<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.confluent.io/blog/windowing-in-kafka-streams/">Original</a>
    <h1>Apache Kafka Beyond the Basics: Windowing</h1>
    
    <div id="readability-page-1" class="page"><div><div data-swiftype-name="body" data-swiftype-type="text"><h2>What Is Windowing? </h2><p>If you’re creating an application with Kafka Streams or ksqlDB, and that application involves aggregations, it’s likely that you’ll use windowing. </p><p>Why is that?</p><p>Well, aggregations of data accumulate over time, and without a limit, these aggregations won’t<i> stop</i> accumulating. Enter windowing, which defines the amount of data that can accumulate. </p><p>Note that windowing takes four forms, depending on whether the window is defined by size and period, or whether the window is event-triggered.</p><table><tbody><tr><td><p><b>Size and Period</b></p></td><td><p><b>Event-Triggered</b></p></td></tr><tr><td><p>Hopping</p></td><td><p>Session</p></td></tr><tr><td><p>Tumbling</p></td><td><p>Sliding</p></td></tr></tbody></table><p>For example, say that you’re designing an <a href="https://avi.im/ko-kr/blog/using-data-pipelines-for-real-time-alerting-with-ksqldb/">application using moisture sensors</a> to alert when a houseplant gets too dry. You can perform a filter for plants with low moisture readings in the past hour. If that filter returns anything, that event can trigger an aggregation over a window tumbling on every hour. The result is written to the alerts. </p><p>Let’s take a look at each of the types of windowing in finer detail. </p><h2>Hopping</h2><h3>What is a hopping window?</h3><p>A hopping window is bound by time and defined by a window size and the size of the time block at which it advances (both measured in seconds).</p><p>Consider the red window in the above diagram and think about it advancing through time: if you had a window size of 50 seconds but an advance size of 15 seconds, there would be an overlap of 35 seconds between the windows. In a hopping window, the window size is usually set to a larger amount of time than the advance size. The above diagram shows what an overlap might look like if you took the window as a rectangle and superimposed it over a wavy stream of data—the rectangles that overlap represent the overlapping window.</p><p>Note: Tumbling windows never overlap or have gaps. Hopping windows might have gaps or overlaps, or they might not. </p><p>A classic example of a hopping window implementation is a dashboard with moving averages—say, average clicks on a certain e-commerce page, like a product details page for an air fryer, for 2-minute windows in the past 24 hours. </p><h3>Creating a hopping window</h3><p>As stated above, there are two key pieces of information you need to configure hopping windows: window size and advance size. </p><p>When you’re working with Kafka Streams, you need to set both a <code>windowSize</code> and <code>advanceSize</code>. See the more complete example in this <a href="https://developer.confluent.io/learn-kafka/kafka-streams/windowing/">Kafka Streams 101</a> tutorial. </p><p>If you’re implementing a hopping window with ksqlDB, then you need to make sure to create a table using the <code>WINDOW HOPPING</code> syntax. You’ll set the two sizes with <code>SIZE</code> and <code>ADVANCE BY</code>. You can view a more complete example in this <a href="https://developer.confluent.io/tutorials/create-hopping-windows/ksql.html">tutorial</a>. </p><h2>Tumbling</h2><h3>What is a tumbling window?</h3><p>Similar to hopping windows, tumbling windows are also time-based. In fact, a tumbling window is a special subtype of hopping window where <code>windowSize</code> and <code>advanceSize</code> are the same. This means an individual event will only ever be present in one tumbling window––no duplicates. As you can see, this diagram differs from the former in that the rectangles do not overlap, representing the non-overlapping windows. </p><p>Tumbling windows are useful for reporting where you don’t want events to belong to a single window, like taking the aggregate of credit card swipes in the last 55 seconds. </p><h3>Creating a tumbling window</h3><p>Creating a tumbling window in Kafka Streams uses the same process as a hopping window, but you need to make sure that <code>windowSize</code> and <code>advanceSize</code> are the same. </p><p>In ksqlDB, you use the <code>WINDOW TUMBLING</code> syntax on a <code>TABLE</code> and set the <code>SIZE</code>. The tutorials section on the Confluent website houses a full example: <a href="https://developer.confluent.io/tutorials/create-tumbling-windows/ksql.html">How to create tumbling windows</a>.</p><h2>Session</h2><h3>What is a session window?</h3><p>A session window is triggered by events. The mechanism involves something called an “inactivity gap.” This gap is the amount of time within which the window will grow <i>unless interrupted by a new event</i>. When a new event flows in as input, the inactivity window resets and the window continues to grow. If your inactivity window is too short or you have lots of events, this can result in a very long window! </p><p>In the above diagram, the inactivity gaps are represented by blue rectangles, separated by an event which is represented by a star. The rectangle representing the session window spans the inactivity gaps. </p><p>Use cases involve tracking user activity if you wanted to know how many events were generated over a period of time (e.g., how long <i>exactly </i>was the user’s FlixMovie binge?). </p><h3>Creating a session window</h3><p>Creating a session window in Kafka Streams involves setting an <code>inactivityGap</code>. You can see a more complete description in this tutorial: <a href="https://developer.confluent.io/learn-kafka/kafka-streams/windowing/">Windowing</a>. </p><p>The other option is to use ksqlDB, employing a table with a <code>WINDOW SESSION</code> syntax. You can view a tutorial on this here: <a href="https://developer.confluent.io/tutorials/create-session-windows/ksql.html">Create session windows</a>. </p><h2>Sliding</h2><h3>What is a sliding window?</h3><p>A sliding window is also time-based, so the size of the window is defined in seconds. In order for a sliding window to be triggered, some user events must happen within a defined window of time. For example, you might use this type of window if you wanted to calculate the data between “add-to-cart” and “purchase” events from users that were made within the defined amount of time of three hours. </p><p>In the diagram above, the defined amount of time is represented by a large light-blue rectangle. The user events are represented by two gold stars, and the purple rectangle between them represents the data window. </p><h3>Creating a sliding window</h3><p>When you create a sliding window in the Streams API, you need to set <code>timeDifference</code>. You can find a more complete example in this <a href="https://developer.confluent.io/learn-kafka/kafka-streams/windowing/">windowing tutorial on Confluent Developer</a>. </p><p>Support for explicitly setting sliding windows is not yet available in ksqlDB. </p><h2>A note on late events</h2><p>What if your events arrive late? It could skew your analysis; therefore, you can introduce “grace periods” in tumbling, hopping, and sliding windows. It’s basically a set amount of time in which events will be caught by the window, even though the time stamps of those events are greater than the window’s end. Note that events that occur after the grace period won’t be included—those are late for good and will be missed. Session windows don’t have grace periods because they are based on user behavior only, rather than time. </p><p>Since <a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-633%3A+Deprecate+24-hour+Default+Grace+Period+for+Windowed+Operations+in+Streams">KIP-633</a>, there is no default grace period for Kafka Streams. However, <a href="https://docs.ksqldb.io/en/latest/concepts/time-and-windows-in-ksqldb-queries/#:~:text=The%20default%20grace%20period%20is%2024%20hours.&amp;text=Tune%20the%20update%20frequency%20by,streams.">in ksqlDB</a>, the default is 24 hours. </p><h2>Where to go from here</h2><p>If you found this introduction to windowing with Apache Kafka® useful, you may also be interested in this list of resources for a deeper dive:</p><ul><li><p>A Kafka Stream video from the Kafka Streams 101 course: <a href="https://developer.confluent.io/learn-kafka/kafka-streams/windowing/">Windowing</a></p></li><li><p><a href="https://developer.confluent.io/tutorials/creating-first-apache-kafka-streams-application/confluent.html">Kafka Streams Application</a> tutorial </p></li><li><p><a href="https://developer.confluent.io/learn-kafka/ksqldb/intro/?utm_medium=sem&amp;utm_source=google&amp;utm_campaign=ch.sem_br.nonbrand_tp.prs_tgt.dsa_mt.dsa_rgn.namer_lng.eng_dv.all_con.online-talks&amp;utm_term=&amp;placement=&amp;device=c&amp;creative=&amp;gclid=CjwKCAiApvebBhAvEiwAe7mHSLEpVOhNBVyjLRmvSW1syRU2PV13j906tmyRipYvI8xphKx6tUxn5xoCTm0QAvD_BwE">ksqlDB 101 course</a></p></li><li><p><a href="https://developer.confluent.io/tutorials/">Streams tutorials list</a></p></li><li><p>See the <a href="https://developer.confluent.io/patterns/stream-processing/event-aggregator/">Event Aggregator pattern</a></p></li></ul></div></div></div>
  </body>
</html>
