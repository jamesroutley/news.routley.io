<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/cessen/ropey">Original</a>
    <h1>Ropey â€“ A UTF8 text rope for manipulating and editing large text</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/cessen/ropey/actions?query=workflow%3Aci"><img src="https://github.com/cessen/ropey/workflows/ci/badge.svg" alt="CI Build Status"/></a>
<a href="https://crates.io/crates/ropey" rel="nofollow"><img src="https://camo.githubusercontent.com/d27f4778ffb65e43bf945cc3867f1abc6d7ae7a5ab26b6ccde5d43eb452d2288/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f726f7065792e737667" alt="Latest Release" data-canonical-src="https://img.shields.io/crates/v/ropey.svg"/></a>
<a href="https://docs.rs/ropey" rel="nofollow"><img src="https://camo.githubusercontent.com/59404cd6ed0954e4218012c82073c0222b40b7b2bfcb41dfd31f7bf7a35dc8e1/68747470733a2f2f646f63732e72732f726f7065792f62616467652e737667" alt="Documentation" data-canonical-src="https://docs.rs/ropey/badge.svg"/></a></p>
<p dir="auto">Ropey is a utf8 text rope for Rust, designed to be the backing text-buffer for
applications such as text editors.  Ropey is fast, robust, and can handle huge
texts and memory-incoherent edits with ease.</p>

<div dir="auto" data-snippet-clipboard-copy-content="// Load a text file.
let mut text = ropey::Rope::from_reader(
    File::open(&#34;my_great_book.txt&#34;)?
)?;

// Print the 516th line (zero-indexed).
println!(&#34;{}&#34;, text.line(515));

// Get the start/end char indices of the line.
let start_idx = text.line_to_char(515);
let end_idx = text.line_to_char(516);

// Remove the line...
text.remove(start_idx..end_idx);

// ...and replace it with something better.
text.insert(start_idx, &#34;The flowers are... so... dunno.\n&#34;);

// Print the changes, along with the previous few lines for context.
let start_idx = text.line_to_char(511);
let end_idx = text.line_to_char(516);
println!(&#34;{}&#34;, text.slice(start_idx..end_idx));

// Write the file back out to disk.
text.write_to(
    BufWriter::new(File::create(&#34;my_great_book.txt&#34;)?)
)?;"><pre><span>// Load a text file.</span>
<span>let</span> <span>mut</span> text = ropey<span>::</span><span>Rope</span><span>::</span><span>from_reader</span><span>(</span>
    <span>File</span><span>::</span><span>open</span><span>(</span><span>&#34;my_great_book.txt&#34;</span><span>)</span>?
<span>)</span>?<span>;</span>

<span>// Print the 516th line (zero-indexed).</span>
<span>println</span><span>!</span><span>(</span><span>&#34;{}&#34;</span><span>,</span> text<span>.</span>line<span>(</span><span>515</span><span>)</span><span>)</span><span>;</span>

<span>// Get the start/end char indices of the line.</span>
<span>let</span> start_idx = text<span>.</span><span>line_to_char</span><span>(</span><span>515</span><span>)</span><span>;</span>
<span>let</span> end_idx = text<span>.</span><span>line_to_char</span><span>(</span><span>516</span><span>)</span><span>;</span>

<span>// Remove the line...</span>
text<span>.</span><span>remove</span><span>(</span>start_idx..end_idx<span>)</span><span>;</span>

<span>// ...and replace it with something better.</span>
text<span>.</span><span>insert</span><span>(</span>start_idx<span>,</span> <span>&#34;The flowers are... so... dunno.<span>\n</span>&#34;</span><span>)</span><span>;</span>

<span>// Print the changes, along with the previous few lines for context.</span>
<span>let</span> start_idx = text<span>.</span><span>line_to_char</span><span>(</span><span>511</span><span>)</span><span>;</span>
<span>let</span> end_idx = text<span>.</span><span>line_to_char</span><span>(</span><span>516</span><span>)</span><span>;</span>
<span>println</span><span>!</span><span>(</span><span>&#34;{}&#34;</span><span>,</span> text<span>.</span>slice<span>(</span>start_idx..end_idx<span>)</span><span>)</span><span>;</span>

<span>// Write the file back out to disk.</span>
text<span>.</span><span>write_to</span><span>(</span>
    <span>BufWriter</span><span>::</span><span>new</span><span>(</span><span>File</span><span>::</span><span>create</span><span>(</span><span>&#34;my_great_book.txt&#34;</span><span>)</span>?<span>)</span>
<span>)</span>?<span>;</span></pre></div>

<p dir="auto">Ropey is designed and built to be the backing text buffer for applications
such as text editors, and its design trade-offs reflect that.  Ropey is good
at:</p>
<ul dir="auto">
<li>Handling frequent edits to medium-to-large texts.  Even on texts that are
multiple gigabytes large, edits are measured in single-digit microseconds.</li>
<li>Handling Unicode correctly.  It is impossible to create invalid utf8 through
Ropey, and all Unicode line endings are correctly tracked including CRLF.</li>
<li>Having flat, predictable performance characteristics.  Ropey will never be
the source of hiccups or stutters in your software.</li>
</ul>
<p dir="auto">On the other hand, Ropey is <em>not</em> good at:</p>
<ul dir="auto">
<li>Handling texts smaller than a couple of kilobytes or so.  That is to say,
Ropey will handle them fine, but Ropey allocates space in kilobyte chunks,
which introduces unnecessary bloat if your texts are almost always small.</li>
<li>Handling texts that are larger than available memory.  Ropey is an in-memory
data structure.</li>
<li>Getting the best performance for every possible use-case.  Ropey puts work
into tracking both line endings and unicode scalar values, which is
performance overhead you may not need depending on your use-case.</li>
</ul>
<p dir="auto">Keep this in mind when selecting Ropey for your project.  Ropey is very good
at what it does, but like all software it is designed with certain
applications in mind.</p>


<p dir="auto">Ropey&#39;s atomic unit of text is
<a href="https://www.unicode.org/glossary/#unicode_scalar_value" rel="nofollow">Unicode scalar values</a>
(or <a href="https://doc.rust-lang.org/std/primitive.char.html" rel="nofollow"><code>char</code></a>s in Rust)
encoded as utf8.  All of Ropey&#39;s editing and slicing operations are done
in terms of char indices, which prevents accidental creation of invalid
utf8 data.</p>
<p dir="auto">Ropey also supports converting between scalar value indices and utf16 code unit
indices, for interoperation with external APIs that may still use utf16.</p>

<p dir="auto">Ropey knows about line breaks, allowing you to index into and iterate over
lines of text.</p>
<p dir="auto">The line breaks Ropey recognizes are also configurable at build time via
feature flags.  See Ropey&#39;s documentation for details.</p>

<p dir="auto">Ropey has rope slices that allow you to work with just parts of a rope, using
all the read-only operations of a full rope including iterators and making
sub-slices.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Flexible APIs with low-level access</h3><a id="user-content-flexible-apis-with-low-level-access" aria-label="Permalink: Flexible APIs with low-level access" href="#flexible-apis-with-low-level-access"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Although Ropey is intentionally limited in scope, it also provides APIs for
efficiently accessing and working with its internal text chunk
representation, allowing additional functionality to be efficiently
implemented by client code with minimal overhead.</p>

<p dir="auto">Ropey is fast and minimizes memory usage:</p>
<ul dir="auto">
<li>On a recent mobile i7 Intel CPU, Ropey performed over 1.8 million small
incoherent insertions per second while building up a text roughly 100 MB
large.  Coherent insertions (i.e. all near the same place in the text) are
even faster, doing the same task at over 3.3 million insertions per
second.</li>
<li>Freshly loading a file from disk only incurs about 10% memory overhead.  For
example, a 100 MB text file will occupy about 110 MB of memory when loaded
by Ropey.</li>
<li>Cloning ropes is <em>extremely</em> cheap.  Rope clones share data, so an initial
clone only takes 8 bytes of memory.  After that, memory usage will grow
incrementally as the clones diverge due to edits.</li>
</ul>

<p dir="auto">Ropey ensures that even though clones share memory, everything is thread-safe.
Clones can be sent to other threads for both reading and writing.</p>

<p dir="auto">Ropey uses unsafe code to help achieve some of its space and performance
characteristics.  Although effort has been put into keeping the unsafe code
compartmentalized and making it correct, please be cautious about using Ropey
in software that may face adversarial conditions.</p>
<p dir="auto">Auditing, fuzzing, etc. of the unsafe code in Ropey is extremely welcome.
If you find any unsoundness, <em>please</em> file an issue!  Also welcome are
recommendations for how to remove any of the unsafe code without introducing
significant space or performance regressions, or how to compartmentalize the
unsafe code even better.</p>

<p dir="auto">Ropey is licensed under the MIT license (LICENSE.md or <a href="http://opensource.org/licenses/MIT" rel="nofollow">http://opensource.org/licenses/MIT</a>)</p>

<p dir="auto">Contributions are absolutely welcome!  However, please open an issue to discuss
larger changes, to avoid doing a lot of work that may get rejected.  Also note
that PRs that add dependencies are very likely to be rejected (Ropey aims to
have minimal dependencies).</p>
<p dir="auto">An overview of Ropey&#39;s design can be found <a href="https://github.com/cessen/ropey/blob/master/design/design.md">here</a>.</p>
<p dir="auto">Unless you explicitly state otherwise, any contribution intentionally submitted
for inclusion in Ropey by you will be licensed as above, without any additional
terms or conditions.</p>
</article></div></div>
  </body>
</html>
