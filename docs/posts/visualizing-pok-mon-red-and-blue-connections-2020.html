<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://peterhajas.com/blog/pokemon_rb_connections.html">Original</a>
    <h1>Visualizing Pok√©mon Red and Blue Connections (2020)</h1>
    
    <div id="readability-page-1" class="page"><article>

<h3>April 14, 2020  ‚Ä¢ ¬†üò∫üó∫</h3>

<p>I love Pok√©mon. My fascination with the series began with the original games released in the US, Pok√©mon Red and Blue (I had the Blue version).</p>

<p>In the past few years, people have been disassembling Pok√©mon games. You can check these out for Pok√©mon <a href="https://github.com/pret/pokered">Red and Blue</a>, <a href="https://github.com/pret/pokecrystal">Crystal</a>, <a href="https://github.com/pret/pokeemerald">Emerald</a>, and others. It&#39;s really cool to be able to compile and build a game that was such a huge part of my youth.</p>

<p>I thought it would be fun to play with this source code, viewing these games through a new lens. A few months ago, I discovered <a href="https://www.graphviz.org">Graphviz</a>, a software package for rendering graphs written in the <a href="https://en.wikipedia.org/wiki/DOT_(graph_description_language)">Dot language</a>. Dot is a very simple language, and it&#39;s easy to filter data into its format. Graphviz includes some command line tools that can render dot files to nice human-readable output. Let&#39;s see how we can use Graphviz to visualize Pok√©mon Red and Blue.</p>

<p>Inside of <code>pokered</code>, there&#39;s a <code>data</code> directory with a <code>mapHeaders</code> subdirectory inside. <code>mapHeaders</code> includes metadata about every overworld map in the game. This includes the connections between maps. For example, here is the metadata for Route 10:</p>

<pre><code>$ cat Route10.asm 
Route10_h:
    db OVERWORLD ; tileset
    db ROUTE_10_HEIGHT, ROUTE_10_WIDTH ; dimensions (y, x)
    dw Route10_Blocks ; blocks
    dw Route10_TextPointers ; texts
    dw Route10_Script ; scripts
    db SOUTH | WEST ; connections
    SOUTH_MAP_CONNECTION ROUTE_10, LAVENDER_TOWN, 0, 0, LavenderTown_Blocks
    WEST_MAP_CONNECTION ROUTE_10, ROUTE_9, 0, 0, Route9_Blocks
    dw Route10_Object ; objects
</code></pre>

<p>So south of Route 10 is Lavender Town, and west is Route 9. We can use this connection data and some simple uses of <code>grep</code> and <code>awk</code> to generate Dot code representing these connections. The following commands are all run from <code>/data/mapHeaders</code> in the <code>pokered</code> repository. First, we use <code>grep</code> to see the connections:</p>

<pre><code>$ grep -R &#34;MAP_CONNECTION&#34; ./
.//PewterCity.asm:  SOUTH_MAP_CONNECTION PEWTER_CITY, ROUTE_2, 5, 0, Route2_Blocks
.//PewterCity.asm:  EAST_MAP_CONNECTION PEWTER_CITY, ROUTE_3, 4, 0, Route3_Blocks
...
</code></pre>

<p>Next, let&#39;s pipe that to <code>awk</code> to print the endpoints of that connection:</p>

<pre><code>$ grep -R &#34;MAP_CONNECTION&#34; ./ | awk -F&#34; &#34; &#39;{ print $3 $4; }&#39;
PEWTER_CITY,ROUTE_2,
PEWTER_CITY,ROUTE_3,
...
</code></pre>

<p>We can use a second <code>awk</code> invocation to print these as Dot edges:</p>

<pre><code>$ grep -R &#34;MAP_CONNECTION&#34; ./ | awk -F&#34; &#34; &#39;{ print $3 $4; }&#39; | awk -F&#34;,&#34; &#39;{ print $1&#34; -- &#34;$2 }&#39;
PEWTER_CITY -- ROUTE_2
PEWTER_CITY -- ROUTE_3
...
</code></pre>

<p>Undirected Dot edges are represented with the two nodes and a <code>--</code> between them.</p>

<p>We can represent a strict (one connection between nodes) graph (non-directed, as these are bidirectional connections) by wrapping all these connections in a <code>strict graph {}</code>:</p>

<pre><code>strict graph {
    PEWTER_CITY -- ROUTE_2
    PEWTER_CITY -- ROUTE_3
    ...
</code></pre>

<p>We can add two other options (<code>overlap=false</code> to avoid edge overlap and <code>splines=true</code> to use splines for edges) to get a better looking graph. Here&#39;s my <code>pokemon_rb_towns_and_routes.dot</code> generated from the above steps:</p>

<pre><code>strict graph {
    overlap=false;
    splines=true;
    PEWTER_CITY -- ROUTE_2
    PEWTER_CITY -- ROUTE_3
    CELADON_CITY -- ROUTE_16
    CELADON_CITY -- ROUTE_7
    ROUTE_9 -- CERULEAN_CITY
    ROUTE_9 -- ROUTE_10
    ROUTE_8 -- SAFFRON_CITY
    ROUTE_8 -- LAVENDER_TOWN
    ROUTE_21 -- PALLET_TOWN
    ROUTE_21 -- CINNABAR_ISLAND
    ROUTE_20 -- CINNABAR_ISLAND
    ROUTE_20 -- ROUTE_19
    ROUTE_22 -- ROUTE_23
    ROUTE_22 -- VIRIDIAN_CITY
    PALLET_TOWN -- ROUTE_1
    PALLET_TOWN -- ROUTE_21
    ROUTE_23 -- INDIGO_PLATEAU
    ROUTE_23 -- ROUTE_22
    VERMILION_CITY -- ROUTE_6
    VERMILION_CITY -- ROUTE_11
    ROUTE_24 -- CERULEAN_CITY
    ROUTE_24 -- ROUTE_25
    ROUTE_18 -- ROUTE_17
    ROUTE_18 -- FUCHSIA_CITY
    ROUTE_19 -- FUCHSIA_CITY
    ROUTE_19 -- ROUTE_20
    ROUTE_25 -- ROUTE_24
    LAVENDER_TOWN -- ROUTE_10
    LAVENDER_TOWN -- ROUTE_12
    LAVENDER_TOWN -- ROUTE_8
    ROUTE_14 -- ROUTE_15
    ROUTE_14 -- ROUTE_13
    ROUTE_15 -- FUCHSIA_CITY
    ROUTE_15 -- ROUTE_14
    ROUTE_17 -- ROUTE_16
    ROUTE_17 -- ROUTE_18
    ROUTE_16 -- ROUTE_17
    ROUTE_16 -- CELADON_CITY
    ROUTE_12 -- LAVENDER_TOWN
    ROUTE_12 -- ROUTE_13
    ROUTE_12 -- ROUTE_11
    ROUTE_13 -- ROUTE_12
    ROUTE_13 -- ROUTE_14
    ROUTE_11 -- VERMILION_CITY
    ROUTE_11 -- ROUTE_12
    CERULEAN_CITY -- ROUTE_24
    CERULEAN_CITY -- ROUTE_5
    CERULEAN_CITY -- ROUTE_4
    CERULEAN_CITY -- ROUTE_9
    ROUTE_10 -- LAVENDER_TOWN
    ROUTE_10 -- ROUTE_9
    ROUTE_5 -- CERULEAN_CITY
    ROUTE_5 -- SAFFRON_CITY
    FUCHSIA_CITY -- ROUTE_19
    FUCHSIA_CITY -- ROUTE_18
    FUCHSIA_CITY -- ROUTE_15
    SAFFRON_CITY -- ROUTE_5
    SAFFRON_CITY -- ROUTE_6
    SAFFRON_CITY -- ROUTE_7
    SAFFRON_CITY -- ROUTE_8
    ROUTE_4 -- ROUTE_3
    ROUTE_4 -- CERULEAN_CITY
    ROUTE_6 -- SAFFRON_CITY
    ROUTE_6 -- VERMILION_CITY
    VIRIDIAN_CITY -- ROUTE_2
    VIRIDIAN_CITY -- ROUTE_1
    VIRIDIAN_CITY -- ROUTE_22
    INDIGO_PLATEAU -- ROUTE_23
    ROUTE_7 -- CELADON_CITY
    ROUTE_7 -- SAFFRON_CITY
    ROUTE_3 -- ROUTE_4
    ROUTE_3 -- PEWTER_CITY
    ROUTE_2 -- PEWTER_CITY
    ROUTE_2 -- VIRIDIAN_CITY
    CINNABAR_ISLAND -- ROUTE_21
    CINNABAR_ISLAND -- ROUTE_20
    ROUTE_1 -- VIRIDIAN_CITY
    ROUTE_1 -- PALLET_TOWN
}
</code></pre>

<p>We can use a simple invocation of <code>neato</code> to produce a PDF file with:</p>

<pre><code>neato -Tpdf pokemon_rb_towns_and_routes.dot &gt; pokemon_rb_towns_and_routes.pdf
</code></pre>

<p>Check it out:</p>

<p><img src="http://peterhajas.com/media/pokemon_rb_towns_and_routes_preview.jpeg" alt="A graph visualizing all towns and routes in Pok√©mon Red and Blue"/>
(<a href="http://peterhajas.com/media/pokemon_rb_towns_and_routes.pdf">PDF file here</a>)</p>

<p>OK, so towns and routes are cool. Can we augment this file to include buildings, tunnels, and rooms? There are <code>warp</code> and <code>warp_to</code> markers in the files in <code>/data/mapObjects</code>. For example, let&#39;s look at <code>SaffronCity.asm</code>:</p>

<pre><code>$ cat data/mapObjects/SaffronCity.asm
SaffronCity_Object:
    db $f ; border block

    db 8 ; warps
    warp 7, 5, 0, COPYCATS_HOUSE_1F
    warp 26, 3, 0, FIGHTING_DOJO
    warp 34, 3, 0, SAFFRON_GYM
    warp 13, 11, 0, SAFFRON_PIDGEY_HOUSE
    warp 25, 11, 0, SAFFRON_MART
    warp 18, 21, 0, SILPH_CO_1F
    warp 9, 29, 0, SAFFRON_POKECENTER
    warp 29, 29, 0, MR_PSYCHICS_HOUSE

    ...

    ; warp-to
    warp_to 7, 5, SAFFRON_CITY_WIDTH ; COPYCATS_HOUSE_1F
    warp_to 26, 3, SAFFRON_CITY_WIDTH ; FIGHTING_DOJO
    warp_to 34, 3, SAFFRON_CITY_WIDTH ; SAFFRON_GYM
    warp_to 13, 11, SAFFRON_CITY_WIDTH ; SAFFRON_PIDGEY_HOUSE
    warp_to 25, 11, SAFFRON_CITY_WIDTH ; SAFFRON_MART
    warp_to 18, 21, SAFFRON_CITY_WIDTH ; SILPH_CO_1F
    warp_to 9, 29, SAFFRON_CITY_WIDTH ; SAFFRON_POKECENTER
    warp_to 29, 29, SAFFRON_CITY_WIDTH ; MR_PSYCHICS_HOUSE

    ...
</code></pre>

<p>(These <code>_WIDTH</code> suffixes seem to indicate the coordinates are inside of the width of the map. We&#39;ll clean them up later.)</p>

<p>So, if we parse out the <code>warp_to</code> statements, we should be able to get a more complete view of the game&#39;s locations and how they connect. Let&#39;s start with a simple <code>grep</code> to find all the <code>warp_to</code> statements (run from <code>/data/mapObjects</code>):</p>

<pre><code>grep -R &#34;warp_to &#34; ./
.//RocketHideoutB4F.asm:    warp_to 19, 10, ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_B3F
.//RocketHideoutB4F.asm:    warp_to 24, 15, ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_ELEVATOR
.//RocketHideoutB4F.asm:    warp_to 25, 15, ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_ELEVATOR
...
</code></pre>

<p>Next, pipe to <code>awk</code> to find the endpoints of the warp:</p>

<pre><code>$ grep -R &#34;warp_to &#34; ./ | awk -F&#34;,&#34; &#39;{ print $3; }&#39;
ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_B3F
ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_ELEVATOR
ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_ELEVATOR
CELADON_MART_3F_WIDTH ; CELADON_MART_4F
CELADON_MART_3F_WIDTH ; CELADON_MART_2F
CELADON_MART_3F_WIDTH ; CELADON_MART_ELEVATOR
BRUNOS_ROOM_WIDTH ; LORELEIS_ROOM
BRUNOS_ROOM_WIDTH ; LORELEIS_ROOM
BRUNOS_ROOM_WIDTH ; AGATHAS_ROOM
BRUNOS_ROOM_WIDTH ; AGATHAS_ROOM
BIKE_SHOP_WIDTH
...
</code></pre>

<p>This is close, but includes some warps that appear to point to themselves (like <code>BIKE_SHOP_WIDTH</code> above). No problem - we can only print lines with <code>;</code> in them using <code>grep</code>:</p>

<pre><code>$ grep -R &#34;warp_to &#34; ./ | awk -F&#34;,&#34; &#39;{ print $3; }&#39; | grep &#34;;&#34;
ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_B3F
ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_ELEVATOR
ROCKET_HIDEOUT_B4F_WIDTH ; ROCKET_HIDEOUT_ELEVATOR
CELADON_MART_3F_WIDTH ; CELADON_MART_4F
CELADON_MART_3F_WIDTH ; CELADON_MART_2F
CELADON_MART_3F_WIDTH ; CELADON_MART_ELEVATOR
...
</code></pre>

<p>OK, almost done. Next, let&#39;s strip out the <code>_WIDTH</code> text and put in edge connections:</p>

<pre><code>$ grep -R &#34;warp_to &#34; ./ | awk -F&#34;,&#34; &#39;{ print $3; }&#39; | grep &#34;;&#34; | sed -e &#34;s/_WIDTH//&#34; | sed -e &#34;s/;/--/&#34;
 ROCKET_HIDEOUT_B4F -- ROCKET_HIDEOUT_B3F
 ROCKET_HIDEOUT_B4F -- ROCKET_HIDEOUT_ELEVATOR
 ROCKET_HIDEOUT_B4F -- ROCKET_HIDEOUT_ELEVATOR
 CELADON_MART_3F -- CELADON_MART_4F
 CELADON_MART_3F -- CELADON_MART_2F
 CELADON_MART_3F -- CELADON_MART_ELEVATOR
...
</code></pre>

<p>(note the leading space here - not a big deal for the Graphviz tools)</p>

<p>Now, we&#39;ll put this all into a <code>pokemon_rb_all.dot</code> file (along with the connections from <code>pokemon_rb_towns_and_routes.dot</code>) to make a graph of all of the locations in Pok√©mon Red and Blue. For this invocation, I also used <code>neato</code>:</p>

<pre><code>neato -Tpdf pokemon_rb_all.dot &gt; pokemon_rb_all.pdf
</code></pre>

<p>This graph is so cool! Check it out:</p>

<p><img src="http://peterhajas.com/media/pokemon_rb_all_preview.jpeg" alt="A graph visualizing all locations in Pok√©mon Red and Blue"/>
(<a href="http://peterhajas.com/media/pokemon_rb_all.pdf">PDF file here</a>, <a href="http://peterhajas.com/media/pokemon_rb_all.dot">dot file here</a>)</p>

<p>There are so many sections of this graph with interesting details, like Victory Road leading into the Indigo Plateau and Elite Four:</p>

<p><img src="http://peterhajas.com/media/pokemon_rb_all_e4.jpeg" alt="A cropped version of the &#34;all locations&#34; graph showing just Victory Road, the Indigo Plateau, and the Elite Four sections of the graph"/></p>

<p>Or the maze-like Silph Company building:</p>

<p><img src="http://peterhajas.com/media/pokemon_rb_all_silph.jpeg" alt="A cropped version of the &#34;all locations&#34; graph showing just the Silph Company building floors"/></p>

<p>I think it&#39;s really cool how easy it is to use simple tools to see these games from a new angle. I hope to look at other aspects of these games sometime in the future.</p>

</article></div>
  </body>
</html>
