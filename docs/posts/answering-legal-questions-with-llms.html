<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hugodutka.com/posts/answering-legal-questions-with-llms/">Original</a>
    <h1>Answering Legal Questions with LLMs</h1>
    
    <div id="readability-page-1" class="page"><div>


<article>
  
  <div><p>If you asked a lawyer whether ChatGPT could do his job, he would laugh you out of the room. The tool is often useful, but can’t handle legal questions end to end. It makes up sources, its reasoning can be flawed, and it may overlook key aspects of the law.</p>
<p>We decided to tackle this problem at <a href="https://hotseatai.com">Hotseat</a>. After iterating multiple times, implementing advanced agentic workflows, and testing with dozens of lawyer, we’re certain that the product has glaring limitations and it won’t replace any jobs soon. However, we figured out an unintuitive, LLM-only method of doing RAG, and we leveraged it to make LLMs answer complex questions about select EU regulations.</p>
<p>In this post, you’re going to learn how to implement a system that can perform advanced reasoning over very long documents.</p>
<h2 id="the-problem">The Problem</h2>
<p>A great answer to a legal question must at least:</p>
<ul>
<li>Be based on sound reasoning;</li>
<li>Quote the source text of the law to be verifiable; and</li>
<li>Take into account all relevant parts of the law.</li>
</ul>
<p>To meet these requirements, we had to put the relevant documents in the prompt - we couldn’t just hope that the LLM was trained on all of the law. We also limited our scope to a single regulation. It made the problem approachable, and we could scale later.</p>
<p>In our first attempts, we<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> fed the entire 226 pages of the <a href="https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:52021PC0206">EU’s AI Act</a> into GPT-4 and asked a sample question:</p>
<blockquote>
<p>Does the deployment of an LLM acting as a proxy to optimize SQL queries fall within the regulatory scope of the EU’s AI Act?</p>
</blockquote>
<p>And we found that GPT-4 couldn’t give us a good answer.</p>
<p>A lawyer would start by asking some helper questions:</p>
<ol>
<li>Does the proxy meet the definition of an AI system?</li>
<li>Can the proxy be classified as a high-risk AI system?</li>
<li>Will the proxy process personal or sensitive data?</li>
</ol>
<p>But in a single response, GPT-4 couldn’t both break down the question and answer it. The former task requires a high-level analysis of the document, and the latter - low-level focus on details.</p>
<h2 id="the-solution">The Solution</h2>
<p>We split answering the question into subtasks.</p>
<p>The rough idea is to:</p>
<ol>
<li>Make GPT-4 figure out which subquestions it should ask; then</li>
<li>Answer each subquestion independently; and</li>
<li>Aggregate the findings into a single response.</li>
</ol>
<h3 id="breaking-down-the-question">Breaking Down the Question</h3>
<p>To answer a legal question based on a single regulation, GPT-4 must first find the relevant sections. It requires high-level reasoning across the entire document.</p>
<p>We discovered that GPT-4 can complete this task well, provided you prompt it carefully. All the standard prompt engineering guidelines apply. Crucial were:</p>
<ul>
<li><strong>Structuring the document with Markdown.</strong> Without it, reasoning over 80,000 tokens wouldn’t work.</li>
<li><strong>Roleplaying.</strong> We framed the task as a senior lawyer planning out work for a junior lawyer.</li>
<li><a href="https://platform.openai.com/docs/guides/prompt-engineering/give-the-model-time-to-think"><strong>Tokens to “think.”</strong></a> We gave the model space to produce internal notes about the task - like how it understands the user’s question - before asking for the plan itself.</li>
</ul>
<p>We designed the output so it corresponds to a list of subquestions required to answer the main question. Each point is self-contained; it includes specific instructions and references to sections of the document. If a lawyer looked at any single step, they could carry it out themselves.</p>
<p>Here’s what GPT-4 gave us:</p>
<div>
<h4 id="plan-for-the-junior-lawyer">Plan for the Junior Lawyer</h4>
<ol>
<li><strong>Identify Relevant High-Risk Categories</strong>:
<ul>
<li>Analyze <strong>Annex III</strong> for high-risk AI systems to see if the language model fits under any listed categories.</li>
</ul>
</li>
<li><strong>Examine Requirements for High-Risk AI Systems</strong>:
<ul>
<li>Look at <strong>Articles 8-15</strong> to understand general requirements for high-risk AI systems.</li>
</ul>
</li>
<li>…</li>
</ol>
<p><em>(The other 7 points truncated for brevity. Full plan <a href="https://gist.github.com/hugodutka/9ba6cf3e172f38b288dc1705ecde9967">here</a>, and the prompt <a href="https://gist.github.com/hugodutka/6ef19e197feec9e4ce42c3b6994a919d">here</a>.)</em></p>
</div>

<p>The quality of the plans still surprises me. When we analyzed them for questions from actual lawyers, we found that GPT-4 generally covers all necessary subquestions.</p>
<h3 id="answering-subquestions">Answering Subquestions</h3>
<p>The plan is executed by a simple AI agent. In fact, just a single conversation that GPT-4 has with itself.</p>
<p>GPT-4 is prompted with instructions to assume the role of a “master agent” tasked with answering a legal question based on the pre-generated plan. It can delegate subquestions to “junior lawyers” - in fact, separate GPT-4 chats - by calling <a href="https://platform.openai.com/docs/guides/function-calling">functions</a>.</p>
<p>Here’s an example function call:</p>
<div><pre tabindex="0"><code data-lang="js"><span><span><span>AnnexAnalysis</span>({
</span></span><span><span>  <span>&#34;task&#34;</span><span>:</span> <span>&#34;Analyze Annex III for high-risk AI systems to see if the language model fits under any listed categories.&#34;</span>,
</span></span><span><span>  <span>&#34;annexes&#34;</span><span>:</span> [<span>&#34;Annex III&#34;</span>],
</span></span><span><span>  <span>&#34;legal_question&#34;</span><span>:</span> <span>&#34;Does the deployment of an LLM acting as a proxy to optimize SQL queries fall within the regulatory scope of the EU&#39;s AI Act?&#34;</span>
</span></span><span><span>})
</span></span></code></pre></div><p>We convert such calls into prompts that contain the task, the question, the specified parts of the regulation, and instructions to carry out the task. Whatever GPT-4 outputs is fed back into the master chat as the junior lawyer’s answer.</p>
<p>We preprocess the regulation so that when a call contains a reference to “Annex III,” we know which pages to put into the “junior lawyer’s” prompt. This is the LLM-based RAG I mentioned in the introduction.</p>
<p>Compared to analyzing the entire AI Act, GPT-4’s reasoning is massively boosted when it’s given a clear task and a short context. With a 5k-token-long prompt, you can even usually trust the LLM to correctly quote the source, which is useful to a user verifying the final answer.</p>
<p>We implemented the master AI agent as a while loop. It goes on as long as GPT-4 calls functions, going through the plan step by step. Eventually, after all subquestions are answered, it outputs the final answer in a format we can detect with a regex. We then break the loop and return the answer to the user.</p>
<p>You can see the final answer <a href="https://hotseatai.com/ans/does-the-development-and-deployment-of-q_2azysfQoPxFksVXKW8TYw2TGT79#legal-trace">here</a>, in the “Legal trace” section.</p>
<p>Here’s <a href="https://gist.github.com/hugodutka/58ccf2d104c0fe9a8f7bde585d304d59">the master prompt</a> along with <a href="https://gist.github.com/hugodutka/004b8e90ca55e5c6f8f83e3eb603cf01">function definitions</a>, and here’s <a href="https://gist.github.com/hugodutka/d19137accea33fc4a0105f94f7f296c0">the junior lawyer’s prompt</a>.</p>
<h2 id="results-and-limitations">Results and Limitations</h2>
<p>Answering a question this way takes 5 to 10 minutes and costs about $2 with GPT-4.</p>
<p>The highlight of testing the system with dozens of lawyers was when a GDPR specialist reviewed its answers. The lawyer ranked 8 out of 10 responses as excellent, and the remaining 2 as overly cautious in interpreting the law.</p>
<p>However, over the long term, we found that GPT-4 can identify subquestions very well but often can’t answer them correctly. In non-trivial scenarios, it makes logical errors.<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup></p>
<p>Lawyers also told us that when they answer a question, they rarely touch upon a single regulation. Not only do they analyze multiple regulations, but they also take into account supporting documents such as various guidelines, regulatory technical standards, and court rulings. In contrast, this system can only process a single document at a time.</p>
<p>We’ve learned that the combination of high latency, faulty reasoning, and limited document scope kills usage. No lawyer wants to expend effort to ask a detailed question, wait 10 minutes for an answer, wade through a 2-pages-long response, and find that the AI made an error.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Keeping all the limitations in mind, dividing complex jobs into simple tasks improves the reasoning capabilities of LLMs dramatically.</p>
<p>While the system isn’t directly useful for lawyers yet, the underlying architecture can be generalized to other problems. If less-than-perfect reasoning and high latency are acceptable, you could use it to answer arbitrary questions about arbitrary documents.</p>
<p>If solving such problems is interesting to you, we’re looking for another co-founder. We’re still early, but we’ve learned a ton about how lawyers do legal research. Our next steps will be focused on semantic search that actually works, helping law firms navigate through thousands of legal documents.<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup> If you’d like to build a meaningful product in the legal tech space, please check out our <a href="https://go.gkk.dev/request-for-cofounder">request for a co-founder</a>. We’d love to hear from you.</p>

</div>
  
  
  
  
  
</article>

</div></div>
  </body>
</html>
