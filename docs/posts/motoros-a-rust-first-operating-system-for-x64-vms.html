<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/moturus/motor-os">Original</a>
    <h1>MotorOS: a Rust-first operating system for x64 VMs</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Motūrus project builds a simple, fast, and secure operating system (Motūrus OS) for the cloud.</p>
<p dir="auto">In more specific terms, Motūrus OS (sometimes called Motor OS),
is a new operating system targeting virtual machine-based workloads such as web serving, &#34;serverless&#34;, edge caching, etc.</p>
<p dir="auto"><a href="https://github.com/moturus/motor-os/blob/main/docs/screenshot.md">Screenshot</a></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-why" aria-hidden="true" tabindex="-1" href="#why"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Why?</h2>
<p dir="auto">At the moment, most virtualized production workloads run Linux.
While Linux has many advanced features that in many
situations mean it is the only reasonable OS choice, there are
several complications that make it not ideal, in theory,
for some virtualized workloads:</p>
<ul dir="auto">
<li>Linux is optimized for baremetal, which leads to inefficiencies
when it is used inside a VM that is running on a Linux host:
<ul dir="auto">
<li>duplicate block caches</li>
<li>duplicate page table walks</li>
<li>the host scheduler can preempt the VCPU holding a spinlock in the VM&#39;s kernel</li>
</ul>
</li>
<li>Linux is difficult to use:
<ul dir="auto">
<li>Docker, Nix OS, &#34;serverless&#34;, etc. all exist because of Linux&#39;s complexity</li>
</ul>
</li>
<li>Linux has, historically, not been very secure</li>
</ul>
<p dir="auto">A new operating system built from ground-up with the focus
on virtualized workloads can be made much simpler and more
secure than Linux, while matching or exceeding its
performance and/or efficiency.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-what" aria-hidden="true" tabindex="-1" href="#what"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>What?</h2>
<p dir="auto">Motūrus OS is a microkernel-based operating system, built in
Rust, that targets virtualized workloads exclusively. It
currently supports x64 KVM-based virtual machines, and can
run in either Qemu or Cloud Hypervisor.</p>
<p dir="auto">Rust is <em>the</em> language of Motūrus OS: not only it is
implemented in Rust, it also exposes its ABI in Rust, not C.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-what-works" aria-hidden="true" tabindex="-1" href="#what-works"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>What works</h3>
<p dir="auto">While at the moment most of the subsystems are working in only
POC/MVP mode, they <strong>are</strong> working, and you can run, say, a web
server.</p>
<p dir="auto">More specifically, these things work:</p>
<ul dir="auto">
<li>boots via MBR (Qemu) or PVH (Cloud Hypervisor) in about 200ms</li>
<li>himem micro-kernel</li>
<li>scheduling:
<ul dir="auto">
<li>a simple multi-processor round robin (SMP)</li>
<li>in-kernel scheduling is cooperative
<ul dir="auto">
<li>the kernel is very small and does not block, so does not need to be preemptible</li>
</ul>
</li>
<li>the userspace is preemptible</li>
</ul>
</li>
<li>memory management:
<ul dir="auto">
<li>only 4K pages at the moment</li>
<li>stacks are guarded</li>
<li>page faults in the userspace work and are properly handled (only stack memory allocations are currently lazy)</li>
</ul>
</li>
<li>I/O subsystem (in the userspace)
<ul dir="auto">
<li>VirtIO-BLK and VirtIO-NET <a href="https://github.com/moturus/motor-os/tree/main/src/lib/virtio">drivers</a></li>
<li>two simple filesystems
(<a href="https://crates.io/crates/srfs" rel="nofollow">srfs</a> and
<a href="https://crates.io/crates/flatfs" rel="nofollow">flatfs</a>)</li>
<li><a href="https://crates.io/crates/smoltcp" rel="nofollow">smoltcp</a>-based networking (TCP only at the moment)
<ul dir="auto">
<li>a simple <a href="https://github.com/moturus/motor-os/tree/main/src/bin/httpd">httpd</a> is provided</li>
</ul>
</li>
</ul>
</li>
<li>the userspace:
<ul dir="auto">
<li>multiple processes, with preemption</li>
<li>threads, TLS</li>
<li>Rust&#39;s standard library <a href="https://github.com/moturus/rust/tree/moturus-2023-12-16">mostly ported</a>
<ul dir="auto">
<li>Rust programs that use Rust standard library and do not
depend, directly or indirectly, on Unix or Windows FFI,
will cross-compile for Motūrus OS and run, subject to
&#34;what does not work&#34; below</li>
</ul>
</li>
<li>a simple <a href="https://github.com/moturus/rush">unix-like shell</a> in the serial console</li>
</ul>
</li>
</ul>
<h3 tabindex="-1" dir="auto"><a id="user-content-what-does-not-work" aria-hidden="true" tabindex="-1" href="#what-does-not-work"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>What does not work</h3>
<p dir="auto">Most pieces are not yet ready for production use. No security
audit has been made. It is very easy to hit a &#34;not implemented&#34;
panic in sys-io (the userspace I/O subsystem).</p>
<p dir="auto">More specifically:</p>
<ul dir="auto">
<li>Filesystem: most Rust std::fs APIs have been implemented as
proof-of-concept, but are slow (synchronous) and will
have to be reimplemented using Motūrus async I/O</li>
<li>Networking:
<ul dir="auto">
<li>std::net::TcpStream is mostly implemented, but there are
todo! panics</li>
<li>other protocols are not implemented yet</li>
<li>performance can (and will) be better</li>
</ul>
</li>
<li>The ecosystem outside Rust std:
<ul dir="auto">
<li>crates like rand or rustls can be compiled and used
with minor tweaks</li>
<li>crates depending on async runtimes (e.g.
<a href="https://tokio.rs/" rel="nofollow">Tokio</a>) will not compile at the moment
<ul dir="auto">
<li><a href="https://github.com/tokio-rs/mio">Tokio Mio</a> should be
not too difficult to port</li>
</ul>
</li>
<li>crates that are wrappers around native Linux or Windows APIs
will not work, obviously</li>
</ul>
</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-how-can-i-buildrun-it" aria-hidden="true" tabindex="-1" href="#how-can-i-buildrun-it"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>How can I build/run it?</h2>
<p dir="auto">See <a href="https://github.com/moturus/motor-os/blob/main/docs/build.md">docs/build.md</a>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-thanks" aria-hidden="true" tabindex="-1" href="#thanks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Thanks</h2>
<p dir="auto">Big thanks to Philipp Oppermann for his great <a href="https://os.phil-opp.com/" rel="nofollow">Writing an OS in Rust</a> blog series - it has inspired a lot of people to experiment in this space.</p>
</article>
          </div></div>
  </body>
</html>
