<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nolanlawson.com/2022/06/27/spas-theory-versus-practice/">Original</a>
    <h1>SPAs: theory versus practice</h1>
    
    <div id="readability-page-1" class="page"><div>
				<p>I’ve been thinking a lot recently about Single-Page Apps (SPAs) and Multi-Page Apps (MPAs). I’ve been thinking about <a href="https://nolanlawson.com/2022/05/25/more-thoughts-on-spas/">how MPAs have improved over the years</a>, and <a href="https://nolanlawson.com/2022/05/29/state-is-hard-why-spas-will-persist/">where SPAs still have an edge</a>. I’ve been thinking about <a href="https://nolanlawson.com/2022/06/09/the-collapse-of-complex-software/">how complexity creeps into software</a>, and why a developer may choose a more complex but powerful technology at the expense of a simpler but less capable technology.</p>
<p>I think this core dilemma – complexity vs simplicity, capability vs maintainability – is at the heart of a lot of the debates about web app architecture. Unfortunately, these debates are so often tied up in other factors (a kind of <a href="https://css-tricks.com/the-great-divide/">web dev culture war</a>, <a href="https://nolanlawson.com/2022/02/02/five-years-of-quitting-twitter/">Twitter-stoked conflicts</a>, maybe even a generational gap) that it can be hard to see clearly what the debate is even about.</p>
<p>At the risk of grossly oversimplifying things, I propose that the core of the debate can be summed up by these truisms:</p>
<ol>
<li>The best SPA is better than the best MPA.</li>
<li>The <em>average</em> SPA is worse than the average MPA.</li>
</ol>
<p>The first statement should be clear to most seasoned web developers. Show me an MPA, and I can show you how to make it better with JavaScript. Added too much JavaScript? I can show you some clever ways to minimize, defer, and multi-thread that JavaScript. Ran into some bugs, because now you’ve deviated from the browser’s built-in behavior? There are always ways to fix it! You’ve got JavaScript.</p>
<p>Whereas with an MPA, you are delegating some responsibility to the browser. Want to animate navigations between pages? You can’t (<a href="https://github.com/WICG/shared-element-transitions/">yet</a>). Want to avoid the flash of white? You can’t, until Chrome <a href="https://developer.chrome.com/blog/paint-holding/">fixes it</a> (and <a href="https://nolanlawson.com/2022/05/25/more-thoughts-on-spas/#comment-223785">it’s not perfect yet</a>). Want to avoid re-rendering the whole page, when there’s only a small subset that actually needs to change? You can’t; it’s a “full page refresh.”</p>
<p>My second truism may be more controversial than the first. But I think time and experience have shown that, whatever the promises of SPAs, the reality has been less convincing. It’s not hard to find examples of poorly-built SPAs that score badly on a variety of metrics (performance, accessibility, reliability), and which could have been built better and more cheaply as a bog-standard MPA.</p>
<h2>Example: subsequent navigations</h2>
<p>To illustrate, let’s consider one of the main value propositions of an SPA: making subsequent navigations faster.</p>
<p>Rich Harris recently offered <a href="https://twitter.com/Rich_Harris/status/1539084063558062080">an example</a> of using <a href="https://kit.svelte.dev">the SvelteKit website</a> (SPA) compared to <a href="https://astro.build/">the Astro website</a> (MPA), showing that page navigations on the Svelte site were faster.</p>
<p>Now, to be clear, this is a bit of an unfair comparison: the Svelte site is preloading content when you hover over links, so there’s no network call by the time you click. (Nice optimization!) Whereas the Astro site is not using a Service Worker or other offlining – if you throttle to 3G, it’s even slower relative to the Svelte site.</p>

<p>But I totally believe Rich is right! Even with a Service Worker, Astro would have a hard time beating SvelteKit. The amount of DOM being updated here is small and static, and doing <a href="https://github.com/sveltejs/sites/blob/828d5284dc7ae651ebe496b15adcca8876efe69d/packages/site-kit/src/lib/docs/Section.svelte#L19">the minimal updates</a> in JavaScript should be faster than asking the browser to re-render the full HTML. It’s hard to beat <code>element.innerHTML = &#39;...&#39;</code>.</p>
<p>However, in many ways this site represents the ideal conditions for an SPA navigation: it’s small, it’s lightweight, it’s built by the kind of experts who build their own JavaScript framework, and those experts are also keen to get performance right – since this website is, in part, a showcase for the framework they’re offering. What about real-world websites that <em>aren’t</em> built by JavaScript framework authors?</p>
<p>Anthony Ricaud recently gave <a href="https://www.youtube.com/watch?v=Px3NTHZb0S0">a talk</a> (in French – apologies to non-Francophones) where he analyzed the performance of real-world SPAs. In the talk, he asks: What if these sites used standard MPA navigations?</p>
<p>To answer this, he built a proxy that strips the site of its first-party JavaScript (leaving the kinds of ads and trackers that, sadly, many teams are not allowed to forgo), as well as another version of the proxy that doesn’t strip any JavaScript. Then, he scripted WebPageTest to click an internal link, measuring the load times for both versions (on throttled 4G).</p>
<p>So which was faster? Well, out of the three sites he tested, on both mobile (Moto G4) and desktop, the MPA was either just as fast or faster, every time. In some cases, the WebPageTest filmstrips even showed that the MPA version was faster by several seconds. (Note again: these are <em>subsequent navigations</em>.)</p>
<p>On top of that, the MPA sites gave immediate feedback to the user when clicking – showing a loading indicator in the browser chrome. Whereas some of the SPAs didn’t even manage to show a “skeleton” screen before the MPA had already finished loading.</p>
<div data-shortcode="caption" id="attachment_12165"><p><a href="https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png"><img loading="lazy" aria-describedby="caption-attachment-12165" data-attachment-id="12165" data-permalink="https://nolanlawson.com/2022/06/27/spas-theory-versus-practice/vlcsnap-2022-06-25-16h27m34s714/" data-orig-file="https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png" data-orig-size="1920,1080" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="vlcsnap-2022-06-25-16h27m34s714" data-image-description="" data-image-caption="&lt;p&gt;Screenshot from Anthony Ricaud’s talk. Note that the SPA version is on the top (5.5s) and the MPA version is on bottom (2.5s).&lt;/p&gt;
" data-medium-file="https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=300" data-large-file="https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=570" src="https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=570&amp;h=321" alt="Screenshot from conference talk showing a speaker on the left and a WebPageTest filmstrip on the right. The filmstrip compares two sites: the first takes 5.5 seconds and the second takes 2.5 seconds" width="570" height="321" srcset="https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=570&amp;h=321 570w, https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=1140&amp;h=642 1140w, https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=150&amp;h=84 150w, https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=300&amp;h=169 300w, https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=768&amp;h=432 768w, https://nolanwlawson.files.wordpress.com/2022/06/vlcsnap-2022-06-25-16h27m34s714.png?w=1024&amp;h=576 1024w" sizes="(max-width: 570px) 100vw, 570px"/></a></p><p id="caption-attachment-12165">Screenshot from Anthony Ricaud’s talk. The SPA version is on top (5.5s), and the MPA version is on bottom (2.5s).</p></div>
<p>Now, I don’t think this experiment is perfect. As Anthony admits, removing inline <code>&lt;script&gt;</code>s removes some third-party JavaScript as well (the kind that injects itself into the DOM). Also, removing first-party JavaScript removes some non-SPA-related JavaScript that you’d need to make the site interactive, and removing any render-blocking inline <code>&lt;script&gt;</code>s would inherently improve the visual completeness time.</p>
<p>Even with a perfect experiment, there are a lot of variables that could change the outcome for other sites:</p>
<ul>
<li>How fast is the <abbr title="Server-Side Rendering">SSR</abbr>?</li>
<li>Is the HTML streamed?</li>
<li>How much of the DOM needs to be updated?</li>
<li>Is a network request required at all?</li>
<li>What JavaScript framework is being used?</li>
<li>How fast is the client CPU?</li>
<li>Etc.</li>
</ul>
<p>Still, it’s pretty gobsmacking that JavaScript was slowing these sites down, <em>even in the one case</em> (subsequent navigations) where JavaScript should be making things faster.</p>
<h2>Exhausted developers and clever developers</h2>
<p>Now, let’s return to my truisms from the start of the post:</p>
<ol>
<li>The best SPA is better than the best MPA.</li>
<li>The <em>average</em> SPA is worse than the average MPA.</li>
</ol>
<p>The cause of so much debate, I think, is that two groups of developers may look at this situation, agree on the facts on the ground, but come to two different conclusions:</p>
<blockquote><p>
  “The average SPA sucks? Well okay, I should stop building SPAs then. Problem solved.” <em>– Exhausted developer</em>
</p></blockquote>

<blockquote><p>
  “The average SPA sucks? That’s just because people haven’t tried hard enough! I can think of 10 ways to fix it.” <em>– Clever developer</em>
</p></blockquote>
<p>Let’s call these two archetypes <em>the exhausted developer</em> and <em>the clever developer</em>.</p>
<p>The exhausted developer has had enough with managing the complexity of “modern” web sites and web applications. Too many build tools, too many code paths, too much to think about and maintain. They have <a href="https://medium.com/@ericclemmons/javascript-fatigue-48d4011b6fc4">JavaScript fatigue</a>. Throw it all away and simplify!</p>
<p>The clever developer is similarly frustrated by the state of modern web development. But they also deeply understand how the web works. So when a tool breaks or a framework does something in a sub-optimal way, it irks them, because they can think of a better way. Why can’t a framework or a tool fix this problem? So they set out to find a new tool, or to build it themselves.</p>
<p>The thing is, I think <em>both</em> of these perspectives are right. Clever developers can always improve upon the status quo. Exhausted developers can always save time and effort by simplifying. And one group can even help the other: for instance, maybe <a href="https://parceljs.org/">Parcel</a> is approachable for those exhausted by <a href="https://webpack.js.org/">Webpack</a>, but a clever developer had to go and build Parcel first.</p>
<h2>Conclusion</h2>
<p>The disparity between the best and the average SPA has been around since the birth of SPAs. In the mid-2000s, people wanted to build SPAs because they saw <a href="https://www.wired.com/2014/04/gmail-ten/">how amazing GMail was</a>. What they didn’t consider is that Google had a crack team of experts monitoring every possible problem with SPAs, right down to esoteric topics like <a href="https://web.dev/effectivemanagement/">memory leaks</a>. (Do you have a team like that?)</p>
<p>Ever since then, JavaScript framework and tooling authors have been trying to democratize SPA tooling, bringing us the kinds of optimizations previously only available to the Googles and the Facebooks of the world. Their intentions have been admirable (I would put my own <a href="https://github.com/nolanlawson/fuite/"><code>fuite</code></a> on that pile), but I think it’s fair to say the results have been mixed.</p>
<p>An expert developer can stand up on a conference stage and show off the amazing scores for their site (perfect performance! perfect accessibility! perfect SEO!), and then an excited conference-goer returns to their team, convinces them to use the same tooling, and two years later they’ve built a monstrosity. When this happens enough times, the same conference-goer may start to distrust the next dazzling demo they see.</p>
<p>And yet… the web dev community marches forward. Today I can grab any number of “starter” app toolkits and build something that comes out-of-the-box with code-splitting, Service Workers, tree-shaking, a thousand different little micro-optimizations that I don’t even have to know the names of, because someone else has already thought of it and gift-wrapped it for me. That is a miracle, and we should be grateful for it.</p>
<p>Given enough innovation in this space, it is possible that, someday, the average SPA could be pretty great. If it came batteries-included with proper scroll, focus, and <a href="https://www.gatsbyjs.com/blog/2019-07-11-user-testing-accessible-client-routing/">screen reader announcements</a>, tooling to identify performance problems (including memory leaks), progressive DOM rendering (e.g. <a href="https://jakearchibald.com/2016/fun-hacks-faster-content/">Jake Archibald’s hack</a>), and a bunch of other optimizations, it’s possible that developers would fall into the “pit of success” and consistently make SPAs that outclass the equivalent MPA. I remain skeptical that we’ll get there, and even the best SPA would still have problems (complexity, performance on slow clients, etc.), but I can’t fault people for trying.</p>
<p>At the same time, browsers never stop taking the lessons from userland and upstreaming them into the browser itself, giving us more lines of code we can potentially delete. This is why it’s important to periodically re-evaluate the assumptions baked into our tooling.</p>
<p>Today, I think the core dilemma between SPAs and MPAs remains unresolved, and will maybe never be resolved. Both SPAs and MPAs have their strengths and weaknesses, and the right tool for the job will vary with the size and skills of the team and the product they’re trying to build. It will also vary over time, as browsers evolve. The important thing, I think, is to remain open-minded, skeptical, and analytical, and to accept that everything in software development has tradeoffs, and none of those tradeoffs are set in stone.</p>
							</div></div>
  </body>
</html>
