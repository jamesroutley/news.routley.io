<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/t184256/nix-on-droid">Original</a>
    <h1>Nix-on-droid: Nix-enabled environment for your Android device (termux-based)</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a href="https://f-droid.org/packages/com.termux.nix" rel="nofollow"><img src="https://camo.githubusercontent.com/16dfb987afb6c25d8d861680d279611161f98237503e0607d97e28461a259354/68747470733a2f2f6664726f69642e6769746c61622e696f2f617274776f726b2f62616467652f6765742d69742d6f6e2e706e67" alt="Get it on F-Droid" height="80" data-canonical-src="https://fdroid.gitlab.io/artwork/badge/get-it-on.png"/></a></p>
<p dir="auto">Nix package manager on Android, in a single-click installable package. This is
not full <a href="https://nixos.org/" rel="nofollow">NixOS</a> running inside Android, but you get easy
access to <a href="https://github.com/NixOS/nixpkgs">nixpkgs</a>&#39; vast collection of
(precompiled!) software and the best package manager under the sun. It&#39;s
prototype-grade quality as of now, but hey, it works!</p>
<p dir="auto">It does not require root, user namespaces support or disabling SELinux,
but it relies on <code>proot</code> and other hacks instead.
It uses <a href="https://github.com/t184256/nix-on-droid-app">a fork</a>
of <a href="https://github.com/termux/termux-app">Termux-the-terminal-emulator app</a>,
but has no relation to <a href="https://termux.com/" rel="nofollow">Termux-the-distro</a>.
Please do not pester Termux folks about Nix-on-Droid.</p>
<p dir="auto">This repository contains:</p>
<ol dir="auto">
<li>Nix expressions that generate a bootstrap zipball,
which is then used to install Nix package manager on Android
along with the <code>nix-on-droid</code> executable.</li>
<li>A module system for configuring the local Nix-on-Droid installation directly
on the device.</li>
</ol>
<p dir="auto">It is only tested with aarch64 (64-bit ARM devices).
It also used to compile for i686 devices, but the developers don&#39;t own any
and nobody has reported whether it actually worked or not,
so it&#39;s no longer built unless a user shows up.
Sorry, it would not work on 32-bit ARM devices
and it&#39;s not an easy feat to pull off.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-try-it-out" aria-label="Heading link" href="#try-it-out"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Try it out</h2>
<p dir="auto"><a href="https://f-droid.org/packages/com.termux.nix" rel="nofollow">Install it from F-Droid</a>,
launch the app, press OK,
expect many hundreds megabytes of downloads to happen.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-nix-on-droid-and-the-module-system" aria-label="Heading link" href="#nix-on-droid-and-the-module-system"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Nix-on-Droid and the module system</h2>
<h3 tabindex="-1" dir="auto"><a id="user-content-config-file" aria-label="Heading link" href="#config-file"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Config file</h3>
<p dir="auto">The Nix-on-Droid system can be managed through a custom config
file in <code>~/.config/nixpkgs/nix-on-droid.nix</code> as generated on first build,
for example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{ pkgs, ... }:

{
  environment.packages = [ pkgs.vim ];
  system.stateVersion = &#34;22.11&#34;;
}"><pre>{ <span>pkgs</span><span>,</span> <span>... </span>}:

{
  <span>environment</span>.<span>packages</span> <span>=</span> [ <span>pkgs</span><span>.</span><span>vim</span> ];
  <span>system</span>.<span>stateVersion</span> <span>=</span> <span><span>&#34;</span>22.11<span>&#34;</span></span>;
}</pre></div>
<p dir="auto">An alternative location is <code>~/.config/nixpkgs/config.nix</code> with the key
<code>nix-on-droid</code>, for example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  nix-on-droid =
    { pkgs, ... }:

    {
      environment.packages = [ pkgs.vim ];
      system.stateVersion = &#34;22.11&#34;;
    };
}"><pre>{
  <span>nix-on-droid</span> <span>=</span>
    { <span>pkgs</span><span>,</span> <span>... </span>}:

    {
      <span>environment</span>.<span>packages</span> <span>=</span> [ <span>pkgs</span><span>.</span><span>vim</span> ];
      <span>system</span>.<span>stateVersion</span> <span>=</span> <span><span>&#34;</span>22.11<span>&#34;</span></span>;
    };
}</pre></div>
<p dir="auto">See <a href="https://t184256.github.io/nix-on-droid/" rel="nofollow">https://t184256.github.io/nix-on-droid/</a> for list of all available options.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-home-manager-integration" aria-label="Heading link" href="#home-manager-integration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><a href="https://github.com/rycee/home-manager"><code>home-manager</code></a> integration</h3>
<p dir="auto">To enable <code>home-manager</code> you simply need to follow the instructions already provided in the example <code>nix-on-droid.nix</code>:</p>
<ol dir="auto">
<li>Add <code>home-manager</code> channel:
<div dir="auto" data-snippet-clipboard-copy-content="nix-channel --add https://github.com/rycee/home-manager/archive/release-22.11.tar.gz home-manager
nix-channel --update"><pre>nix-channel --add https://github.com/rycee/home-manager/archive/release-22.11.tar.gz home-manager
nix-channel --update</pre></div>
</li>
<li>Configure <code>home-manager</code>:
<div dir="auto" data-snippet-clipboard-copy-content="{ pkgs, ... }:

{
  # Read Nix-on-Droid changelog before changing this value
  system.stateVersion = &#34;22.11&#34;;

  # insert Nix-on-Droid config

  home-manager.config =
    { pkgs, ... }:
    {
      # Read home-manager changelog before changing this value
      home.stateVersion = &#34;22.11&#34;;

      # insert home-manager config
    };

  # or if you have a separate home.nix already present:
  home-manager.config = ./home.nix;
}"><pre>{ <span>pkgs</span><span>,</span> <span>... </span>}:

{
  <span># Read Nix-on-Droid changelog before changing this value</span>
  <span>system</span>.<span>stateVersion</span> <span>=</span> <span><span>&#34;</span>22.11<span>&#34;</span></span>;

  <span># insert Nix-on-Droid config</span>

  <span>home-manager</span>.<span>config</span> <span>=</span>
    { <span>pkgs</span><span>,</span> <span>... </span>}:
    {
      <span># Read home-manager changelog before changing this value</span>
      <span>home</span>.<span>stateVersion</span> <span>=</span> <span><span>&#34;</span>22.11<span>&#34;</span></span>;

      <span># insert home-manager config</span>
    };

  <span># or if you have a separate home.nix already present:</span>
  <span>home-manager</span>.<span>config</span> <span>=</span> <span>./home.nix</span>;
}</pre></div>
</li>
</ol>
<h3 tabindex="-1" dir="auto"><a id="user-content-nix-on-droid-executable" aria-label="Heading link" href="#nix-on-droid-executable"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>nix-on-droid</code> executable</h3>
<p dir="auto">This executable is responsible for activating new configurations:
Use <code>nix-on-droid switch</code> to activate the current configuration and
<code>nix-on-droid rollback</code> to rollback to the latest build.</p>
<p dir="auto">For more information, please run <code>nix-on-droid help</code>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-build-nix-on-droid-on-your-own" aria-label="Heading link" href="#build-nix-on-droid-on-your-own"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Build Nix-on-Droid on your own</h2>
<p dir="auto">The <a href="https://github.com/t184256/nix-on-droid-app">terminal emulator part</a>
is probably not interesting for you, just download and use a prebuilt one.
If you really want to rebuild it, you can just use Android Studio for that.</p>
<p dir="auto">The zipball generation is probably what you are after.
Get an x86_64 computer with flake-enabled Nix.</p>
<blockquote>
<p dir="auto"><strong>tl;dr</strong>: Use the deploy app like the following which executes all steps mentioned below:</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix run &#34;.#deploy&#34; -- &lt;public_url&gt; &lt;rsync_target&gt;
# or run the following for explanation of this script
nix run &#34;.#deploy&#34;"><pre>nix run <span><span>&#34;</span>.#deploy<span>&#34;</span></span> -- <span>&lt;</span>public_url<span>&gt;</span> <span>&lt;</span>rsync_target<span>&gt;</span>
<span><span>#</span> or run the following for explanation of this script</span>
nix run <span><span>&#34;</span>.#deploy<span>&#34;</span></span></pre></div>
</blockquote>
<p dir="auto">Run</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix build &#34;.#bootstrapZip&#34; --impure"><pre>nix build <span><span>&#34;</span>.#bootstrapZip<span>&#34;</span></span> --impure</pre></div>
<p dir="auto">Put the zip file from <code>result</code> on some HTTP server
and specify the parent directory URL during the installation.
To re-trigger the installation, you can use
&#39;clear data&#39; on the Android app (after backing stuff up, obviously).</p>
<p dir="auto">If you want to change the Nix-on-Droid channel to your custom one,
you can do that either with <code>nix-channel</code> after the installation,
or by setting the environment variable <code>NIX_ON_DROID_CHANNEL_URL</code>.
Other environment variables are <code>NIXPKGS_CHANNEL_URL</code> an
<code>NIX_ON_DROID_FLAKE_URL</code>.</p>
<p dir="auto"><strong>Note</strong>: The <code>proot</code> binary is not built on the android device
(NDK is required for building it, and it&#39;s not available on mobile platforms).
The way we work around it is to push proot derivation to cachix.
The current workaround is to hardcode the path to the wanted <code>proot</code> nix store
path in <code>modules/environment/login/default.nix</code>. During evaluation time on
the android device this store path will be downloaded from the binary cache
(<a href="https://nix-on-droid.cachix.org/" rel="nofollow">https://nix-on-droid.cachix.org/</a>). This in return means the <code>proot</code>
derivation has to be present there or in any other binary cache configured
in the <code>nix.conf</code> on the device.</p>
<p dir="auto">Obviously it&#39;s an annoyance if one wants to fork this repo and test something.
To minimize the hassle with this scenario, proot derivation is also bundled
with the bootstrap zipball. This way you only need your own binary cache
if you are planning to maintain a long-term fork that users can update from.
In case you only care about updates through wiping the data,
or are forking to submit a one-off pull request,
you shouldn&#39;t need a binary cache for that.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-nix-flakes" aria-label="Heading link" href="#nix-flakes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Nix flakes</h2>
<p dir="auto"><strong>Note:</strong> Nix flake support is still experimental at the moment and subject to change.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-examples--templates" aria-label="Heading link" href="#examples--templates"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Examples / templates</h3>
<p dir="auto">A minimal example could look like the following:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  description = &#34;Minimal example of Nix-on-Droid system config.&#34;;

  inputs = {
    nixpkgs.url = &#34;github:NixOS/nixpkgs/nixos-22.11&#34;;

    nix-on-droid = {
      url = &#34;github:t184256/nix-on-droid/release-22.11&#34;;
      inputs.nixpkgs.follows = &#34;nixpkgs&#34;;
    };
  };

  outputs = { self, nixpkgs, nix-on-droid }: {

    nixOnDroidConfigurations.default = nix-on-droid.lib.nixOnDroidConfiguration {
      modules = [ ./nix-on-droid.nix ];
    };

  };
}"><pre>{
  <span>description</span> <span>=</span> <span><span>&#34;</span>Minimal example of Nix-on-Droid system config.<span>&#34;</span></span>;

  <span>inputs</span> <span>=</span> {
    <span>nixpkgs</span>.<span>url</span> <span>=</span> <span><span>&#34;</span>github:NixOS/nixpkgs/nixos-22.11<span>&#34;</span></span>;

    <span>nix-on-droid</span> <span>=</span> {
      <span>url</span> <span>=</span> <span><span>&#34;</span>github:t184256/nix-on-droid/release-22.11<span>&#34;</span></span>;
      <span>inputs</span>.<span>nixpkgs</span>.<span>follows</span> <span>=</span> <span><span>&#34;</span>nixpkgs<span>&#34;</span></span>;
    };
  };

  <span>outputs</span> <span>=</span> { <span>self</span><span>,</span> <span>nixpkgs</span><span>,</span> <span>nix-on-droid</span> }: {

    <span>nixOnDroidConfigurations</span>.<span>default</span> <span>=</span> <span>nix-on-droid</span><span>.</span><span>lib</span><span>.</span><span>nixOnDroidConfiguration</span> {
      <span>modules</span> <span>=</span> [ <span>./nix-on-droid.nix</span> ];
    };

  };
}</pre></div>
<p dir="auto">For more examples and nix flake templates, see <a href="https://github.com/t184256/nix-on-droid/blob/master/templates"><code>templates</code></a> directory or explore with:</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix flake init --template github:t184256/nix-on-droid#advanced"><pre>nix flake init --template github:t184256/nix-on-droid#advanced</pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-usage-with-nix-on-droid" aria-label="Heading link" href="#usage-with-nix-on-droid"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage with <code>nix-on-droid</code></h3>
<p dir="auto">Use <code>nix-on-droid switch --flake path/to/flake#device</code> to build and activate your configuration (<code>path/to/flake#device</code>
will expand to <code>.#nixOnDroidConfigurations.device</code>). If you run <code>nix-on-droid switch --flake path/to/flake</code>, the
<code>default</code> configuration will be used.</p>
<p dir="auto"><strong>Note:</strong> Currently, Nix-on-Droid can not be built with an pure flake build because of hardcoded store paths for proot.
Therefore, every evaluation of a flake configuration will be executed with <code>--impure</code> flag. (This behaviour will be
dropped as soon as the default setup does not require it anymore.)</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-emulate-nix-on-droid-like-environment-with-fakedroid" aria-label="Heading link" href="#emulate-nix-on-droid-like-environment-with-fakedroid"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Emulate Nix-on-Droid-like environment with <code>fakedroid</code></h2>
<p dir="auto">For easier debugging and testing, there is a so-called <code>fakedroid</code> environment which
emulates the on-device environment including proot as good as possible.</p>
<p dir="auto">You can enter this emulated environment with</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix run --impure &#34;.#fakedroid&#34;"><pre>nix run --impure <span><span>&#34;</span>.#fakedroid<span>&#34;</span></span></pre></div>
<p dir="auto">This will install Nix-on-Droid with initial channel setup and save the state of
this session in the <code>.fakedroid</code> directory in the project directory. To enter this
environment with initial flake setup, set <code>USE_FLAKE=1</code> as environment variable.
Channel and flake setups can co-exist in the <code>.fakedroid</code> state directory. To
rebuild/re-test the bootstrap process, remove the <code>.fakedroid</code> directory.</p>
<p dir="auto">To only run a command in fakedroid and not enter an interactive shell, just call it
with the command as arguments:</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix run --impure &#34;.#fakedroid&#34; -- ls -l"><pre>nix run --impure <span><span>&#34;</span>.#fakedroid<span>&#34;</span></span> -- ls -l</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-testing" aria-label="Heading link" href="#testing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Testing</h2>
<p dir="auto">In the <a href="https://github.com/t184256/nix-on-droid/blob/master/tests/on-device">./tests/on-device</a> directory, there is small set
of <a href="https://github.com/bats-core/bats-core">bats</a> tests that can be executed on the
android device or run in the <code>fakedroid</code> environment.</p>
<p dir="auto">To run the tests (on device or in fakedroid), run</p>
<div dir="auto" data-snippet-clipboard-copy-content="nix-on-droid on-device-test"><pre>nix-on-droid on-device-test</pre></div>
<p dir="auto"><strong>Note:</strong> This currently requires a channel setup and should only be executed on
clean installations.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-tips" aria-label="Heading link" href="#tips"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Tips</h2>
<ul dir="auto">
<li>To grant the app access to the storage, use the toggle in the app settings
(reachable from Android settings).</li>
<li>If the terminal freezes, use &#39;Acquire wakelock&#39; button in the notification
and/or tone down your device&#39;s aggressive power saving measures.</li>
<li>We have a <a href="https://github.com/t184256/nix-on-droid/wiki">wiki</a>
with tips and success stories, you&#39;re encouraged to add yours as well.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-technical-overview" aria-label="Heading link" href="#technical-overview"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Technical overview</h2>
<p dir="auto">OK, real brief.</p>
<p dir="auto">Developer&#39;s device:</p>
<ol dir="auto">
<li><code>proot</code> for the target platform is cross-compiled against <code>bionic</code>,
(to fake file paths like <code>/nix/store</code>; think &#39;userspace <code>chroot</code>&#39;)</li>
<li>Target <code>nix</code> is taken from the original release tarball</li>
<li>Target <code>nix</code> database is initialized</li>
<li>Support scripts and config files are built with <code>nix</code> and the Nix-on-Droid
module system</li>
<li>From these, a bootstrap zipball is built and published on an HTTP server</li>
</ol>
<p dir="auto">User&#39;s device:</p>
<ol start="6" dir="auto">
<li>Android app is installed and launched, bootstrap URL is entered</li>
<li>Bootstrap zipball gets downloaded and unpacked</li>
<li>&#39;First boot&#39; begins, Nix builds the environment
(or, possibly, pulls it from Cachix)</li>
<li>Nix installs the environment (login scripts, config files, etc.)</li>
</ol>
<p dir="auto">You can refer to a
<a href="https://nix-on-droid.unboiled.info/nixcon-2019-nix-on-droid.slides.pdf" rel="nofollow">NixCon 2019 presentation talk</a>
for a more extensive overview of the subject.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-licensing-and-credits" aria-label="Heading link" href="#licensing-and-credits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Licensing and credits</h2>
<p dir="auto">Licensed under MIT License, see LICENSE.
Copyright (c) 2019-2021 Alexander Sosedkin and other contributors, see AUTHORS.</p>
<p dir="auto">Two rewrites ago it was based off the official Nix install script
(<a href="https://nixos.org/nix/install" rel="nofollow">https://nixos.org/nix/install</a>),
presumably written by Eelco Dolstra.</p>
<p dir="auto">Is deployed and used with <a href="https://github.com/t184256/nix-on-droid-app">a fork</a>
of <a href="https://github.com/termux/termux-app">Termux-the-terminal-emulator app</a>,
but has no relation to Termux-the-distro.</p>
<p dir="auto">Previous project that did use Termux-the-distro:
<a href="https://github.com/t184256/nix-in-termux">https://github.com/t184256/nix-in-termux</a></p>
</article>
          </div></div>
  </body>
</html>
