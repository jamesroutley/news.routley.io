<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://www.moserware.com/2008/02/does-your-code-pass-turkey-test.html">Original</a>
    <h1>Does Your Code Pass the Turkey Test? (2008)</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        <div>
  

  <article>
    <p>Over the past 6 years or so, I’ve failed each item on “The Turkey Test.” It’s very simple: will your code work properly on a person’s machine in or around the country of Turkey? Take this simple test.</p>

<ol>
  <li>
    <p>Parsing dates from a configuration file using <a href="http://msdn2.microsoft.com/en-us/library/1k1skd40.aspx">DateTime.Parse(string)</a>: </p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDateTime.png" alt=""/></p>

    <p>Does it pass “The Turkey Test?”</p>

    <p>Nope:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDateTimeResult.png" alt=""/></p>

    <p><strong>Reason:</strong> Turkish people write July 4th, 2008 as “04.07.2008”</p>

    <p><strong>Fix:</strong> Always specify what format your date is in. In this case, we use a <a href="http://msdn2.microsoft.com/en-us/library/system.globalization.datetimeformatinfo.invariantinfo.aspx">DateTimeFormat.InvariantInfo</a> which just <em>happens</em> to be USA English’s format (more or less):</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDateTimeFix.png" alt=""/></p>

    <p>Which gives us what we were expecting:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDateTimeResultFixed.png" alt=""/></p>

    <p><a href="http://www.hanselman.com/blog/">Scott Hanselman</a> likes <a href="http://www.hanselman.com/blog/ParsingACultureawareDateTimeOrAvoidingInStr.aspx">to talk</a> <a href="http://www.hanselman.com/blog/DateParseExactAndTheSubtleGooThatIsDateTimeFormatStrings.aspx">about DateTime</a>s. (Be sure to see his DateTime <a href="http://www.hanselman.com/blog/WhatGreatNETDevelopersOughtToKnowMoreNETInterviewQuestions.aspx">interview question</a>).</p>
  </li>
  <li>
    <p>Ok, ok. You knew about dates. I sort of did, but I still got it wrong the first few times. What about this seemingly simple piece of code:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDouble.png" alt=""/></p>

    <p>Does it pass “The Turkey Test?”</p>

    <p>Nope:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDoubleResult.png" alt=""/></p>

    <p><strong>Reason:</strong> Turkish people use a period to group digits (like people in the USA use a comma). Instead of getting a 4.5% discount like you intended, Turkish people will be getting at 45% discount.</p>

    <p><strong>Fix:</strong> Again, always specify your format explicitly:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDoubleFix.png" alt=""/></p>

    <p>Which saves your company from having to go out of business from having too high of discounts:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyDoubleResultFixed.png" alt=""/></p>
  </li>
  <li>
    <p>Say your application reads in some command line parameter:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringUSFail.png" alt=""/></p>

    <p>Forget about Turkey, this won’t even pass in the USA. You need a case insensitive compare. So you try:</p>

    <p><a href="http://msdn2.microsoft.com/en-us/library/zkcaxw5y.aspx">String.Compare(string,string,bool ignoreCase)</a>:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringCompareBad.png" alt=""/></p>

    <p>Or using <a href="http://msdn2.microsoft.com/en-us/library/e78f86at.aspx">String.ToLower()</a>:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringToLowerBad.png" alt=""/></p>

    <p>Or <a href="http://msdn2.microsoft.com/en-us/library/c64xh8f9(VS.80).aspx">String.Equals</a> with <a href="http://msdn2.microsoft.com/en-us/library/system.stringcomparer.currentcultureignorecase.aspx">CurrentCultureIgnoreCase</a>:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringCCIC.png" alt=""/></p>

    <p>Or even a trusty <a href="http://msdn2.microsoft.com/en-us/library/system.text.regularexpressions.regex.aspx">Regular Expression</a>:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringRegexBad.png" alt=""/></p>

    <p>Do <em>any</em> of these pass “The Turkey Test?”</p>

    <p>Not a chance!</p>

    <p><strong>Reason:</strong> You’ve been hit with the “Turkish I” problem.</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/TurkishIToUpper.png" alt=""/></p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/TurkishIToLower.png" alt=""/></p>

    <p><a href="http://blogs.msdn.com/deeptanshuv/archive/2004/09/04/225720.aspx">As</a> <a href="http://www.hanselman.com/blog/UpdateOnTheDasBlogTurkishIBugAndAReminderToMeOnGlobalization.aspx">discussed</a> <a href="http://blogs.msdn.com/michkap/archive/2004/12/03/274288.aspx">by</a> <a href="http://msdn2.microsoft.com/en-us/library/ms973919.aspx">lots</a> <a href="http://msdn2.microsoft.com/en-us/library/ms994325.aspx#cltsafcode_topic4">and</a> <a href="http://www.mail-archive.com/users@lists.ironpython.com/msg04721.html">lots</a> <a href="http://msdn2.microsoft.com/en-us/library/xk2wykcz(VS.71).aspx">of</a> <a href="http://cafe.elharo.com/blogroll/turkish/">people</a>, the “I” in Turkish behaves differently than in most languages. <a href="http://www.unicode.org/charts/PDF/U0100.pdf">Per the Unicode standard</a>, our lowercase “i” becomes “İ” (U+0130 “Latin Capital Letter I With Dot Above”) when it moves to uppercase. Similarly, our uppercase “I” becomes “ı” (U+0131 “Latin Small Letter Dotless I”) when it moves to lowercase.</p>

    <p><strong>Fix:</strong> Again, use an <a href="http://msdn2.microsoft.com/en-us/library/system.stringcomparer.ordinalignorecase.aspx">ordinal (raw byte) comparer</a>, or <a href="http://msdn2.microsoft.com/en-us/library/system.stringcomparer.invariantcultureignorecase.aspx">invariant culture</a> for comparisons unless you absolutely need culturally based linguistic comparisons (which give you uppercase I’s with dots in Turkey)</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringCompareGood.png" alt=""/></p>

    <p>Or </p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringToLowerGood.png" alt=""/></p>

    <p>Or </p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringOIC.png" alt=""/></p>

    <p>And finally, a fix to our Regex friend: </p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyStringRegexGood.png" alt=""/></p>
  </li>
  <li>
    <p>My final example is especially embarrassing. I was actually smug when I wrote something like this (note the comment):</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyZipCodeRegexBad.png" alt=""/></p>

    <p>Does this simple program pass “The Turkey Test?”</p>

    <p>You’re probably hesitant to say “yes” … and rightly so. Because this too fails the test.</p>

    <p><strong>Reason:</strong> As <a href="http://blogs.msdn.com/oldnewthing/archive/2004/03/09/86555.aspx">Raymond Chen points out</a>, there are more than 10 digits out there. Here, I use real Arabic digits (see page 4 of <a href="http://www.unicode.org/charts/PDF/U0600.pdf">this code table</a>):</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyZipCodeRegexFireworks.png" alt=""/></p>

    <p><strong>Fix:</strong> A <a href="http://msdn2.microsoft.com/en-us/library/z0sbec17.aspx">CultureInvariant</a> won’t help you here. The only option is to explicitly specify the character range you mean:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyZipCodeRegexGoodExplicit.png" alt=""/></p>

    <p>Or use the RegexOptions.ECMAScript option. In <s>Java</s><a href="https://en.wikipedia.org/wiki/ECMAScript">ECMAScript</a>, “\d” means [0-9] which gives us:</p>

    <p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyZipCodeRegexGoodECMAScript.png" alt=""/></p>
  </li>
</ol>

<p>“The Turkey Test” poses a very simple question, but yet is full of surprises for guys like me who didn’t realize all the little details. Turkey, as we saw above, is sort of like “New York, New York” in the <a href="https://www.youtube.com/results?search_query=frank+sinatra+%22new+york%2C+new+york%22&amp;search_type=">classic Frank Sinatra song</a>:</p>

<blockquote>
  <p>“These little town blues, are melting away </p>
</blockquote>

<p>If your code properly runs in Turkey, it’ll probably work anywhere.</p>

<p>This brings us to the logo program:</p>

<p><img src="http://www.moserware.com/assets/does-your-code-pass-turkey-test/turkeyTestLogo.png" alt=""/></p>

<p><strong>“Turkey Test” Logo Program Requirements</strong>:</p>

<ol>
  <li>Read Joel Spolsky’s <a href="http://www.joelonsoftware.com/articles/Unicode.html">basic introduction to Unicode</a> to understand the absolute minimum about it.</li>
  <li>Read Microsoft’s “<a href="http://msdn2.microsoft.com/en-us/library/ms973919.aspx">New Recommendations for Using Strings in Microsoft .NET 2.0</a>” article and <a href="http://blogs.msdn.com/bclteam/archive/2007/05/31/string-compare-string-equals-josh-free.aspx">this post</a> by the BCL team.</li>
  <li>Always specify culture and number formatter for all string, parsing, and regular expression you use.</li>
  <li>If you read data from the user and want to process it in a language sensitive matter (e.g. sorting), use the <a href="http://msdn2.microsoft.com/en-us/library/system.globalization.cultureinfo.currentculture.aspx">CurrentCulture</a>. If none of that matters, really try to use use <a href="http://msdn2.microsoft.com/en-us/library/system.stringcomparer.ordinal.aspx">Ordinal</a> comparisons.</li>
  <li>Run <a href="http://msdn2.microsoft.com/en-us/library/bb429476(VS.80).aspx">FxCop</a> on your code and make sure you have no <a href="http://msdn2.microsoft.com/en-us/library/ms182189.aspx">CA1304</a> (SpecifyCultureInfo) or <a href="http://msdn2.microsoft.com/en-us/library/ms182190.aspx">CA1305</a> (SpecifyIFormatProvider) warnings.</li>
  <li>Unit test string comparing operations in the “<a href="https://en.wikipedia.org/wiki/Turkey">tr-TR</a>” culture as well as your local culture (unless you actually live in Turkey, then use a culture like “en-US”).</li>
</ol>

<p>Having successfully passed the above requirements, your software will finally be able to wear “Passed ‘The Turkey Test’” logo with pride.</p>

<p><strong>Note:</strong> Special thanks to my coworker, Evan, for calling the 3rd type of error “Turkeys.” Also, thanks to <a href="http://www.madetostick.com/">Chip and Dan Heath</a> for the “Sinatra Test” idea.</p>

  </article>
  
          
    
    
    
</div>

      </div>
    </div></div>
  </body>
</html>
