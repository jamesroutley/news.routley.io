<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://videoinu.com/blog/firefox-reader-view-heuristics/">Original</a>
    <h1>How does Firefox&#39;s Reader View work? (2020)</h1>
    
    <div id="readability-page-1" class="page"><div> <p> Reader view is Firefox&#39;s answer bloated websites and content-filled websites with non-readable content, but how does it function underneath? </p> <p> The main crux is utilizing a big bag of heuristics and knowledge about how semantic HTML elements <i>should</i> be used and structured to strip the page of content that offers no immediate relevance to the reader. All this while also making the font size bigger and more readable, and the page more distraction-free. </p> <p> If you haven&#39;t tried it out (and are still sticking with Firefox), please do! If you have, then welcome to an episode of how does it work (with more code than usual). </p> <p> The reader view code is in <a href="https://github.com/mozilla/readability">a library form on Mozilla&#39;s Github</a> and is pure Javascript. The code is split into modules for checking the readability of a page (<b>Readability-readerable.js</b>) and the actual conversion of a document to reader view (<b>Readability.js</b>). </p> <p> The conversion function takes in the <code>document</code> and pushes out the article title, HTML string of processed article content, length of an article, in characters, article description (or excerpt automatically extracted from the content), and author metadata (<code>byline</code>). The whole process is a bit heuristical in approach as can be seen in for example <a href="https://github.com/mozilla/readability/blob/52ab9b5c8916c306a47b2119270dcdabebf9d203/Readability.js#L116">hardcoding of site names and attributes</a>, <a href="https://github.com/mozilla/readability/blob/52ab9b5c8916c306a47b2119270dcdabebf9d203/Readability.js#L652"> calculation of title similarities using the length difference</a>, and <a href="https://github.com/mozilla/readability/blob/52ab9b5c8916c306a47b2119270dcdabebf9d203/Readability.js#L1944">node removal thresholds</a>, but in a crude sense the codebase <i>feels</i> pragmatic. Almost industrial. Thankfully nobody has decided to call the if statements with arbitrary numeric thresholds machine learning yet. </p> <p> Retrieving the title from article is simple enough; just get the page title or alternatively whatever metadata we&#39;re trying to push using <a href="https://www.dublincore.org/">Dublin Core</a> (<code>dc:title</code>), Twitter (<code>twitter:title</code>), Open Graph (<code>og:title</code>), or Weibo (<code>weibo:title</code>). What was ever wrong with just <code>&lt;title&gt;</code>? Anyway, as long as we got some title-like property we can move on. Next up, excerpt and author metadata. </p> <p> Getting author information a.k.a. byline relies primarily on either on the correct appearance two attribute=value pairs <code>rel=author</code> or <code>itemprop=author</code>, or <a href="https://github.com/mozilla/readability/blob/52ab9b5c8916c306a47b2119270dcdabebf9d203/Readability.js#L125">a regexp soup matching potential byline matches</a>. Even in this blog where I decided to go fancy with a misused <code>&lt;address&gt;</code> attribute for the author information (or lack thereof), Readability finds the information due to the classname <code>class=&#34;author&#34;</code>. </p> <p> Excerpt isn&#39;t quite as fancy. Extracting the extract primarily relies on finding a meta tag for description similarly to how title was retried (with all the accompanying social media site tags), but if all else fails, the code falls back to retrieving the first paragraph of the text content and trimming it. </p> <p> Reader view is an example of very pragmatic solve-a-real-problem coding, hopefully resulting in a zen-like reading experience for the reader. Even with its beautiful goal, we can only hope that as a tool Reader view will become less useful as sites start adapting more reader-friendly approaches. </p> <p> If you&#39;re a website owner and concerned about reader view (or lacking reader view), here&#39;s a few tools to hopefully help with that. </p> <h2 id="score-checker">Readability score checker</h2> <p> This checker allows you to check the score your page would get from Mozilla&#39;s reader view readability algorithm. The default contents are this page&#39;s source. </p> <p> Paste your page&#39;s HTML source (right click -&gt; View page source) in the following text area. If your page renders HTML with Javascript (using e.g. React or fetching data from server on load), you might have to use Devtools to get the rendered HTML (<code>document.documentElement.outerHTML</code> is a quick method for essentially whole page HTML). </p>  <h2 id="want-reader-view">I want reader view, and don&#39;t have it :(</h2> <p> The reader view algorithm has a few pitholes your site might fall into. We&#39;ll go from the most to the least likely: </p> <ol> <li> Are you using <code>&lt;p&gt;</code>, <code>&lt;pre&gt;</code>, or <code>&lt;div&gt;</code> with immediate <code>&lt;br&gt;</code> children for your text content? <ul> <li> These are the only elements readability algorithm uses to determine the readability of your page </li> </ul> </li> <li> Is the content inside those nodes long enough? <ul> <li> Readability algorithm only starts incrementing your readability score after the node contents hit 140 characters. </li> <li> After 140 characters, the score is increased with the logarithmic <code>sqrt(textContentLength - 140)</code> formula, so two paragraphs of ~150 characters is better than one paragraph of ~300 characters. </li> </ul> </li> <li> Are the text paragraphs hidden or considered unlikely text candidates by the algorithm? <ul> <li> Make sure paragraph is hidden neither by <code>display: none</code> or <code>aria-hidden</code> </li> <li> Avoid the classnames listed <a href="https://github.com/mozilla/readability/blob/master/Readability-readerable.js#L27">here</a> in your text paragraphs </li> </ul> </li> </ol> <h2 id="hate-reader-view">I have reader view, but don&#39;t want it!</h2> <p> Let&#39;s play devil&#39;s advocate for a while. On many websites reader view allows you to essentially skip the paywalls and advertisements sprinkled alongside the article. Therefore, for a publisher it might make sense to actively try to get <i>rid</i> of the reader view. </p> <p> The easiest method would be to just get rid of all <code>p</code>, <code>pre</code>, and <code>div</code> with <code>br</code> tags, but this might cause a lot of effort in restyling everything. Way easier way is to use one of the hardcoded exceptions that Mozilla has added for non-viable readability elements; for instance, any node with class <code>skyscraper</code> is considered hidden (maybe the logic is that those elements are shrouded by clouds). </p> <p> We can achieve this on any page with the following snippet. <code> // Reader view disabler 9000 [...document.querySelectorAll(&#34;p,pre&#34;), ...[...document.querySelectorAll(&#34;div &gt; br&#34;)].map(e =&gt; e.parentNode)] .forEach(e =&gt; e.classList.add(&#34;skyscraper&#34;)); </code> </p>    </div></div>
  </body>
</html>
