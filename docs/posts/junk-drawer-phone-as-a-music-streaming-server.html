<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://davidhampgonsalves.com/junk-drawer-phone-as-a-music-streaming-server/">Original</a>
    <h1>Junk drawer phone as a music streaming server</h1>
    
    <div id="readability-page-1" class="page"><div><p><img src="https://davidhampgonsalves.com/images/android-music-server.jpg" width="100%"/></p><p>I wanted to get a music streaming server running as I have in the past but with the scarcity of RasberryPi’s my I needed to try something new. I had a Samsung Galaxy S7 that had been taking up space in my junk drawer and this post is my journey to give it a new task.</p><p>First step was remembering why I stopped using it. Trying to charge it revealed that the charging port was broken. I didn’t want to dig too deeply into the device but I got lucky and was given another S7 with a bad battery. After destructively taking them apart I was able to swap the batteries and get a working device.</p><h2 id="first-try-no-root-stock-android">First Try, No Root, Stock Android</h2><p>Ideally I wouldn’t have to root the phone and could just get it to take on its new role using its current fireware.</p><p>With that goal in mind my first attempt was using <a href="https://github.com/termux">Termux</a>. It is an awesome terminal emulator wrapped up as an Android app.</p><p>One of Termux limitations is that it can’t run binaries even if they have been built for a matching ARM archetecture. As such I had to build my music streaming server of choice, <a href="https://github.com/navidrome/navidrome">Navidrome</a> on the device. One hickup with this process is that the JS build process eats up all the RAM on the device but building it on a larger machine and sending it over sidesteps that issue and the Go build process can then bundle it up.</p><p>Once I got everything setup I had a working music server BUT because of the limited RAM of the S7, Termux seemed to get agressively killed by Android, even though it was an old device running Android v6 (which didn’t have many of the battery optimizations to kill apps). Even with termux-wake-lock, termux:Boot and everything setup as rundit services I would see server outages.</p><p>After a few days I tried again.</p><h2 id="second-try-postmarketos">Second Try, PostmarketOS</h2><p><a href="https://postmarketos.org/">PostmarketOS</a> would be ideal for this kind of project and would turn the phone into a reliable linux box BUT unless you happen to have (or buy) one of the devices that are well supported you either need to get lucky with one of the non-mainline (testing) devices. In my case there have been working builds but after I got everything on the device it turned out that support had regressed and it is currently (at the time of writing) non-bootable.</p><p>It would proably be fun but timeconsuming to learn enough about the ecosystem so I shelved the project for a couple days until…</p><h2 id="third-try-lineageos">Third Try LineageOS</h2><p>Having run <a href="https://lineageos.org/">LineageOS</a> in the past I thought it might be lightweight enough to free up enough RAM for Termux to be more long lived. Setting this up was straightforward since I already had <a href="https://twrp.me/">TWRP</a> recovery on the device from the PostmarketOS attempt.</p><p>Once LineageOS was on the device I disabled/uninstalled everything non-essential and repeated my setup process from my initial Android attempt. My setup looks like:</p><ul><li>Termux, Termux:Services, Termux:Boot</li><li>Navidrome</li><li>ssh + sftp via openssh</li><li>Dynamic DNS via Cloudflare via <a href="https://github.com/timothymiller/cloudflare-ddns">timothymiller/cloudflare-ddns</a></li></ul><p>All my music wouldn’t fit on the devices internal memory and not having a spare SD card I decided to transcode it all to OPUS. I then found out that it isn’t supported in IOS (and I currently use an IPhone) unless its in a CAF container and Navidrome doesn’t support CAF. Thus I transcoded everything to mp3 at a lower bitrate that was still acceptable to my ears.</p><p>With that I have a faily powerful and reliable music server(based on a few weeks of usage). I’m keeping an eye out for any devices with good PostmarketOS support to try that again.</p><p>The setup guide for this can be found on <a href="https://github.com/davidhampgonsalves/music-server">github</a>.</p></div></div>
  </body>
</html>
