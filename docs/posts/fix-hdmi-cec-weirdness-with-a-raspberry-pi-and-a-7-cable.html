<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://johnlian.net/posts/hdmi-cec/">Original</a>
    <h1>Fix HDMI-CEC weirdness with a Raspberry Pi and a $7 cable</h1>
    
    <div id="readability-page-1" class="page"><article><section><p>For years I treated <a href="https://en.wikipedia.org/wiki/Consumer_Electronics_Control">HDMI-CEC</a> like a house spirit: sometimes helpful, mostly temperamental, never fully understood. My living-room stack is straightforward: Samsung TV on <a href="https://en.wikipedia.org/wiki/HDMI#ARC_and_eARC">ARC</a> (NOT eARC - story for another day), Denon AVR-X1700H hidden in a closet, Apple TV plus a bunch of consoles connected to the receiver, and a <a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry Pi 4</a> already doing <a href="https://homebridge.io/">Homebridge</a> duty. When it comes to CEC, the Apple TV handles it like a dream, but every console behaves like it missed the last week of CEC school. They wake the TV, switch the input, then leave the Denon asleep so I’m back to toggling audio outputs manually.</p><p><img src="https://debamitro.github.io/images/posts/hdmi-cec/media-closet.jpg" alt="My media closet where all the consoles are"/></p><blockquote><p>I documented the <a href="https://debamitro.github.io/posts/media-closet/">media closet build-out</a> separately, so if you want the full wiring tour (and the before/after photos), start there.</p></blockquote><p>With the media closet, rewiring everything to the TV wasn’t an option and disabling CEC wasn’t viable (Apple TV works and it gets the most use). My first instinct was to lean on traditional automation stacks: HomeKit scenes to chain “TV on” into “receiver on” or wattage triggers via an <a href="https://www.evehome.com/en/eve-energy">Eve Energy</a> plug. This kind of worked, but every extra layer added 30 seconds of lag or more. The last stop on that journey was a <a href="https://github.com/electroflame/homebridge-cec-tv-control"><code>homebridge-cec-tv-control</code> plugin</a>, but while reading the README I realized I was about to pipe CEC messages through Node, Homebridge, and HomeKit before they hit the receiver. The Pi is wired into the rack already, so skipping those layers and going through <code>/dev/cec0</code> directly was clearly the faster path.</p><p>After an evening of struggling, the Pi now sits quietly on the HDMI bus, watching for consoles to announce themselves and issuing the single command Samsung + Denon should have exchanged on their own.</p><p>This post follows the structure of my notes: build a small mental model of CEC, monitor the bus, copy whatever Apple TV does right, wrap it in Python, then ship it as a <a href="https://systemd.io">systemd</a> unit.</p><h2 id="small-hdmi-cec-primer">Small HDMI-CEC primer</h2><p><em><a href="https://en.wikipedia.org/wiki/HDMI">High-Definition Multimedia Interface</a> <a href="https://en.wikipedia.org/wiki/Consumer_Electronics_Control">Consumer Electronics Control</a></em>, much better known as <strong>HDMI-CEC</strong>, is a low-bandwidth side channel that rides alongside HDMI video/audio. Everyone on the bus speaks in <em>logical addresses</em> (<code>0x0</code> for TV, <code>0x5</code> for audio systems, <code>0x4/0x8/0xB</code> for playback devices, etc.) and tiny <em>opcodes</em> such as <code>0x82</code> (<strong>Active Source</strong>) or <code>0x72</code> (<strong>Set System Audio Mode</strong>). Physical addresses are “lat/long” references inside the topology, so <code>3.0.0.0</code> can mean “AVR input source HDMI 3”.</p><p>CEC is <em>supposed to</em> help consumers control their electronics, so in a healthy system the flow goes like this: console wakes and declares itself active, the TV notices there’s an ARC partner, somebody sends “please be the audio system”, the receiver wakes up, and audio comes out of the big speakers. For me, that path only occurred when Apple TV was involved. Sadly, when I woke a console, the TV switched inputs but audio stayed on the tinny TV speakers.</p><p>To debug that mess I first wrote down how every device identified itself on the bus. Here are the specific CEC roles in my home theater:</p><ul><li><strong>TV</strong> – logical address <code>0x0</code></li><li><strong>Audio system (Denon AVR-X1700H)</strong> – logical address <code>0x5</code></li><li><strong>Playback devices</strong> – logical addresses <code>0x4</code>, <code>0x8</code>, <code>0xB</code> (Apple TV, PS5, Switch 2 and Xbox all competing for the three playback slots)</li><li><strong>Broadcast</strong> – logical address <code>0xF</code> (messages to everyone)</li></ul><p>And the key opcodes we ended up caring about:</p><ul><li><code>0x82</code> – <strong>Active Source</strong> (“I am now the active input”)</li><li><code>0x84</code> – <strong>Report Physical Address</strong> (“this is where I live in the HDMI tree”)</li><li><code>0x70</code> – <strong>System Audio Mode Request</strong></li><li><code>0x72</code> – <strong>Set System Audio Mode</strong> (Denon’s “I am now the audio system” broadcast)</li></ul><h2 id="monitoring-the-cec-bus-with-cec-client">Monitoring the CEC bus with <code>cec-client</code></h2><p>The Raspberry Pi 4 I have exposes <code>/dev/cec0</code> interface on its micro-HDMI, and with a $7 micro-HDMI to HDMI cable plugged into HDMI input port on the receiver, it’s possible to monitor CEC traffic from <em>everything connected to the receiver</em>.</p><p><img src="https://debamitro.github.io/images/posts/hdmi-cec/raspberry-pi-hdmi.jpg" alt="Close-up photo of the Pi plugged into the TV’s ARC HDMI input, HDMI adapters visible"/></p><p>I was initially hesitant because of some <a href="https://www.philips-hue.com/en-us/support/product/sync-box/100010#How_do_I_know_if_I_have_a_sync_box_4K_or_8K">Hue Play Sync Box</a> trauma: every HDMI splitter or inline gadget I’ve tried in front of the TV caused weird <a href="https://en.wikipedia.org/wiki/Extended_Display_Identification_Data">EDID</a> breakage, troubles with HDR negotiation, or outright signal loss. But once I understood the Pi <em>never sits in the middle</em> of the HDMI handshake my concerns went away. By plugging it into an unused HDMI input on the AVR, it behaves like just another participant on the shared CEC bus. No signal regeneration, no spoofed EDIDs, nothing for the rest of the chain to notice.</p><p>So the topology looks like this:</p><p data-processed="true"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 1048.3359375 721.5999755859375" style="max-width: 1048.3359375px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1765800827150"><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" id="mermaid-1765800827150_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" id="mermaid-1765800827150_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" id="mermaid-1765800827150_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" id="mermaid-1765800827150_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" id="mermaid-1765800827150_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" id="mermaid-1765800827150_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g><g><g id="subGraph1"><rect height="137.1999969482422" width="206.703125" y="288.5999927520752" x="825.6328125" ry="0" rx="0" style=""></rect><g transform="translate(928.984375, 288.5999927520752)"><text style=""><tspan x="0" dy="1em" xml:space="preserve">Living Room</tspan></text></g></g><g id="subGraph0"><rect height="705.599983215332" width="579.1640625" y="0" x="0" ry="0" rx="0" style=""></rect><g transform="translate(289.58203125, 0)"><text style=""><tspan x="0" dy="1em" xml:space="preserve">Media Closet</tspan></text></g></g></g><g><path style="fill:none;" id="L-SW-AVR-0" d="M178.789,68.6L196.372,68.6C213.956,68.6,249.122,68.6,294.345,111.1C339.568,153.6,394.846,238.6,422.486,281.1L450.125,323.6"></path><path style="fill:none;" id="L-ATV-AVR-0" d="M174.043,185.8L192.417,185.8C210.792,185.8,247.54,185.8,291.064,208.767C334.587,231.733,384.885,277.667,410.035,300.633L435.184,323.6"></path><path style="fill:none;" id="L-PI-AVR-0" d="M174.488,303L192.788,303C211.089,303,247.689,303,283.572,308.078C319.456,313.155,354.622,323.311,372.206,328.388L389.789,333.466"></path><path style="fill:none;" id="L-PC-AVR-0" d="M137.41,411.4L161.89,411.4C186.37,411.4,235.329,411.4,277.393,406.322C319.456,401.245,354.622,391.089,372.206,386.012L389.789,380.934"></path><path style="fill:none;" id="L-XBOX-AVR-0" d="M174.043,519.8L192.417,519.8C210.792,519.8,247.54,519.8,290.732,498.3C333.924,476.8,383.558,433.8,408.375,412.3L433.192,390.8"></path><path style="fill:none;" id="L-PS5-AVR-0" d="M174.879,637L193.114,637C211.349,637,247.819,637,293.579,595.967C339.339,554.933,394.388,472.867,421.913,431.833L449.438,390.8"></path><path style="fill:none;" id="L-AVR-TV-0" d="M554.164,357.2L558.331,357.2C562.497,357.2,570.831,357.2,595.536,357.2C620.242,357.2,661.32,357.2,702.398,357.2C743.477,357.2,784.555,357.2,809.26,357.2C833.966,357.2,842.299,357.2,846.466,357.2L850.633,357.2"></path></g><g><g transform="translate(284.2890625, 68.5999984741211)"><g transform="translate(-27.1640625, -8.5)"><rect height="17.55039405822754" width="54.159420013427734" ry="0" rx="0"></rect><text style=""><tspan x="0" dy="1em" xml:space="preserve">HDMI 1</tspan></text></g></g><g transform="translate(284.2890625, 185.79999542236328)"><g transform="translate(-27.1640625, -8.5)"><rect height="17.55039405822754" width="54.159420013427734" ry="0" rx="0"></rect><text style=""><tspan x="0" dy="1em" xml:space="preserve">HDMI 2</tspan></text></g></g><g transform="translate(284.2890625, 302.99999237060547)"><g transform="translate(-80.5, -8.5)"><rect height="17.55039405822754" width="160.6501007080078" ry="0" rx="0"></rect><text style=""><tspan x="0" dy="1em" xml:space="preserve">micro HDMI to HDMI 3</tspan></text></g></g><g transform="translate(284.2890625, 411.3999900817871)"><g transform="translate(-27.1640625, -8.5)"><rect height="17.55039405822754" width="54.159420013427734" ry="0" rx="0"></rect><text style=""><tspan x="0" dy="1em" xml:space="preserve">HDMI 4</tspan></text></g></g><g transform="translate(284.2890625, 519.7999877929688)"><g transform="translate(-27.1640625, -8.5)"><rect height="17.55039405822754" width="54.159420013427734" ry="0" rx="0"></rect><text style=""><tspan x="0" dy="1em" xml:space="preserve">HDMI 5</tspan></text></g></g><g transform="translate(284.2890625, 636.9999847412109)"><g transform="translate(-27.1640625, -8.5)"><rect height="17.55039405822754" width="54.159420013427734" ry="0" rx="0"></rect><text style=""><tspan x="0" dy="1em" xml:space="preserve">HDMI 6</tspan></text></g></g><g transform="translate(702.3984375, 357.1999912261963)"><g transform="translate(-98.234375, -8.5)"><rect height="17.55039405822754" width="196.13937377929688" ry="0" rx="0"></rect><text style=""><tspan x="0" dy="1em" xml:space="preserve">HDMI Out to HDMI 3 (ARC)</tspan></text></g></g></g><g><g transform="translate(928.984375, 357.1999912261963)" data-id="TV" data-node="true" id="flowchart-TV-12"><rect height="67.19999694824219" width="156.703125" y="-33.599998474121094" x="-78.3515625" ry="0" rx="0" style=""></rect><g transform="translate(0, -26.099998474121094)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">Samsung</tspan><tspan font-weight="bold" font-style="normal"> S95B</tspan><tspan font-weight="bold" font-style="normal"> TV</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">TV</tspan><tspan font-weight="normal" font-style="normal"> @</tspan><tspan font-weight="normal" font-style="normal"> 0x0</tspan></tspan><tspan dy="1.1em" y="2.1em" x="0"><tspan font-weight="normal" font-style="normal">0.0.0.0</tspan></tspan></text></g></g></g><g transform="translate(471.9765625, 357.1999912261963)" data-id="AVR" data-node="true" id="flowchart-AVR-1"><rect height="67.19999694824219" width="164.375" y="-33.599998474121094" x="-82.1875" ry="0" rx="0" style=""></rect><g transform="translate(0, -26.099998474121094)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">Denon</tspan><tspan font-weight="bold" font-style="normal"> AVR-X1700H</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">Audio</tspan><tspan font-weight="normal" font-style="normal"> @</tspan><tspan font-weight="normal" font-style="normal"> 0x5</tspan></tspan><tspan dy="1.1em" y="2.1em" x="0"><tspan font-weight="normal" font-style="normal">3.0.0.0</tspan></tspan></text></g></g></g><g transform="translate(101.89453125, 68.5999984741211)" data-id="SW" data-node="true" id="flowchart-SW-0"><rect height="67.19999694824219" width="153.7890625" y="-33.599998474121094" x="-76.89453125" ry="0" rx="0" style=""></rect><g transform="translate(0, -26.099998474121094)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">Nintendo</tspan><tspan font-weight="bold" font-style="normal"> Switch</tspan><tspan font-weight="bold" font-style="normal"> 2</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">Playback</tspan><tspan font-weight="normal" font-style="normal"> 1</tspan><tspan font-weight="normal" font-style="normal"> @</tspan><tspan font-weight="normal" font-style="normal"> 0x8</tspan></tspan><tspan dy="1.1em" y="2.1em" x="0"><tspan font-weight="normal" font-style="normal">3.1.0.0</tspan></tspan></text></g></g></g><g transform="translate(101.89453125, 185.79999542236328)" data-id="ATV" data-node="true" id="flowchart-ATV-2"><rect height="67.19999694824219" width="144.296875" y="-33.599998474121094" x="-72.1484375" ry="0" rx="0" style=""></rect><g transform="translate(0, -26.099998474121094)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">Apple</tspan><tspan font-weight="bold" font-style="normal"> TV</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">Playback</tspan><tspan font-weight="normal" font-style="normal"> 2</tspan><tspan font-weight="normal" font-style="normal"> @</tspan><tspan font-weight="normal" font-style="normal"> 0x4</tspan></tspan><tspan dy="1.1em" y="2.1em" x="0"><tspan font-weight="normal" font-style="normal">3.2.0.0</tspan></tspan></text></g></g></g><g transform="translate(101.89453125, 302.99999237060547)" data-id="PI" data-node="true" id="flowchart-PI-4"><rect height="67.19999694824219" width="145.1875" y="-33.599998474121094" x="-72.59375" ry="0" rx="0" style=""></rect><g transform="translate(0, -26.099998474121094)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">Raspberry</tspan><tspan font-weight="bold" font-style="normal"> Pi</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">Recorder</tspan><tspan font-weight="normal" font-style="normal"> 1</tspan><tspan font-weight="normal" font-style="normal"> @</tspan><tspan font-weight="normal" font-style="normal"> 0x1</tspan></tspan><tspan dy="1.1em" y="2.1em" x="0"><tspan font-weight="normal" font-style="normal">3.3.0.0</tspan></tspan></text></g></g></g><g transform="translate(101.89453125, 411.3999900817871)" data-id="PC" data-node="true" id="flowchart-PC-6"><rect height="49.599998474121094" width="71.03125" y="-24.799999237060547" x="-35.515625" ry="0" rx="0" style=""></rect><g transform="translate(0, -17.299999237060547)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">PC</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">no</tspan><tspan font-weight="normal" font-style="normal"> CEC</tspan></tspan></text></g></g></g><g transform="translate(101.89453125, 519.7999877929688)" data-id="XBOX" data-node="true" id="flowchart-XBOX-8"><rect height="67.19999694824219" width="144.296875" y="-33.599998474121094" x="-72.1484375" ry="0" rx="0" style=""></rect><g transform="translate(0, -26.099998474121094)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">Xbox</tspan><tspan font-weight="bold" font-style="normal"> Series</tspan><tspan font-weight="bold" font-style="normal"> X</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">Playback</tspan><tspan font-weight="normal" font-style="normal"> 1</tspan><tspan font-weight="normal" font-style="normal"> @</tspan><tspan font-weight="normal" font-style="normal"> 0x8</tspan></tspan><tspan dy="1.1em" y="2.1em" x="0"><tspan font-weight="normal" font-style="normal">3.5.0.0</tspan></tspan></text></g></g></g><g transform="translate(101.89453125, 636.9999847412109)" data-id="PS5" data-node="true" id="flowchart-PS5-10"><rect height="67.19999694824219" width="145.96875" y="-33.599998474121094" x="-72.984375" ry="0" rx="0" style=""></rect><g transform="translate(0, -26.099998474121094)" style=""><rect></rect><g><rect></rect><text y="-10.1"><tspan dy="1.1em" y="-0.1em" x="0"><tspan font-weight="bold" font-style="normal">PS5</tspan></tspan><tspan dy="1.1em" y="1em" x="0"><tspan font-weight="normal" font-style="normal">Playback</tspan><tspan font-weight="normal" font-style="normal"> 3</tspan><tspan font-weight="normal" font-style="normal"> @</tspan><tspan font-weight="normal" font-style="normal"> 0xB</tspan></tspan><tspan dy="1.1em" y="2.1em" x="0"><tspan font-weight="normal" font-style="normal">3.6.0.0</tspan></tspan></text></g></g></g></g></g></g></svg></p><p>Now, you can get <code>cec-client</code> from <a href="https://github.com/Pulse-Eight/libcec"><code>libcec</code></a>. Install it with</p><div data-enhanced="true"><p><span>BASH</span></p><pre tabindex="0"><code data-lang="bash"><span><span>sudo apt update
</span></span><span><span>sudo apt install cec-utils
</span></span></code></pre></div><p>Then do a quick scan to see which devices respond:</p><div data-enhanced="true"><p><span>BASH</span></p><pre tabindex="0"><code data-lang="bash"><span><span><span>echo</span> <span>&#34;scan&#34;</span> <span>|</span> cec-client -s
</span></span></code></pre></div><p>Example scan output from my setup below. As you can see, the Xbox and Switch both claim logical address <code>0x8</code>:</p><div data-enhanced="true"><p><span>TEXT</span></p><pre tabindex="0"><code data-lang="text"><span><span>CEC bus information
</span></span><span><span>===================
</span></span><span><span>device #0: TV
</span></span><span><span>address:       0.0.0.0
</span></span><span><span>active source: no
</span></span><span><span>vendor:        Samsung
</span></span><span><span>osd string:    TV
</span></span><span><span>CEC version:   1.4
</span></span><span><span>power status:  on
</span></span><span><span>language:      eng
</span></span><span><span>
</span></span><span><span>
</span></span><span><span>device #1: Recorder 1
</span></span><span><span>address:       3.3.0.0
</span></span><span><span>active source: no
</span></span><span><span>vendor:        Pulse Eight
</span></span><span><span>osd string:    CECTester
</span></span><span><span>CEC version:   1.4
</span></span><span><span>power status:  on
</span></span><span><span>language:      eng
</span></span><span><span>
</span></span><span><span>
</span></span><span><span>device #4: Playback 1
</span></span><span><span>address:       3.1.0.0
</span></span><span><span>active source: yes
</span></span><span><span>vendor:        Unknown
</span></span><span><span>osd string:    Switch 2
</span></span><span><span>CEC version:   1.3a
</span></span><span><span>power status:  on
</span></span><span><span>language:      ???
</span></span><span><span>
</span></span><span><span>
</span></span><span><span>device #5: Audio
</span></span><span><span>address:       3.0.0.0
</span></span><span><span>active source: no
</span></span><span><span>vendor:        Denon
</span></span><span><span>osd string:    AVR-X1700H
</span></span><span><span>CEC version:   1.4
</span></span><span><span>power status:  on
</span></span><span><span>language:      ???
</span></span><span><span>
</span></span><span><span>
</span></span><span><span>device #8: Playback 2
</span></span><span><span>address:       3.2.0.0
</span></span><span><span>active source: no
</span></span><span><span>vendor:        Apple
</span></span><span><span>osd string:    Apple TV
</span></span><span><span>CEC version:   2.0
</span></span><span><span>power status:  standby
</span></span><span><span>language:      ???
</span></span><span><span>
</span></span><span><span>
</span></span><span><span>device #B: Playback 3
</span></span><span><span>address:       3.6.0.0
</span></span><span><span>active source: no
</span></span><span><span>vendor:        Sony
</span></span><span><span>osd string:    PlayStation 5
</span></span><span><span>CEC version:   1.3a
</span></span><span><span>power status:  standby
</span></span><span><span>language:      ???
</span></span></code></pre></div><p>If the expected devices show up, use monitor mode with the correct level of logging:</p><p>This command keeps the Pi quiet (monitor mode) yet gives you every bus transaction.</p><p>A line such as <code>TRAFFIC: [...] &gt;&gt; bf:82:36:00</code> means: logical <code>0xB</code> (PS5) broadcast Active Source (<code>0x82</code>) with physical address <code>3.6.0.0</code>. That’s the packet you expect any console to send when it wakes up.</p><h2 id="figuring-out-the-magic-handshake">Figuring out the magic handshake</h2><p>So I put the system in standby, start logging, then wake Apple TV. I got the expected <code>Active Source</code> burst, followed immediately by the Denon broadcasting that it has taken over audio:</p><div data-enhanced="true"><p><span>TEXT</span></p><pre tabindex="0"><code data-lang="text"><span><span>&gt;&gt; 8f:82:32:00       # Apple TV (logical 8) -&gt; Broadcast: Active Source
</span></span><span><span>...
</span></span><span><span>&gt;&gt; 8f:a6:06:10:56:10 # Apple TV (logical 8) -&gt; Broadcast: ???
</span></span><span><span>&gt;&gt; 5f:72:01          # Denon (logical 5) -&gt; Broadcast: Set System Audio Mode (on)
</span></span></code></pre></div><p>Translated:</p><ol><li>Apple TV announces itself as the active source.</li><li>Apple TV broadcasts some magic bits?</li><li>Very soon after, the Denon tells everyone “System Audio Mode is on,” and the TV happily keeps output set to <strong>Receiver</strong> instead of flipping back to TV speakers.</li></ol><p>I did the exact same experiment with PS5, Xbox, Switch 2 and the result was different:</p><div data-enhanced="true"><p><span>TEXT</span></p><pre tabindex="0"><code data-lang="text"><span><span>&gt;&gt; bf:82:36:00       # PS5: Active Source
</span></span><span><span># ...a bunch of reports, but no 5f:72:01
</span></span></code></pre></div><p>So what was the <code>8f:a6:06:10:56:10</code> frame when Apple TV was involved? With debug logs, <code>cec-client</code> showed <code>UNKNOWN (A6)</code>. I suspect <code>libCEC</code> labels it unknown because it’s in the vendor-specific range. The following bytes (<code>06:10:56:10</code>) could be Apple’s proprietary payload, like some capability or extended control. It’s possible Samsung and Apple have a private handshake here that ultimately results in the Denon doing the right thing. It’s neat, but I couldn’t rely on it since it’s undocumented and sending it manually from the Raspberry Pi’s logical address had no effect. Impersonating Apple TV over CEC is not realistically viable and likely brittle.</p><p>However, with <a href="https://www.cec-o-matic.com">cec-o-matic.com</a>, it was easy to craft a CEC frame for the Raspberry Pi to send a normal system audio mode request:</p><div data-enhanced="true"><p><span>TEXT</span></p><pre tabindex="0"><code data-lang="text"><span><span>15:70:00:00 # TV (1) -&gt; Audio (5): System Audio Mode Request
</span></span></code></pre></div><p>Breaking it down:</p><ul><li><code>15</code> = source <code>0x1</code> (Recorder 1 = Pi) sends to destination <code>0x5</code> (Audio System = Denon)</li><li><code>70</code> = opcode <strong>System Audio Mode Request</strong></li><li><code>00:00</code> = operands (TV’s physical address 0.0.0.0, plus “system audio status” = off/0, which Denon interprets as “please negotiate system audio mode and turn on ARC”)</li></ul><p>The second I typed this into <code>cec-client</code>’s interactive shell with <code>tx 15:70:00:00</code>, the Denon turned on and ARC anchored to the receiver even with only a console and TV powered on. I confirmed by checking the TV’s audio output:</p><p><img src="https://debamitro.github.io/images/posts/hdmi-cec/output.jpg" alt="Photo of TV UI confirming receiver output"/></p><p>So the solution started to emerge: whenever a console wakes up and claims Active Source, the Pi should step in and send <code>15:70:00:00</code> to the Denon to kickstart audio negotiation.</p><h2 id="dont-spam-the-bus">Don’t spam the bus!</h2><p>Now that we know the basis of the automation, the most obvious thing to do is to write a bash script that loops <code>cec-client</code> every few seconds and blast <code>on 5</code>. That sort of works, but it’s not ideal:</p><ul><li>Using a loop means the automation is delayed instead of reacting to actual CEC events.</li><li>Every iteration spins up a new <code>cec-client</code>, binds to <code>/dev/cec0</code>, sends one command, and tears down.</li><li>CEC is a shared bus, not a write-only GPIO.</li></ul><p>A better pattern is:</p><ol><li>Start a <strong>single</strong> long-lived <code>cec-client</code> process.</li><li>Let it print every <code>TRAFFIC</code> line for you to parse.</li><li>Feed it <code>tx ...</code> commands on stdin only when you need to intervene.</li></ol><p>The only catch: monitor mode (<code>-m</code>) can’t transmit. So for the automation we switch to:</p><p>No <code>-m</code> here. <code>cec-client</code> still prints all the traffic, but now it also accepts commands. Our Python script treats it like a bridge between HDMI land and our own logic: <code>stdout</code> is an event stream, <code>stdin</code> is a control channel.</p><h2 id="the-python-script">The Python script</h2><p>It took some trial and error, but it wasn’t too difficult to write a small Python program that watches for consoles waking up and sends the magic <code>15:70:00:00</code> command when needed. I put it all on GitHub:</p><p>The script logic goes:</p><ul><li>Starts <code>cec-client -d 8</code> as a subprocess.</li><li>Parses <code>TRAFFIC</code> lines.</li><li>Watches for <strong>Active Source (<code>0x82</code>)</strong> from any <strong>Playback</strong> logical address (<code>0x4/0x8/0xB</code>).</li><li>Tracks when the Denon last broadcast <strong>Set System Audio Mode (<code>5f:72:01</code>)</strong> so we don’t fight Apple TV or the TV’s own logic.</li><li>Sends <code>tx 15:70:00:00</code> at most once per console wake if nobody else has done it.</li></ul><p>A few notes:</p><ul><li>The script <strong>doesn’t hard-code</strong> any device names, vendors, or physical addresses.</li><li>It treats <strong>any Playback logical address</strong> (<code>0x4/0x8/0xB</code>) turning into Active Source as a “console wake” event.</li><li>It stays <strong>passive</strong> when Apple TV / Samsung / Denon manage to do the right thing themselves (because we observe a real <code>5f:72:01</code>).</li><li>It runs as a single long-lived process tied to a single <code>cec-client</code> instance.</li></ul><p>To make sure it starts on boot and keeps running, I wrapped it in a simple <code>systemd</code> service. The unit file I used <a href="https://github.com/jlian/cec_auto_audio?tab=readme-ov-file#running-as-a-systemd-service">can be found in the GitHub README</a>. I’ve been running it for a few days and feels rock solid.</p><h2 id="generalizing-this-approach">Generalizing this approach</h2><p>I hope this post gives you enough of a mental model to adapt this approach to your own CEC pain points. My solution is specific to the Denon + Samsung + consoles scenario, but the same pattern should work for other CEC quirks.</p><p>Maybe your issue isn’t consoles not engaging the AVR. Maybe DTS never negotiates, or your TV keeps snapping back to its tiny speakers. The workflow is the same:</p><ol><li><p><strong>Get the Pi onto the an HDMI port</strong>. Plug the Pi into the TV or Receiver’s HDMI input using a <a href="https://www.amazon.com/dp/B06WWQ7KLV">micro-HDMI–&gt;HDMI cable</a> (or adapter). Put it somewhere it can sit forever.</p></li><li><p><strong>Baseline the bus</strong>. Run:</p><div data-enhanced="true"><p><span>BASH</span></p><pre tabindex="0"><code data-lang="bash"><span><span><span>echo</span> <span>&#34;scan&#34;</span> <span>|</span> cec-client -s -d <span>1</span>
</span></span></code></pre></div><p>to make sure your Pi can see all the expected devices, what logical/physical addresses they have, and what roles they use.</p></li><li><p><strong>Record a “good” scenario and a “bad” one</strong>. Use:</p><p>to log traffic while you:</p><ul><li>Trigger a <strong>good</strong> path (e.g., Apple TV gets 5.1 sound correctly).</li><li>Trigger a <strong>bad</strong> path (e.g., DTS falls back to stereo, or ARC drops to TV speakers).</li></ul></li><li><p><strong>Diff the traces</strong>. Look for opcodes that show up in the good trace but are missing in the bad. In my case, the interesting delta was the presence of <code>5f:72:01</code> after Apple TV woke, and the absence of anything like it when a console woke alone.</p></li><li><p><strong>Inject the missing opcode manually</strong>. Go to <a href="https://www.cec-o-matic.com">cec-o-matic.com</a> to build the missing frame, then run:</p><p>to use <code>cec-client</code> in interactive mode, then type <code>tx ...</code> for your suspected magic packet, and see if anything changes. If not, try again with a different frame.</p><p>You likely would want to start with a frame like <code>1f:...</code> (Pi logical address as Recording 1 <code>0x1</code> to Broadcast <code>0xF</code>), or <code>15...</code> (Pi to Audio System <code>0x5</code>), depending on what you’re trying to achieve.</p></li><li><p><strong>Wrap it in code</strong>. Once you know the magic packet, wrap it in a tiny program like the one above and let the Pi quietly participate on the bus.</p></li></ol><p>You can picture the good vs bad paths like this:</p><p data-processed="true"><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-50 -10 819 548" style="max-width: 819px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1765800827276"><rect height="158" width="615.5" fill="rgb(255,230,230)" y="284" x="59.5"></rect><rect height="199" width="615.5" fill="rgb(230,255,230)" y="75" x="59.5"></rect><g><rect ry="3" rx="3" name="AVR" height="65" width="158" stroke="#666" fill="#eaeaea" y="462" x="561"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" alignment-baseline="central" dominant-baseline="central" y="494.5" x="640"><tspan dy="0" x="640">AVR / Soundbar (5)</tspan></text></g><g><rect ry="3" rx="3" name="TV" height="65" width="150" stroke="#666" fill="#eaeaea" y="462" x="239"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" alignment-baseline="central" dominant-baseline="central" y="494.5" x="314"><tspan dy="0" x="314">TV (0)</tspan></text></g><g><rect ry="3" rx="3" name="Src" height="65" width="189" stroke="#666" fill="#eaeaea" y="462" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" alignment-baseline="central" dominant-baseline="central" y="494.5" x="94.5"><tspan dy="0" x="94.5">Source (console/player)</tspan></text></g><g><line stroke="#999" stroke-width="0.5px" y2="462" x2="640" y1="5" x1="640" id="actor2"></line><g id="root-2"><rect ry="3" rx="3" name="AVR" height="65" width="158" stroke="#666" fill="#eaeaea" y="0" x="561"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" alignment-baseline="central" dominant-baseline="central" y="32.5" x="640"><tspan dy="0" x="640">AVR / Soundbar (5)</tspan></text></g></g><g><line stroke="#999" stroke-width="0.5px" y2="462" x2="314" y1="5" x1="314" id="actor1"></line><g id="root-1"><rect ry="3" rx="3" name="TV" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="239"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" alignment-baseline="central" dominant-baseline="central" y="32.5" x="314"><tspan dy="0" x="314">TV (0)</tspan></text></g></g><g><line stroke="#999" stroke-width="0.5px" y2="462" x2="94.5" y1="5" x1="94.5" id="actor0"></line><g id="root-0"><rect ry="3" rx="3" name="Src" height="65" width="189" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" alignment-baseline="central" dominant-baseline="central" y="32.5" x="94.5"><tspan dy="0" x="94.5">Source (console/player)</tspan></text></g></g><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="arrowhead"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><rect ry="0" rx="0" height="37" width="595.5" stroke="#666" fill="#EDF2AE" y="95" x="69.5"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="100" x="367"><tspan x="367">Good path</tspan></text></g><g><rect ry="0" rx="0" height="37" width="595.5" stroke="#666" fill="#EDF2AE" y="304" x="69.5"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="309" x="367"><tspan x="367">Bad path</tspan></text></g><g><rect ry="0" rx="0" height="37" width="376" stroke="#666" fill="#EDF2AE" y="395" x="289"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="400" x="477"><tspan x="477">No audio-mode negotiation</tspan></text></g><text style="font-size: 16px; font-weight: 400;" dy="1em" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="147" x="203">Active Source (0x82)</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" y2="176" x2="310" y1="176" x1="95.5"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="191" x="476">System Audio Mode Request (0x70)</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" y2="220" x2="636" y1="220" x1="315"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="235" x="479">Set System Audio Mode On (0x72)</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" y2="264" x2="318" y1="264" x1="639"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="356" x="203">Active Source (0x82)</text><line style="fill: none;" marker-end="url(#arrowhead)" stroke="none" stroke-width="2" y2="385" x2="310" y1="385" x1="95.5"></line></svg></p><p>Your job is to spot the missing step and teach the Pi to do it.</p><h2 id="where-this-leaves-my-setup">Where this leaves my setup</h2><p>Apple TV keeps doing its thing. PS5, Xbox, or Switch now wake the TV, the Pi nudges the Denon within half a second, and audio stays glued to the receiver. Latency is low enough that it feels native. The Pi sits in the closet pretending to be a slightly overqualified remote.</p><p><img src="https://debamitro.github.io/images/posts/hdmi-cec/tv-and-cat.jpg" alt="Picture of my TV and cat being comfortable"/></p><p>There are still a couple of rough edges I haven’t tackled yet:</p><ul><li><p><strong>When a console goes to sleep, the TV sometimes “helpfully” switches to its antenna input.</strong> I don’t even have an antenna plugged in, so the net effect is a confusing “no signal” screen instead of falling back to Apple TV or a known-good input. That’s technically “correct” from the TV’s point of view (its own tuner is always a valid source), but wrong for how this setup is actually used.</p></li><li><p><strong>My sunset TV automation can land on a dead input.</strong> I have a HomeKit automation that turns the TV on around sunset. Most of the time that means Apple TV wakes up with a nice aerial screensaver. But if the last input before power-off was a console, the TV wakes to that HDMI port and just shows “no signal”, which confuses other people in the house.</p></li></ul><p>These problems are similar, but require slightly different solutions:</p><ol><li><strong>Console standby → TV becomes Active Source.</strong> When a console goes to sleep it tends to release the bus and the TV politely promotes its tuner. The helper could watch for that very specific frame pair (console Standby, TV Active Source) and, after a short grace period, switch the input to Apple TV.</li><li><strong>Sunset automation → no Active Source.</strong> In this case the TV powers on but nobody (not even the TV) claims Active Source, so it sits on the last HDMI port showing “no signal.” The helper needs to detect “TV on, Denon asleep, no Active Source within N ms,” then wake both Apple TV and the receiver and switch inputs.</li></ol><p>Or maybe we could unify both by having a state machine that tracks “who was Active Source most recently” and automatically falls back to Apple TV whenever the bus goes quiet <em>or</em> the TV promotes itself. Either way, the Pi’s job is to make sure there’s always a sane outcome.</p><p>That would turn the Pi into a more general “HDMI shepherd”: not just keeping ARC pinned to the receiver when something is playing, but also steering the system back to a sane default when nothing is.</p><p>There’s probably a small cottage industry of “two-page CEC scripts” waiting to be written. If you adapt this trick for some other HDMI-CEC horror story, <a href="https://debamitro.github.io/about/#contact">send me the packet traces</a>—I’m collecting folklore.</p></section></article></div>
  </body>
</html>
