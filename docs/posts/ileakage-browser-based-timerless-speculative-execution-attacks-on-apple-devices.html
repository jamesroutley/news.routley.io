<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ileakage.com/">Original</a>
    <h1>iLeakage: Browser-Based Timerless Speculative Execution Attacks on Apple Devices</h1>
    
    <div id="readability-page-1" class="page"><div>
			<section id="abstract">
				<h4><i></i>Overview of the <span>iLeakage Attack.</span></h4>
				<div>
					<p>
						<!-- After first sentence, emphasize how Spectre is still alive and kicking nearly 6 years after release -->
						We present iLeakage, a transient execution side channel targeting the <a href="https://www.apple.com/safari/">Safari web browser</a> present on Macs, iPads and
						iPhones. iLeakage shows that the <a href="https://spectreattack.com/">Spectre</a> attack is still
						relevant and exploitable, even after nearly 6 years of effort to mitigate it since its discovery.
						We show how an attacker can induce Safari to render an arbitrary webpage, subsequently
						recovering sensitive information present within it using speculative execution. In particular,
						we demonstrate how Safari allows a malicious webpage to recover secrets from popular high-value
						targets, such as Gmail inbox content. Finally, we demonstrate the recovery of passwords, in case
						these are autofilled by credential managers.
					</p>

					

					
				</div>
			</section>

			<section id="demos">
				<h4><i></i>Demo <span>Videos.</span></h4>
				<div>
					<div>
						<div>
							<h5>Recovering Instagram Credentials</h5>
							<p>
								We show a scenario where the target uses an autofilling credential manager
								(LastPass in this demo) to sign into Instagram with Safari on macOS.
							</p>
							<p>
								<iframe src="https://www.youtube-nocookie.com/embed/Z2RtpN77H8o" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope" allowfullscreen=""></iframe>
							</p>
						</div>
						<div>
							<h5>Recovering Gmail Inbox Content</h5>
							<p>
								Assuming the target is signed into Google on Safari for iOS, we recover the subject
								lines of the Gmail account&#39;s most recent messages on an iPad.
							</p>
							<p>
								<iframe src="https://www.youtube-nocookie.com/embed/2uH9slLKTjw" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope" allowfullscreen=""></iframe>
							</p>
						</div>
						<div>
							<h5>Recovering YouTube Watch History</h5>
							<p>
								We recover YouTube watch history from the Chrome browser for iOS, which is a shell on
								top of Safari&#39;s browsing engine due to Apple&#39;s App Store policy.
							</p>
							<p>
								<iframe src="https://www.youtube-nocookie.com/embed/sNdyrCtajP4" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope" allowfullscreen=""></iframe>
							</p>
						</div>
					</div>
				</div>
			</section>

			<section id="people">
				<h4><i></i>The People
					<span>Behind iLeakage.</span>
				</h4>
				
			</section>

			<section id="qa">
				<h4><i></i>Frequently Asked <span>Questions.</span></h4>

				<p>
					<h5>The Basics</h5>
				</p>
				<div id="impact-and-potential-concerns">
					<div>
						
						<div id="panelsStayOpen-collapseAffected" aria-labelledby="panelsStayOpen-headingAffected">
							<p>
								Yes (with a very high chance), if you have a device running macOS or iOS with Apple&#39;s
								A-series or M-series CPUs. This includes all recent iPhones and iPads, as well as
								Apple&#39;s laptops and desktops from 2020 and onwards.
							</p>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseImpact" aria-labelledby="panelsStayOpen-headingImpact">
							<p>
								Code running in one web browser tab should be isolated and not be able to infer anything
								about other tabs that a user has open. However, with iLeakage, malicious JavaScript and
								WebAssembly can read the content of a target webpage when a target visits and clicks on
								an attacker&#39;s webpage. This content includes personal information, passwords, or credit
								card information.
							</p>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseMitigation" aria-labelledby="panelsStayOpen-headingMitigation">
							<div>
								<p>
									At the time of public release, Apple has implemented a mitigation for iLeakage
									in Safari. However, this mitigation is not enabled by default, and enabling it
									is possible only on macOS. Furthermore, it is marked as unstable.
									We will keep this FAQ updated as Apple pushes more iOS and macOS updates.
									If you wish to enable the mitigation on your Mac now, below are the steps:
								</p>
								<p>
									<b>If you have updated to macOS Sonoma:</b>
								</p>
								<ol>
									<li>Open the Terminal app. You can find this in the Launchpad, or through Spotlight
										search.</li>
									<li>Copy and paste the following command (in magenta), and press the Return key to
										run it:
										</li>
								</ol>
								<p>
									<b>If you are on an earlier macOS version (macOS Ventura and earlier):</b>
								</p>
								<ol>
									<li>We recommend enabling automatic updates and updating to macOS Sonoma. However,
										if you wish to enable the mitigation on older macOS versions, follow these
										steps:</li>
									<li>First, download the version of Safari Technology Preview tht matches your macOS
										version from Apple&#39;s <a href="https://developer.apple.com/safari/resources/">download page.</a></li>
									<li>Double-click the downloaded installer with the <code>.pkg</code> file extension,
										and follow its directions until Safari Technology Preview is installed.</li>
									<li>Open the Terminal app. You can find this in the Launchpad, or through Spotlight
										search.</li>
									<li>Copy and paste the following command (in magenta), and press the Return key to
										run it:
										</li>
								</ol>
								<p>
									<b>This enables Safari&#39;s hidden debugging menu. Then, follow these steps:</b>
								</p>
								<ol>
									<li>Open Safari (or Safari Technology Preview). On the menu bar, you should see a
										new entry named <b>Debug</b>. </li>
									<li>Click the Debug menu. This opens a long dropdown. Click on <b>WebKit Internal
											Features</b>. </li>
									<li>This opens another long dropdown to the side. Scroll down to the bottom of this
										new dropdown, where you&#39;ll find an entry called <b>Swap Processes on Cross-Site
											Window Open</b>. </li>
									<li>Click this entry. A checkmark should appear to the left of it, like the
										screenshot below. </li>
								</ol>
								<p>
									Afterwards, you&#39;re all set! To disable the mitigation, repeat steps 1-4 from above,
									and the checkmark will disappear.
									To disable the hidden debugging menu, open the Terminal app, copy and paste the
									following command (depending on your OS version), and press the Return key to run.
									The changes will apply the next time you start Safari (or Safari Technology
									Preview).
								</p>
								<ul>
									<li>For Safari (macOS Sonoma):
										</li>
									<li>For Safari Technology Preview (macOS Ventura and earlier):
										</li>
								</ul>
							</div>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseDetect" aria-labelledby="panelsStayOpen-headingDetect">
							<p>
								iLeakage is highly unlikely to be detected, since the attack runs in Safari and does not
								leave traces in the system&#39;s log files. However, traces of an attacker webpage hosting
								iLeakage may be present in the browser&#39;s cache of pages it has recently visited.
							</p>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseAbuse" aria-labelledby="panelsStayOpen-headingAbuse">
							<p>
								So far, we do not have evidence that iLeakage has been or not been abused. However, we
								note that iLeakage is a significantly difficult attack to orchestrate end-to-end, and
								requires advanced knowledge of browser-based side-channel attacks and Safari&#39;s
								implementation.
							</p>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseStopPassword" aria-labelledby="panelsStayOpen-headingStopPassword">
							<p>
								Not for the most part. In fact, we encourage using credential managers as opposed to
								trying to remember all of your passwords. In general, this is a better approach
								than reusing passwords or storing them insecurely. While iLeakage can recover
								credentials that are autofilled into a webpage, we note that many platforms require user
								interaction for autofill to occur.
							</p>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseNotify" aria-labelledby="panelsStayOpen-headingNotify">
							<p>
								We disclosed our results to Apple on September 12, 2022 (408 days before public release).
							</p>
						</div>
					</div>
				</div>

				<p>
					<h5>For Tech-Savvy Readers</h5>
				</p>
				<div id="technical-details">
					<div>
						
						<div id="panelsStayOpen-collapseJS" aria-labelledby="panelsStayOpen-headingJS">
							<p>
								JavaScript and WebAssembly are two programming languages that make up the backbone of
								interactive webpages, such as online games and video streaming services. JavaScript can
								update the content of the website directly, while WebAssembly is used for
								high-performance web applications. Ultimately, WebAssembly interfaces with JavaScript to
								deliver dynamic content to users. Since both are sandboxed in a browser environment,
								side-channel attacks are notably more difficult to implement in these languages.
								However, the impact is drastically greater, as browsers execute both types of code
								automatically and do not require the user to download the malicious program.
							</p>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseSidechannel" aria-labelledby="panelsStayOpen-headingSidechannel">
							<div>
								<p>
									Most computer bugs arise from mistakes in programming, such as missing bounds checks
									or use-after-frees. However, a side-channel attack exploits the implementation of a
									computer system to attack it, even if the program it runs is a secure algorithm.
									Systems can leak sensitive data through sound, electromagnetic radiation, or thermal
									throttling, just for a few examples.
								</p>
								<p>
									Many side channels, including ones we use for iLeakage, comes from the CPU&#39;s
									microarchitecture.
									Whenever an attacker and target run on the same CPU, they share the CPU&#39;s internal
									resources such as cores, caches, and internal buffers.
									Sharing resources leads to contention, and contention can be measured indirectly
									through several variables like timing or power consumption.
									These measurements leave fingerprints on the target&#39;s behavior on the CPU.
									Accordingly, an attacker can abuse this to make inferences about the target&#39;s
									secrets even if they are isolated at the process level or the hypervisor level.
								</p>
							</div>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseSpectre" aria-labelledby="panelsStayOpen-headingSpectre">
							<div>
								<p>
									Virtually all modern CPUs use a performance optimization where they predict if a
									branch instruction will be taken or not, should the outcome not be readily
									available. Once a prediction is made, the CPU will execute instructions along the
									prediction, a process called speculative execution. If the CPU realizes it had
									mispredicted, it must revert all changes in the state it performed after the
									prediction. Both desktop and mobile CPUs exhibit this behavior, regardless of
									manufacturer (such as Apple, AMD, or Intel).
								</p>
								<p>
									<a href="https://spectreattack.com/">Spectre</a> is a hardware vulnerability in
									virtually all modern CPUs that occurs when speculative execution backfires. While
									the CPU should ideally revert all changes in state, speculative execution leaves
									traces in the CPU&#39;s microarchitectural state and especially the cache. A Spectre
									attack coerces the CPU into speculatively executing the wrong flow of instructions.
									If this wrong flow has instructions depending on sensitive data, their value can be
									inferred through a side channel even after the CPU realizes the mistake and reverts
									its changes. An adversary can abuse this behavior to read data that they cannot
									normally access through program semantics. Because speculative execution is an
									important part of CPU performance that is infeasible to simply remove as a
									countermeasure, Spectre continues to be dangerous to software even years after its
									discovery.
								</p>
							</div>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseDifference" aria-labelledby="panelsStayOpen-headingDifference">
							<div>
								<p>
									Since the original <a href="https://spectreattack.com/">Spectre</a> exploit, browser
									vendors had significantly hardened browsers against attacks based on speculative and
									transient execution. For the case of Safari, this includes 35-bit addressing and the
									value poisoning, one process per tab isolation policy, as well as a low resolution
									timer.
								</p>
								<p>
									Nonetheless, iLeakage is the first demonstration of a speculative execution attack
									against <a href="https://en.wikipedia.org/wiki/Apple_silicon">Apple Silicon</a> CPUs
									and the Safari browser.
									In particular, we show that speculative execution attacks are possible on Apple&#39;s
									latest A-series and M-series architectures, despite Apple&#39;s side channel hardening.
									More specifically, we first devise an empirical method to recover the cache
									organization of Apple CPUs, since it is not publicly documented. We then use this
									information to develop a gadget that can distinguish cache hits from misses even in
									the absence of a cycle-accurate timer, which is the case for both native and browser
									environments for Apple devices. We use this gadget as both a test to generate cache
									eviction sets and as a covert channel. Finally, we migrate these techniques to the
									Safari browser, where we make Safari run code designed for one datatype on our
									maliciously crafted object of the wrong type while the CPU is performing speculative
									execution. Ultimately, we achieve a out-of-bounds read anywhere in the address space
									of Safari&#39;s rendering process.
								</p>
							</div>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseWorks" aria-labelledby="panelsStayOpen-headingWorks">
							<p>
									In order to construct iLeakage, we first reverse engineer the cache topology on <a href="https://en.wikipedia.org/wiki/Apple_silicon">Apple Silicon</a> CPUs.
									We then overcome Apple&#39;s timer limitations using a new speculation-based gadget, which allows us
									to distinguish individual cache hits from cache misses, despite having access to only low
									resolution timers. We also demonstrate a variant of this gadget that uses no timers, leveraging
									race conditions instead.
									After using our speculation-based gadget to construct eviction sets, we
									proceded to analyze Safari&#39;s side channel resilience. Here, we bypass Safari&#39;s 35-bit addressing
									and the value poisoning countermeasures, creating a primitive that can speculatively read and
									leak any 64-bit pointer within Safari&#39;s rendering process. Combining this with a new method for
									consolidating websites from different domains into the same address space, we are able to mount
									a speculative type confusion attack that leaks sensitive information.
								</p>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapsePaper" aria-labelledby="panelsStayOpen-headingPaper">
							<p>
									The download button at the top of this website links to an academic paper, also
									available through this <a href="https://pjg1.site/files/ileakage.pdf">link.</a>
									Our paper will appear at the 2023 ACM Conference on Computer and Communications
									Security (CCS).
								</p>
						</div>
					</div>
				</div>

				<p>
					<h5>Miscellaneous</h5>
				</p>
				<div id="miscellaneous">
					<div>
						
						<div id="panelsStayOpen-collapseOther" aria-labelledby="panelsStayOpen-headingOther">
							<div>
								<p>
									On macOS, other popular browsers such as Chrome, Firefox and Microsoft Edge use
									different JavaScript engines. Since iLeakage exploits idiosyncrasies in Safari&#39;s
									JavaScript engine, these nuances suffice to deter iLeakage from working on them.
								</p>
								<p>
									However, iOS has a different situation. Due to Apple&#39;s App Store and sandboxing
									policies, other browser apps are forced to use Safari&#39;s JavaScript engine. That is,
									Chrome, Firefox and Edge on iOS are simply wrappers on top of Safari that provide
									auxiliary features such as synchronizing bookmarks and settings. Consequently,
									nearly every browser application listed on the App Store is vulnerable to iLeakage.
								</p>
							</div>
						</div>
					</div>
					<div>
						
						<div id="panelsStayOpen-collapseLogo" aria-labelledby="panelsStayOpen-headingLogo">
							<p>
									Yes, we have <a href="https://pjg1.site/img/ileakage.svg">SVG</a> and <a href="https://pjg1.site/img/ileakage.png">PNG</a> versions of the iLeakage logo. While the logo
									contains a modified version of the Safari logo, we note the Safari logo is in the
									public domain at <a href="https://commons.wikimedia.org/wiki/File:Safari_browser_logo.svg">Wikimedia
										Commons</a>. Furthermore, it is not on Apple&#39;s list of <a href="https://www.apple.com/legal/intellectual-property/trademark/appletmlist.html">trademarks.</a>
								</p>
						</div>
					</div>
				</div>

			</section>
			<section id="acknowledgments">
				<h4><i></i>Acknowledgments</h4>
				<p>
						This research was supported by
						the Air Force Office of Scientific Research (AFOSR) under award number FA9550-20-1-0425;
						an ARC Discovery Project number DP210102670;
						the Defense Advanced Research Projects Agency (DARPA) under contract HR00112390029 and
						W912CG-23-C-0022;
						the Deutsche Forschungsgemeinschaft (DFG, German Research Foundation) under Germany&#39;s Excellence
						Strategy - EXC 2092 CASA - 390781972;
						the National Science Foundation under grant CNS-1954712;
						and gifts by Cisco and Qualcomm.
						</p>
			</section>
		</div></div>
  </body>
</html>
