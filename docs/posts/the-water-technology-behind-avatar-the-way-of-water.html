<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.unity.com/industry/technology-behind-avatar-the-way-of-water">Original</a>
    <h1>The water technology behind Avatar: The Way of Water</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><p>Wētā Digital – now part of Unity – developed many of the tools and solutions used to bring the world of <em>Avatar: The Way of Water</em> to life. Here, we take a look at the CGI technology behind the water. If you’re interested in being among the first to access some of the tools used in the film, you can register for the Unity Wētā Tools beta <a href="https://create.unity.com/weta-digital-beta-program-sign-up" target="_blank">through our website</a>.</p></div></div><div><div><div><figure><div><p><img alt="" aria-hidden="true" role="presentation" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAyMCIgaGVpZ2h0PSI1NzMuNzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></p><p><img alt="Director James Cameron on set of 20th Century Studios&#39; AVATAR 2. Photo by Mark Fellman. © 2021 20th Century Studios. All Rights Reserved." src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async"/></p></div><figcaption>Director James Cameron on set of 20th Century Studios&#39; AVATAR 2. Photo by Mark Fellman. © 2021 20th Century Studios. All Rights Reserved.</figcaption></figure></div></div></div><div><div><div><p>James Cameron is no stranger to working with water. <em>Titanic</em> aside, in 2012 he made a record-breaking solo dive, piloting a submarine to the bottom of the Mariana Trench in the Pacific Ocean: Earth’s lowest point at nearly 11 kilometers deep. As he said in the resulting 2014 documentary, <em>Deepsea Challenge</em>, “Down here you feel the power of nature’s imagination, which is so much greater than our own.”</p>

<p>It must have been truly remarkable, then, seeing as the world of Pandora and its stunning visuals ultimately came from Cameron’s own imagination.</p></div></div></div><div><div><div><figure><div><p><img alt="" aria-hidden="true" role="presentation" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDY4OCIgaGVpZ2h0PSIyNjM3IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="/></p><p><img alt="Jake Sully (Sam Worthington) in 20th Century Studios&#39; AVATAR: THE WAY OF WATER. Photo courtesy of 20th Century Studios. ©2022 20th Century Studios. All Rights Reserved." src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async"/></p></div><figcaption>Jake Sully (Sam Worthington) in 20th Century Studios&#39; AVATAR: THE WAY OF WATER. Photo courtesy of 20th Century Studios. ©2022 20th Century Studios. All Rights Reserved.</figcaption></figure></div></div></div><div><div><h2><p>Unity Wētā Tools: Water Taskforce</p></h2></div></div><div><div><div><p>Translating Cameron’s vision, which for the sequel included the new reef village of the aquatic Metkayina clan, required extensive use of visual effects – especially for the dominant water setting.</p>

<p>The <a href="https://blog.unity.com/entertainment/avatar-awards-season-splash" target="_blank">tools and solutions</a> used to create the film’s VFX – including the <a href="https://variety.com/2023/artisans/awards/visual-effects-awards-2023-winners-avatar-2-pinocchio-1235523262/" target="_blank">award-winning water effects</a> – were developed by Wētā Digital, now a division of Unity.</p>

<p>To ensure that the interactions between the characters and water elements were as realistic as possible, a team of experts, including Unity and Wētā’s water simulation VFX specialists Alexey Stomakhin, Steve Lesser, Joel Wretborn, and Sean Flynn, were brought together to form the “Water Taskforce”. This team’s water toolset was recently recognized with a win at the <a href="https://twitter.com/weta_digital/status/1626261833010012160" target="_blank">Visual Effects Society (VES) Awards</a>, with the Emerging Technology Award.</p>

<p>Extreme attention to detail saw the taskforce conduct extensive research and experimentation in collaboration with New Zealand’s National Institute of Water and Atmospheric Research (NIWA) to find the best approach to creating CGI water. This included taking into account the effects of tides, wind, and the sea floor on aquatic environments.</p></div></div></div><div><div><div><figure><div><p><img alt="" aria-hidden="true" role="presentation" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDY4OCIgaGVpZ2h0PSIyNjM3IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="/></p><p><img alt="Lo’ak (Britain Dalton) in 20th Century Studios&#39; AVATAR: THE WAY OF WATER. Photo courtesy of 20th Century Studios. © 2022 20th Century Studios. All Rights Reserved." src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async"/></p></div><figcaption>Lo’ak (Britain Dalton) in 20th Century Studios&#39; AVATAR: THE WAY OF WATER. Photo courtesy of 20th Century Studios. © 2022 20th Century Studios. All Rights Reserved.</figcaption></figure></div></div></div><div><div><div><p><em>Avatar: The Way of Water</em> required water effects for 2,225 shots, some taking up to eight days of simulation to achieve the high resolution needed.</p>

<p>There were also numerous scenes where water interacted with over 50 creatures in a single shot. This presented the challenge of needing simulations to be accurate at scale, from large domains for bigger creatures, to submillimeter resolution for thin film on skin.</p>

<p>As it was not computationally feasible to create a single-representation water system, the toolset was developed with a number of distinct solvers to keep compute times to a minimum.</p></div></div></div><div><div><div><blockquote>
<p>“The Loki water state machine was crucial for delivering the sheer volume of large-scale water shots in this movie. In a typical VFX-heavy movie, water shots of this complexity are few and far between and require many iterations and passes from very experienced artists. In contrast, our state machine approach was able to deliver great results after just a single pass, even by artists who had just entered the industry.” – Sean Flynn, simulation lead, Unity x Wētā Digital</p>
</blockquote>

<p>A majority of the water tools developed by the team sit within Wētā’s proprietary simulation framework, Loki. This piece of tech includes solvers for multiple water states, including procedural water waves, bulk water, spray, mist, hero bubbles, diffuse bubbles, foam, capillary surface waves, thin film, and residual wetness.</p>

<h4>State machine</h4>

<p>Many of these solvers sit within the Loki state machine – an airborne spray system. The water states are coupled with the surrounding air, with transitions between states handled in a mass- and momentum-conserving way.</p>

<p>Rather than a one-size-fits-all approach, the Loki state machine allows multiple solvers to run in tandem. Each solver is optimized for the level of detail required by its respective state, such as bulk water, spray, and mist. This helps keep large-scale water simulations efficient while still capturing the very fine droplet interactions required by spray and mist.</p>

<p>All of the states including the surrounding air are completed in a single simulation pass. As all solvers are computed with proper physical interactions between them, this is what helped to create such natural and realistic water interaction throughout the film.</p></div></div></div><div><div><div><div data-testid="wrapper"><div data-testid="overlay"><div><p>This content is hosted by a third party provider that does not allow video views without acceptance of Targeting Cookies. Please set your cookie preferences for Targeting Cookies to yes if you wish to view videos from these providers.</p></div></div></div><p>“Loki: A unified multiphysics simulation framework for production,” presented at SIGGRAPH 2022</p></div></div></div><div><div><h3><p>Thin film and drips simulation</p></h3></div></div><div><div><div><p>During SIGGRAPH 2019, a practical approach for modeling close-up water interaction with characters was presented, with a focus on high-fidelity surface tension and adhesion effects as water moves over and drips from skin. Using a scene from <em>Alita: Battle Angel</em> (a screenplay also written by Cameron), the team showed how this method allowed for a resolution of effects that was performant enough – on the scale of a fraction of a millimeter – to cover a whole character with a layer of water.</p>

<p>The approach was to adapt an existing particle-in-cell (FLIP/APIC) solver to capture small-scale water-solid interaction dynamics. This technique was then advanced during the production of <em>Avatar: The Way of Water</em> to handle any sequence that involved characters emerging from water.</p>

<blockquote>
<p>“This was not a cheap solution, as we had to simulate water dynamics at sub-millimeter scales. The results would often take days to compute. We had to ensure our solver was scalable, robust and reliable enough to produce physically plausible visuals out of the box, with minimal tuning required from artists.” – Alexey Stomakhin, principal research engineer, Unity x Wētā Digital</p>
</blockquote></div></div></div><div><div><div><figure><div><p><img alt="" aria-hidden="true" role="presentation" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYwMCIgaGVpZ2h0PSIxMDgwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIvPg=="/></p><p><img alt="Close-up render of high-fidelity surface tension and adhesion affects, taken from the SIGGRAPH 2019 session “A practical guide to thin film and drips simulation” " src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async"/></p></div><figcaption>Close-up render of high-fidelity surface tension and adhesion affects, taken from the SIGGRAPH 2019 session “A practical guide to thin film and drips simulation” </figcaption></figure></div></div></div><div><div><h3><p>Underwater bubbles and coupling</p></h3></div></div><div><div><div><p>To achieve believable dynamics in underwater scenarios – for example, when characters breathe underwater in <em>Avatar: The Way of Water </em>– the approach to underwater bubbles was to simulate them together with a narrow band of water around the region of interest. The bubbles themselves would be represented in two parts: a hero and diffuse counterpart.</p>

<p>The hero counterpart captures bigger bubbles with more explosive and turbulent behaviors. It utilizes an incompressible two-phase Navier-Stokes solve on a Eulerian grid, with the air phase represented by FLIP/APIC particles to facilitate volume conservation and accurate interface tracking.</p>

<p>The diffuse counterpart captures the motion of smaller bubbles below the resolution of  the Eulerian grid. The team has developed a novel scheme for coupling diffuse bubble particles with bulk fluid that could also be applied to other submerged, porous objects such as sand, hair, and cloth.</p></div></div></div><div><div><h3><p>Wave curves and surface simulation</p></h3></div></div><div><div><div><p>To enhance the visual detail of a water surface simulation, the team from Wētā Digital and IST Austria developed a method of post-processing that took a simulation as an input, and increased its apparent resolution by simulating detailed Lagrangian water waves on top of it.</p>

<p>Linear water wave theory was extended to work in non-planar domains with Lagrangian wave packets attached to spline curves that would evolve over the bulk fluid surface. This method produces high-frequency ripples with dispersive wave-live behaviors, customized to the underlying fluid simulation.</p></div></div></div><div><div><div><div data-testid="wrapper"><div data-testid="overlay"><div><p>This content is hosted by a third party provider that does not allow video views without acceptance of Targeting Cookies. Please set your cookie preferences for Targeting Cookies to yes if you wish to view videos from these providers.</p></div></div></div><p>“Wave Curves: Simulating Lagrangian water waves on dynamically deforming surfaces,” presented at SIGGRAPH 2020</p></div></div></div><div><div><h3><p>Bubbles and wet foam for realistic whitewater simulation</p></h3></div></div><div><div><div><p>A technique was developed for the realistic movement of underwater bubbles – created by movement in the water – reaching the water surface and converting into foam. This was important for nearly all of the water scenes in <em>Avatar: The Way of Water</em>.</p>

<p>Grid-based Navier-Stokes simulators – usually reserved for capturing large-scale motion such as bulk fluid – are inherently limited by their grid resolution, making this method  impractical for small-scale phenomena like spray and mist from breaking waves. These whitewater effects are usually simulated as independent Lagrangian particles.</p>

<blockquote>
<p>“One key aspect of our whitewater method is the interaction of two solvers: a grid-based fluid solver coupled with bubbles, and a SPH solver for foam constrained to the water surface. The declarative solver framework in Loki is what makes building and supporting these complex systems possible in production without having to develop new solvers from scratch.” – Joel Wretborn, senior research engineer, Unity x Wētā Digital</p>
</blockquote>

<p>The key aspect most of the existing solvers neglect are the collective effects: groups of bubbles rise faster than single bubbles due to their combined buoyancy, and the collection of many bubbles can have a significant impact on the motion of the water.</p>

<p>The new technique addresses this limitation by simulating bubbles two-way coupled with the surrounding fluid. This effectively captures collective bubble effects, and creates a more connected look between bubbles and the motion of the fluid. As bubbles reach the surface they transition into &#34;wet&#34; foam particles constrained to the water surface, discretized with smoothed particle hydrodynamics (SPH). In the end this created believable whitewater dynamics in both close-up and large ocean shots.</p></div></div></div><div><div><div><div data-testid="wrapper"><div data-testid="overlay"><div><p>This content is hosted by a third party provider that does not allow video views without acceptance of Targeting Cookies. Please set your cookie preferences for Targeting Cookies to yes if you wish to view videos from these providers.</p></div></div></div><p>Overview of “Guided bubbles and wet foam for realistic whitewater simulation” as presented at SIGGRAPH 2022. Video courtesy of Wētā FX.</p></div></div></div><div><div><p><em>The simulation technology used by the Water Taskforce was created by present and former colleagues at Wētā Digital, as well as friends from Wētā FX and academic institutions, including: Alexey Stomakhin, Joel Wretborn, Kevin Blom, Gilles Daviet, Steve Lesser, John Edholm, Noh-Hoon Lee, Eston Schweickart, Xiao Zhai, Sean Flynn, Andrew Moffat, Gary Boyle, Tomas Skrivan, Andreas Soderstron, John Johansson, Christoph Sprenger, Ken Museth, and Chris Wojtan. Learn more about <a href="https://create.unity.com/weta-digital-beta-program-sign-up" target="_blank">Unity Wētā Tools beta</a>.</em></p></div></div></div></div>
  </body>
</html>
