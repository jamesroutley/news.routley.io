<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://moral.net.au/writing/2025/01/11/waiting_for_oregon/">Original</a>
    <h1>Can you complete the Oregon Trail if you wait at a river for 14272 years?</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<div>

<p><i>11 January 2025</i></p>
<p><img alt="A screenshot from the main gameplay view of Oregon Trail, showing a covered wagon drawn by oxen near a river, and cheerfully informing you that Zeke has a broken leg and will die soon." src="https://moral.net.au/writing/2025/01/11/waiting_for_oregon/header.png" title="Goddamnit Zeke I turn my head for ONE SECOND"/></p><p>If you&#39;re into retro computing, you probably know about Oregon Trail; a simulation of the hardships faced by a group of colonists in 1848 as they travel by covered wagon from Independence Missouri to the Willamette Valley in Oregon. The game was wildly successful in the US education market, with the various editions selling 65 million copies. What you probably <em>don&#39;t</em> know is the game&#39;s great untold secret.</p>
<p>Two years ago, Twitch streamer <a href="https://www.twitch.tv/albrot">albrot</a> discovered a bug in the code for crossing rivers. One of the options is to &#34;wait to see if conditions improve&#34;; waiting a day will consume food but <em>not</em> recalculate any health conditions, granting your party immortality.</p>
<p>From this conceit the Oregon Trail Time Machine was born; a multiday livestream of the game as the party waits for conditions to improve at the final Snake River crossing until the year 10000, to see if the withered travellers can make it to the ruins of ancient Oregon. The <a href="https://www.twitch.tv/videos/1738411118?t=01h04m40s">first attempt ended in tragedy</a>; no matter what albrot tried, the party would succumb to disease and die almost immediately.</p>
<p>A couple of days before New Years Eve 2025, albrot reached out and asked if I knew anything about Apple II hacking. In reality the answer was no, I knew three things about the Apple II:</p>
<ul>
<li>It has a MOS 6502 processor</li>
<li>It was popular in the US educational market</li>
<li>Something something Carmen Sandiego something Prince of Persia?</li>
</ul>
<p>But all old computers are basically the same right? Specialist knowledge is for cowards.</p>
<div id="where-to-start">
<h2>Where to start</h2>
<p>First I loaded Oregon Trail into MAME&#39;s Apple II emulator. MAME is an emulator that was originally targeted at arcade hardware, however it has support for hundreds of game consoles and home computer systems thanks to merging with the MESS project. It has one of the nicest debuggers I&#39;ve ever used, with plenty of documentation, which is why I strongly recommend it for reversing work. You will need a copy of the Apple II ROMs, listed in the MAME ROM index as <tt>apple2e.zip</tt>.</p>
<p>We are using the most common disk image of the game (aka &#34;peperony and chease&#34; edition). To open the game:</p>
<div><pre><span></span>mame<span> </span>apple2e<span> </span>-debug<span> </span>-flop1<span> </span>oregonmod_a.do
</pre></div>
<p>This will open a separate Debug window and pause execution until you start running the machine (F5). In the game window you can activate the MAME menu keys by pressing Scroll Lock; useful ones to know are TAB for the main menu, F6 for saving a state, F7 for loading a state.</p>
<p>This was my thinking for how to get a first toehold into what was going on. As you travel, the game gives your party one of four health ratings:</p>
<ul>
<li>good</li>
<li>fair</li>
<li>poor</li>
<li>very poor</li>
</ul>
<p>It follows that the game code must read the text string &#34;poor&#34; from somewhere in memory so it can be printed on the screen, and this code would be attached to the routine that determines how sick everyone is. So I sent the party off from Independence, Missouri with 1 ox, no food and no clothes. As soon as we were on the road, I made a save state. I then called &#34;Step Into&#34; in the debugger (F11) which paused execution, and made a dump of the Apple II&#39;s memory to a file with the following command:</p>
<div><pre><span></span>save<span> </span>/tmp/mem_before,0,0x10000
</pre></div>
<p>I loaded this dump into a hex editor and searched for the word &#34;poor&#34;, which I found at address 0xA6AE. Then in the debugger I added a watchpoint for any code attempting to read the first byte of &#34;poor&#34;:</p>

<p>As expected, once my party became emaciated enough the debugger halted execution at the following instruction:</p>

<p>The Apple II CPU is a 6502, which has a nice <a href="http://6502.org/users/obelisk/6502/reference.html">instruction reference</a> here. Looking it up, we can see that LDA basically means &#34;load a byte from the address stored at 0x005E into register A&#34;. Because the 6502 is a very basic 8-bit CPU, you are limited in how you access the 16-bit address space. Generally speaking you have the choice of using a fixed offset (up to 16-bit, baked in the instruction) plus whatever 8-bit value is in a register, or using a Zero Page pointer. The above instruction is using a Zero Page address; for this mode you have to write a 16-bit pointer containing the location you want to somewhere in the first 0x100 bytes of memory, then use an instruction which references that pointer.</p>
<p>So we know that the pointer to the text describing the player&#39;s health is at 0x005E, which we can confirm by opening a memory window in the debugger and see AE A6 at address 0x005E (the 6502 is little endian, so addresses are stored backwards). It&#39;s fair to say that this is just for updating the display, and not for checking how ill everyone is.</p>
<p>We need to find the code that sets this status, so I added another watchpoint for any writes to the pointer at 0x005E:</p>
<div><pre><span></span>wpset<span> </span>0x005E,1,w,wpdata<span> </span><span>==</span><span> </span>0xAE
</pre></div>
<p>After reload the save state, the game stopped in another area:</p>
<div><pre><span></span>E630<span>  </span>STX<span> </span><span>$5</span>E<span>       </span><span>;</span><span> </span>mem<span>[</span>0x005E<span>]</span><span> </span><span>=</span><span> </span>X
</pre></div>
<p>I started using the debugger&#39;s Step Out feature (Shift+F11) to move up the call stack and see what was calling what. From further poking around it became apparent that we were in some sort of generic high level text printing function. Then a penny dropped, and I started wondering about the memory layout of the Apple II. A <a href="http://apple2.guidero.us/doku.php/mg_notes/general/mem_map">memory map</a> shows the D000â€“F7FF range to be the part of the ROM containing the BASIC interpreter. Oh.</p>
<p>In fact there&#39;s a <a href="https://6502disassembly.com/a2-rom/Applesoft.html#SymFREFAC">very helpful annotated Apple II ROM disassembly</a>, showing that function is indeed a high-level print function for text.</p>
</div>
<div id="well-that-just-got-complicated">
<h2>Well that just got complicated</h2>
<p>So 1985 Oregon Trail is written in <a href="https://en.wikipedia.org/wiki/Applesoft_BASIC">Applesoft BASIC</a>, and the program is stored as some sort of bytecode. My heart sank a little at this news; 6502 assembly is cumbersome to understand at the best of times, and throwing a BASIC virtual machine on top of that makes live debugging even worse. I didn&#39;t have time to hack together a way to trace the BASIC code as it executed.</p>
<p>However this did open up a new angle of attack. A BASIC program uses variables, which are stored in a known location in a known format. What if we let the game play, then kept an eye on the debugger&#39;s live memory view to see what variables change over time?</p>
<p>The good news is that Applesoft BASIC keeps the original names for each variable; a critical clue. The downside is that those names are (at most) two letters long. Also the memory is managed dynamically, so variables will move around as the program chugs on.</p>
<p>From poking around the ROM disassembly, the pointer to the variable store is at address 0x0069 of the Zero Page (usually 0x9902), followed by a pointer to the array store, and a pointer to all of the string data. Each variable is 7 bytes long; 2 bytes for the name (using the high bits of each to encode type), and 5 bytes data. The default numeric type in Applesoft BASIC is a cursed 40-bit floating point format, with an 8-bit exponent and a 31-bit mantissa.</p>
<p>After a bunch of test runs I found a variable called H, which increased in line with my health status getting worse. Even better, setting the H data to all zeros reset the status back to &#34;good&#34;, after which it seemed to decay back to &#34;very poor&#34; at the previous rate. There was also a H1 array that seemed to keep track of party members that had died (0 for alive, -1 for dead), and a H2 array which seemed to keep track of whatever exciting disease each party member had. Easy! Open and shut!</p>
</div>
<div id="did-we-make-it">
<h2>Did we make it?</h2>
<p>New Years Eve 2025 had arrived, and with it attempt 2 to reach the barren wastelands of future Oregon. This time, the time machine stopped at 16120 AD.</p>
<p><img alt="A screenshot of albrot&#39;s second Oregon Trail Time Machine attempt, some 5 days after the stream began. There is a tombstone that reads &#34;Here lies ALBROT&#34;. The streamer is facepalming." src="https://moral.net.au/writing/2025/01/11/waiting_for_oregon/rip.jpg" title="RIP albrot, what was he even doing up on the roof"/></p><p>A dismal failure. Even when zeroing out the memory, every day H would reset to 139, dooming the party to a short-but-agonizing fate. Cheating death is harder than expected.</p>
</div>
<div id="we-can-still-save-this">
<h2>We can still save this</h2>
<p>Several days later, I tried writing a scrappy decompiler for the Applesoft BASIC bytecode. From past experience I was worried this would be real complex, but in the mother of all lucky breaks the &#34;bytecode&#34; is the original program text with certain keywords replaced with 1-byte tokens. After nicking the list of tokens from the Apple II ROM disassembly I had a half-decent decompiler after a few goes.</p>
<p>(This ultimately turned out to be unnecessary. If I had looked more closely at the options for <a href="https://ciderpress2.com/">CiderPress II</a>, I would&#39;ve seen that you can use the &#34;<a href="https://github.com/fadden/CiderPress2/blob/main/docs/Manual-cp2.md#importip">import</a>&#34; and &#34;<a href="https://github.com/fadden/CiderPress2/blob/main/docs/Manual-cp2.md#exportxp">export</a>&#34; commands to convert Applesoft BASIC files to and from plain text).</p>
<p>So of <em>course</em> we had to look for the code that calculates the player&#39;s health. Here it is, from <tt>OREGON TRAIL</tt>:</p>
<div><pre><span></span><span>...</span>
<span>#</span><span> </span><span>3200</span>
<span>LET</span><span> </span><span>H0</span><span> </span><span>=</span><span> </span><span>C0</span>
<span>FOR</span><span> </span><span>L</span><span> </span><span>=</span><span> </span><span>C0</span><span> </span><span>TO</span><span> </span><span>C4</span>
<span>IF</span><span> </span><span>H1</span><span>(</span><span>L</span><span>)</span><span> </span><span>&gt;</span><span> </span><span>C0</span><span> </span><span>THEN</span><span> </span><span>H2</span><span>(</span><span>L</span><span>)</span><span> </span><span>=</span><span> </span><span>H2</span><span>(</span><span>L</span><span>)</span><span> </span><span>-</span><span> </span><span>C1</span>
<span>LET</span><span> </span><span>H0</span><span> </span><span>=</span><span> </span><span>H0</span><span> </span><span>+</span><span> </span><span>C1</span>
<span>IF</span><span> </span><span>H2</span><span>(</span><span>L</span><span>)</span><span> </span><span>&lt;</span><span> </span><span>C1</span><span> </span><span>THEN</span><span> </span><span>H1</span><span>(</span><span>L</span><span>)</span><span> </span><span>=</span><span> </span><span>C0</span>

<span>#</span><span> </span><span>3205</span>
<span>NEXT</span>
<span>IF</span><span>  </span><span>RND</span><span> </span><span>(</span><span>C1</span><span>)</span><span> </span><span>&lt;</span><span> </span><span>P5</span><span> </span><span>THEN</span><span> </span><span>TM</span><span> </span><span>=</span><span> </span><span>QT</span><span> </span><span>+</span><span>  </span><span>INT</span><span> </span><span>(</span><span> </span><span>RND</span><span> </span><span>(</span><span>C1</span><span>)</span><span> </span><span>*</span><span> </span><span>41</span><span>)</span>
<span>LET</span><span> </span><span>PP</span><span> </span><span>=</span><span> </span><span>(</span><span> </span><span>RND</span><span> </span><span>(</span><span>C1</span><span>)</span><span> </span><span>&lt;</span><span> </span><span>QP</span><span>)</span>
<span>LET</span><span> </span><span>W</span><span> </span><span>=</span><span> </span><span>INT</span><span> </span><span>((</span><span>TM</span><span> </span><span>+</span><span> </span><span>10</span><span>)</span><span> </span><span>/</span><span> </span><span>20</span><span>)</span>
<span>LET</span><span> </span><span>TM</span><span> </span><span>=</span><span> </span><span>W</span>

<span>#</span><span> </span><span>3206</span>
<span>LET</span><span> </span><span>TR</span><span> </span><span>=</span><span> </span><span>C0</span>
<span>LET</span><span> </span><span>TS</span><span> </span><span>=</span><span> </span><span>C0</span>
<span>IF</span><span> </span><span>PP</span><span> </span><span>THEN</span><span> </span><span>Z</span><span> </span><span>=</span><span> </span><span>(</span><span> </span><span>RND</span><span> </span><span>(</span><span>C1</span><span>)</span><span> </span><span>&lt;</span><span> </span><span>.3</span><span>)</span>
<span>LET</span><span> </span><span>W</span><span> </span><span>=</span><span> </span><span>6</span><span> </span><span>+</span><span> </span><span>Z</span><span> </span><span>+</span><span> </span><span>Z</span>
<span>LET</span><span> </span><span>TR</span><span> </span><span>=</span><span> </span><span>.2</span><span> </span><span>+</span><span> </span><span>.6</span><span> </span><span>*</span><span> </span><span>Z</span>
<span>IF</span><span> </span><span>TM</span><span> </span><span>&lt;</span><span> </span><span>C2</span><span> </span><span>THEN</span><span> </span><span>W</span><span> </span><span>=</span><span> </span><span>W</span><span> </span><span>+</span><span> </span><span>C1</span>
<span>LET</span><span> </span><span>TS</span><span> </span><span>=</span><span> </span><span>8</span><span> </span><span>*</span><span> </span><span>TR</span>
<span>LET</span><span> </span><span>TR</span><span> </span><span>=</span><span> </span><span>C0</span>

<span>#</span><span> </span><span>3207</span>
<span>LET</span><span> </span><span>ZT</span><span> </span><span>=</span><span> </span><span>TM</span><span> </span><span>-</span><span> </span><span>C3</span>
<span>IF</span><span> </span><span>ZT</span><span> </span><span>&lt;</span><span> </span><span>C0</span><span> </span><span>THEN</span><span> </span><span>ZT</span><span> </span><span>=</span><span> </span><span>C2</span><span> </span><span>-</span><span> </span><span>TM</span>

<span>#</span><span> </span><span>3210</span>
<span>LET</span><span> </span><span>ZC</span><span> </span><span>=</span><span> </span><span>5</span><span> </span><span>-</span><span> </span><span>TM</span><span> </span><span>-</span><span> </span><span>TM</span><span> </span><span>-</span><span> </span><span>OP</span>
<span>IF</span><span> </span><span>ZC</span><span> </span><span>&lt;</span><span> </span><span>C0</span><span> </span><span>THEN</span><span> </span><span>ZC</span><span> </span><span>=</span><span> </span><span>C0</span>

<span>#</span><span> </span><span>3215</span>
<span>LET</span><span> </span><span>X</span><span> </span><span>=</span><span> </span><span>(</span><span>ZC</span><span> </span><span>&gt;</span><span> </span><span>P5</span><span>)</span>
<span>LET</span><span> </span><span>Y</span><span> </span><span>=</span><span> </span><span>(</span><span>PF</span><span> </span><span>=</span><span> </span><span>C0</span><span>)</span>
<span>LET</span><span> </span><span>ZF</span><span> </span><span>=</span><span> </span><span>F0</span>
<span>IF</span><span> </span><span>Y</span><span> </span><span>THEN</span><span> </span><span>ZF</span><span> </span><span>=</span><span> </span><span>8</span>

<span>#</span><span> </span><span>3220</span>
<span>LET</span><span> </span><span>ZP</span><span> </span><span>=</span><span> </span><span>(</span><span>W</span><span> </span><span>&gt;</span><span> </span><span>5</span><span>)</span><span> </span><span>+</span><span> </span><span>(</span><span>W</span><span> </span><span>&gt;</span><span> </span><span>7</span><span>)</span><span> </span><span>+</span><span> </span><span>P</span><span> </span><span>+</span><span> </span><span>P</span>

<span>#</span><span> </span><span>3225</span>
<span>LET</span><span> </span><span>Z</span><span> </span><span>=</span><span> </span><span>FS</span><span> </span><span>*</span><span> </span><span>P5</span>
<span>IF</span><span> </span><span>X</span><span> </span><span>OR</span><span> </span><span>Y</span><span> </span><span>THEN</span><span> </span><span>Z</span><span> </span><span>=</span><span> </span><span>FS</span><span> </span><span>+</span><span> </span><span>.8</span>

<span>#</span><span> </span><span>3230</span>
<span>LET</span><span> </span><span>FS</span><span> </span><span>=</span><span> </span><span>Z</span>
<span>LET</span><span> </span><span>H</span><span> </span><span>=</span><span> </span><span>.9</span><span> </span><span>*</span><span> </span><span>H</span><span> </span><span>+</span><span> </span><span>ZT</span><span> </span><span>+</span><span> </span><span>ZC</span><span> </span><span>+</span><span> </span><span>ZF</span><span> </span><span>+</span><span> </span><span>ZP</span><span> </span><span>+</span><span> </span><span>FS</span><span> </span><span>+</span><span> </span><span>H0</span><span> </span><span>+</span><span> </span><span>HR</span>
<span>LET</span><span> </span><span>PF</span><span> </span><span>=</span><span> </span><span>PF</span><span> </span><span>-</span><span> </span><span>FC</span>
<span>IF</span><span> </span><span>PF</span><span> </span><span>&lt;</span><span> </span><span>C0</span><span> </span><span>THEN</span><span> </span><span>PF</span><span> </span><span>=</span><span> </span><span>C0</span>

<span>#</span><span> </span><span>3235</span>
<span>IF</span><span>  </span><span>NOT</span><span> </span><span>W1</span><span> </span><span>AND</span><span> </span><span>H</span><span> </span><span>&gt;</span><span> </span><span>139</span><span> </span><span>THEN</span><span>  </span><span>GOSUB</span><span> </span><span>10300</span>
<span>INVERSE</span>
<span>...</span>
</pre></div>
<p>Constants:</p>
<ul>
<li><strong>C0</strong>: 0.0</li>
<li><strong>C1</strong>: 1.0</li>
<li><strong>C2</strong>: 2.0</li>
<li><strong>C3</strong>: 3.0</li>
<li><strong>C4</strong>: 4.0</li>
<li><strong>P5</strong>: 0.5</li>
</ul>
<p>Inputs:</p>
<ul>
<li><strong>NP</strong>: number of party members alive.</li>
<li><strong>P</strong>: pace. 1: steady, 2: strenuous, 3: gruelling</li>
<li><strong>PF</strong>: pounds of food left. Copied over from I(8).</li>
<li><strong>R</strong>: rations. 1: filling, 2: meagre, 3: bare-bones</li>
<li><strong>W</strong>: weather. 0: very cold, 1: cold, 2: cool, 3: warm, 4: hot, 5: very hot, 6: rainy, 7: snowy, 8: very rainy, 9: very snowy</li>
</ul>
<p>Calculated factors:</p>
<ul>
<li><strong>FC</strong>: pounds of food consumed. <tt>FC = NP * (4 - R)</tt></li>
<li><strong>ZC</strong>: clothing misery factor. <tt>ZC = 5 - W * 2 - (clothes/NP)</tt></li>
<li><strong>ZF</strong>: food misery factor. <tt>ZF = 2 * (R - 1)</tt>, or <tt>= 8</tt> if you have no food left</li>
<li><strong>ZP</strong>: pace misery factor. <tt>ZP = (W &gt; 5) + (W &gt; 7) + P + P</tt></li>
<li><strong>ZT</strong>: temperature misery factor. <tt>ZT = 0</tt> if W is warm or cool, otherwise the number of steps away from warm or cool.</li>
<li><strong>FS</strong>: food starvation factor. <tt>FS = FS + 0.8</tt> if there&#39;s no food or if ZC &gt; 0.5, otherwise <tt>FS = FS * 0.5</tt>.</li>
<li><strong>H0</strong>: seems to be <tt>H0 = 5.0</tt> at calc time?</li>
<li><strong>HR</strong>: hardship factor. <tt>HR = 10</tt> if the trail is rough, <tt>HR = 20</tt> if someone just died, 20% chance of <tt>HR = 20</tt> if the water is bad, 10% chance of <tt>HR = 10</tt> if there&#39;s very little water</li>
</ul>
<p>Output:</p>
<ul>
<li><strong>H</strong>: party health score. 0-34 is good, 35-69 is fair, 70-104 is poor, 105-139 is very poor. Capped at 139. <tt>H = .9 * H + ZT + ZC + ZF + ZP + FS + H0 + HR</tt></li>
</ul>
<p>The inputs were figured out by checking what text the game prints on the screen for those variables; e.g. W is used to fetch a string from an array W$ that looks like this:</p>
<div><pre><span></span><span>[</span>0xa0ee<span>]</span><span>  </span>5780250001000a<span>  </span>W$<span>[</span><span>10</span><span>]</span><span> </span><span>=</span>
<span>[</span>0xa0f8<span>]</span><span>  </span>09efa6<span>  </span>-<span> </span>b<span>&#39;very cold&#39;</span>
<span>[</span>0xa0fb<span>]</span><span>  </span>04eba6<span>  </span>-<span> </span>b<span>&#39;cold&#39;</span>
<span>[</span>0xa0fe<span>]</span><span>  </span>04e7a6<span>  </span>-<span> </span>b<span>&#39;cool&#39;</span>
<span>[</span>0xa101<span>]</span><span>  </span>04e3a6<span>  </span>-<span> </span>b<span>&#39;warm&#39;</span>
<span>[</span>0xa104<span>]</span><span>  </span>03e0a6<span>  </span>-<span> </span>b<span>&#39;hot&#39;</span>
<span>[</span>0xa107<span>]</span><span>  </span>08d8a6<span>  </span>-<span> </span>b<span>&#39;very hot&#39;</span>
<span>[</span>0xa10a<span>]</span><span>  </span>05d3a6<span>  </span>-<span> </span>b<span>&#39;rainy&#39;</span>
<span>[</span>0xa10d<span>]</span><span>  </span>05cea6<span>  </span>-<span> </span>b<span>&#39;snowy&#39;</span>
<span>[</span>0xa110<span>]</span><span>  </span>0ac4a6<span>  </span>-<span> </span>b<span>&#39;very rainy&#39;</span>
<span>[</span>0xa113<span>]</span><span>  </span>0abaa6<span>  </span>-<span> </span>b<span>&#39;very snowy&#39;</span>
</pre></div>
<p>The health factors are all conjecture based on the inputs, but I think they make sense. We have the formula for H, and there&#39;s only one misery factor which would be affected by waiting 14272 years: the food starvation factor. In case you&#39;re wondering what that looks like:</p>
<div><pre><span></span><span>[</span>0x9bb0<span>]</span><span>  </span>4653967e4f4234<span>  </span><span>FS</span><span> </span><span>=</span><span> </span><span>4166608</span>.55078125
</pre></div>
<p>Yikes. We can see that every day after crossing Snake River, H would increase by at least 4.1 million, and then be rounded down to the worst possible health score of 139. It would take 15 days of doing nothing but sitting and eating to bring the food starvation factor down to 127, by which point everyone in the party would be dead.</p>
<p>But finally, FINALLY we know how to distort reality enough to get this train back on the rails. The party is back to full health, all that&#39;s left is to get past the final fork at The Dalles and...</p>
</div>
<div id="did-we-make-it-to-oregon">
<h2>Did we make it to Oregon???</h2>
<p><img alt="A screenshot of an error screen. The text reads &#34;Error 53 at line #50050 in Oregon Trail. Please report this error to MECC.&#34;" src="https://moral.net.au/writing/2025/01/11/waiting_for_oregon/error53.png" title="This only happened because I threw out the receipt"/></p><p>Piss. I couldn&#39;t find a technical contact for MECC, so I dug around and saw line 50050 was in TRADE.LIB; namely the code responsible for drawing the inventory. Error 53 is the Apple II error code for <tt>GS/OS: parameter out of range</tt>. But what could possibly be wrong with the inventory? It was fine on the road!</p>
<p>Oh. Wait.</p>
<div><pre><span></span><span>[</span>0x9d29<span>]</span><span>  </span><span>49802200010009</span><span>  </span>I$<span>[</span><span>9</span><span>]</span><span> </span><span>=</span>
<span>[</span>0x9d33<span>]</span><span>  </span><span>000000</span><span>  </span>-<span> </span>b<span>&#39;&#39;</span>
<span>[</span>0x9d36<span>]</span><span>  </span>0512a9<span>  </span>-<span> </span>b<span>&#39;Wagon&#39;</span>
<span>[</span>0x9d39<span>]</span><span>  </span>040ea9<span>  </span>-<span> </span>b<span>&#39;oxen&#39;</span>
<span>[</span>0x9d3c<span>]</span><span>  </span>10fea8<span>  </span>-<span> </span>b<span>&#39;sets of clothing&#39;</span>
<span>[</span>0x9d3f<span>]</span><span>  </span>07f7a8<span>  </span>-<span> </span>b<span>&#39;bullets&#39;</span>
<span>[</span>0x9d42<span>]</span><span>  </span>0ceba8<span>  </span>-<span> </span>b<span>&#39;wagon wheels&#39;</span>
<span>[</span>0x9d45<span>]</span><span>  </span>0be0a8<span>  </span>-<span> </span>b<span>&#39;wagon axles&#39;</span>
<span>[</span>0x9d48<span>]</span><span>  </span>0dd3a8<span>  </span>-<span> </span>b<span>&#39;wagon tongues&#39;</span>
<span>[</span>0x9d4b<span>]</span><span>  </span>0ec5a8<span>  </span>-<span> </span>b<span>&#39;pounds of food&#39;</span>
<span>[</span>0x9d4b<span>]</span><span>  </span><span>49003400010009</span><span>  </span>I<span>[</span><span>9</span><span>]</span><span> </span><span>=</span>
<span>[</span>0x9d57<span>]</span><span>  </span>ffffffffff<span>  </span>-<span> </span>-1.7014118342085515e+38
<span>[</span>0x9d5c<span>]</span><span>  </span>ffffffffff<span>  </span>-<span> </span>-1.7014118342085515e+38
<span>[</span>0x9d61<span>]</span><span>  </span><span>8310000000</span><span>  </span>-<span> </span><span>4</span>.5
<span>[</span>0x9d66<span>]</span><span>  </span><span>8528000000</span><span>  </span>-<span> </span><span>21</span>.0
<span>[</span>0x9d6b<span>]</span><span>  </span>8a09000000<span>  </span>-<span> </span><span>548</span>.0
<span>[</span>0x9d70<span>]</span><span>  </span><span>8100000000</span><span>  </span>-<span> </span><span>1</span>.0
<span>[</span>0x9d75<span>]</span><span>  </span><span>8100000000</span><span>  </span>-<span> </span><span>1</span>.0
<span>[</span>0x9d7a<span>]</span><span>  </span><span>8100000000</span><span>  </span>-<span> </span><span>1</span>.0
<span>[</span>0x9d7f<span>]</span><span>  </span><span>8200000000</span><span>  </span>-<span> </span><span>2</span>.0
</pre></div>
<p>The game was kind enough to gift me -170 billion billion billion billion wagons.</p>
<p>Actually this was a red herring. Line 50050 is also on Side B inside END.LIB, aka. the screen before the crash (choosing between floating down the Columbia River or taking the Barlow Toll Road).</p>
<p>And guess what.</p>
<p>It reads the date:</p>
<div><pre><span></span><span># 50050</span>
<span>[</span>0x023d<span>]</span><span>  </span>POKE<span> </span><span>900</span>,NP
<span>[</span>0x0245<span>]</span><span>  </span>POKE<span> </span><span>901</span>,AY<span> </span>-<span> </span><span>1800</span>
<span>[</span>0x0252<span>]</span><span>  </span>POKE<span> </span><span>902</span>,AM
<span>[</span>0x025a<span>]</span><span>  </span>POKE<span> </span><span>903</span>,AD
</pre></div>
<p><tt>AY</tt> is the variable containing the year, and the POKE instruction tries to shove the value of <tt>AY - 1800</tt> into <em>a single byte</em> of the regular Apple II memory, causing a crash as it is much larger than the maximum of 255.</p>
<p>These POKEs seem to be how Oregon Trail saves key information when it switches between BASIC programs. Most of the game is handled by the main program &#34;OREGON TRAIL&#34; (written by John Krenz), which loads in modules like &#34;RIVER.LIB&#34; and keeps access to all the variables. Whenever a new main program is loaded in, all the BASIC variables are lost except for whatever data you happened to copy to regular memory with POKE. At the end of the game you have the option of floating down the river, which uses a new main program &#34;FLOAT&#34; (written by Steven Splinter) before switching again to the &#34;WIN&#34; program, so it follows that the game would need to use the POKEd numbers.</p>
<p>What happens if we mod the BASIC code in memory to say something else?</p>

<p><img alt="A screenshot of the ending screen of Oregon Trail, showing the beautiful Willamette Valley, and the utterly incorrect year of 18255." src="https://moral.net.au/writing/2025/01/11/waiting_for_oregon/badending.png" title="Oh no."/></p><p>Finally we have a definitive answer about whether this whole ordeal is possible. Unlike <em>every other progress screen in the game</em>, the ending screen has the year hardcoded to start with &#34;18&#34;, followed by the printed text of whatever <tt>PEEK 901</tt> is. The maximum number of years you can take without crashing the game is 207, and any attempts longer than 51 years will end in the wrong century.</p>
<p>Really, there wasn&#39;t much point going on; it felt like further trickery went against the spirit of the challenge. Maybe there&#39;s closure enough in knowing that if you somehow avoid starvation for 142 centuries, the game dicks you at the last possible moment by expecting the year to be sensible.</p>
</div>
<div id="then-again-we-re-98-of-the-way-there">
<h2>Then again we&#39;re 98% of the way there</h2>
<p>I lied. <a href="https://moral.net.au/misc/oregon_sideb_mod.do">Here&#39;s</a> a improved version of Oregon Trail side B with the following quality-of-life changes:</p>
<ul>
<li>Waiting by a river for conditions to improve resets the food starvation factor to 0.</li>
<li>The final sequence uses two bytes to store the year.</li>
</ul>
<p>Many thanks to the CiderPress II team for making it easy to load replacement code onto the floppy.</p>
</div>
<div id="conclusions">
<h2>Conclusions</h2>
<p><img alt="A screenshot of the ending screen of Oregon Trail, showing the beautiful Willamette Valley, and the correct end year of 16120." src="https://moral.net.au/writing/2025/01/11/waiting_for_oregon/success.png" title="Nature has reclaimed post-civilisation Oregon"/></p><p>Applesoft BASIC is majestically slow, but thanks to 40-bit floating point and standard commands for drawing and text manipulation, Oregon Trail works much better than I could have expected after running the simulation for 14272 years. The final screen being broken is a bit of a letdown, but understandable given how unlikely it is that you&#39;d take 14272 years to finish the game.</p>
<p>Honestly, one of my aims has been to create a reverse engineering approach that will work for any system, regardless of knowledge or experience, and give you the basic steps for how to understand and modify it. This was a bit of a test run of this, and I think it could be considered a success. Eventually I&#39;ll write it down properly, but hopefully this effort will give you some ideas for your next reversing project.</p>
<p>And albrot? Well, he was able to fulfill his dream and become the <a href="https://www.twitch.tv/albrot/clip/MushyFlirtyPorcupineOhMyDog-r1PPasYUcpDPTW4e">first person to survive for 15000 years on the Oregon Trail</a>. A well deserved victory.</p>
<p>If you&#39;re interested in the tools I wrote for this work, the Applesoft BASIC decompiler and variable scraper I wrote are available <a href="https://github.com/moralrecordings/applesoft-basic-decompiler">here</a>. Happy trails!</p>
</div>

</div>
</div>
</div></div>
  </body>
</html>
