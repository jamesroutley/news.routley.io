<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300">Original</a>
    
    <div id="readability-page-1" class="page"><div>

    

    




    <section>
        <h2 id="menu-description">Description</h2>
        <div><p>The nice thing about technological progress is that even once innovative technologies are considered outdated at some point. And outdated technology is cheap technology. So it comes that one can buy the first generation of digital xray image sensors on ebay from time to time for just 100-200€. This isn&#39;t particularly cheap, however these things were sold for ~20k€ once. 
</p></div>
    </section>

    




    <section>
        <h2 id="menu-details">Details</h2>
        

        
            <div>
                <p>Before I got the DigiPan delivered, I did some research on the internet and was rather disappointed to find nothing about this sensors at all. However I contacted a guy on a medical support forum that seemed to know about Trophy devices. As it turned out this guy had all the documents I could have wished, including pinouts and confidential powerpoint presentations. Without his help I probably wouldn&#39;t have come so far yet.</p>

<p>First challenge was to get the DigiPan powered. The only connection is a 8-pin DIN plug on a ~20cm long cable. Both power and data goes through this connector.</p>



















<p>Here is the pinout of a similar type of DigiPan as mine, pinout is identical for both:</p>



















<figure><img data-src="https://cdn.hackaday.io/images/2083531519390355378.png"/></figure>



















<p>As you can see, the sensor requires 5V (2A) and +/- 15V (700mA). Also there is some hint of the type of interface this thing uses: RS422. <br/></p>



















<p>Unfortunately RS422 is only a specification of the physical layer, not the actual protocol. So it was still unclear how this thing sends out image data. However, RS422 is a mono-directional interface and there is no second RX channel. This means the panel can only send out data, it can&#39;t receive anything from the computer. This is nice, as this means it doesn&#39;t require any magical initialization commands or settings transmitted to it to operate normal. It works standalone, which makes it perfect for further reverse engineering</p>









<hr/>



















<p>With this information I was able to power my DigiPan once I received it. Applying the 5V is enough to get the digital circuitry running. In fact there is a relais inside that only lowers the CCD and analog circuitry during exposure. </p>



















<p>From the support manual I knew that the DigiPan sends out a test image at powerup. It is a greysgale gradient with the resolution of a typical x-ray scan. </p>





















<p>First goal was to capture this image and display it. However, first we have to understand how this sensor actually works:</p>





















<p>The actual CCD sensor has a resolution of 1244 x 61 pixels. While today&#39;s image sensors use a 2D image sensor with the size of the required area (up to 200 x 200mm, which is basically a whole silicon wafer as a single image sensor), this DigiPan sensor has to be slided during exposure. It is basically a 1D sensor that has to be moved to generate 2D images. From what I know, this also means maximum image witdh is unlimited as the data isn&#39;t buffered, but streamed out during exposure.</p>





















<p>But wait, why does the sensor has 61 pixels in x direction then?  </p>





















<p>X-rays are rather weak, especially in medical context.

So to get well exposed images, long exposure times are necessary. This isn&#39;t a problem for stationary 2D image sensors, but as this thing moves, long integration times would cause motion blur. </p>





















<p>In order to achieve both high sensitivity and fast movement Trophy uses a trick called time delay integration (TDI). This works by having multiple (61) rows of elements which each shift their partial measurements to the adjacent row synchronously with the motion of the image across the array of elements.</p>















<p><img data-src="https://cdn.hackaday.io/images/3925911519394711240.jpg"/></p>









<hr/>









<p>Here you can see the data sent out by the DigiPan at powerup. Sampled with a Saleae China clone at 24MSa/s and PulseView:<br/></p>







<figure><img data-src="https://cdn.hackaday.io/images/152961519401587073.png"/></figure>









<figure><img data-src="https://cdn.hackaday.io/images/7117501519401597255.png"/></figure>









<p>Some measuring revealed a bit rate of ~7.9MHz. The crystal next to the cpu on the DigiPan pcb has 16MHz, so it&#39;s 8MHz. The protocol contains<strong> one Start bit </strong>and <strong>no Stop bit</strong>. <br/></p>









<p>The actual data is 12bit + 1 control bit that seems to be always 1. The 12 bit data is the actual ADC reading of each pixel. Data is streamed out pixel by pixel, line by line, 1244x 13 bit data packets per CCD line.</p>









<p>This is very similar to genuine UART, however UART usually has baud rates of 9600-115200 and 8 data bits + 1 stop bit. Sigrok-cli already has an UART decoder, however only for these standard values....</p>
                    
                        <p><a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/details">Read more »</a></p>
            </div>
        
        
    </section>


    




    




    

    






    <section>
        <h2 id="menu-logs">Project Logs
            
                <a href="">
                    




    


                    




    


                    <span>Collapse</span>
                </a>
            
        </h2>
        
        <ul>
        
            <li data-order="0" data-id="113379">
                <h3>
                    <a href="https://hackaday.io/project/62710/log/113379-going-realtime">Going realtime</a>
                    
                </h3>
                <small>
                    <span><span data-id="291971"><a href="https://hackaday.io/hacker/291971-lucy-fauth">Lucy Fauth</a></span></span> •
                    <span title="4 years ago">03/09/2018 at 20:25</span>  •
                    <a href="https://hackaday.io/project/62710/log/113379-going-realtime#discussion-list">
                        0 comments
                    </a>
                </small>
                <div>
                    <p>The nice thing about the original DigiPan hard- and software is that the image is displayed in realtime as it is exposed. This saves a lot of time, as you can see right at the beginning if an acquisition is over- or underexposed. With the current software setup, however, realtime processing isn&#39;t possible: Data needs to be captured first, and then the software decoder can be used for decoding.</p><p>I didn&#39;t like the sigrok decoder anyway, it was just a quick workaround to be able to somehow capture UART with 13bit. The proper way to do this is in hardware: Either with an actual CPU that supports 13bit framing, or, for more flexibility, a fpga. I had an iCE40 board laying around and the toolchain set up anyway, so I gave it a go. Using an existing UART-echo demo, it was a matter of few hours to modify the code for my application. As I would require an UART speed of 8Mbaud to transmit 13bit data with 4Mbaud as 2x 8 bit frames, I had to configure the internal PLL to get faster clocking. Also, setting the FTDI to a baudrate &gt;2Mbaud isn&#39;t supported by the Linux driver, so you have to do this using some usb magic.</p><p>Both the verilog code and the python scripts for capturing and displaying are available here: <a href="https://github.com/NiklasFauth/iCE40-digipan-hardwaredecoder">https://github.com/NiklasFauth/iCE40-digipan-hardwaredecoder</a></p><p>Here is a video of the acquisition:</p><p><iframe src="//www.youtube.com/embed/EExRPJqIu88" allowfullscreen="" frameborder="0"></iframe></p><p>After playing around with pygame and stty for buffering data while received, I managed to get the same effect as using the original Windows 2000 software: The image is being displayed as the DigiPan is slided along the image:</p><p><iframe src="//www.youtube.com/embed/FhK-hanAdVs" allowfullscreen="" frameborder="0"></iframe></p>
                        
                    
                </div>
            </li>
        
            <li data-order="1" data-id="102930">
                <h3>
                    <a href="https://hackaday.io/project/62710/log/102930-first-images">First Images</a>
                    
                </h3>
                <small>
                    <span><span data-id="291971"><a href="https://hackaday.io/hacker/291971-lucy-fauth">Lucy Fauth</a></span></span> •
                    <span title="4 years ago">02/26/2018 at 10:24</span>  •
                    <a href="https://hackaday.io/project/62710/log/102930-first-images#discussion-list">
                        0 comments
                    </a>
                </small>
                <div>
                    <p>While for the test pattern only the 5V rail is required, for actual xray acquisition the DigiPan also needs +/- 15V. So the first step was to build a suitable power supply.<br/></p><figure><img data-src="https://cdn.hackaday.io/images/4150591519637126917.jpg"/></figure><figure><img data-src="https://cdn.hackaday.io/images/7176621519637129768.jpg"/></figure><ul><li>2x 15V 1A switching mode power supplies</li><li>1x 5V 3A switching mode power supply</li><li>1x Saleae Logic 8 clone from AliExpress for 3$</li><li>1x ISO1176 RS485 isolator to isolate the DigiPan ground from the USB &amp; logic ground</li></ul><p>The output of the ISO1176 is connected to one of the logic analyzer inputs. Also the 5V DigiPan power is connected to one input. This is not necessary however it allows to trigger sampling on rising edge of this power rail and thus to the test image sent out at power up, which makes testing way easier.</p><hr/><p>To slide the DigiPan during exposure we used a linear guide with a built in brushed motor. Speed control by controlling the motors voltage was sufficient at this point. Here is a video of the setup used to capture the first images:</p></div>
            </li>
        
        </ul>
        <p>
            
            
                <a href="https://hackaday.io/project/62710/logs">
                
                    View all 2 project logs
                
                </a>
            
        </p>
    </section>

    




    

    
    




    


    
    <section>
    <h2 id="j-discussions-title">Discussions</h2>

    

    <div id="discussion-list">
        

    <p><a href="#">Log In/Sign up to comment</a></p>
<div id="login-modal">
        <div>
        <div>
    

    <div>
        <div>
            
            <p>
                <span>Create an account to leave a comment.</span>
                <span>Already have an account?</span>
                <a href="https://hackaday.io/signin">Log In</a>.
            </p>
        </div>
        
    </div>

    </div>
    </div>

</div>





    
    

    <div id="j-discussion-167108" data-level="1">
        <p><a href="https://hackaday.io/hacker/1211208">
                <img src="https://cdn.hackaday.io/images/resize/100x100/default-avatar.png" alt=""/>
            </a>

            
        </p>
        <div>
            <p><small>

                <span data-id="1211208"><a href="https://hackaday.io/hacker/1211208-ssemakulaivan7">ssemakulaivan7</a></span>

                wrote <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/discussion-167108"><span title="3 months ago">08/26/2021 at 11:18</span></a>

                <span id="comment-points-holder-167108">
                    • <span id="comment-points-167108">
                         point
                    </span>
                </span>

            </small></p><div>
                <p>i bought the trophy os 500 but i have failed to have the x  ray  image displayed on my pc screen any videos or slides or assistance on how to make it work guys thanks </p>
                
            </div>
            <p>
                <span id="actions-167108">
                    
                    
                     
                </span>
                <span><span>Are you sure?</span> <a href="#">yes</a> | <a href="#">no</a></span>
            </p>
        </div>
    </div>

    

    
    

    <div id="j-discussion-128712" data-level="1">
        <p><a href="https://hackaday.io/hacker/15890">
                <img src="https://cdn.hackaday.io/images/resize/100x100/default-avatar.png" alt=""/>
            </a>

            
        </p>
        <div>
            <p><small>

                <span data-id="15890"><a href="https://hackaday.io/hacker/15890-konstantin-werner">Konstantin Werner</a></span>

                wrote <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/discussion-128712"><span title="2 years ago">06/23/2019 at 16:33</span></a>

                <span id="comment-points-holder-128712">
                    • <span id="comment-points-128712">
                         point
                    </span>
                </span>

            </small></p><div>
                <div id="comment-128712-content">
                    <p>Does your sensor output any data when moved without any x-rays? I get the grayscale image at startup and hear the relay for the +-15V click when it starts moving in the right direction. But there&#39;s no output on the RS-422 lines. Is it broken or does it need to see x-rays to start sending? (I tried it without the metal cover, but maybe the scintillator crystal doesn&#39;t transmit enough visible light.)</p>



<p>On a related topic: Where&#39;d you get your sweet microfocus source? I&#39;ve been searching for one of those for ages -.-<br/></p>
                </div>
                
            </div>
            <p>
                <span id="actions-128712">
                    
                    
                     
                </span>
                <span><span>Are you sure?</span> <a href="#">yes</a> | <a href="#">no</a></span>
            </p>
        </div>
    </div>

    

    
    

    

    

    
    

    <div id="j-discussion-102615" data-level="1">
        <p><a href="https://hackaday.io/hacker/177148">
                <img src="https://cdn.hackaday.io/images/resize/100x100/default-avatar.png" alt=""/>
            </a>

            
        </p>
        <div>
            <p><small>

                <span data-id="177148"><a href="https://hackaday.io/hacker/177148-mt-tth">Máté Tóth</a></span>

                wrote <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/discussion-102615"><span title="4 years ago">03/11/2018 at 22:39</span></a>

                <span id="comment-points-holder-102615">
                    • <span id="comment-points-102615">
                         point
                    </span>
                </span>

            </small></p><div>
                <div id="comment-102615-content">
                    <p>I like your project, I was thinking when I read the part where you mentioned the linear encoder. Is it possible it need that barcode lines read on the ccd, because it is absolute encoder, so the cpld is calcating the positios, and it is triggering the ccd. I think the ccd is not velocity controlled it is actually position controlled. In case the mechine loses power, after the power restored, the encoder still know where it is. It is my theary sorry, If it is not the case.</p>

<p>I saw a simmilar setup, Where is a head with Mini ccd inside and it is reading a linear barcode. It is called renishaw resolute.</p>

<p><a href="https://goo.gl/images/QN9AP1">https://goo.gl/images/QN9AP1</a></p>
                </div>
                
            </div>
            <p>
                <span id="actions-102615">
                    
                    
                     
                </span>
                <span><span>Are you sure?</span> <a href="#">yes</a> | <a href="#">no</a></span>
            </p>
        </div>
    </div>

    

    
    

    <div id="j-discussion-102707" data-level="2">
        <p><a href="https://hackaday.io/hacker/37025">
                <img src="https://cdn.hackaday.io/images/resize/100x100/805561501699422767.png" alt=""/>
            </a>

            
        </p>
        <div>
            <p><small>

                <span data-id="37025"><a href="https://hackaday.io/hacker/37025-jana-marie">Jana Marie</a></span>

                wrote <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/discussion-102707"><span title="4 years ago">03/13/2018 at 07:57</span></a>

                <span id="comment-points-holder-102707">
                    • <span id="comment-points-102707">
                         point
                    </span>
                </span>

            </small></p><div>
                <p>No it is not an absolute encoder, it&#39;s purpose is to determine the velocity and direction the panel is moving.</p>
                
            </div>
            <p>
                <span id="actions-102707">
                    
                    
                     
                </span>
                <span><span>Are you sure?</span> <a href="#">yes</a> | <a href="#">no</a></span>
            </p>
        </div>
    </div>

    

    
    

    <div id="j-discussion-102365" data-level="1">
        <p><a href="https://hackaday.io/hacker/112574">
                <img src="https://cdn.hackaday.io/images/resize/100x100/705291501713889750.png" alt=""/>
            </a>

            
        </p>
        <div>
            <p><small>

                <span data-id="112574"><a href="https://hackaday.io/hacker/112574-cbmeeks">cbmeeks</a></span>

                wrote <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/discussion-102365"><span title="4 years ago">03/07/2018 at 19:48</span></a>

                <span id="comment-points-holder-102365">
                    • <span id="comment-points-102365">
                         point
                    </span>
                </span>

            </small></p><div>
                <p>Great idea...get you some of those X-Ray glasses they used to sell in the back of comic books and put two of these in there.  Finally, X-Ray glasses that REALLY WORK!</p>
                
            </div>
            <p>
                <span id="actions-102365">
                    
                    
                     
                </span>
                <span><span>Are you sure?</span> <a href="#">yes</a> | <a href="#">no</a></span>
            </p>
        </div>
    </div>

    

    
    

    

    

    
    

    

    

    
    

    

    

    
    

    <div id="j-discussion-102357" data-level="1">
        <p><a href="https://hackaday.io/hacker/44620">
                <img src="https://cdn.hackaday.io/images/resize/100x100/4171571501699619061.jpeg" alt=""/>
            </a>

            
        </p>
        <div>
            <p><small>

                <span data-id="44620"><a href="https://hackaday.io/hacker/44620-eliasbakken">eliasbakken</a></span>

                wrote <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/discussion-102357"><span title="4 years ago">03/07/2018 at 18:34</span></a>

                <span id="comment-points-holder-102357">
                    • <span id="comment-points-102357">
                         point
                    </span>
                </span>

            </small></p><div>
                <p>Very cool! Would love one of these for verifying BGA placement on PCBs. Glad to see it&#39;s within reach should I ever come around to it :)</p>
                
            </div>
            <p>
                <span id="actions-102357">
                    
                    
                     
                </span>
                <span><span>Are you sure?</span> <a href="#">yes</a> | <a href="#">no</a></span>
            </p>
        </div>
    </div>

    

    
    

    <div id="j-discussion-102708" data-level="2">
        <p><a href="https://hackaday.io/hacker/37025">
                <img src="https://cdn.hackaday.io/images/resize/100x100/805561501699422767.png" alt=""/>
            </a>

            
        </p>
        <div>
            <p><small>

                <span data-id="37025"><a href="https://hackaday.io/hacker/37025-jana-marie">Jana Marie</a></span>

                wrote <a href="https://hackaday.io/project/62710-taking-digital-xray-shots-for-cheap-300/discussion-102708"><span title="4 years ago">03/13/2018 at 08:03</span></a>

                <span id="comment-points-holder-102708">
                    • <span id="comment-points-102708">
                         point
                    </span>
                </span>

            </small></p><div>
                <p>That is why we bought these, but its pixel pitch is not quite fine enought. However, we are working on reverse engineering a better sensor. :)</p>
                
            </div>
            <p>
                <span id="actions-102708">
                    
                    
                     
                </span>
                <span><span>Are you sure?</span> <a href="#">yes</a> | <a href="#">no</a></span>
            </p>
        </div>
    </div>

    





    </div>

    

</section>




</div></div>
  </body>
</html>
