<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/UnixShellsNoMoreAccessControl">Original</a>
    <h1>Unix shells are generally not viable access control mechanisms any more</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Unix shells are generally not viable access control mechanisms any more</h2>

	<p><small>September 17, 2023</small></p>
</div><div><p>Once upon a time, if you had a collection of Unix systems, you could
reasonably do a certain amount of access control to your overall
environment by forcing logins to have specific administrative shells.
As a bonus, these administrative shells could print helpful messages
about why the particular login wasn&#39;t being allowed to use your system.
This is a quite attractive bundle of features, but unfortunately this
no longer works in a (modern) Unix environment with logins (<a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/OurDifferentSysadminEnvironment">such as
we have</a>). There are two core problems.</p>

<p>First, you almost certainly operate a variety of services that
normally only use Unix logins as a source of (password) authentication
and perhaps a UID to operate as, and ignore the login&#39;s shell. This
is the common pattern of Samba, IMAP servers, <a href="https://utcc.utoronto.ca/~cks/space/blog/web/ApacheBasicAuthWhy">Apache HTTP Basic
Authentication</a>, and so on. In some cases
you may be able to teach these services to look at the login&#39;s shell
and do special things, but some of them are sealed black boxes and
even the ones that can be changed require you to go out of your
way. If you forget one, it fails open (allowing access to people
with an administrative shell that should lock them out).</p>

<p>(One of these services is SSH itself, since you can generally
initiate SSH sessions and ask for port forwarding or other features
that don&#39;t cause SSH to run the login shell.)</p>

<p>Second, you may operate general authentication services, such as
LDAP or a Single Sign On system, and if you do these authentication
services are generally blind to what they&#39;re being used for and
thus to whether or not a login with a special shell should be allowed
to pass this particular authentication. The only real solution is
to have multiple versions of these authentication systems with
different logins in them, and point systems at different ones based
on exactly who should be allowed to use them.</p>

<p>A similar issue happens with Apache HTTP Basic Authentication in
common configurations, where you have a single authentication realm
with a single Apache htpasswd file that covers an assortment of
different services. If you need certain logins (&#39;locked&#39; logins or
the like) to be excluded from some of these services but not others,
either you need multiple htpasswd files (at least) or you need to
teach each such service to do additional checks.</p>

<p>(In general you&#39;re going to have to try to carefully review who
should be able to use which of your services when, and the resulting
matrix is often surprisingly complicated and tangled. Life gets more
complicated if you&#39;re using administrative shells for reasons other
than just locking people out with a message, for example to try to
force an initial password change.)</p>

<p>Today, the only two measures of login access control that really
work in a general environment are either scrambling the login&#39;s
password (and disable any SSH authorized keys) or excluding the
login entirely from your various authentication data sources (your
LDAP servers, your Apache htpasswd files, and so on). It&#39;s a pity
that changing people&#39;s shells is no longer enough (it was both easy
and convenient), but that&#39;s how the environment has evolved.</p>
</div></div>
  </body>
</html>
