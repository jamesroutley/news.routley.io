<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://buttondown.email/hillelwayne/archive/raku-a-language-for-gremlins/">Original</a>
    <h1>Raku: A language for gremlins</h1>
    
    <div id="readability-page-1" class="page"><div>

                

                
                    
                        <p>I just added a big new section to learntla: <a href="https://learntla.com/topics/optimization.html" target="_blank">Optimizing TLA+ Model Checking</a>. I take a spec and then show 15 different optimizations, many of them getting a 10x runtime improvement. Patreon notes <a href="https://www.patreon.com/posts/notes-on-tla-87093195" target="_blank">here</a>. Besides that I&#39;ve done very little writing the last couple weeks. I&#39;m just in a slump: I sit down to write and the words all come out wrong. It happens sometimes and there&#39;s nothing to do about it but wait it out. </p>
<p>So instead of working I&#39;ve been learning <a href="https://raku.org/" target="_blank">Raku</a>.<sup id="fnref:perl6"><a href="#fn:perl6">1</a></sup> It originally got on my radar after I ranted about <a href="https://buttondown.email/hillelwayne/archive/i-am-disappointed-by-dynamic-typing/" target="_blank">dynamic languages</a> and a couple of users told me I&#39;d like Raku. I finally checked it out last week to see if it&#39;d make a good &#34;calculator language&#34;. I use a hodgepodge of Python, <a href="https://hillelwayne.com/post/j-notation/" target="_blank">J</a>, <a href="https://hillelwayne.com/post/frink/" target="_blank">Frink</a>, and Excel to do math and they all have their own big drawbacks, so it&#39;d be nice if Raku could round them out.</p>
<p>After several days of experiments, I&#39;m at a loss of <em>how</em> to describe Raku. The best I can come up with is that the language was designed by a bunch of really intelligent gremlins. Gremlins who spent a lot of time gathering feedback from other gremlins. </p>
<h3>Weird Operators</h3>
<p>Raku has no qualms about using Unicode operators. You check set membership with ∈. There&#39;s also ∉, ∋, and ∌. It&#39;s also fine with alphanumeric infix operators. String repetition op is <code>x</code>. Function composition is <code>o</code>.</p>
<div><pre><span></span><code>&gt; <span>&#34;a&#34;</span> <span>x</span> <span>3</span>
<span>aaa</span>
&gt; <span>my</span> <span>&amp;f</span> = <span>&amp;sqrt</span> <span>o</span> <span>&amp;abs</span>
{<span>noise</span>}
&gt; <span>f</span> -<span>3</span>
<span>1.7320508075688772</span>
</code></pre></div>

<p><code>X</code> gives you the cross product of a list, <code>Xf</code> applies <code>f</code> to each element of the cross product, <code>Zf</code> does the same with zip.</p>
<div><pre><span></span><code>&gt; <span>&lt;a b c&gt;</span> <span>X</span> <span>&lt;1 2 3&gt;</span>
((<span>a</span> <span>1</span>) (<span>a</span> <span>2</span>) (<span>a</span> <span>3</span>) (<span>b</span> <span>1</span>) (<span>b</span> <span>2</span>) (<span>b</span> <span>3</span>) (<span>c</span> <span>1</span>) (<span>c</span> <span>2</span>) (<span>c</span> <span>3</span>))
&gt; <span>&lt;a b c&gt;</span> <span>Xx</span> <span>&lt;1 2 3&gt;</span>
(<span>a</span> <span>aa</span> <span>aaa</span> <span>b</span> <span>bb</span> <span>bbb</span> <span>c</span> <span>cc</span> <span>ccc</span>)
&gt; <span>&lt;a b c&gt;</span> <span>Zx</span> <span>&lt;1 2 3&gt;</span>
(<span>a</span> <span>bb</span> <span>ccc</span>)
</code></pre></div>

<p>If <code>f</code> is an infix operator, then <code>[f]</code> reduces a list and <code>[\f]</code> accumulates it: </p>
<div><pre><span></span><code>&gt; [+] <span>&lt;1 2 3 4 5&gt;</span>
<span>15</span>
&gt; [\+] <span>&lt;1 2 3 4 5&gt;</span>
(<span>1</span> <span>3</span> <span>6</span> <span>10</span> <span>15</span>)
</code></pre></div>

<p><code>~~</code> is the &#34;anything goes&#34; matcher.</p>
<div><pre><span></span><code>&gt; <span>&#34;abc&#34;</span> ~~ <span>&#34;abc&#34;</span> <span># do the strings match?</span>
<span>True</span>
&gt; <span>&#34;abc&#34;</span> ~~ <span>Str</span> <span># is abc a string?</span>
<span>True</span>
&gt; <span>&#34;abc&#34;</span> ~~ {.<span>chars</span> == <span>3</span>} <span># is abc length 3?</span>
<span>True</span>
&gt; <span>so</span> <span>&#34;abc&#34;</span> ~~<span> /^b/</span> <span>#does abc start with b?</span>
<span>False</span>
</code></pre></div>

<p>Finally, there&#39;s <code>...</code>.</p>
<div><pre><span></span><code>&gt; <span>0</span>,<span>1</span>,<span>2</span>..<span>.10</span>
(<span>0</span> <span>1</span> <span>2</span> <span>3</span> <span>4</span> <span>5</span> <span>6</span> <span>7</span> <span>8</span> <span>9</span> <span>10</span>)

&gt; <span>0</span>,<span>2</span>,<span>4</span>..<span>.10</span>
(<span>0</span> <span>2</span> <span>4</span> <span>6</span> <span>8</span> <span>10</span>)

&gt; <span>1</span>,<span>2</span>,<span>4</span>..<span>.10</span>
(<span>1</span> <span>2</span> <span>4</span> <span>8</span>)
</code></pre></div>

<h3>Defining operators</h3>
<p>So you know how some languages let you define infix operators? Raku lets you also define new circumfix and <em>postcircumfix</em> operators.</p>
<div><pre><span></span><code><span># circumfix</span>
<span>sub</span> <span>circumfix:</span><span>&lt;[∀ zz&gt;</span>(<span>$inner</span>){<span>sum</span>(<span>$inner</span>)}
&gt; [∀ <span>1</span>,<span>3</span>,<span>5</span>..<span>.10</span> <span>zz</span>
<span>25</span>

<span># vector inner product!</span>
<span>sub</span> <span>postcircumfix:</span><span>&lt;| ⟩&gt;</span>(<span>@left</span>, <span>@inside</span>){[+] (<span>@left</span> <span>Z</span>* <span>@inside</span>)}
&gt; <span>&lt;1 2 3&gt;</span>|<span>&lt;4 5 6&gt;</span>⟩
<span>32</span>
</code></pre></div>

<p>In addition to left- and right-associative infix operators, you can define operators to be chain associative (like how <code>x &lt; y &lt; z</code> is <code>x &lt; y &amp;&amp; y &lt; z</code>) and &#34;list&#34; associative (<code>a op b op c</code> is <code>op(a, b, c)</code>).</p>
<h3>Multiple dispatch</h3>
<p>So Raku has &#34;multiple dispatch&#34;, meaning that you overload a function with multiple different type signatures and it will choose the appropriate one. </p>
<div><pre><span></span><code><span># @ is for iterable types</span>

<span>multi</span> <span>f</span>(<span>$x</span>,<span>@arr</span>) {<span>@arr</span>.<span>map</span>(-&gt; <span>$elem</span> {<span>$elem</span> + <span>$x</span>})}
<span>multi</span> <span>f</span>(<span>@arr</span>, <span>$x</span>) {<span>@arr</span>.<span>map</span>(-&gt; <span>$elem</span> {<span>$elem</span> + <span>$x</span>})}
<span>multi</span> <span>f</span>(<span>@arr1</span>, <span>@arr2</span>) {<span>@arr1</span> <span>Z</span>+ <span>@arr2</span>}

&gt; <span>f</span>(<span>2</span>, <span>&lt;1 2 3&gt;</span>);
(<span>3</span> <span>4</span> <span>5</span>)

&gt; <span>f</span>(<span>&lt;1 2 3&gt;</span>, <span>&lt;3 4 5&gt;</span>)
(<span>4</span> <span>6</span> <span>8</span>)
</code></pre></div>

<p>This isn&#39;t weird, lots of languages have multiple dispatch. What <em>is</em> weird is that you can also dispatch based on a <em>runtime predicate of the value</em>.</p>
<div><pre><span></span><code><span>multi</span> <span>my_abs</span>(<span>Int</span> <span>$x</span> <span>where</span> {<span>$x</span> &gt; <span>0</span>}) {<span>$x</span>}
<span>multi</span> <span>my_abs</span>(<span>Int</span> <span>$x</span>) {-<span>$x</span>}

&gt; <span>map</span> <span>&amp;my_abs</span>, <span>&lt;-4 4&gt;</span>
</code></pre></div>

<p>Also the signature of a function is a first-class value, as are the parameters in the signature.</p>
<h3>Miscellaneous Things</h3>
<ul>
<li>If you define a <code>MAIN</code> function, any parameters you give it will be automatically turned into CLI flags.</li>
<li>Objects have way more preloaded methods than I&#39;ve seen in any language, and I used to do Rails. The <a href="https://docs.raku.org/type/List" target="_blank">List object</a> has methods for getting all permutations, all k-combinations, and all sliding windows.</li>
<li><a href="https://docs.raku.org/type/Junction" target="_blank">Junctions</a> are this weird type-value-thing for doing multiple comparisons at once. <code>1|2</code> expands to <code>any(1, 2)</code>, so <code>1 &lt; 1|2</code>. <code>1&amp;2</code> expands to <code>all(1, 2)</code>, so <code>1 !&lt; 1&amp;2</code>.<ul>
<li>Oh yeah and you can negate any infix operator by prefixing it with <code>!</code>.</li>
</ul>
</li>
<li>Raku is the only language I&#39;ve ever seen that has <code>$kebab-case</code> names <em>and</em> infix subtraction, I&#39;m guessing because sigils disambiguate <code>x-y</code>.</li>
<li>The <a href="https://docs.raku.org/language/regexes" target="_blank">regex syntax</a> isn&#39;t backwards compatible with Perl 5. For <em>thirty years</em> languages followed the PCRE &#34;standard&#34; and Perl 6 just…  threw it all away.</li>
</ul>
<hr/>
<p>That&#39;s just a tiny slice of all the weird Raku features, since I&#39;ve only been looking at calculator applications so far. I haven&#39;t even learned about the object system, packages, or <a href="https://docs.raku.org/language/grammar_tutorial" target="_blank">grammars</a>! And even so, I <em>still</em> left out a ton of stuff. Like in a function body, <code>samewith</code> will call the same function with new arguments.</p>
<p>I think if I had to maintain a Raku legacy codebase my brain would explode. I have no idea how people would manage to write this language In The Large. At the same time, it seems incredible for programming In The Small. One-off scripts, computations, personal tooling, all the kinds of things I wanted to do with it in the first place.</p>
<p>I&#39;ve also seen some really frustrating things:</p>
<ol>
<li>The documentation is really poor and the heavy reliance on symbols makes it hard to search for things. I&#39;ve learned a lot of poorly-documented languages but Raku is much bigger and more complex than any of them and it can be real demotivating.</li>
<li>The REPL crashes on Windows if I type in any Unicode. The compiler is also pretty slow, with even small files taking half a second or more. Iterating on things is painful.</li>
<li>I hate the sigil thing. I spent half an hour debugging a problem because I wrote <code>$x</code> instead of <code>@x</code>.</li>
</ol>
<p>Overall? Maybe I&#39;m just a gremlin at heart, but I think I like this language and want it to succeed. I assume I&#39;ll have a more balanced picture thoughts after I use it in anger. I just hope that over time the compile times and documentation improve.</p>

                    
                

                
                    <p><em>If you&#39;re reading this on the web, you can subscribe <a href="https://buttondown.email/hillelwayne" target="_blank">here</a>. Updates are 6x a month. My main website is <a href="https://www.hillelwayne.com" target="_blank">here</a>.</em></p>
                
            </div></div>
  </body>
</html>
