<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lcat.dev/post.php?id=3cf8e1b9-e5e3-4a6d-af27-12720c5b2d54">Original</a>
    <h1>How to Bypass WhatsApp Web&#39;s Locked Chat Feature</h1>
    
    <div id="readability-page-1" class="page"><div>
                




<pre id="content">I discovered that WhatsApp&#39;s feature to lock/hide chats is quite
secure -&gt; the key or secret code is not easily recoverable as it
is encrypted. But, **the chats are actually not encrypted
with the secret code**. That means, the secret code feature is just
a front-end security control mechanism that can easily be bypassed.
This may sound like bruteforcing Netflix&#39;s profile PIN which may
be useless, but it actually serves an interesting use case. Let&#39;s say
that the locked chat contains a very important information, but you
forgot your secret code and you don&#39;t have access to your phone.
Unfortunately, without the secret key, or a normal way to unlock the chats,
WhatsApp will erase those chats. So, your options may be: (1) try
to bypass the lock mechanism, or (2) find the secret code hash and crack it.

### Discovery

I went to the Developer Tools&#39; Sources tab, and search for interesting 
strings like &#34;secretCode&#34;, &#34;validateSecretCode&#34;, etc. Then, set a
breakpoint on some interesting lines. This way, I can dissect the variable contents
at runtime via the debugger, including the hashed secret code.

### Location of Secret Code Hash

Aside from using the debugger, the hashed secret code is also stored in the `localStorage`.
Look for something with the following value:

```
{\&#34;transformer\&#34;:1,\&#34;encoding\&#34;:0,\&#34;iterations\&#34;:10000,\&#34;salt\&#34;:\&#34;bnUhR7dM70MxxxxxB0u4PA==\&#34;,\&#34;data\&#34;:\&#34;uO3dHQYxxxxxxxxcGBxb21dEQ1jjCcPOJcSrBO+31TQP/p/SjNWU4t5P6WIQXCIH8MdirWsutoUhLIxOWN2tA==\&#34;}&#34;
```

It&#39;s hashed using PBKDF2 ([this may be interesting](https://github.com/wppconnect-team/wa-proto/blob/48d0c1bf8f8c7c2a8c6eca903d3b6ed7e8793899/WAProto.proto#L3649)).

```
import json
from passlib.hash import pbkdf2_sha512

# from localStorage
p = &#39;{&#34;transformer&#34;:1,&#34;encoding&#34;:0,&#34;iterations&#34;:10000,&#34;salt&#34;:&#34;bnUhR7dM70MF8tNfB0u4PA==&#34;,&#34;data&#34;:&#34;uO3dHQYZ1RiQwbaNcGBxb21dEQ1jjCcPOJcSrBO+31TQP/p/SjNWU4t5P6WIQXCIH8MdirWsutoUhLIxOWN2tA==&#34;}&#39;
p = json.loads(p)

# $pbkdf2-digest$rounds$salt$checksum
h = f&#39;$pbkdf2-sha512${p[&#34;iterations&#34;]}${p[&#34;salt&#34;].strip(&#34;=&#34;)}${p[&#34;data&#34;].strip(&#34;=&#34;)}&#39;
assert pbkdf2_sha512.verify(&#34;hehe&#34;, h) is True
```

### Bypassing Secret Code Check

In the Sources tab, find a file with the following content:

```
d(&#34;WAWebCmd&#34;).Cmd.trigger(&#34;chatlock:unlock&#34;));
```

It should be inside the body of an `if` statement. Set a breakpoint on the `if` statement.
The `if` statement should look like `if (yield o(a)) {`. Now, try to enter a wrong secret
in the secret code pop-up form, it should hit the breakpoint. In the console, modify `o`
to return `Promise.resolve(1)`.

```o = () =&gt; Promise.resolve(1)```

Then, let the debugger continue. And.. voila! Your locked chats are now unlocked.


&lt;small&gt;Sorry for the bad English. English is not my first language + I am too sleepy to
think much about grammatical correctness&lt;/small&gt;</pre>


<small>
    Created: 2024-12-06 19:04:12, Updated: 2024-12-06 19:29:07, ID: 3cf8e1b9-e5e3-4a6d-af27-12720c5b2d54</small>


    </div></div>
  </body>
</html>
