<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://javalin.io/news/javalin-5.0.0-stable.html">Original</a>
    <h1>Show HN: I finished v5 of a JVM framework I&#39;ve spent spent half a decade making</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
        <h2 id="foreword">Foreword</h2>
<p>Javalin is a Java and Kotlin web framework which focuses on simplicity and Java/Kotlin interoperability.
It supports WebSockets and HTTP3, and it uses Virtual Threads (“Project Loom”) by default.
Javalin aims to be very lightweight and has a codebase of around 7000 lines of Java/Kotlin code,
as well as around 10 000 lines of test (629 tests).</p>

<p>I’d like to extend my special thanks to one of our newer contributors, <a href="https://github.com/dzikoysk">@dzikoysk</a>,
who has been very helpful in getting v5 ready. Thank you, your contributions have given me a lot of motivation!</p>

<p><strong>Okay, let’s have a look at Javalin 5!</strong></p>

<h2 id="hello-javalin-world">Hello Javalin World</h2>
<p>Javalin’s main goal is simplicity and developer productivity.
The “Hello World” example reflects that:</p>

<div data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div><div><pre><code><span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[]</span> <span>args</span><span>)</span> <span>{</span>
    <span>var</span> <span>app</span> <span>=</span> <span>Javalin</span><span>.</span><span>create</span><span>(</span><span>/*config*/</span><span>)</span>
        <span>.</span><span>get</span><span>(</span><span>&#34;/&#34;</span><span>,</span> <span>ctx</span> <span>-&gt;</span> <span>ctx</span><span>.</span><span>result</span><span>(</span><span>&#34;Hello World&#34;</span><span>))</span>
        <span>.</span><span>start</span><span>(</span><span>7070</span><span>);</span>
<span>}</span>
</code></pre></div>    </div>
  </div>
<div data-tab="2">
    <div><div><pre><code><span>fun</span> <span>main</span><span>()</span> <span>{</span>
    <span>val</span> <span>app</span> <span>=</span> <span>Javalin</span><span>.</span><span>create</span><span>(</span><span>/*config*/</span><span>)</span>
        <span>.</span><span>get</span><span>(</span><span>&#34;/&#34;</span><span>)</span> <span>{</span> <span>ctx</span> <span>-&gt;</span> <span>ctx</span><span>.</span><span>result</span><span>(</span><span>&#34;Hello World&#34;</span><span>)</span> <span>}</span>
        <span>.</span><span>start</span><span>(</span><span>7070</span><span>)</span>
<span>}</span>
</code></pre></div>    </div>
  </div>
</div>

<h2 id="sending-data-to-clients">Sending data to clients</h2>
<p>The simplest way to send content to a client is through
<code>ctx.result(&#34;My String&#34;)</code>, which sends a <code>text/plain</code> result.
Javalin has several options for sending responses:</p>

<div data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div><div><pre><code><span>ctx</span><span>.</span><span>result</span><span>(</span><span>stringOrStream</span><span>));</span>           <span>// writes string or input stream to client (`text/plain` by default)</span>
<span>ctx</span><span>.</span><span>json</span><span>(</span><span>myJson</span><span>));</span>                     <span>// serializes object to JSON string and writes to client (as `application/json`)</span>
<span>ctx</span><span>.</span><span>jsonStream</span><span>(</span><span>myJson</span><span>));</span>               <span>// serializes JSON directly to client (nothing buffered in memory)</span>
<span>ctx</span><span>.</span><span>writeSeekableStream</span><span>(</span><span>myMediaFile</span><span>));</span> <span>// stream audio and video to client (supports seeking/skipping)</span>
<span>ctx</span><span>.</span><span>future</span><span>(</span><span>myFutureSupplier</span><span>);</span>          <span>// instructs Javalin to handle request asynchronously</span>
<span>ctx</span><span>.</span><span>render</span><span>(</span><span>&#34;/file.ext&#34;</span><span>,</span> <span>model</span><span>));</span>       <span>// render template or markdown file (as `text/html`)</span>
</code></pre></div>    </div>
  </div>
<div data-tab="2">
    <div><div><pre><code><span>ctx</span><span>.</span><span>result</span><span>(</span><span>stringOrStream</span><span>))</span>            <span>// writes string or input stream to client (`text/plain` by default)</span>
<span>ctx</span><span>.</span><span>json</span><span>(</span><span>myJson</span><span>))</span>                      <span>// serializes object to JSON string and writes to client (as `application/json`)</span>
<span>ctx</span><span>.</span><span>jsonStream</span><span>(</span><span>myJson</span><span>));</span>               <span>// serializes JSON directly to client (nothing buffered in memory)</span>
<span>ctx</span><span>.</span><span>writeSeekableStream</span><span>(</span><span>myMediaFile</span><span>))</span>  <span>// stream audio and video to client (supports seeking/skipping)</span>
<span>ctx</span><span>.</span><span>future</span><span>(</span><span>myFutureSupplier</span><span>)</span>           <span>// instructs Javalin to handle request asynchronously</span>
<span>ctx</span><span>.</span><span>render</span><span>(</span><span>&#34;/file.ext&#34;</span><span>,</span> <span>model</span><span>))</span>        <span>// render template or markdown file (as `text/html`)</span>
</code></pre></div>    </div>
  </div>
</div>

<h2 id="handling-input-from-clients">Handling input from clients</h2>
<p>Javalin makes it easy to extract and validate client data through dedicated methods:</p>

<div data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div><div><pre><code><span>ctx</span><span>.</span><span>body</span><span>();</span>                     <span>// get the request body as a string (caches the body)</span>
<span>ctx</span><span>.</span><span>formParam</span><span>(</span><span>&#34;name&#34;</span><span>);</span>          <span>// get a form parameter</span>
<span>ctx</span><span>.</span><span>queryParam</span><span>(</span><span>&#34;name&#34;</span><span>);</span>         <span>// get a query parameter</span>
<span>ctx</span><span>.</span><span>uploadedFile</span><span>(</span><span>&#34;name&#34;</span><span>);</span>       <span>// get an uploaded file</span>

<span>// JSON methods</span>
<span>ctx</span><span>.</span><span>bodyAsClass</span><span>(</span><span>Clazz</span><span>);</span>         <span>// deserialize ctx.body() to class</span>
<span>ctx</span><span>.</span><span>bodyStreamAsClass</span><span>(</span><span>Clazz</span><span>);</span>   <span>// consume input stream from request body and deserialize to class</span>

<span>// validation</span>
<span>var</span> <span>age</span> <span>=</span> <span>ctx</span><span>.</span><span>queryParamAsClass</span><span>(</span><span>&#34;age&#34;</span><span>,</span> <span>Integer</span><span>.</span><span>class</span><span>)</span>  <span>// wraps parameter in Validator</span>
    <span>.</span><span>check</span><span>(</span><span>age</span> <span>-&gt;</span> <span>age</span> <span>&gt;</span> <span>18</span><span>,</span> <span>&#34;NOT_OLD_ENOUGH&#34;</span><span>)</span> <span>// adds check with error message</span>
    <span>.</span><span>get</span><span>();</span> <span>// gets the validated value, or throws ValidationException</span>
<span>var</span> <span>bananaBox</span> <span>=</span> <span>ctx</span><span>.</span><span>bodyValidator</span><span>(</span><span>BananaBox</span><span>.</span><span>class</span><span>)</span>
    <span>.</span><span>check</span><span>(</span><span>box</span> <span>-&gt;</span> <span>box</span><span>.</span><span>weight</span> <span>&lt;</span> <span>5</span><span>,</span> <span>ValidationError</span><span>(</span><span>&#34;WEIGHT_TOO_HIGH&#34;</span><span>,</span> <span>Map</span><span>.</span><span>of</span><span>(</span><span>&#34;MAX_WEIGHT&#34;</span><span>,</span> <span>5</span><span>)))</span>
    <span>.</span><span>check</span><span>(</span><span>box</span> <span>-&gt;</span> <span>box</span><span>.</span><span>bananas</span><span>.</span><span>length</span> <span>&gt;</span> <span>20</span><span>,</span> <span>ValidationError</span><span>(</span><span>&#34;NOT_ENOUGH_BANANAS&#34;</span><span>,</span> <span>Map</span><span>.</span><span>of</span><span>(</span><span>&#34;MIN_BANANAS&#34;</span><span>,</span> <span>20</span><span>)))</span>
    <span>.</span><span>getOrDefault</span><span>(</span><span>defaultBananaBox</span><span>)</span> <span>// uses default if body is null, runs validation rules otherwise</span>
</code></pre></div>    </div>
  </div>
<div data-tab="2">
    <div><div><pre><code><span>ctx</span><span>.</span><span>body</span><span>()</span>                      <span>// get the request body as a string (caches the body)</span>
<span>ctx</span><span>.</span><span>formParam</span><span>(</span><span>&#34;name&#34;</span><span>)</span>           <span>// get a form parameter</span>
<span>ctx</span><span>.</span><span>queryParam</span><span>(</span><span>&#34;name&#34;</span><span>)</span>          <span>// get a query parameter</span>
<span>ctx</span><span>.</span><span>uploadedFile</span><span>(</span><span>&#34;name&#34;</span><span>)</span>        <span>// get an uploaded file</span>

<span>// JSON methods</span>
<span>ctx</span><span>.</span><span>bodyAsClass</span><span>&lt;</span><span>Clazz</span><span>&gt;()</span>        <span>// deserialize ctx.body() to class</span>
<span>ctx</span><span>.</span><span>bodyStreamAsClass</span><span>&lt;</span><span>Clazz</span><span>&gt;()</span>  <span>// consume input stream from request body and deserialize to class</span>

<span>// validation</span>
<span>val</span> <span>age</span> <span>=</span> <span>ctx</span><span>.</span><span>queryParamAsClass</span><span>&lt;</span><span>Int</span><span>&gt;(</span><span>&#34;age&#34;</span><span>)</span>  <span>// wraps parameter in Validator</span>
    <span>.</span><span>check</span><span>({</span> <span>it</span> <span>&gt;</span> <span>18</span> <span>},</span> <span>&#34;NOT_OLD_ENOUGH&#34;</span><span>)</span> <span>// adds check with error message</span>
    <span>.</span><span>get</span><span>()</span> <span>// gets the validated value, or throws ValidationException</span>
<span>val</span> <span>bananaBox</span> <span>=</span> <span>ctx</span><span>.</span><span>bodyValidator</span><span>&lt;</span><span>BananaBox</span><span>&gt;()</span>
    <span>.</span><span>check</span><span>({</span> <span>it</span><span>.</span><span>weight</span> <span>&lt;</span> <span>5</span> <span>},</span> <span>ValidationError</span><span>(</span><span>&#34;WEIGHT_TOO_HIGH&#34;</span><span>,</span> <span>mapOf</span><span>(</span><span>&#34;MAX_WEIGHT&#34;</span> <span>to</span> <span>5</span><span>)))</span>
    <span>.</span><span>check</span><span>({</span> <span>it</span><span>.</span><span>bananas</span><span>.</span><span>length</span> <span>&gt;</span> <span>20</span> <span>},</span> <span>ValidationError</span><span>(</span><span>&#34;NOT_ENOUGH_BANANAS&#34;</span><span>,</span> <span>mapOf</span><span>(</span><span>&#34;MIN_BANANAS&#34;</span> <span>to</span> <span>20</span><span>)))</span>
    <span>.</span><span>getOrDefault</span><span>(</span><span>defaultBananaBox</span><span>)</span> <span>// uses default if body is null, runs validation rules otherwise</span>
</code></pre></div>    </div>
  </div>
</div>

<h2 id="websockets-and-server-sent-events">WebSockets and Server-Sent Events</h2>
<p>WebSockets and Server-Sent Events are handled with lambdas,
similar to most of Javalin’s other APIs:</p>

<div data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div><div><pre><code><span>app</span><span>.</span><span>ws</span><span>(</span><span>&#34;/websocket/{path}&#34;</span><span>,</span> <span>ws</span> <span>-&gt;</span> <span>{</span>
    <span>ws</span><span>.</span><span>onConnect</span><span>(</span><span>ctx</span> <span>-&gt;</span> <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span>&#34;Connected&#34;</span><span>));</span>
    <span>ws</span><span>.</span><span>onMessage</span><span>(</span><span>ctx</span> <span>-&gt;</span> <span>{</span>
        <span>User</span> <span>user</span> <span>=</span> <span>ctx</span><span>.</span><span>messageAsClass</span><span>(</span><span>User</span><span>.</span><span>class</span><span>);</span> <span>// convert from json</span>
        <span>ctx</span><span>.</span><span>send</span><span>(</span><span>user</span><span>);</span> <span>// convert to json and send back</span>
    <span>});</span>
    <span>ws</span><span>.</span><span>onBinaryMessage</span><span>(</span><span>ctx</span> <span>-&gt;</span> <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span>&#34;Message&#34;</span><span>))</span>
    <span>ws</span><span>.</span><span>onClose</span><span>(</span><span>ctx</span> <span>-&gt;</span> <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span>&#34;Closed&#34;</span><span>));</span>
    <span>ws</span><span>.</span><span>onError</span><span>(</span><span>ctx</span> <span>-&gt;</span> <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span>&#34;Errored&#34;</span><span>));</span>
<span>});</span>

<span>app</span><span>.</span><span>sse</span><span>(</span><span>&#34;/sse&#34;</span><span>,</span> <span>client</span> <span>-&gt;</span>
    <span>client</span><span>.</span><span>sendEvent</span><span>(</span><span>&#34;connected&#34;</span><span>,</span> <span>&#34;Hello, SSE&#34;</span><span>);</span>  <span>// can also send an object, which will be serialized</span>
    <span>client</span><span>.</span><span>onClose</span><span>(()</span> <span>-&gt;</span> <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span>&#34;Client disconnected&#34;</span><span>));</span>
<span>});</span>
</code></pre></div>    </div>
  </div>
<div data-tab="2">
    <div><div><pre><code><span>app</span><span>.</span><span>ws</span><span>(</span><span>&#34;/websocket/{path}&#34;</span><span>)</span> <span>{</span> <span>ws</span> <span>-&gt;</span>
    <span>ws</span><span>.</span><span>onConnect</span> <span>{</span> <span>ctx</span> <span>-&gt;</span> <span>println</span><span>(</span><span>&#34;Connected&#34;</span><span>)</span> <span>}</span>
    <span>ws</span><span>.</span><span>onMessage</span> <span>{</span> <span>ctx</span> <span>-&gt;</span>
        <span>val</span> <span>user</span> <span>=</span> <span>ctx</span><span>.</span><span>messageAsClass</span><span>&lt;</span><span>User</span><span>&gt;();</span> <span>// convert from json</span>
        <span>ctx</span><span>.</span><span>send</span><span>(</span><span>user</span><span>);</span> <span>// convert to json and send back</span>
    <span>}</span>
    <span>ws</span><span>.</span><span>onBinaryMessage</span> <span>{</span> <span>ctx</span> <span>-&gt;</span> <span>println</span><span>(</span><span>&#34;Message&#34;</span><span>)</span> <span>}</span>
    <span>ws</span><span>.</span><span>onClose</span> <span>{</span> <span>ctx</span> <span>-&gt;</span> <span>println</span><span>(</span><span>&#34;Closed&#34;</span><span>)</span> <span>}</span>
    <span>ws</span><span>.</span><span>onError</span> <span>{</span> <span>ctx</span> <span>-&gt;</span> <span>println</span><span>(</span><span>&#34;Errored&#34;</span><span>)</span> <span>}</span>
<span>}</span>

<span>app</span><span>.</span><span>sse</span><span>(</span><span>&#34;/sse&#34;</span><span>)</span> <span>{</span> <span>client</span> <span>-&gt;</span>
    <span>client</span><span>.</span><span>sendEvent</span><span>(</span><span>&#34;connected&#34;</span><span>,</span> <span>&#34;Hello, SSE&#34;</span><span>)</span> <span>// can also send an object, which will be serialized</span>
    <span>client</span><span>.</span><span>onClose</span> <span>{</span> <span>println</span><span>(</span><span>&#34;Client disconnected&#34;</span><span>)</span> <span>}</span>
<span>}</span>
</code></pre></div>    </div>
  </div>
</div>

<h2 id="routing-and-request-lifecycle">Routing and request lifecycle</h2>
<p>Routing in Javalin can either happen directly on the <code>Javalin</code> instance (usually named <code>app</code>),
or through a set of util-methods which improves readability. Please note that these util-method
do not hold any global state, but function as normal util-methods (<code>Util.method(app, ...)</code>) with a fancy syntax.</p>

<div data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div><div><pre><code><span>import</span> <span>static</span> <span>io</span><span>.</span><span>javalin</span><span>.</span><span>apibuilder</span><span>.</span><span>ApiBuilder</span><span>.*</span>
<span>...</span>
<span>app</span><span>.</span><span>routes</span><span>(()</span> <span>-&gt;</span> <span>{</span>
    <span>before</span><span>(</span><span>GlobalController:</span><span>:</span><span>globalAction</span><span>)</span>               <span>// handler that runs for every request to the app</span>
    <span>path</span><span>(</span><span>&#34;users&#34;</span><span>,</span> <span>()</span> <span>-&gt;</span> <span>{</span>                                <span>// push subpath /users on the router</span>
        <span>get</span><span>(</span><span>UserController:</span><span>:</span><span>getAll</span><span>);</span>                     <span>// get controller for /users/</span>
        <span>post</span><span>(</span><span>UserController:</span><span>:</span><span>create</span><span>);</span>                    <span>// post controller for /users/</span>
        <span>before</span><span>(</span><span>&#34;{userId}*&#34;</span><span>,</span> <span>UserController:</span><span>userIdCheck</span><span>);</span> <span>// handler that runs for every request to /users/{userId} as well as al subpaths</span>
        <span>path</span><span>(</span><span>&#34;{userId}&#34;</span><span>,</span> <span>(()</span> <span>-&gt;</span> <span>{</span>                        <span>// new subpath /{userId} on the router</span>
            <span>get</span><span>(</span><span>UserController:</span><span>:</span><span>getOne</span><span>);</span>                 <span>// get controller for /users/{userId}</span>
            <span>patch</span><span>(</span><span>UserController:</span><span>:</span><span>update</span><span>);</span>               <span>// patch controller for /users/{userId}</span>
            <span>path</span><span>(</span><span>&#34;subpath&#34;</span><span>,</span> <span>(()</span> <span>-&gt;</span> <span>{</span> <span>...</span> <span>});</span>             <span>// push subpath /subpath on the router (and pop it immediately)</span>
        <span>});</span>                                              <span>// pop subpath /{userId} on the router</span>
        <span>ws</span><span>(</span><span>&#34;events&#34;</span><span>,</span> <span>UserController:</span><span>:</span><span>webSocketEvents</span><span>);</span>   <span>// websocket controller for /users/events</span>
    <span>});</span>                                                  <span>// pop subpath /users on the router</span>
<span>}).</span><span>start</span><span>(</span><span>port</span><span>);</span>
</code></pre></div>    </div>
  </div>
<div data-tab="2">
    <div><div><pre><code><span>import</span> <span>static</span> <span>io</span><span>.</span><span>javalin</span><span>.</span><span>apibuilder</span><span>.</span><span>ApiBuilder</span><span>.*</span>
<span>..</span><span>.</span>
<span>app</span><span>.</span><span>routes</span> <span>{</span>
    <span>before</span><span>(</span><span>GlobalController</span><span>::</span><span>globalAction</span><span>)</span>               <span>// handler that runs for every request to the app</span>
    <span>path</span><span>(</span><span>&#34;users&#34;</span><span>)</span> <span>{</span>                                      <span>// push subpath /users on the router</span>
        <span>get</span><span>(</span><span>UserController</span><span>::</span><span>getAll</span><span>)</span>                      <span>// get controller for /users/</span>
        <span>post</span><span>(</span><span>UserController</span><span>::</span><span>create</span><span>)</span>                     <span>// post controller for /users/</span>
        <span>before</span><span>(</span><span>&#34;{userId}*&#34;</span><span>,</span> <span>UserController</span><span>:</span><span>userIdCheck</span><span>)</span>  <span>// handler that runs for every request to /users/{userId} as well as al subpaths</span>
        <span>path</span><span>(</span><span>&#34;{userId}&#34;</span><span>)</span> <span>{</span>                               <span>// new subpath /{userId} on the router</span>
            <span>get</span><span>(</span><span>UserController</span><span>::</span><span>getOne</span><span>)</span>                  <span>// get controller for /users/{userId}</span>
            <span>patch</span><span>(</span><span>UserController</span><span>::</span><span>update</span><span>)</span>                <span>// patch controller for /users/{userId}</span>
            <span>path</span><span>(</span><span>&#34;subpath&#34;</span><span>)</span> <span>{</span> <span>..</span><span>.</span> <span>}</span>                      <span>// push subpath /subpath on the router (and pop it immediately)</span>
        <span>}</span>                                                <span>// pop subpath /{userId} on the router</span>
        <span>ws</span><span>(</span><span>&#34;events&#34;</span><span>,</span> <span>UserController</span><span>::</span><span>webSocketEvents</span><span>)</span>    <span>// websocket controller for /users/events</span>
    <span>}</span>                                                    <span>// pop subpath /users on the router</span>
<span>}.</span><span>start</span><span>(</span><span>port</span><span>)</span>
</code></pre></div>    </div>
  </div>
</div>

<h3 id="request-lifecycle">Request lifecycle</h3>
<p>The Javalin request lifecycle is pretty straightforward.
The following snippet covers every place you can hook into:</p>
<div><div><pre><code><span>Javalin</span><span>#</span><span>before</span>              <span>// runs first, can throw exception (which will skip any endpoint handlers)</span>
<span>Config</span><span>#</span><span>accessManager</span>        <span>// can be configured to run before endpoints (get/post/patch/etc)</span>
<span>Javalin</span><span>#</span><span>get</span><span>/</span><span>post</span><span>/</span><span>patch</span><span>/</span><span>etc</span>  <span>// runs second, can throw exception</span>
<span>Javalin</span><span>#</span><span>after</span>               <span>// runs third, can throw exception</span>
<span>Javalin</span><span>#</span><span>error</span>               <span>// runs fourth, can throw exception</span>
<span>Javalin</span><span>#</span><span>exception</span>           <span>// runs any time a handler throws (cannot throw exception)</span>
<span>Config</span><span>#</span><span>requestLogger</span>        <span>// runs after response is written to client</span>
</code></pre></div></div>

<h2 id="configuring-javalin">Configuring Javalin</h2>
<p>To configure Javalin, you can adjust the <code>JavalinConfig</code> using a <code>Consumer</code> in the <code>Javalin#create</code> method:</p>

<div data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div><div><pre><code><span>var</span> <span>app</span> <span>=</span> <span>Javalin</span><span>.</span><span>create</span><span>(</span><span>config</span> <span>-&gt;</span> <span>{</span>
    <span>config</span><span>.</span><span>http</span><span>.</span><span>generateEtags</span> <span>=</span> <span>true</span><span>;</span>
    <span>config</span><span>.</span><span>http</span><span>.</span><span>asyncTimeout</span> <span>=</span> <span>10_000L</span><span>;</span>
    <span>config</span><span>.</span><span>routing</span><span>.</span><span>ignoreTrailingSlashes</span> <span>=</span> <span>true</span><span>;</span>
    <span>config</span><span>.</span><span>staticFiles</span><span>.</span><span>add</span><span>(</span><span>&#34;/public&#34;</span><span>,</span> <span>Location</span><span>.</span><span>CLASSPATH</span><span>);</span>
<span>});</span>
</code></pre></div>    </div>
  </div>
<div data-tab="2">
    <div><div><pre><code><span>val</span> <span>app</span> <span>=</span> <span>Javalin</span><span>.</span><span>create</span> <span>{</span> <span>config</span> <span>-&gt;</span>
    <span>config</span><span>.</span><span>http</span><span>.</span><span>generateEtags</span> <span>=</span> <span>true</span>
    <span>config</span><span>.</span><span>http</span><span>.</span><span>asyncTimeout</span> <span>=</span> <span>10_000L</span>
    <span>config</span><span>.</span><span>routing</span><span>.</span><span>ignoreTrailingSlashes</span> <span>=</span> <span>true</span>
    <span>config</span><span>.</span><span>staticFiles</span><span>.</span><span>add</span><span>(</span><span>&#34;/public&#34;</span><span>,</span> <span>Location</span><span>.</span><span>CLASSPATH</span><span>)</span>
<span>};</span>
</code></pre></div>    </div>
  </div>
</div>

<h2 id="configuring-jetty">Configuring Jetty</h2>
<p>Javalin is built on top of Jetty, and unlike many other web frameworks
it doesn’t try to make this a loose coupling. This gives you access to many nice features that
are only available in Jetty:</p>

<div data-tab="1">
<ul>
    <li data-tab="1">Java</li>
    <li data-tab="2">Kotlin</li>
</ul>
<div data-tab="1">
    <div><div><pre><code><span>var</span> <span>app</span> <span>=</span> <span>Javalin</span><span>.</span><span>create</span><span>(</span><span>config</span> <span>-&gt;</span> <span>{</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>server</span><span>(()</span> <span>-&gt;</span> <span>Server</span><span>());</span>                 <span>// set the Jetty Server</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>sessionHandler</span><span>(()</span> <span>-&gt;</span> <span>SessionHandler</span><span>());</span> <span>// set the Jetty SessionHandler</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>contextHandlerConfig</span><span>(</span><span>handler</span> <span>-&gt;</span> <span>{});</span>    <span>// configure the Jetty ServletContextHandler</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>wsFactoryConfig</span><span>((</span><span>factory</span><span>)</span> <span>-&gt;</span> <span>{});</span>       <span>// configure the Jetty WebSocketServletFactory</span>
<span>});</span>
</code></pre></div>    </div>
  </div>
<div data-tab="2">
    <div><div><pre><code><span>val</span> <span>app</span> <span>=</span> <span>Javalin</span><span>.</span><span>create</span> <span>{</span> <span>config</span> <span>-&gt;</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>server</span> <span>{</span> <span>Server</span><span>()</span> <span>}</span>                 <span>// set the Jetty Server</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>sessionHandler</span> <span>{</span> <span>SessionHandler</span><span>()</span> <span>}</span> <span>// set the Jetty SessionHandler</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>contextHandlerConfig</span> <span>{</span> <span>handler</span> <span>-&gt;</span> <span>}</span> <span>// configure the Jetty ServletContextHandler</span>
    <span>config</span><span>.</span><span>jetty</span><span>.</span><span>wsFactoryConfig</span> <span>{</span> <span>factory</span> <span>-&gt;</span> <span>}</span>      <span>// configure the Jetty WebSocketServletFactory</span>
<span>}</span>
</code></pre></div>    </div>
  </div>
</div>

<p>Session handling is a particularly useful Jetty feature, as can be seen in
<a href="https://javalin.io/tutorials/jetty-session-handling">/tutorials/jetty-session-handling</a>.</p>

<h2 id="plugins">Plugins</h2>
<p>There are many third-party open-source plugins available for Javalin, and as of Javalin 5
we’re launching a plugin “marketplace” on <a href="https://javalin.io/plugins">javalin.io/plugins</a>.</p>

<h3 id="openapi-support">OpenAPI support</h3>
<p>One of the most popular Javalin plugins is its OpenAPI integration:</p>

<div><div><pre><code><span>@OpenApi</span><span>(</span>
    <span>path</span> <span>=</span> <span>&#34;/api/v1/users&#34;</span><span>,</span>
    <span>methods</span> <span>=</span> <span>[</span><span>HttpMethod</span><span>.</span><span>POST</span><span>],</span>
    <span>summary</span> <span>=</span> <span>&#34;Register a user&#34;</span><span>,</span>
    <span>tags</span> <span>=</span> <span>[</span><span>&#34;Users&#34;</span><span>],</span>
    <span>requestBody</span> <span>=</span> <span>OpenApiRequestBody</span><span>(</span>
        <span>content</span> <span>=</span> <span>[</span><span>OpenApiContent</span><span>(</span><span>RegistrationRequest</span><span>::</span><span>class</span><span>)],</span>
        <span>required</span> <span>=</span> <span>true</span><span>,</span>
        <span>description</span> <span>=</span> <span>&#34;Data about the user&#34;</span>
    <span>),</span>
    <span>responses</span> <span>=</span> <span>[</span>
        <span>OpenApiResponse</span><span>(</span><span>status</span> <span>=</span> <span>&#34;200&#34;</span><span>,</span> <span>..</span><span>.),</span>
        <span>OpenApiResponse</span><span>(</span><span>status</span> <span>=</span> <span>&#34;401&#34;</span><span>,</span> <span>..</span><span>.),</span>
    <span>]</span>
<span>)</span>
<span>fun</span> <span>register</span><span>(</span><span>context</span><span>:</span> <span>Context</span><span>)</span> <span>{</span>
    <span>// handler code goes here</span>
<span>}</span>
</code></pre></div></div>

<h2 id="whats-changed-since-javalin-4">What’s changed since Javalin 4</h2>
<p>The biggest change is that Javalin no longer works with Java 8.
We have moved to Jetty 11, which requires Java 11. We’ve also restructured a bit,
reworked configuration and futures,  split out some of the modules into
separate Maven artifacts, and fixed one or two bugs.</p>

<p>You can read more in the migration guide: <a href="https://javalin.io/migration-guide-javalin-4-to-5">/migration-guide-javalin-4-to-5</a>.</p>

<h3 id="get-involved">Get involved</h3>
<p>If you want to contribute to the project, please head over to
<a href="https://github.com/tipsy/javalin">GitHub</a> or <a href="https://discord.com/invite/sgak4e5NKv">Discord</a>.</p>

<p>If you want to stay up to date, please follow us on <a href="https://twitter.com/javalin_io">Twitter</a>.</p>

    </div></div>
  </body>
</html>
