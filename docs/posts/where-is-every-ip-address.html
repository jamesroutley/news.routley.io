<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tech.marksblogg.com/where-are-ip-addresses-ipinfo.html">Original</a>
    <h1>Where is every IP Address?</h1>
    
    <div id="readability-page-1" class="page"><div id="article_text">
            <p><a href="https://ipinfo.io/">IPinfo</a> builds and sells IPv4 and IPv6 address metadata. This is available either by API, file download or as a <a href="https://www.snowflake.com/datasets/ipinfo-ip-geolocation/">Snowflake</a> dataset. When you present an IP address, it&#39;ll offer that IP&#39;s physical location and ownership information. You can also see if it&#39;s used as a VPN or Tor endpoint, is owned by a hosting company and which domain names have been pointed at it.</p>
<p>For example, this site&#39;s IPv4 address <a href="https://ipinfo.io/146.185.174.209">146.185.174.209</a> is listed as being owned by Digital Ocean, a hosting company, and is located in their data centre in Amsterdam with the domain marksblogg.com pointed at it.</p>
<div><pre><span></span>$ curl -S ipinfo.io/146.185.174.209?token<span>=</span>obscured
</pre></div>
<div><pre><span></span><span>{</span>
  <span>&#34;ip&#34;</span><span>:</span> <span>&#34;146.185.174.209&#34;</span><span>,</span>
  <span>&#34;hostname&#34;</span><span>:</span> <span>&#34;www.marksblogg.com&#34;</span><span>,</span>
  <span>&#34;city&#34;</span><span>:</span> <span>&#34;Amsterdam&#34;</span><span>,</span>
  <span>&#34;region&#34;</span><span>:</span> <span>&#34;North Holland&#34;</span><span>,</span>
  <span>&#34;country&#34;</span><span>:</span> <span>&#34;NL&#34;</span><span>,</span>
  <span>&#34;loc&#34;</span><span>:</span> <span>&#34;52.3740,4.8897&#34;</span><span>,</span>
  <span>&#34;org&#34;</span><span>:</span> <span>&#34;AS14061 DigitalOcean, LLC&#34;</span><span>,</span>
  <span>&#34;postal&#34;</span><span>:</span> <span>&#34;1012&#34;</span><span>,</span>
  <span>&#34;timezone&#34;</span><span>:</span> <span>&#34;Europe/Amsterdam&#34;</span><span>,</span>
  <span>&#34;asn&#34;</span><span>:</span> <span>{</span>
    <span>&#34;asn&#34;</span><span>:</span> <span>&#34;AS14061&#34;</span><span>,</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;DigitalOcean, LLC&#34;</span><span>,</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;digitalocean.com&#34;</span><span>,</span>
    <span>&#34;route&#34;</span><span>:</span> <span>&#34;146.185.160.0/20&#34;</span><span>,</span>
    <span>&#34;type&#34;</span><span>:</span> <span>&#34;hosting&#34;</span>
  <span>},</span>
  <span>&#34;company&#34;</span><span>:</span> <span>{</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;Digital Ocean, Inc.&#34;</span><span>,</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;digitalocean.com&#34;</span><span>,</span>
    <span>&#34;type&#34;</span><span>:</span> <span>&#34;hosting&#34;</span>
  <span>},</span>
  <span>&#34;privacy&#34;</span><span>:</span> <span>{</span>
    <span>&#34;vpn&#34;</span><span>:</span> <span>false</span><span>,</span>
    <span>&#34;proxy&#34;</span><span>:</span> <span>false</span><span>,</span>
    <span>&#34;tor&#34;</span><span>:</span> <span>false</span><span>,</span>
    <span>&#34;relay&#34;</span><span>:</span> <span>false</span><span>,</span>
    <span>&#34;hosting&#34;</span><span>:</span> <span>true</span><span>,</span>
    <span>&#34;service&#34;</span><span>:</span> <span>&#34;&#34;</span>
  <span>},</span>
  <span>&#34;abuse&#34;</span><span>:</span> <span>{</span>
    <span>&#34;address&#34;</span><span>:</span> <span>&#34;DigitalOcean, LLC, 101 Avenue of the Americas, 10th Floor, New York, NY, 10013, United States of America&#34;</span><span>,</span>
    <span>&#34;country&#34;</span><span>:</span> <span>&#34;US&#34;</span><span>,</span>
    <span>&#34;email&#34;</span><span>:</span> <span>&#34;abuse@digitalocean.com&#34;</span><span>,</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;Abuse Department&#34;</span><span>,</span>
    <span>&#34;network&#34;</span><span>:</span> <span>&#34;146.185.168.0/21&#34;</span><span>,</span>
    <span>&#34;phone&#34;</span><span>:</span> <span>&#34;+13478756044&#34;</span>
  <span>},</span>
  <span>&#34;domains&#34;</span><span>:</span> <span>{</span>
    <span>&#34;ip&#34;</span><span>:</span> <span>&#34;146.185.174.209&#34;</span><span>,</span>
    <span>&#34;total&#34;</span><span>:</span> <span>1</span><span>,</span>
    <span>&#34;domains&#34;</span><span>:</span> <span>[</span>
      <span>&#34;marksblogg.com&#34;</span>
    <span>]</span>
  <span>}</span>
<span>}</span>
</pre></div>
<p>The above API response was put together from 15 different data sources, including IPinfo&#39;s own global &#34;Probe Network&#34;.</p>
<p>The above information is useful for companies trying to detect e-commerce fraud, maintain sanctions compliance, understand their client&#39;s infrastructure as well as personalise and optimise offerings.</p>
<p>For customers with large sets of network logs, having a local IP address database can allow for good data locality when enriching dataset via batch processes. For customers with existing systems, the API is very easy to integrate and has 14 programming language bindings as of this writing.</p>
<p>In May, I signed a 3-month deal with IPinfo to provide consulting services. In this post, I&#39;ll describe how their probe network, which identifies the physical location of almost every IPv4 address on the planet, operates.</p>
<div id="how-ipinfo-got-started">
<h2>How IPinfo Got Started</h2>
<p><a href="https://www.linkedin.com/in/bendowling/">Ben Dowling</a>, the founder of IPinfo, began looking into ways to detect IP Address locations in 2013, shortly after he arrived in the US from the UK and began working for Facebook. In 2016, after a stint as the CTO of Calm, a meditation app, he decided to start IPinfo which builds and sells IP address metadata.</p>
<p>Ben&#39;s first customer was Tesla and from there he managed to win deals with Cloudflare, Microsoft and Tencent to name a few. Today IPinfo supplies data to over 400K businesses around the world. In July, their API crossed the 40B queries per month milestone.</p>
</div>
<div id="the-probe-network">
<h2>The Probe Network</h2>
<p>IPinfo uses a large variety of sources of information on IP addresses. In the Autumn of 2020, they set out to add a new data source for IPv4 locations. This source was called the &#34;Probe Network&#34; and would run an ICMP census across the entire publicly-addressable IPv4 space every few weeks.</p>
<p>To conduct the census, <a href="https://github.com/zmap/zmap">zmap</a> is run from four regions and collects a list of all IPv4 addresses that respond to any one of four ping types. Then, that list of IPv4 addresses is given to 90+ servers around the world. Those servers will then ping those addresses and record their ping times using <a href="https://www.caida.org/catalog/software/scamper/">scamper</a>.</p>
<p>The ping times from every server are then put together and calculations are made as to the likely location of each IPv4 address.</p>
</div>
<div id="uncovering-the-truth">
<h2>Uncovering the Truth</h2>
<p>Network devices can fake long ping responses but they can&#39;t fake short ones. If an IPv4 address block has WHOIS information stating they&#39;re located in the US but servers in Dubai, Mumbai and Istanbul have pings times of less than 30ms, it is unlikely those addresses are being used in the US. ICMP responses from those three locations to the continental US should take at least 100ms.</p>
<p>The above scenario has uncovered IP addresses being covertly used in countries under US sanctions while posing as being in other parts of the world.</p>
</div>
<div id="producing-the-dataset">
<h2>Producing the Dataset</h2>
<p>IPinfo stores all of its collected data in Google Cloud&#39;s BigQuery. As of July, a little more than 300 TB of data was being stored there. This data is synthesized down to CSV, JSON, MMDB and XML files which are MBs in size, refreshed every few weeks and distributed to both IPinfo&#39;s customers as well as to IPinfo&#39;s API servers.</p>
<p>IPinfo has gone to great lengths to minimise the queries they execute against BigQuery and as a result, they spend around $4,500 / month on the service. This is one of the lowest costs per TB per month I&#39;ve seen for a dataset of this size and level of importance to a business.</p>
</div>
<div id="expanding-the-network">
<h2>Expanding the Network</h2>
<p>After IPinfo signed agreements with nine Cloud providers the probe network now has a fleet of 90+ VMs. Expanding this further has been an ongoing challenge as few providers have VMs located in a wide variety of geographies.</p>
<p>To add to this, IPinfo has had to reach out to the Cloud Provider&#39;s heads of security ahead of time to get signoff for the probe network. If you are running software that can ping the entire internet in less than a day it may look as though you&#39;re running large DDOS attacks. Thankfully the security teams have been understanding thus far.</p>
</div>

        </div><div id="support_text"><p>
            Thank you for taking the time to read this post. I offer both consulting and hands-on development services to clients in North America and Europe. If you&#39;d like to discuss how my offerings can help your business please contact me via <a href="https://uk.linkedin.com/in/marklitwintschik/">LinkedIn</a>.
            </p></div></div>
  </body>
</html>
