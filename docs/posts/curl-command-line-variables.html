<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://daniel.haxx.se/blog/2023/07/31/introducing-curl-command-line-variables/">Original</a>
    <h1>Curl Command Line Variables</h1>
    
    <div id="readability-page-1" class="page"><div>
		
<p>If you are anything like me, you appreciate solving your every day simple tasks directly from the command line. Creating crafty single shot command lines or a small shell script to solve that special task you figured out you needed and makes your day go a little smoother. A fellow <em>command line cowboy</em>.</p>



<h2>Video presentation</h2>



<p>This feature will be described and detailed on live-streamed video. Join me then and ask me all your questions about this. The video will be done (and recorded for later watching) on <strong>Wednesday August 2 at 08:00 UTC </strong>(10:00 CEST) on <a href="https://www.twitch.tv/curlhacker">the curlhacker channel on twitch</a> – as usual.</p>



<h2>Background</h2>



<p>To make life easier for curl users, the tool supports “<a href="https://everything.curl.dev/cmdline/configfile">config files</a>“. They are a set of command line options written in a text file that you can point the curl tool to use. By default curl will check for and use such a config file named <code>.curlrc</code> if placed in your home directory.</p>



<p>One day not too long ago, a user over in <a href="https://curl.se/docs/irc.html">the curl IRC channel</a> asked me if it was possible to use environment variables in such config files to avoid having to actually store secrets directly in the file.</p>



<h2>Variables</h2>



<p>This new variable system that we introduce in <strong>curl 8.3.0</strong> (commit <a href="https://github.com/curl/curl/commit/2e160c9c652504e147f474ed920ae891481e299c">2e160c9c65</a>) makes it possible to use environment variable in config files. But it does not stop there. It allows lots of other fun things.</p>



<p>First off, you can <em>set</em> named variables on the command line. Like :</p>



<pre>curl --variable name=content</pre>



<p>or in the config file:</p>



<pre>variable=name=content</pre>



<p>A variable name must only consist of a-z, A-Z, 0-9 or underscore (up to 128 characters). If you set the same name twice, the second set will overwrite the first.</p>



<p>There can be an unlimited amount of variables. A variable can hold up to 10M of content. Variables are set in a left to right order as curl parses the command line or config file.</p>



<h2>Assign</h2>



<p>You can assign a variable a plain fixed string as shown above. Optionally, you can tell curl to populate it with the contents of a file:</p>



<pre>curl --variable name@filename</pre>



<p>or straight from stdin:</p>



<pre>curl --variable name@-</pre>



<h2>Environment variables</h2>



<p>The variables mentioned above are only present in the curl command line. You can also opt to “import” an environment variable into this context. To import $HOME:</p>



<pre>curl --variable %HOME</pre>



<p>In this case above, curl will exit if there is no environment variable by that name. Optionally, you can set a default value for the case where the variable does not exist:</p>



<pre>curl --variable %HOME=/home/nouser</pre>



<h2>Expand variables</h2>



<p>All variables that are set or “imported” as described above can be used in subsequent command line option arguments – or in config files.</p>



<p>Variables must be explicitly asked for, to make sure they do not cause problems for older command lines or for users when they are not desired. To accomplish this, we introduce the <code>--expand-</code> option prefix.</p>



<p>Only when you use  the <code>--expand-</code> prefix in front of an option will the argument get variables expanded.</p>



<p>You reference (expand) a variable like <code>{{name}}</code>. That means two open braces, the variable name and then two closing braces. This sequence will then be replaced by the contents of the variable and  a non-existing variable will expand as blank/nothing.</p>



<p><strong>Trying to show a variable with a null byte causes error</strong></p>



<h2>Examples</h2>



<p>Use the variable named ‘content’ in the argument to <code>--data</code>, telling curl what to send in a HTTP POST:</p>



<pre>--expand-data “{{content}}”</pre>



<p>Create the URL to operate on by inserting the variables ‘host’ and ‘user’.</p>



<pre>--expand-url “https://{{host}}/user/{{user}}”</pre>



<h2>Expand variables</h2>



<p><code>--variable</code> itself can be expanded when you want to create a new variable that uses content from one or more other variables. Like:</p>



<pre>--expand-variable var1={{var2}}
--expand-variable fullname=’Mrs {{first}} {{last}}’
--expand-variable source@{{filename}}</pre>



<h2>Expansion functions</h2>



<p>When expanding a variable, functions can be applied. Like this: <code>{{name:function}}</code></p>



<p>Such variable functions alter how the variable is expanded. How it gets output.</p>



<p>Multiple functions can be applied in a left-to-right order:</p>



<p>curl offers four different <em>functions</em> to help you expand variables in the most productive way: trim, json, url and b64:</p>



<ul>
<li><strong>trim</strong> – removes leading and trailing whitespace</li>



<li><strong>json</strong> – outputs the variable JSON quoted (but without surrounding quotes)</li>



<li><strong>url</strong> – shows the string URL encoded, also sometimes called percent encoding</li>



<li><strong>b64</strong> – shows the variable base64 encoded</li>
</ul>



<h2>Function examples</h2>



<p>Expands the variable URL encoded. Also known as “percent encoded”.</p>



<pre>--expand-data “name={{name:url}}”</pre>



<p>To trim the variable first, apply both functions (in the right order):</p>



<pre>--expand-data “name={{name:trim:url}}”</pre>



<p>Send the HOME environment variable as part of a JSON object in a HTTP POST:</p>



<pre>--variable %HOME
--expand-data “{ \&#34;homedir\&#34;: \&#34;{{HOME:json}}\” &#34;</pre>




	</div></div>
  </body>
</html>
