<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/geofabrik/OpenRailRouting">Original</a>
    <h1>OpenRailRouting</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This is a prototype of a routing engine for railways based on a forked version of the
<a href="https://github.com/geofabrik/graphhopper/tree/osm-reader-callbacks">GraphHopper</a> routing engine and OpenStreetMap data.</p>

<p dir="auto">Following features are currently supported:</p>
<ul dir="auto">
<li>simple routing requests</li>
<li>map matching</li>
<li>isochrones</li>
<li>taking turn angles into account (to avoid U-turns on points)</li>
<li>disabling turns on railway crossings (OSM tag <code>railway=railway_crossing</code>)</li>
<li>support of tracks with multiple gauges</li>
<li>support of tracks with switchable voltage and frequency</li>
<li>support of different speeds in forward and backward direction</li>
</ul>
<p dir="auto">The configured vehicle profiles can:</p>
<ul dir="auto">
<li>use only tracks which have a compatible gauge</li>
<li>skip tracks without catenary if it is an electrical locomotive/electrical multiple unit</li>
<li>take the type of electrification (third rails vs. catenary) into account</li>
<li>avoid using tracks against theire preferred direction (useful for railway lines with multiple tracks)</li>
</ul>
<p dir="auto">Missing features:</p>
<ul dir="auto">
<li>taking the low acceleration and the long breaking distances of trains into account</li>
<li>a lot of features which would need data which is not in OSM (incline, structure gauges)</li>
<li>support for barriers (e.g. gates)</li>
</ul>

<p dir="auto">This project includes a web frontend which is a fork of the original GraphHopper web frontend.</p>

<p dir="auto">This project uses Maven (for the Java code) and NodeJS for the web frontend for building.
<code>npm</code> has to be installed.</p>
<div dir="auto" data-snippet-clipboard-copy-content="git submodule init
git submodule update
mvn clean install"><pre>git submodule init
git submodule update
mvn clean install</pre></div>
<p dir="auto">JUnit 5 is used for unit tests.</p>

<p dir="auto">You can configure OpenRailRouting by editing its GraphHopper configuration (YAML file). Please refer to <a href="https://github.com/geofabrik/OpenRailRouting/blob/master/config.yml">config.yml</a> for details.</p>

<p dir="auto">Each route request has to specify a profile. The available profiles are determined by the configuration when the graph is imported.
Each profile consists of</p>
<ul dir="auto">
<li><code>name</code>: name of the profile</li>
<li><code>turn_costs</code>: turn costs
<ul dir="auto">
<li><code>vehicle_types</code>: vehicle types used for vehicle-specific turn restrictions. Available values: <code>train</code>, <code>light_rail</code>, <code>tram</code>, <code>subway</code></li>
<li><code>u_turn_costs</code>: time penality in seconds for reversing</li>
</ul>
</li>
<li><code>custom_model_files</code>: list of files that define the profile. The files are searched in <code>src/main/resources/com/graphhopper/custom_profiles</code>.</li>
</ul>
<p dir="auto">You can add an additional directory to the custom models search path by:</p>
<div dir="auto" data-snippet-clipboard-copy-content="graphhopper:
  custom_models.directory: path/to/your/custom_models_directory"><pre><span>graphhopper</span>:
  <span>custom_models.directory</span>: <span>path/to/your/custom_models_directory</span></pre></div>
<p dir="auto">If you have your own separate custom models directory, you do not have to recompile OpenRailRouting after every change of the models.</p>
<p dir="auto">Please refer to the <a href="https://github.com/graphhopper/graphhopper/blob/master/docs/core/custom-models.md">GraphHopper documentation about custom models</a> for a detailed explanation how custom models work. The following contains a few notes about differences between GraphHopper and OpenRailRouting.</p>
<p dir="auto">In addition to the encoded values supported by GraphHopper, OpenRailRouting can encoded the following encoded values per edge:</p>
<ul dir="auto">
<li><code>voltage</code>: decimal (precision: 100 Volt), missing values are encoded as <code>0.0</code></li>
<li><code>frequency</code>: decimal (precision: 2.5 Hz), missing values are encoded as <code>0.0</code></li>
<li><code>electrified</code>: enum (<code>UNSET</code>, <code>NO</code>, <code>OTHER</code>, <code>CONTACT_LINE</code>, <code>RAIL</code>)</li>
<li><code>gauge</code>: integer, missing values are encoded as <code>0.0</code></li>
<li><code>railway_class</code>: enum for the value of the OSM <code>railway=*</code> tag: <code>RAIL</code>, <code>LIGHT_RAIL</code>, <code>TRAM</code>, <code>SUBWAY</code>, <code>NARROW_GAUGE</code>, <code>FUNICULAR</code></li>
<li><code>railway_service</code>: enum for the value of the OSM <code>service=*</code> tag: <code>NONE</code>, <code>SIDING</code>, <code>YARD</code>, <code>SPUR</code>, <code>CROSSOVER</code></li>
<li><code>preferred_direction</code>: boolean value, true if the requested direction matches the preferred direction of operation of the track</li>
</ul>
<p dir="auto">In order to make use of these encoded values, you have to set them in the GraphHopper configuration using:</p>
<div dir="auto" data-snippet-clipboard-copy-content="graphhopper:
  graph.encoded_values: gauge,voltage,electrified,frequency,road_environment,max_speed,rail_access,rail_average_speed,railway_class,railway_service"><pre><span>graphhopper</span>:
  <span>graph.encoded_values</span>: <span>gauge,voltage,electrified,frequency,road_environment,max_speed,rail_access,rail_average_speed,railway_class,railway_service</span></pre></div>
<p dir="auto">If an edge has multiple gauges, voltages, freuqencies or types of electrification (e.g. multi-gauge tracks or tracks), the edge is duplicated during import. As author of a custom model, you don&#39;t need to take this into account.</p>
<p dir="auto">OpenRailRouting provides a few basic profiles where you can combine and built upon:</p>
<ul dir="auto">
<li><code>all_tracks.json</code> accepts any track.</li>
<li><code>rail.json</code> routes on any <code>railway=rail</code></li>
<li><code>tramtrain.json</code> routes on <code>railway=rail/light_rail/tram</code></li>
<li><code>gauge_1435.json</code> limits accessible tracks to those with <code>gauge=1435</code> or missing gauge.</li>
<li><code>15kv-ac_750v-dc.json</code> limits accessible tracks to those with 15 kV 16.7 Hz AC, 750 V DC or missing information about power systems. Tracks with <code>electrified=no/rail</code> will be assumed as inaccessible.</li>
</ul>
<p dir="auto">Don&#39;t forget that clients can submit their own profiles at runtime if they use POST requests.</p>

<p dir="auto">To run the routing engine, execute</p>
<div dir="auto" data-snippet-clipboard-copy-content="java -Xmx2500m -Xms50m \
  -Ddw.graphhopper.datareader.file=$OSMFILE \
  -jar target/railway_routing-0.0.1-SNAPSHOT.jar ACTION [ARGUMENTS] CONFIG_FILE [OPTARG]"><pre>java -Xmx2500m -Xms50m \
  -Ddw.graphhopper.datareader.file=<span>$OSMFILE</span> \
  -jar target/railway_routing-0.0.1-SNAPSHOT.jar ACTION [ARGUMENTS] CONFIG_FILE [OPTARG]</pre></div>
<p dir="auto">The tool currently supports three different actions (<code>ACTION</code> above):</p>
<ul dir="auto">
<li><code>import</code> to import the graph (graph will be stored at the subdirectory <code>graph-cache/</code>)</li>
<li><code>serve</code> to listen to HTTP requests for the API and the web interface on the port specified in a YAML configuration file (see
<code>config.yml</code> as an example). If no data has been imported, an import of the routing graph will happen first.</li>
<li><code>match</code> do map matching. This command needs additional arguments called <code>OPTARG</code> above.</li>
</ul>

<p dir="auto">Arguments:</p>
<ul dir="auto">
<li><code>--input</code>, <code>-i</code>: Path to input file (.osm.pbf format)</li>
<li><code>--output</code>, <code>-o</code>: Path to output directory where the graph should be written to</li>
</ul>
<p dir="auto">Required settings to be given either as Java system properties (<code>-Dgraphhopper.datareader.file=PATH</code> or in the YAML file):</p>
<ul dir="auto">
<li><code>graphhopper.datareader.file=$PATH</code>: path to OSM file</li>
<li><code>graphhopper.graph.location=./graph-cache</code>: directory where the graph should be written to
(default: <code>./graph-cache</code>)</li>
</ul>

<p dir="auto">Required settings to be given either as Java system properties (<code>-Ddw.KEY=VALUE</code> or in the configuration file):</p>
<ul dir="auto">
<li><code>dw.graphhopper.datareader.file=$PATH</code>: path to OSM file</li>
<li><code>dw.graphhopper.graph.location=./graph-cache</code>: directory where the graph should be read from
(default: <code>./graph-cache</code>)</li>
<li><code>dw.server.applicationConnector.port=$PORT</code>: port to be opened by Jetty</li>
</ul>

<p dir="auto">Required settings to be given either as Java system properties (<code>-Ddw.KEY=VALUE</code> or in the configuration file):</p>
<ul dir="auto">
<li><code>dw.graphhopper.datareader.file=$PATH</code>: path to OSM file</li>
<li><code>dw.graphhopper.graph.location=./graph-cache</code>: directory where the graph should be read from
(default: <code>./graph-cache</code>)</li>
</ul>
<p dir="auto">Following arguments have to be provided (not as Java system variables). You can retrieve this list
by calling
<code>java -jar target/railway_routing-0.0.1-SNAPSHOT-jar-with-dependencies.jar match config.yml</code></p>
<ul dir="auto">
<li><code>--gpx-location=$PATTERN</code> is required. This can be either a single GPX file or a wildcard pattern
like <code>/path/to/dir/mytracks/*.gpx</code>. The resulting routes will be written as GPX files to same
directory but <code>.res.gpx</code> will be appended to their file names. Wildcard patterns need to be
enclosed with quotes (<code>--gpx-location=&#34;path/to/files/*.gpx&#34;</code>) to prevent your shell expanding
the pattern.</li>
<li><code>-V VEHICLE</code>, <code>--vehicle=$VEHICLE</code>: routing profile to be used.</li>
</ul>
<p dir="auto">Optional command line arguments:</p>
<ul dir="auto">
<li><code>-a NUMBER</code>, <code>--gps-accuracy=NUMBER</code>: GPS accuracy in metres (default: 40)</li>
<li><code>--max_nodes=NUMBER</code>: maximum number of nodes to visit between two trackpoints (default: 10,000)</li>
</ul>

<p dir="auto">See <a href="https://github.com/geofabrik/OpenRailRouting/blob/master/LICENSE.txt">LICENSE.txt</a></p>
<p dir="auto">See <a href="https://github.com/geofabrik/OpenRailRouting/blob/master/THIRD_PARTY.md">THIRD_PARTY.md</a> for a list of all third-party code in this repository</p>

<p dir="auto">Development of this project has been supported by <a href="https://www.geofabrik.de" rel="nofollow">Geofabrik</a> and <a href="https://www.sncf.com/fr" rel="nofollow">SNCF</a>.</p>
</article></div></div>
  </body>
</html>
