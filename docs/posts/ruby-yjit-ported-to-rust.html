<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ruby/ruby/pull/5826">Original</a>
    <h1>Ruby YJIT Ported to Rust</h1>
    
    <div id="readability-page-1" class="page"><div>
        <div>
  
  <task-lists disabled="" sortable="">
    <div>
      <p dir="auto">In December 2021, we opened an <a href="https://bugs.ruby-lang.org/issues/18481" rel="nofollow">issue</a> to solicit feedback regarding the porting of the YJIT codebase from C99 to Rust. There were some reservations, but this project was given the go ahead by Ruby core developers and Matz. Since then, we have successfully completed the port of YJIT to Rust. We are opening this pull request to upstream Rust YJIT, effectively replacing the C version of YJIT.</p>
<p dir="auto">The new Rust version of YJIT has reached parity with the C version, in that it passes all the CRuby tests, is able to run all of the YJIT benchmarks, and performs similarly to the C version (because it works the same way and largely generates the same machine code). We&#39;ve even incorporated some design improvements, such as a more fine-grained constant invalidation mechanism which we expect will make a big difference in Ruby on Rails applications.</p>
<p dir="auto">Because we want to be careful, YJIT is guarded behind a configure option:</p>
<div data-snippet-clipboard-copy-content="./configure -–enable-yjit # Build YJIT in release mode
./configure -–enable-yjit=dev # Build YJIT in dev/debug mode"><pre>./configure -–enable-yjit <span><span>#</span> Build YJIT in release mode</span>
./configure -–enable-yjit=dev <span><span>#</span> Build YJIT in dev/debug mode</span></pre></div>
<p dir="auto">By default, YJIT does not get compiled and cargo/rustc is not required. If YJIT is built in dev mode, then <code>cargo</code> is used to fetch development dependencies, but when building in release, <code>cargo</code> is not required, only <code>rustc</code>. At the moment YJIT requires Rust 1.60.0 or newer.</p>
<p dir="auto">The YJIT command-line options remain mostly unchanged, and more details about the build process are documented in <code>doc/yjit/yjit.md</code>.</p>
<p dir="auto">The CI tests have been updated and do not take any more resources than before.</p>
<p dir="auto">The development history of the Rust port is available at the following commit for interested parties: <a data-hovercard-type="commit" data-hovercard-url="https://github.com/Shopify/ruby/commit/958c89d5ddb5d98cabcd2a9962ea42e4c9194728/hovercard" href="https://github.com/Shopify/ruby/commit/958c89d5ddb5d98cabcd2a9962ea42e4c9194728">Shopify@<tt>958c89d</tt></a></p>
<p dir="auto">Our hope is that Rust YJIT will be compiled and included as a part of system packages and compiled binaries of the Ruby 3.2 release. We do not anticipate any major problems as Rust is well supported on every platform which YJIT supports, but to make sure that this process works smoothly, we would like to reach out to those who take care of building systems packages before the 3.2 release is shipped and resolve any issues that may come up.</p>
<hr/>
<p dir="auto">Please feel free to comment or ask questions on this pull request if you have any.</p>
<p dir="auto"><em>AppVoyer</em> CI checks are currently red on the master branch, so they will be red on this PR as well.</p>
    </div>
  </task-lists>
  
</div>

      </div></div>
  </body>
</html>
