<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://destevez.net/2023/01/decoding-lunar-flashlight/">Original</a>
    <h1>Decoding Lunar Flashlight</h1>
    
    <div id="readability-page-1" class="page"><article id="post-13743">

	<!-- .entry-header -->

	<div>
		
<p><a href="https://en.wikipedia.org/wiki/Lunar_Flashlight">Lunar Flashlight</a> is a 6U NASA cubesat whose mission is to detect the presence of water ice on permanently shadowed regions of the lunar south pole. It was launched on December 11 2022 together with Hakuto-R M1 (to which I dedicated my <a href="https://destevez.net/2023/01/decoding-hakuto-r-m1/" data-type="post" data-id="13642">previous post</a>). It travels using a low-energy transfer to lunar orbit, so it will arrive to the Moon in a few months.</p>



<p>The day after the launch, <a href="https://amsat-dl.org/en/">AMSAT-DL</a> made an IQ recording of the X-band beacon of Lunar Flashlight at 8457.27 MHz with the <a href="https://amsat-dl.org/en/20-meter-antenna/">20 metre antenna at Bochum observatory</a>. The recording was done on 2022-12-12 17:08:54 UTC and lasts 3 minutes 2 seconds. In this post I will analyse the recording.</p>



<h4>Modulation and coding</h4>



<p>The modulation used by Lunar Flashlight is PCM/PM/bi-phase-L. This means that the telemetry is Manchester encoded and phase modulated with a residual carrier. The nominal baudrate is probably 48 kbaud. To be more precise, I have measured 48077 baud. Coding is r=1/6 CCSDS Turbo code with 8920 bit frames. This is the CCSDS coding that provides the best Eb/N0 performance.</p>



<p>The figure below shows the <a href="https://www.gnuradio.org/">GNU Radio</a> <a href="https://github.com/daniestevez/jupyter_notebooks/blob/master/Lunar_Flashlight/lunar_flashlight.grc">flowgraph</a> that I have used to decode this recording. The flowgraph uses the Turbo decoder block from <a href="https://github.com/daniestevez/gr-dslwp/tree/maint-3.10">gr-dslwp</a> and some blocks from <a href="https://github.com/daniestevez/gr-satellites">gr-satellites</a>.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_flowgraph.png"><img decoding="async" width="644" height="387" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_flowgraph-644x387.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_flowgraph-644x387.png 644w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_flowgraph-300x180.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_flowgraph-768x461.png 768w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_flowgraph.png 1512w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Lunar Flashlight GNU Radio decoder flowgraph</figcaption></figure>



<p>At some point in the recording, there is a frequency jump of approximately 121 kHz. This is probably caused by the spacecraft locking or unlocking to an uplink carrier from the groundstation. The recording is therefore processed in two segments, using different File Source blocks for each of the segments. In the second segment there is actually a second, much smaller, frequency jump. For this reason, the PLL bandwidth for the second segment is set to 100 Hz, so that the jump can be tracked correctly. For the first segment, a PLL bandwidth of 25 Hz is used, which gives less jitter.</p>



<p>The figure below shows the GUI of the decoder flowgraph. The top left plot is the spectrum at the output of the PLL, showing the real and imaginary parts separately. I don’t know why there is a significant amount of modulation power on the real part (besides the residual carrier). This only happens at the beginning of the recording. A few seconds before the frequency jump the power in the real part disappears. It briefly appears again for a few seconds some time after the frequency jump.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui.png"><img decoding="async" width="644" height="357" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui-644x357.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui-644x357.png 644w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui-300x166.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui-768x425.png 768w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui-1536x850.png 1536w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui-1568x868.png 1568w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gui.png 1920w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Lunar Flashlight GNU Radio decoder flowgraph GUI</figcaption></figure>



<p>The top right plot shows the constellation plot. We see that the SNR is good and there are few bit errors. The bottom plot shows a time domain plot of the stream of symbols and the correlations with the 192-bit ASM.</p>



<h4>AOS frames</h4>



<p>Lunar Flashligh transmits <a href="https://public.ccsds.org/Pubs/732x0b4.pdf">CCSDS AOS Space Data Link frames</a> using spacecraft ID <code>0x81</code>. This ID is <a href="https://sanaregistry.org/r/spacecraftid/records/14178">assigned to the return link of Lunar-Flashlight</a> in SANA registry. The forward link has assigned a different spacecraft ID, <code>0x36B</code>. We have seen this tendency to use different spacecraft IDs for the forward and return links in most of the cubesats that have been launched to the Moon on the end of 2022.</p>



<p>Only virtual channel 2 is in use. There is no Operational Control Field or AOS Insert Zone, but there is a Frame Error Control Field (CRC-16), as recommended for Turbo coded frames. The GNU Radio flowgraph checks this CRC-16. In this recording, only one frame was lost, due to the frequency jump happening mid-frame.</p>



<p>The figure below shows a raster map of all the AOS frames. No structure is immediately recognizable.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_vc2.png"><img decoding="async" width="618" height="622" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_vc2.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_vc2.png 618w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_vc2-298x300.png 298w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_vc2-150x150.png 150w" sizes="(max-width: 618px) 100vw, 618px"/></a></figure>



<p>The frames contain <a href="https://public.ccsds.org/Pubs/133x0b2e1.pdf">CCSDS Space Packets</a> using the M_PDU protocol. The Space Packets belong to several APIDs and have different sizes. Typically all the packets from the same APID have the same size, but APIDs 1 and 98 that are an exception to this. All the packets have the secondary header flag asserted.</p>






<p>I have determined that the secondary header contains a 48-bit timestamp that indicates the number of \(2^{-16}\) second ticks elapsed since the J2000 epoch 2000-01-01 12:00:00. Interestingly, the packets in each APID are sent with timestamps that differ by up to a couple of minutes, as if some APIDs were buffered or delayed or used a different time source.</p>



<p>The plots below try to illustrate this. The APIDs are separated in three plots only to make the plots less busy. In each plot, thin grey lines are shown in the background for all the APIDs for easier reference. In the foreground, four coloured lines for four APIDs are shown. The x-axis represents the Space Packet relative number, which corresponds to the order in which the Space Packets have been received. Since the recording starts at 17:08:54 UTC, I would say that the APIDs 0, 1, 2, 3, 8,11, and 13 are sent close to real time, and the other APIDs are delayed by one or two minutes. APID 7 is specially interesting because its delay changes at some point.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_timestamps.png"><img decoding="async" width="644" height="404" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_timestamps-644x404.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_timestamps-644x404.png 644w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_timestamps-300x188.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_timestamps.png 746w" sizes="(max-width: 644px) 100vw, 644px"/></a></figure>



<p>APID 6 probably contains some kind of real-time telemetry, judging by the fact that it is sent regularly and by the looks of its raster map, shown here.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid6.png"><img decoding="async" width="609" height="622" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid6.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid6.png 609w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid6-294x300.png 294w" sizes="(max-width: 609px) 100vw, 609px"/></a></figure>



<p>The <a href="https://github.com/daniestevez/jupyter_notebooks/blob/master/Lunar_Flashlight/Lunar%20Flashlight%20frames.ipynb">Jupyter notebook</a> contains raster maps of all the APIDs.</p>



<p>APID 1 is specially interesting. It contains Space Packets of four different lengths: 33, 94, 1021, and 2041 (these are the values of the Space Packet data length fields). The packets of different lengths are sent in a regular sequence, as we can see in the raster map. Shorter frames have been padded with zeros at the end, which are shown as a purple colour. First there is a length 33 packet and a length 94 packet. Then there are a bunch of length 2041 packets. Finally there is a length 1021 packet, and the sequence repeats again.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid1.png"><img decoding="async" width="614" height="622" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid1.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid1.png 614w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid1-296x300.png 296w" sizes="(max-width: 614px) 100vw, 614px"/></a></figure>



<p>Even though it is not easy to see the structure of the data in this raster map, we can see a diagonal pattern. It turns out that in the packets of length 2041, the segment from byte 28 of the payload to 6 bytes before the end of the packet contains a concatenation of Space Packets of length 165 bytes. Since 165 does not divide the size of this segment, the packets that become fragmented at the end of a packet continue in the next packet. Similarly, the packets of length 1021 also contain Space Packets starting at byte 28.</p>



<p>All of the Space Packets that are encapsulated in APID 1 belong to APID 113. Looking at the timestamps of these encapsulated packets, we see that they correspond to pre-recorded telemetry which is being replayed. The timestamps are spaced approximately 10 seconds apart, and in this recording they cover from 7:40:29 to 9:48:22. This is probably a time interval during which the spacecraft wasn’t being tracked by any grounstation, so now that a groundstation is tracking, all the recorded data is downlinked on demand.</p>



<p>The next figure shows the raster map of these packets. As we will see in the next section, they contain telemetry for the ADCS, and probably other subsystems.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid113.png"><img decoding="async" width="693" height="622" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid113.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid113.png 693w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid113-300x269.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_apid113-644x578.png 644w" sizes="(max-width: 693px) 100vw, 693px"/></a></figure>



<p>It is interesting that the total length of the packets with data length field 2041 (once we take into account the size of the Space Packet Primary Header) is 2048 bytes. This suggest that this is the maximum Space Packet size for this spacecraft, so when replayed telemetry packets are being sent, they are encapsulated in Space Packets that are as large as possible. Each transfer comes preceded by some kind of announcement, which are the two shorter packets. Since the transfer doesn’t fill up an integer number of length 2041 packets, the last packet is shorter, which explains the length 1021 packets.</p>



<p>Although the only clue that we have in this data is the fact that virtual channel 2 is used, we know that Lunar Flashlight uses the IRIS radio, because it is mentioned in <a href="https://ieeexplore.ieee.org/document/8826666">this paper</a>. We have been seeing in the last series of posts that most of the cubesats that have been launched to the Moon use this radio, which has a number of distinguishing features, including using virtual channel 2 for the telemetry and <code>0xdc</code> as a filler byte for only idle data and idle packets.</p>



<h4>ADCS telemetry</h4>



<p>The APID 113 packets encapsulated in APID 1 contain ADCS telemetry. The techniques we will follow in this analysis are very similar to those I used for <a href="https://destevez.net/2023/01/decoding-hakuto-r-m1/" data-type="post" data-id="13642">Hakuto-R M1</a>. Bytes 90 to 106 in these packets interpreted as big-endian <code>int32</code> contain the attitude quaternions. These are in scalar-last format, and use a scale factor of \(2\cdot 10^9\). As we will see, they encode the rotation from the spacecraft body frame to ICRF (or a similar system, such as equatorial J2000). Thanks to the fact that APID 1 replays pre-recorded telemetry, we can see the evolution of the attitude over the course of two hours.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_quaternions.png"><img decoding="async" width="700" height="353" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_quaternions.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_quaternions.png 700w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_quaternions-300x151.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_quaternions-644x325.png 644w" sizes="(max-width: 700px) 100vw, 700px"/></a></figure>



<p>The jumps that we can see in the quaternion data correspond to a change of sign in the \(i, j, k\) components with the goal of making the scalar component always positive. We have also seen this behaviour in other spacecraft.</p>



<p>The next figure shows the relative axis of rotation in spacecraft body coordinates. This has been computed as the axis of rotation of \(q(t)^{-1}q(t_0)\), where \(q(t)\) are the spacecraft body to ICRF quaternions shown above, and \(t_0\) is the first timestamp in the data. We see that the axis of rotation is constant and close to the spacecraft Z-axis.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_axis.png"><img decoding="async" width="605" height="353" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_axis.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_axis.png 605w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_axis-300x175.png 300w" sizes="(max-width: 605px) 100vw, 605px"/></a></figure>



<p>Next we plot the relative rotation angle. This has been unwrapped, since over the course of two hours the spacecraft completes 5 revolutions. The rotation angle changes almost as a linear slope, which means that the rotation rate is almost constant.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angle.png"><img decoding="async" width="657" height="353" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angle.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angle.png 657w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angle-300x161.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angle-644x346.png 644w" sizes="(max-width: 657px) 100vw, 657px"/></a></figure>



<p>Bytes 72 to 84 contain the gyroscope angular velocity as big-endian <code>int32</code>. This agrees with the quaternion data, since the rotation happens mostly in the Z-axis and its angular speed is roughly constant, but oscillates in a sinusoidal fashion.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro.png"><img decoding="async" width="613" height="368" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro.png 613w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro-300x180.png 300w" sizes="(max-width: 613px) 100vw, 613px"/></a></figure>



<p>We can compute the norm of the gyroscope vector, which indicates the total angular speed, and try to match it with the time derivative of the rotation angle computed with the quaternions. This helps us check the consistency of the data and find the scale factor for the gyroscopes. The plot below shows good agreement, and uses a gyroscope scale factor of \(-1.118\cdot 10^{-9}\). I haven’t been able to explain this scale factor in terms of a nice number and an appropriate choice of units (rad, deg, rpm, etc.).</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro_match.png"><img decoding="async" width="634" height="353" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro_match.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro_match.png 634w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_gyro_match-300x167.png 300w" sizes="(max-width: 634px) 100vw, 634px"/></a></figure>



<p>There are some other telemetry fields that show sinusoids which are probably related to the ADCS. I haven’t been able to find the meaning of these fields. Their plots are shown in the Jupyter notebook.</p>



<p>We have seen that the spacecraft is rotating slowly about its Z-axis, at a rate of approximately 2.5 revolutions per hour. This seems to be a deliberate <a href="https://en.wikipedia.org/wiki/Spin_stabilization">spin stabilization</a> configuration. Below we can see an image of Lunar Flashlight. We see that all the solar panels point in one direction. Therefore, it is quite likely that this direction is along the Z-axis, and the spacecraft is slowly rotating around the Z-axis while keeping its solar panels pointed to the Sun.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/Lunar_Flashlight_Post-Integration.jpg"><img decoding="async" width="644" height="362" src="https://destevez.net/wp-content/uploads/2023/01/Lunar_Flashlight_Post-Integration-644x362.jpg" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/Lunar_Flashlight_Post-Integration-644x362.jpg 644w, https://destevez.net/wp-content/uploads/2023/01/Lunar_Flashlight_Post-Integration-300x169.jpg 300w, https://destevez.net/wp-content/uploads/2023/01/Lunar_Flashlight_Post-Integration-768x432.jpg 768w, https://destevez.net/wp-content/uploads/2023/01/Lunar_Flashlight_Post-Integration.jpg 1008w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Lunar Flashlight. Image taken from <a href="https://en.wikipedia.org/wiki/Lunar_Flashlight#/media/File:Lunar_Flashlight_Post-Integration.jpg">Wikipedia</a>.</figcaption></figure>



<p>I have taken from <a href="https://ssd.jpl.nasa.gov/horizons/app.html">NASA HORIZONS</a> the spacecraft’s position in heliocentric ICRF coordinates at 07:30 TDB and used that to compute the Sun vector from the point of view of the spacecraft. Note that we can assume the Sun vector to be almost constant during the 2 hours of data we have. The figure below shows the ICRF coordinates of the Z-axis of Lunar Flashlight and of the Sun vector. We see that the Z-axis oscillates, since the spacecraft’s rotation axis is not perfectly aligned with the Z-axis. However, this oscillation is well centred on the Sun vector. This confirms our idea the the spacecraft Z-axis is orthogonal to the plane where the solar panels lie and that the Solar panels are being pointed directly to the Sun.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_sun_vector.png"><img decoding="async" width="718" height="353" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_sun_vector.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_sun_vector.png 718w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_sun_vector-300x147.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_sun_vector-644x317.png 644w" sizes="(max-width: 718px) 100vw, 718px"/></a></figure>



<p>In fact, the paper <a href="https://digitalcommons.usu.edu/cgi/viewcontent.cgi?article=5308&amp;context=smallsat">Systems Integration and Test of the Lunar Flashlight Spacecraft</a> confirms our understanding of the spacecraft body axes definition, since it includes the figure reproduced here.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_diagram.png"><img decoding="async" width="644" height="483" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_diagram-644x483.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_diagram-644x483.png 644w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_diagram-300x225.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_diagram.png 698w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Diagram of Lunar Flashlight, showing the spacecraft body axes (taken from <a href="https://digitalcommons.usu.edu/cgi/viewcontent.cgi?article=5308&amp;context=smallsat">this paper</a>)</figcaption></figure>



<p>Our next question is what happens with the spacecraft antennas. The paper indicates that:</p>



<blockquote>
<p>Lunar Flashlight has two pairs of planar patch antennas, one on the propulsion system (+Z) side and one on the payload radiator (−Z) side.</p>
<cite><a href="https://digitalcommons.usu.edu/cgi/viewcontent.cgi?article=5308&amp;context=smallsat">Systems Integration and Test of the Lunar Flashlight Spacecraft</a>, page 11</cite></blockquote>



<p>The above photo showed the antennas on the +Z side, which are in the middle of the spacecraft body, between the solar panels. The antennas on the -Z side can be seen in this other photo. Note that here the solar panels are folded over the spacecraft body.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_1.jpg"><img decoding="async" width="644" height="483" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_1-644x483.jpg" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_1-644x483.jpg 644w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_1-300x225.jpg 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_1-768x576.jpg 768w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_1.jpg 960w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Lunar Flashlight. Image taken from <a href="https://www.nasa.gov/centers/marshall/news/releases/2022/nasa-marshall-team-delivers-tiny-powerful-lunar-flashlight-propulsion-system.html">NASA</a>.</figcaption></figure>



<p>I have also taken from HORIZONS the spacecraft position in geocentric ICRF coordinates at 7:30 TDB in order to compute the Earth vector as seen from the spacecraft. We also assume that this vector doesn’t change much during 2 hours. The angle between the Sun and Earth vectors is 23 degrees. The spacecraft is pointing its solar panels, and hence its antennas on the +Z side, towards the Sun. Since the Earth is not too far off from the Sun from the point of view of the spacecraft, it can use its +Z side antennas to communicate with Earth. The plot below shows the angles between the Z-axis and the Sun and the Earth.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angles.png"><img decoding="async" width="815" height="353" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angles.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angles.png 815w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angles-300x130.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angles-644x279.png 644w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_angles-768x333.png 768w" sizes="(max-width: 815px) 100vw, 815px"/></a></figure>



<p>The antennas of Lunar Flashlight are low-gain circularly polarized patch antennas for X-band. <a href="https://ntrs.nasa.gov/api/citations/20190004974/downloads/20190004974.pdf">This paper</a> indicates that the antennas are “two pairs of INSPIRE-heritage low-gain antennas”. INSPIRE is just another name for the IRIS radio. In the paper <a href="https://ieeexplore.ieee.org/document/7119295">X-Band electronics for the INSPIRE Cubesat deep space radio</a> we can see more details about these antennas. The next figure is taken from this paper and shows the radiation pattern for the receive antenna (7.2 GHz). The radiation pattern for the transmit antenna (8.4 GHz) would be similar.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_antenna_pattern.png"><img decoding="async" width="644" height="491" src="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_antenna_pattern-644x491.png" alt="" srcset="https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_antenna_pattern-644x491.png 644w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_antenna_pattern-300x229.png 300w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_antenna_pattern-768x586.png 768w, https://destevez.net/wp-content/uploads/2023/01/lunar_flashlight_antenna_pattern.png 949w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Antenna patter for the Lunar Flashlight receive antenna (taken from <a href="https://ieeexplore.ieee.org/document/7119295">this paper</a>)</figcaption></figure>



<p>We can see that the gain reduction at 23 degrees from boresight is around 1 dB, which is not much. This shows why the spacecraft can afford to point its solar panels and antennas directly to the Sun in this case. I wonder how the spacecraft attitude would be configured for situations in which the Sun-spacecraft-Earth angle is much larger. Probably it depends on whether the spacecraft is being tracked by a groundstation (prioritizing pointing the antennas to Earth) or not (prioritizing pointing the solar panels to the Sun).</p>



<h4>Code and data</h4>



<p>The GNU Radio flowgraph and Jupyter notebook used in this post can be found in <a href="https://github.com/daniestevez/jupyter_notebooks/tree/master/Lunar_Flashlight">this repository</a>. It also contains the AOS frames decoded from the IQ recording.</p>
	</div><!-- .entry-content -->

	<!-- .entry-footer -->

				
</article></div>
  </body>
</html>
