<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.intigriti.com/hacking-tools/hacking-misconfigured-aws-s3-buckets-a-complete-guide">Original</a>
    <h1>Hacking misconfigured AWS S3 buckets: A complete guide</h1>
    
    <div id="readability-page-1" class="page"><div><p>AWS S3 (Simple Storage Service) buckets are a popular storage service used by software companies and organizations to store public as well as sensitive data. However, the implementation of this service is not always correctly done. A single missing access policy can often introduce security risks, data leaks, or other unintended consequences.</p><p>In this article, we will cover some of the most common security misconfigurations in AWS S3 buckets.</p><h2 id="finding-and-identifying-aws-s3-buckets">Finding &amp; identifying AWS S3 buckets</h2><p>There are several ways to find and identify AWS S3 bucket names. Below are 3 of the most effective ways of enumerating AWS S3 buckets.</p><h3>Examining HTTP responses:</h3><p>One method is simply examining HTTP responses in your proxy intercepting tool. Often AWS S3 bucket references &amp; links are included in the HTTP response to load images or other files. Search for:</p><pre data-language="regex"><code>\.s3\.amazonaws\.com\/?</code></pre><p>Or search for one of the following HTTP response headers:</p><pre data-language="http"><code>x-amz-bucket-region
x-amz-request-id
x-amz-id-2</code></pre><div><div><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNjQ1IiBoZWlnaHQ9IjgzNCI+PC9zdmc+" aria-hidden="true" alt=""/><img aria-hidden="true" alt="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgFCgoFBQwFBQUFBREJCgUMFxMZGBYTFhUaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLBQUFEAUFEC8cFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAA0AGAMBIgACEQEDEQH/xAAVAAEBAAAAAAAAAAAAAAAAAAAAB//EABQQAQAAAAAAAAAAAAAAAAAAAAD/xAAVAQEBAAAAAAAAAAAAAAAAAAACAP/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/AJ+AQgCT/9k="/></p></div><p>Example of an AWS S3 bucket response</p></div><h3>Dorking:</h3><p>Several popular search engines like Google, Bing, DuckDuckGo and Brave Search support search syntaxis. You can take advantage of this by specifically looking for your company and browse through indexed results.</p><pre data-language="markdown"><code>site:.s3.amazonaws.com &#34;company&#34;</code></pre><div><div><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjA4IiBoZWlnaHQ9IjYyNSI+PC9zdmc+" aria-hidden="true" alt=""/><img aria-hidden="true" alt="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgFCgoFBQwFBQUFBREJCgUMFxMZGBYTFhUaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLBQUFEAUFEC8cFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAA0AGAMBIgACEQEDEQH/xAAVAAEBAAAAAAAAAAAAAAAAAAAAB//EABQQAQAAAAAAAAAAAAAAAAAAAAD/xAAVAQEBAAAAAAAAAAAAAAAAAAACAP/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/ALCARACT/9k="/></p></div><p>Finding AWS S3 buckets with search engines</p></div><h3>Bruteforcing:</h3><p>You can also bruteforce common keywords your target may use as a bucket name. Automated tools such as <strong>S3enum</strong> and <strong>cloud_enum</strong> can help you enumerate AWS S3 buckets.</p><div><div><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMzcyIiBoZWlnaHQ9Ijg0NiI+PC9zdmc+" aria-hidden="true" alt=""/><img aria-hidden="true" alt="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICAgLEBYTDhgPDg0WDBIOFhEYFxMZGBYTFiEaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLDgYOEBAQEC8cFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAA8AGAMBIgACEQEDEQH/xAAXAAADAQAAAAAAAAAAAAAAAAAABQYD/8QAHRAAAgICAwEAAAAAAAAAAAAAAAECAwQSERVhBf/EABUBAQEAAAAAAAAAAAAAAAAAAAIA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AjKXLr2vCdytltyikwJqzDaaFX06oxrbSERGm9QNq61KDAk//2Q=="/></p></div><p>cloud_enum preview</p></div><p>Now that know how to enumerate AWS S3 buckets, we can start testing each one of them individually. At the end of this article, we will also go over a few popular open-source tools to help you automate these checks.</p><p><strong>TIP! To test AWS S3 buckets, we will need an active AWS account and the </strong><a target="_blank" href="https://aws.amazon.com/cli"><strong>official AWS CLI</strong></a><strong> installed. Make sure to also configure your AWS CLI after successfully installing it.</strong></p><h2 id="1-testing-for-misconfigured-list-permissions-in-aws-s3">1) Testing for misconfigured list permissions in AWS S3</h2><p>The most basic test we can perform on an AWS S3 bucket is testing the list permissions. Previously, AWS S3 buckets had list permissions enabled by default. But recently that changed and any newly created buckets have list permissions disabled by default. Developers and admins will now need to explicitly declare a policy to allow S3 listing.</p><p>We can however still test for list permissions on our target AWS S3 bucket by running the following command:</p><pre data-language="bash"><code>aws s3 ls s3://{BUCKET_NAME} --no-sign-request</code></pre><p>You should receive the following output if list permissions are enabled:</p><div><div><p><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MTkiIGhlaWdodD0iMjU2Ij48L3N2Zz4=" aria-hidden="true" alt=""/><img aria-hidden="true" alt="" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHBwgHBgoICA4GCAoIDhsQDgUGDhEJDREYFxMZGBYTFhUaHysjGh0oHRUWJDUlKC0vMjIyGSI4PTcwPCsxMi8BCgsLBQ0NEA0FEC8cFhwvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL//AABEIAAgAGAMBIgACEQEDEQH/xAAXAAEAAwAAAAAAAAAAAAAAAAAAAQQH/8QAGhAAAwEBAQEAAAAAAAAAAAAAAAEDBBESAv/EABUBAQEAAAAAAAAAAAAAAAAAAAIA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AzjPoxqT6JXwP6fCQIlK1M7s/IAJP/9k="/></p></div><p>Example output</p></div><p><strong>TIP! Before reporting a potential security misconfiguration, always verify the impact of the vulnerability! Some AWS S3 buckets are meant to be public!</strong></p><h2 id="2-testing-for-misconfigured-read-permissions-in-aws-s3">2) Testing for misconfigured read permissions in AWS S3</h2><p>As you can see from the previous results, we could list all the contents inside a storage bucket with list permissions enabled. Access controls can also be set on individual objects within a storage bucket.</p><p>An example might be that the <code>index.html</code> file is accessible but the <code>archive.zip</code> is not. But before jumping to any conclusions, we can simply perform the test ourselves:</p><pre data-language="bash"><code>aws s3api get-object --bucket {BUCKET_NAME} --key archive.zip ./OUTPUT --no-sign-request</code></pre><p><em>Make sure to replace the filename and bucket name in the command above.</em></p><h2 id="3-testing-for-misconfigured-download-permissions-in-aws-s3">3) Testing for misconfigured download permissions in AWS S3</h2><p>To quickly check if we can download and read files, we can use the <code>cp</code> subcommand:</p><pre data-language="bash"><code>aws s3 cp s3://{BUCKET_NAME}/intigriti.txt ./ --no-sign-request</code></pre><p><em>Make sure to replace the filename and bucket name in the command above.</em></p><h2 id="4-testing-for-misconfigured-write-permissions-in-aws-s3">4) Testing for misconfigured write permissions in AWS S3</h2><p>To test for missing write permissions, we can use the following command:</p><pre data-language="bash"><code>aws s3 cp intigriti.txt s3://{BUCKET_NAME}/intigriti-ac5765a7-1337-4543-ab45-1d3c8b468ad3.txt --no-sign-request</code></pre><p><em>Make sure to use a filename with a non-trivial name to prevent any disruption and replace the bucket name in the command above.</em></p><p>This operation can write and even overwrite a file, essentially deleting the old one. If bucket versioning is not enabled, the changes are permanent and permanent data loss is possible which can be catastrophic for a company.</p><h2 id="5-testing-for-read-permissions-on-access-control-lists-acls">5) Testing for read permissions on Access Control Lists (ACLs)</h2><p>An Access Control List (ACL, commonly also referred to as ACP) is a predefined scheme to help manage access controls on a specific S3 bucket or an object within an S3 bucket.</p><p>These ACLs can also have misconfigured access controls and allow malicious actors to request them, essentially allowing them to take a shortcut and easily enumerate any storage buckets or objects with misconfigured access controls.</p><p>To attempt to read an ACL on your S3 storage bucket using the AWS CLI, run the following command:</p><pre data-language="bash"><code>aws s3api get-bucket-acl --bucket {BUCKET_NAME} --no-sign-request</code></pre><p><em>Make sure to replace the bucket name in the command above.</em></p><p>To read an ACL on a specific object within a bucket using the AWS CLI, run the following command:</p><pre data-language="bash"><code>aws s3api get-object-acl --bucket {BUCKET_NAME} --key index.html --no-sign-request</code></pre><p><em>Make sure to replace the filename and bucket name in the command above.</em></p><h2 id="6-testing-for-write-permissions-on-access-control-lists-acls">6) Testing for write permissions on Access Control Lists (ACLs)</h2><p>AWS also provides you the option to overwrite any Access Control List (ACL) for an S3 storage bucket or object.</p><p>If permissions are misconfigured, it would allow a malicious actor to overwrite any current policies. This could allow a malicious actor to grant himself/herself permission to view the contents of the S3 storage bucket with no extra effort.</p><p>We can test for write permissions on ACLs by running the following command:</p><pre data-language="bash"><code>aws s3api put-bucket-acl --bucket {BUCKET_NAME} --grant-full-control emailaddress={EMAIL} --no-sign-request</code></pre><p><em>Make sure to replace the bucket name and the email in the command above.</em></p><p><strong>TIP! You do not have to always necessarily change an ACL to test for write permissions if read permissions are enabled. You can simply check the &#34;Grants&#34; property in the response to a read operation and verify if any unauthorized users are allowed to perform the write operation!</strong></p><h2 id="7-testing-for-missing-file-type-restrictions">7) Testing for missing file type restrictions</h2><p>AWS S3 buckets are often also used for storing public data such as profile images. And there are several ways developers are used to upload data to an AWS S3:</p><ol><li><p>Make the client upload the data to the company&#39;s API server, perform validations on the uploaded file, and finally store it on AWS S3 and return the public URL. The API server acts here as a proxy between the client and the AWS S3 bucket API.</p></li><li><p>Or make the client upload the data directly to AWS S3 by sending a form upload request to the AWS S3 bucket API. The API will return a link from which you can access the resource. To perform validation, you&#39;d have to <a target="_blank" href="https://repost.aws/knowledge-center/s3-allow-certain-file-types">declare additional policies to the <code>s3:PutObject</code> for your AWS S3 bucket</a> (this step is often neglected as developers aren&#39;t aware of it).</p></li></ol><p>The reason why most developers select the latter approach over the former is to decrease the load on their server. However, as mentioned before, developers often forget to declare additional file type restriction policies to further control what can be uploaded.</p><p>In other words, as an attacker, you can often easily upload malicious files like SVG files to achieve stored XSS for example.</p><p>In this video by <a href="https://x.com/gregxsunday">@gregxsunday</a>, you could view another example of how developers sometimes make mistakes when integrating AWS S3:</p><div><div></div></div><h2 id="8-testing-for-s3-versioning">8) Testing for S3 versioning</h2><p>S3 versioning is an additional security measure to allow bucket owners to store multiple versions of the same object. If an object accidentally gets modified, or even worse deleted, admins can simply revert to the latest version and undo the unwanted action. </p><p>For that reason, AWS always recommends you enable S3 versioning. However, storing multiple versions of the same file comes with additional costs that most development teams want to prevent. Turning that option off seems reasonable but this comes with a few security issues. If a malicious user ever gets the chance to delete or overwrite files, the changes will be permanent and there will be no way of restoring the original data objects (unless a separate backup is made).</p><p>You can test if unauthorized users can check if S3 versioning is enabled by running the following command:</p><pre data-language="bash"><code>aws s3api get-bucket-versioning --bucket {BUCKET_NAME} --no-sign-request</code></pre><h2 id="automated-tools">Automated tools</h2><p>Enumerating and testing all your targets&#39; S3 buckets individually can be a tedious task, especially when your target makes use of several S3 buckets. Fortunately for us, there are several open-source tools that we can make use of.</p><p>Here are a few open-source tools listed that can help with identifying and exploiting AWS S3 buckets.</p><p><strong>S3enum</strong></p><p>S3enum is a fast and stealthy AWS S3 bucket enumeration tool written in Golang and used by bug bounty hunters and penetration testers to enumerate AWS S3 buckets.</p><p><a target="_blank" href="https://github.com/koenrh/s3enum">https://github.com/koenrh/s3enum</a></p><p><strong>cloud_enum</strong></p><p>cloud_enum is an extensive OSINT tool to help bug bounty hunters and penetration testers enumerate cloud buckets such as AWS S3, GCP buckets and even Azure storage buckets.</p><p><a target="_blank" href="https://github.com/initstring/cloud_enum">https://github.com/initstring/cloud_enum</a></p><p><strong>LazyS3</strong></p><p>LazyS3 is a Ruby script that is capable of enumerating and identifying potential S3 buckets that belong to your target.</p><p><a href="https://github.com/nahamsec/lazys3">https://github.com/nahamsec/lazys3</a></p><p><strong>AWS Extender</strong></p><p>AWS Extender is a Burpsuite plugin (Professional edition only) to help you test for permissions on AWS S3, Google Cloud Provider storage buckets and Azure Storage Containers.</p><p><a target="_blank" href="https://github.com/VirtueSecurity/aws-extender">https://github.com/VirtueSecurity/aws-extender</a></p><p><strong>Nuclei</strong></p><p>Nuclei is a powerful template-based scanner that is capable of identifying and testing several permissions and access control lists (ACLs) on AWS S3 buckets using custom templates.</p><p><a target="_blank" href="https://github.com/projectdiscovery/nuclei">https://github.com/projectdiscovery/nuclei</a></p><h2 id="conclusion">Conclusion</h2><p>You&#39;ve probably already come across an AWS S3 bucket, maybe even a misconfigured one too, and if you ignored them before, we hope this article shines some light on the most common security misconfigurations present in this storage bucket service.</p><p>So, you’ve just learned something new about AWS S3 security misconfigurations… Right now, it’s time to put your skills to the test! You can start by practicing on vulnerable labs or... browse through our <a href="https://www.intigriti.com/programs">70+ public bug bounty programs on Intigriti</a> and who knows, maybe earn a bounty on your next submission!</p><p><a href="https://www.intigriti.com/programs">START HACKING ON INTIGRITI TODAY</a></p></div></div>
  </body>
</html>
