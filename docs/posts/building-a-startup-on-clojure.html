<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://wobaka.com/blog/building-a-startup-on-clojure/">Original</a>
    <h1>Building a Startup on Clojure</h1>
    
    <div id="readability-page-1" class="page"><section>
        <p>After first getting hooked on Clojure in 2018 I decided to build my business, <a href="https://wobaka.com">Wobaka.com</a>, on 100% Clojure the following year. That&#39;s how much I enjoyed it. I thought I&#39;d share some of my experience and technical stack for anyone else thinking about building and running their business on Clojure.</p><p>I&#39;ll walk you through my background and parts of my experience with Clojure, but if you&#39;re just looking for my tech stack, skip to the end.</p><h2 id="yes-its-great-even-if-java">Yes, it&#39;s great (even if Java)</h2><p>First of all, it&#39;s a great experience. Enjoyable. Easy to upgrade and no <em>npm fatigue</em>. Libraries doesn&#39;t always look as popular on Github as in other languages, but they&#39;re often of high quality. </p><p>I&#39;m not big on Java but Clojure running on the JVM turned out to be a huge benefit. It makes it easy to run your app on any platform and you can even deploy it as a single file if you want to using uberjar.</p><p>Don&#39;t hold of starting with Clojure because of Java.</p><h2 id="before-clojure">Before Clojure</h2><p>Let&#39;s start with some background on what I used before coming to Clojure, so you know a little more about what I compare it too.</p><p>I&#39;ve been building things on the web since around 1999. Staring with HTML, JS, Geocities ðŸ¤˜, ASP, PHP and Java. More recently I&#39;ve liked to work with Python using Flask or Django. I&#39;ve also worked quite a bit with NodeJS and Ruby on Rails. For the frontend I&#39;ve mostly used plain JavaScript, jQuery, Backbone, Angular and most recently React and Vue. The whole shebang.</p><p>I also have some (mostly academic) experience from working with distrubuted systems in Go, low level assembly and C, writing functional programs in Haskell, working on a compiler in Scala and coding proof testers in Prolog.</p><p>Alright, enough about my background, let&#39;s dig into the setup and experience of building a business on Clojure in 2022. Which is not that different from 2019, when I started building Wobaka. And that&#39;s a good thing!</p><h2 id="getting-started">Getting started</h2><p>&#34;Simple, not easy&#34; is almost a mantra in the Clojure community by now. If you haven&#39;t watched the talk (Simplicity matters), check the footnotes [1]. To keep things simple I opted to not use a full web framework like Rails, so getting set up took a little more time. Honestly, it was mostly just finding my way around the ecosystem and finding what libraries to use for things like routing and database migrations. Tools like Leiningen makes it really easy to set things up and I wish I had this blogpost when I started out.</p><p>You can use Leiningen (a handy tool like npm + extras), and basically do <code>lein new app &lt;name&gt;</code>.</p><h2 id="development-experience">Development experience</h2><p>Development experience is great once up and running. I setup everything with very few libraries so I had to write some extra code to get started. Now I have hot reloading, simple state management, very few dependencies and never have to switch language, not even for css.</p><figure><img src="https://wobaka.com/blog/content/images/2022/09/Screen-Shot-2022-09-29-at-10.59.42.png" alt="" loading="lazy" width="682" height="254" srcset="https://wobaka.com/blog/content/images/size/w600/2022/09/Screen-Shot-2022-09-29-at-10.59.42.png 600w, https://wobaka.com/blog/content/images/2022/09/Screen-Shot-2022-09-29-at-10.59.42.png 682w"/><figcaption>Ok it&#39;s 97.8% Clojure. I do have some config files not written in Clojure.</figcaption></figure><h2 id="library-support">Library support</h2><p>Sometimes the documentation is great, sometimes it&#39;s not. However, the good thing with Clojure is that it&#39;s really easy to read the code. It&#39;s just functions and data. Just look at the imported namespace and see what functions there is.</p><h2 id="java-and-javascript-interop">Java and JavaScript interop</h2><p>Interop makes it easy to tap into the host language&#39;s libraries. I almost never use interop with Java but on the frontend I sometimes need to interact with the DOM. Working with JavaScript is pretty straight forward though. For example, adding a click event handler that calls <code>event.preventDefault()</code> is as simple as this:</p><pre><code>{:on-click (fn [event] (.preventDefault event))}</code></pre><p>You basically just flip the order when calling object methods. Or you could use Clojure threading which passes down the result from functions. Look, now it&#39;s basically the same:</p><pre><code>{:on-click (fn [event] (-&gt; event .preventDefault))}</code></pre><p>This makes it easy to use any JavaScript library, and since the view library I use is built on top of React, I can basically use any React library as well, if I wanted to.</p><h2 id="deployment-options">Deployment options</h2><p>Deploying a ClojureScript frontend is a very smooth experience. I really recommend using something like Netlify and from there it&#39;s basically a one-liner to build the application using Shadowcljs (a beautiful tool to setup and build ClojureScript projects): <code>npx shadow-cljs release app</code>.</p><p>The backend is also easily deployed using something like Heroku but you can also host it easily on your own server. To host it yourself you can build the entire app into a self-contained uberjar using <code>lein ring uberjar</code> . Now you can just run the uberjar on any system with Java and you have the backend up and running. Most likely using something like systemctl and a reverse proxy in front like Nginx.</p><p>One thing to consider is that when your project grows larger, the startup time will not be instant or really quick like NodeJS or native binaries. This means that you may have to do a little work to get zero downtime deploys. But it&#39;s nothing that can&#39;t be fixed.</p><h2 id="the-stack">The stack</h2><p>This is what I use to build my SaaS on 100% Clojure. Let&#39;s start with the backend.</p><ul><li>Leiningen for project / dependency management</li><li>Ring + Compojure for routing and REST API</li><li>Ring-logger for logging requests</li><li>Environ to manage environment variables</li><li>Java.jdbc + c3p0 for database connection to Postgresql</li><li>Ragtime for database migrations</li><li>Tick for date/time utils</li><li>Postal for sending emails</li><li>Buddy for cryptography</li><li>Clj-http for making requests</li><li>Cheshire for JSON parsing</li></ul><p>That&#39;s it for the backend. I&#39;ve built my own worker/job scheduling using Postgresql and clojure.core.async, which basically let&#39;s you do concurrency like in the Go programming language.</p><p>I have two frontend apps. One for the marketing page which is server rendered and hydrated on load, and another that&#39;s just an ordinary SPA. For both I use the same setup.</p><ul><li>Shadowcljs to build the apps</li><li>Rum as a React wrapper and view component library</li><li>Accountant + Secretary for client side routing</li><li>Cljs-http for making API requests</li><li>Garden for writing CSS in Clojure</li><li>Flatpickr as date picker</li><li>Chartjs for charts</li><li>Papaparse for client side csv parsing</li><li>Trix as WYSIWYG editor</li><li>Plyr as Vimeo video player</li></ul><p>All in all, Wobaka is a relatively large app by now but it&#39;s still simple to work with, because it&#39;s just <em>functions and data</em>. It&#39;s also still simple to manage and update dependencies. I default to building things myself but sometimes it doesn&#39;t make sense and I&#39;m happy to be able to tap into the JavaScript ecosystem.</p><h2 id="parenthesis">Parenthesis</h2><p>I almost forgot to write about parenthesis. That&#39;s how much you care about it after getting started. They are just in different places (it&#39;s not a big deal).</p><h2 id="give-clojure-a-try">Give Clojure a try</h2><p>I really recommend giving Clojure a try. Especially if you like to write functional JavaScript code or enjoy working with things like React.</p><p>Clojure for the brave and true [2] is a great place to start. For a more web focused guide I&#39;m not sure. But I hope this guide can give you some good starting points on which libraries to use. Perhaps I&#39;ll write a getting started with web development in Clojure blogpost at some point.</p><p>Building your startup on Clojure or just want to talk Clojure? Hit me up on Twitter <a href="https://twitter.com/drikerf">@drikerf.</a></p><p>Also check out my other blogpost about things I love about working with Clojure.</p><figure><a href="https://wobaka.com/blog/how-i-use-clojure-to-build-and-scale-my-saas/"><div><p>How I Use Clojure to Build and Scale my SaaS</p><p>I was first introduced to Clojure in grad school where I was taking a course on building large scale software applications.</p><p><img src="https://wobaka.com/blog/favicon.png" alt=""/><span>Making a better CRM</span><span>Fredrik</span></p></div><p><img src="https://wobaka.com/blog/content/images/2022/01/hannah-gibbs-BINLgyrG_fI-unsplash.jpg" alt=""/></p></a></figure><p>[1] <a href="https://www.youtube.com/watch?v=rI8tNMsozo0">https://www.youtube.com/watch?v=rI8tNMsozo0</a></p>
    </section></div>
  </body>
</html>
