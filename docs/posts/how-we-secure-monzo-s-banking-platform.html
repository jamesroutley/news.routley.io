<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://monzo.com/blog/2022/03/31/how-we-secure-monzos-banking-platform/">Original</a>
    <h1>How we secure Monzo&#39;s banking platform</h1>
    
    <div id="readability-page-1" class="page"><article id="article"><p>Since the early days of Monzo, we have <a href="https://monzo.com/blog/2016/09/19/building-a-modern-bank-backend">built our banking platform</a> around a microservices-based architecture, using mostly containerised workloads that are distributed and redundant. We run our infrastructure on <a href="https://aws.amazon.com/">AWS</a>, and as an early adopter of <a href="https://kubernetes.io/">Kubernetes</a>, we have been able to <a href="https://monzo.com/blog/2020/10/19/autoscaling-monzo">efficiently scale</a> a banking platform consisting of more than 20,000 containerised workloads across more than 2000 microservices to date.</p><p>In this blog post, we’ll talk about the principles our Security Infrastructure team follow to build security in Monzo’s fast-moving engineering environment, how we robustly apply these principles in practice, and work with other engineering teams to keep our platform and customers safe.</p><h2>Threat modelling</h2><p>When engineering teams introduce new infrastructure components into Monzo’s banking platform, our security engineers work with them to perform threat modelling as a collaborative exercise. It’s important to understand new risks, and agree on necessary security controls which both keep us safe and continue to allow us to move fast. We use the <a href="https://en.wikipedia.org/wiki/STRIDE_(security)">STRIDE model</a> paired with <a href="https://owasp.org/www-project-threat-dragon/">OWASP Threat Dragon</a> to draw diagrams and document our models.</p><p>Once new infrastructure components are introduced into the platform, security engineers will conduct regular threat modelling sessions for larger parts of our platform as a whole. This helps us keep threat models updated as time passes.</p><h2>Design principles</h2><p>We condense the threat models for different parts of our platform into higher-level risks and necessary security controls, and derive our security design principles from that. Monzo security engineers then in turn follow these principles when advising engineering teams or making key security designs.</p><h3>Don’t trust workloads by default</h3><p>When we deploy a new microservice, it cannot talk to other services or access the internet by default. It has no access to a database, secrets or other resources on the network. Access is explicitly granted. We have <a href="https://monzo.com/blog/we-built-network-isolation-for-1-500-services">Kubernetes Network Policies</a> for traffic between all our microservices, we apply network and/or application access rules on all shared resources in the private network, and we <a href="https://monzo.com/blog/controlling-outbound-traffic-from-kubernetes">allowlist egress to the internet on a DNS-name basis and at a microservice-level</a>.</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/3g9uYiBkpe9b4JKQmULJ1a/49a672468cbe871b4d3f52fa8a391e0f/network_controls.png?w=1280&amp;q=90" alt="Diagram: Examples of network security controls within our platform"/></picture><p>We make sure these controls scale, both in terms of platform performance and developer productivity. For example, we now have more than 2000 microservices running on our platform. Since our deployment pipeline analyses service code on the main branch automatically to figure out valid network paths to other services and the internet, there is no more security overhead now compared to what it was in 2019.</p><p>For data and <a href="https://monzo.com/blog/2019/10/11/how-our-security-team-handle-secrets">secret access,</a> we have <a href="https://monzo.com/blog/2019/10/11/how-our-security-team-handle-secrets">templated policies</a> where each service can access resources namespaced to their name. For example, a Vault policy might look similar to this:</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/HEQRsXVlOC6M9n5IMscb3/7eca7938714f1f196c84f447ae8deddc/Screenshot_2022-03-31_at_14.14.20.png?w=1280&amp;q=90" alt="A template Vault policy."/></picture><p>The same is also used for assigning our services <a href="https://monzo.com/blog/2022/02/15/securely-delegating-trust-with-digital-signatures-and-secret-storage-systems">unique cryptographic identities</a> via a private public-key infrastructure (PKI), supported by <a href="https://monzo.com/blog/2021/11/18/protecting-our-most-sensitive-secrets">strong hardware security measures</a>.</p><p>For internet-facing traffic we receive, only load balancers terminating traffic for the backend endpoints they serve have public IP addresses, and firewall rules for subnets and resources ensure that they are the only components in our private network that can receive internet traffic. We are then able to focus on securing just a small set of network ingress paths.</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/1HL6WjslBeO5XpDnSm429z/eaa66ae24f211a612dbbd563ff51a7be/Authenticate_staff.png?w=1280&amp;q=90" alt="Diagram: How we authenticate Monzo staff when they access some of our internal systems through a VPN"/></picture><p>We authenticate connections from Monzo staff to all internal systems and infrastructure using their linked staff profiles before allowing access to any private network interfaces. All accesses to our internal systems require multiple authentication factors, which are less likely to be compromised at the same time. We are also careful about the toil that security measures generate. An example of this is how we <a href="https://monzo.com/blog/2019/03/19/improving-our-staff-VPN">improved our staff VPN system</a> using a combination of client credentials secured on laptops and a dynamic factor using mobile devices.</p><p>For all network access controls we implement, we also ensure we have good visibility of these controls in action. We export metrics and set up alerts to flag situations where the controls may be misbehaving or there may be indications of an attack, and these feed into <a href="https://monzo.com/blog/2022-02-24/scaling-our-on-call-process">our on-call system</a> to ensure that security engineers respond quickly to potential issues.</p><h3>Automation, automation, automation</h3><p>We highly prefer automating infrastructure changes to having engineers making manual changes. Our change management policy dictates that we require at least one other person to review a change, meaning if we allow manual changes from a laptop it’s much harder to enforce such policy.</p><p>For example any changes to AWS have to go through peer review, then changes would be automatically applied with Concourse to our staging environments. Once approved, merged and verified, engineers can trigger the same change to apply to production.</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/zN2PyxHSxiV3lV4LqxquN/bb71e90395bfd0095f70fe700a609f80/Concourse_pipeline.png?w=1280&amp;q=90" alt="Diagram: Concourse pipeline for Web Application Firewall (WAF) configurations, with s102 and s101 being our staging environments"/></picture><p>We strive to provide self-service security as much as possible at Monzo, by giving engineering teams tools and guard rails so that they could implement security without us being a blocker. For example, if an engineering team wants to create a new pipeline in Concourse delivering changes for another part of our infrastructure, there are well-defined guidance and templates for them to follow, which will then only require review and approval.</p><p>When human interventions are required, often due to an incident, we have “break glass” tools which allow us to respond quicker. We’ll talk about these later in this post.</p><h3>Technical controls to back security policies</h3><p>We prefer technically enforceable policies over paper-driven processes. Paper policies inform us what our technical controls should be, but they can’t be relied upon to prevent a security incident. When we mention that an action requires multi-party authorisation, we mean technical controls are in place to ensure the action can’t be performed unless it has been approved. This follows the “policy-as-code” principle.</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/5C8ccpULMtDCTzmGVtot1W/61cf62fdb235510cbb09c0ece6afcb8f/MPA.jpg?w=1280&amp;q=90" alt="Multi-party authorisation in our command-line tooling"/></picture><p>Our change management policy requires at least one engineer to have approved changes to production, so we’ve made our deployment pipeline require review from the owning teams and the PR to be merged before allowing deployments.</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/4BCDQJfZ9lQaX9iEymi5z0/39b05a9ae6185e3b80f3ef3234482186/MPA_for_deployments.jpg?w=1280&amp;q=90" alt="A screenshot of multi-party authorisation for deployments in our command-line tooling"/></picture><p>We’ve scaled this beyond engineering. Sensitive actions by our customer operations team and other parts of the company also require multi-party authorisation.</p><h3>Log everything and make use of the logs</h3><p>Each layer of our infrastructure produces audit logs, for example <a href="https://aws.amazon.com/cloudtrail/">CloudTrail events</a> from AWS and <a href="https://kubernetes.io/docs/tasks/debug-application-cluster/audit/">Kubernetes audit events</a> from our Kubernetes clusters. Various network components of our infrastructure also generate their own access logs or traffic logs. Across all audit sources, we log all actions by both human users and service accounts, with the highest level of detail recorded on actions that potentially impact the security of our customers’ money and data. Components handling data for the pipeline implement append-only permissions to protect the integrity of audit logs and logging systems.</p><p>We have pipelines delivering audit events into a centralised system for detecting potentially suspicious patterns, which sends alerts to our security teams for further investigation. Because we build and manage most of our own event pipelines, we can enrich the stateless audit events referencing specific resources or users with additional contextual information from the infrastructure that are related to their subjects. This information allows our alerting system to make refined decisions and improve the signal-to-noise ratio of our alerts.</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/77U0nRj2ZHbBydKkM6n1oT/5f116c3db45c2bf8832c91fc8db94449/audit_summary.png?w=1280&amp;q=90" alt="Diagram: How our event-driven pipelines ingest, store, and process audit events"/></picture><p>The advantage of having a centralised system for analysing events is that we can easily integrate events which are not directly linked to actions by humans, and process them in the same way as we handle audit events generated from sources such as AWS CloudTrail and Kubernetes.</p><p>Finally, when it comes to auditing shell sessions in our production compute instances and Kubernetes workloads, we require more than the typical metadata-level logs on who accessed which server at what time.</p><p>Engineers at Monzo make use of extensive automation and internal tooling to deliver backend changes safely and more efficiently without infrastructure access. Direct infrastructure access is limited to exceptional situations only, and when we allow engineers access, they have to do this via <a href="https://github.com/gravitational/teleport">Teleport</a> as an auditing proxy to preserve full visibility over their actions:</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/45SI20Too9P31RaYo8fAhP/dd5499e50486d2c67ce0dd1bb0841e0a/SSH.gif?w=1280&amp;q=90" alt="GIF: Playing back an SSH session through our auditing proxy, after an engineer has accessed a server via SSH"/></picture><h3><b>Breaking the glass safely</b></h3><p>Our banking platform works reliably the vast majority of the time, and so do the infrastructure access control systems running on the platform. But when there’s a problem, our engineers will need to <a href="https://monzo.com/blog/2019/07/08/how-we-respond-to-incidents">raise an incident</a> and fix it as soon as possible. Our security controls work in a “fail-closed” manner. So if the infrastructure access systems go down with the platform, they will not expose any additional access compared to when they were up.</p><p>However, we do need to let our platform engineers go in and fix the platform when this happens, and to do this we have implemented a set of backup access systems we call “break glass” systems. These systems provide us with the ability to access infrastructure components and internal tooling in an emergency, and are tested regularly by our engineers to ensure we can count on them in the event of a major incident.</p><p>Break glass systems need to have minimum dependency on other platform components so that they can work reliably in an incident, but this sometimes means that we can’t implement as many controls and logging systems as we would like for the regular access systems. However, we always ensure that when someone uses a break-glass access system, it will:</p><ul><li><p>trigger very loud alerts, and will immediately page security on-call engineers</p></li><li><p>require multi-party authorisation if necessary</p></li><li><p>provide the same level of audit scope and ability to identify the user as using the regular system</p></li></ul><h3>Permissions are least privileged</h3><p>Internal applications use role-based access controls where each role is scoped to a particular responsibility at the company. As a customer support specialist you may have dozens of roles based on your area of expertise and training, same applies to engineers.</p><picture><source srcset="https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=288&amp;q=90 288w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=328&amp;q=90 328w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=343&amp;q=90 343w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=361&amp;q=90 361w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=382&amp;q=90 382w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=576&amp;q=90 576w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=656&amp;q=90 656w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=674&amp;q=90 674w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=686&amp;q=90 686w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=722&amp;q=90 722w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=735&amp;q=90 735w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=764&amp;q=90 764w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=1348&amp;q=90 1348w, https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=1470&amp;q=90 1470w" media="" sizes="(max-width: 639px) 90vw, 640px"/><img src="https://images.ctfassets.net/ro61k101ee59/6UGWnJjxpHtjs0Fym4n14Q/07369166f356fe6ad7c29a555248346a/teleport_policy.png?w=1280&amp;q=90" alt="An example access policy configuring fine-grained SSH accesses"/></picture><p>For SaaS products we aim to achieve the same where possible. Being one of our most critical SaaS products, we write as tightly scoped IAM policies as practical for our AWS accounts; however not all SaaS products have a policy language. For those products we still try to align permissions assigned within them to be as close to least-privilege as possible.</p><p>We hold access review sessions at a regular cadence, during which each team responsible for a SaaS product or an internal product will review users of such system, their roles and associated policies. The process is highly structured and audited at least once per year.</p><h3>No shared credentials</h3><p>We require personal accounts for each staff so we can attribute actions to individuals. Where available, we enforce hardware tokens due to their many security benefits, including the ability to enforce our policy on no credential sharing internally.</p><p>This applies to internal applications such as our customer support portal, but also to all of our SaaS products that support a Single Sign-On (<a href="https://en.wikipedia.org/wiki/Single_sign-on">SSO</a>) protocol. We use a centralised Identity Provider (<a href="https://en.wikipedia.org/wiki/Identity_provider">IdP</a>) which we configure to always require multiple factors, including a possession factor such as a hardware token device.</p><h2>Conclusion</h2><p>This blog post provides an overview of the different principles we follow to protect the lowest layers of our banking platform. The Security Infrastructure team is just one of the many teams at Monzo who work on <a href="https://monzo.com/blog/how-we-protect-you">different parts of our banking platform to keep our customers safe</a>.</p><p>If you’re interested in building infrastructure as well as security, we are always looking for people who would be a great addition to our team, including <a href="https://grnh.se/89181f461us">backend engineers</a>.</p></article></div>
  </body>
</html>
