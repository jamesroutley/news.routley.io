<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.michaeldresser.io/posts/2021-11-27_how-to-parse-eve-chat-log.html">Original</a>
    
    <div id="readability-page-1" class="page">
        <p><a href="https://blog.michaeldresser.io/index.html">Home</a></p>
        

        <p>Date: 2021-11-27</p>

<blockquote>
<p>If you’d like to skip straight to the details, <a href="#how-to-parse-the-logs">click here</a></p>
</blockquote>
<p><a href="https://www.eveonline.com/">EVE Online</a> has many interesting properties that emerge from its “sandbox” environment, especially in the areas referred to as “nullsec” that have completely free-for-all PVP combat. Corporations (guilds, in common MMO parlance) form Alliances in nullsec, control regions of this slice of the in-game world, and perform various money-making activities there which often benefit from the Alliance’s control of the area. To keep track of enemy activity in Alliance-controlled space, Alliances usually have a common intel-sharing chat channel (think something like an IRC channel), where players post messages like <code>R1O-GN 3</code>, indicating that 3 hostile players have been spotted in the system <code>R1O-GN</code>. Players in the Alliance use this information to keep themselves safe by hiding or to seek out a fight by chasing down the enemies.</p>
<p>EVE conveniently stores chat logs in a file on disk. These logs can be found on Windows in the folder <code>C:\Users\yourusernamehere\Documents\EVE\logs\Chatlogs</code>. This data is available in a convenient text format for out-of-game tools to consume. Many EVE players have built utilities that use this data to provide audio alerts and visualizations of the intel information. For my own education, and for the fun of it, I decided to create something similar in Common Lisp to suit my personal needs. What follows are some short notes on how to parse on-disk EVE logs into a usable format in Common Lisp. I hope that it can also help others, as much of the information is not Lisp-specific.</p>
<h2 id="how-to-parse-the-logs">How to parse the logs</h2>
<blockquote>
<p>Many thanks to <a href="https://github.com/andrewpmartinez/py-eve-chat-mon">py-eve-chat-mon</a> which I referenced heavily when trying to figure out the format of the log file and what regular expressions to use for parsing.</p>
</blockquote>
<blockquote>
<p>Also, please note that I am very far from a Lisp expert. If you have any tips on improving this code, give me a shout!</p>
</blockquote>
<h3 id="read-the-log-file">Read the log file</h3>
<p>EVE uses UTF-16LE for chat. In Common Lisp, you can use <code>UIOP</code> to read the lines from the file using the correct format:</p>


<p>All chat logs come with a header, which I remove with a fairly hacky method that is based on identifying the dash <code>-</code> characters that delimit the header region.</p>

<h3 id="parse-components-of-the-message">Parse components of the message</h3>
<p>To then extract the relevant parts of the message (timestamp, author, message contents), I use the following (requires <a href="http://edicl.github.io/cl-ppcre/">CL-PPCRE</a>):</p>

<p>While I don’t think it should be necessary, the first <code>.*</code> (right after the <code>^</code>) is there because experimentally it didn’t work otherwise. I think it may have something to do with <a href="https://github.com/andrewpmartinez/py-eve-chat-mon/blob/31f7855abcbbe5de0d985ed9f7a8df54b9c3a635/py_eve_chat_mon/chat_message.py#L29">py-eve-chat-mon’s “chat line delimeter”</a> of <code>u&#34;\ufeff&#34;</code> which it removes from messages.</p>
<h3 id="further-parse-the-timestamp">Further parse the timestamp</h3>
<p>The timestamp can be further parsed, if necessary, with the following:</p>

    

</div>
  </body>
</html>
