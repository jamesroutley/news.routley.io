<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://alexn.org/blog/2022/09/09/scala-isnt-fun-anymore/">Original</a>
    <h1>Scala Isn&#39;t Fun Anymore</h1>
    
    <div id="readability-page-1" class="page"><div id="content" itemprop="articleBody">
<p>I‚Äôve just spent over a day, going to sleep at 1:00 am, to upgrade dependencies and fix eviction warnings in the build of a Scala project. Had to fix the usual suspects:</p>
<ul>
<li><a href="https://www.slf4j.org/">Slf4j-api</a> <code>1.7.x</code> evicted by <code>2.0.0</code>. They are binary backwards compatible, but the linking to the backend happens at runtime, so it can fail at runtime. This was a mix and match job. I had to downgrade <a href="https://github.com/tpolecat/doobie">Doobie</a> from <code>0.13.4</code> to <code>0.13.3</code>, because that one patch version also bumped HikariCP from <code>3.4.5</code> to <code>4.0.3</code>, which in turn bumped <code>slf4j-api</code>.</li>
<li><a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a>, also a mix and match job, because <a href="https://github.com/akka/akka-persistence-jdbc">akka-persistence-jdbc</a> also depends on it. I would have stayed on <code>4.0.3</code>, but Akka wants <code>3.4.x</code>, and I have no idea if they are compatible.</li>
<li><a href="https://github.com/scala/scala-xml">Scala-xml</a> <code>1.2.0</code> evicted by <code>2.1.0</code>; unfortunately we rely on Twirl templates, that require both a sbt plugin and a library dependency, and sbt plugins still rely on Scala 2.12, which require Scala-xml <code>1.2.0</code>. The fix was to forcefully upgrade to <code>2.1.0</code> and hope for the best.</li>
<li><a href="https://github.com/FasterXML/jackson">Jackson (JSON)</a> <code>2.11.4</code> evicted by <code>2.12.7</code> ‚Äî normally, in Java world, this would be fine, except that <a href="https://github.com/FasterXML/jackson-module-scala">jackson-module-scala</a> is sensitive to minor version bumps, and it fails at runtime (thank God we have unit tests); and we wouldn‚Äôt use <code>jackson-module-scala</code>, but ALAS, <a href="https://doc.akka.io/docs/akka/current/serialization-jackson.html">akka-serialization-jackson</a> depends on it. This was hard to fix, because it manifests as a weird runtime exception, and I had no idea where it came from or who‚Äôs complaining.
<ul>
<li>In case you‚Äôre wondering, we use <a href="https://github.com/circe/circe">Circe</a> too, but Circe has been fine this round, as nobody updated its minor version (<code>early-semver</code>).</li>
<li><strong>You can guess the maturity of any Scala project by the number of libraries it uses to do JSON parsing.</strong></li>
</ul>
</li>
<li><code>org.apache.kafka:kafka-clients</code> version <code>3.0.1</code> was also evicted by <code>7.0.5-css</code>; the former is used by <a href="https://github.com/akka/alpakka-kafka">akka-streams-kafka</a>, whereas the latter is required by <a href="https://github.com/confluentinc/schema-registry">kafka-avro-serializer</a>; no worries, I consulted this <a href="https://docs.confluent.io/platform/current/installation/versions-interoperability.html#cp-ak-compatibility">HTML table of compatibility</a> and I think they were compatible.</li>
</ul>
<p>Couple of months ago this list was bigger, but I prefer dropping dependencies causing issues like hot potatoes.</p>
<p>This was before I went in to fix the compilation and the test errors; at least Scala fails a lot at compile time, instead of runtime. Getting <code>sbt evicted</code> to stay silent can be a chore. In fairness, sbt is really sweet for the ability to turn eviction warnings to errors, by setting the <a href="https://www.scala-lang.org/blog/2021/02/16/preventing-version-conflicts-with-versionscheme.html">versioning schemes</a> for the required dependencies. Did I mention that I absolutely love sbt? (except for how freaking slow it is)</p>
<p>Anyway, this wasn‚Äôt fun:</p>
<div><div><pre><code><span>// https://www.scala-lang.org/blog/2021/02/16/preventing-version-conflicts-with-versionscheme.html</span>
<span>libraryDependencySchemes</span> <span>++=</span> <span>ourLibraryVersioningSchemes</span><span>,</span>
<span>// Configures eviction reports</span>
<span>evicted</span> <span>/</span> <span>evictionWarningOptions</span> <span>:=</span> <span>EvictionWarningOptions</span><span>.</span><span>default</span>
  <span>.</span><span>withWarnDirectEvictions</span><span>(</span><span>true</span><span>)</span>
  <span>.</span><span>withWarnEvictionSummary</span><span>(</span><span>true</span><span>)</span>
  <span>.</span><span>withWarnScalaVersionEviction</span><span>(</span><span>true</span><span>)</span>
  <span>.</span><span>withWarnTransitiveEvictions</span><span>(</span><span>true</span><span>)</span>
  <span>.</span><span>withShowCallers</span><span>(</span><span>true</span><span>),</span>
<span>// Checks evictions on resolving dependencies</span>
<span>update</span> <span>:=</span> <span>update</span><span>.</span><span>dependsOn</span><span>(</span><span>evicted</span><span>).</span><span>value</span><span>,</span>
</code></pre></div></div>
<p>PRO-TIP: to hunt down from where transitive dependencies come from, <code>sbt dependencyBrowseTreeHTML</code> is your friend üòâüòç</p>
<p>Many Scala libraries are really well maintained and stable (e.g., Cats), and we‚Äôve got the tools to do it, such as sbt being awesome at conditional/cross compilation, checking versioning schemes, or the availability of <a href="https://github.com/lightbend/mima">Mima</a>, a plugin meant to check for breakages of binary compatibility. It‚Äôs a useful case study in communities adapting to their sins. But being the user, and having to deal with all the breakage, is still painful as hell, and I feel that in general many libraries have no respect for downstream users suffering from breakage.</p>
<p>Speaking of versioning schemes, I‚Äôve set Akka‚Äôs stuff to <code>pvp</code>. This means that minor versions break compatibility, which should trigger eviction errors. Not sure if it will work. I hope we can pin it down to <code>2.6.20</code> (<a href="https://alexn.org/blog/2022/09/07/akka-is-moving-away-from-open-source/">the last Open Source version</a>) ü§∑‚Äç‚ôÇÔ∏è</p>
<p>This new development is such a shame, as in my experience Akka has been the gravitational force attracting a vast majority of the Java programmers (the ones into programming, not data science üòõ). That will be over soon. I wonder what will happen to the libraries depending on Akka. You may think of libraries meant for the enterprise, with corporate sponsorship, but what about libraries made by volunteers, like <a href="https://github.com/DanielaSfregola/twitter4s">Twitter4s</a>? Oh, well.</p>
<p>We‚Äôre left with the Scala FP communities, which yield awesome libraries and are awesome people, but the ecosystem is essentially a microcosm of the US political landscape. I‚Äôm guessing all programming communities are turning to this nowadays. As an Eastern European, however, it kind of pisses me off.</p>
<p>Maybe this is just me getting older (going to turn 40 soon). Maybe all programming is terrible. I‚Äôve actually started to read <a href="https://blog.jetbrains.com/idea/2022/09/java-annotated-monthly-september-2022/">Java newsletters</a>, maybe Spring isn‚Äôt that bad, I‚Äôm also having affectionate memories of JavaScript and Python, and thinking about having a plan B in case this programming thing doesn‚Äôt work out ü§∑‚Äç‚ôÇÔ∏è</p>
<p>Oh, <a href="https://alexn.org/blog/2020/10/10/when-my-world-vanishes/">how the mighty have fallen</a>!</p>
<p>Bye, going to reboot my MacBook, since IntelliJ wanted to reload the project, and nothing works anymore.</p>
</div><div id="article-details">
<p><time itemprop="dateModified" content="2022-09-09T20:07:03+0300">
Updated: September 9, 2022
</time>
| Written by </p>
</div></div>
  </body>
</html>
