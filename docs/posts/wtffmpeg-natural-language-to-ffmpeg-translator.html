<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/scottvr/wtffmpeg">Original</a>
    <h1>Show HN: WTFfmpeg â€“ Natural Language to FFmpeg Translator</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">wtffmpeg is a command-line tool that uses a local Large Language Model (LLM) to translate plain English descriptions of video and audio tasks into executable ffmpeg commands.</p>
<p dir="auto">Stop searching through Stack Overflow and documentation for that one specific ffmpeg flag. Just ask for what you want.</p>
<p dir="auto"><strong>Example:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="&gt; wtff &#34;convert my_video.avi to mp4 with no sound&#34;

Loading model... (this may take a moment)
Model loaded. Generating command...

--- Generated ffmpeg Command ---
ffmpeg -i my_video.avi -an -c:v libx264 my_video.mp4
------------------------------
Execute this command? [y/N] y

Executing: ffmpeg -i my_video.avi -an -c:v libx264 my_video.mp4

ffmpeg version N-100029-g040e989223 Copyright (c) 2000-2020 the FFmpeg developers
..."><pre><span>&gt;</span> wtff <span><span>&#34;</span>convert my_video.avi to mp4 with no sound<span>&#34;</span></span>

Loading model... (this may take a moment)
Model loaded. Generating command...

--- Generated ffmpeg Command ---
ffmpeg -i my_video.avi -an -c:v libx264 my_video.mp4
------------------------------
Execute this command<span>?</span> [y/N] y

Executing: ffmpeg -i my_video.avi -an -c:v libx264 my_video.mp4

ffmpeg version N-100029-g040e989223 Copyright (c) 2000-2020 the FFmpeg developers
...</pre></div>

<ul dir="auto">
<li>Natural Language Interface: Describe complex ffmpeg operations in plain English.</li>
<li>Local First: Runs entirely on your local machine. No data is sent to external APIs.</li>
<li>Interactive Execution: Reviews the generated command before giving you the option to execute it.</li>
<li>GPU Accelerated: Leverages llama-cpp-python to offload model layers to your GPU for faster inference.</li>
<li>Customizable: Easily swap out different LLM models or customize the system prompt to improve accuracy for your specific needs.</li>
</ul>

<p dir="auto">This project uses Python 3.8+ and is packaged with pyproject.toml.</p>
<ol dir="auto">
<li>Clone the Repository</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/scottvr/wtffmpeg.git
cd wtffmpeg"><pre>git clone https://github.com/scottvr/wtffmpeg.git
<span>cd</span> wtffmpeg</pre></div>
<ol start="2" dir="auto">
<li>Create a Virtual Environment</li>
</ol>
<p dir="auto">It is highly recommended to install the packages in a virtual environment.</p>
<div dir="auto" data-snippet-clipboard-copy-content="python3 -m venv .venv
source .venv/bin/activate"><pre>python3 -m venv .venv
<span>source</span> .venv/bin/activate</pre></div>
<ol start="3" dir="auto">
<li>Install llama-cpp-python with Hardware Acceleration</li>
</ol>
<p dir="auto">This is the most critical step. For the best performance, you should install llama-cpp-python with the correct build flags for your hardware before installing the project.</p>
<p dir="auto">For NVIDIA GPUs (CUDA):</p>
<div dir="auto" data-snippet-clipboard-copy-content="CMAKE_ARGS=&#34;-DLLAMA_CUBLAS=on&#34; pip install llama-cpp-python"><pre>CMAKE_ARGS=<span><span>&#34;</span>-DLLAMA_CUBLAS=on<span>&#34;</span></span> pip install llama-cpp-python</pre></div>
<p dir="auto">For Apple Silicon (Metal):</p>
<div dir="auto" data-snippet-clipboard-copy-content="CMAKE_ARGS=&#34;-DLLAMA_METAL=on&#34; pip install llama-cpp-python"><pre>CMAKE_ARGS=<span><span>&#34;</span>-DLLAMA_METAL=on<span>&#34;</span></span> pip install llama-cpp-python</pre></div>
<p dir="auto">For CPU Only (OpenBLAS):</p>
<div data-snippet-clipboard-copy-content="pip install llama-cpp-python"><pre><code>pip install llama-cpp-python
</code></pre></div>
<p dir="auto">Refer to the official llama-cpp-python documentation for other hardware configurations (ROCm, CLBlast, etc.) or for installation from prebuilt wheels.</p>
<ol start="4" dir="auto">
<li>Install wtffmpeg</li>
</ol>
<p dir="auto">Once llama-cpp-python is installed, you can install the project and its dependencies. This will also create the wtff command alias in your virtual environment.</p>


<ol dir="auto">
<li>Download a Model</li>
</ol>
<p dir="auto">This tool requires a model in the GGUF format. You can download models from Hugging Face. Good candidates include:</p>
<p dir="auto">Phi-3-mini-4k-instruct-gguf</p>
<p dir="auto">Mistral-7B-Instruct-v0.2-GGUF</p>
<p dir="auto">Download your chosen model and place it in the project directory.</p>
<p dir="auto">(Note: the default model file is Phi-3-mini-4k-instruct-q4.gguf, but you can override this with the --model option when running wtff.)
)</p>

<p dir="auto">Once installed and configured, you can use the wtff command directly from your terminal.</p>
<p dir="auto">Basic Usage:</p>
<div dir="auto" data-snippet-clipboard-copy-content="wtff &#34;your ffmpeg instruction in quotes&#34;"><pre>wtff <span><span>&#34;</span>your ffmpeg instruction in quotes<span>&#34;</span></span></pre></div>
<p dir="auto"><strong>Examples:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="# Convert a file
wtff &#34;turn presentation.mov into a web-friendly mp4&#34;

# Extract audio
wtff &#34;extract the audio from lecture.mp4 and save it as a high-quality mp3&#34;

# Create a clip
wtff &#34;create a 10-second clip from movie.mkv starting at the 2 minute mark&#34;

# Execute without confirmation
wtff -x &#34;resize video.mp4 to 720p&#34;

# Specify a different LLM and start interactive mode
wtff --model mistral-7b-instruct-v0.1.Q3_K_M.gguf -i"><pre><span><span>#</span> Convert a file</span>
wtff <span><span>&#34;</span>turn presentation.mov into a web-friendly mp4<span>&#34;</span></span>

<span><span>#</span> Extract audio</span>
wtff <span><span>&#34;</span>extract the audio from lecture.mp4 and save it as a high-quality mp3<span>&#34;</span></span>

<span><span>#</span> Create a clip</span>
wtff <span><span>&#34;</span>create a 10-second clip from movie.mkv starting at the 2 minute mark<span>&#34;</span></span>

<span><span>#</span> Execute without confirmation</span>
wtff -x <span><span>&#34;</span>resize video.mp4 to 720p<span>&#34;</span></span>

<span><span>#</span> Specify a different LLM and start interactive mode</span>
wtff --model mistral-7b-instruct-v0.1.Q3_K_M.gguf -i</pre></div>

<p dir="auto">Sometimes the model may generate commands that are not valid ffmpeg syntax or otherwise do not work as expected. In this example, I&#39;ll work in interactive mode, but the same principles apply in one-off mode.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ wtff -i
...
Model loaded.
Entering interactive mode. Type &#39;exit&#39; or &#39;quit&#39; to leave.
wtff&gt; reverse the video test_pattern.mp4
--- Generated ffmpeg Command ---
ffmpeg -i test_pattern.mp4 -vf &#34;reverse&#34; -c copy output.mp4
------------------------------
Execute? [y/N], or (c)opy to clipboard: N"><pre>$ wtff -i
...
Model loaded.
Entering interactive mode. Type <span><span>&#39;</span>exit<span>&#39;</span></span> or <span><span>&#39;</span>quit<span>&#39;</span></span> to leave.
wtff<span>&gt;</span> reverse the video test_pattern.mp4
--- Generated ffmpeg Command ---
ffmpeg -i test_pattern.mp4 -vf <span><span>&#34;</span>reverse<span>&#34;</span></span> -c copy output.mp4
------------------------------
Execute<span>?</span> [y/N], or (c)opy to clipboard: N</pre></div>
<p dir="auto">Here the model incorrectly added the <code>-c copy</code> flag, which is not valid when using a filter like <code>-vf &#34;reverse&#34;</code>, and had we executed this command, ffmpeg would have given us an explicit error telling us that the <code>-c copy</code> flag is not compatible with the filter.</p>
<p dir="auto">So while we <em>could</em> copy the commmand to our clipboard, and execute it with the <code>! command</code> syntax from within interactive mode after pasting and editing the command-line, let&#39;s edit our wtff prompt instead to ensure that the model does not add the <code>-c copy</code> flag in this case. We&#39;ll just up-arrow to get our prompt history and add a sentence to our prompt:</p>
<div dir="auto" data-snippet-clipboard-copy-content="wtff&gt; reverse the video test_pattern.mp4. Do not use `-c copy` in your command.

--- Generated ffmpeg Command ---
ffmpeg -i test_pattern.mp4 -vf &#34;reverse&#34; -c:v libx264 -crf 18 -pix_fmt yuv420p output.mp4
------------------------------
Execute? [y/N], or (c)opy to clipboard: "><pre>wtff<span>&gt;</span> reverse the video test_pattern.mp4. Do not use <span><span>`</span>-c copy<span>`</span></span> <span>in</span> your command.

--- Generated ffmpeg Command ---
ffmpeg -i test_pattern.mp4 -vf <span><span>&#34;</span>reverse<span>&#34;</span></span> -c:v libx264 -crf 18 -pix_fmt yuv420p output.mp4
------------------------------
Execute<span>?</span> [y/N], or (c)opy to clipboard: </pre></div>
<p dir="auto">That command will work just fine so we can either allow wtff to execute it, or we can copy it to our clipboard and execute it manually with <code>! command</code> syntax.</p>
<p dir="auto">The <code>!command</code> syntax is a feature of wtffmpeg that allows you to execute any command from within the wtff interactive mode. This is useful if you want to run a command that was generated by the model but needs some manual adjustments, or if you want to run a completely different command without leaving the interactive session. Like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="Model loaded.
Entering interactive mode. Type &#39;exit&#39; or &#39;quit&#39; to leave.
wtff&gt; !ls -l *.mp4

Executing: ls -l *.mp4

-rwxrwxrwx 1 scottvr scottvr 249093 Jul 22 21:30 output.mp4
-rwxrwxrwx 1 scottvr scottvr 243716 Jul 22 19:45 test_pattern.mp4

--- Command completed successfully ---
wtff&gt;"><pre>Model loaded.
Entering interactive mode. Type <span><span>&#39;</span>exit<span>&#39;</span></span> or <span><span>&#39;</span>quit<span>&#39;</span></span> to leave.
wtff<span>&gt;</span> <span>!</span>ls -l <span>*</span>.mp4

Executing: ls -l <span>*</span>.mp4

-rwxrwxrwx 1 scottvr scottvr 249093 Jul 22 21:30 output.mp4
-rwxrwxrwx 1 scottvr scottvr 243716 Jul 22 19:45 test_pattern.mp4

--- Command completed successfully ---
wtff<span>&gt;</span></pre></div>
<p dir="auto">So of course if you want to stay in interactive mode, you can have it copy the commands to your clipboard, type <code>!</code> and paste the contents of your clipboard, and then hit enter to execute the command, without having to leave that terminal, reload the model, etc.</p>

<p dir="auto">This was largely made to amuse myself; consider it a piece of humorous performance art but it so borders on being actually useful, I went to the trouble to document all of this. YMMV. Use at your own risk. The author is not responsible for any damage or data loss that may occur from using this tool. Always review generated commands before executing them, especially when working with important files.</p>
</article></div></div>
  </body>
</html>
