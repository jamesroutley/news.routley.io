<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.thepythoncodingstack.com/p/python-diffusion-simulation-demo-turtle">Original</a>
    <h1>A simplified Python simulation of diffusion</h1>
    
    <div id="readability-page-1" class="page"><div><div dir="auto"><p>How often has this happened to you? You think you understand a topic well. Then you realise that you hadn&#39;t quite understood it as well as you thought.</p><p>I&#39;ve been listening to the Feynman lectures in physics recently. Some of you may be familiar with these lectures. Richard Feynman was a brilliant physicist and an exceptional communicator. In the early 1960s, he was asked to deliver a two-year undergraduate physics course. This would have been &#34;beneath him&#34; as one of the most renowned physicists of his time. But Feynman loved teaching, and he was remarkably good at it. So he accepted on the condition he only delivers the course once!</p><p>Luckily for us, the lectures were recorded (audio-only, unfortunately).</p><p><span>What&#39;s this got to do with </span><em>The Python Coding Stack</em><span>? Some of you may know that I&#39;m a physicist by training, and I worked as a research scientist for many years. As someone with a PhD in physics, surely there&#39;s nothing to learn from listening to undergraduate-level lectures, right?</span></p><p>Wrong.</p><p>Even in the early lectures when Feynman was covering basic concepts, his descriptions and explanations led me to understand topics I &#34;knew well&#34; at a deeper level. Feynman&#39;s talent as a communicator was to help students visualise what&#39;s going on intuitively.</p><p>If we could transpose Richard Feynman to the present day, he would explain many of the concepts using Python simulations!</p><p>Recently, I&#39;ve been helping physics school teachers communicate ideas in physics and demonstrate key concepts using Python. Today&#39;s step-by-step tutorial is inspired by this work, and by one of Feynman&#39;s lectures.</p><p>But this is a Python publication, not a physics one. So, this article will focus on the coding, including looking at clever ways to optimise the simulation. Don&#39;t worry if you&#39;re not into physics. This article is mostly about Python!</p><p>I&#39;ll also simplify the physics concepts in this simulation. This is also a technique Feynman often used. When the priority is understanding the main concepts, cutting some corners is acceptable.</p><p>Here&#39;s the animation you&#39;ll create in this article. Notice how the particles collide with each other and with the sides:</p><p><em>I&#39;ll use one of my favourite modules in this tutorial, the </em><code>turtle</code><span> module. However, I plan to follow this tutorial with Part 2 in a few weeks, which will look at a different solution using NumPy and Matplotlib.</span></p><p><span>Let&#39;s start with a gas in a closed container. Let&#39;s simplify by saying that there are </span><em>particles</em><span> moving around the container, without worrying about the physical chemistry. And yes, let&#39;s make them perfect spheres, too.</span></p><p>These particles are moving around in random directions, and each one has a particular speed. In physics, we use the term velocity to represent the speed and direction of an object.</p><p>Each particle keeps moving with the same velocity—the same speed and direction—until it hits another particle or the sides of the container. We&#39;ll also assume all the particles are identical.</p><p>And one more simplification: the gas and its container exist in two dimensions. Who needs a third dimension?</p><p>Right, enough of the physics for now–it&#39;s time to start coding.</p><p><em><span>I&#39;ll assume you&#39;re familiar with the basics of object-oriented programming, but if you&#39;re not, you can </span><a href="https://thepythoncodingplace.com/the-python-coding-book/" rel="">read The Python Coding Book</a><span>, which has a chapter introducing OOP, or the seven-part Harry Potter-themed series on this topic here on The Python Coding Stack: </span><a href="https://www.thepythoncodingstack.com/p/a-magical-tour-through-object-oriented" rel="">A Magical Tour Through Object-Oriented Programming in Python • Hogwarts School of Codecraft and Algorithmancy</a></em></p><div><p><span>A few more seconds of your time before you carry on with the tutorial. I&#39;m making a number of </span><strong>free passes</strong><span> available for readers of The Stack to access the learning platform at </span><strong>The Python Coding Place</strong><span>. The passes give </span><strong>access to all the video courses for one week and a live session</strong><span>, similar to the ones I have weekly with members of The Python Coding Place. Here&#39;s the link to get your one week&#39;s pass:</span></p><p data-attrs="{&#34;url&#34;:&#34;https://thepythoncodingplace.com/free-one-week-python-coding-pass/&#34;,&#34;text&#34;:&#34;Get Free One Week Pass&#34;,&#34;action&#34;:null,&#34;class&#34;:null}" data-component-name="ButtonCreateButton"><a href="https://thepythoncodingplace.com/free-one-week-python-coding-pass/" rel=""><span>Get Free One Week Pass</span></a></p></div><p><span>Let&#39;s represent the container as a 2D simulation area. You can create a class to represent this area and create the screen as an attribute in this class. Let&#39;s define the class in </span><code>particles_simulation.py</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png" width="1200" height="924" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:924,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:114213,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8df7d42d-a5a9-48ad-a976-4d0b071e3176_1200x924.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>All code blocks are available in text format at the end of this article • #1</figcaption></figure></div><p>When you create an instance of this class, you&#39;ll need to pass the width and height in pixels, and you can optionally pass a colour if you don&#39;t want a white background.</p><p><span>The width and height are used to calculate the </span><em>x-</em><span> and </span><em>y-</em><span>coordinates representing the four sides of this 2D container. You&#39;ll need these to be integers later as you&#39;ll use them as arguments in </span><code>random.randint()</code><span>, so you can use the floor division operator </span><code>//</code><span> to ensure the values are integers.</span></p><p><span>The last four lines in the </span><code>.__init__()</code><span> special method create the screen using the </span><code>turtle</code><span> module. They set the size of this screen using the width and height. And </span><code>.bgcolor()</code><span> is the method in the </span><code>turtle</code><span> module that sets the background colour.</span></p><p><span>The </span><code>.tracer(0)</code><span> method ensures that changes to the state of </span><code>turtle</code><span> objects are not drawn on the screen instantly. Instead, you&#39;ll need to call </span><code>.update()</code><span>, which is a screen method in the </span><code>turtle</code><span> module. You can improve the interface by making this a </span><code>SimulationArea</code><span> method so that someone using this class doesn&#39;t need to access the </span><code>turtle</code><span> method directly:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png" width="1200" height="840" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:840,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:72996,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F22cb8548-c97f-47f6-ba5b-f02af208c574_1200x840.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#2</figcaption></figure></div><p><span>You also create a </span><code>.set_title()</code><span> method to provide access to the </span><code>turtle</code><span> module&#39;s method to update the window&#39;s title, and </span><code>.run_mainloop()</code><span> to call </span><code>turtle.mainloop()</code><span>, which is needed to run the event loop in the </span><code>turtle</code><span> module. If you&#39;re familiar with some of my other </span><code>turtle</code><span> tutorials, I often use the alias </span><code>turtle.done()</code><span> instead of </span><code>turtle.mainloop()</code><span>. They&#39;re the same function. The </span><code>.run_mainloop()</code><span> method doesn&#39;t need access to the data within the instance. So, it&#39;s a static method instead of an instance method.</span></p><p><span>Now, let&#39;s start working on a second script to run the demo: </span><code>run_demo.py</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png" width="1200" height="462" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:462,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:39345,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F89a4f18f-95cb-4b22-81a1-67252073ffdf_1200x462.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#3</figcaption></figure></div><p>When you run this script, Python creates the window that represents the 2D container:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png" width="1456" height="1100" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1100,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:453192,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F91b9df24-a59f-4738-8e45-b06310f4b98f_2224x1680.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>Now, we need to put some particles in the container and get them to move around.</p><p>We&#39;re making some assumptions to simplify this demo. One of these is to assume that the molecules in the gas are spheres. Let&#39;s just call them particles.</p><p><span>You can create a </span><code>Particle</code><span> class. Let&#39;s start by listing some of the attributes a particle should have:</span></p><ul><li><p><span>Position: This can be a list containing the </span><em>x-</em><span> and </span><em>y-</em><span>coordinates.</span></p></li><li><p><span>Velocity: This can be another list containing the </span><em>x-</em><span> and </span><em>y-</em><span>components of the particle&#39;s velocity. Each component can be a negative or positive number to account for direction.</span></p></li><li><p>Colour and size: These attributes enable you to customise the way each particle is displayed on the screen.</p></li></ul><p><span>You&#39;ll also need to link the particle with the container so that the particle can access information about the simulation area. Here&#39;s the class with the first part of the </span><code>.__init__()</code><span> method. We&#39;ll work on the position and velocity later:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png" width="1200" height="1050" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1050,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:98269,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F385a3498-95b1-4a82-8064-a96941e3f914_1200x1050.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#4</figcaption></figure></div><p><span>The class&#39;s </span><code>.__init__()</code><span> method includes several arguments. I used a type hint for </span><code>simulation_area</code><span> to clarify this is an instance of the </span><code>SimulationArea</code><span> class. Another advantage of using type hints for </span><code>.simulation_area</code><span> is that tools such as IDEs can assist with autocomplete and other aids.</span></p><p><span>The </span><code>Turtle()</code><span> object is the primary tool in the </span><code>turtle</code><span> module to create graphics. You could define </span><code>Particle</code><span> to inherit from </span><code>turtle.Turtle</code><span> so that a </span><code>Particle</code><span> object is also a </span><code>turtle.Turtle</code><span> object. However, I chose to create a </span><code>.particle</code><span> attribute containing a </span><code>turtle.Turtle()</code><span> object instead. This is a design choice you can make in situations like this.</span></p><p><span>The rest of the </span><code>.__init__()</code><span> method so far changes the shape and colour of the sprite representing the </span><code>Turtle</code><span> object, &#34;raises the pen up&#34; so that the </span><code>Turtle</code><span> object doesn&#39;t draw a line when it moves, and changes the size of the sprite. The </span><code>Turtle</code><span> method </span><code>.shapesize()</code><span> accepts a multiplicative factor as an argument. Therefore, the default value of </span><code>size_factor = 0.5</code><span> displays the sprite at half its default size. By default, a sprite in the </span><code>turtle</code><span> module occupies a 20 x 20 pixel area.</span></p><p><span>You can check that this code works in </span><code>run_demo.py</code><span>. Note that the import line now includes </span><code>Particle</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png" width="1200" height="588" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/ee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:588,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:53021,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee6a6293-e049-4cda-9fe3-b1168ba11e0d_1200x588.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#5</figcaption></figure></div><p><span>You also need to add </span><code>simulation_area.update()</code><span> to ensure the screen&#39;s display is updated. There&#39;s a particle in the middle of the container now:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png" width="1456" height="1100" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1100,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:448620,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F31bc4534-d05c-4d95-8dbf-9e9c510839e0_2224x1680.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><span>You can pass arguments for </span><code>position</code><span> and </span><code>velocity</code><span> when you create a </span><code>Particle</code><span> instance. However, these arguments are optional as they have a default value of </span><code>None</code><span>. If you need to create lots of particles, you want to create each particle in a random position in the container and assign a random velocity within a desired range.</span></p><p><span>Let&#39;s fix this by adding a few more lines to the </span><code>.__init__()</code><span> method. You also need to import the </span><code>random</code><span> module:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png" width="1290" height="2100" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:2100,&#34;width&#34;:1290,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:184491,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6e579366-cc18-408c-be02-957a2e0a9c21_1290x2100.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#6</figcaption></figure></div><p>Let&#39;s review the changes in this version:</p><ul><li><p><span>You import the </span><code>random</code><span> module, which you use in the </span><code>.__init__()</code><span> method.</span></p></li><li><p><span>You define a class attribute, </span><code>.MAX_VELOCITY</code><span>. This attribute is not specific to each instance of the class but is shared by all instances.</span></p></li><li><p><span>If </span><code>position</code><span> is the default value </span><code>None</code><span>, you assign a list containing two random values. The first value represents the </span><em>x</em><span>-position and is a random number between the left and right edges of the screen. The second value is the </span><em>y-</em><span>position, and it&#39;s chosen using the top and bottom edges as limits. The arguments in </span><code>random.randint()</code><span> need to be integers. This is why you use the floor division </span><code>//</code><span> when defining the edges of the container from the width and height values in </span><code>SimulationArea</code><span>.</span></p></li><li><p><span>If </span><code>velocity</code><span> is the default value </span><code>None</code><span>, you assign another list containing two random values. These represent the </span><em>x-</em><span> and </span><em>y-</em><span>components of the particle&#39;s velocity. Since </span><code>random.randint()</code><span> only deals with integers, you can create values with one digit after the decimal point using a bit of arithmetic. You multiply the minimum and maximum values you use as arguments in </span><code>random.randint()</code><span> by 10, but then you divide the answer by 10 again.</span></p></li></ul><p><span>Let&#39;s create 100 particles in </span><code>run_demo.py</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png" width="1200" height="588" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/e03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:588,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:57725,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe03b9621-56f9-47ee-8a53-07c3504548e2_1200x588.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#7</figcaption></figure></div><p><span>This code creates a list with 100 </span><code>Particle</code><span> objects. A </span><code>Turtle</code><span> object is created in the centre of the screen. Even though all the </span><code>Particle</code><span> objects have a </span><code>.position</code><span> attribute with </span><em>x-</em><span> and </span><em>y-</em><span>coordinates, you&#39;re not moving the </span><code>Turtle</code><span> objects to their new positions yet. We&#39;ll deal with this in the next section.</span></p><p><span>There are two key steps to start the animation and move all the particles. One of them is to create an animation loop in </span><code>run_demo.py</code><span>. But first, let&#39;s define </span><code>Particle.move()</code><span> in </span><code>particles_simulation.py</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png" width="1200" height="756" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/fa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:756,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:59192,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffa2b3439-403b-4a1b-b02d-b641fb846c76_1200x756.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#8</figcaption></figure></div><p><span>A particle&#39;s speed tells us how much the position changes in a specific time unit. Often, the unit is m/s in scientific applications. However, speed can be defined using any measure of distance and time. To keep this animation simple, you&#39;ll use </span><em>pixels per frame</em><span> as a measure of a particle&#39;s speed.</span></p><p><span>Therefore, each time the particle moves in the animation, its </span><em>x-</em><span>position changes by an amount equal to its velocity&#39;s </span><em>x-</em><span>component. And the </span><em>y-</em><span>position changes by the velocity&#39;s </span><em>y-</em><span>component.</span></p><p><span>The final line in </span><code>.move()</code><span> calls </span><code>.setposition()</code><span>, which is a method in the </span><code>turtle</code><span> module to place the </span><code>Turtle</code><span> object in its new position. Recall that </span><code>.particle</code><span> is the data attribute that represents the </span><code>Turtle</code><span> object.</span></p><p><span>Let&#39;s add the animation loop in </span><code>run_demo.py</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png" width="1272" height="882" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:882,&#34;width&#34;:1272,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:91251,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5a2c26a8-db17-407f-8f99-36fbc7b05b1c_1272x882.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#9</figcaption></figure></div><p><span>You call </span><code>.move()</code><span> for each particle in the list of 100 particles. The display is only updated after the </span><code>for</code><span> loop to ensure all particle positions are updated on the screen at the same time. Recall that you set </span><code>.tracer(0)</code><span> when setting up </span><code>SimulationArea</code><span> to prevent the sprites from being updated before you call </span><code>.update()</code><span>.</span></p><p><span>Here&#39;s the animation so far. Note that the speed of the animation may vary depending on your operating system and setup. You can adjust the class attribute </span><code>.MAX_VELOCITY</code><span> in the </span><code>Particle</code><span> class to control the speed of your animation.</span></p><p>You can see particles starting at random positions on the screen, moving in different directions at different speeds.</p><p>This is great, but we still need to do more work to get a basic animation running:</p><ul><li><p>Account for particles hitting the edges of the container/screen</p></li><li><p>Account for particles hitting each other</p></li></ul><p>Let&#39;s work on the edges of the container first.</p><p><span>Let&#39;s get back to the </span><code>.move()</code><span> method in </span><code>Particle</code><span>. You can check whether the particle has hit any of the four edges. If the particle hits the left or right edge, you can change the sign of the velocity&#39;s </span><em>x-</em><span>component. If the velocity&#39;s </span><em>x-</em><span>component is negative, the particle is moving towards the left. After it hits the side, it&#39;s moving towards the right, so the </span><em>x-</em><span>component is positive. The opposite happens on the other side.</span></p><p><span>And when the ball hits the top or bottom, you can swap the sign of the velocity&#39;s </span><em>y-</em><span>component. Let&#39;s add this to </span><code>.move()</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png" width="1326" height="1302" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/afb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1302,&#34;width&#34;:1326,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:121504,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fafb2c3c4-2749-452d-973c-be452bcd3319_1326x1302.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#10</figcaption></figure></div><p><span>Note that you shouldn&#39;t check for equality using </span><code>==</code><span> when checking whether the particle has hit any of the four sides since the particle&#39;s position may never be exactly equal to that side&#39;s coordinate.</span></p><p><span>For example, if the </span><em>x-</em><span>velocity is 3 pixels per frame, the particle&#39;s </span><em>x-</em><span>position changes by 3 pixels every time it moves in the animation. The particle may &#34;jump over&#34; the container side&#39;s </span><em>x-</em><span>coordinate when it moves. Instead, use </span><code>&lt;</code><span> for the negative values (left and bottom) and </span><code>&gt;</code><span> for the positive values (right and top) to check whether a particle has hit one of the container&#39;s sides.</span></p><p><span>And the nice thing about creating classes is that you don&#39;t need to make any changes to </span><code>run_demo.py</code><span> to verify whether this code works since you changed the definition of </span><code>Particle.move()</code><span>. Here&#39;s the animation now:</span></p><p>The particles stay in the container by bouncing off the sides.</p><p>But particles don&#39;t just collide with the container&#39;s sides. They also collide with each other. We&#39;re assuming the particles are spheres of the same mass. Here&#39;s another simplification: when particles collide, they always collide head-on. This is not the case in real life, but it&#39;s a reasonable simplification for a demonstration designed to help understand how gas particles move in a container.</p><p>Let&#39;s start with a method to check whether two particles have collided. You need to check whether the distance between the centres of two particles is less than a certain threshold. You can&#39;t check whether this distance is exactly zero, as was the case when checking whether a particle has hit the sides. To make the demo visually realistic, you can set the threshold to represent the centre-to-centre distance when the surface of one particle touches the surface of another.</p><p><span>By default, a sprite in the </span><code>turtle</code><span> module occupies a 20 x 20 pixel footprint. However, you increase or decrease this size when creating the </span><code>Particle</code><span> instance. You can access this size factor using the </span><code>Turtle</code><span> class&#39;s </span><code>.shapesize()</code><span> method. You used this method to set the size of the sprite in </span><code>Particle.__init__()</code><span>. However, you can call this method with no arguments since it returns a value representing the shape&#39;s size. The </span><code>.shapesize()</code><span> method returns a tuple containing the stretch factors along the </span><em>x-</em><span> and </span><em>y-</em><span>directions. The tuple also includes a third element, which I&#39;ll ignore here as it&#39;s not relevant.</span></p><p><span>Since you called </span><code>.shapesize()</code><span> with one argument when you created the </span><code>Turtle</code><span> object, you applied the same stretch along both </span><em>x-</em><span> and </span><em>y-</em><span>directions. Therefore, you can use either the first or the second element in the tuple returned by </span><code>.shapesize()</code><span> since they&#39;re equal:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png" width="1200" height="798" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/de9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:798,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:62014,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fde9180e9-0e81-4ba1-9a5c-f0cb3e880444_1200x798.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#11</figcaption></figure></div><p><span>The hard-coded value of 20 represents the default sprite size in the </span><code>turtle</code><span> module, and it&#39;s multiplied by the scaling factor you chose when creating the particle (or 0.5 if using the default, as we are doing in this example). This method calls </span><code>.distance()</code><span>, which is a method in the </span><code>turtle</code><span> library that returns the distance between two turtles. Recall that a </span><code>Turtle</code><span> object&#39;s position is the centre of the dot displayed. So, </span><code>.distance()</code><span> returns the centre-to-centre distance between two particles. The </span><code>.check_collision()</code><span> method returns a Boolean to indicate whether the particles have collided.</span></p><p><span>Now, you can define </span><code>.collide()</code><span>, which determines what happens when two particles collide. The assumption that particles all collide head-on will simplify this method. Those of you who want to create a more precise simluation can account for the correct geometry in this method. However, this won&#39;t make a huge difference to this demonstration:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png" width="1456" height="741" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:741,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:65070,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0a8ebed1-a5d3-490a-876f-dd8cca31d647_1650x840.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#12</figcaption></figure></div><p><span>When two particles of equal mass collide head-on (assuming an elastic collision), they simply swap their velocities. </span><em>Note: in future code snippets in this tutorial, I&#39;ll break this line into multiple lines to keep the overall width of the code narrower, but I left it as a single line on this first occasion as it&#39;s more readable.</em></p><p>Next, you need to check all the particles to find out which ones are colliding during each frame. In this part of the tutorial, we&#39;ll use the brute force approach. However, I&#39;ll look at a more efficient option later in this article. And Part 2, which I&#39;ll publish at a later date, will also examine different solutions.</p><p><span>Let&#39;s update </span><code>run_demo.py</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png" width="1200" height="882" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/940c1535-0170-4203-831e-45c8d788592e_1200x882.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:882,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:89088,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F940c1535-0170-4203-831e-45c8d788592e_1200x882.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#13</figcaption></figure></div><p>For each particle, you first move it, and then you check all the other particles in the container to look for collisions. This works. There&#39;s a &#34;but&#34; coming—several of them. Before we deal with the potential pitfalls, let&#39;s look at the animation now:</p><p>If you look closely at the animation, you&#39;ll notice some particles clumping together. There are a few issues we need to consider about the algorithm dealing with the collisions. Let&#39;s look at this in the next section.</p><p>First of all, let&#39;s consider a particle hitting itself. Eh?! That can&#39;t happen, right?</p><p><span>Right, but it currently happens in the code. Let&#39;s say you just moved particle A. The code in the </span><code>while</code><span> loop in </span><code>run_demo.py</code><span> loops through all the particles, including A itself. The distance between A and itself is zero, of course!</span></p><p>Now, this doesn&#39;t really matter since the particle is swapping velocities with itself when it collides with itself—this sentence is so weird out of context! So, no harm done. But it&#39;s tidier and a bit more efficient if we avoid this.</p><p><span>One option is to loop through an iterable that contains all the particles except particle A. In the inner </span><code>for</code><span> loop in the animation loop, instead of iterating through </span><code>particles</code><span> again, you could create a generator expression </span><code>(part for part in particles if part is not particle)</code><span>. It&#39;s best not to create a copy of </span><code>particles</code><span> with one particle removed, as that option uses up more memory.</span></p><p><span>As much as I love to use generators, in this case, I&#39;ll opt for a simpler and more readable option, which you can implement directly in </span><code>Particle.collide()</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png" width="1200" height="1092" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1092,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:82657,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F731f5a3b-0d19-49bb-ad11-85cf59843d87_1200x1092.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#14</figcaption></figure></div><p><span>When </span><code>.collide()</code><span> is called with the instance as its own argument so that </span><code>self</code><span> and </span><code>other_particle</code><span> are the same object, the method returns early.</span></p><p>The main issue with our algorithm is that if A collides with B, say, the animation loop may later find that B collides with A again, and the collision happens twice in the same frame. If this happens, you swap the velocities between A and B and then swap them back again in the same iteration of the game loop.</p><p><span>This </span><em>double collision</em><span> doesn&#39;t occur in most collisions in the animation since when A hits B, their positions change. So, it&#39;s possible that when it&#39;s B&#39;s turn, it&#39;s no longer close enough to A. However, this </span><em>double collision</em><span> does occur in some cases. This artefact gives rise to the clumping of particles you see in the animation.</span></p><p><span>One way of dealing with this is to keep track of which particles are in collision with each other within a frame. You can add a new attribute to </span><code>Particles</code><span> to keep a record of these particles:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png" width="1200" height="672" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/cee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:672,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:37829,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcee3a8f2-1eec-446c-ac8d-5ff5fe0e3351_1200x672.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#15</figcaption></figure></div><p><span>Next, you can update </span><code>.collide()</code><span> to ensure particles haven&#39;t already collided in the frame. You also need to add </span><code>self</code><span> to </span><code>other_particle.in_collision_with</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png" width="1200" height="1050" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/cba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1050,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:96404,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcba178e6-1021-4bb0-b2ac-57b531802746_1200x1050.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#16</figcaption></figure></div><p><em>Note: the highlights in the code blocks show new or modified lines compared to the previous step, but they don&#39;t show lines if only their indentation has changed.</em></p><p><span>Since you iterate through the particles in the animation loop, you&#39;ll always process one of the colliding particles before the other. Therefore, you only need to keep one record of the collision. If we consider particles A and B again, and let&#39;s say A comes first in the animation loop because it&#39;s at a lower index in the list of particles. You only need to store A in B&#39;s </span><code>.in_collision_with</code><span> list. There&#39;s no need to also store B in A&#39;s.</span></p><p>Let&#39;s go through the process step-by-step:</p><ul><li><p><span>Each particle has a list </span><code>.in_collision_with</code><span>.</span></p></li><li><p>When you&#39;re processing A and find that it collides with B, you execute the collision code, and you add A to B&#39;s list of collisions.</p></li><li><p>When it&#39;s B&#39;s turn to be processed, you check A&#39;s list of collisions. B will be in that list. Therefore, you skip the collision in this case.</p></li></ul><p><span>There&#39;s one problem. At some point, you need to remove a particle from the collision list of another particle to make sure you can deal with future collisions of the same pair of particles. Let&#39;s start by defining a method in </span><code>Particle</code><span> to provide an interface for removing particles:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png" width="1200" height="504" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/cf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:504,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:35445,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcf6eabdb-8675-4fbe-87ea-ec37f76991c7_1200x504.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#17</figcaption></figure></div><p><span>And you can call this method in an </span><code>elif</code><span> clause in the animation loop:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png" width="1200" height="756" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:756,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:65713,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F4ff4f740-16bc-4631-8495-232f41a62f5d_1200x756.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#18</figcaption></figure></div><p>If the particles aren&#39;t colliding in a frame, but one is on the collision list of the other, then you can remove the particle from the collision list. The collision must have occurred in the previous frame.</p><p>Here&#39;s the animation you get at this stage. Pick one particle and follow its path:</p><p>This is good enough for now. You may still get the odd glitch due to some edge cases, but this happens much less frequently now, if at all!</p><p>We&#39;ll explore another issue with this version later in this article.</p><p>Remember the motivation for writing this simulation? I&#39;ve been assisting physics school teachers with Python-based exercises to visualise physics concepts. Now that we have a simple model of gas molecules moving around in a 2D container, let&#39;s assume that we start the animation with one type of gas in the left half of the container and a different type of gas in the right half. I&#39;ll stick to the assumption that all particles are of equal mass, which is unlikely in the real-case scenario, but it doesn&#39;t affect the demo.</p><p><span>You can assign different colours to the particles depending on whether they&#39;re in the left or right half of the container. First, you can define two helper methods in </span><code>Particle</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png" width="1200" height="630" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:630,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:45450,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7e9278f9-50ef-4407-b81e-7f9d0a293da4_1200x630.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#19</figcaption></figure></div><p><span>The first of these methods, </span><code>.assign_colour()</code><span>, provides an interface to change the colour directly through the </span><code>Particle</code><span> class. Therefore, anyone using this class doesn&#39;t need to use the </span><code>turtle</code><span> module directly. The second method you define, </span><code>.get_position()</code><span>, is what some languages call a </span><em>getter</em><span> method. It provides access to the values of a data attribute without the need to access the data attribute directly. This step discourages a user from accessing </span><code>.position</code><span> and accidentally changing its value. There are other steps you can take to prevent </span><code>.position</code><span> from being modified by mistake, but I won&#39;t go down that path in this tutorial.</span></p><p><span>Now, you can replace the list comprehension that creates the 100 particles in </span><code>run_demo.py</code><span> to assign different colours to particles in the left and right halves of the container:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png" width="1200" height="882" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/ee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:882,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:90129,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fee714179-74b1-4301-8ac8-0523b8a06858_1200x882.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#20</figcaption></figure></div><p><span>The middle of the screen corresponds to </span><em>x</em><span> = 0. Therefore, you colour those particles with an </span><em>x-</em><span>position less than zero in one colour and the rest in another colour. The hex colours are the main brand colours for </span><em>The Python Coding Stack</em><span> (and </span><em><a href="https://thepythoncodingplace.com/" rel="">The Python Coding Place</a></em><span>)!</span></p><p>Here&#39;s the animation. Notice how all the green particles are in the left half and all the orange ones on the right at the start of the animation. However, the gasses gradually diffuse so that after some time, there&#39;s an equal number of green and orange particles in both halves:</p><p>The random motion and collisions lead to an even distribution of the two gasses within the container.</p><p><span>Here&#39;s the full code so far for reference. First, </span><code>particles_simulation.py</code><span>, which contains the two classes:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png" width="1326" height="5208" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:5208,&#34;width&#34;:1326,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:601974,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3f412c2e-5abd-4f30-8360-01dce12df830_1326x5208.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#21</figcaption></figure></div><p><span>And next, </span><code>run_demo.py</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png" width="1200" height="1260" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/d4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1260,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:143366,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4fb74cc-bf80-459e-93f1-b78cbdefe69c_1200x1260.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#22</figcaption></figure></div><p><em>Breathe! This is a long article, and there&#39;s plenty going on. If you&#39;re looking for a good place to stop for the day and return to this article another day, this is it.</em></p><p><em>Or you can proceed directly to the second half of the article, which looks at a clever optimisation technique to deal with the slowing down you&#39;ll see as you add more particles.</em></p><p><em>…and if you&#39;re pausing here, don&#39;t forget to come back later!</em></p><p>Great. Let&#39;s add more particles! I just noticed that the number of particles, currently 100, is hard-coded in the current version. Let&#39;s create a variable and assign a larger number to it:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png" width="1200" height="966" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/a0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:966,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:99110,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa0d9121e-14aa-4fa1-ac7d-abd96454c13e_1200x966.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#23</figcaption></figure></div><p>Here&#39;s the problem. This video is recorded using the same settings as all the previous videos:</p><p>It&#39;s slow. Painfully slow. Life&#39;s too short to wait for this animation to reach a state when sufficient diffusion has occurred.</p><p><span>The problem is that our nested </span><code>for</code><span> loops are not efficient. You need to loop through all the particles to move each one. You can&#39;t quite avoid that! But the current algorithm loops through each particle again for every particle. Let&#39;s go back to particles labelled with letters, and let&#39;s start with particle A. After you move particle A, you iterate through all the particles A, B, C, D, E, and so on to check whether A has collided with them.</span></p><p>Then, it&#39;s B&#39;s turn to move. And once more, you iterate through the same full list of particles A, B, C, D, E, and so on to check for collisions. And you repeat this process for every particle. The computations needed increase rapidly as you add more particles, slowing the animation. Those familiar with Big-O notation may recognise this as O(n^2) but don&#39;t worry if you&#39;re not.</p><p>However, a lot of this work is unnecessary. Take particle A, wherever it is in the container. At any point in time, it&#39;s too far away from most of the other particles to be able to collide with them. So, it&#39;s wasteful to check all the particles for particle A. Let&#39;s find a better way.</p><p>What if we divide the whole simulation area into a grid? Then, we figure out which cell each particle is in. Finally, we only check for collisions within each cell separately instead of over the whole area. This avoids checking whether a particle in one corner of the container is about to collide with a particle at the other end!</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png" width="1000" height="700" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/6068811c-442a-44af-853b-d80632aafd2f_1000x700.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:700,&#34;width&#34;:1000,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:559781,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F6068811c-442a-44af-853b-d80632aafd2f_1000x700.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>This approach splits the simulation area into many smaller ones. Since there are fewer particles in each cell, checking for collisions is quicker using this approach.</p><p><span>But don&#39;t take my word for it. Let&#39;s make changes to </span><code>SimulationArea</code><span> and </span><code>Particles</code><span> to implement this technique.</span></p><p><span>Let&#39;s start with </span><code>SimulationArea</code><span>, and add a new parameter to its </span><code>.__init__()</code><span> method to define the size of the grid. The efficiency gains will depend on how many cells you have in the grid. You can also work out the width and height of each cell and create a dictionary to keep track of which particles are in which cell:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png" width="1380" height="1470" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1470,&#34;width&#34;:1380,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:170450,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F94d736d0-66dc-49a2-8f43-ba0be4a21786_1380x1470.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#24</figcaption></figure></div><p><span>The data attribute </span><code>.cells</code><span> is a dictionary. The keys are tuples of indices representing each cell in the grid. We&#39;ll use </span><em>i</em><span> and </span><em>j</em><span> to represent the indices or coordinates of the cells and </span><em>x</em><span> and </span><em>y</em><span> to represent the pixel coordinates of the particles. In this animation, the tuple </span><code>(0, 0)</code><span> represents the cell in the bottom left corner, and so on. The value associated with each key is an empty list. You&#39;ll add particles to these lists later.</span></p><p><span>The default grid size defined in the signature is 1 x 1, which is equivalent to having no grid at all. But you&#39;ll be testing this code with grids with more than one cell. So, in </span><code>run_demo.py</code><span>, you can update the call to </span><code>SimulationArea()</code><span> to set the grid size:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png" width="1200" height="546" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/e5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:546,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:43816,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe5f4c336-3614-45d6-a133-1ff8cb71e7c7_1200x546.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#25</figcaption></figure></div><p>Since the simulation area is 1000 x 700 pixels, you can choose a grid of 10 x 7 for now to keep things simple. This means that each cell is 100 x 100 pixels.</p><p><span>Next, you need to assign each particle to one of these cells. You can start by defining a </span><code>.cell</code><span> data attribute in </span><code>Particle.__init__()</code><span>. Initially, you can assign </span><code>None</code><span> to this attribute:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png" width="1200" height="588" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:588,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:29449,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8e036888-5a8f-42d5-a5b0-8cc8bbe9ee4b_1200x588.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#26</figcaption></figure></div><p>The code needs to associate each particle with a cell based on the particle&#39;s position. You need to perform this operation at the start of the animation when you create each particle in a random position on the screen. However, you also need to reassign the particles to a new cell each time they move from one cell to the next as they&#39;re moving around the container.</p><p><span>Let&#39;s focus on the horizontal dimension first. You can find the difference between a particle&#39;s </span><em>x-</em><span>position and the left edge of the container and divide by the width of a cell. For example, let&#39;s consider a particle with an </span><em>x-</em><span>coordinate of -424. The simulation area is 1000 pixels wide. Therefore, the left edge is at -500 since the centre of the container is 0. The difference between these values is 76, which means that the particle is 76 pixels from the left edge.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png" width="1000" height="700" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:700,&#34;width&#34;:1000,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:22508,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F958bc023-0d18-4fec-a884-0ac5827f2517_1000x700.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><span>If the simulation area is split into a 10 x 7 grid, the width of each cell is 100 pixels. Therefore, the particle is in the first column of cells from the left since these cells include any particles that are within 100 pixels of the left edge. The index </span><em>i</em><span> is equal to 0 for all cells in the first column. Since 76 divided by 100 is 0.76, you can find the index by taking the floor of this value, </span><code>76 // 100</code><span>.</span></p><p><span>A new method, </span><code>.assign_to_cell()</code><span>, can deal with this calculation:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png" width="1254" height="924" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:924,&#34;width&#34;:1254,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:76647,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3fcd2894-ebd0-44b8-b232-fda5f8b27353_1254x924.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#27</figcaption></figure></div><p><span>The local variables </span><code>cell_i</code><span> and </span><code>cell_j</code><span> contain the </span><em>i</em><span> and </span><em>j</em><span> indices that represent the cell. If you&#39;re using a 10 x 7 grid, there are ten columns of cells with indices 0 to 9. However, particles can briefly have an </span><em>x-</em><span>coordinate that&#39;s further left from the left edge. For example, if a particle is at </span><em>x </em><span>= -499 and it&#39;s moving at 2 pixels per frame, it will move to </span><em>x</em><span> = -501 in the next frame. You&#39;ll recall that you reverse the horizontal velocity of these particles so that they bounce back into the container on the following iteration. However, the calculation in </span><code>.assign_to_cell()</code><span> assigns this particle to a non-existant cell with index -1. You need to correct this and for a similar issue on the remaining three sides of the container:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png" width="1254" height="1302" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1302,&#34;width&#34;:1254,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:132262,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F579e3c3d-3a63-4f9f-9969-57a0690cf7cb_1254x1302.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#28</figcaption></figure></div><p><span>Note that the right and top side corrections are inclusive, whereas the left and bottom ones are exclusive. A particle with </span><em>x </em><span>= 0 goes in the cell with </span><em>i </em><span>= 0, but a particle with </span><em>x </em><span>= 500 goes in the cell with </span><em>i </em><span>= 9 even though 1000 / 100 = 10.</span></p><p><span>You determined the </span><em>i</em><span> and </span><em>j</em><span> indices corresponding to the particle&#39;s cell. If this is the first time you&#39;re assigning a particle to a cell, which occurs when you create the particle at the beginning of the animation, you need to perform two steps:</span></p><ol><li><p><span>Store the </span><em>i</em><span> and </span><em>j</em><span> indices in the particle&#39;s </span><code>.cell</code><span> attribute. You set this attribute to </span><code>None</code><span> when you created it.</span></p></li><li><p><span>Place the particle in the correct list in </span><code>simulation_area.cells</code><span>. This is the dictionary containing all the particles in each cell. The tuple with the cell indices is the key in this dictionary.</span></p></li></ol><p><span>Here are these two steps added to </span><code>.assign_to_cell()</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png" width="1254" height="1554" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/dfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1554,&#34;width&#34;:1254,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:164620,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdfecc2be-d442-4357-84e8-ced2df3271ae_1254x1554.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#29</figcaption></figure></div><p>However, during the rest of the animation, you need to check whether the particle has drifted into a different cell. Here are the scenarios:</p><ol><li><p>If the particle is still in the same cell, do nothing.</p></li><li><p>If the particle is no longer in the same cell:</p><ul><li><p><span>Remove it from the current cell in </span><code>simulation_area.cells</code></p></li><li><p><span>Assign the new indices to the particles </span><code>.cell</code><span> attribute</span></p></li><li><p><span>Place the particle in the new cell in </span><code>simulation_area.cells</code></p></li></ul></li></ol><p><span>Let&#39;s implement this logic by adding an </span><code>elif</code><span> clause to the </span><code>if</code><span> statement from the previous step:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png" width="1456" height="1767" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/f35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1767,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:210320,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff35d3911-b352-4210-813e-4fe2252701a4_1488x1806.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#30</figcaption></figure></div><p>You need to call this method in two places within the class:</p><ol><li><p>When you create each particle</p></li><li><p>When you move each particle</p></li></ol><p><span>Let&#39;s conclude this section by adding these two calls at the end of </span><code>.__init__()</code><span> and </span><code>.move()</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png" width="1200" height="882" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:882,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:48019,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75a5f3f7-24be-4ae5-9672-4c02b3917da8_1200x882.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#31</figcaption></figure></div><p><span>Let&#39;s add a few temporary lines in </span><code>run_demo.py</code><span>. You can pick one particle as a sample. Let&#39;s pick the first one in the list. Each time this particle moves, you can display the indices of the cell it belongs to on the screen.</span></p><p>Here are the changes you need. You can reduce the number of particles to 50 in this section to ensure you can spot the odd one out:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png" width="1218" height="1134" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/c947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1134,&#34;width&#34;:1218,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:92134,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc947f60f-26a5-41a5-8b2f-a028e3819fec_1218x1134.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#32</figcaption></figure></div><p>You need to clear the writing from the previous iteration and write the new indices in each iteration. Here&#39;s the animation showing the cell indices for one of the particles. Look for the particle with a label next to it:</p><p><span>Even though the grid is not shown, you can see the particle moving from one cell to another when the indices change. Recall that you created a 10 x 7 grid. Therefore, the </span><em>i</em><span> indices range from 0 to 9 and the </span><em>j</em><span> indices from 0 to 6.</span></p><p>Before moving on to improving the main collision algorithm, let&#39;s work on another visualisation. You can pick a cell and change the colour of any particle in that cell. This will show us particles entering and exiting cells by changing their colours.</p><p>For this exercise, you can use more particles and a smaller grid size. The smaller grid size leads to larger cells, and more particles ensure that there are always several particles in the cells.</p><p><span>You can add a few more temporary lines in the </span><code>for</code><span> loop within the </span><code>while</code><span> loop:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png" width="1218" height="1344" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1344,&#34;width&#34;:1218,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:132541,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F375f54dd-37d8-45ee-a72f-69c1968f08e8_1218x1344.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#33</figcaption></figure></div><p><span>The particles in cell </span><code>(1, 1)</code><span> will light up in a different colour to the rest. The grid is 4 x 3 in this example. Here&#39;s the animation:</span></p><p><span>The particles that enter cell </span><code>(1, 1)</code><span> turn purple, and then they turn grey again when they exit the cell.</span></p><p>You can now remove or comment out the temporary code you wrote in this section.</p><p><span>The final step is to change the iteration in the </span><code>while</code><span> loop to check for collisions only within a cell in the grid instead of across the whole simulation area.</span></p><p><span>You can loop through the values of the dictionary </span><code>simulation_area.cells</code><span>, and then you can loop through each particle in each cell. Before making the change in the animation loop, let&#39;s create a helper function in </span><code>SimulationArea</code><span> to facilitate accessing the values in </span><code>simulation_area.cells</code><span>:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png" width="1200" height="630" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:630,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:42430,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F059304f2-ea2e-4470-a596-d0f8be686fc7_1200x630.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#34</figcaption></figure></div><p><span>This method ensures that anyone using the </span><code>SimulationArea</code><span> doesn&#39;t need to dive too deeply into the class&#39;s implementation. Note that I&#39;m not including docstrings in this example since it&#39;s part of a detailed tutorial. However, these methods normally have docstrings to assist users.</span></p><p><span>Finally, let&#39;s update the animation loop in </span><code>run_demo.py</code><span>. You can also go back to using 500 particles, which led to a very slow animation earlier in this tutorial. You should increase the number of cells by returning to a grid size of 10 x 7:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png" width="1272" height="1386" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1386,&#34;width&#34;:1272,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:163128,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F43ff45c5-5367-48cf-9b49-b4ce78f18bb8_1272x1386.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#35</figcaption></figure></div><p><em>A reminder that the highlighted lines are the ones with changes in the code. However, the rest of the lines in the </em><code>while</code><span> loop have also changed as their level of indentation increased.</span></p><p>You divide the animation into several smaller units within each cell. Particles can still move from one cell to another, of course. However, the time-consuming collision checks are significantly reduced.</p><p>Here&#39;s the final animation:</p><p>Compare this with the attempt to run the basic version of the simulation with 500 particles! This simulation is much smoother. In the appendix, I&#39;ll compare the performance of the two methods and the effect of different grid sizes.</p><p>You can see the gradual diffusion of the two gasses leading to a homogenous distribution after some time. The random movement of particles and the collisions between them are all we need to explain diffusion. Feynman explains many physical processes using this type of visualisation—but using diagrams and imagination instead of Python demonstrations!</p><p><span>The final versions of </span><code>particles_simulation.py</code><span> and </span><code>run_demo.py</code><span> are available below, after the conclusion.</span></p><p>A reminder: I&#39;m simplifying physics concepts and cutting some corners since this is a demonstration rather than a more rigorous real-world simulation. For example, if two particles are sufficiently close to each other to collide but are on opposite sides of the boundary between two cells, they won&#39;t collide in the code. You could place particles close enough to a boundary in two cells, but you&#39;ll need to tidy up other parts of the code for this since the code currently assumes that a particle can only be in one cell at any one time.</p><p>This article is already long—very long. So, I&#39;ll conclude the main article here. However, I can&#39;t resist adding a bit more in two appendices. Firstly, I&#39;ll compare the efficiency gains of this method by comparing different grid sizes—and none at all! Secondly, I&#39;ll add a metric to monitor the diffusion more quantitatively.</p><p><span>And if that&#39;s not enough, I&#39;ll follow this article with Part 2 in a few weeks, exploring yet another technique using Python tools other than </span><code>turtle</code><span>.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp" width="522" height="522" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/f4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1024,&#34;width&#34;:1024,&#34;resizeWidth&#34;:522,&#34;bytes&#34;:1369264,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/webp&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4d08f62-c5b8-4307-8c88-10aea921585a_1024x1024.webp 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><em>Code in this article uses Python 3.12</em></p><div><figure><a target="_blank" href="https://thepythoncodingplace.com/free-one-week-python-coding-pass/" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png" width="1456" height="420" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:420,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:1012371,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:&#34;https://thepythoncodingplace.com/free-one-week-python-coding-pass/&#34;,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F140a9575-fb85-42f8-bdfc-1315694f60a9_2080x600.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><pre><code> # particles_simulation.py
 ​
 import random
 import turtle
 ​
 class SimulationArea:
     def __init__(self, width, height, colour=&#34;white&#34;, cell_grid=(1, 1)):
         self.width = width
         self.height = height
         # Define the edges of the simulation area as integers
         # (we&#39;ll need them as integers later)
         self.left_edge = -width // 2
         self.right_edge = width // 2
         self.top_edge = height // 2
         self.bottom_edge = -height // 2
         # Create a turtle screen object
         self.window = turtle.Screen()
         self.window.setup(width, height)
         self.window.tracer(0)
         self.window.bgcolor(colour)
 ​
         # Define the cell grid
         self.cell_grid = cell_grid
         self.cell_width = width / cell_grid[0]
         self.cell_height = height / cell_grid[1]
         self.cells = {
             (i, j): []
             for i in range(cell_grid[0])
             for j in range(cell_grid[1])
         }
 ​
     def update(self):
         self.window.update()
 ​
     def set_title(self, title):
         self.window.title(title)
 ​
     @staticmethod
     def run_mainloop():
         turtle.mainloop()
 ​
     def get_sequence_of_cells(self):
         return self.cells.values()
 ​
 class Particle:
     MAX_VELOCITY = 4
 ​
     def __init__(
         self,
         simulation_area: SimulationArea,
         position=None,
         velocity=None,
         colour=&#34;black&#34;,
         size_factor=0.5,
     ):
         self.simulation_area = simulation_area
         self.particle = turtle.Turtle()
         self.particle.shape(&#34;circle&#34;)
         self.particle.color(colour)
         self.particle.penup()
         self.particle.shapesize(size_factor)
         if position is None:
             position = [
                 random.randint(
                     self.simulation_area.left_edge,
                     self.simulation_area.right_edge,
                 ),
                 random.randint(
                     self.simulation_area.bottom_edge,
                     self.simulation_area.top_edge,
                 ),
             ]
         self.position = position
         if velocity is None:
             velocity = [
                 random.randint(
                     -self.MAX_VELOCITY * 10, self.MAX_VELOCITY * 10
                 ) / 10,
                 random.randint(
                     -self.MAX_VELOCITY * 10, self.MAX_VELOCITY * 10
                 ) / 10,
             ]
         self.velocity = velocity
 ​
         self.in_collision_with = []
         self.cell = None
         self.assign_to_cell()
 ​
     def assign_to_cell(self):
         # Convert the x and y coordinates to cell indices i and j
         cell_i = int(
             (self.position[0] - self.simulation_area.left_edge)
             // self.simulation_area.cell_width
         )
         cell_j = int(
             (self.position[1] - self.simulation_area.bottom_edge)
             // self.simulation_area.cell_height
         )
         # Ensure the cell indices are within the grid
         if cell_i &lt; 0:
             cell_i = 0
         elif cell_i &gt;= self.simulation_area.cell_grid[0]:
             cell_i = self.simulation_area.cell_grid[0] - 1
         if cell_j &lt; 0:
             cell_j = 0
         elif cell_j &gt;= self.simulation_area.cell_grid[1]:
             cell_j = self.simulation_area.cell_grid[1] - 1
 ​
         # Add the particle if it&#39;s not already in the
         # cell (first iteration)
         if not self.cell:
             self.cell = (cell_i, cell_j)
             self.simulation_area.cells[self.cell].append(self)
         elif self.cell != (cell_i, cell_j):
             # Remove the particle from the current cell
             self.simulation_area.cells[self.cell].remove(self)
             # Update the cell assignment
             self.cell = (cell_i, cell_j)
             # Add the particle to the new cell
             self.simulation_area.cells[self.cell].append(self)
 ​
     def move(self):
         self.position[0] += self.velocity[0]
         self.position[1] += self.velocity[1]
 ​
         # Bounce off the edges
         if (
                 self.position[0] &lt; self.simulation_area.left_edge
                 or self.position[0] &gt; self.simulation_area.right_edge
         ):
             self.velocity[0] *= -1
         if (
                 self.position[1] &lt; self.simulation_area.bottom_edge
                 or self.position[1] &gt; self.simulation_area.top_edge
         ):
             self.velocity[1] *= -1
 ​
         self.particle.setposition(self.position)
         self.assign_to_cell()
 ​
     def check_collision(self, other_particle):
         return (
             self.particle.distance(other_particle.particle)
             &lt; 20 * self.particle.shapesize()[0]
         )
 ​
     def collide(self, other_particle):
         &#34;&#34;&#34;
         This assumes that the particles are of equal mass and
         that the collision is a head-on elastic collision.
         &#34;&#34;&#34;
         if other_particle is self:
             return
         if self not in other_particle.in_collision_with:
             self.velocity, other_particle.velocity = (
                 other_particle.velocity,
                 self.velocity,
             )
             # Keep a record of collision in other_particle.
             # No need to keep it in self
             other_particle.in_collision_with.append(self)
 ​
     def remove_collision(self, other_particle):
         self.in_collision_with.remove(other_particle)
 ​
     def assign_colour(self, colour):
         self.particle.color(colour)
 ​
     def get_position(self):
         return self.position</code></pre><pre><code> # run_demo.py
 ​
 from collections import deque
 ​
 from particles_simulation import SimulationArea, Particle
 ​
 n_particles = 500
 ​
 simulation_area = SimulationArea(1000, 700, cell_grid=(10, 7))
 simulation_area.set_title(&#34;Diffusion Demo&#34;)
 ​
 particles = []
 for _ in range(n_particles):
     particle = Particle(simulation_area)
     if particle.get_position()[0] &lt; 0:
         particle.assign_colour(&#34;#1A6B72&#34;)
     else:
         particle.assign_colour(&#34;#FDB33B&#34;)
     particles.append(particle)
 ​
 # Animation loop
 while True:
     for cell in simulation_area.get_sequence_of_cells():
         for particle in cell:
             particle.move()
             for other_particle in cell:
                 if particle.check_collision(other_particle):
                     particle.collide(other_particle)
                 elif other_particle in particle.in_collision_with:
                         particle.remove_collision(other_particle)
 ​
     simulation_area.update()</code></pre><p><span>You can see the difference between the animation speeds when you use the grid approach. But let&#39;s time the execution under different grid conditions. To make the comparisons, you can set a seed in the </span><code>random</code><span> module to ensure all the starting conditions are identical:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png" width="1200" height="504" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:504,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:30665,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5323c611-309c-46ce-aa9a-452a3d5f1921_1200x504.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#36</figcaption></figure></div><p><span>You can use any integer as an argument in </span><code>random.seed()</code><span>.</span></p><p><span>You can also comment the </span><code>.update()</code><span> call out in the animation loop to prevent the frames from being displayed. This allows you to time the operations in the </span><code>while</code><span> loop without including the time it takes to update the screen. Note that as a result of this change, you won&#39;t see any output when you run this code.</span></p><p>Finally, you can run the animation for a fixed number of iterations and time the execution time:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png" width="1398" height="1260" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1260,&#34;width&#34;:1398,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:132999,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1165492c-44d9-4a65-8332-f09c1e391e5a_1398x1260.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#37</figcaption></figure></div><p><span>The </span><code>cell_grid</code><span> argument in </span><code>SimulationArea</code><span> is </span><code>(1, 1)</code><span>, which means that you perform the animation using a single simulation area. This is equivalent to the first version of the code you created earlier in this tutorial before you implemented the grid approach.</span></p><p><span>You also replace the </span><code>while</code><span> loop with a </span><code>for</code><span> loop to time how long it takes the simulation to run for 500 iterations. The execution time will vary depending on your computing setup. I&#39;ll present the values I got on my system here:</span></p><pre><code> Time elapsed with grid (1, 1): 87.53 s</code></pre><p>Next, you can use a 4 x 3 grid, which has twelve cells:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png" width="1200" height="420" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/ba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:420,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:13355,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fba4e13fe-be14-4204-b898-7299a4aaa18c_1200x420.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#38</figcaption></figure></div><p>Here&#39;s the output:</p><pre><code> Time elapsed with grid (4, 3): 8.61 s</code></pre><p>And finally, a 10 x 7 grid, which has seventy cells:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png" width="1200" height="420" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:420,&#34;width&#34;:1200,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:13715,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F81ec4de4-33ff-4ee9-b957-75116009bd6b_1200x420.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#39</figcaption></figure></div><p>The 500 iterations run much faster now:</p><pre><code> Time elapsed with grid (10, 7): 2.87 s</code></pre><p>Here&#39;s a table comparing the output for several grid sizes:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png" width="1456" height="667" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/f7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:667,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:136118,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff7946c90-cef5-4773-b2bb-379ed87e0d3d_2484x1138.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><span>Recall that these times represent the code when it doesn&#39;t display each frame on the screen. However, when the loop execution time is small, the time it takes to display the animation becomes a bottleneck in the full animation. For example, the 10 x 7 grid animation takes over 12 seconds to run when you include </span><code>.update()</code><span> in the animation loop to draw each frame, even though the same animation clocked under 3 seconds when you don&#39;t display the frames.</span></p><p><span>At the start of the animation, all the green particles are in the left half, and all the orange particles are in the right half. At the end of the animation, both types of particles are spread across the whole container. You can quantify this using the mean </span><em>x-</em><span>position of all the green and orange particles. Let&#39;s make some changes to the code to implement this:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png" width="1344" height="2268" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:2268,&#34;width&#34;:1344,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:314882,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3d596715-4d97-4192-9127-89c5422dea2b_1344x2268.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption>#40</figcaption></figure></div><p><span>You run this simulation with 200 particles and a grid size of 10 x 7. You also add a data attribute </span><code>.colour</code><span> directly in the </span><code>for</code><span> loop when creating the particles to keep a record of the type of particle you create. Another variable keeps a record of how many particles there are of each colour.</span></p><p><span>You store the mean </span><em>x-</em><span>coordinates in each frame in a deque instead of a list. You set the deque&#39;s maximum length to 500 to keep only the values from the most recent 500 frames. The display on the window&#39;s title bar shows the average of these last 500 frames. This moving average minimises noise in the value displayed.</span></p><p><span>Here&#39;s the animation showing the average </span><em>x-</em><span>positions approach 0 as the simulation progresses. The particles’ </span><code>.MAX_VELOCITY</code><span> has been changed to 4 for this animation:</span></p><ul><li><p><span>I&#39;m making a number of </span><strong>free passes</strong><span> available for readers of The Stack to access the learning platform at </span><strong>The Python Coding Place</strong><span>. The passes give </span><strong>access to all the video courses for one week and a live session</strong><span>, similar to the ones I have weekly with members of The Python Coding Place. Here&#39;s the link to get your one week&#39;s pass:</span></p><p data-attrs="{&#34;url&#34;:&#34;https://thepythoncodingplace.com/free-one-week-python-coding-pass/&#34;,&#34;text&#34;:&#34;Get Free One Week Pass&#34;,&#34;action&#34;:null,&#34;class&#34;:null}" data-component-name="ButtonCreateButton"><a href="https://thepythoncodingplace.com/free-one-week-python-coding-pass/" rel=""><span>Get Free One Week Pass</span></a></p></li><li><p><span>Thank you to all those who supported me with a one-off donation recently. This means a lot and helps me focus on writing more articles and keeping more of these articles free for everyone. Here&#39;s the link again for anyone who wants to make a one-off donation to support The Python Coding Stack</span><br/></p><p data-attrs="{&#34;url&#34;:&#34;https://buy.stripe.com/00g3de2iGdgg4gg7su&#34;,&#34;text&#34;:&#34;Make a one-off contribution&#34;,&#34;action&#34;:null,&#34;class&#34;:null}" data-component-name="ButtonCreateButton"><a href="https://buy.stripe.com/00g3de2iGdgg4gg7su" rel=""><span>Make a one-off contribution</span></a></p></li><li><p><span>The </span><a href="https://thepythoncodingplace.com/the-python-coding-book?utm_source=substack" rel="">Python Coding Book is available</a><span> (Ebook and paperback). This is the First Edition, which follows from the &#34;Zeroth&#34; Edition that has been available online for a while—Just ask Google for &#34;python book&#34;!</span></p></li><li><p>And if you read the book already, I&#39;d appreciate a review on Amazon. These things matter so much for individual authors!</p></li><li><p><span>I&#39;m also releasing </span><a href="https://thepythoncodingplace.thinkific.com/courses/the-numpy-mindset-digital-edition" rel="">The NumPy Mindset</a><span> at the moment. Currently, this is available as an Early Release—I&#39;m publishing chapters as and when they&#39;re ready. Members of The Python Coding Place already have access to this Early Release. Everyone else can </span><a href="https://thepythoncodingplace.thinkific.com/courses/the-numpy-mindset-digital-edition" rel="">get it here</a><span>—You&#39;ll get the final ebook version too once it&#39;s ready if you get the Early Release version, of course!</span></p></li><li><p><span>And for those who want to join </span><em>The Python Coding Place</em><span> to access all of my video courses—past and future—join regular live sessions, and interact with me and other learners on the members-only forum, here&#39;s the link:</span><br/></p><p data-attrs="{&#34;url&#34;:&#34;https://thepythoncodingplace.com?utm_source=substack&#34;,&#34;text&#34;:&#34;Join The Python Coding Place&#34;,&#34;action&#34;:null,&#34;class&#34;:null}" data-component-name="ButtonCreateButton"><a href="https://thepythoncodingplace.com?utm_source=substack" rel=""><span>Join The Python Coding Place</span></a></p></li><li><p>Any questions? Just ask…</p></li></ul><h5>Code Block #1</h5><pre><code><code># particles_simulation.py

import turtle

class SimulationArea:
    def __init__(self, width, height, colour=&#34;white&#34;):
        self.width = width
        self.height = height
        # Define the edges of the simulation area as integers
        # (we&#39;ll need them as integers later)
        self.left_edge = -width // 2
        self.right_edge = width // 2
        self.top_edge = height // 2
        self.bottom_edge = -height // 2
        # Create a turtle screen object
        self.window = turtle.Screen()
        self.window.setup(width, height)
        self.window.tracer(0)
        self.window.bgcolor(colour)
</code></code></pre><h5>Code Block #2</h5><pre><code><code># particles_simulation.py

import turtle

class SimulationArea:
    def __init__(self, width, height, colour=&#34;white&#34;):
        # ...

    def update(self):
        self.window.update()

    def set_title(self, title):
        self.window.title(title)
        
    @staticmethod
    def run_mainloop():
        turtle.mainloop()
</code></code></pre><h5>Code Block #3</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

simulation_area.run_mainloop()
</code></code></pre><h5>Code Block #4</h5><pre><code><code># particles_simulation.py

import turtle

class SimulationArea:
    # ...

class Particle:
    def __init__(
        self,
        simulation_area: SimulationArea,
        position=None,
        velocity=None,
        colour=&#34;black&#34;,
        size_factor=0.5,
    ):
        self.simulation_area = simulation_area
        self.particle = turtle.Turtle()
        self.particle.shape(&#34;circle&#34;)
        self.particle.color(colour)
        self.particle.penup()
        self.particle.shapesize(size_factor)
</code></code></pre><h5>Code Block #5</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

test_particle = Particle(simulation_area)
simulation_area.update()

simulation_area.run_mainloop()
</code></code></pre><h5>Code Block #6</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    # ...

class Particle:
    MAX_VELOCITY = 2

    def __init__(
        self,
        simulation_area: SimulationArea,
        position=None,
        velocity=None,
        colour=&#34;black&#34;,
        size_factor=0.5,
    ):
        
        # ... &lt;Rest of `__init__()` not shown&gt;
        
        # Set a random position if not provided
        if position is None:
            position = [
                random.randint(
                    self.simulation_area.left_edge,
                    self.simulation_area.right_edge,
                ),
                random.randint(
                    self.simulation_area.bottom_edge,
                    self.simulation_area.top_edge,
                ),
            ]
        self.position = position
        
        # Set a random velocity if not provided
        if velocity is None:
            velocity = [
                random.randint(
                    -self.MAX_VELOCITY * 10, self.MAX_VELOCITY * 10
                ) / 10,
                random.randint(
                    -self.MAX_VELOCITY * 10, self.MAX_VELOCITY * 10
                ) / 10,
            ]
        self.velocity = velocity
</code></code></pre><h5>Code Block #7</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = [Particle(simulation_area) for _ in range(100)]

simulation_area.update()
simulation_area.run_mainloop()
</code></code></pre><h5>Code Block #8</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    # ...

class Particle:
    # ...
        
    def move(self):
        self.position[0] += self.velocity[0]
        self.position[1] += self.velocity[1]
        self.particle.setposition(self.position)
</code></code></pre><h5>Code Block #9</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = [Particle(simulation_area) for _ in range(100)]

## You can now remove these two lines since there&#39;s a `while` loop
# simulation_area.update()
# simulation_area.run_mainloop()

# Animation loop
while True:
    for particle in particles:
        particle.move()
    simulation_area.update()
</code></code></pre><h5>Code Block #10</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    # ...

class Particle:
    # ...

    def move(self):
        self.position[0] += self.velocity[0]
        self.position[1] += self.velocity[1]

        # Bounce off the edges
        if (
                self.position[0] &lt; self.simulation_area.left_edge
                or self.position[0] &gt; self.simulation_area.right_edge
        ):
            self.velocity[0] *= -1
        if (
                self.position[1] &lt; self.simulation_area.bottom_edge
                or self.position[1] &gt; self.simulation_area.top_edge
        ):
            self.velocity[1] *= -1

        self.particle.setposition(self.position)
</code></code></pre><h5>Code Block #11</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    # ...

class Particle:
    # ...

    def check_collision(self, other_particle):
        return (
            self.particle.distance(other_particle.particle)
            &lt; 20 * self.particle.shapesize()[0]
        )
</code></code></pre><h5>Code Block #12</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    # ...

class Particle:
    # ...

        def collide(self, other_particle):
        &#34;&#34;&#34;
        This assumes that the particles are of equal mass and
        that the collision is a head-on elastic collision.
        &#34;&#34;&#34;
        self.velocity, other_particle.velocity = other_particle.velocity, self.velocity
</code></code></pre><h5>Code Block #13</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = [Particle(simulation_area) for _ in range(100)]

# Animation loop
while True:
    for particle in particles:
        particle.move()
        for other_particle in particles:
            if particle.check_collision(other_particle):
                particle.collide(other_particle)

    simulation_area.update()
</code></code></pre><h5>Code Block #14</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    # ...

class Particle:
    # ...

    def collide(self, other_particle):
        &#34;&#34;&#34;
        This assumes that the particles are of equal mass and
        that the collision is a head-on elastic collision.
        &#34;&#34;&#34;
        if other_particle is self:
            return
        self.velocity, other_particle.velocity = (
            other_particle.velocity,
            self.velocity,
        )

</code></code></pre><h5>Code Block #15</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    MAX_VELOCITY = 2

    def __init__(...):  # Parameters not displayed
       # ...
        
        self.in_collision_with = []

    # ...
</code></code></pre><h5>Code Block #16</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    # ...

    def collide(self, other_particle):
        &#34;&#34;&#34;
        This assumes that the particles are of equal mass and
        that the collision is a head-on elastic collision.
        &#34;&#34;&#34;
        if other_particle is self:
            return
        if self not in other_particle.in_collision_with:
            self.velocity, other_particle.velocity = (
                other_particle.velocity,
                self.velocity,
            )
            # Keep a record of collision in other_particle.
            # No need to keep it in self
            other_particle.in_collision_with.append(self)
</code></code></pre><h5>Code Block #17</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    # ...

    def remove_collision(self, other_particle):
        self.in_collision_with.remove(other_particle)
</code></code></pre><h5>Code Block #18</h5><pre><code><code># run_demo.py

# ...

# Animation loop
while True:
    for particle in particles:
        particle.move()
        for other_particle in particles:
            if particle.check_collision(other_particle):
                particle.collide(other_particle)
            elif other_particle in particle.in_collision_with:
                    particle.remove_collision(other_particle)

    simulation_area.update()
</code></code></pre><h5>Code Block #19</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    # ...

    def assign_colour(self, colour):
        self.particle.color(colour)

    def get_position(self):
        return self.position
</code></code></pre><h5>Code Block #20</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = []
for _ in range(100):
    particle = Particle(simulation_area)
    if particle.get_position()[0] &lt; 0:
        particle.assign_colour(&#34;#1A6B72&#34;)
    else:
        particle.assign_colour(&#34;#FDB33B&#34;)
    particles.append(particle)

# Animation loop
# ...
</code></code></pre><h5>Code Block #21</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    def __init__(self, width, height, colour=&#34;white&#34;):
        self.width = width
        self.height = height
        # Define the edges of the simulation area as integers
        # (we&#39;ll need them as integers later)
        self.left_edge = -width // 2
        self.right_edge = width // 2
        self.top_edge = height // 2
        self.bottom_edge = -height // 2
        # Create a turtle screen object
        self.window = turtle.Screen()
        self.window.setup(width, height)
        self.window.tracer(0)
        self.window.bgcolor(colour)

    def update(self):
        self.window.update()

    def set_title(self, title):
        self.window.title(title)

    @staticmethod
    def run_mainloop():
        turtle.mainloop()

class Particle:
    MAX_VELOCITY = 2

    def __init__(
        self,
        simulation_area: SimulationArea,
        position=None,
        velocity=None,
        colour=&#34;black&#34;,
        size_factor=0.5,
    ):
        self.simulation_area = simulation_area
        self.particle = turtle.Turtle()
        self.particle.shape(&#34;circle&#34;)
        self.particle.color(colour)
        self.particle.penup()
        self.particle.shapesize(size_factor)
        if position is None:
            position = [
                random.randint(
                    self.simulation_area.left_edge,
                    self.simulation_area.right_edge,
                ),
                random.randint(
                    self.simulation_area.bottom_edge,
                    self.simulation_area.top_edge,
                ),
            ]
        self.position = position
        if velocity is None:
            velocity = [
                random.randint(
                    -self.MAX_VELOCITY * 10, self.MAX_VELOCITY * 10
                ) / 10,
                random.randint(
                    -self.MAX_VELOCITY * 10, self.MAX_VELOCITY * 10
                ) / 10,
            ]
        self.velocity = velocity

        self.in_collision_with = []

    def move(self):
        self.position[0] += self.velocity[0]
        self.position[1] += self.velocity[1]

        # Bounce off the edges
        if (
                self.position[0] &lt; self.simulation_area.left_edge
                or self.position[0] &gt; self.simulation_area.right_edge
        ):
            self.velocity[0] *= -1
        if (
                self.position[1] &lt; self.simulation_area.bottom_edge
                or self.position[1] &gt; self.simulation_area.top_edge
        ):
            self.velocity[1] *= -1

        self.particle.setposition(self.position)

    def check_collision(self, other_particle):
        return (
            self.particle.distance(other_particle.particle)
            &lt; 20 * self.particle.shapesize()[0]
        )

    def collide(self, other_particle):
        &#34;&#34;&#34;
        This assumes that the particles are of equal mass and
        that the collision is a head-on elastic collision.
        &#34;&#34;&#34;
        if other_particle is self:
            return
        if self not in other_particle.in_collision_with:
            self.velocity, other_particle.velocity = (
                other_particle.velocity,
                self.velocity,
            )
            # Keep a record of collision in other_particle.
            # No need to keep it in self
            other_particle.in_collision_with.append(self)

    def remove_collision(self, other_particle):
        self.in_collision_with.remove(other_particle)

    def assign_colour(self, colour):
        self.particle.color(colour)

    def get_position(self):
        return self.position
</code></code></pre><h5>Code Block #22</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = []
for _ in range(100):
    particle = Particle(simulation_area)
    if particle.get_position()[0] &lt; 0:
        particle.assign_colour(&#34;#1A6B72&#34;)
    else:
        particle.assign_colour(&#34;#FDB33B&#34;)
    particles.append(particle)

# Animation loop
while True:
    for particle in particles:
        particle.move()
        for other_particle in particles:
            if particle.check_collision(other_particle):
                particle.collide(other_particle)
            elif other_particle in particle.in_collision_with:
                    particle.remove_collision(other_particle)

    simulation_area.update()
</code></code></pre><h5>Code Block #23</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

n_particles = 500

simulation_area = SimulationArea(1000, 700)
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = []
for _ in range(n_particles):
    particle = Particle(simulation_area)
    if particle.get_position()[0] &lt; 0:
        particle.assign_colour(&#34;#1A6B72&#34;)
    else:
        particle.assign_colour(&#34;#FDB33B&#34;)
    particles.append(particle)

# Animation loop
# ...
</code></code></pre><h5>Code Block #24</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    def __init__(self, width, height, colour=&#34;white&#34;, cell_grid=(1, 1)):
        self.width = width
        self.height = height
        # Define the edges of the simulation area as integers
        # (we&#39;ll need them as integers later)
        self.left_edge = -width // 2
        self.right_edge = width // 2
        self.top_edge = height // 2
        self.bottom_edge = -height // 2
        # Create a turtle screen object
        self.window = turtle.Screen()
        self.window.setup(width, height)
        self.window.tracer(0)
        self.window.bgcolor(colour)
        
        # Define the cell grid
        self.cell_grid = cell_grid
        self.cell_width = width / cell_grid[0]
        self.cell_height = height / cell_grid[1]
        self.cells = {
            (i, j): []
            for i in range(cell_grid[0])
            for j in range(cell_grid[1])
        }

    # ...
</code></code></pre><h5>Code Block #25</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

n_particles = 500

simulation_area = SimulationArea(1000, 700, cell_grid=(10, 7))
simulation_area.set_title(&#34;Diffusion Demo&#34;)

# ...
</code></code></pre><h5>Code Block #26</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    MAX_VELOCITY = 2

    def __init__(...):
        # ...
        
        self.cell = None
</code></code></pre><h5>Code Block #27</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    # ...

    def assign_to_cell(self):
        # Convert the x and y coordinates to cell indices i and j
        cell_i = int(
            (self.position[0] - self.simulation_area.left_edge)
            // self.simulation_area.cell_width
        )
        cell_j = int(
            (self.position[1] - self.simulation_area.bottom_edge)
            // self.simulation_area.cell_height
        )

    # ...
</code></code></pre><h5>Code Block #28</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    # ...

    def assign_to_cell(self):
        # Convert the x and y coordinates to cell indices i and j
        cell_i = int(
            (self.position[0] - self.simulation_area.left_edge)
            // self.simulation_area.cell_width
        )
        cell_j = int(
            (self.position[1] - self.simulation_area.bottom_edge)
            // self.simulation_area.cell_height
        )
        # Ensure the cell indices are within the grid
        if cell_i &lt; 0:
            cell_i = 0
        elif cell_i &gt;= self.simulation_area.cell_grid[0]:
            cell_i = self.simulation_area.cell_grid[0] - 1
        if cell_j &lt; 0:
            cell_j = 0
        elif cell_j &gt;= self.simulation_area.cell_grid[1]:
            cell_j = self.simulation_area.cell_grid[1] - 1

    # ...
</code></code></pre><h5>Code Block #29</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    # ...

    def assign_to_cell(self):
        # Convert the x and y coordinates to cell indices i and j
        cell_i = int(
            (self.position[0] - self.simulation_area.left_edge)
            // self.simulation_area.cell_width
        )
        cell_j = int(
            (self.position[1] - self.simulation_area.bottom_edge)
            // self.simulation_area.cell_height
        )
        # Ensure the cell indices are within the grid
        if cell_i &lt; 0:
            cell_i = 0
        elif cell_i &gt;= self.simulation_area.cell_grid[0]:
            cell_i = self.simulation_area.cell_grid[0] - 1
        if cell_j &lt; 0:
            cell_j = 0
        elif cell_j &gt;= self.simulation_area.cell_grid[1]:
            cell_j = self.simulation_area.cell_grid[1] - 1
        
        # Add the particle if it&#39;s not already in the 
        # cell (first iteration)
        if not self.cell:
            self.cell = (cell_i, cell_j)
            self.simulation_area.cells[self.cell].append(self)
            
        # ...
</code></code></pre><h5>Code Block #30</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    # ...

    def assign_to_cell(self):
        # Convert the x and y coordinates to cell indices i and j
        cell_i = int(
            (self.position[0] - self.simulation_area.left_edge)
            // self.simulation_area.cell_width
        )
        cell_j = int(
            (self.position[1] - self.simulation_area.bottom_edge)
            // self.simulation_area.cell_height
        )
        # Ensure the cell indices are within the grid
        if cell_i &lt; 0:
            cell_i = 0
        elif cell_i &gt;= self.simulation_area.cell_grid[0]:
            cell_i = self.simulation_area.cell_grid[0] - 1
        if cell_j &lt; 0:
            cell_j = 0
        elif cell_j &gt;= self.simulation_area.cell_grid[1]:
            cell_j = self.simulation_area.cell_grid[1] - 1

        # If the particle is not already in the cell (first iteration), add it
        if not self.cell:
            self.cell = (cell_i, cell_j)
            self.simulation_area.cells[self.cell].append(self)
        elif self.cell != (cell_i, cell_j):
            # Remove the particle from the current cell
            self.simulation_area.cells[self.cell].remove(self)
            # Update the cell assignment
            self.cell = (cell_i, cell_j)
            # Add the particle to the new cell
            self.simulation_area.cells[self.cell].append(self)

    # ...
</code></code></pre><h5>Code Block #31</h5><pre><code><code># particles_simulation.py

# ...

class Particle:
    MAX_VELOCITY = 2

    def __init__(...)
        # ...
        self.assign_to_cell()

    # ...

    def move(self):
        # ...
        self.assign_to_cell()

    # ...
</code></code></pre><h5>Code Block #32</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

n_particles = 50

simulation_area = SimulationArea(1000, 700, cell_grid=(10, 7))

# ...

# Temporary checks
sample_particle = particles[0]

# Animation loop
while True:
    # ...
    
    # Temporary checks
    sample_particle.particle.clear()
    sample_particle.particle.write(
        f&#34;{sample_particle.cell}&#34;, font=(&#34;Courier&#34;, 20, &#34;bold&#34;)
    )

    simulation_area.update()
</code></code></pre><h5>Code Block #33</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

n_particles = 200

simulation_area = SimulationArea(1000, 700, cell_grid=(4, 3))
simulation_area.set_title(&#34;Diffusion Demo&#34;)

# ...

# Animation loop
while True:
    for particle in particles:
        # ...
        
        # Temporary code: Visualise one of the cells, (1, 1)
        if particle in simulation_area.cells[(1, 1)]:
            particle.assign_colour(&#34;#6D227A&#34;)
        else:
            particle.assign_colour(&#34;#AABFBF&#34;)

    # Temporary checks
    sample_particle.particle.clear()
    sample_particle.particle.write(
        f&#34;{sample_particle.cell}&#34;, font=(&#34;Courier&#34;, 20, &#34;bold&#34;)
    )

    simulation_area.update()
</code></code></pre><h5>Code Block #34</h5><pre><code><code># particles_simulation.py

import random
import turtle

class SimulationArea:
    # ...
        
    def get_sequence_of_cells(self):
        return self.cells.values()

# ...
</code></code></pre><h5>Code Block #35</h5><pre><code><code># run_demo.py

from particles_simulation import SimulationArea, Particle

n_particles = 500

simulation_area = SimulationArea(1000, 700, cell_grid=(10, 7))
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = []
for _ in range(n_particles):
    particle = Particle(simulation_area)
    if particle.get_position()[0] &lt; 0:
        particle.assign_colour(&#34;#1A6B72&#34;)
    else:
        particle.assign_colour(&#34;#FDB33B&#34;)
    particles.append(particle)

# Animation loop
while True:
    for cell in simulation_area.get_sequence_of_cells():
        for particle in cell:
            particle.move()
            for other_particle in cell:
                if particle.check_collision(other_particle):
                    particle.collide(other_particle)
                elif other_particle in particle.in_collision_with:
                        particle.remove_collision(other_particle)

    simulation_area.update()
</code></code></pre><h5>Code Block #36</h5><pre><code><code># particles_simulation.py

import random
import turtle

random.seed(0)

class SimulationArea:
    # ...
</code></code></pre><h5>Code Block #37</h5><pre><code><code># run_demo.py

import time

from particles_simulation import SimulationArea, Particle

n_particles = 500

grid = (1, 1)
simulation_area = SimulationArea(1000, 700, cell_grid=grid)

# ...

start_time = time.time()
# Animation loop
for _ in range(500):
    for cell in simulation_area.get_sequence_of_cells():
        for particle in cell:
            particle.move()
            for other_particle in cell:
                if particle.check_collision(other_particle):
                    particle.collide(other_particle)
                elif other_particle in particle.in_collision_with:
                        particle.remove_collision(other_particle)

    # simulation_area.update()
print(f&#34;Time elapsed with grid {grid}: {time.time() - start_time:.2f} s&#34;)
</code></code></pre><h5>Code Block #38</h5><pre><code><code># run_demo.py

# ...

grid = (4, 3)

# ...
</code></code></pre><h5>Code Block #39</h5><pre><code><code># run_demo.py

# ...

grid = (10, 7)

# ...
</code></code></pre><h5>Code Block #40</h5><pre><code><code># run_demo.py

from collections import deque

from particles_simulation import SimulationArea, Particle

n_particles = 200

simulation_area = SimulationArea(1000, 700, cell_grid=(10, 7))
simulation_area.set_title(&#34;Diffusion Demo&#34;)

particles = []
total_green_particles = 0
total_orange_particles = 0
for _ in range(n_particles):
    particle = Particle(simulation_area)
    if particle.get_position()[0] &lt; 0:
        particle.assign_colour(&#34;#1A6B72&#34;)
        particle.colour = &#34;green&#34;
        total_green_particles += 1
    else:
        particle.assign_colour(&#34;#FDB33B&#34;)
        particle.colour = &#34;orange&#34;
        total_orange_particles += 1
    particles.append(particle)

# Animation loop
green_mean_x = deque(maxlen=500)
orange_mean_x = deque(maxlen=500)
while True:
    sum_green_x_coords, sum_orange_x_coords = 0, 0
    for cell in simulation_area.get_sequence_of_cells():
        for particle in cell:
            particle.move()
            if particle.colour == &#34;green&#34;:
                sum_green_x_coords += particle.position[0]
            elif particle.colour == &#34;orange&#34;:
                sum_orange_x_coords += particle.position[0]
            for other_particle in cell:
                if particle.check_collision(other_particle):
                    particle.collide(other_particle)
                elif other_particle in particle.in_collision_with:
                        particle.remove_collision(other_particle)
    green_mean_x.append(sum_green_x_coords / total_green_particles)
    orange_mean_x.append(sum_orange_x_coords / total_orange_particles)
    simulation_area.set_title(
        f&#34;Green: {sum(green_mean_x)/len(green_mean_x):0.0f}, &#34;
        f&#34;Orange: {sum(orange_mean_x)/len(orange_mean_x):0.0f}&#34;
    )

    simulation_area.update()
</code></code></pre><div><figure><a target="_blank" href="https://thepythoncodingplace.com?utm_source=substack" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png" width="1456" height="420" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/e63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:420,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:448113,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:&#34;https://thepythoncodingplace.com?utm_source=substack&#34;,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe63ca140-8d08-4c0c-ae7e-9c663eff132b_2080x600.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/cec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:null,&#34;width&#34;:null,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:0,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcec9cbba-0591-4c6a-b1e0-5cea153cd0a3.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div></div></div></div>
  </body>
</html>
