<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2025/03/26/atop/">Original</a>
    <h1>Problems with the heap</h1>
    
    
<p>
Okay, first off, everybody breathe.  Everyone is freaking out.  This is 
not the way to do this.
</p>
<p>
Right, so, let me try a half-assed analogy here.  There&#39;s a day care 
center and a bunch of people send their kids to it.  Then one day, 
someone finds out that they built the playground out of the sharpest 
materials available.  It&#39;s not that the playground is from the &#39;70s or 
something, either.  It&#39;s relatively new.
</p>
<p>
Saying &#34;maybe you don&#39;t want to send your kids there&#34; is what I did.
</p>
<p>
Now, so, this is a bad analogy, because I didn&#39;t go into details.  In 
this case, I&#39;d rather the world have a chance to turn this stuff off 
before it becomes known just what all is possible.  The nature of this 
sort of thing means it&#39;s a race and I&#39;m on the side of protecting  
machines for some reason, so I asked people to stop running it.
</p>
<p>
Now, first off, I don&#39;t know exactly how to exploit this sort of thing.  
I was there in the 90s when this overflow stuff started popping off, and 
I&#39;m pretty sure that if you can do this, you can do much worse.
</p>
<p>
This is what I&#39;m talking about:
</p>
<p>
Terminal 1:
</p>
<pre class="terminal">user1$ random-tool
</pre>
<p>
Terminal 2:
</p>
<pre class="terminal">user2$ atop
malloc(): corrupted top size
Aborted
</pre>
<p>
... that&#39;s pretty bad, right?
</p>
<p>
So you twiddle the tool a little bit and go again and...
</p>
<pre class="terminal">user2$ atop
Segmentation fault
</pre>
<p>
That&#39;s not great, either!
</p>
<p>
Or... how about...
</p>
<pre class="terminal">user2$ atop
Fatal glibc error: malloc assertion failure in sysmalloc: (old_top == initial_top (av) &amp;&amp; old_size == 0) || ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse (old_top) &amp;&amp; ((unsigned long) old_end &amp; (pagesize - 1)) == 0)
</pre>
<p>
Again, this is not my world.  I&#39;ve never written a heap exploit, but 
reading about it briefly makes me think that there&#39;s meat on these 
bones.
</p>
<p>
user1 does something... and gets user2 to blow up.  If you can make 
that do something useful, then you get user2 to run stuff on your 
behalf.
</p>
<p>
What if user2 is root?  Then you own the box.
</p>
<p>
Okay?  So maybe stop running it as root, but also just stop running it.  
</p>

  </body>
</html>
