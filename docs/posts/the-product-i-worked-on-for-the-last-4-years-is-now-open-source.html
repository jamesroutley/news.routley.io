<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.confluent.io/blog/announcing-the-open-source-confluent-cli/">Original</a>
    <h1>The product I worked on for the last 4 years is now open-source</h1>
    
    <div id="readability-page-1" class="page"><div><div data-swiftype-name="body" data-swiftype-type="text"><p>Confluent was founded on open source principles and has consistently contributed to some of the world’s most popular open source software, including Apache Kafka®. We are excited to reaffirm our commitment to the open source community by announcing that the Confluent CLI is now <a href="https://github.com/confluentinc/cli">open source on GitHub</a>!</p><p>Our open source announcement coincides with our latest major version release, <code>confluent</code> CLI v3, which ushers in a host of <a href="https://docs.confluent.io/confluent-cli/3.0.0/release-notes.html">new features and UX improvements</a>. Notable features include 1) full adoption of Kafka REST for all <code>confluent kafka</code> commands, 2) acknowledgement prompts to prevent the accidental deletion of Cloud resources, and 3) increased command syntax standardization and command discoverability. This release is the capstone of more than a year’s worth of work. We hope the latest features in v3 and the open source CLI improve and facilitate more communication and collaboration between customers, developers, and contributors.</p><p>This post covers our design objectives, details the effort required to open source the CLI, and provides an introduction on how to make an open source contribution.</p><h2>Why we are open sourcing the <code>confluent</code> CLI</h2><h3>To become the de facto CLI tool for Kafka, ksqlDB, and more</h3><p>Our users rely on Confluent, Kafka, and ksqlDB every day. To provide an integrated user experience, we built a comprehensive command-line tool that can facilitate all use cases. Our CLI is a feature-complete interface that supports tasks like organization and user management, cluster provisioning, and producing/consuming messages. We are actively making investments to ensure the <code>confluent</code> CLI provides features that parallel the functionality of Kafka and ksqlDB bash scripts. The open source <code>confluent</code> CLI helps to accelerate our mission to make a unified command-line tool for all data streaming workflows and to become the recommended CLI for any OSS project using technologies like Kafka or ksqlDB.</p><h3>To empower users to contribute and provide rich feedback</h3><p>The CLI is our most popular programmatic interface by active user count. It works as both a learning tool and a tried-and-true component of automated production workflows. When the CLI was closed source, collecting user feedback required users to sign up for a support plan and open tickets through a support portal. Because the majority of our CLI users are developers, GitHub Issues is a much more familiar and lower-friction interface for reporting bugs and requesting features. Another benefit is that all GitHub issues are accessible to everyone, which, over time, will result in an extensive library of suggestions and contributions. Users are also encouraged to open pull requests (PRs) in our repository, following the <a href="https://github.com/confluentinc/cli/blob/main/CONTRIBUTING.md">contribution guide</a>.</p><h3>To build credibility through transparency</h3><p>Thousands of enterprises rely on Confluent, and a worldwide community of Kafka users support our codebase. As such, we value making the <code>confluent</code> CLI more reliable. We want to empower our users to actively drive CLI development, and we want to build trust and confidence with our users and community through the transparency of our logic, code, and documentation.</p><h2>High-level design of the <code>confluent</code> CLI</h2><p>In a <a href="https://www.confluent.io/blog/how-we-designed-and-architected-the-confluent-cli/">previous blog post</a>, we covered the design of the <code>confluent</code> CLI and highlighted some challenges of shipping a cross-platform tool that communicates with a variety of APIs both on-prem and in the cloud. To recap, our CLI is designed to be:</p><ul><li><p><b>Powerful:</b> Users can fully manage their Confluent deployment (Cloud and/or Platform) and modern data flow through any of our developer interfaces.</p></li><li><p><b>Stable:</b> Functionality is reliable. Breaking changes are minimal, infrequent, and clearly communicated in advance.</p></li><li><p><b>Intuitive:</b> Syntax is consistent and predictable, conforming to users&#39; expectations. Users can easily discover the functionality of the platform and quickly develop production-ready, automated workflows.</p></li></ul><p>For example, to create your first fully managed Kafka cluster in Confluent Cloud, you can run:</p><div><div><div data-language="text"><pre><code>$ confluent kafka cluster create my-cluster --cloud aws --region us-east-1
</code></pre></div></div></div><p>To produce a message to your Kafka topic “test” with an Avro schema with ID 100001:</p><div><div><div data-language="text"><pre><code>$ confluent kafka topic produce test --value-format avro --schema-id 100001 --schema-registry-api-secret &lt;sr-secret&gt;

Starting Kafka Producer. Use Ctrl-C or Ctrl-D to exit.

{&#34;name&#34;:&#34;hello&#34;,&#34;amount&#34;:1.00}
</code></pre></div></div></div><p>And to consume a message from offset 0:</p><div><div><div data-language="text"><pre><code>$ confluent kafka topic consume test --value-format avro --offset 0

Starting Kafka Consumer. Use Ctrl-C to exit.

{&#34;name&#34;:&#34;hello&#34;,&#34;amount&#34;:1}
</code></pre></div></div></div><h2>What happens when a command executes? </h2><p>We chose to write the <code>confluent</code> CLI in Go because it has great support for cross-platform compilation and lets us easily bundle all of our dependencies into a single binary. Go also allows us to build our CLI with the widely adopted <a href="https://github.com/spf13/cobra">Cobra</a> CLI framework, which provides handy functionality such as parsing arguments and flags, creating commands, and executing them as needed.</p><p>When a user executes a command, the CLI client generates a Cobra command that holds all arguments, flags, and a series of <code>Run()</code> functions that do the execution job. Before the actual work function runs, the CLI sets up API clients as needed, ready to communicate with the backend services and dependent libraries. This includes <a href="https://github.com/confluentinc/confluent-kafka-go">confluent-kafka-go</a>, an open source Go client that enables quick and efficient producing to and consuming from Kafka.</p><p>In a <code>Run()</code> function, the CLI reads arguments and flags from the command and prepares a request to do the job. The request is then sent to an SDK layer, where the communication between the CLI client and the actual API is made possible. Communication with Kafka brokers is also done in this layer. The CLI takes backend responses, handles errors and exceptions, and provides users with structured, informative output.</p><h2>Supporting cross-compilation and many OS targets</h2><p>The <code>confluent</code> CLI supports native development on Darwin, Linux, and Windows machines, whether using ARM or AMD CPUs. It’s also possible to cross-compile the CLI from macOS to Linux and Windows with CGO enabled and the right cross compilers: <code>aarch64-linux-musl-gcc</code>, <code>x86_64-w64-mingw32-gcc</code>, and <code>x86_64-linux-musl-gcc</code>. We take advantage of this when preparing a release of the CLI. Building for glibc-based Linux distributions is more complicated: we use a Docker container to create the native environment, install all the essential tools, build the binary file in it, then copy it back to the release environment. With all these techniques, we are able to release and ship weekly versions of the CLI with ease. We have a pre-built Docker image ready for use, and a well-structured release script, both of which help us construct an automated release process.</p><h2>Make your first contribution to the <code>confluent</code> CLI</h2><p>Our team mainly develops on darwin/amd64. However, the CLI supports <a href="https://docs.confluent.io/confluent-cli/current/requirements.html#operating-systems">more operating systems and architectures</a>, as long as you have the necessary tools and environment setup. We invite the community to explore the CLI codebase, build local copies of the CLI, and open PRs to request new flags and features that you find interesting—or simply report bugs! Check out our <a href="https://github.com/confluentinc/cli/blob/main/CONTRIBUTING.md">contribution guide</a> for more information.</p><h2>Plugins: Add your own CLI commands!</h2><p>We also want to take this opportunity to share a powerful new feature that was introduced last year and comes packaged with all <code>confluent</code> v3 binaries: plugins! Similar to tools like <code>git</code> and <code>kubectl</code>, you can add your own custom command to <code>confluent</code> by placing an executable file prefixed with “confluent-” anywhere in your <code>$PATH</code>. For more information, see our <a href="https://docs.confluent.io/confluent-cli/current/plugins.html#write-a-plugin">plugin guide</a>.</p><h2>Enabling the open source CLI</h2><p>Over the past year, we’ve made many architectural changes to the CLI to make it open source. This work included:</p><ul><li><p><b>Migrating to new public APIs.</b> Confluent recently rolled out a new API framework, requiring all feature teams to release new APIs for their respective backend features. We needed to completely migrate the CLI to use the new public and well-documented APIs, which required complex cross-team collaboration and dependency tracking over multiple quarters. An example of one of these new APIs is the <a href="https://docs.confluent.io/cloud/current/api.html#tag/Clusters-(cmkv2)">Cluster Management for Kafka</a> (CMK) API.</p></li><li><p><b>Hardening the CLI.</b> Security is a big consideration for open sourcing the CLI, and we worked diligently to prevent secret leaks and arbitrary code execution in our build pipeline. Rounds of reviews were done for our CI system to ensure compliance. We set up <a href="https://github.com/dependabot">Dependabot</a> to ensure all dependencies remain up to date and free of insecure versions, and we implemented other technical requirements such as updating versions of security protocols to ensure a safe and secure CLI.</p></li><li><p><b>Eliminating private dependencies. </b>To make the CLI open source we needed to also open source several dependencies. To do so, we applied two different strategies to our dependencies: 1) for the Confluent Cloud SDK (<a href="https://github.com/confluentinc/ccloud-sdk-go-v2">ccloud-sdk-go-v2</a>), we migrated to our new public v2 APIs; 2) for some SDKs like <a href="https://github.com/confluentinc/kafka-rest-sdk-go">kafka-rest-sdk-go</a>, no new implementation was required, but we worked to ensure everything was publicly documented, properly licensed, and secure.</p></li></ul><h2>Conclusion</h2><p>The <code>confluent</code> CLI evolved from a hallway conversation in early 2019 and has since grown to support thousands of enterprises and use cases ranging from local development to mission-critical applications. Our CLI has been used all around the world—including on airplanes and on ships in international waters—and we can’t wait to see the innovative use cases from our users in the future (especially with new features like the plugin framework). We are thrilled to give back to the open source community, which has meaningfully benefited CLI development over the years (from <a href="https://github.com/spf13/cobra">cobra</a> to <a href="https://goreleaser.com/">goreleaser</a> and many packages in between). Our open source v3 CLI release is a significant milestone, but we believe this is just the beginning of a new level of development and engagement with the community. We are excited to directly engage with the community and partner with you to build the best version of the <code>confluent</code> CLI.</p><h2>Get in touch</h2><p>Our team wants your feedback! Send us your suggestions, bug reports, feature requests, and general feedback. You can open a GitHub Issue, make a PR, send us an email at <a href="mailto:cli-team@confluent.io">cli-team@confluent.io</a>, or file a ticket through <a href="https://support.confluent.io">Confluent Support</a>. We look forward to hearing from you!</p></div></div></div>
  </body>
</html>
