<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/rrika/cdcEngineDXHR">Original</a>
    <h1>Decompilation of Deus Ex: Human Revolution</h1>
    
    <div id="readability-page-1" class="page"><article role="main">
        <blockquote>
<p>You can find the source code of tutorial in <a href="https://github.com/kracekumar/jplay/tree/bazel-101">bazel-101 branch</a>.</p>
</blockquote>
<h3 id="what-will-you-learn">What will you learn?</h3>
<ul>
<li>Introduction to bazel build system</li>
<li>How to build and run Java package?</li>
<li>How to add maven dependency to bazel build files?</li>
<li>How to add protobuf compiler to bazel build?</li>
</ul>
<h3 id="introduction">Introduction</h3>
<p><a href="https://bazel.build/">Bazel</a> is imperative build system that can build packages for Java, C++, Python, Ruby, Go, etc …
The two main advantages of bazel,</p>
<ol>
<li>One build tool can build packages for variety of languages and easier for
platform teams to build packages across variety of languages.
Consider learning many different build systems - Pip, bundle, maven, etc…</li>
<li>Bazel build system can cache already built packages in a remote or local environment and
can reuse it without compiling be it for binary, library, or tests.</li>
</ol>
<p>The main difference between bazel and other build/dependency management systems
is imperative vs declarative approach.</p>
<p>Consider a Java package <code>sample</code> with the following structure with one file <code>Sample.java</code></p>
<div><pre tabindex="0"><code data-lang="shell"><span><span><span>$ls_custom</span>
</span></span><span><span>
</span></span><span><span>.
</span></span><span><span>BUILD
</span></span><span><span>src/main/java/com/example/Sample.java
</span></span><span><span>WORKSPACE
</span></span></code></pre></div><p>Every project contains one <code>WORKSPACE</code> <a href="https://bazel.build/reference/glossary#workspace">file</a> and contains one or many <code>BUILD</code> <a href="https://bazel.build/reference/glossary#build-file">files</a>.
One <code>BUILD</code> file for a package. In the example project, <code>BUILD</code></p>
<blockquote>
<p>WORKSPACE: A directory containing a WORKSPACE file and source code for the software you want to build. Labels that start with // are relative to the workspace directory.</p>
</blockquote>
<blockquote>
<p>WORKSPACE FILE: Defines a directory to be a workspace. The file can be empty, although it usually contains external repository declarations to fetch additional dependencies from the network or local filesystem.</p>
</blockquote>
<blockquote>
<p>A BUILD file is the main configuration file that tells Bazel what software outputs to build, what their dependencies are, and how to build them. Bazel takes a BUILD file as input and uses the file to create a graph of dependencies and to derive the actions that must be completed to build intermediate and final software outputs. A BUILD file marks a directory and any sub-directories not containing a BUILD file as a package, and can contain targets created by rules. The file can also be named BUILD.bazel.</p>
</blockquote>
<p>The <code>Sample.java</code> file looks like</p>
<div><pre tabindex="0"><code data-lang="shell"><span><span>package com.example<span>;</span>
</span></span><span><span>
</span></span><span><span>public class Sample<span>{</span>
</span></span><span><span>    public static void main<span>(</span>String<span>[]</span> args<span>)</span> <span>{</span>
</span></span><span><span>        String <span>label</span> <span>=</span> <span>&#34;Krace&#34;</span><span>;</span>
</span></span><span><span>        System.out.println<span>(</span>String.format<span>(</span><span>&#34;Hello: %s&#34;</span>, label<span>))</span><span>;</span>
</span></span><span><span>
</span></span><span><span>    <span>}</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><h3 id="build-the-target">Build the target</h3>
<p>Now let’s build the java binary and execute it. The Sample.java file has no external dependency.</p>
<p>Assuming the bazel is installed, let’s write imperative code to build the binary package(BUILD file).</p>
<div><pre tabindex="0"><code data-lang="shell"><span><span>java_binary<span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;Sample&#34;</span>,
</span></span><span><span>    <span>srcs</span> <span>=</span> glob<span>([</span><span>&#34;src/main/java/com/example/*.java&#34;</span><span>])</span>,
</span></span><span><span><span>)</span>
</span></span></code></pre></div><p>In BUILD file mention, it’s a Java binary by invoking <code>java_binary</code> function, name the package as <code>Sample</code>
and source files as <code>srcs=glob([&#34;src/main/java/com/example/*.java&#34;])</code>.
All the java files inside <code>src/main/java/com/example</code> directory is part of the package <code>Sample</code>.</p>
<p>Now build the package using <code>bazel build &lt;target&gt;</code> syntax.</p>
<div><pre tabindex="0"><code data-lang="shell"><span><span><span>$bazel</span> build Sample
</span></span><span><span>INFO: Analyzed target //:Sample <span>(</span><span>0</span> packages loaded, <span>0</span> targets configured<span>)</span>.
</span></span><span><span>INFO: Found <span>1</span> target...
</span></span><span><span>Target //:Sample up-to-date:
</span></span><span><span>  bazel-bin/Sample.jar
</span></span><span><span>  bazel-bin/Sample
</span></span><span><span>INFO: Elapsed time: 0.046s, Critical Path: 0.00s
</span></span><span><span>INFO: <span>1</span> process: <span>1</span> internal.
</span></span><span><span>INFO: Build completed successfully, <span>1</span> total action
</span></span></code></pre></div><p>The command built the package without any error and the target is generated in <code>bazel-bin</code> directory.</p>
<h3 id="run-the-target">Run the target</h3>
<p>Now run the target using <code>bazel run &lt;target&gt;</code> or <code>./bazel-bin/Sample</code></p>
<div><pre tabindex="0"><code data-lang="shell"><span><span> ./bazel-bin/Sample
</span></span><span><span>Hello: Krace
</span></span></code></pre></div><p>When you invoke <code>bazel run &lt;target&gt;</code>, bazel build the package and executes it(uses the cache, if there is no change).</p>
<div><pre tabindex="0"><code data-lang="shell"><span><span>$ bazel run Sample
</span></span><span><span>INFO: Analyzed target //:Sample <span>(</span><span>0</span> packages loaded, <span>0</span> targets configured<span>)</span>.
</span></span><span><span>INFO: Found <span>1</span> target...
</span></span><span><span>Target //:Sample up-to-date:
</span></span><span><span>  bazel-bin/Sample.jar
</span></span><span><span>  bazel-bin/Sample
</span></span><span><span>INFO: Elapsed time: 0.046s, Critical Path: 0.00s
</span></span><span><span>INFO: <span>1</span> process: <span>1</span> internal.
</span></span><span><span>INFO: Build completed successfully, <span>1</span> total action
</span></span><span><span>INFO: Build completed successfully, <span>1</span> total action
</span></span><span><span>Hello: Krace
</span></span></code></pre></div><p>Similar to <code>java_binary</code>, notable functions are <code>java_library</code>, <code>java_test</code>.</p>
<h3 id="add-a-dependency-from-the-maven-repository">Add a dependency from the maven repository</h3>
<p>Bazel has rules and definition for how to download and build the packages that are distributed to the
repositories like <a href="https://bazel.build/migrate/maven">maven</a> or zip files.</p>
<p>To download file from maven repository, bazel needs to some information about the repository and it’s structure.</p>
<p>In <code>WORKSPACE</code> file, you can details about the maven bazel rules and what to packages are required.</p>
<p>Let’s add <code>okhttp3</code> from maven as dependency to <code>Sample Project</code>.</p>
<h3 id="update-workspace-file">Update WORKSPACE file</h3>
<div><pre tabindex="0"><code data-lang="shell"><span><span>load<span>(</span><span>&#34;@bazel_tools//tools/build_defs/repo:http.bzl&#34;</span>, <span>&#34;http_archive&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>RULES_JVM_EXTERNAL_TAG</span> <span>=</span> <span>&#34;4.2&#34;</span>
</span></span><span><span>
</span></span><span><span><span>RULES_JVM_EXTERNAL_SHA</span> <span>=</span> <span>&#34;cd1a77b7b02e8e008439ca76fd34f5b07aecb8c752961f9640dea15e9e5ba1ca&#34;</span>
</span></span><span><span>
</span></span><span><span>http_archive<span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;rules_jvm_external&#34;</span>,
</span></span><span><span>    <span>sha256</span> <span>=</span> RULES_JVM_EXTERNAL_SHA,
</span></span><span><span>    <span>strip_prefix</span> <span>=</span> <span>&#34;rules_jvm_external-%s&#34;</span> % RULES_JVM_EXTERNAL_TAG,
</span></span><span><span>    <span>url</span> <span>=</span> <span>&#34;https://github.com/bazelbuild/rules_jvm_external/archive/%s.zip&#34;</span> % RULES_JVM_EXTERNAL_TAG,
</span></span><span><span><span>)</span>
</span></span><span><span>
</span></span><span><span>load<span>(</span><span>&#34;@rules_jvm_external//:repositories.bzl&#34;</span>, <span>&#34;rules_jvm_external_deps&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span>rules_jvm_external_deps<span>()</span>
</span></span><span><span>
</span></span><span><span>load<span>(</span><span>&#34;@rules_jvm_external//:setup.bzl&#34;</span>, <span>&#34;rules_jvm_external_setup&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span>rules_jvm_external_setup<span>()</span>
</span></span><span><span>
</span></span><span><span>load<span>(</span><span>&#34;@rules_jvm_external//:defs.bzl&#34;</span>, <span>&#34;maven_install&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span>maven_install<span>(</span>
</span></span><span><span>    <span>artifacts</span> <span>=</span> <span>[</span>
</span></span><span><span>        <span># https://mvnrepository.com/artifact/com.squareup.okhttp3/okhttp</span>
</span></span><span><span>        <span>&#34;com.squareup.okhttp3:okhttp:jar:4.10.0&#34;</span>,
</span></span><span><span>    <span>]</span>,
</span></span><span><span>    <span>repositories</span> <span>=</span> <span>[</span>
</span></span><span><span>        <span>&#34;https://repo1.maven.org/maven2&#34;</span>,
</span></span><span><span>    <span>]</span>,
</span></span><span><span><span>)</span>
</span></span></code></pre></div><p>That’s a lot of copy-paste code!</p>
<ol>
<li>First the bazel workspace loads <code>http</code> build file located in <code>bazeltools</code> repo.</li>
<li>Sets some rules for JVM, external dependencies and external setup.</li>
<li>Then workspace loads <code>maven_install</code> function.</li>
<li><code>maven_install</code> function specifies the dependency and repository location for installation.</li>
</ol>
<h3 id="update-the-build-file">Update the BUILD file</h3>
<p>Now the workspace knows what to load for the project, now let’s update the build file.</p>
<p>Most of the heavy lifting happens in the WORKSPACE file.
In build file, mention the dependency to load using <code>deps</code> parameter to the function <code>java_binary</code>.</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>java_binary</span><span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;Sample&#34;</span><span>,</span>
</span></span><span><span>    <span>srcs</span> <span>=</span> <span>glob</span><span>([</span><span>&#34;src/main/java/com/example/*.java&#34;</span><span>]),</span>
</span></span><span><span>    <span>deps</span> <span>=</span> <span>[</span>
</span></span><span><span>        <span>&#34;@maven//:com_squareup_okhttp3_okhttp&#34;</span><span>,</span>
</span></span><span><span>    <span>],</span>
</span></span><span><span><span>)</span>
</span></span></code></pre></div><p><code>@maven</code> indicates the dependency is a maven install. And in the name, <code>.</code> in artifcat becomes  <code>_</code>.</p>
<div><pre tabindex="0"><code data-lang="shell"><span><span>bazel build Sample
</span></span><span><span>INFO: Analyzed target //:Sample <span>(</span><span>41</span> packages loaded, <span>753</span> targets configured<span>)</span>.
</span></span><span><span>INFO: Found <span>1</span> target...
</span></span><span><span>Target //:Sample up-to-date:
</span></span><span><span>  bazel-bin/Sample.jar
</span></span><span><span>  bazel-bin/Sample
</span></span><span><span>INFO: Elapsed time: 5.997s, Critical Path: 2.27s
</span></span><span><span>INFO: <span>20</span> processes: <span>7</span> internal, <span>10</span> linux-sandbox, <span>3</span> worker.
</span></span><span><span>INFO: Build completed successfully, <span>20</span> total actions
</span></span></code></pre></div><h3 id="add-protobuf-as-dependency">Add protobuf as dependency</h3>
<p>Similar to maven rules, it’s possible to download any dependency from the internet and add it as dependency.</p>
<p><a href="https://developers.google.com/protocol-buffers/">Protobuf</a> is a binary data serialization format
for communicating with services. Since it’s a binary format,
the proto buffer compiler generates the java class to encode and decode.</p>
<p>Let’s add a proto buf definition to the project and use it.</p>
<p>Create a new directory <code>protos</code> in example directory and  add <code>label.proto</code>.</p>
<p>A simple Label with list of names. Extra option configuration is to generate java class from proto definition.</p>
<div><pre tabindex="0"><code data-lang="java"><span><span><span>syntax</span> <span>=</span> <span>&#34;proto3&#34;</span><span>;</span>
</span></span><span><span><span>package</span> <span>example</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>option</span> <span>java_multiple_files</span> <span>=</span> <span>true</span><span>;</span>
</span></span><span><span><span>option</span> <span>java_package</span> <span>=</span> <span>&#34;com.example.protos&#34;</span><span>;</span>
</span></span><span><span><span>option</span> <span>java_outer_classname</span> <span>=</span> <span>&#34;LabelProtos&#34;</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>message</span> <span>Label</span> <span>{</span>
</span></span><span><span>  <span>repeated</span> <span>string</span> <span>names</span> <span>=</span> <span>1</span><span>;</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>Add <a href="https://github.com/cgrushko/proto_library">following lines</a> to <code>WORKSPACE</code> file</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span># proto</span>
</span></span><span><span><span># rules_cc defines rules for generating C++ code from Protocol Buffers.</span>
</span></span><span><span><span>http_archive</span><span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;rules_cc&#34;</span><span>,</span>
</span></span><span><span>    <span>sha256</span> <span>=</span> <span>&#34;35f2fb4ea0b3e61ad64a369de284e4fbbdcdba71836a5555abb5e194cf119509&#34;</span><span>,</span>
</span></span><span><span>    <span>strip_prefix</span> <span>=</span> <span>&#34;rules_cc-624b5d59dfb45672d4239422fa1e3de1822ee110&#34;</span><span>,</span>
</span></span><span><span>    <span>urls</span> <span>=</span> <span>[</span>
</span></span><span><span>        <span>&#34;https://mirror.bazel.build/github.com/bazelbuild/rules_cc/archive/624b5d59dfb45672d4239422fa1e3de1822ee110.tar.gz&#34;</span><span>,</span>
</span></span><span><span>        <span>&#34;https://github.com/bazelbuild/rules_cc/archive/624b5d59dfb45672d4239422fa1e3de1822ee110.tar.gz&#34;</span><span>,</span>
</span></span><span><span>    <span>],</span>
</span></span><span><span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>http_archive</span><span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;rules_java&#34;</span><span>,</span>
</span></span><span><span>    <span>sha256</span> <span>=</span> <span>&#34;ccf00372878d141f7d5568cedc4c42ad4811ba367ea3e26bc7c43445bbc52895&#34;</span><span>,</span>
</span></span><span><span>    <span>strip_prefix</span> <span>=</span> <span>&#34;rules_java-d7bf804c8731edd232cb061cb2a9fe003a85d8ee&#34;</span><span>,</span>
</span></span><span><span>    <span>urls</span> <span>=</span> <span>[</span>
</span></span><span><span>        <span>&#34;https://mirror.bazel.build/github.com/bazelbuild/rules_java/archive/d7bf804c8731edd232cb061cb2a9fe003a85d8ee.tar.gz&#34;</span><span>,</span>
</span></span><span><span>        <span>&#34;https://github.com/bazelbuild/rules_java/archive/d7bf804c8731edd232cb061cb2a9fe003a85d8ee.tar.gz&#34;</span><span>,</span>
</span></span><span><span>    <span>],</span>
</span></span><span><span><span>)</span>
</span></span><span><span>
</span></span><span><span><span># rules_proto defines abstract rules for building Protocol Buffers.</span>
</span></span><span><span><span>http_archive</span><span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;rules_proto&#34;</span><span>,</span>
</span></span><span><span>    <span>sha256</span> <span>=</span> <span>&#34;2490dca4f249b8a9a3ab07bd1ba6eca085aaf8e45a734af92aad0c42d9dc7aaf&#34;</span><span>,</span>
</span></span><span><span>    <span>strip_prefix</span> <span>=</span> <span>&#34;rules_proto-218ffa7dfa5408492dc86c01ee637614f8695c45&#34;</span><span>,</span>
</span></span><span><span>    <span>urls</span> <span>=</span> <span>[</span>
</span></span><span><span>        <span>&#34;https://mirror.bazel.build/github.com/bazelbuild/rules_proto/archive/218ffa7dfa5408492dc86c01ee637614f8695c45.tar.gz&#34;</span><span>,</span>
</span></span><span><span>        <span>&#34;https://github.com/bazelbuild/rules_proto/archive/218ffa7dfa5408492dc86c01ee637614f8695c45.tar.gz&#34;</span><span>,</span>
</span></span><span><span>    <span>],</span>
</span></span><span><span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>load</span><span>(</span><span>&#34;@rules_cc//cc:repositories.bzl&#34;</span><span>,</span> <span>&#34;rules_cc_dependencies&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>rules_cc_dependencies</span><span>()</span>
</span></span><span><span>
</span></span><span><span><span>load</span><span>(</span><span>&#34;@rules_java//java:repositories.bzl&#34;</span><span>,</span> <span>&#34;rules_java_dependencies&#34;</span><span>,</span> <span>&#34;rules_java_toolchains&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>rules_java_dependencies</span><span>()</span>
</span></span><span><span>
</span></span><span><span><span>rules_java_toolchains</span><span>()</span>
</span></span><span><span>
</span></span><span><span><span>load</span><span>(</span><span>&#34;@rules_proto//proto:repositories.bzl&#34;</span><span>,</span> <span>&#34;rules_proto_dependencies&#34;</span><span>,</span> <span>&#34;rules_proto_toolchains&#34;</span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>rules_proto_dependencies</span><span>()</span>
</span></span><span><span>
</span></span><span><span><span>rules_proto_toolchains</span><span>()</span>
</span></span></code></pre></div><p>So many rules and setup for proto conversion and java specific instructions!</p>
<h3 id="protobuf-build-instructions-and-example">protobuf BUILD instructions and example</h3>
<p>Now add the proto build instructions in <code>BUILD</code> file</p>
<ol>
<li>Load the bazel definition for proto library and java proto library.</li>
</ol>
<div><pre tabindex="0"><code data-lang="python"><span><span>
</span></span><span><span><span>load</span><span>(</span><span>&#34;@rules_proto//proto:defs.bzl&#34;</span><span>,</span> <span>&#34;proto_library&#34;</span><span>)</span>
</span></span><span><span><span>load</span><span>(</span><span>&#34;@rules_java//java:defs.bzl&#34;</span><span>,</span> <span>&#34;java_proto_library&#34;</span><span>)</span>
</span></span></code></pre></div><ol start="2">
<li>Convert proto definition and generate java code</li>
</ol>
<div><pre tabindex="0"><code data-lang="python"><span><span>
</span></span><span><span><span>proto_library</span><span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;label_proto&#34;</span><span>,</span>
</span></span><span><span>    <span>srcs</span> <span>=</span> <span>[</span><span>&#34;src/main/java/com/example/protos/label.proto&#34;</span><span>],</span>
</span></span><span><span><span>)</span>
</span></span><span><span>
</span></span><span><span><span>java_proto_library</span><span>(</span>
</span></span><span><span>    <span>name</span> <span>=</span> <span>&#34;label_java_proto&#34;</span><span>,</span>
</span></span><span><span>    <span>deps</span> <span>=</span> <span>[</span><span>&#34;:label_proto&#34;</span><span>],</span>
</span></span><span><span><span>)</span>
</span></span></code></pre></div><ol start="3">
<li>Update the <code>deps</code> in <code>java_binary</code> function call to include the generate java code.</li>
</ol>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>deps</span> <span>=</span> <span>[</span>
</span></span><span><span>        <span>&#34;:label_java_proto&#34;</span><span>,</span>
</span></span><span><span>        <span>&#34;@maven//:com_squareup_okhttp3_okhttp&#34;</span><span>,</span>
</span></span><span><span>    <span>],</span>
</span></span></code></pre></div><ol start="3">
<li>Modify the <code>Sample.java</code> code to use generated Java class</li>
</ol>
<div><pre tabindex="0"><code data-lang="java"><span><span><span>package</span> <span>com.example</span><span>;</span>
</span></span><span><span><span>import</span> <span>com.example.protos.Label</span><span>;</span>
</span></span><span><span><span>import</span> <span>java.util.ArrayList</span><span>;</span>
</span></span><span><span>
</span></span><span><span><span>public</span> <span>class</span> <span>Sample</span><span>{</span>
</span></span><span><span>    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[]</span> <span>args</span><span>)</span> <span>{</span>
</span></span><span><span>        <span>ArrayList</span><span>&lt;</span><span>String</span><span>&gt;</span> <span>names</span> <span>=</span> <span>new</span> <span>ArrayList</span><span>&lt;</span><span>String</span><span>&gt;();</span>
</span></span><span><span>        <span>names</span><span>.</span><span>add</span><span>(</span><span>&#34;Adult!&#34;</span><span>);</span>
</span></span><span><span>        <span>names</span><span>.</span><span>add</span><span>(</span><span>&#34;Programmer&#34;</span><span>);</span>
</span></span><span><span>
</span></span><span><span>        <span>Label</span><span>.</span><span>Builder</span> <span>builder</span> <span>=</span> <span>Label</span><span>.</span><span>newBuilder</span><span>();</span>
</span></span><span><span>        <span>builder</span><span>.</span><span>addAllNames</span><span>(</span><span>names</span><span>);</span>
</span></span><span><span>        <span>Label</span> <span>label</span> <span>=</span> <span>builder</span><span>.</span><span>build</span><span>();</span>
</span></span><span><span>        <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span>String</span><span>.</span><span>format</span><span>(</span><span>&#34;Hello: %s&#34;</span><span>,</span> <span>label</span><span>));</span>
</span></span><span><span>
</span></span><span><span>    <span>}</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><ol start="4">
<li>Run the target.</li>
</ol>
<div><pre tabindex="0"><code data-lang="shell"><span><span>bazel run Sample
</span></span><span><span>INFO: Analyzed target //:Sample <span>(</span><span>0</span> packages loaded, <span>0</span> targets configured<span>)</span>.
</span></span><span><span>INFO: Found <span>1</span> target...
</span></span><span><span>Target //:Sample up-to-date:
</span></span><span><span>  bazel-bin/Sample.jar
</span></span><span><span>  bazel-bin/Sample
</span></span><span><span>INFO: Elapsed time: 0.501s, Critical Path: 0.45s
</span></span><span><span>INFO: <span>5</span> processes: <span>1</span> internal, <span>2</span> linux-sandbox, <span>2</span> worker.
</span></span><span><span>INFO: Build completed successfully, <span>5</span> total actions
</span></span><span><span>INFO: Build completed successfully, <span>5</span> total actions
</span></span><span><span>Hello: names: <span>&#34;Adult!&#34;</span>
</span></span><span><span>names: <span>&#34;Programmer&#34;</span>
</span></span></code></pre></div><h3 id="common-beginner-mistakes">Common beginner mistakes</h3>
<ol>
<li>Using wrong function in BUILD and WORKSPACE.</li>
<li>Not loading relevant load functions or rules.</li>
<li>Missing out dependency in deps.</li>
</ol>
<h3 id="conclusion">Conclusion</h3>
<p>There are a lot of more important concepts like <code>visibility, local dependency</code> that’s skipped.
Another tutorial for another day.</p>
<p>Bazel is definitely confusing and powerful build system that can make you hate building the package.
In my opinion, learning bazel is like learning new programming language with step-learning curves.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://bazel.build/start/java">Bazel build for java</a></li>
<li><a href="https://bazel.build/rules/lib/repo/http#http_archive">Bazel http_archive</a></li>
<li><a href="https://bazel.build/migrate/maven">Bazel Maven integration</a></li>
<li><a href="https://mvnrepository.com/artifact/com.squareup.okhttp3/okhttp/4.10.0">OkHTTP Maven repository</a></li>
<li><a href="https://github.com/bazelbuild/rules_jvm_external">Bazel JVM rules</a></li>
<li><a href="https://blog.bazel.build/2017/02/27/protocol-buffers.html">Protobuf in Bazel</a></li>
<li><a href="https://github.com/cgrushko/proto_library">Bazel Proto library</a></li>
<li><a href="https://github.com/bazelbuild/rules_proto/releases">Bazel proto rules</a></li>
<li><a href="https://github.com/kracekumar/jplay/tree/bazel-101">Repo with source code</a></li>
<li><a href="https://developers.google.com/protocol-buffers/">Proto buf</a></li>
</ul>


        
          
        

        

        
          

          
                  
       <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"/></a></article></div>
  </body>
</html>
