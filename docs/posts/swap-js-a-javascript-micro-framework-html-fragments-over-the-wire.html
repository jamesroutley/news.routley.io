<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/josephernest/Swap">Original</a>
    <h1>Show HN: Swap.js â€“ a JavaScript micro-framework (HTML fragments over the wire)</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/6168083/239333696-38f392b7-b537-4cb9-a52a-6c0ef25a8c85.jpg"><img src="https://user-images.githubusercontent.com/6168083/239333696-38f392b7-b537-4cb9-a52a-6c0ef25a8c85.jpg" alt="logo_new300px"/></a></p>
<p dir="auto"><strong>Swap.js</strong> is a JavaScript micro-library which facilitates AJAX-style navigation in web pages, in less than ~ 100 lines of code. (See <a href="#user-content-why-a-100-line-of-code-limit">&#34;Why?&#34;</a> paragraph below)</p>
<p dir="auto">This is inspired by the recent libraries that make server-side-rendering and &#34;HTML-over-the-wire&#34; techniques popular again (HTMX, Unpoly, Hotwire...).</p>
<p dir="auto">Demo here using this library: <a href="https://afewthingz.com/swap-library/email/" rel="nofollow"><strong>Demo</strong></a></p>
<p dir="auto">Features:</p>
<ul dir="auto">
<li>AJAX-style navigation and replacement of HTML elements of the page</li>
<li>handling of the browser history (history back button, etc.)</li>
<li>automatic code launcher when HTML elements are created/removed in the DOM</li>
<li>adapted for single page applications (or not)</li>
</ul>
<p dir="auto">Important aspects:</p>
<ul dir="auto">
<li>vanilla JS (no external tool needed: no bundler, no webpack, no TypeScript compiler, no minification needed...)</li>
<li>the good old <code>&lt;a href=&#34;...&#34;</code> navigation still works if JavaScript is disabled in the browser (progressive enhancement)</li>
<li>you can keep your current server-side rendering solution (PHP, Python...)</li>
</ul>
<p dir="auto"><strong>Key idea:</strong></p>
<blockquote>
<div data-snippet-clipboard-copy-content="&lt;a href=&#34;newpage.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Click me&lt;/a&gt;
&lt;div id=&#34;container&#34;&gt;Container&lt;/div&gt;`"><pre><code>&lt;a href=&#34;newpage.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Click me&lt;/a&gt;
&lt;div id=&#34;container&#34;&gt;Container&lt;/div&gt;`
</code></pre></div>
<p dir="auto">When you click on <em>&#34;Click me&#34;</em>, the element <code>#container</code> is replaced by <code>newpage.html</code>&#39;s <code>#container</code>. Simple isn&#39;t it?</p>
</blockquote>

<p dir="auto">See <code>demo1/</code> folder.</p>
<p dir="auto"><code>index.html</code></p>
<div data-snippet-clipboard-copy-content="&lt;body&gt;
&lt;a href=&#34;index.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Home&lt;/a&gt;
&lt;a href=&#34;screen2.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Go to screen 2&lt;/a&gt;
&lt;div id=&#34;container&#34;&gt;Container&lt;/div&gt;
&lt;script src=&#34;../swap.js&#34;&gt;&lt;/script&gt;
&lt;/body&gt;"><pre><code>&lt;body&gt;
&lt;a href=&#34;index.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Home&lt;/a&gt;
&lt;a href=&#34;screen2.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Go to screen 2&lt;/a&gt;
&lt;div id=&#34;container&#34;&gt;Container&lt;/div&gt;
&lt;script src=&#34;../swap.js&#34;&gt;&lt;/script&gt;
&lt;/body&gt;
</code></pre></div>
<p dir="auto"><code>screen2.html</code></p>
<div data-snippet-clipboard-copy-content="&lt;body&gt;
&lt;a href=&#34;index.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Home&lt;/a&gt;
&lt;a href=&#34;screen2.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Go to screen 2&lt;/a&gt;
&lt;div id=&#34;container&#34;&gt;You are on screen 2!&lt;/div&gt;
&lt;script src=&#34;../swap.js&#34;&gt;&lt;/script&gt;
&lt;/body&gt;"><pre><code>&lt;body&gt;
&lt;a href=&#34;index.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Home&lt;/a&gt;
&lt;a href=&#34;screen2.html&#34; swap-target=&#34;#container&#34; swap-history=&#34;true&#34;&gt;Go to screen 2&lt;/a&gt;
&lt;div id=&#34;container&#34;&gt;You are on screen 2!&lt;/div&gt;
&lt;script src=&#34;../swap.js&#34;&gt;&lt;/script&gt;
&lt;/body&gt;
</code></pre></div>
<p dir="auto">Of course, in real life, you don&#39;t want to duplicate the same header and footer in multiple HTML files, and you will want to use server-side rendering: for a more complete example, see <code>demo2/</code> folder with PHP code, multiple screens, multiple containers to be replaced, and also with some JS code that is run automatically when elements are inserted/destroyed in the DOM.</p>

<p dir="auto">The folder <code>demo3-email/</code> is another example of usage of the library. Nearly no JS is written, but mostly HTML attributes.</p>
<p dir="auto"><a href="https://afewthingz.com/swap-library/email/" rel="nofollow"><strong>Live demo</strong></a></p>
<p dir="auto"><a href="https://afewthingz.com/swap-library/email/" rel="nofollow"><img src="https://user-images.githubusercontent.com/6168083/183262644-de8b396c-a0ee-46fc-9ebc-943ba7bf656b.png" alt=""/></a></p>

<p dir="auto">You can use these 3 features:</p>
<ul dir="auto">
<li>
<p dir="auto"><strong><code>swap-target</code> (HTML attribute)</strong></p>
<p dir="auto">If present on a <code>&lt;a href=&#34;...&#34;</code> link, then, when clicked, a HTTP request is done with <code>fetch()</code> and the HTML fragment of the response <em>matched by the CSS selector</em> <code>swap-target</code> will replace the part of the current page <em>matched by this same selector</em>.</p>
<p dir="auto">This little detail is quite powerful because it allows you to continue to always render the full page server-side, no matter if only a HTML fragment will be used client-side (because AJAX navigation) or if the full page is required (for example, because the user did a refresh on the navigator). If you find in certain cases that it&#39;s a waste of bytes to send the full page in every case you can also render <em>only</em> a fragment server-side, based on the presence of HTTP request header <code>swap-target</code> (<code>$_SERVER[&#39;HTTP_SWAP_TARGET&#39;]</code> in PHP), but this is <em>purely optional</em>.</p>
</li>
<li>
<p dir="auto"><strong><code>swap-history</code> (HTML attribute)</strong></p>
<p dir="auto">If <code>true</code>, a new browser history element will be pushed when the link is clicked.</p>
<p dir="auto">When going back in history, an AJAX-call is made to update <code>&lt;body&gt;</code> based on the history URL.</p>
</li>
<li>
<p dir="auto"><strong>Loader/unloader JS functions when DOM elements are added/removed</strong></p>
<p dir="auto">Sometimes, you want to execute JS code when a new HTML fragment is inserted, or when it is removed. Here is how it works:</p>
<div data-snippet-clipboard-copy-content="Swap.loaders[&#39;.screen2&#39;] = () =&gt; {
    console.log(&#34;An element with class screen2 has just been inserted in the DOM.&#34;)
    var task = setInterval(() =&gt; { console.log(&#34;On repeat!&#34;); }, 1000);
    return () =&gt; { clearInterval(task); };                // in a loader function, you return an unloader function which will be executed when the element is removed from DOM
}"><pre><code>Swap.loaders[&#39;.screen2&#39;] = () =&gt; {
    console.log(&#34;An element with class screen2 has just been inserted in the DOM.&#34;)
    var task = setInterval(() =&gt; { console.log(&#34;On repeat!&#34;); }, 1000);
    return () =&gt; { clearInterval(task); };                // in a loader function, you return an unloader function which will be executed when the element is removed from DOM
}
</code></pre></div>
</li>
</ul>

<p dir="auto">When you start a new web project and decide to use a rather new library xyz.js, you always take the risk that:</p>
<ul dir="auto">
<li>eventually xyz.js will not be maintained anymore</li>
<li>a feature is missing but you don&#39;t know where to add it in the 50 different source code files with a total of 10&#39;000 lines of code</li>
<li>there is a strange bug but you can&#39;t find where it is in these 10k lines of code</li>
<li>the library has hundreds of features you don&#39;t need</li>
</ul>
<p dir="auto">For this reason, this micro-library will always stay single-file and not have more than ~ 100 lines of code. No complex feature will be added, it will stay very basic. The benefit of all this is that you can read, understand, and improve the full code of the micro-library in less than 1 hour of your time.</p>
<p dir="auto">This project&#39;s source code was initially <em>much larger</em> than its current state, with more complex mechanisms (for the same result), and I spent good time simplifying it and keep (what I find) the most elegant solution. It looks simple now, but it wasn&#39;t initially ;) (the use of MutationObserver API was helpful).</p>

<p dir="auto">Issues, ideas, discussions are welcome - please open an issue before doing a pull request to be sure it is necessary.</p>
<p dir="auto">Which simple feature would you want to to see included? After all the current code is &lt; 50 lines of code, so there is plenty of room until reaching the 100 lines of code limit :)</p>

<p dir="auto">Joseph Ernest</p>
<p dir="auto">For R&amp;D, Python, data science, automation consulting/freelancing requests, please contact me on <a href="https://afewthingz.com" rel="nofollow">https://afewthingz.com</a>.</p>
<p dir="auto">Sponsors are welcome to support the development of my open-source projects.</p>
<p dir="auto">I am currently sponsored by <a href="https://codesigningstore.com" rel="nofollow">CodeSigningStore.com</a>. Thank you to them for providing a DigiCert Code Signing Certificate and supporting open source software.</p>

<p dir="auto">MIT</p>
</article>
          </div></div>
  </body>
</html>
