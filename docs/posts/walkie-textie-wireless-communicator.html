<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://www.technoblogy.com/show?2AON">Original</a>
    <h1>Walkie-Textie Wireless Communicator</h1>
    
    <div id="readability-page-1" class="page"><div id="content">

<p>29th July 2025</p>
<p>The Walkie-Textie is a simple handheld device with a 12-key keypad and OLED display that allows you to send and receive text messages using the LoRa wireless protocol. It&#39;s ideal for situations where there&#39;s no mobile signal, such as when you&#39;re camping or hiking in a remote area, when you don&#39;t want the cost of a mobile network, or for children to have fun without running up a bill:</p>
<p><img src="https://unplannedobsolescence.com/pictures/kvm/walkietextieangle.jpg" alt="WalkieTextieAngle.jpg" width="720" height="480"/></p>
<p><em>The Walkie-Textie is a handheld device that allows you to send text messages</em></p>
<p>The circuit uses a low-cost LoRa module, the HopeRF RFM95W, controlled by an ATtiny814, which also drives a low-cost monochrome OLED display to show the messages, reads the keyboard, provides an audio alert, and reads the battery level.</p>
<h3>Introduction</h3>
<p>The Walkie-Textie uses the LoRa wireless protocol which is unsuitable for speech, but ideal for short text messages. LoRa can reach a range of up to 3 miles (4.8 km) in urban areas, and up to 10 miles (16 km) in rural areas. It uses license-free sub-gigahertz radio frequency bands: 433 MHz or 868 MHz in Europe, 915 MHz in North and South America, 868 MHz in India, and 915 MHz in Asia. The LoRa modules are available in two versions: one for 433 MHz, and one that can be tuned to either 868 MHz or 915 MHz.</p>
<h4>Using the Walkie-Textie</h4>
<p>The Walkie-Textie has a twelve-key keypad, and like early mobile phones uses a technique called multi-tap to compose messages, in which repeatedly pressing the same key cycles through the characters for that key:</p>
<p><img src="https://unplannedobsolescence.com/pictures/kvm/walkietextie.jpg" alt="WalkieTextie.jpg" width="340" height="635"/></p>
<p><em>The Walkie-Textie lets you write messages on a 12-key keypad</em></p>
<p>If you&#39;re too young to remember having to write messages like this count yourself lucky! But early texters became very fast at the technique. This is how it works:</p>
<ul>
<li>Press a key to enter one of the characters on that key.</li>
</ul>
<p>Pressing the key repeatedly steps through the letters and digit in sequence. To enter another character on the same key wait until the cursor reappears before pressing again.</p>
<p>The &#39;0&#39; key includes space. The &#39;1&#39; key includes full stop and a sequence of punctuation marks and other symbols.</p>
<ul>
<li>To delete the last character press &#39;#&#39;.</li>
<li>To send your message press &#39;*&#39;.</li>
</ul>
<p>When you receive a message the indicator light flashes and a beeper sounds.</p>
<p>The Walkie-Textie limits the length of each message to one line of 20 characters, but you can send multiple lines in succession. When you receive replies they are interleaved with your messages in the scrolling window, in a similar way to message or chat apps.</p>
<p>If you prefer not to have a beeper you can toggle it on or off by holding down the &#39;#&#39; key when you first turn on the Walkie-Textie.</p>
<p>A status bar at the top of the display shows the signal strength of the last received message, the beeper status, and the battery level:</p>
<p><img src="https://unplannedobsolescence.com/pictures/kvm/lorastatus.gif" alt="LoRaStatus.gif" width="390" height="27"/></p>
<h4>History</h4>
<p>The Walkie-Textie is project that I started several months ago, with an initial prototype based on the Microchip RN2483 LoRa transmitter/receiver that you control via a serial interface using AT commands, but I found parsing the AT commands made writing the user interface very difficult, and the project ground to a halt. Recently I was experimenting with the HopeRF modules and decided that they would offer a simpler solution, and so resumed the project.</p>
<h3>The circuit</h3>
<p>Here&#39;s the circuit of the Walkie-Textie:</p>
<p><img src="https://unplannedobsolescence.com/pictures/kvm/walkie-textie.gif" alt="Walkie-Textie.gif" width="720" height="278"/></p>
<p><em>The circuit of the Walkie-Textie, based on an RFM95W LoRa module and an ATtiny814.</em></p>
<p>Although I used an ATtiny814 you could also use an ATtiny804, ATtiny1604, or ATtiny1614.</p>
<p>The circuit takes advantage of my <a href="https://unplannedobsolescence.com/show?NGM">One Input Keypad Interface</a> to read the keyboard using a single analogue input on the ATtiny814.</p>
<p>The RFM95W is connected to four pins on the ATtiny814 to handle the SPI interface, and two additional pins to control <strong>RST</strong> and <strong>DIO0</strong>, the reset and interrupt pins.</p>
<p>Because I&#39;d run out of pins the circuit uses the same pin PA5 to drive the piezo beeper, and read the battery voltage via a voltage divider, since these functions don&#39;t interfere with each other.</p>
<h4>Display</h4>
<p>For the display I chose a 128x64 monochrome I2C OLED display available from AliExpress and eBay:</p>
<p><img src="https://unplannedobsolescence.com/pictures/kvm/geekcreitdisplay.jpg" alt="GeekcreitDisplay.jpg" width="404" height="328"/></p>
<p>These are based on the SH1106 driver chip, and the pins should be in the order GND, VCC, SCL, SDA. Note there are some virtually identical displays for sale with the order of the GND and VCC pins swapped, but these won&#39;t be suitable for the PCB without modification. The program is also compatible with an SSD1306 128x64 display by changing one constant.</p>
<h4>Aerial options</h4>
<p>The simplest antenna is just a short length of wire soldered to the connection marked ANT on the PCB. Alternatively the PCB will accommodate an SMA socket which will allow you to fit a &#39;rubber ducky&#39; antenna. For more information see <a href="#providing-an-antenna">Providing an antenna</a> below.</p>
<h4>Powering options</h4>
<p>The PCB has space for a 2-pin JST socket that will allow you to plug in a standard LiPo battery, such as the ones supplied by Adafruit <sup id="cite_ref1"><a href="#cite_note1">[1]</a></sup>. I used a  240mAh 7 x 20 x 30mm LiPo cell. Alternatively you could power the Walkie-Textie from two AAA batteries; you can buy battery holders already fitted with a suitable JST plug <sup id="cite_ref2"><a href="#cite_note2">[2]</a></sup>.</p>
<p>A regulator drops the battery voltage to 3.3V suitable for the LoRa module. The typical current consumption is 24mA.</p>
<p>Here&#39;s the full parts list (click to expand):</p>
<h4>► Parts list</h4>

<h3>Construction</h3>
<p>I designed a PCB in Eagle and sent it to JLCPCB for manufacture. For the solder mask colour I chose black because I thought it would be appropriate, making it look like a classic mobile phone.</p>
<p>The components apart from the display and push buttons are mounted onto the back of the board:</p>
<p><img src="https://unplannedobsolescence.com/pictures/kvm/walkietextierear.jpg" alt="WalkieTextieRear.jpg" width="370" height="600"/></p>
<p><em>The components on the back of the Walkie-Textie PCB.</em></p>
<p>The ATtiny814 is in an SOIC package, and the resistors, capacitor, and LED are all 0805 size, so they should be relatively easy to solder using a fine-tipped soldering iron. I recently bought a Miniware MHP50-B5 50x50mm hotplate <sup id="cite_ref3"><a href="#cite_note3">[3]</a></sup> <sup id="cite_ref4"><a href="#cite_note4">[4]</a></sup> and so I used this. Although the board doesn&#39;t fit on the hotplate, I did half of the board at a time by balancing it on the hotplate in the following sequence:</p>
<ul>
<li>Use the hotplate to solder the SMT components on the top half of the back of the board.</li>
<li>Use the hotplate to solder the SMT push buttons on the bottom half of the front of the board.</li>
<li>Finish the resistors on the bottom half of the back of the board, and the LED on the front of the board, with a hot air gun or soldering iron.</li>
<li>Solder the switch using a soldering iron.</li>
</ul>
<h4>Display</h4>
<p>The display header pin holes are staggered, with each hole shifted 8 mil (~0.2 mm) off-centre. This allows you to push the display&#39;s pin headers in place, and they will stay firmly connected without soldering.</p>
<h4>Back panel</h4>
<p>I used a spare PCB as a back panel, held in place with M3 screws and threaded pillars <sup id="cite_ref5"><a href="#cite_note5">[5]</a></sup>. If you are using a small LiPo battery 8mm threaded pillars should be ideal, but for the 2 x AAA battery holder you&#39;ll need 18mm or 20mm threaded pillars. The upper front screws can be fitted with nuts or washers to hold the display in place too.</p>
<h3 id="providing-an-antenna">Providing an antenna</h3>
<p>The PCB will allow you to fit an edge-mounting SMA connector, designed for a PCB with a thickness of 1.6mm, so you can use a matching &#34;rubber ducky&#34; antenna. Alternatively the antenna can simply be a short length of single-core cable connected to the centre terminal marked ANT on the back of the board. I tested both alternatives over 30 metres with one of my prototypes and the simple wire antenna gave similar RSSI readings to a rubber ducky, so unless you like the more professional look I recommend a wire antenna.</p>
<p>The wire antenna should be a quarter-wave monopole, reduced by about 5% for the end effect; I used silicone stranded cable so it wouldn&#39;t break with repeated flexing <sup id="cite_ref6"><a href="#cite_note6">[6]</a></sup>. The length for each frequency is as follows:</p>
<table>
<thead>
<tr>
<td><strong>Frequency</strong></td>
<td><strong>Antenna length</strong></td>
</tr>
</thead>
<tbody>
<tr>
<td>433 MHz</td>
<td>165 mm</td>
</tr>
<tr>
<td>868 MHz</td>
<td>82 mm</td>
</tr>
<tr>
<td>915 MHz</td>
<td>78 mm</td>
</tr>
</tbody>
</table>
<h3>The program</h3>
<h4>Character terminal</h4>
<p>The Walkie-Textie uses my <a href="https://unplannedobsolescence.com/show?23OS">Tiny Graphics Library</a> routines to interface to an SH1106 or SSD1306 monochrome I2C 128x64 OLED display, modified for use with the ATtiny814. These routines only support character-cell plotting, based on a display of 8 lines and 21 columns, and thus avoid the need for a memory display buffer. They also take advantage of the hardware vertical scroll provided by the SH1106/SSD1306 display drivers.</p>
<p>The routines provided are:</p>
<ul>
<li><strong>InitDisplay(</strong>) - Display initialisation.</li>
<li><strong>ClearDisplay()</strong> - Clears the display.</li>
<li><strong>ClearLine()</strong> - Clears a single line on the display.</li>
<li><strong>ScrollDisplay()</strong> - Clears the top line, then scrolls the display up by one line.</li>
<li><strong>PlotChar()</strong> - Plots a character at a specified line and column using a 5x7 bitmap font.</li>
<li><strong>PrintString()</strong> - Prints a string to the display.</li>
</ul>
<h4>Keypad</h4>
<p>Keypad uses my <a href="https://unplannedobsolescence.com/show?NGM">One Input Keypad Interface</a> to read the entire keypad using a single analogue input on the ATtiny814.</p>
<p>The multi-tap processing uses an array Multitap[] to define the sequence of characters assigned to each key:</p>
<pre>const char *Multitap[12] =
{ &#34; 0&#34;, &#34;.1!\&#34;#$%&amp;&#39;()*+,-/:;&lt;=&gt;?@[\\]^_`{|}~&#34;,
  &#34;ABC2abc&#34;, &#34;DEF3def&#34;, &#34;GHI4ghi&#34;, &#34;JKL5jkl&#34;, &#34;MNO6mno&#34;,
  &#34;PQRS7pqrs&#34;, &#34;TUV8tuv&#34;, &#34;WXYZ9wxyz&#34;, &#34;*&#34;, &#34;#&#34; };</pre>
<p>I kept to the traditional assignment of letters to keys, but of course you can change this to suit your preferences.</p>
<p>The multi-tap processing is handled in the main routine, <strong>Interface()</strong>. Within a timeout period of 1000 milliseconds pressing the same key again cycles through the sequence of letters assigned to the key, overprinting the previously entered character. Once the timeout period has expired the cursor is displayed by calling <strong>Display(ShowCursor)</strong>, and the next keypress is entered at the next character position.</p>
<h4>LoRa interface</h4>
<p>The Walkie-Textie program uses of Sandeep Mistry&#39;s Arduino LoRa library <sup id="cite_ref7"><a href="#cite_note7">[7]</a></sup> to provide the LoRa interface to the RFM95W.</p>
<p>The LoRa interface uses the routine <strong>LoRa.onreceive()</strong> to register the function <strong>Receiver()</strong> as a callback, or Interrupt Service Routine. When a message is received this reads the message into the <strong>Received[]</strong> buffer, and sets the <strong>HaveReceived</strong> flag.</p>
<p>The user interface is handled by the routine <strong>Interface()</strong>, called from the main Arduino <strong>loop()</strong> routine. This repeatedly calls <strong>ReadKeypad()</strong> to read the 12-key keypad, and waits for a keypress. While reading the keypad it checks the <strong>HaveReceived</strong> flag, and if so calls <strong>UpdateDisplayReceived()</strong> to scroll the screen and display the message on the left of the display.</p>
<p>If a key has been pressed it processes it according to the multi-tap rules, calls <strong>Display()</strong> to display it, and appends it to the string <strong>Message[]</strong>. The special key &#39;*&#39; is handled differently; this calls <strong>LoRa.beginPacket()</strong> to send the message in <strong>Message[]</strong>, and then <strong>UpdateDisplaySent()</strong> to scroll the display, and display the sent message on the right of the display.</p>
<p>Both <strong>UpdateDisplayReceived()</strong> and <strong>UpdateDisplaySent()</strong> also call<strong> DrawStatus()</strong> to update the status bar at the top of the screen, which shows the RSSI of the last received message, the beeper status, and the battery level.</p>
<h4>Battery voltage</h4>
<p>The battery voltage is read by the analogue input <strong>Piezo</strong> using a voltage divider across the battery, to ensure that the battery voltage will always be within the 3.3V range of the analogue input. The analogue-to-digital converter uses a 2.5V internal voltage reference so that a reading can be obtained even when the voltage has dropped below the 3.3V regulator voltage. The following calculation returns the voltage in hundredths of a volt:</p>
<pre>int battery = analogRead(Piezo) * 21 / 43;</pre>
<p>where 21/43 is a good approximation to 2.5/1024 * 2 * 100. By default the battery display assumes a LiPo battery, with a maximum voltage of 4.2V, but you can specify other types of battery by uncommenting the appropriate line at the start of the source:</p>
<pre>int const FullBattery = 420; // LiPo battery
// int const FullBattery = 320; // 2 x 1.5V Alkaline batteries eg Energizer Max
// int const FullBattery = 360; // 2 x 1.5V Energizer Ultimate Lithium batteries</pre>
<h4>Setup</h4>
<p>The main <strong>setup()</strong> routine initialises LoRa to specify the pins connected to the RFM95W board, and sets the following settings:</p>
<ul>
<li><strong>LoRa.begin(868E6)</strong> - Change this to the appropriate value for the frequency of your LoRa module.</li>
<li><strong>LoRa.setSyncWord(SyncWord)</strong> - <strong>SyncWord</strong> should have the same value for all your units that need to intercommunicate.</li>
</ul>
<p>For example, if you have built a pair of Walkie-Texties for your neighbour&#39;s children, but you don&#39;t want them to interact with your children&#39;s Walkie-Texties, give them a different <strong>SyncWord</strong>.</p>
<h3>Compiling the program</h3>
<p>Compile the program using Spence Konde&#39;s megaTinyCore <sup id="cite_ref8"><a href="#cite_note8">[8]</a></sup>. Choose the <strong>ATtiny3224/1624/1614/1604/824/814/804/424/414/404/214/204 </strong>option under the <strong>megaTinyCore</strong> heading on the <strong>Board</strong> menu. Check that the subsequent options are set as follows (ignore any other options):</p>
<p><strong>Chip: &#34;</strong><strong>ATtiny814</strong><strong>&#34;</strong></p>
<p>To program the processor the recommended option is to use a 5V or 3.3V USB to Serial board, such as the SparkFun FTDI Basic board <sup id="cite_ref9"><a href="#cite_note9">[9]</a></sup>, or a USB to Serial cable <sup id="cite_ref10"><a href="#cite_note10">[10]</a></sup>, connected with a Schottky diode as follows. You can substitute a 4.7kΩ resistor for the Schottky diode:</p>
<p><img src="https://unplannedobsolescence.com/pictures/kvm/serialupdiprogschottky.gif" alt="SerialUPDIProgSchottky.gif" width="395" height="147"/></p>
<p>Connect the +5V/+3.3V, GND, and UPDI pins to the three terminals on the top edge of the Walkie-Textie. I held three pins in contact with the terminals to avoid the need to permanently solder a header to the board. If there&#39;s a battery fitted to the board leave the power switch turned off. Then proceed as follows:</p>
<ul>
<li>Set <strong>Programmer</strong> to <strong>&#34;SerialUPDI - 230400 baud&#34;</strong>.</li>
<li>Select the USB port corresponding to the USB to Serial board in the <strong>Port</strong> menu.</li>
<li>Choose <strong>Upload</strong> from the Arduino IDE <strong>Tools</strong> menu to upload the program.</li>
</ul>
<h3>Resources</h3>
<p>Here&#39;s the whole Walkie-Textie program: <a href="https://unplannedobsolescence.com/list?5BBL">Walkie-Textie Program</a>.</p>
<p>Get the Eagle or Gerber files for the PCB here: <a href="https://github.com/technoblogy/walkie-textie" target="_blank">https://github.com/technoblogy/walkie-textie</a>.</p>
<p>Or order a board from OSH Park here: <a href="https://oshpark.com/shared_projects/fUAMhZqC" target="_blank">Walkie-Textie Wireless Communicator</a>.</p>
<h3>Further suggestions</h3>
<p>The LoRa radio can&#39;t receive when it&#39;s transmitting, and there&#39;s no handshaking, so the sender has no confirmation that their message was received. This can be solved manually by confirming receipt of each message. It would also be possible to automate this by sending a &#34;message received&#34; code after receiving each message.</p>
<p>Also, all LoRa receivers within range will be capable of receiving a sent message. A simple level of privacy is provided by the SyncWord, which is a number from 1 to 255 that ensures that a receiver will only receive messages sent using the same SyncWord. For more privacy you could encrypt messages with a key known only to the sender and receiver.</p>
<h3>Updates</h3>
<p>13th August 2025: Added a note about the typical current consumption.</p><hr/>
<ol>
<li id="cite_note1"><a href="#cite_ref1">^</a> <a href="https://www.adafruit.com/product/4237" target="_blank">Lithium Ion Polymer Battery with Short Cable - 3.7V 350mAh</a> on Adafruit.</li>
<li id="cite_note2"><a href="#cite_ref2">^</a> <a href="https://thepihut.com/products/2-x-aaa-open-battery-holder-with-jst-ph-connector" target="_blank">2 x AAA Open Battery Holder with JST PH Connector</a> on The Pi-Hut.</li>
<li id="cite_note3"><a href="#cite_ref3">^</a> <a href="https://www.adafruit.com/product/5903" target="_blank">MHP50-B5</a> on Adafruit.</li>
<li id="cite_note4"><a href="#cite_ref4">^</a> <a href="https://www.aliexpress.com/item/1005006299730562.html" target="_blank">MHP50-B5</a> on AliExpress.</li>
<li id="cite_note5"><a href="#cite_ref5">^</a> <a href="https://thepihut.com/products/black-nylon-screw-and-stand-off-set-m3-thread" target="_blank">Black Nylon Screw and Stand-off Set – M3 Thread</a> on The Pi-Hut.</li>
<li id="cite_note6"><a href="#cite_ref6">^</a> <a href="https://thepihut.com/products/silicone-cover-stranded-core-wire-2m-26awg-black" target="_blank">Silicone Cover Stranded-Core Wire - 26AWG Black</a> on The Pi Hut.</li>
<li id="cite_note7"><a href="#cite_ref7">^</a> <a href="https://github.com/sandeepmistry/arduino-LoRa" target="_blank">Arduino LoRa</a> on GitHub.</li>
<li id="cite_note8"><a href="#cite_ref8">^</a> <a href="https://github.com/SpenceKonde/megaTinyCore" target="_blank">megaTinyCore</a> on GitHub.</li>
<li id="cite_note9"><a href="#cite_ref9">^</a> <a href="https://www.sparkfun.com/products/9716" target="_blank">SparkFun FTDI Basic Breakout - 5V</a> on Sparkfun.</li>
<li id="cite_note10"><a href="#cite_ref10">^</a> <a href="https://www.adafruit.com/product/70" target="_blank">FTDI Serial TTL-232 USB Cable</a> on Adafruit.</li>
</ol>

<hr/>


<p><a href="http://disqus.com">blog comments powered by </a></p></div></div>
  </body>
</html>
