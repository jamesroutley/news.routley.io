<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cgit.freebsd.org/src/commit/?id=a67b925ff3e58b072a60b633e442ee1d33e47f7f">Original</a>
    <h1>Mail: Make The Dragonfly Mail Agent (dma) the default mta</h1>
    
    <div id="readability-page-1" class="page"><p>mail: make The Dragonfly Mail Agent (dma) the default mta.</p><p>dma accepts mail from a local Mail User Agent (MUA) and delivers it
locally or to a smarthost for delivery. dma does not accept inbound
mail (i.e., it does not listen on port 25) and is not intended to
provide the same functionality as a full MTA like postfix or sendmail.
It is intended for use cases such as delivering cron(8) mail. which
is the default configuration and usage of sendmail in the default
setup of the base system.

In order to switch the default from sendmail to dma, we teach
mailwrapper to fallback on dma directly if the mailer.conf file cannot
be opened.
We install by default a mailer.conf file which points at dma
We install a mailer.conf file for sendmail in the examples.

Relnotes:	yes
Differential Revision:	<a href="https://reviews.freebsd.org/D37035">https://reviews.freebsd.org/D37035</a>
</p><div summary="diff"><tbody><tr><td><div><p>diff --git a/libexec/dma/dmagent/Makefile b/libexec/dma/dmagent/Makefile</p></div><p>@@ -24,11 +24,6 @@ YFLAGS+=	-i</p><p> CLEANFILES=	aliases_parse.i</p><p> FILES=	mailer.conf</p><p> FILESDIR=	${SHAREDIR}/examples/dma</p><p>-.if ${MK_SENDMAIL} == no</p><p>-CONFGROUPS=	CONFS MAILER</p><p>-MAILERDIR=	/etc/mail</p><p>-MAILER=		mailer.conf</p><p>-.endif</p><p> BINMODE=	2555</p><div><p>diff --git a/libexec/rc/rc.conf b/libexec/rc/rc.conf</p></div><p>@@ -596,7 +596,7 @@ allscreens_kbdflags=&#34;&#34;	# Set this kbdcontrol mode for all virtual screens</p><p> mta_start_script=&#34;/etc/rc.sendmail&#34;</p><p> 			# Script to start your chosen MTA, called by /etc/rc.</p><p> # Settings for /etc/rc.sendmail and /etc/rc.d/sendmail:</p><p>-sendmail_enable=&#34;NO&#34;	# Run the sendmail inbound daemon (YES/NO).</p><p>+sendmail_enable=&#34;NONE&#34;	# Run the sendmail inbound daemon (YES/NO).</p><p> sendmail_pidfile=&#34;/var/run/sendmail.pid&#34;	# sendmail pid file</p><p> sendmail_procname=&#34;/usr/sbin/sendmail&#34;		# sendmail process name</p><p> sendmail_flags=&#34;-L sm-mta -bd -q30m&#34; # Flags to sendmail (as a server)</p><div><p>diff --git a/usr.sbin/mailwrapper/Makefile b/usr.sbin/mailwrapper/Makefile</p></div><p>@@ -16,10 +16,10 @@ SYMLINKS=	../sbin/mailwrapper /usr/bin/mailq \</p><p> 		mailwrapper /usr/sbin/purgestat \</p><p> 		mailwrapper /usr/sbin/sendmail</p><p>-.if ${MK_MAILWRAPPER} == &#34;no&#34; &amp;&amp; ${MK_SENDMAIL} != &#34;no&#34;</p><p>-SYMLINKS+=	../libexec/sendmail/sendmail ${BINDIR}/mailwrapper</p><p>-.elif ${MK_MAILWRAPPER} == &#34;no&#34; &amp;&amp; ${MK_SENDMAIL} == &#34;no&#34; &amp;&amp; ${MK_DMAGENT} != &#34;no&#34;</p><p>+.if ${MK_MAILWRAPPER} == &#34;no&#34; &amp;&amp; ${MK_DMAGENT} != &#34;no&#34;</p><p> SYMLINKS+=	../libexec/dma ${BINDIR}/mailwrapper</p><p>+.elif ${MK_MAILWRAPPER} == &#34;no&#34; &amp;&amp; ${MK_DMAGENT} == &#34;no&#34; &amp;&amp; ${MK_SENDMAIL} != &#34;no&#34;</p><p>+SYMLINKS+=	../libexec/sendmail/sendmail ${BINDIR}/mailwrapper</p><p> .endif</p><p> .endif</p><p>@@ -27,16 +27,23 @@ SYMLINKS+=	../libexec/dma ${BINDIR}/mailwrapper</p><p> SYMLINKS+=	..${BINDIR}/mailwrapper /bin/rmail</p><p> .endif</p><p>+.if ${MK_SENDMAIL} != &#34;no&#34;</p><p>+FILES=		${SRCTOP}/etc/mail/mailer.conf</p><p>+FILESDIR=	${SHAREDIR}/examples/sendmail</p><p>+.endif</p><p>+</p><p> .if ${MK_MAILWRAPPER} != &#34;no&#34;</p><p>-# We install here if either sendmail(8) is enabled, or dma(8) isn&#39;t.  In the</p><p>+# We install here if either dma(8) is enabled, or sendmail(8) isn&#39;t.  In the</p><p> # latter scenario, we take care of the possibility that neither sendmail(8) nor</p><p> # dma(8) are installed and simply provide a default that can be changed for an</p><p> # alternative in ports.</p><p>-.if ${MK_SENDMAIL} != &#34;no&#34; || ${MK_DMAGENT} == &#34;no&#34;</p><p>+.if ${MK_DMAGENT} != &#34;no&#34; || ${MK_SENDMAIL} == &#34;no&#34;</p><p>+CONFS=		${SRCTOP}/libexec/dma/dmagent/mailer.conf</p><p>+.else</p><p> CONFS=		${SRCTOP}/etc/mail/mailer.conf</p><p>+.endif</p><p> CONFSDIR=	/etc/mail</p><p> CONFSMODE=	644</p><p> .endif</p><p>-.endif</p><p> .include &lt;bsd.prog.mk&gt;</p><div><p>diff --git a/usr.sbin/mailwrapper/pathnames.h b/usr.sbin/mailwrapper/pathnames.h</p></div><p>@@ -34,4 +34,4 @@</p><p>  */</p><p> #define _PATH_MAILERCONF	&#34;/etc/mail/mailer.conf&#34;</p><p>-#define _PATH_DEFAULTMTA	&#34;/usr/libexec/sendmail/sendmail&#34;</p><p>+#define _PATH_DEFAULTMTA	&#34;/usr/libexec/dma&#34;</p></td></tr></tbody></div></div>
  </body>
</html>
