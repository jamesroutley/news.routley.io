<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2025/03/11/xhtml/">Original</a>
    <h1>Bugs, bugs, bugs!</h1>
    
    
<p>
Look out, I&#39;m talking about feed stuff again.
</p>
<p>
Since
<a href="https://rachelbythebay.com/w/2025/03/03/feed/">last week&#39;s post</a>
with the latest report on feed reader behaviors, a fair number of things 
have happened.  
</p>
<p>
First up, I reported that two FreshRSS instances were sending 
unconditional requests.  This turned out to be a pair of interacting 
bugs, and the developers hopped right on that and stamped it out.  Their 
dev instances shifted right away.  That&#39;s great.
</p>
<p>
Then, something funny happened.  I wrote that post about the 
<a href="https://rachelbythebay.com/w/2025/03/05/1670/">modem noises</a>
and it included a MP3 file.  The way I do this in my stuff here is that 
I have some commands baked into my page generator that knows how to 
create the &lt;audio&gt; container and then put one or more &lt;source&gt; elements 
into it.  So, I did that for the (admittedly crappy) recording and 
shipped it off.
</p>
<p>
I didn&#39;t know this at the time, but this immediately triggered strange 
behavior in a number of feed readers, FreshRSS included.  They all 
started sending the wrong data.  That is, they&#39;d get the latest version 
of the feed with the &#34;2025/03/05/1670&#34; post in it, but on their next 
poll they&#39;d still be sending the If-Modified-Since and/or If-None-Match 
values from the previous version.
</p>
<p>
This sent me down the road of trying to flush out this behavior on the 
feed score project side of things, but nothing I did would reproduce it.  
Again, I didn&#39;t know that something about that specific post was 
responsible, so I was groping around in the dark.
</p>
<p>
Finally, I reported this to the FreshRSS devs, and they came right back 
and showed me my problem: my feed says it&#39;s xhtml, but it was doing 
something that&#39;s not valid: &lt;audio controls&gt;.  That&#39;s not valid XML, so 
it&#39;s not valid XHTML by extension.  It&#39;s just fine in a regular web 
page, naturally.
</p>
<p>
I hate the web.
</p>
<p>
How did this happen?  Easy: In 2023, I
<a href="https://rachelbythebay.com/w/2023/10/12/html/">rewrote</a>
my generator for these web pages and the feeds.  There&#39;s now a bunch of
code that *tries* to crap out reasonable (and validating) results 
instead of doing &#34;HTML by printf&#34; like it had been before.
</p>
<p>
Along the way, I obviously didn&#39;t internalize the rule that &#34;in XHTML, 
attribute minimization is forbidden&#34;.  It sounds like the kind of thing 
I would have read once back in the 90s when I was trying to get pages 
to validate as XHTML 1.0 for some cursed reason, and then promptly 
forgot.  So, it would do a bare &#34;controls&#34; attribute and thought it was 
fine.
</p>
<p>
In practical terms, it means you can&#39;t do this:
</p>
<p>
&lt;audio controls loop&gt;
</p>
<p>
But instead you have to do this:
</p>
<p>
&lt;audio controls=&#34;controls&#34; loop=&#34;loop&#34;&gt;
</p>
<p>
So yeah, I wrote something terrible.  Again, I hate the web.
</p>
<p>
Anyway, what was happening is that a single post within the feed was 
failing validation as a self-proclaimed xhtml document, so the feed 
readers were rejecting the _entire poll_ and were not updating their 
caches.  The next time they polled, it was as if they had never sent the 
request in the first place (as far as they were concerned).
</p>
<p>
Once I shipped a fixed version of the feeds, they went back to normal.
</p>
<p>
I&#39;d snark about something here, but clearly, I&#39;m no better at this.
</p>
<p>
What&#39;s different now?  Well, my bits of code which are responsible for 
attributes (&#34;controls&#34;, &#34;loop&#34;, &#34;href&#34;, ...) now refuse to generate a 
minimized attribute when being used for XML, and that includes the feed 
stuff.  They&#39;ll blow up before they ship garbage like that again.
</p>
<p>
My thanks to the FreshRSS team for being responsive and helping me out.
</p>
<p>
Now, where did I put my clown nose...
</p>

  </body>
</html>
