<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/fish-shell/fish-shell/releases/tag/4.0.0">Original</a>
    <h1>Fish 4.0.0</h1>
    
    <div id="readability-page-1" class="page"><div data-pjax="true" data-test-selector="body-content" data-view-component="true"><p>fish’s core code has been ported from C++ to Rust (<a href="https://github.com/fish-shell/fish-shell/issues/9512" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/9512/hovercard">#9512</a>). This means a large change in dependencies and how to build fish. However, there should be no direct impact on users. Packagers should see the <a href="#rust-packaging">For Distributors</a> section at the end.</p>
<h3>Notable backwards-incompatible changes</h3>
<ul>
<li>
<p>As part of a larger binding rework, <code>bind</code> gained a new key notation.</p>
</li>
<li>
<p><code>ctrl-c</code> now calls a new bind function called <code>clear-commandline</code>. The old behavior, which leaves a “^C” marker, is available as <code>cancel-commandline</code> (<a href="https://github.com/fish-shell/fish-shell/issues/10935" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10935/hovercard">#10935</a>)</p>
</li>
<li>
<p><code>random</code> will produce different values from previous versions of fish when used with the same seed, and will work more sensibly with small seed numbers.</p>
</li>
<li>
<p>Variables in command position that expand to a subcommand keyword are now forbidden to fix a likely user error.</p>
</li>
<li>
<p><code>functions --handlers</code> will now list handlers in a different order.</p>
</li>
<li>
<p>The <code>qmark-noglob</code> feature, introduced in fish 3.0, is enabled by default. That means <code>?</code> will no longer act as a single-character glob.</p>
<div data-snippet-clipboard-copy-content="set -Ua fish_features no-qmark-noglob"><pre lang="fish-docs-samples"><code>set -Ua fish_features no-qmark-noglob
</code></pre></div>
<p>The flag will eventually be made read-only, making it impossible to turn off.</p>
</li>
<li>
<p>Terminals that fail to ignore unrecognized OSC or CSI sequences may display garbage. We know cool-retro-term and emacs’ ansi-term are affected, but most mainstream terminals are not.</p>
</li>
<li>
<p>fish no longer searches directories from the Windows system/user <code>$PATH</code> environment variable for Linux executables. To execute Linux binaries by name (i.e. not with a relative or absolute path) from a Windows folder, make sure the <code>/mnt/c/...</code> path is explicitly added to <code>$fish_user_paths</code> and not just automatically appended to <code>$PATH</code> by <code>wsl.exe</code> (<a href="https://github.com/fish-shell/fish-shell/issues/10506" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10506/hovercard">#10506</a>).</p>
</li>
<li>
<p>Under Microsoft Windows Subsystem for Linux 1 (not WSL 2), backgrounded jobs that have not been disowned and do not terminate on their own after a <code>SIGHUP</code> + <code>SIGCONT</code> sequence will be explicitly killed by fish on exit (after the usual prompt to close or disown them) to work around a WSL 1 deficiency that sees backgrounded processes that run into <code>SIGTTOU</code> remain in a suspended state indefinitely (<a href="https://github.com/fish-shell/fish-shell/issues/5263" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/5263/hovercard">#5263</a>). The workaround is to explicitly <code>disown</code> processes you wish to outlive the shell session.</p>
</li>
</ul>
<h3>Notable improvements and fixes</h3>

<ul>
<li>
<p>fish now requests XTerm’s <code>modifyOtherKeys</code> keyboard encoding and <a href="https://sw.kovidgoyal.net/kitty/keyboard-protocol/" rel="nofollow">kitty keyboard protocol’s</a> progressive enhancements (<a href="https://github.com/fish-shell/fish-shell/issues/10359" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10359/hovercard">#10359</a>).</p>
<p>Additionally, <code>bind</code> now supports a human-readable syntax in addition to byte sequences.</p>
<ul>
<li><code>bind up &#39;do something&#39;</code> binds the up-arrow key instead of a two-key sequence (“u” and then “p”)</li>
<li><code>bind ctrl-x,alt-c &#39;do something&#39;</code> binds a sequence of two keys.</li>
</ul>
<p>Any key argument that starts with an ASCII control character (like <code>\e</code> or <code>\cX</code>) or is up to 3 characters long, not a named key, and does not contain <code>,</code> or <code>-</code> will be interpreted in the old syntax to keep compatibility for the majority of bindings.</p>
<p>Keyboard protocols can be turned off by disabling the “keyboard-protocols” feature flag:</p>
<div data-snippet-clipboard-copy-content="set -Ua fish_features no-keyboard-protocols"><pre lang="fish-docs-samples"><code>set -Ua fish_features no-keyboard-protocols
</code></pre></div>
<p>This is a temporary measure to work around buggy terminals (<a href="https://github.com/fish-shell/fish-shell/issues/11056" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/11056/hovercard">#11056</a>), which appear to be relatively rare.</p>
</li>
<li>
<p>fish can now be built as a self-installing binary (<a href="https://github.com/fish-shell/fish-shell/issues/10367" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10367/hovercard">#10367</a>). That means it can be easily built on one system and copied to another, where it can extract supporting files.</p>
<div data-snippet-clipboard-copy-content="cargo install --path . # in a clone of the fish repository
# or `cargo build --release` and copy target/release/fish{,_indent,_key_reader} wherever you want"><pre lang="fish-docs-samples"><code>cargo install --path . # in a clone of the fish repository
# or `cargo build --release` and copy target/release/fish{,_indent,_key_reader} wherever you want
</code></pre></div>
<p>The first time it runs interactively, it will extract all the data files to  <code>~/.local/share/fish/install/</code>. A specific path can be used for the data files with <code>fish --install=PATH</code> To uninstall, remove the fish binaries and that directory.</p>
<p>This build system is experimental; the main build system, using <code>cmake</code>, remains the recommended approach for packaging and installation to a prefix.</p>
</li>
<li>
<p>A new function <code>fish_should_add_to_history</code> can be overridden to decide whether a command should be added to the history (<a href="https://github.com/fish-shell/fish-shell/issues/10302" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10302/hovercard">#10302</a>).</p>
</li>
<li>
<p>Bindings can now mix special input functions and shell commands, so <code>bind ctrl-g expand-abbr &#34;commandline -i \n&#34;</code> works as expected (<a href="https://github.com/fish-shell/fish-shell/issues/8186" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/8186/hovercard">#8186</a>).</p>
</li>
<li>
<p>Special input functions run from bindings via <code>commandline -f</code> are now applied immediately, instead of after the currently executing binding (<a href="https://github.com/fish-shell/fish-shell/issues/3031" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/3031/hovercard">#3031</a>, <a href="https://github.com/fish-shell/fish-shell/issues/10126" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10126/hovercard">#10126</a>).</p>
</li>
<li>
<p>Undo history is no longer truncated after every command, but kept for the lifetime of the shell process.</p>
</li>
<li>
<p>The <code>ctrl-r</code> history search now uses glob syntax (<a href="https://github.com/fish-shell/fish-shell/issues/10131" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10131/hovercard">#10131</a>).</p>
</li>
<li>
<p>The <code>ctrl-r</code> history search now operates only on the line or command substitution at cursor, making it easier to combine commands from history (<a href="https://github.com/fish-shell/fish-shell/issues/9751" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9751/hovercard">#9751</a>).</p>
</li>
<li>
<p>Abbreviations can now be restricted to specific commands. For instance:</p>
<div data-snippet-clipboard-copy-content="abbr --add --command git back &#39;reset --hard HEAD^&#39;"><pre lang="fish-docs-samples"><code>abbr --add --command git back &#39;reset --hard HEAD^&#39;
</code></pre></div>
<p>will expand “back” to <code>reset --hard HEAD^</code>, but only when the command is <code>git</code> (<a href="https://github.com/fish-shell/fish-shell/issues/9411" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9411/hovercard">#9411</a>).</p>
</li>
</ul>
<h3>Deprecations and removed features</h3>
<ul>
<li>
<p><code>commandline --tokenize</code> (short option <code>-o</code>) has been deprecated in favor of <code>commandline --tokens-expanded</code> (short option <code>-x</code>) which expands variables and other shell syntax, removing the need to use <a href="https://github.com/fish-shell/fish-shell/blob/4.0.0/cmds/eval.md">eval</a> in completion scripts (<a href="https://github.com/fish-shell/fish-shell/issues/10212" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10212/hovercard">#10212</a>).</p>
</li>
<li>
<p>Two new feature flags:</p>
<ul>
<li><code>remove-percent-self</code> (see <code>status features</code>) disables PID expansion of <code>%self</code>, which has been supplanted by <code>$fish_pid</code> (<a href="https://github.com/fish-shell/fish-shell/issues/10262" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10262/hovercard">#10262</a>).</li>
<li><code>test-require-arg</code> disables <code>test</code>’s one-argument mode. That means <code>test -n</code> without an additional argument will return false, <code>test -z</code> will keep returning true. Any other option without an argument, anything that is not an option and no argument will be an error. This also goes for <code>[</code>, test’s alternate name.</li>
</ul>
<p>These can be enabled with:</p>
<div data-snippet-clipboard-copy-content="set -Ua fish_features remove-percent-self test-require-arg"><pre lang="fish-docs-samples"><code>set -Ua fish_features remove-percent-self test-require-arg
</code></pre></div>
<p>We intend to enable them by default in future, and after that eventually make them read-only.</p>
</li>
<li>
<p>Specifying key names as terminfo names (using the <code>bind -k</code> syntax) is deprecated and may be removed in a future version.</p>
</li>
<li>
<p>When a terminal pastes text into fish using bracketed paste, fish used to switch to a special <code>paste</code> bind mode.</p>
</li>
<li>
<p>When an interactive fish is stopped or terminated by a signal that cannot be caught (SIGSTOP or SIGKILL), it may leave the terminal in a state where keypresses with modifiers are sent as CSI u sequences, instead of traditional control characters or escape sequences that are recognized by Readline and compatible programs, such as bash and python.</p>
</li>
<li>
<p><code>fish_key_reader --verbose</code> no longer shows timing information.</p>
</li>
<li>
<p>Terminal information is no longer read from hashed terminfo databases, or termcap databases (<a href="https://github.com/fish-shell/fish-shell/issues/10269" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10269/hovercard">#10269</a>). The vast majority of systems use a non-hashed terminfo database, which is still supported.</p>
</li>
<li>
<p><code>source</code> returns an error if used without a filename or pipe/redirection (<a href="https://github.com/fish-shell/fish-shell/issues/10774" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10774/hovercard">#10774</a>).</p>
</li>
</ul>
<h3>Scripting improvements</h3>
<ul>
<li><code>for</code> loops will no longer remember local variables from the previous iteration (<a href="https://github.com/fish-shell/fish-shell/issues/10525" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10525/hovercard">#10525</a>).</li>
<li>A new <code>history append</code> subcommand appends a command to the history, without executing it (<a href="https://github.com/fish-shell/fish-shell/issues/4506" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/4506/hovercard">#4506</a>).</li>
<li>A new redirection: <code>&lt;? /path/to/file</code> will try opening the file as input, and if it doesn’t succeed silently uses <code>/dev/null</code> instead.</li>
<li>A new option <code>commandline --tokens-raw</code> prints a list of tokens without any unescaping (<a href="https://github.com/fish-shell/fish-shell/issues/10212" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10212/hovercard">#10212</a>).</li>
<li>A new option <code>commandline --showing-suggestion</code> tests whether an autosuggestion is currently displayed (<a href="https://github.com/fish-shell/fish-shell/issues/10586" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10586/hovercard">#10586</a>).</li>
<li><code>functions</code> and <code>type</code> now show that a function was copied and its source, rather than solely <code>Defined interactively</code> (<a href="https://github.com/fish-shell/fish-shell/issues/6575" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/6575/hovercard">#6575</a>).</li>
<li>Stack trace now shows line numbers for copied functions (<a href="https://github.com/fish-shell/fish-shell/issues/6575" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/6575/hovercard">#6575</a>).</li>
<li><code>foo &amp; &amp;&amp; bar</code> is now a syntax error, like in other shells (<a href="https://github.com/fish-shell/fish-shell/issues/9911" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9911/hovercard">#9911</a>).</li>
<li><code>if -e foo; end</code> now prints a more accurate error (<a href="https://github.com/fish-shell/fish-shell/issues/10000" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10000/hovercard">#10000</a>).</li>
<li><code>cd</code> into a directory that is not readable but accessible (permissions <code>--x</code>) is now possible (<a href="https://github.com/fish-shell/fish-shell/issues/10432" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10432/hovercard">#10432</a>).</li>
<li>An integer overflow in <code>string repeat</code> leading to a near-infinite loop has been fixed (<a href="https://github.com/fish-shell/fish-shell/issues/9899" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9899/hovercard">#9899</a>).</li>
<li><code>string shorten</code> behaves better in the presence of non-printable characters, including fixing an integer overflow that shortened strings more than intended (<a href="https://github.com/fish-shell/fish-shell/issues/9854" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/9854/hovercard">#9854</a>).</li>
<li><code>string pad</code> no longer allows non-printable characters as padding (<a href="https://github.com/fish-shell/fish-shell/issues/9854" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/9854/hovercard">#9854</a>).</li>
<li><code>string repeat</code> now allows omission of <code>-n</code> when the first argument is an integer (<a href="https://github.com/fish-shell/fish-shell/issues/10282" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10282/hovercard">#10282</a>).</li>
<li><code>string match</code> and <code>replace</code> have a new <code>--max-matches</code> option to return as soon as the specified number of matches have been identified, which can improve performance in scripts (<a href="https://github.com/fish-shell/fish-shell/issues/10587" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10587/hovercard">#10587</a>).</li>
<li><code>functions --handlers-type caller-exit</code> once again lists functions defined as <code>function --on-job-exit caller</code>, rather than them being listed by <code>functions --handlers-type process-exit</code>.</li>
<li>A new <code>set --no-event</code> option sets or erases variables without triggering a variable event. This can be useful to change a variable in an event handler (<a href="https://github.com/fish-shell/fish-shell/issues/10480" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10480/hovercard">#10480</a>).</li>
<li>Commas in command substitution output are no longer used as separators in brace expansion, preventing a surprising expansion in some cases (<a href="https://github.com/fish-shell/fish-shell/issues/5048" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/5048/hovercard">#5048</a>).</li>
<li>Universal variables can now store strings containing invalid UTF-8 (<a href="https://github.com/fish-shell/fish-shell/issues/10313" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10313/hovercard">#10313</a>).</li>
<li>A new <code>path basename -E</code> option that causes it to return the basename (“filename” with the directory prefix removed) with the final extension (if any) also removed. This is a shorter version of <code>path change-extension &#34;&#34; (path basename $foo)</code> (<a href="https://github.com/fish-shell/fish-shell/issues/10521" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10521/hovercard">#10521</a>).</li>
<li>A new <code>math --scale-mode</code> option to select <code>truncate</code>, <code>round</code>, <code>floor</code>, <code>ceiling</code> as you wish; the default value is <code>truncate</code>. (<a href="https://github.com/fish-shell/fish-shell/issues/9117" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9117/hovercard">#9117</a>).</li>
<li><code>random</code> is now less strict about its arguments, allowing a start larger or equal to the end. (<a href="https://github.com/fish-shell/fish-shell/issues/10879" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10879/hovercard">#10879</a>)</li>
<li><code>function --argument-names</code> now produces an error if a read-only variable name is used, rather than simply ignoring it (<a href="https://github.com/fish-shell/fish-shell/issues/10842" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10842/hovercard">#10842</a>).</li>
<li>Tilde expansion in braces (that is, <code>{~,}</code>) works correctly (<a href="https://github.com/fish-shell/fish-shell/issues/10610" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10610/hovercard">#10610</a>).</li>
</ul>
<h3>Interactive improvements</h3>
<ul>
<li>Autosuggestions were sometimes not shown after recalling a line from history, which has been fixed (<a href="https://github.com/fish-shell/fish-shell/issues/10287" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10287/hovercard">#10287</a>).</li>
<li>Up-arrow search matches -- which are highlighted in reverse colors -- are no longer syntax-highlighted, to fix bad contrast with the search match highlighting.</li>
<li>Command abbreviations (those with <code>--position command</code> or without a <code>--position</code>) now also expand after decorators like <code>command</code> (<a href="https://github.com/fish-shell/fish-shell/issues/10396" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10396/hovercard">#10396</a>).</li>
<li>Abbreviations now expand after process separators like <code>;</code> and <code>|</code>. This fixes a regression in version 3.6 (<a href="https://github.com/fish-shell/fish-shell/issues/9730" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9730/hovercard">#9730</a>).</li>
<li>When exporting interactively defined functions (using <code>type</code>, <code>functions</code> or <code>funcsave</code>) the function body is now indented, to match the interactive command line editor (<a href="https://github.com/fish-shell/fish-shell/issues/8603" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/8603/hovercard">#8603</a>).</li>
<li><code>ctrl-x</code> (<code>fish_clipboard_copy</code>) on multiline commands now includes indentation (<a href="https://github.com/fish-shell/fish-shell/issues/10437" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10437/hovercard">#10437</a>).</li>
<li><code>ctrl-v</code> (<code>fish_clipboard_paste</code>) now strips ASCII control characters from the pasted text.</li>
<li>When a command like <code>fg %2</code> fails to find the given job, it no longer behaves as if no job spec was given (<a href="https://github.com/fish-shell/fish-shell/issues/9835" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9835/hovercard">#9835</a>).</li>
<li>Redirection in command position like <code>&gt;echo</code> is now highlighted as error (<a href="https://github.com/fish-shell/fish-shell/issues/8877" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/8877/hovercard">#8877</a>).</li>
<li><code>fish_vi_cursor</code> now works properly inside the prompt created by builtin <code>read</code> (<a href="https://github.com/fish-shell/fish-shell/issues/10088" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10088/hovercard">#10088</a>).</li>
<li>fish no longer fails to open a FIFO if interrupted by a terminal resize signal (<a href="https://github.com/fish-shell/fish-shell/issues/10250" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10250/hovercard">#10250</a>).</li>
<li><code>read --help</code> and friends no longer ignore redirections. This fixes a regression in version 3.1 (<a href="https://github.com/fish-shell/fish-shell/issues/10274" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10274/hovercard">#10274</a>).</li>
<li>Measuring a command with <code>time</code> now considers the time taken for command substitution (<a href="https://github.com/fish-shell/fish-shell/issues/9100" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9100/hovercard">#9100</a>).</li>
<li><code>fish_add_path</code> now automatically enables verbose mode when used interactively (in the command line), in an effort to be clearer about what it does (<a href="https://github.com/fish-shell/fish-shell/issues/10532" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10532/hovercard">#10532</a>).</li>
<li>fish no longer adopts TTY modes of failed commands (<a href="https://github.com/fish-shell/fish-shell/issues/10603" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10603/hovercard">#10603</a>).</li>
<li><code>complete -e cmd</code> now prevents autoloading completions for <code>cmd</code> (<a href="https://github.com/fish-shell/fish-shell/issues/6716" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/6716/hovercard">#6716</a>).</li>
<li>fish’s default color scheme no longer uses the color “blue”, as it has bad contrast against the background in a few terminal’s default palettes (<a href="https://github.com/fish-shell/fish-shell/issues/10758" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10758/hovercard">#10758</a>, <a href="https://github.com/fish-shell/fish-shell/issues/10786" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10786/hovercard">#10786</a>)</li>
<li>Command lines which are larger than the terminal are now displayed correctly, instead of multiple blank lines being displayed (<a href="https://github.com/fish-shell/fish-shell/issues/7296" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/7296/hovercard">#7296</a>).</li>
<li>Prompts that use external commands will no longer produce an infinite loop if the command crashes (<a href="https://github.com/fish-shell/fish-shell/issues/9796" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9796/hovercard">#9796</a>).</li>
<li>Undo (<code>ctrl-z</code>) restores the cursor position too (<a href="https://github.com/fish-shell/fish-shell/issues/10838" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10838/hovercard">#10838</a>).</li>
<li>The output of <code>jobs</code> shows “-” for jobs that have the same process group ID as the fish process, rather than “-2” (<a href="https://github.com/fish-shell/fish-shell/issues/10833" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10833/hovercard">#10833</a>).</li>
<li>Job expansion (<code>%1</code> syntax) works properly for jobs that are a mixture of external commands and functions (<a href="https://github.com/fish-shell/fish-shell/issues/10832" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10832/hovercard">#10832</a>).</li>
<li>Command lines which have more lines than the terminal can be displayed and edited correctly (<a href="https://github.com/fish-shell/fish-shell/issues/10827" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10827/hovercard">#10827</a>).</li>
<li>Functions that have been erased are no longer highlighted as valid commands (<a href="https://github.com/fish-shell/fish-shell/issues/10866" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10866/hovercard">#10866</a>).</li>
<li><code>not</code>, <code>time</code>, and variable assignments (that is <code>not time a=b env</code>) is correctly recognized as valid syntax (<a href="https://github.com/fish-shell/fish-shell/issues/10890" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10890/hovercard">#10890</a>).</li>
<li>The Web-based configuration removes old right-hand-side prompts again, fixing a regression in fish 3.4.0 (<a href="https://github.com/fish-shell/fish-shell/issues/10675" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10675/hovercard">#10675</a>).</li>
<li>Further protection against programs which crash and leave the terminal in an inconsistent state (<a href="https://github.com/fish-shell/fish-shell/issues/10834" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10834/hovercard">#10834</a>, <a href="https://github.com/fish-shell/fish-shell/issues/11038" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/11038/hovercard">#11038</a>).</li>
<li>A workaround for git being very slow on macOS has been applied, improving performance after a fresh boot (<a href="https://github.com/fish-shell/fish-shell/issues/10535" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10535/hovercard">#10535</a>).</li>
</ul>
<h4>New or improved bindings</h4>
<ul>
<li>When the cursor is on a command that resolves to an executable script, <code>alt-o</code> will now open that script in your editor (<a href="https://github.com/fish-shell/fish-shell/issues/10266" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10266/hovercard">#10266</a>).</li>
<li>During up-arrow history search, <code>shift-delete</code> will delete the current search item and move to the next older item. Previously this was only supported in the history pager.</li>
<li><code>shift-delete</code> will also remove the currently-displayed autosuggestion from history, and remove it as a suggestion.</li>
<li><code>ctrl-Z</code> (also known as <code>ctrl-shift-z</code>) is now bound to redo.</li>
<li>Some improvements to the <code>alt-e</code> binding which edits the command line in an external editor:
<ul>
<li>The editor’s cursor position is copied back to fish. This is currently supported for Vim and Kakoune.</li>
<li>Cursor position synchronization is only supported for a set of known editors, which are now also detected in aliases which use <code>complete --wraps</code>. For example, use <code>complete --wraps my-vim vim</code> to synchronize cursors when <code>EDITOR=my-vim</code>.</li>
<li>Multiline commands are indented before being sent to the editor, which matches how they are displayed in fish.</li>
</ul>
</li>
<li>The <code>...-path-component</code> bindings, like <code>backward-kill-path-component</code>, now treat <code>#</code> as part of a path component (<a href="https://github.com/fish-shell/fish-shell/issues/10271" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10271/hovercard">#10271</a>).</li>
<li>Bindings like <code>alt-l</code> that print output in between prompts now work correctly with multiline commandlines.</li>
<li><code>alt-d</code> on an empty command line lists the directory history again. This restores the behavior of version 2.1.</li>
<li><code>history-prefix-search-backward</code> and <code>-forward</code> now maintain the cursor position, instead of moving the cursor to the end of the command line (<a href="https://github.com/fish-shell/fish-shell/issues/10430" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10430/hovercard">#10430</a>).</li>
<li>The following keys have refined behavior if the terminal supports <a href="#changelog-new-bindings">the new keyboard encodings</a>:
<ul>
<li><code>shift-enter</code> now inserts a newline instead of executing the command line.</li>
<li><code>ctrl-backspace</code> now deletes the last word instead of only one character (<a href="https://github.com/fish-shell/fish-shell/issues/10741" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10741/hovercard">#10741</a>).</li>
<li><code>ctrl-delete</code> deletes the next word (same as <code>alt-d</code>).</li>
</ul>
</li>
<li>New special input functions:
<ul>
<li><code>forward-char-passive</code> and <code>backward-char-passive</code> are like their non-passive variants but do not accept autosuggestions or move focus in the completion pager (<a href="https://github.com/fish-shell/fish-shell/issues/10398" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10398/hovercard">#10398</a>).</li>
<li><code>forward-token</code>, <code>backward-token</code>, <code>kill-token</code>, and <code>backward-kill-token</code> are similar to the <code>*-bigword</code> variants but for the whole argument token (which includes escaped spaces) (<a href="https://github.com/fish-shell/fish-shell/issues/2014" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/2014/hovercard">#2014</a>).</li>
<li><code>clear-commandline</code>, which merely clears the command line, as an alternative to <code>cancel-commandline</code> which prints <code>^C</code> and a new prompt (<a href="https://github.com/fish-shell/fish-shell/issues/10213" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10213/hovercard">#10213</a>).</li>
</ul>
</li>
<li>The <code>accept-autosuggestion</code> special input function now returns false when there was nothing to accept (<a href="https://github.com/fish-shell/fish-shell/issues/10608" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10608/hovercard">#10608</a>).</li>
<li>Vi mode has seen some improvements but continues to suffer from the lack of people working on it.
<ul>
<li>New default cursor shapes for insert and replace mode.</li>
<li><code>ctrl-n</code> in insert mode accepts autosuggestions (<a href="https://github.com/fish-shell/fish-shell/issues/10339" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10339/hovercard">#10339</a>).</li>
<li>Outside insert mode, the cursor will no longer be placed beyond the last character on the commandline.</li>
<li>When the cursor is at the end of the commandline, a single <code>l</code> will accept an autosuggestion (<a href="https://github.com/fish-shell/fish-shell/issues/10286" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10286/hovercard">#10286</a>).</li>
<li>The cursor position after pasting (<code>p</code>) has been corrected.</li>
<li>Added an additional binding, <code>_</code>, for moving to the beginning of the line (<a href="https://github.com/fish-shell/fish-shell/issues/10720" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10720/hovercard">#10720</a>).</li>
<li>When the cursor is at the start of a line, escaping from insert mode no longer moves the cursor to the previous line.</li>
<li>Added bindings for clipboard interaction, like <code>&#34;,+,p</code> and <code>&#34;,+,y,y</code>.</li>
<li>Deleting in visual mode now moves the cursor back, matching vi (<a href="https://github.com/fish-shell/fish-shell/issues/10394" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10394/hovercard">#10394</a>).</li>
<li>The <code>;</code>, <code>,</code>, <code>v</code>, <code>V</code>, <code>I</code>, and <code>gU</code> bindings work in visual mode (<a href="https://github.com/fish-shell/fish-shell/issues/10601" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10601/hovercard">#10601</a>, <a href="https://github.com/fish-shell/fish-shell/issues/10648" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10648/hovercard">#10648</a>).</li>
<li>Support <code>%</code> motion (<a href="https://github.com/fish-shell/fish-shell/issues/10593" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10593/hovercard">#10593</a>).</li>
<li><code>ctrl-k</code> to remove the contents of the line beyond the cursor in all modes (<a href="https://github.com/fish-shell/fish-shell/issues/10648" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10648/hovercard">#10648</a>).</li>
<li>Support ab and ib vi text objects. New input functions are introduced <code>jump-{to,till}-matching-bracket</code> (<a href="https://github.com/fish-shell/fish-shell/issues/1842" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/1842/hovercard">#1842</a>).</li>
<li>The <code>E</code> binding now correctly handles the last character of the word, by jumping to the next word (<a href="https://github.com/fish-shell/fish-shell/issues/9700" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/9700/hovercard">#9700</a>).</li>
</ul>
</li>
</ul>
<h4>Completions</h4>
<ul>
<li>Command-specific tab completions may now offer results whose first character is a period. For example, it is now possible to tab-complete <code>git add</code> for files with leading periods. The default file completions hide these files, unless the token itself has a leading period (<a href="https://github.com/fish-shell/fish-shell/issues/3707" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/3707/hovercard">#3707</a>).</li>
<li>Option completion now uses fuzzy subsequence filtering, just like non-option completion (<a href="https://github.com/fish-shell/fish-shell/issues/830" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/830/hovercard">#830</a>).</li>
<li>Completions that insert an entire token now use quotes instead of backslashes to escape special characters (<a href="https://github.com/fish-shell/fish-shell/issues/5433" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/5433/hovercard">#5433</a>).</li>
<li>Normally, file name completions start after the last <code>:</code>  or <code>=</code> in a token.</li>
<li>Various new completion scripts and numerous updates to existing ones.</li>
<li>Completions could hang if the <code>PAGER</code> environment variable was sent to certain editors on macOS, FreeBSD and some other platforms. This has been fixed (<a href="https://github.com/fish-shell/fish-shell/issues/10820" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10820/hovercard">#10820</a>).</li>
<li>Generated completions are now stored in <code>$XDG_CACHE_HOME/fish</code> or <code>~/.cache/fish</code> by default (<a href="https://github.com/fish-shell/fish-shell/issues/10369" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10369/hovercard">#10369</a>)</li>
<li>A regression in fish 3.1, where completing a command line could change it completely, has been fixed (<a href="https://github.com/fish-shell/fish-shell/issues/10904" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10904/hovercard">#10904</a>).</li>
</ul>
<h4>Improved terminal support</h4>
<ul>
<li>fish now marks the prompt and command-output regions (via OSC 133) to enable terminal shell integration (<a href="https://github.com/fish-shell/fish-shell/issues/10352" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10352/hovercard">#10352</a>).</li>
<li>fish now reports the working directory (via OSC 7) unconditionally instead of only for some terminals (<a href="https://github.com/fish-shell/fish-shell/issues/9955" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/9955/hovercard">#9955</a>).</li>
<li>fish now sets the terminal window title (via OSC 0) unconditionally instead of only for some terminals (<a href="https://github.com/fish-shell/fish-shell/issues/10037" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10037/hovercard">#10037</a>).</li>
<li>Focus reporting in tmux is no longer disabled on the first prompt.</li>
<li>Focus reporting is now disabled during commands run inside key bindings (<a href="https://github.com/fish-shell/fish-shell/issues/6942" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/6942/hovercard">#6942</a>).</li>
<li>Cursor changes are applied to all terminals that support them, and the list of specifically-supported terminals has been removed (<a href="https://github.com/fish-shell/fish-shell/issues/10693" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10693/hovercard">#10693</a>).</li>
<li>If it cannot find the terminfo entry given by <a href="https://github.com/fish-shell/fish-shell/blob/4.0.0/language.md#envvar-TERM"><code>TERM</code></a> environment variable, fish will now use an included <code>xterm-256color</code> definition to match the vast majority of current terminal emulators (<a href="https://github.com/fish-shell/fish-shell/issues/10905" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10905/hovercard">#10905</a>). If you need to have a specific terminfo profile for your terminal’s <code>TERM</code> variable, install it into the terminfo database.</li>
<li>Further improvements to the correct display of prompts which fill the width of the terminal (<a href="https://github.com/fish-shell/fish-shell/issues/8164" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/8164/hovercard">#8164</a>).</li>
</ul>
<h3>Other improvements</h3>
<ul>
<li><code>status</code> gained a <code>buildinfo</code> subcommand, to print information on how fish was built, to help with debugging (<a href="https://github.com/fish-shell/fish-shell/issues/10896" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10896/hovercard">#10896</a>).</li>
<li><code>fish_indent</code> will now collapse multiple empty lines into one (<a href="https://github.com/fish-shell/fish-shell/issues/10325" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10325/hovercard">#10325</a>).</li>
<li><code>fish_indent</code> now preserves the modification time of files if there were no changes (<a href="https://github.com/fish-shell/fish-shell/issues/10624" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10624/hovercard">#10624</a>).</li>
<li>Performance in launching external processes has been improved for many cases (<a href="https://github.com/fish-shell/fish-shell/issues/10869" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10869/hovercard">#10869</a>).</li>
<li>Performance and interactivity under Windows Subsystem for Linux has been improved, with a workaround for Windows-specific locations being appended to <code>$PATH</code> by default (<a href="https://github.com/fish-shell/fish-shell/issues/10506" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10506/hovercard">#10506</a>).</li>
<li>On macOS, paths from <code>/etc/paths</code> and <code>/etc/manpaths</code> containing colons are handled correctly (<a href="https://github.com/fish-shell/fish-shell/issues/10684" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10684/hovercard">#10684</a>).</li>
<li>Additional filesystems such as AFS are properly detected as remote, which avoids certain hangs due to expensive filesystem locks (<a href="https://github.com/fish-shell/fish-shell/issues/10818" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10818/hovercard">#10818</a>).</li>
<li>A spurious error when launching multiple instances of fish for the first time has been removed (<a href="https://github.com/fish-shell/fish-shell/issues/10813" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/10813/hovercard">#10813</a>).</li>
</ul>

<h3>For distributors</h3>
<p>fish has been ported to Rust. This means a significant change in dependencies, which are listed in the README. In short, Rust 1.70 or greater is required, and a C++ compiler is no longer needed (although a C compiler is still required, for some C glue code and the tests).</p>
<p>CMake remains the recommended build system, because of cargo’s limited support for installing support files. Version 3.5 remains the minimum supported version. The Xcode generator for CMake is not supported any longer (<a href="https://github.com/fish-shell/fish-shell/issues/9924" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/9924/hovercard">#9924</a>). CMake builds default to optimized release builds (<a href="https://github.com/fish-shell/fish-shell/issues/10799" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/10799/hovercard">#10799</a>).</p>
<p>fish no longer depends on the ncurses library, but still uses a terminfo database. When packaging fish, please add a dependency on the package containing your terminfo database instead of curses.</p>
<p>The <code>test</code> target was removed as it can no longer be defined in new CMake versions. Use <code>make fish_run_tests</code>. Any existing test target will not print output if it fails (<a href="https://github.com/fish-shell/fish-shell/issues/11116" data-hovercard-type="issue" data-hovercard-url="/fish-shell/fish-shell/issues/11116/hovercard">#11116</a>).</p>
<p>The Web-based configuration has been rewritten to use Alpine.js (<a href="https://github.com/fish-shell/fish-shell/issues/9554" data-hovercard-type="pull_request" data-hovercard-url="/fish-shell/fish-shell/pull/9554/hovercard">#9554</a>).</p>
<h3>Changes since fish 4.0b1</h3>
<p>A number of improvements were included in fish 4.0.0 following the beta release of 4.0b1. These include fixes for regressions, improvements to completions and documentation, and the removal of a small number of problematic changes.</p>
<p>The full list of fixed issues can be found on the <a href="https://github.com/fish-shell/fish-shell/milestone/43">GitHub milestone page for 4.0-final</a>.</p>
<p><em>Download links: To download the source code for fish, use the file named &#34;fish-4.0.0.tar.xz&#34;. The file downloaded from &#34;Source code (tar.gz)&#34; may not build correctly. The SHA-256 sum of this file is <code>2fda5bd970357064d8d4c896e08285ba59965ca2a8c4829ca8a82bf3b89c69f3</code>. A GPG signature from David Adam (key ID <code>0x7A67D962D88A709A</code>) is available  is available as &#34;fish-4.0.0.tar.xz.asc&#34;.</em></p></div></div>
  </body>
</html>
