<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kimmo.blog/posts/7-building-eink-weather-display-for-our-home/">Original</a>
    <h1>Building an e-ink weather display for our home</h1>
    
    <div id="readability-page-1" class="page"><div><div><p><em>This post describes the build-process. You can find more about the software in the <a href="https://github.com/kimmobrunfeldt/eink-weather-display">GitHub repo</a>.</em></p><div><p><a href="https://kimmo.blog/content-assets/7/scene.jpg" rel="noreferrer" target="_blank"><img alt="The final build" src="https://kimmo.blog/content-assets/7/scene.jpg"/></a></p><p>The final build</p></div><p>We almost always want to know today&#39;s weather before leaving the apartment. Often the whole event is quite a hassle: getting our daughter dressed, finding all our personal outwear, plus trying to find your phone to check the weather. To make the experience 1% better, the solution obviously needs engineering.</p><p>I decided to build a DIY battery powered e-ink weather display for our home. After researching a while, I ended up with a few goals for the build:</p><ul><li>Easily glanceable weather forecast at the heart of our home. Ideally eliminates one more reason to pick up the phone.</li><li>Looks like a &#34;real product&#34;. The housing should look professional.</li><li>Fully battery-powered. We didn&#39;t want a visible cable, and drilling the cable inside wall wasn&#39;t an option.</li><li>Always visible and doesn&#39;t light up the hallway during evening / night. This leads to e-ink display.</li><li>Primarily for our use case, but with reusability in mind. For example custom location and timezone. The end result is somewhat tied to Finland due to using the API of Finnish meteorological institute, but nevertheless the design goal was kept in mind.</li></ul><p>The goals come with a few challenges:</p><ul><li>Battery life obviously. Fortunately e-ink displays have an interesting property: the rendered image stays visible as is even if all cables are disconnected. It doesn&#39;t require any power to keep the image.</li><li>Low refresh speed due to battery life constraint. My plan was to refresh the screen only once or twice a day. That brings interesting design challenges.  How do you indicate that the data is not real time? What should we show as the day&#39;s temperature: average or maximum for the day?</li><li>Physical constraints by the frame. Ideally it would be flush to the wall behind.</li></ul><h2 id="the-plan">The plan</h2><p>The device should wake up early in the morning, fetch the latest weather forecast information, update the information to the e-ink display, and go back to deep sleep until tomorrow.</p><p>That way, we would have a fresh weather forecast for the day while consuming minimal amount of battery.</p><p>Then comes the execution.</p><h2 id="execution">Execution</h2><p>First I designed the weather UI in Figma. This took around 2 days (i.e. evenings after work).</p><p><a href="https://kimmo.blog/content-assets/7/figma.png" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/figma.png"/></a></p><p>It was design to the <a href="https://www.waveshare.com/7.5inch-e-paper-hat.htm">Waveshare 7.5&#34; e-ink display</a>. After ordering one, I started looking into good fonts to display in a 1-bit (black and white) screen. It was surprisingly hard to find real 1-bit-screen fonts, so I tested a few sample renders using regular web fonts with and without post-processing:</p><p><a href="https://kimmo.blog/content-assets/7/test-anti-alias-disabled.png" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/test-anti-alias-disabled.png"/></a>
<a href="https://kimmo.blog/content-assets/7/test-post-process-all-pixels-black.png" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/test-post-process-all-pixels-black.png"/></a>
<a href="https://kimmo.blog/content-assets/7/test-post-process-threshold-pixels-black.png" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/test-post-process-threshold-pixels-black.png"/></a></p><p>I wasn&#39;t super satisfied.. the product would be in a central place in our apartment, so it should look nice.</p><p>So... after thinking a bit, I ordered the 10.3&#34; 16-bit display in addition, since it allows text to be anti-aliased. The end result is way smoother. It would&#39;ve been possible to just live with the 1-bit display constraint, but I decided to use that screen for something else in the future.</p><p>On the same day, I also ordered a bunch of other hardware I was expecting to use: SD card, PiJuice chip and battery, standoff screws, GPIO cables and adapters. Fortunately a friend of mine had a spare Raspberry PI Zero lying around which I could use.</p><p>After the Figma designs were ready enough, I started creating the HTML page which is used to render the UI. Many existing projects used lower level libraries such as Python Imaging Library, but I opted for HTML and CSS. The development is fast when you can edit the HTML and immediately see the result without rendering a raster image after each iteration.</p><p>The UI development took rougly 1-2 weeks when coding in the evenings and weekends. Having a flu delayed the build a bit unfortunately.</p><p><a href="https://kimmo.blog/content-assets/7/web-app-dev.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/web-app-dev.jpg"/></a></p><p>The software vs hardware timing realised like a perfect Gantt Chart. As soon as I was ready fine-tuning the UI, the hardware arrived to Finland. Nice.</p><p>Even though the development was done with the 1872x1404 display resolution in mind, I could finally see how it actually looked like. The Raspberry PI installation and setup took quite some time, but it paid off. It was absolutely amazing to see the UI appear the first time in the e-ink display.</p><div><p><a href="https://kimmo.blog/content-assets/7/first-display.jpg" rel="noreferrer" target="_blank"><img alt="First display" src="https://kimmo.blog/content-assets/7/first-display.jpg"/></a></p><p>Past bedtime</p></div><p>Everything was surprisingly smooth sailing to this point. But then I assembled all the parts together and realized how small the frame actually is.</p><p><a href="https://kimmo.blog/content-assets/7/gpio-too-tall.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/gpio-too-tall.jpg"/></a></p><p>I didn&#39;t want to build a larger visible casing to the back, so it was time to go back to the drawing board. I tried to fit everything in the frame by testing all kinds of combinations. This monstrous GPIO cable + 1-to-2 adapter setup almost did the job:</p><p><a href="https://kimmo.blog/content-assets/7/gpio-cable.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/gpio-cable.jpg"/></a></p><p>But even after cutting all extra plastic pieces from the cables, it wasn&#39;t possible to mount the frame flush to wall.</p><p>Then I realised that the Waveshare demo page featured Windows app that connected to the controller via the micro-USB interface. Would it be possible to use that to control the display? There weren&#39;t any examples of doing that in a Linux box though.</p><p>Fortunately for me, some great minds had already <a href="https://twitter.com/faassen/status/1375922965062238208?lang=en">thought the same</a>. I connected the controller using USB cables, built the C code in the Raspberry PI, and tried to clear the display as a test. It worked! What a relief. USB cables were <em>so much</em> smaller than the 40-pin GPIO cables and headers.</p><p>Now that I was confident about the USB-strategy, I needed to get rid of the GPIO header of the IT851 controller. The chip was still too tall for the frame with it attached. Fortunately, Helsinki has an amazing library <em>(more like a library, hacker space, gaming cafe, and a public hangout place combined)</em> where I could go and desolder the header <em>for free</em>.</p><div><p><a href="https://kimmo.blog/content-assets/7/oodi.jpg" rel="noreferrer" target="_blank"><img alt="Oodi" src="https://kimmo.blog/content-assets/7/oodi.jpg"/></a></p><p>The picture is from the library&#39;s electronics room which has cool gear such as laser cutter, 3D printer, and much more.</p></div><p>It&#39;s mind-boggling how cool Oodi is architecturally but also functionally.</p><p>Unfortunately, my soldering skills weren&#39;t as mind-boggling. I estimated to my wife that the job would take around 20 minutes. But even after 1.5 hours of desoldering and googling how to desolder components, I wasn&#39;t able to rip the header off the chip. My time was up in the soldering lab.</p><p>Next strategy was brute force. I took my side cutters and just chopped half of the header off. All I could hope for was that the chip would work after the treatment. With the GPIO header chopped in half, all parts finally fit the IKEA frame nicely!</p><p>The unknows in software had been solved, and the final assembly could begin. I mounted everything to the IKEA frame using screws and hot glue. The display is super thin, so I avoided placing any screws on the back cover directly behind the display. The back cover bends slightly so the screws could end up damaging the panel while moving the product for charging.</p><p><a href="https://kimmo.blog/content-assets/7/final-build-back.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/final-build-back.jpg"/></a></p><p>Tada! Components were able to almost perfectly fit within the 2.9cm thick IKEA Frame. Out of the 2.9cm, approximately 2cm of thickness is left for the actual components.</p><p><a href="https://kimmo.blog/content-assets/7/thickness.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/thickness.jpg"/></a></p><p>I was super worried about component damage after the desoldering amateur hour, but fortunately everything still worked.</p><p>Finally, I tested a few error cases.</p><p><a href="https://kimmo.blog/content-assets/7/error-example.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/error-example.jpg"/></a></p><p><a href="https://kimmo.blog/content-assets/7/battery-empty.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/battery-empty.jpg"/></a></p><p>Those done, it was time to mount the frame on our wall.</p><p><a href="https://kimmo.blog/content-assets/7/sunset-product.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/sunset-product.jpg"/></a></p><p><a href="https://kimmo.blog/content-assets/7/closeup.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/closeup.jpg"/></a></p><p><a href="https://kimmo.blog/content-assets/7/scene.jpg" rel="noreferrer" target="_blank"><img src="https://kimmo.blog/content-assets/7/scene.jpg"/></a></p><p>I really like the end result. The IKEA frame has a white cardboard border, which we ended up cutting to fit the screen. To not have mismatching aspect ratios of the white cardboard border and the frame itself, I sacrificed a few vertical pixels of the e-ink display. The white cover board opening is vertically shorter than what the e-ink display is capable of, leaving some Y-pixels unused. A bit of a shame, but the overall look is most important!</p><p>One option I considered was to saw the frame to be a perfect fit for the screen. However, it could&#39;ve lead to a messy end result and it was much easier to mount everything to the back cover with the extra space.</p><p>The project took 3 weeks in calendar time. I was positively surprised about the quick turnaround time. It didn&#39;t happen by chance though. I purposely chose familiar hardware and software to make the development a easier. The idea was to actually finish the project, even though lower-level tinkering would&#39;ve been educational and beneficial.</p><p>That&#39;s everything, it was fun!</p><h3 id="hardware-list-for-reference">Hardware list for reference</h3><ul><li>Raspberry PI Zero W</li><li><a href="https://uk.pi-supply.com/products/pijuice-zero">PiJuice Zero</a></li><li><a href="https://uk.pi-supply.com/products/pijuice-12000mah-battery">PiJuice 12000mAh battery</a>. As large as possible to avoid having to charge the device often.</li><li><a href="https://www.waveshare.com/10.3inch-e-paper-hat.htm">Waveshare 10.3&#34; 1872x1404 e-ink display with Raspberry PI HAT</a>. Supports 16 shades of black and white.</li><li><a href="https://www.amazon.de/-/en/gp/product/B07MN2GY6Y/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">Geekworm Raspberry Pi Installation Tool 132 Pcs</a>. For a set of spacers and screws that fit Raspberry PI projects nicely.</li><li>Micro-usb to USB adapter</li><li>USB to micro-usb cable</li><li><a href="https://www.ikea.com/fi/fi/p/hovsta-kehys-ja-kehyskartonki-koivukuvio-40365762/">IKEA Hovsta Frame</a></li><li>Misc building items: hot glue, hair band to hold the battery, wall mounting hooks, small plastic box cut to pieces to support the battery from below, and of course duct tape.</li></ul><p>Hardware bought but not needed in the end:</p><ul><li><a href="https://www.amazon.de/-/en/gp/product/B08C4S8NPH/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">GeeekPi Micro Connectors Raspberry Pi 40-pin GPIO 1 to 2 Expansion Board</a>. To connect PiJuice and e-ink display nicely.</li><li><a href="https://www.amazon.de/-/en/gp/product/B08VRJ51T4/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">GPIO Cable for Raspberry Pi 40 Pin</a>. To allow a bit more flexibility inside the build.</li></ul></div></div></div>
  </body>
</html>
