<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://andregarzia.com/2022/02/unable-to-login-to-hn-from-firefox-a-lovecraftian-tale.html">Original</a>
    <h1>Tell HN: Unable to login to HN from Firefox, a Lovecraftian tale</h1>
    
    <div id="readability-page-1" class="page"><article>
        <div itemprop="articleBody">
          <header><p>Posted <time datetime="2022-02-01">Tuesday, February 1st, 2022</time> </p></header>
          <p>I love an epic tale of debugging. You know, those fantastic stories in which an ingenious person goes on a quest to solve a problem and end up in triumph and glory. Sherlock-Holmes-of-debugging kind of stories. Well, this is not one of those tales. This is a very personal problem, not an epic quest. Apparently it is only affecting me. This is also a Lovecraftian tale because I’m slowly getting mad because of it.</p><p>It all begun when I logged out of <a href="https://news.ycombinator.com">Hacker News</a> and all of a sudden couldn’t log back in. It is a very strange behaviour, the login form redirects back to the homepage as if nothing happened. My password is not wrong. I thought that maybe it is a HN bug, give it some days for them to notice and fix it.</p><p>Many days passed. I noticed that I could still post and upvote because those actions would redirect me to the login page. After filling my info there and submitting the form, whatever action I was attempting to do would go through, but I would still not be logged into the webapp. I tried using some other browsers such as Safari and Vivaldi. In those browsers, I could log in normally. I started living a kind of double life, using Firefox for most of my browsing and Safari for when I wanted to interact with HN.</p><p>That got boring really fast. I still kept at it because I’m lazy. I have better things to do. That bug, laughing in the distance, haunted my dreams.</p><p>I got fed up with it and started investigating. It boiled down to the <em>user cookie</em> being rejected because of its expiry date being already in the past.</p><figure><img src="https://andregarzia.com/2022/02/img/cookie-expired.png" alt="Screenshot from Firefox console."/><figcaption>Screenshot from Firefox console.</figcaption></figure><p>Well, that looks easy to fix, right? I checked the <em>Network tab</em> on Firefox DevTools and saw that the expiry date for that cookie was in 2038. Time is flying during the pandemic, but it is not flying that fast. 2038 is still in the future. Why is Firefox saying it is not? I posted a <a href="https://news.ycombinator.com/item?id=30108322"><em>Ask HN</em> post</a> asking if someone experienced a similar problem. A clever user pointed me to <a href="https://en.m.wikipedia.org/wiki/Year_2038_problem">Year 2038 problem</a>, and I thought that was it.</p><p>Today I decided to message the HN mods about it. This led to various messages being exchanged with Daniel who has been extremelly helpful trying to debug this. We both though that the problem might be related to the expiration date being too close to the 2038 cut-off date. He made a temporary change to set the expiration date on the cookie to 2032 instead, and I tried again.</p><figure><img src="https://andregarzia.com/2022/02/img/2032.png" alt="That date looks in the future for me, but not for Firefox."/><figcaption>That date looks in the future for me, but not for Firefox.</figcaption></figure><p>At that point, Daniel confirmed that they could log in and out of HN from Firefox on his side. Other Firefox users are silent as well. Had this been happening to other users, I bet they’d be screaming. The problem looks like a personal hellscape. Like Ged in Earthsea, this is my own personal devil. I need to get rid of it.</p><h3>Clearing cookies</h3><p>My first step has been trying to inspect whatever cookies I had set for the <em>.ycombinator.com</em> domain. I cleared them all on Firefox settings interface. It didn’t work.</p><p>I mostly browse using Firefox Nightly because I’m one of those people who think your browser needs to have bugs to keep your web experience fresh and enjoyable. Maybe it was something wrong with Nightly. Launched Firefox stable, which I haven’t launched in ages, and attempted to log into HN. No cookie for me. It still didn’t work.</p><p>Be aware that Firefox Nightly and Firefox stable use different <a href="https://support.mozilla.org/en-US/kb/profiles-where-firefox-stores-user-data">profiles</a>. The user data from one version is separate from the other. I can log in to HN from all other browsers in my machine except Firefox. It doesn’t matter what profile I use and what Firefox version I use.</p><p>I disabled all the cool add-ons that makes web browsing a pleasant experience—such as uBlock Origin and friends—cleared cookies and tried again. It still didn’t work.</p><h3>I came like a wrecking ball...</h3><p>In my frustration, I decided to do what you should not do with your browser: fiddle with internal files. Firefox on macOS stores it’s data in the <em>Application Support</em> folder. MacOS hides this folder for a reason. The reason being Apple doesn’t want to answer support calls when you break things up.</p><p>Once inside the folder for my Nightly profile, I opened the <em>cookies.sqlite</em> file and kicked some buckets.</p><p>After searching about this problem, I’ve seen some old reports that Firefox was somehow failing to clear old cookies, and that it happened once you had more than 3000 cookies set. I had 3055 cookies on that profile. First step was deleting any cookie for the Y Combinator host. Then I deleted all the <em>ai_user</em> cookies because if I’m having a bad time, so should Google Analytics. That reduced my cookie count below 2000.</p><p>I STILL CAN’T LOGIN TO HN.</p><h3>Maybe it is the cookie syntax...</h3><p>Inspecting the raw response from HN server, I noticed that the date is using dashes instead of spaces:</p><pre><code>Set-Cookie: user=sadboi; Expires=Thu, 01-Jan-2032 00:00:00 GMT; HttpOnly; SameSite=Lax; Secure</code></pre><p>Maybe that was it. Isn’t the format supposed to be with spaces instead? The info on <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie">MDN WebDocs about <em>set-cookies</em></a> is really lax on the date format. It looks quite flexible.</p><p>Experimentation is the mother of learning! I decided to quickly build a little Web Server and try to set my own cookies using dashes in the date and see if I could replicate the bug in a different site. The quickest way for me to build most of my toys is to use <a href="https://livecode.com">LiveCode</a>—a modern-day HyperCard—and just create a simple stack.</p><figure><img src="https://andregarzia.com/2022/02/img/server-stack.png" alt="Behold, the world&#39;s silliest server."/><figcaption>Behold, the world’s silliest server.</figcaption></figure><p>The code is quite minimal, it just replies with some text and attempts to set two cookies: one with dashes in the expiry date and another without.</p><pre><code>on startServer
   put empty into field &#34;debug&#34;
   httpdStart &#34;NewRequest&#34;, 12345, &#34;My Server&#34;
   launch url (&#34;http://localhost:&#34; &amp; it)
end startServer

on NewRequest pSocketID, pRequest
   put arraytojson(pRequest,,true) into field &#34;debug&#34;

   put &#34;Set-Cookie: userWithDashes=kenobi; Expires=Thu, 01-Jan-2032 00:00:00 GMT; HttpOnly; SameSite=Lax; Secure&#34; &amp; crlf into tHeaders
   put &#34;Set-Cookie: userNoDashes=kenobi; Expires=Thu, 01 Jan 2032 00:00:00 GMT; HttpOnly; SameSite=Lax; Secure&#34; &amp; crlf after tHeaders

   httpdResponse pSocketID, 200, &#34;Hi There, General Kenobi!&#34;, tHeaders
end NewRequest</code></pre><p>Guess what? Dates with dashes work. I have no problem setting those cookies. They work fine. That is not the problem.</p><figure><img src="https://andregarzia.com/2022/02/img/dashes-work.png" alt="Yep, those cookies worked fine."/><figcaption>Yep, those cookies worked fine.</figcaption></figure><p>I STILL CAN’T LOGIN TO HN.</p><h3>A clueless user goes inside Application Support</h3><p>Went back to the profile folder. You know you’re desperate when you start using <a href="https://www.unix.com/man-page/osx/1/mdfind/">mdfind</a> to look for clues.</p><pre><code>$ mdfind -onlyin . ycombinator</code></pre><p>I could see that <em>ycombinator</em> was present in some files and folder inside my profile. There was a cache folder for it full of empty files, and also a security related file which I think is related to that <em>Strict-Transport-Security</em> header. I nuked that cache folder.</p><p>I STILL CAN’T LOGIN TO HN.</p><h3>Final words</h3><p>If you’re frustrated because there is no happy ending here, imagine how I feel. I have no trick left to try. I don’t have this problem with any other site, and I don’t have this problem with other browsers. It is a spawn of hell that is born out of the conjunction of my Firefox installation and HN. I deleted all occurrences of <em>ycombinator</em> from the profile. No cookies, no cache, nothing. And it still doesn’t work.</p><p>I think I’ve tried to fix this enough for today. I wanted to post about this problem once I solved it, but it is quite clear that I can’t solve it. Maybe some reader can, maybe you can help guide me out of this maze.</p><h3>Updates</h3><p>I’ll post updates as I figure stuff out.</p><p><strong>1st of February 2022 at 18:21:</strong> If I use <em>private browsing</em>, there is no bug and I can login without problem. The problem still there if I use my normal profile.</p><p><strong>1st of February 2022 at 18:37:</strong> I think that some devs at HN are investigating it. Now, HN is giving me an error in Safari when I try to open the site. I was logged in on Safari. I can still open the site if I’m not logged in.</p><figure><img src="https://andregarzia.com/2022/02/img/news-trouble.png" alt="Oops..."/><figcaption>Oops...</figcaption></figure><p>That problem lasted just some minutes. I’m back logged in in Safari.</p>
      </div></article></div>
  </body>
</html>
