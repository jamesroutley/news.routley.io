<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/rectanglehq/Shapeshift">Original</a>
    <h1>Shapeshift: Semantically map JSON objects using key-level vector embeddings</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/rectanglehq/Shapeshift/blob/main/rectangle-logo.png"><img src="https://github.com/rectanglehq/Shapeshift/raw/main/rectangle-logo.png" width="256"/></a></p>

<p dir="auto">Shapeshift is a TypeScript library that maps arbitrarily structured JSON objects using vector embeddings. It uses semantic similarity to match keys between objects, allowing for flexible and intelligent object transformation, including support for nested structures.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/rectanglehq/Shapeshift/blob/main/graphic.png"><img src="https://github.com/rectanglehq/Shapeshift/raw/main/graphic.png" width="648"/></a></p>

<ul dir="auto">
<li>Map objects with different structures based on semantic similarity of keys</li>
<li>Support for nested objects</li>
<li>Multiple embedding providers: Cohere, OpenAI, and Voyage</li>
<li>Customizable embedding model and similarity threshold</li>
<li>TypeScript support for type safety</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="npm install @rectanglehq/shapeshift"><pre>npm install @rectanglehq/shapeshift</pre></div>
<p dir="auto">Ensure you have an API key from your chosen embedding provider (Cohere, OpenAI, or Voyage).</p>

<p dir="auto">Here&#39;s an example demonstrating Shapeshift&#39;s capability to handle nested objects:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { Shapeshift } from &#34;@rectanglehq/shapeshift&#34;;

const sourceObj = {
  personalInfo: {
    name: &#34;John Doe&#34;,
    age: 30,
  },
  occupation: &#34;Software Engineer&#34;,
  fullAddress: &#34;123 Main St, Anytown&#34;,
  address: {
    street: &#34;123 Main St&#34;,
    city: &#34;Anytown&#34;,
  },
};

// The values of the target object are irrelevant
const targetObj = {
  fullName: &#34;&#34;,
  yearsOld: 0,
  profession: &#34;&#34;,
  location: {
    streetAddress: &#34;&#34;,
    cityName: &#34;&#34;,
  },
};

const shapeshifter = new Shapeshift(
  { embeddingClient: &#34;cohere&#34;, apiKey: process.env.COHERE_API_KEY || &#34;&#34; },
  { embeddingModel: &#34;embed-english-v3.0&#34;, similarityThreshold: 0.5 }
);

const shiftedObj = await shapeshifter.shapeshift(sourceObj, targetObj);
console.log(&#34;Shifted object:&#34;, shiftedObj);"><pre><span>import</span> <span>{</span> <span>Shapeshift</span> <span>}</span> <span>from</span> <span>&#34;@rectanglehq/shapeshift&#34;</span><span>;</span>

<span>const</span> <span>sourceObj</span> <span>=</span> <span>{</span>
  <span>personalInfo</span>: <span>{</span>
    <span>name</span>: <span>&#34;John Doe&#34;</span><span>,</span>
    <span>age</span>: <span>30</span><span>,</span>
  <span>}</span><span>,</span>
  <span>occupation</span>: <span>&#34;Software Engineer&#34;</span><span>,</span>
  <span>fullAddress</span>: <span>&#34;123 Main St, Anytown&#34;</span><span>,</span>
  <span>address</span>: <span>{</span>
    <span>street</span>: <span>&#34;123 Main St&#34;</span><span>,</span>
    <span>city</span>: <span>&#34;Anytown&#34;</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>;</span>

<span>// The values of the target object are irrelevant</span>
<span>const</span> <span>targetObj</span> <span>=</span> <span>{</span>
  <span>fullName</span>: <span>&#34;&#34;</span><span>,</span>
  <span>yearsOld</span>: <span>0</span><span>,</span>
  <span>profession</span>: <span>&#34;&#34;</span><span>,</span>
  <span>location</span>: <span>{</span>
    <span>streetAddress</span>: <span>&#34;&#34;</span><span>,</span>
    <span>cityName</span>: <span>&#34;&#34;</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>;</span>

<span>const</span> <span>shapeshifter</span> <span>=</span> <span>new</span> <span>Shapeshift</span><span>(</span>
  <span>{</span> <span>embeddingClient</span>: <span>&#34;cohere&#34;</span><span>,</span> <span>apiKey</span>: <span>process</span><span>.</span><span>env</span><span>.</span><span>COHERE_API_KEY</span> <span>||</span> <span>&#34;&#34;</span> <span>}</span><span>,</span>
  <span>{</span> <span>embeddingModel</span>: <span>&#34;embed-english-v3.0&#34;</span><span>,</span> <span>similarityThreshold</span>: <span>0.5</span> <span>}</span>
<span>)</span><span>;</span>

<span>const</span> <span>shiftedObj</span> <span>=</span> <span>await</span> <span>shapeshifter</span><span>.</span><span>shapeshift</span><span>(</span><span>sourceObj</span><span>,</span> <span>targetObj</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Shifted object:&#34;</span><span>,</span> <span>shiftedObj</span><span>)</span><span>;</span></pre></div>



<div dir="auto" data-snippet-clipboard-copy-content="new Shapeshift(
  { embeddingClient: EmbeddingClient, apiKey: string },
  options?: ShapeshiftOptions
)"><pre><span>new</span> <span>Shapeshift</span><span>(</span>
  <span>{</span> <span>embeddingClient</span>: <span>EmbeddingClient</span><span>,</span> <span>apiKey</span>: <span>string</span> <span>}</span><span>,</span>
  <span>options</span>?: <span>ShapeshiftOptions</span>
<span>)</span></pre></div>
<ul dir="auto">
<li><code>embeddingClient</code>: The embedding provider to use (&#39;cohere&#39;, &#39;openai&#39;, or &#39;voyage&#39;).</li>
<li><code>apiKey</code>: Your API key for the chosen embedding provider.</li>
<li><code>options</code> (optional):
<ul dir="auto">
<li><code>embeddingModel</code>: The embedding model to use (default varies by provider).</li>
<li><code>similarityThreshold</code>: The minimum similarity score to consider a match (default: 0.5).</li>
</ul>
</li>
</ul>

<div dir="auto"><h5 tabindex="-1" dir="auto"><code>shapeshift&lt;T extends ObjectWithStringKeys, U extends ObjectWithStringKeys&gt;(sourceObj: T, targetObj: U): Promise&lt;U&gt;</code></h5><a id="user-content-shapeshiftt-extends-objectwithstringkeys-u-extends-objectwithstringkeyssourceobj-t-targetobj-u-promiseu" aria-label="Permalink: shapeshift&lt;T extends ObjectWithStringKeys, U extends ObjectWithStringKeys&gt;(sourceObj: T, targetObj: U): Promise&lt;U&gt;" href="#shapeshiftt-extends-objectwithstringkeys-u-extends-objectwithstringkeyssourceobj-t-targetobj-u-promiseu"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Maps the <code>sourceObj</code> to the structure of <code>targetObj</code> based on semantic similarity of keys, including nested structures.</p>
<ul dir="auto">
<li><code>sourceObj</code>: The source object to map from (can include nested objects).</li>
<li><code>targetObj</code>: The target object structure to map to (can include nested objects).</li>
<li>Returns: A promise that resolves to the shifted object with the structure of <code>targetObj</code>.</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Supported Embedding Providers and Models</h2><a id="user-content-supported-embedding-providers-and-models" aria-label="Permalink: Supported Embedding Providers and Models" href="#supported-embedding-providers-and-models"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<ul dir="auto">
<li>Default model: &#39;embed-english-v3.0&#39;</li>
</ul>

<ul dir="auto">
<li>Default model: &#39;text-embedding-ada-002&#39;</li>
</ul>

<ul dir="auto">
<li>Default model: &#39;voyage-large-2&#39;</li>
</ul>

<ol dir="auto">
<li>The library flattens both the source and target objects, preserving the nested structure information in the keys.</li>
<li>It calculates embeddings for the flattened keys of both objects using the specified embedding provider and model.</li>
<li>For each key in the flattened source object, it finds the most semantically similar key in the flattened target object using cosine similarity of their embeddings.</li>
<li>If the similarity score is above the specified threshold, the value from the source object is mapped to the corresponding key in the target object.</li>
<li>Finally, the library unflattens the result, restoring the nested structure of the target object.</li>
</ol>
<div dir="auto"><h2 tabindex="-1" dir="auto">Handling of Nested Objects</h2><a id="user-content-handling-of-nested-objects" aria-label="Permalink: Handling of Nested Objects" href="#handling-of-nested-objects"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Shapeshift can handle nested objects in both the source and target structures. It does this by:</p>
<ol dir="auto">
<li>Flattening nested objects into a single-level object with dot-notation keys.</li>
<li>Performing the semantic matching on these flattened keys.</li>
<li>Reconstructing the nested structure in the final output.</li>
</ol>
<p dir="auto">This allows for flexible mapping between different object structures, even when the nesting doesn&#39;t exactly match.</p>

<ul dir="auto">
<li>The quality of mapping depends on the semantic similarity of key names. Very dissimilar names may not map correctly.</li>
<li>While the library can handle nested objects, extremely deep nesting may impact performance.</li>
</ul>

<p dir="auto">Contributions are welcome! Please feel free to submit a Pull Request.</p>

<p dir="auto">This project is licensed under the MIT License.</p>
</article></div></div>
  </body>
</html>
