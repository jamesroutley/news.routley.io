<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://george.mand.is/2024/10/til-there-are-apple-specific-samba-server-configuration-settings/">Original</a>
    <h1>TIL there are Apple-specific Samba server configuration settings</h1>
    
    <div id="readability-page-1" class="page"><div><article><section><header><p><time datetime="2024-10-20">October 20th, 2024</time> • ~600 words • 3 minute read</p></header><p>I&#39;ve been having fun with Raspberry Pis lately.</p><p>Besides my <a href="https://george.mand.is/2024/10/solar-pi/">solar-powered website</a> project, I&#39;ve been playing with making tiny servers and hiding them around my apartment. To what end, I&#39;m uncertain.</p><p>Already I can see myself falling into some kind of digital &#34;Ideal Palace&#34; obsession like <a href="https://en.wikipedia.org/wiki/Ferdinand_Cheval">Ferdinand Cheval</a>—little computers in my garden, my books, and other hidden nooks-and-crannies, connected to my network with playful names and curious peripherals, tasked with curious purpose...</p><p>But this isn&#39;t about that. I&#39;m simply writing to document an interesting thing I learned on the way to setting up a Samba server on one of those little computers.</p><h2>So, what is a Samba server?</h2><p>A <a href="https://www.samba.org/samba/what_is_samba.html">Samba server</a> is standard server software that lets you share files and printers on a network regardless of operating system. Historically it&#39;s (probably) the reason you can print your documents at work or the library when you&#39;re connected to the network or share files between machines.</p><p>Samba uses the <abbr title="Server Message Block">SMB</abbr> (Server Message Block) and <abbr title="Common Internet File System">CIFS</abbr> (Common Internet File System) protocols to facilitate this.</p><p>If you have a macOS or Windows machine, these things typically “just work”—you’ll see other people’s machines and shared peripherals on the network, to the extent that they’ve been made public and set to share.</p><p><img src="https://georgemandis.s3.us-west-1.amazonaws.com/samba-network-in-action.png" alt="A screenshot of what I see in my network tab, where I have started to name my little computers are the moons of jupiter starting with Europa, Callisto and Ganymede"/></p><p>Why the Jovian naming convention you might ask? Besides the obvious reason being space is cool, <a href="https://science.nasa.gov/jupiter/moons/all-jupiter-moons/">there are 95 of them</a>. That gives me ample room to lean into this theme.</p><p>Now, when I click into into any of those moons of Jupiter, I can peruse the folders I&#39;ve specified as browseable in the Samba config on that machine.</p><p><img src="https://georgemandis.s3.us-west-1.amazonaws.com/ganymede-files.png" alt="A screenshot of browing the files on Ganymede"/></p><p>As you can see in that screenshot, I&#39;ve set the home folder to be browseable. This is all on my private network at home, so there isn&#39;t really any risk. Maybe I&#39;ll reconsider all this some day.</p><p>There isn&#39;t really anything on there and I haven&#39;t decided what to do with it, but being able to remotely view and control the machine over <abbr title="Virtual Network Computing">VNC</abbr> and see an item magically show up on the desktop that I dragged into the &#34;Desktop&#34; folder from my Mac is kind of fun.</p><h2>Making it nice on macOS</h2><p>Every time I&#39;d tried to implement a Samba server from scratch on my Raspberry Pi it just felt... funky. I&#39;m not articulating it well, but the experience I expected was more or less clicking on the name of the server and being able to browse the files, more or less like it&#39;s another folder. The stock Samba configurations never quite did this.</p><p>I noticed however that the out-of-the-box file sharing configuration for my <a href="https://shop.zimaboard.com">Zimaboard</a> <em>did</em> work the way I expected. What was different, I wondered?</p><p><img src="https://georgemandis.s3.us-west-1.amazonaws.com/zimboard-samba-config.png" alt="Screenshot of the default Samba server configuration on my Zimaboard"/></p><p>Aha! Immediately the <code>fruit:</code> prefixed options jumped out at me.</p><p>It turns out there are some Apple-specific options you can set in your Samba config file. They&#39;re all prefixed with <code>fruit:&lt;option&gt;</code> and documented below:</p><ul><li><a href="https://www.samba.org/samba/docs/current/man-html/vfs_fruit.8.html">https://www.samba.org/samba/docs/current/man-html/vfs_fruit.8.html</a></li></ul><p>With these <code>fruit:</code> prefixed values I can leverage Apple’s extended file attributes and metadata handling in macOS.</p><ul><li><code>vfs objects = fruit streams_xattr</code> enables better management of resource forks and Apple-specific file metadata, such as Finder information, which is stored using extended attributes. (I’m not sure why it’s commented out in the Zima configuration. I uncommented it for my Raspberry Pis because it seemed sensible after reading the definition.)</li><li>By setting <code>fruit:metadata = stream</code> and <code>fruit:model = Macmini</code> the server better mimics macOS file storage behavior and the icon that appears next to the machine in Finder. Kind of fun!</li><li>Disabling AppleDouble files (<code>fruit:veto_appledouble = yes</code>) helps avoid clutter, while enabling <code>fruit:posix_rename</code> and <code>fruit:delete_empty_adfiles</code> improves file renaming and cleanup.</li></ul><p>A deeper-dive into how<abbre title="Apple File System">APFS (<a href="https://en.wikipedia.org/wiki/Apple_File_System">Apple File System</a>) works and interacts with SMB is next on my list for some future Sunday, but I thought I&#39;d write something to further document that these vendor-specific options even exist, since they took me by surprise.</abbre></p><p>Hope it helps somebody!</p></section></article></div></div>
  </body>
</html>
