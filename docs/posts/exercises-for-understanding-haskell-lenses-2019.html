<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://williamyaoh.com/posts/2019-04-25-lens-exercises.html">Original</a>
    <h1>Exercises for understanding Haskell Lenses (2019)</h1>
    
    <div id="readability-page-1" class="page"><article>
  
  <section>
      <span>
        <a href="https://williamyaoh.com/posts/2019-04-11-cheatsheet-to-regexes-in-haskell.html">« Previous post</a>
      <span>
     
      <span>
        <a href="https://williamyaoh.com/posts/2019-05-27-string-interpolation-and-overlapping-instances.html">Next post »</a>
      </span>
  </span></span></section>
  <section>
    <p>No matter how many blog posts and tutorials I read about lenses, it seems like there’s no replacement for just using them to get an intuition. So here are some exercises I came up with. While they shouldn’t be all that difficult, they build up from some basic knowledge about lenses up to the more advanced usages of the lens library.</p>
<p>Perhaps you’ve dabbled with lenses before, but got scared away by the complexity and size of the <code>Control.Lens</code> documentation. Maybe you can do some basic things with lenses but want to know how far you can push their capabilities. These exercises assume that you already have a vague idea of what lenses do and what they’re used for, but perhaps that you need a little bit of reinforcement to really “get” it.</p>
<p>This isn’t meant as a lens tutorial. Prerequisites are some basic knowledge of how to use Haskell, GHCI, and familiarity of the idea of lenses, if not the specifics.</p>
<p>For these exercises, you can use GHCI to check your answers. Boot up an REPL with <code>stack repl --package lens</code> and <code>import Control.Lens</code>.</p>
<h2 id="lenses">Lenses</h2>
<p>The basic operators here are <code>^.</code>, <code>.~</code>, and <code>%~</code>. If you’re not a fan of funny-looking operators, <code>Control.Lens</code> provides more helpfully-named functions called <code>view</code>, <code>set</code>, and <code>over</code> (a.k.a. mapping); these three operators are just aliases for the named functions, respectively. For these exercises, we’ll be using the operators.</p>
<p>Assume that we have the following datatypes:</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span>{-# LANGUAGE TemplateHaskell #-}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>Data.Text</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>Control.Lens</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span>data</span> <span>User</span> <span>=</span> <span>User</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  {<span> _name     ::</span> <span>Text</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  ,<span> _userid   ::</span> <span>Int</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  ,<span> _metadata ::</span> <span>UserInfo</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span>deriving</span> (<span>Show</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span>data</span> <span>UserInfo</span> <span>=</span> <span>UserInfo</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  {<span> _numLogins     ::</span> <span>Int</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  ,<span> _associatedIPs ::</span> [<span>Text</span>]</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span>deriving</span> (<span>Show</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>makeLenses &#39;<span>&#39;User</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>makeLenses &#39;<span>&#39;UserInfo</span></span></code></pre></div>
<p>If you’re not familiar with the <code>makeLenses &#39;&#39;User</code> part, we’re using Template Haskell to automatically write lenses for each of the fields in <code>User</code>. So for instance, we’d have lenses called <code>name</code>, <code>userid</code>, and <code>metadata</code> (i.e. without the leading underscore) to access the data inside a <code>User</code>.</p>
<h3 id="i.">I.</h3>
<p>Given the following data:</p>
<div id="cb2"><pre><code><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>user1 <span>=</span> <span>User</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  { _name <span>=</span> <span>&#34;qiao.yifan&#34;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  , _userid <span>=</span> <span>103</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  , _metadata <span>=</span> <span>UserInfo</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    { _numLogins <span>=</span> <span>20</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    , _associatedIPs <span>=</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      [ <span>&#34;52.39.193.61&#34;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      , <span>&#34;52.39.193.75&#34;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>What do the following expressions return?</p>
<ol type="1">
<li></li>
<li><div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>^.</span> metadata<span>.</span>numLogins</span></code></pre></div></li>
<li><div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> metadata<span>.</span>numLogins <span>.~</span> <span>0</span></span></code></pre></div></li>
<li><div id="cb6"><pre><code><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> metadata<span>.</span>associatedIPs <span>%~</span> (<span>&#34;192.168.0.2&#34;</span> <span>:</span>)</span></code></pre></div></li>
<li><div id="cb7"><pre><code><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>   metadata<span>.</span>numLogins <span>%~</span> (<span>+</span> <span>1</span>) <span>$</span> user1</span></code></pre></div></li>
</ol>
<h3 id="ii.">II.</h3>
<p>Look at the following expressions. Given the same data, which expressions will compile and run successfully? For the ones that don’t, can you fix them so that they do work?</p>
<ol type="1">
<li><div id="cb8"><pre><code><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> email <span>.~</span> <span>&#34;qyifan@xingxin.com&#34;</span></span></code></pre></div></li>
<li><div id="cb9"><pre><code><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> metadata <span>.~</span> (<span>UserInfo</span> <span>17</span> [])</span></code></pre></div></li>
<li></li>
<li><div id="cb11"><pre><code><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>   metadata<span>.</span>associatedIPs <span>.~</span> [ <span>&#34;50.193.0.23&#34;</span> ] <span>&amp;</span> user1</span></code></pre></div></li>
<li><div id="cb12"><pre><code><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>^.</span> numLogins<span>.</span>metadata</span></code></pre></div></li>
</ol>
<h3 id="iii.">III.</h3>
<p>Given the same data, write an expression using the lens operators to produce the specified effect.</p>
<ol type="1">
<li>Get the associated IP addresses.</li>
<li>Update the user so that the associated IP addresses are in reverse order.</li>
<li>Update the user so that each word in the name is capitalized.</li>
<li>Set the number of logins to 1.</li>
<li>Remove all associated IP addresses except the first.</li>
</ol>
<h3 id="iv.">IV.</h3>
<p>The basic <code>Lens</code> type is defined like so:</p>
<div id="cb13"><pre><code><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span>type</span> <span>Lens</span> s t a b <span>=</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span>forall</span> f<span>.</span> <span>Functor</span> f <span>=&gt;</span> (a <span>-&gt;</span> f b) <span>-&gt;</span> s <span>-&gt;</span> f t</span></code></pre></div>
<p>This looks slightly weird, but the idea is that whichever operator we use can select a particular Functor <code>f</code> to get different behavior out of the lens itself. So for instance, the setting operator <code>(.~)</code> takes in a lens with a (simplified) type of:</p>
<div id="cb14"><pre><code><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(a <span>-&gt;</span> <span>Identity</span> b) <span>-&gt;</span> s <span>-&gt;</span> <span>Identity</span> t</span></code></pre></div>
<p>Knowing this,</p>
<ol type="1">
<li><p>Implement the simplified version of <code>(.~)</code> below.</p>
<div id="cb15"><pre><code><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span>infixr</span> <span>4</span> <span>.~</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span>(.~) ::</span> ((a <span>-&gt;</span> <span>Identity</span> b) <span>-&gt;</span> s <span>-&gt;</span> <span>Identity</span> t)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> b</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> s</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> t</span></code></pre></div>
<p>If you haven’t seen Identity before, <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Identity.html#t:Identity">here’s the Haddock documentation.</a></p>
<p>You should be able to use your own implementation in place of <code>(.~)</code> and get the same results as some of the exercises above.</p></li>
<li><p>Implement the simplified version of <code>(%~)</code> below.</p>
<div id="cb16"><pre><code><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span>infixr</span> <span>4</span> <span>%~</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span>(%~) ::</span> ((a <span>-&gt;</span> <span>Identity</span> b) <span>-&gt;</span> s <span>-&gt;</span> <span>Identity</span> t)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> (a <span>-&gt;</span> b)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> s</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> t</span></code></pre></div>
<p>Again, you should be able to use your own implementation as a drop-in replacement for <code>(%~)</code>.</p></li>
<li><p>Instead of Identity, the getting operator <code>(^.)</code> uses Const, taking lenses like this:</p>
<div id="cb17"><pre><code><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(a <span>-&gt;</span> <span>Const</span> a b) <span>-&gt;</span> s <span>-&gt;</span> <span>Const</span> a t</span></code></pre></div>
<p>If you haven’t seen Const before, <a href="http://hackage.haskell.org/package/base-4.12.0.0/docs/Data-Functor-Const.html#t:Const">here’s the Haddock documentation.</a></p>
<p>Implement the simplified version of <code>(^.)</code> below.</p>
<div id="cb18"><pre><code><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span>infixl</span> <span>8</span> <span>^.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span>(^.) ::</span> s</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> ((a <span>-&gt;</span> <span>Const</span> a b) <span>-&gt;</span> s <span>-&gt;</span> <span>Const</span> a t)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> a</span></code></pre></div>
<p>Once you have an implementation, you know the drill.</p></li>
<li><p>Implement the <code>name</code> lens for <code>User</code>. That is, implement the following function:</p>
<div id="cb19"><pre><code><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span>name&#39; ::</span> <span>Functor</span> f <span>=&gt;</span> (<span>Text</span> <span>-&gt;</span> f <span>Text</span>) <span>-&gt;</span> <span>User</span> <span>-&gt;</span> f <span>User</span></span></code></pre></div>
<p>Now try using it with the lens operators.</p></li>
<li><p>Look at the type of a Lens again. Why do lenses compose left-to-right, instead of right-to-left, the way “normal” functions in Haskell do?</p></li>
</ol>
<h2 id="prisms">Prisms</h2>
<p>Whereas you use <code>Lens</code>es to access data that is always going to be there, <code>Prism</code>s are used to access data that may or may not be there. The basic operator to get data here is <code>(^?)</code>, instead of <code>(^.)</code>. The setting operators are unchanged; if the data isn’t there, the containing structure is just returned unchanged. (You can use <code>(^.)</code> with Prisms, but it requires a Monoid instance for the returned type; if the data isn’t there, <code>(^.)</code> will just return <code>mempty</code>. Personally I think this behavior is confusing and try to avoid it. But it’s important to know about.)</p>
<p>We’ll use JSON data to look at Prisms, along with the JSON lenses from <a href="http://hackage.haskell.org/package/lens-aeson-1.0.2/docs/Data-Aeson-Lens.html"><code>lens-aeson</code></a>.</p>
<p>The most important Prism here is <code>key</code>, which lets us access a property on JSON object, which may or may not exist.</p>
<div id="cb20"><pre><code><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span>-- stack repl --package lens --package aeson \</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span>--   --package lens-aeson --package aeson-qq</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>user1 <span>=</span> [aesonQQ|</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    &#34;name&#34;: &#34;qiao.yifan&#34;,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    &#34;email&#34;: &#34;qyifan@xingxin.com&#34;</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>|]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>user2 <span>=</span> [aesonQQ|</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    &#34;name&#34;: &#34;ye.xiu&#34;,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    &#34;metadata&#34;: {</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>      &#34;num_logins&#34;: 27</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>|]</span></code></pre></div>
<h3 id="i.-1">I.</h3>
<p>Given the above data, what do the following expressions return? For example, if we have the expression</p>
<div id="cb21"><pre><code><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>user1 <span>^?</span> key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;num_logins&#34;</span><span>.</span>_Integer</span></code></pre></div>
<p>it will return <code>Nothing</code>. Using the same Prism on <code>user2</code> will return <code>Just 27</code>.</p>
<ol type="1">
<li><div id="cb22"><pre><code><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>^?</span> key <span>&#34;email&#34;</span><span>.</span>_String</span></code></pre></div></li>
<li><div id="cb23"><pre><code><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>^?</span> key <span>&#34;email&#34;</span><span>.</span>_String</span></code></pre></div></li>
<li><div id="cb24"><pre><code><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>^.</span> key <span>&#34;email&#34;</span><span>.</span>_String</span></code></pre></div>
<p>Remember, Prisms can be used with <code>(^.)</code>, it just requires a Monoid.</p></li>
<li><div id="cb25"><pre><code><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>^?</span> key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;associated_ips&#34;</span><span>.</span>_Array</span></code></pre></div></li>
<li><div id="cb26"><pre><code><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>^.</span> key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;associated_ips&#34;</span><span>.</span>_Array</span></code></pre></div></li>
<li><p>Pure functions can be lifted into Getters using <code>to</code>.</p>
<div id="cb27"><pre><code><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>qualified</span> <span>Data.Text</span> <span>as</span> <span>Text</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>user1 <span>^?</span> key <span>&#34;name&#34;</span><span>.</span>_String<span>.</span>to Text.toUpper</span></code></pre></div></li>
<li><div id="cb28"><pre><code><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> key <span>&#34;name&#34;</span><span>.</span>_String <span>.~</span> <span>&#34;su.mucheng&#34;</span></span></code></pre></div></li>
<li><div id="cb29"><pre><code><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>&amp;</span> key <span>&#34;email&#34;</span><span>.</span>_String <span>.~</span> <span>&#34;yxiu@xingxin.com&#34;</span></span></code></pre></div></li>
<li><div id="cb30"><pre><code><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>&amp;</span> key <span>&#34;name&#34;</span><span>.</span>_String <span>%~</span> Text.reverse</span></code></pre></div></li>
</ol>
<h3 id="ii.-1">II.</h3>
<p>Look at the following expressions. Given the same data, which expressions will compile and run successfully? For the ones that don’t, can you fix them so that they do work?</p>
<ol type="1">
<li><div id="cb31"><pre><code><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>^.</span> key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;num_logins&#34;</span><span>.</span>_Integer</span></code></pre></div></li>
<li><div id="cb32"><pre><code><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;num_logins&#34;</span><span>.</span>_Integer <span>.~</span> <span>25</span></span></code></pre></div></li>
<li><div id="cb33"><pre><code><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>&amp;</span> key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;num_logins&#34;</span> <span>%~</span> (<span>+</span> <span>1</span>)</span></code></pre></div></li>
<li></li>
<li><div id="cb35"><pre><code><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>   user2 <span>&amp;</span> key <span>&#34;name&#34;</span><span>.</span>_String <span>.~</span> <span>50</span></span></code></pre></div></li>
</ol>
<h3 id="iii.-1">III.</h3>
<p>The signature of a <code>Prism</code> is very similar to the signature for a <code>Lens</code>, but with an Applicative constraint instead of a Functor constraint. Here’s a simplified version of the Prism type alongside Lens:</p>
<div id="cb36"><pre><code><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span>type</span> <span>Prism</span> s t a b <span>=</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span>forall</span> f<span>.</span> <span>Applicative</span> f <span>=&gt;</span> (a <span>-&gt;</span> f b) <span>-&gt;</span> s <span>-&gt;</span> f t</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span>type</span> <span>Lens</span> s t a b <span>=</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span>forall</span> f<span>.</span> <span>Functor</span> f <span>=&gt;</span> (a <span>-&gt;</span> f b) <span>-&gt;</span> s <span>-&gt;</span> f t</span></code></pre></div>
<ol type="1">
<li><p>Implement the simplified version of <code>(^?)</code> below.</p>
<div id="cb37"><pre><code><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span>infixl</span> <span>8</span> <span>^?</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span>(^?) ::</span> s</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> ((a <span>-&gt;</span> <span>Const</span> (<span>First</span> a) b) <span>-&gt;</span> s <span>-&gt;</span> <span>Const</span> (<span>First</span> a) t)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>     <span>-&gt;</span> <span>Maybe</span> a</span></code></pre></div>
<p>Once you have an implementation, you know the drill.</p></li>
<li><p>Control.Lens provides a prism called <code>_Just</code> for accessing a <code>Maybe</code>. Implement the simplified version of <code>_Just</code> below:</p>
<div id="cb38"><pre><code><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span>_Just ::</span> <span>Applicative</span> f <span>=&gt;</span> (a <span>-&gt;</span> f b) <span>-&gt;</span> <span>Maybe</span> a <span>-&gt;</span> f (<span>Maybe</span> b)</span></code></pre></div>
<p>Now try it with the prism operator.</p>
<p>(Hint: take a look at <code>traverse</code>.)</p></li>
<li><p>Do your implementations of <code>(.~)</code> and <code>(%~)</code> from the Lenses section work on Prisms as well?</p></li>
</ol>
<h2 id="folds-and-traversals">Folds and traversals</h2>
<p>While Lenses and Prisms already give us a lot of convenience in working with data, the <code>lens</code> package actually gives us some more general tools in the form of Folds and Traversals. Where Lenses/Prisms are “pointers” to a single location in the data, Folds and Traversals instead point to <em>many</em> locations. In other words, you can use them to get a <em>list</em> of data.</p>
<p>This also means that any Lens or Prism is also a valid Fold or Traversal, since lists of zero or just one element(s) are just as valid as those with many.</p>
<p>While Folds are basically read-only and don’t allow you to modify the passed-in data the way Lenses and Prisms do, Traversals allow you to modify all the pointed-to locations at once. Since these optics correspond to the capabilities of the Foldable and Traversable typeclasses, using these optics also allows you to, say, <code>foldl</code>, <code>foldr</code>, or <code>foldMap</code> over every element pointed to by a Fold, or <code>traverse</code>/<code>sequenceA</code> over all the elements pointed to by a Traversal.</p>
<p>The basic getting operator here is <code>(^..)</code>, which gives back a list of all the pointed-to elements. Again, this is just an alias for <code>toListOf</code>, if you’re not a fan of funky operators. The setting operators still work as usual on Traversals.</p>
<p>For folding, <code>lens</code> provides <code>foldlOf</code>, <code>foldrOf</code>, and <code>foldMapOf</code>, which behave analogously to their counterparts in <code>Data.Foldable</code>, but which use all the pointed-to elements rather than an explicit sequence. Since every Traversal is a Fold, you can use these basic functions on both. If you <em>do</em> have a Traversal, you then get access to some more basic functions, <code>traverseOf</code> and <code>sequenceAOf</code>, which again behave analogously to their counterparts in <code>Data.Traversable</code>.</p>
<p>If you have an optic that points to a Foldable/Traversable, you can compose them with <code>folded</code>/<code>traversed</code> optics to fold/traverse over each element.</p>
<p>We’ll continue using JSON data for this part.</p>
<p>Assume that we have the following data:</p>
<div id="cb39"><pre><code><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>users <span>=</span> [aesonQQ|</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    &#34;users&#34;: [</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        &#34;name&#34;: &#34;qiao.yifan&#34;,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        &#34;email&#34;: &#34;qyifan@xingxin.com&#34;,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        &#34;metadata&#34;: {</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>          &#34;num_logins&#34;: 5</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        &#34;name&#34;: &#34;ye.xiu&#34;,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        &#34;metadata&#34;: {</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>          &#34;num_logins&#34;: 27,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>          &#34;associated_ips&#34;: [</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>            &#34;52.49.1.233&#34;,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>            &#34;52.49.1.234&#34;</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        &#34;name&#34;: &#34;su.mucheng&#34;,</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>        &#34;email&#34;: &#34;smucheng@xingxin.com&#34;,</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>        &#34;metadata&#34;: {</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>          &#34;associated_ips&#34;: [</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>            &#34;51.2.244.193&#34;</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>|]</span></code></pre></div>
<h3 id="i.-2">I.</h3>
<p>What do the following expressions return? For example,</p>
<div id="cb40"><pre><code><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>users <span>^..</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String</span></code></pre></div>
<p>would return <code>[&#34;qiao.yifan&#34;, &#34;ye.xiu&#34;, &#34;su.mucheng&#34;]</code>.</p>
<ol type="1">
<li><div id="cb41"><pre><code><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>   users <span>^..</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;email&#34;</span><span>.</span>_String</span></code></pre></div></li>
<li><div id="cb42"><pre><code><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>   users <span>^..</span> key <span>&#34;users&#34;</span><span>.</span>_Array<span>.</span>traversed<span>.</span>key <span>&#34;email&#34;</span><span>.</span>_String</span></code></pre></div></li>
<li><div id="cb43"><pre><code><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>   users <span>^..</span> key <span>&#34;users&#34;</span><span>.</span>_Array<span>.</span>folded<span>.</span>key <span>&#34;email&#34;</span><span>.</span>_String</span></code></pre></div></li>
<li><p>Pay attention to the operator.</p>
<div id="cb44"><pre><code><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>users <span>^.</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String</span></code></pre></div></li>
<li><div id="cb45"><pre><code><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>qualified</span> <span>Data.Text</span> <span>as</span> <span>Text</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String <span>%~</span> Text.toUpper</span></code></pre></div></li>
<li><div id="cb46"><pre><code><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>   users</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>   <span>^..</span>key <span>&#34;users&#34;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>     <span>.</span>values</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>     <span>.</span>key <span>&#34;metadata&#34;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>     <span>.</span>key <span>&#34;associated_ips&#34;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>     <span>.</span>_Array</span></code></pre></div></li>
<li><div id="cb47"><pre><code><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>   users</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span>^..</span>key <span>&#34;users&#34;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>     <span>.</span>values</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>     <span>.</span>key <span>&#34;metadata&#34;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>     <span>.</span>key <span>&#34;associated_ips&#34;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>     <span>.</span>values</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>     <span>.</span>_String</span></code></pre></div></li>
<li><div id="cb48"><pre><code><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>     foldlOf</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>       (key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;num_logins&#34;</span><span>.</span>_Integer)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>       (<span>+</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>       <span>0</span></span></code></pre></div></li>
<li><div id="cb49"><pre><code><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>Data.Monoid</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>qualified</span> <span>Data.Text</span> <span>as</span> <span>Text</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>users <span>&amp;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  foldMapOf</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    (key <span>&#34;users&#34;</span><span>.</span>_Array<span>.</span>folded<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    (\x <span>-&gt;</span> <span>Any</span> <span>$</span> Text.length x <span>&lt;=</span> <span>8</span>)</span></code></pre></div></li>
</ol>
<h3 id="ii.-2">II.</h3>
<p>What do the following expressions return, and what side effects do they have, if any?</p>
<p>For example,</p>
<div id="cb50"><pre><code><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>Data.Text</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>users <span>&amp;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  traverseOf</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    (key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    (\x <span>-&gt;</span> <span>print</span> x <span>*&gt;</span> <span>fmap</span> <span>pack</span> <span>getLine</span>)</span></code></pre></div>
<p>would, for each username, print it out and prompt you for a replacement name, then return an <code>IO</code> containing the JSON with the updated names.</p>
<ol type="1">
<li><div id="cb51"><pre><code><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>Data.IORef</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span>do</span> ref <span>&lt;-</span> newIORef <span>0</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>     traverseOf</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>       (key <span>&#34;users&#34;</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>         <span>.</span>_Array</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>         <span>.</span>traversed</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>         <span>.</span>key <span>&#34;metadata&#34;</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>         <span>.</span>key <span>&#34;num_logins&#34;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>         <span>.</span>_Integer)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>       (\x <span>-&gt;</span> modifyIORef&#39; ref (<span>+</span>x) <span>*&gt;</span> readIORef ref)</span></code></pre></div></li>
<li><div id="cb52"><pre><code><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>qualified</span> <span>Data.Text</span> <span>as</span> <span>Text</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>qualified</span> <span>Data.Text.IO</span> <span>as</span> <span>Text</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>users <span>&amp;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  traverseOf</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    (key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;email&#34;</span><span>.</span>_String)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    (\x <span>-&gt;</span> Text.putStrLn x <span>*&gt;</span> <span>pure</span> (Text.reverse x))</span></code></pre></div></li>
<li><p>Assume that we have the following function:</p>
<div id="cb53"><pre><code><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span>getAliasMay ::</span> <span>Text</span> <span>-&gt;</span> <span>Maybe</span> <span>Text</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>getAliasMay <span>&#34;ye.xiu&#34;</span> <span>=</span> <span>Just</span> <span>&#34;ye.qiu&#34;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>getAliasMay _        <span>=</span> <span>Nothing</span></span></code></pre></div>
<p>What does the following expression return?</p>
<div id="cb54"><pre><code><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>users <span>&amp;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  traverseOf</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    (key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    getAliasMay</span></code></pre></div></li>
<li><p>What if we redefine <code>getAliasMay</code> this way?</p>
<div id="cb55"><pre><code><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span>getAliasMay ::</span> <span>Text</span> <span>-&gt;</span> <span>Maybe</span> <span>Text</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>getAliasMay <span>&#34;ye.xiu&#34;</span> <span>=</span> <span>Just</span> <span>&#34;ye.qiu&#34;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>getAliasMay x        <span>=</span> <span>Just</span> x</span></code></pre></div></li>
</ol>
<h3 id="iii.-2">III.</h3>
<p>Using folds/traversals, write an expression to do the following.</p>
<ol type="1">
<li>Get all usernames with a ‘u’ in them.</li>
<li>Figure out whether any users have the IP 51.2.244.193.</li>
<li>Print out all the associated IP addresses. (You might want to use <code>traverseOf_</code> instead of <code>traverseOf</code>.)</li>
<li>Reimplement exercise I.8 (summing up the total logins), but using <code>foldMap</code>.</li>
<li>Prompt the user for a prefix, and prepend said prefix to every username.</li>
</ol>
<h3 id="iv.-1">IV.</h3>
<p>Look at the following expressions. Given the same data, which expressions will compile and run successfully? For the ones that don’t, can you fix them so that they do work?</p>
<ol type="1">
<li><div id="cb56"><pre><code><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>_Array<span>.</span>folded<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String <span>.~</span> <span>&#34;&lt;unknown&gt;&#34;</span></span></code></pre></div></li>
<li><div id="cb57"><pre><code><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>_Array<span>.</span>traversed<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String <span>.~</span> <span>&#34;&lt;unknown&gt;&#34;</span></span></code></pre></div></li>
<li><div id="cb58"><pre><code><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;email&#34;</span> <span>%~</span> (<span>&lt;&gt;</span> <span>&#34;.cn&#34;</span>)</span></code></pre></div></li>
<li><div id="cb59"><pre><code><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>Data.Monoid</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>users <span>&amp;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  foldMapOf</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    (key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;num_logins&#34;</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    (\x <span>-&gt;</span> <span>All</span> <span>$</span> x <span>&gt;</span> <span>1</span>)</span></code></pre></div></li>
<li><div id="cb60"><pre><code><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>   users <span>^..</span> key <span>&#34;users&#34;</span><span>.</span>traversed<span>.</span>key <span>&#34;metadata&#34;</span></span></code></pre></div></li>
</ol>
<h3 id="v.">V.</h3>
<p>If you’ve gotten this far, congratulations! You already know far more about using lenses than most. It’s time once again to implement some of the basic functions to understand them. And again, once you have a working implementation, you know the drill: try using them in place of the ones from <code>Control.Lens</code>.</p>
<ol type="1">
<li><p>Implement the simplified version of <code>(^..)</code> below:</p>
<div id="cb61"><pre><code><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span>infixl</span> <span>8</span> <span>^..</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span>(^..) ::</span> s</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>      <span>-&gt;</span> ((a <span>-&gt;</span> <span>Const</span> (<span>Endo</span> [a]) b) <span>-&gt;</span> s <span>-&gt;</span> <span>Const</span> (<span>Endo</span> [a]) t)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>      <span>-&gt;</span> [a]</span></code></pre></div>
<p>If you haven’t seen <code>Endo</code> before, <a href="http://hackage.haskell.org/package/base-4.8.2.0/docs/Data-Monoid.html#t:Endo">here the Haddock documentation.</a> Basically, it’s a monoid on functions using function composition as the binary operator.</p></li>
<li><p>Implement the simplified version of <code>sequenceAOf</code> below:</p>
<div id="cb62"><pre><code><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span>sequenceAOf ::</span> ((f b <span>-&gt;</span> f b) <span>-&gt;</span> s <span>-&gt;</span> f t) <span>-&gt;</span> s <span>-&gt;</span> f t</span></code></pre></div></li>
<li><p>Implement the simplified version of <code>traverseOf</code> below:</p>
<div id="cb63"><pre><code><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span>traverseOf ::</span> ((a <span>-&gt;</span> f b) <span>-&gt;</span> s <span>-&gt;</span> f t) <span>-&gt;</span> (a <span>-&gt;</span> f b) <span>-&gt;</span> s <span>-&gt;</span> f t</span></code></pre></div></li>
<li><p>Implement a function that composes with a lens that returns a list, and produces a traversal over the elements of the list. That is, implement this type signature:</p>
<div id="cb64"><pre><code><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span>traversed ::</span> <span>Applicative</span> f <span>=&gt;</span> (a <span>-&gt;</span> f b) <span>-&gt;</span> [a] <span>-&gt;</span> f [b]</span></code></pre></div>
<p>Does this function look familiar?</p></li>
<li><p>Do your implementations of <code>(.~)</code> and <code>(%~)</code> from the Lenses section still work on Traversals? What about <code>(^?)</code>?</p></li>
</ol>
<h2 id="fancier-operators">Fancier operators</h2>
<p>One last trick that <code>lens</code> has up its sleeve is the “fancy setting” operators. Analogous to the <code>+=</code> operator in imperative languages, <code>lens</code> has <code>+~</code>:</p>
<div id="cb65"><pre><code><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>λ<span>&gt;</span> <span>Just</span> <span>4</span> <span>&amp;</span> _Just <span>+~</span> <span>20</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span>&gt;&gt;&gt;</span> <span>Just</span> <span>24</span></span></code></pre></div>
<p>As you’d expect, there are similar operators for other common updates:</p>
<ul>
<li><p><code>+~</code></p></li>
<li><p><code>-~</code></p></li>
<li><p><code>*~</code></p></li>
<li><p><code>//~</code> — division; not <code>/~</code>, unfortunately</p></li>
<li><p><code>^~</code>, <code>^^~</code>, <code>**~</code> — different forms of exponentiation, equivalent to <code>^</code>, <code>^^</code>, and <code>**</code></p></li>
<li><p><code>&amp;&amp;~</code>, <code>||~</code></p></li>
<li><p><code>&lt;&gt;~</code> — monoidal update, i.e. <code>&lt;&gt;</code> or <code>mappend</code>. Sadly, this requires a Monoid constraint, not a Semigroup. Note that the value you provide is <code>mappend</code>ed to the <em>right</em>.</p>
<div id="cb66"><pre><code><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>λ<span>&gt;</span> greeting <span>=</span> <span>&#34;Hello&#34;</span><span> ::</span> <span>Text</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>λ<span>&gt;</span> greeting <span>&amp;</span> <span>id</span> <span>&lt;&gt;~</span> <span>&#34;!!&#34;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span>&gt;&gt;&gt;</span> <span>&#34;Hello!!&#34;</span></span></code></pre></div></li>
</ul>
<p>Note that these can be used alongside prisms and traversals as well.</p>
<div id="cb67"><pre><code><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>λ<span>&gt;</span> [<span>2.0</span>, <span>4.0</span>, <span>6.0</span>, <span>8.0</span>] <span>&amp;</span> traversed <span>//~</span> <span>2.0</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span>&gt;&gt;&gt;</span> [<span>1.0</span>, <span>2.0</span>, <span>3.0</span>, <span>4.0</span>]</span></code></pre></div>
<p>The pattern here is that the tilde signifies that this is a setting operator, while the specific operation is before the tilde. (A period is kind of a “basic” operator, as in <code>(^.)</code> and <code>(.~)</code>.)</p>
<p>There are also operators that allow you to get the “old” and “new” values after an update.</p>
<div id="cb68"><pre><code><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>λ<span>&gt;</span> (<span>20</span>, <span>&#34;hello&#34;</span>) <span>&amp;</span> _1 <span>&lt;*~</span> <span>2</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span>&gt;&gt;&gt;</span> (<span>40</span>, (<span>40</span>, <span>&#34;hello&#34;</span>))</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>λ<span>&gt;</span> (<span>20</span>, <span>&#34;hello&#34;</span>) <span>&amp;</span> _1 <span>&lt;&lt;*~</span> <span>2</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span>&gt;&gt;&gt;</span> (<span>20</span>, (<span>40</span>, <span>&#34;hello&#34;</span>))</span></code></pre></div>
<p>These are useful since you’re often working with deeply nested data with lenses.</p>
<p>Here, a single <code>&lt;</code> before the operator signifies that it returns the updated value, while a double <code>&lt;&lt;</code> signifies that it returns the old value. This gets a little weird with the monoidal operator; <code>&lt;&lt;&gt;~</code> returns the <em>updated</em> value, not the old one, since one of the angle brackets is from the <code>mappend</code>.</p>
<p>Note that the old/new value operators only work with lenses, not with prisms or traversals, since with prisms or traversals, there’s no guarantee that there is a value to return at all. (Once again, if you accidentally use these with prisms/traversals, it will use the Monoid instance, if available, to combine available values. This is probably not what you want.)</p>
<p>We’ll reuse the data from the Lenses and Folds/Traversals sections.</p>
<div id="cb69"><pre><code><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span>{-# LANGUAGE TemplateHaskell #-}</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span>import</span> <span>Data.Text</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span>data</span> <span>User</span> <span>=</span> <span>User</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  {<span> _name     ::</span> <span>Text</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  ,<span> _userid   ::</span> <span>Int</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  ,<span> _metadata ::</span> <span>UserInfo</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span>deriving</span> (<span>Show</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span>data</span> <span>UserInfo</span> <span>=</span> <span>UserInfo</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  {<span> _numLogins     ::</span> <span>Int</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  ,<span> _associatedIPs ::</span> [<span>Text</span>]</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span>deriving</span> (<span>Show</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>makeLenses &#39;<span>&#39;User</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>makeLenses &#39;<span>&#39;UserInfo</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>user1 <span>=</span> <span>User</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  { _name <span>=</span> <span>&#34;qiao.yifan&#34;</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  , _userid <span>=</span> <span>103</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>  , _metadata <span>=</span> <span>UserInfo</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    { _numLogins <span>=</span> <span>20</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    , _associatedIPs <span>=</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>      [ <span>&#34;52.39.193.61&#34;</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>      , <span>&#34;52.39.193.75&#34;</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>users <span>=</span> [aesonQQ|</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    &#34;users&#34;: [</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>        &#34;name&#34;: &#34;qiao.yifan&#34;,</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>        &#34;email&#34;: &#34;qyifan@xingxin.com&#34;,</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>        &#34;metadata&#34;: {</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>          &#34;num_logins&#34;: 5</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>        &#34;name&#34;: &#34;ye.xiu&#34;,</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>        &#34;metadata&#34;: {</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>          &#34;num_logins&#34;: 27,</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>          &#34;associated_ips&#34;: [</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>            &#34;52.49.1.233&#34;,</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>            &#34;52.49.1.234&#34;</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>        &#34;name&#34;: &#34;su.mucheng&#34;,</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>        &#34;email&#34;: &#34;smucheng@xingxin.com&#34;,</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>        &#34;metadata&#34;: {</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>          &#34;associated_ips&#34;: [</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>            &#34;51.2.244.193&#34;</span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-62"><a href="#cb69-62" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb69-63"><a href="#cb69-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-64"><a href="#cb69-64" aria-hidden="true" tabindex="-1"></a>|]</span></code></pre></div>
<h3 id="i.-3">I.</h3>
<p>Given the above data, what do the following expressions return? For example,</p>
<div id="cb70"><pre><code><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>user1 <span>&amp;</span> metadata<span>.</span>associatedIPs <span>&lt;&lt;&lt;&gt;~</span> [<span>&#34;127.0.0.1&#34;</span>]</span></code></pre></div>
<p>would return</p>
<div id="cb71"><pre><code><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>([<span>&#34;52.39.193.61&#34;</span>, <span>&#34;52.39.193.75&#34;</span>], <span>&lt;</span>updated json<span>&gt;</span>)</span></code></pre></div>
<ol type="1">
<li><div id="cb72"><pre><code><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> metadata<span>.</span>numLogins <span>+~</span> <span>1</span></span></code></pre></div></li>
<li><div id="cb73"><pre><code><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String <span>&lt;&gt;~</span> <span>&#34;.test&#34;</span></span></code></pre></div></li>
<li><div id="cb74"><pre><code><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span><span>.</span>_String <span>&lt;&lt;&gt;~</span> <span>&#34;.test&#34;</span></span></code></pre></div>
<p>Remember, the <code>&lt;</code>* and <code>&lt;&lt;</code>* operators require a Monoid constraint for prisms and traversals.</p></li>
<li></li>
</ol>
<h3 id="ii.-3">II.</h3>
<p>Look at the following expressions. Given the above data, which of the expressions compile and run successfully? For the ones that don’t, can you fix them so that they do?</p>
<ol type="1">
<li><div id="cb76"><pre><code><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;name&#34;</span> <span>&lt;&gt;~</span> <span>&#34;.dev&#34;</span></span></code></pre></div></li>
<li><div id="cb77"><pre><code><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>   user1 <span>&amp;</span> metadata<span>.</span>numLogins <span>//~</span> <span>2</span></span></code></pre></div></li>
<li><div id="cb78"><pre><code><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>   users <span>&amp;</span> key <span>&#34;users&#34;</span><span>.</span>values<span>.</span>key <span>&#34;metadata&#34;</span><span>.</span>key <span>&#34;num_logins&#34;</span> <span>+~</span> <span>1</span></span></code></pre></div></li>
<li></li>
</ol>
<h3 id="iii.-3">III.</h3>
<p>Last set of exercises. Implement:</p>
<ol type="1">
<li><div id="cb80"><pre><code><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>   <span>infixr</span> <span>4</span> <span>&lt;&lt;&gt;~</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span>   (&lt;&lt;&gt;~) ::</span> <span>Monoid</span> a</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>          <span>=&gt;</span> ((a <span>-&gt;</span> (a, a)) <span>-&gt;</span> s <span>-&gt;</span> (a, t))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>          <span>-&gt;</span> a</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>          <span>-&gt;</span> s</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>          <span>-&gt;</span> (a, t)</span></code></pre></div></li>
<li><div id="cb81"><pre><code><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>   <span>infixr</span> <span>4</span> <span>&lt;&lt;&lt;&gt;~</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span>   (&lt;&lt;&lt;&gt;~) ::</span> <span>Monoid</span> a</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>           <span>=&gt;</span> ((a <span>-&gt;</span> (a, a)) <span>-&gt;</span> s <span>-&gt;</span> (a, t))</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>           <span>-&gt;</span> a</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>           <span>-&gt;</span> s</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>           <span>-&gt;</span> (a, t)</span></code></pre></div></li>
<li>Implement a version of <code>(&lt;&lt;&gt;~)</code> that <code>mappend</code>s to the left instead of the right.</li>
</ol>
<hr/>
<p>If you’ve managed to get through all of those exercises successfully, congrats! You’ve got some serious chops. At this point, you should hopefully know enough about how lenses work to do a lot of productive stuff beyond just simple data access.</p>
<p>While this set of exercises should show you <em>how</em> to use lenses, and hopefully a little bit of <em>why</em>, frankly it’s hard to know <em>when</em> to use lenses. Specifically, when <em>not</em> to use lenses; <code>lens</code> is a very complicated library that introduces both a lot of dependencies and a lot of cognitive overhead. It doesn’t help that the type errors are pretty awful if you get your lenses wrong. Adding <code>lens</code> to every single project is probably not a good default; ask yourself whether you <em>really</em> need it before adding it in.</p>
<p>If you’re looking for a smaller lens package without the massive dependency tree, take a look at <a href="http://hackage.haskell.org/package/microlens"><code>microlens</code></a>; it still provides the lens operators up to folds/traversals and some of the <code>&lt;</code>/<code>&lt;&lt;</code> variants, but without requiring you to compile a hundred Hackage packages.</p>
<p>What are you using lenses for? Did lenses allow you easily solve a thorny problem in your project? <a href="https://williamyaoh.com/contact.html">Talk to me!</a></p>
<hr/>
<h3 id="you-might-also-like">You might also like</h3>
<ul>
<li><a href="https://williamyaoh.com/posts/2019-04-11-cheatsheet-to-regexes-in-haskell.html">A cheatsheet to regexes in Haskell</a></li>
<li><a href="https://williamyaoh.com/posts/2019-09-16-time-cheatsheet.html">A cheatsheet to the time library</a></li>
</ul>
  </section>
  <section>
      <span>
        <a href="https://williamyaoh.com/posts/2019-04-11-cheatsheet-to-regexes-in-haskell.html">« Previous post</a>
      <span>
     
      <span>
        <a href="https://williamyaoh.com/posts/2019-05-27-string-interpolation-and-overlapping-instances.html">Next post »</a>
      </span>
  </span></span></section>
    <hr/>
    <section id="email-signup">
  <h3 id="email-signup-title">
    Before you close that tab...
  </h3>

  <p>
    Want to write practical, production-ready Haskell? Tired of broken
    libraries, barebones documentation, and endless type-theory papers only a
    postdoc could understand? I want to help. Subscribe below and you&#39;ll get
    useful techniques for writing real, useful programs straight in your
    inbox.
  </p>

  

  <p>
    Absolutely no spam, ever. I respect your email privacy. Unsubscribe anytime.
  </p>
</section>

</article></div>
  </body>
</html>
