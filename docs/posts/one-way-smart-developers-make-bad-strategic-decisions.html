<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://earthly.dev/blog/see-state/">Original</a>
    <h1>One Way Smart Developers Make Bad Strategic Decisions</h1>
    
    <div id="readability-page-1" class="page"><section itemprop="text">
        
        <header>
          
          

  <p>
    

    

    
      
      

      <span>
        <i aria-hidden="true"></i>
        
          9 minute read
        
        
         	 <i aria-hidden="true"></i> Updated: <time datetime="2022-03-08T00:00:00-05:00">March 8, 2022</time>
        

      </span>
    
    <span>
      
      
      
      </span></p><div>
          <picture data-ll-status="entered"><source data-srcset="/blog/generated/assets/images/authors/adamgordonbell-240-fc29677ee.webp 240w" type="image/webp" srcset="/blog/generated/assets/images/authors/adamgordonbell-240-fc29677ee.webp 240w"/><source data-srcset="/blog/generated/assets/images/authors/adamgordonbell-240-ad4309f1a.png 240w" type="image/png" srcset="/blog/generated/assets/images/authors/adamgordonbell-240-ad4309f1a.png 240w"/><img data-src="/blog/generated/assets/images/authors/adamgordonbell-240-ad4309f1a.png" alt="Adam Gordon Bell %" data-ll-status="loaded" src="https://www.recurse.com/blog/generated/assets/images/authors/adamgordonbell-240-ad4309f1a.png"/></picture><p>

           	 
          Adam Gordon Bell
      </p></div>
      
    
  


        </header>
      
        
           
        
        <p>Sometimes smart people working hard make things worse. The following story is based my recollection of some real events:</p>
<h2 id="scheduling-work-problems">Scheduling Work Problems<a href="#scheduling-work-problems" title=""><span></span><i></i></a></h2>
<p>A small team of developers at a mid-sized SaaS company has a problem. They own several services that do some data loading and transforming. And the services are under increased load because a new customer (Customer-A) is generating many times the amount of data that most customers do.</p>
<p>They manage to get that under control, but a second problem occurs. They’ve increased the data processing through-put, but it turns out they’ve hurt its fairness. As a result, some other customers are often waiting or getting stale results. Customer-A is clogging up the work queue and starving other customers out. The problem is like an operating system scheduling problem but in a micro-services, distributed system context.</p>
<p><picture><source srcset="/blog/generated/assets/images/see-state/3530-500-9bbe6ce89.webp 500w" type="image/webp"/><source srcset="/blog/generated/assets/images/see-state/3530-500-03ae560d6.png 500w" type="image/png"/><img width="200px" src="https://www.recurse.com/blog/generated/assets/images/see-state/3530-800-03ae560d6.png"/></picture></p>
<p>And this is causing the worst kind of problems: people problems – the kind of problem where an executive who didn’t know that a service existed is now requesting daily updates on it.</p>
<p>It turns out this service is using a Postgres table and Kafka topics for scheduling. And there are lots of variables to tweak to get the right combination of through-put and fairness. Scheduling is hard. So calls go out: who can help with this system? Other developers in the company who do similar work aren’t familiar with Kafka. It’s best to let the people who know the system work to improve it.</p>
<p>So the team finds a compromise between fairness and through-put - but to prevent further incidents, Tim gets asked to investigate how queuing and work-in-progress are handled among the company’s hundred-plus services.</p>
<!-- vale HouseStyle.Repetition = NO -->
<p>Tim is a very senior technical lead, and he’s good at his job. The problem put to him is: how do we make sure this doesn’t happen again? We are expecting N more customers the size of Customer-A, and we can’t afford to learn this lesson one incident at a time, as one service after another learns to keep up with increased work. If we do that, we’ll lose high profile customers, and something something shareholder value. We need a better solution than that. <!-- vale HouseStyle.Repetition = YES --></p>
<p>So Tim studies all the existing services and starts mapping things out. It turns out that, across all the services, queuing, and work in progress are handled in every possible way. It’s hard for him to get a truly global view of everything, but it looks like most services are using SQS, database tables, or Kafka.</p>

<h2 id="a-solution">A Solution<a href="#a-solution" title=""><span></span><i></i></a></h2>
<p>So Tim proposes a solution. They would create a shared library, which you can use for all your queuing and message processing needs. It will be backed by Kafka, and everybody will move to it.</p>
<p><picture><source srcset="/blog/generated/assets/images/see-state/4070-1000-3e2c0c4c5.webp 1000w, /blog/generated/assets/images/see-state/4070-1200-3e2c0c4c5.webp 1200w, /blog/generated/assets/images/see-state/4070-1400-3e2c0c4c5.webp 1400w" type="image/webp"/><source srcset="/blog/generated/assets/images/see-state/4070-1000-3e2c0c4c5.png 1000w, /blog/generated/assets/images/see-state/4070-1200-3e2c0c4c5.png 1200w, /blog/generated/assets/images/see-state/4070-1400-3e2c0c4c5.png 1400w" type="image/png"/><img src="https://www.recurse.com/blog/generated/assets/images/see-state/4070-800-3e2c0c4c5.png"/></picture></p>
<figcaption>
It would be simpler if everything were standardized, Right?
</figcaption>
<p>The beauty of this solution is that everything will work the same. If one team working on one service solves some work-starving problem, others can use the solution, because it’s a shared lib. And if things go wrong in one area, people from other teams can lend a hand, because its all the same solution everywhere.</p>
<p>Well it didn’t work out like that at all.</p>
<h2 id="how-things-failed">How Things Failed<a href="#how-things-failed" title=""><span></span><i></i></a></h2>
<p>In the old world, every service that processed data was doing things slightly differently, which made the system as a whole hard to understand from a top-down perspective. Tim had a hard time wrapping his head around how everything worked, and also some of these various subsystems had problems that would only get worse at scale.</p>
<p>The hypothesis was that by standardizing things many of these little unrelated problems, including the initial fairness problem, could be solved all at once. But, that hypothesis turned out to be wrong. Standardizing was a considerable effort that solved some problems but overall it made things work less well. And it turns out that there is a great book written all about this type of error.</p>
<section id="side-note-kafka">
<h3>Side Note: Kafka</h3>
<p>I think picking Kafka was a tactical error here because it’s a bad fit for being a work queue, and Kafka has a big learning curve. But there were uninteresting, extenuating circumstances that made it seem like a good fit.</p>
<p>The more significant issue that I’d like to explore, though, is the problem with pursuing standardization as its own end.</p>
</section>
<h2 id="seeing-like-a-state">Seeing Like a State<a href="#seeing-like-a-state" title=""><span></span><i></i></a></h2>
<p><picture><source srcset="/blog/generated/assets/images/see-state/6860-500-4abf80ccc.webp 500w" type="image/webp"/><source srcset="/blog/generated/assets/images/see-state/6860-500-7236b896f.png 500w" type="image/png"/><img width="200px" src="https://www.recurse.com/blog/generated/assets/images/see-state/6860-800-7236b896f.png"/></picture></p>
<p><em>Seeing Like A State - How certain schemes to improve the human condition have failed</em> is about one thing: how centrally planned, top-down strategies to improve the world have failed. It covers a lot of centralized standardization efforts, and they all have a lot in common and sound a lot like this ‘unify the queues’ effort.</p>
<p>My favorite example is about trees.</p>
<h3 id="scientific-forestry">Scientific Forestry<a href="#scientific-forestry" title=""><span></span><i></i></a></h3>
<p>In the 1800s, in Europe, forests were important essential of revenue. A tree could be timber, and a tree could be firewood, and each acre of forest a country owned was valuable. But how valuable?</p>
<p>The problem with forests is that they contain random trees in a random pattern. It’s illegible. You can’t understand at high level what trees you have. You could make a map of it, but it would be hard, and the map would be very complex.</p>
<div>
<p><picture><source srcset="/blog/generated/assets/images/see-state/3260-500-f5005bf23.webp 500w" type="image/webp"/><source srcset="/blog/generated/assets/images/see-state/3260-500-d7f043900.png 500w" type="image/png"/><img width="300px" src="https://www.recurse.com/blog/generated/assets/images/see-state/3260-800-d7f043900.png"/></picture></p>
<figcaption>
Reality is a mess
</figcaption>
</div>
<p>There are many different types of trees, which all might be useful for different things. Reality, it turns out, is a mess.</p>
<p>So the solution was scientific forestry. Let’s make a map of a simplified forest, where it just has the best type of tree spaced out the ideal amount, and we’ll make the whole forest fit that.</p>
<p>(It turns out, by the way, the “best” tree was a Norway spruce. It grows fast and looks like a Christmas tree.)</p>
<p>This went poorly:</p>
<blockquote>
<p>The impoverished ecosystem couldn’t support the game animals and medicinal herbs that sustained the surrounding peasant villages, and they suffered an economic collapse. The endless rows of identical trees were a perfect breeding ground for plant diseases and forest fires. And the complex ecological processes that sustained the soil stopped working, so after a generation the Norway spruces grew stunted and malnourished. <a href="#fn1" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</blockquote>
<div>
<p><picture><source srcset="/blog/generated/assets/images/see-state/3760-1000-cd25273c9.webp 1000w, /blog/generated/assets/images/see-state/3760-1200-cd25273c9.webp 1200w, /blog/generated/assets/images/see-state/3760-1400-cd25273c9.webp 1400w" type="image/webp"/><source srcset="/blog/generated/assets/images/see-state/3760-1000-cd25273c9.png 1000w, /blog/generated/assets/images/see-state/3760-1200-cd25273c9.png 1200w, /blog/generated/assets/images/see-state/3760-1400-cd25273c9.png 1400w" type="image/png"/><img width="300px" src="https://www.recurse.com/blog/generated/assets/images/see-state/3760-800-cd25273c9.png"/></picture></p>
<figcaption>
A Tree Plantation
</figcaption>
</div>
<p>And you would think that would end things, but managed tree plantations are still popular. And central planning things in a way that looks very uniform on a diagram but doesn’t work well in practice continues today.</p>
<p>James C. Scott calls these top-down solutions legible systems. They are simple to explain at a high level. How does work get processed in that service? The same was as in every other service. What type of tree is that in the forest? It is a Norway spruce, same as all the other trees.</p>
<blockquote>
<p>This is the opposite of building a map from the territory.</p>
<p>This is saying let’s take our map and make the territory more like it. <a href="#fn2" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</blockquote>
<p>The problem from Scott’s perspective is that this push for standardization throws out lots of local, tacit know-how in favor of a system that optimizes for top-down control.</p>
<blockquote>
<p>Let us say, for the sake of simplicity, a fence or gate erected across a road. The more modern type of reformer goes gaily up to it and says, “I don’t see the use of this; let us clear it away.”</p>
<p>To which the more intelligent type of reformer will do well to answer: “If you don’t see the use of it, I certainly won’t let you clear it away. Go away and think. Then, when you can come back and tell me that you do see the use of it, I may allow you to destroy it.”</p>
<ul>
<li>G. K. Chesterton’s Fence</li>
</ul>
</blockquote>
<p>Standardization ignores Chesterton’s Fence. Why did cities develop to have mixed use zones? Why did this service use a simple database table for queuing? Why do Norway spruce not normally grow here? If you don’t know the answer to these questions then there is a good chance your plan might fail.</p>
<h2 id="this-is-hard">This Is Hard<a href="#this-is-hard" title=""><span></span><i></i></a></h2>

<p>Seeing like a State goes through a lot of examples of this problem. From the book’s perspective grid plan cities, modern zoning, and large-scale architecture projects all repeat the mistakes of scientific forestry. And the mistake is easy to state: it’s trying to make the territory match a map and forgetting that the map ( or architecture diagram ) is just a map. Many local conditions on the ground aren’t reflected in the map.</p>
<p>I don’t mean to say this is a silly mistake that no one should make. It’s easy to make this mistake. If you want to understand how several services handle work in progress, there are many details to absorb. The way we as humans make sense of these things is to abstract over them and group details together. What is common between how all these services do things? You build up an understanding, and then with that understanding, you try to come up with a solution.</p>
<p>What Seeing like a State tells us is that the problem might be trying to come up with a global solution. A global solution, by necessity, has to ignore local conditions. A map has to exclude more things than it includes. A solution that is easier to draw on a whiteboard isn’t necessarily better. It’s just easier to draw.</p>
<p>Going back to the queue example, if Tim had embedded with a team, worked to solve that specific problem, and then embedded with another team and solved another specific problem, then some commonalities may have emerged. Or maybe not. Maybe each situation would need a different solution. Embedding with specific teams, you get to learn the conditions on the ground. Lots of it doesn’t matter, but some of it matters a lot.</p>
<blockquote>
<p>The vast majority of knowledge of how the system works is not contained in any book—it’s not contained in some expert’s head—it’s interwoven in heads of all the people who participate in the system.</p>
<p>It’s not just an idea of grand architects for human society… there’s a huge body of local know-how that isn’t really written down anywhere. <a href="#fn3" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
</blockquote>
<p>So now, when I hear about top-down standardization efforts, I get a little worried because I know that trying to generalize across many problems is a fraught endeavor. What’s better is getting to know a specific problem by working collaboratively and embedding with the people who have the most tacit knowledge of the problem. Standardization and top-down edicts fail when they miss or ignore the implicit understandings of people close to the problem.<a href="#fn4" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div>
<p>
<strong>While you’re here:</strong>
</p>
<p>
<a href="https://earthly.dev/">Earthly</a> is a syntax for defining your build. It works with your existing build system. Get repeatable and understandable builds today.
</p>
</div>


        
      </section></div>
  </body>
</html>
