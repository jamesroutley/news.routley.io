<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://media.ccc.de/b/congress/2025">Original</a>
    <h1>39th Chaos Communication Congress Videos</h1>
    
    <div id="readability-page-1" class="page">

<nav id="TOC" role="doc-toc">
<h2 id="toc-title">table of contents</h2>
<ul>
<li><a href="#represent-irrational-square-roots-of-integers-as-continued-fractions" id="toc-represent-irrational-square-roots-of-integers-as-continued-fractions">Represent
Irrational Square Roots of Integers as Continued Fractions</a></li>
<li><a href="#continued-fraction-expansion-of-irrational-square-roots-of-integers" id="toc-continued-fraction-expansion-of-irrational-square-roots-of-integers">Continued
Fraction Expansion of Irrational Square Roots of Integers</a></li>
<li><a href="#represent-rational-numbers" id="toc-represent-rational-numbers">Represent Rational Numbers</a></li>
<li><a href="#convergents-of-the-square-root-of-2" id="toc-convergents-of-the-square-root-of-2">Convergents of the Square
Root of 2</a></li>
<li><a href="#continued-fraction-expansion-of-e" id="toc-continued-fraction-expansion-of-e">Continued Fraction Expansion
of e</a></li>
<li><a href="#pells-equation" id="toc-pells-equation">Pell’s
Equation</a></li>
<li><a href="#just-for-fun-peek-at-cf-expansions-of-first-few-square-roots" id="toc-just-for-fun-peek-at-cf-expansions-of-first-few-square-roots">Just
for fun, peek at CF expansions of first few square roots</a></li>
</ul>
</nav>
<!-- livebook:{"autosave_interval_s":30} -->
<p>Project Euler Problems 57, 64, 65, and 66</p>
<p>This is a set of problems I find particularly interesting and
satisfying to solve, because they all involve learning about continued
fraction expansions, mostly to represent irrational square roots, and
this topic is absolutely fascinating to me. I hope you also find it
interesting.</p>

<p>The leading integer part of the continued fraction will of course be
given by the <code>isqrt</code> function. For mathematical rigor, it is
nice to define this solely in terms of integer operations.</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span>defmodule</span> <span>Isqrt</span> <span>do</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span>def</span> isqrt<span>(</span>x2, est \\ <span>1</span><span>)</span> <span>do</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    est1 <span>=</span> div<span>(</span>est <span>+</span> <span>1</span> <span>+</span> div<span>(</span>x2 <span>+</span> est <span>-</span> <span>1</span>, est<span>)</span>, <span>2</span><span>)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span>if</span> est1 <span>==</span> est <span>do</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span>if</span> est1 <span>*</span> est1 <span>&gt;</span> x2 <span>do</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        est1 <span>-</span> <span>1</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span>else</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        est1</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span>end</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span>else</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      isqrt<span>(</span>x2, est1<span>)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span>end</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span>end</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{:module, Isqrt, &lt;&lt;70, 79, 82, 49, 0, 0, 8, ...&gt;&gt;, ...}</code></pre>
<p>It’s nice to see some examples that this actually works, so:</p>
<div id="cb3"><pre><code><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span>[</span><span>1</span>, <span>2</span>, <span>3</span>, <span>4</span>, <span>16</span>, <span>100</span>, <span>10</span><span>**</span><span>6</span>, <span>10</span><span>**</span><span>12</span><span>]</span> <span>|&gt;</span> <span>Enum</span><span>.</span>flat_map<span>(</span><span>fn</span> i <span>-&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  i2 <span>=</span> i <span>*</span> i</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span>-</span><span>1</span><span>..</span><span>0</span> <span>|&gt;</span> <span>Enum</span><span>.</span>map<span>(</span><span>fn</span> d <span>-&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    x <span>=</span> i2 <span>+</span> d</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span>{</span>x, <span>Isqrt</span><span>.</span>isqrt<span>(</span>x<span>)}</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span>end</span><span>)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span>end</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>[
  {0, 0},
  {1, 1},
  {3, 1},
  {4, 2},
  {8, 2},
  {9, 3},
  {15, 3},
  {16, 4},
  {255, 15},
  {256, 16},
  {9999, 99},
  {10000, 100},
  {999999999999, 999999},
  {1000000000000, 1000000},
  {999999999999999999999999, 999999999999},
  {1000000000000000000000000, 1000000000000}
]</code></pre>

<p>Let’s walk through an example, so we can get a feel for how this
goes. Consider <span>\[ \sqrt{23} \]</span>. Of
course, <code>isqrt(23) = 4</code>, so we write</p>
<p><span>\[ \sqrt{23} = 4 + (\sqrt{23} - 4) = 4 +
\frac{1}{1/(\sqrt{23} - 4)} \]</span></p>
<p>and then rationalize the denominator of <span>\[
1/(\sqrt{23} - 4) \]</span> by multiplying it by <span>\[ 1 = \frac{\sqrt{23} + 4}{\sqrt{23} + 4}
\]</span>.</p>
<p>Since <span>\[ (\sqrt{23} - 4)(\sqrt{23} + 4) =
23 - 16 = 7 \]</span>, we conclude that</p>
<p><span>\[ \sqrt{23} = 4 + \frac{1}{(\sqrt{23} +
4) / 7} = 4 + \frac{1}{1 + (\sqrt{23} - 3) / 7} \]</span>, where we have
pulled out the integer portion of the irrational fraction to find the
first term of our continued fraction expansion, which happens to be
<span>\[1\]</span>.</p>
<p>To find the second term, we start with a new value less than 1 to
approximate. The first time around, we were approximating <span>\[
\sqrt{23} - 4 \]</span>; this time we wish to approximate <span>\[(\sqrt{23} -
3)/7\]</span>. The method we use is pretty much the same: first, we
rewrite it as 1 over its inverse, and then we rationalize the irrational
denominator and finally, extract the integer portion of the resulting
fraction, which will be the next term in the continued fraction
expansion.</p>
<p><span>\[ (\sqrt{23} - 3)/7 =
\frac{1}{7/(\sqrt{23} - 3)} \]</span></p>
<p><span>\[ \frac{7}{(\sqrt{23} - 3)} =
\frac{7(\sqrt{23} + 3)}{23 - 9} = \frac{\sqrt{23} + 3}{2} \]</span>
<span>\[ = 3 + \frac{\sqrt{23} - 3}{2}
\]</span></p>
<p>Therefore <span>\[ (\sqrt{23} - 3) / 7 =
\frac{1}{3 + (\sqrt{23} - 3)/2} \]</span>, the second term in the
continued fraction expansion is <span>\[3\]</span>,
and the next irrational fraction less than one to be approximated, to
get the third term, is <span>\[(\sqrt{23} -
3)/2\]</span>.</p>
<p>Rinse and repeat. Invert the fraction, rationalize the denominator,
and extract a new integer portion, which is the third term in the
expansion. The fractional part which remains will be the irrational
fraction to approximate, in order to extract the fourth term.</p>
<p><span>\[ \frac{2}{\sqrt{23} - 3} =
\frac{2(\sqrt{23} + 3)}{14} = \frac{\sqrt{23} + 3}{7} = 1 +
\frac{\sqrt{23} - 4}{7} \]</span></p>
<p>So the third term is 1, and the next irrational fraction less than
one is <span>\[ \frac{\sqrt{23} - 4}{7}
\]</span>.</p>
<p>Invert, rationalize the denominator, extract the next integer:</p>
<p><span>\[\frac{7}{\sqrt{23} - 4} =
\frac{7(\sqrt{23} + 4)}{7} = \sqrt{23} + 4 = 8 + (\sqrt{23} - 4)
\]</span>.</p>
<p>Now, pause. The next irrational number less than one to approximate
is the <em>same number with which we started the expansion</em>, <span>\[
\sqrt{23} - 4 \]</span>. This means that when we continue this
expansion, from now on, we will simply repeat the same sequence of terms
<span>\[(1, 3,
1, 8)\]</span> forever. (By the way, it turns out that it is not an
accident that the final term in the expansion before this recurrence is
exactly twice the initial <code>isqrt(23) = 4</code>; this pattern will
always occur.)</p>
<p><span>\[\sqrt{23} = 4 + \dfrac{1}{1 +
\dfrac{1}{3 + \dfrac{1}{1 + \dfrac{1}{8 + ...}}}} \]</span></p>
<p>One interesting feature of this example expansion is, that every
integer denominator we computed was a factor of the following difference
of squares. The first non-trivial denominator we found was <span>\[ 23 - 16 = 7 \]</span>, which was a factor of
<span>\[ 23 - 9 = 14 \]</span>. Dividing that out
gave us <span>\[ 2 \]</span>, which was again a
factor of <span>\[ 14 \]</span>. Dividing those
gave another <span>\[ 7 \]</span>, which was equal
to the next difference of squares, again <span>\[
23 - 16 \]</span>. So we never had to answer the question, what is the
largest integer smaller than <span>\[ n \sqrt{23}
\]</span> for some <span>\[ n &gt; 1 \]</span>?
Doing so would require us to compute the <code>isqrt</code> function of
<span>\[ 23n^2 \]</span>, potentially on each
iteration of the expansion. This raises the question, for an arbitrary
expansion of this kind, will this feature always hold, or should we
expect to need to repeatedly evaluate <code>isqrt</code> for numbers
larger than the number for which we are deriving the expansion of the
square root?</p>
<p>In fact, we do not ever need to recompute the <code>isqrt</code>
function to carry out an expansion. In particular, if we denote the
terms of the expansion of <span>\[ \sqrt{n}
\]</span> as <span>\[ a_i \]</span>, with <span>\[ i = {0, 1, ...} \]</span>, we have the
formula</p>
<p><span>\[ a_i = \lfloor
\dfrac{\lfloor\sqrt{n}\rfloor + p_i}{q_i} \rfloor \]</span>, with <span>\[ p_0 = 0, q_0 = 1 \]</span>, and the recurrence
relations</p>
<p><span>\[ p_j = a_{j-1}q_{j-1} - p_{j-1}
\]</span>, <span>\[ q_j = \dfrac{n -
{p_j}^2}{q_{j-1}} \]</span></p>
<p>In these terms, the property we want to be true is that <span>\[ q_j \]</span> is always an integer, rather than
merely a rational number. For now, let’s write the recurrence code so
that it will generate an error if we ever arrive at a non-integer value
of <span>\[ q_j \]</span>.</p>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span>defmodule</span> <span>ContFrac</span> <span>do</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span>defp</span> recur<span>(</span>n2, a0, p \\ <span>0</span>, q \\ <span>1</span>, terms \\ <span>[]</span><span>)</span> <span>do</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>      a_prev <span>=</span> <span>case</span> terms <span>do</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span>[]</span> <span>-&gt;</span> a0</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span>[</span>ap <span>|</span> _<span>]</span> <span>-&gt;</span> ap</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span>end</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      pn <span>=</span> a_prev <span>*</span> q <span>-</span> p</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      num <span>=</span> n2 <span>-</span> pn <span>*</span> pn</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span>if</span> num <span>==</span> <span>0</span> <span>do</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span>raise</span><span>(</span><span>&#34;Expanding sqrt </span><span>#{</span>n2<span>}</span><span>: terminating expansion error&#34;</span><span>)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span>end</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      <span>if</span> rem<span>(</span>num, q<span>)</span><span> !=</span> <span>0</span> <span>do</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span>raise</span><span>(</span><span>&#34;Expanding sqrt </span><span>#{</span>n2<span>}</span><span>: </span><span>#{</span>num<span>}</span><span> indivisible by </span><span>#{</span>q<span>}</span><span>&#34;</span><span>)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span>end</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      qn <span>=</span> div<span>(</span>num, q<span>)</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      an <span>=</span> div<span>(</span>a0 <span>+</span> pn, qn<span>)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      nterms <span>=</span> <span>[</span>an <span>|</span> terms<span>]</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span>if</span> an <span>==</span> <span>2</span> <span>*</span> a0 <span>do</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span>{</span>a0, <span>Enum</span><span>.</span>reverse<span>(</span>nterms<span>)}</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>      <span>else</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        recur<span>(</span>n2, a0, pn, qn, nterms<span>)</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span>end</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span>def</span> expand<span>(</span>n2<span>)</span> <span>do</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    recur<span>(</span>n2, <span>Isqrt</span><span>.</span>isqrt<span>(</span>n2<span>))</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span>end</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{:module, ContFrac, &lt;&lt;70, 79, 82, 49, 0, 0, 13, ...&gt;&gt;, ...}</code></pre>

<!-- livebook:{"output":true} -->
<pre><code>{4, [1, 3, 1, 8]}</code></pre>
<p>Now we can count how many continued fraction expansions for <span>\[ \sqrt{N}, N &lt; 10000 \]</span> have an odd
period, pretty easily.</p>
<div id="cb9"><pre><code><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span>defmodule</span> <span>Counter</span> <span>do</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span>def</span> odd_periods<span>(</span>n<span>)</span> <span>do</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span>2</span><span>..</span>n <span>|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>      <span>Enum</span><span>.</span>filter<span>(</span><span>fn</span> x <span>-&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        sx <span>=</span> <span>Isqrt</span><span>.</span>isqrt<span>(</span>x<span>)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        x <span>&gt;</span> sx <span>*</span> sx</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span>end</span> <span>)</span> <span>|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span>Enum</span><span>.</span>map<span>(</span><span>fn</span> x <span>-&gt;</span> <span>{</span>x, <span>ContFrac</span><span>.</span>expand<span>(</span>x<span>)}</span> <span>end</span><span>)</span> <span>|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span>Enum</span><span>.</span>filter<span>(</span><span>fn</span> <span>{</span>_x, <span>{</span>_a0, terms<span>}}</span> <span>-&gt;</span> rem<span>(</span>length<span>(</span>terms<span>)</span>, <span>2</span><span>)</span> <span>&gt;</span> <span>0</span> <span>end</span><span>)</span> <span>|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span>Enum</span><span>.</span>count<span>()</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span>end</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{:module, Counter, &lt;&lt;70, 79, 82, 49, 0, 0, 10, ...&gt;&gt;, ...}</code></pre>

<!-- livebook:{"output":true} -->
<pre><code>4</code></pre>
<div id="cb13"><pre><code><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span>Counter</span><span>.</span>odd_periods<span>(</span><span>10000</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>1322</code></pre>

<!-- livebook:{"output":true} -->
<pre><code>{31, [1, 1, 1, 1, 1, 6, 2, 2, 15, 2, 2, 6, 1, 1, 1, 1, 1, 62]}</code></pre>

<p>Another preliminary to implement, because we will see later that we
need it, is some convenient way to represent and manipulate rational
numbers. We don’t need much here, so we just represent them as 2-tuples
of integers, and define the bare minimum of operations on them.</p>
<div id="cb17"><pre><code><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span>defmodule</span> <span>Rational</span> <span>do</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span>def</span> new<span>(</span>num, denom<span>)</span> <span>do</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span>{</span>n, d<span>}</span> <span>=</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>      <span>if</span> denom <span>&lt;</span> <span>0</span> <span>do</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span>{</span><span>-</span>num, <span>-</span>denom<span>}</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      <span>else</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span>{</span>num, denom<span>}</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span>end</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    gcd <span>=</span> <span>Integer</span><span>.</span>gcd<span>(</span>n, d<span>)</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span>{</span>div<span>(</span>n, gcd<span>)</span>, div<span>(</span>d, gcd<span>)}</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span>def</span> inv<span>({</span>n, d<span>})</span> <span>do</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    new<span>(</span>d, n<span>)</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span>def</span> add<span>({</span>n1, d1<span>}</span>, <span>{</span>n2, d2<span>})</span> <span>do</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    new<span>(</span>n1 <span>*</span> d2 <span>+</span> n2 <span>*</span> d1, d1 <span>*</span> d2<span>)</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span>def</span> subtract<span>({</span>n1, d1<span>}</span>, <span>{</span>n2, d2<span>})</span> <span>do</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    new<span>(</span>n1 <span>*</span> d2 <span>-</span> n2 <span>*</span> d1, d1 <span>*</span> d2<span>)</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span>def</span> multiply<span>({</span>n1, d1<span>}</span>, <span>{</span>n2, d2<span>})</span> <span>do</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    new<span>(</span>n1 <span>*</span> n2, d1 <span>*</span> d2<span>)</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span>def</span> trunc<span>({</span>n, d<span>})</span> <span>do</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    div<span>(</span>n, d<span>)</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span>end</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{:module, Rational, &lt;&lt;70, 79, 82, 49, 0, 0, 15, ...&gt;&gt;, ...}</code></pre>
<p>Let’s check that things are behaving as we expect, using just a few
examples:</p>
<div id="cb19"><pre><code><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span>[</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span>Rational</span><span>.</span>add<span>(</span><span>Rational</span><span>.</span>new<span>(</span><span>1</span>, <span>6</span><span>)</span>, <span>Rational</span><span>.</span>new<span>(</span><span>1</span>, <span>8</span><span>))</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span>Rational</span><span>.</span>multiply<span>(</span><span>Rational</span><span>.</span>new<span>(</span><span>1</span>, <span>2</span><span>)</span>, <span>Rational</span><span>.</span>new<span>(</span><span>2</span>, <span>-</span><span>3</span><span>))</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span>Rational</span><span>.</span>subtract<span>(</span><span>Rational</span><span>.</span>new<span>(</span><span>1</span>, <span>4</span><span>)</span>, <span>Rational</span><span>.</span>new<span>(</span><span>1</span>, <span>2</span><span>))</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span>Rational</span><span>.</span>trunc<span>(</span><span>Rational</span><span>.</span>new<span>(</span><span>4</span>, <span>-</span><span>3</span><span>))</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span>Rational</span><span>.</span>inv<span>(</span><span>Rational</span><span>.</span>new<span>(</span><span>3</span>, <span>2</span><span>))</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span>]</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>[{7, 24}, {-1, 3}, {-1, 4}, -1, {2, 3}]</code></pre>

<p>Let’s take a look at the approximations to <span>\[ \sqrt{2} \]</span> we get from its continued
fraction expansion.</p>

<!-- livebook:{"output":true} -->
<pre><code>{1, [2]}</code></pre>
<div id="cb23"><pre><code><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span>defmodule</span> <span>Conv</span> <span>do</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span>def</span> terms<span>({</span>a0, as<span>})</span> <span>do</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span>Stream</span><span>.</span>concat<span>(</span><span>[</span>a0<span>]</span>, <span>Stream</span><span>.</span>cycle<span>(</span>as<span>))</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span>def</span> convergent<span>(</span>rterms, acc \\ <span>Rational</span><span>.</span>new<span>(</span><span>0</span>, <span>1</span><span>))</span> <span>do</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span>case</span> rterms <span>do</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span>[</span>a0<span>]</span> <span>-&gt;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span>Rational</span><span>.</span>add<span>(</span><span>Rational</span><span>.</span>new<span>(</span>a0, <span>1</span><span>)</span>, acc<span>)</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      <span>[</span>a <span>|</span> rest<span>]</span> <span>-&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        acc1 <span>=</span> <span>Rational</span><span>.</span>inv<span>(</span><span>Rational</span><span>.</span>add<span>(</span><span>Rational</span><span>.</span>new<span>(</span>a, <span>1</span><span>)</span>, acc<span>))</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        convergent<span>(</span>rest, acc1<span>)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span>end</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span>def</span> conv<span>(</span>expansion, n<span>)</span> <span>do</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    rts <span>=</span> <span>Enum</span><span>.</span>take<span>(</span>terms<span>(</span>expansion<span>)</span>, n <span>+</span> <span>1</span><span>)</span> <span>|&gt;</span> <span>Enum</span><span>.</span>reverse<span>()</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    convergent<span>(</span>rts<span>)</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span>def</span> ndigits<span>(</span>n<span>)</span> <span>do</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    length<span>(</span><span>Integer</span><span>.</span>to_charlist<span>(</span>n<span>))</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span>end</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{:module, Conv, &lt;&lt;70, 79, 82, 49, 0, 0, 13, ...&gt;&gt;, ...}</code></pre>
<div id="cb25"><pre><code><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span>1</span><span>..</span><span>8</span> <span>|&gt;</span> <span>Enum</span><span>.</span>map<span>(</span><span>fn</span> n <span>-&gt;</span> <span>Conv</span><span>.</span>conv<span>(</span><span>ContFrac</span><span>.</span>expand<span>(</span><span>2</span><span>)</span>, n<span>)</span> <span>end</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>[{3, 2}, {7, 5}, {17, 12}, {41, 29}, {99, 70}, {239, 169}, {577, 408}, {1393, 985}]</code></pre>
<div id="cb27"><pre><code><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span>1</span><span>..</span><span>1000</span> <span>|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span>Task</span><span>.</span>async_stream<span>(</span><span>fn</span> n <span>-&gt;</span> <span>Conv</span><span>.</span>conv<span>(</span><span>ContFrac</span><span>.</span>expand<span>(</span><span>2</span><span>)</span>, n<span>)</span> <span>end</span><span>)</span> <span>|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span>Stream</span><span>.</span>map<span>(</span><span>fn</span> <span>{</span><span>:ok</span>, v<span>}</span> <span>-&gt;</span> v <span>end</span><span>)</span> <span>|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>filter<span>(</span><span>fn</span> <span>{</span>num, den<span>}</span> <span>-&gt;</span> <span>Conv</span><span>.</span>ndigits<span>(</span>num<span>)</span> <span>&gt;</span> <span>Conv</span><span>.</span>ndigits<span>(</span>den<span>)</span> <span>end</span><span>)</span> <span>|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>count<span>()</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>153</code></pre>

<p>The continued fraction expansion of <span>\[ e
\]</span> looks like</p>
<p><span>\[ e \sim [2; 1, 2, 1, 1, 4, 1, 1, 6, 1,
..., 1, 2k, 1, ... ] \]</span></p>
<div id="cb29"><pre><code><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span>defmodule</span> <span>ExpContFrac</span> <span>do</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span>def</span> istream2<span>()</span> <span>do</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span>Stream</span><span>.</span>iterate<span>(</span><span>2</span>, <span>fn</span> n <span>-&gt;</span> n <span>+</span> <span>2</span> <span>end</span><span>)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span>def</span> expFracStream<span>()</span> <span>do</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span>Stream</span><span>.</span>concat<span>(</span><span>[</span><span>2</span><span>]</span>, <span>Stream</span><span>.</span>flat_map<span>(</span>istream2<span>()</span>, <span>fn</span> n <span>-&gt;</span> <span>[</span><span>1</span>, n, <span>1</span><span>]</span> <span>end</span><span>))</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span>end</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span>Enum</span><span>.</span>take<span>(</span><span>ExpContFrac</span><span>.</span>expFracStream<span>()</span>, <span>20</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>[2, 1, 2, 1, 1, 4, 1, 1, 6, 1, 1, 8, 1, 1, 10, 1, 1, 12, 1, 1]</code></pre>
<div id="cb31"><pre><code><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span>1</span><span>..</span><span>10</span> <span>|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>map<span>(</span><span>fn</span> n <span>-&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span>Conv</span><span>.</span>convergent<span>(</span><span>Enum</span><span>.</span>reverse<span>(</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>      <span>Enum</span><span>.</span>take<span>(</span><span>ExpContFrac</span><span>.</span>expFracStream<span>()</span>, n<span>)))</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span>end</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>[{2, 1}, {3, 1}, {8, 3}, {11, 4}, {19, 7}, {87, 32}, {106, 39}, {193, 71}, {1264, 465}, {1457, 536}]</code></pre>
<div id="cb33"><pre><code><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span>{</span>e_num100, e_denom100<span>}</span> <span>=</span> <span>Conv</span><span>.</span>convergent<span>(</span><span>Enum</span><span>.</span>reverse<span>(</span><span>Enum</span><span>.</span>take<span>(</span><span>ExpContFrac</span><span>.</span>expFracStream<span>()</span>, <span>100</span><span>)))</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{6963524437876961749120273824619538346438023188214475670667,
 2561737478789858711161539537921323010415623148113041714756}</code></pre>
<div id="cb35"><pre><code><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span>Integer</span><span>.</span>to_charlist<span>(</span>e_num100<span>)</span> <span>|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>reduce<span>(</span><span>0</span>, <span>fn</span> c, s <span>-&gt;</span> s <span>+</span> <span>(</span>c <span>-</span> ?<span>0</span><span>)</span> <span>end</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>272</code></pre>

<p>See https://en.wikipedia.org/wiki/Pell%27s_equation to jump to the
solution, given by:</p>
<p>Let <span>\[ h_{i}/k_{i} \]</span> denote the
sequence of convergents to the regular continued fraction for <span>\[ \sqrt{n} \]</span>. This sequence is unique.
Then the pair of positive integers <span>\[
(x_{1},y_{1}) \]</span> solving Pell’s equation <span>\[ x^2 - n y^2 = 1 \]</span> and minimizing <span>\[ x \]</span> satisfies <span>\[ x_1 = h_i, y_1 = k_i \]</span> for some <span>\[ i \]</span>. This pair is called the fundamental
solution.</p>
<p>The sequence of integers <span>\[
[a_{0};a_{1},a_{2},\ldots ] \]</span> in the regular continued fraction
of <span>\[ \sqrt {n} \]</span> is always
eventually periodic. It can be written in the form <span>\[ \left[\lfloor {\sqrt {n}}\rfloor ;{\overline
{a_{1},a_{2},\ldots ,a_{p-1},2\lfloor {\sqrt {n}}\rfloor }}\right]
\]</span>, where <span>\[ a_{1},a_{2},\ldots
,a_{p-1},2\lfloor {\sqrt {n}}\rfloor \]</span> is the periodic part
repeating indefinitely. Moreover, the tuple <span>\[ (a_{1},a_{2},\ldots ,a_{p-1}) \]</span> is
palindromic. It reads the same from left to right as from right to
left.</p>
<p>The fundamental solution is then</p>
<p><span>\[
(x_{1},y_{1})={\begin{cases}(h_{p-1},k_{p-1}),&amp;{\text{ for
}}p{\text{ even}}\\(h_{2p-1},k_{2p-1}),&amp;{\text{ for }}p{\text{
odd}}\end{cases}} \]</span></p>
<div id="cb37"><pre><code><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span>defmodule</span> <span>Pells</span> <span>do</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span>def</span> fun_solution<span>(</span>d<span>)</span> <span>do</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    expansion <span>=</span> <span>ContFrac</span><span>.</span>expand<span>(</span>d<span>)</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span>{</span>_a0, as<span>}</span> <span>=</span> expansion</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    period <span>=</span> length<span>(</span>as<span>)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span>if</span> rem<span>(</span>period, <span>2</span><span>)</span> <span>==</span> <span>0</span> <span>do</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>      <span>Conv</span><span>.</span>conv<span>(</span>expansion, period <span>-</span> <span>1</span><span>)</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span>else</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>      <span>Conv</span><span>.</span>conv<span>(</span>expansion, <span>2</span> <span>*</span> period <span>-</span> <span>1</span><span>)</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span>end</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span>end</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span>end</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span>[</span><span>2</span>, <span>3</span>, <span>5</span>, <span>6</span>, <span>7</span><span>]</span> <span>|&gt;</span> <span>Enum</span><span>.</span>map<span>(</span><span>&amp;</span><span>Pells</span><span>.</span>fun_solution<span>/</span><span>1</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>[{3, 2}, {2, 1}, {9, 4}, {5, 2}, {8, 3}]</code></pre>
<div id="cb39"><pre><code><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span>2</span><span>..</span><span>1000</span> <span>|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>filter<span>(</span><span>fn</span> d <span>-&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    x <span>=</span> <span>Isqrt</span><span>.</span>isqrt<span>(</span>d<span>)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    x <span>*</span> x <span>&lt;</span> d</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span>end</span><span>)</span> <span>|&gt;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>max_by<span>(</span><span>fn</span> d <span>-&gt;</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span>{</span>x, _y<span>}</span> <span>=</span> <span>Pells</span><span>.</span>fun_solution<span>(</span>d<span>)</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span>end</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>661</code></pre>
<div id="cb41"><pre><code><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span>{</span>x661, y661<span>}</span> <span>=</span> <span>Pells</span><span>.</span>fun_solution<span>(</span><span>661</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{16421658242965910275055840472270471049, 638728478116949861246791167518480580}</code></pre>
<div id="cb43"><pre><code><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>x661 <span>*</span> x661 <span>-</span> <span>661</span> <span>*</span> y661 <span>*</span> y661</span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>1</code></pre>
<div id="cb45"><pre><code><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span>{</span>a0_661, as_661<span>}</span> <span>=</span> <span>ContFrac</span><span>.</span>expand<span>(</span><span>661</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{25,
 [1, 2, 2, 4, 4, 16, 1, 9, 2, 1, 12, 5, 1, 1, 1, 2, 1, 3, 1, 1, 3, 1, 2, 1, 1, 1, 5, 12, 1, 2, 9, 1,
  16, 4, 4, 2, 2, 1, 50]}</code></pre>

<!-- livebook:{"output":true} -->
<pre><code>39</code></pre>

<div id="cb49"><pre><code><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span>[</span><span>2</span>, <span>3</span>, <span>5</span>, <span>6</span>, <span>7</span>, <span>8</span>, <span>10</span>, <span>11</span>, <span>12</span>, <span>13</span>, <span>14</span>, <span>15</span>, <span>17</span>, <span>18</span>, <span>19</span>, <span>20</span>, <span>21</span>, <span>22</span>, <span>23</span>, <span>24</span><span>]</span> <span>|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>map<span>(</span><span>fn</span> n <span>-&gt;</span> <span>{</span>n, <span>ContFrac</span><span>.</span>expand<span>(</span>n<span>)}</span> <span>end</span><span>)</span> <span>|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span>Enum</span><span>.</span>each<span>(</span><span>fn</span> expansion <span>-&gt;</span> <span>IO</span><span>.</span>inspect<span>(</span>expansion, <span>charlists:</span> <span>:as_lists</span><span>)</span> <span>end</span><span>)</span></span></code></pre></div>
<!-- livebook:{"output":true} -->
<pre><code>{2, {1, [2]}}
{3, {1, [1, 2]}}
{5, {2, [4]}}
{6, {2, [2, 4]}}
{7, {2, [1, 1, 1, 4]}}
{8, {2, [1, 4]}}
{10, {3, [6]}}
{11, {3, [3, 6]}}
{12, {3, [2, 6]}}
{13, {3, [1, 1, 1, 1, 6]}}
{14, {3, [1, 2, 1, 6]}}
{15, {3, [1, 6]}}
{17, {4, [8]}}
{18, {4, [4, 8]}}
{19, {4, [2, 1, 3, 1, 2, 8]}}
{20, {4, [2, 8]}}
{21, {4, [1, 1, 2, 1, 1, 8]}}
{22, {4, [1, 2, 4, 2, 1, 8]}}
{23, {4, [1, 3, 1, 8]}}
{24, {4, [1, 8]}}</code></pre>
<!-- livebook:{"output":true} -->
<pre><code>:ok</code></pre>



</div>
  </body>
</html>
