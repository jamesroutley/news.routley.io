<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.torproject.org/arti_100_released/">Original</a>
    <h1>Tor – Arti 1.0.0 is released: Rust Tor implementation ready for production use</h1>
    
    <div id="readability-page-1" class="page"><div><p>Back in 2020, we started work on a new implementation of the Tor
protocols in the Rust programming language.  Now we believe it&#39;s ready
for wider use.</p>
<p>In this blog post, we&#39;ll tell you more about the history of the Arti
project, where it is now, and where it will go next.</p>

<p>Why rewrite Tor in Rust?  Because despite (or because of) its
maturity, the C Tor implementation is showing its age.  While C was a
reasonable choice back when we started working on Tor 2001, we&#39;ve
always suffered from its limitations: it encourages a needlessly
low-level approach to many programming problems, and using it safely
requires painstaking care and effort.  Because of these limitations,
that pace of development in C has always been slower than we would
have liked.</p>
<p>What&#39;s more, our existing C implementation has grown over the years to
have a not-so-modular design: nearly everything is connected to
everything else, which makes it even more difficult to analyze the
code and make safe improvements.</p>
<p>A movement to Rust seemed like a good answer.  Started in 2010 at
Mozilla, and now maintained by the Rust Foundation, Rust has grown
over the years to become an independently maintained programming
language with great ergonomics and performance, and strong safety
properties.  In 2017, we started experimenting with adding Rust inside
the C Tor codebase, with a view to replacing the code bit by bit.</p>
<p>One thing that we found, however, was that our existing C code was not
modular enough to be easily rewritten. (Rust&#39;s security guarantees
depend on Rust code interacting with other Rust code, so to get any
benefit, you need to rewrite a module at a time rather than just one
function at a time.) The parts of the code that were isolated enough
to replace were mostly trivial, and seemed not worth the
effort—whereas the parts that most needed replacement were to
intertwined with each other to practically disentangle.  We tried to
disentangle our modules, but it proved impractical to do so without
destabilizing the codebase.</p>
<p>So in 2020, we started on a Rust Tor implementation that eventually
became Arti.  At first, it was a personal project to improve my Rust
skills, but by the end of the summer, it could connect to the Tor
network, and by September it sent its first anonymized traffic.  After
some discussion, we decided to adopt Arti as an official part of the
Tor Project, and see how far we could take it.</p>
<p>Thanks to generous support from <a href="https://zcashcommunitygrants.org/">Zcash Community Grants</a> starting in
2021, we were able to hire more developers and speed up the pace of
development enormously.  By October, we had our first &#34;no major
privacy holes&#34; release (<a href="https://gitlab.torproject.org/tpo/core/arti/-/blob/main/CHANGELOG.md#arti-001-29-oct-2021">0.0.1</a>), and we started putting out monthly
releases.  In March of this year, we had enough of a public API to be
confident in recommending Arti for experimental embedding, and so we
released version <a href="https://gitlab.torproject.org/tpo/core/arti/-/blob/main/CHANGELOG.md#arti-010-1-mar-2022">0.1.0</a>.</p>
<p>And now, with our latest release, we&#39;ve reached our 1.0.0 milestone.
Let&#39;s talk more about what that means.</p>

<p>When we defined our set of milestones, we defined <a href="https://gitlab.torproject.org/tpo/core/arti/-/milestones/8#tab-issues">Arti 1.0.0</a> as &#34;ready for
production use&#34;: You should be able to use it in the real world, to get a
similar degree of privacy, usability, and stability to what you would with a
C client Tor. The APIs should be (more or less) stable for embedders.</p>
<p>We believe we have achieved this.
You can now use <code>arti proxy</code> to connect to the Tor network
to anonymize your network connections.</p>
<p>Note that we don&#39;t recommend pointing a conventional web browser
at <code>arti</code> (or, indeed, C Tor):
web browsers leak much private and identifying information.
To browse the web anonymously, use Tor Browser;
we have <a href="https://tpo.pages.torproject.net/core/doc/rust/arti/#using-arti-with-tor-browser">instructions for using it with Arti</a>.</p>
<h2>Recent work</h2>
<p>To achieve this, we we&#39;ve made many improvements to Arti.
(Items marked as <strong>NEW</strong> are
new or substantially improved since last month&#39;s 0.6.0 release.)</p>
<ul>
<li>We&#39;ve improved <a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/329">robustness of bootstrapping</a>, including some cases where
our client could get confused and stuck, or put itself into an infinite
loop. To do this, we build a <a href="https://tpo.pages.torproject.net/core/doc/rust/arti_testing/index.html">stress-tester</a> for various failure scenarios,
and evaluated <a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/87">Arti&#39;s performance</a> in those scenario.</li>
<li>We&#39;ve added a robust mechanism to report our <a href="https://tpo.pages.torproject.net/core/doc/rust/arti_client/status/struct.BootstrapStatus.html">bootstrapping status</a> so
that applications can detect and help diagnose problems.</li>
<li>We&#39;ve profiled our performance along <a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/87">various metrics</a>, and worked to address
those that were out-of-line.</li>
<li>Our <a href="https://tpo.pages.torproject.net/core/doc/rust/arti_client/">APIs</a> are far more stable and well analyzed than six months ago.</li>
<li>We&#39;ve done a lot of work to future-proof our <a href="https://tpo.pages.torproject.net/core/doc/rust/arti_client/config/struct.TorClientConfig.html">configuration</a> system.</li>
<li>We now have the same client-oriented security improvements as the C Tor
implementation, including:<ul>
<li><a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/150">Property-oriented circuit isolation</a>.</li>
<li><a href="https://crates.io/crates/fs-mistrust">Validating file permissions</a> to ensure data is stored safely.</li>
<li><a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/514">Omission of sensitive information from logs</a>. <strong>NEW</strong></li>
<li><a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/254">Wiping keys from memory</a> after they&#39;re used. <strong>NEW</strong></li>
<li><a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/364">Hardening against debugger-based attacks</a>. <strong>NEW</strong></li>
<li><a href="https://gitlab.torproject.org/tpo/core/arti/-/issues/62">Channel padding</a> to resist <a href="https://en.wikipedia.org/wiki/NetFlow">netflow</a>-based traffic analysis. <strong>NEW</strong>.</li>
</ul>
</li>
<li>We have improved our portability on iOS, Android, and Windows. <strong>NEW</strong></li>
</ul>
<p>For a complete list of changes, including a list of just the changes
since 0.6.0, see our <a href="https://gitlab.torproject.org/tpo/core/arti/-/blob/main/CHANGELOG.md#arti-100-1-september-2022">CHANGELOG</a>.</p>

<p>Our experience with Rust has been a definite success.</p>
<p>At every stage,
we&#39;ve encountered way fewer bugs than during comparable C development.
The bugs that we <em>have</em> encountered have almost all been
semantic/algorithmic mistakes (real programming issues),
not mistakes in using the Rust language and its facilities.
Rust has a reputation for being a difficult language with a picky compiler -
but the pickiness of the compiler has been a great boon.
Generally speaking, if our Rust code compiles and passes its tests, it is much likelier to be correct than our C code under the same conditions.</p>
<p>Development of comparable features has gone way faster, even
considering that we&#39;re building most things for the second time.  Some
of the speed improvement is due to Rust&#39;s more expressive semantics
and more usable library ecosystem—but a great deal is due to the
confidence Rust&#39;s safety brings.</p>
<p>Portability has been far easier than C, though sometimes we&#39;re forced
to deal with differences between operating systems.  (For example,
when we&#39;ve had to get into the fine details of filesystem permissions,
we&#39;ve found that most everything we do takes different handling on
Windows.)</p>
<p>One still-uncracked challenge is binary size.  Unlike C&#39;s standard
library, Rust&#39;s standard library doesn&#39;t come installed by default on
our target systems, and so it adds to the size of our downloads.
Rust&#39;s approach to high-level programming and generic code
can make fast code, but also large executables.
We&#39;ve been able to offset this somewhat with the Rust ecosystem&#39;s
improved support for working with platform-native TLS implementations,
but there&#39;s more work to do here.</p>
<p>Embedding has been practical so far.  We have preliminary work
embedding Arti in both Java and Python.</p>
<p>We&#39;ve found that Arti has attracted volunteer contributions in greater
volume and with less friction than C Tor.
New contributors are greatly assisted by
Rust&#39;s strong type system,
excellent API documentation support,
and safety properties.
These features help them find where to make a change,
and also enable making changes to unfamiliar code
with much greater confidence.</p>

<p>Our primary focus in Arti 1.1.0 will be to implement Tor&#39;s
anticensorship features, including support for <a href="https://bridges.torproject.org/">bridges</a> and <a href="https://gitlab.torproject.org/tpo/anti-censorship/pluggable-transports">pluggable
transports</a>.  We&#39;ve identified our primary <a href="https://gitlab.torproject.org/tpo/core/arti/-/blob/main/doc/BridgeIssues.md">architectural challenges</a>
there, and are working through them now.</p>
<p>In addition, we intend to further solidify our compliance with
<a href="https://doc.rust-lang.org/cargo/reference/semver.html">semantic versioning</a> in our high-level <a href="https://tpo.pages.torproject.net/core/doc/rust/arti_client/"><code>arti-client</code></a> crate.  We are
confident that our intentionally exposed APIs there are stable, but
before we can promise long-term stability we need to make sure that we
have a way to detect and prevent changes to the lower-level APIs that
<code>arti-client</code> re-exports.  The <a href="https://crates.io/crates/cargo-public-api"><code>cargo-public-api</code></a> and
<a href="https://crates.io/crates/cargo-semver-checks"><code>cargo-semver-checks</code></a> crates both seem promising, but we may need
additional thinking.</p>
<p>(This semantic versioning difficulty is the primary reason why
<code>arti-client</code> is still at 0.6.0 instead of 1.0.0.  When we declare
1.0.0 for <code>arti-client</code>, we want to be sure that we can keep backward
compatibility for as long as possible.)</p>
<p>We expect that Arti 1.1.0 will be complete around the end of October.
We had originally estimated one month of the team&#39;s time for this
work, but since we&#39;ll all be off for a week for a meeting, and then a
few of us have vacations, it seems that we&#39;ll need to allocate two
months in order to find a month of hacking time. (Such is life!)</p>
<p>And then?</p>
<p>After Arti 1.1.0, we&#39;re going to focus on <a href="https://community.torproject.org/onion-services/">onion services</a> in Arti
1.2.0.  They&#39;re a complex and important part of the Tor protocols, and
will take a significant amount of effort to build.  Making onion
services work securely and efficiently will require a number of
related protocol features, including support for <a href="https://gitlab.torproject.org/tpo/core/torspec/-/blob/main/proposals/324-rtt-congestion-control.txt">congestion control</a>,
<a href="https://2019.www.torproject.org/docs/tor-manual.html#MaxMemInQueues">DOS protection</a>, <a href="https://blog.torproject.org/announcing-vanguards-add-onion-services/">vanguards</a>, and <a href="https://gitlab.torproject.org/tpo/core/torspec/-/blob/main/padding-spec.txt#L340">circuit padding machines</a>.</p>
<p>After that, Arti 2.0.0 will focus on feature parity with the C tor
client implementation, and support for embedding Arti in different
languages.  (Preliminary embedding work is promising: we have the
beginnings of a <a href="https://gitlab.torproject.org/tpo/core/onionmasq">VPN tool for mobile</a>, embedding Arti in Java.)  When
we&#39;re done, we intend that Arti will be a suitable replacement for C
tor as a client implementation in all (or nearly all) use contexts.</p>
<p>We&#39;ve <a href="https://zcashgrants.org/gallery/25215916-53ea-4041-a3b2-6d00c487917d/29067252/">applied to the Zcash Community Grants</a> for funding to support these next two
phases, and we&#39;re waiting hopefully to see what they say.</p>
<p>And after that?</p>
<p>We intend that, in the long run, Arti will replace our C tor
implementation completely, not only for clients, but also for relays
and directory authorities.  This will take several more years of work,
but we&#39;re confident that it&#39;s the right direction forward.</p>
<p>(We won&#39;t stop support for the C implementation right away; we expect
that it will take some time for people to migrate.)</p>

<p>We rely on users and volunteers to find problems in our software and
suggest directions for its improvement.  You can test Arti as a SOCKS
proxy (if you&#39;re willing to compile from source) and as an embeddable
library (if you don&#39;t mind a little API instability).</p>
<p>Assuming you&#39;ve installed Arti (with <code>cargo install arti</code>, or directly
from a cloned repository), you can use it to start a simple SOCKS proxy
for making connections via Tor with:</p>
<pre><code>$ arti proxy -p 9150
</code></pre>
<p>and use it more or less as you would use the C Tor implementation!</p>
<p>(It doesn&#39;t support onion services yet.  If compilation doesn&#39;t work,
make sure you have development files for <code>libsqlite</code> installed on your
platform.)</p>
<p>If you want to build a program with Arti, you probably want to start with the <a href="https://tpo.pages.torproject.net/core/doc/rust/arti_client/index.html"><code>arti-client</code></a> crate.  Be sure to check out the <a href="https://gitlab.torproject.org/tpo/core/arti/-/tree/main/crates/arti-client/examples">examples</a> too.</p>
<p>For more information, check out the <a href="https://gitlab.torproject.org/tpo/core/arti/-/blob/main/README.md">README</a> file. (For now, it assumes that you&#39;re comfortable building Rust programs from the command line).  Our <a href="https://gitlab.torproject.org/tpo/core/arti/-/blob/main/CONTRIBUTING.md">CONTRIBUTING</a> file has more information on installing development tools, and on using Arti inside of Tor Browser. (If you want to try that, please be aware that Arti doesn&#39;t support onion services yet.)</p>
<p>When you find bugs, please report them <a href="https://gitlab.torproject.org/tpo/core/arti/">on our bugtracker</a>.  You can <a href="https://gitlab.onionize.space/">request an account</a> or <a href="https://anonticket.onionize.space/">report a bug anonymously</a>.</p>
<p>And if this documentation doesn&#39;t make sense, please ask questions!
The questions you ask today might help improve the documentation
tomorrow.</p>
<p>Whether you&#39;re a user or a developer, please give Arti a try, and let
us know what you think.  The sooner we learn what you need, the better
our chances of getting it into an early milestone.</p>

<p>Thanks to everybody who has helped take us here from Arti 0.1.0,
including: <code>0x4ndy</code>, Alexander Færøy, Alex Xu, Arturo Marquez,
Christian Grigis, Dimitris Apostolou, Emptycup, FAMASoon,
feelingnothing, Jim Newsome, Lennart Kloock, Michael, Michael Mccune,
Neel Chauhan, Orhun Parmaksız, Richard Pospesel, Samanta Navarro,
<code>solanav</code>, <code>spongechameleon</code>, Steven Murdoch, Trinity Pointard, and
Yuan Lyu!</p>
<p>And, of course, thanks to <a href="https://zcashcommunitygrants.org">Zcash Community Grants</a> for their support
of this critical work! The Zcash Community Grants program (formerly known as ZOMG) funds independent teams entering the Zcash ecosystem to perform major ongoing development (or other work) for the public good of the Zcash ecosystem. Zcash is a privacy-focused cryptocurrency, which pioneered the use of zk-SNARKs. The Zcash ecosystem is driven to further individual privacy and freedom.</p>

    </div></div>
  </body>
</html>
