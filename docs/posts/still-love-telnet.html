<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bash-prompt.net/guides/telnet/">Original</a>
    <h1>Still Love Telnet</h1>
    
    <div id="readability-page-1" class="page"><div>
			<p>Telnet, the protocol and the command line tool, were how system administrators used to log into remote servers. However, due to the fact that there is no encryption all communication, including passwords, are sent in plaintext meant that Telnet was abandoned in favour of SSH almost as soon as SSH was created.</p>
<p>For the purposes of logging into a remote server, you should never, and probably have never considered it. This does not mean that the <code>telnet</code> command is not a very useful tool when used for debugging remote connection problems.</p>
<p>In this guide, we will explore using <code>telnet</code> to answer the all too common question, “Why can’t I ###### connect‽”.</p>
<p>This frustrated question is usually encountered after installing a application server like a web server, an email server, an ssh server, a Samba server etc, and for some reason, the client won’t connect to the server.</p>
<p><code>telnet</code> isn’t going to solve your problem but it will, very quickly, narrow down where you need to start looking to fix your problem.</p>
<p><code>telnet</code> is a very simple command to use for debugging network related issues and has the syntax:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet &lt;hostname or IP&gt; &lt;port&gt;
</span></span></code></pre></div><p>Because <code>telnet</code> will initially simply establish a connection to the port without sending any data it can be used with almost any protocol including encrypted protocols.</p>
<p>There are four main errors that you will encounter when trying to connect to a problem server.  We will look at all four, explore what they mean and look at how you should fix them.</p>
<p>For this guide we will assume that we have just installed a <a href="https://www.samba.org/">Samba</a> server at <code>samba.example.com</code> and we can’t get a local client to connect to the server.</p>
<h3 id="error-1---the-connection-that-hangs-forever">Error 1 - The connection that hangs forever<a href="#error-1---the-connection-that-hangs-forever" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>First, we need to attempt to connect to the Samba server with <code>telnet</code>. This is done with the following command (Samba listens on port 445):</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet samba.example.com <span>445</span>
</span></span></code></pre></div><p>Sometimes, the connection will get to this point stop and hang indefinitely:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet samba.example.com <span>445</span>
</span></span><span><span>Trying 172.31.25.31...
</span></span></code></pre></div><p>This means that <code>telnet</code> has not received any response to its request to establish a connection. This can happen for two reasons:</p>
<ol>
<li>There is a router down between you and the server.</li>
<li>There is a firewall dropping your request.</li>
</ol>
<p>In order to rule out <strong>1.</strong> run a quick <a href="https://www.systutorials.com/docs/linux/man/8-mtr/"><code>mtr samba.example.com</code></a> to the server. If the server is accessible then it’s a firewall (note: it’s almost always a firewall).</p>
<p>Firstly, check if there are any firewall rules on the server itself with the following command <code>iptables -L -v -n</code>, if there are none then you will get the following output:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>iptables -L -v -n
</span></span><span><span>Chain INPUT <span>(</span>policy ACCEPT <span>0</span> packets, <span>0</span> bytes<span>)</span>
</span></span><span><span> pkts bytes target     prot opt in     out     <span>source</span>               destination
</span></span><span><span>
</span></span><span><span>Chain FORWARD <span>(</span>policy ACCEPT <span>0</span> packets, <span>0</span> bytes<span>)</span>
</span></span><span><span> pkts bytes target     prot opt in     out     <span>source</span>               destination
</span></span><span><span>
</span></span><span><span>Chain OUTPUT <span>(</span>policy ACCEPT <span>0</span> packets, <span>0</span> bytes<span>)</span>
</span></span><span><span> pkts bytes target     prot opt in     out     <span>source</span>               destination
</span></span></code></pre></div><p>If you see anything else then this is likely the problem. In order to check, stop <code>iptables</code> for a moment and run <code>telnet samba.example.com 445</code> again and see if you can connect. If you still can’t connect see if your provider and/or office has a firewall in place that is blocking you.</p>
<h3 id="error-2---dns-problems">Error 2 - DNS problems<a href="#error-2---dns-problems" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>A DNS issue will occur if the hostname you are using does not resolve to an IP address. The error that you will see is as follows:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet samba.example.com <span>445</span>
</span></span><span><span>Server lookup failure:  samba.example.com:445, Name or service not known
</span></span></code></pre></div><p>The first step here is to substitute the IP address of the server for the hostname. If you can connect to the IP but not the hostname then the problem is the hostname.</p>
<p>This can happen for many reasons (I have seen all of the following):</p>
<ol>
<li>Is the domain registered? Use <code>whois</code> to find out if it is.</li>
<li>Is the domain expired? Use <code>whois</code> to find out if it is.</li>
<li>Are you using the correct hostname? Use <code>dig</code> or <code>host</code> to ensure that the hostname you are using resolves to the correct IP.</li>
<li>Is your <strong>A</strong> record correct? Check that you didn’t accidentally create an <strong>A</strong> record for something like <code>smaba.example.com</code>.</li>
</ol>
<p>Always double check the spelling and the correct hostname (is it <code>samba.example.com</code> or <code>samba1.example.com</code>) as this will often trip you up especially with long, complicated or foreign hostnames.</p>
<h3 id="error-3---the-server-isnt-listening-on-that-port">Error 3 - The server isn’t listening on that port<a href="#error-3---the-server-isnt-listening-on-that-port" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>This error occurs when <code>telnet</code> is able to reach to the server but there is nothing listening on the port you specified. The error looks like this:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet samba.example.com <span>445</span>
</span></span><span><span>Trying 172.31.25.31...
</span></span><span><span>telnet: Unable to connect to remote host: Connection refused
</span></span></code></pre></div><p>This can happen for a couple of reasons:</p>
<ol>
<li>Are you <strong>sure</strong> you’re connecting to the right server?</li>
<li>Your application server is not listening on the port you think it is. Check exactly what it’s doing by running <code>netstat -plunt</code> on the server and see what port it is, in fact, listening on.</li>
<li>The application server isn’t running. This can happen when the application server exits immediately and silently after you start it. Start the server and run <code>ps auxf</code> or <code>systemctl status application.service</code> to check it’s running.</li>
</ol>
<h3 id="error-4---the-connection-was-closed-by-the-server">Error 4 - The connection was closed by the server<a href="#error-4---the-connection-was-closed-by-the-server" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>This error happens when the connection was successful but the application server has a built in security measure that killed the connection as soon as it was made. This error looks like:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet samba.example.com <span>445</span>
</span></span><span><span>Trying 172.31.25.31...
</span></span><span><span>Connected to samba.example.com.
</span></span><span><span>Escape character is <span>&#39;^]&#39;</span>.
</span></span><span><span>Connection closed by foreign host.
</span></span></code></pre></div><p>The last line <code>Connection closed by foreign host.</code> indicates that the connection was actively terminated by the server. In order to fix this, you need to look at the security configuration of the application server to ensure your IP or user is allowed to connect to it.</p>
<h3 id="a-successful-connection">A successful connection<a href="#a-successful-connection" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>This is what a successful <code>telnet</code> connection attempt looks like:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet samba.example.com <span>445</span>
</span></span><span><span>Trying 172.31.25.31...
</span></span><span><span>Connected to samba.example.com.
</span></span><span><span>Escape character is <span>&#39;^]&#39;</span>.
</span></span></code></pre></div><p>The connection will stay open for a while depending on the timeout of the application server you are connected to.</p>
<p>A telnet connection is closed by typing <code>CTRL+]</code> and then when you see the <code>telnet&gt;</code> prompt, type “quit” and hit ENTER i.e.:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>telnet samba.example.com <span>445</span>
</span></span><span><span>Trying 172.31.25.31...
</span></span><span><span>Connected to samba.example.com.
</span></span><span><span>Escape character is <span>&#39;^]&#39;</span>.
</span></span><span><span>^<span>]</span>
</span></span><span><span>telnet&gt; quit
</span></span><span><span>Connection closed.
</span></span></code></pre></div><h3 id="conclusion">Conclusion<a href="#conclusion" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>There are a lot of reasons that a client application can’t connect to a server. The exact reason can be difficult to establish especially when the client is a GUI that offers little or no error information. Using <code>telnet</code> and observing the output will allow you to very rapidly narrow down where the problem lies and save you a whole lot of time.</p>

		</div></div>
  </body>
</html>
