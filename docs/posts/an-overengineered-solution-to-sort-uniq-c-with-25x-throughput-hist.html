<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/noamteyssier/hist-rs">Original</a>
    <h1>An overengineered solution to `sort | uniq -c` with 25x throughput (hist)</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/noamteyssier/hist-rs/blob/main/LICENSE.md"><img src="https://camo.githubusercontent.com/6581c31c16c1b13ddc2efb92e2ad69a93ddc4a92fd871ff15d401c4c6c9155a4/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d626c75652e737667" alt="MIT licensed" data-canonical-src="https://img.shields.io/badge/license-MIT-blue.svg"/></a>
<a href="https://crates.io/crates/hist-rs" rel="nofollow"><img src="https://camo.githubusercontent.com/ff5aa5d98198913e162e01f34a2c2fd40f0cb7ab714480c3df54be59e4258cf7/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f642f686973742d72733f636f6c6f723d6f72616e6765266c6162656c3d6372617465732e696f" alt="Crates.io" data-canonical-src="https://img.shields.io/crates/d/hist-rs?color=orange&amp;label=crates.io"/></a></p>
<p dir="auto">A high-throughput CLI to count unique lines.</p>
<p dir="auto">This is a standalone tool with equivalent functionality to <code>cat &lt;file&gt; | sort | uniq -c | sort -n</code>.</p>



<div dir="auto" data-snippet-clipboard-copy-content="# count unique lines in a file
hist &lt;file&gt;

# count unique lines from stdin
/bin/cat &lt;file&gt; | hist

# skip counting and just write unique lines
hist &lt;file&gt; -u

# exclude lines matching a pattern while counting
hist &lt;file&gt; -e &lt;pattern&gt;

# include lines matching a pattern while counting
hist &lt;file&gt; -i &lt;pattern&gt;

# only output lines with abundance greater than or equal to a threshold
hist &lt;file&gt; -m &lt;threshold&gt;

# only output lines with abundance less than or equal to a threshold
hist &lt;file&gt; -M &lt;threshold&gt;

# sort output by the key (default: by abundance)
hist &lt;file&gt; -n

# sort output in descending order (default: ascending)
hist &lt;file&gt; -d"><pre><span><span>#</span> count unique lines in a file</span>
hist <span>&lt;</span>file<span>&gt;</span>

<span><span>#</span> count unique lines from stdin</span>
/bin/cat <span>&lt;</span>file<span>&gt;</span> <span>|</span> hist

<span><span>#</span> skip counting and just write unique lines</span>
hist <span>&lt;</span>file<span>&gt;</span> -u

<span><span>#</span> exclude lines matching a pattern while counting</span>
hist <span>&lt;</span>file<span>&gt;</span> -e <span>&lt;</span>pattern<span>&gt;</span>

<span><span>#</span> include lines matching a pattern while counting</span>
hist <span>&lt;</span>file<span>&gt;</span> -i <span>&lt;</span>pattern<span>&gt;</span>

<span><span>#</span> only output lines with abundance greater than or equal to a threshold</span>
hist <span>&lt;</span>file<span>&gt;</span> -m <span>&lt;</span>threshold<span>&gt;</span>

<span><span>#</span> only output lines with abundance less than or equal to a threshold</span>
hist <span>&lt;</span>file<span>&gt;</span> -M <span>&lt;</span>threshold<span>&gt;</span>

<span><span>#</span> sort output by the key (default: by abundance)</span>
hist <span>&lt;</span>file<span>&gt;</span> -n

<span><span>#</span> sort output in descending order (default: ascending)</span>
hist <span>&lt;</span>file<span>&gt;</span> -d</pre></div>

<p dir="auto">I use <a href="https://crates.io/crates/nucgen" rel="nofollow"><code>nucgen</code></a> to generate a random 100M line <a href="https://en.wikipedia.org/wiki/FASTQ_format" rel="nofollow">FASTQ file</a> and pipe it into different tools to compare their throughput with <a href="https://lib.rs/crates/hyperfine" rel="nofollow"><code>hyperfine</code></a>.</p>
<p dir="auto">I am measuring the performance of equivalent <code>cat &lt;file&gt; | sort | uniq -c | sort -n</code> functionality.</p>
<p dir="auto">Tools compared:</p>
<ul dir="auto">
<li><a href="https://lib.rs/crates/hist-rs" rel="nofollow"><code>hist</code></a></li>
<li><a href="https://lib.rs/crates/cuniq" rel="nofollow"><code>cuniq</code></a></li>
<li><a href="https://lib.rs/crates/huniq" rel="nofollow"><code>huniq</code></a></li>
<li><a href="https://lib.rs/crates/sortuniq" rel="nofollow"><code>sortuniq</code></a></li>
<li>Naive Implementation (coreutils <code>cat &lt;file&gt; | sort | uniq -c | sort -n</code>)</li>
</ul>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hist</code></td>
<td>200.3 ± 3.3</td>
<td>195.6</td>
<td>208.7</td>
<td>1.00</td>
</tr>
<tr>
<td><code>cuniq</code></td>
<td>434.3 ± 6.6</td>
<td>424.7</td>
<td>442.9</td>
<td>2.17 ± 0.05</td>
</tr>
<tr>
<td><code>huniq</code></td>
<td>2375.5 ± 43.8</td>
<td>2328.1</td>
<td>2450.3</td>
<td>11.86 ± 0.30</td>
</tr>
<tr>
<td><code>sortuniq</code></td>
<td>2593.2 ± 28.4</td>
<td>2535.7</td>
<td>2640.9</td>
<td>12.95 ± 0.26</td>
</tr>
<tr>
<td><code>naive</code></td>
<td>5409.9 ± 23.3</td>
<td>5378.0</td>
<td>5453.3</td>
<td>27.01 ± 0.47</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
</article></div></div>
  </body>
</html>
