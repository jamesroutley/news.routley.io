<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.ovalerio.net/archives/2346">Original</a>
    <h1>Who keeps an eye on clipboard access?</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<p>If there is any feature that “universally” describes the usage of computers, it is the copy/paste pattern. We are used to it, practically all the common graphical user interfaces have support for it, and it magically works.</p>
<p>We copy some information from one application and paste into another, and another…</p>
<p>How does these applications have access to this information? The clipboard must be something that is shared across all of them, right? Right. </p>
<p>While very useful, this raises a lot of security questions. As far as I can tell, all apps could be grabbing what is available on the clipboard. </p>
<p>It isn’t uncommon for people to copy sensitive information from one app to another and even if the information is not sensitive, the user generally has a clear target app for the information (the others don’t have anything to do with it). </p>
<p>These questions started bugging me a long time ago, and the sentiment even got worse when Apple released an iOS feature that notifies users when an app reads the contents of the clipboard. That was brilliant, why didn’t anyone thought of that before?</p>
<p>The result? Tons of apps caught snooping into the clipboard contents without the user asking for it. The following articles can give you a glimpse of what followed:</p>
<ul><li><a href="https://www.theverge.com/2020/7/3/21312821/linkedin-app-ios-14-clipboard-copying-fix">LinkedIn says it will stop repeatedly copying iOS clipboard</a> </li><li><a href="https://arstechnica.com/gadgets/2020/06/tiktok-and-53-other-ios-apps-still-snoop-your-sensitive-clipboard-data/">TikTok and 32 other iOS apps <em>still</em> snoop your sensitive clipboard data</a></li><li><a href="https://www.forbes.com/sites/daveywinder/2020/07/11/iphone-user-sues-linkedin-for-reading-clipboard-data-after-ios-14-alert-revelations-apple-ipad-class-action-privacy-lawsuit/">iPhone User Sues LinkedIn For Reading Clipboard Data After iOS 14 Alert Revelations</a></li></ul>
<p>That’s not good, and saying you won’t do it again is not enough. On iOS, apps were caught and users notified, but what about Android? What about other desktop operating systems?</p>
<p>Accessing the clipboard to check what’s there, then steal passwords, or replace cryptocurrency addresses or just to get a glimpse of what the user is doing <a href="https://www.bleepingcomputer.com/news/security/clipboard-hijacker-malware-monitors-23-million-bitcoin-addresses/">is a common pattern of malware</a>.</p>
<p><strong>I wonder why hasn’t a similar feature been implemented in most operating systems we use nowadays (it doesn’t need to be identical, but at least let us verify how the clipboard is being used). Perhaps there exists tools can help us with this, however I wasn’t able to find any for Linux.</strong></p>
<p>A couple of weeks ago, I started to look at how this works (on Linux, which is what I’m currently using). What I found is that most libraries just provide a simple interface to put things on the clipboard and to get the current clipboard content. Nothing else. </p>
<p>After further digging, I finally found some useful and interesting articles on how this feature works on X11 (under the hood of those high level APIs). For example:</p>
<ul><li><a href="https://www.jwz.org/doc/x-cut-and-paste.html">https://www.jwz.org/doc/x-cut-and-paste.html</a></li><li><a href="https://www.uninformativ.de/blog/postings/2017-04-02/0/POSTING-en.html">https://www.uninformativ.de/blog/postings/2017-04-02/0/POSTING-en.html</a></li><li><a href="https://wiki.archlinux.org/title/Clipboard">https://wiki.archlinux.org/title/Clipboard</a></li></ul>
<p>Then, with this bit of knowledge about how the clipboard works in X11, I decided to do a quick experiment in order to check if I can recreate the clipboard access notifications seen in iOS. </p>
<p>During the small periods I had available in the last few weekends, I tried to build a quick proof of concept, nothing fancy, just a few pieces of code from existing examples stitched together. </p>
<p>Here’s the current result:</p>
<figure><video controls="" src="https://blog.ovalerio.net/wp-content/uploads/2022/01/clipboard-watcher.mp4"></video><figcaption>Demonstration of clipboard-watcher detecting when other apps access the contents</figcaption></figure>
<p>It seems possible to detect all attempts of accessing the clipboard, but after struggling a bit, it seems that due to the nature of X11 it is not possible to know which running process owns the window that is accessing the clipboard. A shame.</p>
<p>The information that X11 has about the requesting client must be provided by the client itself, which makes it very hard to know for sure which process it is (most of the time it is not provided at all).</p>
<p>Nevertheless, I think this could still be a very useful capability for existing clipboard managers (such as Klipper), given the core of this app works just like one.</p>
<p>Even without knowing the process trying to access the clipboard contents, I can see a few useful features that are possible to implement, such as:</p>
<ul><li>Create some stats about the clipboard access patterns.</li><li>Ask the user for permission, before providing the clipboard contents.</li></ul>
<p>Anyhow, you can check the proof of concept <a href="https://github.com/dethos/clipboard-watcher">here</a> and give it a try (improvements are welcome). Let me know what you think and what I’ve missed.</p>
</div>
</div></div>
  </body>
</html>
