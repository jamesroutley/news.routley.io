<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zetier.com/news/jtag-chain-diagram-to-dump-nor/">Original</a>
    <h1>Using JTAG to dump parallel NOR flash</h1>
    
    <div id="readability-page-1" class="page"><section>
	<div>
						<p><img src="https://zetier.com/wp-content/uploads/2024/01/JTAG-Blog_thumbnail.png" alt="/nl_img1"/>
			</p>
						
			<!-- wp:heading -->
<h2>Reading Parallel NOR Flash with JTAG</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Still have that old development kit kicking around from college or high school? Yeah, me too. Don&#39;t have a programmer on hand? Yeah, me too. I had the dire need to dump some parallel NOR flash memory recently and could not find a good tutorial on how to do it cheaply and consistently with free software. So I created my own tutorial, and I invite you to follow along. </p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>The Problem</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Earlier this year, I needed to read out some parallel NOR flash memory. I did not have a programmer (a device that can read flash memory through preprogrammed means via software created by the manufacturer) and did not want to buy one due to cost and shipping time. I found some software—UrJTAG (works well with Linux) and TopJTAG (works well with Windows)—and hooked my JTAG-compatible board to a parallel NOR flash chip. I wound up putting voltage on one of the incorrect pins and it cut its way through the parallel NOR chip to ground. Consequently, the memory was gone forever and I was more interested than ever in getting this working. After some tweaking and learning to use the tools, I found this method to be a very cheap and easy way to read out parallel NOR flash on both Linux and Windows with some basic hardware. </p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4>What you will need</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>If you are interested in putting this project together yourself here are links to the parts used. These links should bring you to an appropriate component which will work, but probably won&#39;t be the cheapest. Doing your own searches for these parts and components on other applications or online stores may drastically decrease the price of this project.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:heading {"level":5} -->
<h5>Required</h5>
<!-- /wp:heading -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><a href="https://www.ebay.com/itm/224960711173?chn=ps&amp;norover=1&amp;mkevt=1&amp;mkrid=711-117182-37290-0&amp;mkcid=2&amp;mkscid=101&amp;itemid=224960711173&amp;targetid=1529493968302&amp;device=m&amp;mktype=pla&amp;googleloc=9008163&amp;poi=&amp;campaignid=19851828444&amp;mkgroupid=145880009014&amp;rlsatarget=pla-1529493968302&amp;abcId=9307249&amp;merchantid=108461346&amp;gad_source=1&amp;gbraid=0AAAAAD_QDh-NCqi4YLUp0x09yEjNLmtck&amp;gclid=EAIaIQobChMIwJugl53ThAMVyW5HAR2QggakEAQYByABEgIQvPD_BwE">USB Blaster Programmer - ebay</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.waveshare.com/product/fpga-tools/core-boards-compact-boards/altera-core/coreep4ce6.htm" data-type="link" data-id="https://www.waveshare.com/product/fpga-tools/core-boards-compact-boards/altera-core/coreep4ce6.html">JTAG-capable board/development kit - waveshare</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.elnec.com/en/products/programming-adapters/Top_TSOP56_ZIF_18.4mm/" data-type="link" data-id="https://www.elnec.com/en/products/programming-adapters/Top_TSOP56_ZIF_18.4mm/">parallel NOR flash memory adapter - elnec</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.digikey.com/en/products/detail/busboard-prototype-systems/KIT-ZW-10X3/19200378?utm_adgroup=&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=PMax%20Shopping_Product_High%20ROAS%20Categories&amp;utm_term=&amp;utm_content=&amp;gad_source=1&amp;gbraid=0AAAAADrbLlgfGQ7VONH1rSrihQUvkweiA&amp;gclid=EAIaIQobChMIwPaqu5_ThAMVvGhHAR387gYCEAQYCyABEgJLf_D_BwE" data-type="link" data-id="https://www.digikey.com/en/products/detail/busboard-prototype-systems/KIT-ZW-10X3/19200378?utm_adgroup=&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=PMax%20Shopping_Product_High%20ROAS%20Categories&amp;utm_term=&amp;utm_content=&amp;gad_source=1&amp;gbraid=0AAAAADrbLlgfGQ7VONH1rSrihQUvkweiA&amp;gclid=EAIaIQobChMIwPaqu5_ThAMVvGhHAR387gYCEAQYCyABEgJLf_D_BwE">Jumper wires - digikey</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="http://www.topjtag.com/downloads/" data-type="link" data-id="http://www.topjtag.com/downloads/">UrJTAG application - TopJTAG Probe</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://bsdl.info/" data-type="link" data-id="https://bsdl.info/">BSDL file pertaining to JTAG board</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.sparkfun.com/products/10326">Heatgun - Sparkfun</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":5} -->
<h5>The following may also be helpful</h5>
<!-- /wp:heading -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><a href="https://www.harborfreight.com/5-to-50-watt-soldering-station-57364.html?ccdenc=eyJjb2RlIjoiNzA0OTczOTkiLCJza3UiOiI1NzM2NCIsImlzIjoiMzguMjQifQ%3D%3D&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=21058668685&amp;campaignid=21058668685&amp;utm_content=159082197589&amp;adsetid=159082197589&amp;product=57364&amp;store=3098&amp;gad_source=1&amp;gclid=EAIaIQobChMIpeWi-p_ThAMV3HBHAR3LjgFdEAQYASABEgIJ1_D_BwE">Solder iron - harbor freight</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.ifixit.com/products/digital-multimeter?pk_campaign=%7BUS%7CShopping%7CMiscTools%7D&amp;pk_source=google&amp;pk_medium=cpc&amp;pk_kwd=&amp;gad_source=1&amp;gclid=EAIaIQobChMIrvrZiqDThAMVnEZHAR3F_gKREAQYBSABEgJ1WPD_BwE">Multimeter - ifixit.com</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.digikey.com/en/products/detail/aven-tools/26000/600972?utm_adgroup=&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=PMax%20Shopping_Product_Low%20ROAS%20Categories&amp;utm_term=&amp;utm_content=&amp;utm_id=go_cmp-20243063506_adg-_ad-__dev-m_ext-_prd-600972_sig-EAIaIQobChMIhvjMi6HThAMVsUtHAR2dHAmqEAQYASABEgJ3LvD_BwE&amp;gad_source=1&amp;gbraid=0AAAAADrbLlhCHMsI9UQzJr03Qdcwe0gKy&amp;gclid=EAIaIQobChMIhvjMi6HThAMVsUtHAR2dHAmqEAQYASABEgJ3LvD_BwE" data-type="link" data-id="https://www.digikey.com/en/products/detail/aven-tools/26000/600972?utm_adgroup=&amp;utm_source=google&amp;utm_medium=cpc&amp;utm_campaign=PMax%20Shopping_Product_Low%20ROAS%20Categories&amp;utm_term=&amp;utm_content=&amp;utm_id=go_cmp-20243063506_adg-_ad-__dev-m_ext-_prd-600972_sig-EAIaIQobChMIhvjMi6HThAMVsUtHAR2dHAmqEAQYASABEgJ3LvD_BwE&amp;gad_source=1&amp;gbraid=0AAAAADrbLlhCHMsI9UQzJr03Qdcwe0gKy&amp;gclid=EAIaIQobChMIhvjMi6HThAMVsUtHAR2dHAmqEAQYASABEgJ3LvD_BwE">Magnifying lens - digikey</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.elnec.com/en/products/programming-adapters/Top_TSOP56_ZIF_18.4mm/" data-type="link" data-id="https://www.elnec.com/en/products/programming-adapters/Top_TSOP56_ZIF_18.4mm/">TopJTAG Probe and flash programmer - elnec.com</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.cvs.com/shop/cvs-health-91-isopropyl-alcohol-prodid-1011920?skuId=216440&amp;cgaa=QWxsb3dHb29nbGVUb0FjY2Vzc0NWU1BhZ2Vz&amp;cid=ps_summer_fa&amp;gclid=EAIaIQobChMI05jJq6DThAMVimFHAR310wUNEAQYASABEgJC__D_BwE&amp;gclsrc=aw.ds">Isopropyl alcohol - CVS</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3>What Is Parallel NOR Flash?</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Parallel NOR flash is a storage medium for electronics. It is used for its accessing abilities in that it can grab single bytes or words randomly rather than pages of memory, which NAND flash cannot. There are other advantages, such as standby power consumption and storage lifespan, that make it a better component to use with systems that do not need to store a lot of information but need accurate data all the time. Parallel NOR flash is employed in an array of embedded devices and IoT systems that are used throughout industry and in home appliances. DVD players, thermostats, Amazon products, and vehicle electronic control units (ECUs) typically contain flash memory.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Identifying and Searching for Parallel NOR Flash</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Parallel NOR flash comes in an array of different integrated circuit (IC) packages. The ones referenced in this article will be thin small outline package (TSOP) components. Some come in ball grid array (BGA) packages and other packages and sizes. In most cases, a simple Google search confirms what your part is and leads you to some sort of datasheet for the component. Here are some parallel NOR flash ICs and the device I found them in:</p>
<!-- /wp:paragraph -->

<!-- wp:group {"layout":{"type":"constrained"}} -->
<div id="Figure1"><!-- wp:table -->
<figure><table><tbody><tr><td data-align="center"><img src="https://zetier.com/wp-content/uploads/2024/02/dvd.png" alt=""/></td><td data-align="center"><img src="https://zetier.com/wp-content/uploads/2024/02/dvd_pcb.png" alt=""/></td></tr></tbody></table><figcaption>Figure 1: Oppo DVD player (L) uses a parallel NOR flash (R)</figcaption></figure>
<!-- /wp:table -->

<!-- wp:paragraph -->

<!-- /wp:paragraph --></div>
<!-- /wp:group -->

<!-- wp:table -->
<figure id="Figure2"><table><tbody><tr><td data-align="center"><img src="https://zetier.com/wp-content/uploads/2024/02/linksys.png" alt=""/></td><td data-align="center"><img src="https://zetier.com/wp-content/uploads/2024/02/linksys_pcb.png" alt=""/></td></tr></tbody></table><figcaption>Figure 2: Linksys WRT54G (L) uses a parallel NOR flash (R)</figcaption></figure>
<!-- /wp:table -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>A simple Google search of the text on either of these ICs brings up relevant datasheets and explains it is parallel NOR flash. Pins are also typically in buses and have an “address in” and “data out” side. Some NAND ICs have similarities so it is best to read and refer to the datasheet about the pinout of the IC and the type. </p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Google Searches and Datasheets</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Taking the router&#39;s flash chip identification markings (for example, EN29LV160AB-70TCP in <a href="#Figure2">Figure 2</a>) and putting it in Google (<a href="#Figure3">Figure 3</a>) retrieves datasheets to which you could refer to learn more about the part.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure3"><img src="https://lh7-us.googleusercontent.com/Doq0x7RUQh4dBFXUxhu3LQ4rEvM0gRYlx6APaZDYlUGH8fJemEvl8lPnC0_PVQ4PUF0E51oUM__CiNQzLYLNipqSBJiKvhEHK4mMGEVdMrf9moK-EOiKA_I8z-rtPKJpbrGehf4oN11rlG93pe5e6fg" alt=""/><figcaption>Figure 3: Google search results of EN29LV160AB-70TCP parallel NOR flash</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Clicking the first datasheet in <a href="#Figure3">Figure 3</a> pulls up relevant information about this flash chip. Looking at the website at Digikey.com also gives a simple overview of the IC (<a href="#Figure4">Figure 4</a>).</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure4"><img src="https://lh7-us.googleusercontent.com/IRSDJDHk9WqrqYiC7apzrmdepYhIMf00QPQ2TWX5mE4l99stz51FSdK4ypTj6sSNjChSNfsaJjnUVDCzlwIkVpIuJLt9JlpcJ5GifmEUC9ak1x7fKRLPW2YZ-cK9SDUHYGtKul-tQB9lpefMXsh6Xxs" alt=""/><figcaption>Figure 4: Digikey information about a flash chip</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Examining the datasheet, we find the pinout diagram (<a href="#Figure5">Figure 5</a>). A pinout diagram typically shows all the pins that can connect to the IC mapped to their specific function. In this case, 48 pins are on the target IC that are shown in the diagram with their respective function (that is, Vss for ground, WE# for write enable, and so on). With these two pieces of information, you can put the IC in an adapter and pull memory.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure5"><img src="https://lh7-us.googleusercontent.com/XkK4kGLGt0jKVXWhmhOlYGOm6vJtcSKD7giu7SZFkjdl_Dv6TeJAwovCczsaHgQ3CQa3qu6YoEVtpOpjW-Rw4tfEmOYjCKh0QAl6wG-gdLO5leX4UMSBWpwrxeyEMH0VvO9fXTU_QfKsFZ5BdFRKk9M" alt=""/><figcaption>Figure 5: Flash pinout</figcaption></figure>
<!-- /wp:image -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure6"><img src="https://lh7-us.googleusercontent.com/MJgpOF1lz9nP1OAHqlJQ10LmWv5rCCFCqGbzlcERxuDdD45BQfy1xbT2OgfIgrCb3Kzs5WUDTc0csOcK-P9PWuaxT1D9Fux81LOYUarCahw5x7htbI_5xRNxpisaGNx0PyxHcxUz7v0qtOtJNubBzW8" alt=""/><figcaption>Figure 6: Pins during operations for flash to take action</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>As shown in <a href="#Figure6">Figure 6</a>, a read requires the chip enable (CE) and output enable (OE) to be low and the write enable (WE) and reset pins to be high. Address requests can then be sent to A0-A19 as bits, and the flash chip serves back the data to the requester on pins D0-D15.</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>Testing Your Equipment and Ensure Compatibility!</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>It is important to examine and test your equipment thoroughly before extracting flash memory. If pins are not connected correctly and power is misconfigured, you can lose data and damage or destroy the flash chip. Following these steps can mitigate damage and data loss before attempting to extract data using JTAG.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>To test your JTAG-able board (we will refer to it as <em>board</em> from now on), retrieve the BSDL for the board by searching for it on <a href="https://bsdl.info/">https://bsdl.info/</a>. A BSDL file is the Boundary Scan Description Language file that pertains to your specific make/model and allows you to control some of the registers that in turn give access to reading and writing to I/O pins. The BSDL file is written in a format similar to VHDL (VHSIC Hardware Description Language) to describe a low-level circuit. JTAG compatible components can also use BSDL files to perform boundary scans on the board’s blocks internally to analyze the logic and find/use external busses (like flash memory or another component). If your equipment works and you are in a Linux environment, skip to this post’s <a href="#UrJTAG">UrJTAG section</a>. Programs such as TopJTAG Probe (<a href="http://www.topjtag.com/downloads/">http://www.topjtag.com/downloads/</a>) can assist in ensuring a board is operating correctly and that a board can send and receive data on I/O pins. After opening the GUI, an empty project should appear (<a href="#Figure7">Figure 7</a>). </p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure7"><img src="https://lh7-us.googleusercontent.com/hcuelCi9fytPDF17bzOsPnkgtcH7uJLU4ln2FnOWpM_NFAvPznceBE50unc33m4jOmKnt6HsKdrb4CnoF_9Bad43CFECqPFMmp5DpS_iU88BNJYR4WjS581qANsTXlKkn-gqR0DZWz_bu_jlmIDYSiw" alt=""/><figcaption>Figure 7: Empty project in TopJTAG Probe</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Go to <strong>File</strong> &gt; <strong>New Project Wizard</strong>. A dialogue box displays the new project wizard (<a href="#Figure8">Figure 8</a>). Choose your interface in the <strong>Device</strong> field. In this case I am using a USBBlaster. It is a cheap and compatible USB adapter for Altera products from Intel.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure8"><img src="https://lh7-us.googleusercontent.com/YJqge4hi3hGyAfVCrq9ax9TOFswkzmOkmJ6sXrR5hdMLKoMfMAGOifw-81d5jaNwmDU0sZLHu__0h6-JZihf9XetCG6ghJW3tce7aAfBG0PCn38P8KFKnVOvQ7qUTAj6d7hbX1AtmbpiFI4rIYOMU3E" alt=""/><figcaption>Figure 8: Choosing an interface in TopJTAG</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Click <strong>Next</strong>. If your board is hooked to your connection device, it will enumerate as shown in <a href="#Figure9">Figure 9</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure9"><img src="https://lh7-us.googleusercontent.com/Z906rg7yccpJjri3dX8vt0mqPki7T_vJaV1U_jtczmD5ff0LpZdc-LElC6AvEnXi6BoUOzrw54Sk9YlY8pgVYZfUr9X6ZMBUeDGmPXwz1vwBiZFlG0ue64plmM4-DYeYERaTbneZmxa2XNXa9NxQ_4A" alt=""/><figcaption>Figure 9: Board being recognized by TopJtag</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Click <strong>Next</strong>. Click <strong>CLICK HERE TO SET</strong>. Browse and select your BSDL file downloaded for your board (<a href="#Figure10">Figure 10</a>). Then click <strong>Finish</strong>. </p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure10"><img src="https://lh7-us.googleusercontent.com/OwArtT_vH_yajVWHHZtRqvFUmnNVxwLtaUMyxmkk5zSHdQzRNtqiQt9VwWG2skSE4PFbi-vqY99HQtFwfkQSJBTYtQ1gP2dmV_VWzTDD7bYGXVB_japuNhThnCTBX-dzPscdp5noR96crJjhcoQdWMU" alt=""/><figcaption>Figure 10: Setting the BSDL for board</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>A new project now displays (<a href="#Figure11">Figure 11</a>). Short one of the I/O pins on your board with a jumper to ground and select <strong>Run</strong> on the top taskbar. Lift the jumper to see if any of the pins change color from black to red. With the exception of the oscillator (changes black to red repeatedly without any interaction), if one changes, your board is probably good and the BSDL file will work. If not, you may need a different BSDL file or different board.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure11"><img src="https://lh7-us.googleusercontent.com/c9K0TNGkoQabhfke1Uqpy2sxkeTiiERf5Z94U1NfmqGa-PjypbW9u3xKIF5fzpfMKBeVxT45FQHFxTgWrSnaG-iU_zWmtDJpJZZepzqHtT7wM7qkl16gt0sDlXd-t8kfWVysfg6v-sa7AadVf9PU7kU" alt=""/><figcaption>Figure 11: Project opened with BSDL</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure12"><img src="https://lh7-us.googleusercontent.com/KRIomDqcmAaYy3WrAVGH82G22v6427h_dN-mvQYsFlC0rIHDf8kD-2gZxc-nRIJIFZ4QZzbGaY7IBsL8Xcd1KNT_4RBfU8Gy6AxVSWot0wmt7B1kk27q_q3BJUJNido5AbxuM2QIK9InBdFSE7Phw8k" alt=""/><figcaption>Figure 12: Grounding I/O pin </figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure13"><img src="https://lh7-us.googleusercontent.com/sicuh8LBKaGW39ziICoV-8CQqPDjtqcSDyLaRLtYFpd2jqFowv-0SvMlS56f-4V4yy3AGThz88a0MykS5exYtWMMQ6crXGL7ZlqHoC2ujQDCD59IvvgsXfm9dObcj3PNry_jTDeWEuAZA0FbSMJSYHs" alt=""/><figcaption>Figure 13: Pin 97 (grounded pin) turned black to indicate logic 0</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure14"><img src="https://lh7-us.googleusercontent.com/kwe-9CrZyYYAICcdhsMTCL3v8HR2hoD8kWzmt7bd_qjISfPAHy04BpVDWWCDKSE4QVl3Rt7mp6d2I0qCe999XTmOrA7yib-D3nNwiGGOYxY5bl_GoGkhopYeCCHw-bjfjI5w36-ZOyVt_3IRgHGQMhs" alt=""/><figcaption>Figure 14: A different board did not change color after grounding. This indicates possible errors and will not work at the moment to record input from an I/O signal. </figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Removing the flash chip may require some skill and finesse. Using a heat gun, slowly heat the area that is soldered down. Slowly moving the heat gun in circular motions or side to side in patterns is effective in heating the solder and will minimize melting the IC. Using a pair of tweezers, lightly pull the IC off or “shuffle” it off its pads to get it off. Be careful. Components will be hot. </p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure15"><img src="https://lh7-us.googleusercontent.com/PYbPe6RR2ji08Fkn110DrEDeaGNcAgFRR6i5mHpj5DT8QI7QsegEPc0MWrVcmf7TjzdTLjbisSYxPJGVSPmih1aqEFe-T9TooreyAEj7vKyMLlLwAGtOmj4ERAq2B4rXZ2zA1xTWIzY7NYYVgK3z_WQ" alt=""/><figcaption>Figure 15: Heating the flash IC to prepare it for removal</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>After removing the flash chip, inspect its package size and shape in comparison to different packages listed on <a href="https://en.wikipedia.org/wiki/List_of_integrated_circuit_packaging_types" data-type="link" data-id="https://en.wikipedia.org/wiki/List_of_integrated_circuit_packaging_types">Wikipedia</a>. With some searching, you can find the exact package of the flash IC. Get an adapter based on the package size if you do not have one on hand. In this case, I am using a TSOP 56 adapter for a flash chip that has 48 pins. Due to the dimensions and standardization of TSOP, the flash chip fits and I can use 48 of the 56 pins on the adapter. An adapter with the same package size but different pin count can work if the adapter pin count is higher than the pin count on the flash chip. Flash adapters can be found on most online shopping sites. Mine was from eBay.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure16"><img src="https://lh7-us.googleusercontent.com/XQoQRgMPVM4KXexGiVbtGiql_NmdQ0-vq4A5agU0kCedKNJt4gKAXYPV_As_KdnUeMBU57uvBxOCMIvhUvdEtg803fCDtg-hmHqlsZlMTlyMMuHBlbRWdEfOoJTp37Uc-mvd4-_malnszlJxpRhfoec" alt=""/><figcaption>Figure 16: TSOP 56 adapter used for TSOP 48</figcaption></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2>The Most Complicated Part</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Up to this point, this project has been a breeze. Now for the hard part. Take the jumper wires and pin them out to the BSDL file pins for your board. You can see the pins in the BSDL file pin map of the board.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure17"><img src="https://lh7-us.googleusercontent.com/P3dn6Ngf78Hs1PP8wl4-qDV0tESz0H-bDVKxv5J6g6yhdm-Gbya3UGcMyoJCOxH1NsvgjzHnhPQbw-3I0y3GpWZ3RQ2lsEECobmcJCZwatHcke6lPBD-9m1GCBehDKsvpODMfPMAk3J62xuyHIIS2M4" alt=""/><figcaption>Figure 17: Pin mapping in the BSDL file</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>It is important to note in some cases the datasheet and BSDL will not overlap and the pins will be different depending on who generated the BSDL file. Write out what I/O pins you intend to connect to the parallel NOR flash. In this case, I mapped CE to IO193 and connected a jumper wire between the two. I mapped A15 to IO105 and connected a jumper wire between the two. For each pin on the flash chip (with the exception of the power rails) there must be an I/O pin connected. Power pins can connect to whatever pins are available to coincide with the voltage required to power the flash chip. Mine is 3.3V so I powered it with the 3.3V my board provided. Hook up all I/O pins to their respective flash pins. Connect the interface from the computer you are using to the JTAG header on the board. Keep track of everything on a text editor or on a piece of paper. Here is an example of the map I used:</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":468,"sizeSlug":"large","linkDestination":"none"} -->
<figure id="Figure18"><img src="https://zetier.com/wp-content/uploads/2024/02/pin_mapping-1024x737.png" alt=""/><figcaption>Figure 18: Record keeping and mapping pins (power pins were moved to power on the board)</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure19"><img src="https://lh7-us.googleusercontent.com/JiZWbroSoGT0GyRDeBVv3shTRzLLxWG6-DyQJNBV6q-__Up00znowbFwy4HQ5fU8lN8NXG7ylcR623EEGlKuSQ3ePBk9UWW1NOpg05NKwOxAeY9U6t8QZnm741P4Yhw-uYlKb7jUcSsvZTDjpJ2K-4Y" alt=""/><figcaption>Figure 19: After mapping on paper, connect wires and pins up</figcaption></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":3} -->
<h3>TopJTAG Toolkit</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Go to <strong>Setup &gt; Signal Pins</strong>. Here is where all flash mapped pins must be input to communicate with the flash chip. Match the datasheet. </p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure20"><img src="https://lh7-us.googleusercontent.com/v-j3b0yrrYE9m5-DMu576dxLRlNSR9eQps5MrdBFOCd0VBSGfYHjPnTy4IISXk1gwA-drpOTZq7FpAgsd9Q9uR-BZIvGi0n2rMjr44r1f9A1rhqPcmBurxSgzYBJFsNg1JbktLDHPaYpTNWHq89aAsA" alt=""/><figcaption>Figure 20: Flash pins mapped to BSDL device pin/physical connection pin. Notice CE/OE/WE have been annotated as what is in the datasheet and are active low. </figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure21"><img src="https://lh7-us.googleusercontent.com/Yy6SnXeXmnZCCerID74n0AYcN1wkDwqQTJMnQEpD8vnccLBVVi4UBAvwoz4C-lHuwQ-ly59-2B6ZZUa2zjYDtf5nGM_kWHJh22TayDXC47YxpSzTvioREJwyNfWnsTs1OIC3s4i9ZjyAkjsEfr2TFqU" alt=""/><figcaption>Figure 21: Datasheet specified RESET to be held high. Specify static pins in the <strong>Static Pins</strong> tab.</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure22"><img src="https://lh7-us.googleusercontent.com/WSy2PV5rJ9JDEzeS5umeHsrRgp8fCKUlnbHMVxSNpjCxzZFjGOfdi69UbWSu9UpJTACCCjzFLGkj8hHZtudsJhAero8VR586_bo6Lh35B0eHWqyYuqIBDd3jPtJGLAPEtWAA5GEhbiy-HNiY8M2BL90" alt=""/><figcaption>Figure 22: Set up flash array upon BUS organization and flash orientation (mine was 16-bit and 16-bit maximum capable). This can be trial and error.</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure23"><img src="https://lh7-us.googleusercontent.com/qbkpGZ3tOk43ULG4cux_L_d1PTacTRIMSgYV0igFjloPaI49PCrGQCMcm6LvJB2MtASe_EwZ3mMX9Zi08EzvO1A5pqvtHJp3212UKxPIWjLy53vuo0s381kgKfmp08n7nt7DWUnhbPYNQsDD6bSU44s" alt=""/><figcaption>Figure 23: Clicking <strong>Info</strong> in the toolbar at the top of TopJTAG enumerates the flash chip and provides information about it. </figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure><img src="https://lh7-us.googleusercontent.com/o71Qf67ZXfbpEm_cuKYE7r8VvKy2csF1207UlqLL4BtbJjRQDd4HtlNQJR5Bv3m6npGBFIOCsej_qiUX6OxHfReybau-hPAZWdDlmHQ3Cbzd55mlYkZz0Q8r-SGc4d40ZHbOdG_PtIxop2MAmnQMb1g" alt=""/></figure>
<!-- /wp:image -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure24"><img src="https://lh7-us.googleusercontent.com/KMOruJJHL_S0bVHtwE5ddpgJti1x0BKI-YigbJRjQXYt41ZmhLpchCtgSm4Nw9RCJwYSzzLvfmXeHY4lsx59T334HHlpYjYFs9Ku5sqMvXiSDT6bCcF4qGrmSuXvY9-vt7cwFS9f7_0j79raZI_VDB0" alt=""/><figcaption>Figure 24: Clicking read and read all produces the binary image on flash</figcaption></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":3} -->
<h3 id="UrJTAG">UrJTAG</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Until now, this post has demonstrated the tool TopJTAG, which is typically used in a Windows environment. In this section, we demonstrate using the tool UrJTAG in a Linux environment.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Start by installing UrJTAG with sudo apt install urjtag. After installing, plug in your board with the flash chip attached and mapped out. Refer above for mapping and connecting components. After connecting everything, run jtag as root. This drops you into a JTAG REPL. You can issue commands to the board now and are able to interact with the hardware as necessary.</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center"} -->
<figure id="Figure25"><img src="https://lh7-us.googleusercontent.com/gi_PF4NnIfhYFZk3sEo4M0ZhowZfvLKothLS_Wt6KV2mqdOCf_tlLk7-Vw1Sjds374giCGWnJBhhPNwI4zLBdnNVRw0TjxpVo95BE4QLCNg01_sgK06bk_EsRxSELN3J0hj3k024PudLoPt38so_mnw" alt=""/><figcaption>Figure 25: UrJTAG REPL</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>With UrJTAG up and running, you must specify an interface to connect to the board. WIthout a method of communicating with the board, UrJTAG cannot issue commands. In this case, I am using an Altera USBBlaster. There are many knockoffs out there and they are dirt cheap. Typing <strong>help cable</strong> lists all available interfaces. </p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure26"><img src="https://lh7-us.googleusercontent.com/d7RvdoIUSAIzJxFCM-RKvgrlJGOC1uXqMfv8lq5lM1YmYNJRsMYfpiKoQrzHSR91Tiu9WULUT3HdmiGkoSDxdiYmc07VnX9cZjGJ39Uo29Y3d_O7SRBh6NjYFawHlSJdNjK4uv4hj7aGdllY2BtJSYI" alt=""/><figcaption>Figure 26: If properly connected, a message like this displays</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure27"><img src="https://lh7-us.googleusercontent.com/FznsMUMw4BFaahETSVe9FMcMZHDxMWwIzJO2IHi892iYkGIhuL2AyuFdYx7HmG3o9q-DWwBNuyjaRfISRaE_RzSI6XBlp1JKvpfnUA-KxejDPoHeni47t847nLCFW-SLZqQtbV3_nQcdp6frIHI5Jg4" alt=""/><figcaption>Figure 27: Running <strong>detect</strong> picks up the JTAG chain</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>To create a bus in UrJTAG with what is known as the prototype function, some editing must be done to the pins detected from the BSDL file. I/O pins must be named into whatever bus they connect to. <a href="#Figure28">Figure 28</a> below is an example from the UrJTAG documentation. </p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure28"><img src="https://lh7-us.googleusercontent.com/6AOpaRimJNFxSDcgXDWPiMklRH-9JmVdhUFVjze1EdvnAjKZqolK3gAAfqNvz8MmGuq2uREG_tbiXlX_61W4Y6GOdutQtXdkrpXZdhZ8pu-8lLtJen8DI0ZanzgUbRi7pjW45pqDYz-s_YTniWFZo-A" alt=""/><figcaption>Figure 28: Pin names in BSDL file pertaining to flash</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Looking at <a href="#Figure17">Figure 17</a>, you can remap the pins using the salias command so they fit the UrJTAG naming convention to initialize the flash memory. Salias creates a signal alias for the pin and changes the name in the instance of UrJTAG open. The syntax is salias rename currentname. The figure below shows a screenshot of how I mapped my pins.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure29"><img src="https://lh7-us.googleusercontent.com/Ei5r2bd3-Dax_rY9T6r1KuqjdL97BPeCEZ7GFA7eBF87sUbOTMfUw50aOyP-s1o_1-guM4xkx9ruw1i_-tU0vxHifzBxkXPX3K6OJWpx0c9msuM8H7lppyWJ9pfTKuo-YjWLgg7yF5N0C-iC22hf6Hw" alt=""/><figcaption>Figure 29: Renaming pins to use with UrJTAG initbus prototype function</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Then, depending on your datasheet, you can use the set command in UrJTAG to put pins in a high or low state. In this case, looking at <a href="#Figure7">Figure 7</a>, I must put my CE and OE low and RESET and WE high. You can try to use the format in UrJTAG to do this, but I found just setting the pins themselves easiest. I referred to <a href="#Figure17">Figure 17</a> to where these pins connected.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure30"><img src="https://lh7-us.googleusercontent.com/8zelK3w3wj6gYR-Inr-rNb9cyNi6O9GBGEnVmFhMsz-dx1dL82MfZ8KY3OB60C-6XjDNohvpPxcfp6yDWlTQG9fQCBU8a8h2e205hejvgVwf_HxNGdiemIzXWGCdWYJjWpsXR325XNtu_LT8ABoQrhI" alt=""/><figcaption>Figure 30: Setting pins CE, OE, RESET, and WE to their values to read</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>After this you can initialize the bus using the initbus prototype command. Some JTAG devices have the EJTAG ability and can bypass this method. Please refer to Joe Grand’s video (<a href="https://youtu.be/IadnBUJAvks?feature=shared">https://youtu.be/IadnBUJAvks?feature=shared</a>) about the JTAGulator as he shows how to use the EJTAG functionality. Because the CE, OE, and WE pins were set to desired values, they can be grounded out in the initbus command. The format for this command is initbus prototype asmb=highestaddresspin alsb=lowestaddresspin dmsb=highestdatapin dlsb=lowestdatapin cs=gnd oe=gnd we=gnd amode=youroperationmode. </p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure31"><img src="https://lh7-us.googleusercontent.com/K1H3EoCguzA8xpNN63Z_N-yVvmR4atfxhZrGRyO0KsJAUFcMpWk3Pkmmw1WtUXxnj0eg8jTFg6hD-kYDIEmzjHSSgBVavFk6j7EyXJwFIuHio_toGHzRG4EeuaROZp2qr2m--9p3ntx-TITLpmn5RbQ" alt=""/><figcaption>Figure 31: Initbus command using 16-bit operation</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>A bus should now be initialized and the command readmem in UrJTAG can automatically read the memory. It sends the required data across the JTAG lines to instruct the JTAG-compatible device to send addresses to the flash and read the data pins out to the application. The format to readmem is readmem startaddr size outputfile. In this case, I was reading 2097152 total bytes.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure32"><img src="https://lh7-us.googleusercontent.com/ll3H-NOm-Q8zhIloEdyhEkR08ITrf6cP-ye-UXrkgMYK5dNxfC6RSiTlMV3MHYN5nYWc6Jd3jAV4M1aUwaCdKTT9LcTRHRy2WzmbrUsGriDv200vSujPlrHyOsSgFsM_E6DJywyhymbOundjHvWIvMY" alt=""/><figcaption>Figure 32: Reading out the flash memory</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>After the flash has been read, there should be a prompt that states done. This means the flash memory has been dumped if all steps were followed correctly. </p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Some Binary Enumeration</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Running some simple commands can give more insight on what may be stored on the device. In this case, the flash was removed from the Linksys router imaged in <a href="#Figure2">Figure 2</a>. Unfortunately, the Oppo DVD player in <a href="#Figure1">Figure 1</a> was sacrificed in the making of this blog :(. This was due to a mismatch of pins and can be avoided by using schematics and boards with strong, contrasted silkscreens to avoid pin confusion. Examining the dump with a simple cat, hexedit, or xxd and head can display if what was read is legitimate data. </p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure33"><img src="https://lh7-us.googleusercontent.com/eBGaRQbV5b7D0kOX1EFBHy_8cXbqfRo8ZVYJHL7jdA3U2MZh2hVS9xRDKVhaMupDRerE70uDl79ap-H0Pw5j5hmhZ2SZ-2NVvC0jjq0KUORQnfVGdO3tdki8N5OBzluxbeaKM6kETxubrZVEZGWo8uE" alt=""/><figcaption>Figure 33: Hexedit displaying data from the dump</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>This is a good sign. Failures in reads or misconfigurations result in repeating characters, 0s or FFs depending on the state and failure. Binaries may have magic numbers, repeating hex, empty space (filled with 0xFF), and repeating characters as in the figure above. It is important to understand that consistent patterns of the same hex value may be a failed dump if the entire file is filled with the same data. If the entire read is failed, all data in the dump may look like what is shown in the following figure. </p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure id="Figure34"><img src="https://lh7-us.googleusercontent.com/FLSNhui4YZo-rRNjZfArncp0trIctOIhj541KbhGyUdCpUNE9SBNkuhJkd5H0wkR9nHlne5dv9P9rfXTT2nFHp9R6_VFGEaS1pzj5xraxWUxj1s_fHSJBuZ3SNZnK96-IUBfpqbSESaVb6HXkAsigWU" alt=""/><figcaption>Figure 34: Possible failed flash read</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->

<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>It is possible the flash may have sections that are filled with no data, so it is important to look throughout the flash for non-repeating patterns and strings. To see if parsable files with known formats are in the dump, use binwalk, which looks for file magic (headers) and sizes and can extract them for further analysis. Syntax to extract is binwalk -e filename. The figure below shows an output of files extracted from the dump. </p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":477,"sizeSlug":"large","linkDestination":"none"} -->
<figure id="Figure35"><img src="https://zetier.com/wp-content/uploads/2024/02/BinwalkMemdump-1024x328.png" alt=""/><figcaption>Figure 35: Binwalk output files from flash memory dump</figcaption></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>There may be some data hiding in other locations or you may need to extract files using data duplicator (also known as dd). In this case, the data was extracted successfully through JTAG and confirmed using these tools. If you are getting strange results, check the pinout and your connection points as simple movements such as plugging in one pin can cause another pin to disconnect and errors with the read.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Conclusion</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>With some superglue after a successful read, you can put your adapter permanently on the board and have a crude parallel NOR programmer. This method is a quick, cheap, and dirty way to get data in a pinch or time crunch and teaches engineers and enthusiasts about tools they can use with the JTAG chain. These tools can also be used to communicate with other hardware devices and components directly connected to the I/O pins on a board. I encourage readers to try to communicate with components connected other than flash memory.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you found this article interesting or have any questions, please email us at <a href="mailto:hello@zetier.com">hello@zetier.com</a>.</p>
<!-- /wp:paragraph -->					
	</div>
</section></div>
  </body>
</html>
