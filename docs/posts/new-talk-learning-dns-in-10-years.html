<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jvns.ca/blog/2023/05/08/new-talk-learning-dns-in-10-years/">Original</a>
    <h1>New talk: Learning DNS in 10 years</h1>
    
    <div id="readability-page-1" class="page"><div>
     

<p>Here’s a keynote I gave at <a href="https://www.rubyconfmini.com/">RubyConf Mini</a> last year: Learning DNS in 10 years.
It’s about strategies I use to learn hard things. I just noticed that they’d
released the video the other day, so I’m just posting it now even though I gave
the talk 6 months ago.</p>

<p>Here’s the video, as well as the slides and a transcript of (roughly) what I
said in the talk.</p>

<h3 id="the-video">the video</h3>

<iframe width="560" height="315" src="https://www.youtube.com/embed/tsxjNsFu_2g" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>

<h3 id="the-transcript">the transcript</h3>



<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-01.png"><img src="https://jvns.ca/images/2022-railsconf/slide-01.png"/></a>
</p>

</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-02.png"><img src="https://jvns.ca/images/2022-railsconf/slide-02.png"/></a>
</p>
<p>
You all got this zine (<a href="https://wizardzines.com/zines/dns/">How DNS Works</a>) in your swag bags -- thanks to RubyConf for printing it!


</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-03.png"><img src="https://jvns.ca/images/2022-railsconf/slide-03.png"/></a>
</p>
<p>
But this talk is
not really about DNS. I mean, this is a Ruby conference, right? So this talk is
really about learning hard things, and DNS is an example of something that was
hard for me to learn. </p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-04.png"><img src="https://jvns.ca/images/2022-railsconf/slide-04.png"/></a>
</p>
<p>
It took me maybe 16 years from the first time
that like I bought a domain name and set up my DNS records to when I really
felt like I understood how the system worked.

</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-05.png"><img src="https://jvns.ca/images/2022-railsconf/slide-05.png"/></a>
</p>
<p>
And one thing I want to say at the beginning of this talk, is that I think that
taking like 16 years to learn something like DNS is kind of normal. The idea
that &#34;I should understand this already&#34; is a bit silly. For me, I was doing
other stuff for most of the 16 years! There was other stuff I wanted to learn.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-06.png"><img src="https://jvns.ca/images/2022-railsconf/slide-06.png"/></a>
</p>
<p>
And so, this talk is not about how you should learn about any particular
thing. I don&#39;t care if you learn how DNS works! It&#39;s really about how to
approach learning something hard that&#39;s a priority for you to learn.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-07.png"><img src="https://jvns.ca/images/2022-railsconf/slide-07.png"/></a>
</p>
<div>
<p>
So, we&#39;re going to talk about learning through
a series of tiny deep dives. My favorite way of learning things is to do
nothing, most of the time. 
</p>

<p>
That&#39;s why it takes 10 years.
</p>

<p>
So for six months I&#39;ll do nothing and then like I&#39;ll furiously learn something
for maybe 30 minutes or three hours or an afternoon. And then I&#39;ll declare
success and go back to doing nothing for months. I find this works really well
for me.
</p>




</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-08.png"><img src="https://jvns.ca/images/2022-railsconf/slide-08.png"/></a>
</p>
<div>
<p>
Here are some of the strategies we&#39;re going to talk about for doing these tiny deep dives
</p>

<p>
First, we&#39;re going to start briefly by talking about what DNS is.
</p>


<p>
Next, we&#39;re going to talk about spying on DNS.
</p>
<p>
Then we&#39;re gonna talk about being confused, which is my main mode. (I&#39;m always confused about something!)
</p>
<p>
Then we&#39;ll talk about reading the specification, we&#39;ll going to
do some experiments, and we&#39;re going to implement our own terrible version
of DNS.
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-09.png"><img src="https://jvns.ca/images/2022-railsconf/slide-09.png"/></a>
</p>
<p>
And so what&#39;s DNS really briefly? DNS stands for the Domain Name System. And
every time you go to a website like <code>www.example.com</code>, your browser
needs to look up that website&#39;s IP address. So DNS translates
domain names into IP addresses. It looks up other information about domain
names too, but we&#39;re mostly just going to talk about IP addresses today.

</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-10.png"><img src="https://jvns.ca/images/2022-railsconf/slide-10.png"/></a>
</p>
<p>
I want to briefly sell why I think DNS is cool, because we&#39;re going to be
talking about it a lot. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-11.png"><img src="https://jvns.ca/images/2022-railsconf/slide-11.png"/></a>
</p>
<p>
One cool thing about DNS is that it&#39;s this invisible system that controls the
entire internet.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-12.png"><img src="https://jvns.ca/images/2022-railsconf/slide-12.png"/></a>
</p>
<div>
<p>
For example, you&#39;re on your phone, you&#39;re using Google Maps, it needs to know,
where is maps.google.com, right? Or on your
computer, where&#39;s reddit.com? What&#39;s the IP address? And if we
didn&#39;t have DNS, the entire internet
would collapse. 
</p>

<p>
I think it&#39;s fun to learn how this behind the scenes stuff works. 
</p>

</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-13.png"><img src="https://jvns.ca/images/2022-railsconf/slide-13.png"/></a>
</p>
<div>

<p>
The other thing about DNS I find interesting is that it&#39;s really old. There&#39;s
this document (<a href="https://datatracker.ietf.org/doc/html/rfc1035">RFC
1035</a>) which defines how DNS works, that was written in 1987. And if
you take that document and you write a program that works
the way that documents says to work, your program will work. And I think
that&#39;s kind of wild, right? 
</p>


<p>
The basics haven&#39;t changed since before I was born. So if you&#39;re a little slow
about learning about it, that&#39;s ok: it&#39;s not going to change out from under
you.
</p>

</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-14.png"><img src="https://jvns.ca/images/2022-railsconf/slide-14.png"/></a>
</p>
<p>
Next I want to talk about spying on DNS, which is one of my favorite ways to
learn about things. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-15.png"><img src="https://jvns.ca/images/2022-railsconf/slide-15.png"/></a>
</p>
<p>
I&#39;m going to talk about two spy tools for DNS: dig and wireshark.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-16.png"><img src="https://jvns.ca/images/2022-railsconf/slide-16.png"/></a>
</p>
<p>
dig is a tool for making DNS queries. We talked about you know, how your
browser needs to look up the IP address for <code>maps.google.com</code>. We
can do that in dig!
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-dig.png"><img src="https://jvns.ca/images/2022-railsconf/demo-dig-small.png"/></a>
</p>
<p>
When we run <code>dig maps.google.com</code>, it prints out 5 fields.  Let&#39;s
talk about what those 5 fields are.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-17.png"><img src="https://jvns.ca/images/2022-railsconf/slide-17.png"/></a>
</p>
<div>
<p>
I&#39;ve used example.com instead of maps.google.com on this slide, but the fields
are the same. Let&#39;s talk about 4 of them:
</p>

<p> We have the domain name, no big deal </p>
<p> The Time To Live, which is how long to cache that record for so this is a one day </p>
<p> You have the record type, A stands for address because this is an IP address </p>
<p> And you have the content, which is the IP address </p>

</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-18.png"><img src="https://jvns.ca/images/2022-railsconf/slide-18.png"/></a>
</p>
<p>
But I think that the funniest field in a DNS record
is this field in the middle, IN, which stands for INternet. I guess in 1987, they thought that we might be on a lot of
different networks. So they made an option for it. In reality, we&#39;re all on the
internet. And every DNS query has class set to &#34;internet&#34;. There are a couple of
others query classes (CHAOS and HESIOD), which truly almost nobody uses.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-dig2.png"><img src="https://jvns.ca/images/2022-railsconf/demo-dig2-small.png"/></a>
</p>
<p>
We can also kind of poke around on the
internet with Dig. We&#39;ve talked about A records to look up IP addresses. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-dig3.png"><img src="https://jvns.ca/images/2022-railsconf/demo-dig3-small.png"/></a>
</p>
<div>
<p>
But there are
other kinds of records like TXT records. So we&#39;re going to look at a TXT record
really quickly just because I think this is very fun. We&#39;re going to look at twitter.com&#39;s TXT records.
</p>

<p>
So TXT records are something that people use for domain verification, for
example to prove to Google that you own twitter.com. 
</p>

<p>
So what you can do is you can set this DNS
record <code>google-site-verification</code>. Google will tell you what to set
it to, you&#39;ll set it, and then Google will believe you.
</p>

<p>
I think it&#39;s kind of fun that you can
like kind of poke around with DNS and see that Twitter is using
Miro or Canva or Mixpanel, that&#39;s all public. It&#39;s like a little peek into what
people are doing inside their companies
</p>


</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-dig4.png"><img src="https://jvns.ca/images/2022-railsconf/demo-dig4-small.png"/></a>
</p>
<p>
 
Oh, the other thing about dig is that by default, dig&#39;s output looks like
this, which is very ugly and unreadable. There&#39;s a lot of nonsense here.

</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-19.png"><img src="https://jvns.ca/images/2022-railsconf/slide-19.png"/></a>
</p>
<p>

So dig has a configuration file, where you can put <code>+noall +answer </code> and
then your dig responses look much nicer (like they did in the screenshots
above) instead of having a lot of nonsense in them. Whenever possible, I try to
make my tools behave in a more human way.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-20.png"><img src="https://jvns.ca/images/2022-railsconf/slide-20.png"/></a>
</p>
<p>
The other thing I want to talk about is Wireshark, which
is my favorite computer networking tool in the universe for spying on 
all things computer networks. In this case, DNS queries. So let&#39;s go look at
Wireshark.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-21.png"><img src="https://jvns.ca/images/2022-railsconf/slide-21.png"/></a>
</p>

</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-wireshark1.png"><img src="https://jvns.ca/images/2022-railsconf/demo-wireshark1-small.png"/></a>
</p>
<p>
When we make a DNS query like this and look up example.com, Wireshark can capture it.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-wireshark2.png"><img src="https://jvns.ca/images/2022-railsconf/demo-wireshark2-small.png"/></a>
</p>
<p>
When you 
start looking in the guts of things, I think it can be a bit scary at first. Like
what do all these numbers? It kind of seems
like a lot. So when I&#39;m looking at something new, I try to start by looking at stuff
that I understand. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-wireshark3.png"><img src="https://jvns.ca/images/2022-railsconf/demo-wireshark3-small.png"/></a>
</p>
<p>
For example, I know that example.com is a domain name,
right? So we should able to use Wireshark to go find that domain name in the
DNS query. If we click into the &#34;query&#34; part of the DNS packet, we can see 3
fields that we recognize. First, the domain name.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-wireshark4.png"><img src="https://jvns.ca/images/2022-railsconf/demo-wireshark4-small.png"/></a>
</p>
<p>
We can also see the type (&#34;A&#34;)
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-wireshark5.png"><img src="https://jvns.ca/images/2022-railsconf/demo-wireshark5-small.png"/></a>
</p>
<p>
And the third one is the class which
is INternet, which is always the same. What I find comforting here is that in
the query, there are really only 2 important fields: a DNS query is just saying &#34;I want
the IP address for example.com&#34;. There&#39;s just two fields. And that that always
makes me feel a little bit better about understanding something. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-22.png"><img src="https://jvns.ca/images/2022-railsconf/slide-22.png"/></a>
</p>
<p>
A quick caveat: your browser might be using encrypted DNS and spying on your
DNS queries with Wireshark will not work if your DNS is encrypted. But there&#39;s
lots of non-encrypted DNS to spy on.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-23.png"><img src="https://jvns.ca/images/2022-railsconf/slide-23.png"/></a>
</p>
<p>
The second thing I want to talk about for learning new things is to
notice when you&#39;re confused about something.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-24.png"><img src="https://jvns.ca/images/2022-railsconf/slide-24.png"/></a>
</p>
<p>

I want to tell you a story, &#34;the case of the mysterious caching&#34;, of something
that happened to me with DNS that really confused me.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-25.png"><img src="https://jvns.ca/images/2022-railsconf/slide-25.png"/></a>
</p>
<p>

First, I want to talk to you a little
bit about how DNS works a little bit more. So on the left here, you have your
browser. And when your browser makes a DNS query, it asks a server called a
resolver. And all you need to know about the resolver is that it&#39;s cache, which
as we know is like the worst thing in computer science. So the resolver is a cache,
and it gets its information from the source of truth, which has the real answers.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-26.png"><img src="https://jvns.ca/images/2022-railsconf/slide-26.png"/></a>
</p>
<p>
So your browser talks to a resolver, which is a cache.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-27.png"><img src="https://jvns.ca/images/2022-railsconf/slide-27.png"/></a>
</p>
<p>
At the time of this story, I had this mental model for like how I thought about
DNS, which is that if I set a TTL (the cache time) of 5 minutes when configuring my DNS records,
then I would never have to wait more than five minutes. Something you need to
know about me is that I&#39;m a very impatient person. And I hate waiting. So this
model was mostly working for me at the time, though there are a few other very
important caveats that we&#39;re not going to get into.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-28.png"><img src="https://jvns.ca/images/2022-railsconf/slide-28.png"/></a>
</p>
<p>

But one day I was setting up a new subdomain for some new project. Let&#39;s say it
was new.jvns.ca. So I set it up. I made its DNS records, and I refreshed the
page. And it wasn&#39;t working. So I figured, that&#39;s fine, my model says, I only
have to wait five minutes, right? Because that&#39;s what I was used to. But I
waited five minutes and still didn&#39;t work.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-29.png"><img src="https://jvns.ca/images/2022-railsconf/slide-29.png"/></a>
</p>
<p>
And I was like, oh, no. My mental model was broken! I did not feel good.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-30.png"><img src="https://jvns.ca/images/2022-railsconf/slide-30.png"/></a>
</p>
<p>

And often when this happens to me, and I think for most of us, if something
weird happens with a computer, you let it go, right? You might decide okay, I
don&#39;t have time to go into a deep investigation here. I&#39;ll just wait longer. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-31.png"><img src="https://jvns.ca/images/2022-railsconf/slide-31.png"/></a>
</p>
<p>
But sometimes I
have a lot of energy, and maybe I&#39;m feeling mad, like &#34;the computer
can&#39;t beat me today&#34;! Because there&#39;s a reason that this is happening, right? And I
want to find out what it is. So this day for some reason. I had a lot
of energy. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-32.png"><img src="https://jvns.ca/images/2022-railsconf/slide-32.png"/></a>
</p>
<p>
So I started Googling furiously. And I found a useful comment on Stack
Overflow.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-33.png"><img src="https://jvns.ca/images/2022-railsconf/slide-33.png"/></a>
</p>
<p>
The Stack Overflow comment talked about something called negative caching.
What&#39;s that?
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-34.png"><img src="https://jvns.ca/images/2022-railsconf/slide-34.png"/></a>
</p>
<div>

<p>
And so here&#39;s what it said might be going on. The first time I opened the
website (before the DNS records had been set up), the DNS servers returned a
negative answer, saying hey,this domain doesn&#39;t exist yet. The code for that is
NXDOMAIN, which is like a 404 for DNS.
</p>

<p>
And the resolver cached that negative NXDOMAIN response. So the fact that it
didn&#39;t exist was cached.
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-35.png"><img src="https://jvns.ca/images/2022-railsconf/slide-35.png"/></a>
</p>
<p>
So my next question was: how long do I have to wait for the cache to expire? 
This brings us to a another learning technique.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-36.png"><img src="https://jvns.ca/images/2022-railsconf/slide-36.png"/></a>
</p>
<p>

I think like maybe the
most upsetting learning technique to me is to read a very boring
technical document. I&#39;m like very impatient. I kind of hate
reading boring things. And so when I read something very boring, I like to
bring a specific question. So in this case, I had a specific question, which is
how long do I have to wait for the cache to expire?
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-37.png"><img src="https://jvns.ca/images/2022-railsconf/slide-37.png"/></a>
</p>
<div>
<p>
In networking, everything has a specification. The boring technical documents
are called RFC is for request for comments. I find this name a bit funny,
because for DNS, some of the main RFCs are RFC 1034 and 1035. These were written in 1987,
and the comment period ended in 1987. You can definitely no longer make
comments. But anyway, that&#39;s what they&#39;re called.
</p>

<p>
I personally kind of love
RFCs because they&#39;re like the ultimate answer to many questions. There&#39;s a
great series of HTTP RFCs, 9110 to 9114. DNS actually has a million
different RFCs, it&#39;s very upsetting, but the answers are often there. So I went
looking. And I think I went looking because when I read comments on
StackOverflow, I don&#39;t always trust them. How do I know if they&#39;re accurate? So
I wanted to go to an authoritative source.
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-38.png"><img src="https://jvns.ca/images/2022-railsconf/slide-38.png"/></a>
</p>
<p>
So I found this document called RFC 2308. In section 3, it has this very boring
sentence, the TTL of this record is set to the minimum of the minimum field of the
SOA record and the TTL of the SOA itself. It indicates how long a resolver may
cache the negative answer. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-39.png"><img src="https://jvns.ca/images/2022-railsconf/slide-39.png"/></a>
</p>
<div>
<p>
So, um, ok, cool. What does that mean, right? Luckily, we only have one
question: I don&#39;t need to read the entire boring document. I just need to like
analyze this one sentence and figure it out.
</p>

<p>
So it&#39;s saying that the cache time depends on two fields. I want to show you
the actual data it&#39;s talking about, the SOA record.
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-negative-caching.png"><img src="https://jvns.ca/images/2022-railsconf/demo-negative-caching-small.png"/></a>
</p>
<p>

Let&#39;s look at what happens when we run <code>dig +all asdfasdfasdfasdfasdf.jvns.ca</code>

It says that the domain doesn&#39;t exist, NXDOMAIN. But it also returns this
record called the SOA record, which has some domain metadata. And there are two
fields here that are relevant.

</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-40.png"><img src="https://jvns.ca/images/2022-railsconf/slide-40.png"/></a>
</p>
<div>

<p>
Here. I put this on a slide to try to make it a little bit clearer. This slide
is a bit messed up, but there&#39;s this field at the end that&#39;s called the MINIMUM
field, and there&#39;s the TTL, time to live of the record, that I&#39;ve tried to
circle.
</p>

<p>
And what it&#39;s saying is that if a record doesn&#39;t exist, the amount of time the
resolver should cache &#34;it doesn&#39;t exist&#34; for is the minimum of those two numbers.
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-41.png"><img src="https://jvns.ca/images/2022-railsconf/slide-41.png"/></a>
</p>
<p>

In this case, both of those numbers are 10800. So that&#39;s how long have to
wait. We have to wait 10,800 seconds. That&#39;s 3 hours.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-42.png"><img src="https://jvns.ca/images/2022-railsconf/slide-42.png"/></a>
</p>
<p>
And so I waited three hours and then everything worked. And I found this
kind of fun to know because often like if you look up DNS advice it will
say something like, if something has gone wrong, you need to wait 48 hours. And I
do not want to wait 48 hours! I hate waiting. So I love it when I
can like use my brain to figure out that I can wait for less time.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-43.png"><img src="https://jvns.ca/images/2022-railsconf/slide-43.png"/></a>
</p>
<div>


<p>Sometimes when I find my mental model is broken, it feels like I don&#39;t know
anything</p>

<p>
But in this case, and I think in a lot of cases, there&#39;s often just a few
things I&#39;m missing? Like this negative caching thing is like kind of weird, but
it really was the one thing I was missing. There are a few more important facts about how
DNS caching works that I haven&#39;t mentioned, but I haven&#39;t run into more
problems I didn&#39;t understand since then. Though I&#39;m sure there&#39;s something I
don&#39;t know.
</p>


<p>
So sometimes learning one small thing really can solve all your problems.
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-44.png"><img src="https://jvns.ca/images/2022-railsconf/slide-44.png"/></a>
</p>
<p>

I want to say briefly that there&#39;s a solution to this negative caching problem.
We talked about how like if you visit a domain that&#39;s nonexistent, it gets
cached. The solution is if you haven&#39;t set up your domain&#39;s DNS, don&#39;t visit
the domain! Only visit it after you set it up. So I&#39;ve learned to do that and
now I almost never have this problem anymore. It&#39;s great.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-45.png"><img src="https://jvns.ca/images/2022-railsconf/slide-45.png"/></a>
</p>
<p>
The next thing I want to talk about is doing experiments.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-46.png"><img src="https://jvns.ca/images/2022-railsconf/slide-46.png"/></a>
</p>
<p>
So let&#39;s say we want to do some experiments with caching. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-47.png"><img src="https://jvns.ca/images/2022-railsconf/slide-47.png"/></a>
</p>
<p>
I think most people don&#39;t want to make experimental changes to their domain
names, because they&#39;re worried about breaking something. Which I think is very understandable.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-48.png"><img src="https://jvns.ca/images/2022-railsconf/slide-48.png"/></a>
</p>

</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-mess1.png"><img src="https://jvns.ca/images/2022-railsconf/demo-mess1-small.png"/></a>
</p>
<div>

<p>
Because I was really into DNS, I wanted to experiment with DNS. And I also
wanted other people to experiment with DNS without having to worry about
breaking something. So I made this little website with my friend, Marie, called
<a href="https://messwithdns.net">Mess with DNS</a>
</p>

<p>
The idea is,  if you don&#39;t want to do that DNS experiments on your domain, you
can do them on my domain. And if you mess something up, it&#39;s my problem, it&#39;s
not your problem. And there have been no problems, so that&#39;s
fine.
</p>

<p>
So let&#39;s use Mess With DNS to do a little DNS experimentation
</p>

</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-mess2.png"><img src="https://jvns.ca/images/2022-railsconf/demo-mess2-small.png"/></a>
</p>
<p>

The way this works is you get a little subdomain. This one is
chair131.messwithdns.com. And then you can make DNS records on it and try
things out. Here we&#39;re making a record for test.char131.messwithdns.net, with
type A, the IP 7.7.7.7, and TTL 3000 seconds. 
        </p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-49.png"><img src="https://jvns.ca/images/2022-railsconf/slide-49.png"/></a>
</p>
<p>
What we would expect to see is that if we make a query to the resolver, then it
asks kind of like the source of truth, which we control. And we should expect
the resolver to make only one query, because it&#39;s cached. So I want to do an
experiment and see if it&#39;s true that we get only 1 query.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-mess3.png"><img src="https://jvns.ca/images/2022-railsconf/demo-mess3-small.png"/></a>
</p>
<p>
So I&#39;m going to make a few queries for it, with <code>dig @1.1.1.1 test.chair131.messwithdns.com</code>. 
I&#39;ve queried it a bunch of times, maybe 10 or 20.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-mess4.png"><img src="https://jvns.ca/images/2022-railsconf/demo-mess4-small.png"/></a>
</p>
<div>

<p>
Oh, cool. This isn&#39;t what I expected to see. This is fun, though, that&#39;s great.
We made about 20 queries for that DNS record. The server logs all queries it
receives, so we can count them.
Our server got 1, 2, 3, 4, 5, 6, 7, 8 queries. That&#39;s kind of fun. 8 is less than 20.
</p>

<p>
One reason I like to do demos live on stage is that sometimes what I what
happens isn&#39;t exactly what I think will happen. When I do this exact experiment
at home, I just get 1 query to the resolver.
</p>

<p>
So we only saw like eight queries here. And I assume that this is
because the resolver, 1.1.1.1, we&#39;re talking to has more than one
independent cache, I guess there are 8 caches. This makes sense to me because
Cloudflare&#39;s network is distributed -- the exact machines I&#39;m talking to here
in Providence are not the same as the ones in Montreal.
</p><p>
This is interesting because it complicates your idea about how caching works a
little bit, right? Like maybe a given DNS resolver actually has like eight
caches and which one you get is random, and you&#39;re not always talking
to the same one. I think that&#39;s what&#39;s going on here.
</p></div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-mess5.png"><img src="https://jvns.ca/images/2022-railsconf/demo-mess5-small.png"/></a>
</p>
<p>
We can also do the same experiment, but ask Google&#39;s resolver, 8.8.8.8, instead
of Cloudflare&#39;s resolver.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-mess6.png"><img src="https://jvns.ca/images/2022-railsconf/demo-mess6-small.png"/></a>
</p>
<p>
And we&#39;re seeing a similar thing here to what we saw with Cloudflare, there are
maybe 4 independent caches.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-50.png"><img src="https://jvns.ca/images/2022-railsconf/slide-50.png"/></a>
</p>
<p>
We could also do an experiment with negative caching, but no, I&#39;m not going to
do this demo. Sorry. I could just see it going downhill. The problem is that
there&#39;s too many different caches, and I really want there to be one cache, but
there&#39;s like seven. That&#39;s fine, let&#39;s move on.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-51.png"><img src="https://jvns.ca/images/2022-railsconf/slide-51.png"/></a>
</p>
<p>
Now I&#39;m going to talk
about my favorite strategy for learning about stuff, which is to
write my own very bad version of the thing. And I want to say that writing my
very bad implementation gives me a really unreasonable amount of confidence. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-52.png"><img src="https://jvns.ca/images/2022-railsconf/slide-52.png"/></a>
</p>
<p>
So you might think that writing DNS software is complicated, right? But it&#39;s
easier than you might think, as long as you keep your expectations low.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-53.png"><img src="https://jvns.ca/images/2022-railsconf/slide-53.png"/></a>
</p>
<p>
To make the DNS queries, the first thing we need to do is we need to
make a network connection. Let&#39;s do that.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-54.png"><img src="https://jvns.ca/images/2022-railsconf/slide-54.png"/></a>
</p>
<p>
These four lines of Ruby connect to 8.8.8.8, the Google DNS resolver, on UDP
port 53. Now we&#39;re like halfway there. So after we&#39;ve made a connection, 
we need to send Google a DNS query. You might be thinking, Julia, I
don&#39;t know how to write a DNS query.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-55.png"><img src="https://jvns.ca/images/2022-railsconf/slide-55.png"/></a>
</p>
<p>
But there&#39;s no problem. We can copy one from something else that knows what a
DNS query looks like. AKA Wireshark.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-write1.png"><img src="https://jvns.ca/images/2022-railsconf/demo-write1-small.png"/></a>
</p>
<p>
So if I right click on this DNS query, it&#39;s very small, but I&#39;m clicking on
&#34;copy&#34;, and then &#34;copy as hex stream&#34;.
You might not know what this means yet, but this is a DNS query. And
you might think that like, Hey, you can&#39;t just copy and paste something and
then send the exact same thing and it&#39;ll reply, but you can. And it works.

</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-56.png"><img src="https://jvns.ca/images/2022-railsconf/slide-56.png"/></a>
</p>
<p>

Here&#39;s what the code looks like to send this hex string we copied and pasted to 8.8.8.8.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-write2.png"><img src="https://jvns.ca/images/2022-railsconf/demo-write2-small.png"/></a>
</p>
<p>
So we take this like hex string that we copy and pasted, and paste it into our
tiny Ruby program, and use `.pack` to convert into a string of bytes and send it.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-write3.png"><img src="https://jvns.ca/images/2022-railsconf/demo-write3-small.png"/></a>
</p>
<p>
Now we run the Ruby program.

</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-write4.png"><img src="https://jvns.ca/images/2022-railsconf/demo-write4-small.png"/></a>
</p>
<div>
<p>
Let&#39;s go to Wireshark and look for the packet we just sent. And we can see it there! There&#39;s some other noise in between, so I&#39;ll stop the capture.
</p>

<p>
We can see that it&#39;s the same packet because the query ID matches, B962.
</p>

<p>
So we sent a query to Google the answer server and we got a response right? It
was like this is totally legitimate. There&#39;s no problem. It doesn&#39;t know that we copied and pasted it and that we have no idea what it means!
</p>

</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-57.png"><img src="https://jvns.ca/images/2022-railsconf/slide-57.png"/></a>
</p>
<p>
But we do want to know what this means, right? And so we&#39;ll take this hex string and split it into 2 parts. 
The first part is the header. And the second part is the
question, which contains the actual domain name we&#39;re looking up. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-58.png"><img src="https://jvns.ca/images/2022-railsconf/slide-58.png"/></a>
</p>
<div>

<p>
We&#39;re going to see how to construct these in Ruby, but first 
I want to talk about what a byte is for
one second. So this (b9) is the hexadecimal representation of a byte. The way
I like to look at figure out what that means is just type it into IRB, if
you type in 0xB9 it&#39;ll print out, that&#39;s the number 184.
</p>
<p>
So the question is 12 bytes
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-59.png"><img src="https://jvns.ca/images/2022-railsconf/slide-59.png"/></a>
</p>
<p>

Those 12 bytes correspond
six numbers, which are two bytes each. So the first number is the thing
<code>b962</code> which is the query ID. The next number is the flags, which
basically in this case, means like this is a query like hello, I have a
question. And then there&#39;s four more sections, the number of questions and then
the number of answers. We do not have any answers. We only have a question. So
we&#39;re saying, hello, I have one question. That&#39;s what the header means.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-60.png"><img src="https://jvns.ca/images/2022-railsconf/slide-60.png"/></a>
</p>
<div>

<p>
And the way that we can do this in Ruby, is we can make a little array that has the
query ID, and then these numbers which
correspond to the other the other header fields, the flags and then 1 for 1
question, and then three zeroes for each of the 3 sections of answers.
</p>


<p>
And then we need to tell Ruby how to take these like six numbers and
then represent them as bytes. So n here means each
of these is supposed to represent it as two bytes, and it also means to use big endian byte order.
</p>

</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-61.png"><img src="https://jvns.ca/images/2022-railsconf/slide-61.png"/></a>
</p>
<p>
Now let&#39;s talk about the question.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-62.png"><img src="https://jvns.ca/images/2022-railsconf/slide-62.png"/></a>
</p>
<div>
<p>
I broke up the question section here. There are two parts
you might recognize from <code>example.com</code>: there&#39;s example, and com. 
The way it works is that first you have a number (like 7), and then a
7-character string, like &#34;example&#34;. The number tells you how many characters to
expect in each part of the domain name. So it&#39;s 7, example, 3, com, 0.
</p>

<p>
And then at the end, you
have two more fields for the type and the class. Class 1 is code for
&#34;internet&#34;. And type 1 is code for &#34;IP address&#34;, because we want to look up the
IP address. is
</p>

</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-63.png"><img src="https://jvns.ca/images/2022-railsconf/slide-63.png"/></a>
</p>
<p>
So we can write a little bit of code to do this. If we want to translate
example.com into seven example three column zero, can like split the domain on
a dot and then like get its length and concatenate that together and put a 0 on
the end. It&#39;s just a little bit of Ruby. how to encode a domain name. 
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-64.png"><img src="https://jvns.ca/images/2022-railsconf/slide-64.png"/></a>
</p>
<p>
And then we can wrap all this up
together where we make a random query ID. And then you make
the header, encode the domain name, and then we add the type
and the class, 1 and 1, and then we can just
concatenate everything together and that&#39;s our query.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-65.png"><img src="https://jvns.ca/images/2022-railsconf/slide-65.png"/></a>
</p>
<p>
There&#39;s definitely more work to do here to print out the response, but I wrote
a 120-line Ruby script that parses the response too, and I want to show you a quick demo of it working.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/demo-write7.png"><img src="https://jvns.ca/images/2022-railsconf/demo-write7-small.png"/></a>
</p>
<p>

What domain should we look up&gt;. rubyconfmini.com. All right, let&#39;s do it. Hey, it works! </p>
</div>



<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-67.png"><img src="https://jvns.ca/images/2022-railsconf/slide-67.png"/></a>
</p>
<p>
We&#39;re at the end! Let&#39;s do a recap.
</p>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-68.png"><img src="https://jvns.ca/images/2022-railsconf/slide-68.png"/></a>
</p>
<div><p>

Okay. Let&#39;s go over the ways we&#39;ve talked about learning things!

</p><p>
First, spy on it. I find that when I look at things like
to see like really what&#39;s happening under the hood, and when I look at like,
what&#39;s in the bytes, you know what&#39;s going on? It&#39;s often like not as
complicated as I think. Like, oh, there&#39;s just the domain name and the
type. It really makes me feel far more confident that I understand that thing.
</p>

<p>
I try to notice when I&#39;m confused, and I want to say again, that 
noticing when you&#39;re confused is something that like we don&#39;t
always have time for right? It&#39;s something to do when you have the energy. For
example there&#39;s this weird DNS query I saw in one of the demos today that I
don&#39;t understand, but I ignored it because, well, I&#39;m giving a talk. But maybe one day I&#39;ll feel like looking at it.
</p>

<p>
We talked about reading the specification, which, there are few times I feel
like more powerful than when I&#39;m in like a discussion with someone, and I KNOW that I have the right answer because, well, I read the specification!
It&#39;s a really nice way to feel certain. 
</p>

<p>
I love to do experiments to check that my understanding of stuff is right. And
often I learn that my understanding of something is wrong! I had an example in
this talk that I was going to include and I did an experiment to check that
that example was true, and it wasn&#39;t! And now I know that. I love that
experiments on computers are very fast and cheap and usually have no
consequences.
</p>

<p>
And then the last thing we talked about and truly my favorite, but the most
work is like implementing your own terrible version. For me,
the confidence I get from writing like a terrible DNS implementation that works
on 11 different domain names is unmatched. If my thing works at all, I feel like,
wow, you can&#39;t tell me that I don&#39;t know how DNS works! I implemented it! And
it doesn&#39;t matter if my implementation is &#34;bad&#34; because I know that it works!
I&#39;ve tested it. I&#39;ve seen it with my own eyes. And I think that just feels
amazing. And there are also no consequences because you&#39;re never going to run
it in production. So it doesn&#39;t matter if it&#39;s terrible. It just exists to give
you huge amounts of confidence in yourself. And I think that&#39;s really nice.
</p>
</div>
</div>

<div>
<p><a href="https://jvns.ca/images/2022-railsconf/slide-69.png"><img src="https://jvns.ca/images/2022-railsconf/slide-69.png"/></a>
</p>
<p>
That&#39;s all for me. Thank you for listening.
</p>
</div>

<h3 id="thanks-to-the-organizers">thanks to the organizers!</h3>

<p>Thanks to the RubyConf Mini organizers for doing such a great job with the
conference – it was the first conference I’d been to since 2019, and I had a
great time.</p>

<h3 id="a-quick-plug-for-how-dns-works">a quick plug for “How DNS Works”</h3>

<p>If you liked this talk and want to to spend <em>less</em> than 10 years learning about
how DNS works, I spent 6 months condensing everything I know about DNS into 28
pages. It’s here and you can get it for $12: <a href="https://wizardzines.com/zines/dns/">How DNS Works</a>.</p>

</div></div>
  </body>
</html>
