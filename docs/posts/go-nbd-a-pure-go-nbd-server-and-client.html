<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/pojntfx/go-nbd">Original</a>
    <h1>Show HN: go-nbd â€“ A Pure Go NBD Server and Client</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/pojntfx/go-nbd/blob/main/docs/logo-readme.png"><img src="https://github.com/pojntfx/go-nbd/raw/main/docs/logo-readme.png" alt="Logo"/></a></p>
<p dir="auto">Pure Go NBD server and client library.</p>
<p dir="auto"><a href="https://github.com/pojntfx/go-nbd/actions/workflows/hydrun.yaml"><img src="https://github.com/pojntfx/go-nbd/actions/workflows/hydrun.yaml/badge.svg" alt="hydrun CI"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/43abec37b58d8a9d00e627741765353464fa6f94220ea399a8bc4213c34d320d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f676f25323076657273696f6e2d2533453d312e32302d3631434644442e737667"><img src="https://camo.githubusercontent.com/43abec37b58d8a9d00e627741765353464fa6f94220ea399a8bc4213c34d320d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f676f25323076657273696f6e2d2533453d312e32302d3631434644442e737667" alt="Go Version" data-canonical-src="https://img.shields.io/badge/go%20version-%3E=1.20-61CFDD.svg"/></a>
<a href="https://pkg.go.dev/github.com/pojntfx/go-nbd" rel="nofollow"><img src="https://camo.githubusercontent.com/e223925652eb192c8e9cd50f48c135ca3ee89384862a9a67c5b27d667f02637d/68747470733a2f2f706b672e676f2e6465762f62616467652f6769746875622e636f6d2f706f6a6e7466782f676f2d6e62642e737667" alt="Go Reference" data-canonical-src="https://pkg.go.dev/badge/github.com/pojntfx/go-nbd.svg"/></a>
<a href="https://matrix.to/#/#go-nbd:matrix.org?via=matrix.org" rel="nofollow"><img src="https://camo.githubusercontent.com/0e5105ade0708b611e3cd30ff0ab4d8351a8e02159ee03320acb5efb092e35dd/68747470733a2f2f696d672e736869656c64732e696f2f6d61747269782f676f2d6e62643a6d61747269782e6f7267" alt="Matrix" data-canonical-src="https://img.shields.io/matrix/go-nbd:matrix.org"/></a></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-overview" aria-hidden="true" href="#overview"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Overview</h2>
<p dir="auto">go-nbd is a lean NBD server and client library supporting the baseline protocol.</p>
<p dir="auto">It enables you to ...</p>
<ul dir="auto">
<li><strong>Build NBD servers and clients in Go:</strong> Develop Network Block Device servers and clients using the efficient and easy-to-understand Go programming language, without having to fallback to CGo.</li>
<li><strong>Expose any <code>io.ReadWriter</code> as a block device:</strong> Effortlessly turn a file, byte slice, S3 bucket or other <code>io.ReadWriter</code> into a fully-fledged block device.</li>
<li><strong>Bridge with legacy services:</strong> If you need to make your application&#39;s dynamic data available to a legacy system, providing a NBD interface can be the perfect solution.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">You can add go-nbd to your Go project by running the following:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ go get github.com/pojntfx/go-nbd/...@latest"><pre>$ go get github.com/pojntfx/go-nbd/...@latest</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<blockquote>
<p dir="auto">TL;DR: Define a backend, expose it with a server, connect a block device with the client and setup/mount the filesystem.</p>
</blockquote>
<h3 tabindex="-1" dir="auto"><a id="user-content-1-define-a-backend" aria-hidden="true" href="#1-define-a-backend"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>1. Define a Backend</h3>
<p dir="auto">First, define a backend; it should conform to this simple interface:</p>
<div dir="auto" data-snippet-clipboard-copy-content="type Backend interface {
	ReadAt(p []byte, off int64) (n int, err error)
	WriteAt(p []byte, off int64) (n int, err error)
	Size() (int64, error)
	Sync() error
}"><pre><span>type</span> <span>Backend</span> <span>interface</span> {
	<span>ReadAt</span>(<span>p</span> []<span>byte</span>, <span>off</span> <span>int64</span>) (<span>n</span> <span>int</span>, <span>err</span> <span>error</span>)
	<span>WriteAt</span>(<span>p</span> []<span>byte</span>, <span>off</span> <span>int64</span>) (<span>n</span> <span>int</span>, <span>err</span> <span>error</span>)
	<span>Size</span>() (<span>int64</span>, <span>error</span>)
	<span>Sync</span>() <span>error</span>
}</pre></div>
<p dir="auto">A simple file-based backend could look like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// server/main.go

type FileBackend struct {
	file *os.File
	lock sync.RWMutex
}

func NewFileBackend(file *os.File) *FileBackend {
	return &amp;FileBackend{file, sync.RWMutex{}}
}

func (b *FileBackend) ReadAt(p []byte, off int64) (n int, err error) {
	b.lock.RLock()

	n, err = b.file.ReadAt(p, off)

	b.lock.RUnlock()

	return
}

func (b *FileBackend) WriteAt(p []byte, off int64) (n int, err error) {
	b.lock.Lock()

	n, err = b.file.WriteAt(p, off)

	b.lock.Unlock()

	return
}

func (b *FileBackend) Size() (int64, error) {
	stat, err := b.file.Stat()
	if err != nil {
		return -1, err
	}

	return stat.Size(), nil
}

func (b *FileBackend) Sync() error {
	return b.file.Sync()
}"><pre><span>// server/main.go</span>

<span>type</span> <span>FileBackend</span> <span>struct</span> {
	<span>file</span> <span>*</span>os.<span>File</span>
	<span>lock</span> sync.<span>RWMutex</span>
}

<span>func</span> <span>NewFileBackend</span>(<span>file</span> <span>*</span>os.<span>File</span>) <span>*</span><span>FileBackend</span> {
	<span>return</span> <span>&amp;</span><span>FileBackend</span>{<span>file</span>, sync.<span>RWMutex</span>{}}
}

<span>func</span> (<span>b</span> <span>*</span><span>FileBackend</span>) <span>ReadAt</span>(<span>p</span> []<span>byte</span>, <span>off</span> <span>int64</span>) (<span>n</span> <span>int</span>, <span>err</span> <span>error</span>) {
	<span>b</span>.<span>lock</span>.<span>RLock</span>()

	<span>n</span>, <span>err</span> <span>=</span> <span>b</span>.<span>file</span>.<span>ReadAt</span>(<span>p</span>, <span>off</span>)

	<span>b</span>.<span>lock</span>.<span>RUnlock</span>()

	<span>return</span>
}

<span>func</span> (<span>b</span> <span>*</span><span>FileBackend</span>) <span>WriteAt</span>(<span>p</span> []<span>byte</span>, <span>off</span> <span>int64</span>) (<span>n</span> <span>int</span>, <span>err</span> <span>error</span>) {
	<span>b</span>.<span>lock</span>.<span>Lock</span>()

	<span>n</span>, <span>err</span> <span>=</span> <span>b</span>.<span>file</span>.<span>WriteAt</span>(<span>p</span>, <span>off</span>)

	<span>b</span>.<span>lock</span>.<span>Unlock</span>()

	<span>return</span>
}

<span>func</span> (<span>b</span> <span>*</span><span>FileBackend</span>) <span>Size</span>() (<span>int64</span>, <span>error</span>) {
	<span>stat</span>, <span>err</span> <span>:=</span> <span>b</span>.<span>file</span>.<span>Stat</span>()
	<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
		<span>return</span> <span>-</span><span>1</span>, <span>err</span>
	}

	<span>return</span> <span>stat</span>.<span>Size</span>(), <span>nil</span>
}

<span>func</span> (<span>b</span> <span>*</span><span>FileBackend</span>) <span>Sync</span>() <span>error</span> {
	<span>return</span> <span>b</span>.<span>file</span>.<span>Sync</span>()
}</pre></div>
<p dir="auto">See <a href="https://github.com/pojntfx/go-nbd/blob/main/pkg/backend">pkg/backend</a> for more backend examples.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-2-expose-the-backend-with-a-server" aria-hidden="true" href="#2-expose-the-backend-with-a-server"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>2. Expose the Backend With a Server</h3>
<p dir="auto">Next, create the backend and expose it with a server:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// server/main.go

b := NewFileBackend(f)

for {
	conn, err := l.Accept()
	if err != nil {
		continue
	}

	go func() {
		if err := server.Handle(
			conn,
			[]server.Export{
				{
					Name:        *name,
					Description: *description,
					Backend:     b,
				},
			},
			&amp;server.Options{
				ReadOnly:           *readOnly,
				MinimumBlockSize:   uint32(*minimumBlockSize),
				PreferredBlockSize: uint32(*preferredBlockSize),
				MaximumBlockSize:   uint32(*maximumBlockSize),
			}); err != nil {
			panic(err)
		}
	}()
}"><pre><span>// server/main.go</span>

<span>b</span> <span>:=</span> <span>NewFileBackend</span>(<span>f</span>)

<span>for</span> {
	<span>conn</span>, <span>err</span> <span>:=</span> <span>l</span>.<span>Accept</span>()
	<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
		<span>continue</span>
	}

	<span>go</span> <span>func</span>() {
		<span>if</span> <span>err</span> <span>:=</span> <span>server</span>.<span>Handle</span>(
			<span>conn</span>,
			[]server.<span>Export</span>{
				{
					<span>Name</span>:        <span>*</span><span>name</span>,
					<span>Description</span>: <span>*</span><span>description</span>,
					<span>Backend</span>:     <span>b</span>,
				},
			},
			<span>&amp;</span>server.<span>Options</span>{
				<span>ReadOnly</span>:           <span>*</span><span>readOnly</span>,
				<span>MinimumBlockSize</span>:   <span>uint32</span>(<span>*</span><span>minimumBlockSize</span>),
				<span>PreferredBlockSize</span>: <span>uint32</span>(<span>*</span><span>preferredBlockSize</span>),
				<span>MaximumBlockSize</span>:   <span>uint32</span>(<span>*</span><span>maximumBlockSize</span>),
			}); <span>err</span> <span>!=</span> <span>nil</span> {
			<span>panic</span>(<span>err</span>)
		}
	}()
}</pre></div>
<p dir="auto">See <a href="https://github.com/pojntfx/go-nbd/blob/main/cmd/go-nbd-example-server-file/main.go">cmd/go-nbd-example-server-file/main.go</a> for the full example.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-3-connect-to-the-server-with-a-client" aria-hidden="true" href="#3-connect-to-the-server-with-a-client"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>3. Connect to the Server with a Client</h3>
<p dir="auto">In a new <code>main</code> package, connect to the server by creating a client; note that you&#39;ll have to <code>modprobe ndb</code> and run the command as <code>root</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// client/main.go

if err := client.Connect(conn, f, &amp;client.Options{
	ExportName: *name,
	BlockSize:  uint32(*blockSize),
}); err != nil {
	panic(err)
}"><pre><span>// client/main.go</span>

<span>if</span> <span>err</span> <span>:=</span> <span>client</span>.<span>Connect</span>(<span>conn</span>, <span>f</span>, <span>&amp;</span>client.<span>Options</span>{
	<span>ExportName</span>: <span>*</span><span>name</span>,
	<span>BlockSize</span>:  <span>uint32</span>(<span>*</span><span>blockSize</span>),
}); <span>err</span> <span>!=</span> <span>nil</span> {
	<span>panic</span>(<span>err</span>)
}</pre></div>
<p dir="auto">See <a href="https://github.com/pojntfx/go-nbd/blob/main/cmd/go-nbd-example-client/main.go">cmd/go-nbd-example-client/main.go</a> for the full example.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-4-setup-and-mount-the-filesystem" aria-hidden="true" href="#4-setup-and-mount-the-filesystem"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>4. Setup and Mount the Filesystem</h3>
<p dir="auto">Lastly, create a filesystem on the block device and mount it:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ sudo mkfs.ext4 /dev/nbd0
$ sudo mkdir -p /mnt
$ sudo mount -t ext4 /dev/nbd0 /mnt"><pre>$ sudo mkfs.ext4 /dev/nbd0
$ sudo mkdir -p /mnt
$ sudo mount -t ext4 /dev/nbd0 /mnt</pre></div>
<p dir="auto">You should now be able to use the mounted filesystem by navigating to <code>/mnt</code>.</p>
<p dir="auto"><g-emoji alias="rocket" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f680.png">ðŸš€</g-emoji> That&#39;s it! We can&#39;t wait to see what you&#39;re going to build with go-nbd.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-examples" aria-hidden="true" href="#examples"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Examples</h2>
<p dir="auto">To make getting started with go-nbd easier, take a look at the following examples:</p>
<ul dir="auto">
<li><a href="https://github.com/pojntfx/go-nbd/blob/main/cmd/go-nbd-example-server-file/main.go">NBD File Server</a></li>
<li><a href="https://github.com/pojntfx/go-nbd/blob/main/cmd/go-nbd-example-server-memory/main.go">NBD Memory Server</a></li>
<li><a href="https://github.com/pojntfx/go-nbd/blob/main/cmd/go-nbd-example-client/main.go">NBD Client</a></li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-acknowledgements" aria-hidden="true" href="#acknowledgements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Acknowledgements</h2>
<ul dir="auto">
<li><a href="https://github.com/abligh/gonbdserver/">abligh/gonbdserver</a> provided the initial inspiration for this project.</li>
<li><a href="https://github.com/NetworkBlockDevice/nbd/blob/master/doc/proto.md">NetworkBlockDevice/nbd</a> provided the NBD protocol documentation.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-contributing" aria-hidden="true" href="#contributing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Contributing</h2>
<p dir="auto">To contribute, please use the <a href="https://guides.github.com/introduction/flow/">GitHub flow</a> and follow our <a href="https://github.com/pojntfx/go-nbd/blob/main/CODE_OF_CONDUCT.md">Code of Conduct</a>.</p>
<p dir="auto">To build and start a development version of one of the examples locally, run the following:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ git clone https://github.com/pojntfx/go-nbd.git
$ cd go-nbd
$ rm -f disk.img &amp;&amp; truncate -s 10G disk.img &amp;&amp; go run ./cmd/go-nbd-example-server-file .
$ go run ./cmd/go-nbd-example-server-memory .

# With the C NBD client
$ sudo umount ~/Downloads/mnt; sudo nbd-client -d /dev/nbd1 &amp;&amp; echo &#39;NBD starting&#39; | sudo tee /dev/kmsg &amp;&amp; sudo nbd-client -N default localhost 10809

# With the Go NBD client
$ sudo umount ~/Downloads/mnt; go build -o /tmp/go-nbd-example-client ./cmd/go-nbd-example-client/ &amp;&amp; sudo /tmp/go-nbd-example-client --file /dev/nbd1

$ sudo mkfs.ext4 /dev/nbd1
$ sync -f ~/Downloads/mnt; sudo umount ~/Downloads/mnt; sudo rm -rf ~/Downloads/mnt &amp;&amp; sudo mkdir -p ~/Downloads/mnt &amp;&amp; sudo mount -t ext4 /dev/nbd1 ~/Downloads/mnt &amp;&amp; sudo chown -R &#34;${USER}&#34; ~/Downloads/mnt"><pre>$ git clone https://github.com/pojntfx/go-nbd.git
$ <span>cd</span> go-nbd
$ rm -f disk.img <span>&amp;&amp;</span> truncate -s 10G disk.img <span>&amp;&amp;</span> go run ./cmd/go-nbd-example-server-file <span>.</span>
$ go run ./cmd/go-nbd-example-server-memory <span>.</span>

<span><span>#</span> With the C NBD client</span>
$ sudo umount <span>~</span>/Downloads/mnt<span>;</span> sudo nbd-client -d /dev/nbd1 <span>&amp;&amp;</span> <span>echo</span> <span><span>&#39;</span>NBD starting<span>&#39;</span></span> <span>|</span> sudo tee /dev/kmsg <span>&amp;&amp;</span> sudo nbd-client -N default localhost 10809

<span><span>#</span> With the Go NBD client</span>
$ sudo umount <span>~</span>/Downloads/mnt<span>;</span> go build -o /tmp/go-nbd-example-client ./cmd/go-nbd-example-client/ <span>&amp;&amp;</span> sudo /tmp/go-nbd-example-client --file /dev/nbd1

$ sudo mkfs.ext4 /dev/nbd1
$ sync -f <span>~</span>/Downloads/mnt<span>;</span> sudo umount <span>~</span>/Downloads/mnt<span>;</span> sudo rm -rf <span>~</span>/Downloads/mnt <span>&amp;&amp;</span> sudo mkdir -p <span>~</span>/Downloads/mnt <span>&amp;&amp;</span> sudo mount -t ext4 /dev/nbd1 <span>~</span>/Downloads/mnt <span>&amp;&amp;</span> sudo chown -R <span><span>&#34;</span><span>${USER}</span><span>&#34;</span></span> <span>~</span>/Downloads/mnt</pre></div>
<p dir="auto">Have any questions or need help? Chat with us <a href="https://matrix.to/#/#go-nbd:matrix.org?via=matrix.org" rel="nofollow">on Matrix</a>!</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>License</h2>
<p dir="auto">go-nbd (c) 2023 Felicitas Pojtinger and contributors</p>
<p dir="auto">SPDX-License-Identifier: Apache-2.0</p>
</article>
          </div></div>
  </body>
</html>
