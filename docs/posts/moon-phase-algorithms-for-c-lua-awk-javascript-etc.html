<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/oliverkwebb/moonphase">Original</a>
    <h1>Show HN: Moon Phase Algorithms for C, Lua, Awk, JavaScript, etc.</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A collection of snippets that get the phase of the moon, currently, the implementations are:</p>
<p dir="auto">Systems Level Languages:</p>
<ul dir="auto">
<li>C/C++</li>
<li>Rust</li>
<li>Zig</li>
</ul>
<p dir="auto">Scripting Languages:</p>
<ul dir="auto">
<li>Lua</li>
<li>JavaScript</li>
<li>Python</li>
</ul>
<p dir="auto">DSLs:</p>
<ul dir="auto">
<li>awk</li>
<li><a href="https://en.wikipedia.org/wiki/Bc_(programming_language)" rel="nofollow">bc</a></li>
</ul>
<p dir="auto">These functions take a time as an input (usually in unix epoch seconds or the languages official way of doing time),
and return the &#34;age&#34; of the moon in radians, such that <code>(1-cos(x))/2</code> returns the illuminated fraction of the moons
surface, this indirection is needed because across a full cycle, the same illuminated percent appears more than once,
the first and third quarter are a good example.</p>
<p dir="auto">All implementations contain test cases showing how to get the illuminated fraction and percent using the code.</p>
<p dir="auto">When the age of the moon is converted into a range between <code>[0,1]</code>. You can then get the age
of the moon in days by multiplying it by ~29.5.</p>
<p dir="auto">You can also get the &#34;index&#34; of the phase, required for the phase name and emoji, with
the illuminated fraction and the angle. As an example, here&#39;s <a href="https://github.com/oliverkwebb/deskephem/blob/main/src/value.rs#L70">some rust code</a>
for a different tool using the same algorithm:</p>
<div dir="auto" data-snippet-clipboard-copy-content="fn phaseidx(ilumfrac: f64, ang: time::Angle) -&gt; usize {
    match (ilumfrac, ang.degrees() &gt; 90.0) {
        (0.00..0.04, _) =&gt; 0,
        (0.96..1.00, _) =&gt; 4,
        (0.46..0.54, true) =&gt; 6,
        (0.46..0.54, false) =&gt; 2,
        (0.54..0.96, true) =&gt; 5,
        (0.54..0.96, false) =&gt; 3,
        (_, true) =&gt; 7,
        (_, false) =&gt; 1,
    }
}"><pre><span>fn</span> <span>phaseidx</span><span>(</span><span>ilumfrac</span><span>:</span> <span>f64</span><span>,</span> <span>ang</span><span>:</span> time<span>::</span><span>Angle</span><span>)</span> -&gt; <span>usize</span> <span>{</span>
    <span>match</span> <span>(</span>ilumfrac<span>,</span> ang<span>.</span><span>degrees</span><span>(</span><span>)</span> &gt; <span>90.0</span><span>)</span> <span>{</span>
        <span>(</span><span>0.00</span>..<span>0.04</span><span>,</span> _<span>)</span> =&gt; <span>0</span><span>,</span>
        <span>(</span><span>0.96</span>..<span>1.00</span><span>,</span> _<span>)</span> =&gt; <span>4</span><span>,</span>
        <span>(</span><span>0.46</span>..<span>0.54</span><span>,</span> <span>true</span><span>)</span> =&gt; <span>6</span><span>,</span>
        <span>(</span><span>0.46</span>..<span>0.54</span><span>,</span> <span>false</span><span>)</span> =&gt; <span>2</span><span>,</span>
        <span>(</span><span>0.54</span>..<span>0.96</span><span>,</span> <span>true</span><span>)</span> =&gt; <span>5</span><span>,</span>
        <span>(</span><span>0.54</span>..<span>0.96</span><span>,</span> <span>false</span><span>)</span> =&gt; <span>3</span><span>,</span>
        <span>(</span>_<span>,</span> <span>true</span><span>)</span> =&gt; <span>7</span><span>,</span>
        <span>(</span>_<span>,</span> <span>false</span><span>)</span> =&gt; <span>1</span><span>,</span>
    <span>}</span>
<span>}</span></pre></div>
<p dir="auto">(Note that your angle has to be converted to a positive angle with <code>a-360.0*(floor(a/360))</code> or some similar modulo <a href="https://www.man7.org/linux/man-pages/man3/fmod.3.html" rel="nofollow">(not remainder)</a> operation)</p>
<p dir="auto">All these snippets are based off the algorithm in <code>moontool</code>, a GUI program made in the 80s
by John Walker, which based its algorithms off the book <em>Practical Astronomy With Your Calculator</em>.</p>
<hr/>

<p dir="auto">These rules may be bent for microlanguages and DSLs.</p>

<p dir="auto">Your function must be self-contained, such that someone could copy-paste
it into their code and not get an error. It also must not effect the
environment outside it if at all possible (no <code>#define</code> or mutating globals).
It must be as &#34;pure&#34; and self-contained as the language will allow.</p>
</article></div></div>
  </body>
</html>
