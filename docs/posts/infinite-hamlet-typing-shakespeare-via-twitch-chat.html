<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://eieio.games/game-diary/game-7-infinite-hamlet/">Original</a>
    <h1>Infinite Hamlet: Typing Shakespeare via twitch chat</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
    
<ul>
  <li><strong>Genre:</strong> twitch-plays-pokemon-like</li>
  <li><strong>Links:</strong> <a href="https://twitch.tv/infinitehamlet">play it live on twitch</a></li>
  <li><strong>Engine:</strong> Godot 3.5</li>
  <li><strong>Time Spent:</strong> ~2 weeks on and off</li>
  <li><strong>Other Stuff:</strong> I built this game at <a href="https://www.recurse.com/">Recurse Center</a>, a magical place that functions like a writers retreat for programmers. Consider applying!</li>
</ul>


<p>To play Infinite Hamlet you attempt to type out all of Hamlet one character at time via twitch chat. That’s the whole game. It’s called “Infinite Hamlet” because of the <a href="https://en.wikipedia.org/wiki/Infinite_monkey_theorem">infinite monkey theorem</a></p>
<center>


</center>
<!-- excerpt-end -->


<p>This game is not particularly fun when you are playing it on your own (it’s sort of fun if you’ve got a few people in twitch at the same time).</p>

<p>That’s ok! It’s a silly game that has caused several of my friends to
inadvertently chat with each other. I like that I can leave it up for a few
months as an experiment.  I enjoyed building it and now that I know the ins and
outs of building a twitch game I think I can build something more interesting.
Or more fun.</p>


<p>For a while I’ve been interested in designing games to be played via Twitch chat. <a href="https://en.wikipedia.org/wiki/Twitch_Plays_Pok%C3%A9mon">Twitch plays Pokemon</a> was great (!) - but it involved taking an already existing game and hooking it up to chat. Some games now feature Twitch chat <em>integration</em> - chat viewers can “visit” a streamer’s restaurant in <a href="https://wiki.plateupgame.com/Twitch">PlateUp</a> or queue up random events in <a href="https://noita.fandom.com/wiki/Twitch_Integration">Noita</a>. But those integrations are typically about making a game more appealing to stream on twitch.</p>

<p>What if a game was instead designed to be <em>played</em> on twitch? What would that look like?</p>

<p>A few weeks ago for a <a href="https://recurse.com">Recurse Center</a> “impossible day” event<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" rel="footnote">1</a></sup> I built a crappy prototype of one idea: an infinite runner where instead of controlling the runner you generated terrain in front of the runner - you could enter “-“ in chat to generate flat terrain or “/” to generate rigid terrain<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" rel="footnote">2</a></sup>.</p>

<div>
    
    <video controls="">
    
        <source src="/assets/images/infinite-hamlet/runner.mp4" type="video/mp4"/>
    </video>
    
    <p> Imagine playing this on a 5-second delay! </p>
    
</div>

<p>The game was kinda neat but I found that the delay between chat and the stream was long enough (a few seconds) that it wasn’t a great fit: it’s just too hard to react to anything in time.</p>

<p>I spent a while brainstorming games that would be a better fit and was most interesting in games where the content on screen was mostly or entire user generated - e.g. games where you could draw shapes or even write code via chat. But I struggled to come up with a game idea that was:</p>
<ol>
  <li>Exciting and flexible enough that I was interested in making it.</li>
  <li>Not trivial to use to write / draw hate speech.</li>
</ol>

<p>Infinite Hamlet was a straightforward way to take care of (2). It definitely gives up a lot of (1) - but the theme was funny enough to me that I was excited to make it anyway. And I figured that plenty of the things that I learned while making this game would be generalizable to future twitch games.</p>


<p>This game has 3 components</p>
<ol>
  <li>A Python bot that consumes twitch chat.</li>
  <li>A Python bot that emits sounds when a word is completed.</li>
  <li>A Godot game that renders what you see on stream.</li>
</ol>

<p>The Python bot authenticates to twitch chat (which is just IRC after you do an OAuth dance). When it sees messages that look relevant it sends a little UDP packet containing the character that was typed along with some metadata (like who typed it) locally.</p>

<p>Our Godot game is listening for those UDP packets - when it sees one it validates and decodes it and then performs some actions (updating scores, adding a new character to the screen, etc). If the character results in us finishing a word the <em>Godot</em> game sends a little UDP packet containg that word.</p>

<p>A separate Python bot is listens for UDP messages on the port that Godot sends packets to. When it gets a word it feeds the word to <a href="https://github.com/nateshmbhat/pyttsx3">pyttsx3</a>, a lovely offline Python text-to-speech library.</p>

<div>
    <p><img src="http://eieio.games/assets/images/infinite-hamlet/system.png" alt=""/></p><p> Listen, there are at most two extra boxes here. </p>
    
</div>

<p>It’s a little funny and…microservicey(?)…to have 3 separate programs like this, but I ended up really liking the approach. It doesn’t add much configuration overhead for me (that time is dwarfed by actually setting up a stream for the game) and I find it much easier to think about. And I simply find it <em>so much easier</em> to write code that interacts with the outside world in Python than in GDscript, so I think I saved a ton of time this way.</p>

<p>One funny problem that comes up is that when I re-OAuth I open up Chrome, which steals focus from the Godot window running the game. This can result in some of the game’s animations not playing at a high frame rate (since it’s in the background). To handle this I wrote an Autohotkey script that re-focuses the Godot window and trigger that script via <a href="https://github.com/asweigart/pyautogui">pyautogui</a> after the OAuth process is finished. Hacky but hey - it works fine!</p>


<p>So getting this running with the microservice-y approach I described above was actually pretty straightforward - but I was running the game from one of my own computers.</p>

<p>I…don’t want to do that! Not only is the idea of having an always-on Twitch stream running out of my home creepy, but there’s no good story for managing the stream when I’m not at home (I am not excited about setting up remote access for my home computer).</p>

<p>And getting this running on a server wasn’t totally trivial! I am plenty used to spinning up servers to run things, but I’ve never spun up a server in order to run (and stream!) graphical applications before.</p>

<p>The first thing that I tried was spinning up a small Windows box on Azure. I figured it’d be easier to run and stream my game from Windows than Linux, and I also anticipated that doing the naive thing wouldn’t work. That was exactly right - Godot refused to start because the box didn’t have a graphics card (well specifically because the video card driver didn’t support Godot’s minimum required OpenGL version).</p>

<p>But it’s hard to find a server from the big VPS providers without spending a ton of money! Most GPU-oriented instances are super beefy and cost hundreds of dollars a month<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" rel="footnote">3</a></sup> This game…does not need a beefy GPU instance! Have you seen it. It’s some text on screen. It just needs some video drivers.</p>

<p>I floated this question to Recurse Center’s internal chat and <a href="https://erikarow.land">Erika</a> pointed me to <a href="https://vultr.com">Vultr</a>, which has some fractional GPU offerings that clock in at at around $30 instead of $300.</p>

<p>I burned several hours trying to get my setup functioning on various Linux boxes before bailing. Godot refused to start on Vultr’s stock Debian and Ubuntu images no matter how much tweaking of the video drivers I did. Godot ran out of the box on Vultr’s Arch-based “3DKit” machine but OBS segfaulted on startup (I was surprised at this since it was pre-installed!). I eventually worked around this by <a href="https://obsproject.com/forum/threads/archlinux-nvidia-wayland-obs-segmentation-fault-core-dumped.163735/">changing the installed video driver</a> only to find that OBS segfaulted as soon as I tried to <em>stream.</em></p>

<div>
    <p><img src="http://eieio.games/assets/images/infinite-hamlet/nopedotpng.png" alt=""/></p><p> For the record, this was with LIBGL_ALWAYS_SOFTWARE set. </p>
    
</div>

<p>I’m too old to spend more than 4 hours trying to configure Arch, so I bailed and spun up a Windows box and spent exactly 0 seconds fighting with my drivers. Exciting! The primary downside of my Windows-based setup is that I need to maintain a constant RDP connection to the box or the screen locks<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" rel="footnote">4</a></sup>, which prevents OBS from streaming. Right now I just do this from a computer at home, but I plan to migrate that to a linux server that’s RDP’d into the Windows box in a screen session.</p>


<p>I enjoyed building this game and sharing updates about it as I built it - it’s silly and different and very accessible as long as you’ve got a twitch account. And since it also served to clear up some things for me about building a twitch-first game I’d consider it a success.</p>

<p>But it also made me miss more traditional games. I’m excited to build a more typical game next and to come back to twitch-first games later with a fresh set of eyes.</p>



  </div></div>
  </body>
</html>
