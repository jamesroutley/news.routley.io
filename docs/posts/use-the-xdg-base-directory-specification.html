<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://xdgbasedirectoryspecification.com/">Original</a>
    <h1>Use the XDG Base Directory Specification</h1>
    
    <div id="readability-page-1" class="page"><div>
	<h2>Why?</h2>
	<p>Look at your home</p>
	<pre><code>$ find ~ -mindepth 1 -maxdepth 1 -type f -printf &#39;%f\n&#39; -or -type d -printf &#39;%f/\n&#39;
.alsoftrc
.android/
.ansible/
.aqbanking/
.audacity-data/
.bashrc
.cache/
.choosenim/
.code-d/
.config/
config/
.cpan/
data/
Desktop/
Downloads/
Documents/
.eclipse/
.elementary/
.emacs.d/
.emulator_console_auth_token
.flutter
.flutter_tool_state
.gem/
.ghc/
.ghidra/
.gnome/
.gnupg/
.godot/
.gore/
.gradle/
.gsutil/
.guestfish
.heekscad
.helioslauncher/
HomeBank-20210521.bak
HomeBank-20210607.bak
HomeBank-20210611.bak
.hushlogin
.idapro/
.ivy2/
.java/
javasharedresources/
.kb/
.kube/
.lldb/
.local/
.lunarclient/
.lyxauth
.m2/
macOS.vdi
.mcfly/
.metals/
.minecraft/
.mono/
.mozilla
.mputils/
.mume/
Music/
.omnisharp/
.ort/
.osc_cookiejar
.pack/
.paradoxlauncher/
.parsec/
Pictures/
.pki/
.pm2/
.profile
.pythonhist
.sbt/
.scim/
.ssh/
.steam/
.steampath
.steampid
.step/
.subversion/
.swt/
.tooling/
&#39;Universe Sandbox&#39;/
Videos/
.vscode/
.w3m/
.wine/
.xinitrc
.yarnrc
.zcompdump
.zoom/
.zshenv</code></pre>

	<p>What if your house was clean and tidy?</p>

	<pre><code>$ find ~ -mindepth 1 -maxdepth 1 -type f -printf &#39;%f\n&#39; -or -type d -printf &#39;%f/\n&#39;
.bashrc
.cache/
.config/
Desktop/
Downloads/
Documents/
.local/
Music/
Pictures/
.profile
Videos/</code></pre>

<p>End users of your application (and hopefully yourself, as well) want a clean home directory. Instead of having files like <code>~/.gitconfig</code> scattered chaotically in the home folder, it would be better for them to reside in a dedicated configuration directory.</p>

<p>I like how <a href="https://0x46.net/thoughts/2019/02/01/dotfile-madness">Filip</a> from <code>0x46.net</code> explained the issue from the perspective of a user:</p>

<figure>
	<blockquote cite="https://0x46.net/thoughts/2019/02/01/dotfile-madness">
		<p>My own home directory contains 25 ordinary files and 144 hidden files. The dotfiles contain data that doesn&#39;t belong to me: it belongs to the programmers whose programs decided to hijack the primary location designed as a storage for my personal files. I can&#39;t place those dotfiles anywhere else and they will appear again if I try to delete them. All I can do is sit here knowing that in the darkness, behind the scenes, they are there. . . . I dread the day in which I will hear a loud knock on my door and one of those programmers will barge in informing me that he is going to store a piece of his furniture in the middle of my living room, If I don&#39;t mind.</p>
	</blockquote>
	<figcaption>Filip from <cite>0x46.net</cite></figcaption>
</figure>

<p>Succinctly, following the spec means (by the very least) your application files are nearly categorized in subdirectories of the home folder. For instance, locations of cache files default to <code>~/.cache</code> while locations of config files default to <code>~/.config</code>, etc.

</p><h3>Benefits</h3>

<p>If you aren&#39;t already sold on a clean home directory, there are additional benefits.</p>

<ul>
	<li>Easier to create backups</li>
	<p>Since several directories (ex. <code>~/.config</code>, by default) represent a discrete class of application files, it is much easier to make rules for a specific category of files during backup.</p>
	<li>Easier to share configuration settings</li>
	<p>Since all settings are in a single directory, they can more easily be shared across computer systems.</p>
	<li>Easier to isolate application state</li>
	<p>Since all data specific to a single machine is in a single directory, you can easily avoid sharing it between systems when sharing data or backups.</p>
	<li>Easier to temporarily ignore the config</li>
	<p>Not all applications have a <code>--no-config</code> option (especially GUI applications), and those that do have a <code>--config</code> option do not always work when using <code>/dev/null</code> as a file, shell process substitution, or a simple empty file. It is easiest to set <code>XDG_CONFIG_HOME=/tmp/dir</code>.</p>
	<li>Decreased reliance on hard-coded paths (flexibility + composability)</li>
</ul>

<p>As a more concrete example, imagine that <code>/etc</code> did not exist - configuration would be chaotically scattered about in a way similar to how <code>$HOME</code> exists today. But, because we have <code>/etc</code> specifically designated as a directory for config files (along with other directories) by the <a href="https://refspecs.linuxfoundation.org/fhs.shtml">File Hierarchy Standard</a>, it is <i>significantly</i> easier to locate, edit, and backup system files <i>across machines</i>. Those ergonomics should not just exist for system-level files, but for the user-level as well.</p>

<p>Thus, I implore, I <i>beg</i> all you application developers to implement the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>.</p>
	<h2>How?</h2>
	<p>First, categorize the files that your program needs to write into four categories:</p>
	<ol>
		<li>Configuration</li>
		<p>Configuration files that affect the behavior of an program. Even if the configuration file is not meant to be human-editable, it likely belongs here.</p>
		<li>Data</li>
		<p>General files and data that is inherently portable across computers. Examples include fonts, files downloaded from the internet, and <a href="https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html">desktop entries</a>.</p>
		<li>State</li>
		<p>Files that hold the state of the application. This may include logs, command history, recently used files, and game save data. In other words, if the data is unique for a given machine, the file belongs here.</p>
		<li>Cache</li>
		<p>Cache files.</p>
	</ol>

	<p>Each aforementioned category is mapped to a special environment variable, which is the directory that contains all files of that category. For example, &#34;Configuration&#34; files are all stored in <code>$XDG_CONFIG_HOME</code>. If that environment variable is invalid, then the default value of <code>$HOME/.config</code> should be used instead. See the full table below:</p>

	<table>
		<tbody><tr>
			<th>Category</th>
			<th>Environment Variable</th>
			<th>Default Value</th>
			<th><a href="https://refspecs.linuxfoundation.org/fhs.shtml">FHS</a> Approximation</th>
		</tr>
		<tr>
			<td>Configuration</td>
			<td><code>$XDG_CONFIG_HOME</code></td>
			<td><code>$HOME/.config</code></td>
			<td><code>/etc</code></td>
		</tr>
		<tr>
			<td>Data</td>
			<td><code>$XDG_DATA_HOME</code></td>
			<td><code>$HOME/.local/share</code></td>
			<td><code>/usr/share</code></td>
		</tr>
		<tr>
			<td>State</td>
			<td><code>$XDG_STATE_HOME</code></td>
			<td><code>$HOME/.local/state</code></td>
			<td><code>/var/lib</code></td>
		</tr>
		<tr>
			<td>Cache</td>
			<td><code>$XDG_CACHE_HOME</code></td>
			<td><code>$HOME/.cache</code></td>
			<td><code>/var/cache</code></td>
		</tr>
	</tbody></table>

	<p>There are three ways the environment variable can be invalid:</p>
	<ol>
		<li>If it is unset (<code>unset XDG_CONFIG_HOME</code>)</li>
		<li>If it is set to an empty value (<code>XDG_CONFIG_HOME=&#34;&#34;</code>)</li>
		<li>If it is not an absolute path (<code>XDG_CONFIG_HOME=&#34;./config&#34;</code>)</li>
	</ol>

	<h2>Code examples</h2>
	<p>Now that you&#39;re acquainted with the standard, you probably want to sees some code examples. The following programs are for <b><i>Linux only</i></b> (See the FAQ below for details on MacOS and Windows). Of course, if you are actually writing a program, I recommend using a library.</p>
	<p>The following is Go 1.13+ code. Note that it does not use <a href="https://pkg.go.dev/os#UserConfigDir">os.UserConfigDir</a> (<a href="https://github.com/golang/go/blob/90860e0c3110ac5898dfe8e0e0fafd0aea8d979a/src/os/file.go#L444">Source</a>) since that does not silently ignore non-absolute paths as per the spec</p>

<details>
	<summary>Show Go</summary>
<pre>package main
import (
  &#34;os&#34;
  &#34;fmt&#34;
  &#34;log&#34;
  &#34;path/filepath&#34;
)

func getConfigDir() (string, error) {
  configDir := os.Getenv(&#34;XDG_CONFIG_HOME&#34;)

  // If the value of the environment variable is unset, empty, or not an absolute path, use the default
  if configDir == &#34;&#34; || configDir[0:1] != &#34;/&#34; {
    homeDir, err := os.UserHomeDir()
    if err != nil {
      return &#34;&#34;, err
    }
    return filepath.Join(homeDir, &#34;.config&#34;, &#34;my-application-name&#34;), nil
  }

  // The value of the environment variable is valid; use it
  return filepath.Join(configDir, &#34;my-application-name&#34;), nil
}

func main() {
  config_dir, err := getConfigDir()
  if err != nil {
    panic(err)
  }

  fmt.Println(config_dir)
}</pre>
</details>

<p>The following is Python 3.5+ code. It uses <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.home">Path.home</a> (<a href="https://github.com/python/cpython/blob/ec4d917a6a68824f1895f75d113add9410283da7/Lib/pathlib.py#L994">Source</a>) (which uses <a href="https://docs.python.org/3/library/pathlib.html#pathlib.Path.home">os.path.expanduser</a> (<a href="https://github.com/python/cpython/blob/ec4d917a6a68824f1895f75d113add9410283da7/Lib/posixpath.py#L228">Source</a>))</p>
<details>
	<summary>Show Python</summary>
<pre>import sys, os
from pathlib import Path

def get_config_dir() -&gt; str:
  config_dir = os.getenv(&#39;XDG_CONFIG_HOME&#39;, &#39;&#39;)

  // If the value of the environment variable is unset, empty, or not an absolute path, use the default
  if config_dir == &#39;&#39; or config_dir[0] != &#39;/&#39;:
    return str(Path.home().joinpath(&#39;.config&#39;, &#39;my-application-name&#39;))

  // The value of the environment variable is valid; use it
  return str(Path(config_dir).joinpath(&#39;my-application-name&#39;))

config_dir = get_config_dir()
print(config_dir)</pre>
</details>

<p>The following is Bash code. Note that it does not use <code>&#34;${XDG_CONFIG_HOME:-$HOME/.config}&#34;</code> since that does not silently ignore non-absolute paths as per the spec</p>
<details>
	<summary>Show Bash</summary>
<pre>get_config_dir() {
  unset REPLY; REPLY=

  local config_dir=&#34;$XDG_CONFIG_HOME&#34;

  # If the value of the environment variable is unset, empty or not an absolute path, use the default
  if [ -z &#34;$config_dir&#34; ] || [ &#34;${config_dir::1}&#34; != &#39;/&#39; ]; then
    REPLY=&#34;$HOME/.config/my-application-name&#34;
    return
  fi

  # The value of the environment variable is valid; use it
  REPLY=&#34;$config_dir/my-application-name&#34;
}

get_config_dir
printf &#39;%s\n&#39; &#34;$REPLY&#34;</pre>
</details>

</div></div>
  </body>
</html>
