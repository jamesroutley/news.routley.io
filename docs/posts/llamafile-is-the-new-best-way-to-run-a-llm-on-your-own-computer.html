<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://simonwillison.net/2023/Nov/29/llamafile/#atom-everything">Original</a>
    <h1>Llamafile is the new best way to run a LLM on your own computer</h1>
    
    <div id="readability-page-1" class="page"><div>



<p>29th November 2023</p>

<p>Mozilla’s innovation group and Justine Tunney <a href="https://hacks.mozilla.org/2023/11/introducing-llamafile/">just released llamafile</a>, and I think it’s now the single best way to get started running Large Language Models (think your own local copy of ChatGPT) on your own computer.</p>
<p>A llamafile is a single multi-GB file that contains both the model weights for an LLM and the code needed to run that model—in some cases a full local server with a web UI for interacting with it.</p>
<p>The executable is compiled using <a href="https://justine.lol/cosmopolitan/index.html">Cosmopolitan Libc</a>, Justine’s incredible project that supports compiling a single binary that works, unmodified, on multiple different operating systems and hardware architectures.</p>
<p>Here’s how to get started with <a href="https://llava-vl.github.io/">LLaVA 1.5</a>, a large multimodal model (which means text and image inputs, like GPT-4 Vision) fine-tuned on top of Llama 2. I’ve tested this process on an M2 Mac, but it should work on other platforms as well (though be sure to <a href="https://github.com/mozilla-Ocho/llamafile#gotchas">read the Gotchas</a> section of the README, and take a look at Justine’s <a href="https://news.ycombinator.com/item?id=38465916">list of supported platforms</a> in a comment on Hacker News).</p>
<ol>
<li>
<p>Download the 4.26GB <code>llamafile-server-0.1-llava-v1.5-7b-q4</code> file <a href="https://huggingface.co/jartine/llava-v1.5-7B-GGUF/blob/main/llava-v1.5-7b-q4-server.llamafile">from Justine’s repository on Hugging Face</a>.</p>
<p><code>curl -LO https://huggingface.co/jartine/llava-v1.5-7B-GGUF/resolve/main/llava-v1.5-7b-q4-server.llamafile</code></p>
</li>
<li>
<p>Make that binary executable, by running this in a terminal:</p>
<p><code>chmod 755 llava-v1.5-7b-q4-server.llamafile</code></p>
</li>
<li>
<p>Run your new executable, which will start a web server on port 8080:</p>
<p><code>./llava-v1.5-7b-q4-server.llamafile</code></p>
</li>
<li>
<p>Navigate to <code>http://127.0.0.1:8080/</code> to start interacting with the model in your browser.</p>
</li>
</ol>
<p>That’s all there is to it. On my M2 Mac it runs at around 55 tokens a second, which is <em>really</em> fast. And it can analyze images—here’s what I got when I uploaded a photograph and asked “Describe this plant”:</p>
<p><img src="https://static.simonwillison.net/static/2023/llamafile.jpg" alt="Screenshot. llama.cpp - then a photo I took of a plant  User: Describe this plant  Llama: The image features a large, green plant with numerous thin branches and leaves. Among the many stems of this plant, there is an orange flower visible near its center. This beautifully decorated plant stands out in the scene due to its vibrant colors and intricate structure.  18ms per token, 54.24 tokens per second Powered by llama.cpp, ggml.ai, and llamafile"/></p>
<h4 id="llamafile-how-this-works">How this works</h4>
<p>There are a number of different components working together here to make this work.</p>
<ul>
<li>The LLaVA 1.5 model by Haotian Liu, Chunyuan Li, Yuheng Li and Yong Jae Lee is <a href="https://arxiv.org/abs/2310.03744">described in this paper</a>, with further details on <a href="https://llava-vl.github.io/">llava-vl.github.io</a>.</li>
<li>The models are executed using <a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a>, and in the above demo also use the <code>llama.cpp</code> server example to provide the UI.</li>
<li>
<a href="https://justine.lol/cosmopolitan/index.html">Cosmopolitan Libc</a> is the magic that makes one binary work on multiple platforms. I wrote more about that in a TIL a few months ago, <a href="https://til.simonwillison.net/cosmopolitan/ecosystem">Catching up with the Cosmopolitan ecosystem</a>.</li>
</ul>
<h4 id="llamafile-trying-other-models">Trying more models</h4>
<p>The <a href="https://github.com/mozilla-Ocho/llamafile">llamafile README</a> currently links to binaries for <code>Mistral-7B-Instruct</code>, <code>LLaVA 1.5</code> and <code>WizardCoder-Python-13B</code>.</p>
<p>You can also download a much smaller <code>llamafile</code> binary from <a href="https://github.com/Mozilla-Ocho/llamafile/releases/tag/0.1">their releases</a>, which can then execute any model that has been compiled to GGUF format:</p>
<p>I grabbed <code>llamafile-server-0.1</code> (4.45MB) like this:</p>
<div><pre>curl -LO https://github.com/Mozilla-Ocho/llamafile/releases/download/0.1/llamafile-server-0.1
chmod 755 llamafile-server-0.1</pre></div>
<p>Then ran it against a 13GB <code>llama-2-13b.Q8_0.gguf</code> file I had <a href="https://huggingface.co/TheBloke/Llama-2-13B-GGUF/tree/main">previously downloaded</a>:</p>
<div><pre>./llamafile-server-0.1 -m llama-2-13b.Q8_0.gguf</pre></div>
<p>This gave me the same interface at <code>http://127.0.0.1:8080/</code> (without the image upload) and let me talk with the model at 24 tokens per second.</p>
<h4 id="llamafile-one-file">One file is all you need</h4>
<p>I think my favourite thing about llamafile is what it represents. This is a single binary file which you can download and then use, forever, on (almost) any computer.</p>

<p>You don’t need a network connection, and you don’t need to keep track of more than one file.</p>

<p>Stick that file on a USB stick and stash it in a drawer as insurance against a future apocalypse. You’ll never be without a language model ever again.</p>




</div></div>
  </body>
</html>
