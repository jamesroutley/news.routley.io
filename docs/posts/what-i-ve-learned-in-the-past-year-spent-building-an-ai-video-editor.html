<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.makeartwithpython.com/blog/a-year-of-showing-up/">Original</a>
    <h1>What I&#39;ve Learned in the Past Year Spent Building an AI Video Editor</h1>
    
    <div id="readability-page-1" class="page"><section itemprop="text">
        <h2 id="an-unexpected-year-spent-in-ai">An Unexpected Year Spent in AI</h2>

<p><a href="https://github.com/burningion/"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/d393e5a5-3cbc-47b8-9f17-90ebf3f21300/webscale" alt="Github contributions for the past year"/></a></p>

<p>Last year I was let go after just 6 months in a new role.</p>

<p>I had left a great company and boss to take a chance on a startup, and before I’d even begun, it was over.</p>

<p>I decided to take the event as an opportunity, and explore what was now becoming possible in video with LLMs, Diffusion models, and the growing number of other open models.</p>

<p>See, years ago I’d helped build a <a href="https://en.wikipedia.org/wiki/Triller_(app)#Launch_and_Early_years">generative video editor that became a unicorn</a>, and had ideas from then I’d wanted to see built.</p>

<p>These ideas were mostly unreasonable back in 2015, but given LLM and computer vision model progress, were now becoming possible.</p>

<h2 id="the-gpu-crunch-and-local-first-multi-modal-generative-ai">The GPU Crunch and Local First, Multi-Modal Generative AI</h2>

<p><a href="https://www.makeartwithpython.com/blog/building-an-ai-video-editor/"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/5fd535b2-841a-41a6-6ae0-4161706b0a00/webscale" alt="Local Editor"/></a></p>

<p>So I initially focused on building a local video editor improved with multi-modal artificial intelligence. It used <a href="https://segment-anything.com">computer vision</a> to detect, extract, and track objects in video, combined with Diffusion models to add and animate new objects in to videos.</p>

<p>I’d previously done daily video sketches 5 years ago, using <a href="https://github.com/matterport/Mask_RCNN">Mask-RCNN</a>, experimenting with skateboard videos:</p>

<center><blockquote data-instgrm-permalink="https://www.instagram.com/p/BgIPFGsleyT/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14"></blockquote> </center>

<p>These video sketches previously allowed me to explore the medium of AI-assisted video editing, without any strong expectations.</p>

<p>I assumed building a tool to continue exploring this work would prove fruitful:</p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/b95dc1ca-e677-4068-c588-8e13b0ae0200/public" alt="The Editor at Work"/></p>

<p>And indeed it did! I was soon playing with video as a more fluid medium, one that felt a bit more editable. I began to understand how the new vision models worked, and how the GPU could be used to speed up rendering, inference, and video.</p>

<p>By using a combination of models I was able to create a prompt for adding unique, diffusion generated objects into videos, already masked off.</p>

<p>You can read about <a href="https://www.makeartwithpython.com/blog/building-an-ai-video-editor/">that process</a> in a previous blog post.</p>

<h2 id="a-sidequest-for-safety-not-the-ai-kind">A Sidequest for Safety (Not the AI Kind)</h2>

<p><a href="https://makeartwithpython.com/blog/submitting-sbir-application/"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/fb3853a3-f361-4d15-0b01-da8a53768b00/webscale" alt="Bicyclist Safety"/></a></p>

<p>But as I was building out computer vision pipelines and prototypes for the video editor, I experienced a string of tragic local deaths.</p>

<p>Bicyclists and pedestrians kept getting hit by cars.</p>

<p>So as a side project, I started researching cyclist safety, and soon discovered just how terrible the pedestrian infrastructure is in the United States. I wondered if there wasn’t maybe a technical solution to reduce or eliminate these deaths, as the statistics showed they’re rapidly increasing.</p>

<p>So on a whim I put together a proposal to address this using artificial intelligence and robotics, and submitted it to the <a href="https://www.sbir.gov/">NSF’s SBIR program</a>.</p>

<p>To my surprise, they invited me to submit a formal, <a href="https://new.nsf.gov/funding/opportunities/nsf-small-business-innovation-research-small-0">Phase I proposal</a>.</p>

<p>If accepted, this meant I could get up to $2 million to pursue and develop my technology, <em>without</em> the government taking any equity.</p>

<p><strong>So of course, I did that.</strong></p>

<p>It took a <a href="https://www.makeartwithpython.com/blog/submitting-sbir-application/">few months worth of work</a>, and brought me far out of my comfort zone.</p>

<p>But! One of the conditions of submitting my proposal was that I had to pause all of my open source work related to the project, as the government couldn’t give me a grant for work already done.</p>

<p>This frustrated me, as pedestrians continued to die in my town. I felt guilty for each additional person who got hit.</p>

<p>As a consolation, since I’d already done the tedious paperwork to form and qualify a company to accept government grants like the SBIR (via <a href="https://sam.gov/content/home">SAM.gov</a>), most of the labor to create another proposal was already taken care of.</p>

<p>So I also submitted an SBIR proposal to the <a href="https://its.dot.gov/csai/">Department of Transportation for Complete Streets AI</a>.</p>

<p>This proposal imagined using smartphones and computer vision to help fill in gaps of pedestrian infrastructure knowledge at the DOT.</p>

<p>6+ months later, I’d found out the final answer from both the NSF and DOT:</p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/1b609042-4aa5-4958-0cb9-42c85986a300/public" alt="Being Rated by Anonymous Reviewers Sucks."/></p>

<p><strong>“No.”</strong></p>

<p>(On a positive note, this means I’m once again able to be <a href="https://github.com/burningion/bicyclist-defense-jetson/">public</a> about this work, and solicit help.)</p>

<h2 id="taking-a-step-back-from-the-obvious">Taking a Step Back From the Obvious</h2>

<p>And after six months of working on the local video editor, I also hit a wall.</p>

<p><a href="https://www.magiceye.com/stwkdisp.htm"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/b7a79f9b-3506-420d-d76f-3334ebceb600/public" alt="If you Stare into a Screen Long Enough, You can See the Future"/></a></p>

<p>It became apparent that AI as a layer “on top of” the existing video editor workflows didn’t make much sense, given how different ML workflows incorporating large language models had become, and how much engineering had gone into <em>everything else</em> around modern, flagship desktop video editors.</p>

<p>More powerful vision and audio models could of course be used to add features that reduce toil in existing workflows, but the underlying assumptions behind the user interface of the video editors seemed to be constraining the discovery of potential new methods for video creation, <em>and more importantly, the evolution of video as a medium</em>.</p>

<p>It seemed the process of video creation itself had to be rethought, using the power and possibility of LLMs, multi-modal embeddings / search, and computer vision / diffusion models as a collaborator.</p>

<p>Which led me to a thought:</p>

<p><strong>What if video was more personal? More maleable? More collaborative?</strong></p>

<p>This meant rethinking current video editing workflows according to the strengths of these models.</p>

<h2 id="building-a-generative-video-platform">Building A Generative Video Platform</h2>

<p>So I went back to the drawing board, and rethought the whole concept of a video editor. When I did, a thought occured to me:</p>

<blockquote>
  <p>What if instead of a <em>single</em> video out of a video editing process we had a <strong>video generator</strong> out of the video editing process?</p>
</blockquote>

<p>What if instead of a single, static artifact at the end of editing, we had a video generator, capable of rendering each video tailored to the viewer? Created on demand, according to unique the specific needs of the viewer?</p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/5bc9c33d-5504-45fa-dae2-65255f986f00/webscale" alt="Generative Video Pipeline"/></p>

<p>What if we allowed for the user to collaborate in the experience of their video?</p>

<p>I’d imagined videos would no longer be static outputs, and would instead be like code: dynamic and generated specifically for the viewer, or a specific audience, video becoming more of a medium for play and interaction, rather than the typical, passive consumption model.</p>

<h2 id="creating-a-dynamic-video-generation-pipeline-with-promptflow">Creating a Dynamic Video Generation Pipeline with Promptflow</h2>

<p>With that, I started building a new prototype of generative video using Microsoft’s LLM framework <a href="https://github.com/microsoft/promptflow">Promptflow</a>. It allows mixing calls to an LLM with code, building up whole graph based pipelines for generative AI workflows.</p>

<p><a href="https://microsoft.github.io/promptflow/concepts/concept-flows.html"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/4815de71-3fd2-4fbb-d981-b70f2d94bf00/webscale" alt="Promptflow DAG"/></a></p>

<p>You define these workflows via a <code>yaml</code> file, in which you can express your variables you’d like passed in to your prompts to your ChatGPT tool. The results from these prompts can then be passed back to Python, or used to gnerate more LLM calls.</p>

<p>With this tool as a basis, I built an initial Horoscope video generator, using the most basic generative approaches to video generation. It took a prompt, injected the user’s variables, called out to an LLM to generate a video script, and then generated images, transformed them into videos, added a voice narrator, subtitles, and finally, put together a video edit.</p>

<p>The flow looks something like this:</p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/64f92c17-3a60-4c38-4b72-261dd17d1900/webscale" alt="Early Promptflow Prototype"/></p>

<p>In this generator, the Video Generator takes in an <strong>Astrological Sign</strong>, a <strong>Date</strong>, and a <strong>Random Seed</strong>. (LLMs are known to have <a href="https://www.alignmentforum.org/posts/t9svvNPNmFf5Qa3TA/mysteries-of-mode-collapse">difficulty</a> in generating <a href="https://people.csail.mit.edu/renda/llm-sampling-paper">random numbers</a>.)</p>

<p>These are all used to run a pipeline that generates a <strong>unique, on demand video horoscope reading for the user</strong>.</p>

<p>From this initial prototype, I immediately ran into a few limitations.</p>

<p>The Promptflow design expected users to build wrappers on a service like ChatGPT, with mostly static flows. Think of things like customer service bots, using RAG to fill in dynamic information necessary to answer a query.</p>

<p>This didn’t match the level of dynamic video generation and editing processes I envisioned getting to. The design and writing of these static flows didn’t feel like the right layer of abstraction.</p>

<p><strong>So I switched my Promptflow over to a different workflow execution engine, <a href="https://temporal.io">Temporal</a>.</strong></p>

<h2 id="generative-workflows-with-temporal">Generative Workflows with Temporal</h2>

<p>Temporal allowed me to restructure the Generative processes I was building with <a href="https://temporal.io/blog/building-reliable-distributed-systems-in-node-js-part-2">durable execution</a> as a primitive.</p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/95d1c046-0f45-452f-866e-4d2703b00b00/webscale" alt="Workflow of Video Analysis"/></p>

<p>Rather than building for static graphs of execution, I could build out individual tools / processes, and later allow for the user to decide <em>how</em> to link and execute the tools together for their specific process. (In Temporal, these are called <a href="https://docs.temporal.io/workflows">“Workflows”</a>, and come with automatic retries and more).</p>

<p>With these as a base, writing ML generation workflows becomes a bit more straightforward. I could define Activities as discreet units with retry, and synchronize the execution of these Activites via Workflows.</p>

<p>To give an example, let’s say we want to analyze a video file that has been uploaded. (We want to know what’s in the video as, as well as generate embeddings, text, and tags.)</p>

<p>There are <em>many</em> places where a failure could occur. A web request may fail to download a file, a file may have an unsupported encoding, or a GPU machine may not be schedulable. Each of these events would normally require logic to handle failure, have a set number of retries, and decide how to gracefully fail.</p>

<p>With <a href="https://temporal.io/">Temporal</a>, we instead set our number of retries and failure conditions across each activity. The Temporal platform automatically handles retries when things go wrong:</p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/ba6da346-832c-4d6a-bea0-f3105f2d7f00/public" alt="Workflow automatically retrying 10 times"/></p>

<p>This is especially useful during development, where if an error occurs, I can usually spot and fix it, and then restart the worker.</p>

<p>The workflow then retries from the last succesful execution, and usually completes.</p>

<p>This substantially speeds up the development flow for my graph execution workflows.</p>

<h2 id="the-challenges-of-building-with-sometimes-unpredictable-llms">The Challenges of Building with (sometimes unpredictable) LLMs</h2>

<p><a href="https://docs.anthropic.com/en/docs/quickstart#start-with-the-workbench"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/29c748d6-8353-4b27-b94d-a5242c60be00/webscale" alt="Anthropic Workbench"/></a></p>

<p>Creating language model prompts for software workflows is a fuzzy process.</p>

<p>Designing a prompt requires significant time investment, to understand how your chosen model performs for your specific use case. And even once you’ve decided on a prompt, each model seems to have it’s own quirks about how it interprets and decides whether and how to to follow instructions.</p>

<p>This means one prompt may end up being more appropriate for one specific model, versus another.</p>

<p>It’s tough to tell ahead of time if one model may be more appropriate for your task than another.</p>

<p>People try to address this by writing <a href="https://cookbook.openai.com/examples/evaluation/getting_started_with_openai_evals">evals</a>.</p>

<p>Evals are tests to see whether or not an LLM comes up with an appropriate answer. You can either write evals using code, or by asking the LLM to determine whether or not its answers are correct.</p>

<p>To help with this, Anthropic now has what it calls a <a href="https://console.anthropic.com/workbench">“Workbench”</a>, from which you can use Claude to generate and analyze specific prompts:</p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/c8161d24-8d66-423e-9ab0-16c0c16b8300/public" alt="Analysis for your test set in prompts"/></p>

<p>Using Workbench allows you to get a feel for how you can approach your chosen prompt task, and what sort of outputs you can expect while developing.</p>

<p>You can quickly evaluate the performance of these generated prompts against one another within the user interface.</p>

<p>Thanks to the example prompts from Workbench, I added a process for generating prompts into my Video Generator, using Anthropic’s <a href="https://github.com/anthropics/anthropic-cookbook/blob/main/misc/metaprompt.ipynb">metaprompting example</a> from Github.</p>

<p>These metaprompts are a great starting point for helping users get started with a prompt template to build from.</p>

<p><strong>Amazingly, asking an advanced model to generate its own prompts seems to mostly work.</strong></p>

<h2 id="embeddings-might-not-be-the-solution-you-think-they-are">Embeddings Might Not Be the Solution You Think They Are</h2>

<p><a href="https://vickiboykis.com/what_are_embeddings/index.html"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/86582e3e-f39d-4c37-d0ab-fd3ec846f600/public" alt="Embeddings Model from What Are Embeddings?"/></a></p>

<p><a href="https://vickiboykis.com/what_are_embeddings/index.html">Vicky Boykis</a> has written an amazing, free book on building embeddings models.</p>

<p><strong>Prior to reading it, I assumed vector databases would dominate search and retrieval for anyone working with LLMs.</strong> The hype sold in 2023 was that vector databases would be the future of information retrieval.</p>

<p>But as I began working with embeddings and vector databases, the results didn’t seem to match to the hype.</p>

<p>As I dug in, I discovered this is because embeddings are fundamentally a <em>compressing</em> technology, squashing the unique features in your dataset into a fixed length vector output, across the embedding space.</p>

<p>How well these dimensions map to the data related to your business use case depends on how well you’ve built your embedding space.</p>

<p>But! Most people getting started <em>aren’t</em> training their own embeddings models for their specific use case, and are instead relying on off the shelf, generic embeddings models to apply to their business problems.</p>

<p>This blind application of generalized embeddings models over traditional search can lead to worse results, and less easily debuggable systems.</p>

<p>Let’s take a concrete example.</p>

<h2 id="a-song-search-example">A Song Search Example</h2>

<p><strong>Years ago I built a search engine for songs.</strong></p>

<p><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/07193c6d-399c-4675-d8c9-b22448e15100/webscale" alt="Search Example"/></p>

<p>One of the challanges I faced was bootstrapping relevant results, for very generic search terms.</p>

<p>See, it turns out <strong>most song titles aren’t very unique</strong>, and so naive text search is terrible on song names, albums, and artists.</p>

<p>Because of this, a generic text embeddings model would be especially challenged to give decent results.</p>

<p>Say our user is searching for the term “stop”:</p>

<p>There may be tens of thousands of songs, albums, and artists with the word “stop” in it.</p>

<p><strong>How do you begin to determine which ones should be most relevant?</strong></p>

<p>To solve the problem, I turned to music top charts. These have been published <a href="https://en.wikipedia.org/wiki/Billboard_charts">since the 40’s</a>, and contain some of the most important songs, culturally.</p>

<p>By adding a weight or bias score to the songs previously in the top charts, I could help bootstrap an initial search system.</p>

<p>If I had instead started with an embeddings model, I’m not sure I would have as easily built a solution. Maybe an off the shelf embedding model already has partial knowledge of the top charts, but how much?</p>

<p>Similarly, in building an automatic video editor, I’ve discovered it’s necessary to have a mix of embeddings models, along with traditional search ideas, and a bit of domain specific ideas / experimentation.</p>

<h2 id="the-wonderful-totally-great-process-of-building-something-new">The Wonderful, Totally Great Process of Building Something New</h2>

<p><a href="https://en.wikipedia.org/wiki/The_Myth_of_Sisyphus#Chapter_4:_The_Myth_of_Sisyphus"><img src="https://imagedelivery.net/_KKQ2p8Uk9OruvuF07KWqw/231b15ae-3158-4eff-e251-b6e9fc71a900/public" alt="Showing up"/></a></p>

<p>Any time I see someone finish a thing, I try to go out of my way to congratulate them.</p>

<p>Getting <em>anything</em> out the door always includes an unseen number of challenges, and entropy works against all of us.</p>

<p>So of course, as I’ve worked towards a vision of building something new the past year, I’ve taken a few detours.</p>

<p>There is a great quote from Jenson Huang, when asked about whether or not he’d start NVIDIA again, he says he wouldn’t, because he now knows how difficult it is:</p>

<!-- Courtesy of embedresponsively.com //-->
<p>

  <iframe src="https://www.youtube.com/embed/URgncvVxxFU" frameborder="0" allowfullscreen=""></iframe>

</p>

<p><strong>Similarly, over the past year I’ve wondered if I’ve been too selfish, too naive in attempting to build something new on my own, rather than build off my existing success and luck, and playing it safe with a full time job.</strong></p>

<p>I don’t know the answer yet, but I am grateful for the chance to find out.</p>

        
      </section></div>
  </body>
</html>
