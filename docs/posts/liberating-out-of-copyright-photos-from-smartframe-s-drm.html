<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://shkspr.mobi/blog/2022/05/liberating-out-of-copyright-photos-from-smartframes-drm/">Original</a>
    <h1>Liberating out-of-copyright photos from SmartFrame&#39;s DRM</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="https://schema.org/articleBody">
<p>During the middle of the 20th Century, the UK&#39;s Royal Air Force took thousands of photographs of the country from above. Think of it like a primitive Google Earth.</p><p>Those photographs are &#34;<a href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/">Crown Copyright</a>&#34;. For photographs <em>created</em> before 1st June 1957, the <a href="https://www.nationalarchives.gov.uk/documents/information-management/crown-copyright-flowchart.pdf">copyright expires after 50 years</a>.</p><p>Recently, the organisation &#34;Historic England&#34; started <a href="https://historicengland.org.uk/images-books/archive/collections/aerial-photos/">sharing high-resolution copies of these photos on a nifty interactive map</a>.</p><p><img src="https://shkspr.mobi/blog/wp-content/uploads/2022/05/Aerial-Photo-Explorer.png" alt=" Aerial Photo Explorer  You can explore over 400,000 digitised photos taken from our aerial photo collections of over 6 million photographs preserved in the Historic England Archive.  Use our nationally important collections of aerial photographs to explore your area. Find the place where you live or why not look for your favourite football ground, railway station or the places you visit?" width="849" height="678"/></p><p>But there were two problems.</p><p>Firstly, they claimed that the photographs were still under copyright. This (no doubt inadvertent) mistake was <a href="https://twitter.com/pigsonthewing/status/1507400294702981163">pointed out to them</a> and was eventually corrected.</p><blockquote data-width="550" data-dnt="true"><p lang="en" dir="ltr">It seems that, without announcement,  <a href="https://twitter.com/HistoricEngland?ref_src=twsrc%5Etfw">@HistoricEngland</a> have dropped the claim that copyright-expired pre-June 1957 RAF images are still in copyright, from their Aerial Photo Explorer <a href="https://t.co/uceK7qzQxd">pic.twitter.com/uceK7qzQxd</a></p><p>â€” Andy Mabbett (@pigsonthewing) <a href="https://twitter.com/pigsonthewing/status/1510239159805530121?ref_src=twsrc%5Etfw">April 2, 2022</a></p></blockquote><p>The second, and to my mind more troubling, problem is that the photos were &#34;protected&#34; using SmartFrame&#39;s Digital Restrictions Management.</p><p>SmartFrame has some useful features - it allows for high-resolution photos to be loaded &#34;zoomed out&#34; in lower resolution. The user can then zoom in on a portion which then gets loaded as higher resolution. That&#39;s it really. SmartFrame&#39;s main selling point is that it &#34;<a href="https://smartframe.io/">brings robust image control</a>&#34;. AKA, it uses DRM to prevent users from downloading images.</p><p>It also promises &#34;<a href="https://smartframe.io/complete-image-protection/">Complete image protection</a>&#34;. This is nonsense. If you transmit an image to a user, the user can copy that image.</p><p>Here&#39;s how easy it is to download the images which SmartFrame claims to protect.</p><h2 id="screenshots"><a href="#screenshots">Screenshots</a></h2><p>The obvious flaw in SmartFrame is that users can take screenshots of the high-resolution image. Zoom in, screenshot, pan left, another screenshot, repeat.</p><p>Of course, stitching together all those images is a bit of a pain. But perfectly possible to automate if you wanted to.</p><h2 id="canvas-chunks"><a href="#canvas-chunks">Canvas Chunks</a></h2><p>The way SmartFrame works is by loading small &#34;chunks&#34; of the image and then drawing then on a <code>&lt;canvas&gt;</code> element.</p><p>In your browser&#39;s network inspector, you&#39;ll see each 256x256 sub-image loading.</p><p>Inspecting the network requests shows that they all use the same Accept Header of <code>authorization/wndeym9ajvin,*/*</code> - that appears to be common across multiple SmartFrame instances. Bad form of them to reuse that key!</p><h2 id="canvas-access"><a href="#canvas-access">Canvas Access</a></h2><p>It&#39;s fairly easy to download anything drawn onto a <code>&lt;canvas&gt;</code> element by running:</p><pre><code>var c = document.getElementsByClassName(&#34;stage&#34;) 
c[0].toDataURL() 
</code></pre><p>However, SmartFrame have overloaded the <code>.toDataURL()</code> function - so it produces a warning when you try that. It&#39;s simple enough to disable their JS once the image has loaded.</p><p>Of course, the <code>&lt;canvas&gt;</code> is smaller than the full resolution image - so you may need to manually increase its size first.</p><p>It&#39;s also possible to simply right-click on the <code>&lt;canvas&gt;</code> in the inspector and copy the Base64 representation of the image:</p><p><img loading="lazy" src="https://shkspr.mobi/blog/wp-content/uploads/2022/05/Copy-canvas.png" alt="Screenshot of the context menu showing a download option." width="800" height="404"/></p><h2 id="putting-it-all-together"><a href="#putting-it-all-together">Putting it all together</a></h2><p>I am indebted to <a href="https://twitter.com/sil/status/1525374913535692802">Stuart Langridge for connecting all the dots</a>. He has <a href="https://gist.github.com/stuartlangridge/82c87a601a7e2ae566e640d93138ed85">written and fully documented some code</a> which is, essentially:</p><ol><li>Grab the canvas</li><li>Resize it</li><li>Wait several seconds for the image chunks to fully load onto the canvas</li><li>Turn the canvas into a Data URL</li><li>Download the data</li></ol><p>It looks something like this:</p><pre><code>var container = document.querySelector(&#34;div.articlePage.container&#34;);
container.style.width=&#34;6000px&#34;;
container.style.maxWidth=&#34;6000px&#34;;

setTimeout(()=&gt;{
  var stage = document.querySelector(&#34;canvas.stage&#34;);
  var url = document.createElement(&#34;canvas&#34;).toDataURL.call(stage);
  var a = document.createElement(&#34;a&#34;);
  a.href = url;
  a.download = &#34;liberated.png&#34;;
  a.click();
}, 3000);
</code></pre><p>And that&#39;s it. A user can paste a dozen lines of Javascript into their browser&#39;s console and get a full-resolution PNG.</p><h2 id="warnings"><a href="#warnings">Warnings</a></h2><p>This technique should only be used to download images which are free of copyright restrictions.</p><p>Companies should be careful before buying a DRM solution and ensure that it is fit for purpose. SmartFrame really isn&#39;t suitable as sold. Despite its grandiose claims of &#34;Super-strong encryption&#34; and &#34;Multi-layered theft-prevention&#34; - it took less than weekend to bypass.</p><p>It is possible that SmartFrame will update their systems to defeat this particular flaw. But, thankfully, DRM can never work effectively. You can&#39;t give users a locked box <em>and</em> a key - then expect them to only unlock the box under the &#34;right&#34; circumstances.</p><blockquote><p>
trying to make digital files uncopyable is like trying to make water not wet.</p></blockquote></div></div>
  </body>
</html>
