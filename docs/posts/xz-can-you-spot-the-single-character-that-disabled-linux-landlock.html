<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://git.tukaani.org/?p=xz.git;a=blobdiff;f=CMakeLists.txt;h=d2b1af7ab0ab759b6805ced3dff2555e2a4b3f8e;hp=76700591059711e3a4da5b45cf58474dac4e12a7;hb=328c52da8a2bbb81307644efdb58db2c422d9ba7;hpb=eb8ad59e9bab32a8d655796afd39597ea6dcc64d">Original</a>
    <h1>Xz: Can you spot the single character that disabled Linux landlock?</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<div id="patch1">






<p> # Sandboxing: Landlock</p>
<p> if(NOT SANDBOX_FOUND AND ENABLE_SANDBOX MATCHES &#34;^ON$|^landlock$&#34;)</p>
<p>-    check_include_file(linux/landlock.h HAVE_LINUX_LANDLOCK_H)</p>
<p>+    # A compile check is done here because some systems have</p>
<p>+    # linux/landlock.h, but do not have the syscalls defined</p>
<p>+    # in order to actually use Linux Landlock.</p>
<p>+    check_c_source_compiles(&#34;</p>
<p>+        #include &lt;linux/landlock.h&gt;</p>
<p>+        #include &lt;sys/syscall.h&gt;</p>
<p>+        #include &lt;sys/prctl.h&gt;</p>
<p>+.</p>
<p>+        void my_sandbox(void)</p>
<p>+        {</p>
<p>+            (void)prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0);</p>
<p>+            (void)SYS_landlock_create_ruleset;</p>
<p>+            (void)SYS_landlock_restrict_self;</p>
<p>+            (void)LANDLOCK_CREATE_RULESET_VERSION;</p>
<p>+            return;</p>
<p>+        }</p>
<p>+</p>
<p>+        int main(void) { return 0; }</p>
<p>+        &#34;</p>
<p>+    HAVE_LINUX_LANDLOCK)</p>

<p>-    if(HAVE_LINUX_LANDLOCK<span>_H</span>)</p>
<p>-        set(SANDBOX_COMPILE_DEFINITION &#34;HAVE_LINUX_LANDLOCK<span>_H</span>&#34;)</p>
<p>+    if(HAVE_LINUX_LANDLOCK)</p>
<p>+        set(SANDBOX_COMPILE_DEFINITION &#34;HAVE_LINUX_LANDLOCK&#34;)</p>
<p>         set(SANDBOX_FOUND ON)</p>

<p>         # Of our three sandbox methods, only Landlock is incompatible</p>
</div>
</div>
</div></div>
  </body>
</html>
