<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/bahaaador/bluetooth-usb-peripheral-relay">Original</a>
    <h1>Show HN: Bluetooth USB Peripheral Relay â€“ Bridge Bluetooth Devices to USB</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<div dir="auto"><h3 tabindex="-1" dir="auto">A delightfully over-engineered solution to an unusual modern problem!</h3><a id="user-content-a-delightfully-over-engineered-solution-to-an-unusual-modern-problem" aria-label="Permalink: A delightfully over-engineered solution to an unusual modern problem!" href="#a-delightfully-over-engineered-solution-to-an-unusual-modern-problem"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Use Bluetooth peripherals with Bluetooth-disabled computers.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/bahaaador/bluetooth-usb-peripheral-relay/blob/main/assets/bluetooth-usb-peripheral-relay-image.png"><img src="https://github.com/bahaaador/bluetooth-usb-peripheral-relay/raw/main/assets/bluetooth-usb-peripheral-relay-image.png" alt="Bluetooth USB HID Relay Overview"/></a></p>
<p dir="auto">This project creates a Bluetooth USB HID relay using a Raspberry Pi Zero (or similar OTG-enabled single-board computer). It allows you to use Bluetooth keyboards and mice with computers that have Bluetooth disabled, by presenting the board as a composite USB HID device.</p>

<p dir="auto">This project was born out of a desire to help a friend who couldn&#39;t use his favorite Bluetooth mouse and keyboard due to Bluetooth being disabled on his work laptop. As someone who enjoys tinkering and problem-solving, I saw this as an opportunity to create something useful while learning more about Linux internals, USB gadgets, and Go programming. The Raspberry Pi Zero became the perfect bridge, connecting Bluetooth peripherals to computers that wouldn&#39;t normally allow it.</p>
<section data-identity="1879b375-f4d2-4153-848d-d6b700f7bb21" data-host="https://viewscreen.githubusercontent.com" data-src="https://viewscreen.githubusercontent.com/markdown/mermaid?docs_host=https%3A%2F%2Fdocs.github.com" data-type="mermaid" aria-label="mermaid rendered output container">
  <div data-json="{&#34;data&#34;:&#34;graph TD\n    B(Keyboard) -- Bluetooth --&amp;gt;  A{\&#34;HID &amp;lt;br&amp;gt; (Raspberry Pi Zero)\&#34;}\n    C(Mouse) -- Bluetooth --&amp;gt; A\n    A -- USB--&amp;gt; D(Host Computer)\n&#34;}" data-plain="graph TD
    B(Keyboard) -- Bluetooth --&gt;  A{&#34;HID &lt;br&gt; (Raspberry Pi Zero)&#34;}
    C(Mouse) -- Bluetooth --&gt; A
    A -- USB--&gt; D(Host Computer)
" dir="auto">
    <div dir="auto">
      <pre lang="mermaid" aria-label="Raw mermaid code">graph TD
    B(Keyboard) -- Bluetooth --&gt;  A{&#34;HID &lt;br&gt; (Raspberry Pi Zero)&#34;}
    C(Mouse) -- Bluetooth --&gt; A
    A -- USB--&gt; D(Host Computer)
</pre>
    </div>
  </div>
  <span role="presentation">
    <span data-view-component="true">
  <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true" data-view-component="true">
    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" fill="none"></circle>
    <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke"></path>
</svg>    <span>Loading</span>
</span>
  </span>
</section>


<ul dir="auto">
<li>Connects to Bluetooth keyboards and mice</li>
<li>Presents itself as a composite USB HID device (keyboard and mouse) to the host computer</li>
<li>Works with Windows, Mac, and Linux computers</li>
<li>Automatically starts the relay service at boot</li>
<li>Configures the board as a USB OTG device</li>
<li>Includes a script to help pair Bluetooth devices</li>
</ul>

<ul dir="auto">
<li>Raspberry Pi Zero or other single-board computer capable of USB OTG</li>
<li>DietPi or another lightweight Linux distribution</li>
<li>Bash scripts for setup and configuration</li>
<li>Go program for handling Bluetooth input and USB HID output</li>
<li>Systemd service for automatic startup</li>
</ul>

<p dir="auto">Before building and running the project, ensure you have the following installed:</p>
<ol dir="auto">
<li>
<p dir="auto">Go (version 1.21 or later)</p>
<p dir="auto">On most Linux distributions, including Raspberry Pi OS (formerly Raspbian), you can install Go using:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo apt-get update
sudo apt-get install golang"><pre>sudo apt-get update
sudo apt-get install golang</pre></div>
</li>
<li>
<p dir="auto">Task runner using:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sh -c &#34;$(curl --location https://taskfile.dev/install.sh)&#34; -- -d -b ~/.local/bin"><pre>sh -c <span><span>&#34;</span><span><span>$(</span>curl --location https://taskfile.dev/install.sh<span>)</span></span><span>&#34;</span></span> -- -d -b <span>~</span>/.local/bin</pre></div>
<p dir="auto">or</p>
<div dir="auto" data-snippet-clipboard-copy-content="go install github.com/go-task/task/v3/cmd/task@latest"><pre>go install github.com/go-task/task/v3/cmd/task@latest</pre></div>
</li>
</ol>
<blockquote>
<p dir="auto">Note: You may need to add $(go env GOPATH)/bin to your PATH environment variable with the second command.</p>
</blockquote>

<p dir="auto"><strong>Please read before proceeding:</strong></p>
<p dir="auto">This project is currently in an experimental state and has only been tested on a limited number of devices. While it works well for my use case, please be aware that:</p>
<ul dir="auto">
<li>The scripts modify system-level configurations and USB settings</li>
<li>Incorrect USB gadget configuration could potentially require a fresh OS installation to recover</li>
<li>The project has only been tested on a small number of devices and configurations</li>
<li>This is a personal project, not production-ready software</li>
</ul>
<p dir="auto"><strong>Before running this project, you should:</strong></p>
<ul dir="auto">
<li>Only use it on devices where you can easily reinstall the OS if needed</li>
<li>Carefully review all scripts and code before execution</li>
<li>Have a backup plan in case something goes wrong</li>
<li>Be comfortable with Linux system administration and USB configurations</li>
</ul>
<p dir="auto">I cannot guarantee this will work on all devices or configurations. Proceed at your own risk.</p>

<ol dir="auto">
<li>
<p dir="auto">Log in to your Raspberry Pi Zero.</p>
</li>
<li>
<p dir="auto">Clone this repository to your board.</p>
</li>
<li>
<p dir="auto">Run the setup scripts in the following order:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo chmod +x scripts/*.sh # make sure all scripts are executable
sudo ./scripts/setup_usb_host.sh # enable the USB host and load the necessary modules
sudo reboot
sudo ./scripts/setup_bluetooth.sh # enable and start the bluetooth service
sudo ./scripts/setup_gadgets.sh # create the gadget and configure the USB strings"><pre>sudo chmod +x scripts/<span>*</span>.sh <span><span>#</span> make sure all scripts are executable</span>
sudo ./scripts/setup_usb_host.sh <span><span>#</span> enable the USB host and load the necessary modules</span>
sudo reboot
sudo ./scripts/setup_bluetooth.sh <span><span>#</span> enable and start the bluetooth service</span>
sudo ./scripts/setup_gadgets.sh <span><span>#</span> create the gadget and configure the USB strings</span></pre></div>
</li>
<li>
<p dir="auto">Pair your Bluetooth devices manually or using the script:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo ./scripts/pair_devices.sh"><pre>sudo ./scripts/pair_devices.sh</pre></div>
</li>
<li>
<p dir="auto">Build and install the service:</p>
<div dir="auto" data-snippet-clipboard-copy-content="task build
sudo task service:install"><pre>task build
sudo task service:install</pre></div>
</li>
</ol>

<p dir="auto">Connect the board to the target computer via USB. This will turn the board on and start the service automatically (assuming it was installed and enabled using the steps above) the bluetooth peripherals should connect automatically as well and the service will retry if they are not connected momentarily. Both Windows and MacOS have been tested and should work.</p>

<p dir="auto">This project uses Task runner for common operations:</p>

<ul dir="auto">
<li><code>task --list</code> - List all available tasks</li>
<li><code>task build</code> - Build the project</li>
<li><code>task clean</code> - Clean build artifacts</li>
<li><code>task test</code> - Run tests</li>
<li><code>task run</code> - Build and run the application</li>
<li><code>task doctor</code> - Run the diagnose tool</li>
<li><code>task simulate</code> - Run the simulate tool</li>
</ul>

<ul dir="auto">
<li><code>task service:install</code> - Install and enable the service</li>
<li><code>task service:status</code> - Check service status</li>
<li><code>task service:logs</code> - View service logs</li>
<li><code>task service:restart</code> - Restart the service</li>
<li><code>task service:start</code> - Start the service</li>
<li><code>task service:stop</code> - Stop the service</li>
<li><code>task service:uninstall</code> - Remove the service</li>
</ul>


<p dir="auto">This tool will check for connected Bluetooth devices and display all incoming events from your Bluetooth keyboard and mouse, helping you debug connection and input issues.</p>


<p dir="auto">To test the USB HID output without Bluetooth devices:</p>

<p dir="auto">This interactive tool allows you to:</p>
<ol dir="auto">
<li>Move the mouse in a circle pattern</li>
<li>Type a test message
These simulations help verify that the USB HID device is working correctly on the host computer.</li>
</ol>
<div dir="auto"><h3 tabindex="-1" dir="auto">Uninstall and remove gadget</h3><a id="user-content-uninstall-and-remove-gadget" aria-label="Permalink: Uninstall and remove gadget" href="#uninstall-and-remove-gadget"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To uninstall the service:</p>

<p dir="auto">To remove the gadget and restore the USB host configuration:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./scripts/uninstall/undo_setup_gadgets.sh
./scripts/uninstall/undo_setup_usb_host.sh"><pre>./scripts/uninstall/undo_setup_gadgets.sh
./scripts/uninstall/undo_setup_usb_host.sh</pre></div>

<p dir="auto">This project can be used as is or as basis for other types of USB gadgets. It can also serve as a learning opportunity for:</p>
<ul dir="auto">
<li>Linux internals</li>
<li>Creating USB gadgets</li>
<li>Using Go for hardware interfacing</li>
<li>Setting up systemd services</li>
<li>Configuring single-board computers as USB OTG devices</li>
<li>Bluetooth device pairing and management</li>
</ul>
<p dir="auto">It&#39;s been a fun journey of discovery, and I hope others find it useful or inspiring for their own projects!</p>

<p dir="auto">Tested with DietPi 64bit as host and Windows 10 and MacOS USB clients to which the keyboard and mouse were connected. No issues with latency or input delay. My friend have been using this setup for a few days now and it works great.</p>

<p dir="auto">Found a bug or have a suggestion? Please feel free to create an issue on GitHub! I&#39;m actively maintaining this project and would be happy to look into any problems or improvements you identify. While this is a personal project, I&#39;m committed to helping others get it working and making it better.</p>
<p dir="auto">Your feedback and contributions help make this project more reliable for everyone! ðŸ’œ</p>

<ul dir="auto">
<li><a href="https://cdn-learn.adafruit.com/downloads/pdf/turning-your-raspberry-pi-zero-into-a-usb-gadget.pdf" rel="nofollow">Adafruit Guide: Turning your Raspberry Pi Zero into a USB Gadget</a></li>
<li><a href="https://www.isticktoit.net/?p=1383" rel="nofollow">Composite USB Gadgets on the Raspberry Pi Zero</a></li>
</ul>

<p dir="auto">This project is licensed under the MIT License - see the <a href="https://github.com/bahaaador/bluetooth-usb-peripheral-relay/blob/main/LICENSE">LICENSE</a> file for details.</p>
</article></div></div>
  </body>
</html>
