<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zarar.dev/anatomy-of-a-mental-breakdown/">Original</a>
    <h1>The anatomy of a 2AM mental breakdown</h1>
    
    <div id="readability-page-1" class="page"><div>
    







<p>
    <i>
        <time datetime="2024-08-20T13:15Z">
            20 Aug, 2024
        </time>
    </i>
</p>


    <p>Note: this <a href="https://news.ycombinator.com/item?id=41300368">made it on HN</a> somehow.</p>
<p>Around 2AM this morning I had a realization that this was the most stressed I have ever been. On verge of a complete breakdown.</p>
<p>Why? Because I noticed around 10PM that jumpcomedy.com was entirely broken with all HTTP POST calls made by RTK Query failing. Nothing worked and though I had deployed recent changes, none of them would cause this. I was at a complete loss as to where to look, especially as this is working locally. Posting on the usual Discords (NextJS, Vercel) is leading to dead silence. I&#39;m alone and have to fix this issue which I didn&#39;t cause.</p>
<p>This isn&#39;t the first production defect I&#39;ve introduced in my 25 years of working, but this is the first one where I had absolutely nobody to turn to in a time of crisis while customer complaints are piling up at a rate never seen before. No production support, no SRE, no Sr. Engineer, no manager to make it go away. Nothing. And here&#39;s the worst part: people who have taken a chance on me to the point where their entire small businesses depend on me are sad. Not only do I have no idea how to fix this, I&#39;m also hurting people. This absolutely sucks. I felt shame, sorrow, and incompetence. Oh the incompetence and the imposter syndrome that comes with it.</p>
<p>The thoughts that were crossing my mind were bizarre: do I just shut this business down? Do I send a mass apology email to my customers and just ask them to pick a different event management provider? What do I do because I don&#39;t know where to look and it&#39;s been four hours already.</p>
<p>Enter Eminem. <em>Alright, calm down, relax, start breathin&#39;</em></p>
<p>I started breathing but it didn&#39;t help a damn as I still didn&#39;t know what the issue was. No matter how many <code>console.log()</code> statements I sprinkled around, nothing made sense. Was it the headers, the length of the API token, the sequence of calls...but it was just working. Why? WHY? WHY???? IS THIS HAPPENING? And why are GET and DELETE calls working?</p>
<p>It&#39;s OK. The world won&#39;t end. So what if your business entirely fails and you&#39;re paraded at the next tech conference as a case of what not to do. Oh well, that&#39;s your destiny, just deal with it BUT right now deal with this goddamn bug that you didn&#39;t cause but have to suffer through. The only clue I have is that it&#39;s working on localhost, which reminded me of that old joke where during a production outage the junior developer tells his boss, &#34;but it&#39;s working on my machine&#34;. Well buddy, you&#39;re the junior developer. Also, you&#39;re a sack of shit. No, no, don&#39;t go there. There&#39;s plenty of time for self-reflection and self-hate later, but right now just see why those cursed POST calls are failing with:</p>
<p><em>TypeError: failed to execute &#39;fetch&#39; on &#39;window&#39;: …with a request object that has already been used</em></p>
<p>Now that error message is a complete red herring and tells me nothing. It may as well have said, &#34;The Lannisters refuse to pay their debts and flight UA763 from Miami is delayed&#34;.</p>
<p>Haha. I start making jokes to add some levity to the situation. It&#39;s not so bad, life is about nature and trees and sooner this business shuts down and you take a boat to a deserted island, the sooner you can start your memoirs and the first chapter of the memoir would be: <em>TypeError: failed to execute &#39;fetch&#39;</em>.</p>
<p>My wife. Oh my poor wife. She offered me a cup of tea and ruffled my hair. &#34;It&#39;s OK, big companies have production outages too&#34;. Ah, that&#39;s so sweet of her. I told her to go to bed while I question every major life decision leading up to this moment. Oh shit, what&#39;s this? It&#39;s customer emails piling up in my inbox. Lovely.</p>
<p>&#34;Hey Zarar, I can&#39;t change the the price of my event&#34;</p>
<p>&#34;Hi Zarar, I&#39;m trying to remove a promo code and it won&#39;t let me&#34;</p>
<p>....</p>
<p>Please, can I just delete my email at this point and take a bus to the northern wilderness? Because I still have no clue what&#39;s going on and now I&#39;m thinking maybe I should take that break to clear my head.  You know, like they say in those self-help books, but what they don&#39;t say is that every five minutes I&#39;m getting an email saying something&#39;s broken and my response is basically, &#34;I apologize. Working on it&#34;. But I&#39;m not working on it, I&#39;m just staring at the screen putting debug statements where I feel Chrome Inspector is saying, &#34;Bro you serious? You think there&#39;s a bug on <em>this</em> line?&#34;</p>
<p>Ah, what&#39;s this? A Chrome update came in today? Could that have caused it? Hmmm...hope, I see hope.  DASHED. HOPE IS DASHED! This is reproducible in Firefox and Edge. Edge? Even Edge is like WTF.  Back to console.log() and break points. Now I&#39;m dealing with source maps and libraries that don&#39;t publish source maps so now I&#39;m looking at code that looks like this:</p>
<div><pre><span></span>eC=Math.random().toString(36).slice(2),eE=&#34;__reactFiber$&#34;+eC,ex=&#34;__reactProps$&#34;+eC,ez=&#34;__reactContainer$&#34;+eC,eP=&#34;__reactEvents$&#34;+eC,eN=&#34;__reactListeners$&#34;+eC,e_=&#34;__reactHandles$&#34;+eC,eL=&#34;__reactResources$&#34;+eC,eT=&#34;__reactMarker$&#34;+eC;
</pre></div>
<p>This is no good. Let me just try reverting to a version from a month ago. Nothing. Three months ago? Nothing. Still failing. A year ago? Zilch.</p>
<p>OK, so you re-ask the question what&#39;s happening in prod that&#39;s happening locally. Or vice-versa. Some candidates:</p>
<ul>
<li>Sentry is disabled locally</li>
<li>Databases are pointing to docker instead of cloud providers</li>
<li>Cloudflare’s a proxy</li>
</ul>
<p>Got rid of Sentry in production. Nothing. Pointed to PROD databases locally. Nothing. Disable Cloudflare. Makes no matter. Maybe I should take that break, if only to calculate the financial damage and the much more significant reputational damage.</p>
<p>What else is different? Maybe PostHog, I have the api_key blanked out locally to reduce costs, so let me just add it to see what gives. Shot in the dark. 1 in a million chance. Let&#39;s do it.</p>
<p>WHAT?! REPRODUCED ON LOCALHOST. GIVE ME THAT FUCKING CUP OF TEA NOW!</p>
<p>Next commit: take out PostHog and everything is working.</p>
<p>At this point I&#39;m thinking all the people I&#39;ve recommended PostHog to as this &#34;amazing tool which <em>shows</em> you what your users are experiencing&#34;. How naive I was? Right now I hate PostHog more than anything and can&#39;t believe I was about to pay for that product (still a good product, I&#39;m overreacting here). But still, in the moment I wanted to burn the company down.</p>
<p>But I did feel good about finding the defect because soon after many people reported the same:</p>
<p><a href="https://github.com/PostHog/posthog/issues/24471">https://github.com/PostHog/posthog/issues/24471</a></p>
<p><a href="https://github.com/reduxjs/redux-toolkit/issues/4573">https://github.com/reduxjs/redux-toolkit/issues/4573</a></p>
<p>So that was my night!</p>
<h4 id="subscribe-to-my-blog">Subscribe to my blog</h4>

<p>There&#39;s also the <a href="https://zarar.dev/feed/">RSS feed</a>.</p>





    

    
    


    



  </div></div>
  </body>
</html>
