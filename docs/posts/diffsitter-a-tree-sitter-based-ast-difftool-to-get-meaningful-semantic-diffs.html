<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/afnanenayet/diffsitter">Original</a>
    <h1>Diffsitter â€“ A Tree-sitter based AST difftool to get meaningful semantic diffs</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/afnanenayet/diffsitter/actions/workflows/CI.yml"><img src="https://github.com/afnanenayet/diffsitter/actions/workflows/CI.yml/badge.svg" alt="CI"/></a>
<a href="https://github.com/afnanenayet/diffsitter/actions/workflows/CD.yml"><img src="https://github.com/afnanenayet/diffsitter/actions/workflows/CD.yml/badge.svg" alt="CD"/></a>
<a href="https://codecov.io/gh/afnanenayet/diffsitter" rel="nofollow"><img src="https://camo.githubusercontent.com/781a7c84e57401c73d1b4d6a9476ecbcfb04bba3d2aaa27dd36e93c36d3da00c/68747470733a2f2f636f6465636f762e696f2f67682f61666e616e656e617965742f646966667369747465722f6272616e63682f6d61696e2f67726170682f62616467652e7376673f746f6b656e3d4742544a475845584f53" alt="codecov" data-canonical-src="https://codecov.io/gh/afnanenayet/diffsitter/branch/main/graph/badge.svg?token=GBTJGXEXOS"/></a>
<a href="https://crates.io/crates/diffsitter" rel="nofollow"><img src="https://camo.githubusercontent.com/06e2980de29f60803bedfb7cfbe369b4bb2bc1aa1a9d70b61e5094bdc2a9e204/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f64696666736974746572" alt="crates version" data-canonical-src="https://img.shields.io/crates/v/diffsitter"/></a>
<a href="https://github.com/afnanenayet/diffsitter/releases/latest"><img src="https://camo.githubusercontent.com/8720bc2a809e1dda7a270e19aa232115907a167726821e2099e6ba78ce7bf897/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f72656c656173652f61666e616e656e617965742f64696666736974746572" alt="GitHub release (latest by date)" data-canonical-src="https://img.shields.io/github/v/release/afnanenayet/diffsitter"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/bbbf1388f34d3406d9e0ecbc55cb8165d053208df65de85abf021e3a6ab0261a/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f642f64696666736974746572"><img src="https://camo.githubusercontent.com/bbbf1388f34d3406d9e0ecbc55cb8165d053208df65de85abf021e3a6ab0261a/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f642f64696666736974746572" alt="downloads" data-canonical-src="https://img.shields.io/crates/d/diffsitter"/></a>
<a href="https://ldirer.com/afnanenayet/diffsitter/blob/main/LICENSE"><img src="https://camo.githubusercontent.com/6b5df81bbd89955fae3c8cebfef46f5746fccbeccb27302cbbdc85003fc4f918/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f61666e616e656e617965742f64696666736974746572" alt="license" data-canonical-src="https://img.shields.io/github/license/afnanenayet/diffsitter"/></a></p>
<p dir="auto"><a href="https://asciinema.org/a/joEIfP8XoxUhZKXEqUD8CEP7j" rel="nofollow"><img src="https://camo.githubusercontent.com/d7e7dc740e1d944a9a80e1b7220ba62784865234d138d98c720e5bcbc56668b4/68747470733a2f2f61736369696e656d612e6f72672f612f6a6f4549665038586f7855685a4b584571554438434550376a2e737667" alt="asciicast" data-canonical-src="https://asciinema.org/a/joEIfP8XoxUhZKXEqUD8CEP7j.svg"/></a></p>

<p dir="auto"><code>diffsitter</code> is very much a work in progress and nowhere close to production
ready (yet). Contributions are always welcome!</p>

<p dir="auto"><code>diffsitter</code> creates semantically meaningful diffs that ignore formatting
differences like spacing. It does so by computing a diff on the AST (abstract
syntax tree) of a file rather than computing the diff on the text contents of
the file.</p>
<p dir="auto"><code>diffsitter</code> uses the parsers from the
<a href="https://tree-sitter.github.io/tree-sitter" rel="nofollow">tree-sitter</a> project to parse
source code. As such, the languages supported by this tool are restricted to the
languages supported by tree-sitter.</p>
<p dir="auto"><code>diffsitter</code> supports the following languages:</p>
<ul dir="auto">
<li>Bash</li>
<li>C#</li>
<li>C++</li>
<li>CSS</li>
<li>Go</li>
<li>Java</li>
<li>OCaml</li>
<li>PHP</li>
<li>Python</li>
<li>Ruby</li>
<li>Rust</li>
<li>Typescript/TSX</li>
<li>HCL</li>
</ul>

<p dir="auto">Take the following files:</p>
<p dir="auto"><a href="https://ldirer.com/afnanenayet/diffsitter/blob/main/test_data/short/rust/a.rs"><code>a.rs</code></a></p>
<div dir="auto" data-snippet-clipboard-copy-content="fn main() {
    let x = 1;
}

fn add_one {
}"><pre><span>fn</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>let</span> x = <span>1</span><span>;</span>
<span>}</span>

<span>fn</span> add_one <span>{</span>
<span>}</span></pre></div>
<p dir="auto"><a href="https://ldirer.com/afnanenayet/diffsitter/blob/main/test_data/short/rust/b.rs"><code>b.rs</code></a></p>
<div dir="auto" data-snippet-clipboard-copy-content="fn



main

()

{
}

fn addition() {
}

fn add_two() {
}"><pre><span>fn</span>



<span>main</span>

<span>(</span><span>)</span>

<span>{</span>
<span>}</span>

<span>fn</span> <span>addition</span><span>(</span><span>)</span> <span>{</span>
<span>}</span>

<span>fn</span> <span>add_two</span><span>(</span><span>)</span> <span>{</span>
<span>}</span></pre></div>
<p dir="auto">The standard output from <code>diff</code> will get you:</p>
<div data-snippet-clipboard-copy-content="1,2c1,12
&lt; fn main() {
&lt;     let x = 1;
---
&gt; fn
&gt;
&gt;
&gt;
&gt; main
&gt;
&gt; ()
&gt;
&gt; {
&gt; }
&gt;
&gt; fn addition() {
5c15
&lt; fn add_one {
---
&gt; fn add_two() {"><pre lang="text"><code>1,2c1,12
&lt; fn main() {
&lt;     let x = 1;
---
&gt; fn
&gt;
&gt;
&gt;
&gt; main
&gt;
&gt; ()
&gt;
&gt; {
&gt; }
&gt;
&gt; fn addition() {
5c15
&lt; fn add_one {
---
&gt; fn add_two() {
</code></pre></div>
<p dir="auto">You can see that it picks up the formatting differences for the <code>main</code>
function, even though they aren&#39;t semantically different.</p>
<p dir="auto">Check out the output from <code>diffsitter</code>:</p>
<div data-snippet-clipboard-copy-content="test_data/short/rust/a.rs -&gt; test_data/short/rust/b.rs
======================================================

9:
--
+ }

11:
---
+ fn addition() {

1:
--
-     let x = 1;

14:
---
+ fn add_two() {

4:
--
- fn add_one {"><pre><code>test_data/short/rust/a.rs -&gt; test_data/short/rust/b.rs
======================================================

9:
--
+ }

11:
---
+ fn addition() {

1:
--
-     let x = 1;

14:
---
+ fn add_two() {

4:
--
- fn add_one {
</code></pre></div>
<p dir="auto"><em>Note: the numbers correspond to line numbers from the original files.</em></p>
<p dir="auto">You can also filter which tree sitter nodes are considered in the diff through
the config file.</p>
<p dir="auto">Since it uses the AST to calculate the difference, it knows that the formatting
differences in <code>main</code> between the two files isn&#39;t a meaningful difference, so
it doesn&#39;t show up in the diff.</p>
<p dir="auto"><code>diffsitter</code> has some nice (terminal aware) formatting too:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ldirer.com/afnanenayet/diffsitter/blob/main/assets/rust_example.png"><img src="https://ldirer.com/afnanenayet/diffsitter/raw/main/assets/rust_example.png" alt="screenshot of rust diff"/></a></p>
<p dir="auto">It also has extensive logging if you want to debug or see timing information:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ldirer.com/afnanenayet/diffsitter/blob/main/assets/rust_example_logs.png"><img src="https://ldirer.com/afnanenayet/diffsitter/raw/main/assets/rust_example_logs.png" alt="screenshot of rust diff with logs"/></a></p>

<p dir="auto">You can filter the nodes that are considered in the diff by setting
<code>include_nodes</code> or <code>exclude_nodes</code> in the config file. <code>exclude_nodes</code> always
takes precedence over <code>include_nodes</code>, and the type of a node is the <code>kind</code>
of a tree-sitter node. The <code>kind</code> directly corresponds to whatever is reported
by the tree-sitter API, so this example may occasionally go out of date.</p>
<p dir="auto">This feature currently only applies to leaf nodes, but we could exclude nodes
recursively if there&#39;s demand for it.</p>
<div dir="auto" data-snippet-clipboard-copy-content="&#34;input-processing&#34;: {
    // You can exclude different tree sitter node types - this rule takes precedence over `include_kinds`.
    &#34;exclude_kinds&#34;: [&#34;string_content&#34;],
    // You can specifically allow only certain tree sitter node types
    &#34;include_kinds&#34;: [&#34;method_definition&#34;],
}"><pre><span>&#34;input-processing&#34;</span>: <span>{</span>
    <span>// You can exclude different tree sitter node types - this rule takes precedence over `include_kinds`.</span>
    <span>&#34;exclude_kinds&#34;</span>: <span>[</span><span>&#34;string_content&#34;</span><span>]</span><span>,</span>
    <span>// You can specifically allow only certain tree sitter node types</span>
    <span>&#34;include_kinds&#34;</span>: <span>[</span><span>&#34;method_definition&#34;</span><span>]</span><span>,</span>
<span>}</span></pre></div>

<a href="https://repology.org/project/diffsitter/versions" rel="nofollow">
  <img src="https://camo.githubusercontent.com/c2189fc8e7869346f99c66dabed4915069543e9cceaf609dc0fafa64131510dd/68747470733a2f2f7265706f6c6f67792e6f72672f62616467652f766572746963616c2d616c6c7265706f732f646966667369747465722e737667" alt="Packaging status" data-canonical-src="https://repology.org/badge/vertical-allrepos/diffsitter.svg"/>
</a>

<p dir="auto">This project uses Github actions to build and publish binaries for each tagged
release. You can download binaries from there if your platform is listed. We
publish <a href="https://github.com/afnanenayet/diffsitter/releases/tag/nightly">nightly releases</a>
as well as tagged <a href="https://github.com/afnanenayet/diffsitter/releases/latest">stable releases</a>.</p>

<p dir="auto">You can build from source with <code>cargo</code> using the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo install diffsitter --bin diffsitter"><pre>cargo install diffsitter --bin diffsitter</pre></div>
<p dir="auto">If you want to generate completion files and other assets you can install the
<code>diffsitter_completions</code> binary with the following command:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cargo install diffsitter --bin diffsitter_completions"><pre>cargo install diffsitter --bin diffsitter_completions</pre></div>

<p dir="auto">You can use my tap to install diffsitter:</p>
<div dir="auto" data-snippet-clipboard-copy-content="brew tap afnanenayet/tap
brew install diffsitter
# brew install afnanenayet/tap/diffsitter"><pre>brew tap afnanenayet/tap
brew install diffsitter
<span><span>#</span> brew install afnanenayet/tap/diffsitter</span></pre></div>

<p dir="auto">@samhh has packaged diffsitter for arch on the AUR. Use your favorite AUR
helper to install <a href="https://aur.archlinux.org/packages/diffsitter-bin/" rel="nofollow"><code>diffsitter-bin</code></a>.</p>

<p dir="auto">Install package <a href="https://pkgs.alpinelinux.org/packages?name=diffsitter" rel="nofollow">diffsitter</a> from the Alpine Linux repositories (on v3.16+ or Edge):</p>

<p dir="auto">Tree-sitter grammars are packaged separately (search for <a href="https://pkgs.alpinelinux.org/packages?name=tree-sitter-*&amp;arch=x86_64" rel="nofollow">tree-sitter-*</a>).
You can install individual packages you need or the virtual package <code>tree-sitter-grammars</code> to install all of them.</p>

<p dir="auto">We also provide a Docker image that builds diffsitter using the standard Rust
base image. It separates the compilation stage from the run stage, so you can
build it and run with the following command (assuming you have Docker installed
on your system):</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker build -t diffsitter .
docker run -it --rm --name diffsitter-interactive diffsitter"><pre>docker build -t diffsitter <span>.</span>
docker run -it --rm --name diffsitter-interactive diffsitter</pre></div>

<p dir="auto">For detailed help you can run <code>diffsitter --help</code> (<code>diffsitter -h</code> provides
brief help messages).</p>
<p dir="auto">You can configure file associations and formatting options for <code>diffsitter</code>
using a config file. If a config is not supplied, the app will use the default
config, which you can see with <code>diffsitter dump-default-config</code>. It will
look for a config at <code>${XDG_HOME:-$HOME}/.config/diffsitter/config.json5</code> on
macOS and Linux, and the standard directory for Windows. You can also refer to
the <a href="https://ldirer.com/afnanenayet/diffsitter/blob/main/assets/sample_config.json5">sample config</a>.</p>
<p dir="auto">You can override the default config path by using the <code>--config</code> flag or set
the <code>DIFFSITTER_CONFIG</code> environment variable.</p>
<p dir="auto"><em>Note: the tests for this crate check to make sure the provided sample config
is a valid config.</em></p>

<p dir="auto">To see the changes to the current git repo in diffsitter, you can add
the following to your repo&#39;s <code>.git/config</code> and run <code>git difftool</code>.</p>
<div data-snippet-clipboard-copy-content="[diff]
        tool = diffsitter

[difftool]
        prompt = false

[difftool &#34;diffsitter&#34;]
        cmd = diffsitter &#34;$LOCAL&#34; &#34;$REMOTE&#34;"><pre><code>[diff]
        tool = diffsitter

[difftool]
        prompt = false

[difftool &#34;diffsitter&#34;]
        cmd = diffsitter &#34;$LOCAL&#34; &#34;$REMOTE&#34;
</code></pre></div>

<p dir="auto">You can generate shell completion scripts using the binary using the
<code>gen-completion</code> subcommand. This will print the shell completion script for a
given shell to <code>STDOUT</code>.</p>
<p dir="auto">You should use the help text for the most up to date usage information, but
general usage would look like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="diffsitter gen-completion bash &gt; completion.bash"><pre>diffsitter gen-completion bash <span>&gt;</span> completion.bash</pre></div>
<p dir="auto">We currently support the following shells (via <code>clap_complete</code>):</p>
<ul dir="auto">
<li>Bash</li>
<li>Zsh</li>
<li>Fish</li>
<li>Elvish</li>
<li>Powershell</li>
</ul>

<p dir="auto"><code>diffsitter</code> is usually compiled as a static binary, so the <code>tree-sitter</code>
grammars/libraries are baked into the binary as static libraries. There is an
option to build with support for dynamic libraries which will look for shared
library files in the user&#39;s default library path. This will search for
library files of the form <code>libtree-sitter-{lang}.{ext}</code>, where <code>lang</code> is the
language that the user is trying to diff and <code>ext</code> is the platform-specific
extension for shared library files (<code>.so</code>, <code>.dylib</code>, etc). The user can
override the dynamic library file for each language in the config as such:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
    &#34;grammar&#34;: {
        // You can specify the dynamic library names for each language
        &#34;dylib-overrides&#34;: {
            // with a filename
            &#34;rust&#34;: &#34;libtree-sitter-rust.so&#34;,
            // with an absolute path
            &#34;c&#34;: &#34;/usr/lib/libtree-sitter-c.so&#34;,
            // with a relative path
            &#34;cpp&#34;: &#34;../libtree-sitter-c.so&#34;,
        },
    }
}"><pre><span>{</span>
    <span>&#34;grammar&#34;</span>: <span>{</span>
        <span>// You can specify the dynamic library names for each language</span>
        <span>&#34;dylib-overrides&#34;</span>: <span>{</span>
            <span>// with a filename</span>
            <span>&#34;rust&#34;</span>: <span>&#34;libtree-sitter-rust.so&#34;</span><span>,</span>
            <span>// with an absolute path</span>
            <span>&#34;c&#34;</span>: <span>&#34;/usr/lib/libtree-sitter-c.so&#34;</span><span>,</span>
            <span>// with a relative path</span>
            <span>&#34;cpp&#34;</span>: <span>&#34;../libtree-sitter-c.so&#34;</span><span>,</span>
        <span>}</span><span>,</span>
    <span>}</span>
<span>}</span></pre></div>
<p dir="auto"><em>The above excerpt was taken from the
<a href="https://ldirer.com/afnanenayet/diffsitter/blob/main/assets/sample_config.json5">sample config</a>.</em></p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Questions, Bugs, and Support</h2><a id="user-content-questions-bugs-and-support" aria-label="Permalink: Questions, Bugs, and Support" href="#questions-bugs-and-support"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you notice any bugs, have any issues, want to see a new feature, or just
have a question, feel free to open an
<a href="https://github.com/afnanenayet/diffsitter/issues">issue</a> or create a
<a href="https://github.com/afnanenayet/diffsitter/discussions">discussion post</a>.</p>
<p dir="auto">If you file an issue, it would be preferable that you include a minimal example
and/or post the log output of <code>diffsitter</code> (which you can do by adding the
<code>-d/--debug</code> flag).</p>

<p dir="auto">See <a href="https://ldirer.com/afnanenayet/diffsitter/blob/main/docs/CONTRIBUTING.md">CONTRIBUTING.md</a>.</p>

<ul dir="auto">
<li><a href="https://github.com/Wilfred/difftastic">difftastic</a></li>
<li><a href="https://github.com/bugout-dev/locust">locust</a></li>
<li><a href="https://github.com/GumTreeDiff/gumtree">gumtree</a></li>
<li><a href="https://github.com/mookid/diffr">diffr</a></li>
<li><a href="https://github.com/dandavison/delta">delta</a></li>
<li><a href="https://www.sdt.dev" rel="nofollow">Semantic Diff Tool</a></li>
</ul>
</article></div></div>
  </body>
</html>
