<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google/mangle">Original</a>
    <h1>Mangle, a programming language for deductive database programming</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Mangle is a programming language for deductive database programming. It
is an extension of Datalog, with various extensions like aggregation, function
calls and optional type-checking.</p>
<p dir="auto">Deductive database is useful for bringing data from multiple data sources
together since it enables us to represent and query that data in a uniform way.
It can also be used to model domain knowledge, similar to machine-readable
ontology but without being restricted to binary predicates.</p>
<p dir="auto">Datalog is an expressive declarative language similar to relational calculus
(think SQL and relational views). Unlike relational calculus, it also supports
recursive rules and program structuring in a straightforward way.</p>
<p dir="auto">Mangle contains Datalog as a fragment and adds extensions that make its use
more practical. Some of the good properties like guaranteed termination are
lost when extensions are used.</p>
<p dir="auto">The goal of Mangle as an open source project is to convey the concepts in
a way that is accessible to developers and lends itself to easy experimentation.
This repository contains an implementation of Mangle as a go library that can be
easily embedded into applications.</p>
<p dir="auto">This is not an officially supported Google product. The Mangle maintainers
welcome external contributions to spec, documentation and this
implementation (see <a href="https://github.com/google/mangle/blob/main/CONTRIBUTING.md">CONTRIBUTING.md</a>) and also other
implementations. Pull requests will be handled <a href="https://github.com/tensorflow/tensorflow/blob/master/CONTRIBUTING.md">like for tensorflow</a>,
to ensure our internal use cases and tests continue to work.</p>
<h2 dir="auto"><a id="user-content-table-of-contents" aria-hidden="true" href="#table-of-contents"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Table of Contents</h2>
<ul dir="auto">
<li><a href="#examples">Examples</a></li>
</ul>

<ul dir="auto">
<li>Building(#building)</li>
</ul>
<h2 dir="auto"><a id="user-content-examples" aria-hidden="true" href="#examples"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Examples</h2>
<h3 dir="auto"><a id="user-content-simple-queries" aria-hidden="true" href="#simple-queries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Simple Queries</h3>
<p dir="auto">Imagine you were asked to spot software affected by the
<a href="https://www.cisa.gov/uscert/apache-log4j-vulnerability-guidance" rel="nofollow">log4j vulnerability discovered in late 2021</a>.
We do this by looking for projects that contain a Java archive (jar file) of
log4j that is not patched version.</p>
<div dir="auto" data-snippet-clipboard-copy-content="projects_with_vulnerable_log4j(P) :-
  projects(P),
  contains_jar(P, &#34;log4j&#34;, Version),
  Version != &#34;2.17.1&#34;,
  Version != &#34;2.12.4&#34;,
  Version != &#34;2.3.2&#34;."><pre><span>projects_with_vulnerable_log4j</span>(<span>P</span>) <span>:-</span>
  projects(<span>P</span>),
  contains_jar(<span>P</span>, <span>&#34;log4j&#34;</span>, <span>Version</span>),
  <span>Version</span> <span>!</span><span>=</span> <span>&#34;2.17.1&#34;</span>,
  <span>Version</span> <span>!</span><span>=</span> <span>&#34;2.12.4&#34;</span>,
  <span>Version</span> <span>!</span><span>=</span> <span>&#34;2.3.2&#34;</span><span>.</span></pre></div>
<p dir="auto">This is a Mangle <em>rule</em>: conceptually, the implementation retrieve all
possible values for variables <code>P</code> and <code>Version</code> that make all the subgoals true.</p>
<p dir="auto">Simple Mangle rules like this correspond to select-project-join relational
queries. The same query in SQL would look like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="SELECT projects.id as P
FROM projects JOIN contains_jar ON projects.id = contains_jar.project_id
WHERE contains_jar.version NOT IN (&#34;2.17.1&#34;, &#34;2.12.4&#34;, &#34;2.3.2&#34;)"><pre><span>SELECT</span> <span>projects</span>.<span>id</span> <span>as</span> P
<span>FROM</span> projects <span>JOIN</span> contains_jar <span>ON</span> <span>projects</span>.<span>id</span> <span>=</span> <span>contains_jar</span>.<span>project_id</span>
<span>WHERE</span> <span>contains_jar</span>.<span>version</span> NOT <span>IN</span> (<span><span>&#34;</span>2.17.1<span>&#34;</span></span>, <span><span>&#34;</span>2.12.4<span>&#34;</span></span>, <span><span>&#34;</span>2.3.2<span>&#34;</span></span>)</pre></div>
<p dir="auto">Unlike SQL, our Mangle rule <code>projects_with_vulnerable_log4j</code> has a name
and can be referenced in other queries.</p>
<p dir="auto">(If translating non-recursive Datalog into SQL queries sounds interesting, you
should check out the <a href="https://logica.dev/" rel="nofollow">Logica</a> open source project.)</p>
<h3 dir="auto"><a id="user-content-aggregation" aria-hidden="true" href="#aggregation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Aggregation</h3>
<p dir="auto">In practice, querying is rarely enough and we also need grouping and
aggregation.</p>
<div data-snippet-clipboard-copy-content="count_projects_with_vulnerable_log4j(Num) :-
  projects_with_vulnerable_log4j(P) |&gt; do fn:group_by(), let Num = fn:Count()."><pre><code>count_projects_with_vulnerable_log4j(Num) :-
  projects_with_vulnerable_log4j(P) |&gt; do fn:group_by(), let Num = fn:Count().
</code></pre></div>
<h3 dir="auto"><a id="user-content-recursive-queries" aria-hidden="true" href="#recursive-queries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Recursive Queries</h3>
<p dir="auto">The example does not specify what <code>contains_jar</code> does. Here is a possible
implementation for <code>contains_jar</code> that walks a dependency graph.
This shows that Mangle rules can be recursive.</p>
<div data-snippet-clipboard-copy-content="contains_jar(P, Name, Version) :-
  contains_jar_directly(P, Name, Version).

contains_jar(P, Name, Version) :-
  project_depends(P, Q),
  contains_jar(Q, Name, Version)."><pre><code>contains_jar(P, Name, Version) :-
  contains_jar_directly(P, Name, Version).

contains_jar(P, Name, Version) :-
  project_depends(P, Q),
  contains_jar(Q, Name, Version).
</code></pre></div>
<p dir="auto">The two rules correspond to two cases in which a project may &#34;contain&#34; a jar:
either directly, or through some dependency.</p>
<h3 dir="auto"><a id="user-content-knowledge-graphs-property-graphs" aria-hidden="true" href="#knowledge-graphs-property-graphs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Knowledge Graphs, Property Graphs</h3>
<p dir="auto">When engineering requirements, it is useful to model a slice of the real world
through a domain model and controlled vocabulary. Description logics use
roles to describe how concepts interact, but the relationships are always
binary. Mangle can represent binary predicates, but also arbitrary n-ary relations.</p>
<div data-snippet-clipboard-copy-content="one_or_two_leg_flight(Codes, Start, Destination, Price) :-
  direct_flight(Code, Start, Destination, Price)
  |&gt; let Codes = fn:list(Code).

one_or_two_leg_flight(Codes, Start, Destination, Price) :-
  direct_flight(FirstCode, Start, FirstStop, FirstLegPrice).
  direct_flight(SecondCode, FirstStop, Destination, SecondLegPrice)
  |&gt; let Codes = [FirstCode, SecondCode],
     let Price = fn:sum(FirstLegPrice, SecondLegPrice)."><pre><code>one_or_two_leg_flight(Codes, Start, Destination, Price) :-
  direct_flight(Code, Start, Destination, Price)
  |&gt; let Codes = fn:list(Code).

one_or_two_leg_flight(Codes, Start, Destination, Price) :-
  direct_flight(FirstCode, Start, FirstStop, FirstLegPrice).
  direct_flight(SecondCode, FirstStop, Destination, SecondLegPrice)
  |&gt; let Codes = [FirstCode, SecondCode],
     let Price = fn:sum(FirstLegPrice, SecondLegPrice).
</code></pre></div>
<section data-identity="9068d191-39c8-41f3-a15d-73a58de51401" data-host="https://viewscreen.githubusercontent.com" data-src="https://viewscreen.githubusercontent.com/markdown/mermaid" data-type="mermaid" aria-label="mermaid rendered output container">
  <div data-json="{&#34;data&#34;:&#34;graph LR\n    A[Square Rect] -- Link text --&amp;gt; B((Circle))\n    A --&amp;gt; C(Round Rect)\n    B --&amp;gt; D{Rhombus}\n    C --&amp;gt; D\n&#34;}" data-plain="graph LR
    A[Square Rect] -- Link text --&gt; B((Circle))
    A --&gt; C(Round Rect)
    B --&gt; D{Rhombus}
    C --&gt; D
">
    <div>
      <pre lang="mermaid" aria-label="Raw mermaid code">graph LR
    A[Square Rect] -- Link text --&gt; B((Circle))
    A --&gt; C(Round Rect)
    B --&gt; D{Rhombus}
    C --&gt; D
</pre>
    </div>
  </div>
  <span role="presentation">
    <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="16" height="16" viewBox="0 0 16 16" fill="none" data-view-component="true">
  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke"></circle>
  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke"></path>
</svg>
  </span>
</section>


<h2 dir="auto"><a id="user-content-building" aria-hidden="true" href="#building"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building</h2>
<p dir="auto">If you want to build from source develop extensions, you need to set up
ANTLR first, which requires Java runtime environment.</p>
<div data-snippet-clipboard-copy-content="wget http://www.antlr.org/download/antlr-4.11.1-complete.jar
alias antlr=&#39;java -jar $PWD/antlr-4.11.1-complete.jar&#39;"><pre><code>wget http://www.antlr.org/download/antlr-4.11.1-complete.jar
alias antlr=&#39;java -jar $PWD/antlr-4.11.1-complete.jar&#39;
</code></pre></div>
<p dir="auto">Then you can generate the parser sources</p>
<div data-snippet-clipboard-copy-content="antlr -Dlanguage=Go -package gen -o ./ parse/gen/Mangle.g4 -visitor"><pre><code>antlr -Dlanguage=Go -package gen -o ./ parse/gen/Mangle.g4 -visitor
</code></pre></div>
<p dir="auto">... and finally build the library:</p>

<h2 dir="auto"><a id="user-content-contributing" aria-hidden="true" href="#contributing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contributing</h2>
<p dir="auto">This project is used in an internal application. Pull requests will
be handled by merging into internal repository.</p>
</article>
          </div></div>
  </body>
</html>
