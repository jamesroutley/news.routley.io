<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/">Original</a>
    <h1>How to write a QML effect for KWin</h1>
    
    <div id="readability-page-1" class="page"><article id="post-818">
	
	<!-- .entry-header -->

	<div>
		
<p>Since the dawn of the times, the only way to implement any effect that has fancy user interface used to be in C++. It would be rather an understatement to say that the C++ API is difficult to use or get it right so there are no glitches. On the other hand, it would be really nice to be able to implement dashboard-like effects while not compromise on code simplicity and maintainability, especially given the rise of popularity of overview effects a few years ago, which indicated that there is demand for such effects.</p>



<p>In order solve that problem, we started looking for some options and the most obvious one was QtQuick. It‚Äôs a quite powerful framework and it‚Äôs already used extensively in Plasma. So, in Plasma 5.24, we introduced basic support for implementing kwin effects written in QML and even added a new overview effect. Unfortunately, if you wanted to implement a QtQuick-based effect yourself, you would still have to write a bit of C++ glue yourself. This is not great because effects that use C++ are a distribution nightmare. They can‚Äôt be just uploaded to the KDE Store and then installed by clicking ‚ÄúGet New Effects‚Ä¶‚Äù. Furthermore, libkwin is a fast moving target with lots of ABI and API incompatible changes in every release. That‚Äôs not good if you‚Äôre an effect developer because it means you will need to invest a bit of time after every plasma release to port the effects to the new APIs or at least rebuild the effects to resolve ABI incompatibilities.</p>



<p>This has been changed in Plasma 6.0.</p>



<p>In Plasma 6, we‚Äôve had the opportunity to address that pesky problem of requiring some C++ code and also improve the declarative effect API after learning some lessons while working on the overview and other effects. So, enough of history and let‚Äôs jump to the good stuff, shall we? üôÇ</p>



<h2>Project Structure</h2>



<p>Declarative effects require some particular project structure that we need to learn first before writing any code</p>



<pre>‚îî‚îÄ‚îÄ package</pre>



<p>The <code>package</code> directory is a toplevel directory, it should contain two things: a <code>metadata.json</code> file and a <code>contents</code> directory. The <code>metadata.json</code> file contains information about the name of the effect, what API it uses, the author, etc.</p>



<pre>{</pre>



<p>The <code>contents</code> directory contains the rest of QML code, config files, assets, etc. Keep in mind that <code>ui/main.qml</code> is a ‚Äúmagical‚Äù file, it acts as an entry point, every effect must have it.</p>



<p>In order to install the effect and make it visible in Desktop Effects settings, you will need to run the following command</p>



<pre>kpackagetool6 --type KWin/Effect --install package/</pre>



<p>This is quite a lot to memorize. That‚Äôs why kwin provides an example qtquick effect that you can grab, tweak some metadata and you‚Äôre good to go. You can find the example project at <a href="https://invent.kde.org/plasma/kwin/-/tree/master/examples/quick-effect?ref_type=heads">https://invent.kde.org/plasma/kwin/-/tree/master/examples/quick-effect?ref_type=heads</a>. Note that the example project also contains a <code>CMakeLists.txt</code> file, which provides an alternative way to install the effect by the means of cmake, i.e. <code>make install</code> or <code>cmake --install builddir</code>.</p>



<h2>Hello World</h2>



<p>Let‚Äôs start with an effect that simply shows a hello world message on the screen:</p>



<pre><code>import QtQuick</code></pre>



<p><code>import QtQuick</code> is needed to use basic QtQuick components such as <code>Rectangle</code>. <code>import org.kde.kwin</code> imports kwin specific components.</p>



<p>The <code>SceneEffect</code> is a special type that every declarative effect must use. Its <code>delegate</code> property specifies the content for every screen. In this case, it‚Äôs a blue rectangle with a ‚ÄúHello World!‚Äù label in the center.</p>



<p>The <code>ShortcutHandler</code> is a helper that‚Äôs used to register global shortcuts. <code>ShortcutHandler.name</code> is the key of the global shortcut, it‚Äôs going to be used to store the shortcut in the config and other similar purposes. <code>ShortcutHandler.text</code> is a human readable description of the global shortcut, it‚Äôs going to be visible in the Shortcuts settings.</p>



<p>The <code>ScreenEdgeHandler</code> allows to reserve a screen edge. When the pointer hits that screen edge, some code can be executed by listening to the <code>activated</code> signal.</p>



<p>The <code>PinchGestureHandler</code> and <code>SwipeGestureHandler</code> allow to execute some code when the user makes a pinch or a swipe gesture, respectively.</p>



<p><code>effect.visible = !effect.visible</code> toggles the visibility of the effect. When <code>effect.visible</code>  is <code>true</code>, the effect is active and visible on the screen; otherwise it‚Äôs hidden. You need to set <code>effect.visible</code> to <code>true</code> in order to show the effect.</p>



<p>If you press <code>Meta+H</code> or make a pinch gesture or move the pointer to the top screen edge, you‚Äôre going to see something like this</p>



<figure><img fetchpriority="high" decoding="async" width="660" height="495" data-attachment-id="838" data-permalink="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/screenshot_20240317_170123/" data-orig-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?fit=1280%2C960&amp;ssl=1" data-orig-size="1280,960" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot_20240317_170123" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?fit=300%2C225&amp;ssl=1" data-large-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?fit=660%2C495&amp;ssl=1" src="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=660%2C495&amp;ssl=1" alt="" srcset="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=1024%2C768&amp;ssl=1 1024w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=300%2C225&amp;ssl=1 300w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=768%2C576&amp;ssl=1 768w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=1200%2C900&amp;ssl=1 1200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=800%2C600&amp;ssl=1 800w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=600%2C450&amp;ssl=1 600w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=400%2C300&amp;ssl=1 400w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=200%2C150&amp;ssl=1 200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?resize=363%2C272&amp;ssl=1 363w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_170123.png?w=1280&amp;ssl=1 1280w" sizes="(max-width: 660px) 100vw, 660px" data-recalc-dims="1"/></figure>







<p>Note that there are no windows visible anymore, it is the responsibility of the effect to decide what should be displayed on the screen now.</p>



<h2>Displaying Windows</h2>



<p>Being able to display text is great, but it‚Äôs not useful. Usually, effects need to display some windows, so let‚Äôs display the active window</p>



<pre><code>    delegate: Rectangle {</code></pre>



<p>The change is quite simple. Instead of displaying a <code>Text</code> component, there‚Äôs a <code>WindowThumbnail</code> component now. The <code>WindowThumbnail</code> type is provided by the <code>org.kde.kwin</code> module. <code>WindowThumbnail.client</code> indicates what window the thumbnail item should display.</p>



<figure><img decoding="async" width="660" height="495" data-attachment-id="842" data-permalink="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/screenshot_20240317_172450/" data-orig-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?fit=1280%2C960&amp;ssl=1" data-orig-size="1280,960" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot_20240317_172450" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?fit=300%2C225&amp;ssl=1" data-large-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?fit=660%2C495&amp;ssl=1" src="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=660%2C495&amp;ssl=1" alt="" srcset="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=1024%2C768&amp;ssl=1 1024w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=300%2C225&amp;ssl=1 300w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=768%2C576&amp;ssl=1 768w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=1200%2C900&amp;ssl=1 1200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=800%2C600&amp;ssl=1 800w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=600%2C450&amp;ssl=1 600w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=400%2C300&amp;ssl=1 400w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=200%2C150&amp;ssl=1 200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?resize=363%2C272&amp;ssl=1 363w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_172450.png?w=1280&amp;ssl=1 1280w" sizes="(max-width: 660px) 100vw, 660px" data-recalc-dims="1"/></figure>







<h2>Input</h2>



<p>Input processing contains no kwin specific APIs. <code>TapHandler</code>, <code>MouseArea</code>, <code>Keys</code> and other stuff available in QtQuick should just work. For example, let‚Äôs implement an effect that arranges windows in a grid and if somebody middle clicks a window, it will be closed</p>



<pre><code>    delegate: Rectangle {</code></pre>



<p>The code looks pretty straightforward except maybe the model of the <code>GridView</code>. <code>WindowModel</code> is a helper provided by <code>org.kde.kwin</code> module that lists all the windows. It can be passed to various views, <code>Repeater</code>, and so on.</p>



<p>The result can be seen here</p>



<figure><p><span><iframe width="660" height="372" src="https://www.youtube.com/embed/lrAmDSjzhQ4?version=3&amp;rel=1&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;fs=1&amp;hl=en-US&amp;autohide=2&amp;wmode=transparent" allowfullscreen="true" sandbox="allow-scripts allow-same-origin allow-popups allow-presentation allow-popups-to-escape-sandbox"></iframe></span>
</p></figure>







<h2>Delegates are Per Screen</h2>



<p>One thing to keep in mind is that the delegates are instantiated per screen. For example, </p>



<pre><code>    delegate: Rectangle {</code></pre>



<p>When you activate the effect on a setup with several outputs, each output will be filled with yellow color and the output name in the center</p>



<figure><img loading="lazy" decoding="async" width="660" height="263" data-attachment-id="854" data-permalink="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/screenshot_20240317_181544/" data-orig-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?fit=2643%2C1053&amp;ssl=1" data-orig-size="2643,1053" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot_20240317_181544" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?fit=300%2C120&amp;ssl=1" data-large-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?fit=660%2C263&amp;ssl=1" src="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=660%2C263&amp;ssl=1" alt="" srcset="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=1024%2C408&amp;ssl=1 1024w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=300%2C120&amp;ssl=1 300w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=768%2C306&amp;ssl=1 768w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=1536%2C612&amp;ssl=1 1536w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=2048%2C816&amp;ssl=1 2048w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=1200%2C478&amp;ssl=1 1200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?resize=683%2C272&amp;ssl=1 683w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?w=1320&amp;ssl=1 1320w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_181544.png?w=1980&amp;ssl=1 1980w" sizes="(max-width: 660px) 100vw, 660px" data-recalc-dims="1"/></figure>







<p>Usually, the output is irrelevant, but if you need to know what output particular delegate is displayed on, you could use the <code>SceneView.screen</code> attached property.</p>



<h2>Configuration</h2>



<p>As your effect grows, you will probably face the need to provide an option or two. Let‚Äôs say that we want the background color in our hello world effect to be configurable. How do we achieve that? The first step, is to add a <code>main.xml</code> file in <code>package/contents/config</code> directory, i.e.</p>



<pre>package/</pre>



<p>The <code>main.xml</code> file lists all options</p>



<pre>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</pre>



<p>In our case, only one option is needed: <code>BackgroundColor</code>, which has <code>Color</code> type and <code>#ff00ff</code> default value. You can refer to the <a href="https://develop.kde.org/docs/features/configuration/kconfig_xt/">KConfigXT</a> documentation to learn more what other entry types are supported.</p>



<p>The next step is to actually use the <code>BackgroundColor</code> option</p>



<pre><code>    delegate: Rectangle {</code></pre>



<p><code>effect.configuration</code> is a map object that contains all the options listed in the <code>main.xml</code>.</p>



<p>Now, if you toggle the hello world effect, you‚Äôre going to see</p>



<figure><img loading="lazy" decoding="async" width="660" height="495" data-attachment-id="890" data-permalink="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/screenshot_20240318_000709/" data-orig-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?fit=1280%2C960&amp;ssl=1" data-orig-size="1280,960" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot_20240318_000709" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?fit=300%2C225&amp;ssl=1" data-large-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?fit=660%2C495&amp;ssl=1" src="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=660%2C495&amp;ssl=1" alt="" srcset="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=1024%2C768&amp;ssl=1 1024w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=300%2C225&amp;ssl=1 300w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=768%2C576&amp;ssl=1 768w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=1200%2C900&amp;ssl=1 1200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=800%2C600&amp;ssl=1 800w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=600%2C450&amp;ssl=1 600w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=400%2C300&amp;ssl=1 400w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=200%2C150&amp;ssl=1 200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?resize=363%2C272&amp;ssl=1 363w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_000709.png?w=1280&amp;ssl=1 1280w" sizes="(max-width: 660px) 100vw, 660px" data-recalc-dims="1"/></figure>







<p>There are a few more thing left to do though. If you navigate to Desktop Effects settings, you‚Äôre not going a configure button next to the hello world effect</p>



<figure><img loading="lazy" decoding="async" width="660" height="97" data-attachment-id="892" data-permalink="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/screenshot_20240318_001125/" data-orig-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_001125.png?fit=884%2C130&amp;ssl=1" data-orig-size="884,130" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot_20240318_001125" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_001125.png?fit=300%2C44&amp;ssl=1" data-large-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_001125.png?fit=660%2C97&amp;ssl=1" src="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_001125.png?resize=660%2C97&amp;ssl=1" alt="" srcset="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_001125.png?w=884&amp;ssl=1 884w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_001125.png?resize=300%2C44&amp;ssl=1 300w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_001125.png?resize=768%2C113&amp;ssl=1 768w" sizes="(max-width: 660px) 100vw, 660px" data-recalc-dims="1"/></figure>







<p>Besides providing a <code>main.xml</code> file, the effect also needs to provide a <code>config.ui</code> file containing a configuration ui</p>



<pre>package/</pre>



<p>The <code>config.ui</code> file is a regular Qt Designer UI file. The only special thing about it is that the controls that represent options should have special name format: <code>kcfg_</code> + <code>OptionName</code>. For example, <code>kcfg_BackgroundColor</code></p>



<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</code></pre>



<p>The last final piece in order to expose the configuration ui is to add the following line in the <code>metadata.json</code> file</p>



<pre>&#34;X-KDE-ConfigModule&#34;: &#34;kcm_kwin4_genericscripted&#34;</pre>



<p>With all of that, the effect is finally displayed as configurable in the system settings and the background color can be changed</p>



<figure><img loading="lazy" decoding="async" width="660" height="252" data-attachment-id="897" data-permalink="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/screenshot_20240318_002244/" data-orig-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?fit=1005%2C384&amp;ssl=1" data-orig-size="1005,384" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot_20240318_002244" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?fit=300%2C115&amp;ssl=1" data-large-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?fit=660%2C252&amp;ssl=1" src="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?resize=660%2C252&amp;ssl=1" alt="" srcset="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?w=1005&amp;ssl=1 1005w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?resize=300%2C115&amp;ssl=1 300w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?resize=768%2C293&amp;ssl=1 768w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240318_002244.png?resize=712%2C272&amp;ssl=1 712w" sizes="(max-width: 660px) 100vw, 660px" data-recalc-dims="1"/></figure>



<h2>Sharing Your Effect With Other People</h2>



<p>The preferred method to distribute third party extensions is via the <a href="https://store.kde.org/browse/">KDE Store</a>. Both JS and QML effects can be uploaded to the same ‚Äú<a href="https://store.kde.org/browse?cat=719">KWin Effects</a>‚Äù category.</p>



<h2>Documentation and Other Useful Resources</h2>



<p>Documentation is still something that needs a lot of work (and writing it is no fun üôÅ ). KWin scripting API documentation can be found here <a href="https://develop.kde.org/docs/plasma/kwin/api/">https://develop.kde.org/docs/plasma/kwin/api/</a>.</p>



<p>Besides the link above, it‚Äôs worth having a look at the examples <a href="https://invent.kde.org/plasma/kwin/-/tree/master/examples?ref_type=heads">https://invent.kde.org/plasma/kwin/-/tree/master/examples?ref_type=heads</a> in kwin git repository.</p>



<h2>Window Heap</h2>



<p>If you need to pack or arrange windows like how the overview effect does, you could use the <code>WindowHeap</code> component from <code>org.kde.kwin.private.effects</code> module. BUT you need to keep in mind that that helper is private and has no stable API yet, so use it on your own risk (or copy paste the relevant code in kwin). Eventually, the <code>WindowHeap</code> will be stabilized once we are confident about its API.</p>



<p>The <code>WindowHeap</code> source code can be found at <a href="https://invent.kde.org/plasma/kwin/-/tree/2a13a330404c8d8a95f6264512aa06b0a560f55b/src/plugins/private">https://invent.kde.org/plasma/kwin/-/tree/2a13a330404c8d8a95f6264512aa06b0a560f55b/src/plugins/private</a>.</p>



<h2>More Examples</h2>



<p>If you need more examples, I suggest to have a look at the desktop cube effect in <code>kdeplasma-addons</code>. It‚Äôs implemented using the same QML effect API in kwin + QtQuick3D. The source code can be found at <a href="https://invent.kde.org/plasma/kdeplasma-addons/-/tree/master/kwin/effects/cube?ref_type=heads">https://invent.kde.org/plasma/kdeplasma-addons/-/tree/master/kwin/effects/cube?ref_type=heads</a></p>



<figure><img loading="lazy" decoding="async" width="660" height="371" data-attachment-id="858" data-permalink="https://blog.vladzahorodnii.com/2024/03/18/how-to-write-a-qml-effect-for-kwin/screenshot_20240317_182738/" data-orig-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?fit=3840%2C2160&amp;ssl=1" data-orig-size="3840,2160" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Screenshot_20240317_182738" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?fit=300%2C169&amp;ssl=1" data-large-file="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?fit=660%2C371&amp;ssl=1" src="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=660%2C371&amp;ssl=1" alt="" srcset="https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=1024%2C576&amp;ssl=1 1024w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=300%2C169&amp;ssl=1 300w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=768%2C432&amp;ssl=1 768w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=1536%2C864&amp;ssl=1 1536w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=2048%2C1152&amp;ssl=1 2048w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=1200%2C675&amp;ssl=1 1200w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?resize=484%2C272&amp;ssl=1 484w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?w=1320&amp;ssl=1 1320w, https://i0.wp.com/blog.vladzahorodnii.com/wp-content/uploads/2024/03/Screenshot_20240317_182738.png?w=1980&amp;ssl=1 1980w" sizes="(max-width: 660px) 100vw, 660px" data-recalc-dims="1"/></figure>



<h2>Conclusion</h2>



<p>I hope that some people find this quick introduction to QML-based effects in KWin useful. Despite being a couple years old, declarative effects can be still considered being in the infancy stage and there‚Äôs a lot of untapped potential in them yet. The QML effect API is not perfect, and that‚Äôs why we are interested in feedback from third party extension developers. If you have some questions or feedback, feel free to reach out us at <a href="https://webchat.kde.org/#/room/#kwin:kde.org">https://webchat.kde.org/#/room/#kwin:kde.org</a>. Happy hacking!</p>

	</div><!-- .entry-content -->

	
	<!-- .entry-footer -->

</article></div>
  </body>
</html>
