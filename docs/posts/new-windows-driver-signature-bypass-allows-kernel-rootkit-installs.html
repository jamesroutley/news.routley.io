<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.bleepingcomputer.com/news/security/new-windows-driver-signature-bypass-allows-kernel-rootkit-installs/">Original</a>
    <h1>New Windows driver signature bypass allows kernel rootkit installs</h1>
    
    <div id="readability-page-1" class="page"><div>
	   
<p><img alt="New Windows Driver Signature bypass allows kernel rootkit installs" height="900" src="https://www.bleepstatic.com/content/hl-images/2024/10/02/Windows_11_headpic.jpg" width="1600"/></p>

<p>Attackers can downgrade Windows kernel components to bypass security features such as Driver Signature Enforcement and deploy rootkits on fully patched systems.</p>

<p>This is possible by taking control of the Windows Update process to introduce outdated, vulnerable software components on an up-to-date machine without the operating system changing the fully patched status.</p>

<h3>Downgrading Windows</h3>

<p>SafeBreach security researcher Alon Leviev reported the update takeover issue but Microsoft dismissed it saying that it did not cross a defined security boundary, although was possible by gaining kernel code execution as an administrator.</p>

<p>Leviev at the <a href="https://www.blackhat.com/us-24/briefings/schedule/#windows-downdate-downgrade-attacks-using-windows-updates-38963" target="_blank" rel="nofollow noopener">BlackHat</a> and <a href="https://defcon.org/html/defcon-32/dc-32-speakers.html#54522" target="_blank" rel="nofollow noopener">DEFCON</a> security conferences this year demonstrated that the attack was feasible but the problem is not completely fixed, leaving open the door for downgrade/version-rollback attacks.</p>

<p>The researcher published a tool called <a href="https://www.bleepingcomputer.com/news/microsoft/windows-downdate-tool-lets-you-unpatch-windows-systems/" target="_blank">Windows Downdate</a>, which allows creating custom downgrades and expose a seemingly fully update target system to already fixed vulnerabilities via outdated components, such as DLLs, drivers, and the NT kernel.</p>

<p>&#34;I was able to make a fully patched Windows machine susceptible to past vulnerabilities, turning fixed vulnerabilities unfixed and making the term “fully patched” meaningless on any Windows machine in the world&#34; - <a href="https://www.safebreach.com/blog/update-on-windows-downdate-downgrade-attacks/" target="_blank" rel="nofollow noopener">Alon Leviev</a></p>

<p>Despite kernel security improving significantly over the years, Leviev managed to bypass the Driver Signature Enforcement (DSE) feature, showing how an attacker could load unsigned kernel drivers to deploy rootkit malware that disables security controls and hides activity that could lead to detecting the compromise.</p>

<p>“In recent years, significant enhancements have been implemented to strengthen the security of the kernel, even under the assumption that it could be compromised with Administrator privileges,” Leviev says. </p>

<p>While the new protections make it more difficult to compromise the kernel, &#34;the ability to downgrade components that reside in the kernel makes things much simpler for attackers,&#34; the researcher explains.</p>

<p>Leviev calls his method <em>&#34;ItsNotASecurityBoundary&#34; DSE bypass</em> because it is a downgrade of the <strong>ItsNotASecurityBoundary</strong> exploit that leverages <strong>false file immutablity flaws</strong>, a new vulnerability class in Windows identified by <a href="http://www.elastic.co/security-labs/false-file-immutability" target="_blank" rel="nofollow noopener">Gabriel Landau</a> of Elastic as a way to achieve arbitrary code execution with kernel privileges.</p>

<h3>Targeting the kernel</h3>

<p>In new research published today, Leviev shows how an attacker with administrator privileges on a target machine could exploit the Windows Update process to bypass DSE protections by downgrading a patched component, even on fully updated Windows 11 systems.</p>

<p>The attack is possible by replacing ‘ci.dll,’ a file responsible for enforcing DSE, with an unpatched version that ignores driver signatures, which essentially sidesteps Windows’ protective checks.</p>

<div>
<figure><img alt="Loading the old DLL while Windows verifies the latest version" height="129" src="https://www.bleepstatic.com/images/news/u/1220909/2024/Campaigns/29/dll.png" width="796"/><figcaption><strong>Loading the old DLL while Windows verifies the latest version</strong></figcaption></figure></div>

<p>Once the component is downgraded to a vulnerable version, the machine needs to restart, just like during a legitimate update process.</p>

<p>In the video below, the researcher demonstrates how he reverted the DSE patch via a downgrade attack and then exploited the component on a fully patched Windows 11 23H2 machine.</p>

<p><iframe allowfullscreen="" frameborder="0" height="360" mozallowfullscreen="" src="https://player.vimeo.com/video/1023363712" webkitallowfullscreen="" width="640"></iframe></p>

<p>Leviev also describes methods to disable or bypass Microsoft&#39;s Virtualization-based Security (VBS) that creates an isolated environment for Windows to protect essential resources and securtiy assets like the secure kernel code integrity mechanism (<em>skci.dll</em>) and authenticated user credentials.</p>

<p>VBS typically relies on protections like UEFI locks and registry configurations to prevent unauthorized changes, but it can be disabled if not configured with max security (<a href="https://learn.microsoft.com/en-us/windows/security/hardware-security/enable-virtualization-based-protection-of-code-integrity" target="_blank" rel="nofollow noopener">“Mandatory” flag</a>) by performing targeted registry key modification.</p>

<p>When partially enabled, key VBS files such as ‘SecureKernel.exe’ can be replaced with corrupt versions that disrupt VBS’s operation and open the way for “ItsNotASecurityBoundary” bypass and to replace &#39;ci.dll&#39;.</p>

<div>
<figure><img alt="Ignoring the VBS configuration during boot" height="131" src="https://www.bleepstatic.com/images/news/u/1220909/2024/Campaigns/29/vbs.png" width="774"/><figcaption><strong>Ignoring the VBS configuration during boot</strong></figcaption></figure></div>

<p>Leviev’s work shows that downgrade attacks are still possible via several pathways, even if they sometimes carry strong privilege prerequisites.</p>

<h3>A fix is brewing</h3>

<p>While the vulnerabilities exploited for the downgrade attack presented at BlackHat and DEFCON (i.e. <a href="https://www.bleepingcomputer.com/news/microsoft/microsoft-august-2024-patch-tuesday-fixes-9-zero-days-6-exploited/" target="_blank">CVE-2024-21302 and CVE-2024-38202</a>), Microsoft still has to address the Windows Update takeover issue.</p>

<p>&#34;[...] the Windows Update takeover which was reported to Microsoft as well, has remained unpatched, as it did not cross a defined security boundary. Gaining kernel code execution as an Administrator is not considered as crossing a security boundary (not a vulnerability),&#34; <a href="https://www.safebreach.com/blog/update-on-windows-downdate-downgrade-attacks/" target="_blank" rel="nofollow noopener">Leviev notes</a>.</p>

<p>Until Microsoft corrects the problem, the researcher highlights that security solutions should monitor for and detect downgrade attacks since they continue to pose a significant risk to organizations.</p>

<p>In a statement for BleepingComputer, a Microsoft spokesperson says that the company is &#34;actively developing mitigations to protect against these risks.&#34;</p>

<p>However, the process involves &#34;a thorough investigation, update development across all affected versions, and compatibility testing&#34; to make sure that customers are protected and operational disruption is minimized.</p>

<p>The company is developing a security update that mitigates the issue by revoking outdated, unpatched VBS system files. It is unclear when the update will become available since the problem is complex and requires comprehensive testing to avoid integration failures or regressions.</p>

<p><strong>UPDATE [October 27th]</strong>: <em>Article edited to remove potential confusion about Microsoft not taking steps to mitigate the issue by adding information from the company, and to clarify that the attack requires administrator privileges.</em></p>

	   
           
          
 
	  </div></div>
  </body>
</html>
