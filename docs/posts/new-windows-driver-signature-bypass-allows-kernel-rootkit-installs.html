<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.bleepingcomputer.com/news/security/new-windows-driver-signature-bypass-allows-kernel-rootkit-installs/">Original</a>
    <h1>New Windows driver signature bypass allows kernel rootkit installs</h1>
    
    <div id="readability-page-1" class="page"><div>
	   
<p><img alt="New Windows Driver Signature bypass allows kernel rootkit installs" height="900" src="https://www.bleepstatic.com/content/hl-images/2024/10/02/Windows_11_headpic.jpg" width="1600"/></p>

<p>Attackers can downgrade Windows kernel components to bypass security features such as Driver Signature Enforcement and deploy rootkits on fully patched systems.</p>

<p>This is possible by taking control of the Windows Update process to introduce outdated, vulnerable software components on an up-to-date machine without the operating system changing the fully patched status.</p>

<h3>Downgrading Windows</h3>

<p>SafeBreach security researcher Alon Leviev reported the update takeover issue but Microsoft dismissed it saying that it did not cross a defined security boundary, although was possible by gaining kernel code execution as an administrator.</p>

<p>Leviev at the <a href="https://www.blackhat.com/us-24/briefings/schedule/#windows-downdate-downgrade-attacks-using-windows-updates-38963" target="_blank" rel="nofollow noopener">BlackHat</a> and <a href="https://defcon.org/html/defcon-32/dc-32-speakers.html#54522" target="_blank" rel="nofollow noopener">DEFCON</a> security conferences this year demonstrated that the attack was feasible but the problem remains unfixed, leaving open the door for downgrade/version-rollback attacks.</p>

<p>The researcher published a tool called <a href="https://www.bleepingcomputer.com/news/microsoft/windows-downdate-tool-lets-you-unpatch-windows-systems/" target="_blank">Windows Downdate</a>, which allows creating custom downgrades and expose a seemingly fully update target system to already fixed vulnerabilities via outdated components, such as DLLs, drivers, and the NT kernel.</p>

<p>&#34;I was able to make a fully patched Windows machine susceptible to past vulnerabilities, turning fixed vulnerabilities unfixed and making the term “fully patched” meaningless on any Windows machine in the world&#34; - <a href="https://www.safebreach.com/blog/update-on-windows-downdate-downgrade-attacks/" target="_blank" rel="nofollow noopener">Alon Leviev</a></p>

<p>Despite kernel security improving significantly over the years, Leviev managed to bypass the Driver Signature Enforcement (DSE) feature, showing how an attacker could load unsigned kernel drivers to deploy rootkit malware that disables security controls and hides activity that could lead to detecting the compromise.</p>

<p>“In recent years, significant enhancements have been implemented to strengthen the security of the kernel, even under the assumption that it could be compromised with Administrator privileges,” Leviev says. </p>

<p>While the new protections make it more difficult to compromise the kernel, &#34;the ability to downgrade components that reside in the kernel makes things much simpler for attackers,&#34; the researcher explains.</p>

<p>Leviev named his exploitation method <em>&#34;ItsNotASecurityBoundary&#34; DSE bypass</em> as it is part of the <strong>false file immutablity flaws</strong>, a new vulnerability class in Windows described in <a href="http://www.elastic.co/security-labs/false-file-immutability" target="_blank" rel="nofollow noopener">research from Gabriel Landau</a> of Elastic as a way to achieve arbitrary code execution with kernel privileges.</p>

<p>Following Landau&#39;s report, Microsoft patched the ItsNotASecurityBoundary admin-to-kernel privilege escalation. However, this does protect against a downgrade attack.</p>

<h3>Targeting the kernel</h3>

<p>In new research published today, Leviev shows how an attacker could exploit the Windows Update process to bypass DSE protections by downgrading a patched component, even on fully updated Windows 11 systems.</p>

<p>The attack is possible by replacing ‘ci.dll,’ a file responsible for enforcing DSE, with an unpatched version that ignores driver signatures, which essentially sidesteps Windows’ protective checks.</p>

<p>This replacement is triggered by the Windows Update, exploiting a double-read condition where the vulnerable ci.dll copy is loaded into memory right after Windows starts checking the latest copy of ci.dll.</p>

<div>
<figure><img alt="Loading the old DLL while Windows verifies the latest version" height="129" src="https://www.bleepstatic.com/images/news/u/1220909/2024/Campaigns/29/dll.png" width="796"/><figcaption><strong>Loading the old DLL while Windows verifies the latest version</strong></figcaption></figure></div>

<p>This “race window” allows the vulnerable ci.dll to load while Windows thinks it has verified the file, hence allowing unsigned drivers to be loaded onto the kernel.</p>

<p>In the video below, the researcher demonstrates how he reverted the DSE patch via a downgrade attack and then exploited the component on a fully patched Windows 11 23H2 machine.</p>

<p><iframe allowfullscreen="" frameborder="0" height="360" mozallowfullscreen="" src="https://player.vimeo.com/video/1023363712" webkitallowfullscreen="" width="640"></iframe></p>

<p>Leviev also describes methods to disable or bypass Microsoft&#39;s Virtualization-based Security (VBS) that creates an isolated environment for Windows to protect essential resources and securtiy assets like the secure kernel code integrity mechanism (<em>skci.dll</em>) and authenticated user credentials.</p>

<p>VBS typically relies on protections like UEFI locks and registry configurations to prevent unauthorized changes, but it can be disabled if not configured with max security (“Mandatory” flag) by performing targeted registry key modification.</p>

<p>When partially enabled, key VBS files such as ‘SecureKernel.exe’ can be replaced with corrupt versions that disrupt VBS’s operation and open the way for “ItsNotASecurityBoundary” bypass and to replace &#39;ci.dll&#39;.</p>

<div>
<figure><img alt="Ignoring the VBS configuration during boot" height="131" src="https://www.bleepstatic.com/images/news/u/1220909/2024/Campaigns/29/vbs.png" width="774"/><figcaption><strong>Ignoring the VBS configuration during boot</strong></figcaption></figure></div>

<p>Leviev’s work shows that downgrade attacks are still possible via several pathways, even if they sometimes carry strong privilege prerequisites.</p>

<p>The researcher highlights the need for endpoint security tools to closely monitor downgrade procedures, even those that do not cross critical security boundaries.</p>

	   
           
          
 
	  </div></div>
  </body>
</html>
