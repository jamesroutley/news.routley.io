<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.thapaliya.com/en/writings/hello-with-a-glider-gun-mojo/">Original</a>
    <h1>game_of_life.ðŸ”¥ - a late night Mojo hack</h1>
    
    <div id="readability-page-1" class="page"><div><div><h2>Let&#39;s start from yesterday</h2><p>I&#39;m not a huge fan of really long form podcasts, the main issue really being the signal to chatter ratio and the freely available time I have. Having said that, yesterday I was sent a link to a podcast episode where <a href="https://www.youtube.com/watch?v=pdJQ8iVTwj8">Chris Lattner was talking for hours about Mojo</a>. I had several hours of train ride planned during the day, so I figured that it would be perfect to listen to the conversation. It took a while to get through even at 1.9x.</p><p>Perhaps it was too much coffee or the thoughts in my head, but I sat down after 11pm and tried to write some Mojo. Around 2am in the morning I had a very hacky version of Conway&#39;s Game of Life working. It&#39;s the kind of code I&#39;ll mostly likely throw away, but I figured I&#39;d include it on the internet as a historical object of embarrassment for my future self.</p><h2>Mojo ðŸ”¥ ?</h2><p>Mojo is a new programming language primarily targeted <a href="https://www.modular.com/mojo">&#39;for all AI developers&#39;</a>. If reading in the future, please take note that this is AI as it was understood in 2023 and not as in 1956, in the latter case the reader is requested to go look up Lisp.</p><p>Now that we&#39;ve put the AI aside, Mojo aims to combine the ease of Python syntax (plus ecosystem) with the performance of systems programming languages such as Rust, while providing compile time metaprogramming capabilities. It is early days for Mojo and I&#39;d urge the reader to visit the <a href="https://docs.modular.com/mojo/">language manual</a> to learn more about it.</p><p>I recently also had the opportunity to explore the basics of Mojo with a fun group. I&#39;ve included the slides and recording of the session below.</p><p>As I&#39;ve repeatedly mentioned in the video below, I&#39;m very much a beginner when it comes to this, a bunch of my claims might be complete garbage, and a lot of my analogies might break as soon as you poke them. Handle with care !</p><iframe src="https://www.youtube.com/embed/pduYnTpRBLo" title="An Introduction to Mojo (Suvash Thapaliya)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe><h2>Game of Life</h2><p>Back to the late night hacks, I&#39;d recently played around with <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway&#39;s Game of Life</a> and figured that this would be a pretty good small challenge to attempt in Mojo. With additional time, I could even try to render the game grid using Matplotlib and hence test the Python ecosystem interop.</p><p>The plan was set to implement <a href="https://en.wikipedia.org/wiki/Gun_(cellular_automaton)">a Gilder gun</a> and watch it evolve. Something like this! (NOTE: the following is not the final result.)</p><figure><img src="https://web.archive.org/assets/images/writings/game-of-life-glider-gun.gif" alt="Game of Life - Glider gun"/><figcaption>Game of Life - Glider gun</figcaption></figure><h2>game_of_life.ðŸ”¥</h2><p>After referring to the various notebooks included in Modular playgroud, I was able to come up with some code that setup the Glider gun and started emitting gliders. This is pretty much my first throwaway Mojo code, I&#39;ve basically copied over things from various notebooks &#34;until it worked&#34;, so I will not bother walking through it. The reader is urged to not use any of this code. I&#39;m only including it here for my own historical reference.</p><h3>A Boolean Matrix (Batrix) from scratch*</h3><pre><code>from IO import print_no_newline

from DType import DType
from Pointer import DTypePointer

struct Batrix:
    var data: DTypePointer[DType.bool]
    var rows: Int
    var cols: Int

    fn __init__(inout self, rows: Int, cols: Int, val: Bool):
        self.rows = rows
        self.cols = cols
        self.data = DTypePointer[DType.bool].alloc(rows * cols)
        for r in range(self.rows):
            for c in range(self.cols):
                self[r, c] = False

    @always_inline
    fn __getitem__(self, row: Int, col: Int) -&gt; SIMD[DType.bool, 1]:
        return self.load[1](row, col)

    @always_inline
    fn load[nelts:Int](self, row: Int, col: Int) -&gt; SIMD[DType.bool, nelts]:
        return self.data.simd_load[nelts](row * self.cols + col)

    @always_inline
    fn __setitem__(self, row: Int, col: Int, val: SIMD[DType.bool, 1]):
        return self.store[1](row, col, val)

    @always_inline
    fn store[nelts:Int](self, row: Int, col: Int, val: SIMD[DType.bool, nelts]):
        self.data.simd_store[nelts](row * self.cols + col, val)

    # to_numpy below returns PythonObject
    # which requires self to be copyable
    fn __copyinit__(inout self, other: Self):
        self.data = other.data
        self.rows = other.rows
        self.cols = other.cols

    def to_numpy(self) -&gt; PythonObject:
        let np = Python.import_module(&#34;numpy&#34;)
        let numpy_array = np.zeros((self.rows, self.cols), np.bool)
        for col in range(self.cols):
            for row in range(self.rows):
                numpy_array.itemset((row, col), self[row, col])
        return numpy_array

    fn dump(self):
        for x in range(self.rows):
            for y in range(self.cols):
                if self[x,y] == True:
                    print_no_newline(&#34;â–ˆ&#34;)
                else:
                    print_no_newline(&#34;-&#34;)
            print(&#34;&#34;)

</code></pre><h3>The GameOfLife board</h3><pre><code>struct Game:
    var board: Batrix
    var rows: Int
    var cols: Int
    
    fn __init__(inout self, rows: Int, cols: Int):
        self.rows = rows
        self.cols = cols
        self.board = Batrix(rows, cols, False)

        
    fn neighbour_count(self, row: Int, col: Int) -&gt; Int:
        var count = 0
        for rOff in range(-1, 2):
            for cOff in range(-1, 2):
                if not ((rOff == 0) and (cOff == 0)):
                    if (self.board[row + rOff, col + cOff] == True):
                        count += 1
        return count
    
    fn replace_board(inout self, owned _board: Batrix):
        self.board = _board
    
    fn step(inout self):
        let next_board = Batrix(self.rows, self.cols, False)
        for row in range(self.rows):
            for col in range(self.cols):
                if self.board[row, col] == True:
                    if (self.neighbour_count(row, col) == 2) or (self.neighbour_count(row, col) == 3):
                        next_board[row, col] = True
                else:
                    if self.neighbour_count(row, col) == 3:
                        next_board[row, col] = True
        self.replace_board(next_board)

    fn evolve(inout self, steps: Int):
        for _ in range(steps):
            self.step()
        
    fn dump(self):
        self.board.dump()
        
</code></pre><h3>The initial setup for the Gosper Glider Gun</h3><pre><code>g = Game(40, 80)

# Setup a Glider gun
# https://en.wikipedia.org/wiki/Gun_(cellular_automaton)

g.board[5, 1] = True
g.board[5, 2] = True

g.board[6, 1] = True
g.board[6, 2] = True

g.board[5, 11] = True
g.board[6, 11] = True
g.board[7, 11] = True

g.board[4, 12] = True
g.board[8, 12] = True

g.board[3, 13] = True
g.board[9, 13] = True

g.board[3, 14] = True
g.board[9, 14] = True

g.board[6, 15] = True

g.board[4, 16] = True
g.board[8, 16] = True

g.board[5, 17] = True
g.board[6, 17] = True
g.board[7, 17] = True

g.board[6, 18] = True

g.board[3, 21] = True
g.board[4, 21] = True
g.board[5, 21] = True

g.board[3, 22] = True
g.board[4, 22] = True
g.board[5, 22] = True

g.board[2, 23] = True
g.board[6, 23] = True

g.board[1, 25] = True
g.board[2, 25] = True
g.board[6, 25] = True
g.board[7, 25] = True

g.board[3, 35] = True
g.board[4, 35] = True

g.board[3, 36] = True
g.board[4, 36] = True


g.evolve(150)
g.dump()

</code></pre><h3>Game board initilization output</h3><p>After the setup above, the following is the result of printing the game board. The Glider gun is ready to shoot gliders.</p><pre><code>--------------------------------------------------------------------------------
-------------------------â–ˆ------------------------------------------------------
-----------------------â–ˆ-â–ˆ------------------------------------------------------
-------------â–ˆâ–ˆ------â–ˆâ–ˆ------------â–ˆâ–ˆ-------------------------------------------
------------â–ˆ---â–ˆ----â–ˆâ–ˆ------------â–ˆâ–ˆ-------------------------------------------
-â–ˆâ–ˆ--------â–ˆ-----â–ˆ---â–ˆâ–ˆ---------------------------------------------------------
-â–ˆâ–ˆ--------â–ˆ---â–ˆ-â–ˆâ–ˆ----â–ˆ-â–ˆ------------------------------------------------------
-----------â–ˆ-----â–ˆ-------â–ˆ------------------------------------------------------
------------â–ˆ---â–ˆ---------------------------------------------------------------
-------------â–ˆâ–ˆ-----------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
</code></pre><h3>Evolve the board</h3><p>After evolving the board through 150 generations</p><pre><code>g.evolve(150)
g.dump()
</code></pre><p>the glider generators seem to be working well</p><pre><code>-------------------------------------â–ˆâ–ˆâ–ˆ----------------------------------------
-------------------------â–ˆ---------â–ˆ---â–ˆ----------------------------------------
-----------------------â–ˆ-â–ˆ--------â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ-----------------------------------------
-------------â–ˆâ–ˆ------â–ˆâ–ˆ----------â–ˆ----â–ˆ-----------------------------------------
------------â–ˆ---â–ˆ----â–ˆâ–ˆ-----------â–ˆâ–ˆâ–ˆ-------------------------------------------
-â–ˆâ–ˆ--------â–ˆ-----â–ˆ---â–ˆâ–ˆ------------â–ˆ--------------------------------------------
-â–ˆâ–ˆ--------â–ˆ---â–ˆ-â–ˆâ–ˆ----â–ˆ-â–ˆ------------------------------------------------------
-----------â–ˆ-----â–ˆ-------â–ˆ------------------------------------------------------
------------â–ˆ---â–ˆ---------------------------------------------------------------
-------------â–ˆâ–ˆ-----------------------------------------------------------------
------------------------â–ˆ-------------------------------------------------------
-------------------------â–ˆâ–ˆ-----------------------------------------------------
------------------------â–ˆâ–ˆ------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
-------------------------------â–ˆ-â–ˆ----------------------------------------------
--------------------------------â–ˆâ–ˆ----------------------------------------------
--------------------------------â–ˆ-----------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
---------------------------------------â–ˆ----------------------------------------
----------------------------------------â–ˆâ–ˆ--------------------------------------
---------------------------------------â–ˆâ–ˆ---------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
----------------------------------------------â–ˆ-â–ˆ-------------------------------
-----------------------------------------------â–ˆâ–ˆ-------------------------------
-----------------------------------------------â–ˆ--------------------------------
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
------------------------------------------------------â–ˆ-------------------------
-----------------------------------------------------â–ˆ-â–ˆ------------------------
</code></pre><h3>Bonus section - Matplotlib integration</h3><p>It was still only 2am, so I figured I could push 30 more minutes until I figured out how to use Python integration and used matplotlib to render the game board. Here&#39;s the result. Not bad, I&#39;d say. Maybe I&#39;ll actually render a gif next time. This is good enough to throw away for today.</p><pre><code>def plot_board(inout game: Game):
    np = Python.import_module(&#34;numpy&#34;)
    plt = Python.import_module(&#34;matplotlib.pyplot&#34;)

    fig = plt.figure(1, [10, 10*game.board.cols//game.board.rows])
    ax = fig.add_axes([0.0, 0.0, 1.0, 1.0], False, 1)
    plt.imshow(game.board.to_numpy(), &#39;gray&#39;)
    plt.axis(&#34;off&#34;)
    plt.show()

plot_board(g)
</code></pre><figure><img src="https://web.archive.org/assets/images/writings/mojo-matplotlib-game-of-life-glider.png" alt="Game of Life - Glider guns - Mojo Matplotlib integration"/><figcaption>Game of Life - Glider gun</figcaption></figure><h2>Resources</h2><ul><li><a href="https://www.modular.com/mojo">https://www.modular.com/mojo</a></li><li><a href="https://docs.modular.com/mojo/">https://docs.modular.com/mojo/</a></li><li><a href="https://playground.modular.com/">https://playground.modular.com/</a></li><li><a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life</a></li><li><a href="https://en.wikipedia.org/wiki/Gun_(cellular_automaton)">https://en.wikipedia.org/wiki/Gun_(cellular_automaton)</a></li></ul></div></div></div>
  </body>
</html>
