<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/SpinalHDL/VexRiscv">Original</a>
    <h1>A FPGA friendly 32 bit RISC-V CPU implementation</h1>
    
    <div id="readability-page-1" class="page"><article><p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/29178ba0abbb6d8abab489ff1d8603f0.png" alt="image"/></p>
<p>This article is about my experience building a Figma plugin. Making the plugin was surprisingly easy and rich with creative potential. This article is also an opportunity for me to share my thoughts on the importance of extensible software, and what it means for software to be <code>dynamic</code> and <code>user defined</code>. Although I find extensibility - it’s importance, and how to achieve it - a fascinating subject, I discovered that I need to do a lot more research before I can effectively describe my <em>own</em> experiences with this dimension of software.</p>
<blockquote data-callout="repo">


</blockquote>
<p>But I do know that Figma fits into this experience. When I first used Figma (Design), I was surprised at how intuitive it was to learn.  Later, when opening up Figma’s whiteboarding program, FigJam, I was amazed at how <em>fun</em> it was. I would urge my colleagues to hop into a whiteboard with me, and I would look forward to presenting my cloud architecture suggestions.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/a3a12907dcd839ba44a15646df032ef7.png" alt="image"/></p>
<p>As someone who has been drawing my whole life, I felt at home on a blank expanse of canvas in a way I never had in digital “document”. On a more social level, it was also really interesting to see people interact in 3D space, and watch my colleagues play around with shapes in real time. It was the closest I’ve gotten to playing videogames at work. By playing the exception, it has  also served as a sort of reminder of how much computers often isolate us.</p>
<blockquote data-callout="allegory">

<div>
<p>There was a time in college when I carried a small, thin notebook everywhere. I would doodle in it to pass the time, and I would use to create my todos for the the day, referencing it frequently when I was waiting in line, or had a few spare moments. Sometimes referencing todos turned into a more reflective process, where I would write out details for an art project, or things I wanted to tell a friend.</p>
<p>What I found was that people would stop and ask me what I was doing <em>all the time</em>. In line for food, on benches, in public transit. It was constant. People seemed to be both interested enough <em>and</em> unconcerned enough about crossing any sort of assumed privacy boundary that they would start up conversations all the time.</p>
<p>And I loved it. It was very refreshing. Especially because I would often enjoy sharing these short snippets of my life, my day, and my psyche. I rarely wrote anything too personal in those notebook - more tasks and ideas.</p>
<p>It was so obvious to contrast this to writing notes in a phone that I quickly realized that this <em>never</em> happened when using a phone to do the exact same thing.</p>
</div>
</blockquote>
<p>I’ve used FigJam in particular for a wide range of personal projects, including:</p>
<p><strong>Planning a Canoeing trip</strong>
<img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/1c1a25df6006210e85408c39cdac5c68.png" alt="image"/></p>
<p><strong>Visualizing Binary Trees</strong>
<img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/35e9ee3639c925a6b3b4ecfa643a4842.png" alt="image"/></p>
<p><strong>Creating product roadmaps</strong>
<img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/399c07601aa637f0345e53039585646d.png" alt="image"/></p>
<p><strong>Laying out the electrical system, layout, and build process for my camper van conversion.</strong>
<img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/b7af9a0222f81f2647f451a6b0e9eae4.png" alt="image"/></p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/bb92a1cdd9f22bc9a7daf3b130d96cd8.png" alt="image"/></p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/8f1e95fbbe37719bc112f34c8a80fb69.png" alt="image"/></p>
<blockquote data-callout="note">

<p>I haven’t blogged about my camper van conversation yet, but I plan to.</p>
</blockquote>
<p>So I can attest to the power of the base features of Figma as a way to fluidly explore ideas. Like many modern applications, Figma can be extended with plugins. In order to be available from within the app, each plugin most go through a review process. But they can still be developed locally without that being necessary.</p>
<p>My colleague <a href="https://www.linkedin.com/in/sethhwalker/">Seth Walker<svg aria-hidden="true" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> told me that he was building a Figma plugin, I was interested what that process would be like. I have built a very simple <a href="https://chromewebstore.google.com/detail/markdown-linker/fladjmflhfeobmajeaokkemcgonajjkp">Chrome Extension<svg aria-hidden="true" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>before, as well as an Obsidian Plugin, and in both cases I felt that the development experience taught me a lot about the internal workings of the parent software. In a very real way, plugins allow users to participate in the building process of software. Because I appreciate Figma software, I was curious how it worked.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/1c78da96e96db690a4c49b244a2736af.png" alt="image"/></p>

<p>I want to provide a quick primer to Figma plugins if you haven’t seen them. Here’s a video of me exploring a couple out of the 3000 plugins available:</p>

<p>Ultimately, I think that many of the plugins that exist in Figma are too niche, or marketing ploys or experiments, or are too silly to really be useful. I’m not sure why this is. But despite this, the potential availability of the perfect plugin is reassuring, and tends to make me trust Figma more because it means the creators are invested in extensibility.</p>
<p>I read an article the other day about <a href="https://www.inkandswitch.com/potluck/">Dynamic Documents as Personal Software<svg aria-hidden="true" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>that described how software is often rigid, designed to do a single purpose. I feel the writers captured a very important truth when they wrote:</p>
<blockquote>
<p>“How might we reorient computing so that people can deeply tailor software to meet their unique needs?”</p>
<p>Inkandswitch.com</p>
</blockquote>
<p>The authors of this article contrast the idea and rigidity of a note-taking app as an example of the <code>app</code> in general with the flexibility of a paper note.</p>
<p>One humble but ubiquitous vision of what flexibility in software looks like is the <code>settings</code> panel:</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/27570222bf653818b6a73b1d80774da1.png" alt="image"/></p>
<blockquote>
<p>Settings panel in Obsidian</p>
</blockquote>
<p>But the configurations available in an app’s settings are rarely foundational to the functionality of the app itself.
<img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/db0a6e199d1174cbcd8af9d44ca4d7b6.jpeg" alt="image"/></p>
<p>Users of the <code>settings</code> panel are beholden to a discrete and limited set of options exposed to them by a developer. That’s why I tend to think of applications with a plugin ecosystem as having a fundamentally different ethos than those without. I trust their approach more.</p>
<p>This is far from a complete reflection on the dichotomy between <code>dynamic</code>and <code>static</code> programs, because this vocabulary is new to me. I think the distinction is exciting, and provides language for experiences I’ve had using different tools that inspired me as a developer (whether it was by way of frustration, or delight).</p>
<p>Figma has provided some of the tools that made me subtly rethink what was possible in software, which is why I’m thinking about these things.</p>

<p>Here is the sample code Figma provided Seth and I with when we got started:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="typescript" data-theme="github-light github-dark"><code data-language="typescript" data-theme="github-light github-dark"><span data-line=""><span>// This file holds the main code for plugins. Code in this file has access to</span></span>
<span data-line=""><span>// the *figma document* via the figma global object.</span></span>
<span data-line=""><span>// You can access browser APIs in the &lt;script&gt; tag inside &#34;ui.html&#34; which has a</span></span>
<span data-line=""><span>// full browser environment (See https://www.figma.com/plugin-docs/how-plugins-run).</span></span>
<span data-line=""> </span>
<span data-line=""><span>// Runs this code if the plugin is run in Figma</span></span>
<span data-line=""><span>if</span><span> (figma.editorType </span><span>===</span><span> &#39;figma&#39;</span><span>) {</span></span>
<span data-line=""><span>  // This plugin will open a window to prompt the user to enter a number, and</span></span>
<span data-line=""><span>  // it will then create that many rectangles on the screen.</span></span>
<span data-line=""> </span>
<span data-line=""><span>  // This shows the HTML page in &#34;ui.html&#34;.</span></span>
<span data-line=""><span>  figma.</span><span>showUI</span><span>(__html__);</span></span>
<span data-line=""> </span>
<span data-line=""><span>  // Calls to &#34;parent.postMessage&#34; from within the HTML page will trigger this</span></span>
<span data-line=""><span>  // callback. The callback will be passed the &#34;pluginMessage&#34; property of the</span></span>
<span data-line=""><span>  // posted message.</span></span>
<span data-line=""><span>  figma.ui.</span><span>onmessage</span><span> =</span><span>  (</span><span>msg</span><span>:</span><span> {</span><span>type</span><span>:</span><span> string</span><span>, </span><span>count</span><span>:</span><span> number</span><span>}) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>    // One way of distinguishing between different types of messages sent from</span></span>
<span data-line=""><span>    // your HTML page is to use an object with a &#34;type&#34; property like this.</span></span>
<span data-line=""><span>    if</span><span> (msg.type </span><span>===</span><span> &#39;create-shapes&#39;</span><span>) {</span></span>
<span data-line=""><span>      const</span><span> nodes</span><span>:</span><span> SceneNode</span><span>[] </span><span>=</span><span> [];</span></span>
<span data-line=""><span>      for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> 0</span><span>; i </span><span>&lt;</span><span> msg.count; i</span><span>++</span><span>) {</span></span>
<span data-line=""><span>        const</span><span> rect</span><span> =</span><span> figma.</span><span>createRectangle</span><span>();</span></span>
<span data-line=""><span>        rect.x </span><span>=</span><span> i </span><span>*</span><span> 150</span><span>;</span></span>
<span data-line=""><span>        rect.fills </span><span>=</span><span> [{type: </span><span>&#39;SOLID&#39;</span><span>, color: {r: </span><span>1</span><span>, g: </span><span>0.5</span><span>, b: </span><span>0</span><span>}}];</span></span>
<span data-line=""><span>        figma.currentPage.</span><span>appendChild</span><span>(rect);</span></span>
<span data-line=""><span>        nodes.</span><span>push</span><span>(rect);</span></span>
<span data-line=""><span>      }</span></span>
<span data-line=""><span>      figma.currentPage.selection </span><span>=</span><span> nodes;</span></span>
<span data-line=""><span>      figma.viewport.</span><span>scrollAndZoomIntoView</span><span>(nodes);</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""> </span>
<span data-line=""><span>    // Make sure to close the plugin when you&#39;re done. Otherwise the plugin will</span></span>
<span data-line=""><span>    // keep running, which shows the cancel button at the bottom of the screen.</span></span>
<span data-line=""><span>    figma.</span><span>closePlugin</span><span>();</span></span>
<span data-line=""><span>  };</span></span>
<span data-line=""><span>}</span></span>
<span data-line=""> </span>
<span data-line=""><span>// Runs this code if the plugin is run in FigJam</span></span>
<span data-line=""><span>if</span><span> (figma.editorType </span><span>===</span><span> &#39;figjam&#39;</span><span>) {</span></span>
<span data-line=""><span>  // This plugin will open a window to prompt the user to enter a number, and</span></span>
<span data-line=""><span>  // it will then create that many shapes and connectors on the screen.</span></span>
<span data-line=""> </span>
<span data-line=""><span>  // This shows the HTML page in &#34;ui.html&#34;.</span></span>
<span data-line=""><span>  figma.</span><span>showUI</span><span>(__html__);</span></span>
<span data-line=""> </span>
<span data-line=""><span>  // Calls to &#34;parent.postMessage&#34; from within the HTML page will trigger this</span></span>
<span data-line=""><span>  // callback. The callback will be passed the &#34;pluginMessage&#34; property of the</span></span>
<span data-line=""><span>  // posted message.</span></span>
<span data-line=""><span>  figma.ui.</span><span>onmessage</span><span> =</span><span>  (</span><span>msg</span><span>:</span><span> {</span><span>type</span><span>:</span><span> string</span><span>, </span><span>count</span><span>:</span><span> number</span><span>}) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>    // One way of distinguishing between different types of messages sent from</span></span>
<span data-line=""><span>    // your HTML page is to use an object with a &#34;type&#34; property like this.</span></span>
<span data-line=""><span>    if</span><span> (msg.type </span><span>===</span><span> &#39;create-shapes&#39;</span><span>) {</span></span>
<span data-line=""><span>      const</span><span> numberOfShapes</span><span> =</span><span> msg.count;</span></span>
<span data-line=""><span>      const</span><span> nodes</span><span>:</span><span> SceneNode</span><span>[] </span><span>=</span><span> [];</span></span>
<span data-line=""><span>      for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> 0</span><span>; i </span><span>&lt;</span><span> numberOfShapes; i</span><span>++</span><span>) {</span></span>
<span data-line=""><span>        const</span><span> shape</span><span> =</span><span> figma.</span><span>createShapeWithText</span><span>();</span></span>
<span data-line=""><span>        // You can set shapeType to one of: &#39;SQUARE&#39; | &#39;ELLIPSE&#39; | &#39;ROUNDED_RECTANGLE&#39; | &#39;DIAMOND&#39; | &#39;TRIANGLE_UP&#39; | &#39;TRIANGLE_DOWN&#39; | &#39;PARALLELOGRAM_RIGHT&#39; | &#39;PARALLELOGRAM_LEFT&#39;</span></span>
<span data-line=""><span>        shape.shapeType </span><span>=</span><span> &#39;ROUNDED_RECTANGLE&#39;</span></span>
<span data-line=""><span>        shape.x </span><span>=</span><span> i </span><span>*</span><span> (shape.width </span><span>+</span><span> 200</span><span>);</span></span>
<span data-line=""><span>        shape.fills </span><span>=</span><span> [{type: </span><span>&#39;SOLID&#39;</span><span>, color: {r: </span><span>1</span><span>, g: </span><span>0.5</span><span>, b: </span><span>0</span><span>}}];</span></span>
<span data-line=""><span>        figma.currentPage.</span><span>appendChild</span><span>(shape);</span></span>
<span data-line=""><span>        nodes.</span><span>push</span><span>(shape);</span></span>
<span data-line=""><span>      }</span></span>
<span data-line=""> </span>
<span data-line=""><span>      for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> 0</span><span>; i </span><span>&lt;</span><span> (numberOfShapes </span><span>-</span><span> 1</span><span>); i</span><span>++</span><span>) {</span></span>
<span data-line=""><span>        const</span><span> connector</span><span> =</span><span> figma.</span><span>createConnector</span><span>();</span></span>
<span data-line=""><span>        connector.strokeWeight </span><span>=</span><span> 8</span></span>
<span data-line=""> </span>
<span data-line=""><span>        connector.connectorStart </span><span>=</span><span> {</span></span>
<span data-line=""><span>          endpointNodeId: nodes[i].id,</span></span>
<span data-line=""><span>          magnet: </span><span>&#39;AUTO&#39;</span><span>,</span></span>
<span data-line=""><span>        };</span></span>
<span data-line=""> </span>
<span data-line=""><span>        connector.connectorEnd </span><span>=</span><span> {</span></span>
<span data-line=""><span>          endpointNodeId: nodes[i</span><span>+</span><span>1</span><span>].id,</span></span>
<span data-line=""><span>          magnet: </span><span>&#39;AUTO&#39;</span><span>,</span></span>
<span data-line=""><span>        };</span></span>
<span data-line=""><span>      }</span></span>
<span data-line=""> </span>
<span data-line=""><span>      figma.currentPage.selection </span><span>=</span><span> nodes;</span></span>
<span data-line=""><span>      figma.viewport.</span><span>scrollAndZoomIntoView</span><span>(nodes);</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""> </span>
<span data-line=""><span>    // Make sure to close the plugin when you&#39;re done. Otherwise the plugin will</span></span>
<span data-line=""><span>    // keep running, which shows the cancel button at the bottom of the screen.</span></span>
<span data-line=""><span>    figma.</span><span>closePlugin</span><span>();</span></span>
<span data-line=""><span>  };</span></span>
<span data-line=""><span>};</span></span>
<span data-line=""> </span></code></pre></figure>
<blockquote>
<p>I appreciate the comments that are included.</p>
</blockquote>
<p>You can easily generate this code and get started by following <a href="https://www.figma.com/plugin-docs/plugin-quickstart-guide/">the quickstart guide<svg aria-hidden="true" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>, which essentially tells you to right click in Design or FigJam and select <code>Plugins &gt; Development &gt; New Plugin</code>.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/5971948f37e09daee080ae1b40c5aadb.png" alt="image"/></p>
<p>Figma recommends you build in typescript, just because you interact with many Figma types. Make sure you build your typescript into javascript, and then run your plugin by selecting it in the <code>development</code> menu we just used. If it was the last one run, you can also use the hotkey <code>option + command + p</code> (on mac) to run it again without having to navigate through the menu.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/1b8280831f0148141790097cfe67d3b1.png" alt="image"/></p>
<p>Figma plugins don’t need to have UI, and can execute javascript once upon initiation, but I want to be able to listen for key events and send them to our running javascript process, for which I need to have an <code>html</code> file called <code>ui.html</code>:</p>

<p>After helping my colleague build Conway’s Game of Life in Figma, I thought “huh, Figma is sort of like a game engine”, probably because many of my programming and design challenges have come from making games. My first thought was whether I could create a “character” that could be moved around the screen with the WASD keys.</p>
<p>I cannibalized Seth’s code, grabbed a rectangle creation line, subscribed to some keypress event listeners, and got that rectangle moving around the screen using user input.</p>
<p>In order to do that I needed some HTML - it’s possible to create Figma plugins that only execute Javascript, but after reading the documentation, it looked like I could only listen to key events through a special file called <code>ui.html</code> rather than the javascript file listed in the plugin manifest. Here it is:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="html" data-theme="github-light github-dark"><code data-language="html" data-theme="github-light github-dark"><span data-line=""><span>&lt;</span><span>button</span><span> id</span><span>=</span><span>&#34;startBtn&#34;</span><span>&gt;Start&lt;/</span><span>button</span><span>&gt;</span></span>
<span data-line=""><span>&lt;</span><span>script</span><span>&gt;</span></span>
<span data-line=""><span>	document.</span><span>getElementById</span><span>(</span><span>&#39;startBtn&#39;</span><span>).</span><span>onclick</span><span> =</span><span> () </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>	  document.body.</span><span>focus</span><span>(); </span><span>// Ensure the body can receive key events</span></span>
<span data-line=""><span>	  document.body.</span><span>onkeydown</span><span> =</span><span> (</span><span>event</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>	    const</span><span> key</span><span> =</span><span> event.key.</span><span>toUpperCase</span><span>();</span></span>
<span data-line=""><span>		if</span><span> ([</span></span>
<span data-line=""><span>		&#39;W&#39;</span><span>, </span><span>&#39;A&#39;</span><span>, </span><span>&#39;S&#39;</span><span>, </span><span>&#39;D&#39;</span><span>, </span><span>&#39;U&#39;</span><span>, </span><span>&#39;H&#39;</span><span>, </span><span>&#39;J&#39;</span><span>, </span><span>&#39;K&#39;</span><span>, </span><span>&#39;N&#39;</span><span>, </span><span>&#39;Z&#39;</span><span>,</span></span>
<span data-line=""><span>		&#39;3&#39;</span><span>, </span><span>&#39;4&#39;</span><span>, </span><span>&#39;5&#39;</span><span>, </span><span>&#39;6&#39;</span><span>, </span><span>&#39;7&#39;</span><span>, </span><span>&#39;8&#39;</span><span>, </span><span>&#39;9&#39;</span><span>]</span></span>
<span data-line=""><span>		.</span><span>includes</span><span>(key)){</span></span>
<span data-line=""><span>	      parent.</span><span>postMessage</span><span>({ pluginMessage: { type: </span><span>&#39;keypress&#39;</span><span>, key } }, </span><span>&#39;*&#39;</span><span>);</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>  };</span></span>
<span data-line=""><span>};</span></span>
<span data-line=""><span>&lt;/</span><span>script</span><span>&gt;</span></span></code></pre></figure>
<p>All we’re really doing here is creating a start button, focusing on the document body, and listening for a certain subset of key input events that we post to the window.</p>
<p>After writing the code to move this rectangle around like a sort of 2D <code>cursor</code>, I had an urge to interact with the surrounding FigJam environment, so I added the ability to “paint” boxes of the same kind around the box using the UHJK keys, sort of like WASD, but a directional box creation mechanism.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/4ab280030e5cac5178844cd13af33fc4.png" alt="image"/></p>
<p>This was cool, and I could recycle the same <code>createRectangle</code> I used to make the <code>cursor</code> rectangle, but it was awkward to paint around the rectangle, so I added the ability to paint <em>at</em> the location of the rectangle.</p>
<p>Then I noticed that the <code>cursor</code>’s z-index was less than the boxes it created, and it got lost behind them. I found no way to directly manipulate z-index in the API reference material, so I rewrote the way I moved my box so that I instead deleted and recreated it for the illusion of movement, making use of how newer objects in Figma are placed one top of older objects. This is the code I ended up with:</p>
<figure data-rehype-pretty-code-figure=""><pre tabindex="0" data-language="typescript" data-theme="github-light github-dark"><code data-language="typescript" data-theme="github-light github-dark"><span data-line=""><span>let</span><span> history</span><span>:</span><span> RectangleNode</span><span>[] </span><span>=</span><span> []</span></span>
<span data-line=""> </span>
<span data-line=""><span>const</span><span> createRectangle</span><span> =</span><span> (</span><span>x</span><span>:</span><span> number</span><span>, </span><span>y</span><span>:</span><span> number</span><span>, </span><span>color</span><span>:</span><span> { </span><span>r</span><span>:</span><span> number</span><span>, </span><span>g</span><span>:</span><span> number</span><span>, </span><span>b</span><span>:</span><span> number</span><span> }, </span><span>cursor</span><span> =</span><span> false</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>  const</span><span> rect</span><span> =</span><span> figma.</span><span>createRectangle</span><span>();</span></span>
<span data-line=""><span>  rect.x </span><span>=</span><span> x;</span></span>
<span data-line=""><span>  rect.y </span><span>=</span><span> y;</span></span>
<span data-line=""><span>  rect.fills </span><span>=</span><span> [{ type: </span><span>&#39;SOLID&#39;</span><span>, color }];</span></span>
<span data-line=""><span>  if</span><span> (</span><span>!</span><span>cursor){</span></span>
<span data-line=""><span>    history.</span><span>push</span><span>(rect)</span></span>
<span data-line=""><span>  } </span><span>else</span><span> {</span></span>
<span data-line=""><span>    rect.strokes </span><span>=</span><span> [{ type: </span><span>&#39;SOLID&#39;</span><span>, color: {r: </span><span>.5</span><span>, g: </span><span>0.15</span><span>, b: </span><span>.15</span><span>} }];</span></span>
<span data-line=""><span>    rect.strokeWeight </span><span>=</span><span> 8</span><span>;</span></span>
<span data-line=""><span>  }</span></span>
<span data-line=""><span>  return</span><span> rect;</span></span>
<span data-line=""><span>};</span></span>
<span data-line=""> </span>
<span data-line=""><span>const</span><span> moveRectangle</span><span> =</span><span> (</span><span>xMove</span><span>:</span><span> number</span><span>, </span><span>yMove</span><span>:</span><span> number</span><span>, </span><span>box</span><span>:</span><span> RectangleNode</span><span>, </span><span>step</span><span>:</span><span> number</span><span>, </span><span>color</span><span>:</span><span> any</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>  let</span><span> newBox </span><span>=</span><span> createRectangle</span><span>(box.x </span><span>+</span><span> xMove</span><span>*</span><span>step, box.y </span><span>+</span><span> yMove</span><span>*</span><span>step, color, </span><span>true</span><span>)</span></span>
<span data-line=""><span>  box.</span><span>remove</span><span>()</span></span>
<span data-line=""><span>  // figma.viewport.scrollAndZoomIntoView(history);</span></span>
<span data-line=""><span>  return</span><span> newBox</span></span>
<span data-line=""><span>}</span></span>
<span data-line=""> </span>
<span data-line=""><span>const</span><span> hexToRgb</span><span> =</span><span> (</span><span>hex</span><span>:</span><span> string</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>  const</span><span> r</span><span> =</span><span> parseInt</span><span>(hex.</span><span>slice</span><span>(</span><span>1</span><span>, </span><span>3</span><span>), </span><span>16</span><span>) </span><span>/</span><span> 255</span><span>;</span></span>
<span data-line=""><span>  const</span><span> g</span><span> =</span><span> parseInt</span><span>(hex.</span><span>slice</span><span>(</span><span>3</span><span>, </span><span>5</span><span>), </span><span>16</span><span>) </span><span>/</span><span> 255</span><span>;</span></span>
<span data-line=""><span>  const</span><span> b</span><span> =</span><span> parseInt</span><span>(hex.</span><span>slice</span><span>(</span><span>5</span><span>, </span><span>7</span><span>), </span><span>16</span><span>) </span><span>/</span><span> 255</span><span>;</span></span>
<span data-line=""><span>  return</span><span> { r, g, b };</span></span>
<span data-line=""><span>};</span></span>
<span data-line=""> </span>
<span data-line=""><span>const</span><span> hexColors</span><span> =</span><span> [</span><span>&#39;#141010&#39;</span><span>, </span><span>&#39;#cf5f4e&#39;</span><span>, </span><span>&#39;#e5a16d&#39;</span><span>, </span><span>&#39;#fae2ac&#39;</span><span>, </span><span>&#39;#822229&#39;</span><span>, </span><span>&#39;#524d56&#39;</span><span>];</span></span>
<span data-line=""><span>const</span><span> rgbColors</span><span> =</span><span> hexColors.</span><span>map</span><span>(hexToRgb);</span></span>
<span data-line=""> </span>
<span data-line=""><span>let</span><span> snapCoords</span><span> =</span><span> (</span><span>num</span><span>:</span><span> number</span><span>, </span><span>interval</span><span>:</span><span> number</span><span> =</span><span> 50</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>  return</span><span> num </span><span>-</span><span> (num </span><span>%</span><span> interval)</span></span>
<span data-line=""><span>}</span></span>
<span data-line=""> </span>
<span data-line=""><span>const</span><span> handleFigjam</span><span> =</span><span> () </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>  let</span><span> currentColor </span><span>=</span><span> 0</span><span>;</span></span>
<span data-line=""> </span>
<span data-line=""><span>  // let box = createRectangle((figma.viewport.center.x - 50), figma.viewport.center.y - 50, rgbColors[currentColor], true);</span></span>
<span data-line=""><span>  let</span><span> box </span><span>=</span><span> createRectangle</span><span>(</span><span>snapCoords</span><span>(figma.viewport.center.x, </span><span>50</span><span>), </span><span>snapCoords</span><span>(figma.viewport.center.y, </span><span>50</span><span>), rgbColors[currentColor], </span><span>true</span><span>);</span></span>
<span data-line=""><span>  box.</span><span>resize</span><span>(</span><span>100</span><span>, </span><span>100</span><span>);</span></span>
<span data-line=""> </span>
<span data-line=""><span>  const</span><span> moveBox</span><span> =</span><span> (</span><span>direction</span><span>:</span><span> string</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>    const</span><span> step</span><span> =</span><span> 100</span><span>;</span></span>
<span data-line=""><span>    const</span><span> actions</span><span>:</span><span> { [</span><span>key</span><span>:</span><span> string</span><span>]</span><span>:</span><span> () </span><span>=&gt;</span><span> void</span><span> } </span><span>=</span><span> {</span></span>
<span data-line=""><span>      // &#39;W&#39;: () =&gt; box.y -= step,</span></span>
<span data-line=""><span>      &#39;W&#39;</span><span>: () </span><span>=&gt;</span><span> box </span><span>=</span><span> moveRectangle</span><span>(</span><span>0</span><span>, </span><span>-</span><span>1</span><span>, box, step, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;A&#39;</span><span>: () </span><span>=&gt;</span><span> box </span><span>=</span><span> moveRectangle</span><span>(</span><span>-</span><span>1</span><span>, </span><span>0</span><span>, box, step, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;S&#39;</span><span>: () </span><span>=&gt;</span><span> box </span><span>=</span><span> moveRectangle</span><span>(</span><span>0</span><span>, </span><span>+</span><span>1</span><span>, box, step, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;D&#39;</span><span>: () </span><span>=&gt;</span><span> box </span><span>=</span><span> moveRectangle</span><span>(</span><span>+</span><span>1</span><span>, </span><span>0</span><span>, box, step, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;U&#39;</span><span>: () </span><span>=&gt;</span><span> createRectangle</span><span>(box.x, box.y </span><span>-</span><span> step, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;H&#39;</span><span>: () </span><span>=&gt;</span><span> createRectangle</span><span>(box.x </span><span>-</span><span> step, box.y, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;J&#39;</span><span>: () </span><span>=&gt;</span><span> createRectangle</span><span>(box.x, box.y </span><span>+</span><span> step, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;K&#39;</span><span>: () </span><span>=&gt;</span><span> createRectangle</span><span>(box.x </span><span>+</span><span> step, box.y, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;N&#39;</span><span>: () </span><span>=&gt;</span><span> createRectangle</span><span>(box.x, box.y, rgbColors[currentColor]),</span></span>
<span data-line=""><span>      &#39;Z&#39;</span><span>: () </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>        if</span><span> (history.</span><span>length</span><span>){</span></span>
<span data-line=""><span>          let</span><span> last </span><span>=</span><span> history.</span><span>pop</span><span>()</span></span>
<span data-line=""><span>          if</span><span> (last) last.</span><span>remove</span><span>()</span></span>
<span data-line=""><span>        }</span></span>
<span data-line=""><span>      }</span></span>
<span data-line=""><span>    };</span></span>
<span data-line=""> </span>
<span data-line=""><span>    if</span><span> (actions[direction]) {</span></span>
<span data-line=""><span>      actions[direction]();</span></span>
<span data-line=""><span>    } </span><span>else</span><span> if</span><span> (</span><span>/</span><span>^</span><span>[3-8]</span><span>$</span><span>/</span><span>.</span><span>test</span><span>(direction)) {</span></span>
<span data-line=""><span>      currentColor </span><span>=</span><span> parseInt</span><span>(direction) </span><span>-</span><span> 3</span><span>;</span></span>
<span data-line=""><span>      box </span><span>=</span><span> moveRectangle</span><span>(</span><span>0</span><span>, </span><span>0</span><span>, box, step, rgbColors[currentColor])</span></span>
<span data-line=""><span>      // box.fills = [{ type: &#39;SOLID&#39;, color: rgbColors[currentColor] }];</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>  };</span></span>
<span data-line=""> </span>
<span data-line=""><span>  figma.ui.</span><span>onmessage</span><span> =</span><span> (</span><span>msg</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>    if</span><span> (msg.type </span><span>===</span><span> &#39;keypress&#39;</span><span>) {</span></span>
<span data-line=""><span>      moveBox</span><span>(msg.key);</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>  };</span></span>
<span data-line=""> </span>
<span data-line=""><span>  figma.</span><span>on</span><span>(</span><span>&#39;close&#39;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span data-line=""><span>    if</span><span> (box){</span></span>
<span data-line=""><span>      box.</span><span>remove</span><span>()</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>  });</span></span>
<span data-line=""><span>};</span></span>
<span data-line=""> </span>
<span data-line=""><span>if</span><span> (figma.editorType </span><span>===</span><span> &#39;figjam&#39;</span><span>) {</span></span>
<span data-line=""><span>  handleFigjam</span><span>();</span></span>
<span data-line=""><span>}</span></span>
<span data-line=""> </span>
<span data-line=""><span>figma.</span><span>showUI</span><span>(__html__);</span></span></code></pre></figure>
<p>Then I added undo! Previously, it was only possibly to undo <em>all</em> of the new squares at once.</p>
<p>I also made sure that the <code>cursor</code> square was removed when the plugin was closed.</p>
<p>Lastly, it was boring to just have one color, so I also added the ability to cycle through colors using the number keys <code>3-8</code> (so the right hand could easily use them, instead of the left, which is busy with the <code>WASD</code> keys). I grabbed the colors out of this photo of me and my brother I really like taken after I almost drowned in the ocean:</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/5aac1fe4768630e18f0a8cd03de5abbf.jpeg" alt="image"/></p>
<p>Here’s a video of me playing around with it on top of the photo the colors are based on:</p>

<p>And here’s a little dude I made:</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/9c1d1e8d1414533f7fa5b742de1f7f8c.png" alt="image"/></p>
<p>This is the process of making said lil’ dude:</p>

<p>I made some…other creatures too. Sorry, I misplaced one of their noggins:</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/ebfe04622e61d7e8b511f45e8c48495b.png" alt="image"/></p>
<p>It turns out that one awesome thing about making pixel art in Figma is that because the result is a set of RectangleNoes, which can be copied, deleted, rotated and manipulated post-creation in all the same ways objects can <em>normally</em> be manipulated in Figma. They be exported as a PNG simply by using the <code>command + shift + c</code> hotkey.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/800962daec4a6ea2223ada0dd6dbdd9b.png" alt="image"/></p>
<p>Or as JPGs using the menu or <code>command + shift + e</code> export hotkey.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/63e5d86ffb63290f6965f47fa64b0623.png" alt="image"/></p>
<p><a href="https://github.com/Elijer/pixelpainter">The repo is public, so please feel free to clone/fork it and use it in figma<svg aria-hidden="true" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/a4017934fce8957d623812bd049cf52a.png" alt="image"/></p>
<p>I don’t have time to go through the Figma publishing process right now, but if you find it useful (or don’t!), please let me know. I welcome all feedback.</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/08899a435d0daa3783c1c5aa0c897024.png" alt="image"/></p>

<ul>
<li><del>Implement undo</del></li>
<li>When the box zooms out of the screen, focus the view on the box. I know this is very doable because the example plugin Figma provides does this
<ul>
<li>I found this problem actually a bit tricky to define, and that using the mouse to readjust the view might be a better solution than manually readjusting the view. HOWEVER, I did comment out a line that used a list of the entire history of the plugin to readjust the view, which actually work pretty well, depending on what you are doing.</li>
</ul>
</li>
<li>~~Make sure the <em>moving</em> box that is used like a sort of cursor has a higher z-index than the boxes it makes, so it never gets <em>lost</em> underneath those boxes.</li>
<li><del>Actually getting the boxes to stack along the same grid every time (I tried to do this with the snapCoords method, but it isn’t quite behaving)</del> Immediately after writing this I realized that the snap to coords method was not snapping to the full width of the box.</li>
<li>Test out multiplayer</li>
<li>Floodfill?</li>
<li>Allow the cursor to ‘eyedrop-tool’ the color below it (looked into this and there is no obvious way to do this I could find on first glance)</li>
<li>Make a multiplayer game.</li>
</ul>

<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/029c47cb05a3d48384df4505f3a15392.png" alt="image"/></p>
<p>I am reaching for a way to categorize the flexibility of different programs, and I’m struggling to quantify this is a satisfying way. Turns out it’s difficult to categorize software on just two dimensions, but here’s an attempt to show how software with plugin / extension ecosystems stacks against other things. I will leave you with this diagram I made in an attempt to map these dimensions out:</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/327e30989af09124d7d9e454ef4e3642.jpeg" alt="image"/></p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/fd8d781bb5ca52ee055b2c6f744dce02.png" alt="image"/></p>
<p>Thanks for reading!</p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/f92bef6a81773989d55957696cb631fa.png" alt="image"/></p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/08899a435d0daa3783c1c5aa0c897024.png" alt="image"/></p>
<p><img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/07bd5238e3c5651fdc8d97b7f75a8b89.png" alt="image"/>
<img src="https://thornberry-obsidian-general.s3.us-east-2.amazonaws.com/attachments/090848365f95e72967c1832b35aa7004.png" alt="image"/></p></article></div>
  </body>
</html>
