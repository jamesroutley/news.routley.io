<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://research.eye.security/consent-and-compromise/">Original</a>
    <h1>Abusing Entra OAuth for fun and access to internal Microsoft applications</h1>
    
    <div id="readability-page-1" class="page"><div>
				
<p>This blog is about how I got access to over 22 internal Microsoft services and how you might be vulnerable too.</p>



<p>After my <a href="https://www.youtube.com/watch?v=uowTmPomYcg">last talk at the 38C3 conference in Hamburg</a>, this was the top comment on YouTube.</p>



<figure><img data-recalc-dims="1" fetchpriority="high" decoding="async" width="802" height="260" data-attachment-id="3418" data-permalink="https://research.eye.security/consent-and-compromise/image-5/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?fit=802%2C260&amp;ssl=1" data-orig-size="802,260" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?fit=300%2C97&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?fit=802%2C260&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?resize=802%2C260&amp;ssl=1" alt="Comment from a YouTube user expressing concerns about cybersecurity talks" srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?w=802&amp;ssl=1 802w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?resize=300%2C97&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?resize=768%2C249&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?resize=800%2C260&amp;ssl=1 800w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-4.png?resize=512%2C166&amp;ssl=1 512w" sizes="(max-width: 802px) 100vw, 802px"/></figure>



<p>Well, this story definitely falls in the category “someone stumbling around finding horrifying vulnerabilities”. Although this time I was not even having issues, I was just distracted from a boring task.</p>



<p>You see, I was writing some documentation the other day, when my Eye fell on one of those aka.ms links. For those of you who don’t know, aka.ms is the <a href="https://github.com/microsoft/aka">URL shortener service used by Microsoft</a>.</p>



<p>My mind started to wonder. Where would you end up if you would just visit <a href="https://aka.ms" rel="nofollow">https://aka.ms</a>, so without any shortener link included?</p>


<div>
<figure><img data-recalc-dims="1" decoding="async" width="755" height="710" data-attachment-id="3419" data-permalink="https://research.eye.security/consent-and-compromise/image-6/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?fit=755%2C710&amp;ssl=1" data-orig-size="755,710" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?fit=300%2C282&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?fit=755%2C710&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?resize=755%2C710&amp;ssl=1" alt="Microsoft sign-in screen prompting users to enter their email, phone, or Skype for account access." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?w=755&amp;ssl=1 755w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?resize=300%2C282&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?resize=512%2C481&amp;ssl=1 512w" sizes="(max-width: 755px) 100vw, 755px"/></figure></div>


<p>A login screen. This is probably where Microsoft employees manage their links. I did wonder though, what would happen if I simply tried logging in here myself with my own Microsoft account? Surely, that would not work, right?</p>


<div>
<figure><img data-recalc-dims="1" decoding="async" width="1024" height="576" data-attachment-id="3421" data-permalink="https://research.eye.security/consent-and-compromise/image-7/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?fit=1322%2C744&amp;ssl=1" data-orig-size="1322,744" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?fit=300%2C169&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?fit=1024%2C576&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-6-1024x576.png?resize=1024%2C576&amp;ssl=1" alt="Microsoft account selection screen with error message indicating the selected user account does not exist in the specified tenant." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?resize=1024%2C576&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?resize=300%2C169&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?resize=768%2C432&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?resize=1200%2C675&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?resize=512%2C288&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?resize=920%2C518&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-6.png?w=1322&amp;ssl=1 1322w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure></div>


<p>Of course not! You need an account in the Microsoft tenant, otherwise, no luck. Back to writing that boring documentation. But what was that? <a href="https://akasearch.net/">An indexing service for aka.ms links</a>? Interesting.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="407" data-attachment-id="3427" data-permalink="https://research.eye.security/consent-and-compromise/image-10/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?fit=2228%2C885&amp;ssl=1" data-orig-size="2228,885" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?fit=300%2C119&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?fit=1024%2C407&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=1024%2C407&amp;ssl=1" alt="A screenshot of akaSearch, a website for searching Microsoft&#39;s aka.ms links, displaying a list of links with titles and corresponding URLs." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=1024%2C407&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=300%2C119&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=768%2C305&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=1536%2C610&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=2048%2C814&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=1200%2C477&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=512%2C203&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=920%2C365&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=1600%2C636&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?resize=1920%2C763&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-9.png?w=2228&amp;ssl=1 2228w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>And one of those links points to an eng.ms domain. What is that?</p>


<div>
<figure><img data-recalc-dims="1" decoding="async" width="755" height="710" data-attachment-id="3419" data-permalink="https://research.eye.security/consent-and-compromise/image-6/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?fit=755%2C710&amp;ssl=1" data-orig-size="755,710" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?fit=300%2C282&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?fit=755%2C710&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?resize=755%2C710&amp;ssl=1" alt="Microsoft sign-in screen prompting users to enter their email, phone, or Skype for account access." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?w=755&amp;ssl=1 755w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?resize=300%2C282&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-5.png?resize=512%2C481&amp;ssl=1 512w" sizes="(max-width: 755px) 100vw, 755px"/></figure></div>


<p>Another login screen! It did not work the first time, but maybe I can login here! The result surprised me.</p>


<div>
<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="754" height="1024" data-attachment-id="3509" data-permalink="https://research.eye.security/consent-and-compromise/image-45/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?fit=796%2C1081&amp;ssl=1" data-orig-size="796,1081" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?fit=221%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?fit=754%2C1024&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?resize=754%2C1024&amp;ssl=1" alt="A Microsoft consent prompt requesting permissions to access user profile information for the EngineeringHub application, indicating it is unverified and not published by Microsoft." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?resize=754%2C1024&amp;ssl=1 754w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?resize=221%2C300&amp;ssl=1 221w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?resize=768%2C1043&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?resize=512%2C695&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-44.png?w=796&amp;ssl=1 796w" sizes="auto, (max-width: 754px) 100vw, 754px"/></figure></div>


<p>I got a consent prompt, asking me to give consent to share my basic profile information with this application. Sure, why not? Does that mean this is an application I can access?</p>



<p>After clicking “accept”, I get a 500 Internal Server Error message. I’m pretty sure that was this server trying to tell me that this application was not meant to be accessed by me. But now I’m intrigued, what is eng.ms? I still had that documentation to write, but that had to wait. </p>



<p>I started subdomain enumeration on the domain eng.ms and found an interesting subdomain: rescue.eng.ms. This gave me another login screen and another consent prompt. But this time it gave me access using my own Microsoft 365 account! Notice my name in the upper right corner?</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="844" data-attachment-id="3424" data-permalink="https://research.eye.security/consent-and-compromise/image-8/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?fit=1638%2C1350&amp;ssl=1" data-orig-size="1638,1350" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?fit=300%2C247&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?fit=1024%2C844&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=1024%2C844&amp;ssl=1" alt="Screenshot of the Engineering Hub Rescue page showing various team sections such as Cloud + AI Platform, Experiences &amp; Devices, Finance Group, and Gaming, along with a search bar at the top." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=1024%2C844&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=300%2C247&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=768%2C633&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=1536%2C1266&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=1200%2C989&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=512%2C422&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=920%2C758&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?resize=1600%2C1319&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-7.png?w=1638&amp;ssl=1 1638w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>I quickly realized that I should not have access here. This Engineering Hub was some sort of portal for Microsoft Engineers. I must admit, my knee-jerk reaction as a red-teamer was to search for the phrase “password”. What can I say, I could not help myself. It returned 13,252 hits, all referring to internal Microsoft procedures and product groups. I was clearly not supposed to access this.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="454" data-attachment-id="3932" data-permalink="https://research.eye.security/consent-and-compromise/attachment/001/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?fit=1608%2C713&amp;ssl=1" data-orig-size="1608,713" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="001" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?fit=300%2C133&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?fit=1024%2C454&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=1024%2C454&amp;ssl=1" alt="Screenshot of the Engineering Hub Rescue page displaying search results for the term &#39;password&#39;, with several links and references to internal documentation related to password management." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=1024%2C454&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=300%2C133&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=768%2C341&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=1536%2C681&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=1200%2C532&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=512%2C227&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=920%2C408&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?resize=1600%2C709&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/001.png?w=1608&amp;ssl=1 1608w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>I stopped here and reported this to the Microsoft Security Response Centre (MSRC). But what had happened here? Why was I able to access this internal portal and might other services be vulnerable in the same way?</p>



<p>To answer that question, we need to have a closer look at how Entra ID handles authentication and authorization for multi-tenant applications.</p>



<p><strong>Multi-Tenant Applications</strong></p>



<p>When developers want to use Entra for authentication to a web application, the application needs to first be registered at Entra. This is called an “App Registration” or “Application Object”. These applications can be set to accept users from the tenant where they are registered (single-tenant), or users from any tenant (multi-tenant). They can also be configured to accept “personal Microsoft accounts”.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="250" data-attachment-id="3431" data-permalink="https://research.eye.security/consent-and-compromise/image-11/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?fit=1902%2C464&amp;ssl=1" data-orig-size="1902,464" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?fit=300%2C73&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?fit=1024%2C250&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=1024%2C250&amp;ssl=1" alt="A screenshot of supported account types for a Microsoft application indicating options for user access across different organizational directories." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=1024%2C250&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=300%2C73&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=768%2C187&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=1536%2C375&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=1200%2C293&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=512%2C125&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=920%2C224&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?resize=1600%2C390&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-10.png?w=1902&amp;ssl=1 1902w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>App developers are then tasked to configure the authorization server (login.microsoftonline.com in most cases) in application logic and all four options above have a corresponding desired value for the authorization server URL.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="371" data-attachment-id="3433" data-permalink="https://research.eye.security/consent-and-compromise/image-12/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?fit=2273%2C824&amp;ssl=1" data-orig-size="2273,824" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?fit=300%2C109&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?fit=1024%2C371&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=1024%2C371&amp;ssl=1" alt="A screenshot showing a table comparing different Microsoft Entra authentication values and their descriptions." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=1024%2C371&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=300%2C109&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=768%2C278&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=1536%2C557&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=2048%2C742&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=1200%2C435&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=512%2C186&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=920%2C334&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=1600%2C580&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?resize=1920%2C696&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-11.png?w=2273&amp;ssl=1 2273w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>So single-tenant applications should be configured to use <code>https://login.microsoftonline.com/&lt;tenantid&gt;</code> or <code>https://login.microsoftonline.com/&lt;domain&gt;</code> as the authorization server, while multi-tenant applications that also accept personal Microsoft accounts should use <code>https://login.microsoftonline.com/common</code>.</p>



<p>The Engineering Hub was configured as a multi-tenant application and redirected me to the /common endpoint. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="709" data-attachment-id="3437" data-permalink="https://research.eye.security/consent-and-compromise/image-13/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?fit=1350%2C935&amp;ssl=1" data-orig-size="1350,935" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?fit=300%2C208&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?fit=1024%2C709&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?resize=1024%2C709&amp;ssl=1" alt="Diagram illustrating the authentication flow for requests to a multi-tenant application using Entra ID, showing steps for user authentication, consent, and token return." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?resize=1024%2C709&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?resize=300%2C208&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?resize=768%2C532&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?resize=1200%2C831&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?resize=512%2C355&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?resize=920%2C637&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-12.png?w=1350&amp;ssl=1 1350w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>This allowed me to login (step 1 &amp; 2) with my own “work or school account”, which triggered a Consent prompt (Step 3), as the application was not used in my own tenant before. When I gave it consent, it was instantiated into a Service Principal or “Enterprise Application” (step 4) in my own tenant and returned an access token (step 5).</p>



<p>This access token was issued by my own tenant. The “iss” (issuer) and “tid” (tenant ID) claims were set to values corresponding with my own tenant. Any conditional access policies or user assignment took place in my own tenant according to my own configuration. I was authenticated &amp; authorized, only by the wrong authority. And nowhere in application logic was this checked.</p>


<div>
<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="600" height="600" data-attachment-id="3442" data-permalink="https://research.eye.security/consent-and-compromise/image-14/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?fit=600%2C600&amp;ssl=1" data-orig-size="600,600" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?fit=300%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?fit=600%2C600&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=600%2C600&amp;ssl=1" alt="Illustration of a cartoon character with a police badge and sunglasses, holding a baton, with the text &#39;RESPECT MY AUTHORITY&#39; displayed prominently." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?w=600&amp;ssl=1 600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=300%2C300&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=150%2C150&amp;ssl=1 150w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=400%2C400&amp;ssl=1 400w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=200%2C200&amp;ssl=1 200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=148%2C148&amp;ssl=1 148w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=296%2C296&amp;ssl=1 296w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-13.png?resize=512%2C512&amp;ssl=1 512w" sizes="auto, (max-width: 600px) 100vw, 600px"/></figure></div>


<p>This made me wonder. What other Microsoft services could be impacted by this misconfiguration? Let’s find out!</p>



<p><strong>Mapping the Microsoft Attack Surface</strong></p>



<p>I enumerated subdomains for microsoft.com, azure.com, azure.net, office365.com, office.com, office.net, windows.net, and any .ms domains owned by Microsoft.</p>



<p>This resulted in 102,672 (sub)domains, of which 70,043 resolved to an IP address, 41,890 responded to HTTPS and 1,406 used Entra ID for authentication. </p>



<p>For all 1,406 applications, I checked the URL and parsed the “client_id” parameter to get the Application ID. Any multi-tenant application can be looked up at the Azure AD Graph API at</p>



<pre><code>https://graph.windows.net/myorganization/applicationRefs/&lt;APP_ID&gt;/?api-version=1.6-internal</code></pre>



<p>Single-tenant applications will not give any result, but multi-tenant applications do. It turns out that of the 1,406 applications, 176 were configured as multi-tenant.</p>



<p>Interestingly enough, most of these redirected visitors to the /&lt;tenantid&gt; endpoint. Remember that this was supposed to be used only for single-tenant applications. Developers were probably not even aware their application was configured as multi-tenant. But this URL is just a client-side setting. The only effect is against which tenant you are authenticating. For /common and /organizations, you will authenticate against your own tenant, for /&lt;tenantid&gt;, you authenticate against that tenant.</p>



<p><strong>Previous Research</strong></p>



<p>In 2023, <a href="https://www.wiz.io/blog/azure-active-directory-bing-misconfiguration">Wiz discovered</a> that for any multi-tenant application, if you replace /common or /organizations with /&lt;tenantid&gt; during authentication, you will receive an access token issued by the resource tenant.</p>



<p><a href="https://msrc.microsoft.com/blog/2023/03/guidance-on-potential-misconfiguration-of-authorization-of-multi-tenant-applications-that-use-azure-ad/">Microsoft patched this</a> and stopped issuing tokens if the user does not exist in the resource tenant. Today, we are going to do it the other way around, we are going to replace /&lt;tenantid&gt; with /common to force authentication against our own tenant. This can easily be done in Burp with “match and replace rules”.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="282" data-attachment-id="3447" data-permalink="https://research.eye.security/consent-and-compromise/image-15/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?fit=2400%2C661&amp;ssl=1" data-orig-size="2400,661" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?fit=300%2C83&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?fit=1024%2C282&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=1024%2C282&amp;ssl=1" alt="Configuration settings for HTTP match and replace rules in a proxy for Microsoft applications." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=1024%2C282&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=300%2C83&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=768%2C212&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=1536%2C423&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=2048%2C564&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=1200%2C331&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=512%2C141&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=920%2C253&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=1600%2C441&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?resize=1920%2C529&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-14.png?w=2400&amp;ssl=1 2400w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>But there were still some more hurdles to take. Some applications required user assignment. This was easily done now in my own tenant.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="578" data-attachment-id="3449" data-permalink="https://research.eye.security/consent-and-compromise/image-16/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?fit=1538%2C868&amp;ssl=1" data-orig-size="1538,868" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?fit=300%2C169&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?fit=1024%2C578&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=1024%2C578&amp;ssl=1" alt="A screenshot of an Azure Active Directory role assignment interface showing a meme depicting a person claiming to be an administrator alongside the role selection options." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=1024%2C578&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=300%2C169&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=768%2C433&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=1536%2C867&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=1200%2C677&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=512%2C289&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?resize=920%2C519&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-15.png?w=1538&amp;ssl=1 1538w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Other applications gave error messages during consent.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="157" data-attachment-id="3452" data-permalink="https://research.eye.security/consent-and-compromise/image-18/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?fit=2427%2C372&amp;ssl=1" data-orig-size="2427,372" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?fit=300%2C46&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?fit=1024%2C157&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=1024%2C157&amp;ssl=1" alt="Error message from a Microsoft application indicating access denial with detailed error description." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=1024%2C157&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=300%2C46&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=768%2C118&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=1536%2C235&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=2048%2C314&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=1200%2C184&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=512%2C78&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=920%2C141&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=1600%2C245&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?resize=1920%2C294&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-17.png?w=2427&amp;ssl=1 2427w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="291" data-attachment-id="3451" data-permalink="https://research.eye.security/consent-and-compromise/image-17/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?fit=2212%2C628&amp;ssl=1" data-orig-size="2212,628" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?fit=300%2C85&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?fit=1024%2C291&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=1024%2C291&amp;ssl=1" alt="Error message on Microsoft sign-in screen indicating trouble signing in due to application access issues." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=1024%2C291&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=300%2C85&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=768%2C218&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=1536%2C436&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=2048%2C581&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=1200%2C341&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=512%2C145&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=920%2C261&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=1600%2C454&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?resize=1920%2C545&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-16.png?w=2212&amp;ssl=1 2212w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Both of these errors occurred when application objects define resources (other application objects) they require access to. These other applications could be configured as single-tenant applications, which can not be instantiated in my tenant. Or the application is configured in a way that it already expects the service principal to be there. Required resource access can be found at the Azure AD Graph API at</p>



<pre><code>https://graph.windows.net/myorganization/applicationRefs/&lt;APP_ID&gt;/?api-version=1.6-internal</code></pre>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="585" data-attachment-id="3455" data-permalink="https://research.eye.security/consent-and-compromise/image-19/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?fit=1530%2C874&amp;ssl=1" data-orig-size="1530,874" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?fit=300%2C171&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?fit=1024%2C585&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?resize=1024%2C585&amp;ssl=1" alt="Code snippet illustrating required resource access in an Azure AD application configuration." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?resize=1024%2C585&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?resize=300%2C171&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?resize=768%2C439&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?resize=1200%2C685&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?resize=512%2C292&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?resize=920%2C526&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-18.png?w=1530&amp;ssl=1 1530w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Luckily, there is a workaround here. By skipping the consent flow and instantiating a service principal directly without consent, we can at least instantiate each application individually that is configured as a multi-tenant application.</p>



<pre><code>New-AzureADServicePrincipal -AccountEnabled $true -AppId $app_id `
 -AppRoleAssignmentRequired $true -Tags {WindowsAzureActiveDirectoryIntegratedApp}</code></pre>



<p>This creates a service principal without asking consent or checking availability of required resource access. You do still need to assign the user to the application afterwards and give consent to all resources that are available.</p>



<p><strong>Internal Microsoft Applications</strong></p>



<p>We now had all the required tools to consent &amp; compromise. It turned out that 22 internal Microsoft applications were vulnerable and exposed internal data. Some examples.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="833" height="364" data-attachment-id="3933" data-permalink="https://research.eye.security/consent-and-compromise/attachment/002/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?fit=833%2C364&amp;ssl=1" data-orig-size="833,364" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="002" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?fit=300%2C131&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?fit=833%2C364&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?resize=833%2C364&amp;ssl=1" alt="Screenshot of a software interface displaying the Risk Register section with options for viewing risks, threat models, outage relationships, and risk reporting." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?w=833&amp;ssl=1 833w, https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?resize=300%2C131&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?resize=768%2C336&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/002.png?resize=512%2C224&amp;ssl=1 512w" sizes="auto, (max-width: 833px) 100vw, 833px"/></figure>



<p>This “Risk Register” contained [<em>redacted on request by Microsoft</em>].</p>



<p>Another interesting application was the Security Intelligence Platform. This application contained security intelligence datasets with names that speak for themselves.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="575" data-attachment-id="3469" data-permalink="https://research.eye.security/consent-and-compromise/image-24/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?fit=2400%2C1348&amp;ssl=1" data-orig-size="2400,1348" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?fit=300%2C169&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?fit=1024%2C575&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=1024%2C575&amp;ssl=1" alt="Screenshot of the Security Intelligence Platform showing datasets with names like &#39;AAD_GroupMembers&#39; and &#39;AAD_UserData&#39;, along with options to request access." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=1024%2C575&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=300%2C169&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=768%2C431&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=1536%2C863&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=2048%2C1150&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=1200%2C674&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=512%2C288&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=920%2C517&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=1600%2C899&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?resize=1920%2C1078&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-23.png?w=2400&amp;ssl=1 2400w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="598" data-attachment-id="3470" data-permalink="https://research.eye.security/consent-and-compromise/image-25/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?fit=2310%2C1350&amp;ssl=1" data-orig-size="2310,1350" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?fit=300%2C175&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?fit=1024%2C598&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=1024%2C598&amp;ssl=1" alt="A grid of application service request cards, each displaying the application name and a &#39;Request Access&#39; button, set on a blue background." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=1024%2C598&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=300%2C175&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=768%2C449&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=1536%2C898&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=2048%2C1197&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=1200%2C701&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=512%2C299&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=920%2C538&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=1600%2C935&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?resize=1920%2C1122&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-24.png?w=2310&amp;ssl=1 2310w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Unfortunately for us, access to these datasets still required admin approval. I wondered how those access requests work. It has a button “Ask Sippy”. Maybe Sippy knows?</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="386" data-attachment-id="3473" data-permalink="https://research.eye.security/consent-and-compromise/image-27/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?fit=2330%2C878&amp;ssl=1" data-orig-size="2330,878" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?fit=300%2C113&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?fit=1024%2C386&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=1024%2C386&amp;ssl=1" alt="A chat interface displaying a virtual assistant named Sippy, providing responses about accessing admin portals and information requests." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=1024%2C386&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=300%2C113&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=768%2C289&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=1536%2C579&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=2048%2C772&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=1200%2C452&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=512%2C193&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=920%2C347&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=1600%2C603&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?resize=1920%2C724&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-26.png?w=2330&amp;ssl=1 2330w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>At least this application allowed me to search the entire Microsoft tenant for Service Principal Names and user accounts.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="561" data-attachment-id="3475" data-permalink="https://research.eye.security/consent-and-compromise/image-28/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?fit=2400%2C1315&amp;ssl=1" data-orig-size="2400,1315" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?fit=300%2C164&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?fit=1024%2C561&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=1024%2C561&amp;ssl=1" alt="Screenshot of the Security Intelligence Platform showing an access request form with fields for AAD Object Id, Comms Aliases, Access Package Name, and Justification." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=1024%2C561&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=300%2C164&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=768%2C421&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=1536%2C842&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=2048%2C1122&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=1200%2C658&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=512%2C281&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=920%2C504&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=1600%2C877&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?resize=1920%2C1052&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-27.png?w=2400&amp;ssl=1 2400w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="464" data-attachment-id="3476" data-permalink="https://research.eye.security/consent-and-compromise/image-29/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?fit=2397%2C1086&amp;ssl=1" data-orig-size="2397,1086" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?fit=300%2C136&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?fit=1024%2C464&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=1024%2C464&amp;ssl=1" alt="Screenshot of the Security Intelligence Platform&#39;s access request interface, displaying fields for AAD Object ID, Access Package Name, and Justification for SPN access request." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=1024%2C464&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=300%2C136&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=768%2C348&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=1536%2C696&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=2048%2C928&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=1200%2C544&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=512%2C232&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=920%2C417&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=1600%2C725&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?resize=1920%2C870&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-28.png?w=2397&amp;ssl=1 2397w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>I even found a logfile that contained Authorization Codes for all the users that had logged in. </p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="114" data-attachment-id="3478" data-permalink="https://research.eye.security/consent-and-compromise/image-30/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?fit=2286%2C254&amp;ssl=1" data-orig-size="2286,254" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?fit=300%2C33&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?fit=1024%2C114&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=1024%2C114&amp;ssl=1" alt="Code snippet showing log data from a Microsoft application, including page IDs, URLs, user IDs, and timestamps." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=1024%2C114&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=300%2C33&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=768%2C85&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=1536%2C171&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=2048%2C228&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=1200%2C133&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=512%2C57&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=920%2C102&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=1600%2C178&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?resize=1920%2C213&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-29.png?w=2286&amp;ssl=1 2286w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>How unfortunate that these can only be redeemed once…</p>



<p>The next application was actually a really big forest of connected applications.</p>


<div>
<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="904" height="1024" data-attachment-id="3479" data-permalink="https://research.eye.security/consent-and-compromise/image-31/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?fit=930%2C1054&amp;ssl=1" data-orig-size="930,1054" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?fit=265%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?fit=904%2C1024&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?resize=904%2C1024&amp;ssl=1" alt="Screenshot of a Microsoft permissions request page displaying an unverified app &#39;MediaCreation-thanos-WebPortal&#39; along with permission details." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?resize=904%2C1024&amp;ssl=1 904w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?resize=265%2C300&amp;ssl=1 265w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?resize=768%2C870&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?resize=512%2C580&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?resize=920%2C1043&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-30.png?w=930&amp;ssl=1 930w" sizes="auto, (max-width: 904px) 100vw, 904px"/></figure></div>


<p>This turned out to be the “Media Creation” service. It promised great things to come. Well bring it on.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="220" data-attachment-id="3481" data-permalink="https://research.eye.security/consent-and-compromise/image-32/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?fit=2391%2C514&amp;ssl=1" data-orig-size="2391,514" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?fit=300%2C64&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?fit=1024%2C220&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=1024%2C220&amp;ssl=1" alt="Screenshot of the MediaBuilder portal, featuring the text &#39;Great things come to those who don&#39;t wait. Build in the cloud today.&#39; with a Microsoft Corporation copyright notice." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=1024%2C220&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=300%2C64&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=768%2C165&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=1536%2C330&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=2048%2C440&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=1200%2C258&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=512%2C110&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=920%2C198&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=1600%2C344&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?resize=1920%2C413&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-31.png?w=2391&amp;ssl=1 2391w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>What media is it actually building? Is that… Windows?</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="645" data-attachment-id="3482" data-permalink="https://research.eye.security/consent-and-compromise/image-33/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?fit=2142%2C1350&amp;ssl=1" data-orig-size="2142,1350" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?fit=300%2C189&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?fit=1024%2C645&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=1024%2C645&amp;ssl=1" alt="Screenshot of a web interface displaying details for a media creation buildable artifact, with sections for properties like BuildableArtifactId, RequestGraphId, FQBN, and more." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=1024%2C645&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=300%2C189&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=768%2C484&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=1536%2C968&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=2048%2C1291&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=1200%2C756&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=512%2C323&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=920%2C580&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=1600%2C1008&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?resize=1920%2C1210&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-32.png?w=2142&amp;ssl=1 2142w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Let’s dive in. There are logfiles.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="901" data-attachment-id="3484" data-permalink="https://research.eye.security/consent-and-compromise/image-34/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?fit=1309%2C1152&amp;ssl=1" data-orig-size="1309,1152" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?fit=300%2C264&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?fit=1024%2C901&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?resize=1024%2C901&amp;ssl=1" alt="A list of log files associated with a task, including file names, sizes, and options to view or download each file." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?resize=1024%2C901&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?resize=300%2C264&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?resize=768%2C676&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?resize=1200%2C1056&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?resize=512%2C451&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?resize=920%2C810&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-33.png?w=1309&amp;ssl=1 1309w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>And one of these even contains some private key. </p>


<div>
<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="787" height="261" data-attachment-id="3485" data-permalink="https://research.eye.security/consent-and-compromise/image-35/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?fit=787%2C261&amp;ssl=1" data-orig-size="787,261" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?fit=300%2C99&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?fit=787%2C261&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?resize=787%2C261&amp;ssl=1" alt="Screenshot of a string containing a private key and associated public key, likely related to an application or service configuration." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?w=787&amp;ssl=1 787w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?resize=300%2C99&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?resize=768%2C255&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-34.png?resize=512%2C170&amp;ssl=1 512w" sizes="auto, (max-width: 787px) 100vw, 787px"/></figure></div>


<p>ESD stands for “Electronic Software Distribution” and is used to generate licence keys. Could it be we can now generate licence keys?</p>



<p>This application also gave us access to an interesting API.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="477" data-attachment-id="3487" data-permalink="https://research.eye.security/consent-and-compromise/image-36/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?fit=1516%2C706&amp;ssl=1" data-orig-size="1516,706" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?fit=300%2C140&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?fit=1024%2C477&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?resize=1024%2C477&amp;ssl=1" alt="Screenshot of a Windows Build API documentation for Source Lookup with endpoints for DeltaForgeSource operations, accompanied by a meme featuring a quote that suggests witnessing unbelievable things." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?resize=1024%2C477&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?resize=300%2C140&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?resize=768%2C358&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?resize=1200%2C559&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?resize=512%2C238&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?resize=920%2C428&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-35.png?w=1516&amp;ssl=1 1516w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>And finally gave us RCE on their build infrastructure by defining a new tool.</p>


<div>
<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="821" data-attachment-id="3488" data-permalink="https://research.eye.security/consent-and-compromise/image-37/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?fit=1198%2C960&amp;ssl=1" data-orig-size="1198,960" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?fit=300%2C240&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?fit=1024%2C821&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?resize=1024%2C821&amp;ssl=1" alt="A form for creating a new version of a tool in a Microsoft application, displaying fields for name, tool path, locator type, source URI, package name, version, and tag." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?resize=1024%2C821&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?resize=300%2C240&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?resize=768%2C615&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?resize=512%2C410&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?resize=920%2C737&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-36.png?w=1198&amp;ssl=1 1198w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure></div>


<p>Next to these services, we also got access to several more internal Microsoft applications.</p>



<ul>
<li>Engage ACE Hub</li>



<li>Responsible AI Ops Platform</li>



<li>Billing Account of Microsoft Internal (BAMI) portal</li>



<li>CPET webservice</li>



<li>HxSDK Documentation</li>



<li>Hardware Inventory API</li>



<li>Electronic Label Management</li>



<li>Quality Checkpoint</li>



<li>Ready to Deploy app</li>



<li>Bing ads SA Diagnostic Tool</li>



<li>SBS tool (Copilot Human Correlation Tool)</li>



<li>Secure Devices Portal</li>



<li>Azure Subscription Hub SLM API</li>
</ul>



<p>This research highlights the risk a single misconfiguration in a large environment can pose. The problem lies in a shared responsibility when deploying these applications. When the application developers rely on other teams to register their applications in Entra, both will think they have set up their part correctly.</p>



<p><strong>Are you vulnerable?</strong></p>



<p>So is this vulnerability still out there? Yes! 2% of our own clients were affected. What should you do?</p>



<ul>
<li>Only use Multi-Tenant applications when necessary</li>



<li>If using Multi-Tenant applications, make sure to check the “iss” or “tid” claim in the access token in application logic</li>
</ul>



<p>We have written a small PowerShell script to quickly identify all Multi-Tenant applications in your own Entra environment and their respective redirect URIs.</p>



<pre><code>&gt; .\ListMultiTenantApplications.ps1
Potentially vulnerable App Registrations found:

DisplayName                        AppId                                RedirectUris
-----------                        -----                                ------------
Eye Security Secret App            8123db1e-3ae6-4068-abcd-f45acafee99c https://somepath.eye.security
Eye Security Research Blog         74561b55-4eee-4db9-dead-c80ababee56d https://research.eye.security/rest/oauth2-credential/callback</code></pre>



<p>Check if any of the redirect URI’s is reachable from the internet and make sure all listed applications are checking the “iss” or “tid” claim in the access token in application logic.</p>



<p>The PowerShell script can be <a href="https://github.com/the1bernard/ListMultiTenantApplications/tree/main">downloaded here</a>.</p>



<p><strong>Timeline &amp; Reward</strong></p>



<p>I submitted the first four cases to the MSRC in November 2024 but got distracted by work for a while. Microsoft scaled up a project team in the meantime and this resulted in a race between the Microsoft internal Azure Security Variant Hunting Team and me to submit more vulnerable services. I won 17 of the 18 submissions I did in January 2025. Almost all cases were resolved within two months and this got me third place on the <a data-type="link" data-id="https://msrc.microsoft.com/blog/2025/05/congratulations-to-the-top-msrc-2025-q1-security-researchers/" href="https://msrc.microsoft.com/blog/2025/05/congratulations-to-the-top-msrc-2025-q1-security-researchers/">MSRC Q1 leaderboard</a>.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="504" data-attachment-id="3491" data-permalink="https://research.eye.security/consent-and-compromise/image-38/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?fit=2202%2C1084&amp;ssl=1" data-orig-size="2202,1084" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?fit=300%2C148&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?fit=1024%2C504&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=1024%2C504&amp;ssl=1" alt="A congratulatory message from the Microsoft Security Response Center recognizing top researchers in the Q1 2025 Security Researcher Leaderboard." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=1024%2C504&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=300%2C148&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=768%2C378&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=1536%2C756&amp;ssl=1 1536w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=2048%2C1008&amp;ssl=1 2048w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=1200%2C591&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=512%2C252&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=920%2C453&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=1600%2C788&amp;ssl=1 1600w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?resize=1920%2C945&amp;ssl=1 1920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-37.png?w=2202&amp;ssl=1 2202w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Now as you can imagine, this research made me rich! The total amount of bug bounties was…</p>


<div>
<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="183" height="152" data-attachment-id="3493" data-permalink="https://research.eye.security/consent-and-compromise/image-39/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-38.png?fit=183%2C152&amp;ssl=1" data-orig-size="183,152" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-38.png?fit=183%2C152&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-38.png?fit=183%2C152&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-38.png?resize=183%2C152&amp;ssl=1" alt="An illustration of a bag of money with a dollar sign, representing a financial concept or bounty."/></figure></div>


<p>What?</p>



<p>After my <a href="https://www.youtube.com/watch?v=uowTmPomYcg">last talk at the 38C3 conference in Hamburg </a>one of the comments on YouTube said</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="232" data-attachment-id="3495" data-permalink="https://research.eye.security/consent-and-compromise/image-40/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?fit=1390%2C315&amp;ssl=1" data-orig-size="1390,315" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?fit=300%2C68&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?fit=1024%2C232&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?resize=1024%2C232&amp;ssl=1" alt="Screenshot of a YouTube comment discussing a talk on bug hunting at Microsoft." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?resize=1024%2C232&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?resize=300%2C68&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?resize=768%2C174&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?resize=1200%2C272&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?resize=512%2C116&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?resize=920%2C208&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-39.png?w=1390&amp;ssl=1 1390w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>So, what happened? Bug hunting at Microsoft was supposed to be an infinite money glitch!</p>



<p>Well, we’re not done yet.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="1024" height="472" data-attachment-id="3497" data-permalink="https://research.eye.security/consent-and-compromise/image-41/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?fit=1472%2C678&amp;ssl=1" data-orig-size="1472,678" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?fit=300%2C138&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?fit=1024%2C472&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?resize=1024%2C472&amp;ssl=1" alt="Screenshot showing a Microsoft permissions request screen with details about the application &#39;MicrosoftRewardsBrt&#39; and options to select a user role." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?resize=1024%2C472&amp;ssl=1 1024w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?resize=300%2C138&amp;ssl=1 300w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?resize=768%2C354&amp;ssl=1 768w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?resize=1200%2C553&amp;ssl=1 1200w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?resize=512%2C236&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?resize=920%2C424&amp;ssl=1 920w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-40.png?w=1472&amp;ssl=1 1472w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>This final application titled “Rewards Support Tool”, allowed managing rewards. And I think I do deserve a reward for this, not?</p>



<p>So, let’s navigate this interesting menu.</p>


<div>
<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="467" height="1024" data-attachment-id="3499" data-permalink="https://research.eye.security/consent-and-compromise/image-42/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?fit=616%2C1350&amp;ssl=1" data-orig-size="616,1350" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?fit=137%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?fit=467%2C1024&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?resize=467%2C1024&amp;ssl=1" alt="Screenshot of the Rewards Support Tool displaying various menu options like &#39;Lookup User Details&#39;, &#39;Create User&#39;, and &#39;Offers&#39;." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?resize=467%2C1024&amp;ssl=1 467w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?resize=137%2C300&amp;ssl=1 137w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?resize=512%2C1122&amp;ssl=1 512w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-41.png?w=616&amp;ssl=1 616w" sizes="auto, (max-width: 467px) 100vw, 467px"/></figure></div>


<p>And go to the “Rebate” page.</p>



<figure><img data-recalc-dims="1" loading="lazy" decoding="async" width="732" height="905" data-attachment-id="3502" data-permalink="https://research.eye.security/consent-and-compromise/image-44/" data-orig-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-43.png?fit=732%2C905&amp;ssl=1" data-orig-size="732,905" data-comments-opened="0" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-43.png?fit=243%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/research.eye.security/wp-content/uploads/image-43.png?fit=732%2C905&amp;ssl=1" src="https://i0.wp.com/research.eye.security/wp-content/uploads/image-43.png?resize=732%2C905&amp;ssl=1" alt="Screenshot of the &#39;Rewards Support Tool&#39; page displaying a rebate submission form with fields for PUID, amount, currency, email, phone number, and a code." srcset="https://i0.wp.com/research.eye.security/wp-content/uploads/image-43.png?w=732&amp;ssl=1 732w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-43.png?resize=243%2C300&amp;ssl=1 243w, https://i0.wp.com/research.eye.security/wp-content/uploads/image-43.png?resize=512%2C633&amp;ssl=1 512w" sizes="auto, (max-width: 732px) 100vw, 732px"/></figure>



<p>Now just enter any amount, currency, PayPal ID, phone number and code, and hit “Payout”.</p>



<p>Turns out, hacking Microsoft still <strong>is</strong> an infinite money glitch.</p>



<h3>About Eye Security</h3>



<p>We are a European cybersecurity company focused on 24/7 threat monitoring, incident response, and cyber insurance. Our research team performs proactive scans and threat intelligence operations across the region to defend our customers and their supply chains.</p>



<p>Learn more at <a href="https://eye.security/" target="_blank" rel="noreferrer noopener">https://eye.security/</a> and <a href="https://www.linkedin.com/company/eyesecurity/">follow us on LinkedIn</a> to help us spread the word.</p>

			</div></div>
  </body>
</html>
