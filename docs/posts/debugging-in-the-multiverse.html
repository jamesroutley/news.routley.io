<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://antithesis.com/blog/multiverse_debugging/">Original</a>
    <h1>Debugging in the Multiverse</h1>
    
    <div id="readability-page-1" class="page"><div id="body_scroll">


    <menu>
        

        

    </menu>
    

    


    

    


<main>
    <section>
        <nav><a href="https://antithesis.com/blog">← Blog</a></nav>
        <header>
            
            
            
            <p>September 10, 2024</p>

        </header>
        
<p data-sid="9000006">Would figuring out your bugs and outages be easier if you had a time machine? </p>
<div><p><picture><source type="image/webp" srcset="/img_opt/cQMH4Qc9r9-1424.webp 1424w"/><img alt="" loading="lazy" decoding="async" src="https://antithesis.com/img_opt/cQMH4Qc9r9-1424.jpeg" width="1424" height="1580"/></picture></p></div>
<p data-sid="9000012">Bring back my files</p>
<div><div><p data-sid="9000013">Obviously the first feature I want from my time machine is the same one I want whenever I accidentally delete data from my harddrive, install malware, or say something dumb in a sensitive conversation: <code>sleep -5</code>. We can do that! (See video.)</p>
<p data-sid="9000014">What exactly is happening here? Antithesis simulates a purely deterministic universe. The reasons we do that are to find bugs faster, and to make them perfectly reproducible once found. But if you can perfectly simulate something, then you can also perfectly simulate it up until 5 seconds from the end.<sup>1</sup> Then we can crack open that universe and give you a bash terminal inside of it. The resulting universe is still deterministic, just dependent on what you decided to do.</p>
</div></div>
<p data-sid="9000016">Information from the past</p>
<div><p data-sid="9000017">Let’s get more concrete. Let’s use this to solve a real problem. My server has crashed and its process has exited! No worries, I’ll just rewind time, attach a debugger to the process, and set a breakpoint or capture a thread dump:</p></div>
<p data-sid="9000018">Packets from the past</p>
<div><p data-sid="9000019">Or you know what? I can’t count the number of times I was trying to figure out where my consensus protocol went wrong and <em>wished</em> I had a dump of all the network traffic. No biggie, I’ll just go back in time and decide I was capturing the traffic all along:</p></div>
<p data-sid="9000020">What was slow?</p>
<div><p data-sid="9000021">Strange and transient performance problems are a snap. Once Antithesis has found them for me, I can rewind time and enable profiling for the period of interest. I don’t need to worry about figuring out how to trigger the pathology again:</p></div>
<p data-sid="9000022">Back to the future</p>
<div><p data-sid="9000023">Like any good time machine, we can travel to the future too. The nice thing about a deterministic universe is that if the thing you’re simulating is mostly idle, you can just simulate it faster. Here we are waiting for 10 minutes to pass in just a few seconds. This kind of time compression is very useful when debugging networked systems:</p></div>
<p data-sid="9000024">Change the past</p>
<div><div><p data-sid="9000025">But let’s be real: if you or I had an actual time machine, we wouldn’t be able to resist the temptation to go back to some historic event, change it, and then return to the present and see what’s different. But that’s a pretty useful technique when debugging too! We call it “multiverse debugging.” Let’s rewind time, turn off fault injection on our Kafka cluster, and see if the NPE still happens:</p>
<p data-sid="9000026">Imagine an extreme version of this. You could rewind a second, explore a thousand tiny variations of the past, and compute the proportion of them that still see the bug. Then you could rewind two seconds and do the same thing. Do that enough times and you’ve just recreated the Antithesis <a href="https://vimeo.com/929193139">bug report</a>. But with this new tool we’re giving you, you could have invented that bug report yourself. What else could you invent?</p>
</div></div>
<p data-sid="9000027">A reactive multiverse</p>
<div><div><p data-sid="9000028">You may be wondering what’s up with this interface I’m showing you. It’s just a browser-based reactive notebook. But by connecting the notebook to a <a href="https://antithesis.com/blog/deterministic_hypervisor/">deterministic hypervisor</a>, we get access to a definitionally side effect-free world. This means there’s no room to smuggle state, so we can make it <em>truly</em> reactive, even when it’s running commands on the Linux system running inside the hypervisor.</p>
<p data-sid="9000029">When you change the text in the notebook it immediately reacts, and the hypervisor reacts too. The UI is just the inevitable result of the notebook text causing a determistic computation. <code>UI = f(code)</code>, even when that code is injecting commands into a distributed system.</p>
</div></div>
<p data-sid="9000030">It’s available now</p>
<div>
<p data-sid="9000031">We haven’t even begun to scratch the surface of this capability, but this post is already too long. We are rolling this out to all of our existing customers today.</p>
<p data-sid="9000032">If you’re already a customer, get started with our <a href="https://antithesis.com/docs/multiverse_debugging/overview.html">new documentation</a>. If you’re not already a customer, <a href="https://antithesis.com/contact">contact us</a>. We’ll find your bugs and then give you a universe-hopping time machine to fix them.</p>
</div>

    </section>
</main>



    
                
        
        
        

        <!-- Simple loading animation -->
        

        <!-- Google Tag Manager (noscript) -->
        
        <!-- End Google Tag Manager (noscript) -->
        
        
            
            
            
            
            
        
    
</div></div>
  </body>
</html>
