<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/nicebyte/86bd1f119d3ff5c8da06bc2fd59ad668">Original</a>
    <h1>Generic dynamic array in 60 lines of C</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C" data-tagsearch-path="dyn_arr.h">
        <tbody><tr>
          <td id="file-dyn_arr-h-L1" data-line-number="1"></td>
          <td id="file-dyn_arr-h-LC1">#<span>pragma</span> once</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L2" data-line-number="2"></td>
          <td id="file-dyn_arr-h-LC2">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L3" data-line-number="3"></td>
          <td id="file-dyn_arr-h-LC3">#<span>define</span> <span>DYN_ARR_OF</span>(<span>type</span>) <span>struct</span>  { \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L4" data-line-number="4"></td>
          <td id="file-dyn_arr-h-LC4">  type *data; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L5" data-line-number="5"></td>
          <td id="file-dyn_arr-h-LC5">  type *endptr; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L6" data-line-number="6"></td>
          <td id="file-dyn_arr-h-LC6">  <span>uint32_t</span> capacity; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L7" data-line-number="7"></td>
          <td id="file-dyn_arr-h-LC7">}</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L8" data-line-number="8"></td>
          <td id="file-dyn_arr-h-LC8">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L9" data-line-number="9"></td>
          <td id="file-dyn_arr-h-LC9">#<span>if</span> !defined(__cplusplus)</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L10" data-line-number="10"></td>
          <td id="file-dyn_arr-h-LC10">#<span>define</span> <span>decltype</span>(<span>x</span>) <span>void</span>*</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L11" data-line-number="11"></td>
          <td id="file-dyn_arr-h-LC11">#<span>endif</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L12" data-line-number="12"></td>
          <td id="file-dyn_arr-h-LC12">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L13" data-line-number="13"></td>
          <td id="file-dyn_arr-h-LC13">#<span>define</span> <span>DYN_ARR_RESET</span>(<span>a, c</span>) { \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L14" data-line-number="14"></td>
          <td id="file-dyn_arr-h-LC14">  a.<span>data</span> = (<span>decltype</span>(a.<span>data</span>))<span>malloc</span>(<span>sizeof</span>(a.<span>data</span>[<span>0</span>]) * c); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L15" data-line-number="15"></td>
          <td id="file-dyn_arr-h-LC15">  a.<span>endptr</span> = a.<span>data</span>; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L16" data-line-number="16"></td>
          <td id="file-dyn_arr-h-LC16">  a.<span>capacity</span> = c; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L17" data-line-number="17"></td>
          <td id="file-dyn_arr-h-LC17">}</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L18" data-line-number="18"></td>
          <td id="file-dyn_arr-h-LC18">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L19" data-line-number="19"></td>
          <td id="file-dyn_arr-h-LC19">#<span>define</span> <span>DYN_ARR_RESIZE</span>(<span>a, s</span>) { \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L20" data-line-number="20"></td>
          <td id="file-dyn_arr-h-LC20">  <span>uint32_t</span> size = (s); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L21" data-line-number="21"></td>
          <td id="file-dyn_arr-h-LC21">  <span>if</span> (a.<span>capacity</span> &lt; size) { \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L22" data-line-number="22"></td>
          <td id="file-dyn_arr-h-LC22">    a.<span>data</span> = (<span>decltype</span>(a.<span>data</span>))<span>realloc</span>(a.<span>data</span>, <span>sizeof</span>(a.<span>data</span>[<span>0</span>]) * size); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L23" data-line-number="23"></td>
          <td id="file-dyn_arr-h-LC23">    a.<span>capacity</span> = size; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L24" data-line-number="24"></td>
          <td id="file-dyn_arr-h-LC24">  } \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L25" data-line-number="25"></td>
          <td id="file-dyn_arr-h-LC25">  a.<span>endptr</span> = a.<span>data</span> + size; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L26" data-line-number="26"></td>
          <td id="file-dyn_arr-h-LC26">} </td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L27" data-line-number="27"></td>
          <td id="file-dyn_arr-h-LC27">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L28" data-line-number="28"></td>
          <td id="file-dyn_arr-h-LC28">#<span>define</span> <span>DYN_ARR_DESTROY</span>(<span>a</span>) <span>if</span>(a.data != <span>NULL</span>) { \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L29" data-line-number="29"></td>
          <td id="file-dyn_arr-h-LC29">  <span>free</span>(a.<span>data</span>); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L30" data-line-number="30"></td>
          <td id="file-dyn_arr-h-LC30">  a.<span>data</span> = a.<span>endptr</span> = <span>NULL</span>; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L31" data-line-number="31"></td>
          <td id="file-dyn_arr-h-LC31">}</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L32" data-line-number="32"></td>
          <td id="file-dyn_arr-h-LC32">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L33" data-line-number="33"></td>
          <td id="file-dyn_arr-h-LC33">#<span>define</span> <span>DYN_ARR_APPEND</span>(<span>a, v</span>) { \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L34" data-line-number="34"></td>
          <td id="file-dyn_arr-h-LC34">  <span>ptrdiff_t</span> cur_size = a.<span>endptr</span> - a.<span>data</span>; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L35" data-line-number="35"></td>
          <td id="file-dyn_arr-h-LC35">  <span>assert</span>(cur_size &gt;= <span>0</span>);                                 \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L36" data-line-number="36"></td>
          <td id="file-dyn_arr-h-LC36">  <span>if</span> ((<span>size_t</span>)cur_size &gt;= a.<span>capacity</span>) { \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L37" data-line-number="37"></td>
          <td id="file-dyn_arr-h-LC37">    a.<span>capacity</span> &lt;&lt;= <span>1u</span>; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L38" data-line-number="38"></td>
          <td id="file-dyn_arr-h-LC38">    <span>decltype</span>(a.<span>data</span>) tmp = (<span>decltype</span>(a.<span>data</span>)) <span>realloc</span>(a.<span>data</span>, <span>sizeof</span>(a.<span>data</span>[<span>0</span>]) * a.<span>capacity</span>); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L39" data-line-number="39"></td>
          <td id="file-dyn_arr-h-LC39">    <span>assert</span>(tmp != <span>NULL</span>); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L40" data-line-number="40"></td>
          <td id="file-dyn_arr-h-LC40">    a.<span>data</span> = tmp; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L41" data-line-number="41"></td>
          <td id="file-dyn_arr-h-LC41">    a.<span>endptr</span> = &amp;a.<span>data</span>[cur_size]; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L42" data-line-number="42"></td>
          <td id="file-dyn_arr-h-LC42">  } \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L43" data-line-number="43"></td>
          <td id="file-dyn_arr-h-LC43">  *(a.<span>endptr</span>++) = v; \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L44" data-line-number="44"></td>
          <td id="file-dyn_arr-h-LC44">}</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L45" data-line-number="45"></td>
          <td id="file-dyn_arr-h-LC45">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L46" data-line-number="46"></td>
          <td id="file-dyn_arr-h-LC46">#<span>define</span> <span>DYN_ARR_CLEAR</span>(<span>a</span>) (a.endptr = a.data)</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L47" data-line-number="47"></td>
          <td id="file-dyn_arr-h-LC47">#<span>define</span> <span>DYN_ARR_SIZE</span>(<span>a</span>) ((<span>uint32_t</span>)(a.endptr - a.data))</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L48" data-line-number="48"></td>
          <td id="file-dyn_arr-h-LC48">#<span>define</span> <span>DYN_ARR_AT</span>(<span>a, i</span>) (a.data[i])</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L49" data-line-number="49"></td>
          <td id="file-dyn_arr-h-LC49">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L50" data-line-number="50"></td>
          <td id="file-dyn_arr-h-LC50">#<span>define</span> <span>DYN_ARR_POP</span>(<span>a</span>) {\</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L51" data-line-number="51"></td>
          <td id="file-dyn_arr-h-LC51">  <span>assert</span>(a.<span>data</span> != a.<span>endptr</span>); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L52" data-line-number="52"></td>
          <td id="file-dyn_arr-h-LC52">  --(a.<span>endptr</span>); \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L53" data-line-number="53"></td>
          <td id="file-dyn_arr-h-LC53">}</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L54" data-line-number="54"></td>
          <td id="file-dyn_arr-h-LC54">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L55" data-line-number="55"></td>
          <td id="file-dyn_arr-h-LC55">#<span>define</span> <span>DYN_ARR_EMPTY</span>(<span>a</span>) (a.endptr == a.data)</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L56" data-line-number="56"></td>
          <td id="file-dyn_arr-h-LC56">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L57" data-line-number="57"></td>
          <td id="file-dyn_arr-h-LC57">#<span>define</span> <span>DYN_ARR_BACKPTR</span>(<span>a</span>) (a.endptr - <span>1</span>)</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L58" data-line-number="58"></td>
          <td id="file-dyn_arr-h-LC58">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L59" data-line-number="59"></td>
          <td id="file-dyn_arr-h-LC59">#<span>define</span> <span>DYN_ARR_FOREACH</span>(<span>a, countername</span>) \</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L60" data-line-number="60"></td>
          <td id="file-dyn_arr-h-LC60"><span>for</span> (<span>size_t</span> countername = <span>0</span>; (countername) &lt; DYN_ARR_SIZE(a); ++(countername))</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L61" data-line-number="61"></td>
          <td id="file-dyn_arr-h-LC61">
</td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L62" data-line-number="62"></td>
          <td id="file-dyn_arr-h-LC62"><span><span>/*</span></span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L63" data-line-number="63"></td>
          <td id="file-dyn_arr-h-LC63"><span> Example usage:</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L64" data-line-number="64"></td>
          <td id="file-dyn_arr-h-LC64"><span>  typedef struct point { uint32_t x, y } point;</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L65" data-line-number="65"></td>
          <td id="file-dyn_arr-h-LC65"><span>  void foo() { </span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L66" data-line-number="66"></td>
          <td id="file-dyn_arr-h-LC66"><span>    DYN_ARR_OF(point) points;</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L67" data-line-number="67"></td>
          <td id="file-dyn_arr-h-LC67"><span>    DYN_ARR_RESET(points, 100u);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L68" data-line-number="68"></td>
          <td id="file-dyn_arr-h-LC68"><span>    uint32_t npoints = 200u;</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L69" data-line-number="69"></td>
          <td id="file-dyn_arr-h-LC69"><span>    for (uint32_t i = 0u; i &lt; npoints; ++i) {</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L70" data-line-number="70"></td>
          <td id="file-dyn_arr-h-LC70"><span>      point p = {i, i * 10u};</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L71" data-line-number="71"></td>
          <td id="file-dyn_arr-h-LC71"><span>      DYN_ARR_APPEND(points, p);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L72" data-line-number="72"></td>
          <td id="file-dyn_arr-h-LC72"><span>    }</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L73" data-line-number="73"></td>
          <td id="file-dyn_arr-h-LC73"><span>    assert(DYN_ARR_SIZE(points) == 200u);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L74" data-line-number="74"></td>
          <td id="file-dyn_arr-h-LC74"><span>    </span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L75" data-line-number="75"></td>
          <td id="file-dyn_arr-h-LC75"><span>    DYN_ARR_FOREACH(points, i) {</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L76" data-line-number="76"></td>
          <td id="file-dyn_arr-h-LC76"><span>      assert(DYN_ARR_AT(points, i).x == i);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L77" data-line-number="77"></td>
          <td id="file-dyn_arr-h-LC77"><span>      assert(DYN_ARR_AT(points, i).y == i * 10u);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L78" data-line-number="78"></td>
          <td id="file-dyn_arr-h-LC78"><span>    }</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L79" data-line-number="79"></td>
          <td id="file-dyn_arr-h-LC79"><span>    DYN_ARR_CLEAR(points);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L80" data-line-number="80"></td>
          <td id="file-dyn_arr-h-LC80"><span>    assert(DYN_ARR_SIZE(points) == 0u);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L81" data-line-number="81"></td>
          <td id="file-dyn_arr-h-LC81"><span>    DYN_ARR_DESTROY(points);</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L82" data-line-number="82"></td>
          <td id="file-dyn_arr-h-LC82"><span>  }</span></td>
        </tr>
        <tr>
          <td id="file-dyn_arr-h-L83" data-line-number="83"></td>
          <td id="file-dyn_arr-h-LC83"><span><span>*/</span></span></td>
        </tr>
  </tbody></div></div>
  </body>
</html>
