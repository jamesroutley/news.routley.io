<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.romanklasen.com/blog/beating-brainrot-by-button/">Original</a>
    <h1>Using Home Assistant, adguard home and an $8 smart outlet to avoid brain rot</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div><p>The internet is the bane of my existence. Ads, distractions, sponsored content, bad news, bad ideas, more ads, social media, antisocial media, even more ads.</p><p>Also, I’m a software developer, so the internet is basically indispensable for me, a central pillar of my income and a convenient way to communicate with friends, family, loved ones, associates, acquaintances, people from my sports club, superpositions of all previous groups and enemies alike. And I think my company runs ads, so in a way ads pay for my clothing and food and stuff. So I guess my current stance towards the internet would be somewhat neutral-ish, but that may still change.</p><p>But I can try to reduce or at least moderate some of the negative aspects of the internet, especially those that keep me hooked like some sad addict: social media. I’ve tried completely blocking it via my networks’ ad blocker, but the animal in me circumvented that blockage by turning off wifi on the cell phone and thus doom scrolling galore on my cell plan. Also, my wife needs some social media for work or research (and of course guilty pleasure) at least some of the time, but she’s as bad in moderation as me. So completely blocking is not viable, but allowing unrestricted internet access to two reasonable adults is somehow also out of the question.</p><p>So the problem remained mathematically unsolvable.</p><p>Until today, when <a href="https://www.neilchen.co/blog/kasa" target="_blank" rel="noreferrer">Neil Chen posted a simply genius idea to hacker news</a>. Neil describes how a smart plug is used to dynamically rewrite some ublock Origin lists to allow unfetted access to all content distracting. The idea is fantastic, but the implementation not practical for my/our scenario, so I’m adapting it here.</p><p>I’m already using an network wide ad blocker via my gli.net router called “Adblock Home”. And for a smart home without internet access (see preamble) I’m using Home Assistant.</p><p>So we have:</p><ul><li>A gli.net router with Adguard Home</li><li>Home Assistant</li><li>Copious amounts of Zigbee Switches</li><li>Some spare time</li></ul><p>Surely there must be some way to wire those together haywire-ly.</p><p>Just like Neil, I want some button to press to allow for access to social media, but only for a limited time (say 15 minutes). After that time has passed, my wife and me must endure a cool-down phase until we can push the button again (say one hour). So whenever we push the button, the filters will be disabled for 15 sin-filled minutes. A Zigbee enabled smart plug is adequately suited.</p><p><picture><source type="image/webp" srcset="/blog/beating-brainrot-by-button/nous_hu_ea1d690a4c54bc3e.webp 300w,/blog/beating-brainrot-by-button/nous_hu_aa1aeff162b71aa0.webp 500w,/blog/beating-brainrot-by-button/nous_hu_309cd10deaafb260.webp 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px"/><img src="https://www.romanklasen.com/blog/beating-brainrot-by-button/nous.jpg" srcset="/blog/beating-brainrot-by-button/nous_hu_de19f3659a6668bf.jpg 300w,/blog/beating-brainrot-by-button/nous_hu_3a24ee3719cb165b.jpg 500w,/blog/beating-brainrot-by-button/nous_hu_e7f8c1e8d6feca5e.jpg 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px" alt="" loading="lazy" width="1000" height="1000"/></picture></p><h2 id="setting-up-adguard-home-on-the-glinet-router">Setting Up Adguard Home on the gli.net Router<a href="#setting-up-adguard-home-on-the-glinet-router" aria-hidden="true">#</a></h2><p>Adguard Home is very conveniently integrated into gli.net’s fork/customization of OpenWRT (formerly Lede, formerly OpenWRT). Frst, we set up the services we wish to block as custom rules. Sadly we cannot use the built-in services, because they don’t seem to count as “custom” and thus cannot be toggled on and off.</p><p><picture><source type="image/webp" srcset="/blog/beating-brainrot-by-button/adguard_hu_ba1fca1252909d21.webp 300w,/blog/beating-brainrot-by-button/adguard_hu_8d43fea3c09c50eb.webp 500w,/blog/beating-brainrot-by-button/adguard_hu_fd7a6a5677aa03b3.webp 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px"/><img src="https://www.romanklasen.com/blog/beating-brainrot-by-button/adguard.png" srcset="/blog/beating-brainrot-by-button/adguard_hu_4e8161e45ce31f6d.png 300w,/blog/beating-brainrot-by-button/adguard_hu_d2c8c7a52dc01fb5.png 500w,/blog/beating-brainrot-by-button/adguard_hu_47794e3286967ff7.png 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px" alt="" loading="lazy" width="1671" height="1737"/></picture></p><h2 id="api-access-to-adguard-home">API Access to Adguard Home<a href="#api-access-to-adguard-home" aria-hidden="true">#</a></h2><p>Adguard Home has a fantastic API, available in OpenAPI yaml. You login to that API with the normal user and password. But: The routers main interface somehow bypasses the authentication, which means Adguard Home has no user/password which we could use for API access. <a href="https://forum.gl-inet.com/t/aguard-home-password/37400/4" target="_blank" rel="noreferrer">This forum link</a> explains how one can be added without breaking the existing integration. Basically, we have to add them by hand to the <code>/etc/Adguard/config.yaml</code> file. Change:</p><p>to</p><div><pre tabindex="0"><code data-lang="yaml"><span><span><span>users</span>:
</span></span><span><span>  - <span>name</span>: <span>admin</span>
</span></span><span><span>    <span>password</span>: <span>$2a$10$dXh72ZnexWPjxzRumXX2fOU2gwvPzqM8OZmcWZmFYl1WEiyhOMj2u</span>
</span></span></code></pre></div><p>This password is the bcrypt hash of <code>admin</code>, but of course thats not the password I’m actually using. <a href="https://gchq.github.io/CyberChef/#recipe=Bcrypt%2810%29&amp;input=YWRtaW4" target="_blank" rel="noreferrer">Use cyberchef to generate the hash</a>.</p><h2 id="home-assistant-integration">Home Assistant Integration<a href="#home-assistant-integration" aria-hidden="true">#</a></h2><p>Home Assistant comes with a functional, but somewhat reduced integration. It can however do all we need.</p><p><picture><source type="image/webp" srcset="/blog/beating-brainrot-by-button/integration_hu_35fbefceb6d7f948.webp 300w,/blog/beating-brainrot-by-button/integration_hu_3d640d33dd59d880.webp 500w,/blog/beating-brainrot-by-button/integration_hu_593082861c80eaf2.webp 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px"/><img src="https://www.romanklasen.com/blog/beating-brainrot-by-button/integration.png" srcset="/blog/beating-brainrot-by-button/integration_hu_afc78de9d0d7bf32.png 300w,/blog/beating-brainrot-by-button/integration_hu_16b715bdb8174dd8.png 500w,/blog/beating-brainrot-by-button/integration_hu_50f71409aa8cb7ef.png 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px" alt="" loading="lazy" width="2062" height="746"/></picture></p><p>Among the switches it exposes is “Filtering”, which enables or disables application of custom filter rules. We can flick this switch via automation.</p><p><picture><source type="image/webp" srcset="/blog/beating-brainrot-by-button/entities_hu_27c77fd3d3caea1b.webp 300w,/blog/beating-brainrot-by-button/entities_hu_41b8dd0e813fe71e.webp 500w,/blog/beating-brainrot-by-button/entities_hu_19b2125638ccf368.webp 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px"/><img src="https://www.romanklasen.com/blog/beating-brainrot-by-button/entities.png" srcset="/blog/beating-brainrot-by-button/entities_hu_4f4548541414ede0.png 300w,/blog/beating-brainrot-by-button/entities_hu_d246e59798131633.png 500w,/blog/beating-brainrot-by-button/entities_hu_7db5253cbcf3056a.png 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px" alt="" loading="lazy" width="934" height="466"/></picture></p><p>After some trial and error, I’ve arrived at this automation, which as of now seems to work just fine and just like I intended.</p><p><picture><source type="image/webp" srcset="/blog/beating-brainrot-by-button/traces_hu_459ade7ecc819a15.webp 300w,/blog/beating-brainrot-by-button/traces_hu_2bba12f4c68adc1c.webp 500w,/blog/beating-brainrot-by-button/traces_hu_5685ec9d68abc89c.webp 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px"/><img src="https://www.romanklasen.com/blog/beating-brainrot-by-button/traces.png" srcset="/blog/beating-brainrot-by-button/traces_hu_2d84d6bbe80f22b9.png 300w,/blog/beating-brainrot-by-button/traces_hu_d9067509242493a9.png 500w,/blog/beating-brainrot-by-button/traces_hu_c4c3e067f0cee336.png 700w" sizes="(max-width: 499px) 300px,(max-width: 699px) 500px,700px" alt="" loading="lazy" width="1592" height="1632"/></picture></p><hr/><div><pre tabindex="0"><code data-lang="yaml"><span><span><span>alias</span>: <span>AdGuard Temporary Disable</span>
</span></span><span><span><span>description</span>: <span>Temporarily disable AdGuard filtering for 15 minutes when button is pressed</span>
</span></span><span><span><span>triggers</span>:
</span></span><span><span>  - <span>type</span>: <span>turned_on</span>
</span></span><span><span>    <span>device_id</span>: <span>83c5ac94282a1e46dfb6b98a103dd9f8</span>
</span></span><span><span>    <span>entity_id</span>: <span>8fbcd8fb42be878036a203950084b125</span>
</span></span><span><span>    <span>domain</span>: <span>switch</span>
</span></span><span><span>    <span>trigger</span>: <span>device</span>
</span></span><span><span><span>actions</span>:
</span></span><span><span>  - <span>choose</span>:
</span></span><span><span>      - <span>conditions</span>:
</span></span><span><span>          - <span>condition</span>: <span>template</span>
</span></span><span><span>            <span>value_template</span>: <span>&#34;{{ cooldown_ok }}&#34;</span>
</span></span><span><span>          - <span>condition</span>: <span>template</span>
</span></span><span><span>            <span>value_template</span>: <span>&#34;{{ override_inactive }}&#34;</span>
</span></span><span><span>        <span>sequence</span>:
</span></span><span><span>          - <span>data</span>: {}
</span></span><span><span>            <span>target</span>:
</span></span><span><span>              <span>entity_id</span>: <span>input_boolean.adguard_override_active</span>
</span></span><span><span>            <span>action</span>: <span>input_boolean.turn_on</span>
</span></span><span><span>          - <span>data</span>:
</span></span><span><span>              <span>datetime</span>: <span>&#34;{{ now().strftime(&#39;%Y-%m-%d %H:%M:%S&#39;) }}&#34;</span>
</span></span><span><span>            <span>target</span>:
</span></span><span><span>              <span>entity_id</span>: <span>input_datetime.last_adguard_disable</span>
</span></span><span><span>            <span>action</span>: <span>input_datetime.set_datetime</span>
</span></span><span><span>          - <span>data</span>: {}
</span></span><span><span>            <span>target</span>:
</span></span><span><span>              <span>entity_id</span>: <span>switch.adguard_home_filterung</span>
</span></span><span><span>            <span>action</span>: <span>switch.turn_off</span>
</span></span><span><span>          - <span>delay</span>:
</span></span><span><span>              <span>hours</span>: <span>0</span>
</span></span><span><span>              <span>minutes</span>: <span>14</span>
</span></span><span><span>              <span>seconds</span>: <span>0</span>
</span></span><span><span>              <span>milliseconds</span>: <span>0</span>
</span></span><span><span>          - <span>repeat</span>:
</span></span><span><span>              <span>count</span>: <span>15</span>
</span></span><span><span>              <span>sequence</span>:
</span></span><span><span>                - <span>data</span>: {}
</span></span><span><span>                  <span>target</span>:
</span></span><span><span>                    <span>entity_id</span>: <span>switch.steckdose_nous_zigbee_internetblock</span>
</span></span><span><span>                  <span>action</span>: <span>switch.turn_off</span>
</span></span><span><span>                - <span>delay</span>:
</span></span><span><span>                    <span>hours</span>: <span>0</span>
</span></span><span><span>                    <span>minutes</span>: <span>0</span>
</span></span><span><span>                    <span>seconds</span>: <span>2</span>
</span></span><span><span>                    <span>milliseconds</span>: <span>0</span>
</span></span><span><span>                - <span>data</span>: {}
</span></span><span><span>                  <span>target</span>:
</span></span><span><span>                    <span>entity_id</span>: <span>switch.steckdose_nous_zigbee_internetblock</span>
</span></span><span><span>                  <span>action</span>: <span>switch.turn_on</span>
</span></span><span><span>                - <span>delay</span>:
</span></span><span><span>                    <span>hours</span>: <span>0</span>
</span></span><span><span>                    <span>minutes</span>: <span>0</span>
</span></span><span><span>                    <span>seconds</span>: <span>2</span>
</span></span><span><span>                    <span>milliseconds</span>: <span>0</span>
</span></span><span><span>          - <span>data</span>: {}
</span></span><span><span>            <span>target</span>:
</span></span><span><span>              <span>entity_id</span>: <span>switch.adguard_home_filterung</span>
</span></span><span><span>            <span>action</span>: <span>switch.turn_on</span>
</span></span><span><span>          - <span>data</span>: {}
</span></span><span><span>            <span>target</span>:
</span></span><span><span>              <span>entity_id</span>: <span>switch.steckdose_nous_zigbee_internetblock</span>
</span></span><span><span>            <span>action</span>: <span>switch.turn_off</span>
</span></span><span><span>          - <span>data</span>: {}
</span></span><span><span>            <span>target</span>:
</span></span><span><span>              <span>entity_id</span>: <span>input_boolean.adguard_override_active</span>
</span></span><span><span>            <span>action</span>: <span>input_boolean.turn_off</span>
</span></span><span><span>    <span>default</span>:
</span></span><span><span>      - <span>delay</span>:
</span></span><span><span>          <span>hours</span>: <span>0</span>
</span></span><span><span>          <span>minutes</span>: <span>0</span>
</span></span><span><span>          <span>seconds</span>: <span>2</span>
</span></span><span><span>          <span>milliseconds</span>: <span>0</span>
</span></span><span><span>      - <span>data</span>: {}
</span></span><span><span>        <span>target</span>:
</span></span><span><span>          <span>entity_id</span>: <span>switch.steckdose_nous_zigbee_internetblock</span>
</span></span><span><span>        <span>action</span>: <span>switch.turn_off</span>
</span></span><span><span><span>mode</span>: <span>single</span>
</span></span><span><span><span>variables</span>:
</span></span><span><span>  <span>cooldown_ok</span>: &gt;-<span>
</span></span></span><span><span><span>    {% set last_disable = states(&#39;input_datetime.last_adguard_disable&#39;) %} {% if
</span></span></span><span><span><span>    last_disable != &#39;unavailable&#39; and last_disable != &#39;unknown&#39; %}
</span></span></span><span><span><span>      {% set hours_since = (now().timestamp() - as_timestamp(last_disable)) / 3600 %}
</span></span></span><span><span><span>      {{ hours_since &gt; 1 }}
</span></span></span><span><span><span>    {% else %}
</span></span></span><span><span><span>      {{ true }}
</span></span></span><span><span><span>    {% endif %}</span>
</span></span><span><span>  <span>override_inactive</span>: <span>&#34;{{ is_state(&#39;input_boolean.adguard_override_active&#39;, &#39;off&#39;) }}&#34;</span>
</span></span></code></pre></div><p>So wait, can’t I still just disable wifi to continue the incessant pollution of my feeble brain with cat videos?</p><p>Well, yes. But this helps me exercise moderation, and like with any poison, social media is tolerable in small doses.</p></div></article></div></div></div>
  </body>
</html>
