<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://garden.bradwoods.io/notes/javascript/three-js/animate-a-mesh-on-a-spheres-surface">Original</a>
    <h1>Animate a mesh across a sphere&#39;s surface</h1>
    
    <div id="readability-page-1" class="page"><div><section><div><div><p><img alt="Sphere with a mesh travelling on its surface" fetchpriority="high" width="300" height="300" decoding="async" data-nimg="1" srcset="/_next/image?url=%2Fimages%2Fpopular%2FanimateAMeshOnASphereSurface.webp&amp;w=384&amp;q=75 1x, /_next/image?url=%2Fimages%2Fpopular%2FanimateAMeshOnASphereSurface.webp&amp;w=640&amp;q=75 2x" src="https://garden.bradwoods.io/_next/image?url=%2Fimages%2Fpopular%2FanimateAMeshOnASphereSurface.webp&amp;w=640&amp;q=75"/></p></div><section><p><span><span>Planted: </span><span><time datetime="2025-06-01T00:00:00.000Z">Jun 2025</time></span></span></p><p><span><span>Status: </span></span><a tabindex="0" href="https://garden.bradwoods.io/about#aboutthisgarden"><span><span><span>seed</span></span></span></a></p><p aria-hidden="true"><span><span>Planted<!-- -->: </span><span><time datetime="2025-06-01T00:00:00.000Z">Jun 2025</time></span></span></p><p><span><span>Hits: </span><span>640</span></span></p><p><span><span>Intended Audience: </span><span>Creative coders, Front-end developers</span></span></p><p><span><span>Tech: </span><span>three.js, GSAP</span></span></p></section><p><span>How to animate a mesh across the surface of a sphere using three.js and GSAP.</span></p><section></section></div></section>
<section><div><h2><span><span>Point on a sphere</span></span></h2><section></section><p><span>We first need to define two positions on the surface to animate between.
A convenient way to do this is by using longitude and latitude as a coordinate system.
These values act as an intuitive UI (user interface) for selecting any point on the sphere.
We can then convert them to 3D coordinates using <code>latLongToVector3</code>.</span></p><!--$--><section><div><pre><p><span><span>function</span><span> </span><span>latLongToVector3</span><span>(</span><span>{</span><span></span></span></p><p><span><span>  latitude</span><span>,</span><span></span></span></p><p><span><span>  longitude</span><span>,</span><span></span></span></p><p><span><span>  center </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Vector3</span><span>(</span><span>...</span><span>config</span><span>.</span><span>meshes</span><span>.</span><span>sphere</span><span>.</span><span>position</span><span>)</span><span>,</span><span></span></span></p><p><span><span>  radius </span><span>=</span><span> config</span><span>.</span><span>meshes</span><span>.</span><span>sphere</span><span>.</span><span>radius</span><span></span></span></p><p><span><span></span><span>}</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>  </span><span>const</span><span> </span><span>{</span><span> sin</span><span>,</span><span> cos</span><span>,</span><span> </span><span>PI</span><span> </span><span>}</span><span> </span><span>=</span><span> </span><span>Math</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> phi </span><span>=</span><span> </span><span>(</span><span>90</span><span> </span><span>-</span><span> latitude</span><span>)</span><span> </span><span>*</span><span> </span><span>(</span><span>PI</span><span> </span><span>/</span><span> </span><span>180</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> theta </span><span>=</span><span> </span><span>(</span><span>longitude </span><span>+</span><span> </span><span>180</span><span>)</span><span> </span><span>*</span><span> </span><span>(</span><span>PI</span><span> </span><span>/</span><span> </span><span>180</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> x </span><span>=</span><span> </span><span>-</span><span>radius </span><span>*</span><span> </span><span>sin</span><span>(</span><span>phi</span><span>)</span><span> </span><span>*</span><span> </span><span>cos</span><span>(</span><span>theta</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> y </span><span>=</span><span> radius </span><span>*</span><span> </span><span>cos</span><span>(</span><span>phi</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> z </span><span>=</span><span> radius </span><span>*</span><span> </span><span>sin</span><span>(</span><span>phi</span><span>)</span><span> </span><span>*</span><span> </span><span>sin</span><span>(</span><span>theta</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>return</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Vector3</span><span>(</span><span>x</span><span>,</span><span> y</span><span>,</span><span> z</span><span>)</span><span>.</span><span>add</span><span>(</span><span>center</span><span>)</span><span>;</span><span></span></span></p><p><span><span></span><span>}</span><span></span></span></p><p><span><span></span><span>function</span><span> </span><span>moveMarker</span><span>(</span><span>{</span><span> marker</span><span>,</span><span> latitude</span><span>,</span><span> longitude </span><span>}</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>  </span><span>const</span><span> pos </span><span>=</span><span> </span><span>latLongToVector3</span><span>(</span><span>{</span><span> latitude</span><span>,</span><span> longitude </span><span>}</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  marker</span><span>.</span><span>position</span><span>.</span><span>copy</span><span>(</span><span>pos</span><span>)</span><span>;</span><span></span></span></p><p><span><span></span><span>}</span></span></p></pre></div></section><!--/$--></div></section>
<section><div><h2><span><span>Path</span></span></h2><section></section><p><span>Next we need to create a path between the two positions.
This is done by calculating a series of points between them, using <code>calcPathPoints</code>.
I&#39;m rendering a line (using <code>createPath</code>) only for visualizing purposes — the animation will only require the points.</span></p><!--$--><section><div><pre><p><span><span></span><span>function</span><span> </span><span>calcPathPoints</span><span>(</span><span>{</span><span></span></span></p><p><span><span>  start</span><span>,</span><span></span></span></p><p><span><span>  end</span><span>,</span><span></span></span></p><p><span><span>  center </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Vector3</span><span>(</span><span>...</span><span>config</span><span>.</span><span>meshes</span><span>.</span><span>sphere</span><span>.</span><span>position</span><span>)</span><span>,</span><span></span></span></p><p><span><span>  radius </span><span>=</span><span> config</span><span>.</span><span>meshes</span><span>.</span><span>sphere</span><span>.</span><span>radius</span><span>,</span><span></span></span></p><p><span><span>  segments </span><span>=</span><span> </span><span>64</span><span></span></span></p><p><span><span></span><span>}</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>  </span><span>const</span><span> points </span><span>=</span><span> </span><span>[</span><span>]</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> startLocal </span><span>=</span><span> start</span><span>.</span><span>clone</span><span>(</span><span>)</span><span>.</span><span>sub</span><span>(</span><span>center</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> endLocal </span><span>=</span><span> end</span><span>.</span><span>clone</span><span>(</span><span>)</span><span>.</span><span>sub</span><span>(</span><span>center</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> startNorm </span><span>=</span><span> startLocal</span><span>.</span><span>normalize</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> endNorm </span><span>=</span><span> endLocal</span><span>.</span><span>normalize</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> quaternion </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Quaternion</span><span>(</span><span>)</span><span>.</span><span>setFromUnitVectors</span><span>(</span><span></span></span></p><p><span><span>    startNorm</span><span>,</span><span></span></span></p><p><span><span>    endNorm</span></span></p><p><span><span>  </span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>for</span><span> </span><span>(</span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>;</span><span> i </span><span>&lt;=</span><span> segments</span><span>;</span><span> i</span><span>++</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>    </span><span>const</span><span> t </span><span>=</span><span> i </span><span>/</span><span> segments</span><span>;</span><span></span></span></p><p><span><span>    </span><span>const</span><span> stepQuat </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Quaternion</span><span>(</span><span>)</span><span>.</span><span>slerpQuaternions</span><span>(</span><span></span></span></p><p><span><span>      </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Quaternion</span><span>(</span><span>)</span><span>,</span><span> </span><span></span></span></p><p><span><span>      quaternion</span><span>,</span><span>             </span><span></span></span></p><p><span><span>      t                       </span><span></span></span></p><p><span><span>    </span><span>)</span><span>;</span><span></span></span></p><p><span><span>    </span><span>const</span><span> pointLocal </span><span>=</span><span> startNorm</span></span></p><p><span><span>      </span><span>.</span><span>clone</span><span>(</span><span>)</span><span></span></span></p><p><span><span>      </span><span>.</span><span>applyQuaternion</span><span>(</span><span>stepQuat</span><span>)</span><span></span></span></p><p><span><span>      </span><span>.</span><span>multiplyScalar</span><span>(</span><span>radius</span><span>)</span><span>;</span><span></span></span></p><p><span><span>    </span><span>const</span><span> pointWorld </span><span>=</span><span> pointLocal</span><span>.</span><span>add</span><span>(</span><span>center</span><span>)</span><span>;</span><span></span></span></p><p><span><span>    points</span><span>.</span><span>push</span><span>(</span><span>pointWorld</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>}</span><span></span></span></p><p><span><span>  </span><span>return</span><span> points</span><span>;</span><span></span></span></p><p><span><span></span><span>}</span><span></span></span></p><p><span><span></span><span>function</span><span> </span><span>createPath</span><span>(</span><span>{</span><span> start</span><span>,</span><span> end </span><span>}</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>  </span><span>const</span><span> </span><span>{</span><span> width</span><span>,</span><span> color </span><span>}</span><span> </span><span>=</span><span> config</span><span>.</span><span>meshes</span><span>.</span><span>path</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> points </span><span>=</span><span> </span><span>calcPathPoints</span><span>(</span><span>{</span><span> start</span><span>,</span><span> end </span><span>}</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> mesh </span><span>=</span><span> </span><span>new</span><span> </span><span>Line2</span><span>(</span><span></span></span></p><p><span><span>    </span><span>new</span><span> </span><span>LineGeometry</span><span>(</span><span>)</span><span>.</span><span>setFromPoints</span><span>(</span><span>points</span><span>)</span><span>,</span><span></span></span></p><p><span><span>    </span><span>new</span><span> </span><span>LineMaterial</span><span>(</span><span>{</span><span></span></span></p><p><span><span>      color</span><span>,</span><span></span></span></p><p><span><span>      </span><span>linewidth</span><span>:</span><span> width</span><span>,</span><span> </span><span></span></span></p><p><span><span>      </span><span>resolution</span><span>:</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Vector2</span><span>(</span><span></span></span></p><p><span><span>        config</span><span>.</span><span>viewport</span><span>.</span><span>width</span><span>,</span><span></span></span></p><p><span><span>        config</span><span>.</span><span>viewport</span><span>.</span><span>height</span><span></span></span></p><p><span><span>      </span><span>)</span><span>,</span><span></span></span></p><p><span><span>      </span><span>dashed</span><span>:</span><span> </span><span>false</span><span></span></span></p><p><span><span>    </span><span>}</span><span>)</span><span></span></span></p><p><span><span>  </span><span>)</span><span>;</span><span></span></span></p><p><span><span>  mesh</span><span>.</span><span>computeLineDistances</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>return</span><span> mesh</span><span>;</span><span></span></span></p><p><span><span></span><span>}</span></span></p></pre></div></section><!--/$--></div></section>
<section><div><h2><span><span>Animate</span></span></h2><section></section><p><span>Finally we add a mesh, called <code>box</code>, that travels along surface.
It&#39;s animated by first creating a spline using our path points.
A spline is a smooth curve that passes through or near a set of points.</span></p><p><span>Next, we use GSAP to interpolate (gradually change) a value, <code>t</code>, from <code>0</code> to <code>1</code>.
<code>t</code> represents the animation&#39;s progress and what point on the spline <code>box</code> should be positioned at:</span></p><ul><li><span><span><span>▪</span> <code>t=0</code>: start of animation and the first point on the spline.</span></span></li><li><span><span><span>▪</span> <code>t=0.5</code>: middle of animation and the middle point on the spline.</span></span></li><li><span><span><span>▪</span> <code>t=1</code>: end of animation and the last point on the spline.</span></span></li></ul><!--$--><section><div><pre><p><span><span>function</span><span> </span><span>animateMeshAlongPath</span><span>(</span><span>{</span><span> mesh</span><span>,</span><span> path</span><span>,</span><span> points </span><span>}</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>  </span><span>const</span><span> spline </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>CatmullRomCurve3</span><span>(</span><span>points</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> tweenTarget </span><span>=</span><span> </span><span>{</span><span> </span><span>t</span><span>:</span><span> </span><span>0</span><span> </span><span>}</span><span>;</span><span></span></span></p><p><span><span>  gsap</span><span>.</span><span>to</span><span>(</span><span>tweenTarget</span><span>,</span><span> </span><span>{</span><span></span></span></p><p><span><span>    </span><span>t</span><span>:</span><span> </span><span>1</span><span>,</span><span></span></span></p><p><span><span>    </span><span>duration</span><span>:</span><span> </span><span>5</span><span>,</span><span></span></span></p><p><span><span>    </span><span>ease</span><span>:</span><span> </span><span>&#34;power1.inOut&#34;</span><span>,</span><span></span></span></p><p><span><span>    </span><span>onUpdate</span><span>:</span><span> </span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span></span></p><p><span><span>      </span><span>const</span><span> t </span><span>=</span><span> tweenTarget</span><span>.</span><span>t</span><span>;</span><span></span></span></p><p><span><span>      </span><span>const</span><span> point </span><span>=</span><span> spline</span><span>.</span><span>getPoint</span><span>(</span><span>t</span><span>)</span><span>;</span><span></span></span></p><p><span><span>      </span><span>const</span><span> quaternion </span><span>=</span><span> </span><span>calcMeshQuaterionAlongPath</span><span>(</span><span>{</span><span> spline</span><span>,</span><span> point</span><span>,</span><span> t </span><span>}</span><span>)</span><span>;</span><span></span></span></p><p><span><span>      mesh</span><span>.</span><span>position</span><span>.</span><span>copy</span><span>(</span><span>point</span><span>)</span><span>;</span><span></span></span></p><p><span><span>      </span><span>if</span><span> </span><span>(</span><span>config</span><span>.</span><span>gui</span><span>.</span><span>orientateBox</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>        mesh</span><span>.</span><span>quaternion</span><span>.</span><span>copy</span><span>(</span><span>quaternion</span><span>)</span><span>;</span><span></span></span></p><p><span><span>      </span><span>}</span><span></span></span></p><p><span><span>    </span><span>}</span><span>,</span><span></span></span></p><p><span><span>    </span><span>repeat</span><span>:</span><span> </span><span>-</span><span>1</span><span>,</span><span></span></span></p><p><span><span>    </span><span>yoyo</span><span>:</span><span> </span><span>true</span><span></span></span></p><p><span><span>  </span><span>}</span><span>)</span><span>;</span><span></span></span></p><p><span><span></span><span>}</span></span></p></pre></div></section><!--/$--><h3><span><span>Geometry origin</span></span></h3><p><span>By default, a mesh&#39;s origin (pivot point) is at (<code>0, 0, 0</code>) in local space, which is usually the center of its geometry.
As a result, when <code>box</code> moves along the path, it passes through the surface of the sphere instead of resting on top of it.
To fix this, we shift <code>box&#39;s</code> geometry up so the bottom aligns with the mesh&#39;s local <code>y = 0</code> position.</span></p><!--$--><section><div><pre><p><span><span>function</span><span> </span><span>setOriginYBottom</span><span>(</span><span>geometry</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>  geometry</span><span>.</span><span>computeBoundingBox</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> yOffset </span><span>=</span><span> </span><span>-</span><span>geometry</span><span>.</span><span>boundingBox</span><span>.</span><span>min</span><span>.</span><span>y</span><span>;</span><span></span></span></p><p><span><span>  geometry</span><span>.</span><span>translate</span><span>(</span><span>0</span><span>,</span><span> yOffset</span><span>,</span><span> </span><span>0</span><span>)</span><span>;</span><span></span></span></p><p><span><span></span><span>}</span></span></p></pre></div></section><!--/$--><h3><span><span>Mesh rotation</span></span></h3><p><span>Another thing we need to do is rotate the mesh so it:</span></p><ul><li><span><span><span>▪</span> <!-- -->faces forward along the spline (make the +Z axis point in the direction of movement) and</span></span></li><li><span><span><span>▪</span> <!-- -->sits upright on the surface of the sphere (make the +Y axis points away from the sphere&#39;s center).</span></span></li></ul><p><span>We do this by calling <code>calcMeshQuaterionAlongPath</code> everytime the mesh moves to a new position.</span></p><!--$--><section><div><pre><p><span><span>function</span><span> </span><span>calcMeshQuaterionAlongPath</span><span>(</span><span>{</span><span></span></span></p><p><span><span>  spline</span><span>,</span><span></span></span></p><p><span><span>  point</span><span>,</span><span></span></span></p><p><span><span>  t</span><span>,</span><span></span></span></p><p><span><span>  sphereCenter </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Vector3</span><span>(</span><span>...</span><span>config</span><span>.</span><span>meshes</span><span>.</span><span>sphere</span><span>.</span><span>position</span><span>)</span><span></span></span></p><p><span><span></span><span>}</span><span>)</span><span> </span><span>{</span><span></span></span></p><p><span><span>  </span><span>const</span><span> forward </span><span>=</span><span> spline</span><span>.</span><span>getTangent</span><span>(</span><span>t</span><span>)</span><span>.</span><span>normalize</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> up </span><span>=</span><span> point</span><span>.</span><span>clone</span><span>(</span><span>)</span><span>.</span><span>sub</span><span>(</span><span>sphereCenter</span><span>)</span><span>.</span><span>normalize</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> right </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Vector3</span><span>(</span><span>)</span><span>.</span><span>crossVectors</span><span>(</span><span>up</span><span>,</span><span> forward</span><span>)</span><span>.</span><span>normalize</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> correctedForward </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Vector3</span><span>(</span><span>)</span><span></span></span></p><p><span><span>    </span><span>.</span><span>crossVectors</span><span>(</span><span>right</span><span>,</span><span> up</span><span>)</span><span></span></span></p><p><span><span>    </span><span>.</span><span>normalize</span><span>(</span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>const</span><span> rotationMatrix </span><span>=</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Matrix4</span><span>(</span><span>)</span><span>.</span><span>makeBasis</span><span>(</span><span></span></span></p><p><span><span>    right</span><span>,</span><span>           </span><span></span></span></p><p><span><span>    up</span><span>,</span><span>              </span><span></span></span></p><p><span><span>    correctedForward </span><span></span></span></p><p><span><span>  </span><span>)</span><span>;</span><span></span></span></p><p><span><span>  </span><span>return</span><span> </span><span>new</span><span> </span><span>THREE</span><span>.</span><span>Quaternion</span><span>(</span><span>)</span><span>.</span><span>setFromRotationMatrix</span><span>(</span><span>rotationMatrix</span><span>)</span><span>;</span><span></span></span></p><p><span><span></span><span>}</span></span></p></pre></div></section><!--/$--></div></section><section><div><h2><span><span>Feedback</span></span></h2><p><span>Have any feedback about this note or just want to comment on the state of the economy?</span></p></div></section><section><div><div><h2><span><span>Where to next?</span></span></h2><div><div><svg preserveAspectRatio="none" viewBox="0 0 18 26" style="width:18px;height:100%;flex-shrink:0"><line x1="1" y1="0" x2="1" y2="26"></line></svg><div><div><svg viewBox="0 0 24 24" width="18px" height="18px"><title>Arrow pointing down</title><path d="M12,23.36L2.94,15h5.56V1h7V15h5.56l-9.06,8.36Zm-3.94-6.36l3.94,3.64,3.94-3.64h-2.44V3h-3v14h-2.44Z" vector-effect="non-scaling-stroke"></path></svg><p><span><span><span>YOU ARE HERE</span></span></span></p></div></div></div><p><img alt="A Johnny Cab pilot" loading="lazy" width="240" height="296" decoding="async" data-nimg="1" srcset="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2FjohnnyCab.0b8d1185.webp&amp;w=256&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2FjohnnyCab.0b8d1185.webp&amp;w=640&amp;q=75 2x" src="https://garden.bradwoods.io/_next/image?url=%2F_next%2Fstatic%2Fmedia%2FjohnnyCab.0b8d1185.webp&amp;w=640&amp;q=75"/></p></div></div></div></section><section></section></div></div>
  </body>
</html>
