<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.ory.dev/oauth2-openid-connect-do-you-need-use-cases-examples/">Original</a>
    <h1>When is OAuth2 and Open ID Connect Useful?</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><p><strong>You probably do not need OAuth2, nor OpenID Connect.</strong> This is a controversial
opinion, even more so because <a href="https://github.com/aeneasr">my biggest</a>
professional achievements are two of the most successful open source projects in
the OAuth2 and OpenID Connect world:</p><ul><li><a href="https://github.com/ory/hydra">Ory Hydra</a> (started in 2015)</li><li><a href="https://github.com/ory/fosite">Ory Fosite</a> (started in 2016)</li></ul><p>Those two projects helped spawn a company that raised series A and an open
source ecosystem used by millions.</p><p><small>The OAuth2 Flow, animated (<a href="https://dev.to/hem/oauth-2-0-flows-explained-in-gifs-2o7a">Source</a>).</small></p><p>Before reading on please note that the views stated in this article are <strong>my
professional opinion</strong>. My intention is to save you valuable time developing the
wrong things at the wrong time. It is in no way meant to discredit the
technology and the brilliant people working on them.</p><p>While writing and maintaining Ory Hydra and Ory Fosite I&#39;ve spent a good portion
of my life working with a large developer community and understanding all the
use cases and problems that users encounter when dealing with authentication and
authorization. As a company, we also help others audit and vet their systems. As
such we often see OAuth 2 and OIDC used in the wrong context. This doesn&#39;t
happen because people make mistakes or don&#39;t &#34;get&#34; security. It happens because
the protocols are complex and often quite vague. When used in the wrong
context - which often is the case - it can lead to serious security
vulnerabilities. So far we&#39;ve identified over 12 cases where incorrect
implementation of OAuth2 and OpenID Connect was responsible for low-severity
security issues (e.g. logout not properly invalidating sessions) as well as
catastrophic vulnerabilities (such as account hijacking with full administrative
privilege escalation). The scary part is that it can happen to any company of
any size - regardless of how talented their developers are!</p><blockquote><p>If the only tool you have is a hammer, you tend to see every problem as a
nail. - &#34;Maslow’s Hammer&#34;</p></blockquote><p>At Ory, we don&#39;t sell OAuth2 and OpenID Connect as the &#34;holy grail&#34; solution.
While the two are very powerful protocols when used correctly, and have many
advantages and use cases, the truth is that they are not always necessary. In
fact, you most likely do not need them. Before we continue, be aware that there
are two primary use cases where you are implementing OAuth2 / OpenID Connect and
that this article only covers one of them:</p><ol><li>Being a consumer of OAuth2 / OpenID Connect: you implement &#34;Sign in with
Google,&#34; need access to a user&#39;s GitHub account and other use cases. Here,
OAuth2 makes a ton of sense. This article does not cover this use case.</li><li>Being a provider of OAuth2 / OpenID Connect: You want to become the system
that issues OAuth2 Access Tokens, OpenID Connect ID Tokens, etc. This article
is for you!</li></ol><p>Now that we&#39;ve set the scene, let&#39;s look at the structure of this article.
Similar to OAuth2 and OpenID Connect (and accompanying RFC8252, RFC6819,
RFC7636, RFC8628, RFC 7523, OpenID Connect Discovery, OpenID Connect Session
Management, OpenID Connect Front-/Backchannel Logout, ...) this article is
lengthy because OAuth2 and OpenID Connect span a variety of specifications and
regularly spawn new, innovative ones.</p><p>Let&#39;s look at the main points covered in this article.</p><ol><li>A tl;dr decision tree to help you choose whether you need OAuth2 or not.</li><li>When are OAuth2 and OpenID Connect useful and what are their problems?</li><li>What misconceptions do developers have about OAuth2 and OpenID Connect?</li><li>When should you avoid OAuth2 and OpenID Connect?</li></ol><p>Before we dive deeper, I want to stress two points:</p><ol><li>We have the utmost respect for the amount of innovation spawned by
researchers and contributors in the area of OAuth2 and OpenID Connect. This
article does not try to diminish their impressive work. Rather, we intend to
shift the mindset of small and medium-sized teams from &#34;we need this complex
security thing&#34; to &#34;we can solve this complex thing at a later stage and use
something really simple for now!&#34;</li><li>Ory is developing an open-source identity infrastructure service called
<a href="https://github.com/ory/kratos">Ory Kratos</a> which is available
<a href="https://www.ory.sh">as a managed cloud service</a>. This article discusses many
of the reasons that initially motivated us to develop this new system. So
yes, it&#39;s a shameless self-plug. But also: it&#39;s what we believe! There is a
place in the software world for a secure, reliable, scalable and <strong>simple</strong>
solution. Our goal at Ory is to develop an open standard, with the help of a
brilliant community. We want something that works for 80% of use cases.</li></ol><h2 id="do-you-need-oauth2-or-openid-connect"><a href="#do-you-need-oauth2-or-openid-connect" aria-label="do you need oauth2 or openid connect permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Do You Need OAuth2 or OpenID Connect?</h2><p>Let&#39;s agree that it&#39;s generally an excellent idea to use an existing piece of
software to solve login, registration, user management, password, reset, account
recovery, 2FA, and all topics related to user authentication and permission
management (authorization). Today most technologies rely on OAuth2 as the
primary interaction protocol. And as we will learn in this article, it is most
often too complex with too many edge cases.</p><p>But that doesn&#39;t mean that there isn&#39;t a better way to solve these problems!
Ory&#39;s attempt at building a better identity authentication de-facto open
standard is the <a href="https://github.com/ory/kratos">Ory Kratos Open Source project</a>!</p><p>A generic decision tree to help you decide whether you need OAuth2 or not can be
summarized as follows:</p><p>Since you&#39;re reading this on the Ory website and we believe in the products we
build, you will find those prominently in the above graph. For comparable
products we have collected the following <strong>open source</strong> ones:</p><ol><li>If you need both an identity platform, implying that you most likely need to
migrate your user data as well, and an OAuth2 &amp; OpenID Connect service and
want to use OAuth2 / OpenID Connect for everything, check out
<a href="https://www.keycloak.org">RedHat&#39;s Keycloak</a>. KeyCloak is as if you were to
use Ory&#39;s Identity Platform and Ory&#39;s OAuth2 / OpenID Connect platform
together, while only using OAuth2 &amp; OpenID Connect to &#34;authenticate&#34;.</li><li>If you only need an identity platform without OAuth2 there are a few
alternatives to Ory&#39;s Identity Platform /
<a href="https://github.com/ory/kratos">Ory Kratos</a>:<ol><li>Language-specific libraries such as
<a href="https://github.com/volatiletech/authboss">authboss</a> with the up- and
downsides language-specific libraries have.</li><li><del><a href="https://supertokens.io">Supertokens</a></del> - we no longer endorse them due
to a questionable choice of mixing OAuth2 terminology with self-built
protocols. In particular, the use of OpenID terminology without supporting
the specification itself, and the use of &#34;access&#34; and &#34;refresh tokens&#34; in
incorrect contexts. We believe this to be what
<a href="https://www.scottbrady91.com/blockchain-identity/technical-review-of-civics-secure-identity-platform">Scott Brady calls MyOwnOAuth™</a>.</li></ol></li></ol><h2 id="when-is-oauth2--open-id-connect-useful"><a href="#when-is-oauth2--open-id-connect-useful" aria-label="when is oauth2  open id connect useful permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When is OAuth2 &amp; Open ID Connect Useful?</h2><p>OAuth2 states its primary use case in the first section (abstract) of its
<a href="https://datatracker.ietf.org/doc/html/rfc6749">RFC</a>:</p><blockquote><p>The OAuth 2.0 authorization framework enables a <strong>third-party application</strong> to
obtain <strong>limited access</strong> to an HTTP service, either <strong>on behalf of a resource
owner</strong> by orchestrating an <strong>approval interaction between the resource
owner</strong> and the HTTP service, or by allowing the <strong>third-party application</strong>
to obtain access on its own behalf.</p></blockquote><p>OAuth 2 was invented to address a need in the era of Web 2.0. Platforms such as
Google and Facebook have massive troves of data and they wanted to open this
data up to third parties. This was sometimes used benevolently (e.g. Facebook
Games) and sometimes abused (e.g.
<a href="https://en.wikipedia.org/wiki/Facebook%E2%80%93Cambridge_Analytica_data_scandal">Cambridge Analytica Scandal</a>).</p><p>Furthermore in 2012, &#34;Social Login&#34; was
<a href="https://www.forbes.com/sites/forbesleadershipforum/2012/02/28/how-social-login-is-changing-business-and-your-privacy/">all the craze.</a>
(And still is!)</p><p>OAuth2 and OpenID Connect were born to solve these two fundamental use cases:</p><ol><li>Allow third parties access to your e.g. Facebook data (OAuth2).</li><li>Allow third parties to authenticate you via your e.g. Facebook account
(OpenID Connect).</li></ol><h3 id="why-oauth2-is-not-authentication-to-the-third-party-but-openid-connect-is"><a href="#why-oauth2-is-not-authentication-to-the-third-party-but-openid-connect-is" aria-label="why oauth2 is not authentication to the third party but openid connect is permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why OAuth2 is not Authentication to the Third Party but OpenID Connect is</h3><p>If you are new to OAuth2, it might be confusing why you need OpenID Connect. The
two are interlinked yet different. The main distinguishing factor is the
audience of the resulting tokens:</p><ol><li>OAuth2&#39;s tokens (OAuth2 Access Token) have the first party server as their
target audience.</li><li>OpenID Connect&#39;s tokens (ID Token) have the third party client as their
target audience.</li></ol><blockquote><p><a href="https://www.scottbrady91.com/oauth/oauth-is-not-authentication">OAuth2 is not Authentication</a>.
Access tokens are not sessions.</p></blockquote><p>OpenID Connect was invented, or added on top of, OAuth2 because OAuth2&#39;s tokens
are opaque - not transparent - to the third party clients who receive them. They
serve no purpose except for presenting them to the first-party server (e.g.
GitHub) and expecting a response (e.g. the user&#39;s private repositories).</p><p><strong><a href="https://oauth.net/articles/authentication/">OAuth2 is not an authentication (login) protocol</a></strong>!
The purpose of OAuth2 Tokens is to authorize requests at a first party server
(or API). If the third party uses the OAuth2 Access Token as proof of
authentication, an attacker could easily impersonate a legitimate user.</p><ol><li>Bob creates app &#34;myphotobook&#34; which offers &#34;Sign in with Facebook.&#34; It
accepts access tokens as proof of authentication at
<code>https://myphotobook.com/login?access_token=&lt;facebook_token&gt;</code>.</li><li>Eve creates app &#34;myevilapp,&#34; also offering &#34;Sign in with Facebook&#34;</li><li>If Alice uses both apps, Eve can use Alice&#39;s access token from &#34;myevilapp&#34; to
impersonate her at Bob&#39;s app by calling, for example,
<code>https://myphotobook.com/login?access_token=&lt;alices_myevilapp_facebook_token&gt;</code>.</li></ol><p>There are ways to prevent this attack using standard OAuth2 mechanisms. Ensuring
that the access token was initiated by &#34;myphotobook&#34; is an effective mitigation.
But it requires in-depth knowledge of the protocols involved and it is implicit.
In security, we really don&#39;t like implicit.</p><p>OpenID Connect addresses this by introducing a new type of token, along with
additional configuration parameters, which can then be used by the third party
to reliably and securely authenticate users. That is why OpenID Connect ID
Tokens are transparent - usable - to the third party clients; it&#39;s because they
are JSON Web Tokens that can be decoded. Additionally, ID Tokens contain the
audience - in this case the third party, not the first party. That way,
&#34;myphotobook&#34; can check whether the audience is &#34;myphotobook&#34; and not
&#34;myevilapp&#34;:</p><div data-language="json5"><pre><code>
<span>{</span>
  <span>iss</span><span>:</span> <span>&#39;https://myphotobook.com&#39;</span><span>,</span>
  <span>sub</span><span>:</span> <span>&#39;alice&#39;</span><span>,</span>
  
  <span>aud</span><span>:</span> <span>[</span><span>&#39;myphotobook&#39;</span><span>]</span><span>,</span>
  
  <span>aud</span><span>:</span> <span>[</span><span>&#39;myevilapp&#39;</span><span>]</span><span>,</span>
  <span>exp</span><span>:</span> <span>1516239022</span><span>,</span>
  <span>iat</span><span>:</span> <span>1516239022</span>
<span>}</span></code></pre></div><h3 id="third-party-third-party-third-party"><a href="#third-party-third-party-third-party" aria-label="third party third party third party permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Third Party, Third Party, Third Party!</h3><p>By now you&#39;ve read &#34;third party&#34; quite often. And that is the catch! These
protocols are targeted at third party integration. Meaning that someone else is
trying to access your user&#39;s data. And someone else is trying to authenticate
their users using your data!</p><p>Your first point of decision is exactly this. Are you building a system that
interacts with third parties, such as partner networks and platform APIs? Or are
you yourself becoming the next &#34;Sign in with ...&#34;? If so, OAuth2 and OpenID
Connect are the best-in-class protocols to address your use case!</p><h2 id="avoid-oauth2--openid-connect-for-first-party-applications-with-exceptions"><a href="#avoid-oauth2--openid-connect-for-first-party-applications-with-exceptions" aria-label="avoid oauth2  openid connect for first party applications with exceptions permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Avoid OAuth2 / OpenID Connect for First Party Applications (With Exceptions)</h2><p>Regardless of whether you are building a mobile app, single page app, web app,
native app, an API system, or you need Bearer Tokens or JSON Web Tokens. You
most likely do not need the complexity of OAuth2 and OpenID Connect right now.
What you most likely need is a system that offers a variety of methods to
authenticate users (password, passwordless, FIDO2, biometrics, SMS, ...), has
profile management, account recovery, password reset, email and phone number
verification, and so on.</p><blockquote><p>You can always add OAuth2 and OpenID Connect on top of your existing
authentication infrastructure using tools such as
<a href="https://github.com/ory/hydra">Ory Hydra</a>.</p></blockquote><h3 id="exceptions"><a href="#exceptions" aria-label="exceptions permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exceptions</h3><p>There are, of course, exceptions to the rule. In some cases it makes sense to
start with OAuth2 and OpenID Connect right away. This can be the case for huge
businesses such as Apple or Amazon that have hundreds of thousands of employees
across hundreds of teams, organizations and offices. In these cases, office A
(Google Mail) might not trust office B (Google Earth) to access data without
user consent. Large organizations can afford the extra cost of training,
implementation, testing, and maintenance of complex systems. But even then -
sign in to your Google profile and you will not find OAuth2 or OpenID Connect
but instead a regular login flow: Post the HTML form to a server, receive a
cookie!</p><p><span>
      <a href="https://www.ory.dev/static/1a2cb23f36f6c24e5e2a144442c9420e/8201f/google-noidc.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/1a2cb23f36f6c24e5e2a144442c9420e/4bbe2/google-noidc.webp 215w,/static/1a2cb23f36f6c24e5e2a144442c9420e/866c5/google-noidc.webp 430w,/static/1a2cb23f36f6c24e5e2a144442c9420e/31b17/google-noidc.webp 860w,/static/1a2cb23f36f6c24e5e2a144442c9420e/e027f/google-noidc.webp 1290w,/static/1a2cb23f36f6c24e5e2a144442c9420e/9d85b/google-noidc.webp 1720w,/static/1a2cb23f36f6c24e5e2a144442c9420e/b5a6f/google-noidc.webp 2554w" sizes="(max-width: 860px) 100vw, 860px" type="image/webp"/>
          <source srcset="/static/1a2cb23f36f6c24e5e2a144442c9420e/2eb24/google-noidc.png 215w,/static/1a2cb23f36f6c24e5e2a144442c9420e/05ed2/google-noidc.png 430w,/static/1a2cb23f36f6c24e5e2a144442c9420e/914ae/google-noidc.png 860w,/static/1a2cb23f36f6c24e5e2a144442c9420e/46115/google-noidc.png 1290w,/static/1a2cb23f36f6c24e5e2a144442c9420e/6c86f/google-noidc.png 1720w,/static/1a2cb23f36f6c24e5e2a144442c9420e/8201f/google-noidc.png 2554w" sizes="(max-width: 860px) 100vw, 860px" type="image/png"/>
          <img src="https://d33wubrfki0l68.cloudfront.net/b43768d924ff0e4bfe9148dd5b5535a7b91f44b5/6f8b5/static/1a2cb23f36f6c24e5e2a144442c9420e/914ae/google-noidc.png" alt="Google does not use OpenID Connect" title="Google does not use OpenID Connect" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></p><p><small>Google does not use OAuth2 or OpenID Connect in their login process</small></p><p>A counterexample to this is Amazon which uses OpenID Connect to sign you into
their Amazon store.</p><p><span>
      <a href="https://www.ory.dev/static/43f6e04999becd7d62455355ff3223a5/82747/amazon-oidc.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/43f6e04999becd7d62455355ff3223a5/4bbe2/amazon-oidc.webp 215w,/static/43f6e04999becd7d62455355ff3223a5/866c5/amazon-oidc.webp 430w,/static/43f6e04999becd7d62455355ff3223a5/31b17/amazon-oidc.webp 860w,/static/43f6e04999becd7d62455355ff3223a5/e027f/amazon-oidc.webp 1290w,/static/43f6e04999becd7d62455355ff3223a5/9d85b/amazon-oidc.webp 1720w,/static/43f6e04999becd7d62455355ff3223a5/81416/amazon-oidc.webp 2232w" sizes="(max-width: 860px) 100vw, 860px" type="image/webp"/>
          <source srcset="/static/43f6e04999becd7d62455355ff3223a5/2eb24/amazon-oidc.png 215w,/static/43f6e04999becd7d62455355ff3223a5/05ed2/amazon-oidc.png 430w,/static/43f6e04999becd7d62455355ff3223a5/914ae/amazon-oidc.png 860w,/static/43f6e04999becd7d62455355ff3223a5/46115/amazon-oidc.png 1290w,/static/43f6e04999becd7d62455355ff3223a5/6c86f/amazon-oidc.png 1720w,/static/43f6e04999becd7d62455355ff3223a5/82747/amazon-oidc.png 2232w" sizes="(max-width: 860px) 100vw, 860px" type="image/png"/>
          <img src="https://d33wubrfki0l68.cloudfront.net/ed3f1c53ac20ba16a2f1f27ea4ce997fdc4caca2/229bf/static/43f6e04999becd7d62455355ff3223a5/914ae/amazon-oidc.png" alt="Amazon uses OpenID Connect" title="Amazon uses OpenID Connect" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></p><p><small>Amazon uses OAuth2 / OpenID Connect in their login process</small></p><h4 id="niche-clients"><a href="#niche-clients" aria-label="niche clients permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Niche Clients</h4><p>Another exception is if you plan interaction with a lot of different client
types. This in particular applies to clients that do not have a traditional user
interface (think Fire TV Stick, Chromecast, anything that does not feature a
keyboard/USB port or browser). In this case you can benefit from the work done
by the IETF and OpenID Foundation who have defined interactions for these types
of clients.</p><p>Some examples of niche clients could be:</p><ul><li>SmartTVs because they do not have a keyboard, mouse, or USB port (for e.g.
YubiKeys), making log in and sign up frustrating or impossible</li><li>Command Line Interfaces when they should use your beautiful website and login
forms (with multiple authentication factors) to sign users in</li></ul><h4 id="integration-with-many-other-services"><a href="#integration-with-many-other-services" aria-label="integration with many other services permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integration with Many Other Services</h4><p>Adding OAuth2 and OpenID Connect to your system, where you&#39;re not using it as
the primary authentication system for your own services, is beneficial if you
use other tools and services which should use the central identity platform to
authenticate users.</p><p>Examples of these tools could be:</p><ul><li><a href="https://docs.rocket.chat/guides/administration/misc.-admin-guides/authentication/open-id-connect">Rocket Chat</a>
where users sign up at a service and are able to also enter a chat room by
logging into Rocket Chat using your OpenID Connect server.</li><li>SaaS tools that offer Enterprise SSO plans, like
<a href="https://www.typeform.com/help/a/set-up-sso-authentication-for-your-account-for-enterprise-customers-360060078751/">Typeform</a>.</li><li>Other software products offering SSO via OpenID Connect.</li></ul><p>In these cases you have to weigh whether you want to use one authentication
methodology for first parties and another one (OpenID Connect) for third
parties, or whether you want to use OpenID Connect for both. This decision
depends a lot on context but neither of the two options are more or less
difficult to implement.</p><h4 id="first-and-third-party-at-the-same-time"><a href="#first-and-third-party-at-the-same-time" aria-label="first and third party at the same time permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First and Third Party at the same time</h4><p>An exception to the rule is if you plan to add OAuth2 to your system to service
third parties. In this case you might save some time and effort by using OpenID
Connect and not having to implement two authentication mechanisms.</p><p>The decision here is not clear-cut and depends a lot on context. It can be as
difficult to implement two authentication mechanisms for first and third-party
use as implementing only OAuth2 for first and third-party.</p><h2 id="complexity-and-inherently-insecure-systems"><a href="#complexity-and-inherently-insecure-systems" aria-label="complexity and inherently insecure systems permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Complexity and Inherently Insecure Systems</h2><p>Making things hard to understand and implement never improves security. It makes
systems less secure since there are more things that can (and eventually will)
go wrong. OAuth2 and accompanying specifications are plentiful, difficult to
read and understand, and sometimes vague. When interacting with popular OAuth2
and OpenID Connect providers (Facebook, Google, Amazon, ...) you will observe
that everyone solves things a little differently. GitHub does not offer OpenID
Connect capabilities, Facebook has their own flavor of OpenID Connect, Apple had
to receive an
<a href="https://openid.net/2019/06/27/open-letter-from-the-openid-foundation-to-apple-regarding-sign-in-with-apple/">open letter from the OpenID Foundation</a>
to become compatible, and Auth0 has its own OAuth2 quirks... the list goes on
and on!</p><p>OAuth2 and OpenID Connect have spawned an enormous and exciting amount of
innovation. That said, if you&#39;re a small team or have a very clear use case
(e.g. an app), the amount of reading needed to properly interface and use the
correct OAuth2 methodologies is vast - even if you are only interfacing with
OAuth2 servers and using OAuth2 libraries! Let&#39;s take a look at the most popular
OAuth2 extensions. The list is long, not (only) to make a point, but because
there are so many variations and possibilities:</p><ul><li><a href="https://datatracker.ietf.org/doc/html/rfc7636">Proof Key for Code Exchange by OAuth Public Clients</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a></li><li><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics">OAuth 2.0 Security Best Current Practice</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc9068">JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc8252">OAuth 2.0 for Native Apps</a></li><li><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps">OAuth 2.0 for Browser-Based Apps</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc8628">OAuth 2.0 Device Authorization Grant</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc8414">OAuth 2.0 Authorization Server Metadata</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7591">OAuth 2.0 Dynamic Client Registration Protocol</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7592">OAuth 2.0 Dynamic Client Registration Management Protocol</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc9126">OAuth 2.0 Pushed Authorization Requests</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc8705">OAuth 2.0 Mutual-TLS Client Authentication and Certificate-Bound Access Tokens</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc9101">The OAuth 2.0 Authorization Framework: JWT-Secured Authorization Request (JAR)</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7521">Assertion Framework for OAuth 2.0 Client Authentication and Authorization Grants</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7523">JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7522">Security Assertion Markup Language (SAML) 2.0 Profile for OAuth 2.0 Client Authentication and Authorization Grants</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc6750">The OAuth 2.0 Authorization Framework: Bearer Token Usage</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7636">Proof Key for Code Exchange by OAuth Public Clients</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7009">OAuth 2.0 Token Revokation</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc7662">OAuth 2.0 Token Introspection</a></li><li><a href="https://openid.net/specs/openid-connect-session-1_0.html">OpenID Connect Session Management</a></li><li><a href="https://openid.net/specs/openid-connect-frontchannel-1_0.html">OpenID Connect Front-Channel Logout</a></li><li><a href="https://openid.net/specs/openid-connect-backchannel-1_0.html">OpenID Connect Back-Channel Logout</a></li><li><a href="https://openid.net/specs/openid-connect-federation-1_0.html">OpenID Connect Federation</a></li><li><a href="https://openid.net/wg/sse/">OpenID Connect SSE</a></li><li><a href="https://openid.net/specs/openid-caep-specification-1_0-ID1.html">OpenID Connect CAEP</a></li></ul><p>This list is long, but there is an even longer list of draft and active
development RFCs and specifications. Alongside these more generic specs, there
are also specs for financial institutions (FAPI), governments (iGov), EAP,
MODRNA, and many more.</p><p>So the question remains: do you really need all of this? Or should we simply
solve login and move on until we actually need to address a critical need?</p><h2 id="oauth2-is-difficult-in-some-use-cases"><a href="#oauth2-is-difficult-in-some-use-cases" aria-label="oauth2 is difficult in some use cases permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth2 is Difficult in Some Use Cases</h2><p>If we haven&#39;t convinced you yet, let&#39;s take a look at some more arguments for
avoiding OAuth2 and OpenID Connect. As stated earlier, this is a recommendation
and does not apply to valid use cases. But before you go down the OAuth2 rabbit
hole you should know exactly how far it goes.</p><h3 id="first-party-native-apps"><a href="#first-party-native-apps" aria-label="first party native apps permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First-Party Native Apps</h3><p>User-facing OAuth2 and OpenID Connect flows require the user to interact with a
website in a browser. If you are building native apps you can not circumvent
this and you will need to open the iOS or Android browser. The only way around
this would be to use the disgraced OAuth2 Resource Owner Password Credentials
Grant. But this grant is not available on all platforms, will raise red flags
with security auditors, and is
<a href="https://oauth.net/2.1/">scheduled to be removed from the specification with OAuth 2.1</a>.</p><p>For many first-party apps this is an absolute no-go, because your users will
leave the app to open a browser and sign in, breaking the user experience.
However, some platforms like iOS try to improve this with better UI. Still, many
product owners shy away from this practice.</p><p>If you do want to use OAuth2 for native apps, have a look at our
<a href="https://www.ory.sh/oauth2-for-mobile-app-spa-browser/">OAuth2 for Native Apps guide</a>.</p><h3 id="session-management-i-layers"><a href="#session-management-i-layers" aria-label="session management i layers permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session Management I: Layers</h3><p>Neither OAuth2 nor OpenID Connect are designed to manage sessions. A few years
ago when I was two weeks deep into implementing Auth0, I realized that Auth0 has
<a href="https://auth0.com/docs/users/sessions/session-layers">three different session layers</a>
which all have their own logout mechanisms! That&#39;s not because Auth0 is bad.
It&#39;s because they are using a third-party protocol to solve a first-party
problem! Citing from their
<a href="https://auth0.com/docs/users/sessions/session-layers">session layer documentation</a></p><blockquote><ol><li>Application Session Layer: This layer is the session inside your
application. Though your application uses Auth0 to authenticate users, your
application also tracks that the user has logged in to your application; in
a regular web application, for example, you achieve this by storing this
information inside a cookie.</li><li>Auth0 Session Layer: Auth0 also maintains a session on the Authorization
Server for the user and stores their user information inside a cookie. This
layer is used so that the next time a user is redirected to Auth0 for login
the user&#39;s information will be remembered. This session layer makes the SSO
experience possible for inbound SSO implementations.</li><li>Identity Provider Session Layer: When users attempt to sign in using an
identity provider such as Facebook or Google, and they already have a valid
sign-in (with whichever provider they choose) they will not be prompted
again to sign in though they may be asked to give permission to share their
information with Auth0 and, in turn, your application.</li></ol></blockquote><h3 id="session-management-ii-logout"><a href="#session-management-ii-logout" aria-label="session management ii logout permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session Management II: Logout</h3><p>You probably know <a href="https://circleci.com">CircleCI</a>, it&#39;s a continuous
integration platform that runs tests on your code. Naturally, CircleCI needs
access to your GitHub or GitLab repositories which means it uses GitHub&#39;s /
GitLab&#39;s OAuth2 capabilities.</p><p>The catch is if you signed in to CircleCI via GitHub, and you log out of GitHub.
You will still be signed in to CircleCI! The same applies if you use an app
using &#34;Sign in with {anything really}&#34;. With OAuth2 it does not matter to the
third party what your session status is at the first party!</p><p>At Ory, we get (and answer) this question on a regular basis: <em>&#34;I have
implemented OAuth2 but how do I globally sign out my users?&#34;</em>.
<a href="https://openid.net/specs/openid-connect-backchannel-1_0.html">There</a>
<a href="https://openid.net/specs/openid-connect-frontchannel-1_0.html">is a</a>
<a href="https://openid.net/specs/openid-connect-session-1_0.html">specification</a> for
that! But it could be so much easier.</p><p>To cite from
<a href="https://auth0.com/docs/users/sessions/session-layers#session-logout">Auth0&#39;s logout documentation</a>,
there are three separate logout mechanisms when delegation protocols (OAuth2 /
OpenID Connect) are involved:</p><blockquote><ul><li>Application Session Layer Logout: Logging users out of your applications
typically results in their application session being cleared, and this
should be handled by your application: for the Application Session Layer,
there is nothing within your Auth0 tenant that you need to use to facilitate
session termination. This will require you to utilize whatever application
session stack you are using to clear out any session-related information.
Note that some of the Auth0 SDKs do provide some support for application
sessions; please check the documentation to see if there is any local SDK
session removal that needs to be done.</li><li>Auth0 Session Layer Logout: You can log users out of the Auth0 session layer
by redirecting them to the Auth0 Logout endpoint so Auth0 can clear the SSO
cookie.</li><li>Identity Provider Session Layer Logout: It is not necessary to log the users
out of this session layer, but you can use Auth0 to force the logout if
required.</li></ul></blockquote><h3 id="session-management-iii-storage"><a href="#session-management-iii-storage" aria-label="session management iii storage permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Session Management III: Storage</h3><p>Browsers have three principal ways to persist data on the client:</p><ol><li>Cookies which only can be set by the server (<code>httpOnly</code>).</li><li>Cookies which can be set by the client (JavaScript&#39;s <code>document.cookie</code> -
vulnerable to XSS).</li><li>LocalStorage which can be set by the client (JavaScript&#39;s <code>localStorage</code> -
vulnerable to XSS).</li></ol><p>When receiving an Access, Refresh or ID Token the question is where do you store
these? The natural place would be in the browser&#39;s <code>httpOnly</code> cookie! But many
applications today are client-side and do not have direct access to a web
server. So storing it in a <code>httpOnly</code> cookie might be the most secure variant,
but it is also the most inconvenient one!</p><p>There are several opinions and considerations to be made. We&#39;ve collected a few
of the most interesting discussions for further reading:</p><ol><li><a href="https://stackoverflow.com/questions/44324080/how-to-store-access-token-oauth-2-auth-code-flow/44655679">How to store access token? (Oauth 2, Auth code flow)</a></li><li><a href="https://security.stackexchange.com/questions/72475/should-we-store-accesstoken-in-our-database-for-oauth2">Should we store access token in our database for oauth2?</a></li><li><a href="https://dev.to/cotter/localstorage-vs-cookies-all-you-need-to-know-about-storing-jwt-tokens-securely-in-the-front-end-15id">LocalStorage vs Cookies: All You Need To Know About Storing JWT Tokens Securely in The Front-End</a></li></ol><h3 id="synchronization-and-race-conditions"><a href="#synchronization-and-race-conditions" aria-label="synchronization and race conditions permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Synchronization and Race Conditions</h3><p>OAuth2 has strict security measures in place to mitigate attack vectors. The
most common are &#34;Token Replay&#34; mitigations, in particular for OAuth2 Refresh
Tokens and OAuth2 Authorization Codes. Token Replay mitigation means that if you
use the same Refresh Token, or Authorization Code twice, the request will fail
and <strong>all associated access, refresh, and authorization codes will be
invalidated</strong>. This means that your user has to redo the whole OAuth2 flow from
the beginning!</p><p>And unfortunately this happens quite a lot. It can be a bug in your system, or
it can be two services making a request at the same time with a token that needs
to be refreshed. Preventing these types of race conditions is challenging in
front end applications - you will need a good side effect solution such as
<a href="https://redux-saga.js.org">Redux Saga</a> to ensure that only one API call is
refreshing the token at a time. In distributed systems this becomes even more
difficult!</p><p>Of course there are solutions to this problem as well, such as having a grace
period (e.g. a few seconds) where the refresh token can be reused. Yet it adds
another layer of complexity and potential flakiness to your system. What happens
if your system is under heavy load? Will the racy refresh requests be fast
enough? What happens if things time out? Or if you need to retry? Should you
deactivate token reuse detection completely? But then you might fail the
security audit!</p><p>There are no clear answers to this. It takes time, research, testing, and
iteration to make the right decisions.</p><h3 id="the-human-aspect-scaling-teams"><a href="#the-human-aspect-scaling-teams" aria-label="the human aspect scaling teams permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Human Aspect: Scaling Teams</h3><p>In development we always think about building scalable systems. Yet one of the
most difficult aspects of scaling a software system is the human aspect. Google
invented Golang, a novel programming language to address the problems of scaling
the humans that write the software, because it is as difficult to scale from 10
to 20.000 developers as it is to build a search engine which replies to any
query in less than 50 ms wherever you are on the planet.</p><p>I started Ory a few years back and have since scaled it from a one-man show to a
company of almost 30 people (a comparatively small number). Throughout this,
I&#39;ve witnessed the community grow and struggle with OAuth2 and OpenID Connect
terminology, complexity, and tooling. In hindsight, it&#39;s clear that scaling
development (the human side) with complex protocols is challenging since there
is a high barrier for entry and a steep learning curve. What&#39;s the difference
between a resource server, a resource owner, a third party client, a relying
party, an ID token, the refresh token and the PKCE verifier? All of this has to
be taught and understood by any new team member touching these systems. Sure,
there are tons of resources out there. But which one <strong>applies to your system</strong>?</p><h3 id="first-party-consent"><a href="#first-party-consent" aria-label="first party consent permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First-Party Consent</h3><p>A good question to ask yourself when deciding whether or not you need OAuth2 /
OpenID Connect is whether you want users to see a screen similar to the
following one:</p><p><span>
      <a href="https://www.ory.dev/static/904f478313a09816efd89ee65d0aeab6/ebf47/github-oauth2-prompt.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/904f478313a09816efd89ee65d0aeab6/4bbe2/github-oauth2-prompt.webp 215w,/static/904f478313a09816efd89ee65d0aeab6/866c5/github-oauth2-prompt.webp 430w,/static/904f478313a09816efd89ee65d0aeab6/01c7f/github-oauth2-prompt.webp 688w" sizes="(max-width: 688px) 100vw, 688px" type="image/webp"/>
          <source srcset="/static/904f478313a09816efd89ee65d0aeab6/2eb24/github-oauth2-prompt.png 215w,/static/904f478313a09816efd89ee65d0aeab6/05ed2/github-oauth2-prompt.png 430w,/static/904f478313a09816efd89ee65d0aeab6/ebf47/github-oauth2-prompt.png 688w" sizes="(max-width: 688px) 100vw, 688px" type="image/png"/>
          <img src="https://d33wubrfki0l68.cloudfront.net/3d175d8502343dc78146a37e224248a73aa845be/c0e0c/static/904f478313a09816efd89ee65d0aeab6/ebf47/github-oauth2-prompt.png" alt="GitHub OAuth2 Prompt Screen" title="GitHub OAuth2 Prompt Screen" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></p><p>If the answer is <strong>no</strong>, you do not need OAuth2 / OpenID Connect for user
authentication.</p><h3 id="scopes-are-not-permissions"><a href="#scopes-are-not-permissions" aria-label="scopes are not permissions permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scopes are not Permissions</h3><p>OAuth2 tokens have a scope. The scope is usually something like <code>read:user</code> or
<code>profile:write</code>. The OAuth2 scope does not say what a user can and cannot do.</p><blockquote><p>OAuth is not suitable for user authorization. The fact that you have an access
token that allows you to act on the user’s behalf does not mean that the user
can perform an action.
<a href="https://www.scottbrady91.com/oauth/oauth-is-not-user-authorization"><em>Source</em></a></p></blockquote><p>An access token represents that the client application has been authorized by
the user. It states what a user said (consent!) a third party application can do
in their name. Let&#39;s take a quick look at the OAuth2 flow:</p><ol><li>The client application asks the user if they can access a protected resource
on their behalf (by redirecting the user to the authorization server’s
authorization endpoint, specifying exactly what they would like to access
(scopes)).</li><li>The user identifies themselves to the authorization server (but remember,
OAuth is not authentication; you’ll need OpenID Connect to help you with
that).</li><li>The user authorizes the client application to access the protected resource
on their behalf (using the OAuth consent process).</li><li>The client application is issued an access token.</li></ol><p>For example:</p><ol><li>Alice allows <em>myphotoapp</em> to access her Facebook photos.</li><li>Bob allows <em>mytodolist</em> to access his Google Calendar.</li></ol><p>Let&#39;s make a counterexample:</p><p>If Alice would allow <em>myphotoapp</em> to act as an administrator of the system and
delete the production database, it would not matter unless Alice is actually a
system administrator. Similarly, Alice can not allow myphotoapp access to Bob&#39;s
pictures, because she is not Bob.</p><p>I have lost count of the number of times developers have gotten this wrong. And
again, it is not because people are not skilled. It is because complex protocols
have steep learning curves and ain&#39;t nobody got time to learn everything. As
said before <strong>complexity kills security</strong>.</p><h3 id="specs-and-rfcs-deprecate-like-everything-else-in-technology"><a href="#specs-and-rfcs-deprecate-like-everything-else-in-technology" aria-label="specs and rfcs deprecate like everything else in technology permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Specs and RFCs Deprecate like Everything Else in Technology</h3><p>Specifications are subject to change and deprecation as any other system. RFCs
and specifications are not timeless and do not protect against breaking changes,
upgrading systems, changing configurations, or deprecating specific flows. Here
are some examples of deprecated specifications:</p><ul><li><a href="https://oauth.net/2/grant-types/implicit/">The OAuth2 Implicit Grant</a></li><li><a href="https://oauth.net/2.1/">Using OAuth2 without PKCE</a> will no longer be an
option with OAuth 2.1+.</li><li>Resource Owner Password Credentials Grant will be
<a href="https://oauth.net/2.1/">deprecated in OAuth 2.1</a> and is generally considered
&#34;bad practice&#34;.</li><li><a href="https://openid.net/specs/openid-connect-session-1_0.html#OPiframe">OpenID Connect Session Management</a>
uses hidden iframes (with HTTP cookies) to synchronize session states, which
is becoming more and more difficult in today&#39;s locked-down cookie world.</li></ul><p>There are of course more abandoned and deprecated specifications. However, those
never made it past the draft status and I therefore didn&#39;t include them. For
this reason we only accept finalized RFCs and specifications to
<a href="http://github.com/ory/fosite">Ory Fosite</a> and
<a href="http://github.com/ory/hydra">Ory Hydra</a>!</p><h2 id="convince-your-peers"><a href="#convince-your-peers" aria-label="convince your peers permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Convince Your Peers</h2><p>In this section we have collected questions and statements we have seen and read
over the years. We hope that our answers can help you convince your peers to go
one way or the other!</p><h3 id="our-api-needs-tokens-thus-we-need-oauth2"><a href="#our-api-needs-tokens-thus-we-need-oauth2" aria-label="our api needs tokens thus we need oauth2 permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Our API needs Tokens, thus we need OAuth2!</h3><p>OAuth2 access tokens are a subcategory of tokens. An authorization token is just
a string that is used to authorize a request. It can be anything from a JSON Web
Token (so-called pass-by-value tokens) to a random identifier (so-called
pass-by-reference tokens). You do not need OAuth2 to issue such a token!</p><p>In particular you will find terminologies such as &#34;Personal Access Tokens&#34; or
&#34;API Keys&#34; in the wild. These types of tokens are not the result of OAuth2
flows! They use systems like
<a href="https://docs.konghq.com/hub/kong-inc/key-auth/">Kong&#39;s Key Authentication Plugin</a>
or a simple service.</p><p>You only really need OAuth2 and OpenID Connect if you&#39;d like your users to give
consent (&#34;i.e. I want to allow this app access to my personal data&#34;). You do not
need OAuth2 to generate a JSON Web Token, a Personal Access Token, a Native
Mobile App Session Token.</p><p>At Ory, you can use
<a href="https://www.ory.sh/kratos/docs/concepts/session/">Ory Session Tokens</a> if you
want to interface your API with native apps and clients which do not have a
browser. We are also planning to publish a new token service which will
standardize API Keys and Personal Access Tokens so that your users will be able
to easily create these types of tokens in a scalable and secure way!</p><p>In conclusion: OAuth2 issues tokens. But not every token must be issued by
OAuth2 to be secure.</p><h3 id="we-want-to-use-json-web-tokens-thus-we-need-oauth2"><a href="#we-want-to-use-json-web-tokens-thus-we-need-oauth2" aria-label="we want to use json web tokens thus we need oauth2 permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>We want to use JSON Web Tokens, thus we need OAuth2.</h3><p>You can use JSON Web Tokens without OAuth2. These are two different standards
which can be used independently! See the section above.</p><h3 id="we-can-use-oauth2-for-permissions"><a href="#we-can-use-oauth2-for-permissions" aria-label="we can use oauth2 for permissions permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>We can use OAuth2 for permissions!</h3><p><strong><a href="#scopes-are-not-permissions">Scopes are not Permissions</a>.</strong></p><h3 id="i-plan-for-the-future-thus-i-need-oauth2-now"><a href="#i-plan-for-the-future-thus-i-need-oauth2-now" aria-label="i plan for the future thus i need oauth2 now permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>I plan for the future, thus I need OAuth2 now!</h3><p>In some cases, this is a valid point. If you are facing a complex landscape with
hundreds of different services and integrations, it may make sense to
standardize everything using OAuth2 and OpenID Connect. This is especially true
if you can build a dedicated team which is responsible for training, auditing,
developing, and maintaining your OAuth2 and OpenID Connect services and
integration tools.</p><p>Another valid case is if you are building a platform wherein third parties need
access to your system. Here too it might make sense to start using OAuth2 and
OpenID Connect immediately to maintain one standard method of authentication.</p><p>If you are a small team, a start-up, or a company with a single product you will
not need it unless you fall under one of the exceptions listed in this article.
And if you still decide to go this route, be prepared to spend a considerable
amount of time and development resources to get it right.</p><h3 id="oauth2-and-openid-connect-are-the-best-weve-got"><a href="#oauth2-and-openid-connect-are-the-best-weve-got" aria-label="oauth2 and openid connect are the best weve got permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OAuth2 and OpenID Connect are the &#34;best we&#39;ve got.&#34;</h3><p>This is something we hear a lot from consultants! At least OAuth2 and OpenID
Connect are standardized and have integrations for most programming languages.</p><p>But wouldn&#39;t it be nicer if we actually had something that:</p><ol><li>Addresses the need for a solution which solves login, registration, account
recovery,... ;</li><li>Is secure and not incredibly complex;</li><li>Solves permissions (not OAuth2 scopes) in a scalable and reliable way;</li><li>Is standardized;</li><li>Can be extended to also support OAuth2 and OpenID Connect when you really
need it?</li></ol><h2 id="if-not-oauth2-what-else"><a href="#if-not-oauth2-what-else" aria-label="if not oauth2 what else permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>If not OAuth2, what else?</h2><p>That&#39;s exactly why we are building Ory. We want to build the next generation of
authentication and authorization services. While there is still a long way to go
for Ory to really become a new standard, we already have a solid foundation!
While you&#39;re here, maybe one of our projects will spark your interest:</p><ul><li><a href="https://www.ory.sh/">Ory Cloud</a> is a managed service offering planet-scale
and low latency APIs for login, registration, permissions, delegation (OAuth2
/ OpenID Connect), and many more features to come. It combines our open source
projects with an effortless and scalable infrastructure!</li><li><a href="https://github.com/ory/kratos">Ory Kratos</a> is our attempt at solving
authentication without the need for OAuth2 or OpenID Connect, in a simple,
reliable, and secure way!</li><li><a href="https://github.com/ory/keto">Ory Keto</a> is an implementation of the Google
Zanzibar whitepaper, which explains how Google is solving permissions and
access control in their own products (Youtube, Google Docs, Google Workspace,
Google Search,...).</li><li><a href="https://github.com/ory/hydra">Ory Hydra</a> is a modern, open-source, and
easy-to-use OAuth2 and OpenID Connect server that can connect to and interface
with any user system (e.g. Ory Kratos).</li></ul><h2 id="so-is-oauth2--openid-connect-all-bad"><a href="#so-is-oauth2--openid-connect-all-bad" aria-label="so is oauth2  openid connect all bad permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>So Is OAuth2 / OpenID Connect all Bad?</h2><p>Of course not! OAuth2 and OpenID Connect are extremely powerful and
well-designed protocols that can, if used in the correct context, greatly
improve the interoperability of systems and thus reduce complexity (which
increases security).</p><p>There are many examples of these two protocols being used securely and
successfully. From FireTV sticks to integrating different services (Hubspot,
Google, Discourse, ...) and offering powerful tools to provide third parties
access to sensitive, private information.</p><p>But it is important to keep in mind what you want to build and in what sequence.
For many of the use cases that end up in Ory&#39;s community, something like
<a href="https://github.com/ory/kratos">Ory Kratos</a> and <a href="https://www.ory.sh">Ory Cloud</a>
are a much better fit than trying to implement OAuth2 and OpenID Connect both on
the server and client side!</p><p>And the great news is, if the need for OAuth2 and OpenID Connect arises, you can
use Ory again to add these on top!</p><h2 id="conclusion"><a href="#conclusion" aria-label="conclusion permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2><p>Thank you for taking the time to read this article. It&#39;s a lot, I know! I hope
you learned a thing or two and, more than anything, that you now have the
knowledge to start building your system without spending restless nights on
things you don&#39;t need yet, figuring out all the intricate details of OAuth2 and
OpenID Connect!</p><p>Do you have a different opinion on this topic or did you just enjoy the read?
Write me on <a href="https://twitter.com/_aeneasr">Twitter</a> or follow me on
<a href="http://github.com/aeneasr">GitHub</a>.</p><p>Thank you for reading and see you next time! Maybe in the
<a href="https://slack.ory.sh">Ory Community</a>? :)</p></div></div></div></div>
  </body>
</html>
