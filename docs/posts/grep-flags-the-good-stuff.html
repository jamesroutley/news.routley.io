<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zwischenzugs.com/2022/02/02/grep-flags-the-good-stuff/">Original</a>
    <h1>Grep flags – the good stuff</h1>
    
    <div id="readability-page-1" class="page"><div>
		
<p>While writing a post on <a rel="noreferrer noopener" href="https://zwischenzugs.com/2022/01/04/practical-shell-patterns-i-actually-use/" target="_blank">practical shell patterns</a> I had a couple of patterns that used <code>grep</code> commands.</p>



<p>I had to drop those patterns from the post, though, because as soon as I thought about them I got lost in all the <code>grep</code> flags I wanted to talk about. I realised <code>grep</code> deserved its own post.</p>



<p><code>grep</code> is one of the most universal and commonly-used commands on the command line. I count about 50 flags you can use on it in my man page. So which ones are the ones you should know about for everyday use?</p>



<p>I tried to find out.</p>



<p>I started by asking on Twitter whether the five flags I have ‘under my fingers’ and use 99% of the time are the ones others also use.</p>



<figure><div>

</div></figure>



<p>It turns out experience varies widely on what the 5 most-used are.</p>



<p>Here are the results, in no particular order, of my researches.</p>



<p>I’ve tried to categorize them to make it easier to digest. The categories are:</p>



<ul><li><strong>ABC – The Context Ones</strong></li><li><strong>What To Match?</strong></li><li><strong>What To Report?</strong></li><li><strong>What To Read?</strong></li><li><strong>Honourable Mention</strong></li></ul>



<p>If you think any are missing, let me know in the comments below.</p>



<h3 id="abc-the-context-ones">ABC – The Context Ones</h3>



<p>These arguments give you more context around your match.</p>



<h5 id="grep-a">grep -A</h5>



<h5 id="grep-b">grep -B</h5>



<h5 id="grep-c">grep -C</h5>



<p>I hadn’t included these in my top five, but as soon as I was reminded of them, <code>-C</code> got right back under my fingertips.</p>



<p>I call them the ‘ABC flags’ to help me remember them.</p>



<p>Each of these gives a specified context around your grep’d line. <code>-A</code> gives you lines after the match, <code>-B</code> gives you lines before the match, and <code>-C</code> (for ‘context’) gives you both the before and after lines.</p>



<pre>$ mkdir grepflags &amp;&amp; cd grepflags
$ cat &gt; afile &lt;&lt;EOF                                                                   
a
b
c
d
e
EOF
$ grep -A2 c afile
c
d
e
$ grep -B2 c afile
a
b
c
$ grep -C1 c afile
b
c
d</pre>



<p>This is especially handy for going through configuration files, where the ‘before’ context can give you useful information about where the thing your matching sits within a wider context.</p>



<h3 id="what-to-match">What To Match?</h3>



<p>These flags relate to altering what you match and don’t match with your grep.</p>



<h5 id="grep-i-1"><code>grep -</code>i</h5>



<p>This flag ignores the case of the match. Very handy and routine for me to use to avoid not missing matches I might want to see (I often grep through large amounts of plain text prose).</p>



<pre>$ cat &gt; afile &lt;&lt;EOF
SHOUT
shout
let it all out
EOF
$ grep shout afile
shout
$ grep -i shout afile
SHOUT
shout</pre>



<h5 id="grep-v">grep <code>-v</code></h5>



<p>This matches any lines that <em>don’t</em> match the regular expression (inverts), for example:</p>



<pre>$ touch README.md
$ IFS=$&#39;\n&#39;   # avoid problems with filenames with spaces in it
$ for f in $(ls | grep -v README)
&gt; do echo &#34;top of: $f&#34;
&gt; head $f
&gt; done
SHOUT
shout
let it all out</pre>



<p>which outputs the heads of all files in the local folder except any files with <code>README</code> in their names.  </p>



<h5 id="grep-w"><code>grep -w</code></h5>



<p>The <code>-w</code> flag only matches ‘whole-word’ matches, ignoring cases where submitted words are part of longer words.</p>



<p>This is a useful flag to narrow down your matches, and also especially useful when searching through prose:</p>



<pre>$ cat &gt; afile &lt;&lt;EOF
na
NaNa
na-na-na
na_na_na
hey jude
EOF
$ grep na afile
na
na-na-na
na_na_na
$ grep -w na afile
na
na-na-na
$ grep -vwi na afile
NaNa
na_na_na
hey jude</pre>



<p>You might be wondering what characters are considered part of a word. The manual tells us that ‘Word-constituent characters are letters, digits, and the underscore.’ This is useful to know if you’re searching code where word separators in identifiers might switch between dashes and underscore. You can see this above with the <code>na-na-na</code> vs <code>na_na_na</code> differences.</p>



<h3 id="what-to-report">What To Report?</h3>



<p>These <code>grep</code> flags offer choices about how the output you see is rendered. </p>



<h5 id="grep-h">grep -h</h5>



<p><code>grep -h</code> suppresses the prefixing of filenames on output. An example is demonstrated below:</p>



<pre>$ rm -f afile
$ cat &gt; afile1 &lt;&lt; EOF
a
EOF
$ cp afile1 afile2 
$ grep a *
afile1:a
afile2:a
$ grep -h a *
a
a</pre>



<p>This is particularly useful if you want to process the matching lines without the filename spoiling the input. Compare these to the output without the <code>-h</code>.</p>



<pre>$ grep -h a * | uniq
a 
$ grep -h a * | uniq -c
2</pre>



<h5 id="grep-o">grep -o</h5>



<p>This outputs only the text specified by your regular expression. One match is output per line, but multiple matches may be made per line.</p>



<p>This can result in more matches than lines, as in the example below, where you look for words that end lines that end in ‘ay’, and then any words with the letter ‘e’ in them (but not at the start or the end of the word).</p>



<pre>$ rm -f afile1 afile2
$ cat &gt; afile &lt;&lt; EOF
Yesterday
All my troubles seemed so far away
Now it looks as though they&#39;re here to stay
Oh I believe
In yesterday
EOF
$ grep -o &#39; [^ ]*ay$&#39; afile
 away
 stay
 yesterday
$ grep -o &#39; [^ ]*e[^ ]*&#39; afile
 troubles
 seemed
 they&#39;re
 here
 believe
 yesterday</pre>



<h5 id="grep-l"><code>grep -</code>l</h5>



<p>If you’re fighting through a blizzard of output and want to focus only on which files your matches are in rather than the matches themselves, then using this flag will show you where you might want to look:</p>



<pre>$ cat &gt; afile &lt;&lt; EOF
a
a
EOF
$ cp afile afile2
$ cp afile afile3grep -l
$ grep a *
afile:a
afile:a
afile2:a
afile2:a
afile3:a
afile3:a
$ grep -l a *
afile
afile2
afile3</pre>



<h3 id="what-to-read">What To Read?</h3>



<p>These flags change which files <code>grep</code> will look at.</p>



<h5 id="grep-r"><code>grep -r</code></h5>



<p>A very popular flag, this flag recurses through the filesystem looking for matches.</p>



<pre>$ grep -r securityagent /etc</pre>



<h5 id="grep-i"><code>grep -I</code></h5>



<p>This one is my favourite, as it’s incredibly useful, and not so well known, despite being widely applicable.</p>



<p>If you’ve ever been desperate to find where a string is referenced in your filesystem (usually as root) and run something like this:</p>



<pre id="block-0fcc3cc1-30f1-4980-b521-8428d6762118">$ grep -rnwi specialconfig /</pre>



<p>then you won’t have failed to notice that it can take a good while. This is partly because it’s looking at every file from the root, whether it’s a binary or not.</p>



<p>The <code>-I</code> flag only considers text files. This radically speeds up recursive greps. Here we run the same command twice (to ensure it’s not only slow the first time due to OS file cacheing), then run the command with the extra flag, and see a nearly 50% speedup.</p>



<pre>$ time sudo grep -rnwi specialconfig / 2&gt;/dev/null 
sudo grep -rnwi specialconfig /  418.01s user 382.19s system 70% cpu 19:03.09 total
$ time sudo grep -rnwi specialconfig /                                                  sudo grep -rnwi specialconfig /  434.19s user 411.62s system 70% cpu 19:56.25 total
$ time sudo grep -rnwiI specialconfig /                                                sudo grep -rnwiI specialconfig /  33.54s user 322.64s system 52% cpu 11:19.03 total</pre>



<h3 id="honourable-mention">Honourable mention</h3>



<p>There are many other <code>grep</code> flags, but I’ll just add one honourable mention at the end here.</p>



<h5 id="grep-e">grep -E</h5>



<p>I spent an embarrassingly long time trying to get regular expressions with + signs in them to work in grep before I realised that default grep didn’t support so-called ‘extended’ regular expressions.</p>



<p>By using <code>-E</code> you can use those regular expressions just as the regexp gods intended.</p>



<pre>$ cat &gt; afile &lt;&lt;&lt; aaaaaa+bc
$ grep -o &#39;a+b&#39; a            # + is treated literally
a+b
$ grep -o &#39;aa*b&#39; a           # a workaround
aaaaaaaaaab
$ grep -oE &#39;a+b&#39; a           # extended regexp
aaaaaaaaaab</pre>



<hr/>



<p><strong><em>If you like this, you might like one of my books:</em></strong></p>



<div><figure><a href="https://leanpub.com/b/learngitbashandterraformthehardway" target="_blank" rel="noreferrer noopener"><img data-attachment-id="4450" data-permalink="https://zwischenzugs.com/2018/08/06/anatomy-of-a-linux-dns-lookup-part-iv/learngitbashandterraformthehardway/" data-orig-file="https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png" data-orig-size="563,356" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="LearnGitBashandTerraformtheHardWay" data-image-description="" data-image-caption="" data-medium-file="https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png?w=300" data-large-file="https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png?w=563" src="https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png?w=357&amp;h=225" alt="LearnGitBashandTerraformtheHardWay" srcset="https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png?w=357&amp;h=225 357w, https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png?w=150&amp;h=95 150w, https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png?w=300&amp;h=190 300w, https://zwischenzugs.files.wordpress.com/2018/08/learngitbashandterraformthehardway.png 563w" sizes="(max-width: 357px) 100vw, 357px"/></a><figcaption>Buy in a bundle <a href="https://leanpub.com/b/learngitbashandterraformthehardway" target="_blank" rel="noreferrer noopener">here</a></figcaption></figure></div>



<hr/>



<p>If you enjoyed this, then please consider <a rel="noreferrer noopener" href="https://www.buymeacoffee.com/zwischenzugs" target="_blank">buying me a coffee</a> to encourage me to do more.</p>



<figure><a href="https://www.buymeacoffee.com/zwischenzugs"><img loading="lazy" data-attachment-id="5328" data-permalink="https://zwischenzugs.com/bmc-button/" data-orig-file="https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png" data-orig-size="1090,306" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="bmc-button" data-image-description="" data-image-caption="" data-medium-file="https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png?w=300" data-large-file="https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png?w=1024" src="https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png?w=1024" alt="" width="353" height="99" srcset="https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png?w=353 353w, https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png?w=706 706w, https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png?w=150 150w, https://zwischenzugs.files.wordpress.com/2021/05/bmc-button.png?w=300 300w" sizes="(max-width: 353px) 100vw, 353px"/></a></figure>
	</div></div>
  </body>
</html>
