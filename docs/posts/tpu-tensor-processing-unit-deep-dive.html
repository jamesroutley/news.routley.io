<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://henryhmko.github.io/posts/tpu/tpu.html">Original</a>
    <h1>TPU (Tensor Processing Unit) Deep Dive</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p>I&#39;ve been working with TPUs a lot recently and it&#39;s fun to see how they had such different design philosophies compared to GPUs.</p>

        <p>The main strongpoint for TPUs is in their scalability. This is achieved through a co-design of both the hardware side (e.g. energy efficiency and modularity) and the software side (e.g. XLA compiler).</p>

        <!-- <figure style="text-align: center;">
            <img src="images/single_chip.png" alt="chip diagram" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">TPU Single Chip + TensorCore</figcaption>
        </figure> -->
        
        


        

        

        

        
        
        
        

        

        

        

        
        

        

        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/systolic_arr.png" alt="systolic array diagram" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
        </figure> -->
        
        

        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/pipeline_pointwise.gif" alt="TPU data movement visualized" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">Pipelined Pointwise Operation (from "How to Scale Your Model" <a href="#ref4">[4]</a>)</figcaption>
        </figure> -->
        
        

        
        

        

        

        
        

        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/patterson_breakdown.png" alt="TPU data movement visualized" width="auto" height="150" style="margin-left:auto; margin-right: auto;">
        </figure> -->
        
        

        

        

        

        
        

        

        

        

        

        
        

        

        
        <!-- <div style="display: flex; justify-content: center; gap: 20px; align-items: flex-end;">
          <figure style="text-align: center; margin: 0;">
              <img src="images/patterson_breakdown_1.png" alt="TPU data movement visualized" width="auto" height="300">
              <figcaption style="margin-top: 10px; font-style: italic;">Energy per Operation (TPUv4, 7 nm)</figcaption>
          </figure>
          <figure style="text-align: center; margin: 0;">
              <img src="images/tpuv4_energy_breakdown.png" alt="Second image description" width="auto" height="400">
          </figure>
      </div> -->
        
        

        

        

        
        

        

        
        
        
        
        <!-- <figure style="text-align: center;">
            <img src="images/tray.png" alt="TPU data movement visualized" width="auto" height="300" style="margin-left:auto; margin-right: auto;">
        </figure> -->
        
        

        

        

        

        
        

        

        

        
        
        

        

        
        

        

        


        

        

        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/rack_ocs.png" alt="Simple thread hierarchy" width="auto" height="400" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">Single TPU Rack with OCS</figcaption>
        </figure> -->
        
        

        

        
        

        

        

        

        
        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/torus_2d.png" alt="TPU data movement visualized" width="auto" height="300" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">2D Torus Topology</figcaption>
        </figure> -->
        
        

        
        

        

        

        

        

        
        
        

        

        
        

        

        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/diff_topo.png" alt="TPU data movement visualized" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">Example TPU Topologies</figcaption>
        </figure> -->
        
        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/diff_topo_fig.png" alt="TPU data movement visualized" width="auto" height="300" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">Improvements in Throughput with Different Topologies</figcaption>
        </figure> -->
        
        

        

        

        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/multijob.png" alt="TPU data movement visualized" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">Individual Jobs Can Treat TPU Racks in a Pod as "Bag of Nodes"</figcaption>
        </figure> -->
        
        

        

        

        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/twisted_torus.png" alt="TPU data movement visualized" width="auto" height="400" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">Regular vs Twisted Torus (Source: TPUv4 Paper <a href="#ref9">[9]</a>)</figcaption>
        </figure> -->
        
        

        

        

        
        

        

        

        
        
        <!-- <p><strong>Scenario #1: 4x4x16 Topology (TP + PP; Total 256 chips)</strong></p> -->

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/twisted_scenario_1.png" alt="TPU data movement visualized" width="auto" height="600" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">4x4x16 Topology with TP + PP</figcaption>
        </figure> -->
        
        

        

        

        
        
        <!-- <p><strong>Scenario #2: 16x4x16 Topology (DP + TP + PP; Total 1024 chips)</strong></p> -->

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/twisted_scenario_2.png" alt="TPU data movement visualized" width="auto" height="600" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">16x4x16 Topology with DP + TP + PP</figcaption>
        </figure> -->
        
        

        

        

        
        

        
        <!-- <figure style="text-align: center;">
            <img src="images/multipod.png" alt="TPU data movement visualized" width="auto" height="200" style="margin-left:auto; margin-right: auto;">
        </figure> -->
        
        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/multipod_dcn.png" alt="TPU data movement visualized" width="auto" height="400" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">Two Pods Connected Over DCN <a href="#ref1">[1]</a></figcaption>
        </figure> -->
        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/palm_train.gif" alt="TPU data movement visualized" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">TPU Pod Utilization for Training PaLM <a href="#ref6">[6]</a></figcaption>
        </figure> -->
        
        


        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/xla_reduce.jpg" alt="TPU data movement visualized" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">XLA Reduction of All-Reduce Across Pods</figcaption>
        </figure> -->
        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/multipod_many.png" alt="TPU data movement visualized" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
        </figure> -->
        
        

        
        

        

        

        
        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/tpu_tray.png" alt="TPU data movement visualized" width="auto" height="300" style="margin-left:auto; margin-right: auto;">
        </figure> -->
        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/tpu_chip.png" alt="TPU data movement visualized" width="auto" height="300" style="margin-left:auto; margin-right: auto;">
            <figcaption style="margin-top: 10px; font-style: italic;">TPUv4 Chip with ASIC in center + 4 HBM Stacks</figcaption>
        </figure> -->
        
        

        

        

        
        <!-- <figure style="text-align: center;">
            <img src="images/tpuv4i_layout.png" alt="TPU data movement visualized" width="auto" height="500" style="margin-left:auto; margin-right: auto;">
        </figure> -->
        
        

        

        
        
        



        
        

        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        




<!--         
        <p id="ref1">[1] <a href="https://github.com/srush/GPU-Puzzles" target="_blank">Sasha Rush, GPU Puzzles Github Repo</a></p>
        <p id="ref2">[2] <a href="https://docs.nvidia.com/deeplearning/performance/dl-performance-gpu-background/index.html" target="_blank"> NVIDIA GPU Performance Guide</a></p>
        <p id="ref3">[3] <a href="https://developer.nvidia.com/cuda-gpus" target="_blank">NVIDIA CUDA Compute Capability Specs</a></p>
        <p id="ref4">[4] Programming Massively Parallel Processors(PMPP) Textbook, 4th ed. Hwu, Kirk, Hajj.</p> -->
    
        </div></div>
  </body>
</html>
