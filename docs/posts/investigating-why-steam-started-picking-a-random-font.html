<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://blog.pkh.me/p/35-investigating-why-steam-started-picking-a-random-font.html">Original</a>
    <h1>Investigating why Steam started picking a random font</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
<p>← <a href="http://blog.pkh.me/index.html">index</a></p>

<article><p>Out of the blue my Steam started picking a random font I had in my user fonts
dir: <a href="https://github.com/excalidraw/virgil/">Virgil</a>, the <a href="https://excalidraw.com/">Excalidraw</a> font.</p>
<p><img src="http://blog.pkh.me/img/steam-font-broken.png" alt="centerimg"/></p>
<p>That triggered me all sorts of emotions, ranging from laugh to total
incredulity. I initially thought the root cause was a random derping from Valve
but the Internet seemed quiet about it, so the unreasonable idea that it might
have been my fault surfaced.</p>
<p>To understand how it came to this, I have to tell you about <a href="https://store.steampowered.com/app/221910/The_Stanley_Parable/">The Stanley
Parable</a>, an incredibly funny game I highly recommend. One of the
achievement of the game is to not play it for 5 years.</p>
<p>To get it, I disabled NTP, changed my system clock to 2030, started the game,
enjoyed my achievement and restored NTP. So far so good, mission is a success,
I can move on with my life.</p>
<p>But not satisfied with this first victory I soon wanted to achieve the same in
<a href="https://store.steampowered.com/app/1703340/The_Stanley_Parable_Ultra_Deluxe/">the Ultra Deluxe</a> edition. This one comes with the same
achievement, except it&#39;s 10 years instead of 5. Since 2022+10 is too hard of a
mental calculation for me I rounded it up to 2040, and followed the same
procedure as previously. Achievement unlocked, easy peasy.</p>
<p>Problem is, Steam accessed many files during that short lapse of time, which
caused them to have their access time updated to 2040. And you know what&#39;s
special about 2040? It&#39;s <strong>after 2038</strong>.</p>
<p>Get it yet? Here is a hint: <a href="https://en.wikipedia.org/wiki/Year_2038_problem">Year 2038 problem</a>.</p>
<p>This is the kind of error I was seeing in the console: <code>&#34;/usr/share/fonts&#34;: Value too large for defined data type</code>.</p>
<p>What kind of error could that be?</p>
<pre><code>% errno -s &#34;Value too large&#34;
EOVERFLOW 75 Value too large for defined data type
</code></pre>
<p>Nice, so we&#39;re triggering an overflow somewhere. More precisely, fontconfig
32-bit (an underlying code to be exact) was going mad crazy because of this:</p>
<pre><code>% stat /etc/fonts/conf.d/*|grep 2040
Access: 2040-11-22 00:00:04.110328309 +0100
Access: 2040-11-22 00:00:04.110328309 +0100
Access: 2040-11-22 00:00:04.110328309 +0100
...
</code></pre>
<p>In order to fix this mess I had to be a bit brutal:</p>
<pre><code>% sudo mount -o remount,strictatime /
% sudo mount -o remount,strictatime /home
% sudo find / -newerat 2039-12-31 -exec touch -a {} +
% sudo mount -o remount,relatime /
% sudo mount -o remount,relatime /home
</code></pre>
<p>The remounts were needed because <code>relatime</code> is the default, which means file
accesses get updated only if the current time is past the access time. And I
had to remount both my root and home partition because Steam touched files
everywhere.</p>
<p>Not gonna lie, this self-inflicted bug brought quite a few life lessons to me:</p>
<ul>
<li>The Stanley Parable meta-game has no limit to madness</li>
<li>2038 is going to be a lot of fun</li>
<li>32-bit games preservation is a sad state of affair</li>
</ul>
</article>
<hr/>
<p>
 For updates and more frequent content you can follow me on <a href="https://twitter.com/insouris">Twitter</a> or <a href="https://fosstodon.org/@bug">Mastodon</a>. Feel also free to
 subscribe to the <a href="http://blog.pkh.me/rss.xml">RSS</a> in order to be notified
 of new write-ups. It is also usually possible to reach me through
 other means (check the footer below). Finally, discussions on some of
 the articles can sometimes be found on HackerNews, Lobste.rs and
 Reddit.
</p>
<p>← <a href="http://blog.pkh.me/index.html">index</a></p>
 </div></div>
  </body>
</html>
