<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ilevd/cwp">Original</a>
    <h1>Show HN: Indentation-based syntax for Clojure</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/ilevd/cwp/blob/main/doc/imgs/words-count.png"><img src="https://github.com/ilevd/cwp/raw/main/doc/imgs/words-count.png" alt="alt words-count"/></a></p>
<p dir="auto"><a href="https://clojars.org/org.clojars.ilevd/cwp" rel="nofollow"><img src="https://camo.githubusercontent.com/f2318dd99530da97ff6618949f4dcf37b30680ccea1a6f39f05b4cde1700f302/68747470733a2f2f696d672e736869656c64732e696f2f636c6f6a6172732f762f6f72672e636c6f6a6172732e696c6576642f6377702e737667" alt="Clojars Project" data-canonical-src="https://img.shields.io/clojars/v/org.clojars.ilevd/cwp.svg"/></a></p>
<p dir="auto">Indentation-based syntax for <a href="https://clojure.org/" rel="nofollow">Clojure</a>.</p>
<p dir="auto">Clojure is a practical dynamic functional programming language.
This project provides familiar syntax, so it&#39;s easy to switch to it, from e.g. Python.</p>
<p dir="auto">Features:</p>
<ul dir="auto">
<li>Indentation-based, Python-like syntax</li>
<li>Easy to write math operations</li>
<li>In most cases separators: <code>,</code> - comma and <code>to</code>- keyword are optional</li>
<li>Readable Clojure code generation</li>
</ul>
<p dir="auto">Being just a syntax for Clojure, it provides access to Clojure features such as:</p>
<ul dir="auto">
<li>Functional programming - immutable data structures, higher-order functions...</li>
<li>Concurrent primitives</li>
<li>Clojure/Java (JVM) ecosystem with a lot of libraries</li>
</ul>
<p dir="auto">It&#39;s a transpiler and a <a href="https://leiningen.org/" rel="nofollow">Leiningen</a> plugin.</p>

<p dir="auto">Data manipulation</p>
<div dir="auto" data-snippet-clipboard-copy-content="def users: [{:name to &#34;John&#34;,  :age to 20}
            {:name to &#34;Anna&#34;,  :age to 32}
            {:name to &#34;Smith&#34;, :age to 27}]

def avg-age(users):
  let ages to users |&gt;&gt; map(:age)
                    |&gt;&gt; reduce(+):
    ages / count(users) |&gt; double

def greetings(users):
  let names to users |&gt;&gt; map(:name)
                     |&gt;&gt; str/join(&#34;, &#34;):
    str(&#34;Hello, &#34;, names, &#34;!&#34;)

println(avg-age(users))
println(greetings(users))"><pre><span>def</span> <span>users</span><span>:</span> [{<span>:</span>name to <span><span>&#34;</span>John<span>&#34;</span></span>,  <span>:</span>age to <span>20</span>}
            {<span>:</span>name to <span><span>&#34;</span>Anna<span>&#34;</span></span>,  <span>:</span>age to <span>32</span>}
            {<span>:</span>name to <span><span>&#34;</span>Smith<span>&#34;</span></span>, <span>:</span>age to <span>27</span>}]

<span>def</span> <span>avg</span><span>-</span>age(users)<span>:</span>
  let ages to users <span>|</span><span>&gt;&gt;</span> map(<span>:</span>age)
                    <span>|</span><span>&gt;&gt;</span> reduce(<span>+</span>)<span>:</span>
    ages <span>/</span> count(users) <span>|</span><span>&gt;</span> double

<span>def</span> <span>greetings</span>(users)<span>:</span>
  let names to users <span>|</span><span>&gt;&gt;</span> map(<span>:</span>name)
                     <span>|</span><span>&gt;&gt;</span> str<span>/</span>join(<span><span>&#34;</span>, <span>&#34;</span></span>)<span>:</span>
    str(<span><span>&#34;</span>Hello, <span>&#34;</span></span>, names, <span><span>&#34;</span>!<span>&#34;</span></span>)

println(avg<span>-</span>age(users))
println(greetings(users))</pre></div>
<p dir="auto">Simple HTTP server with <a href="https://github.com/http-kit/http-kit">http-kit</a>,
<a href="https://github.com/weavejester/hiccup">Hiccup</a> and <a href="https://github.com/ring-clojure/ring">Ring</a></p>
<div dir="auto" data-snippet-clipboard-copy-content="ns my-project.server
  require: [ring.middleware.params :as params]
           [ring.middleware.keyword-params :as kparams]
           [org.httpkit.server :refer [run-server]]
           [hiccup2.core :as h]

def fruits: [&#34;Banana&#34;, &#34;Apple&#34;, &#34;Lemon&#34;]

def get-html(user):
  [:div
    [:p {:style {:font-weight :bold}} str(&#34;Hello, &#34;, user or &#34;User&#34;, &#34;!&#34;)]
    &#34;Fruits:&#34;
    for fruit to fruits:
      [:p {} fruit]]
  |&gt; h/html |&gt; str

def app(req):
 {:status  200
  :headers {&#34;Content-Type&#34; &#34;text/html&#34;}
  :body    get-html(req |&gt; :params |&gt; :name)}

run-server(app |&gt; kparams/wrap-keyword-params 
               |&gt; params/wrap-params,
           {:port 8080})"><pre>ns my<span>-</span>project.server
  <span>require</span>: [ring.middleware.params <span>:</span>as params]
           [ring.middleware.keyword<span>-</span>params <span>:</span>as kparams]
           [org.httpkit.server <span>:</span>refer [run<span>-</span>server]]
           [hiccup2.core <span>:</span>as h]

<span>def</span> <span>fruits</span><span>:</span> [<span><span>&#34;</span>Banana<span>&#34;</span></span>, <span><span>&#34;</span>Apple<span>&#34;</span></span>, <span><span>&#34;</span>Lemon<span>&#34;</span></span>]

<span>def</span> <span>get</span><span>-</span>html(user)<span>:</span>
  [<span>:</span>div
    [<span>:</span>p {<span>:</span>style {<span>:</span>font<span>-</span>weight <span>:</span>bold}} str(<span><span>&#34;</span>Hello, <span>&#34;</span></span>, user or <span><span>&#34;</span>User<span>&#34;</span></span>, <span><span>&#34;</span>!<span>&#34;</span></span>)]
    <span><span>&#34;</span>Fruits:<span>&#34;</span></span>
    <span>for</span> fruit to <span>fruits</span>:
      [<span>:</span>p {} fruit]]
  <span>|</span><span>&gt;</span> h<span>/</span>html <span>|</span><span>&gt;</span> str

<span>def</span> <span>app</span>(req)<span>:</span>
 {<span>:</span>status  <span>200</span>
  <span>:</span>headers {<span><span>&#34;</span>Content-Type<span>&#34;</span></span> <span><span>&#34;</span>text/html<span>&#34;</span></span>}
  <span>:</span>body    get<span>-</span>html(req <span>|</span><span>&gt;</span> <span>:</span>params <span>|</span><span>&gt;</span> <span>:</span>name)}

run<span>-</span>server(app <span>|</span><span>&gt;</span> kparams<span>/</span>wrap<span>-</span>keyword<span>-</span>params 
               <span>|</span><span>&gt;</span> params<span>/</span>wrap<span>-</span>params,
           {<span>:</span>port <span>8080</span>})</pre></div>
<p dir="auto">Some function from <a href="https://github.com/clojure/clojure/blob/clojure-1.11.1/src/clj/clojure/core.clj#L7918">clojure.core</a>
rewritten with CWP</p>
<div dir="auto" data-snippet-clipboard-copy-content="def load-data-reader-file(mappings, ^java.net.URL url):
  with-open rdr to clojure.lang.LineNumberingPushbackReader.(
                     java.io.InputStreamReader.(
                       .openStream(url), &#34;UTF-8&#34;)):
    binding *file* to .getFile(url):
      let read-opts to if .endsWith(.getPath(url), &#34;cljc&#34;):
                         {:eof nil :read-cond :allow}
                       else {:eof nil}
          new-mappings to read(read-opts, rdr):
        if not map?(new-mappings):
          throw ex-info(str(&#34;Not a valid data-reader map&#34;), {:url url})
        reduce(fn m, [k, v]:
                  if not symbol?(k):
                    throw ex-info(str(&#34;Invalid form in data-reader file&#34;),
                                  {:url url
                                   :form k})
                  let v-var to data-reader-var(v):
                    if contains?(mappings, k) and mappings(k) != v-var:
                      throw ex-info(&#34;Conflicting data-reader mapping&#34;,
                                    {:url      url
                                     :conflict k
                                     :mappings m})
                    assoc(m, k, v-var),
               mappings,
               new-mappings)"><pre><span>def</span> <span>load</span><span>-</span>data<span>-</span>reader<span>-</span>file(mappings, ^java.net.<span>URL</span> url)<span>:</span>
  <span>with</span><span>-</span>open rdr to clojure.lang.<span>LineNumberingPushbackReader</span>.(
                     java.io.<span>InputStreamReader</span>.(
                       .openStream(url), <span><span>&#34;</span>UTF-8<span>&#34;</span></span>))<span>:</span>
    binding <span>*</span>file<span>*</span> to .getFile(url)<span>:</span>
      let read<span>-</span>opts to <span>if</span> .endsWith(.getPath(url), <span><span>&#34;</span>cljc<span>&#34;</span></span>)<span>:</span>
                         {<span>:</span>eof nil <span>:</span>read<span>-</span>cond <span>:</span>allow}
                       <span>else</span> {<span>:</span>eof nil}
          <span>new</span><span>-</span>mappings to read(read<span>-</span>opts, rdr)<span>:</span>
        <span>if</span> not map<span>?</span>(<span>new</span><span>-</span>mappings)<span>:</span>
          <span>throw</span> ex<span>-</span>info(str(<span><span>&#34;</span>Not a valid data-reader map<span>&#34;</span></span>), {<span>:</span>url url})
        reduce(fn m, [k, v]<span>:</span>
                  <span>if</span> not symbol<span>?</span>(k)<span>:</span>
                    <span>throw</span> ex<span>-</span>info(str(<span><span>&#34;</span>Invalid form in data-reader file<span>&#34;</span></span>),
                                  {<span>:</span>url url
                                   <span>:</span>form k})
                  let v<span>-</span><span>var</span> <span>to</span> data<span>-</span>reader<span>-</span><span>var</span>(v)<span>:</span>
                    <span>if</span> contains<span>?</span>(mappings, k) and mappings(k) <span>!=</span> v<span>-</span><span>var</span><span>:</span>
                      <span>throw</span> ex<span>-</span>info(<span><span>&#34;</span>Conflicting data-reader mapping<span>&#34;</span></span>,
                                    {<span>:</span>url      url
                                     <span>:</span>conflict k
                                     <span>:</span>mappings m})
                    assoc(m, k, v<span>-</span><span>var</span>),
               mappings,
               <span>new</span><span>-</span>mappings)</pre></div>

<ul dir="auto">
<li><a href="https://github.com/ilevd/cwp/blob/main/doc/overview.md">Overview</a></li>
<li><a href="https://github.com/ilevd/cwp/blob/main/doc/syntax-and-transpiling.md">Syntax and transpiling</a></li>
</ul>

<p dir="auto">Add to <code>project.clj</code> :plugins section:</p>
<div dir="auto" data-snippet-clipboard-copy-content="[org.clojars.ilevd/cwp  &#34;&lt;actual_version&gt;&#34;] "><pre>[org.clojars.ilevd/cwp  <span><span>&#34;</span>&lt;actual_version&gt;<span>&#34;</span></span>] </pre></div>
<p dir="auto">Add builds info to <code>project.clj</code> root:</p>
<div dir="auto" data-snippet-clipboard-copy-content=":cwp {:builds [{:in  &#34;src-cwp&#34;
                :out &#34;src-out&#34;}]}"><pre>:cwp {<span>:builds</span> [{<span>:in</span>  <span><span>&#34;</span>src-cwp<span>&#34;</span></span>
                <span>:out</span> <span><span>&#34;</span>src-out<span>&#34;</span></span>}]}</pre></div>
<p dir="auto"><code>:in</code> - folder where CWP sources are,
<code>:out</code> - folder for generated Clojure code</p>
<p dir="auto">Files extensions mapping:</p>
<ul dir="auto">
<li><code>.cw</code> -&gt; <code>.clj</code></li>
<li><code>.cws</code> -&gt; <code>.cljs</code></li>
<li><code>.cwc</code> -&gt; <code>.cljc</code></li>
</ul>
<p dir="auto">Run: <code>lein cwp</code></p>
<p dir="auto">After that you can compile Clojure code to <code>.jar</code>.</p>

<p dir="auto">Copyright © 2024 ilevd</p>
</article></div></div>
  </body>
</html>
