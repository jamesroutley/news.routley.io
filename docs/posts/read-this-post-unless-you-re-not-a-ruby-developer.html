<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jesseduffield.com/Unless/">Original</a>
    <h1>Read This Post ‘Unless’ You’re Not a Ruby Developer</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p><em>Disclaimer: prepare for hair-splitting and nitpicking</em></p>

<p>I don’t like Ruby’s <code>unless</code> keyword.</p>

<p>In Ruby, <code>unless</code> is just syntactic sugar for <code>if !</code>, so:</p>

<div><div><pre><code><span>unless</span> <span>foo</span> <span>&amp;&amp;</span> <span>bar</span>
  <span># do something</span>
<span>end</span>
</code></pre></div></div>

<p>is the same as</p>

<div><div><pre><code><span>if</span> <span>!</span><span>(</span><span>foo</span> <span>&amp;&amp;</span> <span>bar</span><span>)</span>
  <span># do something</span>
<span>end</span>
</code></pre></div></div>

<p>Given that we have an <code>if</code> statement which executes on true values, it seems sensible to have a corresponding <code>unless</code> statement that executes on false values. But I find that it causes more trouble than it’s worth.</p>

<p>Here are my reasons:</p>

<h2 id="concealed-double-negatives">Concealed double negatives</h2>

<p>The human brain, impressive as it is, grinds to a halt when parsing with double negatives. It’s amazing that we’ve achieved so much as a species despite this embarrassing shortcoming. So we should take any chance we have to reduce the double negatives in our code. Unfortunately, <code>unless</code> is a magnet for double-negatives.</p>

<h3 id="else-blocks">Else blocks</h3>

<p>Geeksforgeeks (admittedly, not the best source) illustrates the use of <code>unless</code> with the following example:</p>

<div><div><pre><code><span>unless</span> <span>condition</span>
  <span># do A</span>
<span>else</span>
  <span># do B</span>
<span>end</span>
</code></pre></div></div>

<p>I don’t know why anybody would want to use <code>unless</code> in conjunction with an <code>else</code> block. If I come across the following (equivalent) code:</p>

<div><div><pre><code><span>if</span> <span>!</span><span>condition</span>
  <span># do A</span>
<span>else</span>
  <span># do B</span>
<span>end</span>
</code></pre></div></div>

<p>It’s obvious to me that there’s a double negative: one from the bang (exclamation mark) and one from the <code>else</code>. You can easily resolve that by negating the condition and swapping the legs:</p>

<div><div><pre><code><span>if</span> <span>condition</span>
  <span># do B</span>
<span>else</span>
  <span># do A</span>
<span>end</span>
</code></pre></div></div>

<p>Which is easier to read? If somebody says to you ‘if it’s raining, bring an umbrella, otherwise leave it at home’ that’s a dead simple instruction. If somebody tells you ‘unless it’s raining, leave your umbrella at home, otherwise bring it’ that’s a brain teaser.</p>



<p>Say you want to return ‘invalid’ if a token isn’t valid. You could write either of the following:</p>

<div><div><pre><code><span>return</span> <span>&#39;invalid&#39;</span> <span>if</span> <span>!</span><span>valid_token</span>
<span>return</span> <span>&#39;invalid&#39;</span> <span>unless</span> <span>valid_token</span>
</code></pre></div></div>

<p>You may find the second option, with <code>unless</code>, more readable. Fair enough. But let’s say that later on you want to also check that the token hasn’t expired. With the <code>if</code> approach it’s easy to tack on a condition:</p>

<div><div><pre><code><span>return</span> <span>&#39;invalid&#39;</span> <span>if</span> <span>!</span><span>valid_token</span> <span>||</span> <span>expired</span>
</code></pre></div></div>

<p>But with the <code>unless</code> approach, it’s not so simple:</p>

<div><div><pre><code><span>return</span> <span>&#39;invalid&#39;</span> <span>unless</span> <span>valid_token</span> <span>&amp;&amp;</span> <span>!</span><span>expired</span>
</code></pre></div></div>

<p>The reason you might find that snippet confusing is because of the concealed double negative. The statement really says:</p>

<div><div><pre><code><span>return</span> <span>&#39;invalid&#39;</span> <span>if</span> <span>!</span><span>(</span><span>valid_token</span> <span>&amp;&amp;</span> <span>!</span><span>expired</span><span>)</span>
</code></pre></div></div>

<p>Using De Morgan’s Theorem (i.e. <code>!(a &amp;&amp; b) == !a || !b</code>), we can rewrite the statement as:</p>

<div><div><pre><code><span>return</span> <span>&#39;invalid&#39;</span> <span>if</span> <span>!</span><span>valid_token</span> <span>||</span> <span>expired</span>
</code></pre></div></div>

<p>Which we already had above when we didn’t use <code>unless</code> to start with!</p>

<p>What’s going on here? When you use <code>if</code>, you’re committing to expressing something in positive terms. That conveniently makes it easy to add more conditions as needed. On the other hand, with <code>unless</code> you’re committing to expressing something in negative terms (by negating the whole expression). This means:</p>
<ul>
  <li>adding a new condition is not simple</li>
  <li>as soon as you add a negated condition e.g. <code>&amp;&amp; !expired</code>, you’ve introduced a double negative</li>
</ul>

<p>Note that the exact same arguments apply when instead of using <code>unless</code> you’re using <code>if !(...)</code>, but the latter approach has a couple of advantages:</p>
<ul>
  <li>when you have a double negative, it’s dead-easy to spot by just looking at the bangs.</li>
  <li><code>unless</code> hypnotises you into doubling-down on the negation</li>
</ul>

<p>To expound on that last point, you often start with a whole condition negated (either via <code>unless</code> of <code>if !(...)</code>) and later on the condition grows and ends up being better expressed in positive terms. If you’ve gone with <code>if !(...)</code>, then expanding out a bang (using De Morgan’s Theorem) is a straight-forward process, but even though the refactor is exactly the same with <code>unless</code>, from my personal experience reviewing Ruby code, there’s this bizarre quirk of human psychology where developers retain the <code>unless</code> against all odds. Not unlike Isildur from Lord of the Rings, developers who have the chance to cast <code>unless</code> into the fire instead stick with it despite the fact that refactoring to an <code>if</code> would vastly simplify the now unwieldy expression.</p>

<p><img src="https://www.recurse.com/images/posts/unless/elrond.png" alt=""/></p>

<p>Perhaps the appropriate response to that is for humans to just be better, but anybody who’s seen Lord of the Rings knows that humans are ever prone to temptation.</p>

<h2 id="incompatibility-with-other-languages">Incompatibility with other languages</h2>

<p>As a general rule I think that if a language has some feature for which there is already a commonly understood syntax across other languages, it should just use that syntax. If you’re introducing a complete paradigm shift, then that’s fine, but <code>unless</code> is not that: it’s just a different way to write <code>if !</code> and people jumping back and forth between ruby and, say, javascript, now have one extra idiosyncracy to keep in mind.</p>

<h2 id="too-many-ways-to-do-the-same-thing">Too many ways to do the same thing</h2>

<p>If we’re already able to do <code>if !foo</code>, why do we need <code>unless foo</code>?</p>
<ul>
  <li>it’s more syntax to learn</li>
  <li>it’s an extra choice you need to make when writing code</li>
  <li>it’s a source of stylistic disputes which make people write ranty blog posts instead of doing something productive.</li>
</ul>

<h2 id="english-meaning-is-slightly-different">English meaning is slightly different</h2>

<p>In the examples above, I claim that going without <code>unless</code> makes it easier to read if statements as plain English. But when there <em>are</em> bangs in there, you need to do some translation, so surely in the basic case of <code>unless foo</code>, that’s more readable than <code>if !foo</code>? Not necessarily. In English, <code>unless</code> doesn’t just mean <code>if not</code>: it suggests that an action is exceptional, unlikely, or unexpected (see <a href="https://github.com/rubocop/ruby-style-guide/issues/329">this rubocop style guide thread</a> for an extended discussion on this point). So, taking the example from that thread, comparing the following two options:</p>

<div><div><pre><code><span>if</span> <span>!</span><span>user</span><span>.</span><span>admin?</span>
  <span>raise</span> <span>&#34;Unauthorized&#34;</span>
<span>end</span>

<span>unless</span> <span>user</span><span>.</span><span>admin?</span>
  <span>raise</span> <span>&#34;Unauthorized&#34;</span>
<span>end</span>
</code></pre></div></div>

<p>I find the second option less readable because it suggests that raising the error would be the normal thing to do, when in fact it’s the exceptional thing to do.</p>

<p>Okay fine, but doesn’t that mean that <code>unless</code> is superior if the action <em>is</em> the normal thing to do? For example:</p>

<div><div><pre><code><span>if</span> <span>!</span><span>user</span><span>.</span><span>suspended?</span>
  <span>send_email</span>
<span>end</span>

<span>unless</span> <span>user</span><span>.</span><span>suspended?</span>
  <span>send_email</span>
<span>end</span>
</code></pre></div></div>

<p>I’m happy to concede that point. But if that’s the only benefit of <code>unless</code>, that it’s more readable in some circumstances, I don’t see how that compensates for all the downsides I’ve talked about above.</p>

<h2 id="why-does-this-matter">Why does this matter?</h2>

<p>Rubocop’s Ruby Style Guide <a href="https://github.com/rubocop/ruby-style-guide#if-vs-unless">says</a> to prefer <code>unless</code> over <code>if</code> for negated expressions:</p>

<div><div><pre><code><span># bad</span>
<span>do_something</span> <span>if</span> <span>!</span><span>some_condition</span>

<span># bad</span>
<span>do_something</span> <span>if</span> <span>not</span> <span>some_condition</span>

<span># good</span>
<span>do_something</span> <span>unless</span> <span>some_condition</span>
</code></pre></div></div>

<p>To its credit, the guide grants an exception for when <code>else</code> blocks are involved, but I still think the recommendation is mistaken. <code>unless</code> provides some small benefit when you’ve got a single condition and you’re talking about an exceptional case e.g. <code>open unless door_is_locked</code>, but I don’t think that benefit is worth the awkwardness that arises in other contexts.</p>

<p>This post is not a call to arms to try and get any style guide to change, because reading through some of the comments on the topic, there are people who find <code>unless</code> more readable compared to <code>if !</code> in the vast majority of cases. But my experience has been the exact opposite, and with all of my posts that nitpick at some language feature (looking at you, <a href="https://jesseduffield.com/Gos-Shortcomings-1/">Go’ing Insane</a> series) I really just want to see if other people relate to my experience. So if you’re reading this and you’re a Ruby dev, whether you love or hate <code>unless</code>, let me know your thoughts!</p>

  </div></div>
  </body>
</html>
