<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ntietz.com/blog/git-mailmap-for-name-changes/">Original</a>
    <h1>Using git mailmap when names change (or you mess up your email)</h1>
    
    <div id="readability-page-1" class="page"><div>
  <article>
    

    <p><strong>Monday, July  3, 2023</strong></p>

    <p>People change their names for all sorts of reasons. They get married, they transition, or they just decide a different name better suits them. When this happens, things break. Recently I talked about how <a href="https://blog.turso.tech/blog/email-address-not-identifier/">email address changes break things</a>. Today it&#39;s how to fix this issue with git.</p>
<p>We use git at work. After I came out at work, it was a game of whack-a-mole to find all the deadname instances. One of my coworkers pointed out that my deadname was all over our commit logs.</p>
<p><em>All</em> over them.</p>
<p>I have the most lines of code committed in our organization.
Many editors show the author and commit message for line that you&#39;re on.
That means...
Deadname, constantly.</p>
<p><em>YIKES</em>.</p>
<p>In other applications, you can just change your name.
In git, the history is meant to be immutable, so a record of old names is just... there.
You could rewrite history, but in a team setting that sort of rebasing isn&#39;t really tenable.
You just cannot stop the world long enough to make it happen.</p>
<p>Fortunately, we can paper over it by using <a href="https://git-scm.com/docs/gitmailmap">git mailmap</a><sup><a href="#1">1</a></sup>.
This lets you replace the name and email addresses on commits with the correct ones.
It&#39;s pretty straightforward.</p>
<p>You create a file called <code>.mailmap</code> in the root of your repository.
In it, each line says how to remap an email address (blank lines are ignored, and <code>#</code> begins comments).
There are a few different ways you can do this, which are provided in the docs.
There&#39;s one that I think is the most useful, though.
You list the correct name, followed by the correct email address inside <code>&lt;&gt;</code>, followed by the email address on the commits to map (also inside <code>&lt;&gt;</code>).</p>
<p>For example, here&#39;s a snippet of a mailmap file I setup at work (with a few lines redacted, for reasons):</p>
<pre><code><span>Nicole Tietz-Sokolskaya &lt;me@ntietz.com&gt; &lt;nicole@remesh.org&gt;
Nicole Tietz-Sokolskaya &lt;me@ntietz.com&gt; &lt;me@ntietz.com&gt;
Nicole Tietz-Sokolskaya &lt;me@ntietz.com&gt; &lt;ntietz@gmail.com&gt;
</span></code></pre>
<p>This standardizes all my commits to display my current name and my current email address, and all the tools seem to pick this up pretty seamlessly.</p>
<p>To find your email addresses to change, you can use grep. I ran something like this, with my deadname subbed in:</p>
<pre><code><span>git log | grep &#34;Author&#34; | grep DeadFirstName
</span></code></pre>
<p>There was another person in the history with the same first name, but it was easy enough to ignore those entries.
Then I wrote the mailmap file you see above (plus a few other lines; why did my config change so many times in 6 years??).
The last step was confirming that it worked:</p>
<pre><code><span>git log | grep &#34;Author&#34; | grep Nicole | sort -u
</span></code></pre>
<p>This comes back with just one line, reflecting my name and email, so everything worked!</p>
<p>We can do better, though.
This can be wrapped up in one small script.</p>
<pre><code><span>#!/bin/bash
# file: mailmap-deadname.sh
</span><span>set </span><span>-e

</span><span>if </span><span>[ </span><span>$</span><span># </span><span>-ne</span><span> 3 </span><span>]</span><span>; </span><span>then
    </span><span>echo </span><span>&#34;Usage: $</span><span>0</span><span> &lt;deadname&gt; &lt;name&gt; &lt;email&gt;&#34;
    </span><span>exit</span><span> 1
</span><span>fi

</span><span>git</span><span> log</span><span> --format</span><span>=</span><span>&#34;%aN &lt;$</span><span>3</span><span>&gt; &lt;%aE&gt;&#34; </span><span>| </span><span>grep </span><span>&#34;$</span><span>1</span><span>&#34; </span><span>| </span><span>sort</span><span> -u </span><span>| </span><span>sed</span><span> -e </span><span>&#34;s/$</span><span>1</span><span>/$</span><span>2</span><span>/g&#34; </span><span>&gt;&gt;</span><span> .mailmap
</span></code></pre>
<p>To use it, you run something like <code>./mailmap-deadname.sh &#39;Dead Name&#39; &#39;Nicole Tietz-Sokolskaya&#39; &#39;me@ntietz.com&#39;</code> and it appends the lines it needs into the mailmap file, and voila, you&#39;re done.
Make sure you commit the mailmap file so that it&#39;s reflected in your coworkers&#39; git logs, too!</p>
<hr/>


  </article>

  <hr/>
  <p>
    If this post was enjoyable or useful for you, <strong>please share it!</strong>
    If you have comments, questions, or feedback, please email <a href="mailto:~ntietz/public-inbox@lists.sr.ht">my public inbox</a> or <a href="mailto:me@ntietz.com">my personal email</a>.
    To get new posts, please use my <a href="https://ntietz.com/atom.xml">RSS feed</a>.
  </p>
  
</div></div>
  </body>
</html>
