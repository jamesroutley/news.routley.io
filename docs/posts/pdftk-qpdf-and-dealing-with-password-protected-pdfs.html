<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://harihareswara.net/posts/2022/pdftk-qpdf-and-dealing-with-password-protected-pdfs/">Original</a>
    <h1>PDFtk, qpdf, And Dealing With Password-Protected PDFs</h1>
    
    <div id="readability-page-1" class="page"><div>
            <p><small>05 May 2022, 13:00 p.m.</small>
            </p>
            <p>PDFtk, qpdf, And Dealing With Password-Protected PDFs</p>

            
            
            

        </div><div>
      <div>

          <div>
            <div>
<p data-block-key="h4nlf">I slice, dice, and transform documents often enough that I rely frequently on <a href="https://pandoc.org/">pandoc</a> and <a href="https://www.pdflabs.com/tools/pdftk-the-pdf-toolkit/">pdftk</a>. I often use <code>pandoc</code> to turn Markdown, HTML, wiki syntax, reStructuredText, etc. into each other or into LibreOffice, MS Office, etc. And I use <code>pdftk</code> (<code>pdftk-java</code> <a href="https://harihareswara.net/posts/2022/pdftk-qpdf-and-dealing-with-password-protected-pdfs/#java-port-of-pdftk">technically</a>) to <a href="https://www.pdflabs.com/docs/pdftk-cli-examples/">say</a>, &#34;turn pages 1 &amp; 5 from this PDF into a new one&#34; or &#34;concatenate these 4 PDFs into a new one&#34;.</p><p data-block-key="1ttsp">Recently I wanted to take a password-protected file, select several page ranges from it, and emit a new non-protected file. I ran into a problem while trying to do this:</p><p data-block-key="6au2k"><code>Error: Invalid PDF: unknown.encryption.type.r</code></p><p data-block-key="c1jt9"><code>Error: Failed to open input PDF file:</code></p><p data-block-key="d9188"><code>redacted-name-of-file.pdf</code></p><p data-block-key="8sm9l"><code>Errors encountered. No output created.</code></p><p data-block-key="c69jm"><code>Done. Input errors, so no output created.</code></p><p data-block-key="66q1r">I looked around and found <a href="https://gitlab.com/pdftk-java/pdftk/-/issues/87">this GitLab issue</a> -- more recent PDFs are often protected with AES256 which isn&#39;t yet supported. Thanks to ergo mesh in that thread who pointed to a solution: <a href="https://qpdf.readthedocs.io/en/stable/cli.html">qpdf</a>. I am more familiar with <code>pdftk</code>&#39;s syntax so I did it in two steps:</p><p data-block-key="auivi"><code>qpdf redacted-name-of-file.pdf --replace-input --password=SECRETPASSWORD --decrypt # note to self: remove this entry from history later</code></p><p data-block-key="dl8h4"><code>pdftk redacted-name-of-file.pdf cat 3-8 10-16 output /tmp/redacted-file-unprotected-edited.pdf</code></p><p data-block-key="cgda1">but I&#39;m likely to learn <a href="https://qpdf.readthedocs.io/en/stable/cli.html#page-selection"><code>qpdf</code>&#39;s page selection syntax</a> soon and switch to it entirely, in which case I could have done this in one step. I also could have <a href="https://qpdf.readthedocs.io/en/stable/cli.html#option-password-file">saved the password in a file and then read it into <code>qpdf</code></a> instead of typing it on the command line, which I&#39;ll probably start doing. But here&#39;s how I <a href="https://gnu.org/software/bash/manual/html_node/Bash-History-Builtins.html">remove a specific item from my bash history</a>:</p><p data-block-key="5ss0b"><code>history -a # append recent history</code></p><p data-block-key="2s8un"><code>history # print out history lines, so user can look for the offset number of the relevant line, e.g., 301</code></p><p data-block-key="bdpd9"><code>history -d 301 # now it&#39;s gone from the current history list!</code></p><p data-block-key="fifu1"><code>history -w # actually seal the deal &amp; write the deletion to the history file</code></p><p data-block-key="divdj">Hope this helps! Also, <a href="https://qpdf.readthedocs.io/en/stable/encryption.html">the <code>qpdf</code> documentation on how PDF encryption/password protection works is pretty enlightening</a>.</p>
            </div>
          </div>

      </div>
</div></div>
  </body>
</html>
