<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.oranlooney.com/post/genji-ko/">Original</a>
    <h1>The Art and Mathematics of Genji-Ko</h1>
    
    <div id="readability-page-1" class="page"><article>
      <img src="https://www.oranlooney.com/post/genji-ko_files/lead.jpg"/>
      
      
      
      <hr/>
      <ul>
        
        <li><time>November 26, 2024</time></li>
        <li>
          <a href="https://www.oranlooney.com/tags/python/">
            <i></i>
            Python
          </a> 
        </li>
        <li>
          <a href="https://www.oranlooney.com/tags/visualization/">
            <i></i>
            Visualization
          </a> 
        </li>
        <li>
          <a href="https://www.oranlooney.com/tags/history/">
            <i></i>
            History
          </a> 
        </li>
      </ul>
      

      

<p>You might think it’s unlikely for any interesting mathematics to arise from
incense appreciation, but that’s only because you’re unfamiliar with the
peculiar character of <a href="https://en.wikipedia.org/wiki/Muromachi_period">Muromachi (室町) era</a> Japanese nobles.</p>

<p>There has never been a group of people, in any time or place, who were so driven
to display their sophistication and refinement. It wouldn’t do to merely put
out a few sticks of incense; no, you would have to prove that your taste was
more exquisite, your judgment more refined, your etiquette more oblique. You
could of course merely invite some other nobles over for an incense
appreciation party, make a few cutting but plausibly deniable remarks about a
rival, maybe drop a few lines of poetry linking the incense to the current
season. But if you were really on the ball you’d be looking for a way to
simultaneously humiliate your rivals, flirt with your love interest, and
impress people in a position of power. They didn’t just perfect cultured
refinement: they weaponized it.</p>

<p>Only under such conditions could something like Genji-kō (源氏香) arise. It is
a parlor game played with incense—just one of many similar games inside the
broader umbrella of kōdō (香道), the traditional Japanese art of incense
appreciation.</p>

<p>What sets Genji-kō apart is its extreme difficulty - where another kōdō game
might have contestants write down their guesses for three separate incenses and
score a point for each correct guess, Genji-kō asks contestants to smell five
separate samples, then determine which of the five were the same scent. All
five might be the same, all five might be different, or (and this is where it
gets interesting) they might be in groups of two or three or four.</p>

<p>Contestants score a single point by correctly guessing all five incenses;
otherwise they score nothing. A typical game has five rounds over the course of
an evening, with an overall winner declared at the end.</p>

<p>Obviously contestants would need some kind of notation to submit their answers
in a concise and unambiguous way, and it is really about this notation (and
the art, mathematics, and culture connected to it) that this article is about.</p>

<h2 id="notation">Notation</h2>

<p>The solutions that Genji-kō players submit are called Genji-mon (源氏紋) and
are drawn with exactly five vertical lines, representing the five possible
incenses. To show that two or more incenses are part of the same group, you
draw a horizontal line connecting the top of every vertical line in that group.
To avoid confusion when there are two or more groups, you draw these horizontal
lines at different heights, shortening the vertical lines as needed:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/examples.png"/></p>

<p>There are a few nuances worth mentioning. If two groups don’t overlap, there is
no need to draw them at different heights (top center.) Sometimes it is
impossible to avoid an intersection (bottom center) but it is clear that groups
are distinct because the horizontal connecting lines are at different heights;
nevertheless, we try to minimize such intersections.</p>

<p>Genji-kō features as a plot point in <a href="https://www.imdb.com/title/tt2076558/">episode 8 of the experimental horror
anime Mononoke</a>, where it is suggested that players used blocks to
record their solutions:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/blocks.png"/></p>

<p>While this might be true - the episode’s description of Genji-Kō is otherwise
grounded and well-researched - I haven’t seen any other references to this;
everything else I’ve seen indicates the game was played with ink and paper. I
think it’s probably just a case of artistic license.</p>

<h2 id="etymology">Etymology</h2>

<p>Genji-kō, by the way, is named after the titular Genji of the Heian (平安) era
literary classic <a href="https://en.wikipedia.org/wiki/The_Tale_of_Genji"><em>The Tale of Genji</em></a>. (The fact that “Genji” is a proper
name is also why I capitalize Genji-kō and Genji-mon.)</p>

<p>There are two connections. First, in one chapter of the book Genji hosts an
incense appreciation party. Second, since there are 52 possible patterns and 54
chapters of the book, each Genji-mon is traditionally associated with—and
named after—a chapter, except for the first and last chapters, which are
omitted.</p>

<p>Every educated person of the Muromachi era would have been be intimately
familiar with <a href="https://en.wikipedia.org/wiki/The_Tale_of_Genji"><em>The Tale of Genji</em></a> and would know the themes, season, and
characters associated with each chapter by heart, giving each pattern a
literary resonance. A skillful kōdō practitioner hosting a game of Genji-kō
would choose a solution that referenced the current season or recent event,
adding both a additional layer of meaning to the game and a hint to skilled
players.</p>

<p>There are <a href="#names#">several different words</a> we could use to refer
to the patterns themselves, but I’ve chosen Genji-mon as it seems to be the
most common.</p>

<h2 id="cultural-influence">Cultural Influence</h2>

<p>Compared to other traditional arts from the same era such as tea ceremony or
flower arranging, kōdō is not particularly popular or well-known, even in
Japan; nevertheless it is <a href="https://www.youtube.com/watch?v=wpDb5LhvvSM">still played</a> even to this day.</p>

<p>However, its cultural influence extends beyond the few who actually play the
game - the patterns show up fairly often as motifs in contemporary Japanese
graphic design, and it’s especially popular on traditional goods such as
kimono:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/genjiko_colorful.jpg"/>
<img src="https://www.oranlooney.com/post/genji-ko_files/kimono.jpg"/>
</p>

<p>While
<a href="https://www.oranlooney.com/post/genji-ko_files/cheap_genjiko_kimono.jpg" target="_blank">cheaper fabrics</a>
simply print the same Genji-mon repeatedly, high-quality Genji-Kō textiles will
use a variety of Genji-mon so that the pattern seems to never quite repeat:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/fabric.jpg"/></p>

<p>Naturally, Genji-mon are often found on goods related to incense in some way,
such as this kōdō set, incense box, or incense holder:</p>

<p><img "display:inline;="" padding:="" 0px;"="" src="https://www.oranlooney.com/post/genji-ko_files/incense_set.jpg"/>
<img src="https://www.oranlooney.com/post/genji-ko_files/incense_box.jpg"/>
<img src="https://www.oranlooney.com/post/genji-ko_files/incense_holder.jpg"/>
</p>

<p>In the 1840s <a href="https://en.wikipedia.org/wiki/Kunisada">Kunisada</a> painted a series of wall scrolls, one for each
chapter of <a href="https://en.wikipedia.org/wiki/The_Tale_of_Genji"><em>The Tale of Genji</em></a>, and included the associated Genji-mon on
each:</p>

<p><a href="https://www.oranlooney.com/post/genji-ko_files/minori_wall_scroll.png" target="_blank">
<img src="https://www.oranlooney.com/post/genji-ko_files/minori_wall_scroll.png"/>
</a></p>

<h2 id="drawing-genji-mon">Drawing Genji-Mon</h2>

<p>To draw Genji-Mon programmatically, we’ll use the standard recursive algorithm
to generate all possible partitions for a set of five elements:</p>

<pre><code>def partitions(s: Set[int]) -&gt; Iterator[List[Set[int]]]:
    &#34;&#34;&#34;Yield all partitions of a set as they are generated.&#34;&#34;&#34;
    if not s:
        yield []
        return
    first = next(iter(s))
    rest = s - {first}
    for partition in partitions(rest):
        yield [{first}] + partition
        for i in range(len(partition)):
            new_partition = (
                partition[:i] + 
                [partition[i] | {first}] + partition[i+1:]
            )
            yield new_partition
</code></pre>

<p id="maintext1">
However, the partition alone does not suffice to fully characterize a Genji-mon.
While we must draw overlapping groups at different heights to avoid ambiguity,
there is still a free choice about which groups we make taller. After studying
the chart of traditional Genji-mon, two rules became clear:
</p>

<ol>
<li>Groups should be as tall as possible.</li>
<li>Groups entirely inside<a href="#footnote1"><sup>†</sup></a> other
groups should be lower and appear to nest inside the outer group.</li>
</ol>

<p>I implemented this as a simple brute-force cost-based optimizer, because that
made it easy to experiment with different rules. (Even though in the end I
only used those two simple rules, I experimented with many others trying to
get rid of the remaining special cases, which I’ll discuss below.)</p>

<pre><code>def optimal_genjiko_for_partition(
    partition: List[Set[int]]
) -&gt; List[Tuple[float, Set[int]]]:
    &#34;&#34;&#34;
    Given a partition, find the optimal Genji-kō layout by minimizing a cost
    function.
    &#34;&#34;&#34;
    best_cost = math.inf
    best_genjiko = None
    HEIGHTS = [1.0, 0.8, 0.6]
    
    # Generate all possible combinations of heights
    for height_combo in itertools.product(HEIGHTS, repeat=len(partition)):
        genjiko_candidate = [
            (height, group) 
            for height, group 
            in zip(height_combo, partition)
        ]
        
        # Skip invalid configurations
        if not validate_genjiko(genjiko_candidate):
            continue
        
        # Encourage larger heights
        cost = -sum(height for height, _ in genjiko_candidate)  
        
        for height1, group1 in genjiko_candidate:
            for height2, group2 in genjiko_candidate:
                # Large penalty for higher inner group height
                if is_nested_within(group1, group2) and height1 &gt; height2:
                    cost += 1
        
        # keep track of the best solution so far
        if cost &lt; best_cost:
            best_cost = cost
            best_genjiko = genjiko_candidate

    return best_genjiko
</code></pre>

<p><a href="https://github.com/olooney/genjiko/blob/main/src/genjiko.py#L122">Drawing these using Pillow</a> or <a href="https://github.com/olooney/genjiko/blob/main/src/genjiko.py#L270">organizing them into a grid</a> is
straight-forward, so you can check the source code if you’re interested in
those details.</p>

<p>Here’s what we get if always use the algorithmically calculated “optimal”
layout and simply put them in the order returned by <code>partitions()</code>:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/algorithmic_genjiko.png"/></p>

<p>Good, but not perfect. The order is only vaguely similar, and the four Genji-mon
rendered in red are the ones where our “optimal” layout has failed to reproduce
the traditional design.</p>

<h2 id="maintext2">Genji-mon Order</h2>

<p>In the introduction he wrote for a <a href="https://www.amazon.com/Combinatorics-Ancient-Modern-Robin-Wilson/dp/0198739052">book on ancient combinatorics</a>, Knuth
<a href="https://www.oranlooney.com/post/genji-ko_files/combanatorics_ancient_and_modern_page.png" target="_blank">mentions</a>
that the Genji-mon “were not arranged in any particularly logical order” and
I’m inclined to agree. I tried several variations of the above <code>partition()</code>
function hoping to find one where the traditional order would just fall out
naturally, but it never did. A close inspection of the traditional order makes
it clear that this was never going to happen: While there is an overall trend
from many to fewer groups, there are just too many cases where the order is
clearly arbitrary.</p>

<p>I found a several references that put them in a different order, and even some
that tried to stretch it to 54 using some kind of
<a target="_blank" href="https://www.oranlooney.com/post/genji-ko_files/dupes.gif">duplication</a>
or introducing
<a target="_blank" href="https://www.oranlooney.com/post/genji-ko_files/irregular.jpg">irregular</a>
patterns.<sup><a href="#footnote2">*</a></sup>
However, if we recall what the notation is designed to represent this is
clearly nonsense: simultaneously useless for playing Genji-kō, mathematically
impossible, and at odds with tradition.</p>

<p>However, the association between the 52 patterns and chapter titles for
chapters 2-53 of the <em>Tale of Genji</em> seems watertight and consistent for
centuries back. Also, the order of the chapters is mostly consistent across
sources (there is some disagreement about the order of the later chapters, and
one chapter which survives only as a title or perhaps was intentionally elided
as a delicate way to allude to a character’s death) so I’ve put my Genji-mon in
chapter order following Waley. You can find the full table in
<a href="#table">Appendix C</a>.</p>

<h2 id="special-cases">Special Cases</h2>

<p>I spent some time trying to find some elegant heuristic that would nudge
the layout algorithm to produce those four without breaking any of the others,
but the rules were more complex than simply listing the special cases (and
none of them correctly handled Yūgiri (夕霧), which I’ll discuss below.)</p>

<p>The four special cases are:</p>

<pre><code>    # Suma: {1, 3, 4} should be lower than {2, 5}
    df.at[10, &#34;Layout&#34;] = [ (0.8, {1, 3, 4}), (1.0, {2, 5}) ]
    
    # Hatsune: {1, 3} should be lower than {2, 4}
    df.at[21, &#34;Layout&#34;] = [ (0.8, {1, 3}), (1.0, {2, 4}), (1.0, {5}) ]
    
    # Yugiri: {1, 4} should be lower than {3, 5}, and {2} even lower.
    df.at[37, &#34;Layout&#34;] = [ (0.8, {1, 4}), (0.6, {2}), (1.0, {3, 5}) ]
    
    # Nioumiya: {1, 2, 4} should be lower than {3, 5}
    df.at[40, &#34;Layout&#34;] = [ (0.8, {1, 2, 4}), (1.0, {3, 5}) ]
</code></pre>

<p>With these corrections, and using the <em>Tale of Genji</em> chapter order:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/genjiko.png"/></p>

<p>Of the four exceptions, two are obvious improvements (fixing the “hole” in Suma
and the “dent” in Hatsune), and one (Nioumiya) is a matter of indifference.
However, the fourth, Yūgiri, seems to actively violate the basic rules around
nesting and creates a three-level structure when two would have sufficed:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/yugiri_diff.png"/></p>

<p>The cost-based optimizer would never have chosen that layout because its most
basic tenet is to make the groups as tall as possible. A heuristic, let me
remind you, that holds for the other 51 Genji-mon. However, all the examples
of Yūgiri I found online use the traditional design, such as this
<a href="https://www.oranlooney.com/post/genji-ko_files/yugiri_wall_scroll.png" target="_blank">wall scroll</a>
by <a href="https://en.wikipedia.org/wiki/Kunisada">Kunisada</a> or this woodblock print by <a href="https://en.wikipedia.org/wiki/Masao_Maeda">Masao Maeda</a>:</p>

<p><a href="https://www.oranlooney.com/post/genji-ko_files/yugiri_woodblock_print.png" target="_blank">
<img src="https://www.oranlooney.com/post/genji-ko_files/yugiri_woodblock_print.png"/>
</a></p>

<p>So I don’t think I have a leg to stand on unless I want to fly in the face of
hundreds of years of tradition; we’ll just have to hard-code Yūgiri as a
special case.</p>

<h2 id="counting-genji-mon">Counting Genji-Mon</h2>

<p>The connection between Genji-kō and mathematics becomes apparent if we ask
ourselves, “Why are there exactly 52 Genji-mon patterns? How can we be sure
there aren’t more?”</p>

<p>Like a lot of questions in mathematics, it helps to generalize things. Instead
of focusing on five incenses, let’s ask ourselves, how many unique ways are
there of grouping $n$ elements? This approach lets us ease into the problem,
starting with a simpler case and building complexity gradually.</p>

<p>For $n = 1$, there’s clearly only solution:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/counting_partitions1.png"/></p>

<p>For $n = 2$, there are only two possible solutions. Either the first element is
in a group by itself, or it is in a group with another.</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/counting_partitions2.png"/></p>

<p>For $n = 3$, things start to get more interesting. Let’s repeat the trick we
used for $n = 2$ and focus on the first element. It must either be in a group
by itself, in a pair with another, or in the same group as all others. That
gives us exactly three cases to consider:</p>

<ol>
<li>If the first element in a group by itself, then there are two elements left
over; We showed above that there are two ways to partition them.</li>
<li>If it’s in a pair, then we have a choice: we can either pair it with the
second or third element. In either case there will only be one element left
over.</li>
<li>And there is only one way to have all the elements be in the same
group.</li>
</ol>

<p>Here they all are, in Genji-kō notation:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/counting_partitions3.png"/></p>

<p>Thus, we have $1 \times 2 + 2 \times 1 + 1 = 5$ ways to partition a set of
three elements.</p>

<p>This is starting to look like a repeatable strategy. We always start by
focusing on the first element. We then neatly divide the set of all possible
solutions by the size $k$ of the group containing this first element. For each
$k$ between $1$ and $n$, there are two questions to ask:</p>

<ol>
<li>How many ways are there of choosing the set that contains the first element?</li>
<li>How many ways are there of putting the remaining $n-k$ elements into groups?</li>
</ol>

<p>Let’s try that out for $n = 4$. The other cases are obvious, but let’s focus on
the case where $k = 2$ as there’s a new wrinkle there. We have to choose one
other element from three possible elements, so there are three ways of doing
that. We’ll always have two left over, and there are always two ways of
grouping those together. This these are two independent choices - choosing the
first group, then choosing how to partition the remaining elements, there are
$3 \times 2 = 6$ ways of doing that. This case teaches us that we have to
count both the ways of selecting a set of $k$ elements and the number of ways
to partition the remaining elements, and multiply them together.</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/counting_partitions4.png"/></p>

<p>So, for $n = 4$, there are $1 \times 5 + 3 \times 2 + 3 \times 1 + 1 = 15$
possible solutions.</p>

<h2 id="mathematical-approach">Mathematical Approach</h2>

<p>For the case of $n = 5$, I’ve
<a href="https://www.oranlooney.com/post/genji-ko_files/counting_partitions5.png" target="_blank">generated the diagram</a>
showing how to use the same strategy to count all possible Genji-mon,
but I think it’s more useful to take the strategy we’ve learned and abstract it.</p>

<p>First, let’s use the right terminology. What we’ve so far called a “Genji-mon,”
mathematicians would call a <a href="https://en.wikipedia.org/wiki/Partition_of_a_set">partition</a>. In mathematical terms, the question
we’re asking is, “How many distinct partitions are there for a set of $n$
elements?” This number also has a name: the <a href="https://en.wikipedia.org/wiki/Bell_number">Bell number</a> denoted $B_n$.</p>

<p>Above, we calculated $B_1$ through $B_4$ using a mix of intuition and common
sense. To formalize the strategy we used in mathematical notation we’ll need a
concept you may or may not have seen before: “the number of ways to choose $k$
elements from $n$ distinct elements, ignoring order” is called “$n$ choose $k$”
or the <a href="https://en.wikipedia.org/wiki/Binomial_coefficient">binomial coefficient</a> and is denoted $nCk$ or with this tall
bracket notation:</p>

<p>\[
    \binom{n}{k} = \frac{n!}{k! (n-k)!}
\]</p>

<p>There are many ways of deriving the equation in terms of factorials, but here’s
one I like: imagine we put all $n$ elements in order; there are $n!$ ways of
doing that. Then we always take the $k$ leftmost elements for our choice. However,
because order doesn’t matter, we divided by all the different ways of ordering
the $k$ chosen elements, which is $k!$, and the $n-k$ remaining elements, which
is $(n-k)!$.</p>

<p>With that tool in hand, we can define the Bell numbers recursively. The first
couple can be treated as special cases, since obviously there’s only one way to
partition a set of zero or one elements:</p>

<p>\[
    B_0 = 1,  B_1 = 1
\]</p>

<p>For $n &gt; 1$, we generalize the strategy we discovered above:</p>

<ol>
<li>Pick an arbitrary element to represent the “first element.”</li>
<li>We’ll call whichever set in the partition that contains this first element
the “first set.” Every element is in exactly one set of the partition, so this
uniquely picks out a particular set in the partition.</li>
<li>For each $k$ between $1$ and $n$, consider only partitions where the first
set is of size $k$. This divides the problem up into non-overlapping buckets:
if two partitions have different sized first set, they cannot
possibly be the same.</li>
<li>We have to make a choice about the other $k-1$ elements to include in the
first set, and there are $\binom{n-1}{k-1}$ ways of doing that.</li>
<li>Regardless of which elements we choose for the first set, there will always
be $n-k$ elements left over. They won’t always be the same elements,
but there will always be $n-k$ of them. Thankfully, we already know how many
ways there are to partition a set of $n-k$ elements: it’s $B_{n-k}$.</li>
<li>Since our choices for step 4 and step 5 are independent, we can <em>multiply</em>
the two counts together to get the total number of partitions where the
first set is of size $k$.</li>
<li>Finally, we just have to add up everything for $k$ from $1$ to $n$.</li>
</ol>

<p>In concise mathematical notation, this algorithm is:</p>

<p>\[
    B_{n} = \sum_{k=1}^{n} \binom{n-1}{k-1} B_{n-k}   \tag{1}
\]</p>

<p>We can make this a little neater if we run $k$ from $0$ to $n-1$ instead and
use the fact that $\binom{n}{r} = \binom{n}{n-r}$ to count down instead of up:</p>

<p>\[
    B_{n} = \sum_{k=0}^{n-1} \binom{n-1}{k} B_{k}     \tag{2}
\]</p>

<p>Substituting $n+1$ for $n$ we can put the recurrence relation in an even tidier
form, which is the canonical form you’ll find in textbooks:</p>

<p>\[
    B_{n+1} = \sum_{k=0}^n \binom{n}{k} B_k           \tag{3}
\]</p>

<p>Equation $(3)$ looks a little cleaner and easier to work with, and can be
understood intuitively if you reconceptualize $k$ not as the number of elements
in the first group, but as the number of elements <em>not</em> in the first group.
Shifting to calculating $B_{n+1}$ also allows us to get rid of the “minus
ones” in the original that made the expression seem messy. However, it’s a
little divorced from the intuition about pinning the size of the first set we
used to motivate $(1)$ although of course they’re completely equivalent
mathematically.</p>

<h2 id="computing-bell-numbers">Computing Bell Numbers</h2>

<p>Of these three equivalent equations, $(2)$ is the most natural fit for a Python
implementation because <code>range(n)</code> naturally runs from <code>0</code> to <code>n-1</code> and it makes
far more sense to implement a function for $B_n$ instead of $B_{n+1}$:</p>

<pre><code>def bell_number(n: int) -&gt; int:
    &#34;&#34;&#34;Calculate the Bell number for any integer `n`.&#34;&#34;&#34;
    if n &lt; 0:
        raise ValueError(&#34;The Bell number is not defined for n &lt; 0.&#34;)
    elif n &lt; 2:
        return 1
    else:
        return sum(
            comb(n-1, k) * bell_number(k)
            for k in range(n)
        )
</code></pre>

<p>(Optimizing this function is left as an exercise to the reader, who may find the
techniques described in my earlier article on writing <a href="https://www.oranlooney.com/post/fibonacci/">a fairly fast Fibonacci
function</a> helpful.)</p>

<p>We can use it to calculate the first 20 Bell numbers:</p>

<div id="bell-table">
    <table>
        <thead>
            <tr>
                <th>$n$</th>
                <th>$B_n$</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>0</td>
                <td>1</td>
            </tr>
            <tr>
                <td>1</td>
                <td>1</td>
            </tr>
            <tr>
                <td>2</td>
                <td>2</td>
            </tr>
            <tr>
                <td>3</td>
                <td>5</td>
            </tr>
            <tr>
                <td>4</td>
                <td>15</td>
            </tr>
            <tr>
                <td>5</td>
                <td>52</td>
            </tr>
            <tr>
                <td>6</td>
                <td>203</td>
            </tr>
            <tr>
                <td>7</td>
                <td>877</td>
            </tr>
            <tr>
                <td>8</td>
                <td>4,140</td>
            </tr>
            <tr>
                <td>9</td>
                <td>21,147</td>
            </tr>
            <tr>
                <td>10</td>
                <td>115,975</td>
            </tr>
            <tr>
                <td>11</td>
                <td>678,570</td>
            </tr>
            <tr>
                <td>12</td>
                <td>4,213,597</td>
            </tr>
            <tr>
                <td>13</td>
                <td>27,644,437</td>
            </tr>
            <tr>
                <td>14</td>
                <td>190,899,322</td>
            </tr>
            <tr>
                <td>15</td>
                <td>1,382,958,545</td>
            </tr>
            <tr>
                <td>16</td>
                <td>10,480,142,147</td>
            </tr>
            <tr>
                <td>17</td>
                <td>82,864,869,804</td>
            </tr>
            <tr>
                <td>18</td>
                <td>682,076,806,159</td>
            </tr>
            <tr>
                <td>19</td>
                <td>5,832,742,205,057</td>
            </tr>
            <tr>
                <td>20</td>
                <td>51,724,158,235,372</td>
            </tr>
        </tbody>
    </table>
</div>

<p>And there it is: $B_5 = 52$, confirming that there are exactly 52 Genji-mon,
no more and no fewer.</p>

<h2 id="conclusion">Conclusion</h2>

<p>It’s not too surprising that some of these ideas were worked out over seven
hundred years ago; combinatorics is an easy branch to stumble into when it
arises in connection to some practical problem. It does, however, feel slightly
surreal that it was a bunch of bored nobles playing an esoteric parlor game who
first noticed these patterns and used it to attach literary significance to
their activities. But I’m happy they did so, because they did something we mere
number crunchers would not have thought to do: they made them beautiful.</p>

<hr/>

<h2 id="appendices">Appendices</h2>

<h3 id="appendix-a-source-code">Appendix A: Source Code</h3>

<p>The full <a href="https://github.com/olooney/genjiko">source code</a> use for this article is available on GitHub. The
main Python code is in <a href="https://github.com/olooney/genjiko/blob/main/src/genjiko.py">src/genjiko.py</a> and the <a href="https://github.com/olooney/genjiko/tree/main/notebooks">notebooks</a>
directory contains many examples of usage.</p>

<h3 id="appendix-b-alternative-genji-kō-chart-a-name-chart-a">Appendix B: Alternative Genji-Kō Chart<a name="chart"></a></h3>

<p>Genji-mon are often rendered with thick lines which achieves an interesting
effect with the negative space. By playing around with the parameters a little:</p>

<pre><code>genjiko_df = load_genjiko()
genjiko_df[&#39;Color&#39;] = &#34;black&#34;
draw_annotated_genjiko_grid(
    genjiko_df,
    cell_size=82,
    grid_width=8,
    grid_height=7,
    line_width=14,
    padding=20,
    include_index_label=False,
    include_romaji_label=False,
    grid_indent=1,
)
</code></pre>

<p>We can achieve a very attractive result:</p>

<p><img src="https://www.oranlooney.com/post/genji-ko_files/genjiko_dense.png"/></p>

<h3 id="table">Appendix C: Full Table</h3>

<p>Here is the full table in HTML format, so you can copy-and-paste the kanji and other
fields. The Genji-mon column uses the <a href="https://www.illllli.com/font/symbol/genjiko/">Genji-Kō TrueType font available from
illllli.com</a>.</p>

<p>You can also download this same table as a <a href="https://www.oranlooney.com/post/genji-ko_files/genjiko.csv">UTF-8 encoded CSV file</a>
or <a href="https://www.oranlooney.com/post/genji-ko_files/genjiko.xlsx">Excel spreadsheet</a>.</p>

<div>
    
    <table>
        <thead>
            <tr>
                <th>Chapter</th>
                <th>Kanji</th>
                <th>Romaji</th>
                <th>English</th>
                <th>Partition</th>
                <th>Genji-mon</th>
            </tr>
        </thead>
        <tbody>
            
            <tr>
                <td>2</td>
                <td>帚木</td>
                <td>Hōkigi</td>
                <td>The Broom Tree</td>
                <td>{1}, {2}, {3}, {4}, {5}</td>
                <td>B</td>
            </tr>
            
            <tr>
                <td>3</td>
                <td>空蝉</td>
                <td>Utsusemi</td>
                <td>Utsusemi</td>
                <td>{1}, {2}, {3}, {4, 5}</td>
                <td>C</td>
            </tr>
            
            <tr>
                <td>4</td>
                <td>夕顔</td>
                <td>Yūgao</td>
                <td>Yūgao</td>
                <td>{1}, {2}, {3, 4}, {5}</td>
                <td>D</td>
            </tr>
            
            <tr>
                <td>5</td>
                <td>若紫</td>
                <td>Wakamurasaki</td>
                <td>Young Murasaki</td>
                <td>{1}, {2, 3}, {4, 5}</td>
                <td>E</td>
            </tr>
            
            <tr>
                <td>6</td>
                <td>末摘花</td>
                <td>Suetsumuhana</td>
                <td>The Saffron Flower</td>
                <td>{1, 2, 3, 4}, {5}</td>
                <td>F</td>
            </tr>
            
            <tr>
                <td>7</td>
                <td>紅葉賀</td>
                <td>Momijinoga</td>
                <td>The Festival of Red Leaves</td>
                <td>{1}, {2, 3, 5}, {4}</td>
                <td>G</td>
            </tr>
            
            <tr>
                <td>8</td>
                <td>花宴</td>
                <td>Hana no En</td>
                <td>The Flower Feast</td>
                <td>{1}, {2}, {3, 5}, {4}</td>
                <td>H</td>
            </tr>
            
            <tr>
                <td>9</td>
                <td>葵</td>
                <td>Aoi</td>
                <td>Aoi</td>
                <td>{1, 2}, {3}, {4}, {5}</td>
                <td>I</td>
            </tr>
            
            <tr>
                <td>10</td>
                <td>賢木</td>
                <td>Sakaki</td>
                <td>The Sacred Tree</td>
                <td>{1, 2, 3}, {4, 5}</td>
                <td>J</td>
            </tr>
            
            <tr>
                <td>11</td>
                <td>花散里</td>
                <td>Hana Chiru Sato</td>
                <td>The Village of Falling Flowers</td>
                <td>{1}, {2, 4}, {3, 5}</td>
                <td>K</td>
            </tr>
            
            <tr>
                <td>12</td>
                <td>須磨</td>
                <td>Suma</td>
                <td>Exile at Suma</td>
                <td>{1, 3, 4}, {2, 5}</td>
                <td>L</td>
            </tr>
            
            <tr>
                <td>13</td>
                <td>明石</td>
                <td>Akashi</td>
                <td>Akashi</td>
                <td>{1}, {2, 3}, {4}, {5}</td>
                <td>M</td>
            </tr>
            
            <tr>
                <td>14</td>
                <td>澪標</td>
                <td>Miotsukushi</td>
                <td>The Flood Gauge</td>
                <td>{1}, {2, 4, 5}, {3}</td>
                <td>N</td>
            </tr>
            
            <tr>
                <td>15</td>
                <td>蓬生</td>
                <td>Yomogiu</td>
                <td>The Palace in the Tangled Woods</td>
                <td>{1, 2, 3}, {4}, {5}</td>
                <td>O</td>
            </tr>
            
            <tr>
                <td>16</td>
                <td>関屋</td>
                <td>Sekiya</td>
                <td>A Meeting at the Frontier</td>
                <td>{1}, {2, 3, 4}, {5}</td>
                <td>P</td>
            </tr>
            
            <tr>
                <td>17</td>
                <td>絵合</td>
                <td>Eawase</td>
                <td>The Picture Competition</td>
                <td>{1, 3}, {2, 5}, {4}</td>
                <td>Q</td>
            </tr>
            
            <tr>
                <td>18</td>
                <td>松風</td>
                <td>Matsukaze</td>
                <td>The Wind in the Pine Trees</td>
                <td>{1, 2}, {3, 4}, {5}</td>
                <td>R</td>
            </tr>
            
            <tr>
                <td>19</td>
                <td>薄雲</td>
                <td>Usugumo</td>
                <td>A Wreath of Cloud</td>
                <td>{1}, {2, 3, 4, 5}</td>
                <td>S</td>
            </tr>
            
            <tr>
                <td>20</td>
                <td>朝顔</td>
                <td>Asagao</td>
                <td>Asagao</td>
                <td>{1, 3, 4}, {2}, {5}</td>
                <td>T</td>
            </tr>
            
            <tr>
                <td>21</td>
                <td>乙女</td>
                <td>Otome</td>
                <td>The Maiden</td>
                <td>{1, 3}, {2}, {4}, {5}</td>
                <td>U</td>
            </tr>
            
            <tr>
                <td>22</td>
                <td>玉鬘</td>
                <td>Tamakazura</td>
                <td>Tamakatsura</td>
                <td>{1, 2}, {3, 4, 5}</td>
                <td>V</td>
            </tr>
            
            <tr>
                <td>23</td>
                <td>初音</td>
                <td>Hatsune</td>
                <td>The First Song of the Year</td>
                <td>{1, 3}, {2, 4}, {5}</td>
                <td>W</td>
            </tr>
            
            <tr>
                <td>24</td>
                <td>胡蝶</td>
                <td>Kochō</td>
                <td>The Butterflies</td>
                <td>{1, 4}, {2, 3, 5}</td>
                <td>X</td>
            </tr>
            
            <tr>
                <td>25</td>
                <td>蛍</td>
                <td>Hotaru</td>
                <td>The Glow-Worm</td>
                <td>{1, 2, 4}, {3}, {5}</td>
                <td>Y</td>
            </tr>
            
            <tr>
                <td>26</td>
                <td>常夏</td>
                <td>Tokonatsu</td>
                <td>A Bed of Carnations</td>
                <td>{1}, {2}, {3, 4, 5}</td>
                <td>Z</td>
            </tr>
            
            <tr>
                <td>27</td>
                <td>篝火</td>
                <td>Kagaribi</td>
                <td>The Flares</td>
                <td>{1}, {2, 4}, {3}, {5}</td>
                <td>a</td>
            </tr>
            
            <tr>
                <td>28</td>
                <td>野分</td>
                <td>Nowaki</td>
                <td>The Typhoon</td>
                <td>{1, 2}, {3}, {4, 5}</td>
                <td>b</td>
            </tr>
            
            <tr>
                <td>29</td>
                <td>御幸</td>
                <td>Miyuki</td>
                <td>The Royal Visit</td>
                <td>{1, 3}, {2, 4, 5}</td>
                <td>c</td>
            </tr>
            
            <tr>
                <td>30</td>
                <td>藤袴</td>
                <td>Fujibakama</td>
                <td>Blue Trousers</td>
                <td>{1, 4}, {2}, {3}, {5}</td>
                <td>d</td>
            </tr>
            
            <tr>
                <td>31</td>
                <td>真木柱</td>
                <td>Makibashira</td>
                <td>Makibashira</td>
                <td>{1, 5}, {2, 4}, {3}</td>
                <td>e</td>
            </tr>
            
            <tr>
                <td>32</td>
                <td>梅枝</td>
                <td>Umegae</td>
                <td>The Spray of Plum Blossom</td>
                <td>{1, 2, 3, 5}, {4}</td>
                <td>f</td>
            </tr>
            
            <tr>
                <td>33</td>
                <td>藤裏葉</td>
                <td>Fuji no Uraba</td>
                <td>Fuji no Uraba</td>
                <td>{1}, {2, 5}, {3, 4}</td>
                <td>g</td>
            </tr>
            
            <tr>
                <td>34</td>
                <td>若菜上</td>
                <td>Wakana Jō</td>
                <td>Wakana, Part I</td>
                <td>{1, 2, 5}, {3, 4}</td>
                <td>h</td>
            </tr>
            
            <tr>
                <td>35</td>
                <td>若菜下</td>
                <td>Wakana Ge</td>
                <td>Wakana, Part II</td>
                <td>{1, 3}, {2}, {4, 5}</td>
                <td>i</td>
            </tr>
            
            <tr>
                <td>36</td>
                <td>柏木</td>
                <td>Kashiwagi</td>
                <td>Kashiwagi</td>
                <td>{1, 3, 5}, {2}, {4}</td>
                <td>j</td>
            </tr>
            
            <tr>
                <td>37</td>
                <td>横笛</td>
                <td>Yokobue</td>
                <td>The Flute</td>
                <td>{1, 4, 5}, {2}, {3}</td>
                <td>k</td>
            </tr>
            
            <tr>
                <td>38</td>
                <td>鈴虫</td>
                <td>Suzumushi</td>
                <td>The Bell Cricket</td>
                <td>{1, 5}, {2}, {3, 4}</td>
                <td>l</td>
            </tr>
            
            <tr>
                <td>39</td>
                <td>夕霧</td>
                <td>Yūgiri</td>
                <td>Yūgiri</td>
                <td>{1, 4}, {2}, {3, 5}</td>
                <td>m</td>
            </tr>
            
            <tr>
                <td>40</td>
                <td>御法</td>
                <td>Minori</td>
                <td>The Law</td>
                <td>{1, 4}, {2, 5}, {3}</td>
                <td>n</td>
            </tr>
            
            <tr>
                <td>41</td>
                <td>幻</td>
                <td>Maboroshi</td>
                <td>Mirage</td>
                <td>{1, 5}, {2}, {3}, {4}</td>
                <td>o</td>
            </tr>
            
            <tr>
                <td>42</td>
                <td>匂宮</td>
                <td>Nioumiya</td>
                <td>Niou</td>
                <td>{1, 2, 4}, {3, 5}</td>
                <td>p</td>
            </tr>
            
            <tr>
                <td>43</td>
                <td>紅梅</td>
                <td>Kōbai</td>
                <td>Kōbai</td>
                <td>{1}, {2, 5}, {3}, {4}</td>
                <td>q</td>
            </tr>
            
            <tr>
                <td>44</td>
                <td>竹河</td>
                <td>Takekawa</td>
                <td>Bamboo River</td>
                <td>{1, 5}, {2, 3, 4}</td>
                <td>r</td>
            </tr>
            
            <tr>
                <td>45</td>
                <td>橋姫</td>
                <td>Hashihime</td>
                <td>The Bridge Maiden</td>
                <td>{1, 3, 4, 5}, {2}</td>
                <td>s</td>
            </tr>
            
            <tr>
                <td>46</td>
                <td>椎本</td>
                <td>Shiigamoto</td>
                <td>At the Foot of the Oak Tree</td>
                <td>{1, 4}, {2, 3}, {5}</td>
                <td>t</td>
            </tr>
            
            <tr>
                <td>47</td>
                <td>総角</td>
                <td>Agemaki</td>
                <td>Agemaki</td>
                <td>{1, 4, 5}, {2, 3}</td>
                <td>u</td>
            </tr>
            
            <tr>
                <td>48</td>
                <td>早蕨</td>
                <td>Sawarabi</td>
                <td>Fern Shoots</td>
                <td>{1, 2}, {3, 5}, {4}</td>
                <td>v</td>
            </tr>
            
            <tr>
                <td>49</td>
                <td>宿木</td>
                <td>Yadorigi</td>
                <td>The Mistletoe</td>
                <td>{1, 2, 4, 5}, {3}</td>
                <td>w</td>
            </tr>
            
            <tr>
                <td>50</td>
                <td>東屋</td>
                <td>Azumaya</td>
                <td>The Eastern House</td>
                <td>{1, 2, 5}, {3}, {4}</td>
                <td>x</td>
            </tr>
            
            <tr>
                <td>51</td>
                <td>浮舟</td>
                <td>Ukifune</td>
                <td>Ukifune</td>
                <td>{1, 5}, {2, 3}, {4}</td>
                <td>y</td>
            </tr>
            
            <tr>
                <td>52</td>
                <td>蜻蛉</td>
                <td>Kagerō</td>
                <td>The Gossamer Fly</td>
                <td>{1, 3, 5}, {2, 4}</td>
                <td>z</td>
            </tr>
            
            <tr>
                <td>53</td>
                <td>手習</td>
                <td>Tenarai</td>
                <td>Writing Practice</td>
                <td>{1, 2, 3, 4, 5}</td>
                <td>1</td>
            </tr>
            
        </tbody>
    </table>
</div>

<p>Note that whenever the English column has apparently been left untranslated,
this is because the chapter title is the proper name of one of the characters
from <a href="https://en.wikipedia.org/wiki/The_Tale_of_Genji"><em>The Tale of Genji</em></a>. Translating these would be as nonsensical as
translating “Jack Smith” to “Lifting Device Metal Worker.”</p>

<h3 id="appendix-d-names-for-genji-kō-pattern">Appendix D: Names for Genji-Kō Pattern</h3>

<p id="names">
This table is included merely to illustrate the variety of legitimate ways
to refer to the patterns used in Genji-kō, and to justify my choice to
standardize on Genji-mon. Click on any of the kanji to link directly to
the Google Image Search for that name.
</p>

<table>
  <thead>
    <tr>
      <th>Kanji</th>
      <th>Romaji</th>
      <th>English Translation</th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://www.google.com/search?tbm=isch&amp;q=源氏紋" target="_blank">源氏紋</a></td>
      <td>Genji-mon</td>
      <td>Genji Crest</td>
      <td>844,000</td>
    </tr>
    <tr>
      <td><a href="https://www.google.com/search?tbm=isch&amp;q=源氏香図" target="_blank">源氏香図</a></td>
      <td>Genji-kōzu</td>
      <td>Genji-kō Diagram</td>
      <td>686,000</td>
    </tr>
    <tr>
      <td><a href="https://www.google.com/search?tbm=isch&amp;q=源氏香" target="_blank">源氏香の模様</a></td>
      <td>Genji-kō no Moyō</td>
      <td>Genji-kō Pattern</td>
      <td>400,000</td>
    </tr>
    <tr>
      <td><a href="https://www.google.com/search?tbm=isch&amp;q=源氏香模様" target="_blank">源氏香模様</a></td>
      <td>Genji-kō Moyō</td>
      <td>Genji-kō Design</td>
      <td>479,000</td>
    </tr>
    <tr>
      <td><a href="https://www.google.com/search?tbm=isch&amp;q=源氏香文様" target="_blank">源氏香文様</a></td>
      <td>Genji-kō Monyō</td>
      <td>Genji-kō Motif</td>
      <td>129,000</td>
    </tr>
  </tbody>
</table>

<h3 id="appendix-e-asymptotic-behavior">Appendix E: Asymptotic Behavior</h3>

<p>The Bell numbers grow very fast. The asymptotic growth is approximately:</p>

<p>\[
    B_n \sim \frac{1}{\sqrt{2 \pi n}} \left( \frac{n}{\ln n} \right)^n
\]</p>

<p>Which is just a tiny bit slower than factorials, as you can see if you compare
it to <a href="https://en.wikipedia.org/wiki/Stirling%27s_approximation">Stirling’s approximation</a>.</p>







    </article></div>
  </body>
</html>
