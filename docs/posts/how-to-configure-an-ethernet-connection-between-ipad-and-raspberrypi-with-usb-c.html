<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.andreagrandi.it/posts/howto-configure-ethernet-connection-ipad-raspberrypi-usbc/">Original</a>
    <h1>How to configure an Ethernet connection between iPad and RaspberryPi with USB-C</h1>
    
    <div id="readability-page-1" class="page"><article>
    <header>

    <div>
    
    <header>
        
            <a href="https://www.andreagrandi.it/categories/howto/">
                HowTo
            </a>
        
    </header>
    

    <div>
        <h2>
            <a href="https://www.andreagrandi.it/posts/howto-configure-ethernet-connection-ipad-raspberrypi-usbc/">How to configure an Ethernet connection between iPad and RaspberryPi through USB-C</a>
        </h2>
    
        
        <h3>
            This tutorial explains how to configure an Ethernet connection between an iPad and a RaspberryPi using the USB-C port.
        </h3>
        
    </div>

    
    
    
    
    
    

    
</div>

</header>

    <section>
    
    
    <p>I recently found out (thanks to <a href="https://hamatti.org/posts/my-on-the-go-solution-with-ipad-and-raspberry-pi/" target="_blank" rel="noopener">this article</a> from <strong>Juha-Matti Santala</strong>) that not only <strong>you can power a RaspberryPi device through the USB-C</strong> of an iPad but that you can also <strong>get an ethernet connection</strong> through it</p>
<h2 id="requirements">Requirements
</h2><ul>
<li>an <strong>USB-C iPad</strong> (I used an iPad Air 4th gen)</li>
<li>a <strong>USB-C cable</strong> (I used the one that comes with the iPad)</li>
<li>a <strong>RaspberryPi</strong> (you need at least a RPI 4. I used a RPi 5)</li>
<li>you already have <strong>SSH access to the RaspberryPi</strong> (I wonâ€™t cover this part in this tutorial)</li>
<li>an updated bootloader on the RaspberryPi (check <a href="https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#update-the-bootloader" target="_blank" rel="noopener">this documentation</a>)</li>
</ul>
<h2 id="configuration">Configuration
</h2><ol>
<li>Connect to the RaspberryPi using SSH</li>
<li>Become <strong>super user</strong> on the RaspberryPi: <code>sudo su</code></li>
<li>Edit <code>/boot/firmware/cmdline.txt</code> and add these options <strong>after <code>rootwait</code></strong>:</li>
</ol>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="text"><span><span>modules-load=dwc2,g_ether
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><ol start="4">
<li>Edit <code>/boot/firmware/config.txt</code> and make sure that <code>otg_mode=1</code> is <strong>uncommented</strong>.
Then add this line after the <code>[all]</code> section:</li>
</ol>
<ol start="5">
<li>Use this command to add a new connection:</li>
</ol>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="text"><span><span>nmcli con add type ethernet con-name ethernet-usb0
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><ol start="6">
<li>Edit <code>/etc/NetworkManager/system-connections/ethernet-usb0.nmconnection</code> and make sure you have these settings:</li>
</ol>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span><span>13
</span><span>14
</span><span>15
</span><span>16
</span><span>17
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="text"><span><span>[connection]
</span></span><span><span>id=ethernet-usb0
</span></span><span><span>uuid=&lt;random group of characters here&gt;
</span></span><span><span>type=ethernet
</span></span><span><span>autoconnect=true
</span></span><span><span>interface-name=usb0
</span></span><span><span>  
</span></span><span><span>[ethernet]
</span></span><span><span>  
</span></span><span><span>[ipv4]
</span></span><span><span>method=shared
</span></span><span><span>  
</span></span><span><span>[ipv6]
</span></span><span><span>addr-gen-mode=default
</span></span><span><span>method=auto
</span></span><span><span>  
</span></span><span><span>[proxy]
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><ol start="7">
<li>Edit <code>/usr/local/sbin/usb-gadget.sh</code> and add this:</li>
</ol>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="text"><span><span>#!/bin/bash
</span></span><span><span>
</span></span><span><span>nmcli con up ethernet-usb0
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><ol start="8">
<li>Make the file executable:</li>
</ol>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="text"><span><span>chmod a+rx /usr/local/sbin/usb-gadget.sh
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><ol start="9">
<li>Edit <code>/lib/systemd/system/usbgadget.service</code> and add this:</li>
</ol>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="text"><span><span>[Unit]
</span></span><span><span>Description=My USB gadget
</span></span><span><span>After=NetworkManager.service
</span></span><span><span>Wants=NetworkManager.service
</span></span><span><span>  
</span></span><span><span>[Service]
</span></span><span><span>Type=oneshot
</span></span><span><span>RemainAfterExit=yes
</span></span><span><span>ExecStart=/usr/local/sbin/usb-gadget.sh
</span></span><span><span>  
</span></span><span><span>[Install]
</span></span><span><span>WantedBy=sysinit.target
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><ol start="10">
<li>Enable the service using this command:</li>
</ol>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="text"><span><span>systemctl enable usbgadget.service
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><ol start="11">
<li>Reboot the RaspberryPi:</li>
</ol>
<h2 id="check-the-configuration-is-working">Check the configuration is working
</h2><p>Connect the RaspberryPi to the iPad using the USB-C cable and wait for it to boot. Once it finishes booting up, open <strong>Settings</strong>
on the iPad and check if there is an <strong>Ethernet</strong> section below the <strong>WiFi Connection</strong>. If you find the entry, then it means the connection is successful.</p>
<h2 id="references">References
</h2><p>This tutorial has been written thanks to this other tutorial <a href="https://github.com/verxion/RaspberryPi/blob/main/Pi5-ethernet-and-power-over-usbc.md" target="_blank" rel="noopener">https://github.com/verxion/RaspberryPi/blob/main/Pi5-ethernet-and-power-over-usbc.md</a></p>

</section>


    


    
</article></div>
  </body>
</html>
