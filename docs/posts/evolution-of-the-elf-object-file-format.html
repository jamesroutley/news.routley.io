<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://maskray.me/blog/2024-05-26-evolution-of-elf-object-file-format">Original</a>
    <h1>Evolution of the ELF object file format</h1>
    
    <div id="readability-page-1" class="page"><div id="wrap">
      

      <div>
        <section id="main"><article id="post-evolution-of-elf-object-file-format" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting">
  
  <div>
    
    
      <header>
        
  
    
  

      </header>
    
    <div itemprop="articleBody">
      
        <p>The ELF object file format is adopted by many UNIX-like operating
systems. While I&#39;ve <a href="http://iafisher.com/blog/2024-01-14-exploring-object-file-formats">previously delved
into</a> the control structures of ELF and its predecessors, tracing the
historical evolution of ELF and its relationship with the System V ABI
can be interesting in itself.</p>
<p>The format consists of the generic specification, processor-specific
specifications, and OS-specific specifications. Three key documents
often surface when searching for the generic specification:</p>
<ul>
<li><em>Tool Interface Standard (TIS) Portable Formats Specification,
version 1.2</em> on <a target="_blank" rel="noopener" href="https://refspecs.linuxfoundation.org/">https://refspecs.linuxfoundation.org/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.sco.com/developers/gabi/latest/contents.html"><em>System
V Application Binary Interface - DRAFT - 10 June 2013</em></a> on
www.sco.com</li>
<li><em>Oracle Solaris Linkers and Libraries Guide</em></li>
</ul>
<p>The TIS specification breaks ELF into the generic specification, a
processor-specific specification (x86), and an OS-specific specification
(System V Release 4). However, it has not been updated since 1995. The
Solaris guide, though well-written, includes Solaris-specific extensions
not applicable to Linux and *BSD. This leaves us primarily with the
System V ABI hosted on www.sco.com, which dedicates Chapters 4 and 5 to
the ELF format.</p>
<p>Let&#39;s trace the ELF history to understand its relationship with the
System V ABI.</p>
<h2 id="history">History</h2>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Unix_System_Laboratories">Unix
System Laboratories (USL)</a> created ELF for their System V Release 4
in late 1980s. USL also maintained the System V Application Binary
Interface, of which ELF was a core component. The dynamic shared library
system was contributed by Sun Microsystems from their <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SunOS">SunOS</a> 4.x (in 1988, SunOS
4.0 got an extended a.out format with dynamic shared library
support).</p>
<p>USL intended ELF to be an open standard and published documents about
the format, e.g.</p>
<ul>
<li>In Proceedings of the Summer 1990 USENIX Conference, <em>ELF: An
Object File to Mitigate Mischievous Misoneism</em> by James Q.
Arnold</li>
<li><em>UNIX System V Release 4 Programmer&#39;s Guide: ANSI C and
Programming Support Tools</em> (ISBN 0-13-933706-7) published in
1990</li>
<li><em>System V Application Binary Interface (Standards)</em> (ISBN
0-13-104670-5) published in 1993</li>
</ul>
<p>In 1993, the Tool Interface Standard (TIS) Committee, a consortium of
industry leaders, adopted ELF and developed the &#34;Tool Interface Standard
(TIS) Portable Formats Specification&#34;. Version 1.2 was released in May
1995.</p>
<p>ELF has been very influential. In the 1990s, many Unix and Unix-like
operating systems, including Solaris, IRIX, HP-UX, Linux, and FreeBSD,
switched to ELF. The 86open Project&#39;s FAQ specified:</p>
<blockquote>
<p>Q18: How can you get a single binary to work identically across all
these diverse systems?</p>
<p>Most Unix-on-Intel binary packages are already largely similar.
Almost all such operating systems use the &#34;ELF&#34; binary &#39;packaging&#39;; the
various operating systems have small but significant differences,
though, that make each system&#39;s ELF binary unusable on others&#39;.</p>
</blockquote>
<h3 id="the-evolving-stewardship-of-the-system-v-abi">The evolving
stewardship of the System V ABI</h3>
<p>The Tool Interface Standard (TIS) Committee essentially dissolved
after 1995. The stewardship of the System V ABI, and consequently the
generic ELF specification, has followed a complex path mirroring the
transfer of Unix software assets.</p>
<p>Between 1993 and 2011, Unix assets underwent a few transfers.</p>
<ul>
<li>In 1993, Novell <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Unix_System_Laboratories#Acquisition_by_Novell">acquired
Unix assets</a> including all copyrights, trademarks, and licensing
contracts.</li>
<li>In September 1995, Novell sold the &#34;develop and sell licenses to
Unix binaries&#34; plus &#34;handle source licencees&#34; business to The Santa Cruz
Operation (sometimes referred to as &#34;old SCO&#34;). Novell still owned the
copyrights (<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/SCO_Group,_Inc._v._Novell,_Inc.">SCO
vs Novell</a> verdict).</li>
<li>In 2001, The Santa Cruz Operation sold its Unix software asserts to
Caldera Systems (later renamed The SCO Group, Inc; sometimes referred to
as &#34;new SCO&#34; or &#34;SCOX&#34;).</li>
<li>In 2011, The SCO Group&#39;s Unix software assets were sold off to UnXis
(later renamed Xinuos).</li>
</ul>
<p><strong>The task of maintaining and updating the generic ABI fell to
these successive owners of Unix software assets</strong>. The Santa Cruz
Operation, and later The SCO Group and Xinuos, managed updates and
extensions to the ABI, including the ELF specification.</p>
<p>In this <a target="_blank" rel="noopener" href="https://sourceware.org/cgit/binutils-gdb/commit/?id=723b0f0d39ebe18c9f28e238c9ecc27931faffa7">binutils
commit</a> in November 2000, it was said that <code>e_machine</code>
values should eventually ask <code>registry@sco.com</code> for
blessing.</p>
<p>Dave Prosser had <a target="_blank" rel="noopener" href="http://www.groklaw.net/article.php?story=20040130235310123">maintained</a>
the System V ABI at USL, then The Santa Cruz Operation, and then The SCO
Group. The last maintainer at The SCO Group and UnXis/Xinuous was John
Wolfe, who oversaw updates until his <a target="_blank" rel="noopener" href="https://groups.google.com/g/generic-abi/c/IakWYdGABjQ">departure
from Xinuos</a> in 2015. <strong>The generic ABI (including the ELF
specification) then became unmaintained</strong>.</p>
<p>The final functional update on <a target="_blank" rel="noopener" href="https://www.sco.com/developers/gabi/latest/contents.html">https://www.sco.com/developers/gabi/latest/contents.html</a>
was made in June 2013 <a target="_blank" rel="noopener" href="https://groups.google.com/g/generic-abi/c/9CUHDfWYeu4">for
<code>SHF_COMPRESSED</code></a>. Since then, the specification has
remained frozen.</p>
<h3 id="all-rights-reserved">&#34;All rights reserved&#34;?</h3>
<p>The copyright notices on the SCO website&#39;s documentation for the
System V ABI seem potentially misleading.</p>
<p>The footnotes of <a target="_blank" rel="noopener" href="https://www.sco.com/developers/gabi/1998-04-29/contents.html">https://www.sco.com/developers/gabi/1998-04-29/contents.html</a>
pages today (and in 2003 per web.archive.org) specify:</p>
<blockquote>
<p>© 1997, 1998, 1998 The Santa Cruz Operation, Inc. All rights
reserved.</p>
</blockquote>
<p>The footnotes of <a target="_blank" rel="noopener" href="https://www.sco.com/developers/gabi/latest/contents.html">https://www.sco.com/developers/gabi/latest/contents.html</a>
pages specify:</p>
<blockquote>
<p>© 1997, 1998, 1999, 2000, 2001 The Santa Cruz Operation, Inc. All
rights reserved. © 2002 Caldera International. All rights reserved. ©
2003-2010 The SCO Group. All rights reserved. © 2011-2015 Xinuos Inc.
All rights reserved.</p>
</blockquote>
<p>The repeated phrase &#34;All rights reserved&#34; could be interpreted as
implying exclusive ownership over the ELF format itself. This is
inaccurate, as ELF is an open standard developed through the
collaboration of many organizations and individuals. The Santa Cruz
Operation&#39;s role in the evolution of the System V ABI seems to have been
more of an editor than an innovator. After The Santa Cruz Operation sold
its Unix assets in 2001, the specification has largely stayed unchanged
with occasional constant updates.</p>
<p>The earliest available snapshot on the Wayback Machine dates back to
2003, a time when The SCO Group had assumed ownership and initiated a
lawsuit against IBM, alleging that the success of Linux was due to the
misappropriation of SCO&#39;s technology. Regrettably, earlier snapshots are
unavailable to provide a more complete historical context.</p>
<p><em>Tool Interface Standard (TIS) Portable Formats Specification,
version 1.2</em> effectively <a target="_blank" rel="noopener" href="http://www.groklaw.net/article.php?story=20040722135616439">put
the specification in the public domain</a>:</p>
<blockquote>
<p>The TIS Committee grants you a non-exclusive, worldwide, royalty-free
license to use the information disclosed in this Specification to make
your software TIS-compliant; no other license, express or implied, is
granted or intended hereby.</p>
</blockquote>
<p>Further reading:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://lwn.net/Articles/924577/">The SCO lawsuit, 20 years
later</a></li>
<li><a target="_blank" rel="noopener" href="http://www.groklaw.net/article.php?story=20040722135616439">A Tall
Tale About ELF - by Frank Sorenson, Dr Stupid and PJ</a></li>
<li><a target="_blank" rel="noopener" href="https://lwn.net/Articles/87556/">SCO shows more
code</a></li>
<li><a target="_blank" rel="noopener" href="https://lwn.net/Articles/924577/">The SCO lawsuit, 20 years
later</a></li>
<li><a target="_blank" rel="noopener" href="https://www.sco.com/company/legal/update/website2.3.pdf">SCO&#39;s
Summary Judgment Hearing Binder</a></li>
</ul>
<h3 id="the-generic-abi-google-group">The generic-abi Google Group</h3>
<p>A neutral <a target="_blank" rel="noopener" href="https://groups.google.com/g/generic-abi">Google
Group</a> not affliated with The SCO Group/Xinuous exists for discussing
the generic ABI. Hongjiu Lu might be the owner. The group served as a
platform for OS and toolchain vendors to collaborate. In recent years,
participation has dwindled to primarily representatives from Oracle
Solaris (just Ali Bahrami) and the GNU toolchain.</p>
<p>The reduced activity might not seem critical, as <strong>significant
non-OS-specific changes to the ELF format are infrequent</strong>.</p>
<h2 id="evolution-of-the-generic-abi">Evolution of the generic ABI</h2>
<p><a target="_blank" rel="noopener" href="https://www.sco.com/developers/gabi/latest/revision.html">https://www.sco.com/developers/gabi/latest/revision.html</a>
outlines the evolution of the ELF from 1998 to 2013. Important features
were all available as of April 2001.</p>
<ul>
<li>Symbol visibility</li>
<li><a href="http://iafisher.com/blog/2021-07-25-comdat-and-section-group">Section
groups</a></li>
<li><code>EI_OSABI</code> and <code>EI_ABIVERSION</code></li>
<li><a href="http://iafisher.com/blog/2021-12-19-why-isnt-ld.lld-faster#shf_merge-duplicate-elimination"><code>SHF_MERGE</code>
and <code>SHF_STRINGS</code></a></li>
<li><a href="http://iafisher.com/blog/2021-01-31-metadata-sections-comdat-and-shf-link-order"><code>SHF_LINK_ORDER</code></a></li>
</ul>
<p>However, <strong>discussions regarding these specific features seem
unavailable</strong>. Please let me know if you have any information on
them.</p>
<p>There were merely constant updates from April 2001 to June 2013.
<code>SHF_COMPRESSED</code> was added in June 2013.</p>
<p>The generic-abi Google Group <strong>reached consensus on
proposals</strong> that haven&#39;t been reflected on the www.sco.com
website:</p>
<ul>
<li>2018: <a href="http://iafisher.com/blog/2021-10-31-relative-relocations-and-relr#relr-relative-relocation-format">RELR
relative relocation format</a></li>
<li>2022: <a href="http://iafisher.com/blog/2022-09-09-zstd-compressed-debug-sections"><code>ELFCOMPRESS_ZSTD</code></a></li>
</ul>
<h3 id="a-future-in-flux">A future in flux</h3>
<p>In April 2020, Cary Coutant reached a <a target="_blank" rel="noopener" href="https://groups.google.com/g/generic-abi/c/9OO5vhxb00Y">preliminary
agreement</a> with Xinuos, but <strong>the future remains
uncertain</strong>. While some constants (e.g., <code>e_machine</code>
and <code>EI_OSABI</code> values, <code>ELFCOMPRESS_ZSTD</code>) have
been defined, no functional updates to the ABI have materialized.</p>
<p><strong>The absence of a centralized, up-to-date repository for the
specification complicates matters</strong>. While some clarifications
and consensus have been reached within the generic-abi group, accessing
the latest, definitive text remains a challenge.</p>
<p>A potential solution could be to <strong>decouple the ELF
specification from the broader System V ABI</strong>, as was done in the
past with the TIS specification. This would create a dedicated and
accessible reference for ELF, independent of the broader System V
specificities that are of less general interest.</p>
<p>Despite this uncertainty, innovation within the ELF ecosystem should
continue. Efforts like my own to replace ELF control structures to
reduce object file sizes (e.g., <a href="http://iafisher.com/blog/2024-03-31-a-compact-section-header-table-for-elf">compact
relocations</a>.) can still move forward. In practice, achieving
consensus among major toolchain vendors (GNU and LLVM) may be
sufficient, even without formal approval from the generic ABI. While
aligning with Solaris would be ideal and I will try doing so, this might
not always be feasible due to varying priorities.</p>
<p>FreeBSD, which Xinuos&#39;s OpenServer is based on, utilizes the LLVM
toolchain. Xinuos might indirectly benefit from my heavy involvement
into the LLVM toolchain.</p>
<h2 id="system-v-abi-processor-supplement-psabi">System V ABI Processor
Supplement (psABI)</h2>
<p>Processor-specific details for the System V ABI are found in the
psABI documents. Actively maintained psABIs exist for various
architectures including <a href="http://iafisher.com/blog/2023-04-23-linker-notes-on-aarch32">AArch32</a>, <a href="http://iafisher.com/blog/2023-03-05-linker-notes-on-aarch64">AArch64</a>, LoongArch,
<a href="http://iafisher.com/blog/2023-02-26-linker-notes-on-power-isa">PPC64</a>, RISC-V,
<a href="http://iafisher.com/blog/2024-02-11-toolchain-notes-on-z-architecture">s390x</a>,
<a href="http://iafisher.com/blog/2023-02-19-linker-notes-on-x86">i386, and x86-64</a>.
(These links refer to my notes.)</p>
<p>Many architectures have older or unavailable psABIs. For
instance:</p>
<ul>
<li>ppc32: <em>Power Architecture® 32-bit Application Binary Interface
Supplement 1.0 - Linux &amp; Embedded</em> was published in 2011. <a href="http://iafisher.com/blog/2023-02-26-linker-notes-on-power-isa">My notes</a></li>
<li>MIPS: The most recent o32 ABI dates back to February 1996, and the
n64 ABI is unavailable. The n32 ABI accompanies the discontinued
compiler MIPSpro: <em>MIPSpro N32 ABI Handbook</em>. <a href="http://iafisher.com/blog/2023-09-04-toolchain-notes-on-mips">My notes</a></li>
</ul>
<p>Noteworthy details</p>
<ul>
<li>Architectures like Motorola 6800, which have 16-bit address spaces,
use the ELFCLASS32 format.</li>
<li>Many architectures have never been ported to any System V derivative
OS, but their psABI documents still use the &#34;System V&#34; name.</li>
<li>Some behaviors are not formally documented and can only be found in
the binutils project&#39;s source code.</li>
</ul>
<h2 id="operating-system-specific-abis">Operating System Specific
ABIs</h2>
<p>In the System V ABI, Operating System Specific ABIs (OSABI) are
extensions that provide operating system-specific details to supplement
the generic ABI.</p>
<p>For example, <em>Oracle Solaris Linkers and Libraries Guide</em>
defines the OSABI for Solaris.</p>
<p>The term OSABI is vague and might not be one single document. For
Linux, we need the following two documents:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://sourceware.org/gnu-gabi/">gABI supplement for
program loading and dynamic linking on GNU</a></li>
<li><a target="_blank" rel="noopener" href="https://gitlab.com/x86-psABIs/Linux-ABI/">https://gitlab.com/x86-psABIs/Linux-ABI/</a></li>
</ul>
<p>The Linux Standard Base (LSB) is a related document that aims to
standardize the Linux system interface.</p>
<p>Until the recent introduction of <em>gABI supplement for program
loading and dynamic linking on GNU</em>, <code>SHT_GNU_HASH</code>,
while widely adopted, was absent from any official documentation.</p>
<p>Interestingly, many Linux ABI extensions are generic enough to be
adopted by other operating systems like FreeBSD, suggesting that a
dedicated FreeBSD OSABI document may not be necessary.</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="http://iafisher.com/blog/2024-05-12-exploring-gnu-extensions-in-linux-kernel" id="article-nav-older">
      <strong>Older</strong>
      <p>Exploring GNU extensions in the Linux kernel</p>
    </a>
  
</nav>

  
</article>




</section>
        
          
        
      </div>
      

    </div></div>
  </body>
</html>
