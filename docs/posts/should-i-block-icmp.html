<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://shouldiblockicmp.com/">Original</a>
    <h1>Should I Block ICMP?</h1>
    
    <div id="readability-page-1" class="page"><div>
                    

                    <div id="TheProblem">
                        <h4>The Problem</h4>
                        <p>Many network administrators feel that ICMP is a security risk, and should therefore always be blocked
                        at the firewall.  It is true that ICMP does have some security issues associated with it, and that a lot
                        of ICMP should be blocked.  But this is no reason to block all ICMP traffic!</p>
                        <p>ICMP has many important features; some are useful for troubleshooting, while some are essential for a
                        network to function correctly.  Here are details of some of the important ICMP traffic that you should
                        know about, and consider allowing through your network.</p>
                        <br/>
                    </div>

                    <div id="EchoReqReply">
                        <h4>Echo Request and Echo Reply</h4>
                        <p>We all know these ones - ping is one of the first troubleshooting tools that we all learn.  Yes, if
                        you enable it, it means that your host is now discoverable - but wasn&#39;t your web server already
                        listening on port 80 anyway?  Sure, block this if you really want at your border to your DMZ, but
                        blocking ping traffic inside your network isn&#39;t going to get you much, except harder troubleshooting
                        (&#34;Can you ping your default gateway?&#34;, &#34;No, but I never can, so that doesn&#39;t tell me anything!&#34;).</p>
                        <p>Remember you can also allow this with a given direction in mind; you could decide to let Echo
                        Requests out from your network to the Internet, and Echo Replies from the Internet to your network, but
                        not vice versa.</p>
                        <br/>
                    </div>

                    <div id="FragNeed">
                        <h4>Fragmentation Needed (IPv4) / Packet Too Big (IPv6)</h4>
                        <p>These ones are important.  VERY important.  They are an essential component in 
                        <a href="http://en.wikipedia.org/wiki/Path_MTU_Discovery">Path MTU Discovery</a> (PMTUD), which is an
                        essential part of TCP that allows two hosts to adjust their 
                        <a href="http://en.wikipedia.org/wiki/Maximum_segment_size">TCP Maximum Segment Size</a> (MSS) value to
                        one that will fit in the smallest 
                        <a href="http://en.wikipedia.org/wiki/Maximum_transmission_unit">MTU</a> along the path of links
                        between the two hosts.  If two hosts have a smaller MTU than their own local link on the path between
                        them, and have no means of discovering this, traffic gets silently black-holed; in other words, &#34;you&#39;re
                        gonna have a bad time&#34;.</p>
                        <p>IPv4 packets with the 
                        <a href="http://en.wikipedia.org/wiki/IPv4#Flags">DF bit</a> set (that&#39;s most of them!), or IPv6 packets
                        (remember there&#39;s no fragmentation by routers in IPv6), that are too large for a router to transmit
                        across an interface will result in that router dropping the packet, and generating a Fragmentation
                        Needed / Packet Too Big ICMP error back to the source, which also contains the MTU of the too-small
                        link.  If this error cannot get through to the sender, then the sender will just interpret the lack of
                        ACKs from the receiver as congestion/loss and re-transmit, which of course will also get dropped.  This
                        kind of behaviour is tough to troubleshoot because of course the TCP handshakes all work fine, as they
                        are small packets, but then the session appears to stall as soon as any bulk data transmission
                        occurs.</p>
                        <p><a href="https://www.ietf.org/rfc/rfc4821.txt">RFC 4821</a> was developed to help hosts get around
                        this problem using Packetization Layer Path MTU Discovery (PLPMTUD), which discovers the path MTU by
                        incrementally increasing the MSS to try to find a suitable value for the path.  This removes the
                        dependency on ICMP, and is available in most OS network stacks, but is not as efficient as learning
                        directly what the maximum MTU should be.  So please just allow these ICMP messages through in the first
                        place, okay?</p>
                        <br/>
                    </div>

                    <div id="TimeExc">
                        <h4>Time Exceeded</h4>
                        <p>Traceroute is a very useful tool for troubleshooting network connections between two hosts, detailing
                        each hop on the path.  It does this by sending a packet with a TTL of 1 so that the first hop sends back
                        a Time Exceeded message (including its own source IP), then sending a packet with a TTL of 2, and so on,
                        to discover each hop on the path.</p>
                        <p>Remember when you&#39;ve run it before, and you get a hop or two that can&#39;t be discovered in the middle
                        of your trace?  Or even worse, you try to traceroute to a host and *every* hop can&#39;t be discovered.
                        Annoying, right?  That&#39;s because the person running those routers (or your local firewall) decided to
                        block ICMP Time Exceeded messages.  Don&#39;t be that guy, okay?</p>
                        <br/>
                    </div>

                    <div id="NDP">
                        <h4>NDP and SLAAC (IPv6)</h4>
                        <p>While IPv4 used 
                        <a href="http://en.wikipedia.org/wiki/Address_Resolution_Protocol">Address Resolution Protocol</a> (ARP)
                        for layer 2 to 3 mappings, IPv6 takes a different approach, in the form of 
                        <a href="http://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbour Discovery Protocol</a>
                        (NDP).  NDP provides many functions, including router discovery, prefix discovery, address resolution,
                        and many more besides.  In addition to NDP, 
                        <a href="http://en.wikipedia.org/wiki/IPv6_address#Stateless_address_autoconfiguration">StateLess Address AutoConfiguration</a> 
                        (SLAAC) allows a host to be dynamically configured on the network, similar in concept to DHCP (although
                        DHCPv6 does exist for finer-grained control).</p>
                        <p>These five ICMP types should be permitted within your network (not across your border) in order for
                        these features of IPv6 to function correctly.</p>
                        <br/>
                    </div>

                    <div id="RateLim">
                        <h4>A Word About Rate Limiting</h4>
                        <p>While ICMP messages like the ones covered on this page can be very useful, remember that generating
                        all of these messages takes CPU time on your routers, and generates traffic.  Do you really expect that
                        you should be getting 1000 pings a second through your firewall in a normal situation?  Would that be
                        considered legitimate traffic if you saw it?  Nope, probably not.  Rate limit all of these ICMP traffic
                        types as you see fit for your network; it&#39;s a good line of defence that should not be ignored.</p>
                        <br/>
                    </div>

                    <div id="Read">
                        <h4>Read, Research, Understand</h4>
                        <p>Given that the &#34;to block or not to block&#34; discussion for ICMP seems to always result in confusion,
                        anger, and borderline fanatical disagreements, go ahead and read up on the topic yourself.  Spend time
                        understanding it as fully as you can; there are plenty of links throughout this page alone.  Then you
                        can form your own opinion and make an informed choice about what is best for your network.</p>
                        <br/>
                    </div>

                    
                    <!-- Ad unit 1 -->
                    </div></div>
  </body>
</html>
