<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/pathbird/poetry-kernel">Original</a>
    <h1>Show HN: Jupyter kernel using Poetry for reproducible Python package management</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto">Use per-directory Poetry environments to run Jupyter kernels. No need to install
a Jupyter kernel per Python virtual environment!</p>
<p dir="auto">The idea behind this project is to allow you to capture the exact state of your
environment. This means you can email your work to your peers, and they&#39;ll have
<em>exactly</em> the same set of packages that you do! Reproducibility!</p>
<h2 dir="auto"><a id="user-content-why-not-virtual-environments-venvs" aria-hidden="true" href="#why-not-virtual-environments-venvs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Why not virtual environments (venvs)?</h2>
<p dir="auto">Virtual environments were (and are) an important advancement to Python&#39;s package
management story, but they have a few shortcomings:</p>
<ul dir="auto">
<li>They are not great for reproducibility. Usually, you&#39;ll create a new virtual
environment using a <code>requirements.txt</code> which includes all the direct
dependencies (numpy, pandas, etc.), but not transient dependencies (pandas
depends on pytz for timezone support, for example). And usually, even the
direct dependencies are specified only as minimum (or semver) ranges (e.g.,
<code>numpy&gt;=1.21</code>) which can make it hard or impossible to accurately recreate the
<code>venv</code> later.</li>
<li>With Jupyter, they usually require that the kernels be installed globally.
This means you&#39;ll need need to have a separate kernelspec for every venv you
want to use with Jupyter.</li>
</ul>
<p dir="auto">Poetry uses venvs transparently under the hood by constructing them from the
<code>pyproject.toml</code> and <code>poetry.lock</code> files. The <code>poetry.lock</code> file records the
exact state of dependencies (and transient dependencies) and can be used to more
accurately reproduce the environment.</p>
<p dir="auto">Additionally, Poetry Kernel means you only have to install one kernelspec. It
then uses the <code>pyproject.toml</code> file from the directory of the notebook (or any
parent directory) to choose which environment to run the notebook in.</p>
<h2 dir="auto"><a id="user-content-shameless-plug" aria-hidden="true" href="#shameless-plug"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Shameless plug</h2>
<p dir="auto">The reason we created this package was to make sure that the code environments
created for running student code on Pathbird exactly match your development
environment. Interested in developing interactive, engaging, inquiry-based
lessons for your students?
<a href="https://pathbird.com/" rel="nofollow">Check out Pathbird for more information!</a></p>

<ol dir="auto">
<li><a href="https://python-poetry.org/docs/#installation" rel="nofollow">Install Poetry</a> if not yet
installed.</li>
<li>Install this package:
<div data-snippet-clipboard-copy-content="# NOTE: Do **NOT** install this package in your Poetry project, it should be
# installed at the system or user level.
pip3 install --user poetry-kernel"><pre><span><span>#</span> NOTE: Do **NOT** install this package in your Poetry project, it should be</span>
<span><span>#</span> installed at the system or user level.</span>
pip3 install --user poetry-kernel</pre></div>
</li>
<li>Initialize a Poetry project (only required if you do not have an existing
Poetry project ready to use):

</li>
<li><strong>IMPORTANT:</strong> Add <code>ipykernel</code> to your project&#39;s dependencies:
<div data-snippet-clipboard-copy-content="# In the directory of your Poetry project
poetry add ipykernel"><pre><span><span>#</span> In the directory of your Poetry project</span>
poetry add ipykernel</pre></div>
</li>
<li>Start a &#34;Poetry&#34; Jupyter kernel and see it in action!
<a target="_blank" rel="noopener noreferrer" href="https://github.com/pathbird/poetry-kernel/blob/main/.static/jupyter-screenshot.png"><img src="https://github.com/pathbird/poetry-kernel/raw/main/.static/jupyter-screenshot.png" alt="Jupyter launcher screenshot"/></a></li>
</ol>

<h2 dir="auto"><a id="user-content-kernel-isnt-starting-no-kernel-message" aria-hidden="true" href="#kernel-isnt-starting-no-kernel-message"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Kernel isn&#39;t starting (&#34;No Kernel&#34; message)</h2>
<p dir="auto"><strong>Pro-tip:</strong> Check the output of the terminal window where you launched Jupyter.
It will usually explain why the kernel is failing to start.</p>
<ol dir="auto">
<li>Make sure that you are launching a notebook in a directory/folder that
contains a Poetry project (<code>pyproject.toml</code> and <code>poetry.lock</code> files). You can
turn a directory into a Poetry project by running:</li>
</ol>

<ol start="2" dir="auto">
<li>Make sure that you&#39;ve installed <code>ipykernel</code> into your project:</li>
</ol>

<ol start="3" dir="auto">
<li>
<p dir="auto">Make sure the Poetry project is installed! This is especially important for
projects that you have downloaded from others (<strong>warning:</strong> installing a
Poetry project could run arbitrary code on your computer, make sure you trust
your download first!):</p>

</li>
<li>
<p dir="auto">Still can&#39;t figure it out? Open an issue!</p>
</li>
</ol>
<h2 dir="auto"><a id="user-content-a-package-i-added-wont-import-properly" aria-hidden="true" href="#a-package-i-added-wont-import-properly"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>A package I added won&#39;t import properly</h2>
<p dir="auto">If you added the package <strong>after</strong> starting the kernel, you might need to
restart the kernel for it to see the new package.</p>

<p dir="auto"><a href="https://github.com/pathbird/poetry-kernel/blob/main/FAQ.md">See FAQ.md.</a></p>
</article>
        </div></div>
  </body>
</html>
