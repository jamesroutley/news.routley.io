<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Park07/amradio">Original</a>
    <h1>Show HN: Formally verified FPGA watchdog for AM broadcast in unmanned tunnels</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A 12-channel AM radio broadcast system using Red Pitaya FPGA for emergency alert transmission in unmanned tunnels.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/5b9a231dc5d4ed489c08822f5d71e6b5c66fe3f8ca5d9a63084ce7db166b0b2e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4368616e6e656c732d31322d626c7565"><img src="https://camo.githubusercontent.com/5b9a231dc5d4ed489c08822f5d71e6b5c66fe3f8ca5d9a63084ce7db166b0b2e/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4368616e6e656c732d31322d626c7565" alt="Channels: 12" data-canonical-src="https://img.shields.io/badge/Channels-12-blue"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/38d9e8c3cdecf7fccbdbb3dad8d026a73f259844fa425f60e5ff7577fbf08b94/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f506c6174666f726d2d5265642532305069746179612d726564"><img src="https://camo.githubusercontent.com/38d9e8c3cdecf7fccbdbb3dad8d026a73f259844fa425f60e5ff7577fbf08b94/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f506c6174666f726d2d5265642532305069746179612d726564" alt="Platform: Red Pitaya" data-canonical-src="https://img.shields.io/badge/Platform-Red%20Pitaya-red"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e929dd6ffabe81ade33696f88256adaaa3462fb0dd46c46625e794fc1311d215/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4261636b656e642d527573742d6f72616e6765"><img src="https://camo.githubusercontent.com/e929dd6ffabe81ade33696f88256adaaa3462fb0dd46c46625e794fc1311d215/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4261636b656e642d527573742d6f72616e6765" alt="Backend: Rust" data-canonical-src="https://img.shields.io/badge/Backend-Rust-orange"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/646341cd1ac029e00cd172d1b1c23ad62640b273d0f77aae56d5824669272b4b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f46726f6e74656e642d4a6176615363726970742d79656c6c6f77"><img src="https://camo.githubusercontent.com/646341cd1ac029e00cd172d1b1c23ad62640b273d0f77aae56d5824669272b4b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f46726f6e74656e642d4a6176615363726970742d79656c6c6f77" alt="Frontend: JavaScript" data-canonical-src="https://img.shields.io/badge/Frontend-JavaScript-yellow"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/93027a7ad4c09aa723d7fbd394741987f3a86cf54836d11acd545cd3781760a6/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f466f726d616c5f566572696669636174696f6e2d313425324631345f504153532d627269676874677265656e"><img src="https://camo.githubusercontent.com/93027a7ad4c09aa723d7fbd394741987f3a86cf54836d11acd545cd3781760a6/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f466f726d616c5f566572696669636174696f6e2d313425324631345f504153532d627269676874677265656e" alt="Formal Verification: 14/14 PASS" data-canonical-src="https://img.shields.io/badge/Formal_Verification-14%2F14_PASS-brightgreen"/></a></p>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Feature</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>12 simultaneous carrier frequencies</td>
<td>✅</td>
</tr>
<tr>
<td>Runtime frequency configuration (no hardware changes)</td>
<td>✅</td>
</tr>
<tr>
<td>AM modulation with pre-recorded audio</td>
<td>✅</td>
</tr>
<tr>
<td>Dynamic power scaling</td>
<td>✅</td>
</tr>
<tr>
<td>MVC architecture (Rust + JavaScript)</td>
<td>✅</td>
</tr>
<tr>
<td>Event-driven pub/sub via event bus</td>
<td>✅</td>
</tr>
<tr>
<td>Stateless UI — device is source of truth</td>
<td>✅</td>
</tr>
<tr>
<td>Network polling &amp; auto-reconnect</td>
<td>✅</td>
</tr>
<tr>
<td>Fail-safe hardware watchdog (5s timeout)</td>
<td>✅</td>
</tr>
<tr>
<td>Formal verification (14 properties, 6 covers, all proven)</td>
<td>✅</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/Park07/amradio/blob/main/ugl_am_radio/docs/architecture.png"><img src="https://github.com/Park07/amradio/raw/main/ugl_am_radio/docs/architecture.png" alt="System Architecture"/></a></p>

<ul dir="auto">
<li><strong>Framework</strong>: Rust (Tauri) backend + JavaScript frontend</li>
<li><strong>Architecture</strong>: MVC with event-driven pub/sub</li>
<li><strong>Model</strong> (<code>model.rs</code>): NetworkManager handles TCP/SCPI, device state, 500ms polling, auto-reconnect with exponential backoff</li>
<li><strong>View</strong> (<code>view.js</code>, <code>index.html</code>): Stateless — only renders confirmed device state. Never assumes hardware state.</li>
<li><strong>Controller</strong> (<code>controller.js</code>): Handles user input, publishes events to bus</li>
<li><strong>Event Bus</strong> (<code>event_bus.rs</code>, <code>event_bus.js</code>): Components communicate through a central bus instead of calling each other directly. Rust emits events to JS frontend via Tauri bridge.</li>
<li><strong>State Machine</strong> (<code>state_machine.rs</code>): IDLE → ARMING → ARMED → STARTING → BROADCASTING → STOPPING. Intermediate states prevent invalid transitions.</li>
<li><strong>Source of Truth</strong>: The device, not the software. UI only updates after hardware confirms.</li>
</ul>

<ul dir="auto">
<li><strong>NCO</strong>: 12 Numerically Controlled Oscillators generate carrier frequencies (505–1605 kHz)</li>
<li><strong>AM Modulator</strong>: Combines audio source with each carrier</li>
<li><strong>Dynamic Scaling</strong>: Output power adjusts based on enabled channel count</li>
<li><strong>Audio Buffer</strong>: BRAM stores pre-recorded emergency messages (16,384 sample buffer at ~5 kHz playback rate). AXI audio loader available for runtime loading.</li>
<li><strong>Watchdog Timer</strong> (<code>wd.v</code>): Hardware fail-safe — if GUI heartbeat stops for 5 seconds, RF output is killed and latched. Only manual operator reset restores output.</li>
<li><strong>SCPI Server</strong> (<code>am_scpi_server.py</code>): Runs on Red Pitaya, parses text commands, converts frequencies to phase increments, writes to FPGA registers via <code>/dev/mem</code>.</li>
</ul>

<div data-snippet-clipboard-copy-content="GUI click → invoke(&#34;set_frequency&#34;) → model.rs sends &#34;FREQ:CH1 700000&#34; over TCP
→ am_scpi_server.py converts to phase_inc = (700000 × 2³²) / 125MHz
→ writes to FPGA register via /dev/mem → NCO generates carrier → AM modulates → RF output"><pre><code>GUI click → invoke(&#34;set_frequency&#34;) → model.rs sends &#34;FREQ:CH1 700000&#34; over TCP
→ am_scpi_server.py converts to phase_inc = (700000 × 2³²) / 125MHz
→ writes to FPGA register via /dev/mem → NCO generates carrier → AM modulates → RF output
</code></pre></div>
<hr/>

<p dir="auto">The watchdog timer is mathematically proven correct using bounded model checking and k-induction (SymbiYosys + Z3 SMT solver). Unlike simulation-based testing which checks individual scenarios, formal verification proves correctness across <strong>every possible input, in every possible state, for all time</strong>.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">14 Safety Properties (All PASS)</h3><a id="user-content-14-safety-properties-all-pass" aria-label="Permalink: 14 Safety Properties (All PASS)" href="#14-safety-properties-all-pass"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Category</th>
<th>#</th>
<th>Property</th>
<th>Guarantee</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Basic</strong></td>
<td>1</td>
<td>Reset clears all</td>
<td><code>!rstn</code> → counter=0, triggered=0, warning=0</td>
</tr>
<tr>
<td></td>
<td>2</td>
<td>Heartbeat prevents trigger</td>
<td>Heartbeat resets counter, clears triggered and warning</td>
</tr>
<tr>
<td></td>
<td>6</td>
<td>Disable kills everything</td>
<td><code>!enable</code> → all outputs cleared</td>
</tr>
<tr>
<td></td>
<td>7</td>
<td>Counter bounded</td>
<td>Counter never exceeds TIMEOUT_CYCLES</td>
</tr>
<tr>
<td></td>
<td>8</td>
<td>Force reset works</td>
<td><code>force_reset</code> clears all state</td>
</tr>
<tr>
<td></td>
<td>9</td>
<td>Warning low before threshold</td>
<td>counter &lt; WARNING_CYCLES → warning=0</td>
</tr>
<tr>
<td><strong>Safety</strong></td>
<td>3</td>
<td><strong>No early trigger</strong></td>
<td><strong>triggered ONLY when counter ≥ TIMEOUT_CYCLES</strong></td>
</tr>
<tr>
<td></td>
<td>4</td>
<td>Trigger guaranteed at timeout</td>
<td>Liveness: timeout always fires trigger</td>
</tr>
<tr>
<td></td>
<td>5</td>
<td>Warning before trigger</td>
<td>triggered=1 → warning=1</td>
</tr>
<tr>
<td></td>
<td>5b</td>
<td>Contrapositive</td>
<td>!warning → !triggered</td>
</tr>
<tr>
<td></td>
<td>10</td>
<td>Warning high in zone</td>
<td>counter &gt; WARNING_CYCLES → warning=1</td>
</tr>
<tr>
<td></td>
<td>11</td>
<td>Counter increments correctly</td>
<td>Exactly +1 per clock cycle during counting</td>
</tr>
<tr>
<td><strong>Output</strong></td>
<td>12</td>
<td>time_remaining at zero</td>
<td>counter=0 → time_remaining = TIMEOUT_SEC</td>
</tr>
<tr>
<td></td>
<td>13</td>
<td>time_remaining at trigger</td>
<td>triggered → time_remaining = 0</td>
</tr>
<tr>
<td></td>
<td>14</td>
<td>time_remaining monotonic</td>
<td>Decreases every cycle during counting</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div dir="auto"><h3 tabindex="-1" dir="auto">6 Cover Scenarios (All Reached)</h3><a id="user-content-6-cover-scenarios-all-reached" aria-label="Permalink: 6 Cover Scenarios (All Reached)" href="#6-cover-scenarios-all-reached"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>#</th>
<th>Scenario</th>
<th>Steps</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Trigger fires</td>
<td>23</td>
<td>Counter reaches timeout</td>
</tr>
<tr>
<td>2</td>
<td>Warning without trigger</td>
<td>21</td>
<td>In warning zone, not yet timed out</td>
</tr>
<tr>
<td>3</td>
<td>Exact timeout boundary</td>
<td>22</td>
<td>Counter = TIMEOUT_CYCLES exactly</td>
</tr>
<tr>
<td>4</td>
<td>Last-second heartbeat</td>
<td>19</td>
<td>Heartbeat at counter = T-1</td>
</tr>
<tr>
<td>5</td>
<td>Recovery from triggered</td>
<td>24</td>
<td>Triggered state cleared by force_reset</td>
</tr>
<tr>
<td>6</td>
<td>Warning-to-trigger lifecycle</td>
<td>23</td>
<td>Warning then immediate trigger</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<div dir="auto" data-snippet-clipboard-copy-content="cd fpga/formal/
sby -f wd.sby"><pre><span>cd</span> fpga/formal/
sby -f wd.sby</pre></div>
<p dir="auto">Expected output:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/Park07/amradio/blob/main/ugl_am_radio/docs/symbiyosys_output.png"><img src="https://github.com/Park07/amradio/raw/main/ugl_am_radio/docs/symbiyosys_output.png" alt="SymbiYosys Verification Output"/></a></p>
<div data-snippet-clipboard-copy-content="SBY [wd_prove] DONE (PASS, rc=0)
    summary: successful proof by k-induction.
SBY [wd_cover] DONE (PASS, rc=0)
    summary: 6/6 cover statements reached."><pre><code>SBY [wd_prove] DONE (PASS, rc=0)
    summary: successful proof by k-induction.
SBY [wd_cover] DONE (PASS, rc=0)
    summary: 6/6 cover statements reached.
</code></pre></div>

<p dir="auto">Verification uses <code>CLK_FREQ=1</code>, <code>TIMEOUT_SEC=5</code> to keep state space tractable. Production uses <code>CLK_FREQ=125000000</code>. The RTL is parameterised — same if/else logic, same state transitions. Proof at reduced scale implies correctness at production scale.</p>



<ul dir="auto">
<li>Red Pitaya STEMlab 125-10</li>
<li>AM Radio receiver(s) for testing</li>
<li>Ethernet cable (for Red Pitaya connection)</li>
</ul>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Dependency</th>
<th>macOS</th>
<th>Windows</th>
</tr>
</thead>
<tbody>
<tr>
<td>Rust + Cargo</td>
<td><code>curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh</code></td>
<td>Download <code>rustup-init.exe</code> from <a href="https://rustup.rs" rel="nofollow">rustup.rs</a></td>
</tr>
<tr>
<td>Node.js (LTS)</td>
<td><code>brew install node</code> or <a href="https://nodejs.org" rel="nofollow">nodejs.org</a></td>
<td><a href="https://nodejs.org" rel="nofollow">nodejs.org</a></td>
</tr>
<tr>
<td>Xcode Command Line Tools (macOS only)</td>
<td><code>xcode-select --install</code></td>
<td>—</td>
</tr>
<tr>
<td>Visual Studio Build Tools (Windows only)</td>
<td>—</td>
<td><a href="https://visualstudio.microsoft.com/visual-cpp-build-tools/" rel="nofollow">Download</a> — select <strong>&#34;Desktop development with C++&#34;</strong></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div dir="auto"><h3 tabindex="-1" dir="auto">Formal Verification (optional)</h3><a id="user-content-formal-verification-optional" aria-label="Permalink: Formal Verification (optional)" href="#formal-verification-optional"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>SymbiYosys</li>
<li>Yosys</li>
<li>Z3 SMT solver</li>
</ul>
<hr/>


<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/Park07/amradio.git
cd amradio/ugl_am_radio"><pre>git clone https://github.com/Park07/amradio.git
<span>cd</span> amradio/ugl_am_radio</pre></div>


<div dir="auto" data-snippet-clipboard-copy-content="# Install Rust (if not installed)
curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env

# Install Xcode CLI tools (if not installed)
xcode-select --install

# Install Node.js via Homebrew (if not installed)
brew install node

# Build
cd gui
npm install
npm run build"><pre><span><span>#</span> Install Rust (if not installed)</span>
curl --proto <span><span>&#39;</span>=https<span>&#39;</span></span> --tlsv1.2 -sSf https://sh.rustup.rs <span>|</span> sh
<span>source</span> <span>$HOME</span>/.cargo/env

<span><span>#</span> Install Xcode CLI tools (if not installed)</span>
xcode-select --install

<span><span>#</span> Install Node.js via Homebrew (if not installed)</span>
brew install node

<span><span>#</span> Build</span>
<span>cd</span> gui
npm install
npm run build</pre></div>
<p dir="auto">The built <code>.app</code> will be in <code>gui/src-tauri/target/release/bundle/macos/</code>.</p>

<div dir="auto" data-snippet-clipboard-copy-content="# 1. Install Rust
#    Download and run rustup-init.exe from https://rustup.rs
#    Close and reopen PowerShell after install

# 2. Install Visual Studio Build Tools
#    Download from https://visualstudio.microsoft.com/visual-cpp-build-tools/
#    Select &#34;Desktop development with C++&#34; during installation
#    Close and reopen PowerShell after install

# 3. Install Node.js
#    Download LTS from https://nodejs.org
#    Close and reopen PowerShell after install

# 4. Verify installations
rustc --version
cargo --version
node --version
npm --version

# 5. Build
cd gui
npm install
npm run build"><pre><span><span>#</span> 1. Install Rust</span>
<span><span>#</span>    Download and run rustup-init.exe from https://rustup.rs</span>
<span><span>#</span>    Close and reopen PowerShell after install</span>

<span><span>#</span> 2. Install Visual Studio Build Tools</span>
<span><span>#</span>    Download from https://visualstudio.microsoft.com/visual-cpp-build-tools/</span>
<span><span>#</span>    Select &#34;Desktop development with C++&#34; during installation</span>
<span><span>#</span>    Close and reopen PowerShell after install</span>

<span><span>#</span> 3. Install Node.js</span>
<span><span>#</span>    Download LTS from https://nodejs.org</span>
<span><span>#</span>    Close and reopen PowerShell after install</span>

<span><span>#</span> 4. Verify installations</span>
rustc <span>--</span>version
cargo <span>--</span>version
node <span>--</span>version
npm <span>--</span>version

<span><span>#</span> 5. Build</span>
cd gui
npm install
npm run build</pre></div>
<p dir="auto">The built <code>.exe</code> will be in <code>gui\src-tauri\target\release\</code>.</p>
<blockquote>
<p dir="auto"><strong>Note:</strong> First build takes ~2–3 minutes (compiling Rust). Subsequent builds are faster.</p>
</blockquote>

<p dir="auto">SSH into the Red Pitaya:</p>
<div dir="auto" data-snippet-clipboard-copy-content="ssh root@&lt;RED_PITAYA_IP&gt;
# Default password: root"><pre>ssh root@<span>&lt;</span>RED_PITAYA_IP<span>&gt;</span>
<span><span>#</span> Default password: root</span></pre></div>
<p dir="auto">Copy required files:</p>
<div dir="auto" data-snippet-clipboard-copy-content="
scp am_scpi_server.py root@&lt;RED_PITAYA_IP&gt;:/root/
scp axi_audio_sequence_loop.py root@&lt;RED_PITAYA_IP&gt;:/root/
scp alarm_fast.wav 0009_part1.wav 0009_part2_fast.wav root@&lt;RED_PITAYA_IP&gt;:/root/
scp fpga/red_pitaya_top.bit root@&lt;RED_PITAYA_IP&gt;:/root/"><pre>scp am_scpi_server.py root@<span>&lt;</span>RED_PITAYA_IP<span>&gt;</span>:/root/
scp axi_audio_sequence_loop.py root@<span>&lt;</span>RED_PITAYA_IP<span>&gt;</span>:/root/
scp alarm_fast.wav 0009_part1.wav 0009_part2_fast.wav root@<span>&lt;</span>RED_PITAYA_IP<span>&gt;</span>:/root/
scp fpga/red_pitaya_top.bit root@<span>&lt;</span>RED_PITAYA_IP<span>&gt;</span>:/root/</pre></div>
<p dir="auto"><strong>Note</strong></p>



<div dir="auto"><h3 tabindex="-1" dir="auto">4. Python Environment (Red Pitaya)</h3><a id="user-content-4-python-environment-red-pitaya" aria-label="Permalink: 4. Python Environment (Red Pitaya)" href="#4-python-environment-red-pitaya"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The Red Pitaya runs Alpine Linux with Python 3.5. The SCPI server has no external dependencies (stdlib only). The audio loader requires <code>numpy</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# On Red Pitaya
pip install numpy"><pre><span><span>#</span> On Red Pitaya</span>
pip install numpy</pre></div>
<blockquote>
<p dir="auto"><strong>Note:</strong> The Red Pitaya&#39;s Python 3.5 does not support <code>venv</code> out of the box and runs as root, so packages are installed globally. This is fine — it&#39;s an embedded device, not a shared server.</p>
</blockquote>
<div dir="auto"><h3 tabindex="-1" dir="auto">5. Python Environment (Local Development — optional)</h3><a id="user-content-5-python-environment-local-development--optional" aria-label="Permalink: 5. Python Environment (Local Development — optional)" href="#5-python-environment-local-development--optional"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you want to run or modify the Python scripts locally (e.g. for testing audio processing without the Red Pitaya):</p>
<div dir="auto" data-snippet-clipboard-copy-content="python3 -m venv venv
source venv/bin/activate        # macOS/Linux
# or
.\venv\Scripts\activate         # Windows PowerShell

pip install -r requirements.txt"><pre>python3 -m venv venv
<span>source</span> venv/bin/activate        <span><span>#</span> macOS/Linux</span>
<span><span>#</span> or</span>
.<span>\v</span>env<span>\S</span>cripts<span>\a</span>ctivate         <span><span>#</span> Windows PowerShell</span>

pip install -r requirements.txt</pre></div>
<p dir="auto">Add <code>venv/</code> to <code>.gitignore</code> if not already present.</p>
<hr/>

<p dir="auto">The system plays three audio files in a loop: <strong>Alarm → Part 1 → Part 2 → (repeat)</strong>.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>File</th>
<th>Description</th>
<th>Duration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>alarm_fast.wav</code></td>
<td>Alarm tone</td>
<td>~4 sec</td>
</tr>
<tr>
<td><code>0009_part1.wav</code></td>
<td>Emergency message part 1</td>
<td>~3 sec</td>
</tr>
<tr>
<td><code>0009_part2_fast.wav</code></td>
<td>Emergency message part 2</td>
<td>~3.6 sec</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">All audio is downsampled to ~5 kHz to fit within the FPGA&#39;s 16,384-sample BRAM buffer. The <code>axi_audio_sequence_loop.py</code> script handles resampling, 14-bit conversion, and sequential loading automatically.</p>
<hr/>

<p dir="auto">You need three SSH terminals open to the Red Pitaya, plus one local terminal for the GUI.</p>
<blockquote>
<p dir="auto"><strong>Note:</strong> The Red Pitaya&#39;s IP address may change each time it is powered on. Check your router&#39;s DHCP client list or use <code>ping rp-f0866a.local</code> to find it.</p>
</blockquote>
<div dir="auto"><h3 tabindex="-1" dir="auto">Step 1: Connect to Red Pitaya</h3><a id="user-content-step-1-connect-to-red-pitaya" aria-label="Permalink: Step 1: Connect to Red Pitaya" href="#step-1-connect-to-red-pitaya"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Open a terminal and SSH in:</p>
<div dir="auto" data-snippet-clipboard-copy-content="ssh root@&lt;RED_PITAYA_IP&gt;
# Password: root"><pre>ssh root@<span>&lt;</span>RED_PITAYA_IP<span>&gt;</span>
<span><span>#</span> Password: root</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Step 2: Load the FPGA bitstream</h3><a id="user-content-step-2-load-the-fpga-bitstream" aria-label="Permalink: Step 2: Load the FPGA bitstream" href="#step-2-load-the-fpga-bitstream"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">On the Red Pitaya (first SSH terminal):</p>
<div dir="auto" data-snippet-clipboard-copy-content="cat /root/red_pitaya_top.bit &gt; /dev/xdevcfg"><pre>cat /root/red_pitaya_top.bit <span>&gt;</span> /dev/xdevcfg</pre></div>
<p dir="auto">This loads the AM radio design onto the FPGA. Required after every power cycle.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Step 3: Start the SCPI server</h3><a id="user-content-step-3-start-the-scpi-server" aria-label="Permalink: Step 3: Start the SCPI server" href="#step-3-start-the-scpi-server"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">On the Red Pitaya (same or second SSH terminal):</p>
<div dir="auto" data-snippet-clipboard-copy-content="python3 /root/am_scpi_server.py"><pre>python3 /root/am_scpi_server.py</pre></div>
<p dir="auto">Leave this running — it bridges TCP commands from the GUI to FPGA registers.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Step 4: Start the audio loop</h3><a id="user-content-step-4-start-the-audio-loop" aria-label="Permalink: Step 4: Start the audio loop" href="#step-4-start-the-audio-loop"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Open a second SSH terminal to the Red Pitaya:</p>
<div dir="auto" data-snippet-clipboard-copy-content="ssh root@&lt;RED_PITAYA_IP&gt;
sudo python3 /root/axi_audio_sequence_loop.py"><pre>ssh root@<span>&lt;</span>RED_PITAYA_IP<span>&gt;</span>
sudo python3 /root/axi_audio_sequence_loop.py</pre></div>
<p dir="auto">Expected output:</p>
<div data-snippet-clipboard-copy-content="============================================================
AXI AUDIO SEQUENCE - AUTO LOOP
Alarm -&gt; Part 1 -&gt; Part 2 -&gt; (repeat)
============================================================
Buffer: 16384 samples
FPGA playback rate: 5000 Hz
Press Ctrl+C to stop
============================================================"><pre><code>============================================================
AXI AUDIO SEQUENCE - AUTO LOOP
Alarm -&gt; Part 1 -&gt; Part 2 -&gt; (repeat)
============================================================
Buffer: 16384 samples
FPGA playback rate: 5000 Hz
Press Ctrl+C to stop
============================================================
</code></pre></div>

<p dir="auto">On your local machine:</p>

<p dir="auto">Or run the built binary directly from <code>src-tauri/target/release/</code>.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Step 6: Connect and broadcast</h3><a id="user-content-step-6-connect-and-broadcast" aria-label="Permalink: Step 6: Connect and broadcast" href="#step-6-connect-and-broadcast"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li>Enter the Red Pitaya IP address</li>
<li>Click <strong>Connect</strong></li>
<li>Enable desired channels (1–12)</li>
<li>Adjust frequencies if needed</li>
<li>Click <strong>START BROADCAST</strong></li>
<li>Tune an AM radio to any enabled frequency</li>
</ol>
<div dir="auto"><h3 tabindex="-1" dir="auto">Vivado (for FPGA development only)</h3><a id="user-content-vivado-for-fpga-development-only" aria-label="Permalink: Vivado (for FPGA development only)" href="#vivado-for-fpga-development-only"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you need to modify the FPGA design and rebuild the bitstream, install Vivado 2020.1. Red Pitaya provides a setup guide here:</p>
<p dir="auto"><a href="https://redpitaya.readthedocs.io/en/latest/developerGuide/fpga/getting_started/vivado_install.html" rel="nofollow">https://redpitaya.readthedocs.io/en/latest/developerGuide/fpga/getting_started/vivado_install.html</a></p>
<p dir="auto">All basic Red Pitaya settings and tutorials are available on the <a href="https://redpitaya.readthedocs.io/" rel="nofollow">Red Pitaya official documentation</a>.</p>
<hr/>

<div data-snippet-clipboard-copy-content="ugl_am_radio/
├── gui/
│   ├── src/
│   │   ├── index.html              # HTML + CSS
│   │   └── js/
│   │       ├── event_bus.js        # Frontend pub/sub + Tauri listener
│   │       ├── model.js            # Rust API calls (stateless)
│   │       ├── view.js             # DOM rendering
│   │       └── controller.js       # Event handlers
│   └── src-tauri/src/
│       ├── main.rs                 # Entry point
│       ├── model.rs                # NetworkManager + DeviceState
│       ├── commands.rs             # Tauri command bridge
│       ├── event_bus.rs            # Rust pub/sub + Tauri emit
│       ├── state_machine.rs        # Broadcast state transitions
│       └── config.rs               # Constants
├── fpga/
│   ├── formal/
│   │   ├── wd.v                    # Watchdog + 14 formal properties
│   │   ├── wd.sby                  # SymbiYosys config
│   │   └── README.md               # Formal verification docs
│   ├── am_mod.sv                   # AM modulation module
│   ├── am_radio_ctrl.v             # 12-channel AM radio controller
│   ├── axi_audio_buffer.v          # AXI audio buffer for BRAM playback
│   ├── nco_sin.v                   # Numerically Controlled Oscillator
│   ├── red_pitaya_top.sv           # Top-level FPGA integration
│   ├── sine_lut_4096.mem           # 4096-point sine lookup table
│   └── watchdog_timer.v            # Watchdog timer module (production)
├── am_scpi_server.py               # SCPI server (runs on Red Pitaya)
├── axi_audio_sequence_loop.py      # Audio sequence loader (alarm → part1 → part2 loop)
├── alarm_fast.wav                  # Alarm tone
├── 0009_part1.wav                  # Emergency message part 1
├── 0009_part2_fast.wav             # Emergency message part 2
├── requirements.txt                # Python dependencies (numpy)
└── README.md"><pre><code>ugl_am_radio/
├── gui/
│   ├── src/
│   │   ├── index.html              # HTML + CSS
│   │   └── js/
│   │       ├── event_bus.js        # Frontend pub/sub + Tauri listener
│   │       ├── model.js            # Rust API calls (stateless)
│   │       ├── view.js             # DOM rendering
│   │       └── controller.js       # Event handlers
│   └── src-tauri/src/
│       ├── main.rs                 # Entry point
│       ├── model.rs                # NetworkManager + DeviceState
│       ├── commands.rs             # Tauri command bridge
│       ├── event_bus.rs            # Rust pub/sub + Tauri emit
│       ├── state_machine.rs        # Broadcast state transitions
│       └── config.rs               # Constants
├── fpga/
│   ├── formal/
│   │   ├── wd.v                    # Watchdog + 14 formal properties
│   │   ├── wd.sby                  # SymbiYosys config
│   │   └── README.md               # Formal verification docs
│   ├── am_mod.sv                   # AM modulation module
│   ├── am_radio_ctrl.v             # 12-channel AM radio controller
│   ├── axi_audio_buffer.v          # AXI audio buffer for BRAM playback
│   ├── nco_sin.v                   # Numerically Controlled Oscillator
│   ├── red_pitaya_top.sv           # Top-level FPGA integration
│   ├── sine_lut_4096.mem           # 4096-point sine lookup table
│   └── watchdog_timer.v            # Watchdog timer module (production)
├── am_scpi_server.py               # SCPI server (runs on Red Pitaya)
├── axi_audio_sequence_loop.py      # Audio sequence loader (alarm → part1 → part2 loop)
├── alarm_fast.wav                  # Alarm tone
├── 0009_part1.wav                  # Emergency message part 1
├── 0009_part2_fast.wav             # Emergency message part 2
├── requirements.txt                # Python dependencies (numpy)
└── README.md
</code></pre></div>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">Channel Frequencies (Default)</h2><a id="user-content-channel-frequencies-default" aria-label="Permalink: Channel Frequencies (Default)" href="#channel-frequencies-default"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Channel</th>
<th>Frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td>CH1</td>
<td>505 kHz</td>
</tr>
<tr>
<td>CH2</td>
<td>605 kHz</td>
</tr>
<tr>
<td>CH3</td>
<td>705 kHz</td>
</tr>
<tr>
<td>CH4</td>
<td>805 kHz</td>
</tr>
<tr>
<td>CH5</td>
<td>905 kHz</td>
</tr>
<tr>
<td>CH6</td>
<td>1005 kHz</td>
</tr>
<tr>
<td>CH7</td>
<td>1105 kHz</td>
</tr>
<tr>
<td>CH8</td>
<td>1205 kHz</td>
</tr>
<tr>
<td>CH9</td>
<td>1305 kHz</td>
</tr>
<tr>
<td>CH10</td>
<td>1405 kHz</td>
</tr>
<tr>
<td>CH11</td>
<td>1505 kHz</td>
</tr>
<tr>
<td>CH12</td>
<td>1605 kHz</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Frequencies adjustable at runtime (500–1700 kHz range).</p>
<hr/>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/Park07/amradio/blob/main/ugl_am_radio/docs/state_machine.png"><img src="https://github.com/Park07/amradio/raw/main/ugl_am_radio/docs/state_machine.png" alt="Watchdog State Machine"/></a></p>
<div data-snippet-clipboard-copy-content="Standard watchdog:  device hangs → timer overflows → restarts device → back to normal
This watchdog:      GUI dies → counter hits timeout → kills RF output → stays dead until operator resets"><pre><code>Standard watchdog:  device hangs → timer overflows → restarts device → back to normal
This watchdog:      GUI dies → counter hits timeout → kills RF output → stays dead until operator resets
</code></pre></div>
<p dir="auto"><strong>Why different:</strong> Automatically restarting a radio transmitter in an unmanned tunnel is dangerous. The system requires human confirmation before RF output resumes. Fail-safe, not fail-recover.</p>
<p dir="auto"><strong>Safety margin:</strong> GUI polls every 500ms. Watchdog timeout is 5s. That&#39;s 10 consecutive missed heartbeats before trigger — resilient against transient network delays.</p>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Channels</th>
<th>Signal Strength</th>
<th>Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td>1–2</td>
<td>Excellent</td>
<td>✅ Best quality</td>
</tr>
<tr>
<td>3–4</td>
<td>Good</td>
<td>✅ Recommended max</td>
</tr>
<tr>
<td>5–8</td>
<td>Fair</td>
<td><g-emoji alias="warning">⚠️</g-emoji> May need amplifier</td>
</tr>
<tr>
<td>9–12</td>
<td>Weak</td>
<td><g-emoji alias="warning">⚠️</g-emoji> Short range only</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><strong>Recommendation</strong>: 4–5 channels maximum for reliable reception.</p>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*IDN?</code></td>
<td>Device identification</td>
</tr>
<tr>
<td><code>STATUS?</code></td>
<td>Full device state</td>
</tr>
<tr>
<td><code>OUTPUT:STATE ON/OFF</code></td>
<td>Master broadcast enable</td>
</tr>
<tr>
<td><code>CH1:FREQ 505000</code></td>
<td>Set CH1 frequency (Hz)</td>
</tr>
<tr>
<td><code>CH1:OUTPUT ON/OFF</code></td>
<td>Enable/disable CH1</td>
</tr>
<tr>
<td><code>SOURCE:MSG 1</code></td>
<td>Select audio message</td>
</tr>
<tr>
<td><code>WATCHDOG:RESET</code></td>
<td>Reset watchdog timer</td>
</tr>
<tr>
<td><code>WATCHDOG:STATUS?</code></td>
<td>Query watchdog state</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>


<p dir="auto">11 tests across the backend — state machine transitions, event bus pub/sub, retry logic, and config validation.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cd gui/src-tauri
cargo test"><pre><span>cd</span> gui/src-tauri
cargo <span>test</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Formal Verification (FPGA)</h3><a id="user-content-formal-verification-fpga" aria-label="Permalink: Formal Verification (FPGA)" href="#formal-verification-fpga"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">14 mathematically proven safety properties on the watchdog timer. See the <a href="#formal-verification">Formal Verification</a> section above.</p>

<p dir="auto">For testing the GUI without a Red Pitaya connected:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Terminal 1 — start mock FPGA
cd gui
npm run mock

# Terminal 2 — start GUI
cd gui
npm run dev"><pre><span><span>#</span> Terminal 1 — start mock FPGA</span>
<span>cd</span> gui
npm run mock

<span><span>#</span> Terminal 2 — start GUI</span>
<span>cd</span> gui
npm run dev</pre></div>
<p dir="auto">Then connect to <code>127.0.0.1:5000</code> in the GUI.</p>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Problem</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>No RF output after power cycle</td>
<td>Reload bitstream: <code>cat /root/red_pitaya_top.bit &gt; /dev/xdevcfg</code></td>
</tr>
<tr>
<td>GUI won&#39;t connect</td>
<td>Check IP, ensure SCPI server is running</td>
</tr>
<tr>
<td>No audio, only carrier</td>
<td>Start audio loop: <code>sudo python3 /root/axi_audio_sequence_loop.py</code></td>
</tr>
<tr>
<td><code>file does not start with RIFF id</code></td>
<td>Audio file is not a valid WAV — reconvert with <code>ffmpeg -i input -ac 1 -ar 44100 output.wav</code></td>
</tr>
<tr>
<td>Weak signal</td>
<td>Reduce enabled channels (max 4–5)</td>
</tr>
<tr>
<td>Connection timeout</td>
<td>Check network, Red Pitaya power</td>
</tr>
<tr>
<td>Watchdog triggered unexpectedly</td>
<td>Check network stability, increase timeout if needed</td>
</tr>
<tr>
<td><code>linker &#39;link.exe&#39; not found</code> (Windows)</td>
<td>Install Visual Studio Build Tools with &#34;Desktop development with C++&#34;</td>
</tr>
<tr>
<td><code>cargo not found</code></td>
<td>Restart terminal after Rust install</td>
</tr>
<tr>
<td><code>npm not found</code></td>
<td>Restart terminal after Node.js install</td>
</tr>
<tr>
<td><code>xcode-select</code> errors (macOS)</td>
<td>Run <code>xcode-select --install</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>

<p dir="auto">This project will be inherited by the next EPI cohort. Here&#39;s what you need to know.</p>

<p dir="auto">The full signal chain is functional: GUI → Rust backend → TCP/SCPI → Red Pitaya → FPGA → RF output. Audio playback loops automatically. The watchdog kills RF if the GUI disconnects. All of this has been demonstrated live on hardware.</p>

<p dir="auto">The FPGA audio buffer is limited to 16,384 samples in BRAM, which forces downsampling to ~5 kHz. Longer or higher-quality audio would need external memory (DDR or SD card). The <code>axi_audio_sequence_loop.py</code> script reloads audio over AXI with a ~1.4 second gap between tracks — DMA would eliminate this. Currently only 4–5 channels are practical at usable signal strength; an external RF amplifier stage would allow all 12 channels simultaneously.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Key files to understand first</h3><a id="user-content-key-files-to-understand-first" aria-label="Permalink: Key files to understand first" href="#key-files-to-understand-first"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Read <code>model.rs</code> (the Rust backend — all network logic lives here), <code>am_scpi_server.py</code> (the bridge between TCP commands and FPGA registers), and <code>am_radio_ctrl.v</code> (the register interface between software and hardware). Those three files are the handshake points between every layer of the system.</p>

<p dir="auto">The Red Pitaya IP was <code>192.168.0.101</code> during development. SSH credentials are <code>root</code>/<code>root</code>. The FPGA bitstream loads automatically on boot from the SD card. If the bitstream is missing or corrupted, you&#39;ll need Vivado to rebuild it from the <code>.sv</code>/<code>.v</code> sources in <code>fpga/</code>.</p>

<p dir="auto">For GUI changes: edit JS/HTML in <code>gui/src/</code>, run <code>npm run dev</code> — hot-reloads the frontend. For Rust backend changes: edit files in <code>gui/src-tauri/src/</code>, the dev server recompiles automatically (takes a few seconds). For FPGA changes: edit Verilog in <code>fpga/</code>, synthesise in Vivado, generate new bitstream, copy to Red Pitaya SD card.</p>
<hr/>

<ul dir="auto">
<li><strong>William Park</strong> — Software architecture (GUI, MVC, event bus), hardware watchdog timer, formal verification</li>
<li><strong>Bowen Deng</strong> — FPGA development (NCO, AM modulation, RF output)</li>
</ul>

<ul dir="auto">
<li><strong>UGL Limited</strong> — Project sponsor</li>
<li><strong>University of New South Wales</strong> — EPI program</li>
<li><strong>Robert Mahood</strong> (UGL) — Engineering supervisor</li>
<li><strong>Andrew Wong</strong> (UNSW) — Academic supervisor</li>
</ul>
<p dir="auto"><em>Final Version: 13th February 2026</em></p>
</article></div></div>
  </body>
</html>
