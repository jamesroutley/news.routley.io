<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/jmforsythe/Git-Heat-Map">Original</a>
    <h1>Show HN: Git Heat Map â€“ a tool for visualising git repo activity for each file</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/jmforsythe/Git-Heat-Map/blob/master/example_image.png"><img src="https://github.com/jmforsythe/Git-Heat-Map/raw/master/example_image.png" alt="Map showing the cpython repositiory, highlighting the files that Guido van Rossum changed the most"/></a>
<em>Map showing the cpython repositiory, highlighting the files that Guido van Rossum changed the most</em></p>
<h2 dir="auto"><a id="user-content-basic-use-guide" aria-hidden="true" href="#basic-use-guide"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Basic use guide</h2>
<ul dir="auto">
<li>Generate database with <code>./generate-db.sh {path_to_repo_dir}</code></li>
<li>Run web server with <code>python flask_app.py</code> (flask must be installed, can be install from pip)</li>
<li>Connect on <code>127.0.0.1:5000</code></li>
<li>Available repos will be displayed, select the one you want to view</li>
<li>Select email to search for in the form at the bottom and click submit</li>
</ul>
<p dir="auto">This project consists of two parts:</p>
<ol dir="auto">
<li>Git log -&gt; database</li>
<li>Database -&gt; treemap</li>
</ol>
<h2 dir="auto"><a id="user-content-git-log---database" aria-hidden="true" href="#git-log---database"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Git log -&gt; database</h2>
<p dir="auto">Scans through an entire git history using <code>git log</code>, and creates a database using three tables:</p>
<ul dir="auto">
<li><em>Files</em>, which just keeps track of filenames</li>
<li><em>Commits</em>, which stores commit hash, author, committer</li>
<li><em>CommitFile</em>, which stores an instance of a certain file being changed by a certain commit, and tracks how many lines were added/removed by that commit</li>
<li><em>Author</em>, which stores an author name and email</li>
<li><em>CommitAuthor</em>, which links commits and Author in order to support coauthors on commits</li>
</ul>
<p dir="auto">Using these we can keep track of which files/commits changed the repository the most, which in itself can provide useful insight</p>
<h2 dir="auto"><a id="user-content-database---treemap" aria-hidden="true" href="#database---treemap"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Database -&gt; treemap</h2>
<p dir="auto">Taking the database above, uses an SQL query to generate a JSON object with the following structure:</p>
<div data-snippet-clipboard-copy-content="directory:
  &#34;name&#34;: &lt;Directory name&gt;
  &#34;val&#34;: &lt;Sum of sizes of children&gt;
  &#34;children&#34;: [&lt;directory or file&gt;, ...]

file:
  &#34;name&#34;: &lt;File name&gt;
  &#34;val&#34;: &lt;Total number of line changes for this file over all commits&gt;"><pre><code>directory:
  &#34;name&#34;: &lt;Directory name&gt;
  &#34;val&#34;: &lt;Sum of sizes of children&gt;
  &#34;children&#34;: [&lt;directory or file&gt;, ...]

file:
  &#34;name&#34;: &lt;File name&gt;
  &#34;val&#34;: &lt;Total number of line changes for this file over all commits&gt;
</code></pre></div>
<p dir="auto">then uses this to generate an inline svg image representing a <a href="https://en.wikipedia.org/wiki/Treemapping" title="Wikipedia: Treemapping" rel="nofollow">treemap</a> of the file system, with the size of each rectangle being the <code>val</code> described above.</p>
<p dir="auto">Then generates a second JSON object in a similar manner to above, but filtering for the things we want (only certain emails, date ranges, etc), then uses this to highlight the rectangles in varying intensity based on the <code>val</code>s returned eg highlighting the files changed most by a certain author.</p>
<h2 dir="auto"><a id="user-content-performance" aria-hidden="true" href="#performance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Performance</h2>
<p dir="auto">These speeds were attained on my personal computer.</p>
<h3 dir="auto"><a id="user-content-database-generation" aria-hidden="true" href="#database-generation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Database generation</h3>
<table>
<thead>
<tr>
<th>Repo</th>
<th>Number of commits</th>
<th>Git log time</th>
<th>Git log size</th>
<th>Database time</th>
<th>Database size</th>
<th><strong>Total time</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/torvalds/linux">linux</a></td>
<td>1,154,884</td>
<td>60 minutes</td>
<td>444MB</td>
<td>462.618 seconds</td>
<td>733MB</td>
<td><strong>68 minutes</strong></td>
</tr>
<tr>
<td><a href="https://github.com/python/cpython">cpython</a></td>
<td>115,874</td>
<td>4.6 minutes</td>
<td>44.6MB</td>
<td>36.607 seconds</td>
<td>74.3MB</td>
<td><strong>5.2 minutes</strong></td>
</tr>
</tbody>
</table>
<p dir="auto">Time taken seems to scale linearly, going through approximately 300 commits/second, or requiring 0.0033 seconds/commit.
Database size also scales linearly, with approximately 2600 commits/MB, or requiring 384 B/commit.</p>
<h3 dir="auto"><a id="user-content-querying-database-and-displaying-treemap" aria-hidden="true" href="#querying-database-and-displaying-treemap"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Querying database and displaying treemap</h3>
<p dir="auto">For this test I filtered each repo by its most prominent authors:</p>
<table>
<thead>
<tr>
<th>Repo</th>
<th>Author filter</th>
<th>Time taken</th>
</tr>
</thead>
<tbody>
<tr>
<td>linux</td>
<td><a href="mailto:torvalds@linux-foundation.org">torvalds@linux-foundation.org</a></td>
<td>45.4 seconds</td>
</tr>
<tr>
<td>cpython</td>
<td><a href="mailto:guido@python.org">guido@python.org</a></td>
<td>1.9 seconds</td>
</tr>
</tbody>
</table>
<p dir="auto">Currently <code>treemap.js</code> uses a global variable <code>MIN_AREA</code> to not render smallest files for better performance.</p>
<p dir="auto">While these performances are not as fast as desired, a more typically sized repo should perform fine.</p>
<h2 dir="auto"><a id="user-content-wanted-features" aria-hidden="true" href="#wanted-features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Wanted features</h2>
<h3 dir="auto"><a id="user-content-submodule-tracking" aria-hidden="true" href="#submodule-tracking"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Submodule tracking</h3>
<p dir="auto">Currently the only submodule changes that can be seen are the top level commit pointer changes. In the future would like to recursively explore submodules and add their files to the database.</p>
<h3 dir="auto"><a id="user-content-faster-database-generation" aria-hidden="true" href="#faster-database-generation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Faster database generation</h3>
<p dir="auto">Currently done using git log which can take a very long time for large repos. Will look into any other ways of getting needed information on files.</p>
<h3 dir="auto"><a id="user-content-asynchronous-javascript" aria-hidden="true" href="#asynchronous-javascript"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Asynchronous javascript</h3>
<p dir="auto">Currently no async functions are used. I believe the performance of the webpage could be imporved if things such as file loading and svg drawing was done asynchronously.</p>
<h3 dir="auto"><a id="user-content-remembering-filters" aria-hidden="true" href="#remembering-filters"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Remembering filters</h3>
<p dir="auto">Filters must be re-entered every time the page is loaded. Ideally filters would be remembered either through cookies or by storing the filters as a url query, which would allow users to bookmark queries.</p>
<h3 dir="auto"><a id="user-content-filter-builder-sidebar" aria-hidden="true" href="#filter-builder-sidebar"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Filter builder sidebar</h3>
<p dir="auto">Current interface is very barebones. Want to have a sidebar that will allow users to select authors, date ranges, etc, to control the highlighting.</p>
<h3 dir="auto"><a id="user-content-selectable-colours-per-author" aria-hidden="true" href="#selectable-colours-per-author"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Selectable colours per author</h3>
<p dir="auto">Currently red is hardcoded for all results. In order to show multiple authors we want to highlight in different colours, will need to decide how to colour files edited by both authors.</p>
</article>
          </div></div>
  </body>
</html>
