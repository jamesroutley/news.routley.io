<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.cottongeeks.com/articles/2025-06-24-fun-with-uv-and-pep-723">Original</a>
    <h1>Fun with uv and PEP 723</h1>
    
    <div id="readability-page-1" class="page"><div>                <p>For the longest time, I have been frustrated with Python because I couldn’t use it for one-off scripts. I had to first ensure it was running in an environment where it could find the right Python version and the dependencies installed. That is now a thing of the past.</p>
<h2 id="uv">uv<a aria-hidden="true" tabindex="-1" href="#uv">¶</a></h2>
<p>If you are not a Pythonista (or one possibly living under a rock), <a href="https://docs.astral.sh/uv/">uv</a> is <em>an extremely fast Python package and project manager, written in Rust.</em></p>
<p>uv also provides this nifty tool called <code>uvx</code> (kinda like <code>npx</code> from the Node/NPM ecosystem for Javascript/Typescript packages) which can be used to invoke a Python tool inside a package. <code>uvx</code> takes care of creating a (cached) disposable virtual environment, setting up the right Python version and installing all the dependencies before running.</p>
<p>For example</p>
<pre tabindex="0" data-language="plaintext"><code><span><span>$ uvx ruff --version</span></span>
<span><span>Installed 1 package in 5ms</span></span>
<span><span>ruff 0.12.0</span></span></code></pre>

<p><a href="https://peps.python.org/pep-0723/">PEP 723</a> is a Python Enhancement Proposal that <em>specifies a metadata format that can be embedded in single-file Python scripts to assist launchers, IDEs and other external tools which may need to interact with such scripts.</em></p>
<p>Here is the example directly lifted from the proposal:</p>
<pre tabindex="0" data-language="python"><code><span><span># /// script</span></span>
<span><span># requires-python = &#34;&gt;=3.11&#34;</span></span>
<span><span># dependencies = [</span></span>
<span><span>#   &#34;requests&lt;3&#34;,</span></span>
<span><span>#   &#34;rich&#34;,</span></span>
<span><span># ]</span></span>
<span><span># ///</span></span>
<span></span>
<span><span>import</span><span> requests</span></span>
<span><span>from</span><span> rich.pretty </span><span>import</span><span> pprint</span></span>
<span></span>
<span><span>resp </span><span>=</span><span> requests.get(</span><span>&#34;https://peps.python.org/api/peps.json&#34;</span><span>)</span></span>
<span><span>data </span><span>=</span><span> resp.json()</span></span>
<span><span>pprint([(k, v[</span><span>&#34;title&#34;</span><span>]) </span><span>for</span><span> k, v </span><span>in</span><span> data.items()][:</span><span>10</span><span>])</span></span></code></pre>

<p>Combining uv and the PEP-723 metadata inside a Python script, we can run the script in the previous section as follows:</p>
<pre tabindex="0" data-language="plaintext"><code><span><span>$ uv run pep.py</span></span>
<span><span>Installed 9 packages in 24ms</span></span>
<span><span>[</span></span>
<span><span>│   (&#39;1&#39;, &#39;PEP Purpose and Guidelines&#39;),</span></span>
<span><span>│   (&#39;2&#39;, &#39;Procedure for Adding New Modules&#39;),</span></span>
<span><span>│   (&#39;3&#39;, &#39;Guidelines for Handling Bug Reports&#39;),</span></span>
<span><span>│   (&#39;4&#39;, &#39;Deprecation of Standard Modules&#39;),</span></span>
<span><span>│   (&#39;5&#39;, &#39;Guidelines for Language Evolution&#39;),</span></span>
<span><span>│   (&#39;6&#39;, &#39;Bug Fix Releases&#39;),</span></span>
<span><span>│   (&#39;7&#39;, &#39;Style Guide for C Code&#39;),</span></span>
<span><span>│   (&#39;8&#39;, &#39;Style Guide for Python Code&#39;),</span></span>
<span><span>│   (&#39;9&#39;, &#39;Sample Plaintext PEP Template&#39;),</span></span>
<span><span>│   (&#39;10&#39;, &#39;Voting Guidelines&#39;)</span></span>
<span><span>]</span></span></code></pre>

<p>We can combine things we covered in the previous sections to create a simple executable script that can extract YouTube transcripts.</p>
<p>First we create a Python script with a shebang and inline metadata.</p>
<pre tabindex="0" data-language="python"><code><span><span>#!/usr/bin/env -S uv run --script</span></span>
<span><span># /// script</span></span>
<span><span># requires-python = &#34;&gt;=3.8&#34;</span></span>
<span><span># dependencies = [</span></span>
<span><span>#     &#34;youtube-transcript-api&#34;,</span></span>
<span><span># ]</span></span>
<span><span># ///</span></span>
<span></span>
<span><span>import</span><span> sys</span></span>
<span><span>import</span><span> re</span></span>
<span><span>from</span><span> youtube_transcript_api </span><span>import</span><span> YouTubeTranscriptApi</span></span>
<span><span>from</span><span> youtube_transcript_api.formatters </span><span>import</span><span> TextFormatter</span></span>
<span></span>
<span><span>if</span><span> len</span><span>(sys.argv) </span><span>&lt;</span><span> 2</span><span>:</span></span>
<span><span>    print</span><span>(</span><span>&#39;Usage: provide YouTube URL or video_id as argument&#39;</span><span>, </span><span>file</span><span>=</span><span>sys.stderr)</span></span>
<span><span>    sys.exit(</span><span>1</span><span>)</span></span>
<span></span>
<span><span>url_or_id </span><span>=</span><span> sys.argv[</span><span>1</span><span>]</span></span>
<span></span>
<span><span># Extract video ID from URL if it&#39;s a full URL</span></span>
<span><span>video_id_match </span><span>=</span><span> re.search(</span><span>r</span><span>&#39;</span><span>(?:</span><span>v=</span><span>|</span><span>/</span><span>)([a-zA-Z0-9_-]</span><span>{11}</span><span>)</span><span>&#39;</span><span>, url_or_id)</span></span>
<span><span>if</span><span> video_id_match:</span></span>
<span><span>    video_id </span><span>=</span><span> video_id_match.group(</span><span>1</span><span>)</span></span>
<span><span>else</span><span>:</span></span>
<span><span>    # Assume it&#39;s already a video ID</span></span>
<span><span>    video_id </span><span>=</span><span> url_or_id</span></span>
<span></span>
<span><span>try</span><span>:</span></span>
<span><span>    ytt_api </span><span>=</span><span> YouTubeTranscriptApi()</span></span>
<span><span>    transcript </span><span>=</span><span> ytt_api.fetch(video_id)</span></span>
<span><span>    formatter </span><span>=</span><span> TextFormatter()</span></span>
<span><span>    print</span><span>(formatter.format_transcript(transcript))</span></span>
<span><span>except</span><span> Exception</span><span> as</span><span> e:</span></span>
<span><span>    print</span><span>(</span><span>f</span><span>&#39;Error: </span><span>{</span><span>e</span><span>}</span><span>&#39;</span><span>, </span><span>file</span><span>=</span><span>sys.stderr)</span></span>
<span><span>    sys.exit(</span><span>1</span><span>)</span></span></code></pre>
<p>Note the shebang line: <code>#!/usr/bin/env -S uv run --script</code>. It is important to specify <code>uv run</code> with the <code>--script</code> flag when used on the shebang line.</p>
<p>We save this script as <code>ytt</code> and then make it executable with <code>chmod +x ytt</code>.</p>
<p>We can now run the script like:</p>
<pre tabindex="0" data-language="plaintext"><code><span><span>$ ./ytt https://www.youtube.com/watch?v=zgSQr0d5EVg</span></span>
<span><span>Installed 7 packages in 10ms</span></span>
<span><span>hey it&#39;s Matt here and today I&#39;m going</span></span>
<span><span>to show you how to use UV not only to</span></span>
<span><span>install packages in your python projects</span></span>
<span><span>but to manage entire projects to create</span></span>
<span><span>virtual environments and even how to</span></span>
<span><span>manage entire versions of python with UV</span></span>
<span><span>uh and hopefully you&#39;ll understand by</span></span>
<span><span>any of this video UV is a dropin</span></span>
<span><span></span></span>
<span><span>…&lt;snipped text&gt;…</span></span></code></pre>
<h2 id="fun-times">Fun times<a aria-hidden="true" tabindex="-1" href="#fun-times">¶</a></h2>
<p>This opens up a lot of possibilities for running Python code more seamlessly. Before this I used to prefer <a href="https://go.dev/">Go</a> for one-off scripts because it was easy to create a self-contained binary executable. But now that I could use uv, I coded up a quick MCP server in Python for extracting YouTube transcripts. Check it out on Github at <a href="https://github.com/cottongeeks/ytt-mcp">cottongeeks/ytt-mcp</a>.</p>
<h2 id="more-resources">More resources<a aria-hidden="true" tabindex="-1" href="#more-resources">¶</a></h2>
<ul>
<li><a href="https://docs.astral.sh/uv/guides/scripts/#using-a-shebang-to-create-an-executable-file">Running scripts | uv</a></li>
<li><a href="https://docs.astral.sh/uv/concepts/tools/">Tools | uv</a></li>
<li><a href="https://aider.chat/2025/01/15/uv.html">Using uv as an installer | aider</a></li>
</ul>   </div></div>
  </body>
</html>
