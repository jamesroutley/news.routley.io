<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aaka.sh/posts/20230129-bgp-at-home.html">Original</a>
    <h1>&#34;BGP at home&#34;: getting a DIA circuit installed at home</h1>
    
    <div id="readability-page-1" class="page">
		<a href="https://aaka.sh/"><b>Aakash Patel</b></a>
		

		<p>
		The infrastructure underlying <a href="https://as.ap.foundation" target="_blank">AS54316</a> -- the network supporting the services offered by the <a href="https://ap.foundation" target="_blank">AP Foundation</a> -- has historically been based out of a datacenter in NYC (NetActuate in Telehouse Chelsea). To add some resiliency, I thought it&#39;d be interesting -- and a potentially fun challenge -- to leverage some spare real estate at my home in neighboring Connecticut, rather co-locating at another datacenter location.
		</p>

		<p>
	Hosting &#34;always-on&#34; physical infrastructure poses a few challenges -- climate control, power, security, network connectivity, etc. While each of these are probably worth their own posts (and some still in progress), the last element of network connectivity was a fascinating journey which I thought was worth sharing (taking 2+ months, 2.5+ miles of fiber, a handful of police officers, and 10+ telecom engineers)
		</p>

		<h2>Contents</h2>
		<ul>
			<li>Background</li>
			<li>Finding a solution</li>
			<li>Buying a solution</li>
			<li>Installing the circuit
				<ul>
					<li>Dispatch 1: Site survey</li>
					<li>Dispatch 2: Fiber drop</li>
					<li>Dispatch 3: Network Interface Device (NID) install</li>
					<li>Dispatch 4: The fiber splicing team</li>
					<li>Dispatch 5: NID #2 install</li>
					<li>Activation</li>
				</ul>
			</li>
			<li>Other notes (after a few months of going live)</li>
		</ul>

		<h2>Background</h2>
		<p>
		We manage our own IPv4 and IPv6 address space allocated by ARIN, which is announced under AS54316 by BGP peering with IP transit providers. Getting these transit relationships in a data center setting is quite easy -- your colocation provider might offer it, but cross connects are often available to the likes of global providers like GTT, Cogent, HE, etc (special shout out to <a href="https://neptunenetworks.org" target="_blank">Neptune Networks</a> in NYC, for providing us with affordable IP transit at Telehouse Chelsea)
		</p>
		<p>
		BGP peering in a residential setting proved to be an entirely different story. 
		</p>
		<p>
		I&#39;m lucky to live in an area serviced by two different fiber-to-the-home (FTTH) providers -- Verizon FiOS and Optimum (Altice) -- and I already was using FiOS for personal use. However, bring up the phrase &#34;BGP peering&#34; to either of these providers and quickly see their eyes glaze over...it&#39;s just not something they do since BGP is typically only leveraged by large enterprises. 
		</p>
		<p>
		While it is possible to BGP peer over a VPN connection to VPS providers like Neptune or Vultr (who offer IP transit), I wanted to have confidence in the underlying connectivity as most FTTH providers lack any SLA. 
		</p>

		<p>
		I could have purchased FTTH service from both Verizon FiOS and Optimum, and then multi-homed over VPNs to a VPS, but both ISPs mostly use above-ground infrastructure strung on local power utility poles -- in my area, trees falling on lines seemed like the most likely common point of failure to which both would be equally vulnerable.
		</p>

		<h2>Finding a solution</h2>
		<p>
		Seeking a more sophisticated solution over the FTTH ISPs, I eventually came across the concept of &#34;dedicated internet access&#34; (&#34;DIA&#34;;  or &#34;dedicated ethernet&#34;, depending on who you&#39;re talking to).
		</p>
		<p>
		Almost all non-enterprise FTTH/FTTB ISP services are architected around a shared resource model, where your neighborhood is essentially &#34;sharing&#34; a backhaul circuit to the ISP&#39;s central office (CO) using technologies like passive optical networking (PON). While there are a bunch of interesting technology and economics at play, this architecture enables ISPs to only run a single fiber strand to service an entire neighborhood, leveraging passive optical splitters to break out connections to each home/building (saving on cost in the central office with less equipment, and in the field with less fiber). ISPs tend to oversubscribe these services as well (where you and your 10 neighbors might all be able to sign up for 1Gbps symmetric service, but not everyone can leverage that full 1Gbps at the same time).
		</p>

		<p>
		With DIA on the other hand, the ISP runs a dedicated pair of fibers from a router in their CO, straight to your building, only for your use, with guarantees on bandwidth, uptime, latency, jitter, etc. and importantly, repair time. It&#39;s literally a long fiber connection from your router to the ISP&#39;s &#34;point of presence&#34; (POP) router. These types of services are (as you can imagine) expensive and therefore mostly used by larger enterprises who can justify the cost. But crucial for my use case, DIA providers allow customers to BGP peer with their POP router.
		</p>

		<h2>Buying a solution</h2>
		<p>
		Now that I knew what I was trying to buy, I went shopping for DIA providers that might service my area -- having little idea on what I was getting myself into. The obvious options were Verizon Enterprise and Lightpath (Altice&#39;s enterprise brand), since I knew they already had infrastructure in the area. Though for good measure I reached out to many of the major connectivity players (AT&amp;T, Cogent, Zayo, Crown Castle, Lumen, etc).
		</p>
		<p>
		A few surprises came out of this search:
		</p>
		<ul>
			<li>Some providers flat out rejected the idea of working with &#34;residential zoned&#34; buildings (since connecting -- or &#34;lighting up&#34; -- a commercial building could bring multiple new customers, rather than just one who could churn after a few years).
			</li>
			<li>Others were willing to quote me extremely high monthly minimums, build-outs, and/or year-long construction given permitting requirements, etc. (e.g., one provider quoted $128k to run 1,148ft of fiber to their nearest &#34;live&#34; bundle)
			</li>
			<li>Quickly I learned about the concept of &#34;local exchange carriers&#34; -- a telephone term: a handful of providers were willing to provide service without an up-front build-out cost, but contracted out the &#34;last mile&#34; physical infrastructure to a 3rd party (likely Verizon given their existing right-of-ways in my area, and legacy in telecom). From my research, it seemed these should be avoided if possible (since repairs would involve coordinating with the 3rd party, and could also lead to finger pointing when attempting to establish who is at fault if things go wrong). These were also generally more expensive on a monthly basis.
			</li>
			<li>Some providers rely on contractors to manage their physical infrastructure, rather than staff, and poor coordination can lead to absurd installation / repair times.
			</li>
			<li>Almost all providers require 3-year commitment
			</li>
		</ul>
		<p>
		Ultimately I decided to move forward with Verizon Enterprise given they claimed my home was already &#34;on net&#34; (meaning &#34;on network&#34;, implying no build-out fee), and had transparent pricing which they actually listed on their website (no other provider did). To give an idea of cost, Verizon (and most other providers) will basically sell you whatever circuit speed you want, but often some pre-set &#34;tiers&#34; make the most sense (as of this writing, VZ was pricing 50Mbps committed @ $455/mo; 100Mbps @ $661/mo; 1Gbps @ $999/mo; 5Gbps @ $2,099/mo; and 10Gbps @ $3,099/mo).
		</p>
		<p>
		The above prices are certainly more expensive than FiOS (and way slower for those lower tiers), but remember these circuits are backed with an SLA and come with BGP sessions, dual-stack connectivity, etc. You can also get creative with 95th percentile billing, but the pricing didn&#39;t make sense for my use case (e.g., a circuit with 100Mbps committed, burstable to 1Gbps, was actually more expensive than a 1Gbps committed circuit -- even ignoring overages).
		</p>
		<p>
		Taking the 50Mbps committed tier at $455/mo as an example: the cost consist of two elements: ~$90/mo for the actual internet &#34;access&#34;, with the remaining ~$365/mo going towards the physical layer 1 connectivity (the &#34;port&#34;). More on this later.
		</p>
		<p>
		As part of the service configuration, I was surprisingly able to select the type of network handoff I wanted (e.g., 100base-FX, 1000base-LX, 1000base-T, single-mode, multi-mode, etc) -- coming from lower tier services, I had assumed it&#39;d be a &#34;you get what you get&#34; situation, though this eventually made more sense once I got into the implementation stage.
		</p>
		<p>
		As an aside, the sales process was quite refreshing compared to what I&#39;m used to as well. In many cases, rather than getting connected to a generic call center, I was connected to a specific sales rep. who specialized in the area I was calling about -- and everyone was willing to get a sales engineer involved who was intimately familiar with the nuances.
		</p>

		<h2>Installing the circuit</h2>
		<p>
		This was where the really interesting stuff happened, ultimately taking ~2 months, 10+ Verizon engineers/technicians, 5 dispatches, and a handful of police officers (!).
		</p>
		<p>
		I quickly learned that Verizon actually segments their business into &#34;Verizon Telecom&#34; (handling the physical layer 1 infrastructure) and &#34;Verizon Business&#34; (handling the routing layer). A bulk of the work was by the former.
		</p>
		<p>
		The activation process was managed offshore by a dedicated &#34;order manager&#34; who coordinated internally within Verizon, and served as my main contact point through the installation.
		</p>

		<h2>Dispatch 1: Site survey</h2>
		<p>
		First, Verizon Telecom sent a &#34;High Capacity Outside Plant Engineer&#34; to conduct a site survey. A lovely gentlemen by the name of Roger who had been with Verizon for what I believe was 40+ years. During this time, we walked my street, figured out which utility poles they&#39;d running the fiber drop from, where my house&#39;s service entrance was, and where the server rack will be. He also explained the conduit requirements for their fiber cable in relation to my service entrance and the server rack, and power / rack space requirements for their equipment (4U of space, which seemed like a lot!).
		</p>
		<p>
		I learned that on most major streets they run giant bundles of fiber optic cable (I think he mentioned 800+ strands on some roads?), with many of those strands left dark for future projects like mine. Since I lived right off a major street, he said they&#39;d run a few hundred feet of new fiber, which they&#39;d splice into a larger bundle (with one end ultimately connecting to a switch port in Verizon&#39;s local central office, other end to the server rack).
		</p>

		<p>
		A few days passed while Verizon&#39;s engineering team processed the site survey and planned the construction on their end, and then I eventually got a &#34;firm order commitment&#34; date for around ~1.5 months later (the guaranteed &#34;go-live&#34;). That initially felt like a long time, but once I fully understood the work that went into setting up the circuit, I thought it was quite fast!
		</p>
		<p>
		There was a bunch of work on my end left to do as well -- including installing appropriate power, a service entrance, the server rack, networking equipment, etc. -- which of course took much longer than I planned. Once I completed a few essentials, I submitted a &#34;site ready&#34; certification to Verizon, so they could begin construction on their end.
		</p>

		<h2>Dispatch 2: Fiber drop</h2>
		<p>
		A few weeks later, a crew of four technicians stopped by with a bucket truck to run a new fiber optic cable from the utility pole to the new server rack -- and thanks to some oddities in my local law, also had to have local police to standing by. The crew also installed a 2U fiber patch panel on the rack.
		</p>
		<p>
		Oddly though I noticed the fiber cable wasn&#39;t terminated at either end. After chatting with the crew, it turns out a separate fiber splicing crew would later splice it at the utility pole and the patch panel.
		</p>
		<p>
		For those who are curious, the installed cable was single-mode with 12-strands from Corning, which they ran direct from the utility pole into the rack (compared to the 1-strand cable which was already in place for the FiOS service, and was adapted to an indoor patch cable before entering the building).
		</p>

		<h2>Dispatch 3: Network Interface Device (NID) install</h2>
		<p>
		Later that week another technician stopped by to install a NID, which took 1U of rack space and serves as Verizon&#39;s service demarcation point (where &#34;their problems&#34; are demarcated from &#34;your problems&#34;). These boxes are apparently built to be robust, and allow their NOC engineers to run diagnostics on the network remotely. Being naturally curious, I took a look at closer look at the hardware: it&#39;s a Canoga Perkins 9145E, and on &#34;telecom&#34; (NNI) side there was installed a 40 kilometer 1310nm 1.25Gbps single-mode SPF transceiver, and on the &#34;user&#34; (UNI) side a similar 10km transceiver.
		</p>
		<p>
		Oddly, the version they installed only had a single internal PSU, though the manufacturer offers a dual PSU model (I requested the dual PSU version but was told this was &#34;not Verizon certified&#34;).
		</p>
		<p>
The technician who came by funnily mentioned that never in his career had he been dispatched to install a NID in a house.
		</p>

		<h2>Dispatch 4: The fiber splicing team</h2>
		<p>
		A couple of weeks passed since the last dispatch; after checking in, Verizon said a crew of two splicers were working in manholes to &#34;get the fiber pairs to my site&#34;, meaning from their local central office to the new server rack. Of course that made a lot of sense after thinking about it -- the dark fibers mentioned earlier, which are left unused in the field, are not connected on either end -- so a crew was literally having to fusion splice fiber pairs across a patchwork of bundles throughout town, to ultimately get live pairs to the site.
		</p>
		<p>
		Sure enough, a few days later I saw a handful of police officers and a couple of Verizon trucks at the end of my road (a bucket truck and a splicing van). The next day we made an appointment for them to finish the work inside the house and get the patch panel spliced to the fiber cable which the earlier crew had run. This was a fun conversation and the crew was nice enough to entertain my questions while letting me watch them fusion splice in the house, while the other tech was working on splicing on the utility pole.
		</p>
		<p>
		After they tested the final splices via OTDR, the final run ended up being over ~2.5 miles (!) -- from the local CO to the patch panel.
		</p>
		<p>
		Like the others, it seems these guys were with Verizon for 30+ years and seemed to enjoy their work, having transitioned from the old copper days to new fiber runs.
		</p>
		<p>
		After their work was through, I was a bit confounded on why the circuit still seemed offline -- and then came the last dispatch.
		</p>
		
		<h2>Dispatch 5: NID #2 install</h2>
		<p>
		This is where I began to see the distinction between Verizon Telecom (VzT) and Verizon Business (VzB). While the layer 1 infrastructure had been installed and tested, there still remained the IP layer, which required another dispatch for another technician to install a dedicated NID for Verizon Business -- a Ciena 3903, with 1310nm single mode optics.
		</p>
		<p>
		This NID essentially serves the same function as the first one, but for VzB. VzT provides an EVC to VzB, and apparently I was a customer of the latter (I tried calling Verizon Telecom and it seemed they were not used to getting calls from people like me!).
		</p>
		<p>
		Ultimately, here&#39;s how things ended up getting connected: VZ CO ↔ ~2.5 miles of fiber ↔ VzT NID ↔ VzB NID ↔ our router
		</p>
		
		<h2>Activation</h2>
		<p>
		Once that last NID was installed and tested, I was very shortly later provided with IP details to spin up my connection along with peering details for the BGP session.
		</p>
		<p>
In the activation phase, I was given a couple of interesting bits of information on the underlying Verizon infrastructure. Namely, it seems they rely on a Fujitsu 9500 for DWDM / ROADM and a Juniper MX960 for the gateway / peering router (which is located ~30-40 miles away in NYC, rather than the local CO).
		</p>

		<h2>Other notes (after a few months of going live)</h2>
		<ul>
			<li>There is an additional ~30% Federal Universal Service Fund tax on the &#34;port&#34; fee -- which, as mentioned, makes up a bulk of the monthly recurring cost, so the tax adds a meaningful amount to each bill. This tax fluctuates on a quarterly basis, but it&#39;s something to budget into a cost analysis if you&#39;re considering a DIA circuit (or any circuit with meaningful inter-state traffic)
			</li>
			<li>A bulk of Verizon&#39;s helpdesk has been offshored, which does make it difficult to diagnose intermittent issues sometimes, but for major issues its quite easy to escalate (e.g., anytime a trouble ticket is opened, an automated system checks if your NIDs / router are ping-able and BGP sessions active).
			</li>
			<li>While the SLA says 100%, don&#39;t expect perfection -- I&#39;ve had a handful of momentary flaps over the past few months and a ~30 minute outage (though I still consider this acceptable for our use case).
			</li>
		</ul>
		<p><i>Posted on 01-29-2023. Last modified on 01-31-2023.</i></p>
        

</div>
  </body>
</html>
