<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://evalapply.org/posts/animate-text-art-javascript/index.html">Original</a>
    <h1>Animating Text Art in JavaScript</h1>
    
    <div id="readability-page-1" class="page"><div id="the-very-top">
        
        <main id="main">
          <article id="blog-post">
  <header>
    <div>
      <p>Animating Text Art in JavaScript</p>
      
      <p>It is with no small thanks to MDN, StackOverflow, Firefox&#39;s support for countless open tabs, JavaScript&#39;s support for first-class functions, and first-class supportive colleagues, I learned it is possible for a web front end novice to program &#34;text art animations&#34;. Whatever that is even. Because I thoroughly enjoyed doing just that for Hanukkah of Data 2022. Here&#39;s how it went down.</p>
      
      <hr/>
    </div>
  </header>
  <section>
      
<hr/>
  
<figure>
<img src="https://bun.sh/blog/HanukkahOfData2022ArtSliceCopyrightDwimmertxt.png" alt=""/><figcaption>Slice of text art for <a href="https://hanukkah.bluebird.sh/credits/">Hanukkah of Data 2022</a>, by <a href="#copyright-notice">dwimmer</a>. Solve the puzzles to see it all, <em>or</em> use the cheat noted below. :)</figcaption>
</figure>

<p>A perfectly innocent-looking thread <code>saulpw</code> (a.k.a. <a href="https://www.saul.pw/">Saul Pwanson</a>) started in the <a href="#site-footer">Recurse Center</a> community Zulip. Tame enough to scroll past at first glance. As did I. Lucky me, someone did not. <em>&#34;What&#39;s a data puzzle?&#34;</em>, they asked.</p>
<p>So. Saul wanted to create an <em>AoC-like</em> <a href="#fn1" id="fnref1" role="doc-noteref"><sup>1</sup></a> for data nerds <a href="#fn2" id="fnref2" role="doc-noteref"><sup>2</sup></a>. He elaborated thusly:</p>
<blockquote>
<p>&#34;… they&#39;re puzzles that you solve from the data clues.</p>
<p>Like here&#39;s one: You overhear someone saying that they&#39;re in &#34;the only place in the state where you can join the mile-high club in a church&#34;. And you would get a list of US places and figure out which place it must be.&#34;</p>
<p>— saulpw</p>
</blockquote>
<p>Long story short <a href="#fn3" id="fnref3" role="doc-noteref"><sup>3</sup></a>, there I was, tagging along with a <a href="https://hanukkah.bluebird.sh/credits/">merry band of Devottys and assorted gentlenerds</a>, tryna make a thing.</p>
<p>The goal became to create a local-first game experience. Where the puzzle data set is a file to download (CSV, JSON, SQLITE). Each day, a puzzle question is released to the website. There is no central scoreboard. Stats are personal. Answers are validated locally. Correct answers beget lightings of flames, reveals of parts of a tapestry, complete with animated animals.</p>
<p>Oh yes, Animated Text Art!</p>

<p>&#39;tis Pointillism in motion. Imagination cast as pure data. Digital art with, ah, <em>character</em>.</p>
<pre><code> ⎠(  ⎠/⎞⎜  ⎠⎞  ⎟⎟  ⎛(  ⎞⎞⎛⎛ ⎠⎛⎞ \ ⎞ ᾆ῎ϔᾧᾗ ⎛ /  ⎛⎝  ⎞⎞⎛⎛  ⎠⎛⎝  ⎜⎜ ⎛⎛⎝
 ⎝‿)    ⎝ (‿⎠  ⎟⎛  ⎝‿) ⎟⎟⎜⎜ ⎝‿⎠  ⎞⎟ ⎜;ἷˈɮ ⎜⎛   ⎝‿) ⎟⎟⎜⎜  ⎝‿⎠  ⎞⎜ ⎝‿⎠
  Ɣ        Ɣ    \   Ɣ  ⎠/⎞⎜  Ɣ   ⎟⎟ ⎜.¡ ⎟ ⎜⎜    Ɣ  ⎟⎛\⎝   Ɣ   /   Ɣ
ζ⅋ɧℌ¸    ҁᾯ¡ҩℷ    ʧ₧℘ҩ¸   ⎝ζ⅋ɧℌ¸ ⎟⎛ ⎜ ʖ ⎟ ⎞⎜ ʧ₧℘ҩ¸⎠   ζ⅋ɧℌ¸   ҁᾯ¡ҩ
ᾆ῟¡₰ᾗ    ᾆ῎ϔᾧᾗ    Ḉἧ℃&#39;ῒ   ᾆ῟¡₰ᾗ   \{ìɨʉɨí}/  Ḉἧ℃&#39;ῒ    ᾆ῟¡₰ᾗ    ᾆ῎ϔᾧ
⎜¸ƾ῟ἷ    ⎜;ἷˈɮ    ⎜Ҹ῏῝ʖ    ⎜¸ƾ῟ἷ    )ˊ⁀ˋ(     ⎜Ҹ῏῝ʖ    ⎜¸ƾ῟ἷ    ⎜;ἷˈ
</code></pre>
<p>Lots of character in fact. Each <code>UTF8</code> character chosen with care. Each instance of each character lovingly hand-picked, painstakingly hand-placed, and coloured. <em>Animated</em> Text Art is several frames worth of this loving, caring, painstaking arrangement of plain text. Maybe two frames that blink at you, maybe forty-two that make a candle flame dance. A craft that hearkens back to <em>Ye Olde</em> days of hand-drawn animation.</p>
<figure>
<img src="https://bun.sh/blog/HanukkahOfData2022DarkDrawDrawingViewCopyrightDwimmer.png" alt=""/><figcaption><a href="https://instagram.com/dwimmertxt">dwimmer</a> created the Text Art with <a href="https://github.com/devottys/darkdraw">DarkDraw</a>, in <a href="https://www.visidata.org/">VisiData</a>.</figcaption>
</figure>
<figure>
<img src="https://bun.sh/blog/HanukkahOfData2022DarkDrawSheetViewCopyrightDwimmer.png" alt=""/><figcaption>The &#34;Backing Sheet&#34; view, of the drawing, in DarkDraw + VisiData.</figcaption>
</figure>
<p>And here it is, exported as JSON:</p>
<div id="cb2"><pre><code><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>{<span>&#34;id&#34;</span><span>:</span> <span>&#34;off&#34;</span><span>,</span> <span>&#34;type&#34;</span><span>:</span> <span>&#34;frame&#34;</span><span>,</span> <span>&#34;text&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;tags&#34;</span><span>:</span> []<span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;duration_ms&#34;</span><span>:</span> <span>100</span>}<span>,</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>{<span>&#34;id&#34;</span><span>:</span> <span>&#34;on&#34;</span><span>,</span> <span>&#34;type&#34;</span><span>:</span> <span>&#34;frame&#34;</span><span>,</span> <span>&#34;text&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;tags&#34;</span><span>:</span> []<span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;duration_ms&#34;</span><span>:</span> <span>100</span>}<span>,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>{<span>&#34;x&#34;</span><span>:</span> <span>76</span><span>,</span> <span>&#34;y&#34;</span><span>:</span> <span>5</span><span>,</span> <span>&#34;text&#34;</span><span>:</span> <span>&#34;</span><span>\u0194</span><span>&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;88&#34;</span><span>,</span> <span>&#34;tags&#34;</span><span>:</span> [<span>&#34;wick&#34;</span><span>,</span> <span>&#34;day1&#34;</span>]<span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;frame&#34;</span><span>:</span> <span>&#34;on&#34;</span><span>,</span> <span>&#34;href&#34;</span><span>:</span> <span>&#34;1&#34;</span>}<span>,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>{<span>&#34;x&#34;</span><span>:</span> <span>40</span><span>,</span> <span>&#34;y&#34;</span><span>:</span> <span>1</span><span>,</span> <span>&#34;text&#34;</span><span>:</span> <span>&#34;</span><span>\u0194</span><span>&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;88&#34;</span><span>,</span> <span>&#34;tags&#34;</span><span>:</span> [<span>&#34;wick&#34;</span><span>,</span> <span>&#34;day0&#34;</span>]<span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;frame&#34;</span><span>:</span> <span>&#34;on&#34;</span>}<span>,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>{<span>&#34;x&#34;</span><span>:</span> <span>46</span><span>,</span> <span>&#34;y&#34;</span><span>:</span> <span>11</span><span>,</span> <span>&#34;text&#34;</span><span>:</span> <span>&#34;{&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;255 bold&#34;</span><span>,</span> <span>&#34;tags&#34;</span><span>:</span> [<span>&#34;menorah&#34;</span>]<span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;frame&#34;</span><span>:</span> <span>&#34;off&#34;</span>}<span>,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>{<span>&#34;x&#34;</span><span>:</span> <span>52</span><span>,</span> <span>&#34;y&#34;</span><span>:</span> <span>11</span><span>,</span> <span>&#34;text&#34;</span><span>:</span> <span>&#34;}&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;255 bold&#34;</span><span>,</span> <span>&#34;tags&#34;</span><span>:</span> [<span>&#34;menorah&#34;</span>]<span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;frame&#34;</span><span>:</span> <span>&#34;off&#34;</span>}</span></code></pre></div>
<p>But, honestly, &#39;tis awesome sauce that mere pictures do not do justice to.</p>
<p>Go <a href="https://hanukkah.bluebird.sh/">play Hanukkah of Data</a> to uncover the art and animations for yourself! Or cheat <a href="#fn4" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>

<figure>
<img src="https://bun.sh/blog/HanukkahOfData2022ArtCopyrightDwimmertxt.png" alt=""/><figcaption>Browser rendering of the delightful Text Art for Hanukkah of Data, by <a href="https://instagram.com/dwimmertxt">dwimmer</a>.</figcaption>
</figure>
<p>Text Art can literally be Javascript too, if your artist draws in <a href="https://github.com/devottys/darkdraw">DarkDraw</a> and your build pipeline exports plain text <code>ddw</code> file contents straight into handy JSON arrays.</p>
<div id="cb3"><pre><code><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span>for</span> <span>i</span> in menorah tapestry flame <span>;</span> <span>do</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    <span>echo</span> -n <span>&#34;const </span><span>${i}</span><span>DDW = &#34;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    <span>vd</span> -b resources/<span>${i}</span>.ddw -o - --save-filetype json</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span>done</span> <span>&gt;</span> <span>assets/js/text_art_data.js</span></span></code></pre></div>
<p>And this is where the front end novice—yours truly—begins to git forge ahead, footguns in both hands, pointed squarely at feet, after this fateful utterance…</p>
<blockquote>
<p><em>&#34;Sure, I&#39;ll try to Javascript the Text Art Animation.&#34;</em>.</p>
<p>— Yours Truly</p>
</blockquote>
<p>A foolish line, as I was soon to discover.</p>
<p>For it was a thing I had never really done. Write Javascript, I mean. The foolishness comes naturally. Luckily it was virtue this time. If I had known how much I&#39;d sweat trying to do justice to the talented <a href="https://instagram.com/dwimmertxt">dwimmer&#39;s</a> Text Art, I&#39;d have quietly stayed home.</p>
<p>Still… I knew that Javascript is a fairly <em><a href="https://evalapply.org/tags/functional_programming/index.html#main">Functional</a></em> language, which provided comfort that I could do <em>something</em>. In the end, I think it came out alright, in about 200 lines of code, warts and all.</p>
<div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span>grep</span> --count -v -E <span>\</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>     <span>-e</span> <span>&#34;^$&#34;</span> -e <span>&#34;//&#34;</span> -e <span>&#34;/|\s+\*.*&#34;</span> <span>\</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>     <span>assets/js/text_artist.js</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span>213</span></span></code></pre></div>

<p>Spreadsheets are a personal favourite tool. Commonplace problems tend to fit snugly into spreadsheet-like models and behaviours. When confronted by a new problem, I invariably make tables to make sense of it. And I&#39;ve used spreadsheets a lot in off-label ways too (Ever created dynamic data-driven app mock-ups in Excel?). Yet, it took some doing before I finally <em>saw</em> that I can (should) use the web browser + DOM as a <em>dynamic medium</em> to play with rather than an <em>inert target</em> to overwrite.</p>
<h2 id="how-it-began-the-dom-as-a-data-structure">How it began: The DOM as a data structure</h2>
<p>Text art was arranged in terms of 2D matrices (Javascript array-of-arrays). That was translated to HTML with which to replace DOM contents entirely, viz. <code>artcontext.append(htmlizeArtSheet(art_sheet))</code>, as seen here:</p>
<details>
<summary>
<code>Treating the browser as an inert target.</code>
<hr/>
</summary><code>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span>function</span> <span>updateDom</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>    artcontext <span>=</span> <span>document</span><span>.</span><span>querySelector</span>(<span>&#39;.textart&#39;</span>)<span>,</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>    max_cols <span>=</span> MAX_COLS<span>,</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    max_rows <span>=</span> MAX_ROWS) {</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    <span>// with reference to ./tapestry_test.html</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>    <span>// This represents a flame animation sequence spread over 41 frames.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>    <span>const</span> flame_ddw_animation <span>=</span> <span>ddwChars</span>(candleFlameAnimatedDDW)<span>;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>    <span>// Just pulling out arbitrary shapes of the flame, to place over</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    <span>// each candle position.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>    <span>const</span> nine_flames <span>=</span> [<span>&#34;0&#34;</span><span>,</span> <span>&#34;1&#34;</span><span>,</span> <span>&#34;2&#34;</span><span>,</span> <span>&#34;3&#34;</span><span>,</span> <span>&#34;5&#34;</span><span>,</span> <span>&#34;8&#34;</span><span>,</span> <span>&#34;13&#34;</span><span>,</span> <span>&#34;21&#34;</span><span>,</span> <span>&#34;34&#34;</span>]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>          <span>.</span><span>reduce</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>              <span>function</span> (flame_frames<span>,</span> frame_id<span>,</span> idx) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>                  flame_frames[idx] <span>=</span> flame_ddw_animation<span>.</span><span>filter</span>(char <span>=&gt;</span> char<span>.</span><span>frame</span> <span>==</span> frame_id)<span>;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>                  <span>return</span> flame_frames<span>;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>              }<span>,</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>              [])<span>;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>    <span>// Offset each flame data to coordinates that place each flame over</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>    <span>// each candle&#39;s wick.</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>    <span>const</span> nine_flames_transposed <span>=</span> [{<span>x</span><span>:</span>  <span>3</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span> {<span>x</span><span>:</span> <span>11</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span> {<span>x</span><span>:</span> <span>20</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a>                                    {<span>x</span><span>:</span> <span>29</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span> {<span>x</span><span>:</span> <span>39</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span> {<span>x</span><span>:</span> <span>48</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a>                                    {<span>x</span><span>:</span> <span>57</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span> {<span>x</span><span>:</span> <span>66</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}<span>,</span> {<span>x</span><span>:</span> <span>75</span><span>,</span> <span>y</span><span>:</span> <span>2</span>}</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>                                   ]<span>.</span><span>flatMap</span>(({x<span>,</span> y}<span>,</span> idx) <span>=&gt;</span> <span>transposeCharLocations</span>(x<span>,</span> y<span>,</span> nine_flames[idx]))<span>;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a>    <span>// Composite teaserDDW data with overlay data of the nine flames.</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a>    <span>const</span> teaser_with_flame_ddw <span>=</span> <span>ddwChars</span>(teaserDDW)<span>.</span><span>concat</span>(nine_flames_transposed)<span>;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true"></a>    <span>// Reshape the composite data into the expected matrix form that will be painted.</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true"></a>    <span>const</span> art_sheet <span>=</span> <span>insertDdwCharsIntoTextArtSheet</span>(teaser_with_flame_ddw<span>,</span> max_cols<span>,</span> max_rows)<span>;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true"></a>    <span>// console.log(art_sheet);</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true"></a>    <span>// Finally... Paint the text art!</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true"></a>    artcontext<span>.</span><span>append</span>(<span>htmlizeArtSheet</span>(art_sheet))<span>;</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true"></a>    <span>return</span> artcontext<span>;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true"></a>}<span>;</span></span></code></pre></div>
</code></details>
<p>The workhorse function was a Javascript matrix manipulator:</p>
<div id="cb6"><pre><code><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span>function</span> <span>insertDdwCharsIntoTextArtSheet</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>    ddw_char_array<span>,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    x_cols <span>=</span> MAX_COLS<span>,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>    y_rows <span>=</span> MAX_ROWS<span>,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>    ddw_char_maker <span>=</span> makeDdwChar) {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>    <span>const</span> insertIfPositionExists <span>=</span> (char_matrix<span>,</span> ddw_char) <span>=&gt;</span> {</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>        <span>let</span> {x<span>,</span> y} <span>=</span> ddw_char<span>;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>        <span>if</span> (y <span>&lt;</span> y_rows <span>&amp;&amp;</span> x <span>&lt;</span> x_cols) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>            char_matrix[y][x] <span>=</span> ddw_char<span>;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>        }</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>        <span>return</span> char_matrix<span>;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>    }<span>;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>    <span>return</span> ddw_char_array</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>        <span>.</span><span>reduce</span>(insertIfPositionExists<span>,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>                <span>makeTextArtSheet</span>(x_cols<span>,</span> y_rows<span>,</span> ddw_char_maker))<span>;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true"></a><span>function</span> <span>makeTextArtSheet</span>(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true"></a>    x_cols <span>=</span> MAX_COLS<span>,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true"></a>    y_rows <span>=</span> MAX_ROWS<span>,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true"></a>    ddw_char_maker <span>=</span> makeDdwChar) {</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true"></a>    <span>return</span> <span>Array</span><span>.</span><span>from</span>({<span>length</span><span>:</span> y_rows}<span>,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true"></a>                      (_<span>,</span> y) <span>=&gt;</span> <span>Array</span><span>.</span><span>from</span>({<span>length</span><span>:</span> x_cols}<span>,</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true"></a>                                           (_<span>,</span> x) <span>=&gt;</span> <span>ddw_char_maker</span>(x<span>,</span> y)))<span>;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true"></a>}</span></code></pre></div>
<p>Yes, I didn&#39;t pay_​attention to namingConventions in that version.</p>
<h2 id="how-it-is-the-dom-as-a-live-spreadsheet">How it is: The DOM as a live spreadsheet</h2>
<p>Now, everything is designed around a live &#34;canvas&#34; written to the DOM. Mechanically, the canvas is a rectangular grid of empty <code>&lt;span&gt;</code> elements, organised by and uniquely addressable by x/y coordinates set as data attributes. All text art operations assume the DOM already contains this live &#34;canvas&#34;, and query/update any part of it, based on information set in the source data (coordinates, glyph, style, frames, tags etc.).</p>
<details>
<summary>
<code>Treating the browser as a live medium.</code>
<hr/>
</summary><code>
<div id="cb7"><pre><code><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span>function</span> <span>updateDom</span>() {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span>let</span> now <span>=</span> <span>Date</span><span>.</span><span>now</span>()<span>;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span>let</span> han5738_begins <span>=</span> <span>Date</span><span>.</span><span>UTC</span>(<span>2022</span><span>,</span> <span>11</span><span>,</span> <span>18</span><span>,</span> <span>16</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>,</span> <span>0</span>)<span>;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>    <span>let</span> han5738_ends <span>=</span> <span>Date</span><span>.</span><span>UTC</span>(<span>2022</span><span>,</span> <span>11</span><span>,</span> <span>26</span><span>,</span> <span>16</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>,</span> <span>0</span>)<span>;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>    <span>let</span> dayZero <span>=</span> now <span>&gt;</span> han5738_ends <span>?</span> <span>getStartTime</span>(<span>0</span>) <span>:</span> han5738_begins<span>;</span> <span>// depending on when a player starts the game</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>    <span>let</span> todayNum <span>=</span> <span>Math</span><span>.</span><span>floor</span>((now <span>-</span> dayZero)<span>/</span>(<span>24</span><span>*</span><span>3600</span><span>*</span><span>1000</span>) <span>+</span> <span>1</span>)<span>;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>    <span>//////////////////////////////////////////////////</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>    <span>// Initialise the Text Art &#34;canvas&#34;.</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>    <span>//////////////////////////////////////////////////</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>    <span>stopAllLiveAnimations</span>()<span>;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>    <span>paintEmptyCanvas</span>()<span>;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>    <span>// Parts of the Menorah to always show</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>    <span>let</span> allMenorahChars <span>=</span> <span>getDdwChars</span>(menorahDDW)<span>;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>    <span>let</span> selectedMenorahChars <span>=</span> allMenorahChars<span>.</span><span>filter</span>((char) <span>=&gt;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>        (char<span>.</span><span>tags</span><span>.</span><span>length</span> <span>==</span> <span>0</span> <span>||</span> char<span>.</span><span>tags</span><span>.</span><span>includes</span>(<span>&#34;day0&#34;</span>) <span>||</span> char<span>.</span><span>tags</span><span>.</span><span>includes</span>(<span>&#34;menorah&#34;</span>)) <span>&amp;&amp;</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a>            (<span>!</span>char<span>.</span><span>frame</span> <span>||</span> char<span>.</span><span>frame</span> <span>==</span> <span>&#34;off&#34;</span>))<span>;</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a>    <span>let</span> setOfFlames <span>=</span> <span>new</span> <span>Set</span>()<span>;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a>    <span>let</span> selectedTapestryChars <span>=</span> []<span>;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a>    <span>// Gather data to paint based on day and answers</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a>    <span>for</span> (<span>let</span> i<span>=</span><span>0</span><span>;</span> i <span>&lt;</span> <span>9</span><span>;</span> <span>++</span>i) {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true"></a>        <span>// Flames to light up for any answered puzzle</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true"></a>        <span>if</span> (<span>isLit</span>(i)) {</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true"></a>            setOfFlames<span>.</span><span>add</span>(i)<span>;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true"></a>        }</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true"></a>        <span>let</span> toggleState <span>=</span> <span>isLit</span>(i) <span>?</span> <span>&#34;on&#34;</span> <span>:</span> <span>&#34;off&#34;</span><span>;</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true"></a>        <span>let</span> dayTag <span>=</span> <span>`day</span><span>${</span>i<span>}</span><span>`</span><span>;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true"></a>        <span>// Candle data for &#34;today&#34; OR for any already-answered puzzle</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true"></a>        <span>if</span> (<span>canBeLit</span>(i) <span>||</span> <span>isLit</span>(i)) {</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true"></a>            selectedMenorahChars <span>=</span> selectedMenorahChars<span>.</span><span>concat</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true"></a>                allMenorahChars<span>.</span><span>filter</span>((char) <span>=&gt;</span> {</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true"></a>                    <span>return</span> char<span>.</span><span>tags</span><span>.</span><span>includes</span>(dayTag) <span>&amp;&amp;</span> (<span>!</span>char<span>.</span><span>frame</span> <span>||</span> char<span>.</span><span>frame</span> <span>==</span> toggleState)<span>;</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true"></a>                })</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true"></a>            )<span>;</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true"></a>        }</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true"></a>        <span>// &#34;Revealed&#34; Tapestry data for any answered puzzle</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true"></a>        selectedTapestryChars <span>=</span> selectedTapestryChars</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true"></a>            <span>.</span><span>concat</span>(allTapestryChars<span>.</span><span>filter</span>((char) <span>=&gt;</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true"></a>                char<span>.</span><span>frame</span> <span>==</span> toggleState <span>&amp;&amp;</span> char<span>.</span><span>tags</span><span>.</span><span>includes</span>(dayTag)))<span>;</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true"></a>    }</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true"></a>    <span>//////////////////////////////////////////////////</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true"></a>    <span>// Paint the art</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true"></a>    <span>//////////////////////////////////////////////////</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true"></a>    <span>paintTextArtPiece</span>(selectedTapestryChars)<span>;</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true"></a>    <span>paintTextArtPiece</span>(selectedMenorahChars<span>,</span> <span>19</span><span>,</span> <span>30</span>)<span>;</span> <span>// offset by x=19, y=30 w.r.t. origin</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true"></a>    <span>// Light flames</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true"></a>    <span>for</span> (<span>const</span> flameNum <span>of</span> setOfFlames) {</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true"></a>        <span>animateFlame</span>(flameNum)<span>;</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true"></a>    }</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true"></a>    <span>// Twitch Animals</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true"></a>    [<span>null</span><span>,</span> <span>// candle 0, no animal for Shamash</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true"></a>     beehiveDdwChars<span>,</span> <span>// candle 1</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true"></a>     snailDdwChars<span>,</span> <span>// candle 2</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true"></a>     spiderDdwChars<span>,</span> <span>// candle 3</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true"></a>     hornedOwlDdwChars<span>,</span> <span>// candle 4</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true"></a>     koalaDdwChars<span>,</span> <span>// candle 5</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true"></a>     squirrelDdwChars<span>,</span> <span>// candle 6</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true"></a>     toucanDdwChars<span>,</span> <span>// candle 7</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true"></a>     snakeDdwChars <span>// candle 8</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true"></a>    ]<span>.</span><span>forEach</span>((animalDdwChars<span>,</span> candleNum) <span>=&gt;</span> {</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true"></a>        <span>if</span> (animalDdwChars <span>&amp;&amp;</span> <span>isLit</span>(candleNum)) {</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true"></a>            <span>twitchAnimal</span>(</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true"></a>                animalDdwChars<span>.</span><span>filter</span>((char) <span>=&gt;</span> char<span>.</span><span>frame</span> <span>==</span> <span>&#34;on&#34;</span>)<span>,</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true"></a>                animalDdwChars<span>.</span><span>filter</span>((char) <span>=&gt;</span> char<span>.</span><span>frame</span> <span>==</span> <span>&#34;on2&#34;</span>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true"></a>            )<span>;</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true"></a>        }</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true"></a>    })<span>;</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true"></a>}<span>;</span></span></code></pre></div>
</code></details>
<p>So, an empty &#34;cell&#34; like this <code>&lt;span data-x=&#34;30&#34; data-y=&#34;42&#34;&gt;&lt;/span&gt;</code> may get DarkDraw character information like this <code>&lt;span data-x=&#34;30&#34; data-y=&#34;42&#34; class=&#34; fg255 bold&#34; data-frame=&#34;off&#34;&gt;)&lt;/span&gt;</code>. Where the source DarkDraw character data itself would look like this: <code>{&#34;x&#34;: 30, &#34;y&#34;: 42, &#34;text&#34;: &#34;)&#34;, &#34;color&#34;: &#34;225 bold&#34;, &#34;tags&#34;: [], &#34;group&#34;: &#34;&#34;, &#34;frame&#34;: &#34;&#34;}</code>.</p>
<p>Like this:</p>
<div id="cb8"><pre><code><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span>function</span> <span>paintTextArtPiece</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    ddwCharArray<span>,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    xCanvasOffset <span>=</span> <span>0</span><span>,</span> yCanvasOffset <span>=</span> <span>0</span><span>,</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    canvasContext <span>=</span> <span>document</span><span>.</span><span>getElementById</span>(<span>&#34;art&#34;</span>)) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>    <span>for</span> (<span>const</span> char <span>of</span> ddwCharArray) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>        el <span>=</span> canvasContext<span>.</span><span>querySelector</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>            <span>`</span><span>${</span>EL_CELL<span>}</span><span>[data-y=&#39;</span><span>${</span>char<span>.</span><span>y</span> <span>+</span> yCanvasOffset<span>}</span><span>&#39;][data-x=&#39;</span><span>${</span>char<span>.</span><span>x</span> <span>+</span> xCanvasOffset<span>}</span><span>&#39;]`</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>        )<span>;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>        <span>if</span>(el) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>            el<span>.</span><span>className</span> <span>=</span> <span>getCssForDdwColorStr</span>(char<span>.</span><span>color</span>)<span>;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>            el<span>.</span><span>dataset</span><span>.</span><span>frame</span> <span>=</span> char<span>.</span><span>frame</span><span>?</span> char<span>.</span><span>frame</span> <span>:</span> <span>&#34;&#34;</span><span>;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>            el<span>.</span><span>innerHTML</span> <span>=</span> char<span>.</span><span>href</span><span>?</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>                <span>`&lt;a href=&#34;</span><span>${</span>char<span>.</span><span>href</span><span>}</span><span>&#34; style=&#34;color:#FFFFFF; font-weight: bold;&#34;&gt;</span><span>${</span>char<span>.</span><span>text</span><span>}</span><span>&lt;/a&gt;`</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>                <span>:</span> <span>`</span><span>${</span>char<span>.</span><span>text</span><span>}</span><span>`</span><span>;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>        }</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a>    }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>}</span></code></pre></div>
<h2 id="what-transpired-in-between-learning-to-see">What transpired in-between: Learning to &#34;see&#34;</h2>
<p>Picture a reticent server-inhabiter bobbing about in a primordial DOM-soup, waiting for the stars to rise.</p>
<p>There is a knowing how to swim versus a knowing how to swim in the open sea. The raw skills are similar, but oceans are so very different from familiar swimming pools, that one has to learn a whole other way of sensing, observing, thinking, and operating. That is how it goes, in unfamiliar territory.</p>
<p>The slow star-dawn was the very process of relocating the &#34;spreadsheet&#34; from being in-memory (a 2D Matrix), to being an in-DOM grid of live elements. That in turn meant identifying the various parts at my disposal, and working out how to organise the solution using the pieces, viz.</p>
<ul>
<li><p>design of raw data; its shape and structure,</p>
<div id="cb9"><pre><code><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span>{</span><span>&#34;x&#34;</span><span>:</span> <span>76</span><span>,</span> <span>&#34;y&#34;</span><span>:</span> <span>5</span><span>,</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a> <span>&#34;text&#34;</span><span>:</span> <span>&#34;</span><span>\u0194</span><span>&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;88&#34;</span><span>,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a> <span>&#34;tags&#34;</span><span>:</span> <span>[</span><span>&#34;wick&#34;</span><span>,</span> <span>&#34;day1&#34;</span><span>]</span><span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a> <span>&#34;frame&#34;</span><span>:</span> <span>&#34;on&#34;</span><span>,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a> <span>&#34;href&#34;</span><span>:</span> <span>&#34;1&#34;</span><span>}</span></span></code></pre></div></li>
<li><p>data transformation operations (filtering, enriching, reshaping)</p>
<div id="cb10"><pre><code><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span>const</span> flameAnimationSequence <span>=</span> <span>getDdwFrames</span>(flameDDW)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a>      <span>.</span><span>sort</span>((fa<span>,</span> fb) <span>=&gt;</span> fb<span>.</span><span>id</span> <span>&gt;</span> fa<span>.</span><span>id</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a>      <span>.</span><span>map</span>((frame) <span>=&gt;</span> flameAnimationCharacters</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a>           <span>.</span><span>filter</span>((char) <span>=&gt;</span> char<span>.</span><span>frame</span> <span>==</span> <span>`</span><span>${</span>frame<span>.</span><span>id</span><span>}</span><span>`</span>))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a>      <span>.</span><span>map</span>((flameChars) <span>=&gt;</span> <span>frameInsideMask</span>(flameChars<span>,</span> <span>3</span><span>,</span> <span>3</span>))<span>;</span></span></code></pre></div></li>
<li><p>domain abstractions (canvas, text art pieces, painter, animator)</p>
<div id="cb11"><pre><code><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span>function</span> <span>paintEmptyCanvas</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>    canvasContext <span>=</span> <span>document</span><span>.</span><span>getElementById</span>(<span>&#34;art&#34;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>) {<span>...</span>}<span>;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a><span>function</span> <span>paintTextArtPiece</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>    ddwCharArray<span>,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    xCanvasOffset <span>=</span> <span>0</span><span>,</span> yCanvasOffset <span>=</span> <span>0</span><span>,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>    canvasContext <span>=</span> <span>document</span><span>.</span><span>getElementById</span>(<span>&#34;art&#34;</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>) {<span>...</span>}<span>;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a><span>function</span> <span>paintFlame</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>    dayIndex <span>=</span> <span>0</span><span>,</span> frameCounter <span>=</span> <span>new</span> <span>FrameCounter</span>(<span>41</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>) {<span>...</span>}<span>;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a><span>function</span> <span>animateFlame</span>(dayIndex <span>=</span> <span>0</span>) {</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a>    <span>let</span> animationID <span>=</span> <span>setInterval</span>(paintFlame<span>,</span> <span>100</span><span>,</span> dayIndex<span>,</span> <span>new</span> <span>FrameCounter</span>(<span>41</span>))<span>;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>    LIVE_ANIMATIONS_IDS_SET<span>.</span><span>add</span>(animationID)<span>;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>}<span>;</span></span></code></pre></div></li>
<li><p>HTML/CSS construction (e.g. make a canvas of rows and colums, with data attributes set)</p>
<div id="cb12"><pre><code><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span>&lt;span</span><span> data-x=</span><span>&#34;30&#34;</span><span> data-y=</span><span>&#34;42&#34;</span><span> class=</span><span>&#34;fg255 bold&#34;</span><span> data-frame=</span><span>&#34;off&#34;</span><span>&gt;</span>)<span>&lt;/span&gt;</span></span></code></pre></div></li>
<li><p>actual DOM manipulations (e.g. select/update element by data attributes)</p>
<div id="cb13"><pre><code><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a>canvasContext<span>.</span><span>querySelector</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>    <span>`</span><span>${</span>EL_CELL<span>}</span><span>[data-y=&#39;</span><span>${</span>char<span>.</span><span>y</span> <span>+</span> yCanvasOffset<span>}</span><span>&#39;][data-x=&#39;</span><span>${</span>char<span>.</span><span>x</span> <span>+</span> xCanvasOffset<span>}</span><span>&#39;]`</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>)<span>;</span></span></code></pre></div></li>
</ul>
<p>And so forth…</p>
<p>Ultimately, I suppose I retained the general data munging needed to <em>prepare</em> source data for writes into the DOM, and dropped the sort-of DarkDraw-to-HTML &#34;compiler&#34; piece from the solution. That piece was causing avoidable data munging work <em>and</em> was tempting me into over-abstracting code.</p>
<p>The revised approach also resulted in code that is true to the <em>aesthetic</em> feel of Text Art animation, which was the real win.</p>

<h2 id="the-aesthetic-of-text-art-and-its-animation">The aesthetic of Text Art and its Animation</h2>
<p><em>Characters are material</em>; where a character is a glyph along with its associated information, including styles (256 bit colour palette), x/y grid position, order of appearance (frame number), tags, grouping etc.</p>
<p><em>Animation is discrete</em>, not smooth; effected by replacing characters with characters.</p>
<p><em>Painting is <strong>not</strong> an emulation of the artist&#39;s intent</em>, but a faithful reproduction of their hand, regardless of medium.</p>
<p>Our mechanical text artist was code in the web browser medium. But one can imagine implementing text artistry with stop-motion photography, or printed flip-books, or kaleidoscopes, or this wicked cool <a href="https://tangible.media.mit.edu/project/inform/.">Dynamic Shape Display</a> at MIT Media Lab.</p>
<p>Hark back to my note on thinking in terms of <em>dynamic</em> media.</p>
<h2 id="structuring-darkdraw-source-data">Structuring DarkDraw source data</h2>
<p>If the data sucks, the code will suck. Now there&#39;s a maxim for you.</p>
<p>I try to structure, fix, and enrich source data as much as humanly possible. If the data is well-formed and models the problem domain well, the solution domain (i.e. the code / system design) almost writes itself.</p>
<p>And when the resident artist quips thusly, it&#39;s pure gold.</p>
<blockquote>
<p>&#34;that&#39;s what&#39;s so fun about dd</p>
<p>— dwimmer</p>
<p>(<em>dd</em> = DarkDraw)</p>
</blockquote>
<p>So, these became goals for the code:</p>
<ul>
<li>Construct a spreadsheet with x/y coordinates</li>
<li>Place characters precisely into the appropriate coordinates</li>
<li>Animate characters based on what they represent (flame, animal, etc.)</li>
</ul>
<p>Over a handful of iterations of data modeling, our data representation came to have two types of records, as follows:</p>
<ul>
<li><p><strong>&#34;Frame&#34; records</strong> that contain information about a single frame.</p>
<div id="cb14"><pre><code><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span>{</span><span>&#34;id&#34;</span><span>:</span> <span>&#34;off&#34;</span><span>,</span> <span>&#34;type&#34;</span><span>:</span> <span>&#34;frame&#34;</span><span>,</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a> <span>&#34;text&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a> <span>&#34;tags&#34;</span><span>:</span> <span>[]</span><span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a> <span>&#34;duration_ms&#34;</span><span>:</span> <span>100</span><span>}</span></span></code></pre></div>
<p>These come bundled in a <code>ddw</code> data file. VisiData uses these to render DarkDraw text art animations. Our game requires only two kinds of animations: flames that cycle over 42 frames, and animals that blink (on/off frames). So I just wrote special functions for each kind of frame-handling. A general frame-aware animator is TBD. Maybe next year :)</p></li>
<li><p><strong>&#34;Character&#34; records</strong>, which we tagged semantically. Is it for a squirrel? A wick? The menorah? Which day of game play to associate it with?</p>
<div id="cb15"><pre><code><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span>{</span><span>&#34;x&#34;</span><span>:</span> <span>76</span><span>,</span> <span>&#34;y&#34;</span><span>:</span> <span>5</span><span>,</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a> <span>&#34;text&#34;</span><span>:</span> <span>&#34;</span><span>\u0194</span><span>&#34;</span><span>,</span> <span>&#34;color&#34;</span><span>:</span> <span>&#34;88&#34;</span><span>,</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a> <span>&#34;tags&#34;</span><span>:</span> <span>[</span><span>&#34;wick&#34;</span><span>,</span> <span>&#34;day1&#34;</span><span>]</span><span>,</span> <span>&#34;group&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a> <span>&#34;frame&#34;</span><span>:</span> <span>&#34;on&#34;</span><span>,</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a> <span>&#34;href&#34;</span><span>:</span> <span>&#34;1&#34;</span><span>}</span></span></code></pre></div>
<p>Given this, our Javascript can interpret each character record to decide whether to place it in the DOM (Is it the right day? What is the frame state?). Then, to place it, we locate a cell for the x/y coordinates, punch in the text, add appropriate CSS class for the color value, and link the cell if an href is specified.</p></li>
</ul>
<h2 id="choice-of-javascript">Choice of Javascript</h2>
<p>It&#39;s just Javascript.</p>
<p>The good parts.</p>
<p>That&#39;s all.</p>
<h2 id="choice-of-animation-method">Choice of animation method</h2>
<p>Even &#34;just&#34; Javascript provides us several options: <code>setInterval</code>, <code>setTimeout</code>, <code>Element.animate</code>, <code>Window.requestAnimationFrame</code>, to name a few <a href="#fn5" id="fnref5" role="doc-noteref"><sup>5</sup></a>. CSS adds more to the mix. <em>However</em>, Text Art Animation aesthetic asks us to work with <em>characters as material</em>, so CSS animation methods are out from the outset.</p>
<h3 id="window.requestanimationframe-had-me-on-the-fence"><code>Window.requestAnimationFrame</code> had me on the fence</h3>
<p>It is supposed to be CPU friendly because it works <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame">with the browser&#39;s render cycle</a> <a href="#fn6" id="fnref6" role="doc-noteref"><sup>6</sup></a>, and I have a feeling one can do a proper job of animation with it—unlike <code>Element.animate</code> discussed below. However, <code>setInterval</code> and <code>setTimeout</code> worked well enough that I didn&#39;t feel compelled to experiment more. A game had to ship, after all.</p>
<h3 id="element.animate-is-neato-but-it-cannot-modify-elements"><code>Element.animate</code> is neato, but it cannot modify elements</h3>
<p>Also it requires us to model discrete animation in terms of carefully-chosen keyframe effects. These traits combined imply we might <em>emulate</em> the artist&#39;s intent, at best. Thus it does not suit our purpose.</p>
<div>
<p><em>This &#34;loading&#34; effect demo with <code>Element.animate()</code> is <b>not</b> text art animation.</em></p>
</div>

<p><em>An unrelated but important detail</em>, because of the unwelcome hair-loss it has caused me… <code>Element.animate</code> does not work <em>visually</em> for inline elements like <code>&lt;span&gt;</code> <em>unless</em> they receive block properties via CSS, viz. <code>display: inline-block;</code>.</p>
<p>Like if we <code>document.getElementById(theID).animate({...})</code> an inline element (no block properties), then <code>document.getElementById(theID).getAnimations()</code> shows that an animation is indeed running. <em>However</em> nothing is visible in-browser.</p>
<p>So my guess is, unadulterated inline elements seem to behave like point objects as far as animate is concerned. This little detail seems to be conspicuously absent from MDN and StackOverflow combined. Unless I&#39;ve misunderstood everything, of course.</p>
<p>This took <strong>way</strong> longer to debug than I&#39;m able to admit in polite company.</p>
<h3 id="setinterval-and-settimeout-worked-just-right"><code>setInterval</code> and <code>setTimeout</code> worked just right</h3>
<p>These let us call functions that do exactly the thing we want, viz. punch <em><a href="#the-aesthetic-of-text-art-and-its-animation">characters</a></em> into our &#34;live spreadsheet&#34; medium, exactly the way the artist placed them in the original art source. These methods can make a CPU sing, but hey, the awesome art is worth every watt it, ah, draws.</p>
<div>
<p><em>Random twitch loop <code>setTimeout</code> and recursion.</em></p>
</div>

<div>
<p><em>Flipbook-like frame-by-frame animation loop with <code>setInterval</code>.</em></p>
</div>

<h2 id="composition-and-painting">Composition and Painting</h2>
<p>Graphics artists will find this section wholly unsurprising. Our Text Art is a composite of parts. These include:</p>
<ul>
<li>static parts like the base of the menorah, parts of the tapestry</li>
<li>animated parts such as flames and twitchy animals</li>
<li>&#34;revealed&#34; parts that could be static and/or animated</li>
</ul>
<p>We can think of each part as an abstract sheet. Sheets of art are over-painted on a shared blank rectangular canvas of pre-set size. A sheet may be as small as one character, or as large as the whole canvas, and may be of any shape in-between.</p>
<p>All art is painted with respect to the same x/y origin, where the coordinates follow display screen layout:</p>
<ul>
<li>x = columns of a sheet of text art</li>
<li>y = rows of a sheet of text art</li>
<li>0/0 origin begins at the <em>top-left</em> corner</li>
</ul>
<p>For animated text art, sheets are associated with animation frames. We view this as a stack of text art sheets, one sheet per frame. Since it&#39;s all 2D space, we are sort of &#34;looking from above&#34; and can&#39;t see the depth of the stack. Frames are irrelevant for static text art; there is just one sheet.</p>
<p>Mechanically, our animation is quite like flipping a flipbook. A subtle detail is that animation art should explicitly paint blanks where it does not want to show characters. If source data contains explicit blanks, our code can blindly punch characters into the DOM. Otherwise, our code has to calculate empty cells, which creates needless complexity (for me it was that first version that I trashed).</p>

<p>Animating text art in the browser is a lot of fun… have at it! Draw with <a href="https://github.com/devottys/darkdraw">DarkDraw</a>. Export as JSON. Drop some <em>Vanilla ice ice baby</em> Javascript. Profit?</p>

<p>All <em>Hanukkah of Data</em> text art featured in this piece, in any form (e.g. screenshots, source data, rendered samples) are copyright <a href="https://www.instagram.com/dwimmertxt/">dwimmer</a>. Reproduced with permission. If you like the art (and why wouldn&#39;t you?), give him a shout out. Better still, commission him to make rad stuff for you!</p>

<p>Cheers to all the <a href="https://bluebird.sh">devottys</a> for a super fun time making Hanukkah of Data. It was my first time working with an artist to render their work, and I&#39;m glad it was someone like dwimmer. A joy! Thanks to <a href="https://www.saul.pw/">Saul</a>, <a href="https://anja.kefala.info/">Anja</a>, <a href="https://www.radhikamurthy.com/">Radhika</a> for reviews and remarks on this post.</p>


  </section>
  
</article>
        </main>
        
    </div></div>
  </body>
</html>
