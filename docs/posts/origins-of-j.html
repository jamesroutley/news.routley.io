<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/kelas/ooj">Original</a>
    <h1>Origins of J</h1>
    
    <div id="readability-page-1" class="page"><div dir="auto" data-snippet-clipboard-copy-content="typedef char C;typedef long I;
typedef struct a{I t,r,d[3],p[2];}*A;
#define P printf
#define R return
#define V1(f) A f(w)A w;
#define V2(f) A f(a,w)A a,w;
#define DO(n,x) {I i=0,_n=(n);for(;i&lt;_n;++i){x;}}
I *ma(n){R(I*)malloc(n*4);}mv(d,s,n)I *d,*s;{DO(n,d[i]=s[i]);}
tr(r,d)I *d;{I z=1;DO(r,z=z*d[i]);R z;}
A ga(t,r,d)I *d;{A z=(A)ma(5+tr(r,d));z-&gt;t=t,z-&gt;r=r,mv(z-&gt;d,d,r);R z;}
V1(iota){I n=*w-&gt;p;A z=ga(0,1,&amp;n);DO(n,z-&gt;p[i]=i);R z;}
V2(plus){I r=w-&gt;r,*d=w-&gt;d,n=tr(r,d);A z=ga(0,r,d);
 DO(n,z-&gt;p[i]=a-&gt;p[i]+w-&gt;p[i]);R z;}
V2(from){I r=w-&gt;r-1,*d=w-&gt;d+1,n=tr(r,d);
 A z=ga(w-&gt;t,r,d);mv(z-&gt;p,w-&gt;p+(n**a-&gt;p),n);R z;}
V1(box){A z=ga(1,0,0);*z-&gt;p=(I)w;R z;}
V2(cat){I an=tr(a-&gt;r,a-&gt;d),wn=tr(w-&gt;r,w-&gt;d),n=an+wn;
 A z=ga(w-&gt;t,1,&amp;n);mv(z-&gt;p,a-&gt;p,an);mv(z-&gt;p+an,w-&gt;p,wn);R z;}
V2(find){}
V2(rsh){I r=a-&gt;r?*a-&gt;d:1,n=tr(r,a-&gt;p),wn=tr(w-&gt;r,w-&gt;d);
 A z=ga(w-&gt;t,r,a-&gt;p);mv(z-&gt;p,w-&gt;p,wn=n&gt;wn?wn:n);
 if(n-=wn)mv(z-&gt;p+wn,z-&gt;p,n);R z;}
V1(sha){A z=ga(0,1,&amp;w-&gt;r);mv(z-&gt;p,w-&gt;d,w-&gt;r);R z;}
V1(id){R w;}V1(size){A z=ga(0,0,0);*z-&gt;p=w-&gt;r?*w-&gt;d:1;R z;}
pi(i){P(&#34;%d &#34;,i);}nl(){P(&#34;\n&#34;);}
pr(w)A w;{I r=w-&gt;r,*d=w-&gt;d,n=tr(r,d);DO(r,pi(d[i]));nl();
 if(w-&gt;t)DO(n,P(&#34;&lt; &#34;);pr(w-&gt;p[i]))else DO(n,pi(w-&gt;p[i]));nl();}

C vt[]=&#34;+{~&lt;#,&#34;;
A(*vd[])()={0,plus,from,find,0,rsh,cat},
 (*vm[])()={0,id,size,iota,box,sha,0};
I st[26]; qp(a){R a&gt;=&#39;a&#39;&amp;&amp;a&lt;=&#39;z&#39;;}qv(a){R a&lt;&#39;a&#39;;}
A ex(e)I *e;{I a=*e;
 if(qp(a)){if(e[1]==&#39;=&#39;)R st[a-&#39;a&#39;]=ex(e+2);a= st[ a-&#39;a&#39;];}
 R qv(a)?(*vm[a])(ex(e+1)):e[1]?(*vd[e[1]])(a,ex(e+2)):(A)a;}
noun(c){A z;if(c&lt;&#39;0&#39;||c&gt;&#39;9&#39;)R 0;z=ga(0,0,0);*z-&gt;p=c-&#39;0&#39;;R z;}
verb(c){I i=0;for(;vt[i];)if(vt[i++]==c)R i;R 0;}
I *wd(s)C *s;{I a,n=strlen(s),*e=ma(n+1);C c;
 DO(n,e[i]=(a=noun(c=s[i]))?a:(a=verb(c))?a:c);e[n]=0;R e;}

main(){C s[99];while(gets(s))pr(ex(wd(s)));}"><pre><span>typedef</span> <span>char</span> <span>C</span>;<span>typedef</span> <span>long</span> <span>I</span>;
<span>typedef</span> <span>struct</span> <span>a</span>{<span>I</span> <span>t</span>,<span>r</span>,<span>d</span>[<span>3</span>],<span>p</span>[<span>2</span>];}<span>*</span><span>A</span>;
<span>#define</span> <span>P</span> printf
<span>#define</span> <span>R</span> return
<span>#define</span> <span>V1</span>(<span>f</span>) A f(w)A w;
<span>#define</span> <span>V2</span>(<span>f</span>) A f(a,w)A a,w;
<span>#define</span> <span>DO</span>(<span>n</span>,<span>x</span>) {I i=0,_n=(n);for(;i&lt;_n;++i){x;}}
<span>I</span> <span>*</span><span>ma</span>(<span>n</span>){<span>R</span>(<span>I</span><span>*</span>)<span>malloc</span>(<span>n</span><span>*</span><span>4</span>);}<span>mv</span>(<span>d</span>,<span>s</span>,<span>n</span>)<span>I</span> <span>*</span><span>d</span>,<span>*</span><span>s</span>;{<span>DO</span>(<span>n</span>,<span>d</span>[<span>i</span>]<span>=</span><span>s</span>[<span>i</span>]);}
<span>tr</span>(<span>r</span>,<span>d</span>)<span>I</span> <span>*</span><span>d</span>;{<span>I</span> <span>z</span><span>=</span><span>1</span>;<span>DO</span>(<span>r</span>,<span>z</span><span>=</span><span>z</span><span>*</span><span>d</span>[<span>i</span>]);<span>R</span> <span>z</span>;}
<span>A</span> <span>ga</span>(<span>t</span>,<span>r</span>,<span>d</span>)<span>I</span> <span>*</span><span>d</span>;{<span>A</span> <span>z</span><span>=</span>(<span>A</span>)<span>ma</span>(<span>5</span><span>+</span><span>tr</span>(<span>r</span>,<span>d</span>));<span>z</span><span>-&gt;</span><span>t</span><span>=</span><span>t</span>,<span>z</span><span>-&gt;</span><span>r</span><span>=</span><span>r</span>,<span>mv</span>(<span>z</span><span>-&gt;</span><span>d</span>,<span>d</span>,<span>r</span>);<span>R</span> <span>z</span>;}
<span>V1</span>(<span>iota</span>){<span>I</span> <span>n</span><span>=</span><span>*</span><span>w</span><span>-&gt;</span><span>p</span>;<span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>0</span>,<span>1</span>,<span>&amp;</span><span>n</span>);<span>DO</span>(<span>n</span>,<span>z</span><span>-&gt;</span><span>p</span>[<span>i</span>]<span>=</span><span>i</span>);<span>R</span> <span>z</span>;}
<span>V2</span>(<span>plus</span>){<span>I</span> <span>r</span><span>=</span><span>w</span><span>-&gt;</span><span>r</span>,<span>*</span><span>d</span><span>=</span><span>w</span><span>-&gt;</span><span>d</span>,<span>n</span><span>=</span><span>tr</span>(<span>r</span>,<span>d</span>);<span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>0</span>,<span>r</span>,<span>d</span>);
 <span>DO</span>(<span>n</span>,<span>z</span><span>-&gt;</span><span>p</span>[<span>i</span>]<span>=</span><span>a</span><span>-&gt;</span><span>p</span>[<span>i</span>]<span>+</span><span>w</span><span>-&gt;</span><span>p</span>[<span>i</span>]);<span>R</span> <span>z</span>;}
<span>V2</span>(<span>from</span>){<span>I</span> <span>r</span><span>=</span><span>w</span><span>-&gt;</span><span>r</span><span>-</span><span>1</span>,<span>*</span><span>d</span><span>=</span><span>w</span><span>-&gt;</span><span>d</span><span>+</span><span>1</span>,<span>n</span><span>=</span><span>tr</span>(<span>r</span>,<span>d</span>);
 <span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>w</span><span>-&gt;</span><span>t</span>,<span>r</span>,<span>d</span>);<span>mv</span>(<span>z</span><span>-&gt;</span><span>p</span>,<span>w</span><span>-&gt;</span><span>p</span><span>+</span>(<span>n</span><span>*</span><span>*</span><span>a</span><span>-&gt;</span><span>p</span>),<span>n</span>);<span>R</span> <span>z</span>;}
<span>V1</span>(<span>box</span>){<span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>1</span>,<span>0</span>,<span>0</span>);<span>*</span><span>z</span><span>-&gt;</span><span>p</span><span>=</span>(<span>I</span>)<span>w</span>;<span>R</span> <span>z</span>;}
<span>V2</span>(<span>cat</span>){<span>I</span> <span>an</span><span>=</span><span>tr</span>(<span>a</span><span>-&gt;</span><span>r</span>,<span>a</span><span>-&gt;</span><span>d</span>),<span>wn</span><span>=</span><span>tr</span>(<span>w</span><span>-&gt;</span><span>r</span>,<span>w</span><span>-&gt;</span><span>d</span>),<span>n</span><span>=</span><span>an</span><span>+</span><span>wn</span>;
 <span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>w</span><span>-&gt;</span><span>t</span>,<span>1</span>,<span>&amp;</span><span>n</span>);<span>mv</span>(<span>z</span><span>-&gt;</span><span>p</span>,<span>a</span><span>-&gt;</span><span>p</span>,<span>an</span>);<span>mv</span>(<span>z</span><span>-&gt;</span><span>p</span><span>+</span><span>an</span>,<span>w</span><span>-&gt;</span><span>p</span>,<span>wn</span>);<span>R</span> <span>z</span>;}
<span>V2</span>(<span>find</span>){}
<span>V2</span>(<span>rsh</span>){<span>I</span> <span>r</span><span>=</span><span>a</span><span>-&gt;</span><span>r</span>?<span>*</span><span>a</span><span>-&gt;</span><span>d</span>:<span>1</span>,<span>n</span><span>=</span><span>tr</span>(<span>r</span>,<span>a</span><span>-&gt;</span><span>p</span>),<span>wn</span><span>=</span><span>tr</span>(<span>w</span><span>-&gt;</span><span>r</span>,<span>w</span><span>-&gt;</span><span>d</span>);
 <span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>w</span><span>-&gt;</span><span>t</span>,<span>r</span>,<span>a</span><span>-&gt;</span><span>p</span>);<span>mv</span>(<span>z</span><span>-&gt;</span><span>p</span>,<span>w</span><span>-&gt;</span><span>p</span>,<span>wn</span><span>=</span><span>n</span><span>&gt;</span><span>wn</span>?<span>wn</span>:<span>n</span>);
 <span>if</span>(<span>n</span><span>-=</span><span>wn</span>)<span>mv</span>(<span>z</span><span>-&gt;</span><span>p</span><span>+</span><span>wn</span>,<span>z</span><span>-&gt;</span><span>p</span>,<span>n</span>);<span>R</span> <span>z</span>;}
<span>V1</span>(<span>sha</span>){<span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>0</span>,<span>1</span>,<span>&amp;</span><span>w</span><span>-&gt;</span><span>r</span>);<span>mv</span>(<span>z</span><span>-&gt;</span><span>p</span>,<span>w</span><span>-&gt;</span><span>d</span>,<span>w</span><span>-&gt;</span><span>r</span>);<span>R</span> <span>z</span>;}
<span>V1</span>(<span>id</span>){<span>R</span> <span>w</span>;}<span>V1</span>(<span>size</span>){<span>A</span> <span>z</span><span>=</span><span>ga</span>(<span>0</span>,<span>0</span>,<span>0</span>);<span>*</span><span>z</span><span>-&gt;</span><span>p</span><span>=</span><span>w</span><span>-&gt;</span><span>r</span>?<span>*</span><span>w</span><span>-&gt;</span><span>d</span>:<span>1</span>;<span>R</span> <span>z</span>;}
<span>pi</span>(<span>i</span>){<span>P</span>(<span>&#34;%d &#34;</span>,<span>i</span>);}<span>nl</span>(){<span>P</span>(<span>&#34;\n&#34;</span>);}
<span>pr</span>(<span>w</span>)<span>A</span> <span>w</span>;{<span>I</span> <span>r</span><span>=</span><span>w</span><span>-&gt;</span><span>r</span>,<span>*</span><span>d</span><span>=</span><span>w</span><span>-&gt;</span><span>d</span>,<span>n</span><span>=</span><span>tr</span>(<span>r</span>,<span>d</span>);<span>DO</span>(<span>r</span>,<span>pi</span>(<span>d</span>[<span>i</span>]));<span>nl</span>();
 <span>if</span>(<span>w</span><span>-&gt;</span><span>t</span>)<span>DO</span>(<span>n</span>,<span>P</span>(<span>&#34;&lt; &#34;</span>);<span>pr</span>(<span>w</span><span>-&gt;</span><span>p</span>[<span>i</span>]))<span>else</span> <span>DO</span>(<span>n</span>,<span>pi</span>(<span>w</span><span>-&gt;</span><span>p</span>[<span>i</span>]));<span>nl</span>();}

<span>C</span> <span>vt</span>[]<span>=</span><span>&#34;+{~&lt;#,&#34;</span>;
<span>A</span>(<span>*</span><span>vd</span>[])()<span>=</span>{<span>0</span>,<span>plus</span>,<span>from</span>,<span>find</span>,<span>0</span>,<span>rsh</span>,<span>cat</span>},
 (<span>*</span><span>vm</span>[])()<span>=</span>{<span>0</span>,<span>id</span>,<span>size</span>,<span>iota</span>,<span>box</span>,<span>sha</span>,<span>0</span>};
<span>I</span> <span>st</span>[<span>26</span>]; <span>qp</span>(<span>a</span>){<span>R</span> <span>a</span>&gt;=<span>&#39;a&#39;</span><span>&amp;&amp;</span><span>a</span>&lt;=<span>&#39;z&#39;</span>;}<span>qv</span>(<span>a</span>){<span>R</span> <span>a</span><span>&lt;</span><span>&#39;a&#39;</span>;}
<span>A</span> <span>ex</span>(<span>e</span>)<span>I</span> <span>*</span><span>e</span>;{<span>I</span> <span>a</span><span>=</span><span>*</span><span>e</span>;
 <span>if</span>(<span>qp</span>(<span>a</span>)){<span>if</span>(<span>e</span>[<span>1</span>]<span>==</span><span>&#39;=&#39;</span>)<span>R</span> <span>st</span>[<span>a</span><span>-</span><span>&#39;a&#39;</span>]<span>=</span><span>ex</span>(<span>e</span><span>+</span><span>2</span>);<span>a</span><span>=</span> <span>st</span>[ <span>a</span><span>-</span><span>&#39;a&#39;</span>];}
 <span>R</span> <span>qv</span>(<span>a</span>)?(<span>*</span><span>vm</span>[<span>a</span>])(<span>ex</span>(<span>e</span><span>+</span><span>1</span>)):<span>e</span>[<span>1</span>]?(<span>*</span><span>vd</span>[<span>e</span>[<span>1</span>]])(<span>a</span>,<span>ex</span>(<span>e</span><span>+</span><span>2</span>)):(<span>A</span>)<span>a</span>;}
<span>noun</span>(<span>c</span>){<span>A</span> <span>z</span>;<span>if</span>(<span>c</span><span>&lt;</span><span>&#39;0&#39;</span><span>||</span><span>c</span><span>&gt;</span><span>&#39;9&#39;</span>)<span>R</span> <span>0</span>;<span>z</span><span>=</span><span>ga</span>(<span>0</span>,<span>0</span>,<span>0</span>);<span>*</span><span>z</span><span>-&gt;</span><span>p</span><span>=</span><span>c</span><span>-</span><span>&#39;0&#39;</span>;<span>R</span> <span>z</span>;}
<span>verb</span>(<span>c</span>){<span>I</span> <span>i</span><span>=</span><span>0</span>;<span>for</span>(;<span>vt</span>[<span>i</span>];)<span>if</span>(<span>vt</span>[<span>i</span><span>++</span>]<span>==</span><span>c</span>)<span>R</span> <span>i</span>;<span>R</span> <span>0</span>;}
<span>I</span> <span>*</span><span>wd</span>(<span>s</span>)<span>C</span> <span>*</span><span>s</span>;{<span>I</span> <span>a</span>,<span>n</span><span>=</span><span>strlen</span>(<span>s</span>),<span>*</span><span>e</span><span>=</span><span>ma</span>(<span>n</span><span>+</span><span>1</span>);<span>C</span> <span>c</span>;
 <span>DO</span>(<span>n</span>,<span>e</span>[<span>i</span>]<span>=</span>(<span>a</span><span>=</span><span>noun</span>(<span>c</span><span>=</span><span>s</span>[<span>i</span>]))?<span>a</span>:(<span>a</span><span>=</span><span>verb</span>(<span>c</span>))?<span>a</span>:<span>c</span>);<span>e</span>[<span>n</span>]<span>=</span><span>0</span>;<span>R</span> <span>e</span>;}

<span>main</span>(){<span>C</span> <span>s</span>[<span>99</span>];<span>while</span>(<span>gets</span>(<span>s</span>))<span>pr</span>(<span>ex</span>(<span>wd</span>(<span>s</span>)));}</pre></div><div data-snippet-clipboard-copy-content="kelas@prng j % make
 2+2
4
 x:!10
0 1 2 3 4 5 6 7 8 9
 y:|x
9 8 7 6 5 4 3 2 1 0
 x+y
9 9 9 9 9 9 9 9 9 9
 +/x+y
90
 *\y
9 72 504 3024 15120 60480 181440 362880 362880 0"><pre><code>kelas@prng j % make
 2+2
4
 x:!10
0 1 2 3 4 5 6 7 8 9
 y:|x
9 8 7 6 5 4 3 2 1 0
 x+y
9 9 9 9 9 9 9 9 9 9
 +/x+y
90
 *\y
9 72 504 3024 15120 60480 181440 362880 362880 0
</code></pre></div></div>
  </body>
</html>
