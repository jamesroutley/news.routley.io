<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/marketplace/actions/cross-platform-action">Original</a>
    <h1>Show HN: Cross-Platform GitHub Action</h1>
    
    <div id="readability-page-1" class="page"><div>
          <div>
            
<p dir="auto">This project provides a GitHub action for running GitHub Action workflows on
multiple platforms. This includes platforms that GitHub Actions doesn&#39;t
currently natively support.</p>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<p dir="auto">Some of the features that are supported include:</p>
<ul dir="auto">
<li>Multiple operating system with one single action</li>
<li>Multiple versions of each operating system</li>
<li>Allows to use default shell or Bash shell</li>
<li>Low boot overhead</li>
<li>Fast execution</li>
</ul>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<p dir="auto">Here&#39;s a sample workflow file which will setup a matrix resulting in four jobs.
One which will run on FreeBSD 13.1, one which runs OpenBSD 7.2, one which runs
NetBSD 9.2 and one which runs OpenBSD 7.2 on ARM64.</p>
<div dir="auto" data-snippet-clipboard-copy-content="name: CI

on: [push]

jobs:
  test:
    runs-on: ${{ matrix.os.host }}
    strategy:
      matrix:
        os:
          - name: freebsd
            architecture: x86-64
            version: &#39;13.1&#39;
            host: macos-12

          - name: openbsd
            architecture: x86-64
            version: &#39;7.2&#39;
            host: macos-12

          - name: openbsd
            architecture: arm64
            version: &#39;7.2&#39;
            host: ubuntu-latest

          - name: netbsd
            architecture: x86-64
            version: &#39;9.2&#39;
            host: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Test on ${{ matrix.os.name }}
        uses: cross-platform-actions/action@v0.9.0
        env:
          MY_ENV1: MY_ENV1
          MY_ENV2: MY_ENV2
        with:
          environment_variables: MY_ENV1 MY_ENV2
          operating_system: ${{ matrix.os.name }}
          architecture: ${{ matrix.os.architecture }}
          version: ${{ matrix.os.version }}
          shell: bash
          run: |
            uname -a
            echo $SHELL
            pwd
            ls -lah
            whoami
            env | sort"><pre><span>name</span>: <span>CI</span>

<span>on</span>: <span>[push]</span>

<span>jobs</span>:
  <span>test</span>:
    <span>runs-on</span>: <span>${{ matrix.os.host }}</span>
    <span>strategy</span>:
      <span>matrix</span>:
        <span>os</span>:
          - <span>name</span>: <span>freebsd</span>
            <span>architecture</span>: <span>x86-64</span>
            <span>version</span>: <span><span>&#39;</span>13.1<span>&#39;</span></span>
            <span>host</span>: <span>macos-12</span>

          - <span>name</span>: <span>openbsd</span>
            <span>architecture</span>: <span>x86-64</span>
            <span>version</span>: <span><span>&#39;</span>7.2<span>&#39;</span></span>
            <span>host</span>: <span>macos-12</span>

          - <span>name</span>: <span>openbsd</span>
            <span>architecture</span>: <span>arm64</span>
            <span>version</span>: <span><span>&#39;</span>7.2<span>&#39;</span></span>
            <span>host</span>: <span>ubuntu-latest</span>

          - <span>name</span>: <span>netbsd</span>
            <span>architecture</span>: <span>x86-64</span>
            <span>version</span>: <span><span>&#39;</span>9.2<span>&#39;</span></span>
            <span>host</span>: <span>ubuntu-latest</span>

    <span>steps</span>:
      - <span>uses</span>: <span>actions/checkout@v2</span>

      - <span>name</span>: <span>Test on ${{ matrix.os.name }}</span>
        <span>uses</span>: <span>cross-platform-actions/action@v0.9.0</span>
        <span>env</span>:
          <span>MY_ENV1</span>: <span>MY_ENV1</span>
          <span>MY_ENV2</span>: <span>MY_ENV2</span>
        <span>with</span>:
          <span>environment_variables</span>: <span>MY_ENV1 MY_ENV2</span>
          <span>operating_system</span>: <span>${{ matrix.os.name }}</span>
          <span>architecture</span>: <span>${{ matrix.os.architecture }}</span>
          <span>version</span>: <span>${{ matrix.os.version }}</span>
          <span>shell</span>: <span>bash</span>
          <span>run</span>: <span>|</span>
<span>            uname -a</span>
<span>            echo $SHELL</span>
<span>            pwd</span>
<span>            ls -lah</span>
<span>            whoami</span>
<span>            env | sort</span></pre></div>
<p dir="auto">Different platforms need to run on different runners, see the
<a href="#runners">Runners</a> section below.</p>
<h3 dir="auto"><a id="user-content-inputs" aria-hidden="true" href="#inputs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Inputs</h3>
<p dir="auto">This section lists the available inputs for the action.</p>
<table>
<thead>
<tr>
<th>Input</th>
<th>Required</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>run</code></td>
<td>✓</td>
<td>✗</td>
<td>Runs command-line programs using the operating system&#39;s shell. This will be executed inside the virtual machine.</td>
</tr>
<tr>
<td><code>operating_system</code></td>
<td>✓</td>
<td>✗</td>
<td>The type of operating system to run the job on. See <a href="#supported-platforms">Supported Platforms</a>.</td>
</tr>
<tr>
<td><code>version</code></td>
<td>✓</td>
<td>✗</td>
<td>The version of the operating system to use. See <a href="#supported-platforms">Supported Platforms</a>.</td>
</tr>
<tr>
<td><code>shell</code></td>
<td>✗</td>
<td><code>default</code></td>
<td>The shell to use to execute the commands. Defaults to the default shell for the given operating system. Allowed values are: <code>default</code>, <code>sh</code> and <code>bash</code></td>
</tr>
<tr>
<td><code>environment_variables</code></td>
<td>✗</td>
<td><code>&#34;&#34;</code></td>
<td>A list of environment variables to forward to the virtual machine. The list should be separated with spaces.</td>
</tr>
</tbody>
</table>
<p dir="auto">All inputs are expected to be strings. It&#39;s important that especially the
<code>version</code> is explicitly specified as a string, using single or double quotes.
Otherwise YAML might interpet the value as a numeric value instead of a string.
This might lead to some unexpected behavior. If the version is specified as
<code>version: 13.0</code>, YAML will interpet <code>13.0</code> as a floating point number, drop the
fraction part (because <code>13</code> and <code>13.0</code> are the same) and the GitHub action will
only see <code>13</code> instead of <code>13.0</code>. The solution is to explicitly state that a
string is required by using quotes: <code>version: &#39;13.0&#39;</code>.</p>
<h2 dir="auto"><a id="user-content-supported-platforms" aria-hidden="true" href="#supported-platforms"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Supported Platforms</h2>
<p dir="auto">This sections lists the currently supported platforms by operating system. Each
operating system will list which versions are supported.</p>
<h3 dir="auto"><a id="user-content-openbsd-openbsd" aria-hidden="true" href="#openbsd-openbsd"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><a href="https://github.com/cross-platform-actions/openbsd-builder">OpenBSD</a> (<code>openbsd</code>)</h3>
<table>
<thead>
<tr>
<th>Version</th>
<th>x86-64</th>
<th>arm64</th>
</tr>
</thead>
<tbody>
<tr>
<td>7.2</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>7.1</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>6.9</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td>6.8</td>
<td>✓</td>
<td>✗</td>
</tr>
</tbody>
</table>
<h3 dir="auto"><a id="user-content-freebsd-freebsd" aria-hidden="true" href="#freebsd-freebsd"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><a href="https://github.com/cross-platform-actions/freebsd-builder">FreeBSD</a> (<code>freebsd</code>)</h3>
<table>
<thead>
<tr>
<th>Version</th>
<th>x86-64</th>
</tr>
</thead>
<tbody>
<tr>
<td>13.1</td>
<td>✓</td>
</tr>
<tr>
<td>13.0</td>
<td>✓</td>
</tr>
<tr>
<td>12.4</td>
<td>✓</td>
</tr>
<tr>
<td>12.2</td>
<td>✓</td>
</tr>
</tbody>
</table>
<h3 dir="auto"><a id="user-content-netbsd-netbsd" aria-hidden="true" href="#netbsd-netbsd"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><a href="https://github.com/cross-platform-actions/netbsd-builder">NetBSD</a> (<code>netbsd</code>)</h3>
<table>
<thead>
<tr>
<th>Version</th>
<th>x86-64</th>
</tr>
</thead>
<tbody>
<tr>
<td>9.2</td>
<td>✓</td>
</tr>
</tbody>
</table>
<h3 dir="auto"><a id="user-content-runners" aria-hidden="true" href="#runners"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Runners</h3>
<p dir="auto">This section list the different combinations of platforms and on which runners
they can run.</p>
<table>
<thead>
<tr>
<th>Runner</th>
<th>OpenBSD</th>
<th>FreeBSD</th>
<th>NetBSD</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Linux</strong></td>
<td>✓</td>
<td>✓</td>
<td>✓</td>
</tr>
<tr>
<td><strong>macos-10.15</strong>, <strong>macos-11</strong>, <strong>macos-12</strong></td>
<td>✓</td>
<td>✓</td>
<td>✗</td>
</tr>
</tbody>
</table>
<h2 dir="auto"><a id="user-content-under-the-hood" aria-hidden="true" href="#under-the-hood"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Under the Hood</h2>
<p dir="auto">GitHub Actions currently only support the following platforms: macOS, Linux and
Windows. To be able to run other platforms, this GitHub action runs the
commands inside a virtual machine (VM). If the host platform is macOS the
hypervisor can take advantage of nested virtualization.</p>
<p dir="auto">The FreeBSD and OpenBSD VMs run on the <a href="https://github.com/machyve/xhyve">xhyve</a> hypervisor (on a macOS
host), while the other platforms run on the <a href="https://www.qemu.org" rel="nofollow">QEMU</a> hypervisor (on a Linux
host). xhyve is built on top of Apple&#39;s <a href="https://developer.apple.com/library/mac/documentation/DriversKernelHardware/Reference/Hypervisor/index.html" rel="nofollow">Hypervisor</a>
framework. The Hypervisor framework allows to implement hypervisors with
support for hardware acceleration without the need for kernel extensions. xhyve
is a lightweight hypervisor that boots the guest operating systems quickly and
requires no dependencies outside of what&#39;s provided by the system. QEMU is a
more general purpose hypervisor that runs on most host platforms and supports
most guest systems. It&#39;s a bit slower than xhyve because it&#39;s general purpose
and it cannot use nested virtualization on the Linux hosts provided by GitHub.</p>
<p dir="auto">The VM images running inside the hypervisor are built using <a href="https://www.packer.io" rel="nofollow">Packer</a>.
It&#39;s a tool for automatically creating VM images, installing the guest
operating system and doing any final provisioning.</p>
<p dir="auto">The GitHub action uses SSH to communicate and execute commands inside the VM.
It uses <a href="https://en.wikipedia.org/wiki/Rsync" rel="nofollow">rsync</a> to share files between the guest VM and the host. xhyve
does not have any native support for sharing files. To authenticate the SSH
connection a unique key pair is used. This pair is generated each time the
action is run. The public key is added to the VM image and the private key is
stored on the host. Since xhyve does not support file sharing, a secondar hard
drive, which is backed by a file, is created. The public key is stored on this
hard drive, which is then mounted by the VM. At boot time, the secondary hard
drive will be identified and the public key will be copied to the appropriate
location.</p>
<p dir="auto">To reduce the time it takes for the GitHub action to start executing the
commands specified by the user, it aims to boot the guest operating systems as
fast as possible. This is achieved in a couple of ways:</p>
<ul dir="auto">
<li>
<p dir="auto">By downloading <a href="https://github.com/cross-platform-actions/resources">resources</a>, like the hypervisor and a few other
tools, instead of installing them through a package manager</p>
</li>
<li>
<p dir="auto">No compression is used for the resources that are downloaded. The size is
small enough anyway and it&#39;s faster to download the uncompressed data than
it is to download compressed data and then uncompress it.</p>
</li>
<li>
<p dir="auto">It leverages <code>async</code>/<code>await</code> to perform tasks asynchronously. Like
downloading the VM image and other resources at the same time</p>
</li>
<li>
<p dir="auto">It performs as much as possible of the setup ahead of time when the VM image
is provisioned</p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-local-development" aria-hidden="true" href="#local-development"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Local Development</h2>
<h3 dir="auto"><a id="user-content-prerequisites" aria-hidden="true" href="#prerequisites"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Prerequisites</h3>
<ul dir="auto">
<li><a href="https://nodejs.org" rel="nofollow">NodeJS</a></li>
<li><a href="https://github.com/npm/cli">npm</a></li>
<li><a href="https://git-scm.com" rel="nofollow">git</a></li>
</ul>
<h3 dir="auto"><a id="user-content-instructions" aria-hidden="true" href="#instructions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Instructions</h3>
<ol dir="auto">
<li>
<p dir="auto">Install the above prerequisites</p>
</li>
<li>
<p dir="auto">Clone the repository by running:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/cross-platform-actions/action"><pre><code>git clone https://github.com/cross-platform-actions/action
</code></pre></div>
</li>
<li>
<p dir="auto">Navigate to the newly cloned repository: <code>cd action</code></p>
</li>
<li>
<p dir="auto">Install the dependencies by running: <code>npm install</code></p>
</li>
<li>
<p dir="auto">Run any of the below npm commands</p>
</li>
</ol>
<h3 dir="auto"><a id="user-content-npm-commands" aria-hidden="true" href="#npm-commands"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>npm Commands</h3>
<p dir="auto">The following npm commands are available:</p>
<ul dir="auto">
<li><code>build</code> - Build the GitHub action</li>
<li><code>format</code> - Reformat the code</li>
<li><code>lint</code> - Lint the code</li>
<li><code>package</code> - Package the GitHub action for distribution and end to end testing</li>
<li><code>test</code> - Run unit tests</li>
<li><code>all</code> - Will run all of the above commands</li>
</ul>
<h3 dir="auto"><a id="user-content-running-end-to-end-tests" aria-hidden="true" href="#running-end-to-end-tests"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Running End to End Tests</h3>
<p dir="auto">The end to end tests can be run locally by running it through <a href="https://github.com/nektos/act">Act</a>. By
default, resources and VM images will be downloaded from github.com. By running
a local HTTP server it&#39;s possible to point the GitHub action to local resources.</p>
<h4 dir="auto"><a id="user-content-prerequisites-1" aria-hidden="true" href="#prerequisites-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Prerequisites</h4>
<ul dir="auto">
<li><a href="https://docker.com" rel="nofollow">Docker</a></li>
<li><a href="https://github.com/nektos/act">Act</a></li>
</ul>
<h4 dir="auto"><a id="user-content-instructions-1" aria-hidden="true" href="#instructions-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Instructions</h4>
<ol dir="auto">
<li>
<p dir="auto">Install the above prerequisites</p>
</li>
<li>
<p dir="auto">Copy <a href="https://github.com/cross-platform-actions/action/blob/master/test/workflows/ci.yml.example"><code>test/workflows/ci.yml.example</code></a> to
<code>test/workflows/ci.yml</code></p>
</li>
<li>
<p dir="auto">Make any changes you like to <code>test/workflows/ci.yml</code>, this is file ignored by
Git</p>
</li>
<li>
<p dir="auto">Build the GitHub action by running: <code>npm run build</code></p>
</li>
<li>
<p dir="auto">Package the GitHub action by running: <code>npm run package</code></p>
</li>
<li>
<p dir="auto">Run the GitHub action by running: <code>act --privileged -W test/workflows</code></p>
</li>
</ol>
<h4 dir="auto"><a id="user-content-providing-resources-locally" aria-hidden="true" href="#providing-resources-locally"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Providing Resources Locally</h4>
<p dir="auto">The GitHub action includes a development dependency on a HTTP server. The
<a href="https://github.com/cross-platform-actions/action/blob/master/test/http"><code>test/http</code></a> directory contains a skeleton of a directory structure
which matches the URLs that the GitHub action uses to download resources. All
files within the <a href="https://github.com/cross-platform-actions/action/blob/master/test/http"><code>test/http</code></a> are ignore by Git.</p>
<ol dir="auto">
<li>
<p dir="auto">Add resources as necessary to the <a href="https://github.com/cross-platform-actions/action/blob/master/test/http"><code>test/http</code></a> directory</p>
</li>
<li>
<p dir="auto">In one shell, run the following command to start the HTTP server:</p>
<div data-snippet-clipboard-copy-content="./node_modules/http-server/bin/http-server test/http -a 127.0.0.1"><pre><code>./node_modules/http-server/bin/http-server test/http -a 127.0.0.1
</code></pre></div>
<p dir="auto">The <code>-a</code> flag configures the HTTP server to only listen for incoming
connections from localhost, no external computers will be able to connect.</p>
</li>
<li>
<p dir="auto">In another shell, run the GitHub action by running:</p>
<div data-snippet-clipboard-copy-content="act --privileged -W test/workflows --env CPA_RESOURCE_URL=&lt;url&gt;"><pre><code>act --privileged -W test/workflows --env CPA_RESOURCE_URL=&lt;url&gt;
</code></pre></div>
<p dir="auto">Where <code>&lt;url&gt;</code> is the URL inside Docker that points to localhost of the host
machine, for macOS, this is <code>http://host.docker.internal:8080</code>. By default,
the HTTP server is listening on port <code>8080</code>.</p>
</li>
</ol>

          </div>

      </div></div>
  </body>
</html>
