<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ounapuu.ee/posts/2023/01/27/thinkpad-as-server-followup/">Original</a>
    <h1>ThinkPad as a Server: The Follow-Up</h1>
    
    <div id="readability-page-1" class="page"><div>
      
      <p>It’s been a while since I last wrote about my <a href="https://ntietz.com/posts/2022/05/10/thinkpad-as-a-home-server/">ThinkPad T430 that was tasked with being a home server.</a>
After doing some experiments with my setup a couple of times, it is once again the main server for all my self-hosting
needs. However, this time I have made some adjustments.</p>

  <figure>
    <img src="https://ntietz.com/media/thinkpad-as-server-followup/cover.jpg"/>
    
  </figure>


<h3 id="background">Background</h3>
<p>The monstrosity that you’re looking at is what I’d call “the minimum viable ThinkPad as a server”. To be fair, you <em>could</em>
go even more minimal by ripping out everything but the motherboard and the drives, but for my use case this is how far I
was willing to go.</p>
<p>In my previous post about this setup, I mentioned that the T430 suffered unexpected shutdowns under certain situations,
which usually involved running the fan at the lowest speed, moderate to high CPU load, and a lot of storage activity.
It wasn’t the CPU as the temperatures were way below the critical point, so I suspected either the motherboard or the
storage running hot and tripping some sensor that I wasn’t aware of.</p>
<p>For a while now, I have been thinking about running the T430 as bare as possible. One idea involved taking the bare
motherboard and the storage and slapping it on an acrylic sheet with some stand-offs, which should give it the best
chance at cooling. Unfortunately I didn’t have enough time to commit to this, and that setup would have had some
downsides as well. At some point an idea popped to my mind: I could probably achieve a similar result by stripping
everything but the bare necessities from the laptop and improve the cooling as a result. That’s how I ended up with
what you just saw.</p>
<h3 id="t430-stripped">T430, stripped</h3>
<p>I ended up removing the following from the T430:</p>
<ul>
<li>palm rest</li>
<li>smart card reader</li>
<li>Bluetooth chip</li>
<li>WiFi chip</li>
<li>the whole display assembly</li>
</ul>
<p>This was in part motivated by the fact that those parts are the ones that are not in the best shape on my main ThinkPad
T430 that I use as an actual laptop. The other part was this nagging feeling that the most powerful PC that I own
<a href="https://ntietz.com/posts/2022/01/17/asrock-x300-future-of-desktops/">(the ASRock DeskMini X300)</a> was woefully underutilized as my home
server.</p>
<p>The keyboard had to stay because the power button is part of the keyboard assembly. There are ways to power on the
laptop without the keyboard:</p>
<ul>
<li>put the laptop in a dock and use the power button that is present on the dock</li>
<li>short a specific pin on the keyboard connector to ground</li>
</ul>
<p>I do have some extra ThinkPad docks around that I could have used for this purpose, but it would have made the setup
bulkier, which is why I did not go for that, at least not yet.</p>
<p>There is also an option in UEFI settings that can be used to turn the laptop on by connecting the charger
(“Power on with AC attach”), but that only seems to work if you have a battery connected and after you have turned the
laptop on manually once. The same caveat applies for Wake on LAN functionality. If the laptop overheats or it runs out
of battery completely, then you need to manually power it on.</p>
<h3 id="the-cooling-situation">The cooling situation</h3>
<p>Removing the palm rest reveals something that might be related to the unexpected shutdowns that I observed with this
setup previously.</p>

  <figure>
    <img src="https://ntietz.com/media/thinkpad-as-server-followup/image-0.jpg"/>
    
  </figure>


<p>Under this area is a chip on the motherboard that seems to generate a modest amount of heat. While the machine is running,
it gets warm to touch and gets hot if you throw a high load at the system, especially if you include storage in the
mix. With the laptop lid closed and the palm rest being present, the cooling situation for this area can be quite bad
indeed. Now that the palm rest is removed, this area of the laptop is now exposed, which should help with the cooling
for this chip.</p>
<p>Having the keyboard connected in this state isn’t too bad. It does restrict the airflow a bit, yes, but at least it can
be fastened using two screws, which means that it won’t move around and cause any other issues.</p>

  <figure>
    <img src="https://ntietz.com/media/thinkpad-as-server-followup/image-1.jpg"/>
    
  </figure>


<p>With this setup, the cooling has improved noticeably. Unfortunately it didn’t come to my mind to make a before/after
comparison to better illustrate this, so I will just write about how well it operates in this configuration.</p>
<p>Currently, I have the laptop fan controlled by a modified version of <a href="https://ntietz.com/posts/2022/09/26/minimum-viable-fan-control-script/">the minimum viable fan control script</a>.
The fan only kicks in after the CPU reaches 60°C, ramps up to a moderate speed at over 85°C, and lets the default fan
behaviour handle everything if the temperatures reaches over 95°C. This results in the fan being off completely for most
of the day as the server is idling at around 5-10% CPU usage and temperatures being anywhere between 45-60°C. When there
is a workload on the system that taxes the CPU, the fan will kick on with a small delay.</p>
<p>I’ve also disabled turbo boost on the Intel i7-3632QM that is currently in this T430, which limits the clock speed to
2.2 GHz max. Performance takes a small hit, but the CPU is now running much more efficiently. This is one of the tweaks
that allows the laptop to be near silent. At a full 8 thread CPU load using <code>stress -c 8</code>, the CPU core temperatures
peak at 70°C at 22°C ambient temperature, with the fan running at around 2600 RPM.</p>
<p>As a result of all of this, the T430 is very quiet while using about 10-12W of power while idling.
Under the maximum CPU load generated by <code>stress</code>, the total system power usage is around 34W.</p>
<h3 id="putting-the-paste-in-thermal-paste">Putting the “paste” in thermal paste</h3>
<p>Originally, the T430-as-a-server ran vertically using a basic laptop vertical stand. Back when I concluded the initial
test in 2022, I disassembled the machine and noticed something very odd with the thermal paste.</p>

  <figure>
    <img src="https://ntietz.com/media/thinkpad-as-server-followup/image-2.jpg"/>
    
  </figure>


<p>Based on this image and the fact that I ran the machine quite warm most of the time (CPU temperatures around 60-80°C),
I assume that the excess thermal paste started slowly dripping down. The part that concerns me the most is that the top
of the chip was barely covered by the thermal paste. Either that part of the chip had great contact with the heatsink,
or the thermal paste drooped down with time and left it mostly uncovered. It could explain some of the issues, but
I’ll avoid making any definitive conclusions from this alone.</p>
<p>To avoid similar issues in the future, the laptop is now on a stand at about 60° angle. Not sure if it will work,
but it’s worth a shot.</p>
<h3 id="closing-thoughts">Closing thoughts</h3>
<p>Overall, I’m happy with how this experiment turned out. Cooling is no longer an issue, and the T430 that I initially
got for spare parts is actually being useful. The amount of performance this machine offers while using very little
power seems to be a good balance for the workloads that I run on my home server.</p>

<p>If you prefer to share your thoughts on this post privately,
<a href="mailto:ihavesomethoughtsonyourblog@ounapuu.ee">just send me an e-mail!</a></p>
<p>Places where you can discuss this post:</p>
<ul>
<li><a href="https://news.ycombinator.com/item?id=34542920">Hacker News</a></li>
<li><a href="https://forum.level1techs.com/t/hddhermans-blog/180788/28?u=hddherman">Level1Techs forum</a></li>
<li><a href="https://www.linkedin.com/posts/%F0%9F%94%A5-herman-%C3%B5unapuu-600516152_thinkpad-as-a-server-the-follow-up-activity-7024612446866673664-HAU3">LinkedIn</a></li>
<li><a href="https://www.reddit.com/user/hddherman/comments/10mdekw/thinkpad_as_a_server_the_followup/">Reddit</a></li>
</ul>

    </div></div>
  </body>
</html>
