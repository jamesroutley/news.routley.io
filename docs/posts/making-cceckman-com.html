<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cceckman.com/writing/colophonics/">Original</a>
    <h1>Making cceckman.com</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p>I serve this site through a combination of cloud and at-home infrastructure.
This post (and its children) outline how it’s set up.</p>
<figure><img src="https://cceckman.com/writing/colophonics/teaser.png" alt="A screenshot of this web page."/><figcaption>
      <p>I didn’t make this an <code>iframe</code>. You’re welcome.</p>
    </figcaption>
</figure>
<h2 id="motivation">Motivation</h2>
<p>I’ve had some sort of a personal website for most of my life.
I like having a space on the web that is <em>mine</em>,
not part of someone else’s platform.</p>
<p>Running a site also lets me practice my sysadmin skills,
and provides an opportunity to use technologies I’d otherwise skip.
Learning new things is fun!</p>
<p>When I quit my job, I figured my <a target="_blank" href="https://www.recurse.com/scout/click?t=8238c6d9149cbd0865752e535795d509">RC batch</a>
would be a good chance to revise my site
<a href="https://cceckman.com/writing/website-wallpaper">aesthetically</a> and technically.
I got most of this work done over the course of 2024.</p>
<h3 id="goals">Goals</h3>
<p>Why rebuild my site? I have a specific set of goals and requirements:</p>
<ul>
<li>
<p><strong>Request logging</strong>: I don’t want to use client-side tracking, but I still want
to know what pages are popular.
This requirement precludes using static-content hosting such as GitHub Pages, S3, or GCS.</p>
</li>
<li>
<p><strong>Dynamic content</strong>: I want to go beyond static pages.
At the moment, this is just
my repository redirector,<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> but
I want to support <a href="https://en.wikipedia.org/wiki/Linkback" rel="external" target="_blank">linkbacks</a> and other Web features.
This also rules out static-content services.</p>
</li>
<li>
<p><strong>Availability</strong>: I want my site to be up even if my house is powered down.
This rules out “pure” self-hosting.</p>
</li>
<li>
<p><strong>Cost control</strong>: I want to use free services where available, and keep a good eye
on my budget otherwise. Several providers target the $5/mo price point
(Fly.io, DigitalOcean).</p>
</li>
<li>
<p><strong>Authority</strong>: I want to make sure that I have ultimate control over the content
served.
I’m okay with delegating some things (including TLS), but I want to make sure that
“anyone else” is at most caching what my server returns.<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup></p>
</li>
<li>
<p><strong>Portability</strong>: I want to be able to move between providers easily.
I should not rely on provider-specific features, platforms, or APIs.<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup></p>
</li>
</ul>
<h3 id="non-goals">Non-goals</h3>
<p>I also decided on things I <em>don’t</em> care about.</p>
<ul>
<li>
<p><strong>End-to-end encryption</strong>: I don’t need a full encrypted tunnel between the user agent
and the server I control.
I’m not collecting any sensitive data from visitors,
and I’m only sharing stuff to the public anyway.</p>
</li>
<li>
<p><strong>Zero-cost</strong>: Free services can go a long way, but I am okay with spending <em>some</em> money.
In particular, reliably running my own authoritative DNS requires static IP addresses,<sup id="fnref:4"><a href="#fn:4" role="doc-noteref">4</a></sup>
which cost $2/mo at many cloud providers.<sup id="fnref:5"><a href="#fn:5" role="doc-noteref">5</a></sup></p>
</li>
</ul>
<h2 id="overview">Overview</h2>
<details>
  <summary>Disclaimer: Fastly and Google affiliations</summary>
<p>As of early 2025, I work for Fastly. Previously, I worked for Google.
At time of writing, I hold Google stock.</p>
<p>I chose Google as a provider in part due to my familiarity with Google Cloud Platform.
I chose Fastly (before going to work there) because they offered a free tier,
and their competitor Cloudflare is <a href="https://www.propublica.org/article/how-cloudflare-helps-serve-up-hate-on-the-web" rel="external" target="_blank">known for hosting Nazis</a>.</p>
<p>I don’t speak for either company. This post was not vetted or sponsored by anyone–
it is my own work.
There’s no referral codes or other kickbacks in this article.</p>
</details>
<figure><img src="https://cceckman.com/writing/colophonics/overview.svg" alt="A diagram of the components described below. DNS traffic goes from users, to recursive resolvers (typically at your ISP), to pvm1 or pvm2, which get data from pvm0. HTTP traffic goes to the Fastly CDN, possibly through multiple servers, then to pvm0."/><figcaption>
      <p>All the paths from you to cceckman.com.</p>
    </figcaption>
</figure>
<p>In its current form, cceckman.com is served by:</p>
<ul>
<li>
<p>The <a href="https://www.fastly.com" rel="external" target="_blank">Fastly</a> CDN: provides a <a href="https://www.rfc-editor.org/rfc/rfc9111" rel="external" target="_blank">cache</a> for HTTP traffic.
(This uses Fastly’s <a href="https://www.fastly.com/pricing" rel="external" target="_blank">free tier</a>.)</p>
<p>Fastly <a href="https://www.fastly.com/documentation/guides/integrations/logging/" rel="external" target="_blank">streams request logs</a>
to a <a href="https://cloud.google.com/storage" rel="external" target="_blank">GCS</a> bucket. I pull the logs out asynchronously and add them
to a SQLite database for analysis.</p>
</li>
<li>
<p><code>pvm1</code> and <code>pvm2</code>: two public-facing VMs, hosted by <a href="https://cloud.google.com/" rel="external" target="_blank">GCP</a> and <a href="https://www.digitalocean.com/" rel="external" target="_blank">DigitalOcean</a>.
(The GCP instance is in the <a href="https://cloud.google.com/free/docs/free-cloud-features#compute" rel="external" target="_blank">free tier</a>.)</p>
<p>Both VMs are secondary <a href="https://bind9.readthedocs.io/en/latest/chapter3.html#authoritative-name-servers" rel="external" target="_blank">authoritative name servers</a>
for the <code>cceckman.com</code> zone, using <a href="https://bind9.readthedocs.io/" rel="external" target="_blank">BIND9</a>.
To serve this role, the servers have static IPs, and are publicly listed in the DNS.</p>
<p><code>pvm2</code> is also a <a href="https://www.fastly.com/documentation/guides/concepts/failover/#basic-fallback" rel="external" target="_blank">fallback</a> origin server for the CDN.</p>
</li>
<li>
<p><code>pvm0</code>: a server on my home network.</p>
<p>This provides the (hidden) primary <a href="https://bind9.readthedocs.io/en/latest/chapter3.html#authoritative-name-servers" rel="external" target="_blank">authoritative name server</a> for the <code>cceckman.com</code>
zone, using <a href="https://bind9.readthedocs.io/" rel="external" target="_blank">BIND9</a>.</p>
<p>It also serves as the primary origin server for the CDN (i.e. not a fallback),
using <a href="https://caddyserver.com" rel="external" target="_blank">Caddy</a> for serving and <a href="https://gohugo.io" rel="external" target="_blank">Hugo</a> for the static files.</p>
<p>Currently, <code>pvm0</code> has a static IP address.
However, the IP only appears in my config files, not in the DNS or in <a href="https://certificate.transparency.dev/" rel="external" target="_blank">CT logs</a>.
This provides an additional measure of privacy and protection:
since this server only gets traffic from the CDN and my VMs, it doesn’t need
to be discoverable except via configuration files.</p>
</li>
</ul>
<p>In addition, I have a local <a href="https://prometheus.io/" rel="external" target="_blank">Prometheus</a> stack that sends metrics to <a href="https://grafana.com/products/cloud" rel="external" target="_blank">Grafana Cloud</a>.
(The Grafana Cloud usage is in the <a href="https://grafana.com/pricing/" rel="external" target="_blank">free tier</a>.)</p>
<h2 id="upcoming-topics">Upcoming topics</h2>
<p>I’m planning on writing more about this configuration:</p>
<ul>
<li>DNS: Hidden primary DNS, DNSSEC management</li>
<li>Caddy configuration for self-signed certificates</li>
<li>Monitoring</li>
</ul>
<p>If there’s a particular topic you’re interested in, let me know!</p>




  <ul>
    
    
    
  </ul>

</div></div>
  </body>
</html>
