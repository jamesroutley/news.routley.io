<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://textslashplain.com/2024/04/10/browser-security-bugs-that-arent-javascript-in-pdf/">Original</a>
    <h1>Browser Security Bugs That Aren&#39;t: JavaScript in PDF</h1>
    
    <div id="readability-page-1" class="page"><div id="content">

	<section id="primary">
		<main id="main">

			
<article id="post-10756">

	

	
	<div>
		
<p>A fairly common security bug report is of the form: “<em>I can put JavaScript inside a PDF file and it runs!</em>” </p>



<p>For example, open <a href="https://webdbg.com/test/pdf/contains-script.pdf">this PDF file</a> with Chrome, and you can see the <code>alert(1)</code> message displayed:</p>


<div>
<figure><a href="https://textplain.files.wordpress.com/2024/04/image-11.png"><img data-attachment-id="10763" data-permalink="https://textslashplain.com/2024/04/10/browser-security-bugs-that-arent-javascript-in-pdf/image-11-27/" data-orig-file="https://textplain.files.wordpress.com/2024/04/image-11.png" data-orig-size="1485,470" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-11" data-image-description="" data-image-caption="" data-medium-file="https://textplain.files.wordpress.com/2024/04/image-11.png?w=300" data-large-file="https://textplain.files.wordpress.com/2024/04/image-11.png?w=750" width="1024" height="324" src="https://textplain.files.wordpress.com/2024/04/image-11.png?w=1024" alt="" srcset="https://textplain.files.wordpress.com/2024/04/image-11.png?w=1024 1024w, https://textplain.files.wordpress.com/2024/04/image-11.png?w=150 150w, https://textplain.files.wordpress.com/2024/04/image-11.png?w=300 300w, https://textplain.files.wordpress.com/2024/04/image-11.png?w=768 768w, https://textplain.files.wordpress.com/2024/04/image-11.png 1485w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure></div>


<p>Support for JavaScript within PDFs is by-design and expected by the developers of PDF rendering software, including common browsers like Chrome and Edge. Much like HTML, PDF files are an <a href="https://chromium.googlesource.com/chromium/src/+/master/docs/security/faq.md#Are-PDF-files-static-content-in-Chromium">active content</a> type and may contain JavaScript.</p>



<p>Periodically, <em>less experienced</em> security researchers excitedly file this issue against <strong>browsers</strong>, and those reports are quickly resolved “<a href="https://chromium.googlesource.com/chromium/src/+/master/docs/security/faq.md#Are-PDF-files-static-content-in-Chromium">By Design</a>.”</p>



<p>Periodically, <em>more experienced</em> security researchers excitedly file this issue against <strong>sites and applications</strong> that are willing to host or transfer untrusted PDF files, arguing that this represents a “<a href="https://owasp.org/www-community/attacks/xss/#stored-xss-attacks">Stored Cross-Site Scripting vulnerability</a>.” </p>



<p>Their confusion here is somewhat more understandable– if a website allows a user to upload a <strong>HTML document</strong> containing script, and then <span>serves that HTML document from their domain</span>, any script within it will run in the security context of the serving domain. <em>That </em>describes a classic Stored XSS Attack, and it presents a security threat because the embedded script can steal or manipulate cookies (by accessing the <code>document.cookie</code> property), manipulate web platform storage (IndexedDB, <code>localStorage</code>, etc), conduct request forgery attacks from a 1st party origin, etc.</p>



<p>The story for PDF documents is very different.</p>



<p>The <a href="https://chromium.googlesource.com/chromium/src/+/master/docs/security/faq.md#does-executing-javascript-in-a-pdf-file-mean-there_s-an-xss-vulnerability">Chrome Security FAQ</a> describes the limitation tersely, noting <code>the set of bindings provided to the PDF are more limited than those provided by the DOM to HTML documents, nor do PDFs get any ambient authority based upon the domain from which they are served</code>. </p>



<p>What does that mean? It means that, while PDF’s JavaScript does run, the <em>universe </em>the script runs in is limited: there’s no access to cookies or storage, very limited ability to make requests (e.g. you can navigate the document’s window elsewhere, but that’s about it), and no ability to make use of the Web Platform’s powerful capabilities exposed by the HTML Document Object Model (DOM) objects like <code>document</code>, <code>window</code>, <code>navigator</code>, et cetera. While the capabilities of JavaScript in PDF are extremely limited, they’re not non-existent, and PDF engine software must take care to avoid introducing new capabilities that void the safety assumptions of PDF-handling code.</p>



<h4>Restricting JavaScript in PDF</h4>



<p>Engineers should take care that handling of JavaScript in PDF respects app/user settings. For example, if the user turns off JavaScript for a site, PDFs hosted on that site <a href="https://source.chromium.org/chromium/chromium/src/+/main:chrome/browser/resources/pdf/main.ts;l=40;drc=1076746b494b84eeaf625c7a475ee501de270f17">shouldn’t allow script</a> either. This works properly in Chrome and Edge.</p>


<div>
<figure><a href="https://textplain.files.wordpress.com/2024/04/image-12.png"><img data-attachment-id="10767" data-permalink="https://textslashplain.com/2024/04/10/browser-security-bugs-that-arent-javascript-in-pdf/image-12-27/" data-orig-file="https://textplain.files.wordpress.com/2024/04/image-12.png" data-orig-size="684,507" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-12" data-image-description="" data-image-caption="" data-medium-file="https://textplain.files.wordpress.com/2024/04/image-12.png?w=300" data-large-file="https://textplain.files.wordpress.com/2024/04/image-12.png?w=684" width="684" height="507" src="https://textplain.files.wordpress.com/2024/04/image-12.png?w=684" alt="" srcset="https://textplain.files.wordpress.com/2024/04/image-12.png 684w, https://textplain.files.wordpress.com/2024/04/image-12.png?w=150 150w, https://textplain.files.wordpress.com/2024/04/image-12.png?w=300 300w" sizes="(max-width: 684px) 100vw, 684px"/></a></figure></div>


<p>Somewhat surprisingly, Firefox’s global <code>javascript.enabled</code> toggle doesn’t impact script inside its PDF viewer:</p>


<div>
<figure><a href="https://textplain.files.wordpress.com/2024/04/image-13.png"><img data-attachment-id="10769" data-permalink="https://textslashplain.com/2024/04/10/browser-security-bugs-that-arent-javascript-in-pdf/image-13-27/" data-orig-file="https://textplain.files.wordpress.com/2024/04/image-13.png" data-orig-size="1353,643" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-13" data-image-description="" data-image-caption="" data-medium-file="https://textplain.files.wordpress.com/2024/04/image-13.png?w=300" data-large-file="https://textplain.files.wordpress.com/2024/04/image-13.png?w=750" width="1024" height="486" src="https://textplain.files.wordpress.com/2024/04/image-13.png?w=1024" alt="" srcset="https://textplain.files.wordpress.com/2024/04/image-13.png?w=1024 1024w, https://textplain.files.wordpress.com/2024/04/image-13.png?w=150 150w, https://textplain.files.wordpress.com/2024/04/image-13.png?w=300 300w, https://textplain.files.wordpress.com/2024/04/image-13.png?w=768 768w, https://textplain.files.wordpress.com/2024/04/image-13.png 1353w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></figure></div>


<p>Instead, Firefox offers an individual <code>pdfjs.enableScripting</code> preference that can be configured from the <code>about:flags</code> page.</p>



<p>Chromium currently <a href="https://issues.chromium.org/issues/41494478">ignores</a> <code>Content-Security-Policy</code> headers on PDF responses because it renders PDF files using web technologies that could otherwise be disallowed by the <code>CSP</code>, leading to user confusion and webdev annoyance.</p>




	</div><!-- .entry-content -->

	<!-- .entry-footer -->

			<div>
	
	<p>
		Impatient optimist. Dad. Author/speaker. Created Fiddler &amp; SlickRun. PM @ Microsoft 2001-2012, and 2018-, working on Office, IE, and Edge. Now a GPM for Microsoft Defender. My words are my own, I do not speak for any other entity.		<a href="https://textslashplain.com/author/ericlaw1979/" rel="author">
			View more posts		</a>
	</p><!-- .author-description -->
</div><!-- .author-bio -->
	
</article><!-- #post-${ID} -->

	<nav aria-label="Posts">
		<h2>Post navigation</h2>
		
	</nav>
<!-- #comments -->

		</main><!-- #main -->
	</section><!-- #primary -->


	</div></div>
  </body>
</html>
