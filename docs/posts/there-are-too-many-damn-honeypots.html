<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vulncheck.com/blog/too-many-honeypots">Original</a>
    <h1>There are too many damn honeypots</h1>
    
    <div id="readability-page-1" class="page"><div><!--[--><div><div><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-b4d8bffc=""><path fill="currentColor" d="M5.7 18L8 14q-1.65 0-2.825-1.175T4 10q0-1.65 1.175-2.825T8 6q1.65 0 2.825 1.175T12 10q0 .575-.137 1.063T11.45 12L8 18zm9 0l2.3-4q-1.65 0-2.825-1.175T13 10q0-1.65 1.175-2.825T17 6q1.65 0 2.825 1.175T21 10q0 .575-.137 1.063T20.45 12L17 18z"></path></svg><p><!--[-->According to Huntress Labs, a Shodan search for &#34;Confluence&#34; returns more than 200,000 results, and searches for the Confluence favicon return more than 5,000. These figures aren&#39;t an indication of the number of vulnerable instances, but do show how many are exposed to the internet.<!--]--></p><a href="https://www.theregister.com/2023/11/08/atlassian_confluence_flaw_upgraded/" rel="noopener noreferrer" target="_new"><p>The Register</p></a></div><div><div><!--[--><div><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-b4d8bffc=""><path fill="currentColor" d="m9 20.42l-6.21-6.21l2.83-2.83L9 14.77l9.88-9.89l2.83 2.83z"></path></svg><p><span>At the time of publication, there’s more than 235,000 internet-facing Confluence honeypots.</span></p></div><div><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-b4d8bffc=""><path fill="currentColor" d="m9 20.42l-6.21-6.21l2.83-2.83L9 14.77l9.88-9.89l2.83 2.83z"></path></svg><p><span>There’s, at most, 4,000 real internet-facing Confluence servers.</span></p></div><div><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-b4d8bffc=""><path fill="currentColor" d="m9 20.42l-6.21-6.21l2.83-2.83L9 14.77l9.88-9.89l2.83 2.83z"></path></svg><p><span>Filtering ~240,000 potential Confluence servers down to 4,000 hosts is not trivial but is important for understanding the potential impact of Confluence vulnerabilities.</span></p></div><!--]--></div></div><p><!--[-->Determining the number of internet-facing hosts affected by a new vulnerability is a key factor in determining if it will become a widespread or emergent threat. Are there a lot of hosts affected? Pretty good possibility things are about to pop off. Only a few hosts? Probably less likely. But actually, counting those hosts has become quite a bit more challenging.<!--]--></p><p><!--[-->Take for example, <a href="https://nvd.nist.gov/vuln/detail/CVE-2023-22527" rel="nofollow"><!--[-->CVE-2023-22527<!--]--></a> affecting Atlassian Confluence. At the time of writing, Confluence has appeared on the CISA KEV list nine (yes, <strong><!--[-->nine<!--]--></strong>) times. That’s a level of exploitation that should encourage everyone to get their Confluence servers off the internet. But let’s look for ourselves. There are a number of generic Confluence Shodan queries floating around, but <a href="https://pentest-tools.com/blog/detect-exploit-cve-2021-26084-confluence-server-rce#using-shodan" rel="nofollow"><!--[-->X-Confluence-Request-Time<!--]--></a> might be the most well known (this simply checks for an HTTP response header value):<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/x-confluence-request-time.png" alt="X-Confluence-Request-Time Shodan Query"/><!--]--></p><p><!--[-->241,000 hosts is a great target base for an emergent threat! But, on closer examination, there’s something off about the listed hosts. For example, this one has the Confluence “X-Confluence-Request-Time” header:<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/f5-confluence-qnap.png" alt="A honeypot pretending to be F5, Confluence, and QNAP"/><!--]--></p><p><!--[-->But it also has an F5 favicon, and it also claims to be a QNAP TS-128A. This is a honeypot. Whoever created this honeypot was somewhat clever. They mashed together the popular Shodan queries for Confluence, <a href="https://www.shodan.io/search?query=http.favicon.hash%3A-335242539" rel="nofollow"><!--[-->F5 devices<!--]--></a>, and <a href="https://www.shodan.io/search?query=http.html_hash%3A-558771039" rel="nofollow"><!--[-->QNAP systems<!--]--></a>, to create an abomination that would show up in all three queries.<!--]--></p><p><!--[-->To avoid throwing exploits all over the internet (and thus getting quickly caught), some attackers use Shodan (or similar) to curate target lists. This honeypot is optimized for this use case. Which is neat, but blocks our view of what is real. Can we filter them out of our search?<!--]--></p><p><!--[-->In a <a href="https://blog.projectdiscovery.io/atlassian-confluence-ssti-remote-code-execution/" rel="nofollow"><!--[-->blog<!--]--></a> about CVE-2023-22527, Project Discovery provides this Shodan query in a Nuclei template:<!--]--></p><blockquote><!--[--><p><!--[-->http.component:&#34;Atlassian Confluence&#34;<!--]--></p><!--]--></blockquote><p><!--[-->The result is significantly better than the “X-Confluence-Request-Time” query, but you can still see the 2nd and 3rd results are honeypots. So that won’t do.<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/nuclei.png" alt="Nuclei query"/><!--]--></p><p><!--[-->At this point, it’s probably useful to look at what a real Confluence server HTTP response looks like (this is actually after a 302 redirect, but let’s avoid that discussion):<!--]--></p><div><!----><!--[--><pre><!--[--><code>HTTP/1.1 200
Cache-Control: no-store
Expires: Thu, 01 Jan 1970 00:00:00 GMT
X-Confluence-Request-Time: 1696956993845
Set-Cookie: JSESSIONID=72D881CD92E61BE1394BB6231C28A68B; Path=/; HttpOnly
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Content-Security-Policy: frame-ancestors &#39;self&#39;
X-Accel-Buffering: no
Content-Encoding: gzip
Vary: User-Agent
Content-Type: text/html;charset=UTF-8
Content-Language: en-US
Transfer-Encoding: chunked
Date: Tue, 10 Oct 2023 16:56:33 GMT
</code><!--]--></pre><!--]--></div><p><!--[-->The server has a number of useful headers to key off of, but we’ll try to filter by adding in <code><!--[-->Set-Cookie: JSESSIONID=<!--]--></code>. That update brings the host count down to nearly half of the Nuclei query.<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/jsessionid.png" alt="Filter using JSESSIONID"/><!--]--></p><p><!--[-->But still, there are so many honeypots! Almost all of which aren’t responding with an actual Confluence landing page. A simple way we can capitalize on that is to include a snippet from the Confluence login page in our query: <code><!--[-->html:&#34;confluence-base-url&#34;<!--]--></code>:<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/baseurl.png" alt="Filter using confluence-base-url"/><!--]--></p><p><!--[-->That does knock off ~17,000 hosts, and things are looking more <em><!--[-->Confluency<!--]--></em>. But there seems to be a whole bunch of entries without favicons. Let’s drill down into one and see…<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/its-a-honeypot.png" alt="Another damn honeypot"/><!--]--></p><p><!--[-->It’s a honeypot. This one is really well done. It looks just like a standard Confluence install, except it produces 302 redirects on the <code><!--[-->.css<!--]--></code>, <code><!--[-->.js<!--]--></code>, and <code><!--[-->favicon<!--]--></code> requests.<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/redirects.png" alt="Honeypot fail #1"/><!--]--></p><p><!--[-->Unfortunately, Shodan doesn’t provide a good way to filter out hosts without favicon. Additionally, filtering on a known favicon is a non-starter because users can upload their own. So we have to find some other discrepancies in these honeypots in order to filter them out. Lucky for us, they have a few mistakes, but highlighted here is the most obvious:<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/reused-session.png" alt="Honeypot fail #2"/><!--]--></p><p><!--[-->They all use the exact same JSESSIONID. Filter all those out, and we have the following:<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/final.png" alt="The final Shodan query"/><!--]--></p><p><!--[-->A quick investigation suggests that this could be the complete set of real Confluence hosts (or just very very good honeypots). That’s a reduction from 240,000 hosts all the way down to just 4,200. That means there are approximately 236,000 Confluence honeypots on the internet or more than 50 times the actual number of real Confluence servers.<!--]--></p><p><!--[--><img src="https://angelolloti.com/blog/too-many-honeypots/confluence-servers-shodan.png" alt="Filtering for Confluence"/><!--]--></p><p><!--[-->A vulnerability that only impacts 4,000 hosts is much less concerning than a vulnerability that impacts 240,000. Understanding the scale of an issue is important, and therefore, being precise about the number of potentially impacted hosts is important too. Those who copy overinflated statistics or haven’t done their due diligence are making vulnerabilities appear <strong><!--[-->more<!--]--></strong> impactful than they truly are.<!--]--></p><p><!--[-->While we focused on Confluence, this particular problem has been repeated across many different targets. Honeypots are a net good for the security community. But their expanding popularity does make understanding real-world attack surfaces much more difficult for defenders, not just attackers.<!--]--></p><p><!--[-->VulnCheck continuously monitors the internet for high-impact vulnerabilities and tracks the potential internet-facing attack surface. We pride ourselves on providing accurate and actionable information. All signal, no noise. To demo our data, create an account and request a trial today.<!--]--></p></div><!--]--></div></div>
  </body>
</html>
