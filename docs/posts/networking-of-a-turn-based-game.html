<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://longwelwind.net/blog/networking-turn-based-game/">Original</a>
    <h1>Networking of a turn-based game</h1>
    
    <div id="readability-page-1" class="page"><div><article><header><small>February 02, 2022</small><small>11 min read</small></header><p>3 years ago, I started developing <a href="https://swordsandravens.net/"><strong>Swords &amp; Ravens</strong></a>, an open-source online multi-player adaptation of a strategy board game I love, <a href="https://boardgamegeek.com/boardgame/103343/game-thrones-board-game-second-edition">A Game of Thrones: The Board Game (Second Edition)</a>, designed by Christian T. Petersen and published by <a href="https://www.fantasyflightgames.com/en/">Fantasy Flight Games</a>. As of Febuary 2022, around 500 players gather daily on the platform and more than 2000 games have been played since its release. While I stopped actively developping S&amp;R, the platform is still seeing new features being added thanks to the work of the open-source community.</p><figure>
    <span>
      <a href="https://bellmar.medium.com/static/e1476e5da3d6e5d2d4ced7506a19191e/a8a6f/screenshot.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="An intense game of A Game of Thrones: The Board Game on Swords &amp; Ravens" title="An intense game of A Game of Thrones: The Board Game on Swords &amp; Ravens" src="https://bellmar.medium.com/static/e1476e5da3d6e5d2d4ced7506a19191e/fcda8/screenshot.png" srcset="/static/e1476e5da3d6e5d2d4ced7506a19191e/12f09/screenshot.png 148w,/static/e1476e5da3d6e5d2d4ced7506a19191e/e4a3f/screenshot.png 295w,/static/e1476e5da3d6e5d2d4ced7506a19191e/fcda8/screenshot.png 590w,/static/e1476e5da3d6e5d2d4ced7506a19191e/efc66/screenshot.png 885w,/static/e1476e5da3d6e5d2d4ced7506a19191e/c83ae/screenshot.png 1180w,/static/e1476e5da3d6e5d2d4ced7506a19191e/a8a6f/screenshot.png 1516w" sizes="(max-width: 590px) 100vw, 590px" loading="lazy" decoding="async"/>
  </a>
    </span>
    <figcaption>An intense game of A Game of Thrones: The Board Game on Swords &amp; Ravens</figcaption>
  </figure><p>I’ve learned a lot while developing S&amp;R, and I wanted to share some of the knowledge I’ve gained to people that might be interested in doing a similar project. There is a lot to say about how it works but this blog post will focus on how I’ve designed the networking part of the game. I’ll first describe the problem in a more formal way. I’ll continue by explaining how it’s solved in S&amp;R, as well as describe other possible solutions that I’ve discovered or imagined. I’ll detail the advantages &amp; disadvantages of each method and conclude with which method I think is the best (Spoiler alert: it’s the last one 👀).</p><h2>Problem statement</h2><p>In a single-player game, everything lives inside a single computer. The player’s actions are applied to the game state, and modifications to this game state are reflected on the screen of the player. In an online multiplayer environment, things are different. Each player is playing on its own computer, which all have their own current information about the game, and which all have their own UI to display the current state of the game.</p><p>The general architecture of an online game can be summarized with the following schema:</p><svg host="65bd71144e" version="1.1" width="531px" height="301px" viewBox="-0.5 -0.5 531 301" content="&lt;mxfile&gt;&lt;diagram id=&#34;6hGFLwfOUW9BJ-s0fimq&#34; name=&#34;Page-1&#34;&gt;7Ztbb9owFIB/DY+rciHQPgIr3aRNq4SmrY9eYhJvTg5yTIH9+tmJnZthpCvQtEsfkH18iRN/5+KTdODO4u0dQ6voMwSYDhwr2A7c9wPHuXE98SsFu1xwPRzngpCRIBfZpWBBfmMltJR0TQKc1jpyAMrJqi70IUmwz2syxBhs6t2WQOtXXaEQG4KFj6gp/UYCHunVWVbZ8AGTMOLNlhjp3kqQRiiATUXk3g7cGQPgeSnezjCVD08/mHzc/EBrsTKGE95mgJMPeER0rW7u60e1Mr7T98tgnQRYjrAG7nQTEY4XK+TL1o3YYCGLeExFzRbF4o5k35CiNFVlH2Liq3LKGfwqHp4ctoSEz1FMqGTiywonYgkLlKSqaQFrll0w4lzssuO5E/Ejbkv+yA7pVQgQUoxWJL0Sl8oa/DTrOl/mE4uimtpzpnpyQukMKDAxdwIJLhanhQPHnWd/aiWH5ApTeyTq5i6ojXnEjONtRaR25Q5DjDkTS7R0q6sIUTpie6q+qRGXy6IKbEMlQwrysJi6xEAUFAn7qbg2qDCYwIFQCVUFxiMIIUH0tpRO69SUfT4BrNSm/8Sc79SDQ2sOdZLwlvDvlfKDnOrKU7X3WzVzVtnpSiJu9Xu1Uhklq+WwrLYrgESMT6RtEAJfUitZzcVzQvWSApRG2S29JLJP55OiH5hOkf8rzDalwXtrelN9RxIzZXcRC7Hqpay6JOOvhDNMESePdWP6HFyHBq4zSuTiHWvSG7MOGjPHvaAx8ww6FpiJtfdkdIAM13tBMm464eZaup7X421aY1J1Hs6pnYcaeg8kcwSaxutGWGU3OMp9nBrVQKlYRiu6RgZd9xTtpN3Z45WEOVnJ4jqmE5/LRzqVSkTEoeOTdN73kBJOIBFdfgDnYvuOeXU9fEJJKIdxaFgwWHNKErGz+pBkvU3KnuCmxnU4hqYtcs5kijSGFVruUIzl0+eI495XdQGPRhTjWhf0VbbdA9J1QJrBzGUBMVM5ZjSTBGagsefEXZ6yHyotx07c5SH7odr2vBP3G3RIR47R2hUcDYUqVHl7oNKyZ0ZMBcSFU2wXMZkTNbXDa0yUP4RThF62+9p04RBsHdeSk+qCt0cX7E7pQqGb+rR684+60JzIdc6nC2Z2rJ0uHECvqiIHcLeP4P7/2fS2p9vepB/E2DxO92+qOhH1eqMXfFNljw0sitz/tMejg3hcNMNrd+NNZsejuAuleLUJP3eOd9QIrs6Y47XNVwhFktc0P32StwP2aGQEP4Y5OleSV8/b5/Bej7u6aA7PMZO8prvqVN7if/Vr1fOejkFrB75uJfHGwxOd+MY3Fzvxafb7xMVLgtw6aOtBPghym2z0BT6n1NDbNRN/qk8jC79T8TrHvtZ8k59T5q3AAsx0S4CXaE35KfWy7ceWCvd31pUzdsY15N/Zp9FJrxFRO01Vap1ObH4mOGqnk+VEuiMslyl+ot6Kavndfd69/O8F9/YP&lt;/diagram&gt;&lt;/mxfile&gt;"><defs></defs><g><rect x="0" y="110" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="135" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    UI
                </text></switch></g><path d="M 106.37 210 L 213.63 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 101.12 210 L 108.12 206.5 L 106.37 210 L 108.12 213.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 218.88 210 L 211.88 213.5 L 213.63 210 L 211.88 206.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="0" y="190" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="215" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Client A
                </text></switch></g><rect x="220" y="190" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="270" y="215" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Server
                </text></switch></g><path d="M 50 76.37 L 50 103.63" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 50 71.12 L 53.5 78.12 L 50 76.37 L 46.5 78.12 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 50 108.88 L 46.5 101.88 L 50 103.63 L 53.5 101.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><ellipse cx="50" cy="5" rx="5" ry="5" fill="rgb(255, 255, 255)" stroke="#ffffff" pointer-events="all"></ellipse><path d="M 50 10 L 50 26.67 M 50 13.33 L 40 13.33 M 50 13.33 L 60 13.33 M 50 26.67 L 40 40 M 50 26.67 L 60 40" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="63" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Pl...
                </text></switch></g><rect x="0" y="260" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="285" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Game State
                </text></switch></g><rect x="220" y="260" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="270" y="285" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Game State
                </text></switch></g><path d="M 50 236.37 L 50 253.63" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 50 231.12 L 53.5 238.12 L 50 236.37 L 46.5 238.12 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 50 258.88 L 46.5 251.88 L 50 253.63 L 53.5 251.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 270 236.37 L 270 253.63" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 270 231.12 L 273.5 238.12 L 270 236.37 L 266.5 238.12 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 270 258.88 L 266.5 251.88 L 270 253.63 L 273.5 251.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 50 183.63 L 50 156.37" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 50 188.88 L 46.5 181.88 L 50 183.63 L 53.5 181.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 50 151.12 L 53.5 158.12 L 50 156.37 L 46.5 158.12 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="430" y="110" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="480" y="135" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    UI
                </text></switch></g><rect x="430" y="190" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="480" y="215" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Client B
                </text></switch></g><path d="M 480 76.37 L 480 103.63" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 480 71.12 L 483.5 78.12 L 480 76.37 L 476.5 78.12 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 480 108.88 L 476.5 101.88 L 480 103.63 L 483.5 101.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><ellipse cx="480" cy="5" rx="5" ry="5" fill="rgb(255, 255, 255)" stroke="#ffffff" pointer-events="all"></ellipse><path d="M 480 10 L 480 26.67 M 480 13.33 L 470 13.33 M 480 13.33 L 490 13.33 M 480 26.67 L 470 40 M 480 26.67 L 490 40" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="480" y="63" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Pl...
                </text></switch></g><rect x="430" y="260" width="100" height="40" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="480" y="285" fill="#FFFFFF" font-family="Open Sans" font-size="16px" text-anchor="middle">
                    Game State
                </text></switch></g><path d="M 480 236.37 L 480 253.63" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 480 231.12 L 483.5 238.12 L 480 236.37 L 476.5 238.12 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 480 258.88 L 476.5 251.88 L 480 253.63 L 483.5 251.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 480 183.63 L 480 156.37" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 480 188.88 L 476.5 181.88 L 480 183.63 L 483.5 181.88 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 480 151.12 L 483.5 158.12 L 480 156.37 L 476.5 158.12 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 423.63 210 L 326.37 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 428.88 210 L 421.88 213.5 L 423.63 210 L 421.88 206.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 321.12 210 L 328.12 206.5 L 326.37 210 L 328.12 213.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"></g><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Viewer does not support full SVG 1.1
            </text></a></switch></svg><p>The <code>UI</code> displays to the player the current state of the game, based on the local copy of the state of the game. The <code>Clients</code> are responsible for the communication with the server, both to send the actions of the player and to receive new information about the game state.</p><p>The problem we’re interested in solving is how to synchronize the different local states of the game of the clients with the game state of the server. More specifically: when the server applies the action of a player to its game state, how must it communicate the modifications to the game state to the clients.</p><h2>Update propagation method</h2><p>The most obvious solution is to apply any action received by the server to the game and transmit the different updates to the state of the game to the clients. The following diagram shows it in action.</p><svg host="65bd71144e" version="1.1" width="701px" height="364px" viewBox="-0.5 -0.5 701 364" content="&lt;mxfile&gt;&lt;diagram id=&#34;6hGFLwfOUW9BJ-s0fimq&#34; name=&#34;Page-1&#34;&gt;7Zpdb9owFIZ/DdodSuKEj0tKSydt06Zxse3Sik1i1YmRYwrs189OHIhj6ICmNFTpBYqP42PH78PJOS49ME02jxwu428MYdrzHLTpgfue541BID+VYVsYRv6wMEScoMLk7g1z8hdro6OtK4JwZtwoGKOCLE1jyNIUh8KwQc7Z2rxtwag56xJG2DLMQ0ht6y+CRKyfwhvu7Z8xieJyZncwLnoSWN6snySLIWLrigk89MCUMyaKq2QzxVTtXbkvxbjZkd7dwjhOxSkDvGLAM6Qr/WxTStRYz5noFYpt+dicrVKE1UinB+7WMRF4voSh6l1LnaUtFgmVLVdeLlgqZjAhVGn8fYlT6WsO00x3zdmK5yNjIaRqXgDkfIFcp/pQN2T9iLGIYrgkWT9kSd4RZvmts0XhWF5q14F3VzonlE4ZZVz6TlmK9XylqeeBWf4n7Zng7Akf6slXWGDnBrJtb6ve6WfMBd5UTHqbHzFLsOByiY7u9bXiGnl3rNvrPUCuo21xBZ5A26BmNtp53ssqL7Syh1UGx1W+61RuUuXBe8rsWzLPMZdr7yRuUmLwnhIPLIktcXGKJuodt9+2Noj5auWkYHz7WyHb3zX/6KfKG/cbzXPR2urWUcUF5BEWxmsQI+O9byNQkTh4QWGOKRTk2cwWDsmuZ/jBSB6My/zIBCwIPNNDlqukB1Vf7jU/rms68oY1AostsBzlEO6e+iQuh6/k8lJ1b5fnk7j0W8UlqIPpO5eBCcagH5hojt4MzVEXMt8iZIJWoTloCs3h9WKm655FZkhhlpHw48BZFvYj2UIwi/OE1H2Jv5bAVmMNeBeHwf84apA1uwScCAHDJ2n7QtLok1Tc+QpTJK/zfZTb6DkzxkQCFVMLrthwfsmVYL7IfddIldmzMNk0WShTeDurh5REqQIcK+fSoHJxEkI60R0JQUhNc7BSMWuZOmVt+34cRfv0+sMFtQg1suuP3flSlf56SLyk/nCDZmJWmzU6HsNuOGZZsaaecJ0atOpvWstRg0HrvGq3g+3DwXZF1s6rYDvW2sqaf2nmXw9slqMGYTuvJu1g+3CwXZG1scXaT5wwuQVdft/K/N4Pai89387v3dEb5fdl3VCtExEyUCHpwZqxw6UduPjONXGxj7DmMnSpQDfLZ+pwaTsug2viYp9CdXnPLeY9gdNM3mP5aS7v8eyTqi7vaXNkct8177GPmrq856ZwuW7eY58WdXnPbeFyzbwHNPSf3jZr1OU95xwuNpf4yOb+5+LF7fvf3IOHfw==&lt;/diagram&gt;&lt;/mxfile&gt;"><defs></defs><g><rect x="0" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client A
                </text></switch></g><rect x="600" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="650" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client B
                </text></switch></g><rect x="300" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="350" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Server
                </text></switch></g><path d="M 50 362 L 50 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 350 350 L 350 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 650 350 L 650 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 50 130 L 342.13 130" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 348.88 130 L 339.88 134.5 L 342.13 130 L 339.88 125.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="90" y="90" width="220" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:218px;height:1px;padding-top:110px;margin-left:91px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Attack King&#39;s Landing with Footman from Winterfell
                            </p></div></div></foreignObject><text x="200" y="115" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Attack King&#39;s Landing with Fo...
                </text></switch></g><path d="M 350 190 L 642.13 190" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 648.88 190 L 639.88 194.5 L 642.13 190 L 639.88 185.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 350 190 L 57.87 190" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 51.12 190 L 60.12 185.5 L 57.87 190 L 60.12 194.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 350 250 L 642.13 250" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 648.88 250 L 639.88 254.5 L 642.13 250 L 639.88 245.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 350 250 L 57.87 250" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 51.12 250 L 60.12 245.5 L 57.87 250 L 60.12 254.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="410" y="150" width="180" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:178px;height:1px;padding-top:170px;margin-left:411px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Remove Footman from Winterfell
                            </p></div></div></foreignObject><text x="500" y="175" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Remove Footman from Wint...
                </text></switch></g><rect x="410" y="210" width="180" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:178px;height:1px;padding-top:230px;margin-left:411px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Add Footman in King&#39;s Landing
                            </p></div></div></foreignObject><text x="500" y="235" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Add Footman in King&#39;s La...
                </text></switch></g><rect x="410" y="270" width="180" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:178px;height:1px;padding-top:290px;margin-left:411px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Start Fight in King&#39;s Landing
                            </p></div></div></foreignObject><text x="500" y="295" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Start Fight in King&#39;s La...
                </text></switch></g><path d="M 350 310 L 57.87 310" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 51.12 310 L 60.12 305.5 L 57.87 310 L 60.12 314.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="110" y="150" width="180" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:178px;height:1px;padding-top:170px;margin-left:111px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Remove Footman from Winterfell
                            </p></div></div></foreignObject><text x="200" y="175" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Remove Footman from Wint...
                </text></switch></g><rect x="110" y="210" width="180" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:178px;height:1px;padding-top:230px;margin-left:111px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Add Footman in King&#39;s Landing
                            </p></div></div></foreignObject><text x="200" y="235" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Add Footman in King&#39;s La...
                </text></switch></g><rect x="110" y="270" width="180" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:178px;height:1px;padding-top:290px;margin-left:111px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Start Fight in King&#39;s Landing
                            </p></div></div></foreignObject><text x="200" y="295" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Start Fight in King&#39;s La...
                </text></switch></g><path d="M 350 310 L 642.13 310" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 648.88 310 L 639.88 314.5 L 642.13 310 L 639.88 305.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"></g><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Viewer does not support full SVG 1.1
            </text></a></switch></svg><p>This is the method used by Swords &amp; Ravens. It’s simple, intuitive and it’s easy to know which kind of data you’re sending or not to the different clients. This also makes it trivial to have secret data (i.e. data that should only be known to a subset of the players). If a player draws a card and place it in his (secret) hand, then you can transmit which card was drawn only to this player so that no other player knows which card it is.</p><p>The first downside to this method is that you must code all the possible updates to the state of your game. While there are certainly ways to automate this in JS using, for example, decorators to control the access to the variables of your game state, it may make your code less readable.</p><p>The second downside is that since you’re possibly sending multiple updates for a single action, the local game state of a client might temporarily be in an invalid state before all the updates have been received. In the diagram shown above, between the update <code>Remove footman in Winterfell</code> and <code>Add footman in Kings&#39; Landing</code>, there is a missing Footman which would modify the count of Footman shown in the UI. Though this particular issue could be solved by sending a combined update (for example <code>Move Footman Footman from Winterfell to King&#39;s Landing</code>), not all updates can easily be concatenated.</p><p>A better way to address this would be to combine all the updates done because of the action and send them at once. This is essentially what the next method is about.</p><h2>Delta-update propagation method</h2><p>The delta-update propagation method works by computing the delta between the new state of the game and the state of the game before the action was applied. This delta is then sent to the clients so that they can apply it to their own local state of the game. This is how the game engine <a href="https://boardgame.io/">boardgame.io</a> works.</p><svg host="65bd71144e" version="1.1" width="701px" height="262px" viewBox="-0.5 -0.5 701 262" content="&lt;mxfile&gt;&lt;diagram id=&#34;cd_pagwYxz8ZJAQ-eVP4&#34; name=&#34;Page-1&#34;&gt;7ZlNc9owEIZ/DdMbY1s2H0dCQjrTdtoph7RHxRK2JrLEyCJAf30lWwbLMikhTkJbOIC0stbyvg+7EvTANNvcCrhMv3CEaS/w0KYHrntBMAaReteGbWkYhcPSkAiCSpO/N8zJL2yMnrGuCMK5daHknEqytI0xZwzH0rJBIfjavmzBqX3XJUywY5jHkLrWO4JkWq3O8/YDHzFJUtkcyWB1tTHkKUR8XTOBmx6YCs5l2co2U0x18KrAlPNmB0Z3KxOYyWMmBOWER0hX5uGmlOi5gTcxK5Tb6rkFXzGE9UyvB67WKZF4voSxHl0roZUtlRlVPV81F5zJGcwI1SJ/XWKmfM0hy83QnK9EMTOVUskWREDdL1Lr1G/6gryfcJ5QDJck78c8KwbivLh0tigdq6ZxHQVXlXNC6ZRTLpRvxhk296tMvQDMipey51LwB9w2Uqyw5M6PVN8Nq4n0IxYSb2omE+ZbzDMshVqiZ0ZDo7hh3h+b/toiqLSlNXgiY4MG2mTneS+rahhl21UGh1W+uqjcpcqD95Q5dGSeY6HWfpG4S4nBe0ocORI74mKGJrrI7cN2DmK+WDklmNj+0Mj2d92f5qmKzvXG8Fz2tqZ3UHEJRYKlVQYxsgq/i0BN4ugJhQWmUJJHe7vQJru5wzdOimRcbZBswMImOHmhkplUL+4NP75vOwqGDUdlCBxHBYS7pz6Ky8ELuTxV3b+X56O4DM+KS9AVmGAM+pGN5ujV0BxeUuZrpExwVmgOukJz+HY5c/QsMGMK85zE/w6b1cF+pHoI5mmxH/Wfwu9MWGugBoKTs+AfHHWH2thBbSIljB+U7RNhyQcluPcZMqTaRRhVFANvxrnMoEZqITQa3p1aCBaLwnUDVLV3ljaaNgrVBt7d00NKEqb5xtq5MuidOIkhnZiBjCCkb9N6TrFPMk3Izu3rcZDs408fPmjkp5F7+tj9ulSHP+zg9FHlxpemrHPW6HAK+4tTlrNz807MWU6dbTrqLmf5/gW2/xu2N2TN/ensO864CkG9DBLWWi+V9wHV1e9eqFYiC4kGMNP1id3n+mOCkOupXk6nzRmuz7l6XB2cWSHYpQC/UwEOGwcE4LUU4EHLt8v3Bv0o6qAIu+eGC6sXVls3i6ezGvbD8Nmsqu7+r8syDe//AAY3vwE=&lt;/diagram&gt;&lt;/mxfile&gt;"><defs></defs><g><rect x="0" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client A
                </text></switch></g><rect x="600" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="650" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client B
                </text></switch></g><rect x="300" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="350" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Server
                </text></switch></g><path d="M 50 260 L 50 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 350 260 L 350 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 650 260 L 650 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 50 130 L 342.13 130" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 348.88 130 L 339.88 134.5 L 342.13 130 L 339.88 125.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="90" y="90" width="220" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:218px;height:1px;padding-top:110px;margin-left:91px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Attack King&#39;s Landing with Footman from Winterfell
                            </p></div></div></foreignObject><text x="200" y="115" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Attack King&#39;s Landing with Fo...
                </text></switch></g><path d="M 350 210 L 642.13 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 648.88 210 L 639.88 214.5 L 642.13 210 L 639.88 205.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 350 210 L 57.87 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 51.12 210 L 60.12 205.5 L 57.87 210 L 60.12 214.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="370" y="110" width="260" height="106.55" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="500" y="168" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Remove Footman in King&#39;s Landing,...
                </text></switch></g><rect x="70" y="110" width="260" height="104.44" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="200" y="167" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Remove Footman in King&#39;s Landing,...
                </text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"></g><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Viewer does not support full SVG 1.1
            </text></a></switch></svg><p>This solves the 2 downsides described in the previous method. We no longer need to code all the possible updates, since once you change something, it will be computed in the delta after the action has been processed. You no longer get transient invalid states, since the updates will be applied at once, atomically.</p><p>One thing we’ve lost, though, is the easiness of managing secret state. If you want to prevent some secret information to be sent to a specific client, the server must filter the delta out of any potential private information before sending it to the clients.</p><h2>Deterministic action propagation method</h2><p>This method is inspired by the deterministic lockstep<sup id="fnref-2"><a href="#fn-2">2</a></sup> method used in online real-time games.</p><p>It relies on the assumption that processing the actions of a player is deterministic, meaning that for a given state of the game, applying an action will always give us the same resulting state of the game. We can exploit this property to avoid having to propagate the updates to the state of the game to the clients. Instead, the server can apply the action it has received from the client, and then propagate this action to the clients who can then apply the action to derive their own new game state. Since applying the action is deterministic, the clients will arrive at the same state of the game as the server.<sup id="fnref-1"><a href="#fn-1">1</a></sup></p><svg host="65bd71144e" version="1.1" width="701px" height="262px" viewBox="-0.5 -0.5 701 262" content="&lt;mxfile&gt;&lt;diagram id=&#34;cd_pagwYxz8ZJAQ-eVP4&#34; name=&#34;Page-1&#34;&gt;7Zldb9owFIZ/TbQ7lMSEj0tKSydt0yZx0e3Sik1i1YmRYwrs1+84cQDH0LKStrDRCxS/jk8cv0+Pj8FD42x1L/E8/SYI5V7ok5WHbr0wHKIIPrWwroRBt18JiWSkkoKtMGW/qRF9oy4YoYV1oxKCKza3xVjkOY2VpWEpxdK+bSa4/dQ5TqgjTGPMXfWBEZXWs/P9bcdnypJUNXsyXN9thCLFRCx3JHTnobEUQlVX2WpMuV68emGqcZMDvZuZSZqrYwaE1YAnzBfm5cac6bGhPzIzVOv6vaVY5ITqkb6HbpYpU3Q6x7HuXYLRoKUq49AK4HImcjXBGePa5O9zmkOsKc4L0zUVC1mOTJUC28IIwfMimKf+0DcUnUSIhFM8Z0UnFlnZERflrZNZFRguTegovKmDM87HggsJsXORU/O8WvJCNCn/QC+UFI90X085w4q7IIK2u6xmpZ+oVHS1I5llvqcio0rCFH3T2zWOG+aDoWkvLYIqLd2BJzIaNtAmm8hbW+HCOLvfZXTY5Zury2263PtIm7uOzVMqYe5Xi9u0GH2kxZFjsWMuzclIb3LbZTsHM092DgyT658a2c6m+cu8Vdm4XRmeq9batA46rrBMqLK2QUqsjd9FYMfi6BmHJeVYsSe7XNhnu3nCD8HKZFwXSDZg3SY4RemSGbS7uTfiBIEdKOw3AlVL4AQqIdy89VFc9k7k8rXuXi7PR3HZPSsuUVtgoiHqRDaagzdDs39NmW+RMtFZodlrC83+++XMwV+BGXNcFCz+d9isD/YDaBFcpGU9GjyH35mw1kANha/Ogi8Eag+1oYPaSCkcP4L2heXJJzDc/4pzAtflMsIqhv5ECJVhjdRMajT8B5gIlbMydANUqJ2VjaaNQl3AuzU95izJNd9UBwdBV+IsxnxkOjJGiH7M3nOKfZJpQnZu/x4HyT7+9BGgRn4auKePzbdLu/B3Wzh91Lnx1JR1zh4dTmEXnLKcys1/Zc5y9tlmoPZyVhBcYfu/YXtH1tyvzq4b5GVukJvKv66qenu+nhvu2yDDTp1hTtoj3bL+itJlohS8L0rQ3P7wVyWx7c+n6O4P&lt;/diagram&gt;&lt;/mxfile&gt;"><defs></defs><g><rect x="0" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client A
                </text></switch></g><rect x="600" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="650" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client B
                </text></switch></g><rect x="300" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="350" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Server
                </text></switch></g><path d="M 50 260 L 50 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 350 260 L 350 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 650 260 L 650 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 50 130 L 342.13 130" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 348.88 130 L 339.88 134.5 L 342.13 130 L 339.88 125.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="90" y="90" width="220" height="40" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:218px;height:1px;padding-top:110px;margin-left:91px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Attack King&#39;s Landing with Footman from Winterfell
                            </p></div></div></foreignObject><text x="200" y="115" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Attack King&#39;s Landing with Fo...
                </text></switch></g><path d="M 350 210 L 642.13 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 648.88 210 L 639.88 214.5 L 642.13 210 L 639.88 205.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 350 210 L 57.87 210" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 51.12 210 L 60.12 205.5 L 57.87 210 L 60.12 214.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="410" y="170" width="190" height="42.22" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:188px;height:1px;padding-top:191px;margin-left:411px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Attack King&#39;s Landing with Footman from Winterfell
                            </p></div></div></foreignObject><text x="505" y="196" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Attack King&#39;s Landing wit...
                </text></switch></g><rect x="110" y="170" width="190" height="42.22" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:188px;height:1px;padding-top:191px;margin-left:111px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Attack King&#39;s Landing with Footman from Winterfell
                            </p></div></div></foreignObject><text x="205" y="196" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Attack King&#39;s Landing wit...
                </text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"></g><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Viewer does not support full SVG 1.1
            </text></a></switch></svg><p>This solution has numerous advantages compared to the previous ones.</p><p>First, we don’t need to code additional network logic in our code. The only thing that needs to be implemented is the propagation of the action done by the players.</p><p>Secondly, bandwidth consumption isn’t tied to the size of the modifications done to the game state. If a single player action changes 1000 entities in our game state, the server will still only need to transmit the action and not the changes. This is actually <a href="https://www.gamedeveloper.com/programming/1500-archers-on-a-28-8-network-programming-in-age-of-empires-and-beyond">the reason why deterministic lockstep is used for real-time strategy games, such as Age of Empires</a>. While it is quite uncommon for turn-based games (even less so for board games) to have lots of moving entities when performing an action, having this opens up new possibilities for turn-based games.</p><p>Thirdly, since the actual gameplay code is run on the client, we can perform animations of the different updates done to the game state. For example, if a player action would reduce their amount of money by 10 and then raise it by 40, we could play 2 different animations client-side while with the previous solution, we would only receive from the server the fact that the amount of money was raised by 30, preventing the client from doing so.</p><p>Fourthly, when the player decides to perform an action, the client can directly apply the action to its own game state after sending it to the server without waiting for confirmation from the server. This process, called “optimistic update”, allows us to provide a lag-free experience to the players.</p><p>Overall, this solution is quite elegant. We just need to implement the propagation of the actions of the player and once it’s done, <em>ta-da</em>, we can focus on implementing the gameplay and don’t need to touch the networking code at all!</p><p>There is one big downside, though. To make sure that the clients and the server arrives at the same game state after processing an action, we must ensure that they both possess exactly the same game state initially. At first, this might make you think that it would be impossible to have secret state. Indeed, how could we have state that is only kept server-side if our networking solution relies on the game state being the same between all actors?</p><h3>Handling secret state</h3><p>We can solve this issue quite elegantly by allowing the clients to slightly differ from the server. If an action requires state that was previously hidden to one or multiple clients, we can make the server reconciliates the difference by sending this specific part of the game state to the clients. </p><p>Let’s illustrate this with an example from Swords &amp; Ravens. When a player moves their army into the territory of another player, they trigger a combat. Resolving a combat in S&amp;R involves both players simultaneously choosing, from their hand, a general of their house to lead their armies. This mechanic leads to intense mind-games where both players try to guess which general their opponent will take so they can pick the appropriate counter, while wondering if their opponent will not plan for this and take the counter of the counter, requiring you to pick the counter of the counter of the counter, and so on.</p><p>Obviously, it is important to keep secret the choice of one of the opposing players if the other player has not made their choice yet.</p><p>The following diagram explains how we could solve this.</p><svg host="65bd71144e" version="1.1" width="701px" height="421px" viewBox="-0.5 -0.5 701 421" content="&lt;mxfile&gt;&lt;diagram id=&#34;cd_pagwYxz8ZJAQ-eVP4&#34; name=&#34;Page-1&#34;&gt;7Ztfk6I4EMA/jXW7D2cBAZHH0d3Ze7itmzq3au8esxAhtZFYITPqffpLIChJ0HUV/8wOVqmkkzSQ/tmdDnEApov1JwaX2WeaIDLwnGQ9AB8GnheBQHxKwaYSjP2wEqQMJ5XI3Qlm+D+khI6SPuMEFVpDTinheKkLY5rnKOaaDDJGV3qzOSX6WZcwRZZgFkNiS7/ihGf11TnOruIPhNOMmzULWLdWgiKDCV01RODjAEwZpbw6WqyniMjBqwem6ve4p3Z7ZQzl/JgOXtXhBZJndXNTgmVfz3lQV8g39X0z+pwnSPZ0BmCyyjBHsyWMZe1KGFrIMr4gouSKwznN+SNcYCKN/NcS5ULXDOaFqprRZ1b2zDgXZvMCIM4XiOuUH7JBMUwpTQmCS1wMY7ooK+KibPo4rxSLQ6U68Ca1ckzIlBLKhO6c5kidrxYNPPBYvoS84Ix+R2015RVW3LmBKNvDqkb6BTGO1g2RGuZPiC4QZ+ISHVXrK4sr5t1IlVcaQZUsa8ATKBlU0KZbzTuzigNl2XYrg/1WnvRW7tLKo1ua2bfMPENMXHtv4i5NDG5p4sAysWVclCcPMsjthu0ejHm25YTB2OYfiexwW/xX3VVZ+LBWPFelTV1aY151c0JXlWW/34UAACXY9ZWFZtcnxLCwEmJKthcgDlmKuBZVUWLMI4p6eGWbcTtlDYqCAxAxRCDHL7r+NrLUGZ4oLv19PQfTGfYjg83qSlWn5vzB0OO6uiIvNBRVw2IpKjnf3vVR6I/ORP9UgF7xT2aLftAA3znI/FF8+3fPN+gKcBCBYaAjPr4Y4mHv3U/27pEYPd27j8LLeHdw9/SPuqI/vJ57H/8U+zGBRYHjXwf/epljLEoJLLJydu4eQtLg705mEsA52dH+QFF3qEUWatOM0gIJ2ZfNCkts/oR5jgvekjuJLIHr2OlmrlMVO3uBBKe5ZFdYUnqcicw5cAzJg6pY4CSRp2nNyPSczQTo3tDfS+3xeZYLDN8ztvOs7TpaE2yvgzyr9nvnuqN7ttF+9/SK3ZHlRvwT/ZEZQy1F3fkj1+1he9uwXZE1e5Hw3cN7IdiGQCjeMWTJwBvBhYw8+bdiuTVGHwmvHwn9wMDDsyPhdhVSi4TesHYlZwVDe25uMNNPm+4GFtdYngbueDgG9sypbYXaA0MQnc+L10+eDsUza+HAsvfdrBuMOkrmLEXdBTTPnjxt3dJneRZYDuCXDSv79W7pZLdk+aCjyN0Tw3z/ujGs1tH7pFfmk0xXEnSV0FmKOvRJ9oaLHrY3BdsVWWtJ6Cba5LwlCo6IjHrfxDR9lMqjd3+jmOYxJliMHhXRS8AjN4A5cbZngv++D6V3E0rDI0OpOQk7KY7aj+EN3BrrB8dQNmlQZpHaU3YzytybUmY/Ca92LBZScZ5IJtTWNieDL5IdnsnPAi7kV1p9FRxy8T2VN85ojFDZEc4R2Vhgvd09cVqEloUnyMUvJC8lnuN35LWMiNjyNCdsW5MAXeBkL2DtNsD+VljAOAmezxGTFXMmreNUGylbmvYU3ZIicFWK7OfGh2b1/fYcffPloKO9lz/OHoytOOEtM4pxNAycxss38oJo6Bg6j00xhOaxHqHdiyUZ9c+n33x5hc2XrwtwIAnXoTY3uh+9amypuiTSP/fQvffm+mbLSHfn7ptw5iMBqG/A7ofDKDqN91EkDHAp4EVx9zfCqvnuz5jg4/8=&lt;/diagram&gt;&lt;/mxfile&gt;"><defs></defs><g><rect x="0" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="50" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client A
                </text></switch></g><rect x="600" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="650" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client B
                </text></switch></g><rect x="300" y="0" width="100" height="50" fill="none" stroke="#ffffff" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="350" y="30" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Server
                </text></switch></g><path d="M 49.7 189.01 L 50 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 350 190 L 350 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 648.9 187.99 L 650 50" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 50 110 L 342.13 110" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 348.88 110 L 339.88 114.5 L 342.13 110 L 339.88 105.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="90" y="90" width="220" height="20" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="200" y="105" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Choose Tywin Lannister
                </text></switch></g><path d="M 350 150 L 642.13 150" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 648.88 150 L 639.88 154.5 L 642.13 150 L 639.88 145.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 350 150 L 57.87 150" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 51.12 150 L 60.12 145.5 L 57.87 150 L 60.12 154.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="410" y="130" width="190" height="22.22" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="505" y="146" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    (A) Choose a card
                </text></switch></g><rect x="100" y="128.83" width="200" height="23.39" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:198px;height:1px;padding-top:141px;margin-left:101px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                (A) Choose Tywin Lannister
                            </p></div></div></foreignObject><text x="200" y="145" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    (A) Choose Tywin Lannister
                </text></switch></g><path d="M 650 270 L 357.87 270" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 351.12 270 L 360.12 265.5 L 357.87 270 L 360.12 274.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="410" y="250" width="190" height="22.22" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="505" y="266" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Choose Margeary Tyrell
                </text></switch></g><path d="M 350 350 L 642.13 350" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 648.88 350 L 639.88 354.5 L 642.13 350 L 639.88 345.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><path d="M 350 350 L 57.87 350" fill="none" stroke="#ffffff" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="stroke"></path><path d="M 51.12 350 L 60.12 345.5 L 57.87 350 L 60.12 354.5 Z" fill="#ffffff" stroke="#ffffff" stroke-miterlimit="10" pointer-events="all"></path><rect x="410" y="280" width="190" height="60" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="505" y="315" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    (B) Choose Margeary Tyrel...
                </text></switch></g><rect x="110" y="280" width="190" height="60" fill="none" stroke="none" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"></foreignObject><text x="205" y="315" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    (B) Choose a card...
                </text></switch></g><rect x="0" y="390" width="700" height="30" fill="none" stroke="#ffffff" stroke-dasharray="1 4" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:698px;height:1px;padding-top:405px;margin-left:1px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Clients and server have the same game state, proceed safely
                            </p></div></div></foreignObject><text x="350" y="410" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Clients and server have the same game state, proceed safely
                </text></switch></g><rect x="0" y="190" width="700" height="30" fill="none" stroke="#ffffff" stroke-dasharray="1 4" pointer-events="all"></rect><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow:visible;text-align:left"><div style="display:flex;align-items:unsafe center;justify-content:unsafe center;width:698px;height:1px;padding-top:205px;margin-left:1px"><div data-drawio-colors="color: #FFFFFF; " style="box-sizing:border-box;font-size:0px;text-align:center"><p>
                                Client B&#39;s game state differs from Server&#39;s game state
                            </p></div></div></foreignObject><text x="350" y="210" fill="#FFFFFF" font-family="Open Sans" font-size="15px" text-anchor="middle">
                    Client B&#39;s game state differs from Server&#39;s game state
                </text></switch></g><path d="M 49 389.01 L 49.8 220" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 350 390 L 349.5 220" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path><path d="M 650.3 387 L 650.55 220" fill="none" stroke="#ffffff" stroke-miterlimit="10" pointer-events="stroke"></path></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"></g><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">
                Viewer does not support full SVG 1.1
            </text></a></switch></svg><p>When <code>Client A</code> sends their action to the server (Choosing Tywin Lannister), we propagate this action to both players, but not before filtering the chosen leader out of the message sent to <code>Client B</code>. At this point, <code>Client B</code>’s game state differs from <code>Server</code>’s game state since it does not know which leader <code>A</code> has chosen. When <code>Client B</code> sends their action (Choosing Margaery Tyrell), we apply the same logic and filter out the chosen leader out of the message sent to <code>Client A</code>. Since both players have chosen their leaders, we can reconciliate the differences in game state by sending out the choice of the other players. After this little manoeuver, all clients have the same game state and can resolve the rest of the combat deterministically.</p><p>Note that while we could have opted not to send anything to <code>Client B</code> after <code>A</code> had chosen their leader, sending this information makes it possible to display in the UI of <code>B</code> that <code>A</code> has already chosen their leader.</p><h2>Conclusion</h2><p>If I had to develop Swords &amp; Ravens from scratch, I would do it using a deterministic method. Having to implement the networking only once, and be done with it, is quite elegant and appealing. Since AGoT:TBG is quite a complex game with a lot of different phases, having to network every interaction produced a lot of boilerplate code, which amounts to a big portion of the code. On top of that, I never managed to easily add animations (pieces moving, cards moving from hand to board, …) to the UI, which does not help a lot with AGoT:TBG where a single action can have a lot of state updates.</p><p>Another nice thing about using a deterministic method is that you can easily make a library that handles all the networking part of a turn-based game, letting the developer focus on developing the mechanics of the game itself. I’ve started working on such a library, <a href="https://ravens.dev/">Ravens</a>. Unfortunately, due to external circumstances, I have not continued developing it.</p><p>If you’re actually in the process of implementing a turn-based multiplayer game, I hope that this article was able to help you on choosing a sound architecture. If not, then I hope the content and the writing was interesting enough!</p></article></div></div>
  </body>
</html>
