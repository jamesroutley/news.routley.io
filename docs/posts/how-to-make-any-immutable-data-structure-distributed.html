<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.unison-lang.org/articles/distributed-datasets/core-idea/">Original</a>
    <h1>How to make any immutable data structure distributed</h1>
    
    <div id="readability-page-1" class="page"><article><section><p><span><span>In this post we&#39;ll build our own distributed data structure from first principles. The version developed here is a little simpler than the</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@341hr6pn7bbpeokp01sldn0cnobibmmsb7m99n2g9glvltpq0jqjaqdfb9c88f8b86h4pd46iojn9lpmfi2fr3lvt5oefs14gtop9pg" target="_blank">Seq</a></span></code><span>used in the &#34;real&#34; version of the library. We&#39;ll get to the real</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@341hr6pn7bbpeokp01sldn0cnobibmmsb7m99n2g9glvltpq0jqjaqdfb9c88f8b86h4pd46iojn9lpmfi2fr3lvt5oefs14gtop9pg" target="_blank">Seq</a></span></code><span>in Part 5 of this article.</span></span></p><p><span><span>First, let&#39;s look at a simple in-memory tree data structure and understand how it can be modified to represent data spread across multiple nodes. Here&#39;s the in-memory version:</span></span></p><div><div><div><div><pre><code><span><span>structural</span><span> </span><span>type</span><span> </span><span>SimpleTree</span><span> </span><span>a</span></span></code></pre></div></div></div></div><p><span><span>A</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@fe82omtjkr81gvs6s26smo5fbeapoureibj9sv1n4ifsb0cqk6f9c2gkce651bmoad78bs5lri2slut8ug54und5j0tfr07ls9uvds0" target="_blank">SimpleTree</a></span></code><span>is either</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@fe82omtjkr81gvs6s26smo5fbeapoureibj9sv1n4ifsb0cqk6f9c2gkce651bmoad78bs5lri2slut8ug54und5j0tfr07ls9uvds0@d0" target="_blank"><span><span>SimpleTree</span><span>.</span><span>Empty</span></span></a></span></code><span>,</span></span></span><span>a leaf:</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@fe82omtjkr81gvs6s26smo5fbeapoureibj9sv1n4ifsb0cqk6f9c2gkce651bmoad78bs5lri2slut8ug54und5j0tfr07ls9uvds0@d2" target="_blank"><span><span>SimpleTree</span><span>.</span><span>One</span></span></a></span></code><span>,</span></span></span><span>or a branch:</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@fe82omtjkr81gvs6s26smo5fbeapoureibj9sv1n4ifsb0cqk6f9c2gkce651bmoad78bs5lri2slut8ug54und5j0tfr07ls9uvds0@d1" target="_blank"><span><span>SimpleTree</span><span>.</span><span>Two</span></span></a></span></code><span>.</span></span></span><span>All the leaves and subtrees in a</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@fe82omtjkr81gvs6s26smo5fbeapoureibj9sv1n4ifsb0cqk6f9c2gkce651bmoad78bs5lri2slut8ug54und5j0tfr07ls9uvds0" target="_blank">SimpleTree</a></span></code><span>are references to values which are in local memory on the same machine. If instead we want it to contain references to values that may exist at another location, we can write the following instead:</span></span></p><p><span><span>All we&#39;ve done here is wrap each branch and leaf of the tree in a data type,</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>,</span></span></span><span>which represents a</span><span><span>lazy</span></span><span>value at a possibly remote location.</span></span></p><div><p>ðŸ‘‰</p><div><section><p><span><span>Making a distributed data type in Unison can be as simple as wrapping the fields in</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>.</span></span></span></span></p><p><span><span>There are some choices you can make here. For instance you can put</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>around all the fields in the data constructor or only some, and you can also have laziness &#34;start at the root&#34; or only when looking at subtrees. We&#39;ll discuss these subtleties in the last part of the series.</span></span></p></section></div></div><p><span><span>With this simple type definition, we can now implement functions like a distributed</span><span><span><span><code><span>map</span></code></span><span>,</span></span></span><span><span><span><code><span>reduce</span></code></span><span>,</span></span></span><span>and so on without needing to write any networking or serialization</span><span><span><span>code.</span><span></span></span></span></span></p><p><span><span>Let&#39;s try it for our</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>.</span></span></span><span>This will be instructive!</span></span></p><p><span><span>We know we&#39;ll need to pattern match on the data constructors of</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>and perform a recursive call of some kind, but now that the leaf and branch are both wrapped in</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>,</span></span></span><span>what should we do? There are two ways to do this that typecheck.</span></span></p><p><span><span>The first is not what quite what we want but it&#39;s instructive nonetheless. It makes ample use of</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a><span> </span><span>: </span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a><span> </span><span>a</span><span> </span><span><span>-&gt;</span></span><span>{</span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@sb0a0jt855ehgtel9rc4ri6vlb27gk88luqci5l2vj11ik72nj8skjeaahglev0otnd1pb33sk90nns7447cpiv60p1qjacph94uhu0" target="_blank">Remote</a><span>}</span><span> </span><span>a</span></span></code><span>to force the lazy</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>and</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@gmls516mdd7k90dsqsbd48v2usq461ggabjniqgah995kkut9huj3d2k17cqe5lug9757u8v4uo024nvo3bo5i87eldbdm27hini34o" target="_blank"><span><span>Value</span><span>.</span><span>pure</span></span></a><span> </span><span>: </span><span>a</span><span> </span><span><span>-&gt;</span></span><span> </span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a><span> </span><span>a</span></span></code><span>for creating a remote value from an in-memory value:</span></span></p><p><span><span>To see why this isn&#39;t what we want, let&#39;s look at the documentation of</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a></span></code><span>and</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@gmls516mdd7k90dsqsbd48v2usq461ggabjniqgah995kkut9huj3d2k17cqe5lug9757u8v4uo024nvo3bo5i87eldbdm27hini34o" target="_blank"><span><span>Value</span><span>.</span><span>pure</span></span></a></span></code><span>:</span></span></span></span></p><blockquote><section><p><strong><span><code><span>Value.get</span></code></span></strong></p><p><span><span>Obtain the</span><span><code><span>a</span></code></span><span>denoted by this</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>.</span></span></span></span></p><p><span><span>A few properties:</span></span></p><ul><li><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a><span> </span><span>(</span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@gmls516mdd7k90dsqsbd48v2usq461ggabjniqgah995kkut9huj3d2k17cqe5lug9757u8v4uo024nvo3bo5i87eldbdm27hini34o" target="_blank"><span><span>Value</span><span>.</span><span>pure</span></span></a><span> </span><span>a</span><span>)</span><span> </span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@@-universal.==" target="_blank">===</a><span> </span><span>a</span></span></code></span></li><li><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a><span> </span><span>(</span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@58pqd859tsng2m0trpitm77jpb5liogdcvm4u51d3ej79uktlpg0lj57o3j6av7q2n5t5rfiiu8lptgjq3qsk4oi9tfng346m11pc68" target="_blank"><span><span>Value</span><span>.</span><span>at</span></span></a><span> </span><span>loc</span><span> </span><span>a</span><span>)</span><span> </span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@@-universal.==" target="_blank">===</a><span> </span><span>a</span></span></code></span></li><li><span><code><span><span>f</span><span> </span><span>(</span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a><span> </span><span>v</span><span>)</span><span> </span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@@-universal.==" target="_blank">===</a><span> </span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a><span> </span><span>(</span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@51bd6ml47bouhf3alngkvg77oipl9ftpcjs28n71j7b9an4c16joirvl93eqmffidfgmug0v5cqsuj4mh6jp8j34mc33dv0u4so4tug" target="_blank"><span><span>Value</span><span>.</span><span>map</span></span></a><span> </span><span>f</span><span> </span><span>v</span><span>)</span></span></code></span></li></ul></section></blockquote><blockquote><span><strong><span><code><span>Value.pure</span></code></span></strong><section><p><span><span>Create an in-memory</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>.</span></span></span></span></p><p><span><span>Satisfies the property:</span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a><span> </span><span>(</span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@gmls516mdd7k90dsqsbd48v2usq461ggabjniqgah995kkut9huj3d2k17cqe5lug9757u8v4uo024nvo3bo5i87eldbdm27hini34o" target="_blank"><span><span>Value</span><span>.</span><span>pure</span></span></a><span> </span><span>a</span><span>)</span><span> </span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@@-universal.==" target="_blank">===</a><span> </span><span>a</span></span></code></span></span></p></section></span></blockquote><p><span><span>We&#39;re</span><strong><span>summoning</span></strong><span>the value from a potentially remote location with</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a></span></code><span>,</span></span></span><span>and then</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@gmls516mdd7k90dsqsbd48v2usq461ggabjniqgah995kkut9huj3d2k17cqe5lug9757u8v4uo024nvo3bo5i87eldbdm27hini34o" target="_blank"><span><span>Value</span><span>.</span><span>pure</span></span></a></span></code><span>creates a value in memory at the location where it&#39;s called. Our implementation of</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@0o50qrthtoun43ntk78lrcnj6mijtqckgdr4lg1flvcmiav2uqgsq1t636mjh19b92urkku35fmbk1e63gigakto5sdipq9jv0ph5f0" target="_blank"><span><span>eager</span><span>.</span><span>Tree</span><span>.</span><span>map</span></span></a></span></code><span>will thus end up sending the entire tree to the original caller of the function, applying the function there, and storing the resulting tree in memory at that location. That&#39;s no good--presumably the whole reason we&#39;re using a distributed data structure is the data is too big to fit in memory on a single machine.</span></span></p><p><span><span>The version of</span><span><code><span>map</span></code></span><span>we want will do its work lazily, when the resulting</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>is forced, and it will do the mapping in parallel at the locations where the data lives rather shipping everything to the</span><span><span><span>caller.</span><span></span></span></span></span></p><p><span><span>A good rule of thumb when implementing functions like</span><span><code><span>Tree.map</span></code></span><span>is to</span><span><span><span><span><span>never call</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a></span></code></span></span><span>.</span></span></span><span>Instead we will use</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@51bd6ml47bouhf3alngkvg77oipl9ftpcjs28n71j7b9an4c16joirvl93eqmffidfgmug0v5cqsuj4mh6jp8j34mc33dv0u4so4tug" target="_blank"><span><span>Value</span><span>.</span><span>map</span></span></a></span></code><span>to lazily apply a function</span><span><span><span><span><span>at the location where the remote value lives</span></span></span><span>.</span></span></span><span></span></span></p><p><span><span>While you can perhaps see how this code typechecks, what this code does is a bit brain-bending. First, because our</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@j4m8l1tm8qj8k9gug2t95ifk0q0dj5vnv2vqkv47clnm97ub9k505ks8djb4pr2e7b7mgjlmi0e1oomgl7qfnasb8ofq28q4dfg6km0" target="_blank"><span><span>src</span><span>.</span><span>Tree</span><span>.</span><span>map</span></span></a></span></code><span>function does not call</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a></span></code><span>,</span></span></span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@j4m8l1tm8qj8k9gug2t95ifk0q0dj5vnv2vqkv47clnm97ub9k505ks8djb4pr2e7b7mgjlmi0e1oomgl7qfnasb8ofq28q4dfg6km0" target="_blank"><span><span>src</span><span>.</span><span>Tree</span><span>.</span><span>map</span></span></a></span></code><span>is just the blueprint for the data transformation, not the transformed data itself. Not until the tree is evaluated (by say, the</span><span><code><span>reduce</span></code></span><span>function we&#39;ll cover in Part 3) does any mapping actually happen. This laziness gives us fusion</span><span></span></span></p><span>&#34;for free&#34;, so if we</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@j4m8l1tm8qj8k9gug2t95ifk0q0dj5vnv2vqkv47clnm97ub9k505ks8djb4pr2e7b7mgjlmi0e1oomgl7qfnasb8ofq28q4dfg6km0" target="_blank"><span><span>src</span><span>.</span><span>Tree</span><span>.</span><span>map</span></span></a></span></code><span>multiple times, the functions will get composed together and applied in the same pass over the data as the</span><span><span><span><code><span>reduce</span></code></span><span>.</span></span></span><p><span><span>Morever, because we are using</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@51bd6ml47bouhf3alngkvg77oipl9ftpcjs28n71j7b9an4c16joirvl93eqmffidfgmug0v5cqsuj4mh6jp8j34mc33dv0u4so4tug" target="_blank"><span><span>Value</span><span>.</span><span>map</span></span></a></span></code><span>,</span></span></span><span>the function will be applied at the location where the data lives, rather than shipping the entire tree to the caller and applying the transformation function there.</span></span></p><div><div><p><span><strong><span><span>Optional but fun exercises</span></span></strong><span>ðŸ˜Ž</span></span></p><div><p><span><strong><span><span>Optional but fun exercises</span></span></strong><span>ðŸ˜Ž</span></span></p><section><p><span><span>See if you can write more functions for</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>.</span></span></span><span>We&#39;ve provided a codebase with the necessary dependencies and stubbed functions. To pull in the codebase, run the following in the UCM:</span></span></p><div><pre><code><span>.&gt; pull git@github.com:unisonweb/website:.articles.distributedDatasets .article1</span></code></pre></div><p><span><span>The</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>function stubs are under</span><span><span><span><code><span>src.Tree</span></code></span><span>.</span></span></span></span></p><div><p>ðŸ““</p><div><section><p><strong><span><span>Exercise:</span><span><span>Another basic</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>transformation</span></span></span></strong></p><p><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@j4m8l1tm8qj8k9gug2t95ifk0q0dj5vnv2vqkv47clnm97ub9k505ks8djb4pr2e7b7mgjlmi0e1oomgl7qfnasb8ofq28q4dfg6km0" target="_blank"><span><span>src</span><span>.</span><span>Tree</span><span>.</span><span>map</span></span></a></span></code><span>is a structure preserving transformation that doesn&#39;t force the distributed data to be evaluated. In a similar vein write</span><span><code><span>Tree.reverse : Tree a -&gt; Tree a</span></code></span><span>which swaps the left and right branches of the tree but doesn&#39;t force the evaluation of the tree.</span></span></p></section></div></div><div><p>ðŸ““</p><div><section><p><strong><span><span>Exercise:</span><span><span>Building a</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>from a list</span></span></span></strong></p><p><span><span>For testing purposes, it would be great if we had an easy way to make an in-memory</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@v1vbm5b8e78gc9fhvqu620313h4dmhmb2a8i3uh40n56svc8gud36bqh74kc7da79njt6l76eid0ot5lpbe49pru4rpjv2983f1mbog" target="_blank">Tree</a></span></code><span>from a</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@@-sequence" target="_blank">List</a></span></code><span>.</span></span></span></span></p><p><span><span>Implement</span><span><span><span><code><span>Tree.fromList : [a] -&gt; Tree a</span></code></span><span>.</span></span></span><span>It might be nice if the Tree was roughly balanced. ðŸ˜Š</span></span></p></section></div></div></section></div></div></div><section><h2><span>Takeaways</span></h2><p><span><span>We learned a few things in this part:</span></span></p><ul><li><span><span>To make a data structure distributed, wrap</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/types/@lkqa61he0gok8ratb0f6rjbkftvd4bnoopc9n51p2teevinru4prhris4k3e011u2o59n93fol2k0maelknlbjvd5qgdhf71hlo97u0" target="_blank"><span><span>distributed</span><span>.</span><span>Value</span></span></a></span></code><span>around the fields it defines in its data constructors. This lets the data structure represent the data being &#34;elsewhere&#34; with a minimum amount of ceremony.</span></span></li><li><span><span>Use</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@51bd6ml47bouhf3alngkvg77oipl9ftpcjs28n71j7b9an4c16joirvl93eqmffidfgmug0v5cqsuj4mh6jp8j34mc33dv0u4so4tug" target="_blank"><span><span>Value</span><span>.</span><span>map</span></span></a></span></code><span>judiciously to build lazy computations like</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@j4m8l1tm8qj8k9gug2t95ifk0q0dj5vnv2vqkv47clnm97ub9k505ks8djb4pr2e7b7mgjlmi0e1oomgl7qfnasb8ofq28q4dfg6km0" target="_blank"><span><span>src</span><span>.</span><span>Tree</span><span>.</span><span>map</span></span></a></span></code><span>where the function is brought to the data.</span></span></li></ul><p><span><span>We also saw how to obtain different runtime behaviors for your distributed programs through implementations of the</span><span><code><span>Tree.map</span></code></span><span>function using</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@51bd6ml47bouhf3alngkvg77oipl9ftpcjs28n71j7b9an4c16joirvl93eqmffidfgmug0v5cqsuj4mh6jp8j34mc33dv0u4so4tug" target="_blank"><span><span>Value</span><span>.</span><span>map</span></span></a></span></code><span>or</span><span><span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@ofrse2tksilit9db11qgg0f24eo66i73c4tsm2gm99kgo5f77vorajg4j7c694qi21s30f31fc6tini1e04fs6vif5tkppngb0ghqug" target="_blank"><span><span>Value</span><span>.</span><span>get</span></span></a></span></code><span>.</span></span></span></span></p><p><span><span>As a library author, you do have to be explicit when describing how your program should behave, and we consider this a good thing: you can achieve exactly what you want with a tiny amount of code, and you can wrap up common patterns in reusable functions like</span><code><span><a href="https://share.unison-lang.org/latest/namespaces/unison/website/;/terms/@j4m8l1tm8qj8k9gug2t95ifk0q0dj5vnv2vqkv47clnm97ub9k505ks8djb4pr2e7b7mgjlmi0e1oomgl7qfnasb8ofq28q4dfg6km0" target="_blank"><span><span>src</span><span>.</span><span>Tree</span><span>.</span><span>map</span></span></a></span></code><span>that anyone can use without being a distributed systems expert!</span></span></p><p><span><span>If you&#39;ve been wondering &#34;how do I evaluate this in some way?&#34; we&#39;ll cover that next, in Part 3. Again there will be some instructive decisions to make: how we implement functions like</span><span><code><span>reduce</span></code></span><span>will determine whether the work happens in parallel close to the data or whether the data gets sent to the caller and reduced there.</span></span></p></section></section></article></div>
  </body>
</html>
