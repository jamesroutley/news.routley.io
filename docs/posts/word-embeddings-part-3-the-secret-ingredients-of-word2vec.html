<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.ruder.io/secret-word2vec/">Original</a>
    <h1>Word embeddings â€“ Part 3: The secret ingredients of Word2Vec</h1>
    
    <div id="readability-page-1" class="page"><section>
        <!--kg-card-begin: markdown--><p>This post will discuss the factors that account for the success of word2vec and its connection to more traditional models.</p>
<p>Table of Contents:</p>
<ul>
<li><a href="#glove">GloVe</a></li>
<li><a href="#wordembeddingsvsdistributionalsemanticsmodels">Word embeddings vs. distributional semantic models</a></li>
<li><a href="#models">Models</a></li>
<li><a href="#hyperparameters">Hyperparameters</a></li>
<li><a href="#results">Results</a></li>
</ul>
<p>Excuse the rather clickbait-y title. This is a blog post that I meant to write for a while. In this post, I want to highlight the factors, i.e. the secret ingredients that account for the success of word2vec.</p>
<p>To this effect, the paper on which this blog post is based is <em>Improving Distributional Similarity with Lessons Learned from Word Embeddings</em>  by Levy et al. (2015). If you haven&#39;t read it, I recommend you to check it out.</p>
<p>Over the course of this blog post, I will first introduce GloVe, a popular word embedding model. I will then highlight the connection between word embedding models and distributional semantic methods. Subsequently, I will introduce the four models that will be used to measure the impact of the different factors. I will then give an overview of all additional factors that play a role in learning word representations, besides the choice of the algorithm. I will finally present the results by Levy et al., their takeaways and recommendations.</p>

<p>In a <a href="http://ruder.io/word-embeddings-1/index.html?ref=ruder.io">previous blog post</a>, we have given an overview of popular word embedding models. One model that we have omitted so far is GloVe .</p>
<p>Briefly, GloVe seeks to make explicit what SGNS does implicitly: Encoding meaning as vector offsets in an embedding space -- seemingly only a serendipitous by-product of word2vec -- is the specified goal of GloVe.</p>
<p>\(J = \sum\limits_{i, j=1}^V f(X_{ij})   (w_i^T \tilde{w}_j + b_i + \tilde{b}_j - \text{log}   X_{ij})^2 \)</p>
<p>where \(w_i\) and \(b_i\) are the word vector and bias respectively of word \(i\), \(\tilde{w}_j\) and \(b_j\) are the context word vector and bias respectively of word \(j\), \(X_{ij}\) is the number of times word \(i\) occurs in the context of word \(j\), and \(f\) is a weighting function that assigns relatively lower weight to rare and frequent co-occurrences.</p>
<p>As co-occurrence counts can be directly encoded in a word-context co-occurrence matrix, GloVe takes such a matrix rather than the entire corpus as input.</p>
<p>If you want to know more about GloVe, the best reference is likely <a href="http://www.aclweb.org/anthology/D14-1162?ref=ruder.io">the paper</a> and the <a href="http://nlp.stanford.edu/projects/glove/?ref=ruder.io">accompanying website</a>. Besides that, you can find some additional intuitions on GloVe and its difference to word2vec by the author of gensim <a href="http://rare-technologies.com/making-sense-of-word2vec/?ref=ruder.io">here</a>, in <a href="https://www.quora.com/How-is-GloVe-different-from-word2vec?ref=ruder.io">this Quora thread</a>, and in <a href="https://cran.r-project.org/web/packages/text2vec/vignettes/glove.html?ref=ruder.io">this blog post</a>.</p>

<p>The reason why word embedding models, particularly word2vec and GloVe, became so popular is that they seemed to continuously and significantly outperform DSMs. Many attributed this to the neural architecture of word2vec or the fact that it predicts words, which seemed to have a natural edge over solely relying on co-occurrence counts.</p>
<p>We can view DSMs as <em>count</em> models as they &#34;count&#34; co-occurrences among words by operating on co-occurrence matrices. In contrast, neural word embedding models can be seen as <em>predict</em> models, as they try to predict surrounding words.</p>
<p>In 2014, Baroni et al.  showed that predict models consistently outperform count models in almost all tasks, thus providing a clear verification for the apparent superiority of word embedding models. Is this the end? No.</p>
<p>Already with GloVe we&#39;ve seen that the differences are not as clear-cut: While GloVe is considered a predict model by Levy et al. (2015), it is clearly factorizing a word-context co-occurrence matrix, which brings it close to traditional methods such as PCA and LSA. Even more, Levy et al.  demonstrate that word2vec implicitly factorizes a word-context PMI matrix.</p>
<p>Consequently, while on the surface DSMs and word embedding models use different algorithms to learn word representations -- the first count, the latter predict -- fundamentally, both types of models act on the same underlying statistics of the data, i.e. the co-occurrence counts between words.</p>
<p>Thus, the question that still remains and which we will dedicate the rest of this blog post to answering is the following:</p>

<p>Following Levy et al. (2015), we will isolate and identify the factors that account for the success of neural word embedding models and show how these can be transferred to traditional methods by comparing the following four models:</p>
<ul>
<li>
<p><strong>Positive Pointwise Mutual Information (PPMI)</strong>: PMI is a common measure for the strength of association between two words. It is defined as the log ratio between the joint probability of two words \(w\) and \(c\) and the product of their marginal probabilities: \(PMI(w,c) = \text{log}   \dfrac{P(w,c)}{P(w) P(c)} \). As \( PMI(w,c) = \text{log}   0 = - \infty \) for pairs \( (w,c) \) that were never observed, PMI is in practice often replaced with <em>positive</em> PMI (PPMI), which replaces negative values with \(0\), yielding \(PPMI(w,c) = \text{max}(PMI(w,c),0)\).</p>
</li>
<li>
<p><strong>Singular Value Decomposition (SVD):</strong> SVD is one of the most popular methods for dimensionality reduction and found its into NLP originally via latent semantic analysis (LSA). SVD factories the word-context co-occurrence matrix into the product of three matrices \(U \cdot \Sigma \times V^T \) where \(U\) and \(V\) are orthonormal matrices (i.e. square matrices whose rows and columns are orthogonal unit vectors) and \(\Sigma\) is a diagonal matrix of eigenvalues in</p>
</li>
<li>
<p><strong>Skip-gram with Negative Sampling (SGNS)</strong> aka word2vec: To learn more about the skip-gram architecture and the negative sampling refer to my previous blog posts <a href="http://ruder.io/word-embeddings-1/index.html?ref=ruder.io">here</a> and <a href="http://ruder.io/word-embeddings-softmax/index.html?ref=ruder.io">here</a> respectively.</p>
</li>
<li>
<p><strong>Global Vectors (GloVe)</strong> as presented in the previous section.</p>
</li>
</ul>

<p>We will look at the following hyper-parameters:</p>
<ul>
<li><a href="#preprocessing">Pre-processing</a>
<ul>
<li><a href="#dynamiccontextwindow">Dynamic context window</a></li>
<li><a href="#subsamplingfrequentwords">Subsampling frequent words</a></li>
<li><a href="#deletingrarewords">Deleting rare words</a></li>
</ul>
</li>
<li><a href="#associationmetric">Association metric</a>
<ul>
<li><a href="#shiftedpmi">Shifted PMI</a></li>
<li><a href="#contextdistributionsmoothing">Context distribution smoothing</a></li>
</ul>
</li>
<li><a href="#postprocessing">Post-processing</a>
<ul>
<li><a href="#addingcontextvectors">Adding context vectors</a></li>
<li><a href="#eigenvalueweighting">Eigenvalue weighting</a></li>
<li><a href="#vectornormalisation">Vector normalisation</a></li>
</ul>
</li>
</ul>
<h2 id="preprocessing">Pre-processing</h2>
<p>Word2vec introduces three ways of pre-processing a corpus, which can be easily applied to DSMs.</p>
<h3 id="dynamiccontextwindow">Dynamic context window</h3>
<p>In DSMs traditionally, the context window is unweighted and of a constant size. Both SGNS and GloVe, however, use a scheme that assigns more weight to closer words, as closer words are generally considered to be more important to a word&#39;s meaning. In SGNS, this weighting is implemented by having a dynamic window size that is sampled uniformly between \(1\) and the maximum window size during training.</p>
<h3 id="subsamplingfrequentwords">Subsampling frequent words</h3>
<p>SGNS dilutes very frequent words by randomly removing words whose frequency \(f\) is higher than some threshold \(t\) with a probability \(p = 1 - \sqrt{\dfrac{t}{f}}\). As this subsampling is done <em>before</em> actually creating the windows, the context windows used by SGNS in practice are larger than indicated by the context window size.</p>
<h3 id="deletingrarewords">Deleting rare words</h3>
<p>In the pre-processing of SGNS, rare words are also deleted <em>before</em> creating the context windows, which increases the actual size of the context windows further. Levy et al. (2015) find this not to have a significant performance impact, though.</p>
<h2 id="associationmetric">Association metric</h2>
<p>PMI has been shown to be an effective metric for measuring the association between words. Since Levy and Goldberg (2014) have shown SGNS to implicitly factorize a PMI matrix, two variations stemming from this formulation can be introduced to regular PMI.</p>
<h3 id="shiftedpmi">Shifted PMI</h3>
<p>In SGNS, the higher the number of negative samples \(k\), the more data is being used and the better should be the estimation of the parameters. \(k\) affects the shift of the PMI matrix that is implicitly factorized by word2vec, i.e. \(k\) k shifts the PMI values by log \(k\).</p>
<h3 id="contextdistributionsmoothing">Context distribution smoothing</h3>
<p>In SGNS, the negative samples are sampled according to a <em>smoothed</em> unigram distribution, i.e. an unigram distribution raised to the power of \(\alpha\), which is empirically set to \(\dfrac{3}{4}\). This leads to frequent words being sampled relatively less often than their frequency would indicate.</p>
<h2 id="postprocessing">Post-processing</h2>
<p>Similar as in pre-processing, three methods can be used to modify the word vectors produced by an algorithm.</p>
<h3 id="addingcontextvectors">Adding context vectors</h3>
<p>The authors of GloVe propose to add word vectors and context vectors to create the final output vectors, e.g. \(\vec{v}_{\text{cat}} = \vec{w}_{\text{cat}} + \vec{c}_{\text{cat}}\). This adds first-order similarity terms, i.e \(w \cdot v\). However, this method cannot be applied to PMI, as the vectors produced by PMI are sparse.</p>
<h3 id="eigenvalueweighting">Eigenvalue weighting</h3>
<p>SVD produces the following matrices: \(W^{SVD} = U_d \cdot \Sigma_d \) and \(C^{SVD} = V_d\). These matrices, however, have different properties: \(C^{SVD}\) is orthonormal, while \(W^{SVD}\) is not.</p>
<h3 id="vectornormalisation">Vector normalisation</h3>
<p>Finally, we can also normalise all vectors to unit length.</p>

<p>Levy et al. (2015) train all models on a dump of the English wikipedia and evaluate them on the commonly used word similarity and analogy datasets. You can read more about the experimental setup and training details in their paper. We summarise the most important results and takeaways below.</p>
<h2 id="takeaways">Takeaways</h2>
<p>Levy et al. find that SVD -- and not one of the word embedding algorithms -- performs best on similarity tasks, while SGNS performs best on analogy datasets. They furthermore shed light on the importance of hyperparameters compared to other choices:</p>
<ol>
<li>Hyperparameters vs. algorithms:</li>
<li>Hyperparameters vs. more data:</li>
</ol>
<h2 id="debunkingpriorclaims">Debunking prior claims</h2>
<p>Equipped with these insights, we can now debunk some generally held claims:</p>
<ol>
<li>Are embeddings superior to distributional methods?</li>
<li>Is GloVe superior to SGNS?</li>
<li>Is CBOW a good word2vec configuration?</li>
</ol>

<p>Finally -- and one of the things I like most about the paper -- we can give concrete practical recommendations:</p>
<ul>
<li><strong>DON&#39;T</strong> use shifted PPMI with SVD.</li>
<li><strong>DON&#39;T</strong> use SVD &#34;correctly&#34;, i.e. without eigenvector weighting (performance drops 15 points compared to with eigenvalue weighting with \(p = 0.5\)).</li>
<li><strong>DO</strong> use PPMI and SVD with short contexts (window size of \(2\)).</li>
<li><strong>DO</strong> use many negative samples with SGNS.</li>
<li><strong>DO</strong> always use context distribution smoothing (raise unigram distribution to the power of \(\alpha = 0.75\)) for all methods.</li>
<li><strong>DO</strong> use SGNS as a baseline (robust, fast and cheap to train).</li>
<li><strong>DO</strong> try adding context vectors in SGNS and GloVe.</li>
</ul>

<p>These results run counter to what is generally assumed, namely that word embeddings are superior to traditional methods and indicate that it generally makes <em>no difference whatsoever</em> whether you use word embeddings or distributional methods -- what matters is that you tune your hyperparameters and employ the appropriate pre-processing and post-processing steps.</p>
<p>Recent papers from Jurafsky&#39;s group   echo these findings and show that SVD -- not SGNS -- is often the preferred choice when you care about accurate word representations.</p>
<p>I hope this blog post was useful in highlighting cool research that sheds light on the link between traditional distributional semantic and in-vogue embedding models. As we&#39;ve seen, knowledge of distributional semantics allows us to improve upon our current methods and develop entirely new variations of existing ones. For this reason, I hope that the next time you train word embeddings, you will consider adding distributional methods to your toolbox or lean on them for inspiration.</p>
<p>As always, feel free to ask questions and point out the mistakes I made in this blog post in the comments below.</p>
<h2 id="citation">Citation</h2>
<p>
For attribution in academic contexts or books, please cite this work as:
</p><pre><code>Sebastian Ruder, &#34;On word embeddings - Part 3: The secret ingredients of word2vec&#34;. http://ruder.io/secret-word2vec/, 2016.
</code></pre>
<p>BibTeX citation:</p>
<pre><code>@misc{ruder2016secretword2vec,
author = {Ruder, Sebastian},
title = {{On word embeddings - Part 3: The secret ingredients of word2vec}},
year = {2016},
howpublished = {\url{http://ruder.io/secret-word2vec/}},
}
</code></pre>

<h2 id="otherblogpostsonwordembeddings">Other blog posts on word embeddings</h2>
<p>If you want to learn more about word embeddings, these other blog posts on word embeddings are also available:</p>
<ul>
<li><a href="http://ruder.io/word-embeddings-1/index.html?ref=ruder.io">On word embeddings - Part 1</a></li>
<li><a href="http://ruder.io/word-embeddings-softmax/index.html?ref=ruder.io">On word embeddings - Part 2: Approximating the softmax</a></li>
<li><a href="http://ruder.io/cross-lingual-embeddings/index.html?ref=ruder.io">Unofficial Part 4: A survey of cross-lingual embedding models</a></li>
<li><a href="http://ruder.io/word-embeddings-2017/index.html?ref=ruder.io">Unofficial Part 5: Word embeddings in 2017 -  Trends and future directions</a></li>
</ul>
<p>Cover images are courtesy of <a href="http://nlp.stanford.edu/projects/glove/?ref=ruder.io">Stanford</a>.</p>


<!--kg-card-end: markdown-->
    </section></div>
  </body>
</html>
