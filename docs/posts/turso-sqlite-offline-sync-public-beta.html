<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://turso.tech/blog/turso-offline-sync-public-beta">Original</a>
    <h1>Turso SQLite Offline Sync Public Beta</h1>
    
    <div id="readability-page-1" class="page"><div><p><strong>We&#39;re excited to announce that Turso Offline Sync is now available in public beta!</strong></p>
<p>Your applications can continue functioning seamlessly, even when disconnected from the internet. Local database operations can proceed normally, with automatic sync occurring once connectivity is restored.</p>
<p>Historically, SQLite has been a database that excels at running local, embedded databases, because the database is just a file. For mobile devices, this means on-device databases.</p>
<p>Turso takes advantage of this with Embedded Replicas — your local embedded databases, on-device or server can now be kept in sync with your Turso Cloud database, and any changes are propagated to all replicas.</p>
<p>Until today, our sync was unidirectional: while you can always read from the database, even if offline, writes happen directly to the Cloud, and are propagated later.</p>
<p>This has two consequences:</p>
<ul>
<li>Writes were always network-slow, since they have to contact the server for every request</li>
<li>Writes could not work offline</li>
</ul>
<p>With today&#39;s announcement, the local database will be able to accept writes that are as fast as a file, work offline, and later sync to Turso Cloud.</p>
<h2 id="use-cases-that-just-got-easier"><a href="#use-cases-that-just-got-easier">#</a><a aria-hidden="true" tabindex="-1" href="#use-cases-that-just-got-easier"><span></span></a>Use Cases That Just Got Easier</h2>
<p>One of the things Offline Sync unlocks is the ability to create on-device local-first applications (in-browser is planned for the future, with <a href="https://www.theguardian.com/blog/introducing-limbo-a-complete-rewrite-of-sqlite-in-rust">&#34;the Limbo Project&#34;</a>). Local-first architectures allow for fast and responsive applications that are resilient to network failures.</p>
<p>Compared to other local-first applications, Turso&#39;s architecture allows for a simpler solution because it always syncs the full database. With Turso&#39;s multitenant architecture, you can control which data goes into which database (e.g., per user or per tenant), and then transfer the entire database to the device.</p>
<p>As well as on-device local-first applications, Offline Sync also simplifies many other use cases:</p>
<ul>
<li><strong>Mobile Apps</strong> — create truly offline-capable mobile experiences, including Expo-based React Native applications.</li>
<li><strong>Point-of-Sale Systems</strong> — process transactions regardless of internet connectivity</li>
<li><strong>Field Data Collection</strong> — gather data in remote locations without worrying about connectivity</li>
<li><strong>IoT Applications</strong> — Maintain local data storage with periodic cloud sync with Turso Cloud</li>
</ul>
<h2 id="what-s-available-in-the-public-beta-"><a href="#what-s-available-in-the-public-beta-">#</a><a aria-hidden="true" tabindex="-1" href="#whats-available-in-the-public-beta"><span></span></a>What&#39;s available in the public beta?</h2>
<p>The following features are part of the public beta:</p>
<ul>
<li>Bi-directional sync (push local changes to remote and pull remote changes)</li>
<li>Remote write support for embedded replicas</li>
<li>WAL sync checkpointing</li>
<li>Conflict detection (but resolution is not yet implemented)</li>
</ul>
<h2 id="getting-started"><a href="#getting-started">#</a><a aria-hidden="true" tabindex="-1" href="#getting-started"><span></span></a>Getting Started</h2>
<p>You are now invited to try Turso Offline Sync. The beta currently includes support for TypeScript, and Rust.</p>
<p>Make sure to create a new database in your preferred AWS location:</p>
<pre><code>
turso group create --location aws-us-east-1 offline


turso db create --group offline offline
</code></pre>
<h3 id="typescript"><a href="#typescript">#</a><a aria-hidden="true" tabindex="-1" href="#typescript"><span></span></a>TypeScript</h3>
<p>Make sure to install the latest <code>@libsql/client</code> package:</p>
<pre><code>npm install @libsql/client
</code></pre>
<p>Then inside your project, make sure to set <code>offline: true</code> to enable offline mode:</p>
<pre><code><span>import</span> { createClient } <span>from</span> <span>&#39;@libsql/client&#39;</span>;

<span>const</span> client = <span>createClient</span>({
  <span>url</span>: <span>&#39;file:local.db&#39;</span>,
  <span>syncUrl</span>: process.<span>env</span>.<span>TURSO_SYNC_URL</span>,
  <span>authToken</span>: process.<span>env</span>.<span>TURSO_AUTH_TOKEN</span>,
});


<span>async</span> <span>function</span> <span>saveNote</span>(<span>content</span>) {
  <span>await</span> client.<span>execute</span>(<span>`
    CREATE TABLE IF NOT EXISTS notes (
      id INTEGER PRIMARY KEY,
      content TEXT,
      created_at TEXT
    )
  `</span>);

  
  <span>await</span> client.<span>execute</span>({
    <span>sql</span>: <span>`INSERT INTO notes (content, created_at) VALUES (?, datetime(&#39;now&#39;))`</span>,
    <span>args</span>: [content],
  });

  
  <span>try</span> {
    <span>await</span> client.<span>sync</span>();
    <span>console</span>.<span>log</span>(<span>&#39;Note synced to cloud&#39;</span>);
  } <span>catch</span> (error) {
    <span>console</span>.<span>log</span>(<span>&#39;Note saved locally, will sync later&#39;</span>);
  }
}


<span>async</span> <span>function</span> <span>getNotes</span>(<span></span>) {
  <span>const</span> result = <span>await</span> client.<span>execute</span>(
    <span>&#39;SELECT * FROM notes ORDER BY created_at DESC&#39;</span>,
  );
  <span>return</span> result.<span>rows</span>;
}
</code></pre>
<h3 id="rust"><a href="#rust">#</a><a aria-hidden="true" tabindex="-1" href="#rust"><span></span></a>Rust</h3>
<p>Make sure to install the latest libsql crate using Cargo:</p>
<pre><code>cargo add libsql
</code></pre>
<p>Here&#39;s how you can use it in your Rust applications</p>
<pre><code><span>use</span> libsql::{Builder, Database, ResultSet, params};
<span>use</span> std::env;

<span>async</span> <span>fn</span> <span>setup_db</span>() <span>-&gt;</span> <span>Result</span>&lt;Database, <span>Box</span>&lt;<span>dyn</span> std::error::Error&gt;&gt; {
    <span>let</span> <span>db_path</span> = env::<span>var</span>(<span>&#34;LOCAL_DB_PATH&#34;</span>).<span>unwrap_or</span>(<span>&#34;local.db&#34;</span>.<span>to_string</span>());
    <span>let</span> <span>sync_url</span> = env::<span>var</span>(<span>&#34;TURSO_SYNC_URL&#34;</span>).<span>expect</span>(<span>&#34;TURSO_SYNC_URL must be set&#34;</span>);
    <span>let</span> <span>auth_token</span> = env::<span>var</span>(<span>&#34;TURSO_AUTH_TOKEN&#34;</span>).<span>expect</span>(<span>&#34;TURSO_AUTH_TOKEN must be set&#34;</span>);

    
    <span>let</span> <span>db</span> = Builder::<span>new_synced_database</span>(db_path, sync_url, auth_token)
        .<span>build</span>()
        .<span>await</span>?;

    <span>let</span> <span>conn</span> = db.<span>connect</span>()?;
    conn.<span>execute</span>(
        <span>&#34;CREATE TABLE IF NOT EXISTS field_data (
            id INTEGER PRIMARY KEY,
            location TEXT,
            reading REAL,
            notes TEXT,
            timestamp TEXT
        )&#34;</span>,
        ()
    ).<span>await</span>?;

    <span>Ok</span>(db)
}

<span>async</span> <span>fn</span> <span>record_data</span>(db: &amp;Database, location: &amp;<span>str</span>, reading: <span>f64</span>, notes: &amp;<span>str</span>) <span>-&gt;</span> <span>Result</span>&lt;(), <span>Box</span>&lt;<span>dyn</span> std::error::Error&gt;&gt; {
    <span>let</span> <span>conn</span> = db.<span>connect</span>()?;

    
    conn.<span>execute</span>(
        <span>&#34;INSERT INTO field_data (location, reading, notes, timestamp)
         VALUES (?, ?, ?, datetime(&#39;now&#39;))&#34;</span>,
        params![location, reading, notes]
    ).<span>await</span>?;

    <span>println!</span>(<span>&#34;Data recorded locally&#34;</span>);

    
    <span>match</span> db.<span>sync</span>().<span>await</span> {
        <span>Ok</span>(_) =&gt; <span>println!</span>(<span>&#34;Data synchronized with central database&#34;</span>),
        <span>Err</span>(e) =&gt; <span>println!</span>(<span>&#34;Working offline - data will sync later: {}&#34;</span>, e),
    }

    <span>Ok</span>(())
}
</code></pre>
<h3 id="mobile-apps-with-expo"><a href="#mobile-apps-with-expo">#</a><a aria-hidden="true" tabindex="-1" href="#mobile-apps-with-expo"><span></span></a>Mobile Apps with Expo</h3>
<p>For those building local-first offline apps, Expo works great with Turso. You can get started with <a href="https://docs.expo.dev/versions/latest/sdk/sqlite/">expo-sqlite</a>:</p>
<pre><code>bunx create-expo-app -e with-libsql my-libsql-app
</code></pre>
<pre><code><span>import</span> { <span>SQLiteProvider</span>, useSQLiteContext } <span>from</span> <span>&#39;expo-sqlite&#39;</span>;

<span>export</span> <span>default</span> <span>function</span> <span>App</span>(<span></span>) {
  <span>return</span> (
    &lt;SQLiteProvider
      databaseName=&#34;local.db&#34;
      onInit={
        // Run some optional migration
      }
      options={{
        libSQLOptions: {
          url: &#39;...&#39;,
          authToken: &#39;...&#39;,
        },
      }}
    &gt;
      &lt;Main /&gt;
    &lt;/SQLiteProvider&gt;
  );
}

<span>function</span> <span>Main</span>(<span></span>) {
  <span>const</span> db = <span>useSQLiteContext</span>();

  <span>return</span> &lt;View&gt;{/* Your offline-first Expo app */}&lt;/View&gt;;
}
</code></pre>
<h2 id="what-s-next-"><a href="#what-s-next-">#</a><a aria-hidden="true" tabindex="-1" href="#whats-next"><span></span></a>What&#39;s next?</h2>
<p>With your support, we&#39;re working hard on the following features:</p>
<ul>
<li>Automatic and manual conflict resolution</li>
<li>Sync protocol bandwidth optimization</li>
<li>Encryption at rest</li>
</ul>
<p>You can follow the progress over <a href="https://github.com/tursodatabase/libsql/issues?q=state%3Aopen%20label%3A%22offline%20writes%22">on GitHub</a>.</p>
<h2 id="thank-you"><a href="#thank-you">#</a><a aria-hidden="true" tabindex="-1" href="#thank-you"><span></span></a>Thank you</h2>
<p>We want to extend our heartfelt gratitude to the Turso community members who participated in the private beta. Your feedback, bug reports, and feature suggestions have been invaluable in shaping this release.</p>
<p><strong>Turso Offline Sync is currently in beta quality, and not yet recommended for production use</strong>. During the beta period, there are no durability guarantees, which means data loss is possible.</p>
<p>Make sure to <a href="https://tur.so/discord">join us on Discord</a> to stay updated on what&#39;s new with the beta, and to provide feedback.</p></div></div>
  </body>
</html>
