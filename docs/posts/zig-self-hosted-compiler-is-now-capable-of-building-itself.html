<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ziglang/zig/pull/11442">Original</a>
    <h1>Zig self hosted compiler is now capable of building itself</h1>
    
    <div id="readability-page-1" class="page"><div>

      <div data-gid="PR_kwDOAmaRMs42TTCk" data-url="/ziglang/zig/pull/11442/partials/body" data-channel="eyJjIjoicHVsbF9yZXF1ZXN0OjkxMTAyODM4OCIsInQiOjE2NTAxNDczMjN9--23fb94d5d24597c98100885343f7da8d79a4a47cab4d47f10defb22257635611">

<p><a href="https://github.com/Vexu" data-view-component="true">
  <img data-hovercard-type="user" data-hovercard-url="/users/Vexu/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" src="https://avatars.githubusercontent.com/u/15308111?s=60&amp;v=4" alt="Vexu" size="40" height="40" width="40" data-view-component="true"/>
  
</a>
  
  
</p><div id="issue-1205785389">
  <div id="pullrequest-911028388">
          

          <div>
        <div>
  
  <task-lists disabled="" sortable="">
    <div>
      <div data-snippet-clipboard-copy-content="$ zig build -Denable-llvm
$ zig2 build -p build-stage3
$ cat a.zig
const std = @import(&#34;std&#34;);
pub fn main() void {
    const stderr = std.io.getStdErr();
    stderr.writeAll(&#34;Hello, world!\n&#34;) catch {};
}
$ build-stage3/bin/zig run a.zig
Hello, world!"><pre>$ <span>zig build -Denable-llvm</span>
$ <span>zig2 build -p build-stage3</span>
$ <span>cat a.zig</span>
<span>const std = @import(&#34;std&#34;);</span>
<span>pub fn main() void {</span>
<span>    const stderr = std.io.getStdErr();</span>
<span>    stderr.writeAll(&#34;Hello, world!\n&#34;) catch {};</span>
<span>}</span>
$ <span>build-stage3/bin/zig run a.zig</span>
<span>Hello, world!</span></pre></div>
<p dir="auto">LLVM backend needs some adjustments still.</p>
<p dir="auto"><span aria-label="This pull request closes issue #11375.">Closes</span> <a data-error-text="Failed to load title" data-id="1190331624" data-permission-text="Title is private" data-url="https://github.com/ziglang/zig/issues/11375" data-hovercard-type="issue" data-hovercard-url="/ziglang/zig/issues/11375/hovercard" href="https://github.com/ziglang/zig/issues/11375">#11375</a></p>
    </div>
  </task-lists>
  
</div>

      </div>

          
          

</div>
  </div>
</div>

       
            


      <div data-gid="C_kwDOC2sY-NoAKDdiZTYyZjY5NWZmYjQ2OGUxOTI0MWE1NjRkNTQ0ZDZhMGFkYWI4Mjk">
  
        <div>
      <div data-test-selector="pr-timeline-commits-list">
      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div>
  <div>
    <div>
      
<div>
  <p><a data-skip-pjax="true" data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/Vexu/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Vexu">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/15308111?s=40&amp;v=4" width="20" height="20" alt="@Vexu"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
</div>

</div>
</div>      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div>
  <div>
    <div>
      
<div>
  <p><a data-skip-pjax="true" data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/Vexu/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Vexu">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/15308111?s=40&amp;v=4" width="20" height="20" alt="@Vexu"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
</div>

</div>
</div>  </div>
</div>


</div>

      

      <div data-gid="C_kwDOC2sY-NoAKDEwMWFhYzkyYzI1OGFmOWYyNTUyMGMzNmYwNmIyY2U4MzM1ZDdmOWE">
  
        <div>
  <div data-test-selector="pr-timeline-commits-list">
      <div data-view-component="true">
  
  
  <div data-view-component="true">          <div>
  <div>
    <div>
      
<div>
  <p><a data-skip-pjax="true" data-test-selector="commits-avatar-stack-avatar-link" data-hovercard-type="user" data-hovercard-url="/users/Vexu/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Vexu">
        <img data-test-selector="commits-avatar-stack-avatar-image" src="https://avatars.githubusercontent.com/u/15308111?s=40&amp;v=4" width="20" height="20" alt="@Vexu"/>
</a>  </p>
</div>

      

      

      

      
    </div>
  </div>
</div>

</div>
</div>  </div>
</div>


</div>

      <div data-gid="IC_kwDOAmaRMs5BlorW">
  
      
<div data-gid="IC_kwDOAmaRMs5BlorW" data-url="/ziglang/zig/comments/IC_kwDOAmaRMs5BlorW/partials/timeline_issue_comment">

  <p><a data-hovercard-type="user" data-hovercard-url="/users/Vexu/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Vexu"><img height="40" width="40" alt="@Vexu" src="https://avatars.githubusercontent.com/u/15308111?s=88&amp;v=4"/></a>

</p>


  <div id="issuecomment-1100384982">
    <div data-body-version="bd17c06a03ab2fa5eabd902fbc95709e679157fc4389f44b1d76507e40abac6c">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <p dir="auto">Recursion:</p>
<div data-snippet-clipboard-copy-content="$ cd build
$ cmake .. -DZIG_PREFER_CLANG_CPP_DYLIB=ON -DZIG_OMIT_STAGE2=on -DCMAKE_BUILD_TYPE=Release
-- Configuring zig version 0.10.0-dev.1825+101aac92c
-- Configuring done
-- Generating done
-- Build files have been written to: /home/vexu/Documents/zig/zig/build
$ make -s -j 12
Consolidate compiler generated dependencies of target opt_c_util
Consolidate compiler generated dependencies of target zigcpp
Consolidate compiler generated dependencies of target embedded_softfloat
[  1%] Built target opt_c_util
[  5%] Built target zigcpp
[ 86%] Built target embedded_softfloat
Consolidate compiler generated dependencies of target zigstage1
[ 98%] Built target zigstage1
Consolidate compiler generated dependencies of target zig0
[ 99%] Building CXX object CMakeFiles/zig0.dir/src/stage1/zig0.cpp.o
[ 99%] Linking CXX executable zig0
[ 99%] Built target zig0
[ 99%] Building self-hosted component /home/vexu/Documents/zig/zig/build/zig1.o
Consolidate compiler generated dependencies of target zig
[ 99%] Linking CXX executable zig
[100%] Built target zig
$ cd ..
$ build/zig build -p build-stage2 -Denable-llvm -Dconfig_h=build/config.h
$ build-stage2/bin/zig build -p build-stage3 -Denable-llvm -Dconfig_h=build/config.h
$ build-stage3/bin/zig build -p build-stage4 -Denable-llvm -Dconfig_h=build/config.h
$ "><pre>$ <span><span>cd</span> build</span>
$ <span>cmake .. -DZIG_PREFER_CLANG_CPP_DYLIB=ON -DZIG_OMIT_STAGE2=on -DCMAKE_BUILD_TYPE=Release</span>
<span>-- Configuring zig version 0.10.0-dev.1825+101aac92c</span>
<span>-- Configuring done</span>
<span>-- Generating done</span>
<span>-- Build files have been written to: /home/vexu/Documents/zig/zig/build</span>
$ <span>make -s -j 12</span>
<span>Consolidate compiler generated dependencies of target opt_c_util</span>
<span>Consolidate compiler generated dependencies of target zigcpp</span>
<span>Consolidate compiler generated dependencies of target embedded_softfloat</span>
<span>[  1%] Built target opt_c_util</span>
<span>[  5%] Built target zigcpp</span>
<span>[ 86%] Built target embedded_softfloat</span>
<span>Consolidate compiler generated dependencies of target zigstage1</span>
<span>[ 98%] Built target zigstage1</span>
<span>Consolidate compiler generated dependencies of target zig0</span>
<span>[ 99%] Building CXX object CMakeFiles/zig0.dir/src/stage1/zig0.cpp.o</span>
<span>[ 99%] Linking CXX executable zig0</span>
<span>[ 99%] Built target zig0</span>
<span>[ 99%] Building self-hosted component /home/vexu/Documents/zig/zig/build/zig1.o</span>
<span>Consolidate compiler generated dependencies of target zig</span>
<span>[ 99%] Linking CXX executable zig</span>
<span>[100%] Built target zig</span>
$ <span><span>cd</span> ..</span>
$ <span>build/zig build -p build-stage2 -Denable-llvm -Dconfig_h=build/config.h</span>
$ <span>build-stage2/bin/zig build -p build-stage3 -Denable-llvm -Dconfig_h=build/config.h</span>
$ <span>build-stage3/bin/zig build -p build-stage4 -Denable-llvm -Dconfig_h=build/config.h</span>
$ </pre></div>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>

</div>


</div>


      <div data-gid="IC_kwDOAmaRMs5BlqEU">
  
      
<div data-gid="IC_kwDOAmaRMs5BlqEU" data-url="/ziglang/zig/comments/IC_kwDOAmaRMs5BlqEU/partials/timeline_issue_comment">

  <p><a data-hovercard-type="user" data-hovercard-url="/users/Snektron/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/Snektron"><img height="40" width="40" alt="@Snektron" src="https://avatars.githubusercontent.com/u/5640649?s=88&amp;u=1ecbb701e2a1d3926fa884381e8e1fc0b21e2e58&amp;v=4"/></a>

</p>


  <div id="issuecomment-1100390676">
    <div data-body-version="01e423d7024572acdb166d8f40ecbb27b222b635471908f4104cd0d5de40b0ae">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <p dir="auto">Whats the time difference between the stage 2 and stage 3 build?</p>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>

</div>


</div>


      <div data-gid="IC_kwDOAmaRMs5BmhNl">
  
      
<div data-gid="IC_kwDOAmaRMs5BmhNl" data-url="/ziglang/zig/comments/IC_kwDOAmaRMs5BmhNl/partials/timeline_issue_comment">

  <p><a data-hovercard-type="user" data-hovercard-url="/users/andrewrk/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/andrewrk"><img height="40" width="40" alt="@andrewrk" src="https://avatars.githubusercontent.com/u/106511?s=88&amp;u=c5381a852bb5385fb4380496a39ab46106b2b6dd&amp;v=4"/></a>

</p>


  <div id="issuecomment-1100616549">
    <div data-body-version="fa327f71e6208f24cf3b507e32564978bcff952986927c9ee643e9a8033196b3">

      



      <div>

        
<task-lists disabled="" sortable="">
<div>
          <blockquote>
<p dir="auto">Whats the time difference between the stage 2 and stage 3 build?</p>
</blockquote>
<p dir="auto">I took one measurement on my computer:</p>
<div data-snippet-clipboard-copy-content="stage1 (release) build stage2 (debug) (LLVM backend):
 * wall clock: 47.80 seconds
 * peak rss: 8.6 GiB

stage2 (release) build stage3 (debug) (LLVM backend):
 * wall clock: 43.26 seconds
 * peak rss: 2.3 GiB"><pre><code>stage1 (release) build stage2 (debug) (LLVM backend):
 * wall clock: 47.80 seconds
 * peak rss: 8.6 GiB

stage2 (release) build stage3 (debug) (LLVM backend):
 * wall clock: 43.26 seconds
 * peak rss: 2.3 GiB
</code></pre></div>
<p dir="auto">While a 10% speedup is no joke, keep in mind this is only the beginning of a set of upcoming compiler milestones, each successively improving compilation speed. I talked about this at the Milan meetup last weekend and <a data-hovercard-type="user" data-hovercard-url="/users/kristoff-it/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/kristoff-it">@kristoff-it</a> will be posting the recordings soon.</p>
<p dir="auto">Edit: here it is! <a href="https://www.youtube.com/watch?v=AqDdWEiSwMM" rel="nofollow">https://www.youtube.com/watch?v=AqDdWEiSwMM</a></p>
      </div>
</task-lists>


          
      </div>

      <!-- '"` --><!-- </textarea></xmp> -->    </div>
</div>

</div>


</div>


      





  <!-- Rendered timeline since 2022-04-16 03:51:06 -->
  



    </div></div>
  </body>
</html>
