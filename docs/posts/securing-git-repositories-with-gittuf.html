<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lwn.net/SubscriberLink/972467/595a68b99f57a87d/">Original</a>
    <h1>Securing Git Repositories with Gittuf</h1>
    
    <div id="readability-page-1" class="page"><div>
<!-- $Id: slink-trial,v 1.1 2005-11-04 21:27:01 corbet Exp $ -->
<center>
<table>
<tbody><tr><td>
<h3>Welcome to LWN.net</h3>
<p>
The following subscription-only content has been made available to you 
by an LWN subscriber.  Thousands of subscribers depend on LWN for the 
best news from the Linux and free software communities.  If you enjoy this 
article, please consider accepting the trial offer on the right.  Thank you
for visiting LWN.net!
</p></td><td>
<div>
<h3>Free trial subscription</h3>
           <p>
           Try LWN for free for 1 month: no payment
           or credit card required.  <a href="https://lwn.net/Promo/slink-trial2-3/claim">Activate
           your trial subscription now</a> and see why thousands of
           readers subscribe to LWN.net.
           
</p></div>
</td>
</tr>

</tbody></table>
</center>

<p>The so-called software supply chain starts with source code. But most security measures and tooling
don&#39;t kick in until source is turned into an artifactâ€”a source
tarball, binary build, container image, or other method of delivering a
release to users. The <a href="https://gittuf.dev/">gittuf</a> project
is an attempt to provide a security layer for <a href="https://git-scm.com/">Git</a> that can handle key management,
enforce security policies for repositories, and guard against attacks
at the version-control layer. At Open Source Summit North America (OSSNA), Aditya Sirish A
Yelgundhalli and Billy Lynch <a href="https://ossna2024.sched.com/event/1aBPF/securing-git-repositories-with-gittuf-aditya-sirish-a-yelgundhalli-new-york-university-billy-lynch-chainguard">presented</a>
an introduction to gittuf with an overview of its goals and
status.</p>

<p><a href="https://lwn.net/Articles/972717/">
<img src="https://static.lwn.net/images/conf/2024/ossna/billy-lynch-sm.png" alt="[Billy
Lynch]" title="Billy Lynch"/></a></p><p>Lynch began the talk with an overview of the state of the
world for security tools. He observed that there are many tools used
to generate provenance and attestation documents for artifacts, as well as tools
to address threats against software at run time. &#34;But we don&#39;t often talk about the
very first part of this. How do we start securing our source code and
source repositories [...] where everything originates?&#34;</p>

<p>More and more frequently, he said, organizations are pulling source
directly into continuous-integration / continuous-delivery (CI/CD) pipelines without the kind of protections we have
for, say, container images or software packages. But a compromise in
the repository itself could snowball into a compromise of everything
built from the source code. &#34;So it&#39;s equally important to protect and
[use] all the same protection mechanisms&#34; for repositories.</p>

<p>Different projects will need different policies, so there needs to be a way to
define policies for common scenarios. For example, Lynch said that projects may want
to enforce a policy that requires code to be reviewed and pass CI
before being merged into a main branch. Applying a tag to the repository might require more
stringent policies, since they often correspond with releases and
things people are most likely to use. For organizations that have a <a href="https://en.wikipedia.org/wiki/Monorepo">monorepo</a>, it might
be necessary to have a folder-level policy to ensure that certain
teams or people review and approve changes to specific parts of the
repository.</p>

<h4>Current state</h4>

<p>Git, today, does not provide these features. Lynch pointed
out that Git has &#34;some amount of integrity checks&#34; as well as commit
and tag signing, but it is &#34;fairly simple&#34; overall. There are many
other operations on Git repositories that need validation beyond what
Git provides on its own.</p>

<p>The various <a href="https://en.wikipedia.org/wiki/Forge_(software)">forges</a> may
layer additional features on top of Git, including security features such as
protected branches. But these, he said, &#34;are forge-specific features
and not actually part of the repository&#34;. Even if a project or
organization uses one of the forges exclusively, the question becomes
&#34;is that enough?&#34;</p>

<blockquote>
Especially when it comes to security metadata you know it&#39;s very nice
to be able to say &#34;hey, if we have a commit we can associate that 
with a pull request but how do we actually know that that pull request has
gone through all the checks?&#34; And, more importantly, how do we know six months
down the line, a year down the line, how can we look back and verify
and ensure that all of those checks have happened in the past? Sometimes
that can be very difficult.
</blockquote>

<p>Even when a forge like GitHub provides more information about how
teams have interacted with a repository, that information may not be
visible to people outside the organization. Ideally, he said, &#34;we want
to get to a state where anyone can verify this metadata&#34;. Perhaps just
as importantly, how do users verify that policies were enforced for a
repository without taking a forge&#39;s word for it? This led to
thinking about &#34;what sort of security properties do we care about, or
might people care about, when consuming Git repositories?&#34;</p>

<h4>Goals</h4>

<p>Next Lynch moved into a discussion of security goals that have guided the 
project. First, verification that policies have been
followed should be possible by any party, and not just members of an
organization or users of specific Git forges. It should also be
possible to verify the state of the repository at any point in its
development. &#34;It shouldn&#39;t just be what is latest, we should be able
to go back even to the first commit, ideally.&#34;</p>

<p>Signing-key distribution is another hard problem that the project hopes to
solve. How do users make sure they&#39;re getting the right keys, or which
keys they should be checking against? On top of that, &#34;how do we
rotate and revoke keys?&#34;</p>

<p>Of course, a security tool needs to be flexible and has to prevent
the possibility of internal threats. Lynch said that
feature branches might have more lax policies, while main and release
branches have stricter policies that require multi-user
signoffs to account for possible insider attacks. &#34;We want to make
sure that you know whenever a security policy changes, multiple people
have to sign off on it. Even if one account is compromised, it&#39;s
harder to compromise the entire repository.&#34;</p>

<p>Finally, any tool that works on top of Git is going to need to
provide backward compatibility. &#34;If somebody is using more security
tools on top of an existing repo, that shouldn&#39;t break the workflow of
everyone else using that repo.&#34; It has to be possible to adopt
stricter security policies &#34;in an incremental way, without having to
completely annihilate the history of the repo and all the metadata&#34;
prior to using the new tool. All of those goals, Lynch said, brought
them to the idea behind gittuf. Here, he handed the talk over to Yelgundhalli, to talk about
the project and the implementation so far.</p>

<h4>Gittuf</h4>

<p>Yelgundhalli said that gittuf takes concepts from
<a href="https://theupdateframework.io/">The Update Framework</a>
(TUF), a Cloud Native Computing Foundation (CNCF) project that
provides a specification for securing software-update systems. &#34;It
gets a lot of things right in [the] context of handling key distribution,
rotation, and revocation&#34; as well as providing a model for
delegating trust from one user to another.</p>

<p><a href="https://lwn.net/Articles/972717/#aditya">
<img src="https://static.lwn.net/images/conf/2024/ossna/Aditya-Yelgundahalli-sm.png" alt="[Aditya Sirish A Yelgundhalli]" title="Aditya Sirish A Yelgundhalli"/></a></p><p>Another important concept for gittuf is the reference state log
(RSL). This idea comes from a 2016 <a href="https://www.usenix.org/system/files/conference/usenixsecurity16/sec16_paper_torres-arias.pdf">paper</a>
on preventing Git metadata tampering. The RSL is similar to the Git <a href="https://git-scm.com/docs/git-reflog">reflog</a>, but &#34;actually
embedded in the repository&#34; and &#34;authenticated using signatures on
each individual entry&#34;. These are implemented in gittuf using a custom
git <a href="https://git-scm.com/docs/gitnamespaces">namespace</a>. The RSL
is stored under <tt>refs/gittuf/reference-state-log</tt> and the
policy metadata is stored under <tt>refs/gittuf/policy</tt>. Every
time a reference state changes in Git, new entries are added in these
logs. This means that the RSL records not only &#34;the main branch went
from commit A to commit B&#34; but also when owners of a repository update
policies.</p>

<p>Git servers need not be aware of gittuf, since its metadata is stored
under the custom namespace. If the
server is gittuf-enabled, then it can perform verification on a change
when is pushed to the server. &#34;This is great because now
you have the ability to reject changes from making their way to other
clients&#34; even if those clients aren&#39;t using gittuf. But if they are,
&#34;they get the changes on the branch as well as the signed statement&#34;
of changes that they can verify.</p>

<p>Gittuf is using the <a href="https://in-toto.io/in-toto/">in-toto</a> project to provide
attestations, which allows a project to make claims about the
software. For example, he said that Git only allows a commit to be
&#34;meaningfully&#34; signed by a single person, but using in-toto it is
possible to record multiple signatures. It would also be useful for
answering other questions like &#34;did this test run, and pass&#34; or other
policy questions that are not covered by Git itself or even Git forges. The
project is also considering how it can authenticate users who are not
using gittuf, so that they are still able record evidence that they
have authenticated.</p>

<p>Ultimately, Yelgundhalli said that step one in a project&#39;s or
organization&#39;s security policy could be to require source code to have
an attestation from gittuf to verify that it has followed policies and
is suitable to be &#34;plugged into other parts of our supply chain&#34;. As a
CI pipeline receives changes to source code, it could inspect each
change to ensure that it meets policy.</p>

<p>With the basics of gittuf covered, Yelgundhalli moved on to a short
demo of the tool. This included using <tt><a href="https://github.com/gittuf/gittuf/blob/main/docs/cli/gittuf.md">gittuf</a></tt> to <a href="https://github.com/gittuf/gittuf/blob/main/docs/cli/gittuf_policy_list-rules.md">list policy
rules</a> for the main branch of a repository that requires two authorized
signatures to push to the branch, and demonstrating what happens when
a commit meets or violates that policy.</p>

<p>As expected, if a commit has the two required signatures,
<tt>gittuf</tt> reports success. If not, the <tt>gittuf</tt>
command-line tool will emit an error. The
demo also illustrated that using gittuf adds several steps to the
process to record and commit the reference log. For those who would like
to follow along at home, the project provides a <a href="https://github.com/gittuf/demo">demo
repository</a> to test out gittuf.</p>

<h4>What&#39;s next</h4>

<p>After the demo, Lynch took the lead again to talk about the status
of gittuf and its roadmap. Currently it is considered alpha status.
The project has &#34;only just joined&#34; the <a href="https://openssf.org/">OpenSSF</a>
as a sandbox project in the <a href="https://github.com/ossf/wg-supply-chain-integrity">Supply Chain
Integrity Working Group</a>. So far, the project has been focused on
functionality but making it easier to use is on the agenda as
well:

</p><blockquote>
There&#39;s all these multiple refs that we have to worry about,
ideally that should just be one command, and ideally that should have
command compatibility with existing Git commands so you don&#39;t really
have to think about it.
</blockquote>

<p>He said that the project is looking at &#34;things like repository
hooks&#34; to help automate gittuf operations &#34;so you can just use your
normal Git workflow&#34;. Another feature that Lynch mentioned for the
future is <a href="https://people.kernel.org/monsieuricon/signed-git-pushes">signed
pushes</a>, but he said that &#34;is not the top priority&#34; because it is
not yet supported by any of the Git forges. The project also has a <a href="https://github.com/gittuf/gittuf/blob/main/docs/roadmap.md">roadmap</a>
that mentions a number of interesting features planned for
gittuf. This includes adding support for roles and teams, so that
policies can require things like &#34;a change must be signed off by two
members of a development team and one member of a security team&#34;. And,
of course, the project should &#34;dogfood&#34; itself by using gittuf to
protect the project&#39;s source code thus demonstrating its viability for
use with other projects.</p>

<p>During the Q&amp;A an attendee asked about Kubernetes CI. The
audience member said that CI for the project cost &#34;between $100,000
and $200,000 a month&#34;; they wondered whether gittuf could allow
developers to run CI tests locally and just submit proof that they had been
run to save on costs. Yelgundhalli said that it is &#34;something we&#39;ve
been talking about but it&#39;s early days&#34;. Actually collecting proof
that CI jobs had run would involve a lot of moving parts, but it would
be possible to allow developers to attest that they had run the jobs
locally if a project is willing to extend trust that far.</p>

<p>Even though gittuf is not yet ready for prime time, the tool and
thinking behind it show a lot of promise. If the project can build out
the planned functionality and improve usability, it may well find its
way into securing source code for many projects and
organizations. (The <a href="https://www.youtube.com/watch?v=eCSeIEdMbCw">video of the talk</a> is available on the Linux
Foundatoin&#39;s YouTube channel.)</p>

<p>[Thanks to the Linux Foundation, LWN&#39;s travel sponsor, for supporting our travel to this event.]</p>

</div></div>
  </body>
</html>
