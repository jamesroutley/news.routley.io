<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://talesofsyn.com/posts/creating-isometric-rpg-game-backgrounds">Original</a>
    <h1>Using Stable Diffusion techniques to create 2D game environments</h1>
    
    <div id="readability-page-1" class="page"><div><div class="page"><p><span><img alt="Creating Isometric RPG Game Backgrounds" sizes="100vw" srcset="/_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=640&amp;q=80 640w, /_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=750&amp;q=80 750w, /_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=828&amp;q=80 828w, /_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=1080&amp;q=80 1080w, /_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=1200&amp;q=80 1200w, /_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=1920&amp;q=80 1920w, /_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=2048&amp;q=80 2048w, /_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=3840&amp;q=80 3840w" src="https://talesofsyn.com/_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F6fc853e0-4524-4e47-89b8-c8fc55cba56c%2Fimages%2Fc7956659-472b-4c7c-9747-0c2eaecabb8b.webp&amp;w=3840&amp;q=80" decoding="async" data-nimg="fill"/></span></p></div><div><article id="block-posts-creating-isometric-rpg-game-backgrounds"><div><div><p><span>Written by</span></p><p><span><span><span><span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fixed"/></span><span>Hackmans</span></span></span></span></p></div><div><p><span>Date published</span></p><p><span><span><span><span>February 24, 2023</span></span></span></span></p></div></div><blockquote id="block-da36df6c80524223ba758feb59d95e01"><span><span>Using Stable Diffusion techniques to create 2D game environments </span></span></blockquote><div id="block-dbbc3a8d22874e97ab6fc3258ac61d8a"><div><picture><img src="https://notion.so/icons/wrench_red.svg" alt="icon" width="60" height="24" layout="fixed" objectfit="contain" objectposition="center" loading="lazy"/></picture></div><div><p><span><span><strong>Tools and Techniques Used</strong></span></span></p><ul><li id="block-e89f1ef5742748c4a62bfee1ea1f5c1b"><span><span>Stable Diffusion v1.5</span></span></li><li id="block-dafc7489d8d54350b9b89f5e07bc5a5a"><span><span>Automatic1111 WebUI</span></span></li><li id="block-3f812640deea4339b84018a121d22513"><span><span>Alpaca Photoshop Plugin</span></span></li><li id="block-c9723277c5864e87ba120fcc18098420"><span><span>Boosting Monocular Depth</span></span></li><li id="block-e394c1ec36a64be086b251f36e75b670"><span><span>Substance Designer</span></span></li><li id="block-1e8e906b9ca0400fab76e20d1df66690"><span><span>Unity URP</span></span></li><li id="block-e6921fa962fe469fbbea9d7db719f974"><span><span>Amplify Shader Editor</span></span></li></ul></div></div><p><span><span>Whilst exploring ways of generating isometric backgrounds, I came across a post by </span><span><strong><strong>Ivan Garcia Filho </strong></strong></span><span>showing game assets created with a Stable Diffusion based platform using a detailed prompt and high step count.</span></span></p><blockquote id="block-977c0326b3fb416f8adf10ff575873bf"><span><span>An intricate modular top-down isometric concept art with PBR materials of a victorian gothic ornated steampunk lamp, in ominous hellish industrial mood and a neat and clean composition with sharp precisely stabilized straight lines, colorful tone mapped cinematic volumetric lighting and global illumination producing shinning edge reflections and detailed ambient occlusion with smooth cold shadows and hot highlights increasing depth and perspective</span></span></blockquote><p><span><span>I started testing some prompts using the same structure but changing the content and the style modifiers to see what sort of futuristic / cyberpunk elements it could generate and get a feel for how the prompt was working.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>Early results weren’t great but that was due to using a lower step count, which I didn’t think would be necessary but makes a huge difference here. Bumping up the steps into the </span><span><strong>100s</strong></span><span> and a higher </span><span><strong>CFG of 15-30</strong></span><span> snapped it into more interesting results.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>I really liked the style of the open style building section, so I carried on iterating through ranges of steps and CFG with </span><span><a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui/wiki/Features#xyz-plot" target="_blank" rel="noopener noreferrer">X/Y Plot</a></span><span> in </span><span><strong>Automatic1111 WebUI</strong></span><span> using the same prompt.</span></span></p><blockquote id="block-37874ce5cea64de39cd0319f2c290f32"><span><span>An intricate modular top-down isometric concept art with PBR materials of a cyberpunk building, in ominous hellish industrial mood and a neat and clean composition with sharp precisely stabilized straight lines, colorful tone mapped cinematic volumetric lighting and global illumination producing shinning edge reflections and detailed ambient occlusion with smooth cold shadows and hot highlights increasing depth and perspective</span></span></blockquote><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>The almost infinite nature of Stable Diffusion generations can make it difficult to settle on a particular output. Early on I used to experience a lot of FOMO, feeling like I had missed the perfect seed or setting, but doing X/Y plots and being brutal about curation has helped me get to a desired result quicker over time. I chose </span><span><strong>CFG 16</strong></span><span> and iterated through steps and hit a great result at </span><span><strong>100</strong></span><span>.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>I mainly work in </span><span><strong>Photoshop</strong></span><span> for editing and cleaning up generated images and have been beta testing the </span><span><strong>Alpaca</strong></span><span> Stable Diffusion plugin, which allows me to to continue working in a familiar environment whilst accessing features like </span><span><strong>inpainting</strong></span><span> and </span><span><strong>img2img</strong></span><span>.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>I placed the building image onto a larger canvas and used outpainting to extend the rest of the building and some more of the walkway using the same prompt.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>I cleaned up the background and ran the final image through img2img at double resolution to get more details. </span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>One of my ideas for using the backgrounds in Unity game engine, was to remove the lighting from the image and then add it back in using custom shaders. I achieved this by painting out the strong colors in Photoshop, using a new layer set to </span><span><strong>color blending mode</strong></span><span> and neutral grey colors sampled from the original image.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>In order to get my own lighting I needed to create a normal map for the 2D scene. Rather than hand painting it (which is an option) I tried automating the process using </span><span><strong>MiDaS</strong></span><span> and </span><span><strong>LeRes</strong></span><span> in </span><span><strong>Boosting Monocular Depth</strong></span><span> to generate depth maps of the image.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>I brought the MiDaS depth map and (inverted) LeRes depth map images into Substance Designer to use the </span><span><a href="https://substance3d.adobe.com/documentation/sddoc/height-to-normal-world-units-159450573.html" target="_blank" rel="noopener noreferrer">Height to Normal World Units</a></span><span> node to generate normal maps and then combined them both using </span><span><a href="https://substance3d.adobe.com/documentation/sddoc/normal-blend-159450576.html" target="_blank" rel="noopener noreferrer">Normal Blend</a></span><span> node since individually they roughly represent large and small detail information.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>The resulting normal map is far from perfect but sufficient enough for my testing. I masked out the background in Photoshop and filled it with the base normal vector value </span><span><strong>RGB(128, 128, 255) </strong></span><span>or</span><span><strong> #8080FF</strong></span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>Here is how the scene looks in Unity using the delit image as the base color and the normal map for the background material on a 3D plane, and two colored point lights in 3D space. The lighting wraps around surfaces in an almost convincing way in some places and makes a crude illusion of scene lighting.</span></span></p><p><span><span>I tried a few different techniques using the depth and normal maps in a custom Unity URP shader I created in </span><span><strong>Amplify Shader Editor</strong></span><span>. I used the depth map to try </span><span><a href="https://wiki.amplify.pt/index.php?title=Unity_Products:Amplify_Shader_Editor/Parallax_Occlusion_Mapping" target="_blank" rel="noopener noreferrer">Parallax Occlusion Mapping</a></span><span> to add some subtle fake 3D perspective to the camera movement but it looked pretty bad since the depth is incorrect for the isometric view.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>I created an implementation of </span><span><strong>Normal Mapping Shadows </strong></span><span>which enabled me to have shadows cast by the 2D scene from the sun directional light. Though the effect added some interesting visual qualities to the scene it is not great for representing actual lighting, but could potentially be used as a custom lighting pass to shade 3D characters.</span></span></p><p><span><span>For the main alleyway environment featured in the video at the top of the page, I followed the same methods of iterating through XY plots of an alleyway prompt until I had a starting point I was happy with.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><p><span><span>I mirrored the image and placed it into a </span><span><strong>2048x2048</strong></span><span> canvas in Photoshop then used the </span><span><strong>Alpaca </strong></span><span>plugin to outpaint the rest of the environment using the same prompt but slightly altering the wording from alleyway to building or street etc to guide the content that was being generated. For each new section I picked my favourite option from 5 possible generations.</span></span></p><p><span><span>Upscaling is often a tricky process which I like to handle in stages. For this 2K image I divided into quarters and ran them through img2img at double resolution with the same initial prompt. Then due to inconsistencies between </span><span><span>quarters</span></span><span>, I repeated the same process for the </span><span><span>overlapping seam areas</span></span><span> and the </span><span><span>center</span></span><span> and composited them together in Photoshop using masks to blend each area and produce a seamless final 4K image.</span></span></p><p><span><span></span><img alt="image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive"/></span></p><div id="block-5a9aee5cad3745d985d63a5f99da7256"><div><picture><img src="https://notion.so/icons/thought-dialogue_red.svg" alt="icon" width="60" height="24" layout="fixed" objectfit="contain" objectposition="center" loading="lazy"/></picture></div><div><p><span><span>Process Review</span></span></p><p><span><span>I am quite happy with the look of the backgrounds, though I would definitely like more control over the scene content which could be enabled with future techniques. Some of the testing didn’t result in usable content and there are areas for improvement:</span></span></p><ul><li id="block-360bab2d641c472a9dccf6a1a74c4a64"><span><span>Explore new methods of guiding the scene content</span></span></li><li id="block-f5e126da9740417eb71a9d5e4eebd3fe"><span><span>Find ways to increase style consistency of different types of locations</span></span></li><li id="block-535ea7bd48eb40ed804bb792da681529"><span><span>Develop better shader techniques for creating pseudo 3D effects from 2D backgrounds</span></span></li><li id="block-093e5bb687e345ac971aee23d31e4e87"><span><span>Train a custom model for generating Normal Maps from backgrounds</span></span></li></ul></div></div><h3 id="block-8305508e97ac4027b0d1c3978719b27c"><span id="8305508e97ac4027b0d1c3978719b27c"></span><span><span>More posts like this</span></span></h3></article></div></div></div>
  </body>
</html>
