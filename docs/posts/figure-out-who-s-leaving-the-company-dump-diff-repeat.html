<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2024/02/08/ldap/">Original</a>
    <h1>Figure out who&#39;s leaving the company: dump, diff, repeat</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>
One common element of the larger places where I&#39;ve worked is that they 
tend to have a directory service of some sort that keeps track of who&#39;s 
an employee and who isn&#39;t.  You can learn some interesting things by 
periodically dumping that list and then running comparisons against the 
previous dump.
</p>
<p>
A certain company had this rolled up into an internal service called 
&#34;epitaphs&#34; where an entry for a person would appear a day or two after 
they &#34;disappeared from LDAP&#34; - meaning, they left the company.  Then 
other people who still worked there could add comments like &#34;went back 
to school&#34;, &#34;moved to Idaho to raise sheep&#34;, that kind of thing.
</p>
<p>
This had an interesting side-effect that you couldn&#39;t write to your own 
&#34;epitaph&#34; because by definition you had to already be gone from the 
company for your page to exist.  Someone else who knew you had to add 
it.  I actually received an e-mail to that effect one time: &#34;I&#39;m 
leaving, so when it shows up, please add XYZ&#34;.  I was pleased that they 
trusted me to do that, and a few days later, I pasted it in as 
requested.
</p>
<p>
Another place I worked didn&#39;t have anything quite like this.  There was 
the &#34;internal profile&#34; where you could see that so and so worked at the 
company from &lt;date&gt; to &lt;date&gt;, but there wasn&#39;t any sort of periodic 
update available.  I decided to roll my own.  It didn&#39;t take much in the 
way of effort, really.  A cron job on my dev server (a physical box in a 
datacenter with access to my home directory) woke up a couple of times 
every day and dumped the entire list to a file.  Then it compared it to 
the last one, crunched it down to just the uid (unix account name) 
field, and appended the results to a log file.
</p>
<p>
Over time, various other people learned about this, and since I had left 
it world-readable, they were able to leave up a &#34;tail -f &lt;path&gt;&#34; to keep 
tabs on it, and sometimes something surprising would show up during the 
day.  People would sometimes just vanish.  Other times, there were 
bizarre things going on that added a bit of context.
</p>
<p>
The log entries looked like this:
</p>
<pre>Thu Feb 08 18:26:42 PST 2024 : uid: &lt;someone&gt;
</pre>
<p>
That was enough to let you go digging and find out more if you actually 
gave a damn about why that particular person no longer worked there.  
Otherwise, it didn&#39;t flood you with useless data.
</p>
<p>
One time, I pasted in a line like that into an IRC channel and that 
&lt;someone&gt; popped up and said &#34;yeah, I don&#39;t work here any more&#34;.  It 
turned out their account had been deactivated, but they still had a 
client connected.  When I mentioned their account name, they got a 
notification, flipped to that window, and replied.  We had a few minutes 
to chat about it.
</p>
<p>
It was weird saying farewell to someone that way.  Normally, the 
electronic lines of communication are severed early on.  I think what 
happened here is that the IRC servers only checked auth at connect-time, 
and then nothing went back to make sure that sessions remained 
associated with current employees.  (It&#39;s a bit of a hard problem.)
</p>
<p>
Another time, some manager type said they were going to be late for a 
meeting because of some &#34;dumb manager thing&#34; they had to do.  Sure 
enough, a few minutes into that meeting, a line scrolled across showing 
the deactivation of an account of one of their direct reports.  
Obviously, they had to go into one of those HR meetings where they 
showed someone the door.
</p>
<p>
I&#39;d say the best time to start doing this is when you start at a 
company, or when that company grows big enough to actually have LDAP or 
whatever.  That means the second-best time would be today.
</p>
<p>
Incidentally, the &#39;comm&#39; tool is great for this sort of thing.
</p>
<pre>comm -2 -3 &lt;(grep ^uid: old | sort) &lt;(grep ^uid: new | sort)
</pre>
<p>
... and there you go.
</p>
<p>
Now, this sort of thing is not perfect.  If you don&#39;t catch errors, the 
first time it fails to dump and yet diffs a full list against an empty 
list, it&#39;ll look like everyone quit.  This is not what you want.  Also, 
once you work at a big enough company, there WILL be days when some 
automation will run amok and &#34;fire&#34; everyone, 
<a href="https://rachelbythebay.com/w/2019/11/01/gb/">and every account will be deactivated.</a>
This will happen more than once if you stay there long enough.
</p>
<p>
Incidentally, if someone gets mad about you running this sort of thing, 
you probably don&#39;t want to work there anyway.  On the other hand, if 
you&#39;re able to build such tools without IT or similar getting 
&#34;threatened&#34; by it, then you might be somewhere that actually enjoys 
creating interesting and useful stuff.  Treasure such places.  They 
don&#39;t tend to last.
</p>
</div></div>
  </body>
</html>
