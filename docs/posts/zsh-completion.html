<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://erikarow.land/notes/zsh-completion">Original</a>
    <h1>zsh Completion</h1>
    
    <div id="readability-page-1" class="page"><section id="zsh-Completion">

<p>Today I continued my exploration of shell completion with <a href="https://mastodon.gamedev.place/notes/zsh"><code>zsh</code></a> completion. 
And it’s a lot simpler than <a href="https://mastodon.gamedev.place/notes/bash-completion">bash completion</a>.</p>
<section id="Enabling-zsh-Completion">
<h2>Enabling zsh Completion</h2>
<p>I learned that you can enable <code>zsh</code> completion to autostart by adding these two lines to your <code>.zshrc</code>:</p>
<pre><code>autoload -Uz compinit
compinit
</code></pre>
<p>Both were added by the <code>zsh</code> configuration wizard when I opened the shell for the first time.
The first line loads <code>compinit</code> so that it’s available to <code>zsh</code>.
The second line calls <code>compinit</code> to enable completions.</p>
</section>
<section id="Custom-completion">
<h2>Custom completion</h2>
<p>A minimal example of <code>zsh</code> completion looks like this:</p>
<pre><code>#compdef my_echo

_my_echo()
{
  completions=(&#34;hello&#34; &#34;hear&#34; &#34;today&#34;)
  _describe &#34;completions&#34; completions
}
</code></pre>
<p>That’s it.</p>
<p>In order to enable this completion, I needed to name the file <code>_my_echo</code>,
and add it to my <code>zsh</code> <code>fpath</code> in my <code>.zshrc</code>:</p>
<pre><code>fpath=(~/.zsh/functions $fpath)
autoload -Uz compinit
...
</code></pre>
<p>Let’s break down the minimal example:</p>
<section id="compdef">
<h3><code>#compdef</code></h3>
<p>When <code>compinit</code> runs, <code>zsh</code> will look at the first line of each file it finds on the <code>fpath</code>.
<code>#compdef</code> is a tag that defines the function to be called for <code>name</code>, in our case <code>my_echo</code>.
Since the filename matches the function name, it loads <code>_my_echo</code>.</p>
</section>
<section id="_describe">
<h3><code>_describe</code></h3>
<p><code>_describe</code> is a utility function provided by <code>zsh</code> that takes a tag, 
in this case <code>&#34;completions&#34;</code>,
and an array of completions and loads them.</p>
<p>Unlike <code>bash</code>, there’s no further work needed. <code>zsh</code> has all the information it needs, and dutifully provides tab completion for <code>my_echo</code>.</p>
<p>The simplicity of <code>zsh</code> after <code>bash</code> is refreshing.</p>
</section>
</section>
</section></div>
  </body>
</html>
