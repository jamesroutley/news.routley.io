<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/jingkaihe/matchlock">Original</a>
    <h1>Matchlock â€“ Secures AI agent workloads with a Linux-based sandbox</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Matchlock is a CLI tool for running AI agents in ephemeral microVMs - with network allowlisting, secret injection via MITM proxy, and everything else blocked by default. Your secrets never enter the VM.</p>

<p dir="auto">AI agents need to run code, but giving them unrestricted access to your machine is a risk. Matchlock lets you hand an agent a full Linux environment that boots in under a second - isolated, disposable, and locked down by default.</p>
<p dir="auto">When your agent calls an API the real credentials are injected in-flight by the host. The sandbox only ever sees a placeholder. The network is sealed by default and nothing gets out unless you say so. Even if the agent is tricked into running something malicious your keys don&#39;t leak and there&#39;s nowhere for data to go. Inside the agent gets a full Linux environment to do whatever it needs. It can install packages and write files and make a mess. Outside your machine doesn&#39;t feel a thing. Every sandbox runs on its own copy-on-write filesystem that vanishes when you&#39;re done. Same CLI and same behaviour whether you&#39;re on a Linux server or a MacBook.</p>


<ul dir="auto">
<li><strong>Linux</strong> with KVM support</li>
<li><strong>macOS</strong> on Apple Silicon</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="brew tap jingkaihe/essentials
brew install matchlock"><pre>brew tap jingkaihe/essentials
brew install matchlock</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="# Basic
matchlock run --image alpine:latest cat /etc/os-release
matchlock run --image alpine:latest -it sh

# Network allowlist
matchlock run --image python:3.12-alpine \
  --allow-host &#34;api.openai.com&#34; python agent.py

# Secret injection (never enters the VM)
export ANTHROPIC_API_KEY=sk-xxx
matchlock run --image python:3.12-alpine \
  --secret ANTHROPIC_API_KEY@api.anthropic.com python call_api.py

# Long-lived sandboxes
matchlock run --image alpine:latest --rm=false   # prints VM ID
matchlock exec vm-abc12345 -it sh                # attach to it

# Lifecycle
matchlock list | kill | rm | prune

# Build from Dockerfile (uses BuildKit-in-VM)
matchlock build -f Dockerfile -t myapp:latest .

# Pre-build rootfs from registry image (caches for faster startup)
matchlock build alpine:latest

# Image management
matchlock image ls                                           # List all images
matchlock image rm myapp:latest                              # Remove a local image
docker save myapp:latest | matchlock image import myapp:latest  # Import from tarball"><pre><span><span>#</span> Basic</span>
matchlock run --image alpine:latest cat /etc/os-release
matchlock run --image alpine:latest -it sh

<span><span>#</span> Network allowlist</span>
matchlock run --image python:3.12-alpine \
  --allow-host <span><span>&#34;</span>api.openai.com<span>&#34;</span></span> python agent.py

<span><span>#</span> Secret injection (never enters the VM)</span>
<span>export</span> ANTHROPIC_API_KEY=sk-xxx
matchlock run --image python:3.12-alpine \
  --secret ANTHROPIC_API_KEY@api.anthropic.com python call_api.py

<span><span>#</span> Long-lived sandboxes</span>
matchlock run --image alpine:latest --rm=false   <span><span>#</span> prints VM ID</span>
matchlock <span>exec</span> vm-abc12345 -it sh                <span><span>#</span> attach to it</span>

<span><span>#</span> Lifecycle</span>
matchlock list <span>|</span> <span>kill</span> <span>|</span> rm <span>|</span> prune

<span><span>#</span> Build from Dockerfile (uses BuildKit-in-VM)</span>
matchlock build -f Dockerfile -t myapp:latest <span>.</span>

<span><span>#</span> Pre-build rootfs from registry image (caches for faster startup)</span>
matchlock build alpine:latest

<span><span>#</span> Image management</span>
matchlock image ls                                           <span><span>#</span> List all images</span>
matchlock image rm myapp:latest                              <span><span>#</span> Remove a local image</span>
docker save myapp:latest <span>|</span> matchlock image import myapp:latest  <span><span>#</span> Import from tarball</span></pre></div>

<p dir="auto">Matchlock also ships with Go and Python SDKs for embedding sandboxes directly in your application. Allows you to programmatically launch VMs, exec commands, stream output and write files.</p>
<p dir="auto"><strong>Go</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="package main

import (
	&#34;fmt&#34;
	&#34;os&#34;

	&#34;github.com/jingkaihe/matchlock/pkg/sdk&#34;
)

func main() {
	client, _ := sdk.NewClient(sdk.DefaultConfig())
	defer client.Close()

	sandbox := sdk.New(&#34;alpine:latest&#34;).
		AllowHost(&#34;dl-cdn.alpinelinux.org&#34;, &#34;api.anthropic.com&#34;).
		AddSecret(&#34;ANTHROPIC_API_KEY&#34;, os.Getenv(&#34;ANTHROPIC_API_KEY&#34;), &#34;api.anthropic.com&#34;)

	client.Launch(sandbox)
	client.Exec(&#34;apk add --no-cache curl&#34;)

	// The VM only ever sees a placeholder - the real key never enters the sandbox
	result, _ := client.Exec(&#34;echo $ANTHROPIC_API_KEY&#34;)
	fmt.Print(result.Stdout) // prints &#34;SANDBOX_SECRET_a1b2c3d4...&#34;

	curlCmd := `curl -s --no-buffer https://api.anthropic.com/v1/messages \
  -H &#34;content-type: application/json&#34; \
  -H &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
  -H &#34;anthropic-version: 2023-06-01&#34; \
  -d &#39;{&#34;model&#34;:&#34;claude-haiku-4-5-20251001&#34;,&#34;max_tokens&#34;:1024,&#34;stream&#34;:true,
       &#34;messages&#34;:[{&#34;role&#34;:&#34;user&#34;,&#34;content&#34;:&#34;Explain TCP to me&#34;}]}&#39;`
	client.ExecStream(curlCmd, os.Stdout, os.Stderr)
}"><pre><span>package</span> main

<span>import</span> (
	<span>&#34;fmt&#34;</span>
	<span>&#34;os&#34;</span>

	<span>&#34;github.com/jingkaihe/matchlock/pkg/sdk&#34;</span>
)

<span>func</span> <span>main</span>() {
	<span>client</span>, <span>_</span> <span>:=</span> <span>sdk</span>.<span>NewClient</span>(<span>sdk</span>.<span>DefaultConfig</span>())
	<span>defer</span> <span>client</span>.<span>Close</span>()

	<span>sandbox</span> <span>:=</span> <span>sdk</span>.<span>New</span>(<span>&#34;alpine:latest&#34;</span>).
		<span>AllowHost</span>(<span>&#34;dl-cdn.alpinelinux.org&#34;</span>, <span>&#34;api.anthropic.com&#34;</span>).
		<span>AddSecret</span>(<span>&#34;ANTHROPIC_API_KEY&#34;</span>, <span>os</span>.<span>Getenv</span>(<span>&#34;ANTHROPIC_API_KEY&#34;</span>), <span>&#34;api.anthropic.com&#34;</span>)

	<span>client</span>.<span>Launch</span>(<span>sandbox</span>)
	<span>client</span>.<span>Exec</span>(<span>&#34;apk add --no-cache curl&#34;</span>)

	<span>// The VM only ever sees a placeholder - the real key never enters the sandbox</span>
	<span>result</span>, <span>_</span> <span>:=</span> <span>client</span>.<span>Exec</span>(<span>&#34;echo $ANTHROPIC_API_KEY&#34;</span>)
	<span>fmt</span>.<span>Print</span>(<span>result</span>.<span>Stdout</span>) <span>// prints &#34;SANDBOX_SECRET_a1b2c3d4...&#34;</span>

	<span>curlCmd</span> <span>:=</span> <span>`curl -s --no-buffer https://api.anthropic.com/v1/messages \</span>
<span>  -H &#34;content-type: application/json&#34; \</span>
<span>  -H &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \</span>
<span>  -H &#34;anthropic-version: 2023-06-01&#34; \</span>
<span>  -d &#39;{&#34;model&#34;:&#34;claude-haiku-4-5-20251001&#34;,&#34;max_tokens&#34;:1024,&#34;stream&#34;:true,</span>
<span>       &#34;messages&#34;:[{&#34;role&#34;:&#34;user&#34;,&#34;content&#34;:&#34;Explain TCP to me&#34;}]}&#39;`</span>
	<span>client</span>.<span>ExecStream</span>(<span>curlCmd</span>, <span>os</span>.<span>Stdout</span>, <span>os</span>.<span>Stderr</span>)
}</pre></div>
<p dir="auto"><strong>Python</strong> (<a href="https://pypi.org/project/matchlock/" rel="nofollow">PyPI</a>)</p>
<div dir="auto" data-snippet-clipboard-copy-content="pip install matchlock
# or
uv add matchlock"><pre>pip install matchlock
<span><span>#</span> or</span>
uv add matchlock</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="import os
import sys

from matchlock import Client, Config, Sandbox

sandbox = (
    Sandbox(&#34;alpine:latest&#34;)
    .allow_host(&#34;dl-cdn.alpinelinux.org&#34;, &#34;api.anthropic.com&#34;)
    .add_secret(
        &#34;ANTHROPIC_API_KEY&#34;, os.environ[&#34;ANTHROPIC_API_KEY&#34;], &#34;api.anthropic.com&#34;
    )
)

curl_cmd = &#34;&#34;&#34;curl -s --no-buffer https://api.anthropic.com/v1/messages \
  -H &#34;content-type: application/json&#34; \
  -H &#34;x-api-key: $ANTHROPIC_API_KEY&#34; \
  -H &#34;anthropic-version: 2023-06-01&#34; \
  -d &#39;{&#34;model&#34;:&#34;claude-haiku-4-5-20251001&#34;,&#34;max_tokens&#34;:1024,&#34;stream&#34;:true,
       &#34;messages&#34;:[{&#34;role&#34;:&#34;user&#34;,&#34;content&#34;:&#34;Explain TCP/IP.&#34;}]}&#39;&#34;&#34;&#34;

with Client(Config()) as client:
    client.launch(sandbox)
    client.exec(&#34;apk add --no-cache curl&#34;)
    client.exec_stream(curl_cmd, stdout=sys.stdout, stderr=sys.stderr)"><pre><span>import</span> <span>os</span>
<span>import</span> <span>sys</span>

<span>from</span> <span>matchlock</span> <span>import</span> <span>Client</span>, <span>Config</span>, <span>Sandbox</span>

<span>sandbox</span> <span>=</span> (
    <span>Sandbox</span>(<span>&#34;alpine:latest&#34;</span>)
    .<span>allow_host</span>(<span>&#34;dl-cdn.alpinelinux.org&#34;</span>, <span>&#34;api.anthropic.com&#34;</span>)
    .<span>add_secret</span>(
        <span>&#34;ANTHROPIC_API_KEY&#34;</span>, <span>os</span>.<span>environ</span>[<span>&#34;ANTHROPIC_API_KEY&#34;</span>], <span>&#34;api.anthropic.com&#34;</span>
    )
)

<span>curl_cmd</span> <span>=</span> <span>&#34;&#34;&#34;curl -s --no-buffer https://api.anthropic.com/v1/messages <span>\</span></span>
<span><span></span>  -H &#34;content-type: application/json&#34; <span>\</span></span>
<span><span></span>  -H &#34;x-api-key: $ANTHROPIC_API_KEY&#34; <span>\</span></span>
<span><span></span>  -H &#34;anthropic-version: 2023-06-01&#34; <span>\</span></span>
<span><span></span>  -d &#39;{&#34;model&#34;:&#34;claude-haiku-4-5-20251001&#34;,&#34;max_tokens&#34;:1024,&#34;stream&#34;:true,</span>
<span>       &#34;messages&#34;:[{&#34;role&#34;:&#34;user&#34;,&#34;content&#34;:&#34;Explain TCP/IP.&#34;}]}&#39;&#34;&#34;&#34;</span>

<span>with</span> <span>Client</span>(<span>Config</span>()) <span>as</span> <span>client</span>:
    <span>client</span>.<span>launch</span>(<span>sandbox</span>)
    <span>client</span>.<span>exec</span>(<span>&#34;apk add --no-cache curl&#34;</span>)
    <span>client</span>.<span>exec_stream</span>(<span>curl_cmd</span>, <span>stdout</span><span>=</span><span>sys</span>.<span>stdout</span>, <span>stderr</span><span>=</span><span>sys</span>.<span>stderr</span>)</pre></div>
<p dir="auto">See full examples in <a href="https://github.com/jingkaihe/matchlock/blob/main/examples/go/main.go"><code>examples/go</code></a> and <a href="https://github.com/jingkaihe/matchlock/blob/main/examples/python/main.py"><code>examples/python</code></a>.</p>

<section data-identity="7411e843-c8cb-4028-b1f4-0130f21db874" data-host="https://viewscreen.githubusercontent.com" data-src="https://viewscreen.githubusercontent.com/markdown/mermaid?docs_host=https%3A%2F%2Fdocs.github.com" data-type="mermaid" aria-label="mermaid rendered output container">
  <div data-json="{&#34;data&#34;:&#34;graph LR\n    subgraph Host\n        CLI[\&#34;Matchlock CLI\&#34;]\n        Policy[\&#34;Policy Engine\&#34;]\n        Proxy[\&#34;Transparent Proxy + TLS MITM\&#34;]\n        VFS[\&#34;VFS Server\&#34;]\n\n        CLI --&amp;gt; Policy\n        CLI --&amp;gt; Proxy\n        Policy --&amp;gt; Proxy\n    end\n\n    subgraph VM[\&#34;Micro-VM (Firecracker / Virtualization.framework)\&#34;]\n        Agent[\&#34;Guest Agent\&#34;]\n        FUSE[\&#34;/workspace (FUSE)\&#34;]\n        Image[\&#34;Any OCI Image (Alpine, Ubuntu, etc.)\&#34;]\n\n        Agent --- Image\n        FUSE --- Image\n    end\n\n    Proxy -- \&#34;vsock :5000\&#34; --&amp;gt; Agent\n    VFS -- \&#34;vsock :5001\&#34; --&amp;gt; FUSE\n&#34;}" data-plain="graph LR
    subgraph Host
        CLI[&#34;Matchlock CLI&#34;]
        Policy[&#34;Policy Engine&#34;]
        Proxy[&#34;Transparent Proxy + TLS MITM&#34;]
        VFS[&#34;VFS Server&#34;]

        CLI --&gt; Policy
        CLI --&gt; Proxy
        Policy --&gt; Proxy
    end

    subgraph VM[&#34;Micro-VM (Firecracker / Virtualization.framework)&#34;]
        Agent[&#34;Guest Agent&#34;]
        FUSE[&#34;/workspace (FUSE)&#34;]
        Image[&#34;Any OCI Image (Alpine, Ubuntu, etc.)&#34;]

        Agent --- Image
        FUSE --- Image
    end

    Proxy -- &#34;vsock :5000&#34; --&gt; Agent
    VFS -- &#34;vsock :5001&#34; --&gt; FUSE
" dir="auto">
    <div dir="auto">
      <pre lang="mermaid" aria-label="Raw mermaid code">graph LR
    subgraph Host
        CLI[&#34;Matchlock CLI&#34;]
        Policy[&#34;Policy Engine&#34;]
        Proxy[&#34;Transparent Proxy + TLS MITM&#34;]
        VFS[&#34;VFS Server&#34;]

        CLI --&gt; Policy
        CLI --&gt; Proxy
        Policy --&gt; Proxy
    end

    subgraph VM[&#34;Micro-VM (Firecracker / Virtualization.framework)&#34;]
        Agent[&#34;Guest Agent&#34;]
        FUSE[&#34;/workspace (FUSE)&#34;]
        Image[&#34;Any OCI Image (Alpine, Ubuntu, etc.)&#34;]

        Agent --- Image
        FUSE --- Image
    end

    Proxy -- &#34;vsock :5000&#34; --&gt; Agent
    VFS -- &#34;vsock :5001&#34; --&gt; FUSE
</pre>
    </div>
  </div>
  <span role="presentation">
    <span data-view-component="true">
  <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true" data-view-component="true">
    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" fill="none"></circle>
    <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke"></path>
</svg>    <span>Loading</span>
</span>
  </span>
</section>


<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Platform</th>
<th>Mode</th>
<th>Mechanism</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linux</td>
<td>Transparent proxy</td>
<td>nftables DNAT on ports 80/443</td>
</tr>
<tr>
<td>macOS</td>
<td>NAT (default)</td>
<td>Virtualization.framework built-in NAT</td>
</tr>
<tr>
<td>macOS</td>
<td>Interception (with <code>--allow-host</code>/<code>--secret</code>)</td>
<td>gVisor userspace TCP/IP at L4</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">See <a href="https://github.com/jingkaihe/matchlock/blob/main/AGENTS.md">AGENTS.md</a> for the full developer reference.</p>

<p dir="auto">MIT</p>
</article></div></div>
  </body>
</html>
