<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ReturnInfinity/BareMetal-Cloud">Original</a>
    <h1>Show HN: A 10KiB kernel for cloud apps</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p dir="auto">This has only been tested with Digital Ocean and Proxmox. Support for other hypervisor/cloud providers (AWS, Azure, and Google Cloud) is coming soon.</p>
</div>
<p dir="auto">BareMetal Cloud is a minimal version of the <a href="https://github.com/ReturnInfinity/BareMetal">BareMetal</a> exokernel specifically geared for running in public/private cloud instances. This minimal version of BareMetal contains only the relevant drivers, is 10,240 bytes in size, and only uses 4 MiB of memory. All other memory is allocated to the payload.</p>
<p dir="auto">An instance of BareMetal is running in Digital Ocean at <a href="http://baremetal.returninfinity.com" rel="nofollow">http://baremetal.returninfinity.com</a> and will respond to HTTP and ICMP.</p>

<p dir="auto">The script in this repo depends on a Debian-based Linux system. macOS is also supported to build and test if you are using <a href="https://brew.sh" rel="nofollow">Homebrew</a>.</p>
<ul dir="auto">
<li><a href="https://nasm.us" rel="nofollow">NASM</a> - Assembler to build the loader and kernel.</li>
<li><a href="https://www.qemu.org" rel="nofollow">QEMU</a> - Computer emulator if you plan on running a virtual machine for quick testing.</li>
<li><a href="https://git-scm.com" rel="nofollow">Git</a> - Version control software for pulling the source code from GitHub.</li>
</ul>
<p dir="auto">In Linux this can be completed with the following command:</p>
<div data-snippet-clipboard-copy-content="sudo apt install nasm qemu-system-x86 git"><pre><code>sudo apt install nasm qemu-system-x86 git
</code></pre></div>
<p dir="auto">In macOS via Homebrew this can be completed with the following command:</p>
<div data-snippet-clipboard-copy-content="brew install nasm qemu git"><pre><code>brew install nasm qemu git
</code></pre></div>

<p dir="auto">BareMetal Cloud consists of two different projects:</p>
<ul dir="auto">
<li><a href="https://github.com/ReturnInfinity/Pure64">Pure64</a> - The software loader.</li>
<li><a href="https://github.com/ReturnInfinity/BareMetal">BareMetal</a> - The kernel.</li>
</ul>


<div data-snippet-clipboard-copy-content="git clone https://github.com/ReturnInfinity/BareMetal-Cloud.git
cd BareMetal-Cloud
./baremetal.sh setup"><pre><code>git clone https://github.com/ReturnInfinity/BareMetal-Cloud.git
cd BareMetal-Cloud
./baremetal.sh setup
</code></pre></div>
<p dir="auto"><code>baremetal.sh setup</code> automatically runs the build and install functions. Once the setup is complete you can execute <code>baremetal.sh run</code> to verify that everything installed correctly.</p>


<p dir="auto">This command builds the boot sector, loader (Pure64), and kernel</p>


<p dir="auto">This command installs the software to the disk image.</p>


<p dir="auto">This command will run BareMetal-Cloud in a QEMU VM. Output to the serial port will be displayed to the console.</p>

<p dir="auto">Create a VMDK disk image</p>

<p dir="auto">The resulting <code>BareMetal_Cloud.vmdk</code> in <code>sys/</code> will be required.</p>

<p dir="auto">In Digital Ocean click on <code>Backups &amp; Snapshots</code> and then <code>Custom Images</code>. Click on the <code>Upload Image</code> button and select the .vmdk file on your filesystem. Once the file is uploaded you can start a droplet of it by clicking on the <code>More</code> dropdown and selecting <code>Start a droplet</code>.</p>
<p dir="auto">On the <code>Create Droplets</code> page you can select the Droplet Type and CPU Options. Give the droplet a name and click on <code>Create Droplet</code>.</p>


<p dir="auto">In Proxmox click on the &#34;Create VM&#34; button. Configure the following settings:</p>
<ul dir="auto">
<li>General - Give the VM a name</li>
<li>OS - &#34;Do not use any media&#34;</li>
<li>System - Machine: q35</li>
<li>Disks - Remove the existing disk</li>
<li>CPU - Provision as needed</li>
<li>Memory - Provision as needed</li>
<li>Network - Model: VirtIO</li>
<li>Confirm - Click &#34;Finish&#34;</li>
</ul>

<p dir="auto">Use a utility like <code>scp</code> to copy the .vmdk file to the filesystem of the Proxmox server.</p>

<p dir="auto"><code>qm importdisk &lt;VMID&gt; &lt;vmdk_filename&gt; &lt;storage_location&gt;</code></p>
<p dir="auto">Example - <code>qm importdisk 101 /root/BareMetal_Cloud.vmdk local-lvm</code></p>

<p dir="auto">In the Proxmox web interface select the new VM. In the Hardware section, find the new unused disk, and attach it to the VM.</p>
<p dir="auto">Verify the &#34;Boot Order&#34; in the VM &#34;Options&#34;.</p>

<p dir="auto">Click &#34;Start&#34; on the VM.</p>
<p dir="auto">//EOF</p>
</article></div></div>
  </body>
</html>
