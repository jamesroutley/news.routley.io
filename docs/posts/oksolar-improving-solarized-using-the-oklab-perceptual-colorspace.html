<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://meat.io/oksolar">Original</a>
    <h1>Show HN: OKSolar: Improving Solarized using the OKLab perceptual colorspace</h1>
    
    <div id="readability-page-1" class="page"><div id="blog">
            
            
            <p>Improving on Solarized using the OKLab perceptual colorspace</p>
            <blockquote>
<p><strong>tl;dr</strong>: This is a long post about what is basically a tweak to an already
great color scheme. I went down the rabbithole of color theory because I was
bored, and this is what I produced. If you just want the final result…you’re
looking at it (this site uses the OKSolar color scheme). You can also <a href="#oksolar">skip
to the end</a>, or get a JSON file with the hex and OKLCh values for
it <a href="https://meat.io/oksolar.json">here</a>.</p>
</blockquote>
<p>I was a long-time user of Ethan Schoonover’s <a href="https://ethanschoonover.com/solarized/">Solarized</a>, an
aesthetically-pleasing and very usable color scheme for the terminal and code
editors. However, I found the contrast lacking, and I usually ended up tweaking
the background and foreground colors to stand out a bit more.</p>
<p>Solarized was developed using “precise <a href="https://en.wikipedia.org/wiki/cielab_color_space">CIELAB</a> lightness relationships”,
which I thought would have prevented this issue. The problem is that CIELAB
isn’t <em>perceptually uniform</em>. Practically speaking, this means different colors
appear to have uneven lightness differences to a human observer, even though
their <em>L*</em> values (the shorthand for CIELAB’s lightness component) are the
same. CIELAB was developed in 1976, and the <a href="https://en.wikipedia.org/wiki/color_difference#cie76">color difference metric</a> it
was based on has long since been obsoleted.</p>
<p>To demonstrate, here’s some Solarized-highlighted code in both light and dark
modes, and how it appears under a monochrome filter (simulating
<a href="https://en.wikipedia.org/wiki/monochromacy">monochromacy</a>):</p>
<p><img src="https://meat.io/images/solarized-example.png" alt="An example of syntax highlighting under the Solarized color scheme, next to their monochromatic representations"/></p>
<p>For me, the contrast between text and the background is just a little too low
(especially if I’m working in a bright space), and you can see that it also
varies between different token types. I know that the goal of syntax
highlighting is to add visual structure to code, but I’d prefer that were done
through color than through brightness.</p>
<h2>OKLab</h2>
<p><a href="https://bottosson.github.io/posts/oklab/">OKLab</a> is a relatively new colorspace (that is, a way of describing colors)
defined by Björn Ottosson in December 2020. It was derived numerically using
the <a href="https://en.wikipedia.org/wiki/color_difference#ciede2000">state-of-the-art color difference metric</a>, and achieves a much
stronger guarantee of perceptual uniformity than CIELAB. That means that two
colors with equal OKLab lightness values will appear equally bright to a human
observer. Despite its newness, it’s caught on enough to be part of the <a href="https://w3c.github.io/csswg-drafts/css-color/#ok-lab">CSS
Color Module Level 4 Draft</a>, and Safari already supports
specifying colors in it natively.</p>
<p>Here’s a constant-lightness rainbow in OKLab, with lightness of 74.6% and chroma (a measure similar to ‘saturation’) of 0.124:</p>
<p><img src="https://meat.io/images/oklab-rainbow.png" alt="A constant-lightness rainbow in OKLab, with hue varying horizontally and lightness varying vertically"/></p>
<p>Armed with OKLab, I reapproached Solarized from first principles, using the
same style of composing base and accent colors, but fixing the lightness values
in OKLab and then tweaking the other components.</p>
<h2>Examining Solarized</h2>
<p>First of all, here’s what the Solarized palette looks like, in light and
dark modes:</p>

<p>
    foreground <span>emphasis</span> <span>secondary <span>highlight</span></span></p>
<p>
    foreground <span>emphasis</span> <span>secondary <span>highlight</span></span></p>
<p>Subjectively, the light background seems to have a lower contrast with the
yellow, green and cyan text, while the dark background has lower contrast with
orange, red, magenta and violet. I also find regular foreground text to be a
little low contrast for my taste.</p>
<h3>OKLCh Values for Solarized</h3>
<p>For the rest of this article, I’ll be specifying colors in LCh format, which is
the <a href="https://en.wikipedia.org/wiki/cielab_color_space#cylindrical_model">cylindrical form</a> of Lab. The conversion between the two is pretty
trivial, and most systems that accept Lab co-ordinates also accept LCh
co-ordinates.</p>
<p>To evaluate Solarized in objective terms, I mapped the colors to their OKLCh
representations:</p>


<p>Yellow, cyan, and green all have higher lightnesses, and orange, red, magenta
and violet skew lower (hence why there were discrepancies in contrast between
light and dark backgrounds).</p>
<p>For both light and dark modes, I looked at the base colors (foreground,
emphasis, secondary and highlight background) and calculated the contrast in
lightness with that mode’s background:</p>


<p>The light mode has higher contrast overall, both color schemes have a pretty
even highlight contrast, and the dark secondary is a fair bit lower contrast
than the light one (so, for example, code comments would be less legible in the
dark mode, which I subjectively agree with).</p>
<h2 id="oksolar">Building OKSolar</h2>
<p>Sticking to the original vision of Solarized, I manually iterated on colors in
OKLCh space to find an analogous scheme such that:</p>
<ul>
<li><code>diff(background, accentColor)</code> was equal for all accent colors against a
given background;</li>
<li><code>diff(background, accentColor)</code> was consistent between light and dark mode;</li>
<li><code>diff(background, baseColor)</code> were each consistent between light and dark
mode;</li>
<li>Every color was representable in sRGB (it’s possible to specify colors in
OKLab/OKLCh that are not describable in web-compatible RGB, and not
displayable on all monitors);</li>
<li>Hues and chromas deviated as little as possible from the original color
scheme.</li>
</ul>
<p>I call the result of this effort OKSolar. You can get the raw values in a JSON
file <a href="https://meat.io/oksolar.json">here</a>, and here’s a small demo:</p>

<p>
    foreground <span>emphasis</span> <span>secondary <span>highlight</span></span></p>
<p>
    foreground <span>emphasis</span> <span>secondary <span>highlight</span></span></p>
<p>I think the accent colors look a lot more even, and that regular text stands
out more without clashing too much with the background. One notable change I
made is that ‘emphasis’ is now expressed through chroma rather than lightness,
with emphasized text having a more saturated color than regular foreground
text. This because a lot of the highlighting schemes and CLI tools I use also
make emphasized text bold, and the combination of bolder <em>and</em> brighter was
just a bit too much.</p>
<p>Here are the OKLCh and hex values for the color scheme:</p>


<p>And the table of lightness differences, similar to the one I calculated above
for Solarized:</p>


<p>Things are much more consistent between light and dark mode now. The small
discrepancies arose where I manually adjusted things to keep a color in sRGB,
keep a color saturated, or maintain distinguishability between accent colors.
Text rendered on a backlit display also significantly affects its appearance,
no matter how closely the colorspace models human perception, so I also
exercized personal judgment when making adjustments.</p>
<h3>Base Hue Customization</h3>
<p>One thing you might notice from the OKLCh values for OKSolar is that the base
colors draw from a set of only 3 hues. By fixing the lightness and just
modifying hue and chroma, you can easily make variants of the color scheme to
suit your taste, while preserving contrast and accessibility:</p>

<p>
    foreground <span>emphasis</span> <span>secondary <span>highlight</span></span></p>
<p>
    foreground <span>emphasis</span> <span>secondary <span>highlight</span></span></p>
<p>
    foreground <span>emphasis</span> <span>secondary <span>highlight</span></span></p>
<p>Note that you’ll need to tweak chroma values, because OKLCh’s chroma is not
<em>orthogonal</em>: that is, the perceived saturation of an OKLCh color can change as
you vary the hue, even if you keep the chroma fixed. Check out Björn Ottosson’s
great post on <a href="https://bottosson.github.io/posts/colorpicker/">OKHSL and OKHSV</a> to learn more about this.</p>
<h2>More Resources</h2>
<p>I made heavy use of the Evil Martians <a href="https://oklch.evilmartians.io/">OKLCh Color Picker</a> in
writing this post and experimenting with OKLCh itself. I also recommend reading
both the original <a href="https://bottosson.github.io/posts/oklab/">OKLab</a> and the <a href="https://bottosson.github.io/posts/colorpicker/">OKHSL and OKHSV</a> blog posts; they’re
good primers on the colorspace and provide background on modern color theory in
general.</p>

        </div></div>
  </body>
</html>
