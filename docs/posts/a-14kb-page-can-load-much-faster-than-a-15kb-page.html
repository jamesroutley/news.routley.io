<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://endtimes.dev/why-your-website-should-be-under-14kb-in-size/">Original</a>
    <h1>A 14kb page can load much faster than a 15kb page</h1>
    
    <div id="readability-page-1" class="page"><div>
    <article>
        
        <main>

            <p><em>Also available to read on <a href="https://dev.to/shadowfaxrodeo/why-your-website-should-be-under-14kb-in-size-398n">dev.to</a> (warning it is much larger than 14kb)</em></p>
<p>Having a smaller website makes it load faster — that&#39;s not surprising.</p>
<p>What is surprising is that <strong>a <code>14kb</code> page can load much faster than a <code>15kb</code> page</strong> — maybe <code>612ms</code> faster — while the difference between a <code>15kb</code> and a <code>16kb</code> page is trivial.</p>
<p>This is because of the <strong>TCP slow start</strong> algorithm. <strong>This article will cover what that is, how it works, and why you should care.</strong> But first we&#39;ll quickly go over some of the basics.</p>
<h2 id="what-is-tcp">What is TCP?<a href="#what-is-tcp"> #</a></h2>
<p><strong>Transmission Control Protocol (TCP)</strong> is a way of using the <strong>Internet Protocol (IP)</strong> to send packets of data reliably — sometimes this is referred to as <strong>TCP/IP</strong>.</p>
<p>When a browser requests your website (or an image or a stylesheet) it makes that request using <strong>HTTP</strong>.</p>
<p>HTTP is built on top of TCP and a single HTTP request is usually made up of many TCP <em>packets</em>.</p>
<p>On its own IP is just a system for sending packets of data from one location on the internet to another. IP doesn&#39;t have a way of checking if a packet has successfully arrived at its destination.</p>
<p><em>When it comes to websites, knowing that all the data has arrived is important — otherwise we could end up with missing chunks of web page. There are other used of the web where this doesn&#39;t matter so much — like streaming live video.</em></p>
<p>TCP is an extension of IP that allows a browser and your website&#39;s server to tell each other which packets have successfully arrived.</p>
<p>The server sends some packets, then waits for a response from the browser saying it has received the packets (this is called an acknowledgement or ACK), then it sends some more — or if it hasn&#39;t received an ACK it can send the packets again.</p>
<h2 id="what-is-tcp-slow-start">What is TCP slow start?<a href="#what-is-tcp-slow-start"> #</a></h2>
<p>TCP slow start is an algorithm used by servers to find out how many packets it can send at a time.</p>
<p>When a browser first makes a connection to your server — the server has no way of knowing the amount of <strong>bandwidth</strong> between them.</p>
<p><em>Bandwidth is how much data can be transmitted over a network per unit of time. Usually it&#39;s measured in bits per second (<code>b/s</code>). Plumbing is a common analogy — think of bandwidth as how much water can come out of a pipe per second.</em></p>
<p>Your server doesn&#39;t know how much data the connection can handle — so it starts by sending you a small and safe amount of data — usually 10 TCP packets.</p>
<p>If those packets successfully reach your site&#39;s visitor, their computer sends back an acknowledgement (ACK) saying the packets have been received.</p>
<p>Your server then sends more data back, but this time it doubles the amount of packets.</p>
<p>This process is repeated until packets are lost and your server doesn&#39;t receive an ACK. (At which point the server continues to send packets but at a slower rate).</p>
<p>That&#39;s the gist of TCP slow start — in real life the algorithm varies, but that&#39;s essentially how it works.</p>
<h2 id="so-where-does-14kb-come-from">So where does 14kb come from?<a href="#so-where-does-14kb-come-from"> #</a></h2>
<p>Most web servers TCP slow start algorithm starts by sending 10 TCP packets.</p>
<p>The maximum size of a TCP packet is <code>1500 bytes</code>.</p>
<p><em>This this maximum is not set by the TCP specification, it comes from the <a href="https://en.wikipedia.org/wiki/Ethernet_frame">ethernet standard</a></em></p>
<p>Each TCP packet uses <strong>40 bytes</strong> in its header — <a href="https://en.wikipedia.org/wiki/IPv4#Packet_structure">16 bytes for IP</a> and an additional <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol#TCP_segment_structure">24 bytes for TCP</a></p>
<p>That leaves <strong>1460 bytes</strong> per TCP packet. <code>10 x 1460 = 14600 bytes</code> or roughly 14kb!</p>
<p>So if you can fit your website — or the critical parts of it — into 14kb, you can save visitors a lot of time — the time it takes for one round trip between them and your website&#39;s server.</p>
<h2 id="how-bad-can-one-round-trip-be">How bad can one round trip be?<a href="#how-bad-can-one-round-trip-be"> #</a></h2>
<p>People are very impatient — and one round trip can be surprisingly long. How long depends on latency…</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Performance/Understanding_latency">Latency is the time it takes a packet of data to travel from one it&#39;s source to it&#39;s destination.</a> If bandwidth is how much water can go through a pipe per second — latency is the time it takes a droplet of water to enter the pipe and then exit the other end.</p>
<p>Here&#39;s a fun example of how bad latency can be:</p>
<h3 id="satelite-internet">Satelite internet<a href="#satelite-internet"> #</a></h3>
<p>Satellite internet is provided by a satellite in orbit around the earth. It&#39;s used by people in very unpopulated areas, on oil rigs, cruise ships, and for inflight WiFi on airlines.</p>
<p>To illustrate this example of bad latency, let&#39;s imagine a bunch of oil rig bros have forgotten their dice at home and need to use the excellent <a href="https://missingdice.com/dice-roller/">missingdice.com</a> to play Dungeons &amp; Dragons.</p>
<p>First one of them uses their phone to make a request for the web page…</p>
<p>The <strong>phone</strong> sends that request to the rig&#39;s <strong>WiFi router</strong> — which sends that data to the on-rig <strong>satellite dish</strong> — lets be nice and say that takes <code>1ms</code>.</p>
<p>The satellite dish then has to send that data to the <strong>satellite</strong> in orbit above the earth.</p>
<p>Typically, this is achieved using a satellite in <a href="https://en.wikipedia.org/wiki/Geostationary_orbit">geostationary orbit</a> at <code>35786km</code> above the earths surface. The speed of light travels at <code>299792458 m/s</code>, so a message sent from earth to the satellite takes <code>120ms</code>. The satellite then sends the message back to a <strong>ground station</strong>, which takes another <code>120ms</code>.</p>
<p>Then the ground station has to send the request to wherever the <strong>server</strong> is on earth (light slows down to <code>200000000 m/s</code> when it&#39;s in a fibre optic cable). If the distance between the ground station and the server is the same as the distance between <a href="https://hpbn.co/primer-on-latency-and-bandwidth/#speed-of-light-and-propagation-latency">New York and London it&#39;ll take about <code>28ms</code></a> — but if it&#39;s more like the distance between New York and Sydney it&#39;ll take <code>80ms</code> — so we&#39;ll call it <code>60ms</code> (a convenient number for our math)</p>
<p>Then the request needs to be processed by the server which could take maybe <code>10ms</code> then the server sends it back again.</p>
<p>Back to the ground station, up  into space, back down to the satellite dish, then to the wifi router, and back again to our oilers phone.</p>
<pre><code>phone -&gt; WiFi router -&gt; satellite dish -&gt; satellite -&gt; ground station -&gt; server -&gt; ground station -&gt; satellite -&gt; satellite dish -&gt; WiFi router -&gt; phone
</code></pre>
<p>If we do the math that&#39;s  <code>10 + ( 1 + 120 + 120 + 60 ) x 2 = 612ms</code>.</p>
<p>That&#39;s an extra <code>612ms</code> every round trip — perhaps that doesn&#39;t seem like a long time to wait but your website could easily have many round trips just to fetch it&#39;s first resource.</p>
<p><em>Also HTTPS requires two additional round trips before it can do the first one — which gets us up to <code>1836ms</code>!</em></p>
<h3 id="what-about-latency-for-people-who-live-on-dry-land">What about latency for people who live on dry land?<a href="#what-about-latency-for-people-who-live-on-dry-land"> #</a></h3>
<p>Satellite internet might seem like a deliberately bad example — I chose it because it illustrates the point and is weird — but for landlubbers latency can get worse than that for lots of reasons:</p>
<ul>
<li>2g mobile typically has latency between <a href="https://hpbn.co/mobile-networks/#brief-history-of-the-gs"><code>300ms</code> and <code>1000ms</code></a></li>
<li>3g networks can have anywhere between <a href="https://hpbn.co/mobile-networks/#brief-history-of-the-gs"><code>100ms</code> and <code>500ms</code></a> latency</li>
<li>Noisy mobile networks  — say in an unusually crowded place like a music festival.</li>
<li>Servers dealing with high amounts of traffic</li>
<li>Bad stuff</li>
</ul>
<p>Spotty connections can also cause packets to be lost — resulting in another round trip to get the lost packets.</p>
<h2 id="now-that-you-know-about-the-14kb-rule-what-can-you-do">Now that you know about the 14kb rule, what can you do?<a href="#now-that-you-know-about-the-14kb-rule-what-can-you-do"> #</a></h2>
<p>Of course, you should make your website as small as possible — <strong>you love your visitors and you want them to be happy</strong>. Aiming for each page to fit in under 14kb is good target.</p>
<p><strong>That 14kb includes compression — so it could actually be more like ~50kb of uncompressed data</strong> — which is generous. <a href="https://www.computerhistory.org/timeline/1969/"><em>Consider that the Apollo 11 guidance computers only had 72kb of memory.</em></a></p>
<p>Once you lose the autoplaying videos, the popups, the cookies, the cookie consent banners, the social network buttons, the tracking scripts, javascript and css frameworks, and all the other junk nobody likes —  you&#39;re probably there.</p>
<p>But, assuming you&#39;ve tried your very best to fit everything into 14kb, and can&#39;t — the 14kb rule is still useful.</p>
<p>If you <strong>Make sure the first 14kb of data you send to your visitors can be used to render something useful</strong> — for instance some critical CSS, JS and the first few paragraphs of text explaining how to use your app.</p>
<h3 id="some-caveats-to-the-rule">Some caveats to the rule<a href="#some-caveats-to-the-rule"> #</a></h3>
<p>The 14kb rule is more like a rule of thumb, than a fundamental law of computing:</p>
<ul>
<li>Some servers have increased the TCP slow start initial window to 30 packets instead of 10</li>
<li>Sometimes the server knows it can start with a larger number of packets because it&#39;s used the TLS handshake to establish a larger window can be used.</li>
<li>Servers can cache how many packets a route can manage, and send more next time it connects.</li>
<li>There&#39;s other caveats too — <a href="https://www.tunetheweb.com/blog/critical-resources-and-the-first-14kb/">here&#39;s a more in depth article about why the 14kb rule isn&#39;t always the case</a></li>
</ul>
<h4>HTTP/2 and the 14kb rule</h4>
<p>There is an idea that the 14kb rule no longer holds true when using HTTP/2. I&#39;ve read all I can about this without boring myself to death — but I haven&#39;t seen any evidence that servers using HTTP/2 have stopped using TCP slow start beginning with 10 packets.</p>
<h2 id="further-reading">Further reading<a href="#further-reading"> #</a></h2>
<p>Much of the content of this post comes from the following resources:</p>
<ul>
<li><a href="https://hpbn.co/">High performance browser networking <em>by Ilya Grigorik</em></a></li>
<li><a href="https://sirupsen.com/napkin/problem-15">Increase HTTP Performance by Fitting In the Initial TCP Slow Start Window <em>by Simon Hørup Eskildsen</em></a></li>
<li><a href="https://www.tunetheweb.com/blog/critical-resources-and-the-first-14kb/">Critical Resources and the First 14 KB - A Review</a></li>
</ul>


            <dl>
                <dt>published</dt>
                <dd>25 Aug 22</dd>
                <dt>modified</dt>
                <dd>25 Aug 22</dd>
                <dt>author</dt>
                <dd>Nathaniel</dd>
                <dt>tags</dt>
                <dd>
                    
                        <code>post</code>
                    
                        <code>performance</code>
                    
                </dd>
                
            </dl>
        </main>
    </article>

</div></div>
  </body>
</html>
