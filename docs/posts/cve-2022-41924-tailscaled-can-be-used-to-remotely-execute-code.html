<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tailscale.com/security-bulletins/#ts-2022-004">Original</a>
    <h1>CVE-2022-41924 – tailscaled can be used to remotely execute code</h1>
    
    <div id="readability-page-1" class="page"><div>
        
          
          <article id="ts-2022-005">
            
            <div>
              <header>
                  <h4>
                    TS-2022-005
                  </h4>
              </header>
            <p><strong><em>Reference</em></strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2022-41925">CVE-2022-41925</a></p>
<p><strong><em>Severity</em></strong>: Low</p>
<p><strong><em>CVSS vector string</em></strong>: CVSS:3.0/AV:A/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N</p>
<p><strong><em>Description</em></strong>: A vulnerability identified in the Tailscale client allows a malicious website to access the peer API, which can then be used to access Tailscale environment variables.</p>
<p><strong><em>Affected platforms</em></strong>: All</p>
<p><strong><em>Patched Tailscale client versions</em></strong>: v1.32.3 or later, v1.33.257 or later (unstable)</p>
<h5 id="what-happened">What happened?</h5>
<p>In the Tailscale client, the peer API was vulnerable to DNS rebinding. This allowed an attacker-controlled website visited by the node to rebind DNS for the peer API to an attacker-controlled DNS server, and then making peer API requests in the client, including accessing the node’s Tailscale environment variables.</p>
<h5 id="who-is-affected">Who is affected?</h5>
<p>All Tailscale clients prior to version v1.32.3 are affected.</p>
<h5 id="what-should-i-do">What should I do?</h5>
<p><strong>Upgrade to v1.32.3 or later to remediate the issue.</strong></p>
<h5 id="what-is-the-impact">What is the impact?</h5>
<p>An attacker with access to the peer API on a node could use that access to read the node’s environment variables, including any credentials or secrets stored in environment variables. This may include Tailscale authentication keys, which could then be used to add new nodes to the user’s tailnet. The peer API access could also be used to learn of other nodes in the tailnet or send files via Taildrop.</p>
<p>An attacker with access to the peer API who sent a malicious file via Taildrop which was accessed while it was loading could use this to gain access to the local API, and remotely execute code.</p>
<p>There is no evidence of this vulnerability being purposefully triggered or exploited.</p>
<h5 id="credits">Credits</h5>
<p>We would like to thank <a href="https://github.com/emilytrau">Emily Trau</a> and <a href="https://twitter.com/JJJollyjim">Jamie McClymont (CyberCX)</a> for reporting this issue. Further detail is available in <a href="https://emily.id.au/tailscale">their blog post</a>.</p>

          </div>
        </article>
        
          
          <article id="ts-2022-004">
            
            <div>
              <header>
                  <h4>
                    TS-2022-004
                  </h4>
              </header>
            <p><strong><em>Reference</em></strong>: <a href="https://www.cve.org/CVERecord?id=CVE-2022-41924">CVE-2022-41924</a></p>
<p><strong><em>Severity</em></strong>: Critical</p>
<p><strong><em>CVSS vector string</em></strong>: CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:L/A:H</p>
<p><strong><em>Description</em></strong>: A vulnerability identified in the Tailscale Windows client allows a malicious website to reconfigure the Tailscale daemon <code>tailscaled</code>, which can then be used to remotely execute code.</p>
<p><strong><em>Affected platforms</em></strong>: Windows</p>
<p><strong><em>Patched Tailscale client versions</em></strong>: v1.32.3 or later, v1.33.257 or later (unstable)</p>
<h5 id="what-happened">What happened?</h5>
<p>In the Tailscale Windows client, the local API was bound to a local TCP socket, and communicated with the Windows client GUI in cleartext with no Host header verification. This allowed an attacker-controlled website visited by the node to rebind DNS to an attacker-controlled DNS server, and then make local API requests in the client, including changing the coordination server to an attacker-controlled coordination server.</p>
<h5 id="who-is-affected">Who is affected?</h5>
<p>All Windows clients prior to version v1.32.3 are affected.</p>
<h3 id="what-should-i-do">What should I do?</h3>
<p><strong>If you are running Tailscale on Windows, upgrade to v1.32.3 or later to remediate the issue.</strong></p>
<h5 id="what-is-the-impact">What is the impact?</h5>
<p>An attacker-controlled coordination server can send malicious URL responses to the client, including pushing executables or installing an SMB share. These allow the attacker to remotely execute code on the node.</p>
<p>Reviewing all logs confirms this vulnerability was not triggered or exploited.</p>
<h5 id="credits">Credits</h5>
<p>We would like to thank <a href="https://github.com/emilytrau">Emily Trau</a> and <a href="https://twitter.com/JJJollyjim">Jamie McClymont (CyberCX)</a> for reporting this issue. Further detail is available in <a href="https://emily.id.au/tailscale">their blog post</a>.</p>

          </div>
        </article>
        
      </div><div>
        
          
          <article id="ts-2022-003">
            
            <div>
              <header>
                  <h4>
                    TS-2022-003
                  </h4>
              </header>
            <p><strong><em>Description</em></strong>: An issue in Tailscale’s implementation of the OAuth authentication flow for GitHub allowed users who authenticate to Tailscale with their GitHub user identity to create a tailnet for a GitHub organization using <a href="https://docs.github.com/en/enterprise-cloud@latest/authentication/authenticating-with-saml-single-sign-on/about-authentication-with-saml-single-sign-on">SAML authentication</a> in <a href="https://docs.github.com/en/get-started/onboarding/getting-started-with-github-enterprise-cloud">GitHub Enterprise Cloud</a>, where Tailscale is not an <a href="https://docs.github.com/en/enterprise-cloud@latest/authentication/keeping-your-account-and-data-secure/authorizing-oauth-apps">authorized OAuth app</a> for their organization.</p>
<h5 id="what-happened">What happened?</h5>
<p>Tailscale silently ignored a 403 error to the <a href="https://docs.github.com/en/enterprise-cloud@latest/rest/orgs/orgs#list-organizations-for-the-authenticated-user">GitHub API query for organizations for an authenticated user</a> that was returned when a user authenticated to SAML, but the organization had not authorized Tailscale. This only applied to organizations using SAML on GitHub Enterprise Cloud with OAuth app authorization enabled, and where Tailscale was not authorized.</p>
<p>As a result, a user identity could bypass the organization’s OAuth app access restrictions, and create a tailnet for the GitHub organization.</p>
<h5 id="who-is-affected">Who is affected?</h5>
<p><strong>Up to 7 tailnets for GitHub organizations on GitHub Enterprise Cloud which use SAML for authentication may have been created between 2021-06-18 and 2022-06-03 without Tailscale being an authorized OAuth app for their GitHub organization</strong>, and could have used Tailscale to connect devices in that organization. An additional 10 tailnets were created with no or only one device, and so could not have used Tailscale to connect between devices.</p>
<p>We have notified the Tailscale admins for the affected organizations who we were able to identify. We do not have a way to notify the GitHub organization owners.</p>
<p>If you’re a GitHub organization owner, you can see if Tailscale is approved for your GitHub organization by going to the organization’s settings page and selecting “Third-party access” from the left-hand navigation. Or, for an organization <code>$your-org</code>, navigate to</p>
<pre tabindex="0"><code>https://github.com/organizations/$your-org/settings/oauth_application_policy
</code></pre><h5 id="what-is-the-impact">What is the impact?</h5>
<p><strong>A tailnet may have been created for a GitHub organization without their GitHub organization owner’s approval</strong>.  In this case, the use of Tailscale and the creation of a tailnet could be perceived as being sanctioned by their organization when it might not have been.</p>
<h5 id="what-do-i-need-to-do">What do I need to do?</h5>
<p><strong>If you are affected, you will need to re-authenticate to keep using your tailnet</strong>. Tailscale has expired all admin console sessions for potentially affected GitHub organizations as of 2022-06-13. As a result, users in a potentially affected tailnet will need to re-authenticate the next time they access the admin console, and will not be able to do so without Tailscale being an authorized OAuth app, which may first require getting approval from their GitHub organization owner. Nodes in a potentially affected tailnet will also need to re-authenticate when their node keys expire. If you’re a GitHub organization owner, you can approve Tailscale as an OAuth app by following GitHub’s instructions for <a href="https://docs.github.com/en/organizations/restricting-access-to-your-organizations-data/approving-oauth-apps-for-your-organization">Approving OAuth Apps for your organization</a>.</p>
<p>Tailscale has deployed a fix to the coordination server as of 2022-06-03, so that no new tailnets can be created without a GitHub organization owner’s approval.</p>
<h5 id="credits">Credits</h5>
<p>We would like to thank <a href="https://github.com/acuteaura">Aurelia</a> for reporting the issue. Further detail is available in <a href="https://notes.acuteaura.net/posts/github-enterprise-security/">their blog post</a>.</p>

          </div>
        </article>
        
      </div><div>
        
          
          <article id="ts-2022-002">
            
            <div>
              <header>
                  <h4>
                    TS-2022-002
                  </h4>
              </header>
            <p><strong><em>Description</em></strong>: An issue in the Tailscale coordination server allowed individuals creating a new Tailscale account with a gmail.com email address to join the same tailnet, rather than individual tailnets.</p>
<h5 id="what-happened">What happened?</h5>
<p>There was a flaw in Tailscale’s logic for migrating accounts between identity providers, and a new gmail.com shared tailnet was accidentally created. Once created, any user who tried to create a new Tailscale account with a gmail.com email address joined the shared gmail.com tailnet.</p>
<h5 id="who-is-affected">Who is affected?</h5>
<p><strong>A total of 44 users with 59 devices who created accounts for their gmail.com email addresses on 2022-05-11 between 10:56 and 13:12 PT were affected</strong>. We have notified affected users.</p>
<h5 id="what-is-the-impact">What is the impact?</h5>
<p><strong>Six connections between devices belonging to different users were made, but no traffic of concern flowed between them</strong>. Four connections were pings, and two connections were UDP traffic on port 27036, likely automated broadcasting by a gaming platform to discover peers to play with. There is no evidence of malicious traffic.</p>
<p><strong>Impacted users could see some metadata about other users and devices from their devices’ clients</strong>, including users’ names, devices’ host names, and devices’ Tailscale IP addresses. This information <em>was</em> viewed by at least one user, who reported it to us.</p>
<p><strong>One user, the tailnet Admin, was able to see all users and devices added to the shared gmail.com tailnet</strong>. This includes users’ email addresses, names, and when they were last connected; and devices’ host names, their OS and version, when the devices were last connected, and their public IP addresses. This information <em>was</em> viewed by the user, who reported it to us.</p>
<h5 id="what-do-i-need-to-do">What do I need to do?</h5>
<p><strong>No action is required</strong>. Tailscale has deployed a fix to the coordination server as of 2022-05-11 13:12 PT.</p>
<p>New users registering for a Tailscale account with a gmail.com email address will create a single-user tailnet as normal.</p>
<h5 id="credits">Credits</h5>
<p>We would like to thank <a href="https://www.linkedin.com/in/davidswafford/">David Swafford</a> and George Constantinides for reporting the issue.</p>

          </div>
        </article>
        
      </div><div>
        
          
          <article id="ts-2022-001">
            
            <div>
              <header>
                  <h4>
                    TS-2022-001
                  </h4>
              </header>
            <p><strong><em>Severity</em></strong>: Medium</p>
<p><strong><em>CVSS vector string</em></strong>: CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:N/A:N</p>
<p><strong><em>Description</em></strong>: A vulnerability identified in the Tailscale control plane allowed individuals using GitHub to authenticate to Tailscale to have their devices join a tailnet associated with an empty GitHub username.</p>
<h5 id="what-happened">What happened?</h5>
<p>There was a flaw in Tailscale’s authorization logic for the GitHub identity provider. If a user tried to authenticate to Tailscale using their GitHub identity, and GitHub returned a 500 error, then in some cases, Tailscale interpreted that as authorization for an empty GitHub username, and connected these devices to the tailnet associated with the empty GitHub username.</p>
<h5 id="who-is-affected">Who is affected?</h5>
<p><strong>A total of five devices belonging to four users were affected between 2021-06-15 and 2022-02-04</strong>, when the issue was reported and remediated. We have contacted the two users we were able to identify.</p>
<p><strong>You may be affected if you authenticated to Tailscale using a GitHub account, and after authorizing a connection using GitHub, you received a connection error.</strong> Without being asked to select which GitHub user or organization tailnet to connect to, your device would have connected to a tailnet.</p>
<h5 id="what-is-the-impact">What is the impact?</h5>
<p><strong>No device connected to another device in the tailnet.</strong> Other than the two devices which belonged to the same user, no two devices in the tailnet had valid node keys at the same time, and so did not and would not have been able to establish connections.</p>
<p><strong>A device’s existence and some metadata was shared with devices added later in time.</strong> Devices added later in time were able to see previously added devices, including: their host names, their OS and version, when the devices were last connected, and their public IP addresses.</p>
<p>There is no evidence of this vulnerability being purposefully triggered or exploited.</p>
<h5 id="credits">Credits</h5>
<p>We would like to thank Marvin Boothby (<a href="https://github.com/boothb">boothb</a>) for reporting the issue.</p>

          </div>
        </article>
        
      </div></div>
  </body>
</html>
