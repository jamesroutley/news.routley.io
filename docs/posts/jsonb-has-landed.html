<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sqlite.org/forum/forumpost/fa6f64e3dc1a5d97">Original</a>
    <h1>JSONB has landed</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>

<p>JSONB is a rewrite of the <a href="https://sqlite.org/draft/json1.html">SQLite JSON functions</a>
that, depending on usage patterns, could be several times faster
than the original JSON functions.  This enhancement has now
<a href="https://sqlite.org/src/info/7f0c79b94e8f55e5">landed on trunk</a>.</p>

<p>Developers who use JSON heavily in their applications are encouraged
to download a <a href="https://sqlite.org/download.html">pre-release snapshot</a>
and give the new code a try.</p>

<h2>How Is This Different?</h2>
<p>Functions that deal with text JSON use a three-step process:</p>

<ol>
<li><p>Parse the text JSON into an internal binary format that is
  more accessible to C-code.</p></li>
<li><p>Carry out the requested operation.  Maybe this is looking up
  a field in an object, or perhaps it is modifying the JSON in
  some way.</p></li>
<li><p>If the processing involved changing the JSON, convert the
  internal binary format back into 
  <a href="https://www.rfc-editor.org/rfc/rfc8259">RFC-8279</a> JSON text for
  output and/or storage.</p></li>
</ol>

<p>Step 2 is the essential operation that you want to accomplish.  Steps
1 and 3 are just overhead.</p>

<p>Historically, SQLite used an internal binary
representation of JSON that involved lots of pointers.  This fits
will into C programs, but it is difficult to serialize.
The JSONB rewrite changes the internal-use binary representation of
JSON into a contiguous byte array that can read or written as an SQL BLOB.
This allows the internal-use representation of JSON to potentially be
saved to the database, in place of JSON text, eliminating the overhead
of steps 1 and 3.</p>

<h2>What has changed?</h2>
<p>All legacy functionality is preserved.  The only change has been to add
new capabilities.</p>

<p>Any JSON function that accepts JSON text as an input will now also accept
JSONB binary content for that same parameter.  You do not have to tell the
function if it getting text or binary data.  It figures that out for itself.</p>

<p>JSON functions that output JSON now come in two versions.  The historical
&#34;<tt>json_</tt>&#34; functions works as before.  But there is now a corresponding
&#34;<tt>jsonb_</tt>&#34; function that returns JSONB rather than text JSON, thus
omitting step 3 in the normal processing.</p>

<p>If you don&#39;t make any changes to your application, everything should
continue to work as it always has, though perhaps slightly (1%) faster.</p>

<p>But if you modify your application to start storing JSONB instead of text
JSON, you might see a 3-times performance improvement, at least for the
JSON-intensive operations.  JSONB is also slightly smaller than text JSON
in most cases (about 5% or 10% smaller) so you might also see a modest
reduction in your database size if you use a lot of JSON.</p>

<h2>Migrating</h2>
<p>Note that all functions accept both text JSON and JSONB.  So to start using
JSONB, you do <u>not</u> have to modify your database files to convert
legacy text JSON into JSONB.  Just start writing out JSONB for new entries.
The old entries will continue to work.  The new entries will just work
faster.</p>

<p>Or, if you do want to convert all your legacy data to JSONB, you can just
run an update operation like:</p>

<blockquote>
<pre><code>UPDATE bigtable SET jsonColumn = jsonb(jsonColumn);
</code></pre></blockquote>

<h2>Please provide comments</h2>
<p>If you find this enhancement useful, or if you try it out and see performance
regressions or bugs, please let us know.  Leave a follow-up post here, or
contact me directly at drh at sqlite dot org.</p>

<p>The current plan is to release the JSONB enhancement in the next
major release of SQLite - version 3.45.0.  That will probably occur
in a month or two.</p>

</div>

</div></div>
  </body>
</html>
