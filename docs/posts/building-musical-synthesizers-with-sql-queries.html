<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ClickHouse/NoiSQL">Original</a>
    <h1>Show HN: Building musical synthesizers with SQL queries</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">NoiSQL (named after <a href="https://en.wikipedia.org/wiki/Robert_Noyce" rel="nofollow">Robert Noyce</a>) shows how to play sound and music with declarative SQL queries.</p>
<p dir="auto">It contains oscillators for basic waves, envelopes, sequencers, arpeggiators, effects (distortion, delay), noise generators, AM and FM, and LFO, ...
Sometimes it can generate something nice, but usually not.</p>

<ul dir="auto">
<li><a href="#noisql---generating-music-with-sql-queries">NoiSQL â€” Generating Music With SQL Queries</a>
<ul dir="auto">
<li><a href="#quick-start---linux">Quick Start - Linux</a></li>
<li><a href="#quick-start---macos">Quick Start - MacOS</a></li>
<li><a href="#bleeps-and-bloops---a-demonstration">Bleeps and Bloops - a demonstration</a></li>
<li><a href="#examples">Examples</a></li>
</ul>
</li>
<li><a href="#how-it-works">How It Works</a>
<ul dir="auto">
<li><a href="#making-something-interesting">Making Something Interesting</a>
<ul dir="auto">
<li><a href="#input">Input</a></li>
<li><a href="#output-control">Output Control</a></li>
<li><a href="#basic-waves">Basic waves</a></li>
<li><a href="#helpers-and-lfo">Helpers and LFO</a></li>
<li><a href="#noise">Noise</a></li>
<li><a href="#distortion">Distortion</a></li>
<li><a href="#envelopes">Envelopes</a></li>
<li><a href="#sequencers">Sequencers</a></li>
<li><a href="#delay">Delay</a></li>
<li><a href="#components">Components</a></li>
<li><a href="#combine-it">Combine It</a></li>
<li><a href="#additional-commands">Additional Commands</a></li>
</ul>
</li>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#further-directions">Further Directions</a></li>
</ul>
</li>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#contributing">Contributing</a>
<ul dir="auto">
<li><a href="#reading-corner">Reading Corner</a></li>
</ul>
</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-quick-start---linux" aria-hidden="true" href="#quick-start---linux"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Quick Start - Linux</h2>
<p dir="auto">Clone the Repository.</p>
<p dir="auto">Download clickhouse-local:</p>
<div data-snippet-clipboard-copy-content="curl https://clickhouse.com/ | sh"><pre><code>curl https://clickhouse.com/ | sh
</code></pre></div>
<p dir="auto">Install (Linux):</p>
<div data-snippet-clipboard-copy-content="sudo ./clickhouse install"><pre><code>sudo ./clickhouse install
</code></pre></div>
<p dir="auto">Check the installation:</p>
<div data-snippet-clipboard-copy-content="clickhouse-local --version"><pre><code>clickhouse-local --version
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-quick-start---macos" aria-hidden="true" href="#quick-start---macos"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Quick Start - MacOS</h2>
<p dir="auto">Before beginning, please ensure that you have <a href="https://brew.sh/" rel="nofollow">homebrew</a> installed.</p>
<p dir="auto">Clone the Repository.</p>
<p dir="auto">Change to the Repository folder (i.e. <code>cd NoiSQL</code>)</p>
<p dir="auto">Install ClickHouse (macOS):</p>
<div data-snippet-clipboard-copy-content="mkdir -p bin
mv clickhouse bin/clickhouse-local
export PATH=&#34;$(pwd)/bin:$PATH&#34;"><pre><code>mkdir -p bin
mv clickhouse bin/clickhouse-local
export PATH=&#34;$(pwd)/bin:$PATH&#34;
</code></pre></div>
<p dir="auto"><em>NOTE: If you want this to live past a terminal restart add to your profile. That may look something like the below or <code>.bash_profile</code> or <code>.zshrc</code> depending on your terminal of choice.</em></p>
<div data-snippet-clipboard-copy-content="echo &#39;export PATH=&#34;&#39;$(pwd)&#39;/bin:$PATH&#34;&#39; &gt;&gt; .profile"><pre><code>echo &#39;export PATH=&#34;&#39;$(pwd)&#39;/bin:$PATH&#34;&#39; &gt;&gt; .profile
</code></pre></div>
<p dir="auto">In order to playback audio from the terminal (via STDIN) we use an open source project (with a convenient brew recipe) called &#39;sox&#39;</p>

<h2 tabindex="-1" dir="auto"><a id="user-content-bleeps-and-bloops---a-demonstration" aria-hidden="true" href="#bleeps-and-bloops---a-demonstration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bleeps and Bloops - a demonstration</h2>
<p dir="auto">Now, ClickHouse Local is setup and it is time to make our first noises.</p>
<p dir="auto">Demo (Linux):</p>
<div data-snippet-clipboard-copy-content="./music2.sql.sh | aplay -f cd"><pre><code>./music2.sql.sh | aplay -f cd
</code></pre></div>
<p dir="auto">Demo (macOS):</p>
<div data-snippet-clipboard-copy-content="./music2.sql.sh | play -t raw -b 16 -e signed -c 2 -r 44100 -v .75 -"><pre><code>./music2.sql.sh | play -t raw -b 16 -e signed -c 2 -r 44100 -v .75 -
</code></pre></div>
<p dir="auto">Live editing (Linux):</p>
<div data-snippet-clipboard-copy-content="sudo apt install inotifytools
./play.sh music0.sql"><pre><code>sudo apt install inotifytools
./play.sh music0.sql
</code></pre></div>
<p dir="auto">You can edit the <code>music0.sql</code> file, and the changes will automatically apply while playing. On macOS this is not possible due to the lack of inotifytools BUT the play script can be used to play any of the samples music*.sql files provided</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-examples" aria-hidden="true" href="#examples"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Examples</h2>
<p dir="auto">If, you are unable to use it yourself. You can still hear the output as .mp4 here.</p>
<video src="https://user-images.githubusercontent.com/18581488/229301700-d71d5a9c-ad7e-492b-80ba-d49114fd0bfe.mp4" data-canonical-src="https://user-images.githubusercontent.com/18581488/229301700-d71d5a9c-ad7e-492b-80ba-d49114fd0bfe.mp4" controls="controls" muted="muted">

  </video>
<video src="https://user-images.githubusercontent.com/18581488/229301704-d82d89b7-7650-44eb-a525-0630888d2080.mp4" data-canonical-src="https://user-images.githubusercontent.com/18581488/229301704-d82d89b7-7650-44eb-a525-0630888d2080.mp4" controls="controls" muted="muted">

  </video>
<video src="https://user-images.githubusercontent.com/18581488/229301706-8e14b0c1-01a9-47a5-84dd-8a069832e63f.mp4" data-canonical-src="https://user-images.githubusercontent.com/18581488/229301706-8e14b0c1-01a9-47a5-84dd-8a069832e63f.mp4" controls="controls" muted="muted">

  </video>
<video src="https://user-images.githubusercontent.com/18581488/229301709-9a102865-be02-4072-8707-48a6a571c500.mp4" data-canonical-src="https://user-images.githubusercontent.com/18581488/229301709-9a102865-be02-4072-8707-48a6a571c500.mp4" controls="controls" muted="muted">

  </video>
<hr/>

<p dir="auto">An SQL query selects from the <code>system.numbers</code> table, containing a sequence of natural numbers, and transforms this sequence into a PCM audio signal in the CD format. This output signal is piped to the <code>aplay -f cd</code> tool (on Linux) to play it.</p>
<p dir="auto">The CD (Compact Disc Audio) format is a 44100 Hz 16-bit stereo PCM signal.</p>
<ul dir="auto">
<li><strong>44100 Hz</strong> is the &#34;sampling frequency&#34;, meaning that the signal has a value 44 100 times every second;</li>
<li><strong>16 bit</strong> is the precision of every value, and the value is represented by <code>Int16</code> (signed, two&#39;s complement, little endian) integer;</li>
<li><strong>stereo</strong> means that we have two values at every sample - for the left channel and for the right channel;</li>
</ul>
<p dir="auto">The signal is represented in binary, corresponding to the ClickHouse&#39;s <code>RowBinary</code> format. Therefore, the bit rate of the signal is 16 * 2 * 44100 = 1411 kBit.</p>
<p dir="auto">Although we could also use the classic 8-bit mono 9 kHz format, the CD format gives more possibilities.</p>
<p dir="auto">To get the idea, run this:</p>
<div data-snippet-clipboard-copy-content="clickhouse-local --query &#34;
    SELECT 
        (number % 44100)::Int16           AS left, 
        ((number + 22050) % 44100)::Int16 AS right 
    FROM system.numbers
    FORMAT RowBinary&#34; | aplay -f cd"><pre><code>clickhouse-local --query &#34;
    SELECT 
        (number % 44100)::Int16           AS left, 
        ((number + 22050) % 44100)::Int16 AS right 
    FROM system.numbers
    FORMAT RowBinary&#34; | aplay -f cd
</code></pre></div>
<p dir="auto">It will give you an uninteresting clicky sound.</p>
<div data-snippet-clipboard-copy-content="clickhouse-local --query &#34;
    WITH number * 2 * pi() / 44100 AS time 
    SELECT
        (sin(time * 200) * 0x7FFF)::Int16 AS left,
        (sin(time * 400) * 0x7FFF)::Int16 AS right
    FROM system.numbers
    FORMAT RowBinary&#34; | aplay -f cd"><pre><code>clickhouse-local --query &#34;
    WITH number * 2 * pi() / 44100 AS time 
    SELECT
        (sin(time * 200) * 0x7FFF)::Int16 AS left,
        (sin(time * 400) * 0x7FFF)::Int16 AS right
    FROM system.numbers
    FORMAT RowBinary&#34; | aplay -f cd
</code></pre></div>
<p dir="auto">It will give you uninteresting waves.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-making-something-interesting" aria-hidden="true" href="#making-something-interesting"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Making Something Interesting</h2>
<p dir="auto">Here is a query from <a href="https://thewitchofendor.com/ClickHouse/NoiSQL/blob/main/music0.sql">music0.sql</a>, that generates something at least listenable. Let&#39;s walk through this SQL query.</p>
<p dir="auto">The WITH clause in the SQL query allows defining expressions for further use.
We can define both constants and functions (in form of lambda expressions).
We use the <code>allow_experimental_analyzer</code> setting to make this query possible.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-input" aria-hidden="true" href="#input"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Input</h3>
<p dir="auto">Let&#39;s define the <code>time</code> column to be a floating point value representing the number of seconds.</p>
<div data-snippet-clipboard-copy-content="WITH

44100 AS sample_frequency
, number AS tick
, tick / sample_frequency AS time"><pre><code>WITH

44100 AS sample_frequency
, number AS tick
, tick / sample_frequency AS time
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-output-control" aria-hidden="true" href="#output-control"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Output Control</h3>
<p dir="auto">Let us work with the signal in the floating point format, with values in the <code>[-1, 1]</code> range.
Here are the functions to convert it to the output PCM CD signal.</p>
<p dir="auto">A knob for the volume:</p>

<p dir="auto">If the signal exceeds the boundaries, it will be clipped:</p>
<div data-snippet-clipboard-copy-content=", level -&gt; least(1.0, greatest(-1.0, level)) AS clamp"><pre><code>, level -&gt; least(1.0, greatest(-1.0, level)) AS clamp
</code></pre></div>
<p dir="auto">Floating point values are converted to Int16 for the output:</p>
<div data-snippet-clipboard-copy-content=", level -&gt; (clamp(level) * 0x7FFF * master_volume)::Int16 AS output"><pre><code>, level -&gt; (clamp(level) * 0x7FFF * master_volume)::Int16 AS output
</code></pre></div>
<p dir="auto">If we don&#39;t care about stereo - we can simply output a tuple (pair) of identical values:</p>

<h3 tabindex="-1" dir="auto"><a id="user-content-basic-waves" aria-hidden="true" href="#basic-waves"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Basic waves</h3>
<p dir="auto">We define oscillators as functions of time, with the period adjusted to be one second.
You can modify the frequency simply by multiplying the time argument.
For example, <code>sine_wave(time * 400)</code> - a sine wave of 400 Hz frequency.</p>
<p dir="auto">The sine wave gives the cleanest and most boring sound.</p>
<div data-snippet-clipboard-copy-content=", time -&gt; sin(time * 2 * pi()) AS sine_wave"><pre><code>, time -&gt; sin(time * 2 * pi()) AS sine_wave
</code></pre></div>
<p dir="auto">The <a href="https://en.wikipedia.org/wiki/Square_wave" rel="nofollow">square wave</a> gives a very harsh sound; it can be imagined as a maximally-distorted sine wave.</p>
<div data-snippet-clipboard-copy-content=", time -&gt; time::UInt64 % 2 * 2 - 1 AS square_wave"><pre><code>, time -&gt; time::UInt64 % 2 * 2 - 1 AS square_wave
</code></pre></div>
<p dir="auto">Sawtooth wave</p>
<div data-snippet-clipboard-copy-content=", time -&gt; (time - floor(time)) * 2 - 1 AS sawtooth_wave"><pre><code>, time -&gt; (time - floor(time)) * 2 - 1 AS sawtooth_wave
</code></pre></div>
<p dir="auto">Triangle wave</p>
<div data-snippet-clipboard-copy-content=", time -&gt; abs(sawtooth_wave(time)) * 2 - 1 AS triangle_wave"><pre><code>, time -&gt; abs(sawtooth_wave(time)) * 2 - 1 AS triangle_wave
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-helpers-and-lfo" aria-hidden="true" href="#helpers-and-lfo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Helpers and LFO</h3>
<p dir="auto">LFO means &#34;Low-Frequency Oscillation,&#34; and it is used to control a parameter of one signal with another low-frequency signal.
It can have multiple interesting effects.</p>
<p dir="auto">For example, AM - amplitude modulation is modulating the volume of one signal with another signal, and it will give a trembling effect, making your sine waves sound more natural.</p>
<p dir="auto">Another example, FM - frequency modulation, is making the frequency of one signal change with another frequency.
See <a href="https://www.youtube.com/watch?v=vvBl3YUBUyY" rel="nofollow">the explanation</a>.</p>
<p dir="auto">We take the wave and map it to the <code>[from, to]</code> interval:</p>
<div data-snippet-clipboard-copy-content=", (from, to, wave, time) -&gt; from + ((wave(time) + 1) / 2) * (to - from) AS lfo"><pre><code>, (from, to, wave, time) -&gt; from + ((wave(time) + 1) / 2) * (to - from) AS lfo
</code></pre></div>
<p dir="auto">Here is a discrete version of an LFO. It allows changing the signal as a step function:</p>
<div data-snippet-clipboard-copy-content=", (from, to, steps, time) -&gt; from + floor((time - floor(time)) * steps) / steps * (to - from) AS step_lfo"><pre><code>, (from, to, steps, time) -&gt; from + floor((time - floor(time)) * steps) / steps * (to - from) AS step_lfo
</code></pre></div>
<p dir="auto">For some unknown reason, the frequencies of musical notes (&#34;musical scale&#34;) are exponentially distributed, so sometimes we have to apply computations in the <a href="https://en.wikipedia.org/wiki/Curvilinear_coordinates" rel="nofollow">logarithmic coordinates</a> to make a more pleasant sound:</p>
<div data-snippet-clipboard-copy-content=", (from, to, steps, time) -&gt; exp(step_lfo(log(from), log(to), steps, time)) AS exp_step_lfo"><pre><code>, (from, to, steps, time) -&gt; exp(step_lfo(log(from), log(to), steps, time)) AS exp_step_lfo
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-noise" aria-hidden="true" href="#noise"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Noise</h3>
<p dir="auto">Generating noise is easy. We just need random numbers.</p>
<p dir="auto">But we want the noise to be deterministic (determined by the time) for further processing.
That&#39;s why we use <code>cityHash64</code> instead of a random and <code>erf</code> instead of <code>randNormal</code>.</p>
<p dir="auto">All the following are variants of white noise. Although we can also generate <a href="https://en.wikipedia.org/wiki/Brownian_noise" rel="nofollow">brown noise</a> with the help of <code>runningAccumulate</code>.</p>
<div data-snippet-clipboard-copy-content=", time -&gt; cityHash64(time) / 0xFFFFFFFFFFFFFFFF AS uniform_noise
, time -&gt; erf(uniform_noise(time)) AS white_noise
, time -&gt; cityHash64(time) % 2 ? 1 : -1 AS bernoulli_noise"><pre><code>, time -&gt; cityHash64(time) / 0xFFFFFFFFFFFFFFFF AS uniform_noise
, time -&gt; erf(uniform_noise(time)) AS white_noise
, time -&gt; cityHash64(time) % 2 ? 1 : -1 AS bernoulli_noise
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-distortion" aria-hidden="true" href="#distortion"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Distortion</h3>
<p dir="auto">Distortion alters the signal in various ways to make it sound less boring.</p>
<p dir="auto">The harshest distortion - clipping - amplifies the signal, then clips what&#39;s above the range.
It adds higher harmonics and makes sound more metallic, and makes sine waves more square.</p>
<div data-snippet-clipboard-copy-content=", (x, amount) -&gt; clamp(x * amount) AS clipping"><pre><code>, (x, amount) -&gt; clamp(x * amount) AS clipping
</code></pre></div>
<p dir="auto">For a milder version, it makes sense to apply the <code>pow</code> function, such as square root to the <code>[-1, 1]</code> signal:</p>
<div data-snippet-clipboard-copy-content=", (x, amount) -&gt; clamp(x &gt; 0 ? pow(x, amount) : -pow(-x, amount)) AS power_distortion"><pre><code>, (x, amount) -&gt; clamp(x &gt; 0 ? pow(x, amount) : -pow(-x, amount)) AS power_distortion
</code></pre></div>
<p dir="auto">We can reduce the number of bits in the values of the signal, making it more coarse.
It adds some sort of noise, making it sound worn out.</p>
<div data-snippet-clipboard-copy-content=", (x, amount) -&gt; round(x * exp2(amount)) / exp2(amount) AS bitcrush"><pre><code>, (x, amount) -&gt; round(x * exp2(amount)) / exp2(amount) AS bitcrush
</code></pre></div>
<p dir="auto">Lowering the sample rate makes the signal dirty. Try to apply it for white noise.</p>
<div data-snippet-clipboard-copy-content=", (time, sample_frequency) -&gt; round(time * sample_frequency) / sample_frequency AS desample"><pre><code>, (time, sample_frequency) -&gt; round(time * sample_frequency) / sample_frequency AS desample
</code></pre></div>
<p dir="auto">Something like compressing the periodic components in time and adding empty space - no idea why I need it:</p>
<div data-snippet-clipboard-copy-content=", (time, wave, amount) -&gt; (time - floor(time) &lt; (1 - amount)) ? wave(time * (1 - amount)) : 0 AS thin"><pre><code>, (time, wave, amount) -&gt; (time - floor(time) &lt; (1 - amount)) ? wave(time * (1 - amount)) : 0 AS thin
</code></pre></div>
<p dir="auto">Skewing the waves in time making sine ways more similar to sawtooth waves:</p>
<div data-snippet-clipboard-copy-content=", (time, wave, amount) -&gt; wave(floor(time) + pow(time - floor(time), amount)) AS skew"><pre><code>, (time, wave, amount) -&gt; wave(floor(time) + pow(time - floor(time), amount)) AS skew
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-envelopes" aria-hidden="true" href="#envelopes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Envelopes</h3>
<p dir="auto">The envelope is a way to make the signal sound like a note of a keyboard musical instrument, such as a piano.</p>
<p dir="auto">It modulates the volume of the signal by:</p>
<ul dir="auto">
<li>attack - time for the sound to appear;</li>
<li>hold - time for the sound to play at maximum volume;</li>
<li>release - time for the sound to decay to zero;</li>
</ul>
<p dir="auto">This is a simplification of what typical envelopes are, but it&#39;s good enough.</p>
<div data-snippet-clipboard-copy-content=", (time, offset, attack, hold, release) -&gt;
       time &lt; offset ? 0
    : (time &lt; offset + attack                  ? ((time - offset) / attack)
    : (time &lt; offset + attack + hold           ? 1
    : (time &lt; offset + attack + hold + release ? (offset + attack + hold + release - time) / release
    : 0))) AS envelope"><pre><code>, (time, offset, attack, hold, release) -&gt;
       time &lt; offset ? 0
    : (time &lt; offset + attack                  ? ((time - offset) / attack)
    : (time &lt; offset + attack + hold           ? 1
    : (time &lt; offset + attack + hold + release ? (offset + attack + hold + release - time) / release
    : 0))) AS envelope
</code></pre></div>
<p dir="auto">We can make the musical note sound periodically to define a rhythm.
For convenience, we define &#34;bpm&#34; as &#34;beats per minute&#34; and make it sound once in every beat.</p>
<div data-snippet-clipboard-copy-content=", (bpm, time, offset, attack, hold, release) -&gt;
    envelope(
        time * (bpm / 60) - floor(time * (bpm / 60)),
        offset,
        attack,
        hold,
        release) AS running_envelope"><pre><code>, (bpm, time, offset, attack, hold, release) -&gt;
    envelope(
        time * (bpm / 60) - floor(time * (bpm / 60)),
        offset,
        attack,
        hold,
        release) AS running_envelope
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-sequencers" aria-hidden="true" href="#sequencers"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Sequencers</h3>
<p dir="auto">To create a melody, we need a sequence of notes. A sequencer generates it.</p>
<p dir="auto">In the first example, we simply take it from an array and make it repeat indefinitely:</p>
<div data-snippet-clipboard-copy-content=", (sequence, time) -&gt; sequence[1 + time::UInt64 % length(sequence)] AS sequencer"><pre><code>, (sequence, time) -&gt; sequence[1 + time::UInt64 % length(sequence)] AS sequencer
</code></pre></div>
<p dir="auto">But the obvious way to generate a melody is to take a <a href="https://en.wikipedia.org/wiki/Sierpi%C5%84ski_triangle" rel="nofollow">Sierpinski triangle</a>.</p>
<p dir="auto">Sierpinski triangles sound delicious:</p>
<div data-snippet-clipboard-copy-content=", time -&gt; bitAnd(time::UInt8, time::UInt8 * 8) AS sierpinski"><pre><code>, time -&gt; bitAnd(time::UInt8, time::UInt8 * 8) AS sierpinski
</code></pre></div>
<p dir="auto">Another way is to map the number of bits in a number to a musical note:</p>
<div data-snippet-clipboard-copy-content=", time -&gt; bitCount(time::UInt64) AS bit_count"><pre><code>, time -&gt; bitCount(time::UInt64) AS bit_count
</code></pre></div>
<p dir="auto">Calculating the number of trailing zero bits gives us a nice arpeggiator:</p>
<div data-snippet-clipboard-copy-content=", time -&gt; log2(time::UInt64 &gt; 0 ? bitXor(time::UInt64, time::UInt64 - 1) : 1) AS trailing_zero_bits"><pre><code>, time -&gt; log2(time::UInt64 &gt; 0 ? bitXor(time::UInt64, time::UInt64 - 1) : 1) AS trailing_zero_bits
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-delay" aria-hidden="true" href="#delay"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Delay</h3>
<p dir="auto">If you ever wanted to generate dub music, you cannot go without a delay effect:</p>
<div data-snippet-clipboard-copy-content=", (time, wave, delay, decay, count) -&gt; arraySum(n -&gt; wave(time - delay * n) * pow(decay, n), range(count)) AS delay"><pre><code>, (time, wave, delay, decay, count) -&gt; arraySum(n -&gt; wave(time - delay * n) * pow(decay, n), range(count)) AS delay
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-components" aria-hidden="true" href="#components"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Components</h3>
<p dir="auto">Here is a kick:</p>
<div data-snippet-clipboard-copy-content="sine_wave(time * 50) * running_envelope(120, time, 0, 0.01, 0.01, 0.025) AS kick,"><pre><code>sine_wave(time * 50) * running_envelope(120, time, 0, 0.01, 0.01, 0.025) AS kick,
</code></pre></div>
<p dir="auto">Here is a snare:</p>
<div data-snippet-clipboard-copy-content="white_noise(time) * running_envelope(120, time, 0.5, 0.01, 0.01, 0.05) AS snare,"><pre><code>white_noise(time) * running_envelope(120, time, 0.5, 0.01, 0.01, 0.05) AS snare,
</code></pre></div>
<p dir="auto">Let&#39;s also define five melodies.</p>
<p dir="auto">What is the idea? Let&#39;s take a <a href="https://www.youtube.com/watch?v=IZHiBJGcrqI" rel="nofollow">Sierpinski triangle</a>, put it into a sine wave, add FM to make it even fancier, and apply a few LFOs over the place.</p>
<div data-snippet-clipboard-copy-content="sine_wave(
    time * (100 * exp2(trailing_zero_bits(time * 8) % 12 / 6))
  + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.01, 0.1, 0.5)
    * lfo(0, 1, sine_wave, time / 12
    ) AS melody1,
  
sine_wave(time * (200 * exp2(bit_count(time * 8) % 12 / 6))
  + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.11, 0.1, 0.5) * lfo(0, 1, sine_wave, time / 24
    ) AS melody2,
    
sine_wave(time * (400 * exp2(sierpinski(time * 8) % 12 / 6))
    + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.21, 0.1, 0.5) * lfo(0, 1, sine_wave, time / 32
    ) AS melody3,
    
sine_wave(time * (800 / exp2(trailing_zero_bits(time * 8) % 12 / 6))
    + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.31, 0.1, 0.5) * lfo(0, 1, sine_wave, time / 16
    ) AS melody4"><pre><code>sine_wave(
    time * (100 * exp2(trailing_zero_bits(time * 8) % 12 / 6))
  + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.01, 0.1, 0.5)
    * lfo(0, 1, sine_wave, time / 12
    ) AS melody1,
  
sine_wave(time * (200 * exp2(bit_count(time * 8) % 12 / 6))
  + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.11, 0.1, 0.5) * lfo(0, 1, sine_wave, time / 24
    ) AS melody2,
    
sine_wave(time * (400 * exp2(sierpinski(time * 8) % 12 / 6))
    + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.21, 0.1, 0.5) * lfo(0, 1, sine_wave, time / 32
    ) AS melody3,
    
sine_wave(time * (800 / exp2(trailing_zero_bits(time * 8) % 12 / 6))
    + sine_wave(time * 3 + 1/4)) * 0.25 * lfo(0.5, 1, sine_wave, time * 11)
    * running_envelope(480, time, 0, 0.31, 0.1, 0.5) * lfo(0, 1, sine_wave, time / 16
    ) AS melody4
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-combine-it" aria-hidden="true" href="#combine-it"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Combine It</h3>
<p dir="auto">So, what will happen if we mix together some garbage and listen to it?</p>
<div data-snippet-clipboard-copy-content="SELECT

mono(output(
      1.0   * melody1
    + 0.5   * melody2
    + 0.25  * melody3
    + 1.0   * melody4
    + 1     * kick
    + 0.025 * snare))

FROM table;"><pre><code>SELECT

mono(output(
      1.0   * melody1
    + 0.5   * melody2
    + 0.25  * melody3
    + 1.0   * melody4
    + 1     * kick
    + 0.025 * snare))

FROM table;
</code></pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-additional-commands" aria-hidden="true" href="#additional-commands"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Additional Commands</h3>
<p dir="auto">Generate five minutes of audio and write to a <code>.pcm</code> file:</p>
<div data-snippet-clipboard-copy-content="clickhouse-local --format RowBinary --query &#34;SELECT * FROM system.numbers LIMIT 44100 * 5 * 60&#34; \
 | clickhouse-local --allow_experimental_analyzer 1 --format RowBinary --structure &#34;number UInt64&#34; --queries-file music0.sql \
&gt; music0.pcm"><pre><code>clickhouse-local --format RowBinary --query &#34;SELECT * FROM system.numbers LIMIT 44100 * 5 * 60&#34; \
 | clickhouse-local --allow_experimental_analyzer 1 --format RowBinary --structure &#34;number UInt64&#34; --queries-file music0.sql \
&gt; music0.pcm
</code></pre></div>
<p dir="auto">Convert <code>pcm</code> to <code>wav</code>:</p>
<div data-snippet-clipboard-copy-content="ffmpeg -f s16le -ar 44.1k -ac 2 -i music0.pcm music0.wav"><pre><code>ffmpeg -f s16le -ar 44.1k -ac 2 -i music0.pcm music0.wav
</code></pre></div>
<p dir="auto">Convert <code>pcm</code> to <code>mp4</code>:</p>
<div data-snippet-clipboard-copy-content="ffmpeg -f s16le -ar 44.1k -ac 2 -i music0.pcm music0.mp4"><pre><code>ffmpeg -f s16le -ar 44.1k -ac 2 -i music0.pcm music0.mp4
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-limitations" aria-hidden="true" href="#limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Limitations</h2>
<p dir="auto">I haven&#39;t, yet, found a good way to implement filters (low-pass, high-pass, band-pass, etc.). It does not have Fourier transform, and we cannot operate on the frequency domain. However, the moving average can suffice as a simple filter.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-further-directions" aria-hidden="true" href="#further-directions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Further Directions</h2>
<p dir="auto">You can use ClickHouse as a sampler - storing the prepared musical samples in the table and arranging them with SELECT queries. For example, the <a href="https://modarchive.org/" rel="nofollow">Mod Archive</a> can help.</p>
<p dir="auto">You can use ClickHouse as a vocoder. Just provide the microphone input signal instead of the <code>system.numbers</code> as a table to <code>clickhouse-local</code>.</p>
<p dir="auto">You can make the queries parameterized, replacing all the hundreds of constants with parameters. Then attach a device with hundreds of knobs and faders to your PC and provide their values of them as a streaming input table. Then you can control your sound like a pro.</p>
<p dir="auto">Real-time video generation can be added as well.</p>

<p dir="auto">This is a fun project and neither a good nor convenient solution to a problem. Better solutions exist.</p>
<p dir="auto">There is not much sense in this project, although it can facilitate testing ClickHouse.</p>
<p dir="auto">You could argue that modern AI, for example, <a href="https://www.riffusion.com/" rel="nofollow">Riffusion</a>, can do a better job. The counterargument is - if you enjoy what you are doing, it&#39;s better not to care if someone does it better but with less pleasure.</p>

<p dir="auto">If you want to share new interesting examples, please make a pull request, adding them directly to this repository!</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-reading-corner" aria-hidden="true" href="#reading-corner"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Reading Corner</h2>
<ul dir="auto">
<li><a href="https://ciechanow.ski/sound/" rel="nofollow">Sound</a> by Bartosz Ciechanowski;</li>
<li><a href="https://www.youtube.com/watch?v=tCRPUv8V22o" rel="nofollow">Bytebeat</a>;</li>
<li><a href="https://en.wikipedia.org/wiki/Colors_of_noise" rel="nofollow">Color of Noise</a>;</li>
<li><a href="https://www.youtube.com/watch?v=adoF2Lc70J8" rel="nofollow">Glitchmachine</a>;</li>
<li><a href="https://www.youtube.com/watch?v=F1RsE4J9k9w" rel="nofollow">Audio Synthesis</a>;</li>
<li><a href="https://en.wikipedia.org/wiki/44,100_Hz" rel="nofollow">44,100 Hz</a>;</li>
</ul>
</article>
          </div></div>
  </body>
</html>
