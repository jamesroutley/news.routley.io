<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jpmens.net/2016/03/05/a-shell-command-to-create-json-jo/">Original</a>
    <h1>Jo – a shell command to create JSON</h1>
    
    <div id="readability-page-1" class="page"><div id="content">  
	    <div id="searchres">
		<div id="4171">
		    
		    <p>I got tired of attempting to get shell scripts to produce valid <a href="http://json.org">JSON</a>. You’ve likely seen something like this before:</p>

<figure><pre><code data-lang="bash"><span>echo</span> <span>&#39;{&#34;name&#34;:&#34;Jane&#34;}&#39;</span></code></pre></figure>

<p>It gets merrier if an element contains an environment variable: open double, close single, add variable, open single, blergh.</p>

<p>A here! script will do it as will a a printf(1), but neither much improve legibility, and if strings contain quotes, it becomes almost impossible to make a script produce JSON.</p>

<figure><pre><code data-lang="bash"><span>printf</span> <span>&#39;{&#34;name&#34;: &#34;%s&#34;}\n&#39;</span> <span>&#34;Jane&#34;</span></code></pre></figure>

<p><img src="https://jpmens.net/media/2016b/jo-logo.png" alt="Logo"/></p>

<p>Enter <a href="https://github.com/jpmens/jo">jo</a>:</p>

<figure><pre><code data-lang="bash"><span>$ </span>jo <span>name</span><span>=</span>Jane
<span>{</span><span>&#34;name&#34;</span>:<span>&#34;Jane&#34;</span><span>}</span></code></pre></figure>

<p>The idea occurred to me late at night, and I don’t know why this has taken so long to happen:</p>

<figure><pre><code data-lang="bash"><span>$ </span>jo <span>time</span><span>=</span><span>$(</span><span>date</span> +%s<span>)</span> <span>dir</span><span>=</span><span>$HOME</span>
<span>{</span><span>&#34;time&#34;</span>:1457195712,<span>&#34;dir&#34;</span>:<span>&#34;/Users/jpm&#34;</span><span>}</span></code></pre></figure>

<p>Bam! Jo tries to be clever about types and knows <code>null</code>, booleans, strings and numbers. It does arrays, and it pretty-prints on demand:</p>

<figure><pre><code data-lang="bash"><span>$ </span>jo <span>-p</span> <span>-a</span> spring summer winter
<span>[</span>
   <span>&#34;spring&#34;</span>,
   <span>&#34;summer&#34;</span>,
   <span>&#34;winter&#34;</span>
<span>]</span></code></pre></figure>

<p>Inspired by <a href="https://news.ycombinator.com/item?id=11230023">a comment on HN</a>, I added another hack: if a key’s value begins with an opening brace (<code>{</code>) or a bracket (<code>[</code>]) we attempt to decode JSON from it; this allows <a href="https://github.com/jpmens/jo">jo</a> to add objects or arrays (use <code>-a</code>!) to itself. Watch:</p>

<figure><pre><code data-lang="bash"><span>$ </span>jo <span>-p</span> <span>name</span><span>=</span>JP <span>object</span><span>=</span><span>$(</span>jo <span>fruit</span><span>=</span>Orange <span>point</span><span>=</span><span>$(</span>jo <span>x</span><span>=</span>10 <span>y</span><span>=</span>20<span>)</span> <span>number</span><span>=</span>17<span>)</span> <span>sunday</span><span>=</span><span>false</span>
<span>{</span>
   <span>&#34;name&#34;</span>: <span>&#34;JP&#34;</span>,
   <span>&#34;object&#34;</span>: <span>{</span>
      <span>&#34;fruit&#34;</span>: <span>&#34;Orange&#34;</span>,
      <span>&#34;point&#34;</span>: <span>{</span>
         <span>&#34;x&#34;</span>: 10,
         <span>&#34;y&#34;</span>: 20
      <span>}</span>,
      <span>&#34;number&#34;</span>: 17
   <span>}</span>,
   <span>&#34;sunday&#34;</span>: <span>false</span>
<span>}</span></code></pre></figure>

<p><a href="https://github.com/jpmens/jo">jo</a> also supports nested types natively:</p>

<figure><pre><code data-lang="bash"><span>$ </span>jo <span>-p</span> <span>number</span><span>=</span>17 <span>pass</span><span>=</span><span>true </span>geo[lon]<span>=</span>88 geo[cc]<span>=</span>ES point[]<span>=</span>1 point[]<span>=</span>2 geo[lat]<span>=</span>123.45
<span>{</span>
   <span>&#34;number&#34;</span>: 17,
   <span>&#34;pass&#34;</span>: <span>true</span>,
   <span>&#34;geo&#34;</span>: <span>{</span>
      <span>&#34;lon&#34;</span>: 88,
      <span>&#34;cc&#34;</span>: <span>&#34;ES&#34;</span>,
      <span>&#34;lat&#34;</span>: 123.45
   <span>}</span>,
   <span>&#34;point&#34;</span>: <span>[</span>
      1,
      2
   <span>]</span>
<span>}</span></code></pre></figure>

<p>Why did I do this? I need lots of <a href="http://json.org">JSON</a> for testing <a href="https://owntracks.org">OwnTracks</a>, and this just looks better in scripts.</p>

<figure><pre><code data-lang="bash"><span>$ </span>jo <span>_type</span><span>=</span>location <span>\</span>
   <span>cog</span><span>=</span><span>$((</span>RANDOM <span>%</span> <span>360</span><span>))</span> <span>\</span>
   <span>t</span><span>=</span>u <span>\</span>
   <span>lat</span><span>=</span>48.85833 <span>\</span>
   <span>lon</span><span>=</span>2.29513 <span>\</span>
   <span>acc</span><span>=</span>5 <span>\</span>
   <span>tid</span><span>=</span>JJ <span>\</span>
   <span>tst</span><span>=</span><span>$(</span><span>date</span> +%s<span>)</span> | mosquitto_pub <span>-t</span> owntracks/jjolie/test <span>-l</span></code></pre></figure>

<p>A <a href="https://github.com/jpmens/jo/issues/22">suggestion by Andrew Bibby</a> brought along the possibility of obtaining JSON element values from files, so I added <code>@file</code> to read a file (sans traling newline or carriage return) into a value as well as something which I use a lot, convert binary files to base64, using the <code>%file</code> syntax:</p>

<figure><pre><code data-lang="bash"><span>$ </span>jo <span>_type</span><span>=</span>card <span>name</span><span>=</span><span>&#34;Vanessa&#34;</span> <span>face</span><span>=</span>%vanessa.png
<span>{</span><span>&#34;_type&#34;</span>:<span>&#34;card&#34;</span>,<span>&#34;name&#34;</span>:<span>&#34;Vanessa&#34;</span>,<span>&#34;face&#34;</span>:<span>&#34;iVBORw0KGgoAAA ... QmCC&#34;</span><span>}</span></code></pre></figure>

<p>And it has a <a href="https://github.com/jpmens/jo/blob/master/jo.md">man page</a>. Go <a href="https://github.com/jpmens/jo">get it</a>. Jo!</p>

<p>Updates:</p>

<ul>
  <li><a href="https://twitter.com/Caius">Caius Durling</a> provided a <a href="https://github.com/caius/homebrew-jo">Homebrew tap for jo</a>, but <code>jo</code> is in Homebrew Formulae now, so <code>brew install jo</code>.</li>
  <li><a href="https://github.com/jpmens/jo">jo</a> has a logo which it created itself; colors inspired by something <a href="https://twitter.com/fcambus">Frederic Cambus</a> said :-)</li>
  <li><a href="https://twitter.com/lattera">Shawn Webb</a> added <em>jo</em> to <a href="https://github.com/HardenedBSD/hardenedbsd-ports/commit/3529fa5103f74c79872a1b071d4604eee34a6b8e">HardenedBSD’s ports</a>.</li>
  <li>I’ve converted <a href="https://github.com/jpmens/jo">jo</a> to use <em>autotools</em>; releases will be <a href="https://github.com/jpmens/jo/releases/">published here</a>.</li>
  <li><a href="https://twitter.com/al3hex">Alessio Sergi</a> has <a href="https://github.com/voidlinux/void-packages/commit/9b1e200d84ed35b7fdbac7aef478cafcc50b6fd7">added jo to voidlinux</a>; install with <code>xbps-install -Su jo</code></li>
  <li>I’ve built a Win32 binary which you can get from <a href="https://github.com/jpmens/jo/releases/">releases/</a>.</li>
  <li><a href="https://github.com/Lance0312">Lance Chen</a> has an <a href="https://aur.archlinux.org/packages/jo/">ArchLinux port of jo</a>.</li>
  <li>
    <p><a href="https://twitter.com/vince2_">Vincent Bernat</a> has submitted <a href="https://ftp-master.debian.org/new/jo_1.0-1.html">jo to Debian</a>.</p>

  </li>
</ul>



	
		

			<!-- postfoot -->


	
		</div><!-- post -->
	    </div><!-- inner -->
        </div></div>
  </body>
</html>
