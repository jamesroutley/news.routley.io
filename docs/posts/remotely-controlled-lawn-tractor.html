<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://offthegrid.dev/blog/remotely-controlled-lawn-mower">Original</a>
    <h1>Remotely Controlled Lawn Tractor</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><p>Demo of the finished project. If you want to know more, keep on reading.</p></div> <figure><iframe src="https://www.youtube.com/embed/ySDjQ4FAHPU?modestbranding=1&amp;playsinline=1&amp;fs=1&amp;rel=0"></iframe><figcaption>A quick drive around the chicken coop.</figcaption></figure><div><p>A quick look back at the project&#39;s origin, its progression, technology choices, and issues that plagued the first iteration of the project.</p></div><p>Unfortunately, I didn&#39;t document the progress of the project as I was building it. I started throwing ideas around for the project back in 2016 and some details and how I arrived at some of the design decisions escape me now. But, most of the important work is very recent so all the detail is here.</p><h2 id="how-it-all-started"><a href="#how-it-all-started">How it all started</a></h2><p>I have a large and grassy yard and after mowing it for what seemed like countless hours every year I wanted to make my life a bit easier. Initially, I wanted to build a remotely controlled lawn tractor using an RC flight controller. The idea seemed to be relatively simple and quick to implement, but this approach was done many times before so I wanted to do something different.</p><h3 id="first-steps"><a href="#first-steps">First steps</a></h3><p>I started with a basic proof-of-concept harness. I wired up a couple of DC motors to a motor controller and an RC transmitter. With the RC controller, I was able to drive the motors backward and forward. Since the motor controller (BasicMicro&#39;s RoboClaw) supports RC mode, it was an easy and simple way to kick things off.</p><figure><iframe src="https://www.youtube.com/embed/rRts3LJMejc?modestbranding=1&amp;playsinline=1&amp;fs=1&amp;rel=0"></iframe><figcaption>Bench test of two motors driven by RC signal.</figcaption></figure><h3 id="wires-and-bits-of-software-everywhere"><a href="#wires-and-bits-of-software-everywhere">Wires and bits of software everywhere</a></h3><p>When I started to piece it all together, all the components and breadboards were all over my workspace. GPS and the absolute orientation module were connected to PJRC&#39;s Teensy MCU (Microcontroller Unit - version 3.5). The Teensy 3.5, Xbox controller and two USB camera modules were connected to a USB hub and the hub was plugged into my laptop.</p><p>On the software side, I considered a desktop app to host the video feed and show sensor data visualizations. But the web app seemed more appropriate for the use case. It was more challenging and would allow me to remotely control the tractor from any device with a browser. I had to rethink the implementation of a lot of functionality and introduce new tooling.</p><ul><li>HUD (heads-up display) gauges - using <a target="_blank" rel="noopener noreferrer" href="https://canvas-gauges.com/">Canvas Gauges</a></li><li>Google Maps - with red tractor marker and GPS data fed to it from a Ublox NEO-7 module</li><li>Depiction of wheels and throttle position - drawn with <a target="_blank" rel="noopener noreferrer" href="http://paperjs.org/">Paper.js</a></li><li>Video from a USB camera module, using MJPEG stream, displayed as a background layer in the browser</li></ul><p>The server-side code responsible for communication between the MCU and the browser was done in Node.js.</p><h3 id="so-close-yet-so-far"><a href="#so-close-yet-so-far">So close yet so far</a></h3><p>Next, it was time to move away from breadboards and build a standalone tractor control enclosure. The enclosure would house all the electronics that needed to be mounted on the mower. For an onboard SBC (Single Board Computer), I went with the Raspberry Pi 3B due to its relatively low power consumption. In the meantime, I added another Teensy (3.2) to be a dedicated MCU for critical functions such as throttle and steering. The existing Teensy 3.5 would be used to aggregate telemetry data from various sensors.</p><p>At this point, all USB ports on the Raspberry PI 3 (RPi3) are in use with two USB camera modules and two Teensy MCUs. The system was taking shape but unfortunately, there were several problems:</p><ul><li>At first, I noticed that MJPEG streams started dropping frames; they were no longer low latency and after a minute or so would freeze completely.</li><li>The Node.js code that handled communication with MCUs was not designed to connect to multiple Teensys. It was connecting to one or the other but it wouldn&#39;t connect to both.</li><li>The web code became bloated and unnecessarily complex making adding features cumbersome.</li></ul><p>The problems were a bit discouraging since there was no simple workaround to any of them. At that point, I decided to step back and focus on other things. It was not clear to me at that time if I would ever come back to finish it.</p><div><p>Deep dive into the design of individual parts that make up the current iteration of the system. I describe how the components are interconnected and my struggles to make sure the setup is performing optimally.</p></div><p>After an extended break from the project, in mid-2019, I decided to take a fresh look at what I&#39;ve built so far. The problems I listed in the previous section meant that I had to start pretty much from scratch when it came to software and most of the firmware code.</p><p>With the experience I now had and all the components selected, I had a very clear picture of what to do next. I decided to approach the project in three distinct stages:</p><ul><li><a href="#software">Software</a> - web UI dashboard and middleware Node.js app to drive MCUs. This work also included firmware code for both MCUs.</li><li><a href="#hardware">Hardware</a> - tractor WiFi connectivity, cameras, sensors, motor controller, and all electrical connections.</li><li><a href="#mechanical">Mechanical</a> - steering and throttle motors, limit sensors, and quadrature encoders. Also included different parts I fabricated to mount many of the components listed here.</li></ul><h2 id="software"><a href="#software">Software</a></h2> <div><figure><img width="1920" height="1080" alt="UI" src="https://offthegrid.dev/static/images/tractor/ui.jpg"/><figcaption>Hover over a red spot to see the component name</figcaption></figure><div><p>Voltage and Current gauges</p></div></div><p><strong>Web UI</strong> - I decided to go simple - JavaScript ES2018 and Browserify for module management. Most of the code needed to be rewritten and some of it redesigned. The app was divided into the following components:</p><ol><li><em>IMU visualization</em> - data coming from BNO055 was visualized as a Tesla truck rendered using three.js.</li><li><em>Map</em> - data from the GPS module is sent to <a target="_blank" rel="noopener noreferrer" href="https://developers.google.com/maps">Google Maps API</a>. The tractor is represented by a red vehicle marker in the center of the map.</li><li><em>HUD gauges</em> - to visualize speed, compass, and acceleration data, the <a target="_blank" rel="noopener noreferrer" href="https://github.com/Mikhus/canvas-gauges">HTML Canvas Gauges</a> project was used. The data for the gauges comes from GPS and BNO055 modules.</li><li><em>Voltage and Current gauges</em> - the extra visualization of the current drawn by the two motors. Also, I added gauges for the voltages measured at the motor controller.</li><li><em>Telemetry pane</em> - representation of raw data coming from BNO055, GPS, and motor controller.</li><li><em>Debug pane</em> (not pictured) - aggregates log messages coming from MCUs and Node.js app.</li></ol><p>All pieces of data coming in and out of the browser are transmitted via the WebSocket.</p><figure><iframe src="https://www.youtube.com/embed/nOIXJO1ZYA8?modestbranding=1&amp;playsinline=1&amp;fs=1&amp;rel=0"></iframe><figcaption>Web UI in action including the backward facing camera.</figcaption></figure><p>Other software components:</p><ul><li><strong>Augmented Reality</strong> - even if the implementation of AR is rudimentary, I felt the platform&#39;s potential needed to be shown off. Since I had access to the GPS and orientation sensors, it did not take much to add one extra feature.</li><li><strong>Video Streams</strong> - I needed two stable, low latency 1080p/30fps streams that didn&#39;t consume the entire bandwidth of the RPi3. One way to achieve that inexpensively was to use camera modules that supported H.264 compression. After trying out several different streaming technologies I chose WebRTC because of its low latency capabilities. Running a WebRTC client on RPi3 was out of the question. RPi3 is just not powerful enough. The idea was to wrap each of the two H.264 streams, from both cameras, in an RTSP layer (using <em>ffmpeg</em>) and send them out to an RTSP server from where the streams would be picked up by the WebRTC client. The WebRTC client app and the RTSP server would live on a ground station - Raspberry PI 4 (RPi4).</li><li><strong>Gamepad</strong> - The <a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API">Gamepad API</a> exposed by browsers allowed me to read the controller axis and buttons. As soon as the value was read, it was sent via the WebSocket to RPi4 and from there broadcasted to RPi3 on the tractor, and finally to the dedicated MCU via USB Raw HID.</li><li><strong>Teensy MCUs</strong> - Both MCUs are connected to RPi3 via USB. There are two communication channels in use, USB Raw HID and Serial.<ul><li><em>USB Raw HID</em> - it is used for transmission of telemetry and steering/throttle data.</li><li><em>USB Serial</em> - serial communication is used to stream log data into the UI debug component. Also, log data from the MCUs is shown in the <em>stdout</em> of the Node.js app container running on RPi3. This allows for easier debugging of the firmware code.</li></ul></li><li>The <strong>RPi3</strong> is installed on the tractor, and runs:<ul><li>two instances of <em>ffmpeg</em> configured to forward front and back RTSP camera streams to the ground station (RPi4).</li><li>A Node.js app that interacts with the two Teensy MCUs. It is also responsible for processing input from the Web UI app. All software is containerized using Docker.</li></ul></li></ul><hr/><h2 id="hardware"><a href="#hardware">Hardware</a></h2><h3 id="overview"><a href="#overview">Overview</a></h3><p>The enclosure that houses all the electronic components is roughly 11x11 in. It is mounted on the floor of the tractor between the seat and steering column. It is held up by four vibration-damping sandwich mounts.</p><ol><li><a href="#power-distribution-layer">Power distribution</a></li><li><a href="#networking-layer">Networking</a></li><li><a href="#telemetry-and-sbc-layer">Telemetry and SBC</a></li><li><a href="#mcus-and-external-sensor-connectors-layer">MCUs and external sensor connectors</a></li></ol><h3 id="power-distribution-layer"><a href="#power-distribution-layer">Power Distribution Layer</a></h3><p>The tractor battery is connected to two buck converters (12VDC and 5VDC) and directly to the motor controller. The 12VDC converter provides regulated power to the WiFi router and the 5VDC converter powers the RPi3 and the cooling fan. The MCUs and external sensors are powered by a 5VDC regulated source on the motor controller.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Power Distribution Layer" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Bottom horizontal screw terminal is 5VDC and vertical is 12VDC.</figcaption></figure><h3 id="networking-layer"><a href="#networking-layer">Networking Layer</a></h3><p>After some research, I decided to go with the <em>Asus RT-AC1200 V2</em> router due to the small factor, 12VDC power input, price, and ability to easily detach existing antennas from the board. The router&#39;s ethernet ports are only 100 Mbps but this is not an issue since RPi3 can&#39;t push data faster and higher speeds are just not needed.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Networking Layer" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Electronic grade silicone was used to hold U.FL pigtails in place.</figcaption></figure><h3 id="telemetry-and-sbc-layer"><a href="#telemetry-and-sbc-layer">Telemetry and SBC Layer</a></h3><p>It contains SBC (RPi3), motor controller, GPS, and IMU modules:</p><ul><li><em>Motor controller</em> - RoboClaw V5 (15A version). Connected via Serial to Teensy 3.2, is responsible for throttle and steering controls. It&#39;s a very capable and feature-rich motor controller that saved me a lot of time when troubleshooting issues.</li><li><em>GPS</em> - the NEO-M9N module is connected to Teensy 3.5 via Serial. It provides location, heading, and speed data.</li><li><em>BNO055 module</em> - this 9 Degrees of Freedom sensor is connected via I2C to Teensy 3.5. It provides the acceleration, orientation, and rotation data.</li><li><em>RPi3</em> - runs software that interfaces with the MCUs and creates two RTSP camera streams. RPi3 connects to the WiFi router via ethernet cable for external communication. Even though USB and Ethernet ports share bandwidth on RPi3, the whole system moves around 48 Mbps of data which is within the RPi3&#39;s practical limits.</li></ul><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Telemetry and SBC Layer" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>In clockwise direction: RPi3, BNO055, RoboClaw, NEO-M9N.</figcaption></figure><h3 id="mcus-and-external-sensor-connectors-layer"><a href="#mcus-and-external-sensor-connectors-layer">MCUs and External Sensor Connectors Layer</a></h3><p>Both MCUs and connectors to external sensors are mounted on a protoboard. Two quadrature encoders and six hall effect sensors for throttle and steering are attached to the connectors on this layer.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="MCUs and External Sensor Connectors Layer" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>MCUs: Teensy 3.2 on the left and 3.5 on the right. Top connectors are for quadrature encoders and bottom ones are for Hall effect sensors.</figcaption></figure><h3 id="external-components"><a href="#external-components">External Components</a></h3><h4 id="cameras-and-wifi-antennas-mount"><a href="#cameras-and-wifi-antennas-mount">Cameras and WiFi antennas mount</a></h4><p>Both cameras and four WiFi antennas (two 2.4Ghz and two 5Ghz) are mounted behind the tractor seat on two 5ft L-shaped aluminum corner angle bars. The bars are attached to the mower with vibration-dampening washers.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzU2IiBoZWlnaHQ9IjEwMDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="Front Camera" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Forward facing camera and GPS antenna.</figcaption></figure><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzU2IiBoZWlnaHQ9IjEwMDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmVyc2lvbj0iMS4xIi8+"/></span><img alt="Back Camera" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Backward facing camera and WiFi antennas.</figcaption></figure><h4 id="xbox-controller"><a href="#xbox-controller">Xbox controller</a></h4><p>I used a wired Xbox 360 controller for testing. Any gamepad/steering wheel could be used as long as it is supported by the browser&#39;s implementation of the Gamepad API and preferably uses <a target="_blank" rel="noopener noreferrer" href="https://w3c.github.io/gamepad/#dfn-standard-gamepad">standard button mapping</a>.</p><h4 id="ground-station-rpi4"><a href="#ground-station-rpi4">Ground station (RPi4)</a></h4><p>The RPi4 hosts the web UI app, Nginx reverse proxy, RTSP server, and WebRTC client. Similarly to RPi3, all software is containerized. RPi4 also bridges the tractor network with the house network. A USB3 wireless AC1200 adapter connects the RPi4 to the WiFi router on the tractor.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTExIiBoZWlnaHQ9IjY2MSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Network Diagram" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Communication between tractor and home networks.</figcaption></figure><hr/><h2 id="mechanical"><a href="#mechanical">Mechanical</a></h2><p>To be able to use the tractor for the project, several mechanical and structural modifications had to be made to it. On top of that, the tractor is 9 years old and multiple parts were worn out and had to be replaced or fixed.</p><h3 id="throttle"><a href="#throttle">Throttle</a></h3><p>I removed the parking brake and &#34;cruise control&#34; linkages entirely. This freed up plenty of space inside (lower dash) to start experimenting with the throttle assembly design.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Throttle work" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>The view of the throttle mechanism from the motor side.</figcaption></figure><p>There are three hall effect sensors attached to the disk working as limit switches (forward, center, backward). The neodymium rare earth magnet attached to the lever activates the switches at the limit positions.</p><figure><iframe src="https://www.youtube.com/embed/aXmyvxjuh_s?modestbranding=1&amp;playsinline=1&amp;fs=1&amp;rel=0"></iframe><figcaption>Throttle mechanism in action.</figcaption></figure><h5 id="quadrature-encoders"><a href="#quadrature-encoders">Quadrature Encoders</a></h5><p>The quadrature encoders allowed me to very precisely control both the throttle and steering movement. The values from analog gamepad sticks and paddles were translated to encoder values. Then, those values were used to turn the motor to the desired position.</p><h4 id="transmission-work"><a href="#transmission-work">Transmission work</a></h4><p>A problem became apparent very quickly. Too much power was required to overcome the spring tension inside the mower&#39;s hydrostatic transmission. The spring is responsible for keeping the throttle pedal in a neutral position when not depressed.</p><p>After draining all the fluids, I removed an internal cover and a couple of pumps to get to the spring.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Throttle work" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Inside of the transmission.</figcaption></figure><p>I decided to fabricate my own spring. I purchased several springs and began to shape them on a vise. It took me several tries before I found a good combination of stiffness and shape.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Springs" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>It took me several tries to fabricate an acceptable spring.</figcaption></figure><p>After installing the new spring, it was now easy for the motor to move the throttle pedal.</p><figure><iframe src="https://www.youtube.com/embed/8DtjGcADdL4?modestbranding=1&amp;playsinline=1&amp;fs=1&amp;rel=0"></iframe><figcaption>Throttle testing.</figcaption></figure><h3 id="steering"><a href="#steering">Steering</a></h3><p>It took some time before I found an optimal location for all the parts related to steering control. In the end, I mounted a right-angle motor under the tractor&#39;s crossmember.</p><figure><iframe src="https://www.youtube.com/embed/49V9BRfubaU?modestbranding=1&amp;playsinline=1&amp;fs=1&amp;rel=0"></iframe><figcaption>Steering mechanism in its final form.</figcaption></figure><p>The hall effect sensors were mounted on the surface of the crossmember. A neodymium rare-earth magnet was attached under the ~3.5&#34; steering shaft sprocket, activating the sensors whenever limits were reached.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Hall Effect Sensors" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Steering Hall Effect sensors. Quadrature encoder on the right (not in the final location).</figcaption></figure><p>This setup worked under test conditions pretty well but it was very difficult for the motor to turn the wheels without drawing a considerable amount of current. This caused the motor to start overheating. It wasn&#39;t designed for continuous duty.</p><h4 id="steering-assembly-work"><a href="#steering-assembly-work">Steering assembly work</a></h4><p>First, I replaced both left and right spindle assemblies to deal with a major tire toe-out. Spindle replacement helped improve the toe-out problem a lot. Then, I noticed the front axle was pretty wobbly. It would have had to be replaced but a new one was around $100 so I decided to just flip it around. That worked great and now the tires were mostly straight. Finally, to make steering even smoother, I installed what&#39;s dubbed a <a target="_blank" rel="noopener noreferrer" href="https://youtu.be/ySXazpX2XP4">&#34;poor man&#39;s power steering&#34;</a>. It is a roller bearing with a washer on each side of the bearing installed between the spindle and the axle.</p><h4 id="firmware-improvements"><a href="#firmware-improvements">Firmware improvements</a></h4><p>There was one more major problem to overcome. I noticed that even if the motor was idling, it was consuming a lot of power. It varied wildly, anywhere from 1-2 amps to the maximum allowed. No amount of adjusting PID coefficients helped the situation. I finally chucked it up to the motor type, since the behavior was similar when driving it with a PWM signal.</p><h3 id="safety-bypass-and-kill-switch"><a href="#safety-bypass-and-kill-switch">Safety Bypass and Kill Switch</a></h3><p>Tractor mowers have several safety features and they have them for a very good reason. For my purpose, most of them had to be disabled, or else the tractor would not even start without a human operator.</p><ul><li><em>Brake switch</em> - to start the tractor a person needs to depress the brake pedal while turning on the engine.</li><li><em>Seat switch</em> - it engages when a person occupies the driver&#39;s seat. The person needs to remain seated while the tractor is operational. If the switch is not depressed, the engine turns off. Disabling the safety features on a tractor with the mower deck removed is not as risky but still, a runaway situation could occur. To manage this I added a kill switch.</li></ul><p>A kill switch is a simple device I built that consists of an RC switch with a relay, an RC receiver, and a battery pack to power the device.</p><figure><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODA2IiBoZWlnaHQ9IjYwNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2ZXJzaW9uPSIxLjEiLz4="/></span><img alt="Kill switch" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span><figcaption>Left: RC Receiver. Right: RC switch with a relay. The battery pack at the bottom.</figcaption></figure><p>The red positive wire coming out of the solenoid and going into the ignition is split in two and connected to Common and Normally Closed contacts on the SPDT switch. Using the RC controller, I can activate the relay, switching the contact to Normally Open causing the engine to shut off.</p><figure><iframe src="https://www.youtube.com/embed/bNnGKdXBmyQ?modestbranding=1&amp;playsinline=1&amp;fs=1&amp;rel=0"></iframe><figcaption>Kill switch in action.</figcaption></figure><p>This was a very challenging and fun project to work on. Writing the software and fabricating all the parts taught me many engineering and system design lessons. There is still plenty that can be improved upon but I had to stop somewhere. I hope you enjoyed reading about it as much as I enjoyed creating it.</p></div></div></div>
  </body>
</html>
