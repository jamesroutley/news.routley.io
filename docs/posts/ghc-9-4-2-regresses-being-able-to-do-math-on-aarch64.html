<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/22282">Original</a>
    <h1>GHC 9.4.2 regresses being able to do math on aarch64</h1>
    
    <div id="readability-page-1" class="page"><div>
<main id="content-body" itemscope="" itemtype="http://schema.org/SoftwareSourceCode">






<div>
<div>
<div data-full-path="ghc/ghc" data-initial="{&#34;endpoint&#34;:&#34;/ghc/ghc/-/issues/22282&#34;,&#34;updateEndpoint&#34;:&#34;/ghc/ghc/-/issues/22282.json&#34;,&#34;canUpdate&#34;:false,&#34;canDestroy&#34;:false,&#34;issuableRef&#34;:&#34;#22282&#34;,&#34;markdownPreviewPath&#34;:&#34;/ghc/ghc/preview_markdown?target_id=22282\u0026target_type=Issue&#34;,&#34;markdownDocsPath&#34;:&#34;/help/user/markdown&#34;,&#34;lockVersion&#34;:0,&#34;state&#34;:&#34;opened&#34;,&#34;issuableTemplateNamesPath&#34;:&#34;/ghc/ghc/description_templates/names/issue&#34;,&#34;initialTitleHtml&#34;:&#34;GHC 9.4.2 regresses being able to do math on aarch64&#34;,&#34;initialTitleText&#34;:&#34;GHC 9.4.2 regresses being able to do math on aarch64&#34;,&#34;initialDescriptionHtml&#34;:&#34;\u003ch2 data-sourcepos=\&#34;1:1-1:10\&#34; dir=\&#34;auto\&#34;\u003e\u0026#x000A;\u003ca id=\&#34;user-content-summary\&#34; class=\&#34;anchor\&#34; href=\&#34;#summary\&#34; aria-hidden=\&#34;true\&#34;\u003e\u003c/a\u003eSummary\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;3:1-3:197\&#34; dir=\&#34;auto\&#34;\u003eI found this test failure while working on nixpkgs on aarch64. This is \u003cem\u003eextremely alarming\u003c/em\u003e, before I reduced it to a simpler program using only base, at which point I am out-of-this-world alarmed.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;5:1-5:59\&#34; dir=\&#34;auto\&#34;\u003e\u003ca href=\&#34;https://github.com/haskell-foundation/foundation/issues/571\&#34; rel=\&#34;nofollow noreferrer noopener\&#34; target=\&#34;_blank\&#34;\u003ehttps://github.com/haskell-foundation/foundation/issues/571\u003c/a\u003e\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&#34;8:1-8:21\&#34; dir=\&#34;auto\&#34;\u003e\u0026#x000A;\u003ca id=\&#34;user-content-steps-to-reproduce\&#34; class=\&#34;anchor\&#34; href=\&#34;#steps-to-reproduce\&#34; aria-hidden=\&#34;true\&#34;\u003e\u003c/a\u003eSteps to reproduce\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;10:1-10:24\&#34; dir=\&#34;auto\&#34;\u003eStick this in \u003ccode\u003eMain.hs\u003c/code\u003e:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&#34;gl-relative markdown-code-block js-markdown-code\&#34;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&#34;12:1-30:3\&#34; class=\&#34;code highlight js-syntax-highlight language-haskell\&#34; lang=\&#34;haskell\&#34; v-pre=\&#34;true\&#34;\u003e\u003ccode\u003e\u003cspan id=\&#34;LC1\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;cp\&#34;\u003e{-# LANGUAGE NoImplicitPrelude, OverloadedStrings, RankNTypes, ScopedTypeVariables, NoRebindableSyntax #-}\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC2\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;kr\&#34;\u003emodule\u003c/span\u003e \u003cspan class=\&#34;nn\&#34;\u003eMain\u003c/span\u003e \u003cspan class=\&#34;kr\&#34;\u003ewhere\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC3\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC4\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;kr\&#34;\u003eimport\u003c/span\u003e \u003cspan class=\&#34;nn\&#34;\u003ePrelude\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC5\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;kr\&#34;\u003eimport\u003c/span\u003e \u003cspan class=\&#34;nn\&#34;\u003eSystem.Environment\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC6\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;kr\&#34;\u003eimport\u003c/span\u003e \u003cspan class=\&#34;nn\&#34;\u003eData.Word\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC7\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC8\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;n\&#34;\u003etestF\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e::\u003c/span\u003e \u003cspan class=\&#34;kt\&#34;\u003eWord8\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&#34;kt\&#34;\u003eWord8\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&#34;kt\&#34;\u003eBool\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC9\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;n\&#34;\u003etestF\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003ea\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eb\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e=\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC10\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e    \u003cspan class=\&#34;kr\&#34;\u003eif\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eb\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e==\u003c/span\u003e \u003cspan class=\&#34;mi\&#34;\u003e0\u003c/span\u003e \u003cspan class=\&#34;kr\&#34;\u003ethen\u003c/span\u003e \u003cspan class=\&#34;kt\&#34;\u003eTrue\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC11\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e              \u003cspan class=\&#34;kr\&#34;\u003eelse\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003ea\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e==\u003c/span\u003e \u003cspan class=\&#34;p\&#34;\u003e(\u003c/span\u003e\u003cspan class=\&#34;n\&#34;\u003ea\u003c/span\u003e \u003cspan class=\&#34;p\&#34;\u003e`\u003c/span\u003e\u003cspan class=\&#34;n\&#34;\u003ediv\u003c/span\u003e\u003cspan class=\&#34;p\&#34;\u003e`\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eb\u003c/span\u003e\u003cspan class=\&#34;p\&#34;\u003e)\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e*\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eb\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e+\u003c/span\u003e \u003cspan class=\&#34;p\&#34;\u003e(\u003c/span\u003e\u003cspan class=\&#34;n\&#34;\u003ea\u003c/span\u003e \u003cspan class=\&#34;p\&#34;\u003e`\u003c/span\u003e\u003cspan class=\&#34;n\&#34;\u003emod\u003c/span\u003e\u003cspan class=\&#34;p\&#34;\u003e`\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eb\u003c/span\u003e\u003cspan class=\&#34;p\&#34;\u003e)\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC12\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC13\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;n\&#34;\u003emain\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e::\u003c/span\u003e \u003cspan class=\&#34;kt\&#34;\u003eIO\u003c/span\u003e \u003cspan class=\&#34;nb\&#34;\u003e()\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC14\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e\u003cspan class=\&#34;n\&#34;\u003emain\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e=\u003c/span\u003e \u003cspan class=\&#34;kr\&#34;\u003edo\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC15\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e    \u003cspan class=\&#34;n\&#34;\u003eargs\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003egetArgs\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC16\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e    \u003cspan class=\&#34;kr\&#34;\u003elet\u003c/span\u003e \u003cspan class=\&#34;p\&#34;\u003e[\u003c/span\u003e\u003cspan class=\&#34;n\&#34;\u003ea\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e::\u003c/span\u003e \u003cspan class=\&#34;kt\&#34;\u003eWord8\u003c/span\u003e\u003cspan class=\&#34;p\&#34;\u003e,\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eb\u003c/span\u003e\u003cspan class=\&#34;p\&#34;\u003e]\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e=\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eread\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e\u0026lt;$\u0026gt;\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eargs\u003c/span\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC17\&#34; class=\&#34;line\&#34; lang=\&#34;haskell\&#34;\u003e    \u003cspan class=\&#34;n\&#34;\u003eputStrLn\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e.\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eshow\u003c/span\u003e \u003cspan class=\&#34;o\&#34;\u003e$\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003etestF\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003ea\u003c/span\u003e \u003cspan class=\&#34;n\&#34;\u003eb\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;32:1-32:5\&#34; dir=\&#34;auto\&#34;\u003eThen:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&#34;gl-relative markdown-code-block js-markdown-code\&#34;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&#34;34:1-47:3\&#34; class=\&#34;code highlight js-syntax-highlight language-plaintext\&#34; lang=\&#34;plaintext\&#34; data-canonical-lang=\&#34;\&#34; v-pre=\&#34;true\&#34;\u003e\u003ccode\u003e\u003cspan id=\&#34;LC1\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » ghc -O1 app/Main.hs\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC2\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[1 of 2] Compiling Main             ( app/Main.hs, app/Main.o )\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC3\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[2 of 2] Linking app/Main\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC4\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC5\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » app/Main 217 161\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC6\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eFalse\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC7\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » ghc -O0 app/Main.hs\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC8\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[1 of 2] Compiling Main             ( app/Main.hs, app/Main.o ) [Optimisation flags changed]\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC9\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[2 of 2] Linking app/Main [Objects changed]\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC10\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC11\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » app/Main 217 161\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC12\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eTrue\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;49:1-49:29\&#34; dir=\&#34;auto\&#34;\u003eNote that it&#39;s fine on 9.2.4:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&#34;gl-relative markdown-code-block js-markdown-code\&#34;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&#34;51:1-65:3\&#34; class=\&#34;code highlight js-syntax-highlight language-plaintext\&#34; lang=\&#34;plaintext\&#34; data-canonical-lang=\&#34;\&#34; v-pre=\&#34;true\&#34;\u003e\u003ccode\u003e\u003cspan id=\&#34;LC1\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » ghcup set 9.2.4\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC2\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[ Warn  ] This is an old-style command for setting GHC. Use &#39;ghcup set ghc&#39; instead.\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC3\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[ Info  ] GHC 9.2.4 successfully set as default version\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC4\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » ghc -O0 app/Main.hs\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC5\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[1 of 1] Compiling Main             ( app/Main.hs, app/Main.o )\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC6\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eLinking app/Main ...\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC7\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » app/Main 217 161\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC8\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eTrue\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC9\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » ghc -O1 app/Main.hs\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC10\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[1 of 1] Compiling Main             ( app/Main.hs, app/Main.o ) [Optimisation flags changed]\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC11\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eLinking app/Main ...\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC12\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eco/ghc942bug » app/Main 217 161\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC13\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eTrue\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;67:1-67:57\&#34; dir=\&#34;auto\&#34;\u003eOn Linux, GHC 9.4.2 from nixpkgs (qemu on Apple Silicon):\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&#34;gl-relative markdown-code-block js-markdown-code\&#34;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&#34;69:1-82:3\&#34; class=\&#34;code highlight js-syntax-highlight language-plaintext\&#34; lang=\&#34;plaintext\&#34; data-canonical-lang=\&#34;\&#34; v-pre=\&#34;true\&#34;\u003e\u003ccode\u003e\u003cspan id=\&#34;LC1\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e~ » ghc -O1 Repro.hs\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC2\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[1 of 2] Compiling Main             ( Repro.hs, Repro.o )\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC3\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[2 of 2] Linking Repro\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC4\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e~ » ./Repro 217 161\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC5\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eFalse\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC6\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e~ » ghc -O0 Repro.hs\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC7\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[1 of 2] Compiling Main             ( Repro.hs, Repro.o ) [Optimisation flags changed]\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC8\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e[2 of 2] Linking Repro [Objects changed]\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC9\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e~ » ./Repro 217 161\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC10\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eTrue\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC11\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003e~ » uname -a\u003c/span\u003e\u0026#x000A;\u003cspan id=\&#34;LC12\&#34; class=\&#34;line\&#34; lang=\&#34;plaintext\&#34;\u003eLinux thinnix 5.15.47 #1-NixOS SMP Tue Jun 14 16:36:28 UTC 2022 aarch64 GNU/Linux\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&#34;84:1-84:20\&#34; dir=\&#34;auto\&#34;\u003e\u0026#x000A;\u003ca id=\&#34;user-content-expected-behavior\&#34; class=\&#34;anchor\&#34; href=\&#34;#expected-behavior\&#34; aria-hidden=\&#34;true\&#34;\u003e\u003c/a\u003eExpected behavior\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;86:1-86:58\&#34; dir=\&#34;auto\&#34;\u003eIt should return True in both optimization configurations.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&#34;88:1-88:14\&#34; dir=\&#34;auto\&#34;\u003e\u0026#x000A;\u003ca id=\&#34;user-content-environment\&#34; class=\&#34;anchor\&#34; href=\&#34;#environment\&#34; aria-hidden=\&#34;true\&#34;\u003e\u003c/a\u003eEnvironment\u003c/h2\u003e\u0026#x000A;\u003cul data-sourcepos=\&#34;90:1-91:0\&#34; dir=\&#34;auto\&#34;\u003e\u0026#x000A;\u003cli data-sourcepos=\&#34;90:1-91:0\&#34;\u003eGHC version used: 9.4.2 from ghcup although it also happens on ghc from nix. It&#39;s fine in ghc 9.2.4.\u003c/li\u003e\u0026#x000A;\u003c/ul\u003e\u0026#x000A;\u003cp data-sourcepos=\&#34;92:1-92:9\&#34; dir=\&#34;auto\&#34;\u003eOptional:\u003c/p\u003e\u0026#x000A;\u003cul data-sourcepos=\&#34;94:1-95:30\&#34; dir=\&#34;auto\&#34;\u003e\u0026#x000A;\u003cli data-sourcepos=\&#34;94:1-94:68\&#34;\u003eOperating System: macOS, although it also happens on aarch64-linux\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&#34;95:1-95:30\&#34;\u003eSystem Architecture: aarch64\u003c/li\u003e\u0026#x000A;\u003c/ul\u003e&#34;,&#34;initialDescriptionText&#34;:&#34;## Summary\n\nI found this test failure while working on nixpkgs on aarch64. This is *extremely alarming*, before I reduced it to a simpler program using only base, at which point I am out-of-this-world alarmed.\n\nhttps://github.com/haskell-foundation/foundation/issues/571\n\n\n## Steps to reproduce\n\nStick this in `Main.hs`:\n\n```haskell\n{-# LANGUAGE NoImplicitPrelude, OverloadedStrings, RankNTypes, ScopedTypeVariables, NoRebindableSyntax #-}\nmodule Main where\n\nimport Prelude\nimport System.Environment\nimport Data.Word\n\ntestF :: Word8 -\u003e Word8 -\u003e Bool\ntestF a b =\n    if b == 0 then True\n              else a == (a `div` b) * b + (a `mod` b)\n\nmain :: IO ()\nmain = do\n    args \u003c- getArgs\n    let [a :: Word8, b] = read \u003c$\u003e args\n    putStrLn . show $ testF a b\n```\n\nThen:\n\n```\nco/ghc942bug » ghc -O1 app/Main.hs\n[1 of 2] Compiling Main             ( app/Main.hs, app/Main.o )\n[2 of 2] Linking app/Main\n\nco/ghc942bug » app/Main 217 161\nFalse\nco/ghc942bug » ghc -O0 app/Main.hs\n[1 of 2] Compiling Main             ( app/Main.hs, app/Main.o ) [Optimisation flags changed]\n[2 of 2] Linking app/Main [Objects changed]\n\nco/ghc942bug » app/Main 217 161\nTrue\n```\n\nNote that it&#39;s fine on 9.2.4:\n\n```\nco/ghc942bug » ghcup set 9.2.4\n[ Warn  ] This is an old-style command for setting GHC. Use &#39;ghcup set ghc&#39; instead.\n[ Info  ] GHC 9.2.4 successfully set as default version\nco/ghc942bug » ghc -O0 app/Main.hs\n[1 of 1] Compiling Main             ( app/Main.hs, app/Main.o )\nLinking app/Main ...\nco/ghc942bug » app/Main 217 161\nTrue\nco/ghc942bug » ghc -O1 app/Main.hs\n[1 of 1] Compiling Main             ( app/Main.hs, app/Main.o ) [Optimisation flags changed]\nLinking app/Main ...\nco/ghc942bug » app/Main 217 161\nTrue\n```\n\nOn Linux, GHC 9.4.2 from nixpkgs (qemu on Apple Silicon):\n\n```\n~ » ghc -O1 Repro.hs\n[1 of 2] Compiling Main             ( Repro.hs, Repro.o )\n[2 of 2] Linking Repro\n~ » ./Repro 217 161\nFalse\n~ » ghc -O0 Repro.hs\n[1 of 2] Compiling Main             ( Repro.hs, Repro.o ) [Optimisation flags changed]\n[2 of 2] Linking Repro [Objects changed]\n~ » ./Repro 217 161\nTrue\n~ » uname -a\nLinux thinnix 5.15.47 #1-NixOS SMP Tue Jun 14 16:36:28 UTC 2022 aarch64 GNU/Linux\n```\n\n## Expected behavior\n\nIt should return True in both optimization configurations.\n\n## Environment\n\n* GHC version used: 9.4.2 from ghcup although it also happens on ghc from nix. It&#39;s fine in ghc 9.2.4.\n\nOptional:\n\n* Operating System: macOS, although it also happens on aarch64-linux\n* System Architecture: aarch64&#34;,&#34;initialTaskStatus&#34;:&#34;0 of 0 checklist items completed&#34;,&#34;hasClosingMergeRequest&#34;:true,&#34;issueType&#34;:&#34;issue&#34;,&#34;zoomMeetingUrl&#34;:null,&#34;sentryIssueIdentifier&#34;:null,&#34;iid&#34;:&#34;22282&#34;,&#34;isHidden&#34;:false,&#34;canCreateIncident&#34;:false,&#34;publishedIncidentUrl&#34;:null,&#34;slaFeatureAvailable&#34;:&#34;false&#34;,&#34;uploadMetricsFeatureAvailable&#34;:&#34;false&#34;,&#34;projectId&#34;:1,&#34;projectPath&#34;:&#34;ghc&#34;,&#34;projectNamespace&#34;:&#34;ghc&#34;,&#34;canAdmin&#34;:false,&#34;hasIssueWeightsFeature&#34;:true}" data-issuable-id="22572" id="js-issuable-app">

<div>
<div><h2 data-sourcepos="1:1-1:10" dir="auto">
<a id="user-content-summary" href="#summary" aria-hidden="true"></a>Summary</h2>
<p data-sourcepos="3:1-3:197" dir="auto">I found this test failure while working on nixpkgs on aarch64. This is <em>extremely alarming</em>, before I reduced it to a simpler program using only base, at which point I am out-of-this-world alarmed.</p>
<p data-sourcepos="5:1-5:59" dir="auto"><a href="https://github.com/haskell-foundation/foundation/issues/571" rel="nofollow noreferrer noopener" target="_blank">https://github.com/haskell-foundation/foundation/issues/571</a></p>
<h2 data-sourcepos="8:1-8:21" dir="auto">
<a id="user-content-steps-to-reproduce" href="#steps-to-reproduce" aria-hidden="true"></a>Steps to reproduce</h2>
<p data-sourcepos="10:1-10:24" dir="auto">Stick this in <code>Main.hs</code>:</p>
<div>
<pre data-sourcepos="12:1-30:3" lang="haskell" v-pre="true"><code><span id="LC1" lang="haskell"><span>{-# LANGUAGE NoImplicitPrelude, OverloadedStrings, RankNTypes, ScopedTypeVariables, NoRebindableSyntax #-}</span></span>
<span id="LC2" lang="haskell"><span>module</span> <span>Main</span> <span>where</span></span>
<span id="LC3" lang="haskell"></span>
<span id="LC4" lang="haskell"><span>import</span> <span>Prelude</span></span>
<span id="LC5" lang="haskell"><span>import</span> <span>System.Environment</span></span>
<span id="LC6" lang="haskell"><span>import</span> <span>Data.Word</span></span>
<span id="LC7" lang="haskell"></span>
<span id="LC8" lang="haskell"><span>testF</span> <span>::</span> <span>Word8</span> <span>-&gt;</span> <span>Word8</span> <span>-&gt;</span> <span>Bool</span></span>
<span id="LC9" lang="haskell"><span>testF</span> <span>a</span> <span>b</span> <span>=</span></span>
<span id="LC10" lang="haskell">    <span>if</span> <span>b</span> <span>==</span> <span>0</span> <span>then</span> <span>True</span></span>
<span id="LC11" lang="haskell">              <span>else</span> <span>a</span> <span>==</span> <span>(</span><span>a</span> <span>`</span><span>div</span><span>`</span> <span>b</span><span>)</span> <span>*</span> <span>b</span> <span>+</span> <span>(</span><span>a</span> <span>`</span><span>mod</span><span>`</span> <span>b</span><span>)</span></span>
<span id="LC12" lang="haskell"></span>
<span id="LC13" lang="haskell"><span>main</span> <span>::</span> <span>IO</span> <span>()</span></span>
<span id="LC14" lang="haskell"><span>main</span> <span>=</span> <span>do</span></span>
<span id="LC15" lang="haskell">    <span>args</span> <span>&lt;-</span> <span>getArgs</span></span>
<span id="LC16" lang="haskell">    <span>let</span> <span>[</span><span>a</span> <span>::</span> <span>Word8</span><span>,</span> <span>b</span><span>]</span> <span>=</span> <span>read</span> <span>&lt;$&gt;</span> <span>args</span></span>
<span id="LC17" lang="haskell">    <span>putStrLn</span> <span>.</span> <span>show</span> <span>$</span> <span>testF</span> <span>a</span> <span>b</span></span></code></pre>
<copy-code></copy-code>
</div>
<p data-sourcepos="32:1-32:5" dir="auto">Then:</p>
<div>
<pre data-sourcepos="34:1-47:3" lang="plaintext" data-canonical-lang="" v-pre="true"><code><span id="LC1" lang="plaintext">co/ghc942bug » ghc -O1 app/Main.hs</span>
<span id="LC2" lang="plaintext">[1 of 2] Compiling Main             ( app/Main.hs, app/Main.o )</span>
<span id="LC3" lang="plaintext">[2 of 2] Linking app/Main</span>
<span id="LC4" lang="plaintext"></span>
<span id="LC5" lang="plaintext">co/ghc942bug » app/Main 217 161</span>
<span id="LC6" lang="plaintext">False</span>
<span id="LC7" lang="plaintext">co/ghc942bug » ghc -O0 app/Main.hs</span>
<span id="LC8" lang="plaintext">[1 of 2] Compiling Main             ( app/Main.hs, app/Main.o ) [Optimisation flags changed]</span>
<span id="LC9" lang="plaintext">[2 of 2] Linking app/Main [Objects changed]</span>
<span id="LC10" lang="plaintext"></span>
<span id="LC11" lang="plaintext">co/ghc942bug » app/Main 217 161</span>
<span id="LC12" lang="plaintext">True</span></code></pre>
<copy-code></copy-code>
</div>
<p data-sourcepos="49:1-49:29" dir="auto">Note that it&#39;s fine on 9.2.4:</p>
<div>
<pre data-sourcepos="51:1-65:3" lang="plaintext" data-canonical-lang="" v-pre="true"><code><span id="LC1" lang="plaintext">co/ghc942bug » ghcup set 9.2.4</span>
<span id="LC2" lang="plaintext">[ Warn  ] This is an old-style command for setting GHC. Use &#39;ghcup set ghc&#39; instead.</span>
<span id="LC3" lang="plaintext">[ Info  ] GHC 9.2.4 successfully set as default version</span>
<span id="LC4" lang="plaintext">co/ghc942bug » ghc -O0 app/Main.hs</span>
<span id="LC5" lang="plaintext">[1 of 1] Compiling Main             ( app/Main.hs, app/Main.o )</span>
<span id="LC6" lang="plaintext">Linking app/Main ...</span>
<span id="LC7" lang="plaintext">co/ghc942bug » app/Main 217 161</span>
<span id="LC8" lang="plaintext">True</span>
<span id="LC9" lang="plaintext">co/ghc942bug » ghc -O1 app/Main.hs</span>
<span id="LC10" lang="plaintext">[1 of 1] Compiling Main             ( app/Main.hs, app/Main.o ) [Optimisation flags changed]</span>
<span id="LC11" lang="plaintext">Linking app/Main ...</span>
<span id="LC12" lang="plaintext">co/ghc942bug » app/Main 217 161</span>
<span id="LC13" lang="plaintext">True</span></code></pre>
<copy-code></copy-code>
</div>
<p data-sourcepos="67:1-67:57" dir="auto">On Linux, GHC 9.4.2 from nixpkgs (qemu on Apple Silicon):</p>
<div>
<pre data-sourcepos="69:1-82:3" lang="plaintext" data-canonical-lang="" v-pre="true"><code><span id="LC1" lang="plaintext">~ » ghc -O1 Repro.hs</span>
<span id="LC2" lang="plaintext">[1 of 2] Compiling Main             ( Repro.hs, Repro.o )</span>
<span id="LC3" lang="plaintext">[2 of 2] Linking Repro</span>
<span id="LC4" lang="plaintext">~ » ./Repro 217 161</span>
<span id="LC5" lang="plaintext">False</span>
<span id="LC6" lang="plaintext">~ » ghc -O0 Repro.hs</span>
<span id="LC7" lang="plaintext">[1 of 2] Compiling Main             ( Repro.hs, Repro.o ) [Optimisation flags changed]</span>
<span id="LC8" lang="plaintext">[2 of 2] Linking Repro [Objects changed]</span>
<span id="LC9" lang="plaintext">~ » ./Repro 217 161</span>
<span id="LC10" lang="plaintext">True</span>
<span id="LC11" lang="plaintext">~ » uname -a</span>
<span id="LC12" lang="plaintext">Linux thinnix 5.15.47 #1-NixOS SMP Tue Jun 14 16:36:28 UTC 2022 aarch64 GNU/Linux</span></code></pre>
<copy-code></copy-code>
</div>
<h2 data-sourcepos="84:1-84:20" dir="auto">
<a id="user-content-expected-behavior" href="#expected-behavior" aria-hidden="true"></a>Expected behavior</h2>
<p data-sourcepos="86:1-86:58" dir="auto">It should return True in both optimization configurations.</p>
<h2 data-sourcepos="88:1-88:14" dir="auto">
<a id="user-content-environment" href="#environment" aria-hidden="true"></a>Environment</h2>
<ul data-sourcepos="90:1-91:0" dir="auto">
<li data-sourcepos="90:1-91:0">GHC version used: 9.4.2 from ghcup although it also happens on ghc from nix. It&#39;s fine in ghc 9.2.4.</li>
</ul>
<p data-sourcepos="92:1-92:9" dir="auto">Optional:</p>
<ul data-sourcepos="94:1-95:30" dir="auto">
<li data-sourcepos="94:1-94:68">Operating System: macOS, although it also happens on aarch64-linux</li>
<li data-sourcepos="95:1-95:30">System Architecture: aarch64</li>
</ul></div>
</div>

</div>
</div>


</div>






</main>
</div></div>
  </body>
</html>
