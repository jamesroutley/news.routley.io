<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hookrace.net/blog/time.gif/">Original</a>
    <h1>Time.gif (2017)</h1>
    
    <div id="readability-page-1" class="page"><div>
  
  <p><span>2017-08-11
  
    · <a href="https://hookrace.net/blog/haskell/">Haskell</a>
  
    · <a href="https://hookrace.net/blog/programming/">Programming</a>
  
  </span></p><p>This is an endless GIF that always shows the current time in UTC:</p>

<!--more-->
<p><img src="https://hookrace.net/time.gif" alt="time.gif (reload if it fails)"/></p>

<p><a href="https://github.com/def-/time.gif">Source Code</a></p>

<p>(From reports it doesn’t seem to work on Safari, other browsers should be fine.)</p>

<p>time.gif is written in Haskell and works by dynamically generating each frame of the GIF and slowly feeding them over the HTTP connection.</p>

<p>There is no guarantee that this GIF shows a reasonable time and this is just for fun anyway, so better don’t build your next project based on the time from this GIF. If my server is overloaded, you can try compiling it yourself and run it locally.</p>

<p>Update: Optimized, runs at less than 1% CPU with 500 simultaneous connections open, LZW encoding reduces bandwidth from 4 KB/s to 300 B/s.</p>

<figure><pre><code data-lang="haskell"><span>-- Wait for incoming connections and start delivering a GIF to them</span>
<span>loop</span> <span>::</span> <span>Int</span> <span>-&gt;</span> <span>FrameSignal</span> <span>-&gt;</span> <span>Socket</span> <span>-&gt;</span> <span>IO</span> <span>()</span>
<span>loop</span> <span>delay</span> <span>frameSignal</span> <span>sock</span> <span>=</span> <span>do</span>
  <span>(</span><span>conn</span><span>,</span> <span>_</span><span>)</span> <span>&lt;-</span> <span>accept</span> <span>sock</span>

  <span>forkIO</span> <span>$</span> <span>body</span> <span>conn</span>
  <span>loop</span> <span>delay</span> <span>frameSignal</span> <span>sock</span>

  <span>where</span>
    <span>body</span> <span>c</span> <span>=</span> <span>do</span>
      <span>f</span> <span>&lt;-</span> <span>receiveMSignal</span> <span>frameSignal</span>
      <span>sendAll</span> <span>c</span> <span>$</span> <span>msg</span> <span>$</span> <span>initialFrame</span> <span>(</span><span>delay</span> <span>`</span><span>div</span><span>`</span> <span>10000</span><span>)</span> <span>f</span>
      <span>nextFrame</span> <span>c</span>

    <span>nextFrame</span> <span>c</span> <span>=</span> <span>do</span>
      <span>f</span> <span>&lt;-</span> <span>receiveMSignal</span> <span>frameSignal</span>
      <span>sendAll</span> <span>c</span> <span>$</span> <span>frame</span> <span>(</span><span>delay</span> <span>`</span><span>div</span><span>`</span> <span>10000</span><span>)</span> <span>f</span>
      <span>nextFrame</span> <span>c</span>

    <span>msg</span> <span>content</span> <span>=</span> <span>B</span><span>.</span><span>intercalate</span> <span>&#34;</span><span>\r\n</span><span>&#34;</span>
      <span>[</span> <span>&#34;HTTP/1.0 200 OK&#34;</span>
      <span>,</span> <span>&#34;Server: gifstream/0.1&#34;</span>
      <span>,</span> <span>&#34;Content-Type: image/gif&#34;</span>
      <span>,</span> <span>&#34;Content-Transfer-Encoding: binary&#34;</span>
      <span>,</span> <span>&#34;Cache-Control: no-cache&#34;</span>
      <span>,</span> <span>&#34;Cache-Control: no-store&#34;</span>
      <span>,</span> <span>&#34;Cache-Control: no-transform&#34;</span>
      <span>,</span> <span>&#34;&#34;</span>
      <span>,</span> <span>content</span>
      <span>]</span></code></pre></figure>

<p>This is cannibalized from <a href="https://github.com/def-/gifstream">gifstream</a>, which lets you play snake and have people watch a GIF livestream. It was actually created as a Christmas exercise for students of the Programming Paradigms course at KIT.</p>

<p><img src="https://raw.githubusercontent.com/def-/gifstream/master/snake.gif" alt="snake"/></p>

<p>Discuss on <a href="https://news.ycombinator.com/item?id=33358486">Hacker News (2022-10-27)</a> (<a href="https://news.ycombinator.com/item?id=14996715">previous thread from 2017-08-12</a>)</p>

</div></div>
  </body>
</html>
