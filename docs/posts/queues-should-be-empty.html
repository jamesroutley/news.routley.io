<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://joshvoigts.com/articles/queues-should-be-empty/">Original</a>
    <h1>Queues should be empty</h1>
    
    <div id="readability-page-1" class="page"><div id="content" role="main">
        <article role="article">
  
<p>I’ve been writing a pubsub listener for work recently and had this silly “shower thought”: the ideal queue should be empty. Why? If the queue is not empty, it means that whatever job is consuming from the queue is not keeping up with messages coming into it. Ok, then if queues are supposed to be empty, then what are they good for?</p>
<h2>Spikey workloads</h2>
<p>One use for a queue is handling “spikey” workloads or scenarios where there is a mismatch between the rate at which events are produced and the rate at which they can be consumed. For instance, if there’s a sudden surge in demand for a service or product, a queue can help absorb the influx of requests until the system can scale up to handle the increased load.</p>
<h2>Safely persisting data</h2>
<p>Another use for a queue is safely persisting data. In pubsub, for example, a message is left on the queue until it’s been processed or acknowledged (ACK’d). If the process fails, it will never have been ACK’d so it will stay safely on the queue until the job is restarted.</p>
<p>A job can also be failed purposefully with a negative acknowledgement (a <span>NACK</span>). You might do this if the job is not ready yet or if a service the job depends on has failed. After a <span>NACK</span>, the message will be returned to the queue to be processed at a later time. Usually using a backoff policy so that the consumer doesn’t continuously pull the same item.</p>
<h2>Decoupling components</h2>
<p>Queues can be used to decouple components in a distributed system. If one component produces events and another component consumes them, a queue can act as a buffer between the two components. This way, the producer doesn’t need to know anything about the consumer and vice versa. They simply interact with the queue, which handles the communication between them.</p>
<h2>Enabling asynchronous processing</h2>
<p>Another use for queues is to enable asynchronous and/or parallel processing. With a queue, you can submit a job or task to be executed later and avoid blocking the caller. If you have an application that generates PDFs, you could submit the task and <span>ACK</span> immediately allowing the job to finish in the background. It also makes it easy to parallelize jobs by having multiple consumers pull from the same queue.</p>
<h2>Empty queues may be the best queues…</h2>
<p>… but they’re still useful.</p>
</article>

      </div></div>
  </body>
</html>
