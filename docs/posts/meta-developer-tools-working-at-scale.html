<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://engineering.fb.com/2023/06/27/developer-tools/meta-developer-tools-open-source/">Original</a>
    <h1>Meta developer tools: Working at scale</h1>
    
    <div id="readability-page-1" class="page"><div>

		<p><span>Every day, thousands of developers at Meta are working in repositories with millions of files. Those developers need tools that help them at every stage of the workflow while working at extreme scale. In this article we’ll go through a few of the tools in the development process. And, as an added bonus, those we talk about below are open source so you can try them yourself.</span></p>
<h2><span>Sapling: Scaling version control</span></h2>
<p><a href="https://engineering.fb.com/2022/11/15/open-source/sapling-source-control-scalable/" target="_blank" rel="noopener"><span>Sapling</span></a><span> is a version control system that can scale to huge sizes, but also emphasizes usability. There are three main components to Sapling – a server, a client, and a virtual file system.</span></p>
<p><span>The server stores all the data and is a careful mix of clever storage formats, wire protocols, and algorithms, </span><a href="https://engineering.fb.com/2021/04/29/developer-tools/rust/" target="_blank" rel="noopener"><span>mostly implemented in Rust</span></a><span> and </span><a href="https://engineering.fb.com/2014/01/07/core-data/scaling-mercurial-at-facebook/" target="_blank" rel="noopener"><span>architected to scale</span></a><span>.</span></p>
<p><span>The client then talks to that server, providing all the familiar operations (check out, rebase, commit, amend, etc). In addition, the client is also capable of talking to a git server, meaning that open source GitHub repositories can be worked on using our </span><a href="https://sapling-scm.com/" target="_blank" rel="noopener"><span>open-source Sapling release</span></a><span>.</span></p>
<p><span>The final component is the virtual file system. When checking out a repository of our scale, just the disk I/O of writing all the files can take a significant amount of time. One solution is </span><a href="https://git-scm.com/docs/git-sparse-checkout" target="_blank" rel="noopener"><span>sparse checkouts</span></a><span>, where a developer declares what subset of the repo they wish to see in advance. A more ergonomic alternative is EdenFS, which checks out everything in a few seconds but then only actually downloads the files from the server when they are accessed.</span></p>
<h2><span>Buck2: Build system</span></h2>
<p><span>After making changes, many developers at Meta use </span><a href="https://engineering.fb.com/2023/04/06/open-source/buck2-open-source-large-scale-build-system/" target="_blank" rel="noopener"><span>Buck2</span></a><span> to compile the results and test out their changes. Buck2 is designed to work at large scale, supporting remote caching and execution, so that developers can share each other’s compilations and a single developer can have access to thousands of machines to run compilations in parallel. Buck2 is also designed to support multiple programming languages simultaneously – so if you want your OCaml program to depend on a Rust library that uses a C++ library whose source code was generated by Erlang, that will work just fine.</span></p>
<p><span>Buck2 works well without Sapling, but has specific design considerations to enable Sapling and EdenFS. Buck2 uses Watchman to find out which files have changed, and Watchman supports EdenFS so that it can integrate smoothly with files that aren’t on the disk. Buck2 can also use specific EdenFS operations to access the file without going via the disk, optimizing performance on systems where virtual file systems can be slower.</span></p>
<h2><span>Infer, RacerD, and Jest: Testing and static analysis</span></h2>
<p><span>Handwritten tests and static analysis play an important role in making sure all of our code functions as intended. Working with the quantity of code we do at Meta means that we need tools that provide a high-quality signal, and do so very quickly.</span></p>
<p><span>For general static analysis, we use a platform called</span> <a href="https://fbinfer.com/" target="_blank" rel="noopener"><span>Infer</span></a><span>, which is</span> <a href="https://engineering.fb.com/2017/09/06/android/finding-inter-procedural-bugs-at-scale-with-infer-static-analyzer/" target="_blank" rel="noopener"><span>interprocedural</span></a><span> and supports multiple languages, including Java and C++. We also have more tailor-made analysis tools such as</span> <a href="https://engineering.fb.com/2017/10/19/android/open-sourcing-racerd-fast-static-race-detection-at-scale/" target="_blank" rel="noopener"><span>RacerD</span></a><span>, which detects Java concurrency bugs. RacerD played a big role in our project to</span> <a href="https://engineering.fb.com/2017/09/26/android/multithreaded-rendering-on-android-with-litho-and-infer/" target="_blank" rel="noopener"><span>move Facebook’s News Feed on Android from single-threaded to multi-threaded</span></a><span>.</span></p>
<p><span>We also have language-specific testing frameworks. For example, </span><a href="https://jestjs.io/" target="_blank" rel="noopener"><span>Jest</span></a><span> is our Javascript testing framework. In 2022</span> <a href="https://engineering.fb.com/2022/05/11/open-source/jest-openjs-foundation/" target="_blank" rel="noopener"><span>we officially transferred Jest to the OpenJS Foundation</span></a><span> to further support its growth within the wider industry.</span></p>
<p><span>Finally, there are tools that sit between static analysis and manual test cases. Our</span> <a href="https://engineering.fb.com/2018/05/02/developer-tools/sapienz-intelligent-automated-software-testing-at-scale/" target="_blank" rel="noopener"><span>Sapienz tool</span></a><span>, for example, automatically tests mobile apps by allowing developers to simulate the user experience to seek out crashes and other potential issues.</span></p>
<h2><span>Learn more about Meta’s developer workflow</span></h2>
<p><span>In addition to our open-source tools, our developers also use a number of proprietary tools in their day-to-day workflows as well. For example, Phabricator (Phab for short), our CI and reviewing tool, helps our developers review and submit stacks of diffs. You can find more about these tools (along with the ones covered above) in the article on </span><a href="https://developers.facebook.com/blog/post/2022/11/15/meta-developers-workflow-exploring-tools-used-to-code/" target="_blank" rel="noopener"><span>Meta developer’s workflow</span></a><span>.</span></p>

		
	</div></div>
  </body>
</html>
