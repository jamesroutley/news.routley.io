<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://0ut3r.space/2022/03/06/windows-defender/">Original</a>
    <h1>Windows Defender is enough, if you harden it</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
    <p>This article is not intended to convince you to abandon your current antivirus solutions. In this post I would like to share my observations and ways to improve the effectiveness of Defender.</p>
<p>You don’t need to buy expensive antivirus software. If you are a standard user, surfing the web, you don’t want to install additional software (eg. which can slow down your PC), or you just have other better things to buy, you can definitely use antivirus software built into your Windows operating system. There is no perfect solution, and no mater if you install free or paid antivirus, you can always be infected, if you do not use your own brain. Sometimes it is easier to break a person than their computer security. Then even the most expensive solution will not help.</p>
<p>Unfortunately, no one checks anyone’s skills before buying the first computer or smartphone. If you want to drive a car, you need to get a driving license. If you want to shoot a gun, you need to get a permit. If you want to connect to the internet and interact with it, you don’t have to do anything. Reading some comments on random websites I guess you don’t even need a brain. Every Internet user these days should be careful, check links, verify sources and be aware. Anyone, even a security specialist, can have a weaker day, so somewhere in the background there should be a program running to protect your computer and data.</p>
<p>There are people who boast that they never had an anti virus program. There are some who think free solutions are crap. There are also those who write that you must have an antivirus program and preferably the most expensive one with all functions. In my opinion, you can have whatever you want. But if you have Windows and a built-in antivirus program, which isn’t the worst, better have it turned on and brag about never having to intervene than one day cry about your data being encrypted.</p>
<p><img src="https://0ut3r.space/2022/03/06/windows-defender/defender.jpg" alt="defender"/></p>
<p><a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/windows/comprehensive-security">Windows Defender</a> is simple, but very good, built in antivirus and threat protection solution in modern Windows OS. It has account, app &amp; browser control, firewall and network protection and it helps you to keep your device secure. Interface of the software is a little bit different than standard antivirus software GUI you are familiar with. There aren’t too many configuration options here either, but all the available switches are well described. </p>
<p>Defender is not only used at home, but many large companies use Defender in conjunction with Sentinel (SIEM) and ASC as their primary protection. I myself had the opportunity to work in one of these companies and this solution had very good results. Because who, if not Microsoft alone, can defend his system best. Of course, together with colleagues from work, we have often laughed that all global companies that use Defender in production are beta testers (global testing environment) for Microsoft products. As many times as the administration interface changed without any announcement, or the product names evolved, once it was Microsoft Defender, then Windows Defender, sometimes you looked at Defender consoles, then it was Defender for Endpoint and then Defender ATP and Defender Security Center etc. There was a time when I didn’t know where I was logging in and what was its name, I was just analyzing the alerts under the currently working link :)</p>
<p>But today, let’s focus on Defender for the home user. It does not have additional functions that are offered by other commercial solutions, but what it does is enough. However, it is worth enabling some additional functions that are not available from the graphical interface.</p>
<p>The effectiveness of many antivirus programs is tested by sites such as <a target="_blank" rel="noopener" href="https://www.av-comparatives.org/vendors/microsoft/">AV Comparatives</a> or <a target="_blank" rel="noopener" href="https://www.av-test.org/en/antivirus/home-windows/windows-10/december-2021/microsoft-defender-4.18-211616/">AV Test</a>. You can check which antivirus is “the best”. If you take a moment to analyze it, you’ll see that it all changes month to month and year to year. In the past, Defender had poor marks, now it’s better, and so are the products of other companies.</p>
<p>So as I said, the interface is not the best and turning on some features that will improve Defender’s performance requires a bit of messing around with the system. This, for sure, deters some users and discourages those who want to install something and everything has to be done for them. But even paid solutions tire users with pop-up windows asking what now, what next, and how you would like it to work. Thanks to this, they learn the user’s behavior, which is sometimes a several-week process of making decisions and clicking on buttons, to shut down forever and notify you only in the event of an emergency.</p>
<h2 id="Local-group-policy-settings"><a href="#Local-group-policy-settings" title="Local group policy settings"></a>Local group policy settings</h2><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265982(v=ws.11)">Local group policy</a> setting is the key to make it better and harden Defender. Local Group Policy Editor is available only in pro/enterprise edition, but you can add it to the Home version of Windows too. If you do not want to enable this editor you can also change options described below in PowerShell chapter of this article. Anyway read this chapter to understand how it works, then it will be easier to change options using PowerShell.</p>
<p>Create <code>gpedit-enable.bat</code> file and put inside code (it works for Windows 10 and 11).</p>
<p><a target="_blank" rel="noopener" href="https://news.ycombinator.com/item?id=30580444#30581094">Hey man! Just not a bat file</a>. Yup, that’s true, random guy, random code, random website, ensure that the code is safe, click me. Sound like creepy scenario, fully agree. This is not a mandatory step and code was borrowed from <a target="_blank" rel="noopener" href="https://www.itechtics.com/enable-gpedit-msc-windows-11/">here for Windows 11</a> and <a target="_blank" rel="noopener" href="https://www.itechtics.com/enable-gpedit-windows-10-home/">here for Windows 10</a>. Check links for more details. <a target="_blank" rel="noopener" href="https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/Manwithtinfoilhat.jpg/800px-Manwithtinfoilhat.jpg">If you trust the links I serve</a> :) Either way, a big plus for being vigilant.</p>
<p>In any other case Google yourself solution for enabling Local group policy editor.</p>
<figure><table><tbody><tr><td><pre><span>1</span></pre></td><td><pre><span>@<span>echo</span> off</span></pre></td></tr></tbody></table></figure>

<p>Save it. Run it. Restart your PC and then run <code>gpedit.msc</code>. Once editor is open you can continue with next steps.</p>
<p>The code above is fancy version of checking admin rights and then enable policy editor.</p>
<h3 id="Enable-MAPS"><a href="#Enable-MAPS" title="Enable MAPS"></a>Enable MAPS</h3><p>Microsoft Advanced Protection Service (MAPS), enhances standard real-time protection by cloud-delivered protection and next-generation technologies.</p>
<p>Steps below will allow you to Join Microsoft Advanced Protection Service (MAPS), Configure Block at First Sight feature, Configure local setting override for reporting to Microsoft MAPS, Send file samples when further analysis is required, Select Cloud Protection level in Windows Defender and Configure extended cloud check.</p>
<p>In Local Group Policy Editor navigate to: <code>Computer Configuration &gt; Administrative Templates &gt; Windows Components &gt; Windows Defender Antivirus &gt; Maps</code> or <code>Computer Configuration &gt; Administrative Templates &gt; Windows Components &gt; Microsoft Defender Antivirus &gt; Maps</code> depends on your Windows version. Open <code>Join Microsoft MAPS</code> entry and change it to <code>Enabled</code>.  In options you can choose from dropdown menu MAPS level. Basic or Advanced Membership. (You can read about both in Help.) I choose <code>Advanced Membership</code>.</p>
<p><img src="https://0ut3r.space/2022/03/06/windows-defender/gpedit.png" alt="MAPS gpedit"/></p>
<p>Configure Block at First Sight feature</p>
<p>Then open <code>Configure the &#34;Block at First Sight&#34; feature</code> entry and also choose <code>Enabled</code>. Do the same for <code>Configure the local setting override for reporting to Microsoft MAPS</code>. In <code>Send File Samples when further submission is required</code> choose option based on your preferences. It is also very well described. I suggest <code>Send safe samples</code>.</p>
<p><img src="https://0ut3r.space/2022/03/06/windows-defender/gpedit_maps.png" alt="MAPS gpedit"/></p>
<p>Next go to <code>Computer Configuration &gt; Administrative Templates &gt; Windows Components &gt; Windows Defender Antivirus &gt; MpEngine</code> or <code>Computer Configuration &gt; Administrative Templates &gt; Windows Components &gt; Microsoft Defender Antivirus &gt; MpEngine</code>.  Edit entry <code>Select cloud protection level</code>, enable it and set options to <code>High blocking level</code>. This option will make Windows Defender Antivirus more aggressive when identifying suspicious files. Last entry to edit is <code>Configure extended cloud check</code>, enable it and set time to <code>50</code>.  The typical cloud check timeout is 10 seconds. To enable the extended cloud check feature, specify the extended time in seconds, up to an additional 50 seconds.</p>
<p>Reboot PC.</p>
<h2 id="Ransomware-protection"><a href="#Ransomware-protection" title="Ransomware protection"></a>Ransomware protection</h2><p>This can be enabled from GUI. Just type <code>Windows Security</code> in Menu Start, go to <code>Virus &amp; Threat protection</code> and at the bottom of that screen select <code>Ransomware protection</code> and click on <code>Manage ransomware protection</code> and select enable on <code>Controlled Folder access</code>.</p>
<h2 id="PowerShell"><a href="#PowerShell" title="PowerShell"></a>PowerShell</h2><p>Use PowerShell… yes, to setup some options in Defender you need to use PowerShell. Run PowerShell as Administrator and type <code>Get-MpPreference</code> to check current Defender configuration.</p>
<h3 id="Signature-update"><a href="#Signature-update" title="Signature update"></a>Signature update</h3><p>Set <code>SignatureUpdateInterval</code> to every 1 hour. </p>
<figure><table><tbody><tr><td><pre><span>1</span><br/></pre></td><td><pre><span><span>Set-MpPreference</span> <span>-SignatureUpdateInterval</span> <span>1</span></span><br/></pre></td></tr></tbody></table></figure>

<p>Also it is worth to force update new signatures before each scan starts.</p>
<figure><table><tbody><tr><td><pre><span>1</span><br/></pre></td><td><pre><span><span>Set-MpPreference</span> <span>-CheckForSignaturesBeforeRunningScan</span> <span>1</span></span><br/></pre></td></tr></tbody></table></figure>

<p>Read about other parameters on the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/defender/set-mppreference?view=windowsserver2022-ps&amp;viewFallbackFrom=win10-ps">official documentation</a> and tweak them as you wish.</p>
<h3 id="Enable-MAPS-1"><a href="#Enable-MAPS-1" title="Enable MAPS"></a>Enable MAPS</h3><p>If you skipped MAPS setup using Local Group Policy Editor you can see the same options in PowerShell.</p>
<p><code>MAPSReporting</code>, 0 - disabled, 2 - enabled threats and additional data will be sent to MS (Advanced Membership), 1 - only basic data (Basic Membership). Set this option using <code>Set-MpPreference</code>. This is the same for every other options described later.</p>
<p><code>SubmitSamplesConsent</code>, 0 - Always prompt, 1-  Send safe samples automatically, 2 - Never send, 3 - Send all samples automatically.</p>
<p><code>CloudBlockLevel</code>, described in documentation, in section above I suggested option 5 - High blocking level.</p>
<p><code>CloudExtendedTimeout</code>, set to <code>50</code>.</p>
<h3 id="Potentially-unwanted-software"><a href="#Potentially-unwanted-software" title="Potentially unwanted software"></a>Potentially unwanted software</h3><p>This can be enabled from GUI, but as you are already a pro Defender user you can use PowerShell for this too.</p>
<p><code>PUAProtection</code>, specifies the level of detection for potentially unwanted applications. When potentially unwanted software is downloaded or attempts to install itself on your computer, you are warned.</p>
<h2 id="GUI"><a href="#GUI" title="GUI"></a>GUI</h2><p>Of course rest of the options you should review is available in graphical interface of Windows Defender. Most important is part with <code>App &amp; browser control</code>, <code>Reputation-based protection</code>,  <code>Isolated browsing</code> (useful if you are using Edge) and <code>Exploit Protection</code>.</p>
<h2 id="Summary"><a href="#Summary" title="Summary"></a>Summary</h2><p>As you can see setting up Defender to be useful, is pretty easy and even you grandmother can do it. Lol. Also pray that another update will not change your settings to the default one ;) I have my fingers crossed for Windows Defender and I hope in the future it will be much better and user friendly with integration for other web browsers. In the meantime I am using <a target="_blank" rel="noopener" href="https://www.trendmicro.com/en_us/forHome/products/antivirus-plus.html">Trend Micro Antivirus+</a> and when license ends I will test <a target="_blank" rel="noopener" href="https://www.bitdefender.com/solutions/antivirus.html">Bitdefender Antivirus Plus</a>. What the heck did you think? That I am using Defender? Too much work with setup. I am too lazy. Let me know in the comments what do you prefer, and what do you think about Defender?</p>
<p>If you want to read interesting comments related to this article check <a target="_blank" rel="noopener" href="https://news.ycombinator.com/item?id=30580444">Hacker News thread</a>. Thank you all for great and constructive dialogue, it will definitely let me help to make my articles better. Sorry if anyone felt offended by my private additions about no brain or shooting people. Rather, it’s an innate sarcasm and my twisted logic, I live in Poland, everyone is a bit different here ;) My readers are a small group that knows that sometimes I turn up the atmosphere. From time to time, some Reddit or Hacker News will hit my article and then I know that not everyone will understand my sense of humor and the way I run this blog. I’m not ready for fame and glory yet ;)</p>

    </div></div>
  </body>
</html>
