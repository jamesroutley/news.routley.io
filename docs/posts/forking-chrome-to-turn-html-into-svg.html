<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://fathy.fr/html2svg">Original</a>
    <h1>Forking Chrome to turn HTML into SVG</h1>
    
    <div id="readability-page-1" class="page"><div id="root"><div><main>
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->

<blockquote>
<p>November 11th 2022</p>
</blockquote>
<p>I&#39;ve been working on a program called <a href="https://github.com/fathyb/html2svg" target="_blank"><code>html2svg</code></a>, it converts web pages to SVG. It&#39;s based on a fork of Chromium to support modern web standards. This post explains most patches.</p>
<h2 id="take-a-picture">Take a picture<a aria-label="Link to this title" href="https://fathy.fr/html2svg#take-a-picture"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 754.4294608960859 854.7113024446331" width="1508.8589217921717" height="1709.4226048892663" filter="invert(93%) hue-rotate(180deg)"><g stroke-linecap="round" transform="translate(281.46086005514644 400.3359024857399) rotate(0 84.65625 63.6015625)"><path d="M-1.96 -2.57 C40.1 4.59, 82.08 -0.27, 165.36 2.09 M1.15 -0.15 C66.1 2.03, 135.39 2.12, 167.47 1.23 M170.62 1.55 C169.1 41.33, 171.92 81.54, 165.56 130.44 M170.57 0.77 C170.19 45.55, 167.32 86.08, 169.64 128.6 M168.45 125.64 C128.06 129.66, 86.53 127.43, -2.51 125.54 M170.99 126.42 C107.15 128.17, 45.36 128.26, 0.91 127.21 M-0.64 124.89 C-4.97 88.11, -3.67 47.47, -1.72 0.3 M-0.33 127.65 C2.22 82.79, -1.44 41.62, 0.01 1.03" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(286.46086005514644 440.9374649857399) rotate(0 79.5 23)"><text x="79.5" y="32" font-family="Virgil,Trebuchet MS,Arial" font-size="36px" fill="#000000" text-anchor="middle" style="white-space:pre" direction="ltr">Skia</text></g><g stroke-linecap="round" transform="translate(10 601.8398405372449) rotate(0 84.65625 63.6015625)"><path d="M-1.7 2.42 C49.68 2.86, 89.7 2.72, 170.15 -0.76 M0.13 0.26 C50.14 -1.35, 95.32 0.31, 170.23 -0.11 M171.35 3.08 C167.22 39.71, 171.57 89.92, 166.9 124.67 M168.98 0.09 C167.97 45.66, 167.51 92.52, 170.71 126.38 M170.19 126.45 C114.3 125.31, 56.08 125.89, 0.16 130.97 M168.03 126.99 C132.39 124.04, 95.88 125.4, 0.74 126.88 M3.62 124.07 C-3.28 101.42, 0.44 77.26, 1.87 0.62 M-1.39 127.78 C-0.12 79.1, 1.19 29.34, -1.63 1.54" stroke="#000000" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(284.58558072045 118.95320430979825) rotate(0 84.65625 63.6015625)"><path d="M-0.58 1.63 C37.37 3.2, 81.6 0.86, 169.31 -1.09 M1.19 0.62 C41.38 2.33, 83.72 0.23, 167.33 -1.06 M172.11 0.21 C165.62 27.96, 169.77 67.65, 173.02 126.23 M170.52 1.49 C170.42 43.61, 170.35 91.32, 168.93 126.94 M169.83 130.29 C112.89 123.67, 59.87 129.27, -0.22 128.9 M170.85 125.36 C105.91 129.25, 47.76 127.72, -1.26 128.54 M0.19 125.61 C-1.04 89.28, -0.66 59.16, -1.64 1.59 M-0.38 128.46 C0.71 79.28, 1 29.62, 1.89 -1.71" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(289.58558072045 159.55476680979825) rotate(0 79.5 23)"><text x="79.5" y="32" font-family="Virgil,Trebuchet MS,Arial" font-size="36px" fill="#000000" text-anchor="middle" style="white-space:pre" direction="ltr">Blink</text></g><g stroke-linecap="round" transform="translate(282.3950021601563 597.9259466617999) rotate(0 84.65625 63.6015625)"><path d="M-2.06 -3.96 C49.37 3.64, 98.26 -1.15, 171.6 -0.31 M1.3 -1.84 C44.81 -2.11, 86.78 -2.79, 169.97 0.77 M169.23 -3.75 C172.88 40.84, 169.42 79.71, 171.84 128.75 M167.38 0.33 C172.67 43.42, 170.01 90.6, 168.88 126.42 M167.27 124.7 C119.63 128.64, 71.63 127.44, 3.36 125.64 M169.03 128.11 C114.83 129.41, 62.22 127.62, -0.32 126.05 M-2.42 125.49 C0.58 98.7, -0.36 63.43, -0.66 0.89 M0.11 127.21 C3.02 78.46, 2.3 29.48, -1.31 0.91" stroke="#000000" stroke-width="2" fill="none"></path></g><g stroke-linecap="round" transform="translate(561.2100128841935 600.3149514415439) rotate(0 84.65625 63.6015625)"><path d="M0.51 3.09 C56.26 -3.98, 115.92 1.61, 169.09 1.7 M1.54 -1.85 C59.54 -1.39, 124.34 -2.93, 168.05 1.34 M169.5 -1.6 C166.28 32.91, 166.66 73.62, 167.67 128.79 M168.94 1.26 C168.03 49.74, 168.32 97.74, 171.2 125.49 M168.88 125.93 C118.8 123.31, 73.43 126.5, -0.64 123.38 M167.74 125.35 C121.43 130.28, 74.37 131.21, 0.31 128.84 M1.16 123.65 C-0.23 96.4, -2.63 64.23, 3.08 1.11 M-1.84 127.39 C-0.43 99.4, 1.94 68.18, -0.35 0.25" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(566.2100128841935 640.9165139415439) rotate(0 79.5 23)"><text x="79.5" y="32" font-family="Virgil,Trebuchet MS,Arial" font-size="36px" fill="#000000" text-anchor="middle" style="white-space:pre" direction="ltr">PDF</text></g><g stroke-linecap="round" transform="translate(30.18839415516959 10) rotate(0 339.662109375 28.740234375)"><path d="M14.37 0 M14.37 0 C167.55 2.2, 320.17 3.24, 664.95 0 M14.37 0 C185.72 -4.55, 356.57 -4.16, 664.95 0 M664.95 0 C670.86 0.36, 678.14 8.13, 679.32 14.37 M664.95 0 C678.6 -0.18, 678.53 5.37, 679.32 14.37 M679.32 14.37 C677.71 25.8, 676.24 28.52, 679.32 43.11 M679.32 14.37 C677.98 25.51, 677.91 35.49, 679.32 43.11 M679.32 43.11 C683.14 52.73, 674.01 59.85, 664.95 57.48 M679.32 43.11 C676.02 49.86, 673.73 57.79, 664.95 57.48 M664.95 57.48 C429.06 52.86, 192.05 52.58, 14.37 57.48 M664.95 57.48 C411.66 60, 157.58 58.78, 14.37 57.48 M14.37 57.48 C3.5 55.38, -2.26 49.52, 0 43.11 M14.37 57.48 C1.25 61.43, -0.42 56.63, 0 43.11 M0 43.11 C-1.42 35.83, 3.12 22.43, 0 14.37 M0 43.11 C-1.22 32.86, 0.9 19.67, 0 14.37 M0 14.37 C0.96 5.2, 8.64 2.2, 14.37 0 M0 14.37 C2.12 6.69, 2.8 -1.91, 14.37 0" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(96.48136290516959 30.031562494165883) rotate(0 272.5 10)"><text x="0" y="16" font-family="Inconsolata,Monaco,Consolas,Courier New,Courier,monospace" font-size="16px" fill="#364fc7" text-anchor="start" style="white-space:pre" direction="ltr">&lt;div style=&#34;width: 50px; height: 50px; background: red&#34; /&gt;</text></g><g stroke-linecap="round" transform="translate(34.90091296660853 298.34863956227434) rotate(0 335.7636718749999 28.740234375)"><path d="M14.37 0 M14.37 0 C153.81 -1.54, 295.13 -2.9, 657.16 0 M14.37 0 C213.77 -4.33, 411.62 -4.19, 657.16 0 M657.16 0 C666.3 -3.21, 670.01 3.63, 671.53 14.37 M657.16 0 C670.33 -3.02, 668.69 6.55, 671.53 14.37 M671.53 14.37 C674.47 19.7, 674.99 33.84, 671.53 43.11 M671.53 14.37 C670.01 21.79, 671.1 31.8, 671.53 43.11 M671.53 43.11 C674.04 55.45, 664.15 57.99, 657.16 57.48 M671.53 43.11 C667.93 50.63, 662.32 61.64, 657.16 57.48 M657.16 57.48 C449.05 63.93, 237.23 61.92, 14.37 57.48 M657.16 57.48 C497.5 54.1, 339 54.09, 14.37 57.48 M14.37 57.48 C5.38 58.07, -1.98 51.36, 0 43.11 M14.37 57.48 C6.82 61.17, -2.98 56.65, 0 43.11 M0 43.11 C1.95 35.25, -2.23 23.35, 0 14.37 M0 43.11 C0.37 35.02, -1.42 24.45, 0 14.37 M0 14.37 C-2.82 3.33, 8.29 1.1, 14.37 0 M0 14.37 C3.63 8.56, 8.47 3.08, 14.37 0" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(63 318.264) rotate(0 300.5000000000001 10)"><text x="0" y="16" font-family="Inconsolata,Monaco,Consolas,Courier New,Courier,monospace" font-size="16px" fill="#5c940d" text-anchor="start" style="white-space:pre" direction="ltr">canvas-&gt;drawRect(0, 0, 50, 50, SkPaint { .fill = SkColor::Red })</text></g><g transform="translate(64.05145984183218 681.5168663839021) rotate(0 29.5 12.5)"><text x="29.5" y="18" font-family="Virgil,Trebuchet MS,Arial" font-size="20px" fill="#000000" text-anchor="middle" style="white-space:pre" direction="ltr">(GPU)</text></g><g transform="translate(34.48793696759685 624.5067439990938) rotate(0 63.5 23)"><text x="0" y="32" font-family="Virgil,Trebuchet MS,Arial" font-size="36px" fill="#000000" text-anchor="start" style="white-space:pre" direction="ltr">Ganesh</text></g><g transform="translate(307.1965142214849 624.3073960610153) rotate(0 62 23)"><text x="0" y="32" font-family="Virgil,Trebuchet MS,Arial" font-size="36px" fill="#000000" text-anchor="start" style="white-space:pre" direction="ltr">Raster</text></g><g transform="translate(339.6496758844778 679.8567225665823) rotate(0 28 12.5)"><text x="0" y="18" font-family="Virgil,Trebuchet MS,Arial" font-size="20px" fill="#000000" text-anchor="start" style="white-space:pre" direction="ltr">(CPU)</text></g><g stroke-linecap="round" transform="translate(275.68462026194084 787.5299528874801) rotate(0 92.50437803670434 27.15459250447782)"><path d="M-1.1 0.8 C40.97 1.41, 84.19 1.93, 188.82 0.04 M-1.23 -0.35 C53.19 3.92, 107.49 1.36, 185.26 -1.56 M186.04 1.44 C187.82 17.06, 187.72 24.81, 183.72 52.21 M186.73 -0.18 C185.86 13.52, 184.44 25.45, 184.34 55.19 M187.43 52.5 C112.93 59.19, 46.83 55.01, 0.96 54.72 M185.83 53.44 C110.87 54.6, 37.67 57.76, 0.55 55.89 M3.93 57.41 C-1.87 33.95, 2.7 9.15, -1.57 0.53 M-0.73 56.05 C2.76 38.64, 0.44 28.67, 0.72 1.55" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(287.2859920929345 802.2323583259159) rotate(0 82.5 12)"><text x="0" y="20" font-family="Inconsolata,Monaco,Consolas,Courier New,Courier,monospace" font-size="20px" fill="#0b7285" text-anchor="start" style="white-space:pre" direction="ltr">for(int i = 0;</text></g><g stroke-linecap="round" transform="translate(10.161049841823115 790.4021174356775) rotate(0 92.50437803670434 27.15459250447782)"><path d="M3.34 3.54 C38.33 0.4, 77.48 0.66, 181.8 -1.52 M-1.23 0.77 C49.6 2.83, 99.11 3.84, 183.76 1.68 M187.38 -2.87 C182.55 20.77, 185.29 45.45, 187.77 51.72 M183.09 1.81 C184.67 17.71, 186.09 35.57, 186.88 52.85 M181.84 51.23 C138.88 51.85, 89.31 52.81, 0.59 52.33 M183.71 56.03 C136.87 56.37, 85.44 58.12, 1.25 53.07 M2.2 56.16 C1.54 34.98, -1.77 16.28, -1.46 3.5 M1.6 55.65 C1.11 38.08, -1.36 18.94, 1.79 -1.84" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(22.409450408779094 804.171877000044) rotate(0 82.5 12)"><text x="0" y="20" font-family="Inconsolata,Monaco,Consolas,Courier New,Courier,monospace" font-size="20px" fill="#e67700" text-anchor="start" style="white-space:pre" direction="ltr">glDrawArrays()</text></g><g stroke-linecap="round" transform="translate(559.1483163388116 788.0273744985758) rotate(0 92.50437803670434 27.15459250447782)"><path d="M2.37 -2.87 C70.67 -0.21, 146.54 3.01, 187.77 -2.59 M-1.92 1.81 C58.37 2.38, 117.63 3.26, 186.88 -1.45 M181.84 -3.08 C187.87 14.18, 187.86 29.69, 185.6 52.33 M183.71 1.72 C186.7 13.58, 184.62 29.82, 186.26 53.07 M187.21 56.16 C126.69 56.14, 63.42 55.04, -1.46 57.8 M186.61 55.65 C126.4 58.89, 63.37 57.53, 1.79 52.47 M-3.69 57.3 C-1.6 43.62, 3.38 22.08, -1.12 3.58 M1.13 54.62 C-1.19 34.93, 0.79 19.18, 0.98 -0.77" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(567.4294608960859 802.9140529165796) rotate(0 88.5 12)"><text x="0" y="20" font-family="Inconsolata,Monaco,Consolas,Courier New,Courier,monospace" font-size="20px" fill="#c92a2a" text-anchor="start" style="white-space:pre" direction="ltr">M0,0 L50,0 L50</text></g><g stroke-linecap="round"><g transform="translate(644.5711148448913 731.0758978812854) rotate(0 -0.47895577332133143 26.090906606669137)"><path d="M-2.32 1.8 C-0.41 14.96, 4.1 40.35, -0.94 49.07 M0.35 -1.3 C1.41 19.58, 1.37 36.74, 0.01 53.48" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(644.5711148448913 731.0758978812854) rotate(0 -0.47895577332133143 26.090906606669137)"><path d="M2.78 51.76 L-9.37 42.59 L5.21 38.14 L1.41 50.97" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-1.73 54.83 C-3.15 46.09, -2 46.56, -7.08 37.19 M0.27 52.51 C-1.41 48.79, -3.76 42.37, -6.37 40.5 M-4.31 41.9 C-1.16 41.86, 5.14 39.62, 5.41 39.37 M-4.76 38.85 C-3.33 40.67, 1.03 39.17, 7.22 40.01 M5.47 37.72 C6.06 45.4, 4.12 48.02, -0.4 51.69 M7.36 40.21 C4.64 45.8, 2.8 50.62, -0.11 53.58 M0.01 53.48 C0.01 53.48, 0.01 53.48, 0.01 53.48 M0.01 53.48 C0.01 53.48, 0.01 53.48, 0.01 53.48" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(100.92270045859027 730.0914060143003) rotate(0 0.92469208968771 27.441287967206335)"><path d="M-1.16 3.12 C-2.77 13.37, 2.12 30.55, 3.33 52.35 M1.91 0.02 C-0.01 21.43, -0.24 39.3, 2.18 54.86" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(100.92270045859027 730.0914060143003) rotate(0 0.92469208968771 27.441287967206335)"><path d="M-1.73 53.74 L-1.92 43.42 L10.21 43.77 L4.44 55.48" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M1.32 57.21 C-1.8 49.24, -0.9 46.53, -4.9 40.2 M3.61 54.88 C-0.7 51.11, -4.43 44.52, -5.76 42.08 M-5.18 40 C-2.08 39.25, 5.93 41.87, 8.03 43.14 M-5.91 41.31 C-1.45 40.67, 3.09 42.28, 7 41.78 M6.12 42.02 C8.01 43.17, 6.64 51.39, 0.83 53.56 M7.48 40.85 C7.05 46.31, 4.61 50.95, 1.53 54.24 M2.18 54.86 C2.18 54.86, 2.18 54.86, 2.18 54.86 M2.18 54.86 C2.18 54.86, 2.18 54.86, 2.18 54.86" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(369.7830712387956 68.60037079296615) rotate(0 -0.31788983992908015 24.29495000846663)"><path d="M2.05 1.87 C0.69 13.45, -2.52 22.17, -2.69 50.22 M-0.74 -1.63 C1.78 10.92, -1.1 20.59, -0.3 47.22" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(369.7830712387956 68.60037079296615) rotate(0 -0.31788983992908015 24.29495000846663)"><path d="M0.11 51.07 L-4.42 35.46 L7.71 31.9 L-1.96 44.4" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M1.24 48.63 C-1.16 46.85, -4.89 42.93, -8.71 34.48 M-0.85 46 C-0.54 44.73, -4.05 41.35, -6.91 32.24 M-4.38 33.52 C-3.14 33.73, 0.94 31.38, 5.1 32.9 M-6.13 33.27 C-1.57 33.03, 3.86 32.99, 7.12 34.84 M3.9 31.79 C3.59 38, 4.08 43.96, -2.24 47.6 M7.42 34.02 C5.07 37.97, 4.32 40.95, -1.39 46.74 M-0.3 47.22 C-0.3 47.22, -0.3 47.22, -0.3 47.22 M-0.3 47.22 C-0.3 47.22, -0.3 47.22, -0.3 47.22" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(368.80835387827597 247.36943185047835) rotate(0 -0.3036015204015712 25.762404778646726)"><path d="M-0.66 0.89 C3.54 13.23, -3.71 32.95, 0.24 50.64 M-1.31 0.91 C-1.16 17.43, -1.47 34.16, -0.25 47.84" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(368.80835387827597 247.36943185047835) rotate(0 -0.3036015204015712 25.762404778646726)"><path d="M2.17 46.03 L-9.09 36.32 L7.81 31.42 L0.71 48.25" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-0.75 48.51 C0.12 40.9, -7.77 38.96, -7.34 36.17 M-1.23 48.52 C-3.8 43.81, -6.55 39.14, -7.71 34.07 M-9.08 34.46 C-5.09 32.07, -1.59 33.49, 7.43 36.15 M-7.49 33.61 C-4.08 34.02, 1.14 33.34, 4.53 34.4 M7.43 32.03 C6.36 40.5, 2.36 41.04, 1.53 45.69 M6.25 34.95 C2.96 37.43, 1.44 39.89, -1.69 49.2 M-0.25 47.84 C-0.25 47.84, -0.25 47.84, -0.25 47.84 M-0.25 47.84 C-0.25 47.84, -0.25 47.84, -0.25 47.84" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(368.17335079971645 358.73377625126784) rotate(0 0.10553548647567368 18.848285684538382)"><path d="M-0.43 -1.27 C-2.45 9.07, 0.68 23.03, 0.8 34.09 M-1.57 -1.85 C0.68 10.73, 2.01 22.4, 1.75 39.55" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(368.17335079971645 358.73377625126784) rotate(0 0.10553548647567368 18.848285684538382)"><path d="M2.34 40.14 L-6.74 24.7 L9.68 29.08 L-0.84 42.99" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M1.42 38.59 C-1.76 34.34, -1.57 32.89, -5.24 23.16 M0.57 38.16 C-0.08 35.84, -1.23 32.71, -4.53 27.26 M-4.03 23.78 C-1.2 25.57, 0.25 24.07, 9.87 26.58 M-5.93 26.15 C-2.2 27.1, 2.24 25.96, 7.7 26.04 M7.05 28.22 C3.94 27.93, 5.28 32.9, 2.34 37.76 M9.35 25.89 C5.26 31.94, 2.09 35.19, 1.48 39.65 M1.75 39.55 C1.75 39.55, 1.75 39.55, 1.75 39.55 M1.75 39.55 C1.75 39.55, 1.75 39.55, 1.75 39.55" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(368.37001432981765 726.1290716617999) rotate(0 -0.6405748893529335 30.09894212358688)"><path d="M1.03 1.99 C2.08 17.47, -2.91 39.51, -2.43 55.03 M-1.57 1.27 C1.03 20.07, 0.71 41.63, -0.17 58.93" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(368.37001432981765 726.1290716617999) rotate(0 -0.6405748893529335 30.09894212358688)"><path d="M3.74 61.01 L-9.07 45.62 L9.41 43.85 L-4 61.98" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M0.61 60.43 C-0.34 53.32, -5.72 51.24, -7.09 42.64 M-1.34 59.88 C-2.37 52.75, -4.49 47.74, -5.39 45.57 M-4.41 45.7 C0.07 43.27, 3.32 47.9, 6.93 47.43 M-6.48 44.2 C-1.04 46.67, 4.87 44.96, 5.97 46.77 M6.04 45.52 C6.7 51.33, -0.07 52.78, 0.66 60.08 M5.75 46.12 C4.97 49.53, 2.33 54.41, -0.36 60.05 M-0.17 58.93 C-0.17 58.93, -0.17 58.93, -0.17 58.93 M-0.17 58.93 C-0.17 58.93, -0.17 58.93, -0.17 58.93" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(368.13233349450684 529.7387986565626) rotate(0 0.9358518883145734 34.673200391384285)"><path d="M1.7 1.2 C1.32 12.57, -1.41 32.53, 2.11 68.15 M0.23 1.47 C2.87 13.51, -0.19 27.28, -0.24 64.83" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(368.13233349450684 529.7387986565626) rotate(0 0.9358518883145734 34.673200391384285)"><path d="M0.95 65.29 L-2.34 47.8 L10.16 54.62 L-0.51 61.84" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M1.04 65.72 C-1.07 59.77, -4.72 60.33, -5.6 53.51 M-0.07 65.93 C-0.19 61.62, -3.99 58.49, -7.36 51.02 M-7.61 53.5 C0.37 50.41, 3.94 50.95, 6.36 53.61 M-5.92 51.58 C-1.68 51.33, 1.89 50.74, 6.87 51.9 M6.02 53.62 C5.39 57.95, 2.64 58.79, 2.71 64.32 M6.91 50.52 C3.82 55.65, 4.4 58.49, 0.29 64.98 M-0.24 64.83 C-0.24 64.83, -0.24 64.83, -0.24 64.83 M-0.24 64.83 C-0.24 64.83, -0.24 64.83, -0.24 64.83" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(367.6828937889213 528.5390274857399) rotate(0 140.09069543294333 32.75267668328331)"><path d="M1.76 -0.4 C6.77 4.9, -11.29 26.41, 30.68 31.29 C72.65 36.17, 211.99 23.07, 253.58 28.89 C295.17 34.71, 275.63 60.23, 280.2 66.23 M-0.73 -3.09 C3.97 2.74, -12.96 30.27, 29.13 34.92 C71.23 39.57, 210.11 19.18, 251.83 24.79 C293.56 30.41, 273.91 61.92, 279.48 68.59" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(367.6828937889213 528.5390274857399) rotate(0 140.09069543294333 32.75267668328331)"><path d="M276.57 67.31 L270.39 53.06 L282 51.64 L282.92 68.23" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M279.05 69.96 C277.29 64.53, 277.86 57.57, 272.02 53.59 M278.57 67.95 C277.98 65.97, 275.98 60.86, 272.25 55.65 M272.63 55.33 C278.76 56.5, 282.79 57.15, 283.51 55.86 M272.79 55.02 C274.94 54.37, 279.31 55.62, 284.3 54.63 M284.27 57.22 C285.97 58.5, 281.2 62.89, 279.15 66.19 M284.18 53.79 C284.17 58.02, 282.4 61.18, 280.54 67.66 M279.48 68.59 C279.48 68.59, 279.48 68.59, 279.48 68.59 M279.48 68.59 C279.48 68.59, 279.48 68.59, 279.48 68.59" stroke="#000000" stroke-width="2" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(368.7351172011854 528.5390274857399) rotate(0 -139.80114524211922 36.06929312141892)"><path d="M0.01 0.11 C-4.33 5.07, 15.64 26.48, -26.43 31.07 C-68.49 35.66, -210.57 20.83, -252.39 27.65 C-294.2 34.48, -273.3 64.84, -277.3 72 M-3.44 -2.3 C-7.87 2.82, 14.6 28.03, -27.23 33.39 C-69.06 38.76, -212.69 23.05, -254.44 29.89 C-296.18 36.73, -274.82 67.65, -277.7 74.44" stroke="#000000" stroke-width="2" fill="none"></path></g><g transform="translate(368.7351172011854 528.5390274857399) rotate(0 -139.80114524211922 36.06929312141892)"><path d="M-279.96 71.27 L-288.95 65.3 L-273.69 63.51 L-277.11 75.03" stroke="none" stroke-width="0" fill="#000000" fill-rule="evenodd"></path><path d="M-277.58 77.27 C-282.72 70.37, -284.22 65.32, -286.2 60.91 M-277.15 74.2 C-280.98 71.19, -281.17 69.78, -287.05 60.47 M-284.69 62.25 C-279.97 59.54, -277.06 58.89, -272.59 57.84 M-286.91 62.84 C-281.46 60.52, -277.84 60.56, -274.49 60.21 M-273.44 59.57 C-273.88 63.72, -277.85 66.79, -278.57 76.78 M-273.73 60.39 C-275.41 64.55, -276.49 68.1, -276.27 74.45 M-277.7 74.44 C-277.7 74.44, -277.7 74.44, -277.7 74.44 M-277.7 74.44 C-277.7 74.44, -277.7 74.44, -277.7 74.44" stroke="#000000" stroke-width="2" fill="none"></path></g></g></svg>
<p>Chromium is built on top of Blink: an HTML engine forked from WebKit, and Skia: a 2D engine also used in Firefox and Android.</p>
<p>Blink consumes the HTML input, and Skia produces the graphical output. The Chromium compositor (<code>cc</code>) is in between, but we&#39;ll ignore it for now.</p>
<p>In order to support multiple platforms and targets, Skia is built to render into a back-end: it could be its GPU renderer called Ganesh, its software rasterizer, or even a PDF file. This is how Chromium can work with or without a GPU and export web pages to PDF files with high fidelity.</p>
<p>Recently, an experimental SVG back-end has been added to Skia. We&#39;re going to use this to build <code>html2svg</code>.</p>
<p>To get started, we&#39;ll need to find a way to render the page into an SVG canvas and expose it under a JS API.</p>
<p>The <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/saving-skp-s-from-chromium/" target="_blank">Chromium docs explains how you can export an <code>.skp</code> file</a> using the <code>--enable-gpu-benchmarking</code> flag.</p>
<p>An <code>.skp</code> file is a binary representation of an <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/core/SkPicture.h;drc=8928b024556f913015a48edab03384311c3c45d8;l=39" target="_blank"><code>SkPicture</code></a>, a C++ class containing Skia drawing instructions that can be replayed into any canvas through its <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/core/SkPicture.h;drc=8928b024556f913015a48edab03384311c3c45d8;l=131" target="_blank"><code>playback()</code></a> method.</p>
<p>Looking at the code we can find that it uses <a href="https://source.chromium.org/chromium/chromium/src/+/main:cc/layers/layer.h;drc=501455e6942313c87a276e8fde93e507786cc51c;l=693" target="_blank"><code>cc::Layer::GetPicture()</code></a> to get an <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/core/SkPicture.h;drc=8928b024556f913015a48edab03384311c3c45d8;l=39" target="_blank"><code>SkPicture</code></a>:</p>
<pre><code><span>// Recursively serializes the layer tree.</span>
<span>// Each layer in the tree is serialized into a separate skp file</span>
<span>// in the given directory.</span>
<span>void</span> <span>Serialize</span><span>(</span><span>const</span> cc<span>::</span>Layer<span>*</span> root_layer<span>)</span> <span>{</span>
    <span>for</span> <span>(</span><span>auto</span><span>*</span> layer <span>:</span> <span>*</span>root_layer<span>-&gt;</span><span>layer_tree_host</span><span>(</span><span>)</span><span>)</span> <span>{</span>
        sk_sp<span>&lt;</span><span>const</span> SkPicture<span>&gt;</span> picture <span>=</span> layer<span>-&gt;</span><span>GetPicture</span><span>(</span><span>)</span><span>;</span>
        <span>if</span> <span>(</span><span>!</span>picture<span>)</span>
            <span>continue</span><span>;</span>
</code></pre>
<h2 id="declare-a-function">Declare a function<a aria-label="Link to this title" href="https://fathy.fr/html2svg#declare-a-function"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>We&#39;re going to add a new global JS API into Chromium to get started, let&#39;s call it <code>getPageContentsAsSVG()</code>.</p>
<p>The GPU extension we&#39;re using to generate <code>.skp</code> files registers itself in <a href="https://source.chromium.org/chromium/chromium/src/+/main:content/renderer/render_frame_impl.cc;l=3817-3838;drc=501455e6942313c87a276e8fde93e507786cc51c" target="_blank"><code>content::RenderFrameImpl::DidClearWindowObject()</code></a> which makes sense: it has access to the rendering data, and it&#39;s called right after <code>window</code>, the global object, is created. Adding the following at the end of this method is enough to get our global function registered.</p>
<pre><code><span>// Get access to the JS VM for this process (each tab is a process)</span>
v8<span>::</span>Isolate<span>*</span> isolate <span>=</span> blink<span>::</span><span>MainThreadIsolate</span><span>(</span><span>)</span><span>;</span>
<span>// Automatic v8::Local destruction</span>
v8<span>::</span>HandleScope <span>handle_scope</span><span>(</span>isolate<span>)</span><span>;</span>
<span>// Get the JS context for the current tab</span>
v8<span>::</span>Local<span>&lt;</span>v8<span>::</span><span>Context</span><span>&gt;</span> context <span>=</span> <span>GetWebFrame</span><span>(</span><span>)</span><span>-&gt;</span><span>MainWorldScriptContext</span><span>(</span><span>)</span><span>;</span>
<span>// Automatic context entry/exit</span>
v8<span>::</span><span>Context</span><span>::</span>Scope <span>context_scope</span><span>(</span>context<span>)</span><span>;</span>
<span>// Get the global object (window)</span>
v8<span>::</span>Local<span>&lt;</span>v8<span>::</span>Object<span>&gt;</span> global <span>=</span> context<span>-&gt;</span><span>Global</span><span>(</span><span>)</span><span>;</span>

<span>// Create a new JS function binding</span>
v8<span>::</span>Local<span>&lt;</span>v8<span>::</span>FunctionTemplate<span>&gt;</span> fn <span>=</span> v8<span>::</span><span>FunctionTemplate</span><span>::</span><span>New</span><span>(</span>
    isolate<span>,</span>
    <span>[</span><span>]</span><span>(</span><span>const</span> v8<span>::</span>FunctionCallbackInfo<span>&lt;</span>v8<span>::</span>Value<span>&gt;</span><span>&amp;</span> args<span>)</span> <span>{</span>
        v8<span>::</span>Isolate<span>*</span> isolate <span>=</span> blink<span>::</span><span>MainThreadIsolate</span><span>(</span><span>)</span><span>;</span>

        args<span>.</span><span>GetReturnValue</span><span>(</span><span>)</span><span>.</span><span>Set</span><span>(</span>
            v8<span>::</span><span>String</span><span>::</span><span>NewFromUtf8</span><span>(</span>isolate<span>,</span> <span>&#34;imagine this is svg&#34;</span><span>)</span><span>.</span><span>ToLocalChecked</span><span>(</span><span>)</span>
        <span>)</span><span>;</span>
    <span>}</span>
<span>)</span><span>;</span>

<span>// Register the function as getPageContentsAsSVG()</span>
global<span>-&gt;</span><span>Set</span><span>(</span>
    context<span>,</span>
    v8<span>::</span><span>String</span><span>::</span><span>NewFromUtf8</span><span>(</span>isolate<span>,</span> <span>&#34;getPageContentsAsSVG&#34;</span><span>)</span><span>.</span><span>ToLocalChecked</span><span>(</span><span>)</span><span>,</span>
    fn<span>-&gt;</span><span>GetFunction</span><span>(</span>context<span>)</span><span>.</span><span>ToLocalChecked</span><span>(</span><span>)</span>
<span>)</span><span>.</span><span>Check</span><span>(</span><span>)</span><span>;</span>
</code></pre>
<a href="https://fathy.fr/assets/c7a193d1c5298d66a90f.gif" target="_blank"><img src="https://fathy.fr/assets/c7a193d1c5298d66a90f.gif" alt="Running getPageContentsAsSVG() in the Chromium debugger" loading="lazy"/></a>
<p>Let&#39;s run Chromium, open the debugger and try.. and it works! Now we need to do some actual work inside the function.</p>
<h2 id="render-to-svg">Render to SVG<a aria-label="Link to this title" href="https://fathy.fr/html2svg#render-to-svg"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<pre><code><span>// Get access to the main JS VM for this process (each tab is a process)</span>
v8<span>::</span>Isolate<span>*</span> isolate <span>=</span> blink<span>::</span><span>MainThreadIsolate</span><span>(</span><span>)</span><span>;</span>
<span>// Automatic v8::Local destruction</span>
v8<span>::</span>HandleScope <span>handle_scope</span><span>(</span>isolate<span>)</span><span>;</span>
<span>// Get the WebLocalFrame for the current v8 Context</span>
<span>auto</span><span>*</span> frame <span>=</span> <span>WebLocalFrame</span><span>::</span><span>FrameForCurrentContext</span><span>(</span><span>)</span><span>;</span>
<span>// Get access to the root rendering layer</span>
<span>auto</span><span>*</span> root <span>=</span> frame<span>-&gt;</span><span>LocalRoot</span><span>(</span><span>)</span><span>-&gt;</span><span>FrameWidget</span><span>(</span><span>)</span><span>-&gt;</span><span>LayerTreeHost</span><span>(</span><span>)</span><span>-&gt;</span><span>root_layer</span><span>(</span><span>)</span><span>;</span>

<span>// Go over each sub-layer</span>
<span>for</span> <span>(</span><span>auto</span><span>*</span> layer <span>:</span> <span>*</span>root<span>-&gt;</span><span>layer_tree_host</span><span>(</span><span>)</span><span>)</span> <span>{</span>
    <span>// Get vectorial data for this layer</span>
    <span>auto</span> picture <span>=</span> layer<span>-&gt;</span><span>GetPicture</span><span>(</span><span>)</span><span>;</span>

    <span>// Skip if we get there is no data</span>
    <span>if</span> <span>(</span><span>!</span>picture<span>)</span> <span>{</span>
        <span>continue</span><span>;</span>
    <span>}</span>

    <span>// Create a memory stream to save the SVG content</span>
    SkDynamicMemoryWStream stream<span>;</span>
    <span>// Create an SVG canvas with the dimensions of the layer</span>
    <span>auto</span> canvas <span>=</span> <span>SkSVGCanvas</span><span>::</span><span>Make</span><span>(</span>picture<span>-&gt;</span><span>cullRect</span><span>(</span><span>)</span><span>,</span> <span>&amp;</span>stream<span>)</span><span>;</span>

    <span>// Draw the layer data into the SVG canvas</span>
    canvas<span>-&gt;</span><span>drawPicture</span><span>(</span>picture<span>.</span><span>get</span><span>(</span><span>)</span><span>)</span><span>;</span>

    <span>// Allocate a buffer to hold the SVG data</span>
    <span>auto</span> size <span>=</span> stream<span>.</span><span>bytesWritten</span><span>(</span><span>)</span><span>;</span>
    <span>auto</span><span>*</span> bytes <span>=</span> <span>new</span> <span>char</span><span>[</span>size<span>]</span><span>;</span>

    <span>// Copy from the stream to the buffer</span>
    stream<span>.</span><span>copyTo</span><span>(</span><span><span>static_cast</span><span><span>&lt;</span><span>void</span> <span>*</span><span>&gt;</span></span></span><span>(</span>bytes<span>)</span><span>)</span><span>;</span>

    <span>// Return the data to the JS world</span>
    args<span>.</span><span>GetReturnValue</span><span>(</span><span>)</span><span>.</span><span>Set</span><span>(</span>
        <span>// Copy the UTF-8 buffer into an UTF-16 JS string</span>
        v8<span>::</span><span>String</span><span>::</span><span>NewFromUtf8</span><span>(</span>isolate<span>,</span> bytes<span>,</span> v8<span>::</span>NewStringType<span>::</span>kNormal<span>,</span> size<span>)</span><span>.</span><span>ToLocalChecked</span><span>(</span><span>)</span>
    <span>)</span><span>;</span>

    <span>// Release the allocated data</span>
    <span>delete</span><span>[</span><span>]</span> bytes<span>;</span>

    <span>// Don&#39;t process any other layers</span>
    <span>break</span><span>;</span>
<span>}</span>
</code></pre>
<p>This won&#39;t work because <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/public/web/web_frame_widget.h;drc=790f34372e0f51a8dfc9693ea979cdb024a5112e;l=225" target="_blank"><code>blink::WebFrameWidget::LayerTreeHost()</code></a> is private. Let&#39;s make <a href="https://source.chromium.org/chromium/chromium/src/+/main:content/renderer/render_frame_impl.h;drc=790f34372e0f51a8dfc9693ea979cdb024a5112e;l=166" target="_blank"><code>content::RenderFrameImpl</code></a> a friend class:</p>
<pre><code>  <span>// GPU benchmarking extension needs access to the LayerTreeHost</span>
  <span>friend</span> <span>class</span> <span>GpuBenchmarkingContext</span><span>;</span>
</code></pre>
<pre><code><span><span>+</span><span> // Allow RenderFrameImpl to access the LayerTreeHost for html2svg
</span><span>+</span><span> friend class content::RenderFrameImpl;
</span></span></code></pre>
<p>Linking error now, we need to bundle <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/svg/SkSVGCanvas.h;drc=a2925fa7cca10bbe5462437c95ba71f2b19ff908;l=20" target="_blank"><code>SkSVGCanvas</code></a>:</p>
<pre><code><span><span>-</span><span> # Remove unused util sources.
</span><span>-</span><span> sources -= [ &#34;//third_party/skia/src/utils/SkParsePath.cpp&#34; ]
</span></span><span><span>+</span><span> # Add SVG dependencies for html2svg
</span><span>+</span><span> deps += [ &#34;//third_party/expat&#34; ]
</span><span>+</span><span> sources += [
</span><span>+</span><span>     &#34;//third_party/skia/src/xml/SkDOM.cpp&#34;,
</span><span>+</span><span>     &#34;//third_party/skia/src/svg/SkSVGCanvas.cpp&#34;,
</span><span>+</span><span>     &#34;//third_party/skia/src/svg/SkSVGDevice.cpp&#34;,
</span><span>+</span><span>     &#34;//third_party/skia/src/xml/SkXMLParser.cpp&#34;,
</span><span>+</span><span>     &#34;//third_party/skia/src/xml/SkXMLWriter.cpp&#34;,
</span><span>+</span><span> ]
</span></span></code></pre>
<a href="https://fathy.fr/assets/bbb71459bdf8c10b748f.png" target="_blank"><img src="https://fathy.fr/assets/bbb71459bdf8c10b748f.png" loading="lazy"/></a>
<p><code>getPageContentsAsSVG()</code> does output something that resembles SVG, but there is an error opening it: XML closing tags are missing.</p>
<p><a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/svg/SkSVGCanvas.h;drc=a2925fa7cca10bbe5462437c95ba71f2b19ff908;l=20" target="_blank"><code>SkSVGCanvas</code></a> closes tags when its destructor is called:</p>
<pre><code><span>SkSVGDevice</span><span>::</span><span>~</span><span>SkSVGDevice</span><span>(</span><span>)</span> <span>{</span>
    <span>// Pop order is important.</span>
    <span>while</span> <span>(</span><span>!</span>fClipStack<span>.</span><span>empty</span><span>(</span><span>)</span><span>)</span> <span>{</span>
        fClipStack<span>.</span><span>pop_back</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span>
</code></pre>
<p>Let&#39;s wrap it in a scope:</p>
<pre><code><span>// Create a memory stream to save the SVG content</span>
SkDynamicMemoryWStream stream<span>;</span>

<span>{</span>
    <span>// Create an SVG canvas with the dimensions of the layer</span>
    <span>auto</span> canvas <span>=</span> <span>SkSVGCanvas</span><span>::</span><span>Make</span><span>(</span>picture<span>-&gt;</span><span>cullRect</span><span>(</span><span>)</span><span>,</span> <span>&amp;</span>stream<span>)</span><span>;</span>

    <span>// Draw the layer data into the SVG canvas</span>
    canvas<span>-&gt;</span><span>drawPicture</span><span>(</span>picture<span>.</span><span>get</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>}</span>

<span>// Allocate a buffer to hold the SVG data</span>
<span>auto</span> size <span>=</span> stream<span>.</span><span>bytesWritten</span><span>(</span><span>)</span><span>;</span>
<span>auto</span><span>*</span> bytes <span>=</span> <span>new</span> <span>char</span><span>[</span>size<span>]</span><span>;</span>
</code></pre>
<a href="https://fathy.fr/assets/78db8459cc90193eeba0.svg" target="_blank"><img src="https://fathy.fr/assets/78db8459cc90193eeba0.svg" loading="lazy"/></a>
<p>Better, but the text is rendered with a serif font and has weird kerning.</p>
<p>The serif font is caused by the SVG doesn&#39;t embed custom fonts, we can fix that by adding a fallback to the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/font-family" target="_blank"><code>font-family</code></a> attribute of <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/text" target="_blank"><code>&lt;text&gt;</code></a> elements:</p>
<pre><code><span><span>-</span><span> if (!familyName.isEmpty()) {
</span><span>-</span><span>     this-&gt;addAttribute(&#34;font-family&#34;, familyName);
</span><span>-</span><span> }
</span></span><span><span>+</span><span> familyName.appendf(
</span><span>+</span><span>     (familyName.isEmpty() ? &#34;%s&#34; : &#34;, %s&#34;),
</span><span>+</span><span>     &#34;-apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;&#34;
</span><span>+</span><span> );
</span><span>+</span><span>
</span><span>+</span><span> this-&gt;addAttribute(&#34;font-family&#34;, familyName);
</span></span></code></pre>
<p>The weird kerning appears because the position of each character is set, we can workaround this by only setting the position of the first character:</p>
<pre><code><span><span>-</span><span> fPosXStr.appendf(&#34;%.8g, &#34;, position.fX);
</span><span>-</span><span> fPosYStr.appendf(&#34;%.8g, &#34;, position.fY);
</span></span><span><span>+</span><span> if (fPosXStr.isEmpty()) {
</span><span>+</span><span>     fPosXStr.appendf(&#34;%.8g&#34;, position.fX);
</span><span>+</span><span> }
</span><span>+</span><span>
</span><span>+</span><span> if (fPosYStr.isEmpty()) {
</span><span>+</span><span>     fPosYStr.appendf(&#34;%.8g&#34;, position.fY);
</span><span>+</span><span> }
</span></span></code></pre>
<p>Little better! Here are some results:</p>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><a href="https://fathy.fr/assets/296aa4cb373df3aac1fc.svg" target="_blank"><img src="https://fathy.fr/assets/296aa4cb373df3aac1fc.svg" alt="HN rendered to SVG" loading="lazy"/></a></td><td><a href="https://fathy.fr/assets/ad5f7f36602964694bd2.svg" target="_blank"><img src="https://fathy.fr/assets/ad5f7f36602964694bd2.svg" alt="Google rendered to SVG" loading="lazy"/></a></td></tr><tr><td><a href="https://fathy.fr/assets/b82ac36fa730f6685bdc.svg" target="_blank"><img src="https://fathy.fr/assets/b82ac36fa730f6685bdc.svg" alt="Twitter rendered to SVG" loading="lazy"/></a></td><td><a href="https://fathy.fr/assets/5c8a82454a84da5af9a2.svg" target="_blank"><img src="https://fathy.fr/assets/5c8a82454a84da5af9a2.svg" alt="MDN rendered to SVG" loading="lazy"/></a></td></tr></tbody></table>
<h2 id="fix-the-t-in-twitter">Fix the T in Twitter<a aria-label="Link to this title" href="https://fathy.fr/html2svg#fix-the-t-in-twitter"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>So the <code>T</code> letter is missing from twitter.com, just the <code>T</code> letter. Hmm okay weird, here&#39;s how Blink and Skia handles font data:</p>
<ol>
<li>Blink loads fonts from the system or remotely and maps them into the <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/core/SkTypeface.h;drc=2562144c11c0b6bb8693e7565842384b5f05f36f;l=50" target="_blank"><code>SkTypeface</code></a> class</li>
<li><a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/core/SkTypeface.h;drc=2562144c11c0b6bb8693e7565842384b5f05f36f;l=50" target="_blank"><code>SkTypeface</code></a> uses a font back-end internally: <a href="https://developer.apple.com/documentation/coretext" target="_blank"><code>CoreText</code></a> for macOS, <a href="https://learn.microsoft.com/en-us/windows/win32/directwrite/direct-write-portal" target="_blank"><code>DirectWrite</code></a> for Windows, and <a href="https://freetype.org" target="_blank"><code>FreeType</code></a> for Linux.</li>
<li>The font back-end parses raw font files and exports an array of supported UTF-32 code points and their vectorial representations, the position in the array is called the glyph ID.</li>
<li>Blink passes the text to <a href="https://harfbuzz.github.io" target="_blank">HarfBuzz</a> which returns a set of glyph IDs and their relative positions, theses are passed to Skia which will picks the vectorial data and render it.</li>
</ol>
<p>Step 4 is needed to support ligatures and some languages. Arabic characters for example, have to be rendered differently based on their position in a word. This is why HarfBuzz is between Blink and Skia: it shapes a string of unicode characters into a set of glyph IDs and their positions.</p>
<!-- -->
<p><svg width="100%" height="100%" viewBox="0 0 425 150"><text fill="white" font-size="90" font-family="&#39;Plus Jakarta Sans&#39;" x="50%" y="50%" text-anchor="middle" dominant-baseline="middle">fātḥȳ</text></svg><svg width="100%" height="100%" viewBox="0 0 425 150"><text fill="white" font-size="90" font-family="Janna LT Regular" x="50%" y="50%" text-anchor="middle" dominant-baseline="middle">فاتْحي</text></svg></p>
<p>Take my name written in latin and arabic script, add a space between letters and the characters are rendered differently in arabic. The unicode characters do not change, but their graphical representation do.</p>
<p>Some of this logic is implemented in HarfBuzz, and some is implemented in font files through tables:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/typography/opentype/spec/cmap" target="_blank"><strong><code>CMAP</code></strong></a>: the <strong>c</strong>haracter <strong>map</strong> table, map glyph ID and its platform encoding ID</li>
<li><a href="https://learn.microsoft.com/en-us/typography/opentype/spec/gsub" target="_blank"><strong><code>GSUB</code></strong></a>: the <strong>g</strong>lyph <strong>sub</strong>stitution table, map one or more glyph IDs to one one more glyph IDs, that&#39;s where ligatures are declared</li>
</ul>
<p>A font implementing a ligature for <code>fi</code> will have a <code>GSUB</code> entry to replace the glyphs for <code>f</code> and <code>i</code> with a special glyph for <code>fi</code>, and this special glyph will very likely map to a special character in the <code>CMAP</code> table.</p>
<p>And that&#39;s the problem, <code>getGlyphToUnicodeMap()</code> just goes over the <code>CMAP</code> table, the <code>T</code> from Twitter is very likely implemented as a substitution on the <code>GSUB</code> table, which maps to a special character, which won&#39;t map to a valid Unicode codepoint.</p>
<p>Our back-end is SVG, it is supposed to handle text shaping already, so we need to bypass HarfBuzz. Text shaping is handled by <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/platform/fonts/font.cc;l=233;drc=9d817b1cfebcb123bab29651e532081c3a900c5c" target="_blank"><code>blink::Font::DrawText()</code></a>, which send data to HarfBuzz and then calls <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/platform/fonts/font.cc;l=152-207;drc=9d817b1cfebcb123bab29651e532081c3a900c5c" target="_blank"><code>blink::Font::DrawBlobs()</code></a> with the glyph data. We&#39;re going to use <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/core/SkTextBlob.h;l=89-112;drc=1aea90338109cdc5735ffef278ffb3385ef8a70b" target="_blank"><code>SkTextBlob::MakeFromString()</code></a> to build a text blob of nominal glyphs from a string. These will map 1:1 to a unicode codepoint, allowing the SVG viewer to handle text shaping. Here&#39;s what the patch looks like:</p>
<pre><code><span><span>-</span><span>  CachingWordShaper word_shaper(*this);
</span><span>-</span><span>  ShapeResultBuffer buffer;
</span><span>-</span><span>  word_shaper.FillResultBuffer(run_info, &amp;buffer);
</span><span>-</span><span>  ShapeResultBloberizer::FillGlyphs bloberizer(
</span><span>-</span><span>      GetFontDescription(), device_scale_factor &gt; 1.0f, run_info, buffer,
</span><span>-</span><span>      draw_type == Font::DrawType::kGlyphsOnly
</span><span>-</span><span>          ? ShapeResultBloberizer::Type::kNormal
</span><span>-</span><span>          : ShapeResultBloberizer::Type::kEmitText);
</span><span>-</span><span>  DrawBlobs(canvas, flags, bloberizer.Blobs(), point, node_id);
</span></span><span><span>+</span><span>  // Bypass HarfBuzz text shaping for html2svg
</span><span>+</span><span>  auto blob = SkTextBlob::MakeFromString(
</span><span>+</span><span>    StringView(run_info.run.ToStringView(), run_info.from, run_info.to - run_info.from).
</span><span>+</span><span>      ToString().
</span><span>+</span><span>      Utf8().
</span><span>+</span><span>      c_str(),
</span><span>+</span><span>    PrimaryFont()-&gt;
</span><span>+</span><span>      PlatformData().
</span><span>+</span><span>      CreateSkFont(false, &amp;font_description_)
</span><span>+</span><span>  );
</span><span>+</span><span>
</span><span>+</span><span>  if (node_id != cc::kInvalidNodeId) {
</span><span>+</span><span>    canvas-&gt;drawTextBlob(blob, point.x(), point.y(), node_id, flags);
</span><span>+</span><span>  } else {
</span><span>+</span><span>    canvas-&gt;drawTextBlob(blob, point.x(), point.y(), flags);
</span><span>+</span><span>  }
</span></span></code></pre>
<h2 id="surface-compositing">Surface compositing<a aria-label="Link to this title" href="https://fathy.fr/html2svg#surface-compositing"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<!-- -->
<div><div><pre>&gt;
 
 
 
 
 </pre><pre><code>text <span>=</span> main<span>.</span><span>onCreateDevice</span><span>(</span><span>)</span>
text<span>.</span><span>drawText</span><span>(</span><span>&#34;chocolatine&#34;</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>)</span>
gradient <span>=</span> main<span>.</span><span>onCreateDevice</span><span>(</span><span>)</span>
gradient<span>.</span><span>drawRect</span><span>(</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>500</span><span>,</span> <span>150</span><span>)</span>
text<span>.</span><span>drawDevice</span><span>(</span>gradient<span>,</span> SkBlendMode<span>::</span>DstIn<span>)</span>
main<span>.</span><span>drawDevice</span><span>(</span>text<span>,</span> SkBlendMode<span>::</span>Over<span>)</span>
</code></pre>
<!-- -->
</div><svg viewBox="0 100 572 256"><g transform="translate(80 100) rotate(0 52 10)" fill="#ffffff"><text x="0" y="16" font-size="16px" font-family="Inconsolata, Monaco, Consolas, Courier New, Courier, monospace" text-anchor="start" direction="ltr">Main canvas</text><g transform="translate(-35, 75) scale(.25)"><path d="m317.66 469.74 21.324 5.2656s18.238-1.4922 27.988-2.4375c9.7461-0.94531 6.5625-12.727 6.5625-12.727l-27.164-7.8789-17.105-2.3633s-19.219 4.2227-21.965 6.7109c-2.7422 2.4805 10.359 13.43 10.359 13.43z"></path><path d="m265.68 454.08c4.4688-1.7656 9.0312-4.6406 12.727-7.293 3.082-2.2109 1.8125-7.0547-1.9492-7.5312l-29.812-3.75s-21.586 7.5312-19.074 12.266c2.5078 4.7344 35.266 7.4336 38.109 6.3086z"></path><path d="m595.32 321.29c-3.7695-4.793-12.527-18.648-19.02-29.121 5.4023-7.3086-29.816-36.535-68.859-53.52-43.516-18.93-146.24-27.582-178.08-19.582-31.84 8-85.543 55.641-98.23 71.492-12.906 16.125-60.996 76.02-68.305 90.324-7.3086 14.309-10.668 37.219-6.2227 46.793 2.832 6.1055 8.4141 19.668 11.914 28.27 0 0-4.9766 0.80078-5.8906 3.168-0.91406 2.3711-2.5703 14.574-0.96484 17.758 1.6055 3.1875 147.25 42.617 168.71 43.223 20.805 0.58594 107.66-13.527 114.99-18.887 7.3359-5.3594 68.5-49.59 82.312-65.812 4.75-5.5781 14.766-14.645 25.887-24.375 20.223-17.703 44.09-37.605 46.531-42.766 3.7695-7.9922 1.7695-38.645-4.7734-46.965zm-6.6914 40.914c-2.4922 9.625-46.566 35.145-65.609 56.309-13.242 14.715-53.738 45.355-75.949 59.996 2.9492-8.6602 22.121-28.508 7.9141-46.121-25.254-8.6836-58.984-48.02-89.637-56.391-45.199-19.66-144.74-5.0703-144.74-5.0703l-4.2891 12.094s96.129-9.8516 142.67 6.2305c33.586 11.609 61.633 38.281 74.832 46.25 0.015626 0.015625 8.2695 3.4766 13.223 12.316 4.6328 8.2773-13.664 28.906-24.32 38.531-10.812 9.7656-73.621 16.316-95.172 14.855-21.457-1.4531-140.45-30.84-140.45-37.746l0.60547-2.5664c20.922 5.4922 118.66 31.262 150.05 31.578 49.285 0.49609 80.227-16.195 80.227-16.195s3.3906-11.008-1.7773-15.383c-17.465-14.801-52.086-21.906-73.699-32.449-11.969-5.8359-62.355-12.469-68.375-14.18-17.168-4.875-35.812-0.29297-52.047 3.7617-16.234 4.0547-20.445 17.477-20.445 17.477l8.0117 7.2109s10.434-10.844 17.707-13.441c7.2734-2.5938 24.867-7.9648 43.754-1.6211 14.695 4.9336 47.305 4.9688 57.371 9.8359 31.965 15.453 65.812 20.742 71.734 27.555 5.2383 6.0195-22.941 11.977-49.305 13.465-39.543 2.2266-143.97-25.895-151.88-29.945-3.7695-1.9336-10.609-22.559-5.3047-29.34 2.25-2.875 17.848-16.973 48.105-13.543 26.965 3.0547 59.699-2.1836 87.59 4.0273 17.883 3.9844 46.25 20.223 64.309 31.367 10.109 6.2383 27.742 17.215 27.742 17.215l9.7695-7.9102s-17.336-10.98-27.207-17.41c-19.41-12.637-51.535-32.16-71.344-36.824-31.809-7.4961-68.93-0.38281-96.184-4.7695-32.73-5.2656-54.922 17.402-57.602 20.113-5.3789 5.4453-0.67187 23.406 1.8086 31.469-0.046875-0.015625-0.10547-0.03125-0.14844-0.050781l-2.9492-1.25c-3.832-11.246-4.6016-15.758-5.9805-25.25-1.7773-12.223 4.3086-27.984 8.957-34.238 0 0 44.375-60.281 62.75-81.988 16.75-19.781 49.098-52.312 87.02-66.008 37.926-13.695 133.49 5.0312 164.57 17.168 22.527 8.8008 64.305 27.895 65.758 40.203 1.1367 9.6406 19.445 33.273 23.633 39.234 5 7.1289 5.5117 26.746 4.2969 31.43z "></path></g></g><g transform="translate(10 128) rotate(0 130 107)" stroke-linecap="round"><path d="M2.205540542742491 -4.213014162967394 C84.0194331813902 9.144886617092853, 169.66067578817032 4.9969395347241035, 259.22512888537483 -2.3547705569663253 M-0.8901776173230885 -0.2683116925387849 C62.2151470185952 1.681485378498702, 125.49979503112843 4.051256308093137, 258.25206895035245 -1.9342548428610944 M262.0532129610599 -3.89779218698351 C251.84162835003298 65.52649645682109, 257.15536251176036 140.2121596962377, 254.95689668380575 209.76158408961058 M258.4407844316078 2.2123351898986976 C258.54192562763274 61.04614567930709, 254.45553316311276 128.18171762479375, 260.7369043539184 210.82423011528428 M257.7746641547618 211.2853850844869 C202.12060703598274 209.0189257525022, 140.72082013307673 213.70416409592812, -0.13105064194726448 209.32303466778845 M258.04652869926616 209.34721424122867 C192.5814250539765 215.48307902542692, 123.8008583319835 215.21789592662347, -0.41291391801647476 208.90087345100576 M4.857455470410277 211.94654490987693 C-2.5518890186347205 170.4837708637564, -1.106236268001573 124.38661979302023, -2.410465606707358 -1.385558329579169 M-1.7777110428710918 211.43551312397724 C-2.7060316947493974 165.84771876823743, -3.0731518618206994 117.23210662434732, 2.3509926914093233 1.8953426378604428" fill="none" stroke="white" stroke-width="1"></path><g transform="translate(5 5)"><g style="opacity:0;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms"><defs><defs><linearGradient x1="0" y1="0" x2="241" y2="0" id="linear-gradient" gradientUnits="userSpaceOnUse" gradientTransform="translate(521 643)"><stop offset="0" stop-color="#007FFF"></stop><stop offset="1" stop-color="#0059B2"></stop></linearGradient></defs><rect fill="url(#linear-gradient)" width="241" height="66"></rect></defs><text x="25" y="40" font-size="36px" direction="ltr" text-anchor="start" fill="url(#linear-gradient)" font-family="Virgil, Trebuchet MS, Arial">chocolatine</text></g></g></g><g style="opacity:1;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms"><g transform="translate(375 98) rotate(0 71 10)"><text x="0" y="16" fill="#ffffff" font-size="16px" direction="ltr" font-family="Inconsolata, Monaco, Consolas, Courier New, Courier, monospace" text-anchor="start">Text surface</text></g><g transform="translate(315 127) rotate(0 119 32)" stroke-linecap="round"><g style="opacity:0;transition:opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms"><text x="25" y="40" font-size="36px" direction="ltr" text-anchor="start" fill="white" font-family="Virgil, Trebuchet MS, Arial">chocolatine</text></g><path d="M-3.19 2.73 C91.52 -1.77, 184.83 -1.44, 240.48 -2.09 M0.43 -1.2 C93.75 3.59, 190.55 1.8, 239.63 1.22 M236.42 1.82 C241.42 23.03, 238.97 49.57, 242.78 64.02 M240.19 -0.81 C239.33 18.65, 237.93 38.9, 241.29 65.54 M238.02 62.68 C166.96 59.53, 91.09 60.04, 0.08 63.34 M240.28 64.59 C159.94 63.31, 81.11 65.26, -1.35 64.58 M-1.39 62.23 C3.88 44.24, 3.53 32.53, -1.79 -2.67 M0.52 64.48 C-0.58 50.72, -1.38 37.91, 0.38 -1.82" fill="none" stroke="#ffffff" stroke-width="1"></path></g></g></svg></div>
<p>Testing <a href="https://mui.com" target="_blank"><code>mui.com</code></a> I noticed some text elements with a gradient effect did not render. This is because <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/src/svg/SkSVGDevice.h;drc=c86141266d10f8614ceda96678a924133cb6da25;l=47" target="_blank"><code>SkSVGDevice</code></a> does not implement surface compositing: drawing into a surface, and then rendering this surface using a <a href="https://www.w3.org/TR/compositing-1/#porterduffcompositingoperators" target="_blank">Porter-Duff compositing operation</a>.</p>
<p>We need to implement <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/src/core/SkDevice.h;l=435-448;drc=c86141266d10f8614ceda96678a924133cb6da25" target="_blank"><code>SkBaseDevice::onCreateDevice()</code></a> and <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/src/core/SkDevice.h;l=361-369;drc=c86141266d10f8614ceda96678a924133cb6da25" target="_blank"><code>SkBaseDevice::drawDevice()</code></a> to support this. On the GPU renderer it creates a texture, on the CPU renderer it allocates a buffer, and on SVG we&#39;re going to use <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/g" target="_blank"><code>&lt;g&gt;</code></a>.</p>
<p>I won&#39;t go into too much details on the implementation as it probably deserves its own post, but basically we use <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/g" target="_blank"><code>&lt;g&gt;</code></a> elements to create textures, <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/use" target="_blank"><code>&lt;use&gt;</code></a> to display them, and <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feComposite" target="_blank"><code>&lt;feComposite&gt;</code></a> to blend them.</p>
<table><thead><tr><th>Before</th><th>After</th></tr></thead><tbody><tr><td><a href="https://fathy.fr/assets/6207f13ae9aecbd664fc.svg" target="_blank"><img src="https://fathy.fr/assets/6207f13ae9aecbd664fc.svg" alt="" loading="lazy"/></a></td><td><a href="https://fathy.fr/assets/e256b6cffbdf1120069f.svg" target="_blank"><img src="https://fathy.fr/assets/e256b6cffbdf1120069f.svg" alt="" loading="lazy"/></a></td></tr></tbody></table>
<h2 id="render-the-whole-page">Render the whole page<a aria-label="Link to this title" href="https://fathy.fr/html2svg#render-the-whole-page"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>Only the first ~6,000 pixels are rendered. We need to get the compositor to draw the whole page, and <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/public/web/web_local_frame.h;l=772-781;drc=3f7a9d89de4c434583d520384b01ce87178ce888" target="_blank"><code>blink::WebLocalFrame::capturePaintPreview()</code></a> does exactly that! It seems to have been implemented for the phising classifier, there was a <a href="https://blog.chromium.org/2021/07/m92-faster-and-more-efficient-phishing-detection.html" target="_blank">Chromium blog post about it</a>. Combined with <a href="https://source.chromium.org/chromium/chromium/src/+/main:cc/paint/paint_recorder.h;drc=3f7a9d89de4c434583d520384b01ce87178ce888;l=18" target="_blank"><code>cc::PaintRecorder</code></a> we can get it to render into our canvas.</p>
<pre><code>cc<span>::</span>PaintRecorder recorder<span>;</span>
<span>auto</span> rect <span>=</span> <span>SkRect</span><span>::</span><span>MakeWH</span><span>(</span>width<span>,</span> height<span>)</span><span>;</span>

frame<span>-&gt;</span><span>CapturePaintPreview</span><span>(</span>
    gfx<span>::</span><span>Rect</span><span>(</span><span>0</span><span>,</span> <span>0</span><span>,</span> width<span>,</span> height<span>)</span><span>,</span>
    recorder<span>.</span><span>beginRecording</span><span>(</span>rect<span>)</span><span>,</span>
    <span>false</span><span>,</span>
    <span>false</span>
<span>)</span><span>;</span>

<span>auto</span> canvas <span>=</span> <span>SkSVGCanvas</span><span>::</span><span>Make</span><span>(</span>rect<span>,</span> <span>&amp;</span>stream<span>)</span><span>;</span>

recorder<span>.</span><span>finishRecordingAsPicture</span><span>(</span><span>)</span><span>-&gt;</span><span>Playback</span><span>(</span>canvas<span>.</span><span>get</span><span>(</span><span>)</span><span>)</span><span>;</span>
</code></pre>
<a href="https://fathy.fr/assets/a35012bbe4d0a2b54cb3.png" target="_blank"><img src="https://fathy.fr/assets/a35012bbe4d0a2b54cb3.png" loading="lazy"/></a>
<p>We now have another problem, the macOS scrollbar also gets rendered into the SVG! Suprisingly, it&#39;s fully vectorized. We can work around this by adding some CSS in the Electron code:</p>
<pre><code><span>const</span> style <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;style&#39;</span><span>)</span>

style<span>.</span><span>innerHTML</span> <span>=</span> <span><span>`</span><span>
    body::-webkit-scrollbar,
    body::-webkit-scrollbar-track,
    body::-webkit-scrollbar-thumb {
        display: none;
    }
</span><span>`</span></span>

<span>document</span><span>.</span><span>head</span><span>.</span><span>appendChild</span><span>(</span>style<span>)</span>
</code></pre>
<h2 id="support-shadows">Support shadows<a aria-label="Link to this title" href="https://fathy.fr/html2svg#support-shadows"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>One thing missing is shadows. Skia doesn&#39;t explicitly support drawing them, but it provides the two main ingredients: gaussian blur and clipping.</p>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1009 465" width="1009" height="465"><rect y="10" rx="10" ry="10" width="400" height="150" fill="#d3d3d3"></rect><filter id="blur"><feGaussianBlur stdDeviation="5"></feGaussianBlur></filter><rect x="600" y="10" rx="10" ry="10" width="400" height="150" fill="#d3d3d3" filter="url(#blur)"></rect><rect x="300" y="310" rx="10" ry="10" width="400" height="150" fill="#d3d3d3" filter="url(#blur)"></rect><rect x="300" y="310" rx="10" ry="10" width="400" height="150" fill="#020307"></rect><g transform="translate(175 42) scale(0.75)"><g stroke-linecap="round"><g transform="translate(298.36508128190235 50.60074319535852) rotate(0 131.13272756508832 -0.9949955466639722)"><path d="M0.14 -1.25 C57.48 4.43, 110.64 4.25, 262.37 -3.25 M-0.1 -1.2 C99.83 1.83, 199.32 0.28, 261.93 -4.72" stroke="#ffffff" stroke-width="1" fill="none"></path></g><g transform="translate(298.36508128190235 50.60074319535852) rotate(0 131.13272756508832 -0.9949955466639722)"><path d="M262.84 -1.61 L245.73 2.16 L245.27 -9.1 L263.47 -6.28" stroke="none" stroke-width="0" fill="#ffffff" fill-rule="evenodd"></path><path d="M262.07 -5.89 C259.49 -1.7, 253.14 0.4, 250.47 2.65 M261.84 -5.85 C257.02 -2.99, 251.71 -0.45, 250.07 1.27 M251.05 2.36 C248.55 -2.67, 249.32 -3.43, 246 -11.31 M249.58 3.26 C248.24 -3.24, 248.18 -7.18, 247.71 -9.07 M250.81 -12.97 C253.12 -11.22, 256.89 -6.85, 262.49 -6.74 M249.04 -11.03 C251.21 -9.92, 254.74 -7.1, 261.78 -3.52 M261.93 -4.72 C261.93 -4.72, 261.93 -4.72, 261.93 -4.72 M261.93 -4.72 C261.93 -4.72, 261.93 -4.72, 261.93 -4.72" stroke="#ffffff" stroke-width="1" fill="none"></path></g></g><g transform="translate(367.8271570387333 10) rotate(0 59.5 12)"><text x="20" y="22" font-family="Inconsolata,Monaco,Consolas,Courier New,Courier,monospace" font-size="22px" fill="#ffffff" text-anchor="start" style="white-space:pre" direction="ltr">blur()</text></g><g transform="translate(379.74152739046986 253.65835448828398) rotate(0 48 12)"><text x="8" y="13" font-family="Inconsolata,Monaco,Consolas,Courier New,Courier,monospace" font-size="22px" fill="#ffffff" text-anchor="start" style="white-space:pre" direction="ltr">clip()</text></g><g stroke-linecap="round"><g transform="translate(11.073163060425031 156.97287559203278) rotate(0 182.78577955746186 55.843330688438186)"><path d="M0.25 -1.07 C8.29 15.85, -11.75 82.31, 49.31 100.81 C110.38 119.32, 313.71 108.28, 366.64 109.95 M-1.07 0.99 C6.75 18.15, -12.49 83.97, 48.66 102.25 C109.8 120.52, 312.7 109.06, 365.8 110.64" stroke="#ffffff" stroke-width="1" fill="none"></path></g><g transform="translate(11.073163060425031 156.97287559203278) rotate(0 182.78577955746186 55.843330688438186)"><path d="M363.9 110.03 L351.94 117.14 L352.58 104.38 L367.42 112.28" stroke="none" stroke-width="0" fill="#ffffff" fill-rule="evenodd"></path><path d="M364.46 111.33 C360.21 113.03, 353.65 115.95, 351.86 118.61 M365.78 111.08 C361.45 113.37, 358.04 114.6, 351.6 116.79 M351.23 116.91 C351.62 112.66, 353.18 110.62, 351.59 103.72 M352.76 117.7 C352.16 112.95, 352.23 107.73, 352.01 104.01 M352.74 103.02 C355.21 105.35, 360.83 109.56, 365.19 110.33 M352.33 103.84 C354.85 105.67, 358.54 108.11, 365.79 110.49 M365.8 110.64 C365.8 110.64, 365.8 110.64, 365.8 110.64 M365.8 110.64 C365.8 110.64, 365.8 110.64, 365.8 110.64" stroke="#ffffff" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(425.0867277315774 277.0231538878429) rotate(0 0.3058898840240545 38.680799142182195)"><path d="M0.04 1.06 C0.42 13.92, 1.65 64.34, 2.01 76.79 M-1.4 0.57 C-1.18 13.09, 0.4 62.14, 0.85 74.84" stroke="#ffffff" stroke-width="1" fill="none"></path></g><g transform="translate(425.0867277315774 277.0231538878429) rotate(0 0.3058898840240545 38.680799142182195)"><path d="M2.71 76.79 L-6.64 59.6 L4.93 60.73 L0.43 73.46" stroke="none" stroke-width="0" fill="#ffffff" fill-rule="evenodd"></path><path d="M2.17 74.34 C-0.59 70.86, -3.73 68.89, -5.29 61.93 M0.97 74.66 C-0.7 70.59, -4.32 65.99, -5.57 61.57 M-4.91 60.98 C0.14 61.01, 3.43 60.32, 6.11 61.15 M-6.13 61.62 C-3.42 61.51, -0.76 61.74, 6.93 60.81 M5.86 62.36 C3.56 64.51, 3.36 72.15, 0.69 73.63 M6.8 61.07 C4.9 64.61, 4.32 67.77, 0.11 74.59 M0.85 74.84 C0.85 74.84, 0.85 74.84, 0.85 74.84 M0.85 74.84 C0.85 74.84, 0.85 74.84, 0.85 74.84" stroke="#ffffff" stroke-width="1" fill="none"></path></g></g><g stroke-linecap="round"><g transform="translate(819.5323437567195 162.74997657274298) rotate(0 -170.47875682945096 52.99468963696802)"><path d="M-0.12 -0.97 C-6.96 14.9, 16.09 78.7, -40.51 96.39 C-97.12 114.08, -290 103.91, -339.78 105.19 M-1.65 1.14 C-8.16 17.18, 18.24 77.13, -38.29 94.7 C-94.82 112.27, -290.73 104.9, -340.83 106.57" stroke="#ffffff" stroke-width="1" fill="none"></path></g><g transform="translate(819.5323437567195 162.74997657274298) rotate(0 -170.47875682945096 52.99468963696802)"><path d="M-339.19 107.69 L-328.58 101.2 L-327.27 114.68 L-341.24 108.13" stroke="none" stroke-width="0" fill="#ffffff" fill-rule="evenodd"></path><path d="M-342.04 105.41 C-335.21 103.71, -331.43 102.3, -328.46 101.29 M-341.08 105.85 C-337.24 104.73, -332.04 102.54, -326.97 99.76 M-327.88 99.43 C-328.07 103.43, -326.92 109.1, -326.47 112.27 M-326.64 100.82 C-326.74 104.49, -327.95 108.61, -327.34 112.78 M-328.02 114.08 C-330.13 110.14, -333.2 110.33, -342.25 106.93 M-327.65 112.44 C-333.16 110.72, -338.1 107.54, -340.6 107.04 M-340.83 106.57 C-340.83 106.57, -340.83 106.57, -340.83 106.57 M-340.83 106.57 C-340.83 106.57, -340.83 106.57, -340.83 106.57" stroke="#ffffff" stroke-width="1" fill="none"></path></g></g></g></svg>
<p>We need to add some code to handle the <code>maskFilter</code> property of <code>SkPaint</code>, it contains the <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/skia/include/effects/SkBlurMaskFilter.h;drc=c86141266d10f8614ceda96678a924133cb6da25;l=19" target="_blank"><code>SkBlurMaskFilter</code></a> used for bluring:</p>
<pre><code><span><span>+</span><span>    if (const SkMaskFilter* mf = paint.getMaskFilter()) {
</span><span>+</span><span>        SkMaskFilterBase::BlurRec maskBlur;
</span><span>+</span><span>
</span><span>+</span><span>        if (as_MFB(mf)-&gt;asABlur(&amp;maskBlur) &amp;&amp; maskBlur.fStyle == kNormal_SkBlurStyle) {
</span><span>+</span><span>            SkString maskfilterID = fResourceBucket-&gt;addColorFilter();
</span><span>+</span><span>
</span><span>+</span><span>            AutoElement filterElement(&#34;filter&#34;, fWriter);
</span><span>+</span><span>
</span><span>+</span><span>            filterElement.addAttribute(&#34;id&#34;, maskfilterID);
</span><span>+</span><span>
</span><span>+</span><span>            AutoElement floodElement(&#34;feGaussianBlur&#34;, fWriter);
</span><span>+</span><span>
</span><span>+</span><span>            floodElement.addAttribute(&#34;stdDeviation&#34;, maskBlur.fSigma);
</span><span>+</span><span>
</span><span>+</span><span>            resources.fMaskFilter.printf(&#34;url(#%s)&#34;, maskfilterID.c_str());
</span></span></code></pre>
<p>The clipping code had to be refactored because shadows extend outside of standard clipping bounds, but we&#39;ll skip it as it is involved.</p>
<h2 id="vectorize-canvas">Vectorize <code>&lt;canvas&gt;</code><a aria-label="Link to this title" href="https://fathy.fr/html2svg#vectorize-canvas"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>What if we could also vectorize 2D <code>&lt;canvas&gt;</code> elements controlled by JavaScript? Turns out, Chromium has this capability built-in for printing:</p>
<pre><code><span>// For 2D Canvas, there are two ways of render Canvas for printing:</span>
<span>// display list or image snapshot. Display list allows better PDF printing</span>
<span>// and we prefer this method.</span>
<span>// Here are the requirements for display list to be used:</span>
<span>//    1. We must have had a full repaint of the Canvas after beforeprint</span>
<span>//       event has been fired. Otherwise, we don&#39;t have a PaintRecord.</span>
<span>//    2. CSS property &#39;image-rendering&#39; must not be &#39;pixelated&#39;.</span>

<span>// display list rendering: we replay the last full PaintRecord, if Canvas</span>
<span>// has been redraw since beforeprint happened.</span>
<span>if</span> <span>(</span><span>IsPrinting</span><span>(</span><span>)</span> <span>&amp;&amp;</span> <span>IsRenderingContext2D</span><span>(</span><span>)</span> <span>&amp;&amp;</span> canvas2d_bridge_<span>)</span> <span>{</span>
</code></pre>
<p>All we need is to make <code>IsPrinting()</code> return <code>true</code>:</p>
<pre><code><span><span> </span><span> bool HTMLCanvasElement::IsPrinting() const {
</span></span><span><span>-</span><span>   return GetDocument().BeforePrintingOrPrinting();
</span></span><span><span>+</span><span>   return true;
</span></span><span><span> </span><span> }
</span></span></code></pre>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="3456" height="2102"><defs><g id="group_0"><clipPath id="cl_3"><rect width="300" height="300"></rect></clipPath><g clip-path="url(#cl_3)"><path fill="none" stroke="white" stroke-width="1" stroke-miterlimit="10" transform="scale(2 2)" d="M12 27L12 147Q12 147.368 12.0181 147.736Q12.0361 148.104 12.0722 148.47Q12.1083 148.837 12.1624 149.201Q12.2164 149.565 12.2882 149.926Q12.3601 150.288 12.4495 150.645Q12.539 151.002 12.6459 151.354Q12.7528 151.707 12.8768 152.053Q13.0009 152.4 13.1418 152.74Q13.2827 153.08 13.4402 153.413Q13.5976 153.746 13.7712 154.071Q13.9448 154.396 14.1341 154.712Q14.3234 155.027 14.528 155.334Q14.7325 155.64 14.9519 155.935Q15.1712 156.231 15.4048 156.516Q15.6384 156.801 15.8857 157.073Q16.133 157.346 16.3934 157.607Q16.6538 157.867 16.9266 158.114Q17.1995 158.362 17.4841 158.595Q17.7687 158.829 18.0645 159.048Q18.3603 159.267 18.6664 159.472Q18.9726 159.677 19.2885 159.866Q19.6043 160.055 19.929 160.229Q20.2538 160.402 20.5867 160.56Q20.9195 160.717 21.2597 160.858Q21.5999 160.999 21.9467 161.123Q22.2934 161.247 22.6457 161.354Q22.9981 161.461 23.3553 161.55Q23.7125 161.64 24.0736 161.712Q24.4348 161.784 24.799 161.838Q25.1633 161.892 25.5297 161.928Q25.8962 161.964 26.264 161.982Q26.6318 162 27 162L147 162Q147.368 162 147.736 161.982Q148.104 161.964 148.47 161.928Q148.837 161.892 149.201 161.838Q149.565 161.784 149.926 161.712Q150.288 161.64 150.645 161.55Q151.002 161.461 151.354 161.354Q151.707 161.247 152.053 161.123Q152.4 160.999 152.74 160.858Q153.08 160.717 153.413 160.56Q153.746 160.402 154.071 160.229Q154.396 160.055 154.712 159.866Q155.027 159.677 155.334 159.472Q155.64 159.267 155.935 159.048Q156.231 158.829 156.516 158.595Q156.801 158.362 157.073 158.114Q157.346 157.867 157.607 157.607Q157.867 157.346 158.114 157.073Q158.362 156.801 158.595 156.516Q158.829 156.231 159.048 155.935Q159.267 155.64 159.472 155.334Q159.677 155.027 159.866 154.712Q160.055 154.396 160.229 154.071Q160.402 153.746 160.56 153.413Q160.717 153.08 160.858 152.74Q160.999 152.4 161.123 152.053Q161.247 151.707 161.354 151.354Q161.461 151.002 161.55 150.645Q161.64 150.288 161.712 149.926Q161.784 149.565 161.838 149.201Q161.892 148.837 161.928 148.47Q161.964 148.104 161.982 147.736Q162 147.368 162 147L162 27Q162 26.6318 161.982 26.264Q161.964 25.8962 161.928 25.5297Q161.892 25.1633 161.838 24.799Q161.784 24.4348 161.712 24.0736Q161.64 23.7125 161.55 23.3553Q161.461 22.9981 161.354 22.6457Q161.247 22.2934 161.123 21.9467Q160.999 21.5999 160.858 21.2597Q160.717 20.9195 160.56 20.5867Q160.402 20.2538 160.229 19.929Q160.055 19.6043 159.866 19.2885Q159.677 18.9726 159.472 18.6664Q159.267 18.3603 159.048 18.0645Q158.829 17.7687 158.595 17.4841Q158.362 17.1995 158.114 16.9266Q157.867 16.6538 157.607 16.3934Q157.346 16.133 157.073 15.8857Q156.801 15.6384 156.516 15.4048Q156.231 15.1712 155.935 14.9519Q155.64 14.7325 155.334 14.528Q155.027 14.3234 154.712 14.1341Q154.396 13.9448 154.071 13.7712Q153.746 13.5976 153.413 13.4402Q153.08 13.2827 152.74 13.1418Q152.4 13.0009 152.053 12.8768Q151.707 12.7528 151.354 12.6459Q151.002 12.539 150.645 12.4495Q150.288 12.3601 149.926 12.2882Q149.565 12.2164 149.201 12.1624Q148.837 12.1083 148.47 12.0722Q148.104 12.0361 147.736 12.0181Q147.368 12 147 12L27 12Q26.6318 12 26.264 12.0181Q25.8962 12.0361 25.5297 12.0722Q25.1633 12.1083 24.799 12.1624Q24.4348 12.2164 24.0736 12.2882Q23.7125 12.3601 23.3553 12.4495Q22.9981 12.539 22.6457 12.6459Q22.2934 12.7528 21.9467 12.8768Q21.5999 13.0009 21.2597 13.1418Q20.9195 13.2827 20.5867 13.4402Q20.2538 13.5976 19.929 13.7712Q19.6043 13.9448 19.2885 14.1341Q18.9726 14.3234 18.6664 14.528Q18.3603 14.7325 18.0645 14.9519Q17.7687 15.1712 17.4841 15.4048Q17.1995 15.6384 16.9266 15.8857Q16.6538 16.133 16.3934 16.3934Q16.133 16.6538 15.8857 16.9266Q15.6384 17.1995 15.4048 17.4841Q15.1712 17.7687 14.9519 18.0645Q14.7325 18.3603 14.528 18.6664Q14.3234 18.9726 14.1341 19.2885Q13.9448 19.6043 13.7712 19.929Q13.5976 20.2538 13.4402 20.5867Q13.2827 20.9195 13.1418 21.2597Q13.0009 21.5999 12.8768 21.9467Q12.7528 22.2934 12.6459 22.6457Q12.539 22.9981 12.4495 23.3553Q12.3601 23.7125 12.2882 24.0736Q12.2164 24.4348 12.1624 24.799Q12.1083 25.1633 12.0722 25.5297Q12.0361 25.8962 12.0181 26.264Q12 26.6318 12 27"></path></g><g clip-path="url(#cl_3)"><path fill="none" stroke="white" stroke-width="1" stroke-miterlimit="10" transform="scale(2 2)" d="M19 28L19 160Q19 160.221 19.0108 160.442Q19.0217 160.662 19.0433 160.882Q19.065 161.102 19.0974 161.321Q19.1298 161.539 19.1729 161.756Q19.216 161.972 19.2697 162.187Q19.3234 162.401 19.3875 162.613Q19.4517 162.824 19.5261 163.032Q19.6005 163.24 19.6851 163.444Q19.7696 163.648 19.8641 163.848Q19.9586 164.048 20.0627 164.243Q20.1669 164.437 20.2804 164.627Q20.394 164.816 20.5168 165Q20.6395 165.184 20.7711 165.361Q20.9027 165.539 21.0429 165.71Q21.1831 165.88 21.3314 166.044Q21.4798 166.208 21.636 166.364Q21.7923 166.52 21.956 166.669Q22.1197 166.817 22.2905 166.957Q22.4612 167.097 22.6387 167.229Q22.8162 167.36 22.9999 167.483Q23.1836 167.606 23.3731 167.72Q23.5626 167.833 23.7574 167.937Q23.9523 168.041 24.152 168.136Q24.3517 168.23 24.5558 168.315Q24.76 168.399 24.968 168.474Q25.176 168.548 25.3874 168.612Q25.5989 168.677 25.8132 168.73Q26.0275 168.784 26.2442 168.827Q26.4609 168.87 26.6794 168.903Q26.898 168.935 27.1178 168.957Q27.3377 168.978 27.5584 168.989Q27.7791 169 28 169L160 169Q160.221 169 160.442 168.989Q160.662 168.978 160.882 168.957Q161.102 168.935 161.321 168.903Q161.539 168.87 161.756 168.827Q161.972 168.784 162.187 168.73Q162.401 168.677 162.613 168.612Q162.824 168.548 163.032 168.474Q163.24 168.399 163.444 168.315Q163.648 168.23 163.848 168.136Q164.048 168.041 164.243 167.937Q164.437 167.833 164.627 167.72Q164.816 167.606 165 167.483Q165.184 167.36 165.361 167.229Q165.539 167.097 165.71 166.957Q165.88 166.817 166.044 166.669Q166.208 166.52 166.364 166.364Q166.52 166.208 166.669 166.044Q166.817 165.88 166.957 165.71Q167.097 165.539 167.229 165.361Q167.36 165.184 167.483 165Q167.606 164.816 167.72 164.627Q167.833 164.437 167.937 164.243Q168.041 164.048 168.136 163.848Q168.23 163.648 168.315 163.444Q168.399 163.24 168.474 163.032Q168.548 162.824 168.612 162.613Q168.677 162.401 168.73 162.187Q168.784 161.972 168.827 161.756Q168.87 161.539 168.903 161.321Q168.935 161.102 168.957 160.882Q168.978 160.662 168.989 160.442Q169 160.221 169 160L169 28Q169 27.7791 168.989 27.5584Q168.978 27.3377 168.957 27.1178Q168.935 26.898 168.903 26.6794Q168.87 26.4609 168.827 26.2442Q168.784 26.0275 168.73 25.8132Q168.677 25.5989 168.612 25.3874Q168.548 25.176 168.474 24.968Q168.399 24.76 168.315 24.5558Q168.23 24.3517 168.136 24.152Q168.041 23.9523 167.937 23.7574Q167.833 23.5626 167.72 23.3731Q167.606 23.1836 167.483 22.9999Q167.36 22.8162 167.229 22.6387Q167.097 22.4612 166.957 22.2905Q166.817 22.1197 166.669 21.956Q166.52 21.7923 166.364 21.636Q166.208 21.4798 166.044 21.3314Q165.88 21.1831 165.71 21.0429Q165.539 20.9027 165.361 20.7711Q165.184 20.6395 165 20.5168Q164.816 20.394 164.627 20.2804Q164.437 20.1669 164.243 20.0627Q164.048 19.9586 163.848 19.8641Q163.648 19.7696 163.444 19.6851Q163.24 19.6005 163.032 19.5261Q162.824 19.4517 162.613 19.3875Q162.401 19.3234 162.187 19.2697Q161.972 19.216 161.756 19.1729Q161.539 19.1298 161.321 19.0974Q161.102 19.065 160.882 19.0433Q160.662 19.0217 160.442 19.0108Q160.221 19 160 19L28 19Q27.7791 19 27.5584 19.0108Q27.3377 19.0217 27.1178 19.0433Q26.898 19.065 26.6794 19.0974Q26.4609 19.1298 26.2442 19.1729Q26.0275 19.216 25.8132 19.2697Q25.5989 19.3234 25.3874 19.3875Q25.176 19.4517 24.968 19.5261Q24.76 19.6005 24.5558 19.6851Q24.3517 19.7696 24.152 19.8641Q23.9523 19.9586 23.7574 20.0627Q23.5626 20.1669 23.3731 20.2804Q23.1836 20.394 22.9999 20.5168Q22.8162 20.6395 22.6387 20.7711Q22.4612 20.9027 22.2905 21.0429Q22.1197 21.1831 21.956 21.3314Q21.7923 21.4798 21.636 21.636Q21.4798 21.7923 21.3314 21.956Q21.1831 22.1197 21.0429 22.2905Q20.9027 22.4612 20.7711 22.6387Q20.6395 22.8162 20.5168 22.9999Q20.394 23.1836 20.2804 23.3731Q20.1669 23.5626 20.0627 23.7574Q19.9586 23.9523 19.8641 24.152Q19.7696 24.3517 19.6851 24.5558Q19.6005 24.76 19.5261 24.968Q19.4517 25.176 19.3875 25.3874Q19.3234 25.5989 19.2697 25.8132Q19.216 26.0275 19.1729 26.2442Q19.1298 26.4609 19.0974 26.6794Q19.065 26.898 19.0433 27.1178Q19.0217 27.3377 19.0108 27.5584Q19 27.7791 19 28"></path></g><g clip-path="url(#cl_3)"><path fill="none" stroke="white" stroke-width="1" stroke-miterlimit="10" transform="scale(2 2)" d="M53 63L53 76Q53 76.2455 53.012 76.4907Q53.0241 76.7359 53.0481 76.9802Q53.0722 77.2245 53.1082 77.4673Q53.1442 77.7101 53.1921 77.9509Q53.24 78.1917 53.2997 78.4298Q53.3593 78.6679 53.4306 78.9028Q53.5019 79.1378 53.5845 79.3689Q53.6672 79.6 53.7612 79.8268Q53.8551 80.0536 53.9601 80.2756Q54.0651 80.4975 54.1808 80.714Q54.2965 80.9305 54.4227 81.141Q54.5489 81.3516 54.6853 81.5557Q54.8217 81.7598 54.9679 81.957Q55.1141 82.1542 55.2699 82.3439Q55.4256 82.5337 55.5905 82.7156Q55.7553 82.8975 55.9289 83.0711Q56.1025 83.2447 56.2844 83.4095Q56.4663 83.5744 56.6561 83.7301Q56.8458 83.8858 57.043 84.0321Q57.2402 84.1783 57.4443 84.3147Q57.6484 84.4511 57.859 84.5773Q58.0695 84.7035 58.286 84.8192Q58.5025 84.9349 58.7244 85.0399Q58.9464 85.1449 59.1732 85.2388Q59.4 85.3327 59.6311 85.4154Q59.8622 85.4981 60.0971 85.5694Q60.3321 85.6407 60.5702 85.7003Q60.8083 85.76 61.0491 85.8078Q61.2899 85.8557 61.5327 85.8918Q61.7755 85.9278 62.0198 85.9519Q62.2641 85.9759 62.5093 85.988Q62.7545 86 63 86L92 86Q92.2455 86 92.4907 85.988Q92.7359 85.9759 92.9802 85.9519Q93.2245 85.9278 93.4673 85.8918Q93.7101 85.8557 93.9509 85.8078Q94.1917 85.76 94.4298 85.7003Q94.6679 85.6407 94.9028 85.5694Q95.1378 85.4981 95.3689 85.4154Q95.6 85.3327 95.8268 85.2388Q96.0536 85.1449 96.2755 85.0399Q96.4975 84.9349 96.714 84.8192Q96.9305 84.7035 97.141 84.5773Q97.3516 84.4511 97.5557 84.3147Q97.7598 84.1783 97.957 84.0321Q98.1542 83.8858 98.3439 83.7301Q98.5337 83.5744 98.7156 83.4095Q98.8975 83.2447 99.0711 83.0711Q99.2446 82.8975 99.4095 82.7156Q99.5744 82.5337 99.7301 82.3439Q99.8858 82.1542 100.032 81.957Q100.178 81.7598 100.315 81.5557Q100.451 81.3516 100.577 81.141Q100.703 80.9305 100.819 80.714Q100.935 80.4975 101.04 80.2756Q101.145 80.0536 101.239 79.8268Q101.333 79.6 101.415 79.3689Q101.498 79.1378 101.569 78.9028Q101.641 78.6679 101.7 78.4298Q101.76 78.1917 101.808 77.9509Q101.856 77.7101 101.892 77.4673Q101.928 77.2245 101.952 76.9802Q101.976 76.7359 101.988 76.4907Q102 76.2455 102 76L102 63Q102 62.7545 101.988 62.5093Q101.976 62.2641 101.952 62.0198Q101.928 61.7755 101.892 61.5327Q101.856 61.2899 101.808 61.0491Q101.76 60.8083 101.7 60.5702Q101.641 60.3321 101.569 60.0971Q101.498 59.8622 101.415 59.6311Q101.333 59.4 101.239 59.1732Q101.145 58.9464 101.04 58.7244Q100.935 58.5025 100.819 58.286Q100.703 58.0695 100.577 57.859Q100.451 57.6484 100.315 57.4443Q100.178 57.2402 100.032 57.043Q99.8858 56.8458 99.7301 56.6561Q99.5744 56.4663 99.4095 56.2844Q99.2446 56.1025 99.0711 55.9289Q98.8975 55.7553 98.7156 55.5905Q98.5337 55.4256 98.3439 55.2699Q98.1542 55.1142 97.957 54.9679Q97.7598 54.8217 97.5557 54.6853Q97.3516 54.5489 97.141 54.4227Q96.9305 54.2965 96.714 54.1808Q96.4975 54.0651 96.2755 53.9601Q96.0536 53.8551 95.8268 53.7612Q95.6 53.6673 95.3689 53.5846Q95.1378 53.5019 94.9028 53.4306Q94.6679 53.3593 94.4298 53.2997Q94.1917 53.24 93.9509 53.1921Q93.7101 53.1443 93.4673 53.1082Q93.2245 53.0722 92.9802 53.0482Q92.7359 53.0241 92.4907 53.012Q92.2455 53 92 53L63 53Q62.7545 53 62.5093 53.012Q62.2641 53.0241 62.0198 53.0482Q61.7755 53.0722 61.5327 53.1082Q61.2899 53.1443 61.0491 53.1921Q60.8083 53.24 60.5702 53.2997Q60.3321 53.3593 60.0971 53.4306Q59.8622 53.5019 59.6311 53.5846Q59.4 53.6673 59.1732 53.7612Q58.9464 53.8551 58.7244 53.9601Q58.5025 54.0651 58.286 54.1808Q58.0695 54.2965 57.859 54.4227Q57.6484 54.5489 57.4443 54.6853Q57.2402 54.8217 57.043 54.9679Q56.8458 55.1142 56.6561 55.2699Q56.4663 55.4256 56.2844 55.5905Q56.1025 55.7553 55.9289 55.9289Q55.7553 56.1025 55.5905 56.2844Q55.4256 56.4663 55.2699 56.6561Q55.1141 56.8458 54.9679 57.043Q54.8217 57.2402 54.6853 57.4443Q54.5489 57.6484 54.4227 57.859Q54.2965 58.0695 54.1808 58.286Q54.0651 58.5025 53.9601 58.7244Q53.8551 58.9464 53.7612 59.1732Q53.6672 59.4 53.5845 59.6311Q53.5018 59.8622 53.4306 60.0971Q53.3593 60.3321 53.2997 60.5702Q53.24 60.8083 53.1921 61.0491Q53.1442 61.2899 53.1082 61.5327Q53.0722 61.7755 53.0482 62.0198Q53.0241 62.2641 53.012 62.5093Q53 62.7545 53 63"></path></g><g clip-path="url(#cl_3)"><path fill="none" stroke="white" stroke-width="1" stroke-miterlimit="10" transform="scale(2 2)" d="M53 125L53 129Q53 129.147 53.0072 129.294Q53.0145 129.442 53.0289 129.588Q53.0433 129.735 53.0649 129.88Q53.0865 130.026 53.1153 130.171Q53.144 130.315 53.1798 130.458Q53.2156 130.601 53.2584 130.742Q53.3011 130.883 53.3507 131.021Q53.4003 131.16 53.4567 131.296Q53.5131 131.432 53.5761 131.565Q53.639 131.698 53.7085 131.828Q53.7779 131.958 53.8536 132.085Q53.9293 132.211 54.0112 132.333Q54.093 132.456 54.1807 132.574Q54.2685 132.692 54.3619 132.806Q54.4554 132.92 54.5543 133.029Q54.6532 133.138 54.7574 133.243Q54.8615 133.347 54.9706 133.446Q55.0798 133.545 55.1936 133.638Q55.3075 133.731 55.4258 133.819Q55.5441 133.907 55.6666 133.989Q55.789 134.071 55.9154 134.146Q56.0417 134.222 56.1716 134.292Q56.3015 134.361 56.4347 134.424Q56.5678 134.487 56.7039 134.543Q56.84 134.6 56.9786 134.649Q57.1173 134.699 57.2583 134.742Q57.3992 134.784 57.5421 134.82Q57.685 134.856 57.8295 134.885Q57.9739 134.913 58.1196 134.935Q58.2653 134.957 58.4119 134.971Q58.5585 134.986 58.7056 134.993Q58.8527 135 59 135L96 135Q96.1473 135 96.2944 134.993Q96.4415 134.986 96.5881 134.971Q96.7347 134.957 96.8804 134.935Q97.0261 134.913 97.1705 134.885Q97.315 134.856 97.4579 134.82Q97.6007 134.784 97.7417 134.742Q97.8827 134.699 98.0213 134.649Q98.16 134.6 98.2961 134.543Q98.4322 134.487 98.5653 134.424Q98.6985 134.361 98.8284 134.292Q98.9583 134.222 99.0846 134.146Q99.2109 134.071 99.3334 133.989Q99.4559 133.907 99.5742 133.819Q99.6925 133.731 99.8064 133.638Q99.9202 133.545 100.029 133.446Q100.138 133.347 100.243 133.243Q100.347 133.138 100.446 133.029Q100.545 132.92 100.638 132.806Q100.731 132.692 100.819 132.574Q100.907 132.456 100.989 132.333Q101.071 132.211 101.146 132.085Q101.222 131.958 101.292 131.828Q101.361 131.698 101.424 131.565Q101.487 131.432 101.543 131.296Q101.6 131.16 101.649 131.021Q101.699 130.883 101.742 130.742Q101.784 130.601 101.82 130.458Q101.856 130.315 101.885 130.171Q101.913 130.026 101.935 129.88Q101.957 129.735 101.971 129.588Q101.986 129.442 101.993 129.294Q102 129.147 102 129L102 125Q102 124.853 101.993 124.706Q101.986 124.558 101.971 124.412Q101.957 124.265 101.935 124.12Q101.913 123.974 101.885 123.829Q101.856 123.685 101.82 123.542Q101.784 123.399 101.742 123.258Q101.699 123.117 101.649 122.979Q101.6 122.84 101.543 122.704Q101.487 122.568 101.424 122.435Q101.361 122.302 101.292 122.172Q101.222 122.042 101.146 121.915Q101.071 121.789 100.989 121.667Q100.907 121.544 100.819 121.426Q100.731 121.307 100.638 121.194Q100.545 121.08 100.446 120.971Q100.347 120.861 100.243 120.757Q100.138 120.653 100.029 120.554Q99.9202 120.455 99.8064 120.362Q99.6925 120.268 99.5742 120.181Q99.4559 120.093 99.3334 120.011Q99.2109 119.929 99.0846 119.854Q98.9583 119.778 98.8284 119.708Q98.6985 119.639 98.5653 119.576Q98.4322 119.513 98.2961 119.457Q98.16 119.4 98.0213 119.351Q97.8827 119.301 97.7417 119.258Q97.6008 119.216 97.4579 119.18Q97.315 119.144 97.1705 119.115Q97.0261 119.087 96.8804 119.065Q96.7347 119.043 96.5881 119.029Q96.4415 119.014 96.2944 119.007Q96.1473 119 96 119L59 119Q58.8527 119 58.7056 119.007Q58.5585 119.014 58.4119 119.029Q58.2653 119.043 58.1196 119.065Q57.9739 119.087 57.8295 119.115Q57.685 119.144 57.5421 119.18Q57.3992 119.216 57.2583 119.258Q57.1173 119.301 56.9786 119.351Q56.84 119.4 56.7039 119.457Q56.5678 119.513 56.4347 119.576Q56.3015 119.639 56.1716 119.708Q56.0417 119.778 55.9154 119.854Q55.789 119.929 55.6666 120.011Q55.5441 120.093 55.4258 120.181Q55.3075 120.268 55.1936 120.362Q55.0798 120.455 54.9706 120.554Q54.8615 120.653 54.7574 120.757Q54.6532 120.861 54.5543 120.971Q54.4554 121.08 54.3619 121.194Q54.2685 121.307 54.1807 121.426Q54.093 121.544 54.0112 121.667Q53.9293 121.789 53.8536 121.915Q53.7779 122.042 53.7085 122.172Q53.639 122.301 53.5761 122.435Q53.5131 122.568 53.4567 122.704Q53.4003 122.84 53.3507 122.979Q53.3011 123.117 53.2584 123.258Q53.2156 123.399 53.1798 123.542Q53.144 123.685 53.1153 123.829Q53.0865 123.974 53.0649 124.12Q53.0433 124.265 53.0289 124.412Q53.0145 124.558 53.0072 124.706Q53 124.853 53 125"></path></g><g clip-path="url(#cl_3)"><path fill="none" stroke="white" stroke-width="1" stroke-miterlimit="10" transform="scale(2 2)" d="M135 63L135 76Q135 76.2455 135.012 76.4907Q135.024 76.7359 135.048 76.9802Q135.072 77.2245 135.108 77.4673Q135.144 77.7101 135.192 77.9509Q135.24 78.1917 135.3 78.4298Q135.359 78.6679 135.431 78.9028Q135.502 79.1378 135.585 79.3689Q135.667 79.6 135.761 79.8268Q135.855 80.0536 135.96 80.2756Q136.065 80.4975 136.181 80.714Q136.296 80.9305 136.423 81.141Q136.549 81.3516 136.685 81.5557Q136.822 81.7598 136.968 81.957Q137.114 82.1542 137.27 82.3439Q137.426 82.5337 137.59 82.7156Q137.755 82.8975 137.929 83.0711Q138.103 83.2447 138.284 83.4095Q138.466 83.5744 138.656 83.7301Q138.846 83.8858 139.043 84.0321Q139.24 84.1783 139.444 84.3147Q139.648 84.4511 139.859 84.5773Q140.07 84.7035 140.286 84.8192Q140.503 84.9349 140.724 85.0399Q140.946 85.1449 141.173 85.2388Q141.4 85.3327 141.631 85.4154Q141.862 85.4981 142.097 85.5694Q142.332 85.6407 142.57 85.7003Q142.808 85.76 143.049 85.8078Q143.29 85.8557 143.533 85.8918Q143.776 85.9278 144.02 85.9519Q144.264 85.9759 144.509 85.988Q144.755 86 145 86L174 86Q174.245 86 174.491 85.988Q174.736 85.9759 174.98 85.9519Q175.224 85.9278 175.467 85.8918Q175.71 85.8557 175.951 85.8078Q176.192 85.76 176.43 85.7003Q176.668 85.6407 176.903 85.5694Q177.138 85.4981 177.369 85.4154Q177.6 85.3327 177.827 85.2388Q178.054 85.1449 178.276 85.0399Q178.497 84.9349 178.714 84.8192Q178.93 84.7035 179.141 84.5773Q179.352 84.4511 179.556 84.3147Q179.76 84.1783 179.957 84.0321Q180.154 83.8858 180.344 83.7301Q180.534 83.5744 180.716 83.4095Q180.897 83.2447 181.071 83.0711Q181.245 82.8975 181.41 82.7156Q181.574 82.5337 181.73 82.3439Q181.886 82.1542 182.032 81.957Q182.178 81.7598 182.315 81.5557Q182.451 81.3516 182.577 81.141Q182.703 80.9305 182.819 80.714Q182.935 80.4975 183.04 80.2756Q183.145 80.0536 183.239 79.8268Q183.333 79.6 183.415 79.3689Q183.498 79.1378 183.569 78.9028Q183.641 78.6679 183.7 78.4298Q183.76 78.1917 183.808 77.9509Q183.856 77.7101 183.892 77.4673Q183.928 77.2245 183.952 76.9802Q183.976 76.7359 183.988 76.4907Q184 76.2455 184 76L184 63Q184 62.7545 183.988 62.5093Q183.976 62.2641 183.952 62.0198Q183.928 61.7755 183.892 61.5327Q183.856 61.2899 183.808 61.0491Q183.76 60.8083 183.7 60.5702Q183.641 60.3321 183.569 60.0971Q183.498 59.8622 183.415 59.6311Q183.333 59.4 183.239 59.1732Q183.145 58.9464 183.04 58.7244Q182.935 58.5025 182.819 58.286Q182.703 58.0695 182.577 57.859Q182.451 57.6484 182.315 57.4443Q182.178 57.2402 182.032 57.043Q181.886 56.8458 181.73 56.6561Q181.574 56.4663 181.41 56.2844Q181.245 56.1025 181.071 55.9289Q180.897 55.7553 180.716 55.5905Q180.534 55.4256 180.344 55.2699Q180.154 55.1142 179.957 54.9679Q179.76 54.8217 179.556 54.6853Q179.352 54.5489 179.141 54.4227Q178.93 54.2965 178.714 54.1808Q178.497 54.0651 178.276 53.9601Q178.054 53.8551 177.827 53.7612Q177.6 53.6673 177.369 53.5846Q177.138 53.5019 176.903 53.4306Q176.668 53.3593 176.43 53.2997Q176.192 53.24 175.951 53.1921Q175.71 53.1443 175.467 53.1082Q175.224 53.0722 174.98 53.0482Q174.736 53.0241 174.491 53.012Q174.245 53 174 53L145 53Q144.755 53 144.509 53.012Q144.264 53.0241 144.02 53.0482Q143.776 53.0722 143.533 53.1082Q143.29 53.1443 143.049 53.1921Q142.808 53.24 142.57 53.2997Q142.332 53.3593 142.097 53.4306Q141.862 53.5019 141.631 53.5846Q141.4 53.6673 141.173 53.7612Q140.946 53.8551 140.724 53.9601Q140.503 54.0651 140.286 54.1808Q140.07 54.2965 139.859 54.4227Q139.648 54.5489 139.444 54.6853Q139.24 54.8217 139.043 54.9679Q138.846 55.1142 138.656 55.2699Q138.466 55.4256 138.284 55.5905Q138.103 55.7553 137.929 55.9289Q137.755 56.1025 137.59 56.2844Q137.426 56.4663 137.27 56.6561Q137.114 56.8458 136.968 57.043Q136.822 57.2402 136.685 57.4443Q136.549 57.6484 136.423 57.859Q136.296 58.0695 136.181 58.286Q136.065 58.5025 135.96 58.7244Q135.855 58.9464 135.761 59.1732Q135.667 59.4 135.585 59.6311Q135.502 59.8622 135.431 60.0971Q135.359 60.3321 135.3 60.5702Q135.24 60.8083 135.192 61.0491Q135.144 61.2899 135.108 61.5327Q135.072 61.7755 135.048 62.0198Q135.024 62.2641 135.012 62.5093Q135 62.7545 135 63"></path></g><g clip-path="url(#cl_3)"><path fill="none" stroke="white" stroke-width="1" stroke-miterlimit="10" transform="scale(2 2)" d="M135 129L135 158Q135 158.245 135.012 158.491Q135.024 158.736 135.048 158.98Q135.072 159.224 135.108 159.467Q135.144 159.71 135.192 159.951Q135.24 160.192 135.3 160.43Q135.359 160.668 135.431 160.903Q135.502 161.138 135.585 161.369Q135.667 161.6 135.761 161.827Q135.855 162.054 135.96 162.276Q136.065 162.497 136.181 162.714Q136.296 162.93 136.423 163.141Q136.549 163.352 136.685 163.556Q136.822 163.76 136.968 163.957Q137.114 164.154 137.27 164.344Q137.426 164.534 137.59 164.716Q137.755 164.897 137.929 165.071Q138.103 165.245 138.284 165.41Q138.466 165.574 138.656 165.73Q138.846 165.886 139.043 166.032Q139.24 166.178 139.444 166.315Q139.648 166.451 139.859 166.577Q140.07 166.703 140.286 166.819Q140.503 166.935 140.724 167.04Q140.946 167.145 141.173 167.239Q141.4 167.333 141.631 167.415Q141.862 167.498 142.097 167.569Q142.332 167.641 142.57 167.7Q142.808 167.76 143.049 167.808Q143.29 167.856 143.533 167.892Q143.776 167.928 144.02 167.952Q144.264 167.976 144.509 167.988Q144.755 168 145 168L150 168Q150.245 168 150.491 167.988Q150.736 167.976 150.98 167.952Q151.224 167.928 151.467 167.892Q151.71 167.856 151.951 167.808Q152.192 167.76 152.43 167.7Q152.668 167.641 152.903 167.569Q153.138 167.498 153.369 167.415Q153.6 167.333 153.827 167.239Q154.054 167.145 154.276 167.04Q154.497 166.935 154.714 166.819Q154.93 166.703 155.141 166.577Q155.352 166.451 155.556 166.315Q155.76 166.178 155.957 166.032Q156.154 165.886 156.344 165.73Q156.534 165.574 156.716 165.41Q156.897 165.245 157.071 165.071Q157.245 164.897 157.41 164.716Q157.574 164.534 157.73 164.344Q157.886 164.154 158.032 163.957Q158.178 163.76 158.315 163.556Q158.451 163.352 158.577 163.141Q158.703 162.93 158.819 162.714Q158.935 162.497 159.04 162.276Q159.145 162.054 159.239 161.827Q159.333 161.6 159.415 161.369Q159.498 161.138 159.569 160.903Q159.641 160.668 159.7 160.43Q159.76 160.192 159.808 159.951Q159.856 159.71 159.892 159.467Q159.928 159.224 159.952 158.98Q159.976 158.736 159.988 158.491Q160 158.245 160 158L160 129Q160 128.755 159.988 128.509Q159.976 128.264 159.952 128.02Q159.928 127.776 159.892 127.533Q159.856 127.29 159.808 127.049Q159.76 126.808 159.7 126.57Q159.641 126.332 159.569 126.097Q159.498 125.862 159.415 125.631Q159.333 125.4 159.239 125.173Q159.145 124.946 159.04 124.724Q158.935 124.503 158.819 124.286Q158.703 124.07 158.577 123.859Q158.451 123.648 158.315 123.444Q158.178 123.24 158.032 123.043Q157.886 122.846 157.73 122.656Q157.574 122.466 157.41 122.284Q157.245 122.103 157.071 121.929Q156.897 121.755 156.716 121.59Q156.534 121.426 156.344 121.27Q156.154 121.114 155.957 120.968Q155.76 120.822 155.556 120.685Q155.352 120.549 155.141 120.423Q154.93 120.296 154.714 120.181Q154.497 120.065 154.276 119.96Q154.054 119.855 153.827 119.761Q153.6 119.667 153.369 119.585Q153.138 119.502 152.903 119.431Q152.668 119.359 152.43 119.3Q152.192 119.24 151.951 119.192Q151.71 119.144 151.467 119.108Q151.224 119.072 150.98 119.048Q150.736 119.024 150.491 119.012Q150.245 119 150 119L145 119Q144.755 119 144.509 119.012Q144.264 119.024 144.02 119.048Q143.776 119.072 143.533 119.108Q143.29 119.144 143.049 119.192Q142.808 119.24 142.57 119.3Q142.332 119.359 142.097 119.431Q141.862 119.502 141.631 119.585Q141.4 119.667 141.173 119.761Q140.946 119.855 140.724 119.96Q140.503 120.065 140.286 120.181Q140.07 120.296 139.859 120.423Q139.648 120.549 139.444 120.685Q139.24 120.822 139.043 120.968Q138.846 121.114 138.656 121.27Q138.466 121.426 138.284 121.59Q138.103 121.755 137.929 121.929Q137.755 122.103 137.59 122.284Q137.426 122.466 137.27 122.656Q137.114 122.846 136.968 123.043Q136.822 123.24 136.685 123.444Q136.549 123.648 136.423 123.859Q136.296 124.07 136.181 124.286Q136.065 124.503 135.96 124.724Q135.855 124.946 135.761 125.173Q135.667 125.4 135.585 125.631Q135.502 125.862 135.431 126.097Q135.359 126.332 135.3 126.57Q135.24 126.808 135.192 127.049Q135.144 127.29 135.108 127.533Q135.072 127.776 135.048 128.02Q135.024 128.264 135.012 128.509Q135 128.755 135 129"></path></g><g clip-path="url(#cl_3)"><path fill="white" transform="scale(2 2)" d="M48.7126 42.6405Q48.5741 42.928 48.4217 43.2084Q48.2693 43.4888 48.1033 43.7614Q47.9373 44.0339 47.7582 44.298Q47.579 44.5621 47.3871 44.8171Q47.1952 45.0721 46.9911 45.3174Q46.7869 45.5626 46.5709 45.7976Q46.3549 46.0325 46.1277 46.2566Q45.9005 46.4807 45.6625 46.6933Q45.4245 46.906 45.1764 47.1067Q44.9283 47.3074 44.6707 47.4957Q44.413 47.684 44.1464 47.8595Q43.8798 48.0349 43.605 48.1971Q43.3301 48.3592 43.0476 48.5077Q42.7651 48.6561 42.4757 48.7905Q42.1862 48.925 41.8905 49.045Q41.5949 49.1651 41.2936 49.2705Q40.9924 49.3759 40.6864 49.4664Q40.3803 49.5569 40.0702 49.6322Q39.7601 49.7076 39.4467 49.7677Q39.1333 49.8277 38.8173 49.8723Q38.5013 49.917 38.1835 49.946Q37.8657 49.9751 37.5468 49.9885Q37.228 50.0019 36.9088 49.9997Q36.5897 49.9974 36.2711 49.9795Q35.9525 49.9616 35.6351 49.9281Q35.3177 49.8946 35.0024 49.8456Q34.687 49.7966 34.3745 49.7321Q34.0619 49.6677 33.7529 49.5879Q33.4439 49.5082 33.1392 49.4135Q32.8344 49.3187 32.5347 49.2091Q32.235 49.0994 31.941 48.9753Q31.647 48.8511 31.3595 48.7126Q31.072 48.5741 30.7916 48.4217Q30.5112 48.2693 30.2386 48.1033Q29.9661 47.9373 29.702 47.7582Q29.4379 47.579 29.1829 47.3871Q28.9279 47.1952 28.6826 46.9911Q28.4374 46.7869 28.2024 46.5709Q27.9674 46.3549 27.7434 46.1277Q27.5193 45.9005 27.3067 45.6625Q27.094 45.4245 26.8933 45.1764Q26.6926 44.9283 26.5043 44.6707Q26.3159 44.413 26.1405 44.1464Q25.9651 43.8798 25.8029 43.605Q25.6408 43.3301 25.4923 43.0476Q25.3439 42.7651 25.2095 42.4757Q25.075 42.1862 24.955 41.8905Q24.8349 41.5949 24.7295 41.2936Q24.6241 40.9924 24.5336 40.6864Q24.4431 40.3803 24.3678 40.0702Q24.2924 39.7601 24.2323 39.4467Q24.1723 39.1333 24.1276 38.8173Q24.083 38.5013 24.054 38.1835Q24.0249 37.8657 24.0115 37.5468Q23.9981 37.228 24.0003 36.9088Q24.0026 36.5897 24.0204 36.2711Q24.0383 35.9525 24.0719 35.6351Q24.1054 35.3177 24.1544 35.0024Q24.2034 34.687 24.2679 34.3745Q24.3323 34.0619 24.4121 33.7529Q24.4918 33.4439 24.5865 33.1392Q24.6813 32.8344 24.7909 32.5347Q24.9006 32.235 25.0247 31.941Q25.1489 31.647 25.2874 31.3595Q25.4259 31.072 25.5783 30.7916Q25.7307 30.5112 25.8967 30.2386Q26.0627 29.9661 26.2418 29.702Q26.421 29.4379 26.6129 29.1829Q26.8048 28.9279 27.0089 28.6826Q27.2131 28.4374 27.4291 28.2024Q27.6451 27.9674 27.8723 27.7434Q28.0995 27.5193 28.3375 27.3067Q28.5755 27.094 28.8236 26.8933Q29.0717 26.6926 29.3293 26.5043Q29.587 26.3159 29.8536 26.1405Q30.1201 25.9651 30.395 25.8029Q30.6699 25.6408 30.9524 25.4923Q31.2349 25.3439 31.5243 25.2095Q31.8138 25.075 32.1095 24.955Q32.4052 24.8349 32.7064 24.7295Q33.0076 24.6241 33.3136 24.5336Q33.6197 24.4431 33.9298 24.3678Q34.2399 24.2924 34.5533 24.2323Q34.8667 24.1723 35.1827 24.1276Q35.4987 24.083 35.8165 24.054Q36.1343 24.0249 36.4532 24.0115Q36.772 23.9981 37.0912 24.0003Q37.4103 24.0026 37.7289 24.0204Q38.0475 24.0383 38.3649 24.0719Q38.6823 24.1054 38.9976 24.1544Q39.313 24.2034 39.6255 24.2679Q39.9381 24.3323 40.2471 24.4121Q40.5561 24.4918 40.8608 24.5865Q41.1656 24.6813 41.4653 24.7909Q41.765 24.9006 42.059 25.0247Q42.353 25.1489 42.6405 25.2874Q43.1336 25.5249 43.605 25.8029Q44.0764 26.081 44.5227 26.3977Q44.9691 26.7144 45.3872 27.0675Q45.8054 27.4206 46.1924 27.8076Q46.5794 28.1946 46.9325 28.6128Q47.2856 29.0309 47.6023 29.4773Q47.919 29.9236 48.1971 30.395Q48.4751 30.8664 48.7126 31.3595L31 37"></path></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="51" y="35" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="67" y="35" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="83" y="35" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="99" y="35" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="35" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="131" y="35" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="147" y="35" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="51" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="67" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="83" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="115" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="131" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="51" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="67" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="83" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="99" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="115" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="131" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><rect fill="white" transform="scale(2 2)" x="147" y="99" width="4" height="4"></rect></g><g clip-path="url(#cl_3)"><path fill="white" transform="scale(2 2)" d="M83 116L83 102C83 94 89 88 97 88C105 88 111 94 111 102L111 116L106.333 111.333L101.666 116L97 111.333L92.333 116L87.666 111.333L83 116"></path></g><g clip-path="url(#cl_3)"><path fill="black" transform="scale(2 2)" d="M91 96C88 96 87 99 87 101C87 103 88 106 91 106C94 106 95 103 95 101C95 99 94 96 91 96M103 96C100 96 99 99 99 101C99 103 100 106 103 106C106 106 107 103 107 101C107 99 106 96 103 96"></path></g><g clip-path="url(#cl_3)"><path fill="white" transform="scale(2 2)" d="M103 102Q103 101.902 102.99 101.804Q102.981 101.706 102.962 101.61Q102.942 101.513 102.914 101.419Q102.885 101.325 102.848 101.235Q102.81 101.144 102.764 101.057Q102.718 100.971 102.663 100.889Q102.608 100.807 102.546 100.731Q102.484 100.655 102.414 100.586Q102.345 100.516 102.269 100.454Q102.193 100.392 102.111 100.337Q102.029 100.282 101.943 100.236Q101.856 100.19 101.765 100.152Q101.675 100.115 101.581 100.086Q101.487 100.058 101.39 100.038Q101.294 100.019 101.196 100.01Q101.098 100 101 100Q100.902 100 100.804 100.01Q100.706 100.019 100.61 100.038Q100.513 100.058 100.419 100.086Q100.325 100.115 100.235 100.152Q100.144 100.19 100.057 100.236Q99.9705 100.282 99.8888 100.337Q99.8072 100.392 99.7312 100.454Q99.6553 100.516 99.5858 100.586Q99.5163 100.655 99.454 100.731Q99.3916 100.807 99.3371 100.889Q99.2825 100.971 99.2362 101.057Q99.1898 101.144 99.1522 101.235Q99.1146 101.325 99.0861 101.419Q99.0576 101.513 99.0384 101.61Q99.0193 101.706 99.0096 101.804Q99 101.902 99 102Q99 102.098 99.0096 102.196Q99.0193 102.294 99.0384 102.39Q99.0576 102.487 99.0861 102.581Q99.1146 102.675 99.1522 102.765Q99.1898 102.856 99.2362 102.943Q99.2825 103.029 99.3371 103.111Q99.3916 103.193 99.454 103.269Q99.5163 103.345 99.5858 103.414Q99.6553 103.484 99.7312 103.546Q99.8072 103.608 99.8888 103.663Q99.9705 103.718 100.057 103.764Q100.144 103.81 100.235 103.848Q100.325 103.885 100.419 103.914Q100.513 103.942 100.61 103.962Q100.706 103.981 100.804 103.99Q100.902 104 101 104Q101.098 104 101.196 103.99Q101.294 103.981 101.39 103.962Q101.487 103.942 101.581 103.914Q101.675 103.885 101.765 103.848Q101.856 103.81 101.943 103.764Q102.029 103.718 102.111 103.663Q102.193 103.608 102.269 103.546Q102.345 103.484 102.414 103.414Q102.484 103.345 102.546 103.269Q102.608 103.193 102.663 103.111Q102.718 103.029 102.764 102.943Q102.81 102.856 102.848 102.765Q102.885 102.675 102.914 102.581Q102.942 102.487 102.962 102.39Q102.981 102.294 102.99 102.196Q103 102.098 103 102"></path></g><g clip-path="url(#cl_3)"><path fill="white" transform="scale(2 2)" d="M91 102Q91 101.902 90.9904 101.804Q90.9807 101.706 90.9616 101.61Q90.9424 101.513 90.9139 101.419Q90.8854 101.325 90.8477 101.235Q90.8102 101.144 90.7638 101.057Q90.7175 100.971 90.6629 100.889Q90.6084 100.807 90.546 100.731Q90.4837 100.655 90.4142 100.586Q90.3447 100.516 90.2688 100.454Q90.1928 100.392 90.1111 100.337Q90.0294 100.282 89.9428 100.236Q89.8561 100.19 89.7654 100.152Q89.6746 100.115 89.5806 100.086Q89.4865 100.058 89.3902 100.038Q89.2938 100.019 89.196 100.01Q89.0983 100 89 100Q88.9017 100 88.804 100.01Q88.7062 100.019 88.6098 100.038Q88.5135 100.058 88.4194 100.086Q88.3254 100.115 88.2346 100.152Q88.1439 100.19 88.0572 100.236Q87.9706 100.282 87.8888 100.337Q87.8072 100.392 87.7312 100.454Q87.6553 100.516 87.5858 100.586Q87.5163 100.655 87.454 100.731Q87.3916 100.807 87.337 100.889Q87.2825 100.971 87.2361 101.057Q87.1898 101.144 87.1522 101.235Q87.1146 101.325 87.0861 101.419Q87.0576 101.513 87.0384 101.61Q87.0193 101.706 87.0096 101.804Q87 101.902 87 102Q87 102.098 87.0096 102.196Q87.0193 102.294 87.0384 102.39Q87.0576 102.487 87.0861 102.581Q87.1146 102.675 87.1522 102.765Q87.1898 102.856 87.2361 102.943Q87.2825 103.029 87.337 103.111Q87.3916 103.193 87.454 103.269Q87.5163 103.345 87.5858 103.414Q87.6553 103.484 87.7312 103.546Q87.8071 103.608 87.8888 103.663Q87.9706 103.718 88.0572 103.764Q88.1439 103.81 88.2346 103.848Q88.3254 103.885 88.4194 103.914Q88.5135 103.942 88.6098 103.962Q88.7062 103.981 88.804 103.99Q88.9017 104 89 104Q89.0983 104 89.196 103.99Q89.2938 103.981 89.3902 103.962Q89.4865 103.942 89.5806 103.914Q89.6746 103.885 89.7654 103.848Q89.8561 103.81 89.9428 103.764Q90.0294 103.718 90.1111 103.663Q90.1928 103.608 90.2688 103.546Q90.3447 103.484 90.4142 103.414Q90.4837 103.345 90.546 103.269Q90.6084 103.193 90.6629 103.111Q90.7175 103.029 90.7638 102.943Q90.8102 102.856 90.8477 102.765Q90.8854 102.675 90.9139 102.581Q90.9424 102.487 90.9616 102.39Q90.9807 102.294 90.9904 102.196Q91 102.098 91 102"></path></g></g></defs><use href="#group_0"></use></svg>
<p>And there you go, SVG pacman based on <a href="https://yari-demos.prod.mdn.mozit.cloud/en-US/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes/_sample_.making_combinations.html" target="_blank">the MDN <code>&lt;canvas&gt;</code> demo</a>!</p>
<h2 id="final-thoughts">Final thoughts<a aria-label="Link to this title" href="https://fathy.fr/html2svg#final-thoughts"><svg focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="LinkIcon"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>That&#39;s all for now, <a href="https://github.com/fathyb/html2svg" target="_blank"><code>html2svg</code> is live on GitHub, check it out!</a></p>
<!-- -->
</main></div></div></div>
  </body>
</html>
