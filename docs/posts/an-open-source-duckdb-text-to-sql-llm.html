<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://motherduck.com/blog/duckdb-text2sql-llm/">Original</a>
    <h1>An open source DuckDB text to SQL LLM</h1>
    
    <div id="readability-page-1" class="page"><div><div><section><h2 id="what-does-a-database-have-to-do-with-ai-anyway">What does a database have to do with AI, anyway?</h2><p>After a truly new technology arrives, it makes the future a lot harder to predict. The one thing you can be sure of is that you’re probably not going to continue in the same straight line that you’ve been traveling. The truly impactful destinations are often just on the other side of a mountain that you can’t yet see the top of. This is also what makes technology so terrifying: once the mist clears you might find yourself in a totally new landscape without a map.</p><p>At MotherDuck, we’re excited about ways that AI can be used to help give people superpowers to understand their data. Someone with access to modern Google search would have looked like a wizard to people just a few decades ago; now we take it for granted that you can instantly settle any bet about how old is Morgan Freeman or when was the last time the Seattle Mariners won the World Series. Similarly, AI has the potential to divide the world into “things you did before AI” and “things you did afterwards.”</p><p>It was pretty clear to us that AI was already changing how people interact with their data when one of our early users mentioned they were spending a lot of their time cutting and pasting between ChatGPT and the MotherDuck query UI. That seems super inefficient, and since then we’ve been trying to figure out how to shorten feedback loops and make data practitioners better at their jobs. Any time you have to leave the query you’re writing to check documentation, it distracts you from all of the details you’re keeping track of in your head.</p><p>Two weeks ago, in order to help analysts stay focused on their SQL, we <a href="https://motherduck.com/blog/introducing-fixit-ai-sql-error-fixer/">launched “FixIt,”</a> a feature that can pinpoint which line in your query has an error and suggest a fix. While “FixIt” is pretty simple, it can be surprisingly helpful. Instead of having to look up syntax for things like window functions with trailing averages or timestamp differencing, I can just write the SQL I think should work; if I get the ordering of arguments wrong, misspell something, or use the wrong quote type, “FixIt” will automatically write it correctly.</p><p>This week we’re taking the next step; in conjunction with <a href="https://www.numbersstation.ai/">Numbers Station</a>, we’re open sourcing a DuckDB specific text-to-SQL LLM. Our goal here is to give back to the DuckDB community and help seed interesting DuckDB applications. For the moment, we’ve chosen to trade off some expressivity for faster and less expensive inference by using a small-ish model size. If this turns out to be an interesting area we will follow up more.</p><p>We hope that you’ll come along with us as we continue to explore the ways that AI can make it easier to solve problems with data.</p></section>
<section><h2 id="about-duckdb-nsql">About DuckDB-NSQL</h2><p>We currently provide <a href="https://motherduck.com/docs/key-tasks/using-ml-to-query/">text-to-SQL functionality</a> within MotherDuck, using OpenAI’s most powerful models, that are doing exceptionally well on text-to-SQL <a href="https://yale-lily.github.io/spider">benchmarks</a> and have been proven useful in practice. We do, however, see a need for more lightweight models that enable DucKDB SQL assistance features at lower latency. Upon reviewing existing open models for text-to-SQL, we came to the realization that existing models and benchmarks primarily focus on analytical queries / SELECT statements.</p><p>Beyond fast analytical querying using regular SQL, a significant part of DuckDB&#39;s appeal lies in its <a href="https://duckdb.org/2022/05/04/friendlier-sql.html#group-by-all">friendly SQL</a> syntax, support for <a href="https://duckdb.org/docs/sql/data_types/overview#nesting">nested types</a>, varied <a href="https://duckdb.org/docs/data/overview">data import</a> options, and its diverse ecosystem of <a href="https://duckdb.org/docs/archive/0.9.2/extensions/overview">extensions</a>. Among others, extensions for querying Postgres, SQLite, and Iceberg tables, and support for JSON and GeoSpatial types.</p><p>We believe that text-to-SQL in the context of DuckDB is particularly useful if the model can help users leverage the full power of DuckDB, without having to go forth-and-back between the DuckDB documentation and the SQL shell. We’ve all been there!</p><p>With DuckDB-NSQL-7B, we’re now releasing a text-to-SQL model that is aware of all documented features in DuckDB 0.9.2, including official extensions! Think of it as a documentation oracle that always gives you the exact DuckDB SQL query you are looking for.</p><p>The model was trained on about 200k synthetically generated and validated DuckDB SQL queries, guided by the DuckDB documentation, and more than 250k general <a href="https://huggingface.co/datasets/NumbersStation/NSText2SQL">Text-2-SQL questions from Numbers Station</a>, which makes the model not only capable of generating handy DuckDB snippets but also to generate SQL queries for answering analytical question.</p><p>We fully release the model weights on <a href="https://huggingface.co/motherduckdb/DuckDB-NSQL-7B-v0.1">Hugging Face</a>. and also release the model in a quantized <a href="https://huggingface.co/motherduckdb/DuckDB-NSQL-7B-v0.1-GGUF">GGUF format</a>, for use with llama.cpp.</p><p><em>Read up more about how we created and evaluated DuckDB-NSQL-7B on <a href="http://www.numbersstation.ai/post/duckdb-nsql-how-to-quack-in-sql">Numbers Station’s blog post</a></em></p></section>
<section><h2 id="how-to-use-duckdb-nsql">How to use DuckDB-NSQL</h2><p>The best thing is - You can try it out now on our <a href="https://huggingface.co/spaces/motherduckdb/DuckDB-NSQL-7B">Hugging Face space</a>.!</p><span>
<img alt="Post Image" sizes="100vw" srcset="/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=3840&amp;q=75 3840w" src="https://motherduck.com/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fdemo_sql_b4d708daed.gif&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" loading="lazy"/>
</span><p>To get a SQL snippet, simply prompt the model with a natural language instruction that describes what kind of query you want. The more literal the instruction is, the better!</p><p>Example 1: <em>create a new table called tmp from test.csv</em></p><pre><code><span>CREATE</span> <span>TABLE</span> tmp <span>AS</span> <span>FROM</span> read_csv_auto(<span>&#39;test.csv&#39;</span>);
</code></pre><p>Example 2: <em>get all columns ending with _amount from taxi table</em></p><pre><code><span>SELECT</span> COLUMNS(<span>&#39;.*_amount&#39;</span>) <span>FROM</span> taxi;
</code></pre><p>Example 3: <em>get passenger count, trip distance and fare amount from taxi table and order by all of them</em></p><pre><code><span>SELECT</span> passenger_count, trip_distance, fare_amount <span>FROM</span> taxi <span>ORDER</span> <span>BY</span> <span>ALL</span>;
</code></pre><p>Example 4: <em>get longest trip in december 2022</em></p><pre><code><span>SELECT</span> <span>MAX</span>(trip_miles) <span>FROM</span> rideshare <span>WHERE</span> request_datetime <span>BETWEEN</span> <span>&#39;2022-12-01&#39;</span> <span>AND</span> <span>&#39;2022-12-31&#39;</span>;
</code></pre></section>
<section><h2 id="run-duckdb-nsql-7b-locally">Run DuckDB-NSQL-7B locally</h2><p>If you want to get the fully local experience with llama.cpp head to the <a href="https://github.com/NumbersStationAI/DuckDB-NSQL">GitHub repo</a> or the <a href="https://huggingface.co/motherduckdb/DuckDB-NSQL-7B-v0.1-GGUF">GGUF readme</a>, you will find all the information you need there!</p><p>Have fun!</p></section></div></div><div><div><p>Subscribe to MotherDuck Blog</p><form><div><div><p><label for="subscribe_md_emails">Also subscribe to other MotherDuck updates</label></p></div></div></form></div></div></div>
  </body>
</html>
