<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://avi.im/blag/2023/hekaton-paper-typo/">Original</a>
    <h1>Errata in Hekaton MVCC paper</h1>
    
    <div id="readability-page-1" class="page"><article><p>Hekaton MVCC Paper - <a href="https://vldb.org/pvldb/vol5/p298_per-akelarson_vldb2012.pdf">High-Performance Concurrency Control Mechanisms for Main-Memory Databases</a> - contains a publication error. After reviewing the paper, I confirmed the error with one of the authors. This blog post explains the mistake, the implications and the fix. I blogged about the background story and my discovery in <a href="https://avi.im/blag/2023/internet-mvcc/">another post</a>.</p><h2 id="error">Error</h2><p>Following the conventions of the paper, here is a state diagram:</p><p><img src="https://avi.im/blag/images/2023/hekaton-state.png" alt=""/></p><ol><li>At time 60, we observe our initial state, where the value of Larry is 170. This is a committed row.</li><li>At time 75, a transaction is started and is in <code>Active</code> state. It wants to update the value to 150, so it appended row<sub>2</sub></li><li>At time 80, another new transaction, Tx80 is started, and it wants to read the value of Larry. Both Tx75 and Tx80 are in <code>Active</code> state.</li></ol><p>What is the value Tx80 going to read?</p><p>Tx80 can’t see row<sub>2</sub> because of Table 1 rules. If Tx75 is in <code>Active</code> state, only Tx75 can see row<sub>2</sub>. This makes sense because row<sub>2</sub> is fresh, and Tx75 might drop the changes later. We don’t want any other transactions to see this row.</p><p>But can Tx80 see row<sub>1</sub>? The rules from the paper contradict that since Tx75 is in <code>Active</code> state:</p><p><img src="https://avi.im/blag/images/2023/hekaton-table-2.png" alt=""/></p><p>This is a typo, and Tx80 should be able to see row<sub>1</sub> since it is a committed row. Also, Tx75 should not be able to see row<sub>1</sub> anymore; instead, only row<sub>2</sub>, which it is updating.</p><h2 id="implications">Implications</h2><ul><li>Committed rows can become invisible for new transactions</li><li>Uncommitted rows can become invisible to the very transactions which are updating them</li></ul><h2 id="fix">Fix</h2><p>The fix is simple, the entire column should read:</p><blockquote><p>V is visible only if TE is not T</p></blockquote><p>The usual rule about the time ranges still apply. By doing this:</p><ul><li>Tx80 can now see row<sub>1</sub> (but not row<sub>2</sub>)</li><li>Tx75 can now see row<sub>2</sub> (but not row<sub>1</sub>)</li></ul></article></div>
  </body>
</html>
