<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://devlog.hexops.com/2022/mach-v0.1-zig-graphics-in-60s">Original</a>
    <h1>Mach v0.1:  Cross-platform Zig graphics</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>Five months ago we announced some of our vision for Mach &amp; <a href="https://devlog.hexops.com/2021/mach-engine-the-future-of-graphics-with-zig">the future of graphics with Zig</a>. Today we’ve reached Mach v0.1 with over 1,100 commits.</p>

<h2 id="cross-platform-graphics-in-60-seconds">Cross-platform graphics in 60 seconds</h2>

<p>If you have <a href="https://ziglang.org/">Zig v0.10</a> you can get started with cross-platform graphics in under 60 seconds, try it for yourself:</p>

<div><div><pre><code>git clone https://github.com/hexops/mach
<span>cd </span>mach/gpu
zig build run-example
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/3173176/159139851-013fc1ad-98d2-4fed-ae58-1d5eaa658a15.png"/></p>

<h2 id="all-you-need-is-zig-git-and-curl">All you need is zig, git, and curl.</h2>

<p>One key point we’re solving with Mach is the developer experience. We’re tired of people wasting hours and sometimes days getting the right versions of dependencies on their system in order to build projects!</p>

<p><img src="https://user-images.githubusercontent.com/3173176/159140683-0714eb12-806a-43e5-980f-63aa0d998fc2.png"/></p>

<p>Our <a href="https://github.com/hexops/mach-glfw">glfw bindings</a> build GLFW 100% from source using Zig. We even go so far as to build the DirectX Shader Compiler from source via Zig’s build system.</p>

<p>For the few inescapable system dependencies, such as <code>Metal.framework</code> or <code>libx11</code>, we <a href="https://github.com/hexops/mach-system-sdk">package them up ourselves</a> and our build system knows how to fetch them as needed.</p>

<h2 id="effortless-cross-compilation">Effortless cross-compilation</h2>

<p>Because of our aggressive approach to solving dependencies, you get effortless cross-compilation to any OS literally at the flip of a switch:</p>

<div><div><pre><code>$ zig build -Dtarget=x86_64-windows
$ zig build -Dtarget=x86_64-linux
$ zig build -Dtarget=x86_64-macos.12
$ zig build -Dtarget=aarch64-macos.12
</code></pre></div></div>

<p>The binaries you end up with are virtually static.</p>

<p>For Linux, Zig lets you target any glibc version, and musl too, so no more worrying if that binary will run on other machines.</p>

<h3 id="unified-graphics-api-metal-vulkan-directx-12">Unified graphics API (Metal, Vulkan, DirectX 12)</h3>

<p>Backed by Metal, Vulkan, DirectX 12 &amp; OpenGL (as a fallback), you get a truly cross-platform graphics API for Windows, Linux, and macOS (Browser and Mobile coming in the future)</p>

<p><img src="https://user-images.githubusercontent.com/3173176/160258676-3031e453-c43b-4a9a-b1f7-bfa31c1e002f.png"/></p>

<h3 id="unified-shader-language--compute-shaders">Unified shader language &amp; compute shaders</h3>

<p>There’s no need to write shaders for each graphics backend, instead you write shaders in a single modern language (WGSL):</p>

<p><img src="https://user-images.githubusercontent.com/3173176/160258785-ffeffec7-c7ce-4e1f-a133-1ff849c91f80.png"/></p>

<p>With compute shaders, you have the ability to leverage computation on the GPU outside of graphical applications (machine learning, physics calculations, etc.) using a straightforward &amp; approachable API that works with every GPU vendor.</p>

<h3 id="behind-the-scenes">Behind the scenes</h3>

<p><img src="https://user-images.githubusercontent.com/3173176/160266635-e35438bc-da23-4b2b-8be0-05ae4cce01c0.png"/></p>

<p>Mach <a href="https://gpuweb.github.io/gpuweb/explainer/">leverages WebGPU</a>, a successor to WebGL. WebGPU is an up and coming graphics API being built by Mozilla, Google, Apple, Microsoft, Intel and others.</p>

<p>Natively, Mach uses Zig as a C/C++ compiler to build <a href="https://github.com/hexops/mach-gpu-dawn">Google Chrome’s native WebGPU implementation</a> and we use Zig’s build system so you don’t even have to deal with cmake/ninja/gn/etc.</p>

<p>Our infrastructure produces binary releases so you don’t even have to wait the handful of minutes it would take to compile by default. From-source builds are literally at your fingertips, though, just add <code>-Ddawn-from-source=true</code> to your <code>zig build</code> command.</p>

<h2 id="machgpu-the-gpu-interface-for-zig"><code>mach/gpu</code>: the GPU interface for Zig</h2>

<p><a href="https://github.com/hexops/mach/tree/main/gpu">mach/gpu</a> is our Zig interface to WebGPU and comes in at just over 250 commits.</p>

<p><img src="https://user-images.githubusercontent.com/3173176/160261203-505aa417-e990-45bb-8a3d-17e224f1506c.png"/></p>

<p>It provides a <code>gpu.Interface</code>, similar to how Zig provides a <code>std.mem.Allocator</code> interface, it’s backed by any implementation:</p>

<ul>
  <li>A <code>NativeInstance</code> like Dawn (Google Chrome’s WebGPU implementation.)</li>
  <li>(future) A browser implementation when targeting WebAssembly.</li>
</ul>

<p>Imagine future implementations: maybe a pure-Zig implementation? Maybe a debugger implementation that <em>wraps an existing one</em> and streams all API calls to disk so you can replay them later and step through graphics API calls. Lots of possibilities here!</p>

<p>It’s a comprehensive interface, covering the 176 methods, 73 data structures, and 43 enum types that WebGPU exposes today - but there’s still much to do around documentation, fixing bugs, and ensuring we match the browser API nicely. but the foundation is all there!</p>

<h2 id="zig--greatness">Zig ≈ greatness</h2>

<p>Zig provides <a href="https://ziglang.org/learn/overview/#performance-and-safety-choose-two">some excellent runtime safety</a> and catches many of the mistakes people make in C/C++ (memory leaks, integer overflow, index out of bounds, etc.)</p>

<p>In fact, we’ve caught several instances of undefined behavior in GLFW, and even <a href="https://github.com/microsoft/DirectXShaderCompiler/pull/4178#discussion_r780733405">illegal integer coercion in the DirectX Shader Compiler</a> - all just by compiling C/C++ code using Zig.</p>

<p><a href="https://devlog.hexops.com/2021/perfecting-glfw-for-zig-and-finding-undefined-behavior"><img src="https://user-images.githubusercontent.com/3173176/160260551-41af24c6-9b35-44e9-a759-5966f47b5390.png"/></a></p>

<p>The reason we’re <em>really</em> ecstatic about Zig, though, are what it promises us in the future:</p>

<ul>
  <li><a href="https://twitter.com/andy_kelley/status/1483677253682675713">Blazing fast compilation</a>, compiling and running a program faster than Python can interpret it - impressive!</li>
  <li><a href="http://www.jakubkonka.com/2022/03/16/hcs-zig.html">Hot code swapping</a>, how cool would it be to edit variables etc. as your game is running?</li>
</ul>

<h2 id="entity-component-system">Entity Component System</h2>

<p>We’re building an Entity Component System <a href="https://devlog.hexops.com/categories/build-an-ecs/">in a blog series</a> and inspired by:</p>

<ul>
  <li>Data Oriented Design</li>
  <li>Database design</li>
  <li>Advice from the authors of <a href="https://bevyengine.org">Bevy</a> (a very popular ECS)</li>
</ul>

<p>It’s still early stages, we’ve got some ways to go! But we’re <a href="https://github.com/hexops/mach/tree/main/ecs">on our third major revision</a> and beginning to face the interesting problems. Keep an eye out for updates on that blog series coming soon.</p>

<h2 id="sounds-great-whats-the-catch">Sounds great! What’s the catch?</h2>

<p>Mach (and Zig) are still very early stages! APIs are going to change and break. Mach is missing <em>a lot!</em></p>

<ul>
  <li>Documentation..</li>
  <li>Examples..</li>
  <li>Demos..</li>
  <li>Browser and Mobile support..</li>
  <li>..Literally everything else that makes a game engine</li>
</ul>

<p>If you’re looking for cross-platform graphics in Zig, Mach is for you! Otherwise, you’ll probably need to wait a bit.</p>

<h2 id="getting-started">Getting started</h2>

<p>Check out <a href="https://github.com/hexops/mach">the GitHub</a> and in particular <a href="https://github.com/hexops/mach/tree/main/gpu/examples">this example code</a>.</p>

<p>There’s a ton of material out there about WebGPU already, check out <a href="https://surma.dev/things/webgpu/">this excellent and comprehensive introductory article</a> and <a href="https://github.com/austinEng/webgpu-samples">these awesome samples</a>. It should be easy to map any of these to the Mach <code>gpu.Interface</code> since it’s the same API, just Ziggified!</p>

<p>Join our <a href="https://matrix.to/#/#hexops:matrix.org">Matrix chat room</a> to get help, discuss, etc.</p>

<h2 id="a-personal-note">A personal note</h2>

<p><img src="https://user-images.githubusercontent.com/3173176/160262520-6768c665-7127-4242-b77a-fd2340ed88cf.png"/> No, it’s not Tom from myspace - it’s me, <a href="https://twitter.com/slimsag">@slimsag</a>! It’s cool that we reached this milestone, but let’s be honest: it’s still just a dumb red triangle!</p>

<p>It’s taken <em>9 brutal months to get here</em> - staring at broken CI pipelines, C++ compiler errors, <a href="https://twitter.com/slimsag/status/1507506138144681986">buying hardware</a> to test every OS+arch possible - and slugging through the depths of hell <a href="https://twitter.com/slimsag/status/1471986125296205825">where only a footnote from Raymond Chen himself will save you.</a> All to get to a point where it all <em>just works the way you and I expect it to.</em></p>

<p>Given the chance, I’d scream from a rooftop “f***ing finally! Now we build the cool part!” because I am so <em>ecstatic</em> to have gotten to this point!</p>

<p>There are few things in life that I am <em>more serious about</em> than this. I dedicate ~48 hours/week to my dayjob, and ~50h/week to Zig building Mach and running <a href="https://zigmonthly.org">zigmonthly.org</a>. After three years of aggressively pushing for progress in this exact way, I have <a href="https://devlog.hexops.com/2021/I-write-code-100-hours-a-week">no plans to slow down anytime soon</a>.</p>

<p>This is <em>literally</em> just the beginning. Buckle up!</p>

<h2 id="whats-next">What’s next?</h2>

<p><img src="https://user-images.githubusercontent.com/3173176/160262449-79adcd0a-dde7-46fe-8730-316419f25516.png"/></p>

<p>My lightning talk in which I’ll be making the case for Mach engine and conveying the vision for where we go from here will be presented at the first-ever European <a href="https://zig.news/kristoff/zig-milan-party-2022-final-info-schedule-1jc1">Zig meetup in Milan, Italy on Apr 9-10</a>.</p>

<p>If like me you are unable to attend in person, the short video will be available afterwards on the <a href="https://twitter.com/machengine">@machengine</a> Twitter!</p>

<h2 id="help-us-reach-mach-v10">Help us reach Mach v1.0</h2>

<p>Consider <a href="https://github.com/sponsors/slimsag">sponsoring me on GitHub</a> if you like my work, so I can do more of it!</p>

<p>Join our <a href="https://matrix.to/#/#hexops:matrix.org">Matrix chat room</a> to discuss ideas - collaboration very welcome!</p>

<p>Thanks for coming along in our journey!</p>

  </div>

  

</article>

      </div>
    </div></div>
  </body>
</html>
