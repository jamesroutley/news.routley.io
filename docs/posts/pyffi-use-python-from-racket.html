<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://soegaard.github.io/pyffi/An_introduction_to_pyffi.html">Original</a>
    <h1>Pyffi – Use Python from Racket</h1>
    
    <div id="readability-page-1" class="page"><div><div><h3>5<tt> </tt><a name="(part._.An_introduction_to_pyffi)"></a>An introduction to <span>pyffi</span></h3><p>The <span>pyffi</span> library makes it possible to use Python libraries from a Racket program.</p><p>A Racket program can start a Python process by requiring <span>pyffi</span> and calling
<span><a href="https://soegaard.github.io/pyffi/Initialization_of_the_Python_Interpreter.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._initialize%29%29" data-pltdoc="x">initialize</a></span>. After the initialization <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span> and <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%2A%29%29" data-pltdoc="x">run*</a></span> can
be used to evaluate expressions and statements in the Python process.</p><blockquote></blockquote><p>Here Racket starts an embed Python process.
The Python &#34;1+2&#34; is parsed, compiled and evaluated by Python.
The resulting Python value 3 is then converted to the Racket value 3.</p><h4>5.1<tt> </tt><a name="(part._.Atomic_values__numbers__.Booleans_and_.None)"></a>Atomic values: numbers, Booleans and <span>None</span></h4><p>Atomic Python values (numbers, Booleans and None) are automatically converted
to their corresponding Racket values.</p><blockquote></blockquote><h4>5.2<tt> </tt><a name="(part._.Compound_.Values__strings__tuples__lists__and__dictionaries)"></a>Compound Values: strings, tuples, lists, and, dictionaries</h4><p>Compound (non-atomic) Python values such as strings, tuples, lists and dicts are not converted
to Racket values. Instead they are wrapped in a struct named <span><span><span>obj</span></span></span>.
Due to a custom printer handler these wrapped values print nicely.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;&#39;Hello World&#39;&#34;</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;str&#34; : &#39;Hello World&#39;)</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;(1,2,3)&#34;</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;tuple&#34; : (1, 2, 3))</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;[1,2,3]&#34;</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;list&#34; : [1, 2, 3])</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;{&#39;a&#39;: 1, &#39;b&#39;: 2}&#34;</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;dict&#34; : {&#39;a&#39;: 1, &#39;b&#39;: 2})</span></p></td></tr></tbody></table></blockquote><p>The values display nicely too:</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;&#39;Hello World&#39;&#34;</span><span>)</span><span>)</span></td></tr><tr><td><p><span>Hello World</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;(1,2,3)&#34;</span><span>)</span><span>)</span></td></tr><tr><td><p><span>(1, 2, 3)</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;[1,2,3]&#34;</span><span>)</span><span>)</span></td></tr><tr><td><p><span>[1, 2, 3]</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;{&#39;a&#39;: 1, &#39;b&#39;: 2}&#34;</span><span>)</span><span>)</span></td></tr><tr><td><p><span>{&#39;a&#39;: 1, &#39;b&#39;: 2}</span></p></td></tr></tbody></table></blockquote><p>Printing and displaying a Python object use the
<a href="https://docs.python.org/3/search.html?q=object.__repr__">__repr__</a> and <a href="https://docs.python.org/3/search.html?q=object.__str__">__str__</a>
methods of the object respectively.</p><p>The idea is that Racket gains four new data types: <span>pystring</span>, <span>pytuple</span>,
<span>pylist</span> and <span>pydict</span>.</p><p>To convert a compound value use <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pystring-~3estring%29%29" data-pltdoc="x">pystring-&gt;string</a></span>, <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pytuple-~3evector%29%29" data-pltdoc="x">pytuple-&gt;vector</a></span>,
<span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pylist-~3elist%29%29" data-pltdoc="x">pylist-&gt;list</a></span> or <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pydict-~3ehash%29%29" data-pltdoc="x">pydict-&gt;hash</a></span>.</p><blockquote></blockquote><p>Similarly, you can convert Racket values to Python ones.</p><blockquote></blockquote><p>It’s important to note that creating Python values using
<span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._string-~3epystring%29%29" data-pltdoc="x">string-&gt;pystring</a></span>, <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._vector-~3epytuple%29%29" data-pltdoc="x">vector-&gt;pytuple</a></span>, <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._list-~3epylist%29%29" data-pltdoc="x">list-&gt;pylist</a></span>
and <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._hash-~3epydict%29%29" data-pltdoc="x">hash-&gt;pydict</a></span> is much more efficient than using <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span>.
The overhead of <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span> is due to the parsing and compiling of its input string.
In contrast <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._string-~3epystring%29%29" data-pltdoc="x">string-&gt;pystring</a></span> and friends use the C API to create the
Python values directly.</p><p>The data types have also have constructors:</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pystring%29%29" data-pltdoc="x">pystring</a></span><span> </span><span>#\H</span><span> </span><span>#\e</span><span> </span><span>#\l</span><span> </span><span>#\l</span><span> </span><span>#\o</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;str&#34; : &#39;Hello&#39;)</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pytuple%29%29" data-pltdoc="x">pytuple</a></span><span> </span><span>1</span><span> </span><span>2</span><span> </span><span>3</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;tuple&#34; : (1, 2, 3))</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pylist%29%29" data-pltdoc="x">pylist</a></span><span> </span><span>1</span><span> </span><span>2</span><span> </span><span>3</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;list&#34; : [1, 2, 3])</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pydict%29%29" data-pltdoc="x">pydict</a></span><span> </span><span>&#34;a&#34;</span><span> </span><span>1</span><span> </span><span>&#34;b&#34;</span><span> </span><span>2</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;dict&#34; : {&#39;a&#39;: 1, &#39;b&#39;: 2})</span></p></td></tr></tbody></table></blockquote><p>The new types <span>pystring</span>, <span>pytuple</span>, <span>pylist</span> and <span>pydict</span> can be used with <span>for</span>.</p><blockquote></blockquote><h4>5.3<tt> </tt><a name="(part._.Builtin_functions_and_modules)"></a>Builtin functions and modules</h4><div><blockquote><blockquote><blockquote><p>Use <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span> for expressions and <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%2A%29%29" data-pltdoc="x">run*</a></span> for statements.</p></blockquote></blockquote></blockquote></div><p>The previous sections showed how to evaluate expressions using the Python interpreter.
Now we will look at statements.</p><blockquote></blockquote><p>Here the statement <span>x = 1+2</span> is parsed, compiled and executed.
The result of the expression <span>1+2</span> is stored in the global variable <span>x</span>.</p><p>To retrieve the value of the Python variable <span>x</span> we could use <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span>:
</p><p>But due to the overhead of <span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span> it is better to make a direct
variable reference.</p><blockquote></blockquote><p>Here <span>main</span> is the name we have given to the module used for the
global namespace of the Python interpreter. The dotted identifier <span>main.x</span>
thus references the variable <span>x</span> in the global namespace.</p><p>In a standard Python interpreter nothing is imported when the interpreter
is started, but with <span>pyffi</span> the module <a href="https://docs.python.org/3/search.html?q=builtins">builtins</a>
is imported at startup.</p><p>Since Python modules are first class values, we can see their printed
representations:</p><blockquote><table><tbody><tr><td><span>&gt; </span><span><span><span>main</span></span></span></td></tr><tr><td><p><span>(obj &#34;module&#34; : &lt;module &#39;__main__&#39; (built-in)&gt;)</span></p></td></tr><tr><td><span>&gt; </span><span><span><span>builtins</span></span></span></td></tr><tr><td><p><span>(obj &#34;module&#34; : &lt;module &#39;builtins&#39; (built-in)&gt;)</span></p></td></tr></tbody></table></blockquote><p>The module <span>builtins</span> is also how we access the built-in Python functions.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>builtins.abs</span><span> </span><span><span>-7</span></span><span>)</span></td></tr><tr><td><p><span>7</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><span><span>builtins.list</span></span></span><span> </span><span>&#34;Hello&#34;</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;list&#34; : [&#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;])</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><span><span>builtins.range</span></span></span><span> </span><span>2</span><span> </span><span>5</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;range&#34; : range(2, 5))</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><span><span>builtins.list</span></span></span><span> </span><span>(</span><span><span><span>builtins.range</span></span></span><span> </span><span>2</span><span> </span><span>5</span><span>)</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;list&#34; : [2, 3, 4])</span></p></td></tr></tbody></table></blockquote><p>If you find the name <span>builtins</span> too long, then you can give it a new, shorter name.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>define</span><span> </span><span>b</span><span> </span><span><span><span>builtins</span></span></span><span>)</span></td></tr><tr><td><span>&gt; </span><span>(</span><span>b.abs</span><span> </span><span><span>-7</span></span><span>)</span></td></tr><tr><td><p><span>7</span></p></td></tr></tbody></table></blockquote><p>If you access the <span>abs</span> functions directly, you get a callable object:</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>b.abs</span></td></tr><tr><td><p><span>(obj callable &#34;builtin_function_or_method&#34; : &lt;built-in function abs&gt;)</span></p></td></tr></tbody></table></blockquote><p>A callable object can be used just like a normal Racket function:</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>map</span><span> </span><span>b.abs</span><span> </span><span>&#39;</span><span>(</span><span>1</span><span> </span><span><span>-2</span></span><span> </span><span>3</span><span> </span><span><span>-4</span></span><span>)</span><span>)</span></td></tr><tr><td><p><span>&#39;(1 2 3 4)</span></p></td></tr></tbody></table></blockquote><p>To use functions from the Python standard library, you need to import it before
you can use it. The standard library <a href="https://docs.python.org/3/search.html?q=sys">sys</a> provide
a lot of system information. Let’s use it to find the version of the Python interpreter.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><span><span>import</span></span></span><span> </span><span>sys</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>sys.version_info</span></td></tr><tr><td><p><span>(obj &#34;version_info&#34; : sys.version_info(major=3, minor=10, micro=7, releaselevel=&#39;final&#39;, serial=0))</span></p></td></tr></tbody></table></blockquote><p>The list of modules in
<a href="https://docs.python.org/3/library/index.html">The Python Standard Library</a>
is long, so let’s just try one more.</p><p>We want to print a text calendar for the current month.</p><div><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><span><span>import</span></span></span><span> </span><span>calendar</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>(</span><span>calendar.TextCalendar</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;TextCalendar&#34; : &lt;calendar.TextCalendar object at 0x7fb02d8a6050&gt;)</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span>(</span><span>calendar.TextCalendar</span><span>)</span><span> </span><span>.formatmonth</span><span> </span><span>2022</span><span> </span><span>7</span><span>)</span><span>)</span></td></tr><tr><td><table><tbody><tr><td></td></tr><tr><td><p><span></span><span> </span><span></span><span>  </span><span></span><span>  </span><span>July 2022</span></p></td></tr><tr><td><p><span>Mo Tu We Th Fr Sa Su</span></p></td></tr><tr><td><p><span></span><span> </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>1</span><span>  </span><span>2</span><span>  </span><span>3</span></p></td></tr><tr><td><p><span></span><span> </span><span>4</span><span>  </span><span>5</span><span>  </span><span>6</span><span>  </span><span>7</span><span>  </span><span>8</span><span>  </span><span>9 10</span></p></td></tr><tr><td><p><span>11 12 13 14 15 16 17</span></p></td></tr><tr><td><p><span>18 19 20 21 22 23 24</span></p></td></tr><tr><td><p><span>25 26 27 28 29 30 31</span></p></td></tr><tr><td></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><p>The expression <span>(calendar.TextCalendar)</span> instantiates a <span>TextCalendar</span> object.
The syntax <span>(object .method arg ...)</span> is used to invoke the method <span>formatmonth</span>
with the arguments 2022 and 7 (for July).</p><p>The documentation for <span>formatmonth</span> shows its signature:</p><blockquote><p><span>formatmonth(theyear, themonth, w=0, l=0)</span></p></blockquote><p>The two first arguments <span>theyear</span> and <span>themonth</span> are postional arguments
and the two last arguments <span>w</span> and <span>l</span> are keyword arguments both has
0 has as default value.</p><p>The keyword argument <span>w</span> specifies the width of the date columns.
We can get full names of the week days with a width of 9.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span>(</span><span>calendar.TextCalendar</span><span>)</span><span> </span><span>.formatmonth</span><span> </span><span>2022</span><span> </span><span>7</span><span> </span><span>#:w</span><span> </span><span>9</span><span>)</span><span>)</span></td></tr><tr><td><table><tbody><tr><td></td></tr><tr><td><p><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>July 2022</span></p></td></tr><tr><td><p><span></span><span>  </span><span>Monday </span><span>  </span><span>Tuesday</span><span>  </span><span>Wednesday</span><span>  </span><span>Thursday </span><span>  </span><span>Friday </span><span>  </span><span>Saturday </span><span>  </span><span>Sunday</span></p></td></tr><tr><td><p><span></span><span> </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>1 </span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>2 </span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>3</span></p></td></tr><tr><td><p><span></span><span> </span><span></span><span>  </span><span></span><span>  </span><span>4 </span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>5 </span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>6 </span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>7 </span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>8 </span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>9</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>10</span></p></td></tr><tr><td><p><span></span><span>  </span><span></span><span>  </span><span>11</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>12</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>13</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>14</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>15</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>16</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>17</span></p></td></tr><tr><td><p><span></span><span>  </span><span></span><span>  </span><span>18</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>19</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>20</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>21</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>22</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>23</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>24</span></p></td></tr><tr><td><p><span></span><span>  </span><span></span><span>  </span><span>25</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>26</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>27</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>28</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>29</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>30</span><span>  </span><span></span><span>  </span><span></span><span>  </span><span></span><span>  </span><span>31</span></p></td></tr><tr><td></td></tr></tbody></table></td></tr></tbody></table></blockquote><h4>5.4<tt> </tt><a name="(part._.Objects__.Callable_objects__.Functions__.Methods_and_.Properties)"></a>Objects, Callable objects, Functions, Methods and Properties</h4><p>All values in Python are represented as <span>objects</span>. This differs from Racket,
where most data types (e.g. numbers and strings) aren’t objects.</p><p>In the data model used by Python, all objects have an identity, a type and a value.
In practice the identity of a Python object is represented by its address in memory
[the CPython implementation never moves objects].</p><p>To represent a Python object in Racket it is wrapped in an <span><span><span>obj</span></span></span> struct.
The structure contains the type name as a string and a pointer to the object.
The wrapper set the struct property <span>gen:custom-write</span> to
display, write and print the wrapped objects nicely.</p><p>The result of <span>repr()</span> is used to write an object. </p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>define</span><span> </span><span>s</span><span> </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._string-~3epystring%29%29" data-pltdoc="x">string-&gt;pystring</a></span><span> </span><span>&#34;foo&#34;</span><span>)</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>(</span><span><span><span>repr</span></span></span><span> </span><span>s</span><span>)</span></td></tr><tr><td><p><span>&#34;&#39;foo&#39;&#34;</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>writeln</span><span> </span><span>s</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;str&#34; : &#39;foo&#39;)</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><span><span>str</span></span></span><span> </span><span>s</span><span>)</span></td></tr><tr><td><p><span>&#34;foo&#34;</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>s</span><span>)</span></td></tr><tr><td><p><span>foo</span></p></td></tr></tbody></table></blockquote><p>Functions and in general <span>callable objects</span> support the well-known
syntax <span>f(a,b,c)</span>. Such callable objects are wrapped in an <span><span><span>callable-obj</span></span></span>
struct, which has <span><span><span>obj</span></span></span> as a super type. The <span><span><span>callable-obj</span></span></span>
use the struct property <span>prop:procedure</span> to make the wrapper applicable.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%2A%29%29" data-pltdoc="x">run*</a></span><span> </span><span>&#34;def f(x): return x+1&#34;</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>(</span><span>define</span><span> </span><span>f</span><span> </span><span>main.f</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>f</span></td></tr><tr><td><p><span>(obj callable &#34;function&#34; : &lt;function f at 0x7fb02da43d90&gt;)</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>f</span><span> </span><span>41</span><span>)</span></td></tr><tr><td><p><span>42</span></p></td></tr></tbody></table></blockquote><p>Function calls with keywords work as expected. A Python keyword
is simply prefixed with <span>#:</span> to turn it into a Racket keyword,
as this example shows:</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%2A%29%29" data-pltdoc="x">run*</a></span><span> </span><span>&#34;def hello(name, title=&#39;Mr&#39;): return &#39;Hello &#39; + title + &#39; &#39; + name&#34;</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span>main.hello</span><span> </span><span>&#34;Foo&#34;</span><span>)</span><span>)</span></td></tr><tr><td><p><span>Hello Mr Foo</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>(</span><span>main.hello</span><span> </span><span>#:title</span><span> </span><span>&#34;Mrs&#34;</span><span> </span><span>&#34;Bar&#34;</span><span>)</span><span>)</span></td></tr><tr><td><p><span>Hello Mrs Bar</span></p></td></tr></tbody></table></blockquote><p>In order to illustrate methods, let’s look at the <span>Calendar</span> class in
the <span>calendar</span> module.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><span><span>import</span></span></span><span> </span><span>calendar</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>calendar.Calendar</span></td></tr><tr><td><p><span>(obj callable &#34;type&#34; : &lt;class &#39;calendar.Calendar&#39;&gt;)</span></p></td></tr></tbody></table></blockquote><p>Calling the class gives us an instance object. We pass 0 to make Monday the first
week day.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>calendar.Calendar</span><span> </span><span>#:firstweekday</span><span> </span><span>0</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;Calendar&#34; : &lt;calendar.Calendar object at 0x7fb02d6da3b0&gt;)</span></p></td></tr></tbody></table></blockquote><p>One of the methods of a calendar object is <span>monthdatescalendar</span>.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>define</span><span> </span><span>cal</span><span> </span><span>(</span><span>calendar.Calendar</span><span> </span><span>#:firstweekday</span><span> </span><span>0</span><span>)</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>cal.monthdatescalendar</span></td></tr><tr><td><p><span>(obj callable &#34;method&#34; : &lt;bound method Calendar.monthdatescalendar of &lt;calendar.Calendar object at 0x7fb02d6da770&gt;&gt;)</span></p></td></tr></tbody></table></blockquote><p>The syntax <span>obj.method</span> gives us a <span>bound method</span>,
which we can call. Bound methods are wrapped in <span><span><span>method-obj</span></span></span>
to make them applicable.</p><div><blockquote><blockquote><blockquote><p>The use of <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pyfirst%29%29" data-pltdoc="x">pyfirst</a></span> is to reduce the amount of output.</p></blockquote></blockquote></blockquote></div><div><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>define</span><span> </span><span>year</span><span>  </span><span>2022</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>(</span><span>define</span><span> </span><span>month</span><span>    </span><span>9</span><span>)</span></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pyfirst%29%29" data-pltdoc="x">pyfirst</a></span><span> </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pyfirst%29%29" data-pltdoc="x">pyfirst</a></span><span> </span><span>(</span><span>cal.monthdatescalendar</span><span> </span><span>year</span><span> </span><span>month</span><span>)</span><span>)</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;date&#34; : datetime.date(2022, 8, 29))</span></p></td></tr></tbody></table></blockquote></div><p>However, we can also invoke the <span>monthdatescalendar</span> method directly
with the help of the syntax <span>(obj .method argument ...)</span>.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pyfirst%29%29" data-pltdoc="x">pyfirst</a></span><span> </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pyfirst%29%29" data-pltdoc="x">pyfirst</a></span><span> </span><span>(</span><span>cal</span><span> </span><span>.monthdatescalendar</span><span> </span><span>year</span><span> </span><span>month</span><span>)</span><span>)</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;date&#34; : datetime.date(2022, 8, 29))</span></p></td></tr></tbody></table></blockquote><p>Method invocations can be chained. That is, if a method call returns
an object, we can invoke a method on it. The fist element
of a list can be retrieved by the <span>pop</span> method, so we can replace
the two calls to <span><a href="https://soegaard.github.io/pyffi/Datatypes.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._pyfirst%29%29" data-pltdoc="x">pyfirst</a></span> with two invocations of <span>.pop</span>.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>cal</span><span> </span><span>.monthdatescalendar</span><span> </span><span>year</span><span> </span><span>month</span><span>  </span><span>.pop</span><span> </span><span>0</span><span> </span><span>.pop</span><span> </span><span>0</span><span>)</span></td></tr><tr><td><p><span>(obj &#34;date&#34; : datetime.date(2022, 8, 29))</span></p></td></tr></tbody></table></blockquote><p>Besides methods an object can have properties (atributes).
The syntax is <span>obj.attribute</span>. Most Python objects
carry a little documentation in the oddly named <span>__doc__</span> attribute.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span>displayln</span><span> </span><span>cal.__doc__</span><span>)</span></td></tr><tr><td><table><tbody><tr><td></td></tr><tr><td><p><span></span><span>  </span><span></span><span>  </span><span>Base calendar class. This class doesn&#39;t do any formatting. It simply</span></p></td></tr><tr><td><p><span></span><span>  </span><span></span><span>  </span><span>provides data to subclasses.</span></p></td></tr><tr><td></td></tr></tbody></table></td></tr></tbody></table></blockquote><h4>5.5<tt> </tt><a name="(part._.Exceptions)"></a>Exceptions</h4><p>An exception on the Python side is converted to an exception on the Racket side.
The exception will be printed with a full traceback.</p><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="https://soegaard.github.io/pyffi/Evaluation.html#%28def._%28%28lib._pyffi%2Fmain..rkt%29._run%29%29" data-pltdoc="x">run</a></span><span> </span><span>&#34;1/0&#34;</span><span>)</span></td></tr><tr><td><p><span>run: Python exception occurred;</span></p></td></tr><tr><td><p><span></span><span> </span><span>ZeroDivisionError: division by zero</span></p></td></tr><tr><td></td></tr><tr><td><p><span></span><span>  </span><span>File &#34;&lt;string&gt;&#34;, line 1, in &lt;module&gt;</span></p></td></tr><tr><td><blockquote></blockquote></td></tr></tbody></table></blockquote></div></div></div>
  </body>
</html>
