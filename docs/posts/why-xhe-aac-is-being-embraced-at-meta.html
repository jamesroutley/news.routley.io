<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://engineering.fb.com/2023/04/11/video-engineering/high-quality-audio-xhe-aac-codec-meta/">Original</a>
    <h1>Why xHE-AAC is being embraced at Meta</h1>
    
    <div id="readability-page-1" class="page"><div>

		<ul>
<li aria-level="1"><span>We’re sharing how Meta delivers high-quality audio at scale with the <a href="https://www.iis.fraunhofer.de/en/ff/amm/broadcast-streaming/xheaac.html" target="_blank" rel="noopener">xHE-AAC audio codec</a>.</span></li>
<li aria-level="1"><span>xHE-AAC has already been deployed on Facebook and Instagram to provide enhanced audio for features like Reels and Stories. </span></li>
</ul>
<p><span>At Meta, we serve every media use case imaginable for billions of people across the world — from short-form, user-generated content, such as</span> <a href="https://engineering.fb.com/2023/02/21/video-engineering/av1-codec-facebook-instagram-reels/" target="_blank" rel="noopener"><span>Reels</span></a><span>, to premium </span><a href="https://engineering.fb.com/2021/04/05/video-engineering/how-facebook-encodes-your-videos/" target="_blank" rel="noopener"><span>video on demand (VOD)</span></a><span> and</span> <a href="https://engineering.fb.com/2020/10/22/video-engineering/live-streaming/" target="_blank" rel="noopener"><span>live broadcasts</span></a><span>. Given this, we need a next-generation audio codec that supports a range of operating points with excellent compression efficiency and modern, system-level audio features. </span></p>
<p><span>To address these needs now and into the future, Meta has embraced xHE-AAC as the vehicle for delivering high-quality audio at scale.</span></p>
<h2><span>The benefits of xHE-AAC</span></h2>
<p><span>xHE-AAC is the latest member of the MPEG AAC audio codec family. The </span><a href="https://www.iis.fraunhofer.de/en/ff/amm/broadcast-streaming/xheaac.html" target="_blank" rel="noopener"><span>Fraunhofer Institute for Integrated Circuits IIS</span></a><span> played a substantial role in the development of xHE-AAC and the MPEG-D DRC standard.</span></p>
<p><span>Today, xHE-AAC is already providing a superior audio experience on Facebook and Instagram — including on </span><a href="https://engineering.fb.com/2023/02/21/video-engineering/av1-codec-facebook-instagram-reels/" target="_blank" rel="noopener"><span>Reels</span></a><span> and </span><a href="https://engineering.fb.com/2022/07/18/developer-tools/building-text-animations-for-instagram-stories/" target="_blank" rel="noopener"><span>Stories</span></a><span> — and has a number of valuable features.</span></p>
<h3><span>Loudness management</span></h3>
<p><span>With </span><a href="https://engineering.fb.com/2021/04/05/video-engineering/how-facebook-encodes-your-videos/" target="_blank" rel="noopener"><span>hundreds of millions of uploads per day across Facebook and Instagram</span></a><span>, we receive audio tracks with loudness levels ranging from silence to full scale, and everything in between. </span></p>
<p><img decoding="async" src="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg?w=1024" alt="xHE-AAC codec at Meta" width="1024" height="767" srcset="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg 1920w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg?resize=916,687 916w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg?resize=768,576 768w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg?resize=1024,767 1024w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg?resize=1536,1151 1536w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg?resize=96,72 96w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-1.jpg?resize=192,144 192w" sizes="(max-width: 992px) 100vw, 62vw"/></p>
<p><span>When people play these videos sequentially, they can perceive some audio as being too loud or too quiet. This creates listener fatigue from having to constantly adjust the volume.</span></p>
<p><img decoding="async" loading="lazy" src="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg?w=1024" alt="xHE-AAC codec at Meta" width="1024" height="660" srcset="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg 1920w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg?resize=916,590 916w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg?resize=768,495 768w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg?resize=1024,660 1024w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg?resize=1536,990 1536w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg?resize=96,62 96w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-2.jpg?resize=192,124 192w" sizes="(max-width: 992px) 100vw, 62vw"/></p>
<p><span>xHE-AAC’s integrated loudness management system solves for loudness inconsistency while meticulously preserving creator intent by bringing the average loudness of all sessions to the same target level and managing the dynamic range of each session to fit the playback environment.</span></p>
<p><span>Instead of burning in a specific target level and dynamic range compression (DRC) profile during encoding, xHE-AAC allows us to leave the original audio characteristics untouched and delegate loudness management processing to the client via loudness metadata, for the optimal audio experience based on context. </span></p>
<p><img decoding="async" loading="lazy" src="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg?w=1024" alt="xHE-AAC codec at Meta" width="1024" height="389" srcset="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg 1920w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg?resize=916,348 916w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg?resize=768,292 768w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg?resize=1024,389 1024w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg?resize=1536,583 1536w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg?resize=96,36 96w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-3.jpg?resize=192,73 192w" sizes="(max-width: 992px) 100vw, 62vw"/></p>
<p><span>As a result of xHE-AAC’s loudness management, people can spend more time immersed in their favorite content and less time fiddling with the volume control.</span></p>
<h3><span>Adaptive bit rate audio</span></h3>
<p><span>Most people who use our apps consume media on mobile devices and expect the highest audio quality without interruption. This presents a challenge for streaming media because connection quality varies on mobile and can result in a very uneven user experience. </span></p>
<p><img decoding="async" loading="lazy" src="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg?w=1024" alt="xHE-AAC codec at Meta" width="1024" height="660" srcset="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg 1920w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg?resize=916,590 916w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg?resize=768,495 768w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg?resize=1024,660 1024w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg?resize=1536,990 1536w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg?resize=96,62 96w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-4.jpg?resize=192,124 192w" sizes="(max-width: 992px) 100vw, 62vw"/></p>
<p><span>To optimize quality under dynamic bandwidth constraints, we produce</span><a href="https://engineering.fb.com/2021/04/05/video-engineering/how-facebook-encodes-your-videos/"> <span>multiple video and audio qualities</span></a><span> to match varying network conditions at playback time. Even though we produce multiple audio lanes, we have historically only employed</span><a href="https://engineering.fb.com/2022/11/04/video-engineering/instagram-video-processing-encoding-reduction/"> <span>adaptive bit rate (ABR)</span></a><span> algorithms to switch video qualities during playback because it’s difficult to enable adaptive bit rate audio without compromising quality during lane transitions.</span></p>
<p><span>In order to enable seamless audio ABR, xHE-AAC introduces the concept of immediate playout frames (IPFs) that contain all the data necessary to start playing a new audio lane without relying on data from other frames. By placing an IPF at the beginning of each Dynamic Adaptive Streaming over HTTP (DASH) segment and aligning the segment durations of each lane, we can seamlessly switch between audio lanes during playback to provide the highest-quality audio at any available bandwidth while avoiding playback stalls.</span></p>
<p><img decoding="async" loading="lazy" src="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg?w=1024" alt="xHE-AAC codec at Meta" width="1024" height="660" srcset="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg 1920w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg?resize=916,590 916w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg?resize=768,495 768w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg?resize=1024,660 1024w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg?resize=1536,990 1536w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg?resize=96,62 96w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC_Visual-5.jpg?resize=192,124 192w" sizes="(max-width: 992px) 100vw, 62vw"/></p>
<p><span>After launching audio ABR on Facebook for Android, we were able to improve user experience by reducing the number of sessions where playback stalls. </span></p>
<h2><span>How we deployed xHE-AAC</span></h2>
<p><span>We generate xHE-AAC bitstreams using an encoder SDK provided by the Fraunhofer Institute for Integrated Circuits IIS, and then prepare the resulting audio files for DASH streaming with shaka-packager. The xHE-AAC encoder’s two-pass encoding mode is used to measure the input loudness envelope and average program loudness on the first pass and perform the actual audio data compression on the second pass. As an added benefit, two-pass encoding allows us to use loudness range control (LRAC) DRC, which mitigates pumping artifacts otherwise introduced by single-pass DRC algorithms. </span><span> <img decoding="async" loading="lazy" src="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?w=742" alt="xHE-AAC codec at Meta" width="742" height="1024" srcset="https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg 1920w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?resize=664,916 664w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?resize=768,1060 768w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?resize=742,1024 742w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?resize=1113,1536 1113w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?resize=1484,2048 1484w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?resize=96,133 96w, https://engineering.fb.com/wp-content/uploads/2023/03/xHE-AAC-Meta-Visual-6.jpg?resize=192,265 192w" sizes="(max-width: 992px) 100vw, 62vw"/></span></p>
<p><span>To prepare an xHE-AAC audio adaptation set for ABR delivery, IPFs are inserted at constant time intervals, audio configuration parameters such as sample rate and channel configuration are kept constant, and unique stream identifiers are selected for each lane in the audio adaptation set.</span></p>
<p><span>At playback time, we custom-fit the audio to the listening environment by configuring a target loudness level and DRC effect type based on context, and thanks to the embedded loudness metadata, we can adapt a single xHE-AAC bitstream to a variety of audio consumption use cases, from headphones to device speakers and various levels of background noise. Finally, if the client is starved for data or bandwidth is plentiful, audio ABR will automatically switch audio qualities to ensure that the highest audio quality is played without interrupting the playback session.</span></p>
<h2><span>Where can you experience xHE-AAC today?</span></h2>
<p><span>You can experience xHE-AAC audio on Facebook for iOS and Android, as well as on targeted surfaces on Instagram, such as Reels and Stories</span><span>. </span><span>We encourage you to install the latest version of Facebook and Instagram apps on iOS 13+ and Android 9+ to ensure that you can experience it.</span></p>
<h2><span>Acknowledgements</span></h2>
<p><i><span>This work is the collective result of the entire Video Infrastructure and Instagram Media Platform teams at Meta in collaboration with Fraunhofer </span></i><i><span>Institute for Integrated Circuits</span></i><i><span> IIS. The author would like to extend special thanks to Abhishek Gera, Tim Harris, Arun Kotidath, Edward Li, Meng Li, Srinivas Lingutla, Denise Noyes, Mohanish Penta, David Ronca, Haixia Shi, Mike Starr, Cosmin Stejerean, Simha Venkataramaiah, Juehui Zhang, Runshen Zhu, and the engineering team at Fraunhofer </span></i><i><span>Institute for Integrated Circuits</span></i><i><span> IIS.</span></i></p>

		
	</div></div>
  </body>
</html>
