<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/nineties/planckforth">Original</a>
    <h1>planckforth: Bootstrapping a Forth interpreter from hand-written tiny ELF binary</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This project aims to bootstrap a Forth interpreter from hand-written tiny (1KB) ELF binary.
This is just for fun. No practical use.</p>

<p dir="auto">Only <code>xxd</code> is needed to build PlanckForth.</p>
<div data-snippet-clipboard-copy-content="$ git clone https://github.com/nineties/planckforth.git
$ cd planckforth
$ make
xxd -r -c 8 planck.xxd &gt; planck
chmod +x planck"><pre><code>$ git clone https://github.com/nineties/planckforth.git
$ cd planckforth
$ make
xxd -r -c 8 planck.xxd &gt; planck
chmod +x planck
</code></pre></div>
<p dir="auto">Implementations in other languages are in <code>others</code>.</p>

<p dir="auto">The hello world program at the beginning looks like this.</p>
<div data-snippet-clipboard-copy-content="$ ./planck
kHtketkltkltkotk tkWtkotkrtkltkdtk!tk:k0-tk0k0-Q"><pre><code>$ ./planck
kHtketkltkltkotk tkWtkotkrtkltkdtk!tk:k0-tk0k0-Q
</code></pre></div>
<p dir="auto">After bootstrapping by <code>bootstrap.fs</code>, it looks like this.</p>
<div data-snippet-clipboard-copy-content="$ ./planck &lt; bootstrap.fs
.&#34; Hello World!&#34; cr"><pre><code>$ ./planck &lt; bootstrap.fs
.&#34; Hello World!&#34; cr
</code></pre></div>
<p dir="auto"><code>bootstrap.fs</code> can also take a file as an input program like this.</p>
<div data-snippet-clipboard-copy-content="$ cat example/fib.fs
: fib dup 2 &lt; unless 1- dup recurse swap 1- recurse + then ;
20 fib . cr
$ ./planck &lt; bootstrap.fs example/fib.fs
6765"><pre><code>$ cat example/fib.fs
: fib dup 2 &lt; unless 1- dup recurse swap 1- recurse + then ;
20 fib . cr
$ ./planck &lt; bootstrap.fs example/fib.fs
6765
</code></pre></div>



<markdown-accessiblity-table><table>
<thead>
<tr>
<th>code</th>
<th>name</th>
<th>stack effect</th>
<th>semantics</th>
</tr>
</thead>
<tbody>
<tr>
<td>Q</td>
<td>quit</td>
<td>( n -- )</td>
<td>Exit the process</td>
</tr>
<tr>
<td>C</td>
<td>cell</td>
<td>( -- n )</td>
<td>The size of Cells</td>
</tr>
<tr>
<td>h</td>
<td>&amp;here</td>
<td>( -- a-addr )</td>
<td>The address of &#39;here&#39; cell</td>
</tr>
<tr>
<td>l</td>
<td>&amp;latest</td>
<td>( -- a-addr )</td>
<td>The address of &#39;latest&#39; cell</td>
</tr>
<tr>
<td>k</td>
<td>key</td>
<td>( -- c )</td>
<td>Read character</td>
</tr>
<tr>
<td>t</td>
<td>type</td>
<td>( c -- )</td>
<td>Print character</td>
</tr>
<tr>
<td>j</td>
<td>jump</td>
<td>( -- )</td>
<td>Unconditional branch</td>
</tr>
<tr>
<td>J</td>
<td>0jump</td>
<td>( n -- )</td>
<td>Jump if a == 0</td>
</tr>
<tr>
<td>f</td>
<td>find</td>
<td>( c -- xt )</td>
<td>Get execution token of c</td>
</tr>
<tr>
<td>x</td>
<td>execute</td>
<td>( xt -- ... )</td>
<td>Run the execution token</td>
</tr>
<tr>
<td>@</td>
<td>fetch</td>
<td>( a-addr -- w )</td>
<td>Load value from addr</td>
</tr>
<tr>
<td>!</td>
<td>store</td>
<td>( w a-addr -- )</td>
<td>Store value to addr</td>
</tr>
<tr>
<td>?</td>
<td>cfetch</td>
<td>( c-addr -- c )</td>
<td>Load byte from addr with sign extension</td>
</tr>
<tr>
<td>$</td>
<td>cstore</td>
<td>( c c-addr -- )</td>
<td>Store byte to addr</td>
</tr>
<tr>
<td>d</td>
<td>dfetch</td>
<td>( -- a-addr )</td>
<td>Get data stack pointer</td>
</tr>
<tr>
<td>D</td>
<td>dstore</td>
<td>( a-addr -- )</td>
<td>Set data stack pointer</td>
</tr>
<tr>
<td>r</td>
<td>rfetch</td>
<td>( -- a-addr )</td>
<td>Get return stack pointer</td>
</tr>
<tr>
<td>R</td>
<td>rstore</td>
<td>( a-addr -- )</td>
<td>Set return stack pointer</td>
</tr>
<tr>
<td>i</td>
<td>docol</td>
<td>( -- a-addr )</td>
<td>Get the code pointer of interpreter</td>
</tr>
<tr>
<td>e</td>
<td>exit</td>
<td>( -- )</td>
<td>Exit current function</td>
</tr>
<tr>
<td>L</td>
<td>lit</td>
<td>( -- n )</td>
<td>Load immediate</td>
</tr>
<tr>
<td>S</td>
<td>litstring</td>
<td>( -- c-addr )</td>
<td>Load string literal</td>
</tr>
<tr>
<td>+</td>
<td>add</td>
<td>( a b -- c )</td>
<td>c = (a + b)</td>
</tr>
<tr>
<td>-</td>
<td>sub</td>
<td>( a b -- c )</td>
<td>c = (a - b)</td>
</tr>
<tr>
<td>*</td>
<td>mul</td>
<td>( a b -- c )</td>
<td>c = (a * b)</td>
</tr>
<tr>
<td>/</td>
<td>divmod</td>
<td>( a b -- c d )</td>
<td>c = (a mod b), d = (a / b)</td>
</tr>
<tr>
<td>&amp;</td>
<td>and</td>
<td>( a b -- c )</td>
<td>c = (a &amp; b)</td>
</tr>
<tr>
<td>|</td>
<td>or</td>
<td>( a b -- c )</td>
<td>c = (a | b)</td>
</tr>
<tr>
<td>^</td>
<td>xor</td>
<td>( a b -- c )</td>
<td>c = (a ^ b)</td>
</tr>
<tr>
<td>&lt;</td>
<td>less</td>
<td>( a b -- c )</td>
<td>c = (a &lt; b)</td>
</tr>
<tr>
<td>u</td>
<td>uless</td>
<td>( a b -- c )</td>
<td>c = (a unsigned&lt; b)</td>
</tr>
<tr>
<td>=</td>
<td>equal</td>
<td>( a b -- c )</td>
<td>c = (a == b)</td>
</tr>
<tr>
<td>(</td>
<td>shl</td>
<td>( a b -- c )</td>
<td>c = a &lt;&lt; b (logical)</td>
</tr>
<tr>
<td>)</td>
<td>shr</td>
<td>( a b -- c )</td>
<td>c = a &gt;&gt; b (logical)</td>
</tr>
<tr>
<td>%</td>
<td>sar</td>
<td>( a b -- c )</td>
<td>c = a &gt;&gt; b (arithmetic)</td>
</tr>
<tr>
<td>v</td>
<td>argv</td>
<td>( -- a-addr u )</td>
<td>argv and argc</td>
</tr>
<tr>
<td>V</td>
<td>version</td>
<td>( -- c-addr )</td>
<td>Runtime infomation string</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/172570/104666244-c0c58800-5716-11eb-9798-847ea2fe76b8.jpeg"><img src="https://user-images.githubusercontent.com/172570/104666244-c0c58800-5716-11eb-9798-847ea2fe76b8.jpeg" alt="binary layout"/></a></p>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Implementation of runtime</th>
<th>build</th>
<th>test status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Handwritten ELF binary for i386-linux</td>
<td><code>make</code></td>
<td><a href="https://github.com/nineties/planckforth/actions/workflows/runtests-i386-linux-handwritten.yaml"><img src="https://github.com/nineties/planckforth/actions/workflows/runtests-i386-linux-handwritten.yaml/badge.svg" alt="testing i386-linux-handwritten"/></a></td>
</tr>
<tr>
<td>C</td>
<td><code>make c</code></td>
<td><a href="https://github.com/nineties/planckforth/actions/workflows/runtests-c.yaml"><img src="https://github.com/nineties/planckforth/actions/workflows/runtests-c.yaml/badge.svg" alt="testing c"/></a></td>
</tr>
<tr>
<td>Python 3.x</td>
<td><code>make python</code></td>
<td><a href="https://github.com/nineties/planckforth/actions/workflows/runtests-python.yaml"><img src="https://github.com/nineties/planckforth/actions/workflows/runtests-python.yaml/badge.svg" alt="testing python"/></a></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">See <a href="https://github.com/nineties/planckforth/wiki/Benchmarks">Wiki/Benchmarks</a></p>
</article></div></div>
  </body>
</html>
