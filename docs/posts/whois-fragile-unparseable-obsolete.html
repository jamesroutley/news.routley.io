<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.netmeister.org/blog/whois.html">Original</a>
    <h1>Whois: Fragile, Unparseable, Obsolete</h1>
    
    <div id="readability-page-1" class="page"><div width="75%">
    <tbody><tr>
      <td>
<p><small>January 9th, 2022</small></p>

<p>The <a href="https://en.wikipedia.org/wiki/WHOIS">WHOIS</a>
protocol is one of the older internet protocols
around.  It&#39;s infuriatingly simple, by and large
considered obsolete, and the data provided by it
unpredictable, unreliable, incomplete, and, of course,
still one of the corner stones of internet
operations.  In other words, it&#39;s the kind of thing I
like to waste my time on trying to understand.</p>

<p>Originally set up in the 1970s at the <em>Stanford
Research Institute Network Information Center</em>
(aka <em>SRI-NIC</em>) by the mother of the DNS and
overall ARPANET boss <a href="https://en.wikipedia.org/wiki/Elizabeth_J._Feinler">Elizabeth
J. Feinler</a>, WHOIS was first described in <a href="https://datatracker.ietf.org/doc/html/rfc812">RFC812</a>
(1982).  Based on the FINGER protocol, it was as dead
simple as you could imagine:</p>

<div><pre>Connect to the service host (SRI-NIC)
   TCP: service port 43 decimal
   NCP: ICP to socket 43 decimal, establishing two 8-bit connections

Send a single &#34;command line&#34;, ending with &lt;CRLF&gt;.

Receive information in response to the command line. 
</pre></div>

<p>Yep, that was it.  And that&#39;s still the full
protocol specification (now <a href="https://datatracker.ietf.org/doc/html/rfc3912">RFC3912</a>
(2004)).  Here, give it a try:</p>

<div><pre>$ telnet whois.iana.org 43
Trying 2620:0:2d0:200::59...
Connected to ianawhois.vip.icann.org.
Escape character is &#39;^]&#39;.
org
% IANA WHOIS server
% for more information on IANA, visit http://www.iana.org
% This query returned 1 object

domain:       ORG
[...]
</pre></div>

<p>Congratulations - you just spoke WHOIS!</p>

<p>The data you get back is intentionally not
structured and is designed to be <em>human-</em>, not
machine-readable (more on that a bit below).  It was
originally intended to provide contact information
including &#34;mailing address, telephone number, and
network mailbox&#34; &#34;for ARPANET users&#34; like so:</p>

<div><pre>Command line: dyer
Response:
   Dyer, David A. (DAD2)   DDYER@USC-ISIB  (213) 822-1511
   Dyer, Fred S. (FSD)  Dyer@RADC-MULTICS  (315) 330-7275
   Dyer, Mary K. (MARY)   DYER@SRI-NIC     (415) 859-4775
   Dyer, William R. (WRD)   WRDyer@RADC-MULTICS  (315) 330-7791

Command line: mary
Response:
   Dyer, Mary K. (MARY)          DYER@SRI-NIC
   SRI International
   Network Information Center
   Telecommunications Sciences Center
   333 Ravenswood Avenue
   Menlo Park, California 94025
   Phone: (415) 859-4775
</pre></div>

<p>And you thought the DNS was the phonebook of the
internet...</p>

<h3><a name="how-to-find"></a>How to find the
responsible WHOIS server</h3>

<p>When the internet grew too large for SRI-NIC to
continue functioning as the global phonebook, and
eventually with the transfer of the operation of the
DNS root to <a href="https://www.icann.org/">ICANN</a>, WHOIS also
became decentralized.  Information about the various
(and increasing number of) <a href="https://mytimeatrecurse.substack.com/p/tlds.html">TLDs</a> was provided logically by
the Regional Internet Registries (RIRs), registries,
and registrars.  Some of them run a so-called &#34;thick&#34;
server, which provides all the information; others are
&#34;thin&#34; servers, only providing the information of the
WHOIS server that <em>does</em> have the full
information.  Different TLDs, for example, may operate
in either mode, but the protocol does not provide any
means to differentiate the two.  In other words: if
you wanted to find out information about a domain,
you&#39;d have to know who the responsible registry is to
ask them.</p>

<p>How do you know what WHOIS server to query for a
given domain? Well, you just gotta know.  There&#39;s no
standardized way.  Some domains
use <a href="https://mytimeatrecurse.substack.com/p/dns-rrs.html#srv">SRV DNS records</a> as
suggested in <a href="https://datatracker.ietf.org/doc/html/draft-sanz-whois-srv-01">this
internet draft</a>:


</p><div><pre>$ host -t srv _nicname._tcp.co.uk
_nicname._tcp.co.uk has SRV record 0 0 43 whois.nic.uk.
$ host -t srv _nicname._tcp.arab
_nicname._tcp.arab has SRV record 10 10 0 your-dns-needs-immediate-attention.arab.
$ host -t srv _nicname._tcp.cpa
_nicname._tcp.cpa has SRV record 10 10 0 your-dns-needs-immediate-attention.cpa.
$ host -t srv _nicname._tcp.music
_nickname._tcp.music has SRV record 10 10 0 your-dns-needs-immediate-attention.music.
$ host -t srv _nicname._tcp.xn--fiqs8s
_nicname._tcp.中国 is an alias for wildcard.cnnic.cn.
$ host -t srv _nicname._tcp.xn--fiqz9s 
_nicname._tcp.中國 is an alias for wildcard.cnnic.cn.
$ host -t srv _nicname._tcp.xn--mxtq1m
_nicname._tcp.政府 has SRV record 10 10 0 your-dns-needs-immediate-attention.政府
$ host -t srv _nicname._tcp.xn--ngbrx
_nicname.tcp.عرب has SRV record 10 10 0 your-dns-needs-immediate-attention.عرب
$ </pre></div>

<p>...but that seems to function primarily as an
indicator of a TLD compromise: out of 1489 TLDs, only
nic.uk has a valid entry.  Instead, some TLDs use
<tt>&lt;tld&gt;.whois-servers.net</tt>, and the &#34;new&#34;
TLDs after 2003 are supposed to have
<tt>whois.nic.&lt;tld&gt;</tt>; ccTLDs pretty much all
do their own thing, why not. Hence, your <tt><a href="http://cvsweb.netbsd.org/bsdweb.cgi/src/usr.bin/whois/whois.c?rev=HEAD&amp;content-type=text/x-cvsweb-markup&amp;only_with_tag=MAIN">whois(1)</a></tt>
client likely contains some optimistic logic and a
number of hardcoded RIR WHOIS servers like this:</p>

<div><pre>#define	ANICHOST	&#34;whois.arin.net&#34;
#define	BNICHOST	&#34;whois.registro.br&#34;
#define	CNICHOST	&#34;whois.corenic.net&#34;
#define	DNICHOST	&#34;whois.nic.mil&#34;
#define	FNICHOST	&#34;whois.afrinic.net&#34;
#define	GNICHOST	&#34;whois.nic.gov&#34;
#define	IANAHOST	&#34;whois.iana.org&#34;
#define	INICHOST	&#34;whois.networksolutions.com&#34;
#define	LNICHOST	&#34;whois.lacnic.net&#34;
#define	MNICHOST	&#34;whois.ra.net&#34;
#define	NICHOST		&#34;whois.crsnic.net&#34;
#define	PDBHOST		&#34;whois.peeringdb.com&#34;
#define	PNICHOST	&#34;whois.apnic.net&#34;
#define	QNICHOST_TAIL	&#34;.whois-servers.net&#34;
#define	RNICHOST	&#34;whois.ripe.net&#34;
#define	RUNICHOST	&#34;whois.ripn.net&#34;
[...]
/*
 * If no country is specified determine the top level domain from the query
 * If the TLD is a number, query ARIN, otherwise, use  TLD.whois-server.net.
 * If the domain does not contain &#39;.&#39;, check to see if it is an NSI handle
 * (starts with &#39;!&#39;) or a CORE handle (COCO-[0-9]+ or COHO-[0-9]+) or an
 * ASN (starts with AS) or IPv6 address (contains &#39;:&#39;). Fall back to
 * NICHOST for the non-handle and non-IPv6 case.
 */
</pre></div>

<p>Otherwise, if you don&#39;t know the WHOIS server to
query, you can try your luck asking <a href="https://www.iana.org/help/whois">IANA</a>, which
runs a &#34;thick&#34; server for all TLDs.  It should return
to you the referral to the responsible WHOIS server,
which you can then ask for who might be responsible
for the final domain you care about:</p>

<div><pre>$ echo netmeister.org | nc whois.iana.org 43 | grep refer
refer:        whois.pir.org
$ echo netmeister.org | nc whois.pir.org 43 | grep refer
$ echo netmeister.org | nc whois.pir.org 43 | grep &#34;Registrar WHOIS Server&#34; 
Registrar WHOIS Server: whois.gandi.net
$ echo netmeister.org | nc whois.gandi.net 43  | grep Creation
Creation Date: 2000-04-24T02:15:22Z
$ 
</pre></div>

<p>Notice something?  When we ask IANA, we ask for
&#34;<tt>refer</tt>&#34;, but when we ask <a href="https://thenew.org/org-people/">PIR</a>, we need
to ask for &#34;<tt>Registrar WHOIS Server</tt>&#34;.  This is
because the WHOIS protocol does not specify the output
format of the data, nor what data should be provided.
At all.  It&#39;s all free form, unstructured ASCII text
-- if you&#39;re lucky, that is. (More on that (again) a
bit below.)</p>

<h3><a name="privacy"></a>Data Privacy</h3>

<p>But what data would you expect to be found in
WHOIS?  Since the early days, ICANN has had a
requirement for registries and registrars to
provide</p>

<blockquote><pre>unrestricted and public access to accurate and
complete WHOIS information, including registrant,
technical, billing, and administrative contact
information.
</pre>
<small><a href="https://whois.icann.org/en/policies#field-section-1">ICANN
Policies</a></small>
</blockquote>

<p>This includes the actual postal address, phone
numbers, and email addresses of the various contact
persons or departments (see above re &#34;phonebook&#34;).
Which of course is routinely abused by all sorts of
people, including by scammers, phishers, and for
general OSINT.  On the other hand, Law Enforcement
really wants this information to be readily
available, and as a geek with at least half a dozen
random domains registered, you are likely familiar
with the legal requirement to keep this information up
to date.</p>

<p>Quite obviously this poses a dilemma: the
information is required by ICANN to be openly
provided, but for a variety of reasons and privacy
concerns, you don&#39;t want your phone number and
address out there on the internet.  But more than just
a cosmetic concern, the ICANN requirement now does
indeed conflict with modern privacy laws, such as the
EU&#39;s <a href="https://en.wikipedia.org/wiki/General_Data_Protection_Regulation">GDPR</a>,
meaning all domains registered by European registries
are in violation of either GDPR or ICANN&#39;s
requirement.  Fun!</p>

<p>(ICANN <a href="https://gnso.icann.org/sites/default/files/file/field-file-attach/2016-12/iag-review-whois-conflicts-procedure-23may16-en.pdf">promised
not to take action against violators</a>, and
registries/registrars nowadays provide redacted
information to the public but promise to provide
detailed information upon &#34;legitimate
requests&#34;.)</p>

<h3><a name="data"></a>Data Format</h3>

<p>As I noted above, the data provided via WHOIS is
completely unstructured and undefined.  It is intended
for human consumption, and the service operator is
free to decide how to display the information.  Most
WHOIS servers use a simple &#34;<tt>key: value</tt>&#34; format,
but that&#39;s far from universal.  Similarly, different
servers use different methods to e.g., show that
certain pieces of information logically belong
together.</p>

<p>For example, consider the information returned by
the different WHOIS servers involved in a simple
lookup of this website:</p>

<div><pre>$ whois netmeister.org
% IANA WHOIS server
% for more information on IANA, visit
% http://www.iana.org
% This query returned 1 object

refer:        whois.pir.org

domain:       ORG

organisation: Public Interest Registry (PIR)
address:      11911 Freedom Drive 10th Floor,
address:      Suite 1000
address:      Reston, VA 20190
address:      United States

contact:      administrative
name:         Director of Operations, Compliance and Customer Support
organisation: Public Interest Registry (PIR)
address:      11911 Freedom Drive 10th Floor,
address:      Suite 1000
address:      Reston, VA 20190
address:      United States
phone:        +1 703 889 5778
fax-no:       +1 703 889 5779
e-mail:       ops@pir.org

[...]

# whois.pir.org

Domain Name: NETMEISTER.ORG
Registry Domain ID: D25516943-LROR
Registrar WHOIS Server: whois.gandi.net
Registrar URL: http://www.gandi.net
Updated Date: 2021-02-20T17:59:09Z
Creation Date: 2000-04-24T02:15:22Z

[...]

# whois.gandi.net

Domain Name: netmeister.org
[...]
Registry Registrant ID: REDACTED FOR PRIVACY
Registrant Name: REDACTED FOR PRIVACY
[...]
Registry Admin ID: REDACTED FOR PRIVACY
Admin Name: REDACTED FOR PRIVACY
[...]
Registry Tech ID: REDACTED FOR PRIVACY
Tech Name: REDACTED FOR PRIVACY
[...]
&gt;&gt;&gt;Last update of WHOIS database: 2022-01-09T00:16:58Z &lt;&lt;&lt;
</pre></div>

<p>Ok, so far, so good.  Different grouping, but
still, reasonably easy to parse.  Now compare this to
the following other queries returning results from
various WHOIS servers:</p>

<table>
  <tbody><tr>
    <td>

<div><pre>$ whois stevens.edu
# whois.educause.edu
Domain Name: STEVENS.EDU

Registrant:
        Stevens Institute of Technology
        Castle Point on Hudson
        Information Technology
        Hoboken, NJ 07030
        USA

Administrative Contact:
        Domain Name Administration
        Stevens Institute of Technology
        Information Technology
        Castle Point on the Hudson
        Hoboken, NJ 07030
        USA
        +1.2012165457
        webmaster@stevens.edu
[...]
</pre></div>
    </td>

    <td>
<div><pre>$ whois nic.tg
This is JWhoisServer serving ccTLD tg
Java Whois Server 0.4.1.3    (c) 2006 - 2015 Klaus
Zerwes zero-sys.net
All rights reserved.
Copyright &#34;NICTogo2 - http://www.nic.tg&#34;

Domain:.............nic.tg
Registrar:..........NETMASTER SARL
Activation:.........2021-11-11
Expiration:.........2030-06-26
Status:.............Activ&amp;eacute;
Contact Type:.......[PRIVEE]
Last Name:..........[PRIVEE]
First Name:.........[PRIVEE]
Address:............[PRIVEE]
Tel:................[PRIVEE]
Fax:................[PRIVEE]
e-mail:.............[PRIVEE]
Name Server (DB):...ns1.nic.tg
Name Server (DB):...ns2.nic.tg
</pre></div>
    </td>
  </tr>
  <tr>
    <td>

<div><pre>$ whois norid.no
[...]
Domain Information

NORID Handle...............: NIC311D-NORID
Domain Name................: nic.no
Registrar Handle...........: REG1-NORID
Tech-c Handle..............: NH55R-NORID
Tech-c Handle..............: NS7R-NORID
DNSSEC.....................: Signed

Additional information:
Created:         2004-02-25
Last updated:    2021-02-25
</pre></div>
    </td>
    <td>
<div><pre>$ whois jprs.jp
Domain Information: [ドメイン情報]
[Domain Name]                   JPRS.JP

[登録者名]                       株式会社日本レジストリサービス
[Registrant]                    Japan Registry Services Co.,Ltd.

[Name Server]                   ns1.jprs.jp
[Name Server]                   ns2.jprs.jp
[Name Server]                   ns3.jprs.jp
[Name Server]                   ns4.jprs.jp
[Signing Key]                   59551 8 2 (
                                F7700A9A545DD57075E545AFE2D823CB
                                90A2C9A1305E1696C61F91BEA26FA137 )
</pre></div>
    </td>
  </tr>
</tbody></table>

<p>Given how useful the information in WHOIS can be,
it&#39;s no surprise that there are many businesses
offering proprietary services to monetize the munging
of the public information into a data format that&#39;s
easy to process in an automated fashion, such as in
XML or JSON.  As you can tell from the above examples,
it&#39;s fairly obvious how the information belongs
together <em>for a human</em>: Humans are really,
really good at identifying patterns visually, and you
can all look at the output and immediately see what
data represents what information, but trying to
convince a computer to understand all these different
formats is a major PITA and exactly what these
services build their profit model on.</p>

<p>Paying for an online service to access
<em>public</em> data is a bit annoying, so I wrote a
tool to JSONify WHOIS data: <a href="https://github.com/jschauma/jswhois">jswhois(1)</a>.
This tool will attempt to turn the unstructured,
human-readable output above into structured JSON as
shown below:</p>

<table>
  <tbody><tr>
    <td>

<div><pre>$ jswhois stevens.edu | jq
{
  &#34;chain&#34;: [
    &#34;whois.iana.org&#34;,
    &#34;whois.educause.edu&#34;
  ],
  &#34;query&#34;: &#34;stevens.edu&#34;,
  &#34;whois.educause.edu&#34;: {
    &#34;Administrative Contact&#34;: [
      &#34;Domain Name Administration&#34;,
      &#34;Stevens Institute of Technology&#34;,
      &#34;Information Technology&#34;,
      &#34;Castle Point on the Hudson&#34;,
      &#34;Hoboken, NJ 07030&#34;,
      &#34;USA&#34;,
      &#34;+1.2012165457&#34;,
      &#34;webmaster@stevens.edu&#34;
    ],
[...]
</pre></div>
    </td>

    <td>
<div><pre>$ jswhois nic.tg | jq
{
  &#34;chain&#34;: [
    &#34;whois.iana.org&#34;,
    &#34;whois.nic.tg&#34;
  ],
  &#34;query&#34;: &#34;nic.tg&#34;,
  &#34;whois.nic.tg&#34;: {
    &#34;Activation&#34;: &#34;2021-11-11&#34;,
    &#34;Address&#34;: &#34;[PRIVEE]&#34;,
    &#34;Domain&#34;: &#34;nic.tg&#34;,
    &#34;Expiration&#34;: &#34;2030-06-26&#34;,
    &#34;First Name&#34;: &#34;[PRIVEE]&#34;,
    &#34;Last Name&#34;: &#34;[PRIVEE]&#34;,
    &#34;Name Server (DB)&#34;: [
      &#34;ns1.nic.tg&#34;,
      &#34;ns2.nic.tg&#34;
    ],
[...]
</pre></div>
    </td>
  </tr>
  <tr>
    <td>

<div><pre>$ jswhois norid.no | jq
{
  &#34;chain&#34;: [
    &#34;whois.iana.org&#34;,
    &#34;whois.norid.no&#34;
  ],
  &#34;query&#34;: &#34;norid.no&#34;,
  &#34;whois.norid.no&#34;: {
    &#34;Algorithm      1&#34;: &#34;8&#34;,
    &#34;Created&#34;: &#34;1999-11-15&#34;,
    &#34;DNSSEC&#34;: &#34;Signed&#34;,
    &#34;DS Key Tag     1&#34;: &#34;44384&#34;,
    &#34;Digest         1&#34;: &#34;ac8f61c8a538d1e6dbfd98fd86d788b0222994a8842ebabc0df159b354a09f8d&#34;,
    &#34;Digest Type    1&#34;: &#34;2&#34;,
    &#34;Domain Name&#34;: &#34;norid.no&#34;,
    &#34;Last updated&#34;: &#34;2021-12-14&#34;,
    &#34;NORID Handle&#34;: &#34;NOR18456D-NORID&#34;,
    &#34;Name Server Handle&#34;: [
      &#34;AUTH681H-NORID&#34;,
      &#34;AUTH682H-NORID&#34;,
      &#34;Y4H-NORID&#34;,
      &#34;Z11H-NORID&#34;
    ],
  }
[...]
</pre></div>
    </td>
    <td>
<div><pre>$ jswhois jprs.jp | jq
{
  &#34;chain&#34;: [
    &#34;whois.iana.org&#34;,
    &#34;whois.jprs.jp&#34;
  ],
  &#34;query&#34;: &#34;jprs.jp&#34;,
  &#34;whois.jprs.jp&#34;: {
    &#34;Domain Information&#34;: {
      &#34;Domain Information&#34;: &#34;[ドメイン情報]&#34;,
      &#34;[Domain Name]&#34;: &#34;JPRS.JP&#34;,
      &#34;[Name Server]&#34;: [
        &#34;ns1.jprs.jp&#34;,
        &#34;ns2.jprs.jp&#34;,
        &#34;ns3.jprs.jp&#34;,
        &#34;ns4.jprs.jp&#34;
      ],
      &#34;[Registrant]&#34;: &#34;Japan Registry Services Co.,Ltd.&#34;,
      &#34;[Signing Key]&#34;: [
        &#34;59551 8 2 (&#34;,
        &#34;F7700A9A545DD57075E545AFE2D823CB&#34;,
        &#34;90A2C9A1305E1696C61F91BEA26FA137 )&#34;
      ],

[...]
</pre></div>
    </td>
  </tr>
</tbody></table>

<p>This is tedious, sure, but what&#39;s even more
annoying is that it <em>still</em> is only of limited
usefulness: aside from the lack of a data
<em>format</em>, there is also no standard
specification of <em>what</em> data is to be provided,
and for the data that <em>is</em> required at least by
ICANN, there is no requirement or specification of
<em>how</em> that data is to be named.</p>

<p>That is, if you want to use <tt><a href="https://github.com/jschauma/jswhois">jswhois(1)</a></tt>
to return to you the email address of the
administrative contact of the domain in question, then
you still have to know what the fields returned by the
registrar&#39;s WHOIS server are named.  Commercial
services may attempt to reformat or rename fields so
that you have consistent keys to extract, but will
that work for <em>all</em> domains?  How many
different WHOIS formats are there?</p>

<h3><a name="registries"></a>Registrars and Registries</h3>

<p>Looking at a subset of TLDs from <a href="https://mytimeatrecurse.substack.com/p/tlds.html">my previous adventure</a>, I found a
total of <b>1021 distinct WHOIS servers for 1489
TLDs</b>.  Here&#39;s the top ten breakdown of which WHOIS
servers are responsible for the most number of
TLDs:</p>

<div><pre> 244 whois.iana.org
  67 whois.afilias-srs.net
  46 whois.nic.google
  24 whois.uniregistry.net
  16 whois.registry.in
  14 whois.nic.gmo
   8 whois.gtld.knet.cn
   7 whois.teleinfo.cn
   6 whois.gtlds.nic.br
   5 whois.publicinterestregistry.net
</pre></div>

<p>IANA, <a href="https://en.wikipedia.org/wiki/Afilias">Afilias</a>,
and <a href="https://en.wikipedia.org/wiki/Uniregistry">Uniregistry</a>
not surprisingly manage the largest number of TLDs,
and as you may remember from the new-TLD-landrush,
Google had <a href="https://twitter.com/jschauma/status/1426012011247308808">applied
for over 100 TLDs</a> and today runs 46 TLDs. (The
largest number of TLDs registered by a single company
goes to <a href="https://en.wikipedia.org/wiki/Donuts_(company)">Donuts
Inc.</a> with 248, but they run a separate WHOIS
server for each of those TLDs at
<tt>whois.nic.&lt;tld&gt;</tt>.)</p>

<p>But that&#39;s only <em>TLDs</em>.  There are over 2500
registrars <a href="https://www.icann.org/en/accredited-registrars?sort-direction=asc&amp;sort-param=name&amp;page=1">accredited
by ICANN</a>, of which e.g., <a href="https://en.wikipedia.org/wiki/GoDaddy">GoDaddy</a>,
currently the largest with over 72 million (!)
domains, is just one.  In theory, for each of the
millions of second-level domains, there might be a
different WHOIS server responsible, each with its own
human-readable output format.</p>

<h3><a name="data-found"></a>Data in WHOIS</h3>

<p>The data found in WHOIS varies from registry to
registry, not only in structure (as shown above), but
of course also in content.  Some include nameserver IP
addresses, some don&#39;t.  Some include DNSSEC
information, others don&#39;t.
I even found an (expired) x509 cert in the
WHOIS data for <tt>2001:dcd::/32</tt>.</p>

<p>If you search for IP addresses or CIDRs, you get
back rather different data than if you search for
domain names.  APNIC, RIPE, and AFRINIC, for example,
even give you some routing and geolocation
information:</p>

<div><pre>$ jswhois 2001:dd8:9:2::101:61 | jq
{
  &#34;query&#34;: &#34;2001:dd8:9:2::101:61&#34;,
  &#34;whois.apnic.net&#34;: {
    &#34;inet6num&#34;: {
      &#34;geoloc&#34;: &#34;-27.473058 153.014208&#34;,
      &#34;inet6num&#34;: &#34;2001:dd8:8::/45&#34;,
[...]
      }
    &#34;route6&#34;: {
      &#34;country&#34;: &#34;AU&#34;,
      &#34;descr&#34;: &#34;APNIC Network&#34;,
      &#34;last-modified&#34;: &#34;2018-11-20T03:36:54Z&#34;,
      &#34;mnt-by&#34;: &#34;MAINT-APNIC-IS-AP&#34;,
      &#34;origin&#34;: &#34;AS4608&#34;,
      &#34;route6&#34;: &#34;2001:dd8:9::/48&#34;,
      &#34;source&#34;: &#34;APNIC&#34;
    }
[...]
</pre></div>

<p>Given the loose specification, you can use the
WHOIS protocol and server for just about any data.  <a href="https://team-cymru.com/community-services/ip-asn-mapping/#whois">Team
Cymru</a>, for example, lets you look up AS numbers
for the given IP addresses using WHOIS:</p>

<div><pre>$ whois -h whois.cymru.com 2001:470:30:84:e276:63ff:fe72:3900
AS      | IP                                       | AS Name
2033    | 2001:470:30:84:e276:63ff:fe72:3900       | PANIX, US
</pre></div>
<p>And as you&#39;ve no doubt noticed, some international
WHOIS servers may return data to you in non-ASCII
charsets, such as e.g., <tt>whois.kr</tt>, or
<tt>whois.jprs.jp</tt>.  How well do the various
WHOIS API services handle what effectively amounts to
random data that may be returned? I wonder...</p>

<div><pre>$ whois -h whois.netmeister.org log4j

 ___________________________________________________ 
&lt; ${jndi:ldap://www.netmeister.org/blog/whois.html} &gt;
 --------------------------------------------------- 
        \  ^___^
         \ (ooo)\_______
           (___)\       )\/\
                ||----w |
                ||     ||
</pre></div>

<h3><a name="whowas"></a>Old and busted...</h3>

<p>Since the data in WHOIS is unpredictable (who knows
what data is returned to you and what the format might
be), unreliable (who knows if the data you&#39;re
looking for, if it is present at all, is up to date),
difficult to discover (bouncing from IANA along
unpredictable, unreliable referral entries or betting
on a few hard-coded servers), possibly available via
different mechanisms (besides the standard TCP port
43, several WHOIS servers provide an HTTP API
endpint), and often obscured or redacted (e.g., due to
GDPR, but several WHOIS servers also require
registration before either TCP port 43 or API access
is granted)... why haven&#39;t we replaced it with
Something Better(tm)?</p>

<p>There were some attempts to overhaul WHOIS, like
the &#34;Referral Whois&#34; protocol (RWhois, <a href="https://datatracker.ietf.org/doc/html/rfc2167">RFC2167</a>)
or the now obsolete &#34;<a href="https://en.wikipedia.org/wiki/WHOIS%2B%2B">WHOIS++</a>&#34;,
but it seems like one of those things everybody
depends on, so changing it isn&#39;t going to be easy.</p>

<p>ICANN decided years ago to replace WHOIS with work
<a href="https://whois.icann.org/en/whats-horizon">dating
back to 2012</a>, and the &#34;<a href="https://www.icann.org/rdap">Registration Data Access
Protocol</a> (RDAP, <a href="https://datatracker.ietf.org/doc/html/rfc9082">RFC9082</a>) certainly
seems like a <em>much</em> better alternative.  RDAP
is RESTful and <a href="https://datatracker.ietf.org/doc/html/rfc7483">standardized</a>
based on an <a href="https://datatracker.ietf.org/doc/html/rfc7485">analysis
by the IETF of the TLD WHOIS server responses</a>;
since 2019, ICANN requires registrars and registries
to implement an RDAP service.</p>

<p>Fully replacing WHOIS does, however, not yet seem
to be on the horizon, and we&#39;re still relying on what
started out as perhaps the simplest possible protocol
intended for human consumption.  Sometimes the
internet moves really slowly, and all I can hope is
that nobody comes along and tries to put it on the
blockchain...</p>

<p><small>January 9th, 2022</small></p>

<hr/>

<p><small>Links:</small></p>

<ul>
<li><small><a href="https://twitter.com/jschauma/status/1480391335634997248">This blog post as a Twitter thread</a></small></li>
<li><small><a href="https://github.com/jschauma/jswhois">jswhois(1) -- a tool to turn WHOIS results into json</a></small></li>
<li><small><a href="https://mytimeatrecurse.substack.com/p/tlds.html">TLDs -- Putting the &#39;.fun&#39; in the top of the DNS</a></small></li>
<li><small><a href="https://mytimeatrecurse.substack.com/p/dns-rrs.html">(All) DNS Resource Records</a></small></li>
</ul>

<p><small>References:</small></p>

<ul>
<li><small><a href="https://datatracker.ietf.org/doc/html/rfc3912">WHOIS Protocol Specification (RFC3912)</a></small></li>
<li><small><a href="https://www.arin.net/resources/registry/whois/rws/cli/">ARIN whois command reference</a></small></li>
<li><small><a href="https://whois.icann.org/en/about-whois">ICANN WHOIS information</a></small></li>
<li><small><a href="https://team-cymru.com/community-services/ip-asn-mapping/#whois">Team Cymru IP to ASN mapping using WHOIS</a></small></li>
</ul>

      </td>
    </tr>
  </tbody></div></div>
  </body>
</html>
