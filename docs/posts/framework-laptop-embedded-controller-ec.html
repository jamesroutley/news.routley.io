<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/FrameworkComputer/EmbeddedController">Original</a>
    <h1>Framework Laptop Embedded Controller (EC)</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<h2 dir="auto"><a id="user-content-introduction" aria-hidden="true" href="#introduction"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Introduction</h2>
<p dir="auto">This project holds the code used for the Framework Laptop Embedded Controller.</p>
<h2 dir="auto"><a id="user-content-warning" aria-hidden="true" href="#warning"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Warning</h2>
<p dir="auto">The Embedded Controller on your Framework Laptop handles low level functions, including power sequencing the system. Modifying the EC code can cause your system to not power on or boot or cause damage to the mainboard, battery, or other parts of the system or devices attached to the system. <strong>Hardware damage caused by EC firmware modifications would not be covered under the Framework Limited Warranty.</strong></p>
<h2 dir="auto"><a id="user-content-building" aria-hidden="true" href="#building"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building</h2>
<h3 dir="auto"><a id="user-content-environment-configuration" aria-hidden="true" href="#environment-configuration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Environment Configuration</h3>
<p dir="auto">The Framework Laptop EC code can be built easily outside the Chromium development environment as a standalone project with a minimal set of tools.</p>
<p dir="auto">On Ubuntu you can install the development tools easily.</p>
<div data-snippet-clipboard-copy-content="sudo apt install gcc-arm-none-eabi libftdi1-dev"><pre><code>sudo apt install gcc-arm-none-eabi libftdi1-dev
</code></pre></div>
<h2 dir="auto"><a id="user-content-framework-laptop-ec-for-intel-11th-gen-core-processors" aria-hidden="true" href="#framework-laptop-ec-for-intel-11th-gen-core-processors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Framework Laptop EC for Intel 11th Gen Core Processors</h2>
<p dir="auto">Building the project</p>
<div data-snippet-clipboard-copy-content="make BOARD=hx20 CROSS_COMPILE=arm-none-eabi-"><pre><code>make BOARD=hx20 CROSS_COMPILE=arm-none-eabi-
</code></pre></div>
<p dir="auto">The output artifact is <code>build/hx20/ec.bin</code> which can be flashed to the EC SPI flash ROM.</p>
<h3 dir="auto"><a id="user-content-ec-flash-configuration" aria-hidden="true" href="#ec-flash-configuration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>EC Flash configuration</h3>
<p dir="auto">When flashing the EC for Framework Laptops with Intel 11th Gen Core Processors, do not erase or overwrite the sectors 0x3C000 to 0x3FFFF, or 0x79000 to 0x7FFFF.</p>
<p dir="auto">Currently the EC only runs from the ro region.</p>
<div data-snippet-clipboard-copy-content="00000000:00000fff bootsector
00001000:00039fff lfwro
00040000:00078fff rw"><pre><code>00000000:00000fff bootsector
00001000:00039fff lfwro
00040000:00078fff rw
</code></pre></div>
<h2 dir="auto"><a id="user-content-ec-background-information" aria-hidden="true" href="#ec-background-information"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>EC background information</h2>
<p dir="auto">The EC is a MEC1521H-B0-I-SZ WFBGA144 which has 256kB of RAM.</p>
<p dir="auto">Most changes are limited to the following folders, however there are some modifications in common.</p>

<h3 dir="auto"><a id="user-content-ec-boot-process" aria-hidden="true" href="#ec-boot-process"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>EC Boot process</h3>
<p dir="auto">Note that the EC has a checksum and header verification of the EC code image. Arbitarily modifying code, for example with a reverse engineering tool will cause the EC to fail to boot. Compiling the code from source will correctly generate the required checksum information to allow the EC to boot.</p>
<h3 dir="auto"><a id="user-content-ec-debug" aria-hidden="true" href="#ec-debug"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>EC Debug</h3>
<p dir="auto">The EC has debug header in the upper right corner of the Mainboard next to the on-board power button.  This is the 10 pin EC debug connector JECDB. Pin 1 is nearest the power button. The EC is configured for 2 wire SWD.</p>
<table>
<thead>
<tr>
<th>Pin</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>EC_VCC_3.3</td>
</tr>
<tr>
<td>2</td>
<td>TDI</td>
</tr>
<tr>
<td>3</td>
<td>TMS</td>
</tr>
<tr>
<td>4</td>
<td>CLK</td>
</tr>
<tr>
<td>5</td>
<td>TDO</td>
</tr>
<tr>
<td>6</td>
<td>UART_TX</td>
</tr>
<tr>
<td>7</td>
<td>UART_RX</td>
</tr>
<tr>
<td>8</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td>EC_RESETI</td>
</tr>
<tr>
<td>10</td>
<td>GND</td>
</tr>
</tbody>
</table>
<h2 dir="auto"><a id="user-content-background" aria-hidden="true" href="#background"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Background</h2>
<p dir="auto">The Framework Laptop EC is based upon the Google Chromium EC repository: <a href="https://chromium.googlesource.com/chromiumos/platform/ec" rel="nofollow">https://chromium.googlesource.com/chromiumos/platform/ec</a>. We upstream common features where they fit into the design decisions of Chrome OS. However, there are a number of features and changes that will be unlikely to be upstreamed because they are unnecessary for Chrome OS operation or do not fit the philosophy of Chrome OS.</p>
<p dir="auto">For example, we implement memory mapped regions that are not used in Chrome OS such as the UCSI driver.</p>
<p dir="auto">The remainder of this README file is directly from Google&#39;s Chromium EC project.</p>
<hr/>

<p dir="auto">[TOC]</p>
<h2 dir="auto"><a id="user-content-introduction-1" aria-hidden="true" href="#introduction-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Introduction</h2>
<p dir="auto">The Chromium OS project includes open source software for embedded controllers
(EC) used in recent ARM and x86 based Chromebooks. This software includes a
lightweight, multitasking OS with modules for power sequencing, keyboard
control, thermal control, battery charging, and verified boot. The EC software
is written in C and supports <a href="https://chromium.googlesource.com/chromiumos/platform/ec/+/master/chip/" rel="nofollow">a variety of micro-controllers</a>.</p>
<p dir="auto">This document is a guide to help make you familiar with the EC code, current
features, and the process for submitting code patches.</p>
<p dir="auto">For more see the Chrome OS Embedded Controller
<a href="https://docs.google.com/presentation/d/1Xa_Z6SjW-soPvkugAR8__TEJFrJpzoZUa9HNR14Sjs8/pub?start=false&amp;loop=false&amp;delayms=3000" rel="nofollow">presentation</a>
and <a href="http://youtu.be/Ie7LRGgCXC8" rel="nofollow">video</a> from the
<a href="http://dev.chromium.org/chromium-os/2014-firmware-summit" rel="nofollow">2014 Firmware Summit</a>.</p>
<h2 dir="auto"><a id="user-content-what-you-will-need" aria-hidden="true" href="#what-you-will-need"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>What you will need</h2>
<ol dir="auto">
<li>A Chromebook with a compatible EC. This includes the Samsung Chromebook
(XE303C12) and all Chromebooks shipped after the Chromebook Pixel 2013
(inclusive). See the
<a href="http://dev.chromium.org/chromium-os/developer-information-for-chrome-os-devices" rel="nofollow">Chrome OS devices</a>
page for a list.</li>
<li>A Linux development environment. Ubuntu 14.04 Trusty (x86_64) is well
supported. Linux in a VM may work if you have a powerful host machine.</li>
<li>A <a href="http://dev.chromium.org/chromium-os/servo" rel="nofollow">servo debug board</a> (and
header) is highly recommended for serial console and JTAG access to the EC.</li>
<li>A sense of adventure!</li>
</ol>
<h2 dir="auto"><a id="user-content-terminology" aria-hidden="true" href="#terminology"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Terminology</h2>
<h3 dir="auto"><a id="user-content-ec" aria-hidden="true" href="#ec"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>EC</h3>
<p dir="auto">EC (aka Embedded Controller) can refer to many things in the Chrome OS
documentation due to historical reasons. If you just see the term &#34;EC&#34;, it
probably refers to &#34;the&#34; EC (i.e. the first one that existed). Most Chrome OS
devices have an MCU, known as &#34;the EC&#34; that controls lots of things (key
presses, turning the AP on/off). The OS that was written for &#34;the&#34; EC is now
running on several different MCUs on Chrome OS devices with various tweaks
(e.g. the FPMCU, the touchpad one that can do palm rejection, etc.). It&#39;s quite
confusing, so try to be specific and use terms like FPMCU to distinguish the
fingerprint MCU from &#34;the EC&#34;.</p>
<p dir="auto">See the <a href="https://github.com/FrameworkComputer/EmbeddedController/blob/hx20/docs/ec_terms.md">EC Acronyms and Technologies</a> for a more complete
glossary.</p>
<h2 dir="auto"><a id="user-content-getting-the-ec-code" aria-hidden="true" href="#getting-the-ec-code"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting the EC code</h2>
<p dir="auto">The code for the EC is open source and is included in the Chromium OS
development environment (<code>~/trunk/src/platform/ec/&lt;/code&gt;</code>).
See<a href="http://dev.chromium.org/chromium-os/quick-start-guide" rel="nofollow"> http://www.chromium.org/chromium-os/quick-start-guide</a>
for build setup instructions. If you want instant gratification, you can fetch
the source code directly. However, you will need the tool-chain provided by the
Chromium OS development environment to build a binary.</p>
<div data-snippet-clipboard-copy-content="git clone https://chromium.googlesource.com/chromiumos/platform/ec"><pre>git clone https://chromium.googlesource.com/chromiumos/platform/ec</pre></div>
<p dir="auto">The source code can also be browsed on the web at:</p>
<p dir="auto"><a href="https://chromium.googlesource.com/chromiumos/platform/ec/" rel="nofollow">https://chromium.googlesource.com/chromiumos/platform/ec/</a></p>
<h2 dir="auto"><a id="user-content-code-overview" aria-hidden="true" href="#code-overview"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Code Overview</h2>
<p dir="auto">The following is a quick overview of the top-level directories in the EC
repository:</p>
<p dir="auto"><strong>baseboard</strong> - Code and configuration details shared by a collection of board
variants. Tightly linked with the <code>board</code> directory described below.</p>
<p dir="auto"><strong>board</strong> - Board specific code and configuration details. This includes the
GPIO map, battery parameters, and set of tasks to run for the device.</p>
<p dir="auto"><strong>build</strong> - Build artifacts are generated here. Be sure to delete this and
rebuild when switching branches and before &#34;emerging&#34; (see Building an EC binary
below). make clobber is a convenient way to clean up before building.</p>
<p dir="auto"><strong>chip</strong> - IC specific code for interfacing with registers and hardware blocks
(adc, jtag, pwm, uart etc…)</p>
<p dir="auto"><strong>core</strong> - Lower level code for task and memory management.</p>
<p dir="auto"><strong>common</strong> - A mix of upper-level code that is shared across boards. This
includes the charge state machine, fan control, and the keyboard driver (among
other things).</p>
<p dir="auto"><strong>driver</strong> - Low-level drivers for light sensors, charge controllers,
I2C/onewire LED controllers, and I2C temperature sensors.</p>
<p dir="auto"><strong>include</strong> - Header files for core and common code.</p>
<p dir="auto"><strong>util</strong> - Host utilities and scripts for flashing the EC. Also includes
“ectool” used to query and send commands to the EC from userspace.</p>
<p dir="auto"><strong>test</strong> - Unit tests for EC components. These can be run locally in
a mock &#34;host&#34; environment or compiled for a target board.
If building for a target board, the test must be flashed and
run manually on the device.
All unit tests and fuzzers are build/run using the local
host environment during a <code>buildall</code>.
To run all unit tests locally, run <code>make runhosttests -j</code>.
To build a specific unit test for a specific board, run
<code>make test-&lt;test_name&gt; BOARD=&lt;board_name&gt;</code>.
Please contribute new tests if writing new functionality.
Please run <code>make help</code> for more detail.</p>
<p dir="auto"><strong>fuzz</strong> - Fuzzers for EC components. These fuzzers are expected to
run in the mock host environment. They follow the same rules
as unit tests, as thus use the same commands to build and run.</p>
<h2 dir="auto"><a id="user-content-firmware-branches" aria-hidden="true" href="#firmware-branches"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Firmware Branches</h2>
<p dir="auto">Each Chrome device has a firmware branch created when the read-only firmware is
locked down prior to launch. This is done so that updates can be made to the
read-write firmware with a minimal set of changes from the read-only. Some
Chrome devices only have build targets on firmware branches and not on
cros/master. Run “<code>git branch -a | grep firmware</code>” to locate the firmware branch
for your board. Note that for devices still under development, the board
configuration may be on the branch for the platform reference board.</p>
<p dir="auto">To build EC firmware on a branch, just check it out and build it:</p>
<div data-snippet-clipboard-copy-content="git checkout cros/firmware-falco_peppy-4389.B"><pre>git checkout cros/firmware-falco_peppy-4389.B</pre></div>
<p dir="auto">To make changes on a branch without creating a whole new development environment
(chroot), create a local tracking branch:</p>
<div data-snippet-clipboard-copy-content="git branch --track firmware-falco_peppy-4389.B cros/firmware-falco_peppy-4389.B

git checkout firmware-falco_peppy-4389.B

make clobber

# &lt;make changes, test, and commit them&gt;

repo upload --cbr .

# (The --cbr means &#34;upload to the current branch&#34;)"><pre>git branch --track firmware-falco_peppy-4389.B cros/firmware-falco_peppy-4389.B

git checkout firmware-falco_peppy-4389.B

make clobber

<span><span>#</span> &lt;make changes, test, and commit them&gt;</span>

repo upload --cbr <span>.</span>

<span><span>#</span> (The --cbr means &#34;upload to the current branch&#34;)</span></pre></div>
<p dir="auto">Here is a useful command to see commit differences between branches (change the
branch1...branch2 as needed):</p>
<div data-snippet-clipboard-copy-content="git log --left-right --graph --cherry-pick --oneline branch1...branch2"><pre>git log --left-right --graph --cherry-pick --oneline branch1...branch2</pre></div>
<p dir="auto">For example, to see the difference between cros/master and the HEAD of the
current branch:</p>
<div data-snippet-clipboard-copy-content="git log --left-right --graph --cherry-pick --oneline cros/master...HEAD

# Note: Use three dots “...” or it won’t work!"><pre>git log --left-right --graph --cherry-pick --oneline cros/master...HEAD

<span><span>#</span> Note: Use three dots “...” or it won’t work!</span></pre></div>
<h2 dir="auto"><a id="user-content-building-an-ec-binary" aria-hidden="true" href="#building-an-ec-binary"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building an EC binary</h2>
<p dir="auto">Note: The EC is normally built from within the Chromium OS development chroot to
use the correct toolchain.</p>
<p dir="auto">Building directly from the EC repository:</p>
<div data-snippet-clipboard-copy-content="cros_sdk
cd ~/trunk/src/platform/ec
make -j BOARD=&lt;boardname&gt;"><pre>cros_sdk
<span>cd</span> <span>~</span>/trunk/src/platform/ec
make -j BOARD=<span>&lt;</span>boardname<span>&gt;</span></pre></div>
<p dir="auto">Where <strong></strong> is replaced by the name of the board you want to build an
EC binary for. For example, the boardname for the Chromebook Pixel is “link”.
The make command will generate an EC binary at <code>build/&lt;boardname&gt;/ec.bin</code>. The
<code>-j</code> tells make to build multi-threaded which can be much faster on a multi-core
machine.</p>
<h3 dir="auto"><a id="user-content-building-via-emerge-the-build-file-used-when-you-build-chrome-os" aria-hidden="true" href="#building-via-emerge-the-build-file-used-when-you-build-chrome-os"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building via emerge (the build file used when you build Chrome OS):</h3>
<p dir="auto">(optional) Run this command if you want to build from local source instead of
the most recent stable version:</p>
<div data-snippet-clipboard-copy-content="cros_workon-&lt;boardname&gt; start chromeos-ec"><pre>cros_workon-<span>&lt;</span>boardname<span>&gt;</span> start chromeos-ec</pre></div>
<p dir="auto">Build the EC binary:</p>
<div data-snippet-clipboard-copy-content="emerge-&lt;boardname&gt; chromeos-ec"><pre><code>emerge-&lt;boardname&gt; chromeos-ec
</code></pre></div>
<p dir="auto">Please be careful if doing both local <code>make</code>s and running emerge. The emerge can
pick up build artifacts from the build subdirectory. It’s best to delete the
build directory before running emerge with <code>make clobber</code>.</p>
<p dir="auto">The generated EC binary from emerge is found at:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ /build/&lt;boardname&gt;/firmware/ec.bin"><pre><code>(chroot) $ /build/&lt;boardname&gt;/firmware/ec.bin
</code></pre></div>
<p dir="auto">The ebuild file used by Chromium OS is found
<a href="https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay/+/master/chromeos-base/chromeos-ec/chromeos-ec-9999.ebuild" rel="nofollow">here</a>:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ ~/trunk/src/third_party/chromiumos-overlay/chromeos-base/chromeos-ec/chromeos-ec-9999.ebuild"><pre>(chroot) $ <span>~</span>/trunk/src/third_party/chromiumos-overlay/chromeos-base/chromeos-ec/chromeos-ec-9999.ebuild</pre></div>
<h2 dir="auto"><a id="user-content-flashing-an-ec-binary-to-a-board" aria-hidden="true" href="#flashing-an-ec-binary-to-a-board"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Flashing an EC binary to a board</h2>
<h3 dir="auto"><a id="user-content-flashing-via-the-servo-debug-board" aria-hidden="true" href="#flashing-via-the-servo-debug-board"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Flashing via the servo debug board</h3>
<p dir="auto">If you get an error, you may not have set up the dependencies for servo
correctly. The EC (on current Chromebooks) must be powered either by external
power or a charged battery for re-flashing to succeed. You can re-flash via
servo even if your existing firmware is bad.</p>
<div data-snippet-clipboard-copy-content="(chroot) $ sudo emerge openocd"><pre>(chroot) $ sudo emerge openocd</pre></div>
<div data-snippet-clipboard-copy-content="(chroot) $ ~/trunk/src/platform/ec/util/flash_ec --board=&lt;boardname&gt; [--image=&lt;path/to/ec.bin&gt;]"><pre>(chroot) $ <span>~</span>/trunk/src/platform/ec/util/flash_ec --board=<span>&lt;</span>boardname<span>&gt;</span> [--image<span>=&lt;</span>path/to/ec.bin<span>&gt;</span>]</pre></div>
<p dir="auto">Note: This command will fail if write protect is enabled.</p>
<p dir="auto">If you build your own EC firmware with the <code>make BOARD=&lt;boardname&gt;</code> command the
firmware image will be at:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ ~/trunk/src/platform/ec/build/&lt;boardname&gt;/ec.bin"><pre>(chroot) $ <span>~</span>/trunk/src/platform/ec/build/<span>&lt;</span>boardname<span>&gt;</span>/ec.bin</pre></div>
<p dir="auto">If you build Chrome OS with <code>build_packages</code> the firmware image will be at:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ /build/&lt;boardname&gt;/firmware/ec.bin"><pre>(chroot) $ /build/<span>&lt;</span>boardname<span>&gt;</span>/firmware/ec.bin</pre></div>
<p dir="auto">Specifying <code>--image</code> is optional. If you leave off the <code>--image</code> argument, the
<code>flash_ec</code> script will first look for a locally built <code>ec.bin</code> followed by one
generated by <code>emerge</code>.</p>
<h3 dir="auto"><a id="user-content-flashing-on-device-via-flashrom" aria-hidden="true" href="#flashing-on-device-via-flashrom"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Flashing on-device via flashrom</h3>
<p dir="auto">Assuming your devices boots, you can flash it using the <code>flashrom</code> utility. Copy
your binary to the device and run:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ flashrom -p ec -w &lt;path-to/ec.bin&gt;"><pre>(chroot) $ flashrom -p ec -w <span>&lt;</span>path-to/ec.bin<span>&gt;</span></pre></div>
<p dir="auto">Note: <code>-p internal:bus=lpc</code> also works on x86 boards...but why would you want to
remember and type all that?</p>
<h2 dir="auto"><a id="user-content-preventing-the-rw-ec-firmware-from-being-overwritten-by-software-sync-at-boot" aria-hidden="true" href="#preventing-the-rw-ec-firmware-from-being-overwritten-by-software-sync-at-boot"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Preventing the RW EC firmware from being overwritten by Software Sync at boot</h2>
<p dir="auto">A feature called &#34;Software Sync&#34; keeps a copy of the read-write (RW) EC firmware
in the RW part of the system firmware image. At boot, if the RW EC firmware
doesn&#39;t match the copy in the system firmware, the EC’s RW section is
re-flashed. While this is great for normal use as it makes updating the EC and
system firmware a unified operation, it can be a challenge for EC firmware
development. To disable software sync a flag can be set in the system firmware.
Run the following commands from a shell on the device to disable Software Sync
and turn on other developer-friendly flags (note that write protect must be
disabled for this to work):</p>
<div data-snippet-clipboard-copy-content="(chroot) $ /usr/share/vboot/bin/set_gbb_flags.sh 0x239"><pre>(chroot) $ /usr/share/vboot/bin/set_gbb_flags.sh 0x239</pre></div>

<p dir="auto">This turns on the following flags:</p>
<ul dir="auto">
<li><code>GBB_FLAG_DEV_SCREEN_SHORT_DELAY</code></li>
<li><code>GBB_FLAG_FORCE_DEV_SWITCH_ON</code></li>
<li><code>GBB_FLAG_FORCE_DEV_BOOT_USB</code></li>
<li><code>GBB_FLAG_DISABLE_FW_ROLLBACK_CHECK</code></li>
<li><code>GBB_FLAG_DISABLE_EC_SOFTWARE_SYNC</code></li>
</ul>
<p dir="auto">The <code>GBB</code> (Google Binary Block) flags are defined in the
<a href="https://chromium.googlesource.com/chromiumos/platform/vboot_reference/+/master/firmware/include/gbb_header.h" rel="nofollow">vboot_reference source</a>.
A varying subset of these flags are implemented and/or relevant for any
particular board.</p>
<h2 dir="auto"><a id="user-content-using-the-ec-serial-console" aria-hidden="true" href="#using-the-ec-serial-console"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Using the EC serial console</h2>
<p dir="auto">The EC has an interactive serial console available only through the UART
connected via servo. This console is essential to developing and debugging the
EC.</p>
<p dir="auto">Find the serial device of the ec console (on your workstation):</p>
<div data-snippet-clipboard-copy-content="(chroot) $ dut-control ec_uart_pty"><pre>(chroot) $ dut-control ec_uart_pty</pre></div>
<p dir="auto">Connect to the console:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ socat READLINE /dev/pts/XX"><pre>(chroot) $ socat READLINE /dev/pts/XX</pre></div>
<p dir="auto">Where <code>XX</code> is the device number. Use <code>cu</code>, <code>minicom</code>, or <code>screen</code> if you prefer
them over <code>socat</code>.</p>
<h3 dir="auto"><a id="user-content-useful-ec-console-commands" aria-hidden="true" href="#useful-ec-console-commands"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Useful EC console commands:</h3>
<p dir="auto"><strong>help</strong> - get a list of commands. help  to get help on a specific
command.</p>
<p dir="auto"><strong>chan</strong> - limit logging message to specific tasks (channels). Useful if you’re
looking for a specific error or warning and don’t want spam from other tasks.</p>
<p dir="auto"><strong>battfake</strong> - Override the reported battery charge percentage. Good for testing
low battery conditions (LED behavior for example). Set “battfake -1” to go back
to the actual value.</p>
<p dir="auto"><strong>fanduty</strong> - Override automatic fan control. “fanduty 0” turns the fan off.
“autofan” switches back to automated control.</p>
<p dir="auto"><strong>hcdebug</strong> - Display the commands that the host sends to the EC, in varying
levels of detail (see include/ec_commands.h for the data structures).</p>
<h2 dir="auto"><a id="user-content-host-commands" aria-hidden="true" href="#host-commands"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Host commands</h2>
<p dir="auto">The way in which messages are exchanged between the AP and EC is
<a href="https://github.com/FrameworkComputer/EmbeddedController/blob/hx20/docs/ap-ec-comm.md">documented separately</a>.</p>
<h2 dir="auto"><a id="user-content-software-features" aria-hidden="true" href="#software-features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Software Features</h2>
<h3 dir="auto"><a id="user-content-tasks" aria-hidden="true" href="#tasks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Tasks</h3>
<p dir="auto">Most code run on the EC after initialization is run in the context of a task
(with the rest in interrupt handlers). Each task has a fixed stack size and
there is no heap (malloc). All variable storage must be explicitly declared at
build-time. The EC (and system) will reboot if any task has a stack overflow.
Tasks typically have a top-level loop with a call to task_wait_event() or
usleep() to set a delay in uSec before continuing. A watchdog will trigger if a
task runs for too long. The watchdog timeout varies by EC chip and the clock
speed the EC is running at.</p>
<p dir="auto">The list of tasks for a board is specified in ec.tasklist in the <code>board/$BOARD/</code>
sub-directory. Tasks are listed in priority order with the lowest priority task
listed first. A task runs until it exits its main function or puts itself to
sleep. The highest priority task that wants to run is scheduled next. Tasks can
be preempted at any time by an interrupt and resumed after the handler is
finished.</p>
<p dir="auto">The console <code>taskinfo</code> command will print run-time stats on each task:</p>
<div data-snippet-clipboard-copy-content="&gt; taskinfo
Task Ready Name         Events      Time (s)  StkUsed
   0 R &lt;&lt; idle &gt;&gt;       00000000   32.975554  196/256
   1 R HOOKS            00000000    0.007835  192/488
   2   VBOOTHASH        00000000    0.042818  392/488
   3   POWERLED         00000000    0.000096  120/256
   4   CHARGER          00000000    0.029050  392/488
   5   CHIPSET          00000000    0.017558  400/488
   6   HOSTCMD          00000000    0.379277  328/488
   7 R CONSOLE          00000000    0.042050  348/640
   8   KEYSCAN          00000000    0.002988  292/488"><pre><code>&gt; taskinfo
Task Ready Name         Events      Time (s)  StkUsed
   0 R &lt;&lt; idle &gt;&gt;       00000000   32.975554  196/256
   1 R HOOKS            00000000    0.007835  192/488
   2   VBOOTHASH        00000000    0.042818  392/488
   3   POWERLED         00000000    0.000096  120/256
   4   CHARGER          00000000    0.029050  392/488
   5   CHIPSET          00000000    0.017558  400/488
   6   HOSTCMD          00000000    0.379277  328/488
   7 R CONSOLE          00000000    0.042050  348/640
   8   KEYSCAN          00000000    0.002988  292/488
</code></pre></div>
<p dir="auto">The <code>StkUsed</code> column reports the largest size the stack for each task grew since
reset (or sysjump).</p>
<h3 dir="auto"><a id="user-content-hooks" aria-hidden="true" href="#hooks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hooks</h3>
<p dir="auto">Hooks allow you to register a function to be run when specific events occur;
such as the host suspending or external power being applied:</p>
<div data-snippet-clipboard-copy-content="DECLARE_HOOK(HOOK_AC_CHANGE, ac_change_callback, HOOK_PRIO_DEFAULT);"><pre><code>DECLARE_HOOK(HOOK_AC_CHANGE, ac_change_callback, HOOK_PRIO_DEFAULT);
</code></pre></div>
<p dir="auto">Registered functions are run in the HOOKS task. Registered functions are called
in priority order if more than one callback needs to be run. There are also
hooks for running functions periodically: <code>HOOK_TICK</code> (fires every
<code>HOOK_TICK_INVERVAL</code> ms which varies by EC chip) and <code>HOOK_SECOND</code>. See
hook_type in
<a href="https://chromium.googlesource.com/chromiumos/platform/ec/+/master/include/hooks.h" rel="nofollow">include/hooks.h</a>
for a complete list.</p>
<h3 dir="auto"><a id="user-content-deferred-functions" aria-hidden="true" href="#deferred-functions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deferred Functions</h3>
<p dir="auto">Deferred functions allow you to call a function after a delay specified in uSec
without blocking. Deferred functions run in the HOOKS task. Here is an example
of an interrupt handler. The deferred function allows the handler itself to be
lightweight. Delaying the deferred call by 30 mSec also allows the interrupt to
be debounced.</p>
<div data-snippet-clipboard-copy-content="static int debounced_gpio_state;

static void some_interrupt_deferred(void)
{

        int gpio_state = gpio_get_level(GPIO_SOME_SIGNAL);

        if (gpio_state == debounced_gpio_state)
                return;

        debounced_gpio_state = gpio_state;

        dispense_sandwich(); /* Or some other useful action. */
}

/* A function must be explicitly declared as being deferrable. */
DECLARE_DEFERRED(some_interrupt_deferred);

void some_interrupt(enum gpio_signal signal)
{
        hook_call_deferred(some_interrupt_deferred, 30 * MSEC);
}"><pre><code>static int debounced_gpio_state;

static void some_interrupt_deferred(void)
{

        int gpio_state = gpio_get_level(GPIO_SOME_SIGNAL);

        if (gpio_state == debounced_gpio_state)
                return;

        debounced_gpio_state = gpio_state;

        dispense_sandwich(); /* Or some other useful action. */
}

/* A function must be explicitly declared as being deferrable. */
DECLARE_DEFERRED(some_interrupt_deferred);

void some_interrupt(enum gpio_signal signal)
{
        hook_call_deferred(some_interrupt_deferred, 30 * MSEC);
}
</code></pre></div>
<h3 dir="auto">Shared Memory Buffer</h3>
<p dir="auto">While there is no heap, there is a shared memory buffer that can be borrowed
temporarily (ideally before a context switch). The size of the buffer depends on
the EC chip being used. The buffer can only be used by one task at a time. See
<a href="https://chromium.googlesource.com/chromiumos/platform/ec/+/master/common/shared_mem.c" rel="nofollow">common/shared_mem.c</a>
for more information. At present (May 2014), this buffer is only used by debug
commands.</p>
<h2 dir="auto"><a id="user-content-making-code-changes" aria-hidden="true" href="#making-code-changes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Making Code Changes</h2>
<p dir="auto">If you see a bug or want to make an improvement to the EC code please file an
issue at <a href="http://crbug.com/new" rel="nofollow">crbug.com/new</a>. It&#39;s best to discuss the change
you want to make first on an issue report to make sure the EC maintainers are
on-board before digging into the fun part (writing code).</p>
<p dir="auto">In general, make more, smaller changes that solve single problems rather than
bigger changes that solve multiple problems. Smaller changes are easier and
faster to review. When changing common code shared between boards along with
board specific code, please split the shared code change into its own change
list (CL). The board specific CL can depend on the shared code CL.</p>
<h3 dir="auto"><a id="user-content-coding-style" aria-hidden="true" href="#coding-style"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Coding style</h3>
<p dir="auto">The EC code follows the
<a href="https://www.kernel.org/doc/html/latest/process/coding-style.html" rel="nofollow">Linux Kernel style guide</a>.
Please adopt the same style used in the existing code. Use tabs, not spaces, 80
column lines etc...</p>
<p dir="auto">Other style notes:</p>
<ol dir="auto">
<li>
<p dir="auto">Globals should either be <code>static</code> or <code>const</code>. Use them for persistent state
within a file or for constant data (such as the GPIO list in board.c). Do
not use globals to pass information between modules without accessors. For
module scope, accessors are not needed.</p>
</li>
<li>
<p dir="auto">If you add a new <code>#define</code> config option to the code, please document it in
<a href="https://chromium.googlesource.com/chromiumos/platform/ec/+/master/include/config.h" rel="nofollow">include/config.h</a>
with an <code>#undef</code> statement and descriptive comment.</p>
</li>
<li>
<p dir="auto">The Chromium copyright header must be included at the top of new files in
all contributions to the Chromium project:</p>
<div data-snippet-clipboard-copy-content="/* Copyright &lt;year&gt; The Chromium OS Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */"><pre><code>/* Copyright &lt;year&gt; The Chromium OS Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */
</code></pre></div>
</li>
</ol>
<h3 dir="auto"><a id="user-content-submitting-changes" aria-hidden="true" href="#submitting-changes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Submitting changes</h3>
<p dir="auto">Prior to uploading a new change for review, please run the EC unit tests with:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ make -j buildall"><pre>(chroot) $ make -j buildall</pre></div>

<p dir="auto">These commands will build and run unit tests in an emulator on your host.</p>
<p dir="auto">Pre-submit checks are run when you try to upload a change-list. If you wish to
run these checks manually first, commit your change locally then run the
following command from within the chroot and while in the <code>src/platform/ec</code>
directory:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ ~/trunk/src/repohooks/pre-upload.py"><pre>(chroot) $ <span>~</span>/trunk/src/repohooks/pre-upload.py</pre></div>
<p dir="auto">The pre-submit checks include checking the commit message. Commit messages must
have a <code>BUG</code>, <code>BRANCH</code>, and <code>TEST</code> line along with <code>Signed-off-by: First Last &lt;name@company.com&gt;</code>. The signed-off-by line is a statement that you have written
this code and it can be contributed under the terms of the <code>LICENSE</code> file.</p>
<p dir="auto">Please refer to existing commits (<code>git log</code>) to see the proper format for the
commit message. If you have configured git properly, running <code>git commit</code> with
the <code>-s</code> argument will add the Signed-off-by line for you.</p>
<h2 dir="auto"><a id="user-content-debugging" aria-hidden="true" href="#debugging"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Debugging</h2>
<p dir="auto">While adding <code>printf</code> statements can be handy, there are some other options for
debugging problems during development.</p>
<h3 dir="auto"><a id="user-content-serial-console" aria-hidden="true" href="#serial-console"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Serial Console</h3>
<p dir="auto">There may already be a message on the serial console that indicates your
problem. If you don’t have a servo connected, the <code>ectool console</code> command will
show the current contents of the console buffer (the buffer’s size varies by EC
chip). This log persists across warm resets of the host but is cleared if the EC
resets. The <code>ectool console</code> command will only work when the EC is not write
protected.</p>
<p dir="auto">If you have interactive access to the serial console via servo, you can use the
read word <code>rw</code> and write word <code>ww</code> commands to peek and poke the EC&#39;s RAM. You
may need to refer to the datasheet for your EC chip or the disassembled code to
find the memory address you need. There are other handy commands on the serial
console to read temperatures, view the state of tasks (taskinfo) which may help.
Type <code>help</code> for a list.</p>
<h3 dir="auto"><a id="user-content-panicinfo" aria-hidden="true" href="#panicinfo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Panicinfo</h3>
<p dir="auto">The EC may save panic data which persists across resets. Use the “<code>ectool panicinfo</code>” command or console “<code>panicinfo</code>” command to view the saved data:</p>
<div data-snippet-clipboard-copy-content="Saved panic data: (NEW)
=== HANDLER EXCEPTION: 05 ====== xPSR: 6100001e ===
r0 :00000001 r1 :00000f15 r2 :4003800c r3 :000000ff
r4 :ffffffed r5 :00000799 r6 :0000f370 r7 :00000000
r8 :00000001 r9 :00000003 r10:20002fe0 r11:00000000
r12:00000008 sp :20000fd8 lr :000012e1 pc :0000105e"><pre><code>Saved panic data: (NEW)
=== HANDLER EXCEPTION: 05 ====== xPSR: 6100001e ===
r0 :00000001 r1 :00000f15 r2 :4003800c r3 :000000ff
r4 :ffffffed r5 :00000799 r6 :0000f370 r7 :00000000
r8 :00000001 r9 :00000003 r10:20002fe0 r11:00000000
r12:00000008 sp :20000fd8 lr :000012e1 pc :0000105e
</code></pre></div>
<p dir="auto">The most interesting information are the program counter (<code>pc</code>) and the link
register (return address, <code>lr</code>) as they give you an indication of what code the
EC was running when the panic occurred. <code>HANDLER EXCEPTIONS</code> indicate the panic
occurred while servicing an interrupt. <code>PROCESS EXCEPTIONS</code> occur in regular
tasks. If you see “Imprecise data bus error” listed, the program counter value
is incorrect as the panic occurred when flushing a write buffer. If using a
cortex-m based EC, add <code>CONFIG_DEBUG_DISABLE_WRITE_BUFFER</code> to your board.h to
disable write buffering (with a performance hit) to get a “Precise bus error”
with an accurate program counter value.</p>
<h3 dir="auto"><a id="user-content-assembly-code" aria-hidden="true" href="#assembly-code"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Assembly Code</h3>
<p dir="auto">If you have a program counter address you need to make sense of, you can
generate the assembly code for the EC by checking out the code at the matching
commit for your binary (<code>ectool version</code>) and running:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ make BOARD=$board dis"><pre>(chroot) $ make BOARD=<span>$board</span> dis</pre></div>
<p dir="auto">This outputs two files with assembly code:</p>
<div data-snippet-clipboard-copy-content="build/$board/RO/ec.RO.dis
build/$board/RW/ec.RW.dis"><pre><code>build/$board/RO/ec.RO.dis
build/$board/RW/ec.RW.dis
</code></pre></div>
<p dir="auto">which (in the case of the LM4 and STM32) are essentially the same, but the RW
addresses are offset.</p>
<h2 dir="auto"><a id="user-content-write-protect" aria-hidden="true" href="#write-protect"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Write Protect</h2>
<p dir="auto">See <a href="https://github.com/FrameworkComputer/EmbeddedController/blob/hx20/docs/write_protection.md">Firmware Write Protection</a>.</p>
<h2 dir="auto"><a id="user-content-ec-version-strings" aria-hidden="true" href="#ec-version-strings"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>EC Version Strings</h2>
<p dir="auto">The read-only and read-write sections of the EC firmware each have a version
string. This string tells you the branch and last change at which the firmware
was built. On a running machine, run <code>ectool version</code> from a shell to see
version information:</p>
<div data-snippet-clipboard-copy-content="RO version:    peppy_v1.5.103-7abb4f7
RW version:    peppy_v1.5.129-cd1a1e9
Firmware copy: RW
Build info:    peppy_v1.5.129-cd1a1e9 2014-03-07 17:18:27 @build120-m2"><pre><code>RO version:    peppy_v1.5.103-7abb4f7
RW version:    peppy_v1.5.129-cd1a1e9
Firmware copy: RW
Build info:    peppy_v1.5.129-cd1a1e9 2014-03-07 17:18:27 @build120-m2
</code></pre></div>
<p dir="auto">You can also run the <code>version</code> command on the EC serial console for a similar
output.</p>
<p dir="auto">The format of the version string is:</p>
<div data-snippet-clipboard-copy-content="&lt;board&gt;_&lt;branch number&gt;.&lt;number of commits since the branch tag was created&gt;-&lt;git hash of most recent change&gt;"><pre><code>&lt;board&gt;_&lt;branch number&gt;.&lt;number of commits since the branch tag was created&gt;-&lt;git hash of most recent change&gt;
</code></pre></div>
<p dir="auto">If the version is: <code>rambi_v1.6.68-a6608c8</code>:</p>
<ul dir="auto">
<li>board name = rambi</li>
<li>branch number = v1.6 (which is for the firmware-rambi branch)</li>
<li>number of commits on this branch (since the tag was added) = 68</li>
<li>latest git hash = a6608c8</li>
</ul>
<p dir="auto">The branch numbers (as of May 2014) are:</p>
<ul dir="auto">
<li>v1.0.0 cros/master</li>
<li>v1.1.0 cros/master</li>
<li>v1.2.0 cros/firmware-link-2695.2.B</li>
<li>v1.3.0 cros/firmware-snow-2695.90.B</li>
<li>v1.4.0 cros/firmware-skate-3824.129.B</li>
<li>v1.5.0 cros/firmware-4389.71.B</li>
<li>v1.6.0 cros/firmware-rambi-5216.B</li>
</ul>
<p dir="auto">Hack command to check the branch tags:</p>
<div data-snippet-clipboard-copy-content="git tag

for hash in $(git for-each-ref --format=&#39;%(objectname)&#39; refs/tags/); do
    git branch -a --contains $hash | head -1;
done"><pre><code>git tag

for hash in $(git for-each-ref --format=&#39;%(objectname)&#39; refs/tags/); do
    git branch -a --contains $hash | head -1;
done
</code></pre></div>
<p dir="auto">(If anyone can come up with something prettier, make a CL).</p>
<p dir="auto">Run <code>util/getversion.sh</code> to see the current version string. The board name is
passed as an environment variable <code>BOARD</code>:</p>
<div data-snippet-clipboard-copy-content="(chroot) $ BOARD=&#34;cheese&#34; ./util/getversion.sh"><pre>(chroot) $ BOARD=<span><span>&#34;</span>cheese<span>&#34;</span></span> ./util/getversion.sh</pre></div>

</article>
        </div></div>
  </body>
</html>
