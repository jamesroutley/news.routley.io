<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zfsbootmenu.org/">Original</a>
    <h1>ZFSBootMenu – A boot loader to manage ZFS boot environments for Linux</h1>
    
    <div id="readability-page-1" class="page"><section id="main_content">
          <p>ZFSBootMenu is a Linux bootloader that attempts to provide an experience
similar to the FreeBSD bootloader. By taking advantage of ZFS features, it
allows a user to have multiple “boot environments” (with different distros, for
example), manipulate snapshots before booting, and, for the adventurous user,
even bootstrap a system installation via <code>zfs recv</code>.</p>

<p>The bootloader is implemented as a small Linux distribution, rolled into a
single initramfs image or UEFI bundle, that provides the tools necessary to
identify, control and boot environments found on ZFS pools. The bootloader is
constructed as a module for <a href="https://github.com/dracutdevs/dracut">dracut</a> or
<a href="https://github.com/archlinux/mkinitcpio">mkinitcpio</a>. It is possible to use
standard add-on modules for either initramfs generator to incorporate advanced
functionality such as remote access via SSH.</p>

<p><a href="https://get.zfsbootmenu.org">Pre-built ZFSBootMenu images</a> are available for
convenience. Full customization is possible by
<a href="https://github.com/zbm-dev/zfsbootmenu#local-image-creation">building a local image</a>;
locally built images will use the kernel provided by your distribution. Additionally,
a <a href="https://github.com/zbm-dev/zfsbootmenu#local-image-creation">build script</a>
facilitates
<a href="https://github.com/zbm-dev/zfsbootmenu/tree/master/releng/docker#readme">containerized builds</a>.
Build containers are based on Void Linux and provide the same environment used
to create the pre-built images, but allow injection of custom configuration and
modules for maximum flexibility in a controlled environment.</p>

<h2 id="main-view">Main view</h2>

<p><img src="https://zfsbootmenu.org/media/v1.11.0-multi-be.png?raw=true" alt="screenshot"/></p>

<h2 id="key-features">Key Features</h2>

<ul>
  <li>
    <p>Allows selection of specific kernels among boot environments distributed
across any number of pools.</p>
  </li>
  <li>
    <p>Facilitates cloning (or independently duplicating) prior snapshots of any
boot environment and booting the clone.</p>
  </li>
  <li>
    <p>Works with native ZFS encryption and LUKS.</p>
  </li>
  <li>
    <p>Capable of producing UEFI bundles or separate kernel and initramfs images.</p>
  </li>
  <li>
    <p>Provides a mechanism to adjust the default boot environment for any pool.</p>
  </li>
  <li>
    <p>Allows kernel versions to be “pinned” for each boot environment, overriding
the default behavior of booting the kernel with the highest version.</p>
  </li>
  <li>
    <p>Behavior is adjustable through (mostly) inheritable ZFS properties.</p>
  </li>
</ul>

<h2 id="overview-of-the-boot-process">Overview of the Boot Process</h2>

<ul>
  <li>Via syslinux, direct EFI booting, gummiboot, rEFInd or other UEFI boot manager,
boot a stock Linux kernel along with an initramfs containing the ZFSBootMenu
dracut module.</li>
  <li>Import all importable pools.</li>
  <li>Try to identify a default boot environment.
    <ul>
      <li>If ZFSBootMenu was started with a <code>zbm.prefer=&lt;pool&gt;</code> argument, the
default boot environment will be that specified by the <code>bootfs</code> property
on the specified pool.</li>
      <li>If no preferred pool was identified, look for the first identified pool
with a <code>bootfs</code> property to determine the default boot environment.</li>
    </ul>
  </li>
  <li>If a default boot environment was identified, present a countdown timer for
automatic boot.</li>
  <li>If no default environment can be found or the countdown is interrupted,
provide an interactive boot menu.
    <ul>
      <li>Identify all potential boot environments as filesystems that mount to <code>/</code>
or have a <code>legacy</code> mountpoint with an opt-in property set.</li>
      <li>Enumerate kernels and initramfs images in the <code>/boot</code> subdirectory of
each environment.</li>
      <li>Allow selection of a desired kernel within any boot environment.</li>
    </ul>
  </li>
  <li>After a boot environment is selected for boot (automatically or manually),
load the selected kernel and initramfs, unmount all ZFS filesystems, and boot
the system.</li>
</ul>

<p>At this point, you’ll be booting into your usual OS-managed kernel and
initramfs, along with any arguments needed to correctly boot your system.</p>

<h2 id="encryption-support">Encryption Support</h2>

<p>ZFSBootMenu was designed around native ZFS encryption. ZFSBootMenu will prompt
for passphrases as necessary to unlock pools or filesystems needing to support
user interaction or the standard boot process.</p>

<p>ZFSBootMenu also works with the standard LUKS dracut module to allow booting
from ZFS pools on a LUKS encrypted device.</p>

<h2 id="safe-by-design">Safe by Design</h2>

<p>Pools are always imported read-only by default. Certain pool, filesystem or
snapshot operations supported by ZFSBootMenu (but only performed by user
request) require that pools be imported read-write. If the reimport cannot be
done safely, those operations will not be permitted.</p>

<h2 id="more-details">More Details</h2>

<p>Please refer to the <a href="https://github.com/zbm-dev/zfsbootmenu">ZFSBootMenu source repository</a>
for detailed documentation.</p>

        </section></div>
  </body>
</html>
