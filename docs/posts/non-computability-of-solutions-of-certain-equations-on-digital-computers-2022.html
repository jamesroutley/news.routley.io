<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arxiv.org/abs/2205.12626">Original</a>
    <h1>Non-computability of solutions of certain equations on digital computers (2022)</h1>
    
    <div id="readability-page-1" class="page"><div><p><i><a href="https://blog.jacobvosmaer.nl/">Jacob Vosmaer&#39;s blog</a></i></p>

<p>2024-08-02</p>

<p>In my last post I mentioned my attempts to make sense of the <a href="https://blog.jacobvosmaer.nl/0027-synth-notes/#vz1">Casio VZ-1 keyboard synthesizer</a>. The reality of how this machine works disagrees with the manual. In this post I will try to make sense of some of what is going on with this machine.</p>

<h2>Algorithms: theory</h2>

<p>In theory, the Casio VZ-1 uses a combination of ring modulation and phase modulation between up to 8 &#34;modules&#34; M1 through M8 which I prefer to call &#34;operators&#34; because that is what they are called in the Yamaha DX7 and that synth is much better known. </p>

<p>The operators are grouped into &#34;lines&#34;. Operator M1 and M2 form line A, M3 and M4 are line B, etc. In the service manual Casio uses numbers for the lines. Line A is actually line 3, line B is line 2, line C is line 1 and line D is line 0.</p>

<p>The operators can be configured to interact in different ways, analogous to how the DX7 has &#34;<a href="https://www.righto.com/2021/12/yamaha-dx7-chip-reverse-engineering.html">algorithms</a>&#34;. This diagram from the service manual (which is also in the normal manual) purports to show how it works.</p>

<p><img src="https://blog.jacobvosmaer.nl/0028-mysterious-vz-1/assets/vz1-algorithms.png" alt="VZ-1 algorithm diagram"/>
<i>Image source: Casio VZ-1 service manual</i></p>

<p>Each of the four lines can be configured into &#34;mix&#34;, &#34;ring&#34; or &#34;phase&#34; mode. The output of line A-C (or 3-1) is either fed to the output bus or fed into the next even operator via the &#34;external phase&#34; setting. So line A is either audible on its own, or it becomes a phase modulation input for operator M4. Line B is either heard or it becomes a phase modulation signal for M6. Same for line C and M8.</p>

<p>Through the &#34;external phase&#34; switches it is possible to create chains of up to 4 lines cascading into the last even operator.</p>

<h2>Algorithms: practice</h2>

<p>The manual mentions this nowhere, but if you create a cascade of lines with external phase modulation, then the operator frequencies of all the even operators are the same, and they can be controlled via the lowest even operator.</p>

<p>For example, if you cascade A into B and B into C, then operators M2, M4 and M6 all share the same frequency, which you can control by changing the settings of M2. The UI lets you change the frequency of M4 and M6 but nothing happens when you do that.</p>

<p>The operator frequency ratio is one of the fundamental parameters in phase modulation synthesis: it determines the sideband frequencies. (The other fundamental parameter is modulation index which determines the amplitude of the sidebands.) It is a big and surprising limitation if you cannot vary the frequency ratios. This also happens when a line is configured in &#34;phase&#34; mode (also called &#34;internal phase&#34;) on the Casio: the operators get locked to the same frequency. And this also is not documented.</p>

<p>But wait, there is more. Imagine you have a cascade of three lines: A into B into C. Operator M4 in line B acts as a choke point for the signal coming out of line A: if M4 is off or has zero amplitude, the sound generated by  M1 and M2 becomes irrelevant. This is what the diagram suggests and it is also what happens with DX7 phase modulation. If I turn off operator 4 in the DX7 algorithm   below, then it does not matter what the frequency or amplitude of operators 5 and 6 is: their signal won&#39;t get past operator 4.</p>

<p><img src="https://blog.jacobvosmaer.nl/0028-mysterious-vz-1/assets/dx7algo1.png" alt="DX7 Algorithm 1"/>
<i>Image source: <a href="https://uk.yamaha.com/files/download/other_assets/9/333979/DX7E1.pdf">DX7 user manual</a></i></p>

<p>In reality, if you <a id="experiment1">do</a> the following on the Casio VZ-1:</p>

<ol>
<li>Start with INIT VOICE</li>
<li>Enable &#34;EXTERNAL PHASE&#34; on line B and C</li>
<li>Enable operator M1 and M6 and disable the rest</li>
</ol>

<p><img src="https://blog.jacobvosmaer.nl/0028-mysterious-vz-1/assets/externalphase.png" alt="External phase example"/>
<i>Signal flows from left to right. Operators M1 and M6 are enabled, all others are disabled.</i></p>

<p>You would expect to only hear M6, because M4 acts as a choke point for the signal from M1 and M4 is disabled. But that is not what you hear: you get a phase modulated sound instead of a pure sinewave, which you can also verify by changing the frequency of M1. How on earth is the signal from M1 getting past M4?</p>



<p><img src="https://blog.jacobvosmaer.nl/0028-mysterious-vz-1/assets/extphase-spectrum.png" alt="External phase modulation spectrum"/>
<i>First I play 4 notes with operator M1 and M6 enabled, then with only M6 enabled. You can hear and see how the sound changes from a phase modulated sound with strong sidebands to almost a pure sinewave (with oddly some 4th harmonic distortion).</i></p>

<h2>Casio is lying to us</h2>

<p>Is my VZ-1 broken? Have I discovered an implementation quirk that nobody on the internet has ever complained about? No and no. My VZ-1 is not broken and on closer inspection at least 1 person on the internet is aware of this problem, and they figured it out for me! Digital synthesis expert <a href="https://www.youtube.com/@acreil">acreil</a> got roped into a <a href="https://gearspace.com/board/electronic-music-instruments-and-electronic-music-production/1359494-casio-vz-love-just-scored-complete-box-example.html">Gearspace thread about the VZ-1</a> back in 2021. The discussion starts off not being very interesting  until acreil shows up, who then repeatedly gets contradicted by someone who loudly says things that are wrong, and then to put that all to rest acreil finds the relevant <a href="https://patents.google.com/patent/US5040448A/en">Casio patent for the VZ series</a> and <a href="https://gearspace.com/board/showpost.php?p=15645527&amp;postcount=63">drops the bomb</a> that the VZ&#39;s don&#39;t do phase modulation at all. They do wave shaping.</p>

<p>Excuse me what now? Yes, pedantically wave shaping is phase modulation with a carrier frequency of 0Hz, but why would you call that phase modulation?</p>

<p>Here is a picture from the patent that shows what actually happens inside a single &#34;line&#34;.</p>

<p><img src="https://blog.jacobvosmaer.nl/0028-mysterious-vz-1/assets/patent-fig7.png" alt="Figure 7 from patent US5040448A"/>
<i>Image source: <a href="https://patents.google.com/patent/US5040448A/en">US patent 5040448A</a> </i></p>

<p>Note how <code>ω0t</code> is the phase of operator 0 and <code>ω1t</code> is the phase of operator 1. In &#34;internal phase&#34; mode switch SW1 is up, SW2 is down and SW3 is right. The result is that the phase input of the  &#34;SIN ROM&#34;  of operator 1 is the output of operator 0. If this was phase modulation, the phase input would be the output of operator 0 <em>plus</em> <code>ω1t</code>.</p>

<p>So if I use &#34;internal phase&#34; mode with operators M1 and M2, what really happens is that M2 becomes a wave shaper for M1. But the user manual and the user interface pretend (!!) that this is phase modulation, and you can for instance turn off M1 and hear the signal of M2. Which is an oscillator stuck at 0Hz. This is impossible because 0Hz is inaudible. acreil figured out for us what actually happens.</p>

<blockquote>
  <p>because the total output would be zero when the modulator output is zero, one modulator is always fixed to a minimum amplitude. That&#39;s M1 when M1 and M2 use phase modulation</p>
</blockquote>

<p>So when I turn off M1 in the user interface and turn on M2, I actually hear M1 at a low volume through M2. Who gets it in their head that lying to the user like this is a good idea? acreil goes on to point out:</p>

<blockquote>
  <p>You can hear the waveform, pitch, etc. of that modulator even when it&#39;s muted. </p>
</blockquote>

<p>Indeed. Take the following patch:</p>

<ol>
<li>Start with INIT VOICE</li>
<li>Set line A to &#34;PHASE&#34; mode</li>
<li>Turn on operator M2 and turn off all other operators</li>
<li>Now vary the pitch and waveform of M1</li>
</ol>



<p>In the recording you first hear me change the M1 waveform and then the M1 frequency. M1 is &#34;exciting&#34; the M2 wave shaper.</p>

<p>Why does this work? If you stay close enough to 0 then <code>sin(x)≈x</code>. In other words if you don&#39;t drive a sine wave shaper hard enough to leave the linear region then you can&#39;t hear that it&#39;s there.</p>

<p>I think this also explains what happens in the <a href="#experiment1">experiment above</a>. Because M6 is enabled, M2 is secretly enabled to act as an exciter for M6. The signal from M2 can only reach M6 by passing through M4 so the envelope of M4 is wide open <em>even though M4 is muted in the user interface</em>. Now when I enable M1 its output gets added to the excitation signal from M2, and ends up driving both the M4 and M6 wave shapers outside their linear region.</p>

<p>Wow.</p>
<p>Tags:
<a href="https://blog.jacobvosmaer.nl/music.html">music</a>
<a href="https://blog.jacobvosmaer.nl/vz-1.html">vz-1</a>
</p><details><summary>Edit history</summary><table>
<tbody><tr><td>2024-08-03</td><td></td><td>0029: draft</td></tr>
<tr><td>2024-08-03</td><td></td><td>0028 synthesizer -&gt; synthesis</td></tr>
<tr><td>2024-08-02</td><td></td><td>0028: publish</td></tr>
<tr><td>2024-08-02</td><td></td><td>0028 proofreading fixes</td></tr>
<tr><td>2024-08-02</td><td></td><td>0028: add draft</td></tr>
</tbody></table></details><p><a href="https://blog.jacobvosmaer.nl/">Back</a></p>
</div></div>
  </body>
</html>
