<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/leeoniya/uDSV">Original</a>
    <h1>Show HN: uDSV.js â€“ A faster CSV parser</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" dir="auto"><a id="user-content--Î¼dsv" aria-hidden="true" tabindex="-1" href="#-Î¼dsv"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>ğŒ  Î¼DSV</h2>
<p dir="auto">A <a href="#performance">faster</a> CSV parser in <a href="https://github.com/leeoniya/uDSV/tree/main/dist/uDSV.iife.min.js">5KB (min)</a> <em>(MIT Licensed)</em></p>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-introduction" aria-hidden="true" tabindex="-1" href="#introduction"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Introduction</h3>
<p dir="auto">uDSV is a fast JS library for parsing well-formed CSV strings, either from memory or incrementally from disk or network.
It is mostly <a href="https://datatracker.ietf.org/doc/html/rfc4180" rel="nofollow">RFC 4180</a> compliant, with support for quoted values containing commas, escaped quotes, and line breaksÂ¹.
The aim of this project is to handle the 99.5% use-case without adding complexity and performance trade-offs to support the remaining 0.5%.</p>
<p dir="auto">Â¹ Line breaks (<code>\n</code>,<code>\r</code>,<code>\r\n</code>) within quoted values must match the row separator.</p>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-features" aria-hidden="true" tabindex="-1" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Features</h3>
<p dir="auto">What does uDSV pack into 5KB?</p>
<ul dir="auto">
<li><a href="https://datatracker.ietf.org/doc/html/rfc4180" rel="nofollow">RFC 4180</a> compliant</li>
<li>Incremental or full parsing, with optional accumulation</li>
<li>Auto-detection and customization of delimiters (rows, columns, quotes, escapes)</li>
<li>Schema inference and value typing: <code>string</code>, <code>number</code>, <code>boolean</code>, <code>date</code>, <code>json</code></li>
<li>Defined handling of <code>&#39;&#39;</code>, <code>&#39;null&#39;</code>, <code>&#39;NaN&#39;</code></li>
<li>Whitespace trimming of values &amp; skipping empty lines</li>
<li>Multi-row header skipping and column renaming</li>
<li>Multiple outputs: arrays (tuples), objects, nested objects, columnar arrays</li>
</ul>
<p dir="auto">Of course, <em>most</em> of these are table stakes for CSV parsers :)</p>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-performance" aria-hidden="true" tabindex="-1" href="#performance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Performance</h3>
<p dir="auto">Is it Lightning Fastâ„¢ or Blazing Fastâ„¢?</p>
<p dir="auto">No, those are too slow! uDSV has <a href="https://www.youtube.com/watch?v=ygE01sOhzz0" rel="nofollow">Ludicrous Speedâ„¢</a>;
it&#39;s faster than the parsers you recognize and faster than those you&#39;ve never heard of.</p>
<p dir="auto">On a Ryzen 7 ThinkPad, Linux v6.4.11, and NodeJS v20.6.0, a diverse set of benchmarks show a 1x-5x performance boost relative to <a href="https://www.papaparse.com/" rel="nofollow">Papa Parse</a>.
Papa Parse is used as a reference not because it&#39;s the fastest, but due to its <a href="https://github.com/search?q=csv+parser&amp;type=repositories&amp;s=stars&amp;o=desc">outsized popularity</a>, battle-testedness, and <a href="https://leanylabs.com/blog/js-csv-parsers-benchmarks/" rel="nofollow">some external validation</a> of its performance claims.</p>
<p dir="auto">Most CSV parsers have one happy/fast path -- the one without quoted values, without value typing, and using the default settings &amp; output format.
Once you&#39;re off that path, you can generally throw their self-promoting benchmarks in the trash.
In contrast, uDSV remains fast with all datasets and options; its happy path is <em>every path</em>.</p>
<p dir="auto">For <em>way too many</em> synthetic and real-world benchmarks, head over to <a href="https://github.com/leeoniya/uDSV/blob/main/bench">/bench</a>...and don&#39;t forget your coffee!</p>
<div data-snippet-clipboard-copy-content="â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ uszips.csv (6 MB, 18 cols x 34K rows)                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name                   â”‚ Rows/s â”‚ Throughput (MiB/s)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ uDSV                   â”‚ 782K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 140 â”‚
â”‚ csv-simple-parser      â”‚ 682K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 122        â”‚
â”‚ achilles-csv-parser    â”‚ 469K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 83.8                      â”‚
â”‚ d3-dsv                 â”‚ 433K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 77.4                        â”‚
â”‚ csv-rex                â”‚ 346K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 61.9                              â”‚
â”‚ PapaParse              â”‚ 305K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 54.5                                 â”‚
â”‚ csv42                  â”‚ 296K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 52.9                                  â”‚
â”‚ csv-js                 â”‚ 285K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50.9                                  â”‚
â”‚ comma-separated-values â”‚ 258K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 46.1                                    â”‚
â”‚ dekkai                 â”‚ 248K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 44.3                                     â”‚
â”‚ CSVtoJSON              â”‚ 245K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 43.8                                     â”‚
â”‚ csv-parser (neat-csv)  â”‚ 218K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 39                                         â”‚
â”‚ ACsv                   â”‚ 218K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 39                                         â”‚
â”‚ SheetJS                â”‚ 208K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 37.1                                        â”‚
â”‚ @vanillaes/csv         â”‚ 200K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35.8                                        â”‚
â”‚ node-csvtojson         â”‚ 165K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 29.4                                           â”‚
â”‚ csv-parse/sync         â”‚ 125K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 22.4                                              â”‚
â”‚ @fast-csv/parse        â”‚ 78.2K  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘ 14                                                   â”‚
â”‚ jquery-csv             â”‚ 55.1K  â”‚ â–‘â–‘â–‘â–‘ 9.85                                                   â”‚
â”‚ but-csv                â”‚ ---    â”‚ Wrong row count! Expected: 33790, Actual: 1                 â”‚
â”‚ @gregoranders/csv      â”‚ ---    â”‚ Invalid CSV at 1:109                                        â”‚
â”‚ utils-dsv-base-parse   â”‚ ---    â”‚ unexpected error. Encountered an invalid record. Field 17 o â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"><pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ uszips.csv (6 MB, 18 cols x 34K rows)                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name                   â”‚ Rows/s â”‚ Throughput (MiB/s)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ uDSV                   â”‚ 782K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 140 â”‚
â”‚ csv-simple-parser      â”‚ 682K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 122        â”‚
â”‚ achilles-csv-parser    â”‚ 469K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 83.8                      â”‚
â”‚ d3-dsv                 â”‚ 433K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 77.4                        â”‚
â”‚ csv-rex                â”‚ 346K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 61.9                              â”‚
â”‚ PapaParse              â”‚ 305K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 54.5                                 â”‚
â”‚ csv42                  â”‚ 296K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 52.9                                  â”‚
â”‚ csv-js                 â”‚ 285K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 50.9                                  â”‚
â”‚ comma-separated-values â”‚ 258K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 46.1                                    â”‚
â”‚ dekkai                 â”‚ 248K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 44.3                                     â”‚
â”‚ CSVtoJSON              â”‚ 245K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 43.8                                     â”‚
â”‚ csv-parser (neat-csv)  â”‚ 218K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 39                                         â”‚
â”‚ ACsv                   â”‚ 218K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 39                                         â”‚
â”‚ SheetJS                â”‚ 208K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 37.1                                        â”‚
â”‚ @vanillaes/csv         â”‚ 200K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35.8                                        â”‚
â”‚ node-csvtojson         â”‚ 165K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 29.4                                           â”‚
â”‚ csv-parse/sync         â”‚ 125K   â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 22.4                                              â”‚
â”‚ @fast-csv/parse        â”‚ 78.2K  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘ 14                                                   â”‚
â”‚ jquery-csv             â”‚ 55.1K  â”‚ â–‘â–‘â–‘â–‘ 9.85                                                   â”‚
â”‚ but-csv                â”‚ ---    â”‚ Wrong row count! Expected: 33790, Actual: 1                 â”‚
â”‚ @gregoranders/csv      â”‚ ---    â”‚ Invalid CSV at 1:109                                        â”‚
â”‚ utils-dsv-base-parse   â”‚ ---    â”‚ unexpected error. Encountered an invalid record. Field 17 o â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-installation" aria-hidden="true" tabindex="-1" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h3>

<p dir="auto">or</p>
<div dir="auto" data-snippet-clipboard-copy-content="&lt;script src=&#34;./dist/uDSV.iife.min.js&#34;&gt;&lt;/script&gt;"><pre><span>&lt;</span><span>script</span> <span>src</span>=&#34;<span>./dist/uDSV.iife.min.js</span>&#34;<span>&gt;</span><span>&lt;/</span><span>script</span><span>&gt;</span></pre></div>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-api" aria-hidden="true" tabindex="-1" href="#api"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>API</h3>
<p dir="auto">A 150 LoC <a href="https://github.com/leeoniya/uDSV/blob/main/dist/uDSV.d.ts">uDSV.d.ts</a> TypeScript def.</p>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-basic-usage" aria-hidden="true" tabindex="-1" href="#basic-usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Basic Usage</h3>
<div dir="auto" data-snippet-clipboard-copy-content="import { inferSchema, initParser } from &#39;udsv&#39;;

let csvStr = &#39;a,b,c\n1,2,3\n4,5,6&#39;;

let schema = inferSchema(csvStr);
let parser = initParser(schema);

// native format (fastest)
let stringArrs = parser.stringArrs(csvStr); // [ [&#39;1&#39;,&#39;2&#39;,&#39;3&#39;], [&#39;4&#39;,&#39;5&#39;,&#39;6&#39;] ]

// typed formats (internally converted from native)
let typedArrs  = parser.typedArrs(csvStr);  // [ [1, 2, 3], [4, 5, 6] ]
let typedObjs  = parser.typedObjs(csvStr);  // [ {a: 1, b: 2, c: 3}, {a: 4, b: 5, c: 6} ]
let typedCols  = parser.typedCols(csvStr);  // [ [1, 4], [2, 5], [3, 6] ]"><pre><span>import</span> <span>{</span> <span>inferSchema</span><span>,</span> <span>initParser</span> <span>}</span> <span>from</span> <span>&#39;udsv&#39;</span><span>;</span>

<span>let</span> <span>csvStr</span> <span>=</span> <span>&#39;a,b,c\n1,2,3\n4,5,6&#39;</span><span>;</span>

<span>let</span> <span>schema</span> <span>=</span> <span>inferSchema</span><span>(</span><span>csvStr</span><span>)</span><span>;</span>
<span>let</span> <span>parser</span> <span>=</span> <span>initParser</span><span>(</span><span>schema</span><span>)</span><span>;</span>

<span>// native format (fastest)</span>
<span>let</span> <span>stringArrs</span> <span>=</span> <span>parser</span><span>.</span><span>stringArrs</span><span>(</span><span>csvStr</span><span>)</span><span>;</span> <span>// [ [&#39;1&#39;,&#39;2&#39;,&#39;3&#39;], [&#39;4&#39;,&#39;5&#39;,&#39;6&#39;] ]</span>

<span>// typed formats (internally converted from native)</span>
<span>let</span> <span>typedArrs</span>  <span>=</span> <span>parser</span><span>.</span><span>typedArrs</span><span>(</span><span>csvStr</span><span>)</span><span>;</span>  <span>// [ [1, 2, 3], [4, 5, 6] ]</span>
<span>let</span> <span>typedObjs</span>  <span>=</span> <span>parser</span><span>.</span><span>typedObjs</span><span>(</span><span>csvStr</span><span>)</span><span>;</span>  <span>// [ {a: 1, b: 2, c: 3}, {a: 4, b: 5, c: 6} ]</span>
<span>let</span> <span>typedCols</span>  <span>=</span> <span>parser</span><span>.</span><span>typedCols</span><span>(</span><span>csvStr</span><span>)</span><span>;</span>  <span>// [ [1, 4], [2, 5], [3, 6] ]</span></pre></div>
<p dir="auto">Nested/deep objects can be re-constructed from column naming via <code>.typedDeep()</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// deep/nested objects (from column naming)
let csvStr2 = `
_type,name,description,location.city,location.street,location.geo[0],location.geo[1],speed,heading,size[0],size[1],size[2]
item,Item 0,Item 0 description in text,Rotterdam,Main street,51.9280712,4.4207888,5.4,128.3,3.4,5.1,0.9
`.trim();

let schema2 = inferSchema(csvStr2);
let parser2 = initParser(schema2);

let typedDeep = parser2.typedDeep(csvStr2);

/*
[
  {
    _type: &#39;item&#39;,
    name: &#39;Item 0&#39;,
    description: &#39;Item 0 description in text&#39;,
    location: {
      city: &#39;Rotterdam&#39;,
      street: &#39;Main street&#39;,
      geo: [ 51.9280712, 4.4207888 ]
    },
    speed: 5.4,
    heading: 128.3,
    size: [ 3.4, 5.1, 0.9 ],
  }
]
*/"><pre><span>// deep/nested objects (from column naming)</span>
<span>let</span> <span>csvStr2</span> <span>=</span> <span>`</span>
<span>_type,name,description,location.city,location.street,location.geo[0],location.geo[1],speed,heading,size[0],size[1],size[2]</span>
<span>item,Item 0,Item 0 description in text,Rotterdam,Main street,51.9280712,4.4207888,5.4,128.3,3.4,5.1,0.9</span>
<span>`</span><span>.</span><span>trim</span><span>(</span><span>)</span><span>;</span>

<span>let</span> <span>schema2</span> <span>=</span> <span>inferSchema</span><span>(</span><span>csvStr2</span><span>)</span><span>;</span>
<span>let</span> <span>parser2</span> <span>=</span> <span>initParser</span><span>(</span><span>schema2</span><span>)</span><span>;</span>

<span>let</span> <span>typedDeep</span> <span>=</span> <span>parser2</span><span>.</span><span>typedDeep</span><span>(</span><span>csvStr2</span><span>)</span><span>;</span>

<span>/*</span>
<span>[</span>
<span>  {</span>
<span>    _type: &#39;item&#39;,</span>
<span>    name: &#39;Item 0&#39;,</span>
<span>    description: &#39;Item 0 description in text&#39;,</span>
<span>    location: {</span>
<span>      city: &#39;Rotterdam&#39;,</span>
<span>      street: &#39;Main street&#39;,</span>
<span>      geo: [ 51.9280712, 4.4207888 ]</span>
<span>    },</span>
<span>    speed: 5.4,</span>
<span>    heading: 128.3,</span>
<span>    size: [ 3.4, 5.1, 0.9 ],</span>
<span>  }</span>
<span>]</span>
<span>*/</span></pre></div>
<p dir="auto"><strong>CSP Note:</strong></p>
<p dir="auto">uDSV uses dynamically-generated functions (via <code>new Function()</code>) for its <code>.typed*()</code> methods.
These functions are lazy-generated and use <code>JSON.stringify()</code> <a href="https://github.com/leeoniya/uDSV/commit/4e7472a7015c0a7ae5ae76e41f282bd4bdcf0c67">code-injection guards</a>, so the risk should be minimal.
Nevertheless, if you have strict <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="nofollow">CSP headers</a> without <code>unsafe-eval</code>, you won&#39;t be able to take advantage of the typed methods and will have to do the type conversion from the string tuples yourself.</p>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-incremental--streaming" aria-hidden="true" tabindex="-1" href="#incremental--streaming"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Incremental / Streaming</h3>
<p dir="auto">uDSV has no inherent knowledge of streams.
Instead, it exposes a generic incremental parsing API to which you can pass sequential chunks.
These chunks can come from various sources, such as a <a href="https://css-tricks.com/web-streams-everywhere-and-fetch-for-node-js/" rel="nofollow">Web Stream</a> or <a href="https://nodejs.org/api/stream.html" rel="nofollow">Node stream</a> via <code>fetch()</code> or <code>fs</code>, a <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" rel="nofollow">WebSocket</a>, etc.</p>
<p dir="auto">Here&#39;s what it looks like with Node&#39;s <a href="https://nodejs.org/api/fs.html#fscreatereadstreampath-options" rel="nofollow">fs.createReadStream()</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="let stream = fs.createReadStream(filePath);

let parser = null;
let result = null;

stream.on(&#39;data&#39;, (chunk) =&gt; {
  // convert from Buffer
  let strChunk = chunk.toString();
  // on first chunk, infer schema and init parser
  parser ??= initParser(inferSchema(strChunk));
  // incremental parse to string arrays
  parser.chunk(strChunk, parser.stringArrs);
});

stream.on(&#39;end&#39;, () =&gt; {
  result = p.end();
});"><pre><span>let</span> <span>stream</span> <span>=</span> <span>fs</span><span>.</span><span>createReadStream</span><span>(</span><span>filePath</span><span>)</span><span>;</span>

<span>let</span> <span>parser</span> <span>=</span> <span>null</span><span>;</span>
<span>let</span> <span>result</span> <span>=</span> <span>null</span><span>;</span>

<span>stream</span><span>.</span><span>on</span><span>(</span><span>&#39;data&#39;</span><span>,</span> <span>(</span><span>chunk</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>// convert from Buffer</span>
  <span>let</span> <span>strChunk</span> <span>=</span> <span>chunk</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>
  <span>// on first chunk, infer schema and init parser</span>
  <span>parser</span> <span>??=</span> <span>initParser</span><span>(</span><span>inferSchema</span><span>(</span><span>strChunk</span><span>)</span><span>)</span><span>;</span>
  <span>// incremental parse to string arrays</span>
  <span>parser</span><span>.</span><span>chunk</span><span>(</span><span>strChunk</span><span>,</span> <span>parser</span><span>.</span><span>stringArrs</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>stream</span><span>.</span><span>on</span><span>(</span><span>&#39;end&#39;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>result</span> <span>=</span> <span>p</span><span>.</span><span>end</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">...and Web streams <a href="https://nodejs.org/api/webstreams.html" rel="nofollow">in Node</a>, or <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/body" rel="nofollow">Fetch&#39;s Response.body</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="let stream = fs.createReadStream(filePath);

let webStream = Stream.Readable.toWeb(stream);
let textStream = webStream.pipeThrough(new TextDecoderStream());

let parser = null;

for await (const strChunk of textStream) {
  parser ??= initParser(inferSchema(strChunk));
  parser.chunk(strChunk, parser.stringArrs);
}

let result = parser.end();"><pre><span>let</span> <span>stream</span> <span>=</span> <span>fs</span><span>.</span><span>createReadStream</span><span>(</span><span>filePath</span><span>)</span><span>;</span>

<span>let</span> <span>webStream</span> <span>=</span> <span>Stream</span><span>.</span><span>Readable</span><span>.</span><span>toWeb</span><span>(</span><span>stream</span><span>)</span><span>;</span>
<span>let</span> <span>textStream</span> <span>=</span> <span>webStream</span><span>.</span><span>pipeThrough</span><span>(</span><span>new</span> <span>TextDecoderStream</span><span>(</span><span>)</span><span>)</span><span>;</span>

<span>let</span> <span>parser</span> <span>=</span> <span>null</span><span>;</span>

<span>for</span> <span>await</span> <span>(</span><span>const</span> <span>strChunk</span> <span>of</span> <span>textStream</span><span>)</span> <span>{</span>
  <span>parser</span> <span>??=</span> <span>initParser</span><span>(</span><span>inferSchema</span><span>(</span><span>strChunk</span><span>)</span><span>)</span><span>;</span>
  <span>parser</span><span>.</span><span>chunk</span><span>(</span><span>strChunk</span><span>,</span> <span>parser</span><span>.</span><span>stringArrs</span><span>)</span><span>;</span>
<span>}</span>

<span>let</span> <span>result</span> <span>=</span> <span>parser</span><span>.</span><span>end</span><span>(</span><span>)</span><span>;</span></pre></div>
<p dir="auto">The above examples show accumulating parsers -- they will buffer the full <code>result</code> into memory.
This may not be something you want (or need), for example with huge datasets where you&#39;re looking to get the sum of a single column, or want to filter only a small subset of rows.
To bypass this auto-accumulation behavior, simply pass your own handler as the third argument to <code>parser.chunk()</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// ...same as above

let sum = 0;

let reducer = (rows) =&gt; {
  for (let i = 0; i &lt; rows.length; i++) {
    sum += rows[i][3]; // sum fourth column
  }
};

for await (const strChunk of textStream) {
  parser ??= initParser(inferSchema(strChunk));
  parser.chunk(strChunk, parser.typedArrs, reducer); // typedArrs + reducer
}

parser.end();"><pre><span>// ...same as above</span>

<span>let</span> <span>sum</span> <span>=</span> <span>0</span><span>;</span>

<span>let</span> <span>reducer</span> <span>=</span> <span>(</span><span>rows</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>for</span> <span>(</span><span>let</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>rows</span><span>.</span><span>length</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span>
    <span>sum</span> <span>+=</span> <span>rows</span><span>[</span><span>i</span><span>]</span><span>[</span><span>3</span><span>]</span><span>;</span> <span>// sum fourth column</span>
  <span>}</span>
<span>}</span><span>;</span>

<span>for</span> <span>await</span> <span>(</span><span>const</span> <span>strChunk</span> <span>of</span> <span>textStream</span><span>)</span> <span>{</span>
  <span>parser</span> <span>??=</span> <span>initParser</span><span>(</span><span>inferSchema</span><span>(</span><span>strChunk</span><span>)</span><span>)</span><span>;</span>
  <span>parser</span><span>.</span><span>chunk</span><span>(</span><span>strChunk</span><span>,</span> <span>parser</span><span>.</span><span>typedArrs</span><span>,</span> <span>reducer</span><span>)</span><span>;</span> <span>// typedArrs + reducer</span>
<span>}</span>

<span>parser</span><span>.</span><span>end</span><span>(</span><span>)</span><span>;</span></pre></div>
<hr/>
<h3 tabindex="-1" dir="auto"><a id="user-content-todo" aria-hidden="true" tabindex="-1" href="#todo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>TODO?</h3>
<ul dir="auto">
<li>handle #comment rows</li>
<li>emit empty-row and #comment events?</li>
</ul>
</article>
          </div></div>
  </body>
</html>
