<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://schollz.com/blog/one-line/">Original</a>
    <h1>One-line drawings</h1>
    
    <div id="readability-page-1" class="page"><div>
            
<p><img src="https://schollz.com/img/oneline/people.png"/>
</p>

<p>There was a well-known painter in 1878 named <a href="https://babel.hathitrust.org/cgi/pt?id=hvd.fl4mls&amp;view=1up&amp;seq=27">James McNeill Whistler who was sued</a> for the prices of a painting because it had been created in only <em>two days</em>. He was ordered in court to explain the cost:</p>
<blockquote>
<p>“Oh, two days! The labour of two days, then, is that for which you ask two hundred guineas!”</p>
<p>“No;—I ask it for the knowledge of a lifetime.”</p>
</blockquote>
<p>This quote about charging high prices for small artworks eventually got <a href="https://quoteinvestigator.com/2018/01/14/time-art/">attributed to Picasso apocryphally</a>. Picasso’s paintings and drawings are among the most valuable, though he has a great many drawings that are exceedingly simplistic. In fact, Picasso create a whole <a href="https://www.pablopicasso.net/drawings/">series of drawings using sometimes just a single-line</a>.</p>
<p><img src="https://ae01.alicdn.com/kf/S01c634a3fe0940e9b101cf52f16162cfI/Pablo-Picasso-Print-Animals-Abstract-Art-One-Line-Drawings-Painting-Pictures-Wall-Art-Canvas-Prints-Sketches.jpg" alt="Picasso’s one line drawings"/></p>
<p>These drawings are simple and beautiful. I got to thinking about reproducing them. But instead of printing them with an inkjet printer, I was interested in drawing them in the style they were meant to be created - using <em>one line</em>.</p>
<h2 id="converting-a-drawing-to-a-one-line-drawing">Converting a drawing to a one-line drawing</h2>
<p>The drawings I am interested in reconstructing are done in one (but sometimes two or three) lines. To figure out the line, I would need to do several steps. I will be starting from a plain image - like a <code>.png</code> or <code>.jpg</code> file. The <code>.png</code>/<code>.jpg</code> is called a raster image. That is - it has information about pixels and intensities but no information about <em>lines</em>.</p>
<p>I would need a program to trace out the lines in the image and convert it to a coordinate system describing lines. This is what vector graphics are for - and there is a image format already encompassing it called <a href="https://developer.mozilla.org/en-US/docs/Web/SVG">scalable vector graphics (SVG)</a>.</p>
<p>Once I have the SVG file with the lines, I would need to gather up all the coordinates and the lines and consolidate the lines so that it creates a single seamless line.</p>
<h2 id="converting-a-raster-image-to-vector-graphics">Converting a raster image to vector graphics</h2>
<p>I am going to start with a simple line drawing - this one-line drawing of a person.</p>
<center>
<img src="https://schollz.com/img/oneline/person.png"/>
</center>
<p>Its pretty clear to see the one line with our human eyes, the challenge here will be to get a computer to also recognize it. The first thing to do is to convert it to a SVG, and we can use two programs: <a href="https://imagemagick.org/script/download.php"><code>imagemagick</code></a> and <a href="https://github.com/autotrace/autotrace"><code>autotrace</code></a>.</p>
<p>First, using <code>imagemagick</code>’s <code>convert</code> command, the image is thresholded and output into a format nessecary for the next tool.</p>
<pre tabindex="0"><code>&gt; convert person.jpg -threshold 60% person.tga
</code></pre><p>Next the resulting image <code>person.tga</code> can be converted using <code>autotrace</code> into a vector graphic file using the “centerline” algorithm that finds the skeleton center line.</p>
<pre tabindex="0"><code>&gt; autotrace -output-file person.svg --output-format svg --centerline person.tga
</code></pre><p>Great, now we have an SVG file (<code>person.svg</code>) to work with for the next step.</p>
<h2 id="parsing-svg-and-consolidating-lines">Parsing SVG and consolidating lines</h2>
<p>Parsing a SVG is standard thing to do and easy to do with lots of tools. The actual SVG content contains a list of coordinates in “paths” which are denoted by <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths">“line commands”</a>. Some of the coordinates are Bezier curves definitions which themselves need to be converted to absolute coordinates.</p>
<p>Also an SVG that looks like it contains only one line may not in fact contain one line. For example, part of the <code>person.svg</code> path looks like:</p>
<div><pre tabindex="0"><code data-lang="svg">...d=&#34;M47 31L45 33L47 31M127 83L139.821...
      ^                 ^                  
</code></pre></div><p>There are special letters (like “<code>M</code>&#34;) denoted where the path should move before starting the next stroke. The presence of these moves means that the SVG I have is actually multiple lines and not a single line.</p>
<p>I need to join these lines together, but first I need to re-order them in the correct order. To re-order the lines I wrote a simple algorithm that uses gradient descent to minimize the distances between subsequent end and start points of each line. This randomly looks through all possible combinations of lines until it finds the best one (though its not guaranteed to be the best).</p>
<p>Once I have that I can output a little animation showing the way the line moves by following the coordinates of my freshly ordered lines:</p>
<center>
<video src="/img/oneline/person.webm" autoplay="" loop="">
</video></center>
<p>Now that I have coordinates I can get to the drawing.</p>
<h2 id="now-for-the-actual-drawing">Now for the actual drawing</h2>
<p>This year my goal is to learn CAD design and to facilitate that I invested in a 3D printer. Of course 3D printers use plastic to make 3D things, but ironically one of my first 3D prints was to make a pen holder so I could make 2D things - I printed out a compatible pen holder (<a href="https://www.thingiverse.com/thing:4764350">Thingiverse thing:4764350</a> designed by <a href="https://www.thingiverse.com/366pete/designs">Pete Manville</a>).</p>
<p>Now to convert the SVG to Gcode. Gcode essentially produces an instruction to move in the X/Y/Z axis. Using special instructions (&#34;<code>G90</code>” and “<code>G91</code>&#34;) you can also switch between absolute/relative coordinate systems. can communicate in absolute and relative coordinates. I can just parse my SVG coordinates, and for each new line it will switch to relative coordinates, move the pen up (in the Z-axis), switch to absolute coordinates, move to the new line start, switch to relative coordinates, then move back down, and finally switch to absolute coordinates and go ahead and draw. It looks something like this:</p>
<pre tabindex="0"><code data-lang="gcode">G91 ; Set coordinates to relative
G1 Z10 F1000 ; raise pen
G90 ; Set coordinates to absolute
G1 X42.712 Y51.772 F1000
G91 ; Set coordinates to relative
G1 Z0 F1000 ; lower pen
G90 ; Set coordinates to absolute
G1 X41.137 Y52.487 F1000
</code></pre><p>Since 3D/CNC machines talk to computers over Serial, its simple enough for my program to simply upload the Gcode after converting the file so that it can draw.</p>
<center>
<video src="/img/oneline/personprint.mp4" autoplay="" loop="">
</video></center>
<p>And that’s it!</p>
<p>As a bonus I can use this same code to draw my own SVG’s and upload them to print really easily with this workflow.</p>
<h2 id="source-code">Source code</h2>
<p>The source code for everything in this post can be found on my Github: <a href="https://github.com/schollz/svg2gcode">schollz/svg2gcode</a>. The basic workflow is as follows:</p>
<pre tabindex="0"><code>&gt; # imagemagick to threshold image
&gt; convert IMAGE -resize 300x -background White -gravity center -threshold 60% 1.tga
&gt; # autotrace to get center line 
&gt; autotrace -output-file potrace.svg --output-format svg --centerline 1.tga
&gt; # convert to Gcode
&gt; svg2gcode convert --debug --png --in potrace.svg --out IMAGE -x 0 -y 0 --width 90 --height 90 --simplify 0.005 --consolidate 0.07 --min-length 0.03 --animate
&gt; # upload to printer
&gt; svg2gcode upload IMAGE.gcode


</code></pre>


        </div></div>
  </body>
</html>
