<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/phil294/AHK_X11">Original</a>
    <h1>Show HN: AutoHotkey for Linux</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">AutoHotkey for Linux.</p>
<div dir="auto">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="http://www.subsymbol.org/phil294/AHK_X11/blob/master/popup.png"><img src="http://www.subsymbol.org/phil294/AHK_X11/raw/master/popup.png" alt="MsgBox"/></a></p>
<p dir="auto"><code>MsgBox, AHK_X11</code> (*)</p>
</div>
<p dir="auto"><a href="https://github.com/phil294/ahk_x11/releases/latest/download/ahk_x11.zip"><strong>Direct download</strong></a> (all Linux distributions, x86_64, single executable)</p>
<p dir="auto"><a href="https://phil294.github.io/AHK_X11" rel="nofollow"><strong>FULL DOCUMENTATION</strong></a> (single HTML page)</p>
<p dir="auto"><a href="#installation"><strong>Go to installation instructions</strong></a></p>
<p dir="auto"><a href="https://www.autohotkey.com/" rel="nofollow">AutoHotkey</a> is &#34;Powerful. Easy to learn. The ultimate automation scripting language for Windows.&#34;. This project tries to bring large parts of that to Linux.</p>
<p dir="auto">More specifically: A very basic but functional reimplementation AutoHotkey v1.0.24 (2004) for Unix-like systems with an X window system (X11), written from ground up with <a href="https://crystal-lang.org/" rel="nofollow">Crystal</a>/<a href="https://github.com/jordansissel/xdotool">libxdo</a>/<a href="https://github.com/jhass/crystal-gobject">crystal-gobject</a>/<a href="https://github.com/TamasSzekeres/x11-cr/">x11-cr</a>/<a href="https://github.com/woodruffw/x_do.cr">x_do.cr</a>, with the eventual goal of 80% feature parity, but most likely never full compatibility. Currently about 60% of work is done. This AHK is shipped as a single executable native binary with very low resource overhead and fast execution time.</p>
<p dir="auto">Note that because of the old version of the spec, many modern AHK features are missing, especially expressions (<code>:=</code>, <code>% v</code>), classes, objects and functions, so you probably can&#39;t just port your scripts from Windows.</p>
<p dir="auto">You can use AHK_X11 to create stand-alone binaries with no dependencies, including full functionality like Hotkeys and GUIs. (just like on Windows)</p>
<p dir="auto">Please also check out <a href="https://bitbucket.org/mfeemster/keysharp/" rel="nofollow">Keysharp</a>, a WIP fork of <a href="https://github.com/Paris/IronAHK/tree/master/IronAHK">IronAHK</a>, another complete rewrite of AutoHotkey in C# that tries to be compatible with multiple OSes and support modern, v2-like AHK syntax with much more features than this one. In comparison, AHK_X11 is a lot less ambitious and more compact, and Linux only.</p>
<p dir="auto">Features:</p>
<ul>
<li> Hotkeys</li>
<li> Hotstrings (complete, but does not work <em>in some windows</em>: help needed)</li>
<li> Window management (but some commands are still missing)</li>
<li> Send keys</li>
<li> Control mouse (only clicks so far)</li>
<li> File management (but some commands are still missing)</li>
<li> GUIs (some controls are still missing)</li>
<li> One-click compile script to portable stand-alone executable</li>
<li> Scripting: labels, flow control: If/Else, Loop</li>
<li> Window Spy</li>
<li> Graphical installer (optional)</li>
<li> Context menu and compilation just like on Windows</li>
</ul>
<p dir="auto">Besides:</p>
<ul dir="auto">
<li>Interactive console (REPL)</li>
</ul>
<p dir="auto">AHK_X11 can be used completely without a terminal. You can however if you want use it console-only too. Graphical commands are optional, it also runs headless.</p>
<details><summary>Click to see which commands are implemented and which are missing. Note however that this is not very representative. For example, all `Gui` sub commands are missing. For a better overview on what is already done, skim through the <a href="https://phil294.github.io/AHK_X11" rel="nofollow">docs</a>.</summary>
<div dir="auto" data-snippet-clipboard-copy-content="DONE      34% (74/216):
+ Else, { ... }, Break, Continue, Return, Exit, GoSub, GoTo, IfEqual, Loop, SetEnv, Sleep, FileCopy,
+ SetTimer, WinActivate, MsgBox, Gui, SendRaw, #Persistent, ExitApp,
+ EnvAdd, EnvSub, EnvMult, EnvDiv, ControlSendRaw, IfWinExist/IfWinNotExist, SetWorkingDir,
+ FileAppend, Hotkey, Send, ControlSend, #Hotstring, Menu, FileCreateDir, FileDelete, IfMsgBox,
+ #SingleInstance, Edit, FileReadLine, FileSelectFile, FileSelectFolder, FileSetAttrib, FileSetTime,
+ IfNotEqual, If var [not] between, IfExist/IfNotExist, IfGreater/IfGreaterOrEqual,
+ IfInString/IfNotInString, IfLess/IfLessOrEqual, IfWinActive/IfWinNotActive, IniDelete, IniRead,
+ IniWrite, Loop (files &amp; folders), Loop (read file contents), MouseClick, Pause, Reload,
+ StringGetPos, StringLeft, StringLen, StringLower, StringMid, StringReplace, StringRight,
+ StringUpper, Suspend, URLDownloadToFile, WinClose, WinGetPos, WinKill, WinMaximize, WinMinimize,
+ WinMove, WinRestore

NEW       2% (5/216): (not part of spec)
@@ Echo, ahk_x11_print_vars, FileRead, RegExGetPos, RegExReplace @@

REMOVED   10% (22/216):
# ### Those that simply make no sense in Linux:
# EnvSet, EnvUpdate, PostMessage, RegDelete, RegRead, RegWrite, SendMessage, #InstallKeybdHook, 
# #InstallMouseHook, #UseHook, Loop (registry)
#
# ### &#34;Control&#34; commands are impossible with X11, I *think*?
# Control, ControlClick, ControlFocus, ControlGet, ControlGetFocus, 
# ControlGetPos, ControlGetText, ControlMove, ControlSetText, SetControlDelay
#
# ### Skipped for other reasons:
# AutoTrim: It&#39;s always Off. It would not differentiate between %a_space% and %some_var%.
#           It&#39;s possible but needs significant work.

TO DO     216% (113/216): alphabetically
- BlockInput, ClipWait, CoordMode, 
- DetectHiddenText, DetectHiddenWindows, Drive, DriveGet, DriveSpaceFree,
- FileCopyDir, FileCreateShortcut,
- FileInstall, FileGetAttrib, FileGetShortcut, FileGetSize, FileGetTime, FileGetVersion,
- FileMove, FileMoveDir, FileRecycle, FileRecycleEmpty, FileRemoveDir,
- FormatTime, GetKeyState, GroupActivate, GroupAdd,
- GroupClose, GroupDeactivate, GuiControl, GuiControlGet,
- If var [not] in/contains MatchList, If var is [not] type, Input, 
- InputBox, KeyHistory, KeyWait, ListHotkeys, ListLines, ListVars, Loop (parse a string),
- MouseClickDrag, MouseGetPos, MouseMove, OnExit, PixelGetColor, PixelSearch, 
- Process, Progress, Random, RunAs, SetBatchLines, 
- SetCapslockState, SetDefaultMouseSpeed, SetFormat, SetKeyDelay, SetMouseDelay, 
- SetNumlockState, SetScrollLockState, SetStoreCapslockMode, SetTitleMatchMode, 
- SetWinDelay, Shutdown, Sort, SoundGet, SoundGetWaveVolume, SoundPlay, SoundSet, 
- SoundSetWaveVolume, SplashImage, SplashTextOn, SplashTextOff, SplitPath, StatusBarGetText, 
- StatusBarWait, StringCaseSense, StringSplit, StringTrimLeft, StringTrimRight,
- SysGet, Thread, ToolTip, Transform, TrayTip, WinActivateBottom,
- WinGetActiveStats, WinGetActiveTitle, WinGetClass, WinGet, WinGetText,
- WinGetTitle, WinHide, WinMenuSelectItem, WinMinimizeAll,
- WinMinimizeAllUndo, WinSet, WinSetTitle, WinShow, WinWait, WinWaitActive, 
- WinWaitClose, WinWaitNotActive, #CommentFlag, #ErrorStdOut, #EscapeChar, 
- #HotkeyInterval, #HotkeyModifierTimeout, #Include, #MaxHotkeysPerInterval, #MaxMem, 
- #MaxThreads, #MaxThreadsBuffer, #MaxThreadsPerHotkey, #NoTrayIcon, #WinActivateForce"><pre>DONE      34% (74/216):
<span><span>+</span> Else, { ... }, Break, Continue, Return, Exit, GoSub, GoTo, IfEqual, Loop, SetEnv, Sleep, FileCopy,</span>
<span><span>+</span> SetTimer, WinActivate, MsgBox, Gui, SendRaw, #Persistent, ExitApp,</span>
<span><span>+</span> EnvAdd, EnvSub, EnvMult, EnvDiv, ControlSendRaw, IfWinExist/IfWinNotExist, SetWorkingDir,</span>
<span><span>+</span> FileAppend, Hotkey, Send, ControlSend, #Hotstring, Menu, FileCreateDir, FileDelete, IfMsgBox,</span>
<span><span>+</span> #SingleInstance, Edit, FileReadLine, FileSelectFile, FileSelectFolder, FileSetAttrib, FileSetTime,</span>
<span><span>+</span> IfNotEqual, If var [not] between, IfExist/IfNotExist, IfGreater/IfGreaterOrEqual,</span>
<span><span>+</span> IfInString/IfNotInString, IfLess/IfLessOrEqual, IfWinActive/IfWinNotActive, IniDelete, IniRead,</span>
<span><span>+</span> IniWrite, Loop (files &amp; folders), Loop (read file contents), MouseClick, Pause, Reload,</span>
<span><span>+</span> StringGetPos, StringLeft, StringLen, StringLower, StringMid, StringReplace, StringRight,</span>
<span><span>+</span> StringUpper, Suspend, URLDownloadToFile, WinClose, WinGetPos, WinKill, WinMaximize, WinMinimize,</span>
<span><span>+</span> WinMove, WinRestore</span>

NEW       2% (5/216): (not part of spec)
<span>@@ Echo, ahk_x11_print_vars, FileRead, RegExGetPos, RegExReplace @@</span>

REMOVED   10% (22/216):
<span><span>#</span> ### Those that simply make no sense in Linux:</span>
<span><span>#</span> EnvSet, EnvUpdate, PostMessage, RegDelete, RegRead, RegWrite, SendMessage, #InstallKeybdHook, </span>
<span><span>#</span> #InstallMouseHook, #UseHook, Loop (registry)</span>
<span><span>#</span></span>
<span><span>#</span> ### &#34;Control&#34; commands are impossible with X11, I *think*?</span>
<span><span>#</span> Control, ControlClick, ControlFocus, ControlGet, ControlGetFocus, </span>
<span><span>#</span> ControlGetPos, ControlGetText, ControlMove, ControlSetText, SetControlDelay</span>
<span><span>#</span></span>
<span><span>#</span> ### Skipped for other reasons:</span>
<span><span>#</span> AutoTrim: It&#39;s always Off. It would not differentiate between %a_space% and %some_var%.</span>
<span><span>#</span>           It&#39;s possible but needs significant work.</span>

TO DO     216% (113/216): alphabetically
<span><span>-</span> BlockInput, ClipWait, CoordMode, </span>
<span><span>-</span> DetectHiddenText, DetectHiddenWindows, Drive, DriveGet, DriveSpaceFree,</span>
<span><span>-</span> FileCopyDir, FileCreateShortcut,</span>
<span><span>-</span> FileInstall, FileGetAttrib, FileGetShortcut, FileGetSize, FileGetTime, FileGetVersion,</span>
<span><span>-</span> FileMove, FileMoveDir, FileRecycle, FileRecycleEmpty, FileRemoveDir,</span>
<span><span>-</span> FormatTime, GetKeyState, GroupActivate, GroupAdd,</span>
<span><span>-</span> GroupClose, GroupDeactivate, GuiControl, GuiControlGet,</span>
<span><span>-</span> If var [not] in/contains MatchList, If var is [not] type, Input, </span>
<span><span>-</span> InputBox, KeyHistory, KeyWait, ListHotkeys, ListLines, ListVars, Loop (parse a string),</span>
<span><span>-</span> MouseClickDrag, MouseGetPos, MouseMove, OnExit, PixelGetColor, PixelSearch, </span>
<span><span>-</span> Process, Progress, Random, RunAs, SetBatchLines, </span>
<span><span>-</span> SetCapslockState, SetDefaultMouseSpeed, SetFormat, SetKeyDelay, SetMouseDelay, </span>
<span><span>-</span> SetNumlockState, SetScrollLockState, SetStoreCapslockMode, SetTitleMatchMode, </span>
<span><span>-</span> SetWinDelay, Shutdown, Sort, SoundGet, SoundGetWaveVolume, SoundPlay, SoundSet, </span>
<span><span>-</span> SoundSetWaveVolume, SplashImage, SplashTextOn, SplashTextOff, SplitPath, StatusBarGetText, </span>
<span><span>-</span> StatusBarWait, StringCaseSense, StringSplit, StringTrimLeft, StringTrimRight,</span>
<span><span>-</span> SysGet, Thread, ToolTip, Transform, TrayTip, WinActivateBottom,</span>
<span><span>-</span> WinGetActiveStats, WinGetActiveTitle, WinGetClass, WinGet, WinGetText,</span>
<span><span>-</span> WinGetTitle, WinHide, WinMenuSelectItem, WinMinimizeAll,</span>
<span><span>-</span> WinMinimizeAllUndo, WinSet, WinSetTitle, WinShow, WinWait, WinWaitActive, </span>
<span><span>-</span> WinWaitClose, WinWaitNotActive, #CommentFlag, #ErrorStdOut, #EscapeChar, </span>
<span><span>-</span> #HotkeyInterval, #HotkeyModifierTimeout, #Include, #MaxHotkeysPerInterval, #MaxMem, </span>
<span><span>-</span> #MaxThreads, #MaxThreadsBuffer, #MaxThreadsPerHotkey, #NoTrayIcon, #WinActivateForce</span></pre></div>
</details>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<p dir="auto">Prerequisites:</p>
<ul dir="auto">
<li>X11 and GTK are the only dependencies. You most likely have them already. Wayland support would be cool too some day.</li>
<li>Old distros like Debian <em>before</em> 10 (Buster) or Ubuntu <em>before</em> 18.04 are not supported (<a href="https://github.com/jhass/crystal-gobject/issues/73#issuecomment-661235729" data-hovercard-type="issue" data-hovercard-url="/jhass/crystal-gobject/issues/73/hovercard">reason</a>). Otherwise, it should not matter what system you use.</li>
</ul>
<p dir="auto">Then, you can download the latest binary from the <a href="https://github.com/phil294/AHK_X11/releases">release section</a>. Make the downloaded file executable and you should be good to go.</p>
<p dir="auto">There is no auto updater yet! (but planned) You will probably want to get the latest version then and again.</p>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<p dir="auto">There are different ways to use it.</p>
<ol dir="auto">
<li>The graphical way, like on Windows: Running the program directly opens up the interactive installer.
<ul dir="auto">
<li>Once installed, all <code>.ahk</code> files are associated with AHK_X11, so you can simply double click them.</li>
<li>Also adds the Compiler into <code>Open as...</code> Menus.</li>
</ul>
</li>
<li>Command line: Pass the script to execute as first parameter, e.g. <code>./ahk_x11 &#34;path to your script.ahk&#34;</code>
<ul dir="auto">
<li>Once your script&#39;s auto-execute section has finished, you can also execute arbitrary single line commands in the console. Code blocks aren&#39;t supported yet in that situation. Those single lines each run in their separate threads, which is why variables like <code>%ErrorLevel%</code> will always be <code>0</code>.</li>
<li>When you don&#39;t want to pass a script, you can specify <code>--repl</code> instead (implicit <code>#Persistent</code>).</li>
<li>If you want to pass your command from stdin instead of file, do it like this: <code>./ahk_x11 /dev/stdin &lt;&lt;&lt; &#39;MsgBox&#39;</code>.</li>
<li>Compile scripts with `./ahk_x11 --compile &#34;path/script.ahk&#34;</li>
<li>Hashbang supported if first line starts with <code>#!</code></li>
</ul>
</li>
</ol>
<h3 dir="auto"><a id="user-content-caveats" aria-hidden="true" href="#caveats"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Caveats</h3>
<h4 dir="auto"><a id="user-content-focus-stealing-prevention" aria-hidden="true" href="#focus-stealing-prevention"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Focus stealing prevention</h4>
<p dir="auto">Some Linux distros offer a configurable setting for focus stealing prevention. Usually, it&#39;s default off. But if you have activated it, window focus changing actions like <code>MsgBox</code> or <code>WinActivate</code> will not work as expected: A <code>MsgBox</code> will appear hidden <em>behind</em> the active window. This can be useful to prevent accidental popup dismissal but when you don&#39;t like that, you have three options:</p>
<ul dir="auto">
<li>
<p dir="auto">disable said setting</p>
</li>
<li>
<p dir="auto">use the <code>always on top</code> setting of MsgBox</p>
</li>
<li>
<details><summary>hack around it with code</summary>
<div dir="auto" data-snippet-clipboard-copy-content="SetTimer, MsgBoxToFront, 1
MsgBox, Hello
Return

MsgBoxToFront:
SetTimer, MsgBoxToFront, off
; You might want to adjust the matching criteria, especially for compiled scripts
WinActivate ahk_class ahk_x11
return"><pre><span>SetTimer</span>, MsgBoxToFront, <span>1</span>
<span>MsgBox</span>, Hello
<span>Return</span>

<span>MsgBoxToFront</span>:
<span>SetTimer</span>, MsgBoxToFront, <span>off</span>
<span><span>;</span> You might want to adjust the matching criteria, especially for compiled scripts</span>
<span>WinActivate</span> <span>ahk_class</span> ahk_x11
<span>return</span></pre></div>
</details></li>
</ul>
<h4 dir="auto"><a id="user-content-appearance" aria-hidden="true" href="#appearance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Appearance</h4>
<p dir="auto">(*) The <code>MsgBox</code> picture at the top was taken on a XFCE system with <a href="https://github.com/grassmunk/Chicago95">Chicago95</a> installed, a theme that resembles Win95 look&amp;feel. On your system, it will look like whatever GTK popups always look like.</p>
<h2 dir="auto"><a id="user-content-development" aria-hidden="true" href="#development"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Development</h2>
<p dir="auto">These are the steps required to build this project locally, such as if you want to contribute to the project. Please open an issue if anything doesn&#39;t work.</p>
<p dir="auto">You don&#39;t need to follow this steps to <em>use</em> AHK_X11, for that, please see Installation above.</p>
<ol dir="auto">
<li>Install development versions of prerequisites.
<ol dir="auto">
<li>Ubuntu 20.04 and up:
<ol dir="auto">
<li>Dependencies
<div data-snippet-clipboard-copy-content="sudo apt-get install libxinerama-dev libxkbcommon-dev libxtst-dev libgtk-3-dev libxi-dev libx11-dev libgirepository1.0-dev"><pre><code>sudo apt-get install libxinerama-dev libxkbcommon-dev libxtst-dev libgtk-3-dev libxi-dev libx11-dev libgirepository1.0-dev
</code></pre></div>
</li>
<li><a href="https://crystal-lang.org/install/" rel="nofollow">Install</a> Crystal and Shards (Shards is typically included in Crystal installation)</li>
</ol>
</li>
<li>Arch Linux:
<div data-snippet-clipboard-copy-content="sudo pacman -S crystal shards gcc libxkbcommon libxinerama libxtst gtk3 gc"><pre><code>sudo pacman -S crystal shards gcc libxkbcommon libxinerama libxtst gtk3 gc
</code></pre></div>
</li>
</ol>
</li>
<li><code>git clone https://github.com/phil294/AHK_X11</code></li>
<li><code>cd AHK_X11</code></li>
<li>Run these commands one by one (I haven&#39;t double checked them, so it&#39;s best to go through them manually). Most of it is all WIP and temporary and only necessary so the different dependencies get along fine (x11 and gobject bindings). As a bonus, the <code>build_namespace</code> invocations cache the GIR (<code>require_gobject</code> calls) and thus reduce the overall compile time from ~6 to ~3 seconds.
<div dir="auto" data-snippet-clipboard-copy-content="shards install
# populate cache
crystal run lib/gobject/src/generator/build_namespace.cr -- Gtk 3.0 &gt; lib/gobject/src/gtk/gobject-cache-gtk.cr
crystal run lib/gobject/src/generator/build_namespace.cr -- xlib 2.0 &gt; lib/gobject/src/gtk/gobject-cache-xlib--modified.cr
for lib in &#34;GObject 2.0&#34; &#34;GLib 2.0&#34; &#34;Gio 2.0&#34; &#34;GModule 2.0&#34; &#34;Atk 1.0&#34; &#34;freetype2&#34; &#34;HarfBuzz 0.0&#34; &#34;GdkPixbuf 2.0&#34; &#34;cairo 1.0&#34; &#34;Pango 1.0&#34; &#34;Gdk 3.0&#34;; do
    echo &#34;### $lib&#34; &gt;&gt; lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr
    crystal run lib/gobject/src/generator/build_namespace.cr -- $lib &gt;&gt; lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr
done
# update lib to use cache
sed -i -E &#39;s/^(require_gobject)/# \1/g&#39; lib/gobject/src/gtk/gobject-cache-gtk.cr lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr
sed -i -E &#39;s/^require_gobject &#34;Gtk&#34;, &#34;3.0&#34;$/require &#34;.\/gobject-cache-gtk&#34;/&#39; lib/gobject/src/gtk/gtk.cr
echo &#39;require &#34;./gobject-cache-xlib--modified&#34;&#39; &gt; tmp.txt; echo &#39;require &#34;./gobject-cache-gtk-other-deps&#34;&#39; &gt;&gt; tmp.txt; cat lib/gobject/src/gtk/gobject-cache-gtk.cr &gt;&gt; tmp.txt; mv tmp.txt lib/gobject/src/gtk/gobject-cache-gtk.cr
echo &#39;macro require_gobject(namespace, version = nil) end&#39; &gt;&gt; lib/gobject/src/gobject.cr
# delete conflicting c function binding by modifying the cache
sed -i -E &#39;s/  fun open_display = XOpenDisplay : Void$//&#39; lib/gobject/src/gtk/gobject-cache-xlib--modified.cr
# https://github.com/jhass/crystal-gobject/issues/103
sed -i -E &#39;s/(def self.new_from_stream.+: self)$/\1?/g&#39; lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr"><pre>shards install
<span><span>#</span> populate cache</span>
crystal run lib/gobject/src/generator/build_namespace.cr -- Gtk 3.0 <span>&gt;</span> lib/gobject/src/gtk/gobject-cache-gtk.cr
crystal run lib/gobject/src/generator/build_namespace.cr -- xlib 2.0 <span>&gt;</span> lib/gobject/src/gtk/gobject-cache-xlib--modified.cr
<span>for</span> <span>lib</span> <span>in</span> <span><span>&#34;</span>GObject 2.0<span>&#34;</span></span> <span><span>&#34;</span>GLib 2.0<span>&#34;</span></span> <span><span>&#34;</span>Gio 2.0<span>&#34;</span></span> <span><span>&#34;</span>GModule 2.0<span>&#34;</span></span> <span><span>&#34;</span>Atk 1.0<span>&#34;</span></span> <span><span>&#34;</span>freetype2<span>&#34;</span></span> <span><span>&#34;</span>HarfBuzz 0.0<span>&#34;</span></span> <span><span>&#34;</span>GdkPixbuf 2.0<span>&#34;</span></span> <span><span>&#34;</span>cairo 1.0<span>&#34;</span></span> <span><span>&#34;</span>Pango 1.0<span>&#34;</span></span> <span><span>&#34;</span>Gdk 3.0<span>&#34;</span></span><span>;</span> <span>do</span>
    <span>echo</span> <span><span>&#34;</span>### <span>$lib</span><span>&#34;</span></span> <span>&gt;&gt;</span> lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr
    crystal run lib/gobject/src/generator/build_namespace.cr -- <span>$lib</span> <span>&gt;&gt;</span> lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr
<span>done</span>
<span><span>#</span> update lib to use cache</span>
sed -i -E <span><span>&#39;</span>s/^(require_gobject)/# \1/g<span>&#39;</span></span> lib/gobject/src/gtk/gobject-cache-gtk.cr lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr
sed -i -E <span><span>&#39;</span>s/^require_gobject &#34;Gtk&#34;, &#34;3.0&#34;$/require &#34;.\/gobject-cache-gtk&#34;/<span>&#39;</span></span> lib/gobject/src/gtk/gtk.cr
<span>echo</span> <span><span>&#39;</span>require &#34;./gobject-cache-xlib--modified&#34;<span>&#39;</span></span> <span>&gt;</span> tmp.txt<span>;</span> <span>echo</span> <span><span>&#39;</span>require &#34;./gobject-cache-gtk-other-deps&#34;<span>&#39;</span></span> <span>&gt;&gt;</span> tmp.txt<span>;</span> cat lib/gobject/src/gtk/gobject-cache-gtk.cr <span>&gt;&gt;</span> tmp.txt<span>;</span> mv tmp.txt lib/gobject/src/gtk/gobject-cache-gtk.cr
<span>echo</span> <span><span>&#39;</span>macro require_gobject(namespace, version = nil) end<span>&#39;</span></span> <span>&gt;&gt;</span> lib/gobject/src/gobject.cr
<span><span>#</span> delete conflicting c function binding by modifying the cache</span>
sed -i -E <span><span>&#39;</span>s/  fun open_display = XOpenDisplay : Void$//<span>&#39;</span></span> lib/gobject/src/gtk/gobject-cache-xlib--modified.cr
<span><span>#</span> https://github.com/jhass/crystal-gobject/issues/103</span>
sed -i -E <span><span>&#39;</span>s/(def self.new_from_stream.+: self)$/\1?/g<span>&#39;</span></span> lib/gobject/src/gtk/gobject-cache-gtk-other-deps.cr</pre></div>
</li>
<li>Now everything is ready for local use with <code>shards build -Dpreview_mt</code>, if you have <code>libxdo</code> (xdotool) version 2016x installed. Read on for a cross-distro compatible build.</li>
<li>In <code>lib/x_do/src/x_do/libxdo.cr</code>, add line <code>role : LibC::Char*</code> <em>after</em> <code>winname : LibC::Char*</code></li>
<li>add <code>xdo_quit_window</code> TODO: Waiting for a PR on <code>x_do.cr</code>, so for now, probably best just comment out the failing lines later on in <code>win-close</code> and <code>win-maximize</code> and <code>win-restore</code></li>
<li>add <code>xdo_set_state</code> TODO: same as above</li>
<li>To make AHK_X11 maximally portable, various dependencies should be statically linked. This is especially important because of the script compilation feature: You can use the binary to transform a script into a new stand-alone binary, and that resulting binary should be portable across various Linux distributions without ever requiring the user to install any dependencies. Here is an overview of all dependencies. All of this was tested on Ubuntu 18.04.
<ul dir="auto">
<li>Should be statically linked:
<ul dir="auto">
<li><code>libxdo</code>. Additionally to the above reasons, it isn&#39;t backwards compatible (e.g. Ubuntu 18.04 and 20.04 versions are incompatible) and may introduce even more breaking changes in the future. Also, we fix a rarely occurring fatal error here (probably Crystal-specific?). So,
<ul dir="auto">
<li>clone <a href="https://github.com/jordansissel/xdotool">xdotool</a> somewhere, in there,</li>
<li>in <code>xdo.c</code>, after <code>data = xdo_get_window_property_by_atom(xdo, wid, request, &amp;nitems, &amp;type, &amp;size);</code>, add another <code>if(data == NULL) return XDO_ERROR;</code></li>
<li>run <code>make clean &amp;&amp; make libxdo.a</code> and then copy the file <code>libxdo.a</code> into our <code>static</code> folder (create if it doesn&#39;t exist yet).</li>
</ul>
</li>
<li>Dependencies of <code>libxdo</code>: <code>libxkbcommon</code>, <code>libXtst</code> and <code>libXi</code>. The static libraries should be available from your package manager dependencies installed above so normally there&#39;s nothing you need to do.</li>
<li>More dependencies of <code>libxdo</code> which are also available from the packages, but their linking fails with obscure PIE errors: <code>libXinerama</code> and <code>libXext</code>. I solved this by getting the source for these two and building the <code>.a</code> files locally (but apparently no makefile changes were required). Not very sure if these aren&#39;t actually part of every standard <code>libx11</code> install anyway, so maybe they should be dynamic...</li>
<li>Other (crystal dependencies?), also via package manager: <code>libevent_pthreads</code>, <code>libevent</code>, and <code>libpcre</code></li>
<li><code>libgc</code> is currently shipped and linked automatically by Crystal itself so there is no need for it</li>
</ul>
</li>
<li>Stays dynamically linked:
<ul dir="auto">
<li><code>libgtk-3</code> and its dependencies, because afaik Gtk is installed everywhere, even on Qt-based distros. If you know of any common distribution that does not include Gtk libs by default please let me know. Gtk does also not officially support static linking. <code>libgtk-3</code>, <code>libgd_pixbuf-2.0</code>, <code>libgio-2.0</code>, <code>libgobject-2.0</code>, <code>libglib-2.0</code>, <code>libgobject-2.0</code></li>
<li>glibc / unproblematic libraries according to <a href="https://github.com/AppImage/pkg2appimage/blob/master/excludelist">this list</a>: <code>libX11</code>, <code>libm</code>, <code>libpthread</code>, <code>librt</code>, <code>libdl</code>.</li>
</ul>
</li>
</ul>
</li>
<li>All in all, once you have <code>libxdo.a</code>, <code>libXext.a</code> and <code>libXinerama.a</code> inside the folder <code>static</code>, the following builds the final binary which should be very portable: <code>shards build -Dpreview_mt --link-flags=&#34;-L$PWD/static -Wl,-Bstatic -lxdo -lxkbcommon -lXinerama -lXext -lXtst -lXi -levent_pthreads -levent -lpcre -Wl,-Bdynamic&#34;</code>. When not in development, increase optimizations and runtime speed by adding <code>--release</code>. The resulting binary is about 3.6 MiB in size.</li>
<li>Attach the installer with <code>bin/ahk_x11 --compile src/installer.ahk tmp &amp;&amp; mv tmp bin/ahk_x11</code>. Explanation: The installer is not shipped separately and instead bundled with the binary by doing this. Bundling is the same thing as compiling a script as a user. As you can see, it is possible to repeatedly compile a binary, with each script being appended at the end each time. Only the last one actually executed - and only if no params are passed to the program. There&#39;s no point in compiling multiple times, but it allows us to ship a default script (the installer) for when no arguments are passed. In other words, this is possible for a user: <code>ahk_x11 --compile script1.ahk &amp;&amp; ./script1 --compile script2.ahk &amp;&amp; ./script2</code> but no one will ever do that.</li>
</ol>
<h2 dir="auto"><a id="user-content-performance" aria-hidden="true" href="#performance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Performance</h2>
<p dir="auto">Not yet explicitly tuned for performance, but by design and choice of technology, it should run reasonably fast. Most recent tests yielded 0.03 ms for parsing one instruction line (this happens once at startup). Execution speed even is at least x100 faster than that.</p>
<p dir="auto">TODO: speed measurements for <code>Send</code> and window operations</p>
<h2 dir="auto"><a id="user-content-contributing" aria-hidden="true" href="#contributing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contributing</h2>
<p dir="auto">If you feel like it, you are welcome to contribute. This program has a very modular structure due to its nature which should make it easier to add features. Most work pending is just implementing commands, as almost everything more complicated is now bootstrapped. Simply adhere to the 2004 spec chm linked above. There&#39;s documentation blocks all across the source.</p>
<p dir="auto">Commands behave mostly autonomous. See for example <a href="https://github.com/phil294/AHK_X11/blob/master/src/cmd/file/file-copy.cr"><code>src/cmd/file/file-copy.cr</code></a>: All that is needed for most commands is <code>min_args</code>, <code>max_args</code>, the <code>run</code> implementation and the correct class name: The last part of the class name (here <code>FileCopy</code>) is automatically inferred to be the actual command name in scripts.
Regarding <code>run</code>: Anything can happen here, but several commands will access the <code>thread</code> or <code>thread.runner</code>, mostly for <code>thread.runner.get_user_var</code>, <code>thread.get_var</code> and <code>thread.runner.set_user_var</code>.</p>
<p dir="auto">GUI: Several controls and their options still need to be translated into GTK. For that, both the <a href="https://docs.gtk.org/gtk3" rel="nofollow">GTK Docs for C</a> and <code>lib/gobject/src/gtk/gobject-cache-gtk.cr</code> are helpful.</p>
<p dir="auto">A more general overview:</p>
<ul dir="auto">
<li><code>src/build</code> does the parsing etc. and is mostly complete</li>
<li><code>src/run/runner</code> and <code>src/run/thread</code> are worth looking into, this is the heart of the application and where global and thread state is stored</li>
<li><code>src/cmd</code> contains all commands exposed to the user.</li>
<li>There&#39;s <em>three</em> libraries included which somehow interact with the X server: <code>x_do.cr</code> for automatization (window, keyboard, mouse) as <code>runner.x_do</code>, <code>crystal-gobject</code> for Gtk (<code>Gui</code>, <code>MsgBox</code>) as <code>runner.gui</code> (<code>gui.cr</code>), and <code>x11-cr</code> for low-level X interaction (hotkeys, hotstrings) as <code>runner.x11</code> (<code>x11.cr</code>).</li>
</ul>
<p dir="auto">There&#39;s also several <code>TODO:</code>s scattered around all source files mostly around technical problems that need some revisiting.</p>
<p dir="auto">While Crystal brings its own hidden <code>::Thread</code> class, any reference to <code>Thread</code> in the source refers to <code>Run::Thread</code> which actually are no real threads (see <a href="https://github.com/phil294/AHK_X11/blob/master/src/run/thread.cr"><code>Run::Thread</code></a> docs).</p>
<h2 dir="auto"><a id="user-content-issues" aria-hidden="true" href="#issues"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Issues</h2>
<p dir="auto">For bugs and feature requests, please open up an issue. I am also available on the AHK Discord server or the <a href="https://www.autohotkey.com/boards/viewtopic.php?f=81&amp;t=106640" rel="nofollow">forum</a>.</p>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto"><a href="https://tldrlegal.com/license/gnu-general-public-license-v2" rel="nofollow">GPL-2.0</a></p>
</article>
          </div></div>
  </body>
</html>
