<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.julipode.net/2023/12/01/We_made_an_apple_ii_selfie_studio.html">Original</a>
    <h1>We made an Apple ][ Selfie Studio</h1>
    
    <div id="readability-page-1" class="page"><div onmouseover="hue(true, ``)" onmouseleave="hue(false)">
        
        <p>I’m currently at the <a href="https://www.recurse.com/">Recurse Center</a> in  New York, basically having fun and learning a lot…ok</p>

<p>A few of us have been hacking at the Apple ][ in the space, and decided to make a web/rust/audio selfie studio maker, here’s what it looks like:</p>

<p><img src="https://www.julipode.net/assets/images/apple2.jpg"/>
</p>

<!--more-->

<h2 id="what-is-all-of-this">What is all of this?</h2>

<h3 id="apple-">Apple ][</h3>
<p>The Apple ][ can accept audio as data to write directly to memory. It also has a ‘<a href="https://en.wikipedia.org/wiki/Apple_II_graphics#High-Resolution_(Hi-Res)_graphics">high graphics mode</a>’ which we can write directly to using the audio method. I basically just wanted a quick way to make drawings on my computer and put them onto the Apple ][…
The <a href="https://archive.org/details/Apple_IIe_Technical_Reference_Manual/page/n67/mode/2up?view=theater">memory mapping</a> is crazy, idk what to say</p>

<h3 id="rust-bas2wav">Rust bas2wav</h3>
<p>Kevan Hollbach, also at RC, recently published <a href="https://crates.io/crates/bas2wav">bas2wav</a>, a rust crate which converts BASIC programs to wav files to run on the Apple ][. It wasn’t too much of a leap for us to adapt the code to translate images and other arbitrary data to a wav file. We followed a <a href="https://rustwasm.github.io/docs/book/introduction.html">wasm tutorial</a>, and surprisingly it just worked - we could pass data from javascript to the rust code and get audio back, all client-side!!</p>

<p>Here’s a snippet from Kevan’s crate:</p>

<pre><code>
/// Three-quarters of the maximum voltage value, assuming each sample is i8.
const AMPLITUDE: f64 = i8::MAX as f64 * 3. / 4.;

fn sine_wave(wav: &amp;mut Wav, freq: f64, dur: Duration, invert: bool) -&gt; Result&lt;()&gt; {
    let num_samples = dur.as_secs_f64() * wav.spec().sample_rate as f64;
    for i in 0..num_samples as u32 {
        let time = i as f64 / wav.spec().sample_rate as f64; // (in seconds)
        let sign = if invert { -1. } else { 1. };
        let sample = (time * freq * 2. * PI).sin() * sign; // [-1, 1]
        wav.write_sample((sample * AMPLITUDE) as i8)?; // [i8::MIN, i8::MAX]
    }
    Ok(())
}
</code>
</pre>

<h3 id="website">Website</h3>
<p>First we made a little pixel editor with html, envisioning a sort of MS Paint that exports to wav files for the Apple ][.
If you upload an image, we convert the data to HSL, pick some lightness threshold with a slider, and use that to convert to black and white.</p>

<p>Whatever is on the canvas is mapped in an array to the correct Apple ][ graphics memory layout, then the most significant bit is discarded, then the 7 bit-memory-mapped pixel data is fed into the rust crate, and the audio that comes out of that is finally played using an &lt;audio&gt; element.</p>

<pre><code>
// I told you the memory mapping&#39;s crazy
function pixelsToMemory(pixelBytes) {
    let mem = new Array(8192).fill(0);
    let i = 0;
    for (let band = 0; band &lt; 3; band++) {
        for (let block_row = 0; block_row &lt; 8; block_row++) {
            for (let pixel_row = 0; pixel_row &lt; 8; pixel_row++) {
                for (let block_column = 0; block_column &lt; 40; block_column++) {
                    let mem_offset = band * 0x28 + block_row * 0x80 + pixel_row * 0x400 + block_column;
                    mem[mem_offset] = pixelBytes[i];
                    i++;
                }
            }
        }
    }
    return mem;
}
</code>
</pre>

<h3 id="go-ahead">Go ahead</h3>

<p>Upload a picture, have fun! Make a drawing :)
Oh yeah if you have access to an Apple ][, here are the steps:</p>
<ul>
  <li>Control + Reset</li>
  <li>HGR</li>
  <li>CALL -151</li>
  <li>2000.3FFFR</li>
  <li>Click the “Save” button (Make sure you computer’s audio output is going into the Apple ][)</li>
  <li>We’ll release the web page soon that you can use to transmit data – stay tuned!!</li>
</ul>


        
    </div></div>
  </body>
</html>
