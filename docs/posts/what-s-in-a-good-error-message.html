<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.morling.dev/blog/whats-in-a-good-error-message/">Original</a>
    <h1>What&#39;s in a good error message?</h1>
    
    <div id="readability-page-1" class="page"><div>
		






		<div id="main-content">
			

			<div>
				
<p>As software developers, weâ€™ve all come across those annoying, not-so-useful error messages when using some library or framework: <em>&#34;Couldnâ€™t parse config file&#34;</em>, <em>&#34;Lacking permission for this operation&#34;</em>, etc.
Ok, ok, so <em>something</em> went wrong apparently; but what exactly? What config file? Which permissions? And what should you do about it?
Error messages lacking this kind of information quickly create a feeling of frustration and helplessness.</p>
<p>So what makes a good error message then?
To me, it boils down to three pieces of information which should be conveyed by an error message:</p>
<div>
<ul>
<li>
<p><em>Context:</em> What led to the error? What was the code trying to do when it failed?</p>
</li>
<li>
<p><em>The error itself:</em> What exactly failed?</p>
</li>
<li>
<p><em>Mitigation:</em> What needs to be done in order to overcome the error?</p>
</li>
</ul>
</div>
<p>Letâ€™s dive into these individidual aspects a bit.
Before we start, let me clarify that this is about error messages created by library or framework code,
for instance in form of an exception message, or in form of a message written to some log file.
This means the consumers of these error messages will typically be either other software developers
(encountering errors raised by 3rd party dependencies during application development),
or ops folks (encountering errors while running an application).</p>
<p>Thatâ€™s in contrast to user-facing error messages,
for which other guidance and rules (in particular in regards to security concerns) should be applied.
For instance, you typically should not expose any implementation details in a user-facing message,
whereas thatâ€™s not that much of a concernâ€‰â€”â€‰or on the contrary, it can even be desirableâ€‰â€”â€‰for the kind of error messages discussed here.</p>
<div>
<h2 id="_context">Context</h2>
<div>
<p>In a way, an error message tells a story; and as with every good story,
you need to establish some context about its general settings.
For an error message, this should tell the recipient what the code in question was trying to do when it failed.
In that light, the first example above, <em>&#34;Couldnâ€™t parse config file&#34;</em>,
is addressing this aspect (and only this one) to some degree,
but probably itâ€™s not enough.
For instance, it would be very useful to know the exact name of the file:</p>
<div>
<blockquote>
<p>Couldnâ€™t parse config file: /etc/sample-config.properties&#34;</p>
</blockquote>
</div>
<p>Using an example from <a href="https://debezium.io/">Debezium</a>,
the open-source change data capture platform I am working on in my day job,
the second message could read like so with some context about what happened:</p>
<div>
<blockquote>
<p>Failed to create an initial snapshot of the data; lacking permission for this operation</p>
</blockquote>
</div>
<p>Coming back to error messages related to the processing of some input or configuration file,
it can be a good idea to print the absolute path.
In case file system resources are provided as relative paths,
this can help to identify wrong assumptions around the current working directory,
or whatever else is used as the root for resolving relative paths.
On the other hand, in particular in case of multi-tenant or SaaS scenarios,
you may consider filesystem layouts as a confidential implementation detail,
which you may prefer to not reveal to unknown code you run.
Whatâ€™s best here depends on your specific situation.</p>
<p>If some framework supports different kinds of files,
the specific kind of the problematic file in question should be part of the message as well: <em>&#34;Couldnâ€™t parse entity mapping fileâ€¦â€‹&#34;</em>.
If the error is about specific parts of the contents of a file,
displaying the line number and/or the line itself is a good idea.</p>
<p>In terms of <em>how</em> to convey the context of an error,
it can be part of messages themselves,
as shown above.
Many logging frameworks also support the notion of a <a href="https://www.baeldung.com/mdc-in-log4j-2-logback">Mapped Diagnostic Context</a> (MDC),
a map for propagating arbitrary key/value pairs into log messages.
So if your messages are meant to show up in logs, setting contextual information to the MDC can be very useful.
In Debezium this is used for instance to propagate the name of the affected connector,
allowing Kafka Connect users to tell apart log messages originating from different connectors deployed to the same Connect cluster.</p>
<div>
<table>
<tbody><tr>
<td>
<i title="Note"></i>
</td>
<td>
As far as propagating contextual information via log messages is concerned (as opposed to, say, error messages printed by a CLI tool),
<a href="https://www.innoq.com/en/blog/structured-logging/">structured logging</a>, typically in form of JSON, simplifies any downstream processing.
By putting contextual information into separate attributes of a structured log entry,
consumers can easily filter messages, ingest only specific sub-sets of messages based on their contents, etc.
</td>
</tr>
</tbody></table>
</div>
<p>In case of exceptions, the chain of exceptions leading to the root cause is an important contextual information, too.
So Iâ€™d recommend to always log the entire exception chain,
rather than catching exceptions and only logging some substitute message instead.</p>
</div>
</div>
<div>
<h2 id="_the_error_itself">The Error Itself</h2>
<div>
<p>On to the next part then, the description of the actual error itself.
Thatâ€™s where you should describe what exactly happened in a concise way.
Sticking to the examples above, the first message, including context and error description could read like so:</p>
<div>
<blockquote>
<p>Couldnâ€™t parse config file: /etc/sample-config.properties; given snapshot mode &#39;nevr&#39; isnâ€™t valid</p>
</blockquote>
</div>
<p>And for the second one:</p>
<div>
<blockquote>
<p>Failed to create an initial snapshot of the data; database user &#39;snapper&#39; is lacking the required permissions</p>
</blockquote>
</div>
<p>Other than that, thereâ€™s not too much to be said here;
try to be efficient: make messages as long as needed, and as short as possible.
One idea could be to work with different variants of messages for the same kind of error, a shorter and a longer one.
Which one is used could be controlled via log levels or some kind of &#34;verbose&#34; flag.
Java developers may find CÃ©dric Champeauâ€™s <a href="https://github.com/melix/jdoctor">jdoctor</a> library useful for implementing this.
Personally, I havenâ€™t used such an approach yet, but it may be worth the effort for specific situations.</p>
</div>
</div>
<div>
<h2 id="_mitigation">Mitigation</h2>
<div>
<p>Having established the context of the failure and what went wrong exactly,
the lastâ€‰â€”â€‰and oftentimes most interestingâ€‰â€”â€‰part is a description of how the user can overcome the error.
Whatâ€™s the action they need to take in order to avoid it?
This could be as simple as telling the user about the constraints and/or valid values in case of the config file example
(i.e. akin to test failure messages, which show both expected and actual values):</p>
<div>
<blockquote>
<p>Couldnâ€™t parse config file: /etc/sample-config.properties; given snapshot mode &#39;nevr&#39; isnâ€™t valid (must be one of &#39;initial&#39;, &#39;always&#39;, &#39;never&#39;)</p>
</blockquote>
</div>
<p>In case of the permission issue, you may clarify which ones are needed:</p>
<div>
<blockquote>
<p>Couldnâ€™t take database snapshot: database user &#39;snapper&#39; is lacking the required permissions &#39;SELECT&#39;, &#39;REPLICATION&#39;</p>
</blockquote>
</div>
<p>Alternatively, if longer mitigation strategies are required,
you may point to a (stable!) URL in your reference documention which provides the required information:</p>

<p>If some configuration change is required (for instance database or IAM permissions), your users will love you even more if you share that information in &#34;executable&#34; form,
for instance as GRANT statements which they can simply copy,
or vendor-specific CLI invocations such as <code>aws iam attach-role-policy --policy-arn arn:aws:iam::aws:policy/SomePolicy --role-name SomeRole</code>.</p>
<p>Speaking of external resources referenced in error messages,
itâ€™s a great idea to have unique error codes as part of your messages
(such as Oracleâ€™s ORA codes, or the <a href="https://docs.wildfly.org/26/wildscribe/log-message-reference.html">error messages</a> produced by WildFly and its components).
Corresponding resources (either provided by yourself, or externally, for instance in answers on StackOverflow) will then be easy to find using your favourite search engine.
Bonus points for adding a reference to your own canonical resource right to the error message itself:</p>
<div>
<blockquote>
<p>Couldnâ€™t take database snapshot: database user &#39;snapper&#39; is lacking the required permissions (DBZ-42). Please see <a href="https://dbz.codes/dbz-42/">https://dbz.codes/dbz-42/</a> for the complete set of necessary permissions</p>
</blockquote>
</div>
<p>(Thatâ€™s a made-up example, we donâ€™t make use of this approach in Debezium currently; but I probably should look into buying the dbz.codes domain ðŸ˜‰).</p>
<p>The key take-away is that you should not leave your users in the dark about what they need to do in order to address the error they ran into.
Nothing is more frustrating than essentially being told &#34;You did it wrong!&#34;, without getting hinted at whatâ€™s the right thing to do instead.</p>
</div>
</div>
<div>
<h2 id="_general_best_practices">General Best Practices</h2>
<div>
<p>Lastly, some practices in regards to error messages which I try to adhere to, and which I would generally recommend:</p>
<div>
<ul>
<li>
<p><em>Uniform voice and style:</em> The specific style chosen doesnâ€™t matter too much, but you should settle on either active vs. passive voice (&#34;couldnâ€™t parse config file&#34; vs. &#34;config file couldnâ€™t be parsed&#34;), apply consistent casing, either finish or not finishes messages with a dot, etc.; not a big thing, but it will make your messages a bit easier to deal with</p>
</li>
<li>
<p><em>One concept, one term</em>: Avoid referring to the same concept from your domain using different terms in different error messages; similarly, avoid using the same term for multiple things. Use the same terms as in other places, e.g. your API documentation, reference guides etc.; The more consisent and unambiguous you are, the better</p>
</li>
<li>
<p><em>Donâ€™t localize error messages:</em> This one is not as clear cut, but Iâ€™d generally recommend to not translate error messages into other languages than English; Again, this all is not about user-facing error messages, but about messages geared towards software developers and ops folks, who generally should command reasonable English skills; depending on your audience and target market, translations to specific languages might make sense, in which case a common, unambiguous error code should definitely be part of messages, so as to facilitate searching for the error on the internet</p>
</li>
<li>
<p><em>Donâ€™t make error messages an API contract:</em> In case consumers of your API should be able to react to different kinds of errors, they should not be required to parse any error messages in order to do so. Instead, raise an exception type which exposes a machine-processable error code, or raise specific exception types which can be caught separately by the caller</p>
</li>
<li>
<p><em>Be cautious about exposing sensitive data:</em> if your library is in the business of handling and processing sensitive user data, make sure to to not create any privacy concerns; for instance, &#34;show actual vs. expected value&#34; may not pose a problem for values provided by an application developer or administrator; but it can pose a problem if the actual value is GDPR protected user data</p>
</li>
<li>
<p><em>Either raise an exception OR log an error, but not both:</em> A given error should either be communicated by raising an exception or by logging an error. Otherwise, when doing both, as the exception will typically end up being logged via some kind of generic handler anyways, the user would see information about the same error in their logs twice, which only adds confusion</p>
</li>
<li>
<p><em>Fail early:</em> This one is not so much about how to express error messages, but when to raise them; in general, the earlier, the better; a message at application start-up beats one later at runtime; a message at build time beats one at start-up, etc. Quicker feedback makes for shorter turn-around times for fixes and also helps to provide the context of any failures</p>
</li>
</ul>
</div>
<p>With that all being said, whatâ€™s your take on the matter? Any best practices you would recommend? Do you have any examples for particularly well (or poorly) crafted messages? Let me know in the comments below!</p>
</div>
</div>
			</div>

			
		</div>


</div></div>
  </body>
</html>
