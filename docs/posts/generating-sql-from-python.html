<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://blog.sory.biz/posts/python-to-sql/">Original</a>
    <h1>Generating SQL from Python</h1>
    
    <div id="readability-page-1" class="page"><div>
	
	<p>I’ve wanted to get more experience writing programs that analyze programs, and after using <a href="https://www.prisma.io/docs/concepts/components/prisma-schema">Prisma schema</a> I decided to try writing a program to convert a Python dataclass to a SQL schema.</p>

<p>At the time, I was starting up a project to extract and load Philadelphia city data into my own database. In the early stages of the project, I found myself toiling through “drop, recreate, rehydrate” cycles of rebuilding my tables and “rehydrating” my local db with test data. Any change to a data model meant updating at least two definitions: my application code and the database schema. While tedious, I didn’t quite want to bring in a full ORM just for this, so I decided to see what it’d be like if I tried solving this problem myself.</p>

<p>The idea is to treat a Python class definition as the canonical data model definiton. My tool would then generate SQL DDL statements from the Python source code. I called my attempt <a href="https://gitlab.com/soryrawyer/norm"><code>norm</code></a>. At a high level, it takes one Python input file, looks for classes annotated with <code>@dataclass</code>, and tries to generate a SQL DDL statement from the type annotations. Unless a class property is optional, <code>not null</code> is added to the table field definition.</p>

<p>While it’s certainly not going to be used for a real project any time soon, I feel hopeful that I’ll be able to come back to this from time to time and add new features as they’re needed. At the very least, it was a fun way to start on the journey of writing Python programs that analyze Python programs.</p>

</div></div>
  </body>
</html>
