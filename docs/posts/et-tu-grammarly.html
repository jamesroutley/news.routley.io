<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dbushell.com/2025/03/29/et-tu-grammarly/">Original</a>
    <h1>Et Tu, Grammarly?</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>
<time datetime="2025-03-29T10:00:00.000Z" title="2025-03-29T10:00:00.000Z">

Saturday

29 <abbr title="March">Mar</abbr>
2025
</time>
</p>

<p>For a few months now I‚Äôve received sporadic reports that my website was broken. They said the layout was askew and things were sized strangely. They had screenshots to prove it. This was embarrassing for a professional website builder.</p><p>Thankfully my audience is tech-savvy and the <a href="https://www.grammarly.com/browser" rel="noopener noreferrer" target="_blank">Grammarly browser extension</a> was identified as a prime suspect. When this extension was installed it broke my website, simple as that. My initial response was: <em>‚ÄúSorry, their bug, not mine‚Äù</em>. But after one report too many, I was forced to sign-up and install Grammarly myself (praise the burner email).</p><h2 id="discovery">Discovery</h2><p>After accepting the Grammarly Firefox (<a href="https://dbushell.com/2025/03/01/never-have-never-will/">Mullvad browser</a>) extension kitchen sink permissions:</p><ul><li>Access your data for all websites</li><li>Display notifications to you</li><li>Access browser tabs</li></ul><p>I soon found the evidence. Grammarly injects a stylesheet into web pages (<a href="https://gist.github.com/dbushell/d65efab2cc2f009a37d5e6b706cf0c66" rel="noopener noreferrer" target="_blank">here‚Äôs a GitHub Gist</a>). This stylesheet is loaded from the local extension assets. It cannot be found by the web page itself using <a href="https://developer.mozilla.org/en-US/docs/Web/API/StyleSheetList" rel="noopener noreferrer" target="_blank">StyleSheetList</a>. It even bypasses <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP" rel="noopener noreferrer" target="_blank">Content Security Policy</a>. It is effectively a stealth stylesheet undetectable by the website itself. In Firefox at least, I didn‚Äôt care to install Grammarly in other browsers.</p><p>The Grammarly extension also appends a custom <code>&lt;grammarly-desktop-integration&gt;</code> element to the <code>&lt;html&gt;</code> document. This is done on every website regardless of whether you interact with the extension or not (I‚Äôve no idea what it‚Äôs used for).</p><h2 id="why-me">Why me?</h2><p>At the end of <a href="https://gist.github.com/dbushell/d65efab2cc2f009a37d5e6b706cf0c66" rel="noopener noreferrer" target="_blank">Grammarly‚Äôs stylesheet</a> you‚Äôll find the following CSS:</p><pre data-lang="css" tabindex="0" id="pre-5340eb92"><code><span><span>:</span><span>host</span><span>,</span></span>
<span><span>:</span><span>root</span><span> </span><span>{</span></span>
<span><span> </span><span> </span><span>--rem</span><span>:</span><span>16</span></span>
<span><span>}</span></span></code></pre><p>Aside from the obvious crime of omitting a semicolon, this is seemingly innocuous. You probably know the magic number 16. By default 1rem = 16px in CSS units (kinda, it‚Äôs complicated). Further up Grammarly are doing a form of dynamic font sizing:</p><pre data-lang="css" tabindex="0" id="pre-ec1d077b"><code><span><span>.kE2Bj</span><span> </span><span>{</span></span>
<span><span> </span><span> </span><span>font-size</span><span>:</span><span>calc</span><span>(</span><span>0.86</span><span>px*</span><span>(</span><span>var</span><span>(--rem)</span><span> </span><span>-</span><span> </span><span>2</span><span>));</span></span>
<span><span> </span><span> </span><span>line-height</span><span>:</span><span>calc</span><span>(</span><span>1.2868</span><span>px*</span><span>(</span><span>var</span><span>(--rem)</span><span> </span><span>-</span><span> </span><span>2</span><span>));</span></span>
<span><span>}</span></span></code></pre><p>This code is auto-generated so it‚Äôs not entirely clear what‚Äôs going on. I thought they might be dynamically setting the <code>--rem</code> value using the browser‚Äôs base font size ‚Äî good for accessibility ‚Äî but from testing that isn‚Äôt the case. Maybe the extension has its own setting?</p><p>As an aside note, Grammarly are also loading twenty variations of the <a href="https://fonts.google.com/specimen/Inter" rel="noopener noreferrer" target="_blank">Inter font</a> ‚Äî <a href="https://knowyourmeme.com/memes/four-naan-jeremy-thats-insane" rel="noopener noreferrer" target="_blank"><em>Four Naan, Jeremy? That‚Äôs Insane!</em></a> ‚Äî Inter is available as a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_fonts/Variable_fonts_guide" rel="noopener noreferrer" target="_blank">variable font</a>. You don‚Äôt need twenty individual <code>@font-face</code> rules, <del>Jeremy</del> Grammarly.</p><p>Anyway, as it happens I was also using the <code>--rem</code> custom property name. I‚Äôm doing my own experimental flavour of <a href="https://clagnut.com/blog/2441/" rel="noopener noreferrer" target="_blank">fluid typography</a>:</p><pre data-lang="css" tabindex="0" id="pre-451b88a5"><code><span><span>@layer</span><span> </span><span>base</span><span> </span><span>{</span></span>
<span><span> </span><span> </span><span>:</span><span>root</span><span> </span><span>{</span></span>
<span><span> </span><span> </span><span> </span><span> </span><span>--rem</span><span>:</span><span> </span><span>0.0625</span><span>rem</span><span>;</span></span>
<span><span> </span><span> </span><span> </span><span> </span><span>--fluid</span><span>:</span><span> </span><span>calc</span><span>((</span><span>100</span><span>vi</span><span> </span><span>-</span><span> </span><span>(</span><span>400</span><span> </span><span>*</span><span> </span><span>var</span><span>(--rem)))</span><span> </span><span>/</span><span> </span><span>(1920</span><span> </span><span>-</span><span> </span><span>400));</span></span>
<span><span> </span><span> </span><span> </span><span> </span><span>--font-size-h1</span><span>:</span><span> </span><span>clamp</span><span>(</span></span>
<span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span>calc</span><span>(</span><span>31</span><span> </span><span>*</span><span> </span><span>var</span><span>(--rem)),</span></span>
<span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span>calc</span><span>((</span><span>31</span><span> </span><span>*</span><span> </span><span>var</span><span>(--rem))</span><span> </span><span>+</span><span> </span><span>(80</span><span> </span><span>-</span><span> </span><span>31</span><span>)</span><span> </span><span>*</span><span> </span><span>var</span><span>(--fluid)),</span></span>
<span><span> </span><span> </span><span> </span><span> </span><span> </span><span> </span><span>calc(80</span><span> </span><span>*</span><span> </span><span>var(--rem))</span></span>
<span><span> </span><span> </span><span> </span><span> </span><span>);</span></span>
<span><span> </span><span> </span><span>}</span></span>
<span><span>}</span></span></code></pre><p>How this works is a topic for another blog post.</p><p>What‚Äôs important is that I was using <code>--rem</code> and it‚Äôs defined inside a <a href="https://developer.mozilla.org/en-US/docs/Learn_web_development/Core/Styling_basics/Cascade_layers" rel="noopener noreferrer" target="_blank">cascade layer</a>. Styles outside of a layer take precedent over those within a layer, regardless of CSS specificity (a topic for an entire book). Source order also matters, so Grammarly‚Äôs <code>--rem</code> probably would have won anyway.</p><p><abbr title="too long; didn&#39;t read">TL;DR</abbr>: Grammarly broke my calculations and thus they broke my website.</p><h2 id="the-fix">The Fix ü§°</h2><p>Initially <a href="https://dbushell.com/notes/2025-03-28T17:54Z/">I used a mutation observer</a> to detect the appended web component and add extra <code>!important</code> styles to reclaim my territory. Once I understood the exact problem I changed my custom property to <code>--ü§°</code> which is <a href="https://argyle.ink/css-emoji-convention" rel="noopener noreferrer" target="_blank">perfectly valid</a>.</p><p>Basically the name <code>--rem</code> is now ‚Äúconsidered harmful‚Äù because Grammarly are bad web citizens. They are generating random class names, why specifically hijack <code>--rem</code>? Why apply it globally to <code>:root</code>? They could also, you know, not inject their code into <strong>every web page ever</strong>, unless the extension is actually used?</p><p>I‚Äôve reached out to Grammarly support. They‚Äôve been quick to respond, but I‚Äôve yet to reach a technical person who understands my issue. I‚Äôm hoping we can swap names. Grammarly can have <code>--ü§°</code> for their sins, the rest of use can use <code>--rem</code>. Any of you nerds work for Grammarly? Let‚Äôs make this happen.</p>
</div></div>
  </body>
</html>
