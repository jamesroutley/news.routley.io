<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.toddtee.sh/posts/github-actions-oidc/">Original</a>
    <h1>Tokens, Please: Comparing OpenID Connect with Video Game “Papers, Please”</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p>Ah, access control.</p>
<p>It’s a topic that I have been thinking about a lot recently.</p>
<p>Why you ask?</p>
<p>Because I have been working hard on a security project? Been DevSecOps-ing my little heart out? Of Course not!</p>
<p>I have been re-playing one of my favorite video games of all time, <a href="https://papersplea.se/">&#34;<em>Papers, Please</em>&#34;</a>, by developer <a href="https://dukope.com/">Lucas Pope</a>.</p>
<p>It had been a few years since I had first played the game, but upon replaying it, I couldn’t shake off the feeling of recent deja vu.
I pondered why I felt this way, and then it hit me.
I had recently secured this blog’s deployment pipeline with OpenID Connect (OIDC).</p>
<p>It then dawned on me that OIDC is a lot like enforcing immigration control policy in the fictional country of Arstotzka.</p>
<p>Not sure what I am on about? Let me explain…</p>
<p><img src="https://images.toddtee.sh/2023/github-actions-oidc/papers-please.gif" alt="gif of papers please title"/></p>
<h2 id="what-is-papers-please">What is Papers, Please?</h2>
<p>In the video game “<em>Papers, Please</em>,” the player takes on the role of an immigration inspector in a dystopian country, Arstotzka.
Your role as the immigration inspector is enforcing the various, and ever-changing, border control policies set by the Arstotzkan government.</p>
<p>This is done by tediously verifying the identification and authorisation documents of each traveler who passes through the border checkpoint.
The documents need to be cross-referenced with the various rules and regulations that apply at the time of inspection.
You as the player, must make a split-second decision on who is or isn’t allowed into the country.</p>
<p><img src="https://images.toddtee.sh/2023/github-actions-oidc/papers-please-gameplay.gif" alt="gif of papers please game-play"/></p>
<p>Get it right, and you will be rewarded with promotions and praise; your family will prosper, Arstotzka will grow from strength-to-strength!</p>
<p>Get it wrong, and the consequences could be dire…</p>
<p><img src="https://images.toddtee.sh/2023/github-actions-oidc/papers-please-got-it-wrong.gif" alt="gif of papers please when you get it wrong"/></p>
<h2 id="so-what-does-oidc-have-to-do-with-this">So What Does OIDC Have To Do With This?</h2>
<p>There is a clear parallel between the game and the process of securing a cloud resources with OIDC.
Let’s first take a look at the key elements in the game and how they interact with each other.</p>
<p><img src="https://images.toddtee.sh/2023/github-actions-oidc/papers-please-workflow.jpg" alt="image of papers please workflow"/></p>
<p>Let’s work through this diagram:</p>
<ol>
<li>The Arstotzkan government creates the immigration policy that determines who can enter the country and under what conditions.</li>
<li>The traveler will go to the appropriate Documents Department and obtain the necessary identification and documents.</li>
<li>The department generates these documents, based on the requesters personal characteristics and stated intentions, which are returned to the requester.</li>
<li>The hopeful border-crosser will now take these documents and present them to the immigration inspector at the border.</li>
<li>The immigration inspector will analyse the documents against the applicable immigration policy and make a decision to approve or deny entry.</li>
<li>The traveler’s passport is then stamped with either an approval or denial stamp, depending on the outcome of the inspection and returned.</li>
</ol>
<p>Now let’s take a look at how this process maps back to securing cloud resources with OIDC.</p>
<p>First, let’s look at the workflow diagram:</p>
<p><img src="https://images.toddtee.sh/2023/github-actions-oidc/aws-oidc-workflow.jpg" alt="image of papers please workflow"/></p>
<p>Again, let’s work through the steps of the workflow; but this time, I want you to think about how each step can be applied to Papers, Please.</p>
<ol>
<li>The AWS Account Owner (or resource owner) creates an OIDC Trust Policy in IAM.
This trust policy determines which OIDC tokens, and subsequent claims on said token, are accepted for the role that is being requested.</li>
<li>The Github workflow will run a step to obtain an OIDC token from the
OIDC provider. This provider can be customised to your desired identity provider, or just kept with the default Github provider.</li>
<li>The OIDC provider will generate a JSON Web Token (JWT) that contains the identity of the user and the claims that the user has requested.</li>
<li>The Github workflow will then present this token to the appropriate AWS IAM service.</li>
<li>AWS IAM will inspect the token for authenticity and review the claims that are contained within it against the OIDC Trust Policy.</li>
<li>If the token is deemed valid, AWS IAM will grant the user a temporary access token that can be used to access the AWS resources. Otherwise, the user will be denied access.</li>
</ol>
<p>Let’s summarise the comparison between the game and the OIDC authetication process:</p>
<table>
<thead>
<tr>
<th><strong>Papers, Please</strong></th>
<th><strong>OIDC Workflow</strong></th>
<th><strong>Role</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Arstotzka Government</strong></td>
<td><strong>AWS Account Owner</strong></td>
<td>Creates the governing policies.</td>
</tr>
<tr>
<td><strong>Immigration Policy</strong></td>
<td><strong>OIDC Trust Policy</strong></td>
<td>Outlines the rules and regulations that determine who can access what and under what conditions.</td>
</tr>
<tr>
<td><strong>Traveler</strong></td>
<td><strong>Github Workflow</strong></td>
<td>The entity requesting access to areas under restricted access.</td>
</tr>
<tr>
<td><strong>ID and Documents</strong></td>
<td><strong>JWT</strong></td>
<td>The official documents outlining the identity of the requesting entity and related supporting claims.</td>
</tr>
<tr>
<td><strong>Immigration Inspector</strong></td>
<td><strong>AWS IAM</strong></td>
<td>Inspects the ID and claims of the requesting entity and compares these claims to the official policies.</td>
</tr>
</tbody>
</table>
<h2 id="so-what">So What?</h2>
<p>That is a great question!</p>
<p>Essentially, the game is a great way to visualise the process of securing cloud resources with OIDC.
Official documentation can be a bit dry and hard to understand, but a game is a great way to learn and understand a new concept.</p>
<p><img src="https://images.toddtee.sh/2023/github-actions-oidc/papers-please-approved.gif" alt="papers please approved stamp"/></p>
<h2 id="anything-else">Anything Else?</h2>
<p>Well yes, there is one more thing.</p>
<p>One of the interesting takeaways from the game is that access control is a delicate balance between security and usability.
The more complex the access control policies, the more difficult it is to enforce them.
The more difficult it is to enforce them, the more likely you will get it wrong.</p>
<p>This balancing relationship applies directly to cloud and CI/CD security.</p>
<p>Pipeline secrets, API keys, IAM credentials, etc. are all tedious and complex to manage and maintain.
Any manual process of providing keys or manual authentication to systems is a source of friction which is prone to error or will deter people from interacting with the system in the first place.</p>
<p>So when I was thinking about how to secure my blog’s deployment pipeline, I wanted to make the security as frictionless as possible, without compromising security.
Bonus points if it was also simple to implement and easy to maintain.</p>
<p><em>OIDC met this criteria perfectly.</em></p>
<p>To summarise the benefits of OIDC:</p>
<p><strong>1. It is Simple to Implement.</strong>
<a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services#adding-the-identity-provider-to-aws">Enabling OIDC in AWS</a> is as simple as creating a OIDC trust policy in AWS IAM and utilising the <code>aws-actions/configure-aws-credentials</code> action in your Github workflow.</p>
<p><strong>2. It is Secure.</strong>
The JWT generated by the OIDC provider is signed with a private key and can be verified with the public key. So you can be sure that the token is coming from the OIDC provider and not a malicious third party.</p>
<p><strong>3. It is Flexible.</strong>
The OIDC trust policy can be as fine grained or as broad as you want.
<a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect#configuring-the-oidc-trust-with-the-cloud">A variety of claims</a> that must be present in the JWT can be specified.</p>
<p><strong>4. It is Scalable.</strong>
You can use the same OIDC trust policy across multiple AWS accounts and multiple AWS regions. This means that you can easily scale your deployment pipeline to multiple environments.</p>
<p><strong>5. It is Easy to Maintain.</strong>
No more management of API keys, IAM credentials or secrets.</p>
<h2 id="in-summary">In Summary…</h2>
<p>I hope that this post has given you a better understanding of how OIDC works and how it can be used to secure your cloud resources, particularly when being interfaced with a CI/CD pipeline.</p>
<p>Oh, and if you haven’t played <em>Papers, Please</em>, I highly recommend it. It is a great game and a great way to learn about the complexities of access control.</p>
<p><img src="https://images.toddtee.sh/2023/github-actions-oidc/glory-to-arstotzka.gif" alt="glory to arstotzka"/></p>

      </div></div>
  </body>
</html>
