<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://destevez.net/2024/07/recording-dme-with-the-limesdr/">Original</a>
    <h1>Decoding DME aircraft radio navigation system with the LimeSDR</h1>
    
    <div id="readability-page-1" class="page"><article id="post-18438">

	<!-- .entry-header -->

	<div>
		
<p><a href="https://en.wikipedia.org/wiki/Distance_measuring_equipment">DME</a> (distance measuring equipment) is an aircraft radio navigation system that is used to measure the distance between an aircraft and a DME station on ground. DME is often colocated with a <a href="https://en.wikipedia.org/wiki/VHF_omnidirectional_range">VOR</a> station, in which case the VOR provides the bearing information. DME works by measuring the two-way time of flight of pulse pairs, which are first transmitted by the aircraft, then retransmitted with a fixed delay by the ground station, which acts as a transponder, and finally received back by the aircraft. DME operates between 960 and 1215 MHz. It is channelized in steps of 1 MHz, and the air-to-ground and ground-to-air frequencies always differ by 63 MHz (<a href="https://www.flightsim-corner.com/wp-content/uploads/VOR-Frequencies-to-TACAN-Channel-list.pdf">here</a> is a list of all the frequency channels).</p>



<p>I want to write a post explaining in detail how DME works by analysing a recording of DME that contains both the air-to-ground and the ground-to-air channels. Among other things, I want to show that the delay between the aircraft and ground station pulses matches the one calculated using the aircraft position (which I can get from ADS-B data on the internet), the ground station position, the position of the recorder, and the fixed delay applied by the ground station transponder.</p>



<p>Recording two channels 63 MHz apart is tricky with the kind of SDRs I have. Devices based on the AD9361 technically support a maximum sample rate of 61.44 Msps (although some people are <a href="https://destevez.net/2023/02/running-the-ad9361-at-122-88-msps/">running it at up to 122.88 Msps</a>). The <a href="https://limemicro.com/technology/lms7002m/">LMS7002M</a>, which is used by the <a href="https://limemicro.com/products/boards/limesdr/">LimeSDR</a> and other SDRs, is an interesting alternative, for two reasons. First, it supports more than 61.44 Msps. However, it isn’t clear what is the maximum sample rate supported by the LimeSDR. Some sources, including the <a href="https://limemicro.com/products/boards/limesdr/">LimeSDR webpage</a> mention 61.44 MHz bandwidth, but the <a href="https://limemicro.com/app/uploads/2017/07/LMS7002M-Data-Sheet-v3.1r00.pdf">LMS7002M datasheet</a> says that the maximum RF modulation bandwidth (whatever that means) through the digital interface in SISO mode is 96 MHz. In the case of the LimeSDR there is also the limitation of the USB3 data rate, but this should not be a problem if we use only 1 RX channel. I haven’t found clear information about the limitations of each of the components of the LMS7002M (ADC max sample rate, etc.).</p>



<p>The second interesting feature is that the LMS7002M has a DDC on the chip. The AD9361 has a series of decimating filters to reduce the ADC sample rate and deliver a lower sample rate through the digital interface. The LMS7002M, in addition to this, has an NCO and digital mixer that can be be used to apply a frequency shift to the ADC IQ signal before decimation.</p>



<p>I had two different ideas about how to use the LimeSDR to record the two DME channels. The first idea consisted in using a 70 Msps output sample rate. For this I used an ADC sample rate of 140 Msps, because I think it is necessary to have at least decimation by 2 after the ADC (the LMS7200M documentation does not explain this clearly, so figuring out how to use the chip often involves some trial and error using <code>LimeSuiteGUI</code>). This idea had two problems. The first problem is that some CGEN PLL occasionally failed to lock when using an ADC sample rate of 140 Msps. However the LimeSuite driver retried multiple times until the PLL locked, so in practice this wasn’t a problem. This approach worked well on my desktop PC, since in 70 Msps I had the two DME channels and then I could use GNU Radio to extract each of the two channels (for instance with the <a href="https://wiki.gnuradio.org/index.php/Frequency_Xlating_FIR_Filter">Frequency Xlating FIR Filter</a>). However, the laptop I planned to use to record on the field couldn’t keep up with 70 Msps.</p>



<p>The second idea was to use the on-chip DDC in the LMS7200M to extract the DME channel and deliver a much lower sample rate over the digital interface. The figure below shows how the LMS7200M digital signal processing datapath works. This datapath is called RXTSP. The RXI and RXQ signals are the digital signals coming from the ADC (here and below, by ADC I mean a dual-channel ADC, since the LMS7002M is a zero-if IQ transceiver). The RYI and RYQ are the signals delivered to the digital interface of the chip. Since the LMS7200M has two RX channels, there are two identical chains, one for each channel. The parameters of each chain can be programmed completely independently.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/rxtsp.png"><img fetchpriority="high" decoding="async" width="1368" height="294" src="https://destevez.net/wp-content/uploads/2024/07/rxtsp.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/rxtsp.png 1368w, https://destevez.net/wp-content/uploads/2024/07/rxtsp-300x64.png 300w, https://destevez.net/wp-content/uploads/2024/07/rxtsp-644x138.png 644w, https://destevez.net/wp-content/uploads/2024/07/rxtsp-768x165.png 768w" sizes="(max-width: 1368px) 100vw, 1368px"/></a><figcaption>LMS7200M digital signal processing, extracted from the <a href="https://limemicro.com/app/uploads/2017/07/LMS7002M-Data-Sheet-v3.1r00.pdf">datasheet</a></figcaption></figure>



<p>There is no way of sending the signal of one ADC to the two RXTSPs. The connection between each ADC and its corresponding RXTSP is fixed. Therefore, we need to feed in the antenna signal through the two RX channels, but we can easily do this with an external splitter. Remember that both of the LMS7200M RX channels share the same LO, as illustrated by the block diagram below. So the point here is to tune the LO to a frequency between the two DME channels, set the sample rate high enough that both DME channels are present in the ADC output, and finally to use each of the two RXTSPs to extract one of the DME channels, sending it at a low sample rate through the digital interface.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/lms7200m_block.png"><img decoding="async" width="649" height="792" src="https://destevez.net/wp-content/uploads/2024/07/lms7200m_block.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/lms7200m_block.png 649w, https://destevez.net/wp-content/uploads/2024/07/lms7200m_block-246x300.png 246w, https://destevez.net/wp-content/uploads/2024/07/lms7200m_block-644x786.png 644w" sizes="(max-width: 649px) 100vw, 649px"/></a><figcaption>LMS7200M block diagram, extracted from the <a href="https://limemicro.com/app/uploads/2017/07/LMS7002M-Data-Sheet-v3.1r00.pdf">datasheet</a></figcaption></figure>



<p>This approach has worked quite well. I have set the ADC to 80 Msps and used the RXTSPs to dowconvert and decimate the DME channels to 2.5 Msps, recording that data directly in GNU Radio.</p>



<p>I have done a two hour recording of DME and published it in the Zenodo dataset <a href="https://zenodo.org/records/12743623">Recording of Colmenar (CNR) VOR-DME air-to-ground and ground-to-air DME channels</a>.</p>



<p>In the rest of this post I explain the details of the recording set up and do a preliminary analysis of the recording quality.</p>



<h4>VOR-DME and recording location</h4>



<p>The VOR-DME station used in this recording is the <a href="https://ourairports.com/navaids/CNR/Colmenar_VOR-DME_ES/">Colmenar (CNR) VOR-DME</a>, which is the one closest to where I live. The VOR has a frequency of 117.3 MHz. The DME frequency is related to the VOR frequency, so according to <a href="https://www.flightsim-corner.com/wp-content/uploads/VOR-Frequencies-to-TACAN-Channel-list.pdf">the list</a>, it corresponds to TACAN channel 120X, which has an aircraft-to-ground frequency of 1144 MHz and a ground-to-aircraft frequency of 1207 MHz (DME is, in a sense, a civilian version of the military <a href="https://en.wikipedia.org/wiki/Tactical_air_navigation_system">TACAN</a> radio navigation system, which provides both range and bearing information).</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/cnr-vor.png"><img decoding="async" width="644" height="646" src="https://destevez.net/wp-content/uploads/2024/07/cnr-vor-644x646.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/cnr-vor-644x646.png 644w, https://destevez.net/wp-content/uploads/2024/07/cnr-vor-300x300.png 300w, https://destevez.net/wp-content/uploads/2024/07/cnr-vor-150x150.png 150w, https://destevez.net/wp-content/uploads/2024/07/cnr-vor-768x770.png 768w, https://destevez.net/wp-content/uploads/2024/07/cnr-vor.png 818w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>CNR VOR and Madrid area in the <a href="https://skyvector.com/">Skyvector</a> world VFR map</figcaption></figure>



<p>According to the <a href="https://skyvector.com/">Skyvector</a> world high and world low IFR maps, the CNR VOR is not part of any airway. However, it is part of several instrument procedures of the Madrid Barajas airport. An aircraft only transmits to a DME station if that DME or VOR-DME station is selected in one of the aircraft navigation radios (most aircraft have two radios for VOR-DME). The pilot will usually tune the radios to the stations that are part of the procedure that the aircraft is flying (although the pilot is free to tune to other stations as a cross check), so the kind of aircraft that we expect to see in the recording are those operating on the Madrid Barajas airport, not those flying high en route.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/world_high.png"><img decoding="async" width="644" height="526" src="https://destevez.net/wp-content/uploads/2024/07/world_high-644x526.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/world_high-644x526.png 644w, https://destevez.net/wp-content/uploads/2024/07/world_high-300x245.png 300w, https://destevez.net/wp-content/uploads/2024/07/world_high-768x628.png 768w, https://destevez.net/wp-content/uploads/2024/07/world_high.png 1077w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>CNR VOR in the <a href="https://skyvector.com/">Skyvector</a> world high map</figcaption></figure>



<p>In particular, aircraft departing from Madrid Barajas runway 36R and flying due west or southwest will fly over CNR.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/sid_36R.png"><img decoding="async" width="644" height="657" src="https://destevez.net/wp-content/uploads/2024/07/sid_36R-644x657.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/sid_36R-644x657.png 644w, https://destevez.net/wp-content/uploads/2024/07/sid_36R-294x300.png 294w, https://destevez.net/wp-content/uploads/2024/07/sid_36R-768x784.png 768w, https://destevez.net/wp-content/uploads/2024/07/sid_36R.png 825w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>SID for LEMD RWY 36R using CNR VOR, taken from the <a href="https://aip.enaire.es/aip/contenido_AIP/AD/AD2/LEMD/LE_AD_2_LEMD_SID_7_en.pdf">SID chart</a></figcaption></figure>



<p>However, departures from runway 36L do not use the CNR VOR at all (see the <a href="https://aip.enaire.es/aip/contenido_AIP/AD/AD2/LEMD/LE_AD_2_LEMD_SID_5_en.pdf">SID chart</a>). I’m quite impressed at how much the instrument procedures for Madrid Barajas have changed since I did my <a href="https://destevez.net/2018/08/aircraft-reflections-of-a-2-3ghz-beacon/">2.3 GHz aircraft reflections recording</a> in 2018. This is due to the increasing prevalence of GPS navigation.</p>



<p>The location I have chosen to do the recording is in the countryside just outside my town. It is 4.58 km southeast of the CNR VOR-DME. There is almost line of sight to the VOR-DME station, but there are some buildings in between. This recording location also gives good geometry for TDOA (time difference of arrival) analysis for aircraft travelling along the path shown above. As they depart from Madrid Barajas, they are closer to my recorder than to the VOR-DME, but at some point they start being closer to the VOR-DME than to my recorder.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/recording_map.png"><img decoding="async" width="644" height="651" src="https://destevez.net/wp-content/uploads/2024/07/recording_map-644x651.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/recording_map-644x651.png 644w, https://destevez.net/wp-content/uploads/2024/07/recording_map-297x300.png 297w, https://destevez.net/wp-content/uploads/2024/07/recording_map-768x776.png 768w, https://destevez.net/wp-content/uploads/2024/07/recording_map.png 888w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Recording location (red pin) and distance to CNR VOR-DME</figcaption></figure>



<p>The <a href="https://www.heywhatsthat.com/">HeyWhatsThat</a> <a href="https://www.heywhatsthat.com/profiler.html?show_grade=0&amp;show_rise=0&amp;include_grade=1&amp;decimal_places=0&amp;elev_source=0&amp;ll1=40.620582,-3.69318&amp;ll2=40.645972,-3.73583">profile</a> shows that there are no significant terrain obstructions.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/profile-0904.png"><img decoding="async" width="644" height="129" src="https://destevez.net/wp-content/uploads/2024/07/profile-0904-644x129.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/profile-0904-644x129.png 644w, https://destevez.net/wp-content/uploads/2024/07/profile-0904-300x60.png 300w, https://destevez.net/wp-content/uploads/2024/07/profile-0904-768x154.png 768w, https://destevez.net/wp-content/uploads/2024/07/profile-0904.png 800w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>HeyWhatsThat profile from the recording location to the CNR VOR-DME</figcaption></figure>



<h4>Antenna</h4>



<p>I have made an antenna from scratch for this recording. I have chosen a quarter-wave groundplane monopole because it’s easy to make and gives a roughly omnidirectional pattern, except for a null in the zenith (which is useful, because I’ll be recording both the ground signal and signals from aircraft at high elevation angles). I made the antenna from a spare SMA female connector and some thick enamelled copper wire.</p>



<p>The following photo shows the antenna and the LNA, with a ruler in cm for scale.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_antenna.jpg"><img decoding="async" width="644" height="884" src="https://destevez.net/wp-content/uploads/2024/07/dme_antenna-644x884.jpg" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_antenna-644x884.jpg 644w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna-218x300.jpg 218w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna-768x1055.jpg 768w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna.jpg 932w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Antenna and LNA</figcaption></figure>



<p>The antenna is resonant somewhere around 1.1 to 1.2 GHz, depending on the presence of nearby objects. It provides a good impedance match to 50Ω in all the DME band.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna.png"><img decoding="async" width="1920" height="1063" src="https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna.png 1920w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna-300x166.png 300w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna-644x357.png 644w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna-768x425.png 768w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna-1536x850.png 1536w, https://destevez.net/wp-content/uploads/2024/07/dme_antenna_vna-1568x868.png 1568w" sizes="(max-width: 1920px) 100vw, 1920px"/></a><figcaption>Antenna S11 measured with NanoVNA V2</figcaption></figure>



<h4>LNA</h4>



<p>Since the antenna will be connected to the two RX channels of the LimeSDR through a splitter, I have used an LNA to overcome the splitter losses. The LNA is a <a href="https://www.minicircuits.com/WebStore/dashboard.html?model=GALI-39%2B">GALI-39</a> <a href="https://www.minikits.com.au/Gali-39-Amplifier">board from Minikits</a> that I had around. The GALI-39 is a wideband LNA MMIC from MiniCircuits that has a gain of around 20 dB and a noise figure of around 2.4 dB. I talked about this LNA board kit in <a href="https://destevez.net/2016/02/building-the-gali-39-amplifier-kit-from-minikits/">an old post</a>. Note that I built the biasing network for the MMIC using the option that covers from 500 kHz to 850 MHz, but this should still be fine at 1.2 GHz.</p>



<h4>Splitter</h4>



<p>To split the antenna signal into the two LimeSDR RX channels, I’m using a cheap Wilkinson splitter board that I originally got to feed two GPS receivers from the same antenna. I installed a DC blocking capacitor in one of the two ports, since GPS receivers often provide a DC bias for an active antenna.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/splitter.jpg"><img decoding="async" width="644" height="508" src="https://destevez.net/wp-content/uploads/2024/07/splitter-644x508.jpg" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/splitter-644x508.jpg 644w, https://destevez.net/wp-content/uploads/2024/07/splitter-300x237.jpg 300w, https://destevez.net/wp-content/uploads/2024/07/splitter-768x606.jpg 768w, https://destevez.net/wp-content/uploads/2024/07/splitter.jpg 1200w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Wilkinson splitter</figcaption></figure>



<p>The figure below shows a measurement of the splitter in the VNA, with the third port terminated with a load. It performs quite well in the DME band, but even though I think it was marketed for GPS, it doesn’t perform so well at 1575.42 MHz (the GPS L1 frequency).</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/splitter_vna.png"><img decoding="async" width="644" height="357" src="https://destevez.net/wp-content/uploads/2024/07/splitter_vna-644x357.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/splitter_vna-644x357.png 644w, https://destevez.net/wp-content/uploads/2024/07/splitter_vna-300x166.png 300w, https://destevez.net/wp-content/uploads/2024/07/splitter_vna-768x425.png 768w, https://destevez.net/wp-content/uploads/2024/07/splitter_vna-1536x850.png 1536w, https://destevez.net/wp-content/uploads/2024/07/splitter_vna-1568x868.png 1568w, https://destevez.net/wp-content/uploads/2024/07/splitter_vna.png 1920w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Splitter S11 and S21 measured with the NanoVNA V2 (third port terminated)</figcaption></figure>



<h4>Complete hardware set up</h4>



<p>The antenna is connected through the LNA and the splitter to the two RX channels of the LimeSDR. I placed everything on a camera tripod on the roof of my car and used a LiPo battery to power the LNA. The following photo shows how everything looked during the recording.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_receiver.jpg"><img decoding="async" width="644" height="860" src="https://destevez.net/wp-content/uploads/2024/07/dme_receiver-644x860.jpg" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_receiver-644x860.jpg 644w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver-225x300.jpg 225w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver-768x1026.jpg 768w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver-1150x1536.jpg 1150w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver.jpg 1437w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>DME receiver hardware set up</figcaption></figure>



<p>This shows the view towards the CNR VOR-DME station. The buildings are in the line of sight towards the VOR-DME, but there are no terrain obstructions behind them.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_receiver2.jpg"><img decoding="async" width="644" height="860" src="https://destevez.net/wp-content/uploads/2024/07/dme_receiver2-644x860.jpg" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_receiver2-644x860.jpg 644w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver2-225x300.jpg 225w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver2-768x1026.jpg 768w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver2-1150x1536.jpg 1150w, https://destevez.net/wp-content/uploads/2024/07/dme_receiver2.jpg 1437w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>Hardware set up looking towards the CNR VOR-DME station</figcaption></figure>



<h4>LimeSDR configuration</h4>



<p>I have used LimeSuiteGUI to prepare the LimeSDR configuration. This configuration can then be loaded in GNU Radio using <a href="https://github.com/myriadrf/gr-limesdr">gr-limesdr</a>. The configuration file can be found <a href="https://github.com/daniestevez/jupyter_notebooks/blob/master/DME/limesdr_config.ini">here</a>.</p>



<p>I have found that it is somewhat tricky to set up from scratch a configuration in LimeSuiteGUI that uses decimation in the RXTSP. The HBD ratio in the RxTSP tab (which controls the decimation applied in the RXTSP) and the Rx clock divider in the LimeLight &amp; PAD tab (which controls when the digital interface outputs a sample) need to be set to matching values. Otherwise samples are duplicated or missing in the output. However, it turns out that for a HBD ratio of 2^5 (which is what I’m using to reduce the 80 Msps ADC sample rate to 2.5 Msps), the Rx clock divider needs to be set to 7. The way I’ve figured this out is by configuring the LimeSDR to 2.5 Msps in GQRX (which automatically sets a decimation of 2^5) and then stopping GQRX and examining the configuration in LimeSuiteGUI. This works because GQRX doesn’t clear the configuration when it stops.</p>



<p>The important points to configure in LimeSuiteGUI are the following:</p>



<ul>
<li>In the CLKGEN tab, the CLK_H is set to 320 MHz. Together with a decimation of 4 this produces an RXTSP and TXTSP frequency of 80 MHz.</li>



<li>In the SXR tab, the RX LO frequency is set to 1175 MHz, which is the midpoint of the aircarft-to-ground and ground-to-aircraft frequencies of this DME channel.</li>



<li>In RxTSP tab, the HBD ratio is set to 2^5, and the NCO is set to 31.5 MHz. Channel A is set to upconvert (which shifts the frequency up), and channel B is set to downconvert (which shifts the frequency down)</li>



<li>In the RBB tab, the RX filter bandwidth is tuned to 70 MHz. Experimentally it seems that this bandwidth refers to the full IQ bandwidth, so the lowpass filter cut-off is at 35 MHz.</li>



<li>The gains are adjusted in the field for appropriate signal levels. I have ended up using a PGA gain of 6 dB (RBB tab), an LNA gain of Gmax-12 dB, and a TIA gain of Gmax-3 dB (RFE tab).</li>



<li>RX IQ imbalance calibration is done in the field.</li>
</ul>



<p>Note that, except for the CLKGEN and SXR setttings, all these settings need to be applied independently to each of the two channels.</p>



<p>In hindsight, the decision to set the LO frequency exactly at the midpoint between the air-to-ground and ground-to-air channels might have not been the best. Since this causes the two channels to be at symmetric frequencies in baseband, any IQ imbalance will cause some power from the signals from one channel to appear in the other. Offsetting the LO frequency by a few MHz would prevent this. However, this doesn’t seem to be a problem in practice. An advantage of setting the LO frequency in the midpoint is that the two channels then have a more similar response in the analog baseband, since they have the same analog baseband frequency.</p>



<h4>GNU Radio flowgraph</h4>



<p>A <a href="https://github.com/daniestevez/jupyter_notebooks/blob/master/DME/dme_limesdr_record.grc">GNU Radio flowgraph</a> is used to load the LimeSDR configuration and record data to disk.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_limesdr_record.png"><img decoding="async" width="644" height="262" src="https://destevez.net/wp-content/uploads/2024/07/dme_limesdr_record-644x262.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_limesdr_record-644x262.png 644w, https://destevez.net/wp-content/uploads/2024/07/dme_limesdr_record-300x122.png 300w, https://destevez.net/wp-content/uploads/2024/07/dme_limesdr_record-768x313.png 768w, https://destevez.net/wp-content/uploads/2024/07/dme_limesdr_record.png 992w" sizes="(max-width: 644px) 100vw, 644px"/></a><figcaption>GNU Radio flowgraph to record DME aircraft-to-ground and ground-to-aircraft channels</figcaption></figure>



<p>The output of the LimeSDR has a small DC spike even though we are using the NCO (so it is not the ADC DC spike). I think the reason is poor rounding in the digital signal chain. Adding <code>1/2**12</code> to each channel fixes this. This is why the Add Const blocks are present.</p>



<p>The Tag Debug block is used to detect lost samples, since the LimeSDR Source emits an <code>rx_time</code> each time that samples are lost.</p>



<p>The LimeSDR configuration file is loaded in the LimeSDR Source block in the Advanced tab, File option. Since we are using a configuration file, most of the other parameters in this block do not matter, as they are overwritten by the configuration file.</p>



<p>Since the LimeSDR doesn’t have a nice timestamp synchronization API as UHD does, timestamping of the files is done by writing the time at which the flowgraph starts running as part of the filename and also by comparing this to the modification timestamp of the file obtained using <code>stat</code> once the recording has stopped (this timestamp corresponds to the end of the file). This method is accurate to about 1 second, which is good enough to compare the recorded data with ADS-B data.</p>



<h4>Recording preliminary analysis</h4>



<p>I have performed a preliminary analysis of the recording in <a href="https://github.com/daniestevez/jupyter_notebooks/blob/master/DME/DME%20recording%20quick%20analysis.ipynb">a Jupyter notebook</a> to validate the recording quality. A more detailed analysis will be done in a future post.</p>



<p>The following figure shows the signal amplitude of the ground-to-air and air-to-ground channels in the first 100 ms of the recording. Each of the spikes we see is a pulse pair. Instead of single pulses, DME uses pulse pairs with a well determined separation between the two pulses so that the receiver can discriminate against pulsed interference.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_amplitude.png"><img decoding="async" width="622" height="353" src="https://destevez.net/wp-content/uploads/2024/07/dme_amplitude.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_amplitude.png 622w, https://destevez.net/wp-content/uploads/2024/07/dme_amplitude-300x170.png 300w" sizes="(max-width: 622px) 100vw, 622px"/></a></figure>



<p>There are many more pulse pairs in the ground-to-air channel. The reason is something known as <a href="https://en.wikipedia.org/wiki/Squitter">squitter</a>. The DME transponder on ground has an AGC system that adjusts the detection threshold so that on average the transponder outputs 2700 pulse pairs per second. If there are not enough pulses received from aircraft, the transponder will trigger on random noise to generate the required amount of pulse pairs. This has several goals. It provides a constant output power to the transponder, it automatically sets the transponder threshold to a value that optimizes the sensitivity, and it degrades gracefully if the number of aircraft increases. If there are so many aircraft that the transponder receives more than 2700 pulse pairs per second, the threshold will be set high enough that the weaker aircraft are ignored. This kind of AGC system is also relatively simple to implement in hardware, so it is a very clever solution.</p>



<p>In this recording there are few aircraft using the DME. Each aircraft transmits around 150 pulse pairs per second when in search mode and less than 30 pulse pairs per second when in track mode, so most of the pulse pairs we see in the ground-to-air channel are squitter.</p>



<p>The following shows the spectrum of the first 100 seconds of the recording, using an FFT size of 4096 and a rectangular window. Both an average and a peak hold spectrum are shown for each channel. Due to the low duty cycle of the pulses (specially for the air-to-ground channel), the peak hold is often better than the average to detect the DME signal.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_spectrum.png"><img decoding="async" width="621" height="353" src="https://destevez.net/wp-content/uploads/2024/07/dme_spectrum.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_spectrum.png 621w, https://destevez.net/wp-content/uploads/2024/07/dme_spectrum-300x171.png 300w" sizes="(max-width: 621px) 100vw, 621px"/></a></figure>



<p>The following two figures show a pulse pair in the ground-to-air channel and in the air-to-ground channel. In both cases, I have plotted the pulse with largest amplitude in the first 100 seconds of the recording. The amplitude of the pulse is around 0.3 with respect to ADC full scale (or rather with respect to the full scale of the LMS7200M digital interface), so the ADC is probably still far from saturation.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_ground_pulse.png"><img decoding="async" width="625" height="353" src="https://destevez.net/wp-content/uploads/2024/07/dme_ground_pulse.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_ground_pulse.png 625w, https://destevez.net/wp-content/uploads/2024/07/dme_ground_pulse-300x169.png 300w" sizes="(max-width: 625px) 100vw, 625px"/></a></figure>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_air_pulse.png"><img decoding="async" width="625" height="353" src="https://destevez.net/wp-content/uploads/2024/07/dme_air_pulse.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_air_pulse.png 625w, https://destevez.net/wp-content/uploads/2024/07/dme_air_pulse-300x169.png 300w" sizes="(max-width: 625px) 100vw, 625px"/></a></figure>



<p>There are two DME modes: mode X and mode Y. Each mode has different parameters for the pulse pair timing. The two modes are mainly a way to support twice as many channels, since a given frequency can be used with mode X or with mode Y (although whether a given frequency is air-to-ground or ground-to-air also changes with the mode). This DME is mode X (recall that it is TACAN channel 120X), so as indicated in <a href="https://www.airnav.eu/index.php?stranka=DMEen">this webpage</a>, the distance between the two pulses in the pair is 12 usec both for the air-to-ground and ground-to-air channels (mode Y uses different distances for air-to-ground and ground-to-air) and the transponder retransmits the pulses with a delay of 50 usec.</p>



<p>The shape of the pulses is somewhat ugly. The SNR is very high, so this is caused by signal distortion, not noise. In the ground-to-air channel perhaps this distortion is multipath, although in the air-to-ground pulse there seems to be an echo with a delay of ~5 usec. This corresponds to 1.5 km. I can’t think how this receiver set up could have 1.5 km of multipath for pulses coming from aircraft, so maybe the distortion is generated in the receiver hardware. Or maybe the aircraft signal is reflected in a building. Who knows.</p>



<p>The next plot shows the same air-to-ground pulse pair, and its corresponding reply on the ground-to-air channel. The reply is received with a delay of approximately 70 usec. The transponder has a delay of 50 usec, and since my receiver is 4.58 km away from the VOR-DME station, the transponder signal takes another 15 usec to reach the receiver. Therefore, this means that the aircraft signal arrived to my receiver 5 usec before it arrived to the VOR-DME station. If we can identify which aircraft transmitted this pulse, we should be able to check that it was 1.5 km closer to my station than to the VOR-DME in this moment. This will be done in the next post.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_ground_and_air_pulse.png"><img decoding="async" width="669" height="353" src="https://destevez.net/wp-content/uploads/2024/07/dme_ground_and_air_pulse.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_ground_and_air_pulse.png 669w, https://destevez.net/wp-content/uploads/2024/07/dme_ground_and_air_pulse-300x158.png 300w, https://destevez.net/wp-content/uploads/2024/07/dme_ground_and_air_pulse-644x340.png 644w" sizes="(max-width: 669px) 100vw, 669px"/></a></figure>



<p>Another interesting feature of the DME ground station is that it periodically sends an identification in Morse code. The way in which this is done is quite ingenious. To transmit a Morse dash or dot, the transponder stops listening to aircraft transmissions and replaces the squitter by a train of 1350 equally spaced pulse pairs per second. This is shown in a plot here. The transition from the squitter to the regular train of pulses is apparent.</p>



<figure><a href="https://destevez.net/wp-content/uploads/2024/07/dme_cw_id.png"><img decoding="async" width="622" height="353" src="https://destevez.net/wp-content/uploads/2024/07/dme_cw_id.png" alt="" srcset="https://destevez.net/wp-content/uploads/2024/07/dme_cw_id.png 622w, https://destevez.net/wp-content/uploads/2024/07/dme_cw_id-300x170.png 300w" sizes="(max-width: 622px) 100vw, 622px"/></a></figure>



<p>When a DME signal is received with an AM receiver such as the ones that are used for aircraft communications, even though the bandwidth of a typical AM receiver is 10 kHz and the bandwidth of the DME signal is 1 MHz, the DME signal causes a distinct sound in the AM receiver audio output. Each DME pulse pair causes a single pulse in the AM receiver audio output. This single pulse is longer, around 100 usec long, due to the reduced bandwidth of the AM receiver. The train of regularly spaced pulses sounds quite similar to a 1350 Hz rectangular wave. The value of 1350 Hz is chosen to be distinct from the tone used by VOR for its Morse ID, which is 1020 Hz.</p>



<p>The audio clip below shows a few seconds of DME squittter and then the Morse ID. The Morse 1350 Hz tone can be heard quite naturally. Observe that there is squitter between the Morse dots and dashes. Also note that the squitter sounds quite different from AWGN, so an AM receiver can be used to detect the presence of a DME ground-to-air signal and even to get a rough idea of its SNR, since as the signal becomes weaker, more and more AWGN will be heard in the AM receiver. This audio file was obtained with <a href="https://github.com/daniestevez/jupyter_notebooks/blob/master/DME/dme_am_demod.grc">this GNU Radio flowgraph</a>.<br/></p>



<figure><audio controls="" src="https://destevez.net/wp-content/uploads/2024/07/dme_am_demod.wav"></audio><figcaption>DME Morse code ID (demodulated as AM with 10 kHz bandwidth)</figcaption></figure>



<p>During the Morse identification, aircraft don’t receive valid response pulses from the DME transponder, so the DME receiver on the aircraft stops updating its distance measurement until valid transponder replies are received again.</p>



<h4>Code and data</h4>



<p>The GNU Radio flowgraphs and the Jupyter notebook used in this post are in <a href="https://github.com/daniestevez/jupyter_notebooks/tree/master/DME">this repository</a>. The recording is published as a <a href="https://zenodo.org/records/12743623">dataset in Zenodo</a>.</p>
	</div><!-- .entry-content -->

	<!-- .entry-footer -->

				
</article></div>
  </body>
</html>
