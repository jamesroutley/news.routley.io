<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/konstin/sudoku-in-python-packaging">Original</a>
    <h1>Solving Sudoku in Python Packaging</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Solve sudokus not in python, but in python packages.</p>
<p dir="auto">Solving the versions of python package from your requirements is <a href="https://research.swtch.com/version-sat" rel="nofollow">NP-complete</a>, in the worst case it runs exponentially slow. Sudokus are also <a href="http://mountainvistasoft.com/docs/ASP.pdf" rel="nofollow">NP-complete</a>, which means we can solve sudokus with python packaging.</p>
<p dir="auto">Each cell in the sudoku grid is a package
<code>sudoku_{x}_{y}</code> (0 indexed), and the version (1-9) is the value in the field, so you can write a pyproject.toml and the installed packages are the solution.</p>
<div dir="auto" data-snippet-clipboard-copy-content="[project]
name = &#34;sudoku&#34;
version = &#34;1.0.0&#34;
dependencies = [
    &#34;sudoku_3_1 == 2&#34;,
    &#34;sudoku_5_7 == 6&#34;,
    &#34;sudoku_0_7 == 5&#34;
    ...
]"><pre>[<span>project</span>]
<span>name</span> = <span><span>&#34;</span>sudoku<span>&#34;</span></span>
<span>version</span> = <span><span>&#34;</span>1.0.0<span>&#34;</span></span>
<span>dependencies</span> = [
    <span><span>&#34;</span>sudoku_3_1 == 2<span>&#34;</span></span>,
    <span><span>&#34;</span>sudoku_5_7 == 6<span>&#34;</span></span>,
    <span><span>&#34;</span>sudoku_0_7 == 5<span>&#34;</span></span>
    <span>...</span>
]</pre></div>

<p dir="auto">You can write the sudoku as csv:</p>
<div data-snippet-clipboard-copy-content="5,3,_,_,7,_,_,_,_
6,_,_,1,9,5,_,_,_
_,9,8,_,_,_,_,6,_
8,_,_,_,6,_,_,_,3
4,_,_,8,_,3,_,_,1
7,_,_,_,2,_,_,_,6
_,6,_,_,_,_,2,8,_
_,_,_,4,1,9,_,_,5
_,_,_,_,8,_,_,7,9"><pre><code>5,3,_,_,7,_,_,_,_
6,_,_,1,9,5,_,_,_
_,9,8,_,_,_,_,6,_
8,_,_,_,6,_,_,_,3
4,_,_,8,_,3,_,_,1
7,_,_,_,2,_,_,_,6
_,6,_,_,_,_,2,8,_
_,_,_,4,1,9,_,_,5
_,_,_,_,8,_,_,7,9
</code></pre></div>
<p dir="auto">Convert it to requirements:</p>
<div dir="auto" data-snippet-clipboard-copy-content="python csv_to_requirements.py sudoku.csv requirements.in"><pre>python csv_to_requirements.py sudoku.csv requirements.in</pre></div>
<div data-snippet-clipboard-copy-content="sudoku_0_0 == 5
sudoku_1_0 == 3
[...]
sudoku_7_8 == 7
sudoku_8_8 == 9"><pre><code>sudoku_0_0 == 5
sudoku_1_0 == 3
[...]
sudoku_7_8 == 7
sudoku_8_8 == 9
</code></pre></div>
<p dir="auto">Solve it with your favourite package manager, e.g:</p>
<div dir="auto" data-snippet-clipboard-copy-content="uv pip compile --find-links packages/ --no-annotate --no-header requirements.in &gt; requirements.txt"><pre>uv pip compile --find-links packages/ --no-annotate --no-header requirements.in <span>&gt;</span> requirements.txt</pre></div>
<p dir="auto">or (slow)</p>
<div dir="auto" data-snippet-clipboard-copy-content="pip-compile --find-links packages/ --no-annotate --no-header requirements.in -o requirements.txt"><pre>pip-compile --find-links packages/ --no-annotate --no-header requirements.in -o requirements.txt</pre></div>
<div data-snippet-clipboard-copy-content="sudoku-0-0==5
sudoku-0-1==6
sudoku-0-2==1
sudoku-0-3==8
sudoku-0-4==4
[...]"><pre><code>sudoku-0-0==5
sudoku-0-1==6
sudoku-0-2==1
sudoku-0-3==8
sudoku-0-4==4
[...]
</code></pre></div>
<p dir="auto">Render the solution:</p>
<div dir="auto" data-snippet-clipboard-copy-content="python render_solution.py requirements.txt"><pre>python render_solution.py requirements.txt</pre></div>
<div data-snippet-clipboard-copy-content="5,3,4,6,7,8,9,1,2
6,7,2,1,9,5,3,4,8
1,9,8,3,4,2,5,6,7
8,5,9,7,6,1,4,2,3
4,2,6,8,5,3,7,9,1
7,1,3,9,2,4,8,5,6
9,6,1,5,3,7,2,8,4
2,8,7,4,1,9,6,3,5
3,4,5,2,8,6,1,7,9"><pre><code>5,3,4,6,7,8,9,1,2
6,7,2,1,9,5,3,4,8
1,9,8,3,4,2,5,6,7
8,5,9,7,6,1,4,2,3
4,2,6,8,5,3,7,9,1
7,1,3,9,2,4,8,5,6
9,6,1,5,3,7,2,8,4
2,8,7,4,1,9,6,3,5
3,4,5,2,8,6,1,7,9
</code></pre></div>
<p dir="auto">Or as a oneliner:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ python csv_to_requirements.py royle.csv - | uv pip compile --find-links packages/ --no-annotate --no-header - | python render_solution.py -
Resolved 81 packages in 126ms
5,3,4,6,7,8,9,1,2
6,7,2,1,9,5,3,4,8
1,9,8,3,4,2,5,6,7
8,5,9,7,6,1,4,2,3
4,2,6,8,5,3,7,9,1
7,1,3,9,2,4,8,5,6
9,6,1,5,3,7,2,8,4
2,8,7,4,1,9,6,3,5
3,4,5,2,8,6,1,7,9"><pre>$ <span>python csv_to_requirements.py royle.csv - <span>|</span> uv pip compile --find-links packages/ --no-annotate --no-header - <span>|</span> python render_solution.py -</span>
<span>Resolved 81 packages in 126ms</span>
<span>5,3,4,6,7,8,9,1,2</span>
<span>6,7,2,1,9,5,3,4,8</span>
<span>1,9,8,3,4,2,5,6,7</span>
<span>8,5,9,7,6,1,4,2,3</span>
<span>4,2,6,8,5,3,7,9,1</span>
<span>7,1,3,9,2,4,8,5,6</span>
<span>9,6,1,5,3,7,2,8,4</span>
<span>2,8,7,4,1,9,6,3,5</span>
<span>3,4,5,2,8,6,1,7,9</span></pre></div>

<div data-snippet-clipboard-copy-content="$ hyperfine --warmup 5 &#34;uv pip compile --find-links packages/ --no-index --no-annotate --no-header requirements.in&#34;
Benchmark 1: uv pip compile --find-links packages/ --no-index --no-annotate --no-header requirements.in
  Time (mean ± σ):      29.7 ms ±   1.6 ms    [User: 29.9 ms, System: 21.0 ms]
  Range (min … max):    27.5 ms …  35.0 ms    97 runs"><pre><code>$ hyperfine --warmup 5 &#34;uv pip compile --find-links packages/ --no-index --no-annotate --no-header requirements.in&#34;
Benchmark 1: uv pip compile --find-links packages/ --no-index --no-annotate --no-header requirements.in
  Time (mean ± σ):      29.7 ms ±   1.6 ms    [User: 29.9 ms, System: 21.0 ms]
  Range (min … max):    27.5 ms …  35.0 ms    97 runs
</code></pre></div>
<p dir="auto">The walltime didn&#39;t vary much between the sudokus i tried.</p>
<p dir="auto">While dependency resolution is NP-complete and their backing algorithm is usually some form of SAT solver, in reality the problem space is much smaller: packages usually depend on a single range of another package, and that range usually increasing monotonically. You almost never run into an exponential case, most resolution in python can be done without even backtracking. The performance bottleneck is instead fetching and parsing metadata, and for python specifically building source distributions.</p>
</article></div></div>
  </body>
</html>
