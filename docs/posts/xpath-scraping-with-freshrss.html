<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://danq.me/2022/09/27/freshrss-xpath/">Original</a>
    <h1>XPath Scraping with FreshRSS</h1>
    
    <div id="readability-page-1" class="page"><div>
	<article id="post-20520" data-post-id="20520">
	
	<div>
	<p>
	I’ve been spending a while <a href="https://djan.org/2022/09/23/covid-brain/">running on reduced brain capacity</a> lately so, to ease myself back into thinking like a programmer, I upgraded my
	preferred feed reader <a href="https://www.freshrss.org/">FreshRSS</a> to version 1.20.0 – which was <a href="https://github.com/FreshRSS/FreshRSS/releases/tag/1.20.0">released a couple
	of weeks ago</a> – and tried out what I believe is <a href="https://github.com/FreshRSS/FreshRSS/pull/4220">its killer new feature</a>: <strong>HTML + XPath scraping</strong>.
	</p>
	<figure id="attachment_20521" aria-describedby="caption-attachment-20521">
	<a href="#lightbox-attachment_20521" role="button"><img fetchpriority="high" decoding="async" src="https://djan.org/_q23u/2022/09/webdevbev-blog.png" alt="Screenshot showing Beverley Newing&#39;s weblog; two articles are visible - Paperback copy of &#39;Disability Visibility&#39;, edited by Alice Wong, next to a cup of tea Setting up an Accessibility Book Club, published on 1 March 2022, and Reflecting on 2021, published on 1 January 2022." width="818" height="656" srcset="/_q23u/2022/09/webdevbev-blog.png 818w, https://danq.me/_q23u/2022/09/webdevbev-blog-300x241.png 300w, https://danq.me/_q23u/2022/09/webdevbev-blog-768x616.png 768w, https://danq.me/_q23u/2022/09/webdevbev-blog-30x24.png 30w" sizes="(max-width: 818px) 100vw, 818px"/></a>
	<figcaption id="caption-attachment-20521">
		I like to keep up-to-date with <a href="https://webdevbev.co.uk/blog.html">my friend Bev’s blog</a>, but they don’t have an <abbr title="Really Simple Syndication">RSS</abbr> feed.
	</figcaption>
	</figure>
	<p>
	I’ve been using <abbr title="Really Simple Syndication">RSS</abbr><sup><a id="footnote-ref-20520-1" name="footnote-ref-20520-1" href="#footnote-20520-1" title="When I say RSS, I mean feed. Most of the feeds I subscribe to are RSS feeds, but some are Atom feeds, h-feed, etc. But I can’t get over the old-fashioned name, and I don’t care to try.">1</a></sup>
	for about 20 years and <a href="https://twobithistory.org/2018/09/16/the-rise-and-demise-of-rss.html">I <em>love</em> it</a>. It <a href="https://gilest.org/rss-feels.html">feels
	great</a> to be able to curate my updates <a href="https://lucybellwood.com/stumbling/">based on “what I care about”</a>, and <a href="https://djan.org/2019/05/25/youtube/">not on “what some social
	network thinks I should care about”</a>, to keep things to read later, to prioritise effectively based on my own categorisation, to consume content offline and have my to-read list
	synchronise later, etc.
	</p>
	<p>
	<abbr title="Really Simple Syndication">RSS</abbr> never went away, of course (<a href="https://inessential.com/2013/03/14/why_i_love_rss_and_you_do_too">what do you think
	a podcast is?</a>), but it got <a href="https://www.techdirt.com/2022/06/03/the-internet-can-still-be-small-and-nice-but-its-on-all-of-us-to-make-that-work/">steamrollered out of the
	public eye by big companies</a> who make their money out of keeping your eyes on <em>their</em> platforms and off the open Web. But it feels like <a href="https://www.wired.com/story/rss-readers-feedly-inoreader-old-reader/">it’s slowly coming back</a>: even <a href="https://substack.com/">Substack</a> – whose entire <em>thing</em> is
	that an email client is more-convenient than a feed reader for most people – <a href="https://on.substack.com/p/new-web-reader">launched an <abbr title="Really Simple Syndication">RSS</abbr> reader this week</a>!
	</p>
	<figure id="attachment_20522" aria-describedby="caption-attachment-20522">
	<a href="#lightbox-attachment_20522" role="button"><img decoding="async" src="https://djan.org/_q23u/2022/09/webdevbev-blog-on-phone-1024x659.jpg" alt="A smartphone on a wooden surface. The screen shows the FeedMe app, showing the most-recent blog post from Beverley&#39;s blog." width="640" height="412" srcset="/_q23u/2022/09/webdevbev-blog-on-phone-1024x659.jpg 1024w, https://danq.me/_q23u/2022/09/webdevbev-blog-on-phone-300x193.jpg 300w, https://danq.me/_q23u/2022/09/webdevbev-blog-on-phone-768x494.jpg 768w, https://danq.me/_q23u/2022/09/webdevbev-blog-on-phone-1536x989.jpg 1536w, https://danq.me/_q23u/2022/09/webdevbev-blog-on-phone-30x19.jpg 30w, https://danq.me/_q23u/2022/09/webdevbev-blog-on-phone-898x578.jpg 898w, https://danq.me/_q23u/2022/09/webdevbev-blog-on-phone.jpg 1920w" sizes="(max-width: 640px) 100vw, 640px"/></a>
	<figcaption id="caption-attachment-20522">
		My day usually starts in my feed reader, accessed via the <a href="https://shallowsky.com/software/feedme/">FeedMe app</a> from my mobile (although FreshRSS provides a reasonably good
		responsive interface out-of-the-box!)
	</figcaption>
	</figure>
	<p>
	I love <abbr title="Really Simple Syndication">RSS</abbr> so much that <a href="https://djan.org/2018/07/05/comic-chameleon/">I routinely retrofit other people’s websites</a> with feeds
	just so I can subscribe to them: I even published <a href="https://github.com/Dan-Q/rssey">the tool I use to do so</a>! Whether <a href="https://djan.org/2019/05/14/bbc-news-without-the-sport/">filtering sports headlines out of BBC News</a>, turning <a href="https://djan.org/2019/07/25/labs-comic-rss-archive/">retro webcomics into “reading lists”</a>
	so I can track my progress, or just <a href="https://djan.org/2020/01/08/far-side-rss/">working around sites that really <em>should</em> have feeds</a> but refuse to, I just love sidestepping these
	“missing feeds”. <a href="https://webdevbev.co.uk/">My friend Beverley</a> has a blog without any kind of feed, so <a href="https://github.com/Dan-Q/rssey/blob/main/feeds/webdevbevblog.js">I added one</a> so I could subscribe to it. Magic.
	</p>
	<p>
	But with FreshRSS 1.20.0, I no longer have to maintain my own tool to get this brilliant functionality, and I’m overjoyed. Let’s look at how it works by re-subscribing to Beverley’s
	blog but <em>without</em> a middleware tool.
	</p>
	<figure id="attachment_20523" aria-describedby="caption-attachment-20523">
	<a href="#lightbox-attachment_20523" role="button"><img decoding="async" src="https://djan.org/_q23u/2022/09/fetchrss-screenshot-1024x628.png" alt="Screenshot showing FetchRSS being used to graphically create a feed from Beverley&#39;s blog." width="640" height="393" srcset="/_q23u/2022/09/fetchrss-screenshot-1024x628.png 1024w, https://danq.me/_q23u/2022/09/fetchrss-screenshot-300x184.png 300w, https://danq.me/_q23u/2022/09/fetchrss-screenshot-768x471.png 768w, https://danq.me/_q23u/2022/09/fetchrss-screenshot-30x18.png 30w, https://danq.me/_q23u/2022/09/fetchrss-screenshot-898x551.png 898w, https://danq.me/_q23u/2022/09/fetchrss-screenshot.png 1120w" sizes="(max-width: 640px) 100vw, 640px"/></a>
	<figcaption id="caption-attachment-20523">
		This post is about to get pretty technical. If you don’t want to learn some <a href="https://www.w3.org/TR/xpath-31/">XPath</a> but just want to make a feed out of a web page, use a
		graphical tool like <a href="https://fetchrss.com/">FetchRSS</a>.
	</figcaption>
	</figure>
	<p>
	In the latest version of FreshRSS, when you add a new feed to your reader, a new section “Type of feed source” is available. Unfold it, and you can change from the default
	(“<abbr title="Really Simple Syndication">RSS</abbr> / Atom”) to the new option “<abbr title="Hypertext Markup Language">HTML</abbr> + XPath (Web scraping)”.
	Put a human-readable page address rather than a feed address into the “Feed <abbr title="Uniform Resource Locator">URL</abbr>” field and fill these fields to tell FreshRSS
	how to parse the page to get the content you want. Note that it doesn’t matter if the web page isn’t valid <abbr title="Extensible Markup Language">XML</abbr> (e.g. missing
	closing tags) because <a href="https://github.com/Alkarex/FreshRSS/blob/871c1142a24b14a5ac621c290c2092f6b10361b3/app/Models/Feed.php#L587-L589">it’s going to get run through PHP’s
	DOMDocument anyway</a> which will “correct” for some really sloppy code if needed.
	</p>
	<figure id="attachment_20525" aria-describedby="caption-attachment-20525">
	<a href="#lightbox-attachment_20525" role="button"><img loading="lazy" decoding="async" src="https://djan.org/_q23u/2022/09/debugger-select-from-xpath-1024x256.png" alt="Browser debugger running document.evaluate(&#39;//li[@class=&#34;blog__post-preview&#34;]&#39;, document).iterateNext() on Beverley&#39;s weblog and getting the first blog entry." width="640" height="160" srcset="/_q23u/2022/09/debugger-select-from-xpath-1024x256.png 1024w, https://danq.me/_q23u/2022/09/debugger-select-from-xpath-300x75.png 300w, https://danq.me/_q23u/2022/09/debugger-select-from-xpath-768x192.png 768w, https://danq.me/_q23u/2022/09/debugger-select-from-xpath-1536x384.png 1536w, https://danq.me/_q23u/2022/09/debugger-select-from-xpath-30x7.png 30w, https://danq.me/_q23u/2022/09/debugger-select-from-xpath-898x224.png 898w, https://danq.me/_q23u/2022/09/debugger-select-from-xpath.png 1817w" sizes="(max-width: 640px) 100vw, 640px"/></a>
	<figcaption id="caption-attachment-20525">
		You can use your browser’s debugger to help check your XPath rules: here I’ve run  <code>document.evaluate(&#39;//li[@class=&#34;blog__post-preview&#34;]&#39;, document).iterateNext()</code> and
		got back the first blog post on the page, so I know I’m on the right track.
	</figcaption>
	</figure><p>You’ll need to use XPath to express how to find a “feed item” on the page. Here’s the rules I used for <a href="https://webdevbev.co.uk/blog.html">https://webdevbev.co.uk/blog.html</a> (many of these fields were optional – I didn’t have to do this much work):
	</p><ul>
	<li>
		<strong>Feed title:</strong> <code>//h1</code>
		</li>
	<li>
		<strong>Finding items:</strong> <code>//li[@class=&#34;blog__post-preview&#34;]</code>
		</li>
	<li>
		<strong>Item titles:</strong> <code>descendant::h2</code>
		</li>
	<li>
		<strong>Item content:</strong> <code>descendant::p[3]</code>
		</li>
	<li>
		<strong>Item link:</strong> <code>descendant::h2/a/@href</code>
		</li>
	<li>
		<strong>Item thumbnail:</strong> <code>descendant::img[@class=&#34;blog__image--preview&#34;]/@src</code>
		</li>
	<li>
		<strong>Item author:</strong> <code>&#34;Beverley Newing&#34;</code>
		</li>
	<li>
		<strong>Item date:</strong> <code>substring-after(descendant::p[@class=&#34;blog__date-posted&#34;], &#34;Date posted: &#34;)</code>
		</li>
	</ul>
	<figure id="attachment_20524" aria-describedby="caption-attachment-20524">
	<a href="#lightbox-attachment_20524" role="button"><img loading="lazy" decoding="async" src="https://djan.org/_q23u/2022/09/freshrss-add-xpath-feed.png" alt="Screenshot: Adding a &#34;HTML + XPath (Web scraping)&#34; feed via FreshRSS." width="816" height="909" srcset="/_q23u/2022/09/freshrss-add-xpath-feed.png 816w, https://danq.me/_q23u/2022/09/freshrss-add-xpath-feed-269x300.png 269w, https://danq.me/_q23u/2022/09/freshrss-add-xpath-feed-768x856.png 768w, https://danq.me/_q23u/2022/09/freshrss-add-xpath-feed-27x30.png 27w" sizes="(max-width: 816px) 100vw, 816px"/></a>
	<figcaption id="caption-attachment-20524">
		I’d love one day for FreshRSS to provide some kind of “preview” feature here so you can see what you’ll expect to get back, as you work. That, and support for different input types
		(<abbr title="Javascript Object Notation">JSON</abbr>, perhaps?), perhaps other selectors (I find <abbr title="Cascading Stylesheets">CSS</abbr>-style
		selectors much simpler than XPath), and maybe even an option to execute Javascript on the page before scraping (I use this in my own toolchain, but that’s just because I want to have
		my cake and eat it too). But this is still all pretty awesome.
	</figcaption>
	</figure>
	<p>
	I hope that this is just the beginning for this new killer feature in FreshRSS: there’s so much more it can be and do. But for now, I’m still mighty impressed that I can begin to
	phase-out my use of my relatively resource-intensive feed-building middleware and use my feed reader to do more and more of the heavy lifting for which I love it so much.
	</p>
	<p>
	I also love that this functionally adds h-feed support in by the back door. I’d still <em>prefer</em> there to be a “h-feed” option in the “Type of feed source” drop-down, but at least
	I can add such support manually, now!
	</p>
	<figure id="attachment_20526" aria-describedby="caption-attachment-20526">
	<a href="#lightbox-attachment_20526" role="button"><img loading="lazy" decoding="async" src="https://djan.org/_q23u/2022/09/webdevbev-blog-in-freshrss.png" alt="Beverley&#39;s blog post &#34;Setting up an Accessibility Book Club&#34; in FreshRSS." width="956" height="803" srcset="/_q23u/2022/09/webdevbev-blog-in-freshrss.png 956w, https://danq.me/_q23u/2022/09/webdevbev-blog-in-freshrss-300x252.png 300w, https://danq.me/_q23u/2022/09/webdevbev-blog-in-freshrss-768x645.png 768w, https://danq.me/_q23u/2022/09/webdevbev-blog-in-freshrss-898x754.png 898w, https://danq.me/_q23u/2022/09/webdevbev-blog-in-freshrss-30x25.png 30w" sizes="(max-width: 956px) 100vw, 956px"/></a>
	<figcaption id="caption-attachment-20526">
		The finished result: Bev’s blog posts appear directly in my feed reader, even though they don’t have a feed, and now <em>without</em> going through the middleware I’d set up for that
		purpose.
	</figcaption>
	</figure>
	
	<dialog id="lightbox-attachment_20521">
	<a href="https://djan.org/_q23u/2022/09/webdevbev-blog.png"><img fetchpriority="high" decoding="async" src="https://djan.org/_q23u/2022/09/webdevbev-blog.png" alt="Screenshot showing Beverley Newing&#39;s weblog; two articles are visible - Paperback copy of &#39;Disability Visibility&#39;, edited by Alice Wong, next to a cup of tea Setting up an Accessibility Book Club, published on 1 March 2022, and Reflecting on 2021, published on 1 January 2022." width="818" height="656" sizes="(max-width: 818px) 100vw, 818px" loading="lazy"/></a><a href="#attachment_20521" title="Close image" role="button">×</a>
	</dialog>
	<dialog id="lightbox-attachment_20522">
	<a href="https://djan.org/_q23u/2022/09/webdevbev-blog-on-phone.jpg"><img decoding="async" src="https://djan.org/_q23u/2022/09/webdevbev-blog-on-phone.jpg" alt="A smartphone on a wooden surface. The screen shows the FeedMe app, showing the most-recent blog post from Beverley&#39;s blog." width="640" height="412" sizes="(max-width: 640px) 100vw, 640px" loading="lazy"/></a><a href="#attachment_20522" title="Close image" role="button">×</a>
	</dialog>
	<dialog id="lightbox-attachment_20523">
	<a href="https://djan.org/_q23u/2022/09/fetchrss-screenshot.png"><img decoding="async" src="https://djan.org/_q23u/2022/09/fetchrss-screenshot.png" alt="Screenshot showing FetchRSS being used to graphically create a feed from Beverley&#39;s blog." width="640" height="393" sizes="(max-width: 640px) 100vw, 640px" loading="lazy"/></a><a href="#attachment_20523" title="Close image" role="button">×</a>
	</dialog>
	<dialog id="lightbox-attachment_20525">
	<a href="https://djan.org/_q23u/2022/09/debugger-select-from-xpath.png"><img loading="lazy" decoding="async" src="https://djan.org/_q23u/2022/09/debugger-select-from-xpath.png" alt="Browser debugger running document.evaluate(&#39;//li[@class=&#34;blog__post-preview&#34;]&#39;, document).iterateNext() on Beverley&#39;s weblog and getting the first blog entry." width="640" height="160" sizes="(max-width: 640px) 100vw, 640px"/></a><a href="#attachment_20525" title="Close image" role="button">×</a>
	</dialog>
	<dialog id="lightbox-attachment_20524">
	<a href="https://djan.org/_q23u/2022/09/freshrss-add-xpath-feed.png"><img loading="lazy" decoding="async" src="https://djan.org/_q23u/2022/09/freshrss-add-xpath-feed.png" alt="Screenshot: Adding a &#34;HTML + XPath (Web scraping)&#34; feed via FreshRSS." width="816" height="909" sizes="(max-width: 816px) 100vw, 816px"/></a><a href="#attachment_20524" title="Close image" role="button">×</a>
	</dialog>
	<dialog id="lightbox-attachment_20526">
	<a href="https://djan.org/_q23u/2022/09/webdevbev-blog-in-freshrss.png"><img loading="lazy" decoding="async" src="https://djan.org/_q23u/2022/09/webdevbev-blog-in-freshrss.png" alt="Beverley&#39;s blog post &#34;Setting up an Accessibility Book Club&#34; in FreshRSS." width="956" height="803" sizes="(max-width: 956px) 100vw, 956px"/></a><a href="#attachment_20526" title="Close image" role="button">×</a>
	</dialog>
	
	</div>
	
	</article>
	
	</div></div>
  </body>
</html>
