<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/nat-418/bdccb2428cde750c9f42bf9bbc1a50d3">Original</a>
    <h1>Why Tcl?</h1>
    
    <div id="readability-page-1" class="page"><div>
  <div id="file-why-tcl-md">
      
      <div id="file-why-tcl-md-readme">
    <article itemprop="text">
<h2 dir="auto"><a id="user-content-introduction" aria-hidden="true" href="#introduction"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Introduction</h2>
<p dir="auto">I use <a href="https://www.tcl-lang.org/" rel="nofollow">Tcl</a> as my scripting language of choice, and recently
someone asked me why. This article is an attempt to answer that question.</p>
<p dir="auto">Ousterhout&#39;s dichotomy claims that there are two general categories
of programming languages:</p>
<ul dir="auto">
<li>low-level, statically-typed systems languages</li>
<li>high-level, dynamic scripting languages</li>
</ul>
<p dir="auto">Systems languages are best for efficiently handling large quantities of data,
implementing algorithims, and can handle significant internal complexity.
Scripting languages are best for glueing other programs together,
exploring a problem, and extending applications. Ousterhout designed Tcl with
this dichotomy in mind:</p>
<blockquote>
<p dir="auto">Thus I designed Tcl to make it really easy to drop down into C or C++
when you come across tasks that make more sense in a lower-level
language. This way Tcl doesn&#39;t have to solve all of the world&#39;s
problems. Stallman appears to prefer an approach where a single
language is used for everything, but I don&#39;t know of a successful
instance of this approach. Even Emacs uses substantial amounts of
C internally, no?</p>
</blockquote>
<p dir="auto">Tcl is a very simple language that you can learn quickly and keep in your head.
It is a mature platform, with a comprehensive standard library.
Unlike some other scripting languages, Tcl is stable and does not require
complex virtual environment or dependency management. To get started, all you
need is the interpreter <code>tclsh</code> and the standard library <code>tcllib</code>.</p>
<p dir="auto">I reach for Tcl whenever I have a shell script that gets more than trivially
complex, because shell scripts are brittle: not only is the syntax tricky—I
always use <a href="https://www.shellcheck.net/" rel="nofollow">shellcheck</a> to make sure I catch all the necessary
double-quotes, for example—but many of the basic tools used in shell
scripting are subtly different from machine to machine—even a simple call
to <a href="https://apple.stackexchange.com/questions/173836/why-echo-n-doesnt-work-in-this-script-on-mac-terminal" rel="nofollow">echo</a> can break. By contrast, Tcl programs will work across Linux, BSD,
macOS, and Windows.</p>
<p dir="auto">I also like to use Tcl to prototype and test ideas. Hal Abelson called Tcl
&#34;Lisp without a brain&#34;, and I find the strange blend of Unix and Lisp ideas
in Tcl enjoyable to work with. Tcl is command-oriented and generally
procedural, but can accomodate object-oriented, functional,
and metaprogramming.</p>
<h2 dir="auto"><a id="user-content-example-programs" aria-hidden="true" href="#example-programs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Example programs</h2>
<p dir="auto">Recently I have been working through <em>The Go Programming Language</em>
by Donovan and &amp; Kernighan, and thought I would give a few examples of
how Tcl compares to Go, Python, and shell scripts. Each example will
begin with the Go code from the book end with a performance benchmark
made using <a href="https://github.com/sharkdp/hyperfine">hyperfine</a>.</p>
<h3 dir="auto"><a id="user-content-echo-command-line-input" aria-hidden="true" href="#echo-command-line-input"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Echo command-line input</h3>
<p dir="auto">To begin with, let&#39;s simply take command-line input and print it out.</p>
<h4 dir="auto"><a id="user-content-go" aria-hidden="true" href="#go"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Go</h4>
<div dir="auto"><pre><span>package</span> main

<span>import</span> (
	<span>&#34;fmt&#34;</span>
	<span>&#34;os&#34;</span>
)

<span>func</span> <span>main</span>() {
	<span>var</span> <span>s</span>, <span>sep</span> <span>string</span>
	<span>for</span> <span>i</span> <span>:=</span> <span>1</span>; <span>i</span> <span>&lt;</span> <span>len</span>(<span>os</span>.<span>Args</span>); <span>i</span><span>++</span> {
		<span>s</span> <span>+=</span> <span>sep</span> <span>+</span> <span>os</span>.<span>Args</span>[<span>i</span>]
		<span>sep</span> <span>=</span> <span>&#34; &#34;</span>
	}
	<span>fmt</span>.<span>Println</span>(<span>s</span>)
}</pre></div>
<h4 dir="auto"><a id="user-content-python" aria-hidden="true" href="#python"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Python</h4>
<div dir="auto"><pre><span>#!/usr/bin/env python</span>

<span>import</span> <span>sys</span>

<span>output</span> <span>=</span> <span>&#34; &#34;</span>.<span>join</span>(<span>sys</span>.<span>argv</span>[<span>1</span>:])

<span>print</span>(<span>output</span>)</pre></div>
<h4 dir="auto"><a id="user-content-tcl" aria-hidden="true" href="#tcl"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Tcl</h4>
<div dir="auto"><pre><span><span>#</span>!/usr/bin/env tclsh</span>

<span>puts</span> <span>$argv</span></pre></div>
<h4 dir="auto"><a id="user-content-benchmark" aria-hidden="true" href="#benchmark"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Benchmark</h4>
<table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>./echo &#34;Hello, world!&#34;</code></td>
<td>0.5 ± 0.1</td>
<td>0.4</td>
<td>1.0</td>
<td>1.00</td>
</tr>
<tr>
<td><code>echo &#34;Hello, world!&#34;</code></td>
<td>1.0 ± 0.1</td>
<td>0.8</td>
<td>1.6</td>
<td>1.88 ± 0.35</td>
</tr>
<tr>
<td><code>tclsh ./echo.tcl &#34;Hello, world!&#34;</code></td>
<td>1.9 ± 0.1</td>
<td>1.6</td>
<td>2.8</td>
<td>3.44 ± 0.57</td>
</tr>
<tr>
<td><code>python ./echo.py &#34;Hello, world!&#34;</code></td>
<td>10.9 ± 0.3</td>
<td>10.3</td>
<td>11.7</td>
<td>19.90 ± 2.94</td>
</tr>
</tbody>
</table>
<p dir="auto">We can see that Tcl is very straightforward to write and fast to start-up.</p>
<h3 dir="auto"><a id="user-content-count-duplicate-lines-in-files" aria-hidden="true" href="#count-duplicate-lines-in-files"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Count duplicate lines in files</h3>
<p dir="auto">Given some files like this example.txt:</p>
<div dir="auto"><pre>foo
hello
foo bar
hello
foo bar
bar</pre></div>
<p dir="auto">We produce the result:</p>

<h4 dir="auto"><a id="user-content-go-1" aria-hidden="true" href="#go-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Go</h4>
<div dir="auto"><pre><span>package</span> main

<span>import</span> (
	<span>&#34;fmt&#34;</span>
	<span>&#34;io/ioutil&#34;</span>
	<span>&#34;os&#34;</span>
	<span>&#34;strings&#34;</span>
)

<span>func</span> <span>main</span>() {
	<span>counts</span> <span>:=</span> <span>make</span>(<span>map</span>[<span>string</span>]<span>int</span>)
	<span>for</span> <span>_</span>, <span>filename</span> <span>:=</span> <span>range</span> <span>os</span>.<span>Args</span>[<span>1</span>:] {
		<span>data</span>, <span>err</span> <span>:=</span> <span>ioutil</span>.<span>ReadFile</span>(<span>filename</span>)
		<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
			<span>fmt</span>.<span>Fprintf</span>(<span>os</span>.<span>Stderr</span>, <span>&#34;dup3: %v<span>\n</span>&#34;</span>, <span>err</span>)
			<span>continue</span>
		}
		<span>for</span> <span>_</span>, <span>line</span> <span>:=</span> <span>range</span> <span>strings</span>.<span>Split</span>(<span>string</span>(<span>data</span>), <span>&#34;<span>\n</span>&#34;</span>) {
			<span>counts</span>[<span>line</span>]<span>++</span>
		}
	}
	<span>for</span> <span>line</span>, <span>n</span> <span>:=</span> <span>range</span> <span>counts</span> {
		<span>if</span> <span>n</span> <span>&gt;</span> <span>1</span> {
			<span>fmt</span>.<span>Printf</span>(<span>&#34;%d<span>\t</span>%s<span>\n</span>&#34;</span>, <span>n</span>, <span>line</span>)
		}
	}
}</pre></div>
<h2 dir="auto"><a id="user-content-shell" aria-hidden="true" href="#shell"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Shell</h2>
<div dir="auto"><pre><span><span>#!</span>/bin/sh</span>

<span>set</span> -e
<span>set</span> -o pipefail

<span>for</span> <span>path</span> <span>in</span> <span><span>&#34;</span><span>$@</span><span>&#34;</span></span>
<span>do</span>
	sort <span><span>&#34;</span><span>$path</span><span>&#34;</span></span> <span>|</span> uniq --count --repeated <span>||</span> {
		<span>echo</span> <span><span>&#34;</span>^dup error^<span>&#34;</span></span>
		<span>continue</span>
	}
<span>done</span></pre></div>
<p dir="auto">Note how awkward it is to try and handle errors in this shell script.</p>
<h4 dir="auto"><a id="user-content-python-1" aria-hidden="true" href="#python-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Python</h4>
<div dir="auto"><pre><span>#!/usr/bin/env python</span>

<span>import</span> <span>collections</span>
<span>import</span> <span>sys</span>

<span>for</span> <span>i</span>, <span>p</span> <span>in</span> <span>enumerate</span>(<span>sys</span>.<span>argv</span>):
    <span>if</span> <span>i</span> <span>==</span> <span>0</span>:
        <span>continue</span>
    <span>try</span>:
        <span>with</span> <span>open</span>(<span>p</span>) <span>as</span> <span>f</span>:
            <span>c</span> <span>=</span> <span>collections</span>.<span>Counter</span>(<span>f</span>.<span>readlines</span>())
            <span>for</span> <span>k</span>, <span>v</span> <span>in</span> <span>c</span>.<span>most_common</span>():
                <span>if</span> <span>v</span> <span>&gt;</span> <span>1</span>:
                    <span>print</span>(<span>v</span>, <span>&#34;<span>\t</span>&#34;</span>, <span>k</span>.<span>replace</span>(<span>&#34;<span>\n</span>&#34;</span>, <span>&#34;&#34;</span>))
    <span>except</span> <span>Exception</span> <span>as</span> <span>e</span>:
        <span>print</span>(<span>&#34;dup: &#34;</span>, <span>str</span>(<span>e</span>))
        <span>continue</span></pre></div>
<h4 dir="auto"><a id="user-content-tcl-1" aria-hidden="true" href="#tcl-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Tcl</h4>
<div dir="auto"><pre><span><span>#</span>!/usr/bin/env tclsh</span>

<span>proc</span> <span>main</span> {paths} {
    <span>foreach</span> path <span>$paths</span> {
        try {
            <span>set</span> file [<span>read</span> [<span>open</span> <span>$path</span> r]]
        } on error {err} {
            <span>puts</span> <span><span>&#34;</span>dup: <span>$err</span><span>&#34;</span></span>
            <span>continue</span>
        }

        <span>foreach</span> line [<span>split</span> <span>$file</span> <span>\n</span>] {
            <span>incr</span> count(<span>$line</span>)
        }

        <span>foreach</span> {line n} [<span>array</span> get count] {
            <span>if</span> {<span>$n</span> &gt; 1} {
                <span>puts</span> <span><span>&#34;</span><span>$n</span><span>\t</span><span>$line</span><span>&#34;</span></span>
            }
        }
    }
}

main <span>$argv</span></pre></div>
<h4 dir="auto"><a id="user-content-benchmarks" aria-hidden="true" href="#benchmarks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Benchmarks</h4>
<p dir="auto">To compare these programs, I did a a few rounds of testing:
first with just one small file, then with batch of files,
and finally including a 230 megabyte torture-test.</p>
<h5 dir="auto"><a id="user-content-first-round" aria-hidden="true" href="#first-round"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>First Round</h5>
<table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>./dup         0.txt</code></td>
<td>0.6 ± 0.1</td>
<td>0.5</td>
<td>1.4</td>
<td>1.00</td>
</tr>
<tr>
<td><code>tclsh dup.tcl 0.txt</code></td>
<td>2.1 ± 0.2</td>
<td>1.8</td>
<td>2.8</td>
<td>3.36 ± 0.69</td>
</tr>
<tr>
<td><code>sh dup.sh     0.txt</code></td>
<td>3.3 ± 0.3</td>
<td>2.8</td>
<td>4.7</td>
<td>5.32 ± 1.15</td>
</tr>
<tr>
<td><code>python dup.py 0.txt</code></td>
<td>12.1 ± 0.5</td>
<td>10.9</td>
<td>13.6</td>
<td>19.25 ± 3.76</td>
</tr>
</tbody>
</table>
<h5 dir="auto"><a id="user-content-second-round" aria-hidden="true" href="#second-round"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Second Round</h5>
<table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>./dup         0.txt err 1.txt 2.txt 3.txt 4.txt</code></td>
<td>4.6 ± 0.6</td>
<td>3.6</td>
<td>7.0</td>
<td>1.00</td>
</tr>
<tr>
<td><code>python dup.py 0.txt err 1.txt 2.txt 3.txt 4.txt</code></td>
<td>17.8 ± 0.8</td>
<td>15.9</td>
<td>20.7</td>
<td>3.84 ± 0.50</td>
</tr>
<tr>
<td><code>sh dup.sh     0.txt err 1.txt 2.txt 3.txt 4.txt</code></td>
<td>30.1 ± 0.9</td>
<td>27.9</td>
<td>32.3</td>
<td>6.51 ± 0.82</td>
</tr>
<tr>
<td><code>tclsh dup.tcl 0.txt err 1.txt 2.txt 3.txt 4.txt</code></td>
<td>34.8 ± 1.4</td>
<td>32.0</td>
<td>37.9</td>
<td>7.53 ± 0.97</td>
</tr>
</tbody>
</table>
<h5 dir="auto"><a id="user-content-third-round" aria-hidden="true" href="#third-round"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Third Round</h5>
<table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>./dup         0.txt err 1.txt 2.txt 3.txt 4.txt torture.txt</code></td>
<td>201.8 ± 7.6</td>
<td>190.7</td>
<td>214.9</td>
<td>1.00</td>
</tr>
<tr>
<td><code>python dup.py 0.txt err 1.txt 2.txt 3.txt 4.txt torture.txt</code></td>
<td>875.6 ± 28.2</td>
<td>848.8</td>
<td>940.7</td>
<td>4.34 ± 0.21</td>
</tr>
<tr>
<td><code>tclsh dup.tcl 0.txt err 1.txt 2.txt 3.txt 4.txt torture.txt</code></td>
<td>1292.4 ± 121.4</td>
<td>1165.9</td>
<td>1484.7</td>
<td>6.40 ± 0.65</td>
</tr>
<tr>
<td><code>sh dup.sh     0.txt err 1.txt 2.txt 3.txt 4.txt torture.txt</code></td>
<td>2212.5 ± 47.7</td>
<td>2146.4</td>
<td>2293.4</td>
<td>10.96 ± 0.47</td>
</tr>
</tbody>
</table>
<p dir="auto">Although I prefer the Go and Tcl approach above of directly implementing
the solution to the problem, I do see some advantages to Python&#39;s dependence
on more complex libraries when it comes to performance in this case.</p>
<h2 dir="auto"><a id="user-content-get-request" aria-hidden="true" href="#get-request"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>GET request</h2>
<p dir="auto">We do the equivalent of <code>curl whatever</code> and print the result.</p>
<h4 dir="auto"><a id="user-content-go-2" aria-hidden="true" href="#go-2"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Go</h4>
<div dir="auto"><pre><span>package</span> main

<span>import</span> (
	<span>&#34;fmt&#34;</span>
	<span>&#34;io/ioutil&#34;</span>
	<span>&#34;net/http&#34;</span>
	<span>&#34;os&#34;</span>
)

<span>func</span> <span>main</span>() {
	<span>for</span> <span>_</span>, <span>url</span> <span>:=</span> <span>range</span> <span>os</span>.<span>Args</span>[<span>1</span>:] {
		<span>resp</span>, <span>err</span> <span>:=</span> <span>http</span>.<span>Get</span>(<span>url</span>)
		<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
			<span>fmt</span>.<span>Fprintf</span>(<span>os</span>.<span>Stderr</span>, <span>&#34;fetch: %v<span>\n</span>&#34;</span>, <span>err</span>)
			<span>os</span>.<span>Exit</span>(<span>1</span>)
		}
		<span>b</span>, <span>err</span> <span>:=</span> <span>ioutil</span>.<span>ReadAll</span>(<span>resp</span>.<span>Body</span>)
		<span>resp</span>.<span>Body</span>.<span>Close</span>()
		<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
			<span>fmt</span>.<span>Fprintf</span>(<span>os</span>.<span>Stderr</span>, <span>&#34;fetch: reading %s: %v<span>\n</span>&#34;</span>, <span>url</span>, <span>err</span>)
			<span>os</span>.<span>Exit</span>(<span>1</span>)
		}
		<span>fmt</span>.<span>Printf</span>(<span>&#34;%s&#34;</span>, <span>b</span>)
	}
}</pre></div>
<h4 dir="auto"><a id="user-content-python-2" aria-hidden="true" href="#python-2"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Python</h4>
<div dir="auto"><pre><span>#!/usr/bin/env python</span>

<span>import</span> <span>requests</span>
<span>import</span> <span>sys</span>

<span>url</span> <span>=</span> <span>sys</span>.<span>argv</span>[<span>1</span>]

<span>try</span>:
    <span>response</span> <span>=</span> <span>requests</span>.<span>get</span>(<span>url</span>)
<span>except</span> <span>Exception</span> <span>as</span> <span>e</span>:
    <span>print</span>(<span>&#34;fetch: &#34;</span>, <span>e</span>)
    <span>sys</span>.<span>exit</span>(<span>1</span>)

<span>print</span>(<span>response</span>.<span>text</span>)</pre></div>
<p dir="auto">The <code>requests</code> here is a third-party package that required installation
and a virtual environment to use. I don&#39;t know how to catch more
granular exceptions in this example.</p>
<h4 dir="auto"><a id="user-content-tcl-2" aria-hidden="true" href="#tcl-2"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Tcl</h4>
<div dir="auto"><pre><span><span>#</span>!/usr/bin/env tclsh</span>

<span>package</span> require http

<span>set</span> url [<span>lindex</span> <span>$argv</span> 0]

<span>proc</span> <span>main</span> {url} {
    try {
        <span>set</span> http [::http::geturl <span>$url</span>]
    } on error {err} {
        <span>puts</span> stderr <span><span>&#34;</span>fetch: <span>$err</span><span>&#34;</span></span>
        <span>exit</span> 1
    }
    
    try {
        <span>set</span> html [::http::data <span>$http</span>]
    } on error {err} {
        <span>puts</span> stderr <span><span>&#34;</span>fetch: reading <span>$url</span> <span>$err</span><span>&#34;</span></span>
        <span>exit</span> 1
    }
    
    <span>puts</span> <span>$html</span>
}

main <span>$url</span></pre></div>
<h4 dir="auto"><a id="user-content-benchmarks-1" aria-hidden="true" href="#benchmarks-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Benchmarks</h4>
<p dir="auto">The first test is with a local file served with <a href="https://github.com/svenstaro/miniserve">miniserve</a>,
in order to see how fast is it possible to complete the request.
The second test is with a remote server to simulate real-world use.</p>
<h5 dir="auto"><a id="user-content-first-round-1" aria-hidden="true" href="#first-round-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>First Round</h5>
<table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>./fetch         http://[::1]:8080</code></td>
<td>1.7 ± 0.2</td>
<td>1.3</td>
<td>2.6</td>
<td>1.00</td>
</tr>
<tr>
<td><code>sh fetch.sh     http://[::1]:8080</code></td>
<td>5.1 ± 0.4</td>
<td>4.4</td>
<td>7.0</td>
<td>3.07 ± 0.43</td>
</tr>
<tr>
<td><code>tclsh fetch.tcl http://[::1]:8080</code></td>
<td>10.2 ± 0.4</td>
<td>9.5</td>
<td>11.9</td>
<td>6.16 ± 0.76</td>
</tr>
<tr>
<td><code>python fetch.py http://[::1]:8080</code></td>
<td>89.5 ± 1.0</td>
<td>88.0</td>
<td>91.5</td>
<td>54.03 ± 6.34</td>
</tr>
</tbody>
</table>
<h5 dir="auto"><a id="user-content-second-round-1" aria-hidden="true" href="#second-round-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Second Round</h5>
<table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sh fetch.sh     http://example.com</code></td>
<td>251.4 ± 22.7</td>
<td>235.2</td>
<td>289.2</td>
<td>1.00</td>
</tr>
<tr>
<td><code>./fetch         http://example.com</code></td>
<td>253.5 ± 22.9</td>
<td>232.5</td>
<td>282.7</td>
<td>1.01 ± 0.13</td>
</tr>
<tr>
<td><code>tclsh fetch.tcl http://example.com</code></td>
<td>259.2 ± 21.9</td>
<td>240.7</td>
<td>292.6</td>
<td>1.03 ± 0.13</td>
</tr>
<tr>
<td><code>python fetch.py http://example.com</code></td>
<td>342.8 ± 21.9</td>
<td>319.7</td>
<td>370.7</td>
<td>1.36 ± 0.15</td>
</tr>
</tbody>
</table>
<p dir="auto">It&#39;s possible I am simply not familiar enough with Python to see how to
get that granular exception handling, but I like how Tcl strikes a balance:
the code is explicit without being verbose. I don&#39;t want to fuss with
third-party libraries.</p>
<h2 dir="auto"><a id="user-content-parallel-get-requests" aria-hidden="true" href="#parallel-get-requests"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Parallel GET requests</h2>
<p dir="auto">This time we do multiple parallel requests,
and then calculate the size of the response
and how long it took to get it in seconds.
The output should look like this:</p>
<div dir="auto"><pre>$ ./script http://example.com http://ddg.gg
0.38s     1256  http://example.com
1.08s     5999  http://ddg.gg
1.08s elapsed</pre></div>
<h4 dir="auto"><a id="user-content-go-3" aria-hidden="true" href="#go-3"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Go</h4>
<div dir="auto"><pre><span>package</span> main

<span>import</span> (
    <span>&#34;fmt&#34;</span>
    <span>&#34;io&#34;</span>
    <span>&#34;io/ioutil&#34;</span>
    <span>&#34;net/http&#34;</span>
    <span>&#34;os&#34;</span>
    <span>&#34;time&#34;</span>
)

<span>func</span> <span>main</span>() {
    <span>start</span> <span>:=</span> <span>time</span>.<span>Now</span>()
    <span>ch</span> <span>:=</span> <span>make</span>(<span>chan</span> <span>string</span>)
    <span>for</span> <span>_</span>, <span>url</span> <span>:=</span> <span>range</span> <span>os</span>.<span>Args</span>[<span>1</span>:] {
        <span>go</span> <span>fetch</span>(<span>url</span>, <span>ch</span>) <span>// start a goroutine</span>
    }
    <span>for</span> <span>range</span> <span>os</span>.<span>Args</span>[<span>1</span>:] {
        <span>fmt</span>.<span>Println</span>(<span>&lt;-</span><span>ch</span>) <span>// receive from channel ch</span>
    }
    <span>fmt</span>.<span>Printf</span>(<span>&#34;%.2fs elapsed<span>\n</span>&#34;</span>, <span>time</span>.<span>Since</span>(<span>start</span>).<span>Seconds</span>())
}

<span>func</span> <span>fetch</span>(<span>url</span> <span>string</span>, <span>ch</span> <span>chan</span><span>&lt;-</span> <span>string</span>) {
    <span>start</span> <span>:=</span> <span>time</span>.<span>Now</span>()
    <span>resp</span>, <span>err</span> <span>:=</span> <span>http</span>.<span>Get</span>(<span>url</span>)
    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
        <span>ch</span> <span>&lt;-</span> <span>fmt</span>.<span>Sprint</span>(<span>err</span>) <span>// send to channel ch</span>
        <span>return</span>
    }

    <span>nbytes</span>, <span>err</span> <span>:=</span> <span>io</span>.<span>Copy</span>(<span>ioutil</span>.<span>Discard</span>, <span>resp</span>.<span>Body</span>)
    <span>resp</span>.<span>Body</span>.<span>Close</span>() <span>// avoid leaking resources</span>
    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
        <span>ch</span> <span>&lt;-</span> <span>fmt</span>.<span>Sprintf</span>(<span>&#34;while reading %s: %v&#34;</span>, <span>url</span>, <span>err</span>)
        <span>return</span>
    }
    <span>secs</span> <span>:=</span> <span>time</span>.<span>Since</span>(<span>start</span>).<span>Seconds</span>()
    <span>ch</span> <span>&lt;-</span> <span>fmt</span>.<span>Sprintf</span>(<span>&#34;%.2fs  %7d  %s&#34;</span>, <span>secs</span>, <span>nbytes</span>, <span>url</span>)
}</pre></div>
<h4 dir="auto"><a id="user-content-python-3" aria-hidden="true" href="#python-3"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Python</h4>
<div dir="auto"><pre><span>#!/usr/bin/env python</span>

<span>import</span> <span>json</span>
<span>import</span> <span>requests</span>
<span>import</span> <span>sys</span>
<span>import</span> <span>time</span>

<span>from</span> <span>concurrent</span>.<span>futures</span> <span>import</span> <span>ThreadPoolExecutor</span>

<span>def</span> <span>fetch_url</span>(<span>data</span>):
    <span>index</span>, <span>url</span> <span>=</span> <span>data</span>
    <span>try</span>:
        <span>r</span> <span>=</span> <span>requests</span>.<span>get</span>(<span>url</span>, <span>timeout</span><span>=</span><span>10</span>)
    <span>except</span> <span>requests</span>.<span>exceptions</span>.<span>ConnectTimeout</span>:
        <span>return</span>

    <span>time_taken</span> <span>=</span> <span>round</span>(<span>time</span>.<span>time</span>()<span>-</span><span>start</span>, <span>2</span>)
    <span>print</span>(<span>&#39;{}s <span>\t</span>{}&#39;</span>.<span>format</span>(<span>time_taken</span>, <span>len</span>(<span>r</span>.<span>text</span>)))

<span>start</span> <span>=</span> <span>time</span>.<span>time</span>()
<span>with</span> <span>ThreadPoolExecutor</span>(<span>max_workers</span><span>=</span><span>10</span>) <span>as</span> <span>runner</span>:
    <span>for</span> <span>_</span> <span>in</span> <span>runner</span>.<span>map</span>(<span>fetch_url</span>, <span>enumerate</span>(<span>sys</span>.<span>argv</span>[<span>1</span>:])):
        <span>pass</span>

    <span>runner</span>.<span>shutdown</span>()

<span>time_taken</span> <span>=</span> <span>round</span>(<span>time</span>.<span>time</span>()<span>-</span><span>start</span>, <span>2</span>)
<span>print</span>(<span>&#39;{}s elapsed&#39;</span>.<span>format</span>(<span>time_taken</span>))</pre></div>
<h4 dir="auto"><a id="user-content-tcl-3" aria-hidden="true" href="#tcl-3"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Tcl</h4>
<div dir="auto"><pre><span><span>#</span>!/usr/bin/env tclsh</span>

<span>package</span> require http

<span>set</span> done false
<span>set</span> requests 0
<span>set</span> responses 0
<span>set</span> start [<span>clock</span> milliseconds]

<span>proc</span> <span>main</span> {urls} {
    <span>global</span> done start
    
    <span>foreach</span> url <span>$urls</span> {
        fetch <span>$url</span>
    }

    <span>vwait</span> done

    <span>set</span> stop [<span>clock</span> milliseconds]
    <span>puts</span> [<span>format</span> {%0.2fs elapsed} [<span>expr</span> {(<span>$stop</span> - <span>$start</span>) / 1000.0}]]
}

<span>proc</span> <span>fetch</span> {url} {
    <span>global</span> requests

    try {
        ::http::geturl <span>$url</span> -command callback
        <span>incr</span> requests
    } on error {err} {
        <span>puts</span> stderr <span><span>&#34;</span>fetch: <span>$err</span><span>&#34;</span></span>
        <span>exit</span> 1
    }
}

<span>proc</span> <span>callback</span> {token} {
    <span>global</span> done requests responses start

    try {
        <span>set</span> data [::http::data <span>$token</span>]
    } on error {err} {
        <span>puts</span> stderr <span><span>&#34;</span>fetch: reading <span>$url</span> <span>$err</span><span>&#34;</span></span>
        <span>exit</span> 1
    }

    <span>set</span> stop [<span>clock</span> milliseconds] 
    <span>set</span> elapsed [<span>format</span> {%0.2fs} [<span>expr</span> {(<span>$stop</span> - <span>$start</span>) / 1000.0}]]
    <span>set</span> length [<span>string</span> length <span>$data</span>]

    <span>puts</span> <span><span>&#34;</span><span>$elapsed</span><span>\t</span><span>$length</span><span>&#34;</span></span>

    <span>incr</span> responses

    <span>if</span> {<span>$requests</span> eq <span>$responses</span>} {
        <span>set</span> done true
    }
}

main <span>$argv</span></pre></div>
<p dir="auto">Note that in the above code, <code>expr</code> is a command that interprets a
domain-specific language for mathematical expressions. Tcl allows you
to write your own DSLs as well.</p>
<h4 dir="auto"><a id="user-content-benchmark-1" aria-hidden="true" href="#benchmark-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Benchmark</h4>
<table>
<thead>
<tr>
<th>Command</th>
<th>Mean [ms]</th>
<th>Min [ms]</th>
<th>Max [ms]</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tclsh ./fetchall.tcl http://example.com http://github.com http://127.0.0.1:8080 http://127.0.0.1:1222 http://127.0.0.1:1223</code></td>
<td>245.1 ± 29.0</td>
<td>220.6</td>
<td>336.6</td>
<td>1.00</td>
</tr>
<tr>
<td><code>./fetchall http://example.com http://github.com http://127.0.0.1:8080 http://127.0.0.1:1222 http://127.0.0.1:1223</code></td>
<td>253.6 ± 64.4</td>
<td>213.3</td>
<td>444.4</td>
<td>1.03 ± 0.29</td>
</tr>
<tr>
<td><code>python ./fetchall.py http://example.com http://github.com http://127.0.0.1:8080 http://127.0.0.1:1222 http://127.0.0.1:1223</code></td>
<td>348.5 ± 27.0</td>
<td>321.9</td>
<td>400.8</td>
<td>1.42 ± 0.20</td>
</tr>
</tbody>
</table>
<p dir="auto">I was surprised to see Tcl be <em>faster</em> than Go on average. Perhaps this
is due to network variance, but my home connection is pretty stable.
In any case, all three programs perform acceptably but work differently.
Go of course used its version of light-weight processes, goroutines.
The Python code was multi-threaded. Tcl supports multiple threads and
coroutines, but for this task it seemed best to use the event loop and
callbacks. The Tcl program is longer, but the logic of how it works is
all on the page—Python again required third-party packages and a virtual
environment to get working.</p>
<h2 dir="auto"><a id="user-content-conclusion" aria-hidden="true" href="#conclusion"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Conclusion</h2>
<p dir="auto">Hopefully the above examples give a sense of Tcl. In general, I think the
sales pitch for Tcl is that it is simple, fast, and expressive. Tcl has
been extended for automating interactions with <a href="https://core.tcl-lang.org/expect/index" rel="nofollow">Expect</a> and writing
cross-platform GUI applications with <a href="https://en.wikibooks.org/wiki/Tcl_Programming/Tk" rel="nofollow">Tk</a>. To learn more, check out these
resources:</p>
<ul dir="auto">
<li><a href="https://learnxinyminutes.com/docs/tcl/" rel="nofollow">Learn Tcl in Y Minutes</a></li>
<li><a href="http://antirez.com/articoli/tclmisunderstood.html" rel="nofollow">Tcl the Misunderstood</a></li>
<li><a href="https://wiki.tcl-lang.org/page/Tcl+Tutorial+Index" rel="nofollow">Tcl Tutorial</a></li>
</ul>
</article>
  </div>

  </div>
</div></div>
  </body>
</html>
