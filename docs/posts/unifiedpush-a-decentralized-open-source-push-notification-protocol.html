<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://f-droid.org/2022/12/18/unifiedpush.html">Original</a>
    <h1>UnifiedPush: A decentralized, open-source push notification protocol</h1>
    
    <div id="readability-page-1" class="page"><div>

      


      <div>

        <div>
          <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>A modern Android smartphone relies on a lot of services, from app stores and
calendars to messaging and push notifications. Most of them have open
alternatives, but until now, the only option for push notifications was
Google’s proprietary service, <em>Firebase Cloud Messaging</em>
(FCM). <strong>UnifiedPush is a new alternative that allows you to get push
notifications without being tied to a single company</strong>.</p>

<p>Push notifications are essential to the modern mobile experience because
they allow apps to communicate with users in real-time, even when not
actively in use.  Relying on Google-provided push notifications is a concern
for both privacy and independence. The proprietary FCM library cannot be
included in F-Droid apps and relies on having Google services. As a result,
it is common to see FOSS applications adopt a persistent direct connection
between the application and the server as an alternative.</p>

<h2 id="the-limitations-of-direct-app-server-connections">The limitations of direct app-server connections</h2>

<p>While it is technically possible for each application to connect to its own
server and receive notifications directly, there are several reasons why
this approach may not be practical or effective.</p>

<p>Establishing and maintaining a direct connection between an app and a server
can be resource-intensive, which can strain the device’s battery, CPU, and
network resources.</p>

<ul>
  <li>To minimize resource load, the operating system (OS) tries to suspend
applications that are not actively in use. However, if each app actively
maintains a server connection, the OS cannot suspend them.</li>
  <li>Multiple apps pinging their own servers at variable intervals can prevent
the device from going into a low-power sleep mode, which can drain the
device’s battery faster.</li>
  <li>Giving one special app the ability to make priority connections minimizes
these problems and allows for the OS to efficiently suspend other
applications and go to sleep, saving resources and reducing battery
consumption.</li>
  <li>As a developer, managing background services and optimizing connections
can be complex and time-consuming. By using a push notification service,
you can offload this responsibility to a dedicated app, allowing you to
focus on other aspects of your app.</li>
</ul>

<h2 id="how-do-i-start-with-unifiedpush-as-a-user">How do I start with UnifiedPush, as a user?</h2>

<p>Applications that support UnifiedPush can receive notifications via a
dedicated UnifiedPush application that maintains a single server connection
to receive all notifications. We call this “UnifiedPush application” a
<em>distributor</em>; it distributes push notifications to other apps on the
device. You can choose which distributor you want to use, self-host the
server part, or even create your own. For more information on distributors,
check out the <a href="https://unifiedpush.org/users/distributors/">full list</a>.</p>

<p>To use UnifiedPush on an application that supports it, you have to install
and configure your distributor. You can use
<a href="https://f-droid.org/en/packages/org.unifiedpush.example/">UP-Example</a> as a
simple test app.</p>

<p><img src="https://f-droid.org/assets/animation-options_MLZPGs9RJptxV8Q_3U4fEdo2mJcvJDSd4rYpMr7r9og=.svg" alt="An animated SVG that shows how all distributors and apps are interchangeable and still work together through the UnifiedPush protocol"/></p>

<h3 id="tldr-on-android">TL;DR on Android</h3>

<p>The easiest way to set UnifiedPush up with an <a href="https://unifiedpush.org/users/apps/">application that supports
it</a> is to:</p>

<ol>
  <li>Install the <a href="https://ntfy.sh/#subscribe-phone">ntfy</a> Android application;
this is your distributor</li>
  <li>Open it, and disable battery optimization for it</li>
  <li>Turn on UnifiedPush in the application; it will detect ntfy
automatically. (This step depends on the app’s UX)</li>
</ol>

<p><img src="https://f-droid.org/assets/distributor-selection_kcH2I9W24oZPfVcrgTZ7zcZ9S4royYU2TbPICUt2UVc=.png" alt="A screenshot of the distributor selection screen showing Gotify-UP, Google Services, ntfy, UP-FCM Distributor, NextPush, NoProvider2Push"/></p>

<h2 id="how-to-add-unifiedpush-support-to-my-app-as-a-developer">How to add UnifiedPush support to my app, as a developer?</h2>

<p>To add UnifiedPush support to your application, you first need to ensure
that your server is UnifiedPush compatible: it must be able to send
notifications to different endpoints, which are URLs pointing to various
servers used by users. If your application uses a gateway to work with
Google push notifications, modifying the gateway can make it compatible with
UnifiedPush.</p>

<p>On the mobile app side, once the user enables UnifiedPush, you have to check
for installed distributors on the user’s device. The app should then prompt
the user to select the distributor they want to use. Afterward, you can
register with it.</p>

<p>The selected distributor will then send a new endpoint, which the
application should forward to its server. Then, the app prepares to receive
data sent to that endpoint by registering an Android BroadcastReceiver. This
BroadcastReceiver handles the messages coming from your server (often a ping
to fetch the notifications).</p>

<p>It is important to register the application with the selected distributor
every time the application starts, in case they get out of sync. If the
application receives the same endpoint again, it does not need to
re-register it.</p>

<p>Most of this is handled by the UnifiedPush library. You can find more
detailed instructions on <a href="https://unifiedpush.org/developers/android/">our documentation
website</a>.</p>

<p>If you need help with implementing UnifiedPush in your app, we are happy to
answer any questions you have on our <a href="https://matrix.to/#/#unifiedpush:matrix.org">Matrix
chat</a>.</p>

<p><em>Note: This blog post focuses on Android; instructions to add UnifiedPush support on a Linux application can be found <a href="https://unifiedpush.org/developers/go_c/">on our website</a>.</em></p>

<h2 id="how-does-unifiedpush-work-under-the-hood">How does UnifiedPush work under the hood?</h2>

<p>At its core, UnifiedPush is a specification. That specification is split
into two halves:</p>

<ul>
  <li>On the device (client) side, it defines an Application Programming
Interface (API) to allow <strong>any end-user application</strong> (ex. your messaging
app) to communicate with <strong>any distributor application</strong> (ntfy, NextPush,
etc.)</li>
  <li>On the server side, the API describes how the <strong>application server</strong>
(Matrix homeserver, Mastodon instance, etc.) sends messages to the <strong>push
server</strong> (ntfy server, Nextcloud server, etc.).</li>
</ul>

<p>Our client libraries and the reference proxies assist in implementing both
sides of the specification, respectively.</p>

<p>To obtain a UnifiedPush endpoint (capability URL to send notifications to),
the end-user application registers with the UnifiedPush distributor, which
maintains a constant connection with the push server. Upon registration, the
distributor provides the application with a unique URL pointing to the push
server. This endpoint URL is then transmitted by the application client to
the application server.</p>

<p>When the application server needs to send a push message to the end-user
application, it sends the message to the push server with a simple HTTP POST
request. The push server then forwards the push message to the distributor,
which delivers it to the end-user application.</p>

<p>One key feature of UnifiedPush is that the communication between the push
server and the distributor is not specified. This means that a variety of
technologies can be employed, such as WebSockets, Server-Sent Events, XMPP,
raw TCP, or even SMS, whatever works best for the user.</p>

<p><img src="https://f-droid.org/assets/animation-flow_mn6UvHd72uYVuF8n36saeLBGpdRSR8O5O90R3delqI4=.svg" alt="An animated SVG showing a message moving through all the steps of
UnifiedPush from the Application Server to the Push Server to (on the phone)
Distributor app and the end-user application, which then wakes up and emits
an Android notification"/></p>

<p>The distributor uses platform-specific IPC mechanisms, such as Broadcast
Intents on Android or D-Bus on Linux, to wake the app and allow it to handle
the push message. The app can then process the data and decide whether to
show a notification based on the content. It is important to note that
UnifiedPush does not handle the display of user-visible notifications; it
only delivers data to the app. Consequently, apps can support notification
features in various platforms without involvement from UnifiedPush or the
server.</p>

<p>In cases where the application server does not natively support UnifiedPush,
a Push Gateway can convert application-specific notifications to the
UnifiedPush server protocol. Some popular Push Gateways, such as the one for
Matrix, are integrated directly into push servers for self-hosting
convenience. In addition, Rewrite Proxies are used in rare cases where the
push server does not support UnifiedPush, such as the FCM distributor
sending UnifiedPush-over-FCM.</p>

<p><img src="https://f-droid.org/assets/detailed-component-diagram_6cGPhCr3oZVif0gAwk4LaZNwdXop9PIRvEg08dvCK4c=.png" alt="A static image showing all the components described above linking to one
another"/>  <em>Push
Provider = Push Server</em></p>

<h2 id="compatibility-between-unifiedpush-and-webpush">Compatibility between UnifiedPush and WebPush</h2>

<p>Now, you might be looking at the elephant in the room: WebPush
(RFC8030). WebPush is the open standard that browsers use for their push
notifications. And the good news is that UnifiedPush is WebPush compatible
… mostly.</p>

<p>Basically, application servers that support WebPush but <em>do not need its
advanced features</em> and <em>do not restrict push to only popular WebPush
servers</em> (those from browser vendors) should work without problems with
UnifiedPush providers. We are working on solutions to ensure better and more
stable WebPush support.</p>

<h2 id="future-plans">Future plans</h2>

<ul>
  <li>The more apps that adopt UnifiedPush, the more useful it
becomes. Currently, UnifiedPush is supported by many Matrix and Mastodon
apps. We are also working on getting open-source versions of popular apps
such as Telegram and Signal to support UnifiedPush.</li>
  <li>Improving WebPush support will also help to increase the number of apps
that can use UnifiedPush. We are working towards better WebPush
compatibility with UnifiedPush.</li>
  <li>What about built-in distributors in custom Android ROMs like Lineage OS or
/e/OS (murena)? Their support could hugely accelerate UnifiedPush-support
in the De-Googled community.</li>
  <li>Linux platforms can also benefit from UnifiedPush. Improving the Linux
specification and increasing its adoption will help improve battery life
and reactivity.</li>
  <li>As UnifiedPush is very flexible, some platforms could achieve even greater
efficiency gains by using low-power hardware for the distributor: keeping
it on the modem or a low-power core while the phone is asleep.</li>
</ul>

<hr/>

<p>At the end of the day, if you use a Matrix or Mastodon app or one of the
other <a href="https://unifiedpush.org/users/apps/">supported apps</a> on Android,
there’s a good chance that you can use UnifiedPush to get your push
notifications without relying on Google. You can start using UnifiedPush
today by just installing <a href="https://ntfy.sh/#subscribe-phone">ntfy</a> or
<a href="https://unifiedpush.org/users/distributors/">choosing another distributor</a>.</p>

<p>If you are an app developer interested in your app receiving push
notifications when installed from F-Droid and allowing your users to have
independent, self-hosted infrastructure, check out UnifiedPush and feel free
to <a href="https://matrix.to/#/#unifiedpush:matrix.org">talk to us</a> if you have any
questions!</p>


  </div>

</article>

        </div>

        

      </div>

      


    </div></div>
  </body>
</html>
