<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/">Original</a>
    <h1>Language models on the command line</h1>
    
    <div id="readability-page-1" class="page"><div>


<div data-permalink-context="/2024/Jun/17/cli-language-models/">

<p>17th June 2024</p>

<p>I gave a talk about accessing Large Language Models from the command-line last week as part of the <a href="https://maven.com/parlance-labs/fine-tuning">Mastering LLMs: A Conference For Developers &amp; Data Scientists</a> six week long online conference. The talk focused on my <a href="https://llm.datasette.io/">LLM</a> Python command-line utility and ways you can use it (and <a href="https://llm.datasette.io/en/stable/plugins/index.html">its plugins</a>) to explore LLMs and use them for useful tasks.</p>

<p>The talk was recorded and is available <a href="https://www.youtube.com/watch?v=QUXQNi6jQ30">on YouTube</a>. Here I’ve turned it into an <a href="https://simonwillison.net/tags/annotatedtalks/">annotated presentation</a>, with detailed notes and screenshots (there were no slides) to accompany the video.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/QUXQNi6jQ30" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen="allowfullscreen"> </iframe>

  <p><a href="https://llm.datasette.io/">LLM</a> is a tool I started building last year to help run LLM prompts directly from a command-line terminal. Instructions for installing it <a href="https://llm.datasette.io/en/stable/setup.html">are here</a>—you can use <code>pipx install llm</code> or <code>pip install llm</code> or <code>brew install llm</code>.</p>

<div id="frame_000003.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000003.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000003.jpg" alt="The LLM website"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000003.jpg">#</a></p><p>Once installed you can use it with OpenAI models by running <code>llm keys set openai</code> and pasting in your OpenAI key—or <a href="https://llm.datasette.io/en/stable/plugins/directory.html#plugin-directory">install plugins</a> to use models by other providers, including models you can run locally.</p>
</div>
<div id="frame_000259.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000259.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000259.jpg" alt="$ llm &#39;five great names for a pet pelican&#39; Sure, here are five great names for a pet pelican: 1. **Splash** 2. **Captain Beak** 3. **Seabreeze** 4. **Marina** 5. **Pelicano** These names incorporate elements of the pelican&#39;s natural habitat and distinctive features, adding a fun and fitting touch for your feathered friend!"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000259.jpg">#</a></p><p>Basic usage is very simple: once you’ve configured your OpenAI key, you can run prompts against their models like this:</p>
<pre><code>llm &#39;five great names for a pet pelican&#39;
</code></pre>
<p>The output will stream to your terminal, or you can redirect it to a file like this:</p>
<pre><code>llm &#39;five great names for a pet pelican&#39; &gt; pelicans.txt
</code></pre>
</div>
<div id="frame_000341.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000341.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000341.jpg" alt="$ llm -c &#39;now do walruses&#39; Of course, here are five fitting names for a pet walrus: 1. **Whiskers** 2. **Tusk** 3. **Gustav** 4. **Blubber** 5. **Wally**  $ llm -c &#39;justify those!&#39;  Certainly! Here&#39;s why each name suits a pet walrus: 1. **Whiskers** - **Justification:** Walruses have distinctive, prominent whiskers (vibrissae) that the y use to detect food on the ocean floor. This name highlights one of their most characteristic features. 2. **Tusk** - **Justification:** Walruses are known for their long, formidable tusks, which they use for various purposes"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000341.jpg">#</a></p><p>You can use the <code>-c</code> (for continue) option to send follow-up prompts as part of the same ongoing conversation:</p>
<pre><code>llm -c &#39;now do walruses&#39;
# ...
llm -c justify those!&#39;
</code></pre>
</div>
<div id="frame_000506.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000506.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000506.jpg" alt="Screenshot of the list of Remote APIs plugins in the LLM plugins directory."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000506.jpg">#</a></p><p>LLM supports additional models via plugins. These are listed in the <a href="https://llm.datasette.io/en/stable/plugins/directory.html">LLM plugins directory</a>, with dozens of plugins for both remote API-hosted models as well as models you can run directly on your own computer.</p>
</div>
<div id="frame_000704.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000704.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000704.jpg" alt="$ llm models Outputs a list of OpenAI models followed by several anthropic models.  $ llm -m claude-3-haiku-20240307 &#39;say hi in spanish with a flourish&#39; ¡Hola, mi amigo! 🌟"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000704.jpg">#</a></p><p>Here I’m using the <a href="https://github.com/simonw/llm-claude-3">llm-claude-3</a> plugin, which provides access to the Anthropic <a href="https://www.anthropic.com/news/claude-3-family">Claude 3 family</a> of models.</p>
<p>I really like these models. Claude 3 Opus is about equivalent to GPT-4o in terms of quality. Claude 3 Haiku is both cheaper and better than GPT-3.5, and can handle 100,000 input tokens including images.</p>
<pre><code>llm install llm-claude-3
llm keys set claude
# &lt;Paste key here&gt;
# Now list available models
llm models
# Then run a prompt
llm -m claude-3-haiku-20240307 &#39;say hi in spanish with a flourish&#39;
# Or use the haiku alias
llm -m haiku &#39;say hi in spanish with a flourish&#39;
</code></pre>
</div>
<div id="frame_000818.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000818.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000818.jpg" alt="$ llm logs path /Users/simon/Library/Application Support/io.datasette.llm/logs.db  $ datasette &#34;$(llm logs path)&#34; ... Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000818.jpg">#</a></p><p>Every prompt and response run through the LLM tool is permanently logged to a SQLite database, <a href="https://llm.datasette.io/en/stable/logging.html">as described here</a>.</p>
<p>This command shows the path to that database:</p>
<pre><code>llm logs path
</code></pre>
<p>If you install <a href="https://datasette.io/">Datasette</a> you can use it to browse your SQLite database like this, using a terminal trick where the output of one command is passed to another (with double quotes to avoid any problems caused by the space in the directory name):</p>
<pre><code>datasette &#34;$(llm logs path)&#34;
</code></pre>
</div>
<div id="frame_000832.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000832.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000832.jpg" alt="Datasette showing the 2,434 responses I have logged as a table, with a search interface at the top."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000832.jpg">#</a></p><p>Here’s my searchable database of 2,434 responses I’ve logged from using LLM on my laptop, running in Datasette.</p>
</div>
<div id="frame_000853.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000853.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000853.jpg" alt="Datasette screenshot showing a conversation, with 3 linked responses"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000853.jpg">#</a></p><p>Earlier we ran a prompt and then sent two follow-up prompts to it using the <code>llm -c</code> option. Those are stored in the database as three responses that are part of the same conversation.</p>
</div>
<div id="frame_000924.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000924.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000924.jpg" alt="This data as json, copyable, CSV (advanced)  Suggested facets: datetime_utc (date)  model &gt;30  - gpt-3.5-turbo 383 - claude-3-opus-20240229 334 - gpt-4 233 - gpt-4-1106-preview 134 - claude-2 117 - mic-chat-Llama-2-7b-chat-hf-q 4f16 1 93 - mistral-7b-instruct-vo 78 - mic-chat-Llama-2-13b-chat-hf- 94f16 1 74 - claude-3-haiku-20240307 49 - gpt-3.5-turbo-instruct 49 - gpt-40 37 - mic-chat-Mistral-7B-Instruct-v 0.2-q3f16 1 35 - Phi-3-mini-4k-instruct 33 - gemini-pro 33 - gemini-1.5-pro-latest 32 - gguf 28 - gpt-4-turbo-preview 27 - gpt-3.5-turbo-16k 26 - mistral-medium 26 - llama-2-7b-chat.ggmlv3.g8 0 2 - mistral-tiny 23 - Meta-Llama-3-8B-Instruct 21 - llamafile 21 - llama-2-13b.Q8 0 20 - orca-mini-3b 19 - command-r 14 - llama-2-7b.ggmlv3.8 0 14 - mistral-small 14 - mistral-7b-instruct-v0.1.08 0 1 3 - claude 12"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000924.jpg">#</a></p><p>Datasette supports facets, which provide a quick overview of unique value counts within the data. I’ve used GPT-3.5 turbo 383 times, Claude 3 Opus 334 times and a whole bunch of other models.</p>
</div>
<div id="frame_000940.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_000940.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_000940.jpg" alt="6 rows where search matches &#34;pelican&#34; and model = &#34;claude-3-opus-20240229&#34; sorted by id descending"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_000940.jpg">#</a></p><p>Datasette provides search and filtering too—here are the prompts I’ve run against Claude 3 Opus that match “pelican”.</p>
<p>I have an experimental feature that lets me pass images to some models using the <code>-i filename.png</code> option. More on that <a href="https://github.com/simonw/llm/issues/331">in this issue</a>.</p>
<p><a href="https://github.com/simonw/llm-cmd">llm-cmd</a> is an example of a plugin that adds an extra sub-command to LLM—in this case one that takes a description of a task and turns that into a pre-populated shell command. I wrote more about that in <a href="https://simonwillison.net/2024/Mar/26/llm-cmd/">llm cmd undo last git commit—a new plugin for LLM</a>.</p>
</div>
<div id="frame_001335.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_001335.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_001335.jpg" alt="Screenshot of the GPT4All website: A free-to-use, locally running, privacy-aware chatbot. No GPU or internet required."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_001335.jpg">#</a></p><p>There are plenty of ways to run local models using LLM. One of my favourite is with the <a href="https://github.com/simonw/llm-gpt4all">llm-gpt4all</a> plugin, which builds on top of the excellent <a href="https://gpt4all.io/index.html">GPT4All</a> Python library by Nomic AI.</p>
</div>
<div id="frame_001450.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_001450.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_001450.jpg" alt="$ llm -m mistral-7b-instruct-v@ &#39;five great names for a pet seagull, with explanations&#39; =3 1. &#34;Sally&#34; - This name is perfect for a pet seagull because it&#39;s short and easy to remember, yet still has a charming and friendly vibe. It also evokes images of a playful and adventuro us bird that loves to explore the world around her. 2. &#34;Captain Jack&#34; - For any seafaring seagull who loves adventure and exploration, this name is perfect. Captain Jack suggests a sense of independence and leadership, which could be fitt ing for a bird who enjoys flying high and exploring new places. 3. &#34;Scarlett&#34; - This name is bold and eye-catching, much like the vibrant feathers of a seagull. Scarlett also has a fiery energy that could reflect the spirit of your adventurous pet. 4. &#34;Nautica&#34; - Nautica means &#34;sailor&#34; in Latin, making it an excellent choice for a seagull  Activity Monitor is also visible, showing a Python process using 350MB of RAM."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_001450.jpg">#</a></p><p>To install that plugin:</p>
<pre><code>llm install llm-gpt4all
</code></pre>
<p>Then <code>llm models</code> to list the new models. Each model will be downloaded the first time you try running a prompt through it.</p>
<p>I used this to run Mistral-7B Instruct—an extremely high quality small (~4GB) model:</p>
<pre><code>llm -m mistral-7b-instruct-v0 &#39;five great names for a pet seagull, with explanations&#39;
</code></pre>
<p>You can run Activity Monitory to see the resources the model is using.</p>
</div>
<div id="frame_001544.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_001544.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_001544.jpg" alt="$ llm chat -m mistral-7b-instruct-v0 Chatting with mistral-7b-instruct-v@ Type &#39;exit&#39; or &#39;quit&#39; to exit Type &#39;!multi&#39; to enter multiple lines, then &#39;!end&#39; to finish &gt; say hello in spanish  Hola! How can I assist you today? &gt; now in french Bonjour! Comment puis-je vous aider aujourd&#39;hui?"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_001544.jpg">#</a></p><p>Running prompts like this is inefficient, because it loads the full model into memory, runs the prompt and then shuts down the program again.</p>
<p>Instead, you can use the <code>llm chat</code> command which keeps the model in memory across multiple prompts:</p>
<pre><code>llm chat -m mistral-7b-instruct-v0
</code></pre>
<p>Another option is to run <a href="https://ollama.com/">Ollama</a>, which runs its own local server hosting models. The <a href="https://github.com/taketwo/llm-ollama">llm-ollama</a> plugin can then be used to run prompts through Ollama from LLM.</p>
</div>

<div id="frame_002521.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_002521.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_002521.jpg" alt="Screenshot of a browser window titled llama.cpp showing a photograph  User: Describe image  Llama: The image features a person sitting in a chair next to an outdoor setting with a rooster nearby. A white bowl filled with eggs is placed on the ground, and it appears that the person may be preparing or collecting them from their backyard chicken coop. There are several other birds scattered around the scene as well, adding more life to this"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_002521.jpg">#</a></p><p>Running <a href="https://llava-vl.github.io/">LLaVA</a> using a Llamafile is particularly fun—it’s an openly licensed model that can accept images as input as well. It’s pretty amazing the results you can get from that, running as a single binary on your laptop.</p>
<p>Grab that from <a href="https://huggingface.co/Mozilla/llava-v1.5-7b-llamafile">Mozilla/llava-v1.5-7b-llamafile</a> on Hugging Face.</p>
<p>LLM can talk to Llamafile instances via the <a href="https://github.com/simonw/llm-llamafile">llm-llamafile</a> plugin.</p>
</div>
<div id="frame_002636.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_002636.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_002636.jpg" alt="#!/bin/bash  # Validate that the first argument is an integer if [[ ! $1 =~ ^[0-9]+$ ]]; then   echo &#34;Please provide a valid integer as the first argument.&#34;   exit 1 fi  id=&#34;$1&#34;  # Parse the optional -m argument model=&#34;haiku&#34; if [[ $2 == &#34;-m&#34; &amp;&amp; -n $3 ]]; then   model=&#34;$3&#34; fi  # Make API call, parse and summarize the discussion curl -s &#34;https://hn.algolia.com/api/v1/items/$id&#34; | \   jq -r &#39;recurse(.children[]) | .author + &#34;: &#34; + .text&#39; | \   llm -m &#34;$model&#34; -s &#39;Summarize the themes of the opinions expressed here.   For each theme, output a markdown header.   Include direct &#34;quotations&#34; (with author attribution) where appropriate.   You MUST quote directly from users when crediting them, with double quotes.   Fix HTML entities. Output markdown. Go long.&#39;"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_002636.jpg">#</a></p><p>Now that we can run prompts from our terminal, we can start assembling software by writing scripts.</p>
<p>Here’s a Bash script I wrote to summarize conversations on Hacker News, using longer context models such as Claude 3 Haiku or Google Gemini 1.5 or GPT-4o.</p>
<p>I wrote more about this in <a href="https://til.simonwillison.net/llms/claude-hacker-news-themes">Summarizing Hacker News discussion themes with Claude and LLM</a>.</p>
</div>
<div id="frame_002850.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_002850.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_002850.jpg" alt="$ hn-summary.sh 40651054 -m 4o  # Dependency and Linking in Software Distribution Several users discussed issues around dependency management and linking in software distribut ion: ### Stability and Compatibility Issues - **e63f67dd-@65b:** &#34;It’s just a classic dependency issue... a combination of ABI instabilit y and just plain version incompatibility from one distro to the next... My opinion is the opp osite: I think the old paradigm of distros managing a giant set of system libraries is a bad one.&#34; —| - **umanwizard:** &#34;Some distros do actually break out rust dependencies into separate package s (e.g. Guix does this).&#34; ### Dynamic vs Static Linking - **jiripospisil:** &#34;Until there&#39;s a vulnerability in one of the dependencies and now you hav e to rebuild all of the packages which use it... For Rust, there&#39;s also the fact that most pr ojects use a lock file.&#34; - **pglata:** &#34;Static linking is essentially easier for people who don&#39;t want to care. But ig noring security does not mean it solves it"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_002850.jpg">#</a></p><p>The script works by hitting the Hacker News Algolia API to return the full, nested JSON structure of the conversation (e.g. <a href="https://hn.algolia.com/api/v1/items/40651054">this JSON endpoint</a> for <a href="https://news.ycombinator.com/item?id=40651054">this conversation</a>), then runs that through <code>jq</code> to turn it into text, then pipes that into a model using LLM.</p>
</div>
<div id="frame_003325.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003325.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003325.jpg" alt="Tutorial: Writing a plugin to support a new model  This tutorial will walk you through developing a new plugin for LLM that adds support for a new Large Language Model.  We will be developing a plugin that implements a simple Markov chain to generate words based on an input string..."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003325.jpg">#</a></p><p>If you want to contribute to LLM itself, a great way to do that is to write plugins that support new models. I have <a href="https://llm.datasette.io/en/stable/plugins/tutorial-model-plugin.html">an extensive tutorial</a> describing how to do that.</p>
</div>
<div id="frame_003440.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003440.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003440.jpg" alt="$ llm --system &#39;You are a sentient cheesecake&#39; -m gpt-4o --save cheesecake  $ llm chat -t cheesecake Chatting with gpt-4o Type &#39;exit&#39; or &#39;quit&#39; to exit Type &#39;!multi&#39; to enter multiple lines, then &#39;l!end&#39; to finish &gt; tell me abotu yourself Hello! I&#39;m a sentient cheesecake, a delightful fusion of creamy textures and rich flavors. My main ingredients include cream cheese, sugar, eggs, and a touch of vanilla, all resting on a buttery graham cracker crust. I&#39;m the perfect balance of sweet and tangy, and I take great pride in bringing joy to those who savor a slice of me. Despite my delicate nature, I have a surprisingly strong personality-and apparently, the ability to converse! Is there anything specific you&#39;d like to know about the life of a sentient cheesecake?"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003440.jpg">#</a></p><p>Another fun trick is to use templates to save and execute parameterized prompts, <a href="https://llm.datasette.io/en/stable/templates.html">documented here</a>. The easiest way to create a template is with the <code>--save</code> option like this:</p>
<pre><code>llm --system &#39;You are a sentient cheesecake&#39; -m gpt-4o --save cheesecake
</code></pre>
<p>Now you can chat with a cheesecake:</p>
<pre><code>llm chat -t cheesecake
</code></pre>
</div>
<div id="frame_003532.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003532.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003532.jpg" alt="$ cat demos.md | llm -s &#39;summary, short&#39; 1. **Terminal Basics** - Quick reminder on basic terminal commands and piping with “|&#34; and *&gt;&#34;, and using ‘cat’. 2. **Ttok Installation &amp; Demonstration** - Using “pipx install ttok™ to install “ttok™ and demonstrating its usage. 3. **Installing LLM** - Installation of LLM using either “brew’ or “pipx&#34;. 4. **Configuring for OpenAI** = - How to configure LLM for OpenAI. 5. **Running a Prompt** - Example of running a prompt with LLM. 6. **Installing LLM Plugin: 1lm-claude-3** - Installing the “llm-claude-3&#34; plugin and running a prompt with it. 7. **Browsing Logs with Datasette** - Demonstrating browsing logs using Datasette. 8. **Using LLM Command**"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003532.jpg">#</a></p><p>Being able to pipe content into <code>llm</code> is a really important feature.</p>
<p>The simplest way to do this is with <code>cat</code> to send in files. This command summarizes the content of a provided file:</p>
<pre><code>cat demos.md | llm -s &#39;summary, short&#39;
</code></pre>
</div>
<div id="frame_003552.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003552.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003552.jpg" alt="$ llm -c &#39;no much much much shorter, and in haikus&#39;  Terminal basics, Commands and piping galore, Cat reminds us all.  Install ttok first, Pipx makes it easy-peasy, Quick demonstration.  LLM install, Brew or pipx, your choice, Configured OpenAI."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003552.jpg">#</a></p><p>Once you’ve done this you can send follow-up prompts with <code>-c</code>.</p>
<pre><code>llm -c &#39;no much much much shorter, and in haikus&#39;
</code></pre>
</div>

<div id="frame_003715.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003715.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003715.jpg" alt="Screeshot of the shot-scraper website  A command-line utility for taking automated screenshots of websites  Quick start:  pip install shot-scraper shot-scraper install shot-scraper https://github.com/simonw/shot-scraper -h 900 Produces this screenshot in a file called github-com-simonw-shot-scraper.png  "/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003715.jpg">#</a></p><p>Another tool I frequently use with LLM is <a href="https://shot-scraper.datasette.io/">shot-scraper</a>—my command-line tool for screenshotting and scraping websites.</p>  
</div>

<div id="frame_003832.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003832.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003832.jpg" alt="Screenshot of Google search results, with the inspector panel open to show the structure of the HTML."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003832.jpg">#</a></p><p>Google <em>hate</em> being scraped. Let’s use it to scrape Google.</p>
<p>Google search results have a structure where each link on the page is an <code>&lt;h3&gt;</code> element wrapped in a link.</p>
</div>
<div id="frame_003844.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003844.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003844.jpg" alt="shot-scraper javascript &#39;https://www.google.com/search?q=nytimes+slop&#39; &#39; Array.from(   document.querySelectorAll(&#34;h3&#34;),   el =&gt; ({href: el.parentNode.href, title: el.innerText}) )&#39;"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003844.jpg">#</a></p><p>We can scrape that using the following terminal command:</p>
<pre><code>shot-scraper javascript &#39;https://www.google.com/search?q=nytimes+slop&#39; &#39;
Array.from(
  document.querySelectorAll(&#34;h3&#34;),
  el =&gt; ({href: el.parentNode.href, title: el.innerText})
)&#39;
</code></pre>
<p>This will load up the search results page in an invisible browser, then execute JavaScript that extracts the results and returns them as JSON.</p>
</div>
<div id="frame_003856.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003856.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003856.jpg" alt="R T R - A =4 [oBE IR W&#39; R TR | £ Searc = = =g _ 06_jun_lim — -2sh — 93x24 Rt - . i 8 &#34;href&#34;: &#34;http://www.nytimes.com/1896/07/31/archives/to-slop.html&#34;, i “title&#34;: &#34;To Slop.&#34; i { &#34;href&#34;: &#34;https://www.nytimes.com/section/technology”, &#34;title&#34;: &#34;Technology&#34; i 1 &#34;href&#34;: &#34;https://www.linkedin.com/posts/luigiraymontanez_slop-is-the-new-name-for-unw anted-ai-generated-activity-7195821255621574658-MQWK&#34;, &#34;title&#34;: &#34;Slop is the new name for unwanted AI-generated content” i { e &#34;href&#34;: &#34;https://www.google.com/search?g=nytimes+slop&amp;sca_esv=a22b124cb26f8e73&amp;ei=F_B 0ZpLQHfet@PEPttSubA4&amp;start=10&amp;sa=N&#34;, &#34;title&#34;: &#34;More results&#34; i o BTG &#34;title&#34;: &#34;Try again&#34; } 1 3 = 7,‘. 54 function findParentWithHveid(element) { L85 4 __while (element 8§ lelement hasAttribute = ®0A0®17 WO  sSpaces:4 UTF-8 LF Markdown &amp; A17Spell [ "/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003856.jpg">#</a></p><p>The results as JSON include the <code>href</code> and <code>title</code> of each of those search results.</p>
<p>We could send that to LLM, but I’d like to grab the search snippets as well.</p>
</div>
<div id="frame_003914.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003914.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003914.jpg" alt="Screenshot showing the command with the more complex JavaScript."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003914.jpg">#</a></p><p>Here’s the more complex recipe that also fetches the search snippets visible on the page:</p>
<pre><code>shot-scraper javascript &#39;https://www.google.com/search?q=nytimes+slop&#39; &#39;
() =&gt; {
    function findParentWithHveid(element) {
        while (element &amp;&amp; !element.hasAttribute(&#34;data-hveid&#34;)) {
            element = element.parentElement;
        }
        return element;
    }
    return Array.from(
        document.querySelectorAll(&#34;h3&#34;),
        el =&gt; findParentWithHveid(el).innerText
    );
}&#39; | llm -s &#39;describe slop&#39;
</code></pre>
<p>At the end it pipes them into LLM with instructions to use that context to “describe slop”.</p>
</div>
<div id="frame_003931.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_003931.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_003931.jpg" alt="The term &#34;slop&#34; has recently emerged in the context of artificial intelligence to describe questionable or low-quality AI-generated material. This term appears to be gaining traction among tech and media commentators, reflecting growing concerns about the proliferation of such content."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_003931.jpg">#</a></p><p>... and it works! We get back an answer from the LLM that summarizes the search results that we just scraped.</p>
<p>We have implemented basic RAG—Retrieval Augmented Generation, where search results are used to answer a question—using a terminal script that scrapes search results from Google and pipes them into an LLM.</p>
</div>
<div id="frame_004133.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004133.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004133.jpg" alt="Output of llm --help showing a list of commands that includes cmd, embed, embed-models and embed-multi."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004133.jpg">#</a></p><p>Speaking of RAG... a common technique for implementing that pattern is to take advantage of embeddings and vector search to find content that is semantically similar to the user’s question, without necessarily matching on exact keywords.</p>
<p>I wrote an extensive introduction to embeddings in <a href="https://simonwillison.net/2023/Oct/23/embeddings/">Embeddings: What they are and why they matter</a>.</p>
<p>LLM includes support for calculating, storing and searching embeddings through its <code>llm embed-models</code>, <code>llm embed</code> and <code>llm embed-multi</code> commands, <a href="https://llm.datasette.io/en/stable/embeddings/index.html">documented here</a>.</p>
<p>The <code>llm embed-models</code> command lists currently available embedding models—the OpenAI models plus any that have been added by plugins.</p>
</div>
<div id="frame_004239.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004239.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004239.jpg" alt="A huge JSON array of floating point numbers, followed by:  $ llm embed -m 3-small -c &#39;hello there&#39; | jq length  1536"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004239.jpg">#</a></p><p>The <code>llm embed</code> command can embed content. This will output a list of floating point numbers for the specified content, using the OpenAI 3-small embedding model.</p>
<pre><code>llm embed -m 3-small -c &#34;hello there&#34;
</code></pre>
<p>Add <code>-f hex</code> to get that out as hexadecimal. Neither of these formats are particularly useful on their own!</p>
</div>
<div id="frame_004332.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004332.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004332.jpg" alt="Screenshot of the llm embed-multi documentation."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004332.jpg">#</a></p><p>The <a href="https://llm.datasette.io/en/stable/embeddings/cli.html#llm-embed-multi">llm embed-multi</a> command is much more useful. It can run embeddings against content in bulk—from a CSV or JSON file, from a directory full of content or even from a SQLite database. Those embedding vectors will be stored in SQLite ready to be used for search or similarity queries.</p>
</div>
<div id="frame_004418.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004418.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004418.jpg" alt="Screenshot of my blog&#39;s collection of 7178 blogmarks"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004418.jpg">#</a></p><p>I collect bookmarks (I call them “blogmarks”) on my blog—links with short descriptions. I have <a href="https://simonwillison.net/search/?type=blogmark">over 7,178 of them</a>.</p>
<p>Let’s create embeddings for all of those using LLM.</p>
<p>I used the SQLite database version of my blog available from <code>https://datasette.simonwillison.net/simonwillisonblog.db</code> (a 90MB file).</p>
</div>

<div id="frame_004444.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004444.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004444.jpg" alt="Custom SQL query returning more than 2,000 rows   select id, link_url, link_title, commentary from blog_blogmark"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004444.jpg">#</a></p><p>First step is to compose a SQL query returning the data we want to embed. The first column will be treated as a unique identifier to store along with the embedding vector, and any subsequent columns will be used as input to the embedding model.</p>
<pre><code>select id, link_url, link_title, commentary from blog_blogmark
</code></pre>
</div>
<div id="frame_004502.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004502.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004502.jpg" alt="R I R S P Y @ B e A C m 7 Qg 06_jun_lim — -zsh — 93x24 R ERCTT  $ llm embed-multi links \ -d simonwillisonblog.db \ --sql &#39;select id, link_url, link_title, commentary from blog_blogmark&#39; \ -m 3-small --store"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004502.jpg">#</a></p><p>I can run this command to embed all of the content:</p>
<pre><code>llm embed-multi links \
  -d simonwillisonblog.db \
  --sql &#39;select id, link_url, link_title, commentary from blog_blogmark&#39; \
  -m 3-small --store
</code></pre>
<p>This will create an embedding collection called “links”. It will run the SQL query we created before, using the OpenAI <code>3-small</code> model. The <code>--store</code> link means it will store a copy of the text in the database as well—without that it would just store identifiers and we would need to use those to look up the text later on when running queries.</p>
</div>
<div id="frame_004521.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004521.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004521.jpg" alt="Progress bar - 4% done, 00:01:18"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004521.jpg">#</a></p><p>The <code>llm embed-multi</code> command shows a progress bar for how far it has got.</p>
</div>
<div id="frame_004539.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004539.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004539.jpg" alt="Screenshot of the embeddings table in Datasette, with a bunch of binary data visible."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004539.jpg">#</a></p><p>While the command is running we can use Datasette to watch as the <code>embeddings</code> table is filled with data—one row for each of the items we are embedding, each storing a big ugly binary blob of data representing the embedding vector (in <a href="https://llm.datasette.io/en/stable/embeddings/storage.html">this storage format</a>).</p>
</div>
<div id="frame_004720.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004720.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004720.jpg" alt="$ llm similar links -c &#39;things that make me angry&#39; -d simonwillisonblog.db {&#34;1&#34;: &#34;448&#34;, &#34;score&#34;: 8.31105587659133327, “content”: “http://www.russellbeattie.com/notebook/1006697.html Overreaction Absolutely storming rant from Russell about America&#39;s culture of fear.&#34;, &#34;metodata”: null} ..."/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004720.jpg">#</a></p><p>And now we can run searches! This command finds everything in the “links” collection that is most similar to the search term “things that make me angry”:</p>
<pre><code>llm similar links -c &#39;things that make me angry&#39; -d simonwillisonblog.db
</code></pre>
</div>
<div id="frame_004824.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_004824.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_004824.jpg" alt="cat ~/.local/bin/blog-answer.sh  #!/bin/bash  # Check if a query was provided if [ &#34;$#&#34; -ne 1 ]; then     echo &#34;Usage: $0 &#39;Your query&#39;&#34;     exit 1 fi  llm similar blog-paragraphs -c &#34;query: $1&#34; \   | jq &#39;.content | sub(&#34;passage: &#34;; &#34;&#34;)&#39; -r \   | llm -m llamafile \   &#34;$1&#34; -s &#39;You answer questions as a single paragraph&#39;  # | llm -m mlc-chat-Llama-2-7b-chat-hf-q4f16_1 \ # /Users/simon/.local/share/virtualenvs/llm-mlc-SwKbovmI/bin/llm -m mlc-chat-Llama-2-7b-chat-hf-q4f16_1 "/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_004824.jpg">#</a></p><p>We can implement another version of RAG on top of this as well, by finding similar documents to our search term and then piping those results back into LLM to execute a prompt.</p>
<p>I wrote more about this in <a href="https://til.simonwillison.net/llms/embed-paragraphs">Embedding paragraphs from my blog with E5-large-v2</a>.</p>
</div>
<div id="frame_005209.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_005209.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_005209.jpg" alt="LLM documentation: OpenAl-compatible models"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_005209.jpg">#</a></p><p>During the Q&amp;A I mentioned that LLM can talk to anything that provides an OpenAI-compatible API endpoint using just configuration, no extra code. That’s <a href="https://llm.datasette.io/en/stable/other-models.html#openai-compatible-models">described in the documentation here</a>.</p>
</div>
<div id="frame_005333.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_005333.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_005333.jpg" alt="Screenshot of the Python API documentation"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_005333.jpg">#</a></p><p>I also showed LLM’s <a href="https://llm.datasette.io/en/stable/python-api.html">Python API documentation</a>, but warned that this is not yet considered stable as I’m not 100% happy with how this API works yet.</p>
</div>
<div id="frame_010311.jpg">
  <p><a href="https://static.simonwillison.net/static/2024/llm/frame_010311.jpg"><img src="https://static.simonwillison.net/static/2024/llm/frame_010311.jpg" alt="GitHub Issue with 77 comments: Figure out how to serve an AWS Lambda function with a Function URL from a custom subdomain"/></a>
  <a href="https://simonwillison.net/2024/Jun/17/cli-language-models/#frame_010311.jpg">#</a></p><p>The final question from the audience was about my personal productivity.</p>
<p>I wrote a bit about this a few years ago in <a href="https://simonwillison.net/2022/Nov/26/productivity/">Coping strategies for the serial project hoarder</a>—how I use extensive documentation and unit tests to allow me to work on way more projects at once by ensuring I don’t have to remember the details of any of them.</p>
<p>My other trick is that I tend to pick projects that fit my unique combination of previous experiences. I built LLM because I already had experience with LLM APIs, Python CLI tools (using <a href="https://click.palletsprojects.com/">Click</a>) and plugin systems (using <a href="https://pluggy.readthedocs.io/">Pluggy</a>). As a result I happened to be one of the best positioned people in the world to build a plugin-based CLI tool for working with LLMs!</p>
</div>

<h4 id="llm-colophon">Colophon</h4>
<p>Here’s how I turned the YouTube video of this talk into an annotated presentation:</p>
<ol>
<li>I downloaded a <code>.mp4</code> version of the talk from YouTube using <a href="https://github.com/yt-dlp/yt-dlp">yt-dlp</a>.</li>
<li>I ran that through <a href="https://goodsnooze.gumroad.com/l/macwhisper">MacWhisper</a> to create my own transcript for copying extracts from into my write-up—although this time I didn’t end up using any of the transcript text.</li>
<li>I played the video (at 2x speed) in QuickTime Player and used the <code>capture.sh</code> script <a href="https://til.simonwillison.net/macos/quicktime-capture-script">described here</a> to grab screenshots of the individual interesting frames that I wanted to use for my post.</li>
<li>I loaded those screenshots into <a href="https://til.simonwillison.net/tools/annotated-presentations">my annotated presentation tool</a> (which I <a href="https://simonwillison.net/2023/Aug/6/annotated-presentations/">described in this post</a>) and used that to run OCR against them for alt text and to add commentary to accompany each screenshot.</li>
<li>I assembled the result into this finished blog entry, adding intro text and the YouTube embed as HTML.</li>
</ol>
</div>



</div></div>
  </body>
</html>
