<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://wiki.rossmanngroup.com/wiki/Reverse_Engineering_Bambu_Connect">Original</a>
    <h1>Reverse Engineering Bambu Connect</h1>
    
    <div id="readability-page-1" class="page"><div id="column-content">
		<div id="content" role="main">
			<div id="siteNotice"><div id="localNotice" data-nosnippet=""><p>Please note that all submissions to the site are subject to the wiki&#39;s licence, CC 4.0 BY-SA, as found <a href="https://wiki.rossmanngroup.com/wiki/Consumer_Action_Taskforce:Copyrights" title="Consumer Action Taskforce:Copyrights">here</a>
</p></div></div>
			
			
			<div id="bodyContent">
				<p>From Consumer Action Taskforce</p>
				
				
				<p><a href="#column-one">Jump to navigation</a><a href="#searchInput">Jump to search</a></p><!-- start content -->
				<div id="mw-content-text"><div lang="en" dir="ltr">
<p>Bambu Connect is an <a href="https://wiki.rossmanngroup.com/wiki/Help:Electron" title="Help:Electron">Electron</a> App with <a href="https://wiki.rossmanngroup.com/wiki/Security_Through_Obscurity" title="Security Through Obscurity">Security Through Obscurity</a> principles, hence it is inherently insecure.
</p>
<div>

<div>
<p> This article is a guide.</p>
<hr/>
<p>What is presented here is not objective information about a company&#39;s relation to consumer rights and does follow the Consumer Action Taskforce Wiki&#39;s usual <a href="https://wiki.rossmanngroup.com/wiki/Moderator_Guidelines" title="Moderator Guidelines">content guidelines</a>
</p><p>This is a guide intended to give you more rights over your purchase. Inclusion of guides such as this one is currently under consideration for this wiki. 
</p><p>This guide may be incomplete and the information in it may have not been validated or updated. For more information see the <a href="https://wiki.rossmanngroup.com/wiki/Talk:Reverse_Engineering_Bambu_Connect" title="Talk:Reverse Engineering Bambu Connect"> discussion</a> around it.
</p>
<p>Follow at your own risk.</p>
<ul><li>For official mission and guidelines, please see: <a href="https://wiki.rossmanngroup.com/wiki/Mission_statement" title="Mission statement">Mission statement</a></li></ul>
<p>If you believe this notice has been placed in error, or once you have made the required improvements, please visit the <code>#appeals</code> channel on our Discord server: <a rel="nofollow" href="https://discord.gg/8w5rSNAXRf">Join Here</a>.
</p>
</div>
</div>
<p>To read the main.js for further analysis or extracting the private key stored by Bambu in the app:
</p>
<ol><li>Use the MacOs .dmg file, not the exe. Finding the needed decryption code is easier in the .dmg</li>
<li>Extract <i>bambu-connect-beta-darwin-arm64-v1.0.4_4bb9cf0.dmg</i><sup id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup>, in there you can find the files of the underlying Electron app in <i>Bambu Connect (Beta).app/Contents/Resources</i> folder</li>
<li>The app uses asarmor to prevent easy reading, the key is stored in ./app.asar.unpacked/.vite/build/main.node and can be extracted. Unpacking app.asar without fixing it first will result in an encrypted main.js file and 100 GB of decoy files generated, don&#39;t try it.</li>
<li>Load main.node in Ghidra and Auto-Analyze it. Then search for the GetKey function, or press G and go to 0000b67e<sup id="cite_ref-2"><a href="#cite_note-2">[2]</a></sup></li>
<li>Write down the hex key, for this build it&#39;s B0AE6995063C191D2B404637FBC193AE10DAB86A6BC1B1DE67B5AEE6E03018A2</li>
<li>Install the npm package asarfix and use it to fix the archive: <code>npx asarfix app.asar -k B0AE6995063C191D2B404637FBC193AE10DAB86A6BC1B1DE67B5AEE6E03018A2 -o fixed.asar</code></li>
<li>Now you can extract it in cleartext with  <code>npx asar extract fixed.asar src</code></li>
<li>./src/.vite/build/main.js is minified, use any JavaScript beautifier to make it better readable. Interesting user code including the private key is at the end of the file.</li></ol>
<h3><span id="Extracting_certs_and_private_key">Extracting certs and private key</span><span><span>[</span><a href="https://wiki.rossmanngroup.com/index.php?title=Reverse_Engineering_Bambu_Connect&amp;veaction=edit&amp;section=1" title="Edit section: Extracting certs and private key">edit</a><span> | </span><a href="https://wiki.rossmanngroup.com/index.php?title=Reverse_Engineering_Bambu_Connect&amp;action=edit&amp;section=1" title="Edit section&#39;s source code: Extracting certs and private key">edit source</a><span>]</span></span></h3>
<p>The private key and certs are further obfuscated, to get cleartext you need to do: Encrypted string from cy() -&gt; ure(string, key) -&gt; RC4 decryption -&gt;  decodeURIComponent() -&gt; final string.
</p><p>Example Python reimplementation to extract the secrets, easy to run. Copy the content of t from function cy() in main.js and paste it here. After running, you have a private key from Bambu Lab.
</p>
<pre>import urllib.parse

def cy():
    t = [
		# copy from main.js
	]
    return t

def ure(t, e):
    # RC4 implementation
    r = list(range(256))
    n = 0
    s = &#34;&#34;
    
    # Key-scheduling algorithm (KSA)
    for o in range(256):
        n = (n + r[o] + ord(e[o % len(e)])) % 256
        r[o], r[n] = r[n], r[o]
    
    # Pseudo-random generation algorithm (PRGA)
    o = n = 0
    for byte in t:
        o = (o + 1) % 256
        n = (n + r[o]) % 256
        r[o], r[n] = r[n], r[o]
        k = r[(r[o] + r[n]) % 256]
        s += chr(byte ^ k)
    
    return s

def lt(t, e):
    r = cy()
    n = t - 106
    s = r[n]
    s = ure(s, e)
    return urllib.parse.unquote(s)

def extract_certs_and_key():
    try:
        result = {}
        result[&#34;Are&#34;] = lt(106, &#34;1o9B&#34;)
        result[&#34;fre&#34;] = lt(107, &#34;FT2A&#34;)
        result[&#34;private_key&#34;] = lt(108, &#34;Tlj0&#34;)
        result[&#34;cert&#34;] = lt(109, &#34;NPub&#34;)
        result[&#34;crl&#34;] = lt(110, &#34;x077&#34;)
    except Exception as e:
        print(f&#34;Error extracting certs/key: {e}&#34;)

    for key, value in result.items():
        print(f&#34;{key}:\n{value}\n&#34;)

if __name__ == &#34;__main__&#34;:
    extract_certs_and_key()
</pre>
<h2><span id="References">References</span><span><span>[</span><a href="https://wiki.rossmanngroup.com/index.php?title=Reverse_Engineering_Bambu_Connect&amp;veaction=edit&amp;section=2" title="Edit section: References">edit</a><span> | </span><a href="https://wiki.rossmanngroup.com/index.php?title=Reverse_Engineering_Bambu_Connect&amp;action=edit&amp;section=2" title="Edit section&#39;s source code: References">edit source</a><span>]</span></span></h2>


<!-- 
NewPP limit report
Cached time: 20250120181529
Cache expiry: 86400
Reduced expiry: false
Complications: []
CPU time usage: 0.013 seconds
Real time usage: 0.022 seconds
Preprocessor visited node count: 58/1000000
Post‐expand include size: 1439/209715200 bytes
Template argument size: 0/209715200 bytes
Highest expansion depth: 3/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 2107/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    8.863      1 -total
 38.90%    3.448      1 Template:Reflist
 33.00%    2.925      1 Template:GuideNotice
-->

<!-- Saved in parser cache with key mediawiki:pcache:idhash:686-0!canonical and timestamp 20250120181529 and revision id 3539. Rendering was triggered because: page-view
 -->
</div>
</div>
				
				<!-- end content -->
				
			</div>
		</div>
		
	</div></div>
  </body>
</html>
