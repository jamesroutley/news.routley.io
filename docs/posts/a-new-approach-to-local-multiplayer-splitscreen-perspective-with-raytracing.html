<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ph3at.github.io/posts/Ray-Coop-Camera/">Original</a>
    <h1>A new approach to local multiplayer / splitscreen perspective with raytracing</h1>
    
    <div id="readability-page-1" class="page"><div><p>I’m a huge fan of local multiplayer, and in particular local cooperative multiplayer. I’m <em>also</em> interested in 3D rendering, and especially raytracing.</p><p>This blog post is the result of me <strong>finally</strong> – barely scraping into 2023 – writing about an idea I had in 2019, and which I implemented as a prototype in 2022. It uses the unique strengths of fully raytraced realtime rendering to implement a new kind of screen sharing for local multiplayer. But before that, some history.</p><blockquote><p>If you’re not interested in the history lesson, then you can just skip directly to <a href="#the-result">the result</a>.</p></blockquote><p>One of the more significant challenges with implementing any kind of local coop is the fact that all players share a single screen. Ideally, a game can be designed in such a way to make use of one shared perspective, and I generally feel like these games work best for local multiplayer. But often, particularly for 3D games, working with a single perspective is not feasible.</p><p><a href="https://ph3at.github.io/assets/2023-12-31-Ray-Coop-Camera/halo_infinite_splitscreen.webp"><img data-src="/assets/2023-12-31-Ray-Coop-Camera/halo_infinite_splitscreen.webp" alt="Screenshot showing traditional split-screen gameplay in Halo:Infinite" width="50%" id="fancyimg" data-proofer-ignore=""/></a> <em>Traditional Split-Screen Gameplay in Halo:Infinite</em></p><p>The traditional solution to this conundrum is splitting the screen into N separate areas for N players, which are usually equally sized. Each shows a distinct perspective, and – in 3D rendering terms – has its own camera. Some games have developed this idea further, either visually or even by integrating it with gameplay. In the following I’ll go through a few examples of games that I am aware of which did something interesting within a single-screen, multi-camera framework.</p><h3 id="renegade-ops--dynamic-splitting"><span>Renegade Ops – Dynamic Splitting</span><a href="#renegade-ops--dynamic-splitting"><i></i></a></h3><p>The 2011 co-op twin-stick shooting action game <a href="https://store.steampowered.com/app/99300/Renegade_Ops/">Renegade Ops</a> was the first time I encountered a system which varies the screen layout in multiplayer based on the relative position on the players in world space.</p><p><a href="https://ph3at.github.io/assets/2023-12-31-Ray-Coop-Camera/renegade_ops.jpg"><img data-src="/assets/2023-12-31-Ray-Coop-Camera/renegade_ops.jpg" alt="Screenshot of Renegade Ops&#39; dynamic splitscreen" width="50%" id="fancyimg" data-proofer-ignore=""/></a> <em>Renegade Ops’ Dynamic Split-Screen Implementation</em></p><p>In the game, each player controls a vehicle, and when they are relatively close the screen is shared. If they move further away from each other, at some point the game switches over to two separate camera perspectives, which are split along a line that responds to the relative positioning. I.e. if the players were to be at the exact same postion on the horizontal axis, the line would be perfectly vertical, and if they were on the same vertical position, the split line would be perfectly horizontal. Any offset will result in a slanted line, as seen in the screenshot above.</p><p>Several more games with a top-down or isometric camera have had this type of dynamic visual style for split-screen since Renegade Ops. If you know of anything that does something similar earlier than it, do let us know.</p><blockquote><p>In internal PH3 proofreading, it turned out that Lego Indiana Jones 2 used dynamic split-screen, and released in 2009. There might well be an even earlier example!</p></blockquote><h3 id="dyo--splitscreen-as-a-gameplay-mechanic"><span>DYO – Splitscreen as a Gameplay Mechanic</span><a href="#dyo--splitscreen-as-a-gameplay-mechanic"><i></i></a></h3><p><a href="https://store.steampowered.com/app/791470/DYO/">DYO</a> is an indie co-op puzzle platformer released in 2018. It implemented an idea which, to me, is nothing short of genius: instead of seeing the split-screen as a “necessary evil” required to allow two players with individual perspectives on a single screen, it instead re-conceptualized the split as a core gameplay mechanic.</p><p><a href="https://ph3at.github.io/assets/2023-12-31-Ray-Coop-Camera/dyo.jpg"><img data-src="/assets/2023-12-31-Ray-Coop-Camera/dyo.jpg" alt="Screenshot of DYO" width="50%" id="fancyimg" data-proofer-ignore=""/></a> <em>DYO Uses its Split Screen as a Gameplay Mechanic</em></p><p>In the game, players are given control over various aspects related to how and when the screen is split, and can e.g. arrange both halves to make a previously impassable obstacle traversable.</p><blockquote><p>DYO is now <a href="https://store.steampowered.com/app/791470/DYO/">free on Steam</a>, so do check it out if this sounds at all interesting to you!</p></blockquote><h3 id="degrees-of-separation--why-not-both"><span>Degrees of Separation – Why Not Both?</span><a href="#degrees-of-separation--why-not-both"><i></i></a></h3><p>2019’s <a href="https://store.steampowered.com/app/809880/Degrees_of_Separation/">Degrees of Separation</a> takes both Renegade Ops’ dynamic split and DYO’s screen-split-as-gameplay and integrates them into a brilliant puzzle platformer.</p><p><a href="https://ph3at.github.io/assets/2023-12-31-Ray-Coop-Camera/degrees.jpg"><img data-src="/assets/2023-12-31-Ray-Coop-Camera/degrees.jpg" alt="Screenshot of Degrees of Separation" width="50%" id="fancyimg" data-proofer-ignore=""/></a> <em>Degrees of Separation is Mechanically Interesting, and it’s also Beautiful</em></p><p>Each of Degrees of Separation’s levels introduces a new unique use of dynamic splitscreen as a mechanic, and each of those mechanics is in turn explored over many puzzles with quite some depth.</p><h3 id="ys-ix--just-dont-split-it"><span>Ys IX – Just Don’t Split It</span><a href="#ys-ix--just-dont-split-it"><i></i></a></h3><p>Overall, I’m not a huge fan of split screen gameplay, when it is not used in a really clever way as in the games above.</p><p>One option which I think is underutilized is simply not splitting the screen, even in fully 3D games. This is how the coop modes I implemented for both Ys VIII an Ys IX work. A single 3D camera does its best to keep both players in frame, and both players have the shared ability to adjust it. The video below some gameplay using that approach:</p><p><iframe id="fancyimg" width="560" height="315" src="https://www.youtube.com/embed/SNgDIFRG7S8?si=4pviUxcRhcUMSkYr" title="YouTube video player" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; web-share" allowfullscreen=""></iframe></p><p>Of course, this is not without tradeoffs: even with quite a lot of time invested into tweaking the camera, it still takes getting used to and good coordination between both players, and there are situations in which it can fail to show one or even both actual player characters. However, I know that we and others fully completed these games, and the shared camera provides a unique gameplay feeling, so I wish someone else would also give it a try at some point.</p><blockquote><p>You can read more about local coop in Ys IX <a href="https://store.steampowered.com/news/app/1351630/view/3100164020394220707">in this Steam post</a> announcing its release.</p></blockquote><p>There is one thing that all implementations of split screen gameplay I am aware of at this point have in common: regardless of how the screen is divided – either traditionally in a fixed distribution or dynamically – it is still ultimately just a split into two or more standard camera perspectives, with one alloted to each player.</p><h2 id="technical-background-rasterization-limitations"><span>Technical Background: Rasterization Limitations</span><a href="#technical-background-rasterization-limitations"><i></i></a></h2><p>This universal truth is not surprising. Realtime rendering in games – at least until the advent of HW-accelerated raytracing – was based on rasterization, and the traditional rasterization pipeline assumes that there is one consistent camera projection across the entire screen. In order to accomplish split screen rendering in 3D games, the traditional cross-platform approach required basically performing almost the entire work of rendering a frame again, once for each perspective.</p><p>A technology I’m also quite interested in, but which is unrelated to the topic of this post, actually brought some improvements in this respect: <strong>VR</strong>. VR rendering requires two perspectives, one per eye, or ideally even more for large-FoV displays. This motivated GPU vendors to provide improved support for this use case, though I am not sure if many (or any?) split-screen games actually leverage such hardware support.</p><blockquote><p>NVidia has a thorough and very well-illustrated technical blog post about the VR-related multi-view rendering topic <a href="https://developer.nvidia.com/blog/turing-multi-view-rendering-vrworks/">here</a>. Give it a read if you want to learn more.</p></blockquote><p>However, even with the most advanced hardware support, only up to 4 different views can be rendered at once without substantial performance implications – and even that requires quite a lot of development effort.</p><h2 id="the-potential-of-raytracing"><span>The Potential of Raytracing</span><a href="#the-potential-of-raytracing"><i></i></a></h2><p>Raytracing changes these fundamental rules, and essentially eliminates all of these limitations. Somewhat simplified, every pixel is generated by shooting an individual ray into the scene and seeing what it hits. As such, we can in theory use a different direction and position for every single one of these rays. And that’s where we can finally get to the idea this is all about:</p><p> Rather than having entirely distinct and clearly delineated perspectives for each player, dynamically adjust the camera(s) at a pixel level.</p><p>This allows us to not only use an arbitrary distribution of screen space to various players’ perspectives, but even smoothly interpolate between their perspectives!</p><blockquote><p>Note that basically no mainstream game which uses raytracing today actually does so for the so-called primary or initial rays (mostly since rasterization is just more effective). It’s certainly possible to do so though, as you’ll see shorty.</p></blockquote><p>Without further ado, here’s what that could look like:</p><p><iframe id="fancyimg" width="640" height="360" src="https://www.youtube.com/embed/O_LH6aGUzbY?si=dkKKrmzicJlHNOYV" title="YouTube video player" frameborder="0" allow="accelerometer; encrypted-media; gyroscope; web-share" allowfullscreen=""></iframe></p><p>This is a short video showing a basic implementation of this idea.</p><p>In case you’re wondering about the game: what you’re seeing (for the first time) is <em>Sphere Spectacle</em>. It’s something we worked on shortly after the release of the first RTX-series GPUs, so around 2019. The idea, at a gameplay level, is to basically be a ball-rolling game. At a technical level, we wanted to build something that is <strong>entirely</strong> raytraced, with absolutely no rasterization. We also didn’t want to use any images/textures at all in the game, so everything is just geometry and shaders.</p><p>I won’t go into too much detail here, but the most interesting part of the implementation is how to actually decide to split the screen. I experimented with a few options here. Mathematically, the problem seems similar to trying to draw a Voronoi diagram with the players on-screen positions as the points, and then setting some value for the width of the interpolation. I tried making that work, but ended up reverting to a more ad-hoc solution.</p><p>What you saw in the video is the result of me trying a few different formulas and sticking with something that looks vaguely like what I wanted, but there is a wealth of options to explore here. I ultimately only spent two working days hacking this demo into Sphere Spectacle – and that includes implementing support for two players!</p><p><a href="https://ph3at.github.io/assets/2023-12-31-Ray-Coop-Camera/raygen.png"><img data-src="/assets/2023-12-31-Ray-Coop-Camera/raygen.png" alt="Ray Generation Code Excerpt" width="50%" id="fancyimg" data-proofer-ignore=""/></a></p><p>I still think it’s remarkable that I could get this entire idea working, at least to some extent, in just two days of hacking, and it shows how it is fundamentally so much simpler than trying to do anything like it in a rasterization pipeline.</p><p>If you’ve read until this point then thanks for coming with me on this journey through the history of local multiplayer camera perspectives and my idea on having it take a new step based on raytracing.</p><p>Now we just need someone to build a full game around it!</p></div></div>
  </body>
</html>
