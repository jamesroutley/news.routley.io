<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://input.club/the-problem-with-mechanical-switch-reviews/">Original</a>
    <h1>The Problem with Mechanical Switch Reviews (2016)</h1>
    
    <div id="readability-page-1" class="page"><div id="main">
				<div>
<section id="content">
					<div id="post-4159" class="page">
			<p><span>The Problem with Mechanical Switch Reviews</span><span><span><a href="https://input.club/author/info/" title="Posts by info" rel="author">info</a></span></span><span>2017-05-20T15:34:45-08:00</span></p><div>
				<div><div><div><div data-bg-url=""><div>
<p><em>Jacob Alexander (HaaTa) – November 19, 2016</em></p>
<p><span>Like most of you, I take keyboards way too seriously. However, unlike most of you, I’m an engineer. This means I need facts, data, and real evidence before I can form an opinion. And this lack of actual information has always bothered me when it comes to how the keyboard community at large tends to review switches.</span></p>
<p><span>Here is an example of a review I see quite often:</span></p>
<blockquote>
<p><em><span>“Switch X feels amazing! Switch Q is better than Switch Q2. Just add some lube and switch Y will be great. Even NIB switch Z feels like typing on wet newspaper. OMFG, you like switch Q more? You…you heathen!”</span></em></p>
</blockquote>
<p><span>What’s similar about all those subjective comments (and that I’m sure you’ve also seen if you’ve read enough about keyboards), is that they say really nothing at all.</span></p>
<p><span>Qualitative analysis makes for a good sounding review. But does it really mean anything at all? How do you know their tastes match your tastes?</span></p>
<p><span>Spring weights brings a little glimmer of hope to me when it comes to measurable details, but summarily falls over, like a pile of nickels. As spring weights can vary wildly between two similar switches. And it certainly won’t tell you if one switch is scratchy or fresh from the factory.</span></p>
<p><span>On that note, does anyone believe that gold springs do anything?! If claims are being made that they are better than non-gold springs, doesn’t anyone worry that they are being taken in by the same sort of marketing that Monster cables uses?</span></p>
<p><span>But this isn’t a critique of mechanical keyboard switches and possible customizations and how to compare them. It’s my exploration of of what really matters to all of us. Tactility.</span></p>
</div><div><h2><span>Tactility</span></h2>
<p><span>I’ve always been fascinated by tactility. Ever since I can remember, I’ve loved pushing buttons. Not only because I wondered what they did, but I wanted to know what they felt like.</span></p>
<p><span>This is absolutely a major part as to why I’ve continued my fascination with keyboards. For something that can be so satisfying, why is it that some keyboards can feel so amazing and others….so terrible? </span></p>
<p><span>Is it all subjective? Or can we achieve some semblance of objectivity?</span></p>
<p><span>This question of ‘why’ is the reason I’m part of the keyboard community and the reason I decided to embark on the humble task of building the Keyboard Force Curve Gauge.</span></p>
</div><div><h2><span>What’s a Force Curve Gauge?</span></h2>
<p><span>Put simply, a force curve gauge is a device that records a force while changing the distance into or away from a starting position. This data can be represented in a force curve graph. For example:</span></p>
</div></div></div><div><div data-bg-url=""><p>The legendary IBM Model M, circa 1989. You can click the graph to go to the plotting website where you can select to overlay the other 3 press/release lines.</p><p><span><a href="https://en.wikipedia.org/wiki/Buckling_spring#/media/File:Fig_2_harris_keyforce-o.svg" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/Fig_2_harris_keyforce-o.svg" alt=""/></a></span></p><div>
<p><span>In general force curves have either one or two lines. The lines are read from left to right, where 0 mm is where the press begins. The press ends where the force seems to go up to infinity, also known as bottoming out (usually around 3.5 mm and above).</span></p>
<p><span>The first line, blue in the above graph, is the press. Initially there is a steep increase in force, where if you were pressing the switch are taking the spring force away from the switch housing and transferring it onto your finger. Likely the most interesting part of a buckling spring switch to look at is its tactility. From the graph above (and below), the tactility corresponds to the sharp drop in force at around 1.8 mm.</span></p>

</div></div></div><div><div data-bg-url=""><p><span>The second line, orange in the above graph, is the release. In most cases the release force curve is different than the press. This is known as hysteresis.</span></p></div></div><div><div data-bg-url=""><p><span>With force curves you can now compare the feel of different keyboard switches visually! Hopefully someday we can stop qualifying keyboards with descriptors like “feels good” or “buttery smooth” and put some actual numbers and data behind the sort of keyboards we like. Keyboards are like shoes and everyone has their personal preference. There is absolutely no reason why we should be forced to use some poorly thought out “one-size-fits-all” solution.</span></p></div></div><div><div data-bg-url=""><div>
<p><span>Force curves aren’t anything new. Like the IBM buckling spring curve above, we’ve seen them in keyboard switch patents and on manufacturer websites for a long time.</span></p>
</div><p><span><a href="https://deskthority.net/w/images/c/c3/BOE-ForceGraph.png" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/BOE-ForceGraph.png" alt=""/></a></span></p><p><span><a href="https://deskthority.net/w/images/7/74/FLS-2nd3rdGen-LinearForceCurve.png" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/FLS-2nd3rdGen-LinearForceCurve.png" alt=""/></a></span></p><p><span>(Fujitsu Leaf Spring Gen2/3 – https://deskthority.net/wiki/Fujitsu_Leaf_Spring)</span></p><div><p><span>But these were just engineering approximations of what the force could or should be, they are not extensive set of repeated field tests.</span></p>
<h2><span>Early Force Curves</span></h2>
<p><span>While living in Japan (back in 2009/2010), and still a novice in the ways of keyboards. I stumbled upon Atelier Silencium (</span><a href="http://www5f.biglobe.ne.jp/~silencium/keyboard/index.html"><span>http://www5f.biglobe.ne.jp/~silencium/keyboard/index.html</span></a><span>).</span></p>
<p><span>This Japanese keyboard wizard, SPARC, had *real* force curves, measured for all to see!</span></p>
</div><p><span><a href="http://www5f.biglobe.ne.jp/~silencium/keyboard/gif/linear.gif" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/linear-1.png" alt=""/></a></span></p><p>http://www5f.biglobe.ne.jp/~silencium/keyboard/gif/linear.gif</p></div></div><div><div data-bg-url=""><p><span>All I could think when I first saw this crazy graph was “Woah, this is so awesome.”</span></p><p><span><a href="http://www5f.biglobe.ne.jp/~silencium/keyboard/jpg/keisoku.jpg" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/keisoku.jpg" alt=""/></a></span></p></div></div><div><div data-bg-url=""><div><h2><span>Why can’t I do that too?</span></h2>
<p><span>Fast-forward to early 2012. By this point, I’d already amassed quite an interesting collection of nearly 200 historical keyboards (and keyboard switches) but I had a “problem”. I’d started to find switches that no one had ever seen before (in the keyboard community). Since I’m not prone to hyperbole and marketing speak, there was no easy way to truly describe how they felt.</span></p>
<p><span>I started thinking about what it would take to measure switches and accurately communicate my findings, but I really had no idea what sort of apparatus was required.</span></p>
<p><span>Some months went by, and I had a chat with user OO2 and he had recently acquired an Imada force gauge, with the intent  of measuring Topre switches. Unfortunately he didn’t have the data logger or a stand to mount the force gauge.</span></p>
<p><span>I said, “Hey! Send it to me, I’ll make you a data logger.” (and I still have it, sorry OO2…).</span></p>
<p><span>So, that’s what I attempted. The original code is still up on GitHub (</span><a href="https://github.com/haata/imada-rs232c-teensy2-hid"><span>https://github.com/haata/imada-rs232c-teensy2-hid</span></a><span>).</span></p>
<p><span>Then, as most of us do, I got busy (something about riding my bicycle across Japan for 3 months then driving a U-Haul full of keyboards from Toronto to NYC to San Francisco). Needless to say, the project was shelved until I got settled into my new place.</span></p>
<h2><span>Force Curve Gauge v1</span></h2>
<p><span>In late 2013, I was scrounging through </span><a href="http://www.halted.com/"><span>HSC</span></a><span> (Halted for those in the SF Bay Area) and noticed something interesting. It was a small arbor press that looked something like this one</span></p>
</div><p><span><a href="https://cdn1.bigcommerce.com/server2500/9fa34wk/products/181/images/183/B093_org.1435535583.430.450.jpg" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/B093_org.1435535583.430.450-1.jpg" alt=""/></a></span></p></div></div><div><div data-bg-url=""><div><p><span>And as all great ideas do, the design for Force Curve Gauge (v1) was born.</span></p>
<p><span>The big problem that was blocking me before, was finding a way to mount the force gauge on something sturdy enough to take good readings and measure distance at the same time. It’s correlation between force and distance that is important here. The most sophisticated force sensor will not give you the force profile of a switch. Without the tight mapping of force vs. distance, the generated force and distance data would be inaccurate.</span></p>
<p><span>This is why a force curve gauge must have at least two measuring sensors: one for force and one for distance. </span></p>
<p><span>My materials.</span></p>
<ul>
<li><span>Dake Arbor Press</span></li>
<li><span>Heat formed plastic (something like this </span><a href="https://www.amazon.com/Plastics-Moldable-Plastic-Pellets-Included/dp/B00WRWKM6G"><span>https://www.amazon.com/Plastics-Moldable-Plastic-Pellets-Included/dp/B00WRWKM6G</span></a><span>)</span></li>
<li><span>Some metal brackets to secure molded plastic</span></li>
<li><span>Guide rod from a dismantled typewriter</span></li>
<li><span>iGaging “12 DRO (</span><a href="http://www.igagingstore.com/12-Magnetic-Remote-Table-Mill-Saw-Fence-Digital-p/203927.htm"><span>http://www.igagingstore.com/12-Magnetic-Remote-Table-Mill-Saw-Fence-Digital-p/203927.htm</span></a><span>)</span></li>
<li><span>Imada DPS-1R</span></li>
<li><span>3d printed brackets to hold the Force Gauge to the Arbor Press</span></li>
<li><span>Teensy 3.0</span></li>
<li><span>Special serial cable to read the data off the Imada gauge</span></li>
</ul>
<p><span>Now in my typical style, I reverse engineered the iGaging DRO (with much help from this link </span><a href="http://www.shumatech.com/web/21bit_protocol?page=0,1"><span>http://www.shumatech.com/web/21bit_protocol?page=0,1</span></a><span>) so I could read it directly. This is important as you want the force reading to be timed as closely as possible to the distance reading.</span></p>
<p><span>Force, I used the Imada serial interface.</span></p>
<p><span>Since the Arbor Press is a manual device, I programmed the Teensy to use each distance tick on the DRO as a trigger to read the force gauge and output a new data point.</span></p>
<p><span>And thus, v1 was born: </span></p>
</div><p><span><img src="https://input.club/wp-content/uploads/2016/11/SjIXflf-768x1024.jpg" alt="" title=""/></span></p></div></div><div><div data-bg-url=""><p><span><img src="https://input.club/wp-content/uploads/2016/11/DClpQpL-768x1024.jpg" alt="" title=""/></span></p></div></div><div><div data-bg-url=""><div><p><span>See that long transfer bar. Well, that deflects a bit…and skews measurements whenever you change directions. Sure, it works well when measuring a key press, but good luck getting any kind of decent key release measurement.</span></p>
<p><span>The other main hardware problem was that it’s really really hard to move an arbor press at a consistent rate. Due to how slow the force data was being polled from the Imada force gauge, I found that it was difficult to reproduce force curve results. If I sped up during the tactile point, sometimes I’d miss possibly important details in that test run.</span></p>
<p><span>Take for example, this Model F Buckling Spring force curve that I measured very early on.</span></p>
</div><p><span><a href="https://i.imgur.com/JTKRZF8.png" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/JTKRZF8-1024x768.png" alt=""/></a></span></p></div></div><div><div data-bg-url=""><p><span>Next, using the same v1 force curve gauge, but measuring more carefully.</span></p><p><span><a href="https://i.imgur.com/WfXV3xA.png" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/WfXV3xA-1024x790.png" alt=""/></a></span></p></div></div><div><div data-bg-url=""><div><p>Let’s be honest, the first graph is awful and just plain wrong. And that’s why it’s important to have a tight correlation between the force and distance data. Otherwise you don’t have anything useful at all.</p>
<p>And, well, I didn’t like the firmware architecture. The serial port was too slow (it wasn’t synchronized well enough with the DRO). It was all polling based, and if any of the devices got into a bad state the firmware would hang and corrupt the test :/</p>
<p>Anyways, I got a bit discouraged, and shelved the project while I searched for a proper force gauge stand.</p>
<p>Next, using the same v1 force curve gauge, but measuring more carefully.</p>
</div></div></div><div><div data-bg-url=""><div>
<p><span>A few months later, I, like OO2 before me, located a great deal on an Imada force gauge of my own. Only this time it was a newer version with a faster serial baud rate! (19200 vs. 2400).</span></p>
<p><span>This rekindled my excitement in searching for a way to build a better force curve gauge. It’s the Imada DS2-1 (the last non-USB version as far as I can tell).</span></p>

<p><span>Normally I don’t call out my eBay horror stories, but I think this one deserves some notice.</span></p>
<p><span>By some luck, I’d managed to locate an official motorized (consistent movement!) Imada force gauge stand on eBay for a pretty reasonable price (sub $500). I won it (along with a couple other items from the same seller), paid quickly (as I usually) do, then waited for my force gauge stand.</span></p>
<p><span>I waited.</span></p>
<p><span>And waited.</span></p>
<p><span>Waited some more.</span></p>
<p><span>Fed up, I sent a message to the seller, and they responded back that they’d been in some car accident or something. Ok, whatever, I don’t need a refund, just ship me the stand.</span></p>
<p><span>Some more weeks go by, I send another message.</span></p>
<p><span>Nope, still nothing.</span></p>
<p><span>A couple more weeks go by, and I’m getting worried, so I open a case, and explicitly indicate I want the item.</span></p>
<p><span>A few days later, ****, I get a refund.</span></p>
<p><span>Bah, that was a waste of time.</span></p>
<h2><span>Searching for a force stand</span></h2>
<p><span>By this point, I was pretty fed up with eBay (pretty slim pickings for force gauge stands that would work with an Imada gauge and that I’d be able to modify significantly).</span></p>
<p><span>So, I started looking at new chinese made ones.</span></p>
<p><span>They were a bit pricy, about $1000 shipped at the time, and I knew I’d have to gut the thing. But that’s still cheaper than the $10k+ for new official motorized force gauge stands.</span></p>
<p><span>And so, this one arrived!</span></p>
</div><p><span><img src="https://input.club/wp-content/uploads/2016/11/19532676143_c77b1880ab_z.jpg" alt="" title=""/></span><span><img src="https://input.club/wp-content/uploads/2016/11/19970278830_ce3647244d_z.jpg" alt="" title=""/></span></p></div></div><div><div data-bg-url=""><div><p><span>Now that I’d acquired the critical pieces (force gauge and stand), it was time to design v2.</span></p>

<p><span>Parts list for for Force Curve Gauge v2.</span></p>
<ul>
<li><span>AEL-200-500N force test stand</span></li>
<li><span>Imada DS2-1 force gauge</span></li>
<li><span>Teensy 3.1</span></li>
<li><span>Teensy 3.1 breakout (</span><a href="https://www.tindie.com/products/loglow/teensy-32-breakout-revision-b-standard/"><span>https://www.tindie.com/products/loglow/teensy-32-breakout-revision-b-standard/</span></a><span>)</span></li>
<li><span>iGaging “12 DRO (</span><a href="http://www.igagingstore.com/12-Magnetic-Remote-Table-Mill-Saw-Fence-Digital-p/203927.htm"><span>http://www.igagingstore.com/12-Magnetic-Remote-Table-Mill-Saw-Fence-Digital-p/203927.htm</span></a><span>)</span></li>
<li><span>L-bracket</span></li>
<li><span>Breadboard (to mount teensy inside the force test stand)</span></li>
<li><span>Various cables</span>
<ul>
<li><span>Continuity test</span></li>
<li><span>Imada serial cable</span></li>
<li><span>USB cable for teensy</span></li>
</ul>
</li>
</ul>
<p><span>I have a full album of pictures on Flickr: </span><a href="https://flic.kr/s/aHskgDhUb2"><span>https://flic.kr/s/aHskgDhUb2</span></a></p>
<h2><span>Assembly</span></h2>
<p><span>The mechanical assembly was mostly straightforward. Just had to drill some holes in the steel casing of the force gauge to mount the iGaging DRO as well as a couple holes for extra cables going to the teensy.</span></p>
<p><span>Conveniently, I could use an L-bracket to connect both the DRO and the force gauge head. This has the benefit of being extremely sturdy, so I won’t have to worry about any mechanical distance drift!</span></p>
</div><p><span><img src="https://input.club/wp-content/uploads/2016/11/28264497256_561ea865b2_z.jpg" alt="" title=""/></span></p></div></div><div><div data-bg-url=""><div><p><span>The tricky part was definitely connecting all the different electrical components to the Teensy. As usual, I wanted to be ambitious. I needed to be able to automatically stop the force test stand head whenever the force was above ~800 gf or I risked destroying the load cell located in the Imada force gauge. The test stand had no such functionality built in of course (it can’t sense force by itself, nor connect to gauges). So, this required modifications to the otherwise closed system of the test stand.</span></p>
<p><span>I wasn’t quite ready to design a new PCB, so I pulled some tricks out of my keyboard protocol reverse engineering bag 😀</span></p>
</div><p><span><img src="https://input.club/wp-content/uploads/2016/11/20168325442_0abe01c8a6_z.jpg" alt="" title=""/></span></p></div></div><div><div data-bg-url=""><p><span>Hey, isn’t that a PIC microcontroller? This *was* the brains of the force test stand. Even better, is that it’s socketed! So, I just removed it, and inserted my own custom socket with wires attached to all the pins that I determined were useful.</span></p><p><span><img src="https://input.club/wp-content/uploads/2016/11/30977547711_c8540d9cb4_z.jpg" alt="" title=""/></span></p></div></div><div><div data-bg-url=""><p><span><img src="https://input.club/wp-content/uploads/2016/11/31055986796_d21d6b8a97_z.jpg" alt="" title=""/></span></p></div></div><div><div data-bg-url=""><div><p><span>Obviously, I didn’t have a schematic, so I had to trace all the pins to their individual functions and figure out what the PIC was doing to control the force test stand.</span></p>
<p><span>Currently hooked up to the Teensy 3.1</span></p>
<ul>
<li><span>Motor control</span></li>
<li><span>Top/bottom limit switches</span></li>
<li><span>Imada force gauge serial port</span></li>
<li><span>Imada force gauge analog output</span></li>
<li><span>iGaging serial output</span></li>
<li><span>Continuity tester (used to determine press/release of contact switches)</span></li>
</ul>
<p><span>Rather than bore everyone with the intricate details of the microcontroller firmware design (which you can find here: </span><a href="https://github.com/kiibohd/force"><span>https://github.com/kiibohd/force</span></a><span>), I’ll focus on the main design decisions.</span></p>
<ol>
<li><span>No matter what, make sure the force gauge doesn’t destroy itself (highest priority interrupts on limit switches).</span></li>
<li><span>Reading force over 800 gf is bad. So if detected, automatically move the force gauge upwards.</span></li>
<li><span>Readings from sensors should occur as frequently as possible, asynchronously.</span>
<ul>
<li><span>Force gauge ADC readings must be separated from serial readings as serial port traffic affects ADC readings.</span></li>
<li><span>Clocking sequence for iGaging DRO should be generated by hardware and not depend on cycle counting GPIO sequences.</span></li>
</ul>
</li>
<li><span>Data output to the PC should occur as frequently as possible in remaining spare CPU cycles each with a precision timestamp (ideally per CPU tick).</span></li>
<li><span>Separate data output and control input</span>
<ul>
<li><span>Use debug cli for commands</span></li>
<li><span>Use USB Vendor Specific endpoint to transmit data to PC</span></li>
</ul>
</li>
<li><span>Include a test mode to repeatedly press a switch, then release, go to the reset position and test again without any user intervention.</span>
<ul>
<li><span>Prevents user adjustment error.</span></li>
<li><span>Speeds up measuring switches considerably.</span></li>
</ul>
</li>
</ol>
<p><span>The goal was to design something that could record as much data as possible so the possible drift between distance and force measurements were minimized as much as possible.</span></p>
<p><span>My goal was to be somewhere around Imada’s latest gauge (</span><a href="http://imada.com/products/zt-digital-force-gauge/"><span>http://imada.com/products/zt-digital-force-gauge/</span></a><span>) where it touts 2000 data points per second.</span></p>
<p><span>In practice, I’m about to get around 9500 points per second from USB. The ADC values (which I’ve tuned for accuracy rather than speed) samples about around half that speed. Somewhere around 5000 data points per second. 2.5x speed improvement over the latest Imada force gauge, not bad at all.</span></p>
<p><span>FINALLY, I am able to enjoy raw force curve data!</span></p>
<p><span>Sadly, this is where the scientists reading this will empathize with my pain. It turns out that gathering raw data is easy. Making raw data into something useful is much harder than collecting the data in the first place…</span></p>

</div></div></div><div><div data-bg-url=""><div>
<p><span>This is one of those times where I was really glad I half paid attention during my lectures back in college on computational analysis. I’m not terribly good at the subject but using my vast knowledge of keyboard switch curves I’ve been able to produce something significantly better than what I’ve seen so far.</span></p>
<p><span>(I’m always looking for suggestions on ways to improve data analysis. Even better if you’re familiar with numpy. </span><a href="https://github.com/kiibohd/force/blob/master/fcv.py"><span>https://github.com/kiibohd/force/blob/master/fcv.py</span></a><span>)</span></p>
<p><span>Each set of raw force curve data file is accompanied by a json file which contains things like Vendor, Part number, description, author, max force bounds for graph, and tweaks for when the Python algorithms get a tad confused.</span></p>
<p><span>Due to how I had built the force curve gauge, the raw data that I receive  from the sensors are not zeroed. This means I do not know where the start or end of a keypress is within the data. Yes, it might be possible to zero out some axis before a test, but actually determining the position by eye to 0.1 of a mm is rather tricky, if not fruitless.</span></p>
<p><span>Therefore, much of the data analysis focuses on trying to determine the start and end of a keypress. Using a few heuristics, plus a few plot specific hints and adjustments, we have some rather nice graphs.</span></p>
<h2><span>Start of Press</span></h2>
<p><span>Determining the start of a keypress is a lot more difficult than it sounds. In most cases it’s sufficient to use a peak detection algorithm to detect the switch pre-load force (the initial jump in force when the load cell contacts the keycap). From the peak, then I trace back until the force is consistently ~0 gf and use that as the start of the press.</span></p>
</div></div></div><div><div data-bg-url=""><p><span>This is an ideal case. Unfortunately, it’s also possible to have switches that do not have an initial peak. I don’t have any measured yet, but take a magnetic spring without any pre-load. It would look something like this.</span></p></div></div><div><div data-bg-url=""><p><span><a href="https://a16zcdixon.files.wordpress.com/2015/05/screen-shot-2015-05-12-at-5-46-11-pm1.png" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/screen-shot-2015-05-12-at-5-46-11-pm1.png" alt=""/></a></span></p><p>https://a16zcdixon.files.wordpress.com/2015/05/screen-shot-2015-05-12-at-5-46-11-pm1.png</p></div></div><div><div data-bg-url=""><div><p><span>Once I locate the peak (which is the end of the press), then trace back, it becomes rather difficult to really determine where the start of the press was. Currently I have some manual configuration options to get around this issue, but it is something I’d like to solve in general for all keyboard switches.</span></p>
<h2><span>End of Press</span></h2>
<p><span>While not as tricky as the start of press, this is still a difficult point to be absolutely certain of. When the force curve gauge hits a certain force (around 800 gf) it will automatically change directions. Each raw data point is accompanied by a direction, which makes the direction change point easy to find. However, what we are really interested, is when the switch for “starts” to look like it’s going to infinity. We need to record the force right up until the switch plunger stops moving.</span></p>
<p><span>Here’s a good example of an asymptotic bottom-out force (looks like is going to infinity).</span></p>
</div></div></div><div><div data-bg-url=""><p><span>And here’s a curve where you’re not quite sure if it’s going to infinity yet (as the distance value is still changing).</span></p></div></div><div><div data-bg-url=""><div><p><span>This is particularly important, because the press and release data may be slightly delayed due to stand mechanics, test fixture sturdiness, load cell creep recovery (we are changing the force direction and trying to get a reading immediately afterwards), and a caliper distance reading (delay in directional change). To combat this, I align the press/release force curves based on their bottom out sections.</span></p>
<p><span>After many weeks playing with various algorithms (I wanted to auto-detect the distance scaling of the graphs), I gave up. I still think it’s possible (especially for constrained cases such as the Outemu Brown switch above) to determine the bottom out points.</span></p>
<p><span>Fortunately, in practice the bottom out curve is rather easy to align visually, so this isn’t really a large problem right now.</span></p>
<h2><span>Averaging Force Points</span></h2>
<p><span>One interesting visual issue is that there are more force data points than distance data points. This means each distance tick has more than one force attached to this.</span></p>
<p><span>Currently, I apply averaging to those duplicate force points, which helps smooth out the force curves.</span></p>
<p><span>Another option was to use the time parameter, in addition to the constant speed, to infer distance points and make the graph even more precise. While this is still possible, I started to run into Plotly limits when using the full dataset (had to upload using their Python API rather than directly through the web interface) so I decided not to pursue it.</span></p>
<p><span>I’m also not certain that getting greater distance precision is useful at this stage.</span></p>
<h2><span>Raw Distance to mm</span></h2>
<p><span>Rather than convert each distance tick from the iGaging DRO inside the Teensy 3.1, I opted to record the raw distance value and convert it later while generating the graph. The main benefit to this is that if I discover an error in my conversion I don’t have to re-measure all the switches, but just update the graph from the same set of raw data.</span></p>
<p><span>For a detailed explanation, please refer to the code comments here: </span><a href="https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L693"><span>https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L693</span></a></p>
<h2><span>Raw Force to gf</span></h2>
<p><span>When designing v2 of the force curve gauge, I included a “calibration test” before actually recording the press/release data.</span></p>
<p><span>The way this calibration method works is by stopping every 0.05 mm or so (5 ticks) and recording both a serial force reading and an ADC force reading. We have to stop because the serial force reading is buffered and may lag the ADC reading significantly.</span></p>
<p><span>In addition, the serial reading will affect the ADC reading (likely due to noise within the cable), so the readings have to be taken separately and cannot be done continuously.</span></p>
<p><span>Using this calibration data, the intent was to generate both press and release ADC conversion factors for each full test cycle as part of the raw data. The hope was that this would combat against possible variance in the load cell behaviour.</span></p>
<p><span>Unfortunately, the serial force readings lagged far more than expected. In some cases this just lead to garbage data. And a nonsensical set of conversion factors.</span></p>
<p><span>After about 3-4 weeks of trying to figure out a solution, I decided that I needed to move forward. It was time for a magic number (hah!).</span></p>
<p><a href="https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L386"><span>https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L386</span></a></p>
<p><span>This number was tuned after measuring numerous Cherry (and Topre) switches. It is calibrated reasonably well, but this is definitely something that could use improvement.</span></p>
<h2><span>Noisy Data</span></h2>
<p><span>Anyone that’s worked with raw data before, knows that noisy results are just another thing you have to deal with. In particular, the distance sensor often seems to jump around a little bit (i.e. go down when the motor is clearing going up).</span></p>
<p><span>To work around this I’ve added some data adjustment to force sequential distance ticks.</span></p>
<p><a href="https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L779"><span>https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L779</span></a></p>
<p><span>If 3 of 4 data points are in one direction, force the last one to be in that direction as well.</span></p>
<h2><span>Analytics</span></h2>
<p><span>As of writing this article (2016-11) I have added two different analytics to these force curves: Total Force (gfmm) and Actuation Force (gfmm).</span></p>
<h3><span>gfmm</span></h3>
<p><span>gf or g</span><span>f</span><span> is the measurement of gram-force or the mass of one gram due to the gravity of Earth. Another similar unit is cN or centi-Newton, it has a slightly different scale, but means the same thing. As it’s a bit easier to understand (and more common), I’ve standardize on gf as the common unit of force.</span></p>
<p><span>mm or millimeter is a unit of measurement. But most of the world already knows that.</span></p>
<p><span>gfmm or gf x mm can be read as the amount of force (gf) exerted over a distance (mm). In the context of force curve graphs, this is simply the area under the force curve from one point to another. This measurement, while very difficult to calculate without a force curve, is quite useful when trying to compare switches together.</span></p>
<h3><span>Total Force</span></h3>
<p><span>Total Force (gfmm) is the area under the press force curve from 0 mm to bottom out (4 mm in the graph below). Using numpy I’m able to use the dataset to calculate the total area under the force curve.</span></p>
<p><a href="https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L540"><span>https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L540</span></a></p>
<p><span>We can use a little bit of high school math to calculate the Total Force of a switch.</span></p>
</div></div></div><div><div data-bg-url=""><p><span><a href="http://latex.codecogs.com/gif.download?%5Cint_%7Bstart%7D%5E%7Bend_%7Bbottom-out%7D%7Df_%7Bforce%7Ddd_%7Bdistance%7D" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/CodeCogsEqn-1.png" alt=""/></a></span></p></div></div><div><div data-bg-url=""><p><span>For those who don’t remember what that means. We just multiply the force at every point between 0 mm and the bottom-out position (e.g. 4 mm). More simply, this can also be read as the area under the force curve.</span></p></div></div><div><div data-bg-url=""><p><span><a href="http://latex.codecogs.com/gif.download?f%5E%7Bforce%7D%20%5Ccdot%20d%5E%7Bdistance%7D" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/CodeCogsEqn-1.gif" alt=""/></a></span></p></div></div><div><div data-bg-url=""><p><span>Which can also be read as our force unit.</span></p></div></div><div><div data-bg-url=""><p><span><a href="http://latex.codecogs.com/gif.download?g%5Ef%5Ccdot%20mm" target="_self"><img src="https://input.club/wp-content/uploads/2016/11/CodeCogsEqn-2.gif" alt=""/></a></span></p></div></div><div><div data-bg-url=""><div><h3><span>Actuation Force</span></h3>
<p><span>The term Actuation Force is often incorrectly used for Force at Actuation (63 gf below). As Actuation Force really means how much force did it require in order to activate the switch (gfmm). So, just like Total Force we take the area under the force curve, but from 0 mm to actuation point (5.6 mm below).</span></p>
<p><a href="https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L549"><span>https://github.com/kiibohd/force/blob/c99f9a40da2ee1fd564d056a73c972cc93dd990d/fcv.py#L549</span></a></p>
<p><span>Unfortunately, it’s not always easy to measure the actuation point on switches. Contact switches are straightforward. However capacitive and magnetic switches tend to be a lot trickier to get the precise actuation point. If you’re reading a graph and it’s missing the Actuation Force, it generally means that recording the actuation point wasn’t easy to do.</span></p>
</div></div></div><div><div data-bg-url=""><div><h2><span>Plotly</span></h2>
<p><span>Rather than just export boring png files for plots I wanted something more interactive. And while I was working on raw data processing I discovered Plotly (</span><a href="https://plot.ly/"><span>https://plot.ly/</span></a><span>).</span></p>
<p><span>At a basic level, it provides interactive graphs (including various export formats, such as png). Remember that you can click the graphs in the post to play around with them on the Plotly site, as they can’t be fully embedded here. But what’s even more interesting is that it provides the dataset along with the graph. This means anyone can take the force curve data and apply new algorithms to it or even compare it to force curves they’ve generated themselves.</span></p>
<p><span>However, the most important feature for me is the ability to update force curves in place. So for example when I add a new analytic, I can update all the force curves in place while keeping the same link as they have today.</span></p>
<p><span>As a quick note, the two dates present on each graph are: normal font is measuring date, bold font is the latest updated date.</span></p>
<p><span>For all it’s awesomeness, Plotly is a bit finicky. I’ve spent tens of hours adjusting the templates to work correctly across all the different force curves. I’m also not able to do the sort of tooltip annotations I’d really like to have yet. But I’m hopeful that Plotly will be adding these sorts of things in the future.</span></p>

<p><span>Even as the force gauge stands right now, I still have some improvements planned. It shouldn’t even require any hardware changes.</span></p>
<ul>
<li><span>Varying speeds and changing acceleration</span></li>
<li><span>More curve analysis (additional analytics)</span></li>
<li><span>Automatic graph annotations (start of press, bottom-out point, pre-load force, etc.)</span></li>
<li><span>More precise distance measurement (perhaps through timestamp and speed analysis)</span></li>
<li><span>Reducing ADC Noise</span></li>
</ul>
<p><span>I still don’t know what the Kiibohd Force Curve Gauge v3 will look like or when I’ll start building it. But I have some ideas 😀</span></p>
</div></div></div><div><div data-bg-url=""><div>
<p>To be blunt, most keyboard switch reviews are relatively useless, and you really need to try switches for yourself.</p>
<p>However, it is possible to extract real, and useful, quantitative information about keyboard switches. It is just that all the current methods (nickels, spring weight, actuation force) don’t really give you a basis to compare against other switches.</p>
<p>What I’ve tried to do here is inspire a bit more engineering rigor into keyboard switch reviews. And, just maybe, we can start using useful metrics such as gfmm instead of just gf @ mm.</p>
<p>Still, I think we can do even better than this. This is just the beginning, and I hope all of you feel that way as well.</p>

<p>If you feel like reading even more. Some useful links on various topics.</p>
<ul>
<li><a href="http://www.interfaceforce.com/index.php?mod=library&amp;show=22">http://www.interfaceforce.com/index.php?mod=library&amp;show=22</a></li>
<li><a href="https://www.numpy.org/">http://www.numpy.org/</a></li>
<li><a href="https://plot.ly/">https://plot.ly/</a></li>
<li><a href="https://plot.ly/~haata">https://plot.ly/~haata</a></li>
<li><a href="https://github.com/kiibohd">https://github.com/kiibohd</a></li>
</ul>
</div></div></div></div></div>
							</div>
																													</div>
	</section>
						
					</div>  <!-- fusion-row -->
				</div></div>
  </body>
</html>
