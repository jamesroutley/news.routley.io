<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.tymscar.com/posts/wifi7speedhunt/">Original</a>
    <h1>From 400 Mbps to 1.7 Gbps: A WiFi 7 Debugging Journey</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>I recently upgraded from a <a href="https://techcrunch.com/2019/12/02/the-unifi-dream-machine-router-is-a-great-entry-point-for-networking-nerds">UniFi Dream Machine</a> to a <a href="https://techspecs.ui.com/unifi/cloud-gateways/udr7">UniFi Dream Router 7</a> because I’m getting 2.5 Gbps internet in two weeks and figured I’d jump on the WiFi 7 bandwagon while I’m at it. My iPhone 17 Pro Max supports it, so why not? After setting everything up, I was getting nowhere near the speeds I expected. Time for some debugging.</p><h2 id="the-disappointing-numbers">The disappointing numbers<a href="#the-disappointing-numbers" arialabel="Anchor">#</a></h2><p>My wired connection was pulling 950 Mbps through a 1 Gbps switch, and iperf3 directly to the UDR7’s 2.5 Gbps port showed around 2.3 Gbps. The backbone was solid. But on WiFi 7 (6 GHz, 160 MHz width), standing literally a foot from the router, I was getting around 400 Mbps with iperf3. With 10 concurrent streams it went up to 650 Mbps, but that’s still pathetic.</p><p>A quick note on my testing: I was using iperf3’s <code>-R</code> flag (reverse mode) which makes the server send data to the client instead of the other way around. This typically gives better results on WiFi since the AP has stronger transmit power than phones, and the phone only needs to send tiny ACKs back.</p><p>Meanwhile, <a href="https://www.rtings.com/router/reviews/unifi/dream-router-7">reviewers were getting 1,635 Mbps average on 6 GHz with the UDR7</a>, with peaks up to 1,890 Mbps. There’s even <a href="https://www.youtube.com/watch?v=fSovy5LzYvM">a YouTube video showing an iPhone 17 Pro Max hitting 1.9 Gb/s on 6 GHz 160 MHz</a>. I was getting a third of that.</p><h2 id="false-start-1-maybe-im-testing-wrong">False start #1: “Maybe I’m testing wrong”<a href="#false-start-1-maybe-im-testing-wrong" arialabel="Anchor">#</a></h2><p>I created a dedicated 6 GHz-only network with 160 MHz channel width on Auto transmit power. The spectrum was clean with no other 6 GHz broadcasts. I wondered if maybe 160 MHz was causing issues, so I tried switching to 80 MHz width to test that theory - but that made things worse at 374 Mbps total. So it wasn’t that 160 MHz was broken; something else was going on. Moving the iperf server from the UDR itself to my MacBook over Ethernet improved things to 727 Mbps, but still nowhere near the expected speeds.</p><p>At this point I knew <a href="https://5gstore.com/blog/2025/09/16/apple-n1-chip-wifi-7-iphone-17/">the phone could only do 160 MHz width, not 320 MHz</a> - that’s what Apple’s N1 chip is limited to. I hadn’t enabled IPS/IDS or QOS yet, though I was planning to since the UDR7 can handle it at full 2.5 Gbps.</p><h2 id="finding-the-first-bottleneck">Finding the first bottleneck<a href="#finding-the-first-bottleneck" arialabel="Anchor">#</a></h2><p>After banging my head against this for hours, I had a hypothesis about my test setup. My wired MacBook could hit 2.3 Gbps to the router, so the network was fine. But looking at my iperf3 results when testing WiFi against 10.0.0.1 (the router itself), I wondered if that was the issue:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>iperf3 -c 10.0.0.1 -P <span>6</span> -R -t <span>20</span> -w 2M
</span></span><span><span><span># ...</span>
</span></span><span><span><span>[</span>SUM<span>]</span>   0.00-20.01  sec  1.30 GBytes   <span>560</span> Mbits/sec    <span>0</span>             sender
</span></span></code></pre></div><p>Running iperf server on the router itself creates CPU contention between the WiFi scheduling and the iperf process. The router’s TCP stack isn’t tuned for this either. Classic mistake.</p><h2 id="false-start-2-its-a-25-gbe-problem">False start #2: “It’s a 2.5 GbE problem”<a href="#false-start-2-its-a-25-gbe-problem" arialabel="Anchor">#</a></h2><p>Moved the iperf server to my MacBook connected through a USB-C 2.5 GbE adapter. Verified the port negotiated at 2.5G in UniFi’s port settings. Ran the test again:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>iperf3 -c &lt;mac_ip&gt; -P <span>6</span> -R -t <span>20</span>
</span></span><span><span><span># ...</span>
</span></span><span><span><span>[</span>SUM<span>]</span>   0.00-20.01  sec  1.67 GBytes   <span>718</span> Mbits/sec                  sender
</span></span></code></pre></div><p>Better, but still nowhere close to 1.9 Gbps. Time to check what UniFi was actually showing for the client connection during the test. That’s when I found the real problem.</p><h2 id="the-actual-issue-80-mhz-not-160-mhz">The actual issue: 80 MHz, not 160 MHz<a href="#the-actual-issue-80-mhz-not-160-mhz" arialabel="Anchor">#</a></h2><p>Looking at the UniFi client details while running iperf, I saw this:</p><pre tabindex="0"><code>Ch. 37 (6 GHz, 80 MHz)
Tx/Rx Rate: 1.20 Gbps
</code></pre><p>Wait, what? My iPhone was connecting at 80 MHz channel width, not 160 MHz. Even though I had configured the SSID for 160 MHz, the actual radio was still on 80 MHz. The 1.20 Gbps PHY rate is exactly what you’d expect for 2×2 MIMO at 80 MHz. That explained the 650-900 Mbps TCP throughput perfectly. When I had manually tested 80 MHz earlier and got worse speeds (374 Mbps), it was probably due to testing against the router itself rather than the channel width.</p><p>The fix was in the UDR7’s radio settings, not the SSID settings. I went to:</p><ul><li>Devices → UDR7 → Radios → 6 GHz</li><li>Set channel width explicitly to 160 MHz (not Auto)</li><li>Set transmit power to High</li></ul><h2 id="the-working-configuration">The working configuration<a href="#the-working-configuration" arialabel="Anchor">#</a></h2><p>After applying those changes and reconnecting:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>iperf3 -c &lt;mac_ip&gt; -P <span>6</span> -R -t <span>20</span>
</span></span><span><span><span># ...</span>
</span></span><span><span><span>[</span>SUM<span>]</span>   0.00-20.01  sec  3.77 GBytes  1.62 Gbits/sec                  sender
</span></span></code></pre></div><p>Finally! The UniFi panel now showed:</p><ul><li>6 GHz, 160 MHz</li><li>Tx/Rx Rate: 2.4-2.9 Gbps</li></ul><p>That’s exactly the expected PHY rate for 2×2 WiFi 7 at 160 MHz with 4096-QAM.</p><h2 id="why-certain-iperf-flags-matter">Why certain iperf flags matter<a href="#why-certain-iperf-flags-matter" arialabel="Anchor">#</a></h2><p>During this journey I learned why specific iperf3 flags make such a huge difference:</p><p><strong>The <code>-R</code> flag (reverse mode)</strong>: As I mentioned earlier, this is crucial for WiFi testing. It’s faster because:</p><ul><li>The AP has higher transmit power and better antennas</li><li>The phone only has to send tiny ACKs back</li><li>iOS’s TCP receive path is better optimized than its send path</li><li>Phones transmit at much lower power on 6 GHz</li></ul><p><strong>Multiple streams (<code>-P 6</code>)</strong>: Overcomes single-flow TCP limitations like slow start, congestion window, and socket buffer limits. Four to eight streams usually hit peak; more gives diminishing returns.</p><p><strong>TCP window size (<code>-w 2M</code>)</strong>: Less critical on LAN where RTT is tiny, but can help with bursty traffic.</p><h2 id="why-no-22-client-hits-25-gbps-on-wifi">Why no 2×2 client hits 2.5 Gbps on WiFi<a href="#why-no-22-client-hits-25-gbps-on-wifi" arialabel="Anchor">#</a></h2><p>Even with everything optimized, I’ll never see 2.5 Gbps on my phone. Here’s why:</p><p>The fastest PHY a 2×2 client can negotiate on 160 MHz WiFi 7 is about 2.88 Gbps (4096-QAM, MCS13). But that’s the raw link rate. After overhead:</p><ul><li>MAC/PHY overhead (preambles, pilots, guard intervals, CSMA/CA backoff, block ACKs)</li><li>IP/TCP headers</li><li>Encryption overhead</li></ul><p>Best-case TCP “goodput” is typically 60-75% of PHY on a clean single-client link. So 60-75% of 2.88 Gbps gives you roughly 1.7-2.1 Gbps. That’s why reviews land around 1.6-1.9 Gbps.</p><p>To exceed 2.0-2.1 Gbps you’d need:</p><ul><li>320 MHz channels (not supported on iPhones)</li><li>More spatial streams (3×3 or 4×4, but phones are 2×2)</li><li>WiFi 7 MLO using multiple bands simultaneously</li></ul><h2 id="key-takeaways">Key takeaways<a href="#key-takeaways" arialabel="Anchor">#</a></h2><p>For anyone else trying to maximize their WiFi 7 speeds:</p><ol><li><strong>Don’t test against the router itself</strong> - Use a separate machine on &gt;=2.5 GbE</li><li><strong>Check your actual channel width</strong> - The client details panel tells the truth, not the SSID settings</li><li><strong>Set transmit power to High for testing</strong> - But use Auto/Medium for daily use to avoid uplink/downlink imbalance</li><li><strong>Use reverse mode with multiple streams</strong> - <code>iperf3 -c &lt;server&gt; -P 6 -R -t 20</code></li><li><strong>Stand 6-10 feet away</strong> - Too close can hurt signal quality</li></ol><p>After all this debugging, I’m now consistently seeing 1.6-1.7 Gbps on WiFi 7 with my iPhone. Not quite the headline 1.9 Gbps some reviewers got, but definitely in the expected range for real-world performance. More importantly, I understand exactly why the numbers are what they are.</p><p>Now I just need my ISP to actually deliver that 2.5 Gbps upgrade…</p></div></div></div>
  </body>
</html>
