<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cruncher.ch/blog/printing-music-with-css-grid/">Original</a>
    <h1>Printing Music with CSS Grid</h1>
    
    <div id="readability-page-1" class="page"><div>
    
    
    

    
    

    
    
    

    
    <p>Too often have I witnessed the improvising musician sweaty-handedly attempting to pinch-zoom an A4 pdf on a tiny mobile screen at the climax of a gig. We need fluid and responsive music rendering for the web!</p>
    

    <p>
        <span>Stephen Band</span>
        <time>24 Apr 2024</time>
    </p>
    
    

    








<section>
    <p>Music notation should be as accessible and as fluid as text is, on the
    web; that it is not, yet, is something of an afront to my sensibilities.
    Let us fix this pressing problem.</p>

    <h2>The Scribe prototype</h2>

    <figure>
        <img src="https://www.lynalden.com/static/blog/printing-music/images/scribe-020-dolphin-dance.png"/>
        <figcaption>SVG rendered by Scribe 0.2</figcaption>
    </figure>

    <p>Some years ago I prototyped a music renderer I called Scribe that outputs
    SVG from JSON. The original goal was to produce a responsive music renderer.
    It was a good demo, but to progress I was going to have to write a complex
    multi-pass layout engine, and, well, other things got in the way.</p>

    <p>Shortly after making that I was busy adopting Grid into our projects at
    Cruncher when something about it struck me as familiar, and I wondered if
    it might not be an answer to some of the layout problems I had been tackling
    in Scribe.</p>

    <h2>The class <code>.stave</code></h2>

    <p>The musical staff is grid-like. Pitch is plotted up the vertical axis and
    time runs left to right along the horizontal axis. I am going to define
    these two axes in two seperate classes. The vertical axis, defining grid rows,
    will be called <code>.stave</code>. We&#39;ll get to the time axis in a bit.</p>

    <p>A <code>.stave</code> has fixed-size grid rows named with standard pitch
    names, and a background image that draws the staff. So for a treble clef
    stave the row map might look like this:</p>

    <pre><code>
    .stave {
        display: grid;
        row-gap: 0;
        grid-template-rows:
            [A5] 0.25em [G5] 0.25em [F5] 0.25em [E5] 0.25em
            [D5] 0.25em [C5] 0.25em [B4] 0.25em [A4] 0.25em
            [G4] 0.25em [F4] 0.25em [E4] 0.25em [D4] 0.25em
            [C4] 0.25em ;

        background-image:    url(&#39;/path/to/stave.svg&#39;);
        background-repeat:   no-repeat;
        background-size:     100% 2.25em;
        background-position: 0 50%;
    }
    </code></pre>

    <p>Which, applied to a <code>&lt;div&gt;</code> gives us:</p>

    

    <p>Ok. Not much to see, but on inspecting it we do see that each line and
    each space on the stave now has its own pitch-named grid line to identify each row:</p>

    <img height="520" src="https://www.lynalden.com/static/blog/printing-music/images/template-rows.png" alt="Named grid rows"/>

    <h3>Placing pitches up the stave</h3>

    <p>Any given row on a stave may contain any of several pitches. The
    pitches <strong>G‚ô≠</strong>, <strong>G</strong> and <strong>G‚ôØ</strong> must
    all sit on the <strong>G</strong> stave line, for example.</p>

    <p>To place DOM elements that represent those pitches in their correct rows I
    am going to put pitch names in <code>data-pitch</code> attributes and use CSS
    to map <code>data-pitch</code> values to stave rows.</p>

    <pre><code>
    .stave &gt; [data-pitch^=&#34;G&#34;][data-pitch$=&#34;4&#34;] { grid-row-start: G4; }
    </code></pre>

    <p>This rule captures pitches that start with <code>&#39;G&#39;</code> and end with
    <code>&#39;4&#39;</code>, so it assigns pitches <code>&#39;G‚ô≠4&#39;</code>, <code>&#39;G4&#39;</code>
    and <code>&#39;G‚ôØ4&#39;</code> (and double flat <code>&#39;GùÑ´4&#39;</code> and  double sharp
    <code>&#39;GùÑ™4&#39;</code>) to the <code>G4</code> row. That does need to be done for
    every stave row:</p>

    <!--aside class="right right-2">
    <p class="text-10"> full stylesheet can be found at <a href="">TODO</a>.
    A table of MIDI note numbers at <a href="https://inspiredacoustics.com/en/MIDI_note_numbers_and_center_frequencies">inspiredacoustics.com/en/MIDI_note_numbers_and_center_frequencies</a>.</p>
    </aside-->

    <pre><code>
    .stave &gt; [data-pitch^=&#34;A&#34;][data-pitch$=&#34;5&#34;] { grid-row-start: A5; }
    .stave &gt; [data-pitch^=&#34;G&#34;][data-pitch$=&#34;5&#34;] { grid-row-start: G5; }
    .stave &gt; [data-pitch^=&#34;F&#34;][data-pitch$=&#34;5&#34;] { grid-row-start: F5; }
    .stave &gt; [data-pitch^=&#34;E&#34;][data-pitch$=&#34;5&#34;] { grid-row-start: E5; }
    .stave &gt; [data-pitch^=&#34;D&#34;][data-pitch$=&#34;5&#34;] { grid-row-start: D5; }

    ...

    .stave &gt; [data-pitch^=&#34;D&#34;][data-pitch$=&#34;4&#34;] { grid-row-start: D4; }
    .stave &gt; [data-pitch^=&#34;C&#34;][data-pitch$=&#34;4&#34;] { grid-row-start: C4; }
    </code><!--style>
    .stave > [data-pitch^="A"][data-pitch$="5"] { grid-row-start: A5; }
    .stave > [data-pitch^="G"][data-pitch$="5"] { grid-row-start: G5; }
    .stave > [data-pitch^="F"][data-pitch$="5"] { grid-row-start: F5; }
    .stave > [data-pitch^="E"][data-pitch$="5"] { grid-row-start: E5; }
    .stave > [data-pitch^="D"][data-pitch$="5"] { grid-row-start: D5; }
    .stave > [data-pitch^="C"][data-pitch$="5"] { grid-row-start: C5; }
    .stave > [data-pitch^="B"][data-pitch$="4"] { grid-row-start: B4; }
    .stave > [data-pitch^="A"][data-pitch$="4"] { grid-row-start: A4; }
    .stave > [data-pitch^="G"][data-pitch$="4"] { grid-row-start: G4; }
    .stave > [data-pitch^="F"][data-pitch$="4"] { grid-row-start: F4; }
    .stave > [data-pitch^="E"][data-pitch$="4"] { grid-row-start: E4; }
    .stave > [data-pitch^="D"][data-pitch$="4"] { grid-row-start: D4; }
    .stave > [data-pitch^="C"][data-pitch$="4"] { grid-row-start: C4; }
    </style--></pre>

    <p>That should give us enough to begin placing symbols on a stave! I have a
    bunch of SVG symbols that were prepared for the Scribe prototype, so let&#39;s
    try placing a couple on a stave:</p>

    <pre><code>
    &lt;div class=&#34;stave&#34;&gt;
        &lt;svg data-pitch=&#34;G4&#34; class=&#34;head&#34;&gt;
            &lt;use href=&#34;#head[2]&#34;&gt;&lt;/use&gt;
        &lt;/svg&gt;
        &lt;svg data-pitch=&#34;E5&#34; class=&#34;head&#34;&gt;
            &lt;use href=&#34;#head[2]&#34;&gt;&lt;/use&gt;
        &lt;/svg&gt;
    &lt;/div&gt;
    </code></pre>

    

    <p>That looks promising. Next, time.</p>

    <h2>The class <code>.bar</code> and its beats</h2>

    <p>Rhythm is perhaps a little trickier to handle. There is not one
    immediately obvious smallest rhythmic division to adopt that will support all kinds
    of rhythms. A judgement call must be made about what minimum note lengths
    and what cross-rhythms to support inside a grid.</p>

    <p>A 24-column-per-beat approach supports beat divisions to evenly lay out
    eighth notes (12 columns), sixteenth notes (6 columns) 32nd notes (3 columns)
    as well as triplet values of those notes. It&#39;s a good starting point.</p>

    <!--aside class="4x right right-2 text-10">
        <p>There may be a case for opting for higher
        resolutions, but I don't know yet how an HTML document will behave when it
        has hundreds of bars of grids in it ‚Äì potentially hundreds of thousands of
        cells.</p>
    </aside-->

    <p>Here is a 4 beat bar defined as 4 √ó 24 = 96 grid columns, plus a column at
    the beginning and one at the end:</p>

    <pre><code>
    .bar {
        column-gap: 0.03125em;
        grid-template-columns:
            [bar-begin]
            max-content
            repeat(96, minmax(max-content, auto))
            max-content
            [bar-end];
    }
    </code><!--style>
    .bar {
        padding-left: 0.5em;
        padding-right: 0.5em;
        column-gap: 0.03125em;
        grid-template-columns:
            [bar-begin]
            max-content
            repeat(96, minmax(max-content, auto))
            max-content
            [bar-end];
    }

    .bar::before,
    .bar::after {
        grid-row: B4;
        align-self: center;
        height: 2em;
    }

    .flex > .bar {
        flex: 1 1;
        /* Make bar lines overlap */
        margin-left: calc(-1 * var(--bar-line-size, 1px));
        margin-right: 0;
    }
    </style--></pre>

    <p>Add a couple of bar lines as <code>::before</code> and <code>::after</code>
    content, and put a clef symbol in there centred on the stave with <code>data-pitch=&#34;B4&#34;</code>,
    and we get:</p>

    <pre><code>
    &lt;div class=&#34;stave bar&#34;&gt;
        &lt;svg data-pitch=&#34;B4&#34; class=&#34;treble-clef&#34;&gt;
            &lt;use href=&#34;#treble-clef&#34;&gt;&lt;/use&gt;
        &lt;/svg&gt;
    &lt;/div&gt;
    </code></pre>

    

    <p>Inspect that and we see that the clef has dropped into the first column,
    and there are 96 zero-width columns, 24 per beat, each seperated by a small <code>column-gap</code>:</p>

    <img height="516" src="https://www.lynalden.com/static/blog/printing-music/images/template-columns.png" alt="Named grid rows"/>

    <h3>Placing symbols at beats</h3>

    <p>This time I am going to use <code>data-beat</code> attributes to assign
    elements a beat, and CSS rules to map beats to grid columns. The CSS map
    looks like this, with a rule for each 1/24th of a beat:</p>

    <pre><code>
    .bar &gt; [data-beat^=&#34;1&#34;]    { grid-column-start: 2; }
    .bar &gt; [data-beat^=&#34;1.04&#34;] { grid-column-start: 3; }
    .bar &gt; [data-beat^=&#34;1.08&#34;] { grid-column-start: 4; }
    .bar &gt; [data-beat^=&#34;1.12&#34;] { grid-column-start: 5; }
    .bar &gt; [data-beat^=&#34;1.16&#34;] { grid-column-start: 6; }
    .bar &gt; [data-beat^=&#34;1.20&#34;] { grid-column-start: 7; }
    .bar &gt; [data-beat^=&#34;1.25&#34;] { grid-column-start: 8; }

    ...

    .bar &gt; [data-beat^=&#34;4.95&#34;] { grid-column-start: 97; }
    </code><!--style>
    .bar > [data-beat^="1"]    { grid-column-start: 2; }
    .bar > [data-beat^="1.04"] { grid-column-start: 3; }
    .bar > [data-beat^="1.08"] { grid-column-start: 4; }
    .bar > [data-beat^="1.12"] { grid-column-start: 5; }
    .bar > [data-beat^="1.16"] { grid-column-start: 6; }
    .bar > [data-beat^="1.20"] { grid-column-start: 7; }
    .bar > [data-beat^="1.25"] { grid-column-start: 8; }
    .bar > [data-beat^="1.29"] { grid-column-start: 9; }
    .bar > [data-beat^="1.33"] { grid-column-start: 10; }
    .bar > [data-beat^="1.37"] { grid-column-start: 11; }
    .bar > [data-beat^="1.41"] { grid-column-start: 12; }
    .bar > [data-beat^="1.45"] { grid-column-start: 13; }
    .bar > [data-beat^="1.5"]  { grid-column-start: 14; }
    .bar > [data-beat^="1.54"] { grid-column-start: 15; }
    .bar > [data-beat^="1.58"] { grid-column-start: 16; }
    .bar > [data-beat^="1.62"] { grid-column-start: 17; }
    .bar > [data-beat^="1.66"] { grid-column-start: 18; }
    .bar > [data-beat^="1.70"] { grid-column-start: 19; }
    .bar > [data-beat^="1.75"] { grid-column-start: 20; }
    .bar > [data-beat^="1.79"] { grid-column-start: 21; }
    .bar > [data-beat^="1.83"] { grid-column-start: 22; }
    .bar > [data-beat^="1.87"] { grid-column-start: 23; }
    .bar > [data-beat^="1.91"] { grid-column-start: 24; }
    .bar > [data-beat^="1.95"] { grid-column-start: 25; }
    .bar > [data-beat^="2"]    { grid-column-start: 26; }
    .bar > [data-beat^="2.04"] { grid-column-start: 27; }
    .bar > [data-beat^="2.08"] { grid-column-start: 28; }
    .bar > [data-beat^="2.12"] { grid-column-start: 29; }
    .bar > [data-beat^="2.16"] { grid-column-start: 30; }
    .bar > [data-beat^="2.20"] { grid-column-start: 31; }
    .bar > [data-beat^="2.25"] { grid-column-start: 32; }
    .bar > [data-beat^="2.29"] { grid-column-start: 33; }
    .bar > [data-beat^="2.33"] { grid-column-start: 34; }
    .bar > [data-beat^="2.37"] { grid-column-start: 35; }
    .bar > [data-beat^="2.41"] { grid-column-start: 36; }
    .bar > [data-beat^="2.45"] { grid-column-start: 37; }
    .bar > [data-beat^="2.5"]  { grid-column-start: 38; }
    .bar > [data-beat^="2.54"] { grid-column-start: 39; }
    .bar > [data-beat^="2.58"] { grid-column-start: 40; }
    .bar > [data-beat^="2.62"] { grid-column-start: 41; }
    .bar > [data-beat^="2.66"] { grid-column-start: 42; }
    .bar > [data-beat^="2.70"] { grid-column-start: 43; }
    .bar > [data-beat^="2.75"] { grid-column-start: 44; }
    .bar > [data-beat^="2.79"] { grid-column-start: 45; }
    .bar > [data-beat^="2.83"] { grid-column-start: 46; }
    .bar > [data-beat^="2.87"] { grid-column-start: 47; }
    .bar > [data-beat^="2.91"] { grid-column-start: 48; }
    .bar > [data-beat^="2.95"] { grid-column-start: 49; }
    .bar > [data-beat^="3"]    { grid-column-start: 50; }
    .bar > [data-beat^="3.04"] { grid-column-start: 51; }
    .bar > [data-beat^="3.08"] { grid-column-start: 52; }
    .bar > [data-beat^="3.12"] { grid-column-start: 53; }
    .bar > [data-beat^="3.16"] { grid-column-start: 54; }
    .bar > [data-beat^="3.20"] { grid-column-start: 55; }
    .bar > [data-beat^="3.25"] { grid-column-start: 56; }
    .bar > [data-beat^="3.29"] { grid-column-start: 57; }
    .bar > [data-beat^="3.33"] { grid-column-start: 58; }
    .bar > [data-beat^="3.37"] { grid-column-start: 59; }
    .bar > [data-beat^="3.41"] { grid-column-start: 60; }
    .bar > [data-beat^="3.45"] { grid-column-start: 61; }
    .bar > [data-beat^="3.5"]  { grid-column-start: 62; }
    .bar > [data-beat^="3.54"] { grid-column-start: 63; }
    .bar > [data-beat^="3.58"] { grid-column-start: 64; }
    .bar > [data-beat^="3.62"] { grid-column-start: 65; }
    .bar > [data-beat^="3.66"] { grid-column-start: 66; }
    .bar > [data-beat^="3.70"] { grid-column-start: 67; }
    .bar > [data-beat^="3.75"] { grid-column-start: 68; }
    .bar > [data-beat^="3.79"] { grid-column-start: 69; }
    .bar > [data-beat^="3.83"] { grid-column-start: 70; }
    .bar > [data-beat^="3.87"] { grid-column-start: 71; }
    .bar > [data-beat^="3.91"] { grid-column-start: 72; }
    .bar > [data-beat^="3.95"] { grid-column-start: 73; }
    .bar > [data-beat^="4"]    { grid-column-start: 74; }
    .bar > [data-beat^="4.04"] { grid-column-start: 75; }
    .bar > [data-beat^="4.08"] { grid-column-start: 76; }
    .bar > [data-beat^="4.12"] { grid-column-start: 77; }
    .bar > [data-beat^="4.16"] { grid-column-start: 78; }
    .bar > [data-beat^="4.20"] { grid-column-start: 79; }
    .bar > [data-beat^="4.25"] { grid-column-start: 80; }
    .bar > [data-beat^="4.29"] { grid-column-start: 81; }
    .bar > [data-beat^="4.33"] { grid-column-start: 82; }
    .bar > [data-beat^="4.37"] { grid-column-start: 83; }
    .bar > [data-beat^="4.41"] { grid-column-start: 84; }
    .bar > [data-beat^="4.45"] { grid-column-start: 85; }
    .bar > [data-beat^="4.5"]  { grid-column-start: 86; }
    .bar > [data-beat^="4.54"] { grid-column-start: 87; }
    .bar > [data-beat^="4.58"] { grid-column-start: 88; }
    .bar > [data-beat^="4.62"] { grid-column-start: 89; }
    .bar > [data-beat^="4.66"] { grid-column-start: 90; }
    .bar > [data-beat^="4.70"] { grid-column-start: 91; }
    .bar > [data-beat^="4.75"] { grid-column-start: 92; }
    .bar > [data-beat^="4.79"] { grid-column-start: 93; }
    .bar > [data-beat^="4.83"] { grid-column-start: 94; }
    .bar > [data-beat^="4.87"] { grid-column-start: 95; }
    .bar > [data-beat^="4.91"] { grid-column-start: 96; }
    .bar > [data-beat^="4.95"] { grid-column-start: 97; }
    </style--></pre>

    <p>The attribute <code>^=</code> starts-with selector
    makes the rule error-tolerant. At some point, inevitably, unrounded or
    floating point numbers will be rendered into <span><code>data-beat</code>.</span>
    Two of their decimal places is enough to identify a <span>1/24th-of-a-beat</span>
    grid column.</p>

    <p>Put that together with our <code>stave</code> class and we are able to position symbols
    by beat and pitch by setting <code>data-beat</code> to a beat between
    <code>1</code> and <code>5</code>, and <code>data-pitch</code> to a note name. As we do,
    the beat columns containing those symbols grow to accommodate them:</p>

    <pre><code>
    &lt;div class=&#34;stave bar&#34;&gt;
        &lt;svg class=&#34;clef&#34; data-pitch=&#34;B4&#34;&gt;‚Ä¶&lt;/svg&gt;
        &lt;svg class=&#34;flat&#34; data-beat=&#34;1&#34; data-pitch=&#34;Bb4&#34;&gt;‚Ä¶&lt;/svg&gt;
        &lt;svg class=&#34;head&#34; data-beat=&#34;1&#34; data-pitch=&#34;Bb4&#34;&gt;‚Ä¶&lt;/svg&gt;
        &lt;svg class=&#34;head&#34; data-beat=&#34;2&#34; data-pitch=&#34;D4&#34;&gt;‚Ä¶&lt;/svg&gt;
        &lt;svg class=&#34;head&#34; data-beat=&#34;3&#34; data-pitch=&#34;G5&#34;&gt;‚Ä¶&lt;/svg&gt;
        &lt;svg class=&#34;rest&#34; data-beat=&#34;4&#34; data-pitch=&#34;B4&#34;&gt;‚Ä¶&lt;/svg&gt;
    &lt;/div&gt;
    </code></pre>

    

    <p>Ooo. Stems?</p>

    

    <p>Yup. Tails?</p>

    

    <p>Yup. The tail spacing can be improved (which should be achievable with margins) ‚Äì but the positioning works.</p>

    <h2>Fluid and responsive notation</h2>

    <p>Stick a whole bunch of bars like these together in a flexbox container
    that wraps and we start to see responsive music:</p>

    <pre><code>
    &lt;figure class=&#34;flex&#34;&gt;
        &lt;div class=&#34;treble-stave stave bar&#34;&gt;‚Ä¶&lt;/div&gt;
        &lt;div class=&#34;treble-stave stave bar&#34;&gt;‚Ä¶&lt;/div&gt;
        &lt;div class=&#34;treble-stave stave bar&#34;&gt;‚Ä¶&lt;/div&gt;
        ‚Ä¶
    &lt;/figure&gt;
    </code></pre>





    





    <p>There are clearly a bunch of things missing from this, but this is a
    great base to start from. It already wraps more gracefully than I have yet
    seen an online music renderer¬†do.</p>


    <h2>The space between the¬†notes</h2>

    <p>Ignoring these beams for a moment, notice that note heads that occur closer
    in time to one another are rendered slightly closer together:</p>

    

    <p>It&#39;s a subtle, deliberate effect created by the small <code>column-gap</code>,
    which serves as a sort of time &#39;ether&#39; into which symbol elements slot. Columns
    themselves are zero width unless there is a note head in them, but there are
    more column-gaps ‚Äì 24 per beat ‚Äì between events that are further apart in
    beats, and so more distance.</p>

    <p>Constant spacing can be controlled by adjusting margins on the symbols.
    To get a more constant spacing here we would reduce the <code>column-gap</code>
    while increasing the margin of note heads:</p>

    

    <p>But ugh, that looks bad, because the head spacings give the reader no clue
    as to how rapid the rhythm is. The point is, CSS is giving us some nice control
    over the metrics. And the aim now is to tweak those metrics for readability.</p>

    <h3>Clefs and time signatures</h3>

    <!--p>I like this system for printing music.  Individual symbol margins,
    stroke thicknesses, and even stave maps, can all be restyled in¬†CSS.</p-->

    <p>You may be wondering why I employed seperate classes for vertical and
    horizontal spacing, why not just one? Seperating the axes means that
    one can be swapped out without the other. Take the melody:</p>

    <scribe-music type="sequence" clef="treble" meter="4/4">
    0.5 B3  0.2 1.5
    2   D4  0.2 1
    3   F#4 0.2 1
    4   E4  0.2 1
    5   D4  0.2 1
    6   B3  0.2 0.5
    6.5 G3  0.2 0.5
    <!--9   A3  0.2 1
    10  C4  0.2 1
    11  G4  0.2 1
    12  F#4 0.2 1
    13  C#4 0.2 2-->
    </scribe-music>

    <p>To display this same melody on a bass clef, the <code>stave</code> class can be
    swapped out for a <code>bass-stave</code> class that maps the same <code>data-pitch</code>
    attributes to bass stave lines:</p>

    <pre><code>
    &lt;div class=&#34;bass-stave bar&#34;&gt;...&lt;/div&gt;
    </code></pre>

    <scribe-music type="sequence" clef="bass" meter="4/4">
    0.5 B3  0.2 1.5
    2   D4  0.2 1
    3   F#4 0.2 1
    4   E4  0.2 1
    5   D4  0.2 1
    6   B3  0.2 0.5
    6.5 G3  0.2 0.5
    <!--9   A3  0.2 1
    10  C4  0.2 1
    11  G4  0.2 1
    12  F#4 0.2 1
    13  C#4 0.2 2-->
    </scribe-music>

    <p>Or, with CSS that mapped <code>data-duration=&#34;5&#34;</code> to 120
    <code>grid-template-columns</code> on <code>.bar</code>, the same stave
    could be given a time signature of 5/4:</p>

    <pre><code>
    &lt;div class=&#34;bass-stave bar&#34; data-duration=&#34;5&#34;&gt;...&lt;/div&gt;
    </code></pre>

    <scribe-music type="sequence" clef="bass" meter="5/4">
    0.5 B3  0.2 1.5
    2   D4  0.2 1
    3   F#4 0.2 1
    4   E4  0.2 1
    5   D4  0.2 1
    6   B3  0.2 0.5
    6.5 G3  0.2 0.5
    <!--9   A3  0.2 1
    10  C4  0.2 1
    11  G4  0.2 1
    12  F#4 0.2 1
    13  C#4 0.2 2-->
    </scribe-music>

    <p>Clearly I am glossing over a few details. Not everything is as simple as
    a class change, and a few stems and ledger lines need repositioned.</p>

    <p>Here&#39;s a stave class that remaps pitches entirely. General MIDI
    places drum and percussion voices on a bunch of notes in the bottom octaves
    of a keyboard, but those notes are not related to where drums are printed
    on a stave. In CSS a <code>drums-stave</code> class can be defined that maps
    those pitches to their correct rows:</p>

    <pre><code>
    &lt;div class=&#34;drums-stave bar&#34; data-duration=&#34;4&#34;&gt;...&lt;/div&gt;
    </code></pre>

    

    <pre><code>
    &lt;div class=&#34;percussion-stave bar&#34; data-duration=&#34;4&#34;&gt;...&lt;/div&gt;
    </code></pre>

    

    <p>That&#39;s some very readable drum notation. I&#39;m pretty pleased with that.</p>

    <h3>Chords and lyrics</h3>

    <p>CSS Grid allows us to align other symbols inside the notation grid too.
    Chords and lyrics, dynamics and so on can be lined up with, and span, timed
    events:</p>

    <div>
        <div data-duration="4">
            <svg preserveAspectRatio="none" viewBox="0 0.4 5.2 14.6"><use x="3.2" y="1" width="8" href="#piano-clef"></use></svg>
            <header>
                <p>4</p>
                <p>4</p>
            </header>
            <p data-beat="1" data-duration="1.5">In</p>
            <p data-beat="1" data-duration="2">A<span>‚ô≠</span><sub>maj</sub></p>
            <svg data-beat="1" data-pitch="C5" data-duration="1.5" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1.5]"></use></svg>
            <svg data-beat="1" data-pitch="A‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="C5" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="A‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="1" data-pitch="E‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="E‚ô≠4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="E‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <p data-beat="2.5" data-duration="0.5">the</p>
            <svg data-beat="2.5" data-pitch="D‚ô≠5" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="2.5" data-pitch="D‚ô≠5" data-duration="0.5" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemdown"></use></svg>
            <svg data-beat="2.5" data-pitch="D‚ô≠5" data-duration="0.5" preserveAspectRatio="xMidYMid" viewBox="0 -1 2.7 2"><use href="#taildown[0.5]"></use></svg>
            <svg data-beat="2.5" data-pitch="D‚ô≠5" data-duration="0.5" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[0.5]"></use></svg>
            <p data-beat="3" data-duration="1">bleak</p>
            <p data-beat="3" data-duration="2">A<span>‚ô≠</span><sub>maj</sub>/G</p>
            <svg data-beat="3" data-pitch="E‚ô≠5" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="3" data-pitch="E‚ô≠5" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="3" data-pitch="B‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="3" data-pitch="E‚ô≠5" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="B‚ô≠4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="3" data-pitch="F4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="F4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <p data-beat="4" data-duration="1">mid-</p>
            <svg data-beat="4" data-pitch="C5" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="4" data-pitch="C5" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="4" data-pitch="F4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="4" data-pitch="C4" preserveAspectRatio="xMidYMin" viewBox="0 -0.5 4.4 1" style="height: calc(1 * var(--y-size));"><use x="0" y="-8" href="#ledges"></use></svg>
            <svg data-beat="4" data-pitch="C4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="4" data-pitch="C4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="1" data-pitch="A‚ô≠2" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="A‚ô≠2" data-duration="2" data-part="lower" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="A‚ô≠2" data-duration="2" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="3" data-pitch="G2" data-duration="2" data-part="lower" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="G2" data-duration="2" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
        </div>
        <div data-duration="4">
            <p data-beat="1" data-duration="2">win-</p>
            <p data-beat="1" data-duration="2">C<sup>7</sup><span>‚ô≠</span><sup>9</sup></p>
            <svg data-beat="1" data-pitch="B‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="B‚ô≠4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="B‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="1" data-pitch="F‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="F‚ô≠4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="F‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <p data-beat="3" data-duration="2">ter,</p>
            <p data-beat="3" data-duration="1">F-<sup>7</sup></p>
            <svg data-beat="3" data-pitch="A‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="3" data-pitch="A‚ô≠4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="A‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="3" data-pitch="E‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="3" data-pitch="E‚ô≠4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="E‚ô≠4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="3" data-pitch="C4" preserveAspectRatio="xMidYMin" viewBox="0 -0.5 4.4 1" style="height: calc(1 * var(--y-size));"><use x="0" y="-8" href="#ledges"></use></svg>
            <svg data-beat="3" data-pitch="C4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="C4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <p data-beat="4" data-duration="1">A<span>‚ô≠</span><sup>7</sup><sub>sus</sub></p>
            <svg data-beat="4" data-pitch="G‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="4" data-pitch="G‚ô≠4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="4" data-pitch="G‚ô≠4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="4" data-pitch="E‚ô≠4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="4" data-pitch="E‚ô≠4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="1" data-pitch="C3" data-duration="2" data-part="lower" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="C3" data-duration="2" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="3" data-pitch="F2" data-duration="1" data-part="lower" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="F2" data-duration="1" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="4" data-pitch="A‚ô≠2" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="4" data-pitch="A‚ô≠2" data-duration="1" data-part="lower" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="4" data-pitch="A‚ô≠2" data-duration="1" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
        </div>
        <div data-duration="4">
            <p data-beat="1" data-duration="1.5">Frost-</p>
            <p data-beat="1" data-duration="2">D<span>‚ô≠</span><sub>maj</sub></p>
            <svg data-beat="1" data-pitch="B‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="B‚ô≠4" data-duration="1.5" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="B‚ô≠4" data-duration="1.5" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1.5]"></use></svg>
            <svg data-beat="1" data-pitch="F4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="F4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="1" data-pitch="C4" preserveAspectRatio="xMidYMin" viewBox="0 -0.5 4.4 1" style="height: calc(1 * var(--y-size));"><use x="0" y="-8" href="#ledges"></use></svg>
            <svg data-beat="1" data-pitch="C4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="C4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <p data-beat="2.5" data-duration="0.5">y</p>
            <svg data-beat="2.5" data-pitch="C5" data-duration="0.5" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemdown"></use></svg>
            <svg data-beat="2.5" data-pitch="C5" data-duration="0.5" preserveAspectRatio="xMidYMid" viewBox="0 -1 2.7 2"><use href="#taildown[0.5]"></use></svg>
            <svg data-beat="2.5" data-pitch="C5" data-duration="0.5" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[0.5]"></use></svg>
            <p data-beat="3" data-duration="0.5">wind</p>
            <p data-beat="3" data-duration="2">B<span>‚ô≠</span>/D</p>
            <svg data-beat="3" data-pitch="B‚ô≠4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="B‚ô≠4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="3" data-pitch="F4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="F4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="3" data-pitch="C4" preserveAspectRatio="xMidYMin" viewBox="0 -0.5 4.4 1" style="height: calc(1 * var(--y-size));"><use x="0" y="-8" href="#ledges"></use></svg>
            <svg data-beat="3" data-pitch="C4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="C4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <p data-beat="4" data-duration="0.5">made</p>
            <svg data-beat="4" data-pitch="F4" data-duration="1" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="4" data-pitch="F4" data-duration="1" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[1]"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠3" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠3" data-duration="2" data-part="lower" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠3" data-duration="2" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="3" data-pitch="D3" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 1.8 4"><use href="#acci-natural"></use></svg>
            <svg data-beat="3" data-pitch="D3" data-duration="2" data-part="lower" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="D3" data-duration="2" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
        </div>
        <div data-duration="4">
            <p data-beat="1" data-duration="4">moan‚Äì</p>
            <p data-beat="1" data-duration="2">E<span>‚ô≠</span><sup>7</sup><sub>sus</sub><span>‚ô≠</span><sup>9</sup></p>
            <svg data-beat="1" data-pitch="A‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2.3 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="A‚ô≠4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="A‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="1" data-pitch="E4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="E4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2.3 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠4" preserveAspectRatio="xMidYMin" viewBox="0 -0.5 4.4 1" style="height: calc(1 * var(--y-size));"><use x="0" y="-8" href="#ledges"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="1" data-pitch="D‚ô≠4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <p data-beat="3" data-duration="2">C/E<span>‚ô≠</span></p>
            <svg data-beat="3" data-pitch="G4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 1.8 4"><use href="#acci-natural"></use></svg>
            <svg data-beat="3" data-pitch="G4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="G4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="3" data-pitch="E4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="E4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="3" data-pitch="C4" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 1.8 4"><use href="#acci-natural"></use></svg>
            <svg data-beat="3" data-pitch="C4" preserveAspectRatio="xMidYMin" viewBox="0 -0.5 4.4 1" style="height: calc(1 * var(--y-size));"><use x="0" y="-8" href="#ledges"></use></svg>
            <svg data-beat="3" data-pitch="C4" data-duration="2" preserveAspectRatio="none" viewBox="0 0 2.7 7" style="--beam-y: 0;"><use href="#stemup"></use></svg>
            <svg data-beat="3" data-pitch="C4" data-duration="2" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[2]"></use></svg>
            <svg data-beat="1" data-pitch="E‚ô≠3" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -4 2.3 4"><use href="#acci-flat"></use></svg>
            <svg data-beat="1" data-pitch="E‚ô≠3" data-duration="4" data-part="lower" preserveAspectRatio="xMidYMid slice" viewBox="0 -1 2.7 2"><use href="#head[4]"></use></svg>
        </div>
    </div>

    <h3>But what about those beams?</h3>

    <p>Beams, chords and some of the longer rests are made to span columns by
    mapping their <code>data-duration</code> attributes to <code>grid-column-end</code>
    span values:</p>

    <pre><code>
    .stave &gt; [data-duration=&#34;0.25&#34;] { grid-column-end: span 6; }
    .stave &gt; [data-duration=&#34;0.5&#34;]  { grid-column-end: span 12; }
    .stave &gt; [data-duration=&#34;0.75&#34;] { grid-column-end: span 18; }
    .stave &gt; [data-duration=&#34;1&#34;]    { grid-column-end: span 24; }
    .stave &gt; [data-duration=&#34;1.25&#34;] { grid-column-end: span 30; }
    ...
    </code></pre>

    <p>Simple as, bru.</p>

    <h3>Sizing</h3>

    <p>Lastly, the whole system is sized in <code>em</code>, so to scale it we
    simply change the <code>font-size</code>:</p>

    <scribe-music type="sequence" clef="treble">
        0   meter 2 1
        0   E4    1 0.5
        1   B4    1 0.5
        2   Bb4   1 2
    </scribe-music>

    <h3>Limits of Flex and Grid</h3>
    <p>Is it the perfect system? Honestly, I&#39;m quietly gobsmacked that it works
    so well, but if we are looking for caveats‚Ä¶ <strong>1.</strong> CSS cannot
    automatically position a new clef/key signature at the beginning of each
    wrapped line, or <strong>2.</strong> tie a head to a new head on a new line.
    And <strong>3.</strong>, angled beams are a whole story onto themselves;
    1/16th and 1/32nd note beams are hard to align because we cannot know precisely
    where their stems are until after the Grid has laid them out:</p>

    

    <p>So it&#39;s going to need a bit of tidy-up JavaScript to finish
    the job completely, but CSS shoulders the bulk of the layout work here, and
    that means far less layout work to do in JavaScript.</p>

    <h2>Let me know what you think</h2>

    <p>If you like this CSS system or this blog post, or if you can see how to make
    improvements, please do let me know. I&#39;m on Bluesky
    <a href="https://bsky.app/profile/stephen.band">@stephen.band</a>,
    Mastodon
    <a href="https://front-end.social/@stephband">@stephband@front-end.social</a>,
    and Twitter (still, just about)
    <a href="https://twitter.com/stephband">@stephband</a>.
    Or join me in making this in the Scribe repo...</p>
</section>

<section>
    <header>
        <h2><code>&lt;scribe-music&gt;</code></h2>
        <p>A custom element for rendering music</p>
    </header>

    

    <p>I have written an interpreter around this new CSS system and wrapped that up
    in the element <code>&lt;scribe-music&gt;</code>. It&#39;s nowhere near production-ready,
    but as it is already capable of rendering a <a href="https://stephen.band/scribe/dolphin-dance.html">responsive lead sheet</a>
    and notating drums I think it&#39;s interesting and useful.</p>

    <h3>Whazzitdo?</h3>

    <p>The <code>&lt;scribe-music&gt;</code> element renders music notation
    from data found in it&#39;s content:</p>

    <pre><code>
        &lt;scribe-music type=&#34;sequence&#34;&gt;
            0 chord D maj 4
            0 F#5 0.2 4
            0 A4  0.2 4
            0 D4  0.2 4
        &lt;/scribe-music&gt;
    </code></pre>

    <scribe-music type="sequence" clef="treble">
        0 chord Dmaj 4
        0 F#5 0.2 4
        0 A4  0.2 4
        0 D4  0.2 4
    </scribe-music>

    <p>Or from a file fetched by its <code>src</code> attribute, such as this JSON:</p>

    <pre><code>
        &lt;scribe-music
            clef=&#34;drums&#34;
            type=&#34;application/json&#34;
            src=&#34;/static/blog/printing-music/data/caravan.json&#34;&gt;
        &lt;/scribe-music&gt;
    </code></pre>

    <scribe-music type="application/json" clef="drums" src="/static/blog/printing-music/data/caravan.json"></scribe-music>

    <p>Or from a JS object set on the element&#39;s <code>.data</code> property.</p>
    <p>There&#39;s some basic documentation about all that in the <a href="https://github.com/stephband/scribe/">README</a>.</p>

    <h3>Try it out</h3>
    <p>You can try the current development build by importing these files in a web page:</p>
    <pre><code>
        &lt;link rel=&#34;stylesheet&#34; href=&#34;https://stephen.band/scribe/scribe-music/module.css&#34; /&gt;
        &lt;script type=&#34;module&#34; src=&#34;https://stephen.band/scribe/scribe-music/module.js&#34;&gt;&lt;/script&gt;
    </code></pre>

    <p>As I said, it&#39;s in development. Asides from some immediate improvements I
    can make to Scribe 0.3, like tuning the autospeller, fixing the 1/16th-note
    beams and detecting and displaying tuplets, some longer-term features I would
    like to investigate are:</p>

    <ul>
        <li><strong>Support for <a href="https://www.smufl.org/fonts/">SMuFL fonts</a></strong> ‚Äì
        changing the font used for notation symbols. So far I have not been able to display their
        extended character sets reliably cross-browser.</li>
        <li><strong>Support for nested sequences</strong> ‚Äì enabling multi-part tunes.</li>
        <li><strong>Split-stave rendering</strong> ‚Äì placing multiple parts on one stave. The mechanics for this are already half in place ‚Äì the drums stave and piano stave currently auto-split by pitch.</li>
        <li><strong>Multi-stave rendering</strong> ‚Äì placing multiple parts on multiple, aligned, staves.</li>
    </ul>

    <p>I leave you with a transposable lead sheet for Dolphin Dance, rendered by <code>&lt;scribe-music&gt;</code>:</p>
</section>

<section>
    

    <header>
        
        
        <form>
            <label for="select-transpose">Transpose:</label>
            
        </form>
    </header>

    <scribe-music type="application/json" clef="treble" id="dolphin-dance">[
    [0,   &#34;chord&#34;, &#34;C&#34;,  &#34;‚àÜ&#34;, 4],
    [4,   &#34;chord&#34;, &#34;G&#34;,  &#34;-&#34;, 4],
    [8,   &#34;chord&#34;, &#34;C&#34;,  &#34;‚àÜ&#34;, 4],
    [12,  &#34;chord&#34;, &#34;B&#34;,  &#34;√∏&#34;, 2],
    [14,  &#34;chord&#34;, &#34;E&#34;,  &#34;7alt&#34;, 2],
    [16,  &#34;chord&#34;, &#34;A&#34;,  &#34;-&#34;, 4],
    [20,  &#34;chord&#34;, &#34;F&#34;,  &#34;‚àÜ(‚ôØ11)&#34;, 2],
    [22,  &#34;chord&#34;, &#34;E&#34;,  &#34;7alt&#34;, 2],
    [24,  &#34;chord&#34;, &#34;A&#34;,  &#34;-&#34;, 4],
    [28,  &#34;chord&#34;, &#34;F‚ôØ&#34;, &#34;-7&#34;, 2],
    [30,  &#34;chord&#34;, &#34;B&#34;,  &#34;7&#34;, 2],
    [32,  &#34;chord&#34;, &#34;E&#34;,  &#34;‚àÜ&#34;, 4],
    [36,  &#34;chord&#34;, &#34;F&#34;,  &#34;-7&#34;, 4],
    [40,  &#34;chord&#34;, &#34;D&#34;,  &#34;-7&#34;, 6],
    [46,  &#34;chord&#34;, &#34;E&#34;,  &#34;7alt&#34;, 2],
    [48,  &#34;chord&#34;, &#34;A&#34;,  &#34;-7&#34;, 8],
    [56,  &#34;chord&#34;, &#34;F‚ôØ&#34;, &#34;-7&#34;, 4],
    [60,  &#34;chord&#34;, &#34;B&#34;,  &#34;7&#34;, 4],
    [64,  &#34;chord&#34;, &#34;E&#34;,  &#34;‚àÜ&#34;, 4],
    [68,  &#34;chord&#34;, &#34;E&#34;,  &#34;7sus&#34;, 4],
    [72,  &#34;chord&#34;, &#34;E&#34;,  &#34;‚àÜ‚ôØ11&#34;, 4],
    [76,  &#34;chord&#34;, &#34;E&#34;,  &#34;7sus&#34;, 4],
    [80,  &#34;chord&#34;, &#34;D&#34;,  &#34;7sus&#34;, 4],
    [84,  &#34;chord&#34;, &#34;D&#34;,  &#34;‚àÜ‚ôØ11&#34;, 4],
    [88,  &#34;chord&#34;, &#34;D&#34;,  &#34;7sus&#34;, 4],
    [92,  &#34;chord&#34;, &#34;C‚ôØ&#34;, &#34;-7&#34;, 2],
    [94,  &#34;chord&#34;, &#34;F‚ôØ&#34;, &#34;7&#34;, 2],
    [96,  &#34;chord&#34;, &#34;C&#34;,  &#34;7‚ôØ11&#34;, 4],
    [100, &#34;chord&#34;, &#34;F‚ôØ&#34;, &#34;-7&#34;, 2],
    [102, &#34;chord&#34;, &#34;B&#34;,  &#34;7&#34;, 2],
    [104, &#34;chord&#34;, &#34;G‚ôØ&#34;, &#34;-7&#34;, 2],
    [108, &#34;chord&#34;, &#34;C‚ôØ&#34;, &#34;7&#34;, 2],
    [110, &#34;chord&#34;, &#34;B&#34;,  &#34;-7&#34;, 2],
    [112, &#34;chord&#34;, &#34;B‚ô≠&#34;, &#34;-7&#34;, 4],
    [116, &#34;chord&#34;, &#34;E‚ô≠&#34;, &#34;7&#34;, 4],
    [120, &#34;chord&#34;, &#34;C‚ôØ&#34;, &#34;-7&#34;, 4],
    [124, &#34;chord&#34;, &#34;C‚ôØ&#34;, &#34;-‚ô≠6&#34;, 4],
    [128, &#34;chord&#34;, &#34;C‚ôØ&#34;, &#34;-7&#34;, 4],
    [132, &#34;chord&#34;, &#34;C‚ôØ&#34;, &#34;-‚ô≠6&#34;, 4],
    [136, &#34;chord&#34;, &#34;C&#34;,  &#34;7sus&#34;, 4],
    [140, &#34;chord&#34;, &#34;C&#34;,  &#34;‚àÜ‚ô≠6&#34;, 4],
    [144, &#34;chord&#34;, &#34;C&#34;,  &#34;7sus‚ô≠9&#34;, 4],
    [148, &#34;chord&#34;, &#34;E&#34;,  &#34;7alt&#34;, 4],
    [2,      &#34;note&#34;, 76, 0.25, 0.5],
    [2.5,    &#34;note&#34;, 77, 0.25, 0.5],
    [3,      &#34;note&#34;, 79, 0.25, 0.5],
    [3.5,    &#34;note&#34;, 74, 0.25, 3.5],
    [10,     &#34;note&#34;, 76, 0.25, 0.5],
    [10.5,   &#34;note&#34;, 77, 0.25, 0.5],
    [11,     &#34;note&#34;, 79, 0.25, 0.5],
    [11.5,   &#34;note&#34;, 74, 0.25, 3.5],
    [18,     &#34;note&#34;, 72, 0.25, 0.5],
    [18.5,   &#34;note&#34;, 74, 0.25, 1],
    [19.5,   &#34;note&#34;, 76, 0.25, 0.5],
    [20,     &#34;note&#34;, 71, 0.25, 1],
    [21,     &#34;note&#34;, 71, 0.25, 2],
    [26,     &#34;note&#34;, 72, 0.25, 0.5],
    [26.5,   &#34;note&#34;, 74, 0.25, 0.5],
    [27,     &#34;note&#34;, 76, 0.25, 0.5],
    [27.5,   &#34;note&#34;, 71, 0.25, 3.5],
    [31,     &#34;note&#34;, 69, 0.25, 1],
    [32,     &#34;note&#34;, 68, 0.25, 1.5],
    [33.5,   &#34;note&#34;, 75, 0.25, 2.5],
    [36,     &#34;note&#34;, 75, 0.25, 1.5],
    [37.5,   &#34;note&#34;, 75, 0.25, 0.5],
    [38,     &#34;note&#34;, 77, 0.25, 0.5],
    [38.5,   &#34;note&#34;, 75, 0.25, 0.5],
    [39,     &#34;note&#34;, 77, 0.25, 0.5],
    [39.5,   &#34;note&#34;, 79, 0.25, 4.5],
    [48,     &#34;note&#34;, 76, 0.25, 1.5],
    [49.5,   &#34;note&#34;, 79, 0.25, 2.5],
    [52,     &#34;note&#34;, 79, 0.25, 1],
    [53,     &#34;note&#34;, 79, 0.25, 0.5],
    [53.5,   &#34;note&#34;, 79, 0.25, 0.5],
    [54,     &#34;note&#34;, 81, 0.25, 0.5],
    [54.5,   &#34;note&#34;, 79, 0.25, 0.5],
    [55,     &#34;note&#34;, 81, 0.25, 0.5],
    [55.5,   &#34;note&#34;, 83, 0.25, 4.5],
    [66,     &#34;note&#34;, 80, 0.25, 0.5],
    [66.5,   &#34;note&#34;, 81, 0.25, 0.5],
    [67,     &#34;note&#34;, 83, 0.25, 0.5],
    [67.5,   &#34;note&#34;, 78, 0.25, 3.5],
    [74,     &#34;note&#34;, 76, 0.25, 0.5],
    [74.5,   &#34;note&#34;, 78, 0.25, 0.5],
    [75,     &#34;note&#34;, 80, 0.25, 0.5],
    [75.5,   &#34;note&#34;, 74, 0.25, 3.5],
    [82,     &#34;note&#34;, 72, 0.25, 0.5],
    [82.5,   &#34;note&#34;, 74, 0.25, 1],
    [83.5,   &#34;note&#34;, 76, 0.25, 0.5],
    [84,     &#34;note&#34;, 71, 0.25, 1],
    [85,     &#34;note&#34;, 71, 0.25, 2],
    [90,     &#34;note&#34;, 72, 0.25, 0.5],
    [90.5,   &#34;note&#34;, 74, 0.25, 1],
    [91,     &#34;note&#34;, 76, 0.25, 0.5],
    [91.5,   &#34;note&#34;, 78, 0.25, 4.5],
    [96,     &#34;note&#34;, 78, 0.25, 0.5],
    [96.5,   &#34;note&#34;, 79, 0.25, 0.5],
    [97.5,   &#34;note&#34;, 78, 0.25, 0.25],
    [97.75,  &#34;note&#34;, 77, 0.25, 0.25],
    [98,     &#34;note&#34;, 78, 0.25, 1],
    [99,     &#34;note&#34;, 78, 0.25, 0.5],
    [99.5,   &#34;note&#34;, 83, 0.25, 0.5],
    [100.5,  &#34;note&#34;, 80, 0.25, 3.5],
    [104,    &#34;note&#34;, 80, 0.25, 0.5],
    [104.5,  &#34;note&#34;, 82, 0.25, 0.5],
    [105.5,  &#34;note&#34;, 80, 0.25, 0.25],
    [105.75, &#34;note&#34;, 78, 0.25, 0.25],
    [106,    &#34;note&#34;, 80, 0.25, 1],
    [107,    &#34;note&#34;, 80, 0.25, 0.5],
    [107.5,  &#34;note&#34;, 85, 0.25, 2.5],
    [110,    &#34;note&#34;, 86, 0.25, 2],
    [112,    &#34;note&#34;, 87, 0.25, 1.5],
    [113.5,  &#34;note&#34;, 85, 0.25, 1],
    [114.5,  &#34;note&#34;, 80, 0.25, 1],
    [115.5,  &#34;note&#34;, 77, 0.25, 0.5],
    [116,    &#34;note&#34;, 84, 0.25, 3],
    [119,    &#34;note&#34;, 75, 0.25, 0.5],
    [119.5,  &#34;note&#34;, 80, 0.25, 8.5],
    [138,    &#34;note&#34;, 81, 0.25, 0.5],
    [138.5,  &#34;note&#34;, 82, 0.25, 0.5],
    [139,    &#34;note&#34;, 84, 0.25, 0.5],
    [139.5,  &#34;note&#34;, 79, 0.25, 3.5],
    [146,    &#34;note&#34;, 76, 0.25, 0.5],
    [146.5,  &#34;note&#34;, 77, 0.25, 0.5],
    [147,    &#34;note&#34;, 79, 0.25, 0.5],
    [147.5,  &#34;note&#34;, 74, 0.25, 3.5]
    ]</scribe-music>
</section>



</div></div>
  </body>
</html>
