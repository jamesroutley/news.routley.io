<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bun.com/blog/bun-v1.3.9">Original</a>
    <h1>Bun v1.3.9</h1>
    
    <div id="readability-page-1" class="page"><article><h4 level="4" id="to-install-bun">To install Bun</h4><div id="vExcMnYuJC"><div><div><p>curl</p><div><div id="AGtzSmTxVytI:0"><pre><code><span><span>curl -fsSL https://bun.sh/install </span><span>|</span><span> bash</span></span></code></pre></div></div></div></div><div><div><p>npm</p><div><div id="JJTvgCZgqmHE:0"><pre><code><span><span>npm install -g bun</span></span></code></pre></div></div></div></div><div><div><p>powershell</p><div><div id="SWEEPxRmUlJx:0"><pre><code><span><span>powershell -c </span><span>&#34;</span><span>irm bun.sh/install.ps1|iex</span><span>&#34;</span></span></code></pre></div></div></div></div><div><div><p>scoop</p><div><div id="jPsixfOyoayT:0"><pre><code><span><span>scoop install bun</span></span></code></pre></div></div></div></div><div><div><p>brew</p><div><div id="ASXeePygheWq:0"><pre><code><span><span>brew tap oven-sh/bun</span></span></code></pre></div></div><div><div id="ASXeePygheWq:1"><pre><code><span><span>brew install bun</span></span></code></pre></div></div></div></div><div><div><p>docker</p><div><div id="nUsLoWoLifHP:0"><pre><code><span><span>docker pull oven/bun</span></span></code></pre></div></div><div><div id="nUsLoWoLifHP:1"><pre><code><span><span>docker run --rm --init --ulimit memlock=-1:-1 oven/bun</span></span></code></pre></div></div></div></div></div><h4 level="4" id="to-upgrade-bun">To upgrade Bun</h4><div><div><div id="dCJxYQOEnzJF:0"><pre><code><span><span>bun upgrade</span></span></code></pre></div></div></div><h2 level="2" anchor-id="bun-run-parallel-and-bun-run-sequential" id="bun-run-parallel-and-bun-run-sequential"><a name="bun-run-parallel-and-bun-run-sequential"></a><a href="#bun-run-parallel-and-bun-run-sequential"><code>bun run --parallel</code> and <code>bun run --sequential</code></a></h2><p>Run multiple package.json scripts concurrently or sequentially with Foreman-style prefixed output. Includes full <code>--filter</code> and <code>--workspaces</code> integration for running scripts in parallel or sequential across workspace packages.</p><div><div><div id="IrWbLOEouIOC:0"><pre><code><span><span># Run &#34;build&#34; and &#34;test&#34; concurrently from the current package.json</span></span>
<span><span>bun run --parallel build </span><span>test</span></span>
<span></span>
<span><span># Run &#34;build&#34; and &#34;test&#34; sequentially with prefixed output</span></span>
<span><span>bun run --sequential build </span><span>test</span></span>
<span></span>
<span><span># Glob-matched script names</span></span>
<span><span>bun run --parallel </span><span>&#34;</span><span>build:*</span><span>&#34;</span></span>
<span></span>
<span><span># Run &#34;build&#34; in all workspace packages concurrently</span></span>
<span><span>bun run --parallel --filter </span><span>&#39;</span><span>*</span><span>&#39;</span><span> build</span></span>
<span></span>
<span><span># Run &#34;build&#34; in all workspace packages sequentially</span></span>
<span><span>bun run --sequential --workspaces build</span></span>
<span></span>
<span><span># Multiple scripts across all packages</span></span>
<span><span>bun run --parallel --filter </span><span>&#39;</span><span>*</span><span>&#39;</span><span> build lint </span><span>test</span></span>
<span></span>
<span><span># Continue running even if one package fails</span></span>
<span><span>bun run --parallel --no-exit-on-error --filter </span><span>&#39;</span><span>*</span><span>&#39;</span><span> </span><span>test</span></span>
<span></span>
<span><span># Skip packages missing the script</span></span>
<span><span>bun run --parallel --workspaces --if-present build</span></span>
<span></span></code></pre></div></div></div><p>Each line of output is prefixed with a colored, padded label so you can tell which script produced it:</p><div><div><div id="uCdgjrUGBgUk:0"><pre><code><span><span>build | compiling...</span></span>
<span><span>test  | running suite...</span></span>
<span><span>lint  | checking files...</span></span>
<span><span></span></span></code></pre></div></div></div><p>When combined with <code>--filter</code> or <code>--workspaces</code>, labels include the package name:</p><div><div><div id="mLDHHZvLvcqF:0"><pre><code><span><span>pkg-a:build | compiling...</span></span>
<span><span>pkg-b:build | compiling...</span></span>
<span><span></span></span></code></pre></div></div></div><p><strong><code>--parallel</code></strong> starts all scripts immediately with interleaved, prefixed output. <strong><code>--sequential</code></strong> runs scripts one at a time in order. By default, a failure in any script kills all remaining scripts — use <code>--no-exit-on-error</code> to let them all finish.</p><p>Pre/post scripts (<code>prebuild</code>/<code>postbuild</code>) are automatically grouped with their main script and run in the correct dependency order within each group.</p><h3 level="3" anchor-id="how-is-this-different-from-filter" id="how-is-this-different-from-filter"><a name="how-is-this-different-from-filter"></a><a href="#how-is-this-different-from-filter">How is this different from <code>--filter?</code></a></h3><p><code>bun --filter=&#34;pkg&#34; &lt;script&gt;</code> respects dependency order. It doesn&#39;t start a script until all it&#39;s dependendents are also run. This can be an issue when using long-lived watch-like scripts. <code>--parallel</code> and <code>--sequential</code> do not respect dependency order so they won&#39;t wait.</p><h2 level="2" anchor-id="http-2-connection-upgrades-via-net-server" id="http-2-connection-upgrades-via-net-server"><a name="http-2-connection-upgrades-via-net-server"></a><a href="#http-2-connection-upgrades-via-net-server">HTTP/2 Connection Upgrades via <code>net.Server</code></a></h2><p>The <code>net.Server → Http2SecureServer</code> connection upgrade pattern now works correctly. This pattern is used by libraries like <a href="https://github.com/szmarczak/http2-wrapper">http2-wrapper</a>, <a href="https://github.com/apify/crawlee">crawlee</a>, and custom HTTP/2 proxy servers that accept raw TCP connections on a <code>net.Server</code> and forward them to an <code>Http2SecureServer</code> via <code>h2Server.emit(&#39;connection&#39;, rawSocket)</code>.</p><div><div><div id="jfMKWnhkUuuK:0"><pre><code><span><span>import</span><span> { createServer } </span><span>from</span><span> </span><span>&#34;</span><span>node:net</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> { createSecureServer } </span><span>from</span><span> </span><span>&#34;</span><span>node:http2</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> { readFileSync } </span><span>from</span><span> </span><span>&#34;</span><span>node:fs</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> h2Server </span><span>=</span><span> </span><span>createSecureServer</span><span>({</span></span>
<span><span>  key</span><span>:</span><span> </span><span>readFileSync</span><span>(</span><span>&#34;</span><span>key.pem</span><span>&#34;</span><span>),</span></span>
<span><span>  cert</span><span>:</span><span> </span><span>readFileSync</span><span>(</span><span>&#34;</span><span>cert.pem</span><span>&#34;</span><span>),</span></span>
<span><span>});</span></span>
<span></span>
<span><span>h2Server.</span><span>on</span><span>(</span><span>&#34;</span><span>stream</span><span>&#34;</span><span>, (</span><span>stream</span><span>, </span><span>headers</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  stream.</span><span>respond</span><span>({ </span><span>&#34;</span><span>:status</span><span>&#34;</span><span>:</span><span> </span><span>200</span><span> });</span></span>
<span><span>  stream.</span><span>end</span><span>(</span><span>&#34;</span><span>Hello over HTTP/2!</span><span>&#34;</span><span>);</span></span>
<span><span>});</span></span>
<span></span>
<span><span>const</span><span> netServer </span><span>=</span><span> </span><span>createServer</span><span>((</span><span>rawSocket</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>// Forward the raw TCP connection to the HTTP/2 server</span></span>
<span><span>  h2Server.</span><span>emit</span><span>(</span><span>&#34;</span><span>connection</span><span>&#34;</span><span>, rawSocket);</span></span>
<span><span>});</span></span>
<span></span>
<span><span>netServer.</span><span>listen</span><span>(</span><span>8443</span><span>);</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="symbol-dispose-support-for-mock-and-spyon" id="symbol-dispose-support-for-mock-and-spyon"><a name="symbol-dispose-support-for-mock-and-spyon"></a><a href="#symbol-dispose-support-for-mock-and-spyon"><code>Symbol.dispose</code> support for <code>mock()</code> and <code>spyOn()</code></a></h2><p><code>mock()</code> and <code>spyOn()</code> now implement <code>Symbol.dispose</code>, enabling the <code>using</code> keyword to automatically restore mocks when they go out of scope. This eliminates the need to manually call <code>mockRestore()</code> or rely on <code>afterEach</code> cleanup.</p><div><div><div id="VZrFRsEqdQXD:0"><pre><code><span><span>import</span><span> { spyOn, expect, test } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>auto-restores spy</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>const</span><span> obj </span><span>=</span><span> { </span><span>method</span><span>:</span><span> () </span><span>=&gt;</span><span> </span><span>&#34;</span><span>original</span><span>&#34;</span><span> };</span></span>
<span></span>
<span><span>  {</span></span>
<span><span>    using spy </span><span>=</span><span> </span><span>spyOn</span><span>(obj, </span><span>&#34;</span><span>method</span><span>&#34;</span><span>).</span><span>mockReturnValue</span><span>(</span><span>&#34;</span><span>mocked</span><span>&#34;</span><span>);</span></span>
<span><span>    </span><span>expect</span><span>(obj.</span><span>method</span><span>()).</span><span>toBe</span><span>(</span><span>&#34;</span><span>mocked</span><span>&#34;</span><span>);</span></span>
<span><span>  }</span></span>
<span></span>
<span><span>  </span><span>// automatically restored when `spy` leaves scope</span></span>
<span><span>  </span><span>expect</span><span>(obj.</span><span>method</span><span>()).</span><span>toBe</span><span>(</span><span>&#34;</span><span>original</span><span>&#34;</span><span>);</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p><code>[Symbol.dispose]</code> is aliased to <code>mockRestore</code>, so it works with both <code>spyOn()</code> and <code>mock()</code>:</p><div><div><div id="VFuXysxHAADy:0"><pre><code><span><span>import</span><span> { mock } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> fn </span><span>=</span><span> </span><span>mock</span><span>(() </span><span>=&gt;</span><span> </span><span>&#34;</span><span>original</span><span>&#34;</span><span>);</span></span>
<span><span>fn</span><span>();</span></span>
<span><span>expect</span><span>(fn).</span><span>toHaveBeenCalledTimes</span><span>(</span><span>1</span><span>);</span></span>
<span></span>
<span><span>fn[</span><span>Symbol</span><span>.dispose](); </span><span>// same as fn.mockRestore()</span></span>
<span><span>expect</span><span>(fn).</span><span>toHaveBeenCalledTimes</span><span>(</span><span>0</span><span>);</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="no-proxy-now-respected-for-explicit-proxy-options" id="no-proxy-now-respected-for-explicit-proxy-options"><a name="no-proxy-now-respected-for-explicit-proxy-options"></a><a href="#no-proxy-now-respected-for-explicit-proxy-options"><code>NO_PROXY</code> now respected for explicit proxy options</a></h2><p>Previously, setting <code>NO_PROXY</code> only worked when the proxy was auto-detected from <code>http_proxy</code>/<code>HTTP_PROXY</code> environment variables. If you explicitly passed a <code>proxy</code> option to <code>fetch()</code> or <code>new WebSocket()</code>, the <code>NO_PROXY</code> environment variable was ignored.</p><p>Now, <code>NO_PROXY</code> is always checked — even when a proxy is explicitly provided via the <code>proxy</code> option.</p><div><div><div id="sfHZvxetGMAT:0"><pre><code><span><span>// NO_PROXY=localhost</span></span>
<span><span>// Previously, this would still use the proxy. Now it correctly bypasses it.</span></span>
<span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>http://localhost:3000/api</span><span>&#34;</span><span>, {</span></span>
<span><span>  proxy</span><span>:</span><span> </span><span>&#34;</span><span>http://my-proxy:8080</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span>
<span><span>// Same fix applies to WebSocket</span></span>
<span><span>const</span><span> ws </span><span>=</span><span> </span><span>new</span><span> </span><span>WebSocket</span><span>(</span><span>&#34;</span><span>ws://localhost:3000/ws</span><span>&#34;</span><span>, {</span></span>
<span><span>  proxy</span><span>:</span><span> </span><span>&#34;</span><span>http://my-proxy:8080</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="cpu-prof-interval-flag" id="cpu-prof-interval-flag"><a name="cpu-prof-interval-flag"></a><a href="#cpu-prof-interval-flag"><code>--cpu-prof-interval</code> flag</a></h2><p>Bun now supports the <code>--cpu-prof-interval</code> flag to configure the CPU profiler&#39;s sampling interval in microseconds, matching Node.js&#39;s flag of the same name. The default interval is 1000μs (1ms).</p><div><div><div id="aeRHTQgLRoNv:0"><pre><code><span><span># Sample every 500μs for higher resolution profiling</span></span>
<span><span>bun --cpu-prof --cpu-prof-interval 500 index.js</span></span>
<span></span></code></pre></div></div></div><p>If used without <code>--cpu-prof</code> or <code>--cpu-prof-md</code>, Bun will emit a warning.</p><h2 level="2" anchor-id="esm-bytecode-in-compile" id="esm-bytecode-in-compile"><a name="esm-bytecode-in-compile"></a><a href="#esm-bytecode-in-compile">ESM bytecode in <code>--compile</code></a></h2><p>Using <code>--bytecode</code> with <code>--format=esm</code> is now supported. Previously, this was unsupported due to missing functionality in JavaScriptCore and now it&#39;s fully supported.</p><p>When <code>--bytecode</code> is used without an explicit <code>--format</code>, it continues to default to CommonJS. In a future version of Bun, we may change that default to ESM to make the behavior more consistent.</p><p>Thanks to @alistair!</p><h2 level="2" anchor-id="fixed-illegal-instruction-sigill-crashes-on-armv8-0-aarch64-cpus" id="fixed-illegal-instruction-sigill-crashes-on-armv8-0-aarch64-cpus"><a name="fixed-illegal-instruction-sigill-crashes-on-armv8-0-aarch64-cpus"></a><a href="#fixed-illegal-instruction-sigill-crashes-on-armv8-0-aarch64-cpus">Fixed: Illegal instruction (SIGILL) crashes on ARMv8.0 aarch64 CPUs</a></h2><p>Fixed crashes on older ARM64 processors (Cortex-A53, Raspberry Pi 4, AWS a1 instances) caused by mimalloc emitting LSE atomic instructions that require ARMv8.1 or later. Bun now correctly targets ARMv8.0 on Linux aarch64, using outline atomics for runtime dispatch.</p><h2 level="2" anchor-id="faster-markdown-to-html-rendering" id="faster-markdown-to-html-rendering"><a name="faster-markdown-to-html-rendering"></a><a href="#faster-markdown-to-html-rendering">Faster Markdown-to-HTML rendering</a></h2><p><code>Bun.Markdown</code> now uses SIMD-accelerated scanning to find characters that need HTML escaping (<code>&amp;</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&#34;</code>), resulting in <strong>3-15% faster</strong> Markdown-to-HTML rendering throughput. Larger documents with fewer special characters see the biggest gains.</p><p>Thanks to <a href="https://github.com/billywhizz">@billywhizz</a> for the contribution!</p><h2 level="2" anchor-id="faster-bun-markdown-react" id="faster-bun-markdown-react"><a name="faster-bun-markdown-react"></a><a href="#faster-bun-markdown-react">Faster <code>Bun.markdown.react()</code></a></h2><p>Cached frequently-used HTML tag strings (<code>div</code>, <code>p</code>, <code>h1</code>-<code>h6</code>, etc.) in the React renderer for <code>Bun.markdown.react()</code>, avoiding repeated string allocations on every element creation.</p><div><table><thead><tr><th>Input size</th><th>Before</th><th>After</th><th>Improvement</th></tr></thead><tbody><tr><td>Small (121 chars)</td><td>3.20 µs</td><td>2.30 µs</td><td><strong>28% faster</strong></td></tr><tr><td>Medium (1,039 chars)</td><td>15.09 µs</td><td>14.02 µs</td><td><strong>7% faster</strong></td></tr><tr><td>Large (20,780 chars)</td><td>288.48 µs</td><td>267.14 µs</td><td><strong>7.4% faster</strong></td></tr></tbody></table></div><p>String object count reduced by <strong>40%</strong> and heap size reduced by <strong>6%</strong> for a typical render.</p><h2 level="2" anchor-id="faster-abortsignal-abort-with-no-listeners" id="faster-abortsignal-abort-with-no-listeners"><a name="faster-abortsignal-abort-with-no-listeners"></a><a href="#faster-abortsignal-abort-with-no-listeners">Faster <code>AbortSignal.abort()</code> with no listeners</a></h2><p><code>AbortSignal.abort()</code> now skips creating and dispatching an <code>Event</code> object when there are no registered listeners, avoiding unnecessary object allocation and dispatch overhead. This results in a <strong>~6% improvement</strong> in micro-benchmarks (~16ms saved per 1M calls).</p><div><table><thead><tr><th>Case</th><th>Before</th><th>After</th><th>Improvement</th></tr></thead><tbody><tr><td>no listener</td><td>271 ms</td><td>255 ms</td><td>~6%</td></tr><tr><td>with listener</td><td>368 ms</td><td>370 ms</td><td>(same)</td></tr></tbody></table></div><p>Thanks to @sosukesuzuki for the contribution!</p><h2 level="2" anchor-id="javascriptcore-upgrade" id="javascriptcore-upgrade"><a name="javascriptcore-upgrade"></a><a href="#javascriptcore-upgrade">JavaScriptCore upgrade</a></h2><h3 level="3" anchor-id="regexp-simd-acceleration" id="regexp-simd-acceleration"><a name="regexp-simd-acceleration"></a><a href="#regexp-simd-acceleration">RegExp SIMD Acceleration</a></h3><p>Regular expressions got a major performance boost with a new SIMD-accelerated prefix search, inspired by V8&#39;s approach. When a regex has alternatives with known leading characters (e.g., <code>/aaaa|bbbb/</code>), JSC now uses SIMD instructions to scan 16 bytes at a time, rapidly rejecting non-matching positions before falling back to scalar matching. This is implemented for both ARM64 (using TBL2) and x86_64 (using PTEST), so all platforms benefit.</p><p>The x86_64 codegen also gained new constant materialization primitives (<code>move128ToVector</code>, <code>move64ToDouble</code>, <code>move32ToFloat</code>) using broadcast and shuffle instructions, which are necessary for the SIMD regex paths and future SIMD optimizations.</p><ul><li><a href="https://github.com/oven-sh/WebKit/commit/579b96614b75"><code>579b96614b75</code></a> — SIMD fast prefix search for RegExp (ARM64)</li><li><a href="https://github.com/oven-sh/WebKit/commit/b7ed3dae4a6a"><code>b7ed3dae4a6a</code></a> — SIMD fast prefix search for RegExp (x86_64)</li><li><a href="https://github.com/oven-sh/WebKit/commit/aa596dded063"><code>aa596dded063</code></a> — x86_64 constant materialization for SIMD masks</li></ul><h3 level="3" anchor-id="regexp-jit-fixed-count-parentheses" id="regexp-jit-fixed-count-parentheses"><a name="regexp-jit-fixed-count-parentheses"></a><a href="#regexp-jit-fixed-count-parentheses">RegExp JIT: Fixed-Count Parentheses</a></h3><p>Non-capturing parenthesized subpatterns with fixed-count quantifiers like <code>(?:abc){3}</code> previously fell back to the slower Yarr interpreter. They are now JIT-compiled using a counter-based loop, yielding a <strong>~3.9x speedup</strong> on affected patterns. A follow-up patch also added JIT support for fixed-count subpatterns <strong>with capture groups</strong> (e.g., <code>/(a+){2}b/</code>), correctly saving and restoring capture state across iterations.</p><ul><li><a href="https://github.com/oven-sh/WebKit/commit/ac63cc259d74"><code>ac63cc259d74</code></a> — JIT support for non-capturing fixed-count parentheses (~3.9x faster)</li><li><a href="https://github.com/oven-sh/WebKit/commit/c8b66aa0832b"><code>c8b66aa0832b</code></a> — JIT support for fixed-count subpatterns with captures</li></ul><h3 level="3" anchor-id="string-startswith-optimized-in-dfg-ftl" id="string-startswith-optimized-in-dfg-ftl"><a name="string-startswith-optimized-in-dfg-ftl"></a><a href="#string-startswith-optimized-in-dfg-ftl"><code>String#startsWith</code> Optimized in DFG/FTL</a></h3><p><code>String.prototype.startsWith</code> is now an intrinsic in the DFG and FTL JIT tiers, with constant folding support when both the string and search term are known at compile time.</p><div><table><thead><tr><th>Benchmark</th><th>Speedup</th></tr></thead><tbody><tr><td><code>string-prototype-startswith</code></td><td><strong>1.42x faster</strong></td></tr><tr><td><code>string-prototype-startswith-constant-folding</code></td><td><strong>5.76x faster</strong></td></tr><tr><td><code>string-prototype-startswith-with-index</code></td><td><strong>1.22x faster</strong></td></tr></tbody></table></div><ul><li><a href="https://github.com/oven-sh/WebKit/commit/1f7d7d5a8c23"><code>1f7d7d5a8c23</code></a></li></ul><h3 level="3" anchor-id="set-size-and-map-size-optimized-in-dfg-ftl-and-inline-caches" id="set-size-and-map-size-optimized-in-dfg-ftl-and-inline-caches"><a name="set-size-and-map-size-optimized-in-dfg-ftl-and-inline-caches"></a><a href="#set-size-and-map-size-optimized-in-dfg-ftl-and-inline-caches"><code>Set#size</code> and <code>Map#size</code> Optimized in DFG/FTL and Inline Caches</a></h3><p>The <code>.size</code> getter on <code>Set</code> and <code>Map</code> is now handled as an intrinsic in the DFG/FTL tiers and inline caches, eliminating the overhead of a generic getter call.</p><div><table><thead><tr><th>Benchmark</th><th>Speedup</th></tr></thead><tbody><tr><td><code>set-size</code></td><td><strong>2.24x faster</strong></td></tr><tr><td><code>map-size</code></td><td><strong>2.74x faster</strong></td></tr></tbody></table></div><ul><li><a href="https://github.com/oven-sh/WebKit/commit/2e2c23521a24"><code>2e2c23521a24</code></a></li></ul><h3 level="3" anchor-id="string-trim-optimized" id="string-trim-optimized"><a name="string-trim-optimized"></a><a href="#string-trim-optimized"><code>String#trim</code> Optimized</a></h3><p><code>String.prototype.trim</code>, <code>trimStart</code>, and <code>trimEnd</code> now use direct pointer access via <code>span8()</code>/<code>span16()</code> instead of indirect <code>str[i]</code> character access, avoiding repeated bounds checking.</p><div><table><thead><tr><th>Benchmark</th><th>Speedup</th></tr></thead><tbody><tr><td><code>string-trim</code></td><td><strong>1.17x faster</strong></td></tr><tr><td><code>string-trim-end</code></td><td><strong>1.42x faster</strong></td></tr><tr><td><code>string-trim-start</code></td><td><strong>1.10x faster</strong></td></tr></tbody></table></div><ul><li><a href="https://github.com/oven-sh/WebKit/commit/73a97d320d4b"><code>73a97d320d4b</code></a></li></ul><h3 level="3" anchor-id="object-defineproperty-handled-in-dfg-ftl" id="object-defineproperty-handled-in-dfg-ftl"><a name="object-defineproperty-handled-in-dfg-ftl"></a><a href="#object-defineproperty-handled-in-dfg-ftl"><code>Object.defineProperty</code> Handled in DFG/FTL</a></h3><p><code>Object.defineProperty</code> is now recognized as an intrinsic in the DFG and FTL JIT tiers. While this patch alone doesn&#39;t change benchmark numbers, it lays the groundwork for future optimizations that can specialize based on descriptor shape.</p><ul><li><a href="https://github.com/oven-sh/WebKit/commit/b1703ed2b97e"><code>b1703ed2b97e</code></a></li></ul><h3 level="3" anchor-id="string-prototype-replace-returns-ropes" id="string-prototype-replace-returns-ropes"><a name="string-prototype-replace-returns-ropes"></a><a href="#string-prototype-replace-returns-ropes"><code>String.prototype.replace</code> Returns Ropes</a></h3><p>When using <code>&#34;string&#34;.replace(&#34;search&#34;, &#34;replacement&#34;)</code> with string arguments, JSC now constructs a rope (lazy concatenation) instead of eagerly copying the entire result. This avoids unnecessary allocations for the common case where the result is only used briefly. This aligns with V8&#39;s behavior.</p><ul><li><a href="https://github.com/oven-sh/WebKit/commit/69162bbdb602"><code>69162bbdb602</code></a></li></ul><h2 level="2" anchor-id="bugfixes" id="bugfixes"><a name="bugfixes"></a><a href="#bugfixes">Bugfixes</a></h2><h3 level="3" anchor-id="node-js-compatibility-improvements" id="node-js-compatibility-improvements"><a name="node-js-compatibility-improvements"></a><a href="#node-js-compatibility-improvements">Node.js compatibility improvements</a></h3><ul><li>Fixed: <code>existsSync(&#39;.&#39;)</code>, <code>statSync(&#39;.&#39;)</code>, and other <code>node:fs</code> operations incorrectly failing on Windows due to <code>&#39;.&#39;</code> being normalized to an empty string instead of the current directory.</li><li>Fixed: <code>Function.prototype.toString()</code> whitespace now matches V8/Node.js</li><li>Fixed 3 rare crashes in <code>node:http2</code></li></ul><h3 level="3" anchor-id="bun-apis" id="bun-apis"><a name="bun-apis"></a><a href="#bun-apis">Bun APIs</a></h3><ul><li>Fixed: <code>Bun.stringWidth</code> incorrectly reporting Thai SARA AA (<code>U+0E32</code>), SARA AM (<code>U+0E33</code>), and their Lao equivalents (<code>U+0EB2</code>, <code>U+0EB3</code>) as zero-width characters instead of width 1. These are spacing vowels, not combining marks, so common Thai words like <code>คำ</code> now correctly return a width of 2 instead of 1.</li></ul><h3 level="3" anchor-id="web-apis" id="web-apis"><a name="web-apis"></a><a href="#web-apis">Web APIs</a></h3><ul><li>Fixed: a crash that could occur in the <code>WebSocket</code> client when using <code>binaryType = &#34;blob&#34;</code> and receiving <code>&#34;data&#34;</code> events when no event listener attached.</li><li>Fixed: Sequential HTTP requests with proxy-style absolute URLs (e.g. <code>GET http://example.com/path HTTP/1.1</code>) hanging on the 2nd+ request when using keep-alive connections. This affected HTTP proxy servers built with Bun, which could only handle one request per connection.</li><li>Fixed: A security issue in the HTTP server chunked encoding parser that could lead to request smuggling.</li></ul><h3 level="3" anchor-id="typescript-types" id="typescript-types"><a name="typescript-types"></a><a href="#typescript-types">TypeScript types</a></h3><ul><li>Fixed: <code>Bun.Build.CompileTarget</code> TypeScript type was missing SIMD variants like <code>bun-linux-x64-modern</code>, causing type errors when cross-compiling with specific architecture targets.</li></ul><ul><li>Fixed: Missing <code>bun-linux-x64-baseline</code> and <code>bun-linux-x64-modern</code> compile target types in TypeScript definitions, which caused type errors when using <code>Bun.build()</code> with these valid targets.</li></ul><ul><li>Fixed: <code>Socket.reload()</code> TypeScript types now correctly expect <code>{ socket: handler }</code> to match runtime behavior, which requires the handler to be wrapped in a <code>socket</code> property.</li></ul><h3 level="3" anchor-id="thanks-to-10-contributors" id="thanks-to-10-contributors"><a name="thanks-to-10-contributors"></a><a href="#thanks-to-10-contributors">Thanks to 10 contributors!</a></h3><ul><li><a href="https://github.com/alii">@alii</a></li><li><a href="https://github.com/billywhizz">@billywhizz</a></li><li><a href="https://github.com/chrislloyd">@chrislloyd</a></li><li><a href="https://github.com/cirospaciari">@cirospaciari</a></li><li><a href="https://github.com/ddmoney420">@ddmoney420</a></li><li><a href="https://github.com/dylan-conway">@dylan-conway</a></li><li><a href="https://github.com/jarred-sumner">@jarred-sumner</a></li><li><a href="https://github.com/robobun">@robobun</a></li><li><a href="https://github.com/sosukesuzuki">@sosukesuzuki</a></li><li><a href="https://github.com/xingxingmofashu">@xingxingmofashu</a></li></ul></article></div>
  </body>
</html>
