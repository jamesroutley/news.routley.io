<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/R-O-C-K-E-T/Factorio-SAT">Original</a>
    <h1>Enhancing Factorio with SAT solvers</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Enhancing the Factorio experience with SAT solvers.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/R-O-C-K-E-T/Factorio-SAT/blob/main/pictures/diagram.png"><img src="https://www.mattambrogi.com/R-O-C-K-E-T/Factorio-SAT/raw/main/pictures/diagram.png" alt=""/></a></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-how-it-works" aria-hidden="true" tabindex="-1" href="#how-it-works"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>How it works</h2>
<ul dir="auto">
<li>A balancer size is selected</li>
<li>Tiles get represented as a list of boolean (true/false) variables (input direction, output direction, underground state, splitter side, splitter id, colour)</li>
<li>Clauses (rules/constraints) are written to restrict solutions to only valid balancers:
<ul dir="auto">
<li>Belts don&#39;t intersect</li>
<li>Colour along a belt is consistent</li>
<li>The ends of the balancer have the correct input/output colours</li>
<li>For each splitter in the splitter network, there are splitters in the solution that have the same input/output colours as the abstract network splitter</li>
</ul>
</li>
<li>Clauses are passed into a SAT solver which either returns the solution or proves there is no solution</li>
<li>If no solution is found then a new size is selected</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-caveats" aria-hidden="true" tabindex="-1" href="#caveats"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Caveats</h2>
<ul dir="auto">
<li>Currently uses the assumption that the inputs/outputs of the balancer need to be covered by splitters. This should result in balancers that are within 1 tile of optimal and in practice no balancers have been found that exhibit this worst case.</li>
<li>There is no proof that the clauses generated by this program are consistent with the rules of Factorio</li>
<li>Generating balancers gets exponentially harder as more splitters are added to the network. At least until someone proves P = NP</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-setup" aria-hidden="true" tabindex="-1" href="#setup"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Setup</h2>
<div dir="auto" data-snippet-clipboard-copy-content="# Create virtual environment
python -m venv .venv

# Activate environment
source .venv/bin/activate # Unix/macOS
# or
.venv\Scripts\activate # Windows
# NOTE: Activating needs to be done for every new terminal session

pip install --editable .

# Get textures
fetch_assets /path/to/factorio/install

# Factorio install directory should look something like:
# Factorio/
# ├── bin/
# ├── data/
# │   ├── base/
# │   ├── core/
# │   ...
# ..."><pre><span><span>#</span> Create virtual environment</span>
python -m venv .venv

<span><span>#</span> Activate environment</span>
<span>source</span> .venv/bin/activate <span><span>#</span> Unix/macOS</span>
<span><span>#</span> or</span>
.venv<span>\S</span>cripts<span>\a</span>ctivate <span><span>#</span> Windows</span>
<span><span>#</span> NOTE: Activating needs to be done for every new terminal session</span>

pip install --editable <span>.</span>

<span><span>#</span> Get textures</span>
fetch_assets /path/to/factorio/install

<span><span>#</span> Factorio install directory should look something like:</span>
<span><span>#</span> Factorio/</span>
<span><span>#</span> ├── bin/</span>
<span><span>#</span> ├── data/</span>
<span><span>#</span> │   ├── base/</span>
<span><span>#</span> │   ├── core/</span>
<span><span>#</span> │   ...</span>
<span><span>#</span> ...</span></pre></div>
<p dir="auto">For rendering splitter networks <code>graphviz</code> needs to be installed. This can be done via a package manager or with the lastest install package available at <a href="https://graphviz.org/download/#windows" rel="nofollow">https://graphviz.org/download/</a>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-tools" aria-hidden="true" tabindex="-1" href="#tools"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Tools</h2>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>fetch</td>
<td>Load textures (required for render.py)</td>
</tr>
<tr>
<td>blueprint</td>
<td>Import/Export blueprints</td>
</tr>
<tr>
<td>blueprint_book</td>
<td>Pack/Unpack blueprint books</td>
</tr>
<tr>
<td>render</td>
<td>Render generated balancers</td>
</tr>
<tr>
<td>network</td>
<td>Tools for managing balancer networks</td>
</tr>
<tr>
<td>belt_balancer</td>
<td>Generate balancer from a network</td>
</tr>
<tr>
<td>belt_balancer_net_free</td>
<td>Generate any n to n balancer</td>
</tr>
<tr>
<td>belt_balancer_net_free_power_of_2</td>
<td>Generates n to n balancers where n is a power of 2 (faster than generic version)</td>
</tr>
<tr>
<td>interchange</td>
<td>Generate an interchange for building composite balancers</td>
</tr>
<tr>
<td>make_block</td>
<td>Generate random blocks of belts</td>
</tr>
<tr>
<td>calculate_optimal</td>
<td>Find optimal balancers</td>
</tr>
<tr>
<td>rotate</td>
<td>Rotate a balancer 90 degrees</td>
</tr>
<tr>
<td>stringifier</td>
<td>Convert balancers to and from text</td>
</tr>
<tr>
<td>test_runner</td>
<td>Run the test suite</td>
</tr>
</tbody>
</table>
<h2 tabindex="-1" dir="auto"><a id="user-content-controls-renderpy" aria-hidden="true" tabindex="-1" href="#controls-renderpy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Controls (render.py)</h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>I</td>
<td>Go to next</td>
</tr>
<tr>
<td>K</td>
<td>Go to previous</td>
</tr>
<tr>
<td>S</td>
<td>Save animation of balancer</td>
</tr>
<tr>
<td>E</td>
<td>Export balancer as a blueprint</td>
</tr>
</tbody>
</table>
<h2 tabindex="-1" dir="auto"><a id="user-content-example-usages" aria-hidden="true" tabindex="-1" href="#example-usages"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Example Usages</h2>
<div dir="auto" data-snippet-clipboard-copy-content="# Find and render all 4 to 4 balancers that fit in a 10x4 square
belt_balancer --fast --all networks/4x4 10 4 | render

# Start computing the optimal by length with maximum underground length of 16
calculate_optimal compute 16 length

# Render optimal area balancers with maximum underground length 4
calculate_optimal query 4 area | render

# Generate and render interchanges for a 22 to 22 balancer made of two 11 to 11 balancers
interchange --alternating --underground-length 8 --all 8 22 | render

# Render a network graph
network render networks/5x5 5_to_5.png

# Save an animation of a blueprint to a file
cat blueprint.txt | blueprint decode | render --export-all

# Generate 50 random blocks and save to a blueprint book
make_block 16 16 --all --single-loop | head -n 50 | blueprint encode | blueprint_book pack --label &#34;Blocks&#34; &gt; blueprint_book.txt"><pre><span><span>#</span> Find and render all 4 to 4 balancers that fit in a 10x4 square</span>
belt_balancer --fast --all networks/4x4 10 4 <span>|</span> render

<span><span>#</span> Start computing the optimal by length with maximum underground length of 16</span>
calculate_optimal compute 16 length

<span><span>#</span> Render optimal area balancers with maximum underground length 4</span>
calculate_optimal query 4 area <span>|</span> render

<span><span>#</span> Generate and render interchanges for a 22 to 22 balancer made of two 11 to 11 balancers</span>
interchange --alternating --underground-length 8 --all 8 22 <span>|</span> render

<span><span>#</span> Render a network graph</span>
network render networks/5x5 5_to_5.png

<span><span>#</span> Save an animation of a blueprint to a file</span>
cat blueprint.txt <span>|</span> blueprint decode <span>|</span> render --export-all

<span><span>#</span> Generate 50 random blocks and save to a blueprint book</span>
make_block 16 16 --all --single-loop <span>|</span> head -n 50 <span>|</span> blueprint encode <span>|</span> blueprint_book pack --label <span><span>&#34;</span>Blocks<span>&#34;</span></span> <span>&gt;</span> blueprint_book.txt</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-todo" aria-hidden="true" tabindex="-1" href="#todo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>TODO</h2>
<ul dir="auto">
<li>Solve the remaining balancers (8 to 7, 7 to 5, 5 to 7, 8 to 5, 7 to 8, 5 to 8)</li>
<li>Go bigger</li>
<li>Add support for finding the optimal factory units</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-examples" aria-hidden="true" tabindex="-1" href="#examples"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Examples</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/R-O-C-K-E-T/Factorio-SAT/blob/main/pictures/2to3.gif"><img src="https://www.mattambrogi.com/R-O-C-K-E-T/Factorio-SAT/raw/main/pictures/2to3.gif" alt="" data-animated-image=""/></a>
<a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/R-O-C-K-E-T/Factorio-SAT/blob/main/pictures/6to6.gif"><img src="https://www.mattambrogi.com/R-O-C-K-E-T/Factorio-SAT/raw/main/pictures/6to6.gif" alt="" data-animated-image=""/></a></p>
</article></div></div>
  </body>
</html>
