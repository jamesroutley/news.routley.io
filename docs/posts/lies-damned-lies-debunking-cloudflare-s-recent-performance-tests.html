<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.fastly.com/blog/debunking-cloudflares-recent-performance-tests">Original</a>
    <h1>Lies, damned lies: debunking Cloudflare’s recent performance tests</h1>
    
    <div id="readability-page-1" class="page"><article><p>A couple of weeks ago Cloudflare, one of our competitors, <a href="https://blog.cloudflare.com/network-performance-update-full-stack-week/"><u>published a blog post</u></a> in which they claimed that their edge compute platform is roughly three times as fast as Compute@Edge. This nonsensical conclusion provides a great example of how statistics can be used to mislead. Read on for an analysis of Cloudflare’s testing methodology, and the results of a more scientific and useful comparison. </p><hr/><p>It has often been said that there are three kinds of untruths: <a href="https://en.wikipedia.org/wiki/Lies,_damned_lies,_and_statistics"><u>lies, damned lies, and statistics</u></a>. This is perhaps unfair: Some statistics are pretty sound. But these are not:</p><img src="https://www.fastly.com/cimages/6pk8mg3yh2ee/2sT2p7EeFzYSdugoCfIEW6/0fd29bc407a6bb02789cfef957127523/CF_claim.png?auto=avif" alt="Cloudflare&#39;s claim to be 196% faster than Compute@Edge" loading="lazy"/><p>Where to begin? Citing <a href="https://www.catchpoint.com/"><u>Catchpoint</u></a> like this makes this claim sound like an independent study from a third party. It&#39;s not. Catchpoint allows you to configure their tools for your needs, meaning you <i>could</i> use them to create a test based on a fair and rigorous benchmark standard, or you could use them to tell the story you want to tell.</p><h3 id="ok-so-what-s-wrong-with-their-tests">OK, so what&#39;s wrong with their tests?</h3><p>The design and execution of Cloudflare’s tests were flawed in several ways: </p><ol><li><p>Cloudflare used a curated selection of Catchpoint nodes in the tests. There&#39;s no explanation of why this specific set of nodes was chosen, but it&#39;s worth noting that Cloudflare&#39;s infrastructure is not in exactly the same places as ours, and a biased choice of test locations affects the result dramatically.</p></li><li><p>Their tests compare JavaScript running on Cloudflare Workers, a mature, generally available product, with JavaScript running on Compute@Edge. Although the Compute@Edge platform is <a href="https://www.fastly.com/blog/compute-edge-is-now-available-to-all-with-a-free-trial"><u>now available for all</u></a> in production, support for <a href="https://developer.fastly.com/learning/compute/javascript/"><u>JavaScript on Compute@Edge is a beta product</u></a>. We <a href="https://docs.fastly.com/products/fastly-product-lifecycle"><u>clearly identify in our documentation</u></a> that beta products are not ready for production use. A fairer test on this point would have compared Rust on Compute@Edge with JavaScript on Cloudflare Workers, which are at more comparable stages of the product lifecycle.</p></li><li><p>Cloudflare used a free Fastly trial account to conduct their tests. Free trial accounts are designed for limited use compared to paid accounts, and performance under load is not comparable between the two.</p></li><li><p>Cloudflare conducted their tests in a single hour, on a single day. This fails to normalize for daily traffic patterns or abnormal events and is susceptible to random distortion effects. If you ran several sets of tests at different times of day, it’s likely that at some point, you’d achieve your desired outcome.</p></li><li><p>The blog post states that the test code &#34;executed a function that simply returns the current time&#34; but then goes on to show a code sample that returns a copy of the headers from the inbound request. One of these must be wrong. It&#39;s impossible to objectively evaluate or reproduce a result when the test methodology is not clearly explained.</p></li><li><p>Solely evaluating time-to-first-byte (TTFB) using tests that involve almost no computational load, no significantly sized payloads, and no platform APIs does not measure the performance of Compute@Edge in any meaningful way.</p></li></ol><p>This is bad science. So why are we drawing attention to it, and since we are choosing to do so, what <i>is</i> the performance of Compute@Edge really like?</p><h3 id="surprise!-compute@edge-is-faster-than-cloudflare-workers">Surprise! Compute@Edge is faster than Cloudflare Workers</h3><p>To be clear, we can&#39;t actually say that for sure because the TTFB metric doesn&#39;t really tell you which platform is “faster” (more on that in a minute), but we <i>can</i> say that in a less biased version of the same tests, our network and Compute@Edge scores better than Cloudflare&#39;s network and Cloudflare Workers, even on TTFB.</p><p>It&#39;s difficult to measure the relative performance of edge networks. We&#39;ve moved beyond the CDN era; today, you can’t use a single variable to judge the value of an edge network. Cloudflare in particular should know this because they have an admirable set of capabilities at the edge — none of which were used in this exercise.</p><p>The distracting nature of this kind of “benchmark” makes us wary of participating in a comparison on anything resembling similar terms, and it&#39;s impossible for us to define our own terms for a comparison because Cloudflare’s terms of use prohibit benchmarking of their services:</p><img src="https://www.fastly.com/cimages/6pk8mg3yh2ee/1vlvdZCkHzQyi25O0NZgZB/84b4cca55d1bcb3a474b67326d41fccd/FE1Bj9OXIAk0SqG.jpeg?auto=avif" alt="Cloudflare&#39;s terms of use" loading="lazy"/><p>So instead, we ran the same tests (echoing headers and measuring TTFB via Catchpoint) against <i>our own</i> platform, but with a few key differences:</p><ul><li><p>We used 673 Catchpoint nodes instead of 50, over a much longer period of time (one week instead of one hour).</p></li><li><p>We used a Wasm binary compiled from Rust rather than JavaScript. </p></li><li><p>We used a paid Fastly account instead of a free trial account.  </p></li></ul><p>You can <a href="https://p.catchpoint.com/ui/Entry/PC/V/ARA-C-D-DR.HDwjZrt1bwMAA"><u>view the raw results</u></a> yourself, but the bottom line is that, on these fairer tests, <b>our network and Compute@Edge is faster than Cloudflare&#39;s network and Workers in four out of six regions, </b><i><b>even on</b></i><i> </i><i><b>this flawed metric</b></i>:</p><img src="https://www.fastly.com/cimages/6pk8mg3yh2ee/5qfUHtAzjEvNhKcuzmBvHR/ae914777d9f60de70b8e58b5bc5729cd/CF_blog_graph1.png?auto=avif" alt="Median TTFB for Cloudflare vs. Fastly" loading="lazy"/><p><i>Fastly data: Median TTFB, 673 catchpoint nodes, 378,000 requests, performed from 2021-11-24 00:00 to 2021-11-30 00:00 (6 days) [</i><a href="https://p.catchpoint.com/ui/Entry/PC/V/ARA-C-D-DR.HDwjZrt1bwMAA"><i><u>results</u></i></a><i>] Cloudflare data: Median TTFB, 50 catchpoint nodes, unknown number of requests, performed from 2021-11-08 20:30 to 2021-11-08 22:00 (1.5 hrs) [</i><a href="https://p.catchpoint.com/ui/Entry/PC/V/ARTO-C-D-K396AjZokq1JMAA"><i><u>results</u></i></a><i>]</i></p><p>On the basis of Cloudflare&#39;s preferred TTFB, our network running Compute@Edge is nearly twice as fast as Cloudflare Workers in North America and Europe, and 10 times faster in Oceania. Remember, their terms of service prohibit benchmarking, which prevents us from testing them directly and attempting to replicate that outlying Oceania number.</p><p>Compute@Edge doesn&#39;t have a native language, since we run WebAssembly binaries directly on our edge servers, but Rust is the language that currently offers one of the best combinations of developer experience and performance of compiled code. You absolutely can <a href="https://developer.fastly.com/learning/compute/custom/"><u>run anything on Compute@Edge if it compiles to WebAssembly</u></a> — and <a href="https://developer.fastly.com/solutions/demos/doom/"><u>people do</u></a>.</p><h3 id="yeah-but-javascript">Yeah, but… JavaScript</h3><p>We know support for JavaScript is important to many customers, but we&#39;re not yet satisfied with the performance of Compute@Edge packages compiled from JavaScript. That&#39;s why it&#39;s in beta. When a product is ready for production, we remove the beta designation.</p><p>In creating our edge computing platform, our entire approach has been to chart a course that’s quite different from most of the industry. This means our performance also evolves differently — because the problems we start out with are different.</p><h3 id="measuring-the-right-numbers">Measuring the right numbers</h3><p>Let’s dive into that TTFB metric in a bit more detail and explore why it&#39;s not useful in this context.</p><p>Cloudflare published the results of tests that don’t measure compute performance in any meaningful way. Instead of measuring a single variable, we should use a benchmark that evaluates the performance of edge compute in core use cases that are important to customers. Network RTT is part of it, but so are variables such as:</p><ul><li><p>Startup time, to hand off a request to customer code</p></li><li><p>Compute performance (&#34;thinking time&#34;) for workloads of various sizes</p></li><li><p>Cache performance, both for hot objects and long-tail content</p></li><li><p>RTT to origin servers, for use cases involving origin requests</p></li></ul><p>Cloudflare&#39;s tests are even bad at measuring network round trip time — because time-to-first-byte covers both the network RTT and the server think time — and there&#39;s no way to understand how each component contributes to the overall number. If you wanted to better understand the performance, you&#39;d separate them.  </p><p>For example, consider the graphs below, which show medians for both network RTT and TTFB in Asia for a Fastly service. A cache hit served from our VCL platform (left graph) is so fast that the network RTT (blue) is essentially the same as the TTFB (green). Using Compute@Edge (right), the TTFB is distinct, reflecting the increased cost of running arbitrary code — but still, the RTT is the vast majority of the number in regions with generally higher connection latency (Asia in the examples below).</p><img src="https://www.fastly.com/cimages/6pk8mg3yh2ee/59Lx2TnpcMU6Km4SV2tUfp/6bebda82ff05561cf1a8628b0d6fcbbf/Screen_Shot_2021-12-06_at_9.57.12_AM.png?auto=avif" alt="Medians for network RTT and TTFB in Asia for a Fastly service" loading="lazy"/><p>RTT varies based on geography, and we are seeing that variance pretty dramatically in the results of the main test we showed earlier. As a result, what you are <b>not</b> seeing in Cloudflare&#39;s tests is a clear picture of the relative performance of our edge compute platforms — the “server think time.”</p><h3 id="building-better-outcomes-for-customers">Building better outcomes for customers</h3><p>We are working on a benchmark suite that will assess performance in a more realistic environment, and we’ll publish the code for that benchmark suite and have the results measured and published by an independent third party — because it&#39;s supremely tiresome to have nerd-sniping competitions which distract from improving the internet for everyone.</p><p>In the meantime it is <b>absolutely not true</b> that Cloudflare Workers is 196% faster than Compute@Edge — in fact, it&#39;s not faster at all. But the important variables for our customers are the ones that are critical for their business. If you want to know whether we’re fast enough for your particular needs on the metrics you care about, we encourage you to <a href="https://www.fastly.com/signup/edge-compute"><u>try us</u></a> and measure for yourself.</p><hr/><p><i>This article contains “forward-looking” statements that are based on Fastly’s beliefs and assumptions and on information currently available to Fastly on the date of this article. Forward-looking statements may involve known and unknown risks, uncertainties, and other factors that may cause our actual results, performance, or achievements to be materially different from those expressed or implied by the forward-looking statements. These statements include, but are not limited to, statements regarding future product offerings. Except as required by law, Fastly assumes no obligation to update these forward-looking statements publicly, or to update the reasons actual results could differ materially from those anticipated in the forward-looking statements, even if new information becomes available in the future. Important factors that could cause Fastly’s actual results to differ materially are detailed from time to time in the reports Fastly files with the Securities and Exchange Commission (SEC), including in our Annual Report on Form 10-K for the fiscal year ended December 31, 2020, and our Quarterly Reports on Form 10-Q. Copies of reports filed with the SEC are posted on Fastly’s website and are available from Fastly without charge.</i></p></article></div>
  </body>
</html>
