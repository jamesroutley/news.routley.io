<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.srlabs.de/blog-post/hexagon-fuzz-full-system-emulated-fuzzing-of-qualcomm-basebands">Original</a>
    <h1>Hexagon fuzz: Full-system emulated fuzzing of Qualcomm basebands</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><div><p>6/27/2025</p><div><p>Research by:  </p><p>Bruno Produit, Luca Glockow, Rachna Shriwas</p></div></div></div></div></div><div><div><div><h2><strong>Key takeaways</strong></h2><p>1. Due to Qualcomm’s proprietary architecture, a lack of security tooling exists around their baseband</p><p>2. Our tooling enables research on Hexagon baseband with significantly reduced engineering work</p><p>3. We release the first open-source toolchain for full-system emulated Hexagon firmware fuzzing at <a href="https://troopers.de/troopers25/talks/8p3ft8/">TROOPERS25</a></p><h2>Overview</h2><p>Every phone has a cellular baseband processor to handle mobile communications (5G, 4G, GPS, and more). </p><p>Qualcomm created a specific architecture for its baseband called Hexagon. It powers the baseband processors found in most leading smartphones, including every iPhone since generation 12 except iPhone 16e and all Snapdragon-based devices. This architecture, being different from the classic ARM, x86, or MIPS that we all know, leads to a lack of security research. Most of the produced tooling is simply not applicable to it!</p><p>We developed the first open-source toolchain for full-system emulated fuzzing of any Hexagon firmware. Our work addresses a gap in baseband security research by making a previously inaccessible attack surface available for analysis. With our toolchain, open-sourced <a href="https://github.com/srlabs/hexagon_fuzz">here</a>, we invite the community to collaborate and build upon this work.</p><h2>Previous research landscape and the Hexagon gap</h2><p>The baseband security research community has made considerable progress in recent years, yet a critical gap has persisted regarding Qualcomm’s Hexagon architecture.</p><p>Early work like <a href="https://dl.acm.org/doi/10.1145/3395351.3399360">BaseSAFE (2020, Maier and al.)</a> introduces an advanced framework for fuzzing basebands. Building on this, <a href="https://www.ndss-symposium.org/wp-content/uploads/2022-136-paper.pdf">FirmWire (2022, Hernandez et al.)</a> provides baseband emulation platforms for fuzzing.</p><p>These tools are the go-to solution for fuzzing basebands which use ARM, x86, MIPS and other standard architectures. But, as the FirmWire paper observes:</p><blockquote>“Unlike other baseband implementations, Qualcomm leverages a fully-custom architecture known as Hexagon […] Unfortunately, tooling for this architecture is sparse, and especially full-system emulators are lacking.”</blockquote><p>Other research efforts around Hexagon are limited to specific aspects, such as DIAG protocol analysis and reverse engineering (see Figure 1).</p><figure><p><img src="https://cdn.prod.website-files.com/636034b5be6f5507ed57c4ca/685a8ff6ff4ebd6da97af4d4_Previous%20research-abridged.png" loading="lazy" alt=""/></p><figcaption>Figure 1. Previous baseband research did not cover Hexagon baseband full system emulation<br/></figcaption></figure><h2>Challenges</h2><p>Hexagon presents several barriers that make firmware analysis challenging:</p><ul role="list"><li><strong>Custom CPU architecture</strong>: Most tooling lacks support, making reversing challenging</li><li><strong>Custom OS and software stack</strong>: Requires adapting common attack techniques</li><li><strong>Custom communication protocols: </strong>No free tools or documentation exist</li></ul><p>The primary challenge in reversing Hexagon baseband lies in the lack of tooling support. Ghidra, IDA, and similar tools do not support the architecture out of the box, and while QEMU offers user-space emulation for Hexagon, full system emulation remains unavailable.</p><p>FirmWire, for example, relies on QEMU for emulation and introspection. Since Hexagon does not yet have proper full-system Hexagon emulation in QEMU, it is not possible to use it for analysing this firmware, as explained in the quote above.</p><h2>Solution</h2><p>To address these challenges, we used a QEMU fork from the Qualcomm Innovation Center (QuIC) supporting Hexagon full-system emulation. With the addition of LibAFL’s QEMU fork, we built a custom fuzzing and reverse engineering tool tailored for Hexagon.</p><h3>‍<em>1. How we merged QuIC/QEMU with LibAFL’s QEMU</em></h3><p>The QEMU fork from QuIC includes a <a href="https://github.com/quic/qemu/tree/hexagon_sysemu_20_dec_2023">hexagon_sysemu branch</a> that, with minor modifications, can successfully boot iPhone baseband firmware. We adapted this codebase for fuzzing by integrating it with <a href="https://github.com/AFLplusplus/qemu-libafl-bridge">LibAFL’s QEMU</a>. Since the two projects share no common ancestor in Git, merging them requires significant manual effort and custom fixes.</p><p>We share our QEMU fork in <a href="https://github.com/srlabs/qemu-libafl-bridge/tree/d19511726cfa566268d57fd145c302f290271746">this</a> repository, which can be used directly. Like QuIC’s fork, you can emulate Hexagon firmware and connect LLDB if you have Qualcomm’s Hexagon SDK. You can also compile it as a library and connect LibAFL for introspection directly in Rust via its elegant API.</p><h3><em>2. How we created a fully coverage-guided fuzzer</em></h3><p>Using this approach, we can recreate something similar to FirmWire and use Rust-based hooks for control flow modification. When booting a baseband firmware, these code flow manipulations are necessary. The emulator won’t provide the hardware components that the firmware communicates with.</p><p>We created a fuzzer that handles control flow manipulation for a specific iPhone firmware, up to user mode, utilizing these LibAFL bindings. We provide this with a JSON-based approach, where you can set breakpoints with their handlers in the configuration. You can also modify the QEMU command line arguments to debug firmware emulation issues.</p><figure><p><img src="https://cdn.prod.website-files.com/636034b5be6f5507ed57c4ca/685d6dd1563ce5b69ca8c45f_Snippet.png" loading="lazy" alt="Figure 2. Snippet of the JSON-based configuration for Hexagon fuzz"/></p><figcaption>Figure 2. Snippet of the JSON-based configuration for Hexagon fuzz</figcaption></figure><p>With this tooling, a fully coverage-guided fuzzer can run on any Hexagon-based baseband firmware. This way, all the 5G/4G/GPS stacks from your phone can theoretically be tested for security via a Rust-based API and fuzzed extensively. </p><p>To find vulnerabilities, you need to: </p><ol role="list"><li>Boot the firmware into the expected state</li><li>Provide a harness that specifies the target function(s) to fuzz within the baseband</li></ol><h3><em>3. How we improved reverse engineering through visualized coverage</em></h3><p>We also developed a script to visualize the fuzzer’s coverage. It parses QEMU’s debug logs, printing the program counter and coloring it in Ghidra, with different colors per thread. This improves the code comprehension during reverse engineering by providing immediate insight into the fuzzer progress. We heavily used this to advance the boot procedure as it allows dynamic debugging between emulated code in QEMU and disassembly in Ghidra.</p><p>We also provide some <a href="https://github.com/srlabs/hexagon_fuzz/blob/main/docs/reverse_engineering.md">documentation</a> on how to reverse engineer these basebands and use the tooling.</p><h3>Architecture overview</h3><figure><p><img src="https://cdn.prod.website-files.com/636034b5be6f5507ed57c4ca/685a8dc3f1c45e52245e9cdb_Architecture%20new.png" loading="lazy" alt="Architecture overview of Hexagon fuzz"/></p><figcaption>Figure 3. Architecture overview of Hexagon fuzz</figcaption></figure><p>The toolchain enables you to:</p><p>1. <strong>Emulate Qualcomm Hexagon baseband firmware</strong> in a controlled environment<strong>‍</strong></p><p>2.<strong> Add breakpoints</strong> and modify runtime behavior through Rust hooks</p><p>3. <strong>Skip initialization functions</strong> to speed up the boot process<strong>‍</strong></p><p>4. <strong>Instrument common functions</strong> like printf for debugging<strong>‍</strong></p><p>5.<strong> Perform coverage-guided fuzzing</strong> on baseband components<strong>‍</strong></p><p>6. <strong>Do vulnerability discovery</strong> in Hexagon basebands</p><h3>Current status and next steps</h3><p>Our current implementation successfully: </p><p>1. <strong>Boots the iPhone baseband firmware</strong>, with 100+ lines of boot log output<strong>‍</strong></p><p>2. <strong>Instruments and manipulates the control flow </strong>of the firmware<strong>‍</strong></p><p>3. <strong>Provides basic fuzzing infrastructure</strong> to analyze Hexagon baseband firmware</p><p>Here&#39;s how we plan to improve:</p><ul role="list"><li><strong>Better target function identification</strong> through enhanced reversing</li><li><strong>CLADE/CLADE2</strong> decompression support</li><li><strong>Enhanced fuzzing harness</strong> with appropriate parameter initialization</li><li><strong>Integration with dynamic testing</strong> from phone/SIM interfaces</li></ul><p>This work represents a significant step forward in baseband security research, bridging the gap in Hexagon-based baseband analysis and bringing much-needed transparency to the security posture of these devices.</p><p>We presented this research at the<a href="https://troopers.de/troopers25/talks/8p3ft8/"> Troopers25</a> conference, (slides available <a href="https://github.com/srlabs/hexagon_fuzz/blob/main/docs/talk/hexagon_fuzz_troopers2025.pdf">here</a>) which will be available on YouTube in a few weeks. Visit our GitHub <a href="https://github.com/srlabs/hexagon_fuzz">repository</a> to check out our fuzzer!</p><h2>References</h2><p><strong>[1] Burke 2018</strong>, <a href="https://media.defcon.org/DEF%20CON%2026/DEF%20CON%2026%20presentations/DEFCON-26-Seamus-Burke-Journey-Into-Hexagon.pdf" target="_blank">A Journey into Hexagon</a>​</p><p>‍</p><p>‍</p><p>‍</p></div></div></div></div>
  </body>
</html>
