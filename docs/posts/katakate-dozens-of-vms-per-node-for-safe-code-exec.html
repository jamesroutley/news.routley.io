<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Katakate/k7">Original</a>
    <h1>Show HN: Katakate ‚Äì Dozens of VMs per node for safe code exec</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto">
<span>
    KATAKATE
  </span>
</p>
<p dir="auto">
  Self-hosted secure VM sandboxes for AI compute at scale
</p>
<p dir="auto">
  <a href="https://katakate.org" rel="nofollow"><img src="https://camo.githubusercontent.com/575a13bdebaa125fddd8d3d7a7f8b5c0911f968c334a37f655495110a0f5249a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f776562736974652d6b6174616b6174652e6f72672d6f72616e6765" data-canonical-src="https://img.shields.io/badge/website-katakate.org-orange"/></a>
  <a href="https://github.com/Katakate/k7/stargazers"><img src="https://camo.githubusercontent.com/9e25fe2f6e3c22c107c0d0ba16f87984f6cffbea78e1e937b928eeee7160a82d/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f4b6174616b6174652f6b373f7374796c653d736f6369616c" data-canonical-src="https://img.shields.io/github/stars/Katakate/k7?style=social"/></a>
  <a href="https://docs.katakate.org" rel="nofollow">
    <img src="https://camo.githubusercontent.com/0b2192ce01aeb3cbce276fe593af0ccaa3708c5035645d536a9fba8d9563dcbc/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f63732d646f63732e6b6174616b6174652e6f72672d6f72616e6765" data-canonical-src="https://img.shields.io/badge/docs-docs.katakate.org-orange"/>
  </a>
</p>
<p dir="auto">
  <a href="https://news.ycombinator.com/item?id=45656952" rel="nofollow">
    <img src="https://camo.githubusercontent.com/70f1ed8e45795b3e0e10c74c4b40148389750226384cdabffe27b8a5160e9f64/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f53686f77253230484e2d25323331253230f09f94a52d6f72616e6765" alt="Show HN #1 Badge" data-canonical-src="https://img.shields.io/badge/Show%20HN-%231%20üî•-orange"/>
  </a>
  <a href="https://github.com/Katakate/k7/blob/main/assets/show-hn_nb1_post-id-45656952.png">üì∏</a>
</p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/Katakate/k7/blob/main/assets/k7-cover-upgrade.png"><img src="https://github.com/Katakate/k7/raw/main/assets/k7-cover-upgrade.png" alt="Katakate Logo" width="2000"/></a>
</p>
<p dir="auto">
  <a href="https://deepwiki.com/Katakate/k7" rel="nofollow">
    <img src="https://camo.githubusercontent.com/e7d4bb1a32530e373bb53fbe8eea825440ad27c7531d8f144d561acdd20c093a/68747470733a2f2f6465657077696b692e636f6d2f62616467652e737667" data-canonical-src="https://deepwiki.com/badge.svg"/>
  </a>
  <a href="https://github.com/Katakate/k7/blob/main/LICENSE"><img src="https://camo.githubusercontent.com/c355f200ea90fddaa407b6eaab303663a669248ea3ca7b1fcf77dbe04ff5f48c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d417061636865253230322e302d626c75652e737667" data-canonical-src="https://img.shields.io/badge/license-Apache%202.0-blue.svg"/></a>
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/e42650643e250b5c6ff2c1cb489018fd12391fd8729566339b87a7d5a40f1bac/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f696e7374616c6c253230776974682d6170742d626c75653f6c6f676f3d64656269616e"><img src="https://camo.githubusercontent.com/e42650643e250b5c6ff2c1cb489018fd12391fd8729566339b87a7d5a40f1bac/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f696e7374616c6c253230776974682d6170742d626c75653f6c6f676f3d64656269616e" data-canonical-src="https://img.shields.io/badge/install%20with-apt-blue?logo=debian"/></a>
  <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/276f13d26054a61a941bc683968da15fa6d0b9a78fa0e69b94321b88905563fb/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f6b6174616b617465"><img src="https://camo.githubusercontent.com/276f13d26054a61a941bc683968da15fa6d0b9a78fa0e69b94321b88905563fb/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f6b6174616b617465" data-canonical-src="https://img.shields.io/pypi/v/katakate"/></a>
</p> 
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/Katakate/k7/blob/main/assets/demo-k7.gif"><img src="https://github.com/Katakate/k7/raw/main/assets/demo-k7.gif" alt="K7 Demo" width="900" data-animated-image=""/></a>
</p>
<p dir="auto"><i><b>Katakate</b></i> aims to make it easy to create, manage and orchestrate lightweight safe VM sandboxes for executing untrusted code, at scale. It is built on battle-tested VM isolation with Kata, Firecracker and Kubernetes. It is orignally motivated by AI agents that need to run arbitrary code at scale but it is also great for:</p>
<ul dir="auto">
<li>Custom serverless (like AWS Fargate, but yours)</li>
<li>Hardened CI/CD runners (no Docker-in-Docker risks)</li>
<li>Blockchain execution layers for AI dApps</li>
</ul>
<blockquote>
<p dir="auto"><b>100% open‚Äësource</b> (Apache‚Äë2.0). For technical support, write us at: <a href="mailto:hi@katakate.org">hi@katakate.org</a></p>
</blockquote>

<p dir="auto"><i><b>Katakate</b></i> is built on:</p>
<ul dir="auto">
<li><i><b>Kubernetes</b></i> for orchestration, with K3s which is prod-ready and a great choice for edge nodes,</li>
<li><i><b>Kata</b></i> to encapsulate containers into light-weight virtual-machines,</li>
<li><i><b>Firecracker</b></i> as the chosen VM, for super-fast boots, light footprints and minimal attack surface,</li>
<li><i><b>Devmapper Snapshotter</b></i> with <i><b>thin-pool provisioning of logical volumes</b></i> for efficient use of disk space shared by dozens of VMs per node.</li>
</ul>

<ul dir="auto">
<li>üõ†Ô∏è Docker <code>build</code> / <code>run</code> / <code>compose</code> support <b><i>inside the VM sandbox</i></b></li>
<li>üåê Multi-node cluster capabilities for distributed workloads</li>
<li>üîç Cilium FQDN-based DNS resolution to safely whitelist domains, not just IP blocks</li>
<li>‚öôÔ∏è Support other VMM such as Qemu for GPU workloads</li>
</ul>
<p dir="auto">
   <strong>Note:</strong> Katakate is currently in <em>beta</em> and under security review. Use with caution for highly sensitive workloads.
</p>

<p dir="auto">For usage you need:</p>
<ul dir="auto">
<li><strong>Node(s)</strong> that will host the VM sandboxes</li>
<li><strong>Client</strong> from where to send requests</li>
</ul>
<p dir="auto">We provide a:</p>
<ul dir="auto">
<li><strong>CLI</strong>: to use on the node(s) directly --&gt; <code>apt install k7</code></li>
<li><strong>API</strong>: deployed on the (master) node(s) --&gt; <code>k7 start-api</code></li>
<li><strong>Python SDK</strong>: Python client sync/async talking to API --&gt; <code>pip install katakate</code></li>
</ul>


<ul dir="auto">
<li>Ubuntu (amd64) host.</li>
<li>Hardware virtualization (KVM) available and accessible
<ul dir="auto">
<li>Check: <code>ls /dev/kvm</code> should exist.</li>
<li>This is typically available on your own Linux machine.</li>
<li>On cloud providers, it varies.
<ul dir="auto">
<li>Hetzner (the only one I tested so far)  yes for their <code>Robot</code> instances only, i.e. &#34;dedicated&#34;: robot.hetzner.com.</li>
<li>AWS: only <code>.metal</code> EC2 instances.</li>
<li>GCP: virtualization friendly, most instances, with <code>--enable-nested-virtualization</code> flag.</li>
<li>Azure: Dv3, Ev3, Dv4, Ev4, Dv5, Ev5. Must be Intel/AMD x86, not ARM.</li>
<li>Others: in general, hardware virtualization is not exposed on cloud VPS, so you&#39;ll likely want a dedicated / bare metal.</li>
</ul>
</li>
</ul>
</li>
<li>One raw disk (unformatted, unpartitioned) for the thin-pool that k7 will provision for efficient disk usage of sandboxes.
<ul dir="auto">
<li>Use <code>./utils/wipe-disk.sh /your/disk</code> to wipe a disk clean before provisioning. DANGER: destructive - it will remove data/partitions/formatting/SWRAID.</li>
</ul>
</li>
<li>Ansible (for installer):
<div dir="auto" data-snippet-clipboard-copy-content="sudo add-apt-repository universe -y
sudo apt update
sudo apt install -y ansible"><pre>sudo add-apt-repository universe -y
sudo apt update
sudo apt install -y ansible</pre></div>
</li>
<li>Docker and Docker Compose (for the API):
<div dir="auto" data-snippet-clipboard-copy-content="curl -fsSL https://get.docker.com | sh"><pre>curl -fsSL https://get.docker.com <span>|</span> sh</pre></div>
</li>
</ul>
<p dir="auto">Already tested setups:</p>
<ul dir="auto">
<li>Hetzner Robot instance with Ubuntu 24.04, x86_64 arch, booked with 1 extra empty disk <code>nvme2n1</code> for the thin-pool provisioning. See the setup guide (PDF): <a href="https://github.com/Katakate/k7/blob/main/tutorials/k7_hetzner_node_setup.pdf">tutorials/k7_hetzner_node_setup.pdf</a>.</li>
</ul>

<p dir="auto">Just recent Python.</p>


<p dir="auto">First install <code>k7</code> on your Linux server that will host the VMs:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo add-apt-repository ppa:katakate.org/k7
sudo apt update
sudo apt install k7"><pre>sudo add-apt-repository ppa:katakate.org/k7
sudo apt update
sudo apt install k7</pre></div>
<p dir="auto">Then let <code>k7</code> get your node ready with everything:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$  k7 install
Current task: Reminder about logging out and back in for group changes
  Installing K7 on 1 host(s)... ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 100% 0:01:41
‚úÖ Installation completed successfully!
"><pre>$  <span>k7 install</span>
<span>Current task: Reminder about logging out and back in for group changes</span>
<span>  Installing K7 on 1 host(s)... ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 100% 0:01:41</span>
<span>‚úÖ Installation completed successfully!</span>
</pre></div>
<p dir="auto">Optionally pass <code>-v</code> for a verbose output.</p>
<p dir="auto">This will install and most importantly connect together the following components:</p>
<ul dir="auto">
<li>Kubernetes (K3s prod-ready distribution)</li>
<li>Kata (for container virtualization)</li>
<li>Firecracker (as Virtual Machine Manager)</li>
<li>Jailer (to secure Firecracker VMs further into a chroot)</li>
<li>devmapper snapshotter with thin-pool provisioning of logical volumes for VM efficient disk memory usage</li>
</ul>
<p dir="auto">Careful design: config updates will not touch your existing Docker or containerd setups. We chose to use K3s&#39; own containerd for minimal disruption. Installation may however overwrite existing installations of K3s, Kata, Firecracker, Jailer.</p>

<p dir="auto">You can run workloads directly from the node(s) using the CLI. To create a sandbox, just create a yaml config for it.</p>

<div dir="auto" data-snippet-clipboard-copy-content="name: my-sandbox-123
image: alpine:latest
namespace: default

# Optional: restrict egress
egress_whitelist:
  - &#34;1.1.1.1/32&#34;      # Cloudflare DNS
  - &#34;8.8.8.8/32&#34;      # Google DNS

# Optional: resource limits
limits:
  cpu: &#34;1&#34;
  memory: &#34;1Gi&#34;
  ephemeral-storage: &#34;2Gi&#34;

# Optional: run before_script inside the container once at start. Network restrictions apply after the before-script, so you can install packages here, pull git repos, etc
before_script: |
  apk add --no-cache git curl

# Optional: load environment variables from a file. These will be available both during the before-script, and in the sandbox
env_file: path/to/your/secrets/.env"><pre><span>name</span>: <span>my-sandbox-123</span>
<span>image</span>: <span>alpine:latest</span>
<span>namespace</span>: <span>default</span>

<span><span>#</span> Optional: restrict egress</span>
<span>egress_whitelist</span>:
  - <span><span>&#34;</span>1.1.1.1/32<span>&#34;</span></span>      <span><span>#</span> Cloudflare DNS</span>
  - <span><span>&#34;</span>8.8.8.8/32<span>&#34;</span></span>      <span><span>#</span> Google DNS</span>

<span><span>#</span> Optional: resource limits</span>
<span>limits</span>:
  <span>cpu</span>: <span><span>&#34;</span>1<span>&#34;</span></span>
  <span>memory</span>: <span><span>&#34;</span>1Gi<span>&#34;</span></span>
  <span>ephemeral-storage</span>: <span><span>&#34;</span>2Gi<span>&#34;</span></span>

<span><span>#</span> Optional: run before_script inside the container once at start. Network restrictions apply after the before-script, so you can install packages here, pull git repos, etc</span>
<span>before_script</span>: <span>|</span>
<span>  apk add --no-cache git curl</span>
<span></span>
<span></span><span><span>#</span> Optional: load environment variables from a file. These will be available both during the before-script, and in the sandbox</span>
<span>env_file</span>: <span>path/to/your/secrets/.env</span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="# Create a sandbox (uses k7.yaml in the current directory by default, but you can also pass: -f myfile.yaml)
k7 create

# List sandboxes
k7 list

# Delete a sandbox
k7 delete my-sandbox-123

# Delete all sandboxes. You can also pass a namespace
k7 delete-all"><pre><span><span>#</span> Create a sandbox (uses k7.yaml in the current directory by default, but you can also pass: -f myfile.yaml)</span>
k7 create

<span><span>#</span> List sandboxes</span>
k7 list

<span><span>#</span> Delete a sandbox</span>
k7 delete my-sandbox-123

<span><span>#</span> Delete all sandboxes. You can also pass a namespace</span>
k7 delete-all</pre></div>

<p dir="auto">If you&#39;d like to manage workloads remotely, just use the API:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Start API server (containerized and SSL support with Cloudflared)
k7 start-api

# Generate API key
k7 generate-api-key my-key1"><pre><span><span>#</span> Start API server (containerized and SSL support with Cloudflared)</span>
k7 start-api

<span><span>#</span> Generate API key</span>
k7 generate-api-key my-key1</pre></div>
<p dir="auto">Make sure your user is in the <code>Docker</code> group to be allowed to start or stop the API.</p>
<p dir="auto">As for generating / listing / revoking keys, you might need <code>sudo</code> or <code>root</code>.</p>

<p dir="auto">After your k7 API is up, usage is very simple.</p>
<p dir="auto">Install the Python SDK via:</p>

<p dir="auto">Or if you want async support:</p>
<div dir="auto" data-snippet-clipboard-copy-content="pip install &#34;katakate[async-sdk]&#34;"><pre>pip install <span><span>&#34;</span>katakate[async-sdk]<span>&#34;</span></span></pre></div>
<p dir="auto">Then use with:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from katakate import Client

k7 = Client(
  endpoint=&#39;https://&lt;your-endpoint&gt;&#39;, 
  api_key=&#39;your-key&#39;)

# Create sandbox
sb = k7.create({
    &#34;name&#34;: &#34;my-sandbox&#34;,
    &#34;image&#34;: &#34;alpine:latest&#34;
})

# Execute code
result = sb.exec(&#39;echo &#34;Hello World&#34;&#39;)
print(result[&#39;stdout&#39;])

# List all sandboxes
sandboxes = k7.list()

# Delete sandbox
sb.delete()"><pre><span>from</span> <span>katakate</span> <span>import</span> <span>Client</span>

<span>k7</span> <span>=</span> <span>Client</span>(
  <span>endpoint</span><span>=</span><span>&#39;https://&lt;your-endpoint&gt;&#39;</span>, 
  <span>api_key</span><span>=</span><span>&#39;your-key&#39;</span>)

<span># Create sandbox</span>
<span>sb</span> <span>=</span> <span>k7</span>.<span>create</span>({
    <span>&#34;name&#34;</span>: <span>&#34;my-sandbox&#34;</span>,
    <span>&#34;image&#34;</span>: <span>&#34;alpine:latest&#34;</span>
})

<span># Execute code</span>
<span>result</span> <span>=</span> <span>sb</span>.<span>exec</span>(<span>&#39;echo &#34;Hello World&#34;&#39;</span>)
<span>print</span>(<span>result</span>[<span>&#39;stdout&#39;</span>])

<span># List all sandboxes</span>
<span>sandboxes</span> <span>=</span> <span>k7</span>.<span>list</span>()

<span># Delete sandbox</span>
<span>sb</span>.<span>delete</span>()</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="import asyncio
from katakate import AsyncClient

async def main():
    k7 = AsyncClient(
      endpoint=&#39;https://&lt;your-endpoint&gt;&#39;, 
      api_key=&#39;your-key&#39;
    )
    print(await k7.list())
    await k7.aclose()

asyncio.run(main())"><pre><span>import</span> <span>asyncio</span>
<span>from</span> <span>katakate</span> <span>import</span> <span>AsyncClient</span>

<span>async</span> <span>def</span> <span>main</span>():
    <span>k7</span> <span>=</span> <span>AsyncClient</span>(
      <span>endpoint</span><span>=</span><span>&#39;https://&lt;your-endpoint&gt;&#39;</span>, 
      <span>api_key</span><span>=</span><span>&#39;your-key&#39;</span>
    )
    <span>print</span>(<span>await</span> <span>k7</span>.<span>list</span>())
    <span>await</span> <span>k7</span>.<span>aclose</span>()

<span>asyncio</span>.<span>run</span>(<span>main</span>())</pre></div>

<ul dir="auto">
<li>LangChain ReAct agent with a K7 sandbox tool
<ul dir="auto">
<li>Path: tutorials/langchain-react-agent</li>
<li>Setup: copy .env.example to .env and fill K7_ENDPOINT/K7_API_KEY/OPENAI_API_KEY</li>
<li>Run: python agent.py</li>
<li>Try asking it anything! e.g. &#34;List files from &#39;/&#39;&#34;</li>
</ul>
</li>
</ul>

<p dir="auto">First install make if not already available:</p>
<div dir="auto" data-snippet-clipboard-copy-content="sudo add-apt-repository universe -y
sudo apt update
sudo apt install make"><pre>sudo add-apt-repository universe -y
sudo apt update
sudo apt install make</pre></div>
<p dir="auto">To build the <code>k7</code> CLI and API into <code>.deb</code> package:</p>

<p dir="auto">You can then install it with:</p>

<p dir="auto">To uninstall later:</p>

<p dir="auto">Note: we recommend running <code>make uninstall</code> before reinstalling if it is not your first install, to avoid stale copies of cached files in the .deb package.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Build and run the API container</h3><a id="user-content-build-and-run-the-api-container" aria-label="Permalink: Build and run the API container" href="#build-and-run-the-api-container"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Local dev image:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Build the API image locally
make api-build-local

# Run API using local image (no pull)
make api-run-local"><pre><span><span>#</span> Build the API image locally</span>
make api-build-local

<span><span>#</span> Run API using local image (no pull)</span>
make api-run-local</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Build the katakate Python SDK from source</h3><a id="user-content-build-the-katakate-python-sdk-from-source" aria-label="Permalink: Build the katakate Python SDK from source" href="#build-the-katakate-python-sdk-from-source"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Preferred (uv):</p>
<div dir="auto" data-snippet-clipboard-copy-content="# create env
uv venv .venv-build
. .venv-build/bin/activate

# install directly from source in editable mode
uv pip install -e ."><pre><span><span>#</span> create env</span>
uv venv .venv-build
<span>.</span> .venv-build/bin/activate

<span><span>#</span> install directly from source in editable mode</span>
uv pip install -e <span>.</span></pre></div>

<p dir="auto">K7 sandboxes are hardened by default with multiple layers of security:</p>
<ul dir="auto">
<li>
<p dir="auto"><strong>VM isolation</strong>: Kata Containers provide hardware-level isolation via lightweight VMs with Firecracker</p>
<ul dir="auto">
<li>VMs are further restricted into a chroot using Jailer</li>
<li>Kata&#39;s Seccomp restrictions are enabled</li>
</ul>
</li>
<li>
<p dir="auto"><strong>Linux capabilities</strong>: All capabilities are dropped by default (<code>drop: ALL</code>) for defense-in-depth</p>
<ul dir="auto">
<li>Only explicitly add back capabilities you need via <code>cap_add</code> parameter</li>
<li><code>allow_privilege_escalation</code> is always set to <code>false</code></li>
<li>Seccomp profile: <code>RuntimeDefault</code></li>
</ul>
</li>
<li>
<p dir="auto"><strong>Non-root execution</strong>: Optionally run containers and pods as non-root user (UID 65532):</p>
<ul dir="auto">
<li><code>container_non_root</code>: Run the main container as non-root and disable privilege escalation</li>
<li><code>pod_non_root</code>: Run the entire pod as non-root with consistent filesystem ownership (UID/GID/FSGroup 65532)</li>
</ul>
</li>
<li>
<p dir="auto"><strong>API security</strong>:</p>
<ul dir="auto">
<li>API keys stored as SHA256 hashes with timing-attack-resistant comparison</li>
<li>Expiry enforced; last-used timestamp recorded</li>
<li>File-based storage with 600 permissions (<code>/etc/k7/api_keys.json</code> by default)</li>
</ul>
</li>
<li>
<p dir="auto"><strong>Network policies</strong>: Complete network isolation for VM sandboxes</p>
<ul dir="auto">
<li><strong>Ingress isolation</strong>: All inter-VM communication is blocked by default to prevent sandbox-to-sandbox access</li>
<li><strong>Egress lockdown</strong>: Control outbound traffic with CIDR-based restrictions using Kubernetes NetworkPolicies</li>
<li>DNS to CoreDNS always allowed when egress is locked down</li>
<li>Administrative access via <code>kubectl exec</code> and <code>k7 shell</code> is preserved (uses Kubernetes API, not pod networking)</li>
<li>Soon to come: Cilium integration for domain name whitelisting</li>
</ul>
</li>
</ul>
<p dir="auto">More security features are currently on the roadmap, including integrating AppArmor.</p>

<ul dir="auto">
<li>Layout uses <code>src/</code>:
<ul dir="auto">
<li>CLI, API, core live under <code>src/k7/</code></li>
<li>SDK under <code>src/katakate/</code></li>
</ul>
</li>
<li>Root packaging targets the <code>katakate</code> SDK only; assets under <code>src/k7/</code> are not part of the PyPI distribution.</li>
<li><code>MANIFEST.in</code> (for the <code>katakate</code> SDK) should include essentials like <code>LICENSE</code> and <code>README.md</code> only; deploy assets from <code>src/k7/deploy/*</code> belong to the Debian/CLI packaging flow, not to the PyPI package.</li>
<li><code>setup.py</code> for <code>katakate</code> lives at repo root; packages from <code>src/</code>.</li>
<li>The CLI Debian package is built via <code>src/k7/cli/build.sh</code> and produces <code>dist/k7_&lt;version&gt;_amd64.deb</code>.</li>
<li>CI (tags <code>v*</code>) can publish the PyPI SDK and upload the <code>.deb</code> artifact.</li>
</ul>

<ul dir="auto">
<li>Jailer seems to be currently ignored by Kata despite being passed correctly into its configuration, and despite the Jailer process being started. The use of Kubernetes secrets could be a reason of incompatibility. This is under investigation.</li>
</ul>
</article></div></div>
  </body>
</html>
