<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jvns.ca/blog/2023/05/12/introducing-implement-dns-in-a-weekend/">Original</a>
    <h1>Introducing &#34;Implement DNS in a Weekend&#34;</h1>
    
    <div id="readability-page-1" class="page"><div>
     

<p>Hello! I’m excited to announce a project I’ve been working on for a long time:
a free guide to implementing your own DNS resolver in a weekend.</p>

<p>The whole thing is about 200 lines of Python, including implementing all of the
binary DNS parsing from scratch. Here’s the link:</p>



<p>This project is a fun way to learn:</p>

<ul>
<li>How to parse a binary network protocol like DNS</li>
<li>How DNS works behind the scenes (what’s actually happening when you make a DNS query?)</li>
</ul>

<p>The testers have reported that it takes around 2-4 hours to do in Python.</p>

<h3 id="what-s-a-dns-resolver">what’s a DNS resolver?</h3>

<p>A DNS resolver is a program that knows how to figure out what the IP address
for a domain is. Here’s what the command line interface of the resolver you’ll
write looks like:</p>

<pre><code>$ python3 resolve.py example.com
93.184.216.34
</code></pre>

<h3 id="implementing-dns-gives-me-an-amazing-sense-of-confidence">implementing DNS gives me an amazing sense of confidence</h3>

<p>In <a href="https://jvns.ca/blog/2023/05/08/new-talk-learning-dns-in-10-years/">Learning DNS in 10 years</a>, I
talked about how having implemented a toy version of DNS myself from scratch gives
me an unparalleled sense of confidence in my understanding of DNS.</p>

<p>So this guide is my attempt to share that sense of confidence with you all.</p>

<p>Also, if you’ve bought <a href="https://wizardzines.com/zines/dns">How DNS Works</a>, I think
this guide is a nice companion – you can implement your own DNS
resolver to solidify your understanding of the concepts in the zine.</p>

<h3 id="it-s-a-jupyter-notebook">it’s a Jupyter notebook</h3>

<p>In this guide, I wanted to mix code that you could run with explanations. I
struggled to figure out the right format for months, and then I finally thought
of using a <a href="https://jupyter.org/">Jupyter notebook</a>! This meant that I could easily check that all of
the code actually ran.</p>

<p>I used <a href="https://jupyterbook.org">Jupyter Book</a> to convert the Jupyter notebooks
into a website. It reruns the notebook before converting it to HTML, so I could
easily guarantee that all of the code actually runs and outputs what it says
that it outputs. I ended up hacking the theme a lot to make it more minimal, as
well as doing some terrible things with Beautiful Soup to get a table of
contents that shows you the global TOC as well as the page’s local section
headings all in one place.</p>

<p>You can also download the Jupyter notebooks and run them on your own computer
if you’d like, using the “download the code” button on the <a href="https://implement-dns.wizardzines.com/">homepage</a>.</p>

<h3 id="why-python">why Python?</h3>

<p>I used Python for this guide instead of a lower-level language like Go or Rust
to make it more approachable – when I started learning networking 10 years
ago, I didn’t really know any systems languages well, and I found them kind of
intimidating. Implementing <a href="https://jvns.ca/blog/2013/10/31/day-20-scapy-and-traceroute/">traceroute using scapy in Python</a>  felt
much less scary.</p>

<p>You can very easily pack/unpack binary data in Python with <code>struct.pack</code> and
<code>struct.unpack</code>, so Python being a higher-level language doesn’t really cause
any problems.</p>

<p>The idea is that you can either follow the guide in Python (which is the
easiest mode), or if you want a bigger challenge, you can translate the code to
any language you’d like. (Go? Javascript? Rust? Bash? Lua? Ruby?)</p>

<h3 id="only-the-standard-library">only the standard library</h3>

<p>It was important to me to really show how to implement DNS “from scratch”, so
the guide only uses a few very basic standard library modules: <code>struct</code>,
<code>socket</code>, <code>io</code>, <code>random</code>, and <code>dataclasses</code>.</p>

<p>Here’s what we use each module for:</p>

<ul>
<li><code>random</code> is used for generating DNS query IDs</li>
<li><code>socket</code> is used to make a UDP connection</li>
<li><code>struct</code> is used for converting to/from binary (<code>struct.pack</code> and <code>struct.unpack</code>)</li>
<li><code>dataclasses</code> are used to make serializing / deserializing records a little more ergonomic</li>
<li><code>io</code> is used for <code>BytesIO</code>, which gives us a reader interface which stores a
pointer to how much of the packet we’ve read so far. If I were implementing
DNS in a language that didn’t have this kind of reader interface, I might
implement my own.</li>
</ul>

<h3 id="it-includes-some-bonus-exercises">it includes some bonus exercises</h3>

<p>The toy DNS resolver is obviously missing a bunch of important features, so
I’ve added some exercises at the end with examples of features you could add
(and bugs you could fix) to make it a little more like a “real” DNS resolver.</p>

<p>This list isn’t particularly exhaustive though, and I’d love to hear other
ideas for relatively-easy-to-implement DNS resolver features I’ve missed.</p>

<h3 id="next-goal-tls">next goal: TLS</h3>

<p>I’ve actually written toy implementations of a bunch of other network protocols
in Python (ICMP, UDP, TCP, HTTP, and TLS), and I’m hoping to release “Implement
TLS in a weekend” at some point.</p>

<p>No promises though – I have another zine to finish writing first (on all the
surprising things about how integers and floats work on computers), and a toy
TLS implementation is quite a bit more involved than a toy DNS implementation.</p>

<h3 id="thanks-to-the-beta-testers">thanks to the beta testers</h3>

<p>Thanks to everyone (Atticus, Miccah, Enric, Ben, Ben, Maryanne, Adam, Jordan,
and anyone else I missed) who tested this guide and reported confusing or
missing explanations, mistakes, and typos.</p>

<p>Also a huge thanks to my friend Allison Kaptur who designed the first “Domain
Name Saturday” workshop with me at the Recurse Center in 2020.</p>

<p>The name was inspired by <a href="https://raytracing.github.io/">Ray Tracing in One Weekend</a>.</p>

<h3 id="here-s-the-link-again">here’s the link again</h3>

<p>Here’s the link to the guide again if you’d like to try it out:</p>



</div></div>
  </body>
</html>
