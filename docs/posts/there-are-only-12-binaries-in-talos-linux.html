<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.siderolabs.com/blog/there-are-only-12-binaries-in-talos-linux/">Original</a>
    <h1>There are only 12 binaries in Talos Linux</h1>
    
    <div id="readability-page-1" class="page"><div data-id="60b29bb" data-element_type="widget" data-widget_type="theme-post-content.default">
				<div>
			
<figure><img fetchpriority="high" fetchpriority="high" decoding="async" width="1024" height="538" src="https://mlxz2ksifyzh.i.optimole.com/w:1024/h:538/q:mauto/ig:avif/f:best/https://www.siderolabs.com/wp-content/uploads/2024/03/12-binaries-banner-1.png" alt=""/></figure>



<p>Linux is a core component of your Kubernetes cluster. The distribution you choose will have a big impact on how quickly you can create a cluster, the stability of your workloads, and how much maintenance you’ll need to perform.</p>



<p>When creating a version of Linux for containers or Kubernetes, for many companies and distributions the common practice is to start with a general-purpose Linux and strip away things you don’t need. This results in a smaller footprint variation of the main distribution—e.g. <a href="https://wiki.ubuntu.com/Minimal">Ubuntu minimal</a>—but it always starts from a big, general purpose Linux and tries to make it smaller.</p>



<p>Talos Linux takes the opposite approach. What if the distribution only had to run Kubernetes? What is the minimal set of tooling and executables needed?</p>



<p>There are <strong>12 unique binaries</strong> in /bin and /sbin in Talos 1.7.0. This greatly reduces the size of installation, the maintenance needed for the operating system, and the possible security vulnerabilities of the system.</p>



<p>For reference here are some other popular distributions and how many binaries they include by default. This also counts executables that are symlinked or hard linked to another file (e.g. <code>lvm</code> is often symlinked multiple times for <code>lvs</code> and <code>vgs</code>).</p>



<figure><table><tbody><tr><td>Talos Linux</td><td>29</td></tr><tr><td>Ubuntu Server 22.04</td><td>2780</td></tr><tr><td>Amazon Linux 2</td><td>1382</td></tr><tr><td>Flatcar Container Linux</td><td>2391</td></tr></tbody></table></figure>



<p>All distros were set up with default installation options. No additional packages were installed and binaries were counted with:</p>



<pre><code>ls -1 $(echo $PATH | tr &#39;:&#39; &#39;\n&#39;) | wc -l</code></pre>



<p>Talos doesn’t provide a shell, <code>ls</code>, <code>tr</code>, or <code>wc</code>. Files were counted via the API and we didn’t count directories:</p>



<pre><code>talosctl list -n $NODE_IP /sbin | wc -l
talosctl list -n $NODE_IP /bin | wc -l</code></pre>



<p>With only 12 unique files on the system we can tell you what each one does.</p>



<h2>/sbin/init</h2>



<p>The init binary is one of the biggest strengths of Talos Linux. Talos doesn’t ship with a general purpose init system like systemd. Talos’ init system is purpose built for running the Kubelet and a container runtime. The init system exposes a declarative API which is how the system is configured and maintained.</p>



<p>The init binary is <a href="https://github.com/siderolabs/talos/blob/main/internal/app/machined/main.go">called machined</a> and is written in go. It’s less than 400 lines of code and can be understood by a go developer in less than a day. As <a href="https://github.com/systemd/systemd/blob/main/src/core/main.c">opposed to systemd</a> which is over 3000 lines of C code I’ll never comprehend.</p>



<p>The <code>/sbin/init</code> binary is hard linked to <code>/sbin/dashboard</code>, <code>/sbin/poweroff</code>, <code>/sbin/shutdown</code>, and <code>/sbin/wrapperd</code>. While this technically is 5 files, it’s a single file hard linked 4 times to provide convenience commands.</p>



<p>The dashboard is used for providing local and remote information about the node. You can see an overview of how it works on YouTube.</p>



<figure><p>
<iframe title="Talos dashboard overview" width="800" height="450" src="https://www.youtube.com/embed/52Wmkb0H-98?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</p></figure>



<p>The binaries <code>poweroff</code> and <code>shutdown</code> are commands to cleanly shut down the node. These are used by the kernel and external tools, but Talos uses the system API to shutdown.</p>



<p>The <a href="https://github.com/siderolabs/talos/blob/main/internal/app/wrapperd/main.go">wrapperd</a> binary is used during init to fork processes with reduced privledges. Because a child process will inherit a lot from the parent process wrapperd is used to remove kernel capabilities like CAP_SYSADMIN.</p>



<p>All of the other binaries on the system are included from other packages we build from source. You can see how they get built <a href="https://github.com/siderolabs/pkgs">from GitHub</a> and we will review each binary below.</p>



<h2>/bin/containerd*</h2>



<p>This is the container runtime that ships with Talos. It is commonly used with Kubernetes clusters and is the default container runtime option for the majority of providers.</p>



<p>This also includes <code>/bin/containerd-shim-runc-v2</code> and <code>/bin/containerd-shim</code>. Both of these shims provide the same function (executing a container under <code>runc</code>) but <code>containerd-shim</code> was originally used with docker and <code>containerd-shim-runc-v2</code> is used from containerd.</p>



<h2>/bin/runc</h2>



<p>This is the true <a href="https://github.com/opencontainers/runc">parent process of your containers</a>. It is daemonless so the containerd service can restart if needed without stopping all your containers.</p>



<h2>/sbin/modprobe</h2>



<p>The command <a contenteditable="false" href="https://linux.die.net/man/8/modprobe">modprobe</a> is for managing kernel modules to add or remove functionality from your kernel. This is often for adding support for special hardware (e.g. GPUs) but is also used for additional kernel tooling.</p>



<p>Talos doesn’t use modprob directly but some modules require the binary to load other modules. You can add kernel modules to Talos via <a href="https://www.talos.dev/latest/talos-guides/configuration/system-extensions/">system extensions</a> and use pre-built extensions from the <a href="https://www.talos.dev/latest/learn-more/image-factory/">Image Factory</a>.</p>



<h2>/sbin/lvm</h2>



<p>The <code>lvm</code> binary is used for managing logical volumes in Linux. This is provided for services that run in Kubernetes that may need or expect a logical volume to be present on the host (e.g. <a href="https://rook.io/docs/rook/latest-release/Getting-Started/Prerequisites/prerequisites/#lvm-package">rook</a>).</p>



<h2>/sbin/dmsetup</h2>



<p>This is used for managing logical volumes that use the device-mapper driver. It’s similar to <code>lvs</code> commands but a separate binary for more complex disk configuration.</p>



<h2>/sbin/udevd</h2>



<p>The udevd daemon takes kernel messages and passes the messages to other systems to read the messages. It can be configured as part of the <a href="https://www.talos.dev/latest/reference/configuration/v1alpha1/config/#Config.machine.udev">Talos machine config</a>.</p>



<h2>/sbin/mkfs.xfs</h2>



<p>This will create an <a href="https://en.wikipedia.org/wiki/XFS">XFS file system</a> on a disk or logical volume.</p>



<h2>/sbin/xfs_repair</h2>



<p>This is used to repair an XFS file system if it becomes corrupted.</p>



<h2>/sbin/xtables-legacy-multi</h2>



<p>This binary is symlinked by <code>iptables*</code> and <code>ip6tables*</code> to configure IP tables on the host. Container network interface (CNI) providers often mount directories from the host and expect these commands to exist because they cannot easily be run from within a container.</p>



<p>These symlinks account for 12 total files in the system but they all perform common iptables commands.</p>



<h2>Conclusion</h2>



<p>It may seem impossible but that’s the entire system. Every binary is required to bootstrap a Kubernetes cluster or run a node as part of the cluster. This is why we call Talos Linux the <a href="https://www.siderolabs.com/platform/talos-os-for-kubernetes/">Kubernetes Operating System</a>.</p>



<p>There are more executable files in /lib and /usr but those are Shared Object (.so) files and Kernel modules (.ko). These are necessary to run the system for drivers and various programs but are not called directly.</p>



<p>If you would like to download and install Talos on your system of choice you can get started at <a href="https://talos.dev" target="_blank" rel="noreferrer noopener">https://talos.dev</a>.</p>



<p>To get an even easier interface to managing Kubernetes clusters on-prem or in a cloud provider check out Omni at <a href="https://www.siderolabs.com/platform/saas-for-kubernetes/" target="_blank" rel="noreferrer noopener">https://www.siderolabs.com/platform/saas-for-kubernetes/</a>.</p>



<p>If you have questions or want to get started come join the <a href="https://slack.dev.talos-systems.io/">Talos community Slack</a>.</p>



<figure><p>
<iframe title="Welcome to Omni" width="800" height="450" src="https://www.youtube.com/embed/0gPF0_fLins?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</p></figure>
		</div>
				</div></div>
  </body>
</html>
