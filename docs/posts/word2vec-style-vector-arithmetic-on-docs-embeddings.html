<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://technicalwriting.dev/embeddings/arithmetic/index.html">Original</a>
    <h1>Word2vec-style vector arithmetic on docs embeddings</h1>
    
    <div id="readability-page-1" class="page"><div id="main" role="main">
      
  <section id="word2vec-style-vector-arithmetic-on-docs-embeddings">
<span id="arithmetic"></span>
<p><em>2025 October 29</em></p>
<p><a href="https://en.wikipedia.org/wiki/Word2vec">word2vec</a> popularized the idea of representing words as <a href="https://en.wikipedia.org/wiki/Vector_(mathematics_and_physics)">vectors</a> where
semantically similar words are positioned close to each other in the <a href="https://en.wikipedia.org/wiki/Vector_space">vector
space</a>. Nowadays these vectors are usually called <a href="https://en.wikipedia.org/wiki/Embedding_(machine_learning)">embeddings</a>.</p>
<p>A neat consequence of the word2vec approach is that adding and subtracting
vectors produces semantically logical results. From <a href="https://arxiv.org/pdf/1301.3781">Efficient Estimations of
Word Representations in Vector Space</a> (the word2vec paper):</p>
<blockquote>
<p>Using a word offset technique where simple algebraic operations are performed
on the word vectors, it was shown for example that <code><span>vector(&#34;King&#34;)</span></code> -
<code><span>vector(&#34;Man&#34;)</span></code> + <code><span>vector(&#34;Woman&#34;)</span></code> results in a vector that is closest to the
vector representation of the word <code><span>Queen</span></code>.</p></blockquote>
<p>Does word2vec-style vector arithmetic work in technical writing contexts?</p>
<section id="experiments">
<h2>Experiments<a href="#experiments" title="Link to this heading">§</a></h2>
<p>word2vec was published in 2013. Embedding models have come a long way since
then. word2vec models could only operate on single words. A vector always
represented a single word. Modern embedding models can operate on arbitrary
text. A vector can now represent a word, paragraph, section, document, set of
documents, etc.</p>
<p>My experiments follow the same basic pattern of <code><span>vector(&#34;King&#34;)</span></code> -
<code><span>vector(&#34;Man&#34;)</span></code> + <code><span>vector(&#34;Woman&#34;)</span></code>, with one difference. The experiments
start out with a vector representing the full text of a document, not a
single-word vector.</p>
<section id="same-topic-different-domain">
<span id="arithmetic-domain"></span><h3>Same topic, different domain<a href="#same-topic-different-domain" title="Link to this heading">§</a></h3>
<p>This is the first experiment. Starting with the vector for the full text of
<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing Your Database</a> from the Supabase docs, subtract the vector for the
word <code><span>supabase</span></code>, and then add the vector for the word <code><span>angular</span></code>. The
resultant vector should be semantically close to the concept of “testing in
Angular”.</p>
</section>
<section id="different-topic-same-domain">
<span id="arithmetic-topic"></span><h3>Different topic, same domain<a href="#different-topic-same-domain" title="Link to this heading">§</a></h3>
<p>This is the second experiment. Starting with the vector for the full text of
<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing Your Database</a> from the Supabase docs, subtract the vector for the
word <code><span>testing</span></code>, and then add the vector for the word <code><span>vectors</span></code>. The
resultant vector should be semantically close to the concept of “vectors in
Supabase”.</p>
</section>
</section>
<section id="task-types">
<h2>Task types<a href="#task-types" title="Link to this heading">§</a></h2>
<p>From <a href="https://technicalwriting.dev/embeddings/tasks/index.html#tasks"><span>previous research</span></a> I’ve learned that task types noticeably
affect Gemini Embedding’s outputs. EmbeddingGemma (the model I’ll be using in
the experiments) also supports tasks types. I’ll run both experiments twice:
once with default task types, and again with customized task types.</p>
</section>
<section id="verification">
<h2>Verification<a href="#verification" title="Link to this heading">§</a></h2>
<p>There’s no way to directly verify that the resultant vectors are semantically
close to the expected concepts. What I can do instead is generate vectors from
the full texts of various docs, and then compare the resultant vectors from the
experiments against the vectors of these various docs using <a href="https://p.migdal.pl/blog/2025/01/dont-use-cosine-similarity/">cosine
similarity</a>.</p>
<p>Here’s the full list of docs that I use in the experiments:</p>
<ul>
<li><p><a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/ecosystem/web-workers.md">Background Processing Using Web Workers</a> (Angular)</p></li>
<li><p><a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/i18n/locale-id.md">Refer To Locales By ID</a> (Angular)</p></li>
<li><p><a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/overview.md">Testing</a> (Angular)</p></li>
<li><p><a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/services.md">Testing Services</a> (Angular)</p></li>
<li><p><a href="https://raw.githubusercontent.com/cockroachdb/docs/refs/heads/main/src/current/v25.4/linestring.md">LINESTRING</a> (CockroachDB)</p></li>
<li><p><a href="https://raw.githubusercontent.com/cockroachdb/docs/refs/heads/main/src/current/v25.4/local-testing.md">Test Your Application Locally</a> (CockroachDB)</p></li>
<li><p><a href="https://raw.githubusercontent.com/bazelbuild/bazel-skylib/refs/heads/main/docs/analysis_test_doc.md">analysis_test</a> (Skylib)</p></li>
<li><p><a href="https://raw.githubusercontent.com/bazelbuild/bazel-skylib/refs/heads/main/docs/bzl_library.md">bzl_library</a> (Skylib)</p></li>
<li><p><a href="https://raw.githubusercontent.com/bazelbuild/bazel-skylib/refs/heads/main/docs/diff_test_doc.md">diff_test</a> (Skylib)</p></li>
<li><p><a href="https://raw.githubusercontent.com/microsoft/playwright/refs/heads/main/docs/src/actionability.md">Actionability</a> (Playwright)</p></li>
<li><p><a href="https://raw.githubusercontent.com/microsoft/playwright/refs/heads/main/docs/src/junit-java.md">JUnit</a> (Playwright)</p></li>
<li><p><a href="https://raw.githubusercontent.com/microsoft/playwright/refs/heads/main/docs/src/writing-tests-python.md">Writing Tests</a> (Playwright)</p></li>
<li><p><a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/deployment/branching.mdx">Branching</a> (Supabase)</p></li>
<li><p><a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing Your Database</a> (Supabase)</p></li>
<li><p><a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/functions/unit-test.mdx">Testing Your Edge Functions</a> (Supabase)</p></li>
<li><p><a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/ai/vector-columns.mdx">Vector Columns</a> (Supabase)</p></li>
</ul>
<p>For the <a href="#arithmetic-domain"><span>Same topic, different domain</span></a> experiment (<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing Your Database</a> -
<code><span>supabase</span></code> + <code><span>angular</span></code>) I expect the resultant vector to be most similar to
<a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/overview.md">Testing</a> or <a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/services.md">Testing Services</a> from the Angular docs. And for the
<a href="#arithmetic-topic"><span>Different topic, same domain</span></a> experiment (<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing Your Database</a> - <code><span>testing</span></code> +
<code><span>vectors</span></code>) I expect the resultant vector to be most similar to <a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/ai/vector-columns.mdx">Vector
Columns</a> from the Supabase docs.</p>
<p>Note that I picked short docs because EmbeddingGemma only supports 2048 tokens of
input and I didn’t feel like dealing with chunking. Most of the docs revolve around
testing.</p>
</section>
<section id="results">
<h2>Results<a href="#results" title="Link to this heading">§</a></h2>
<p>In the <a href="#arithmetic-domain"><span>Same topic, different domain</span></a> experiment (<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing Your Database</a> -
<code><span>supabase</span></code> + <code><span>angular</span></code>) the resultant vector is most similar to <a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/overview.md">Testing</a>
and <a href="https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/services.md">Testing Services</a> from the Angular docs, as expected, <strong>when custom task
types are enabled</strong>:</p>
<div><div><pre><span></span><span>[</span><span>INFO</span><span>]</span> <span>Running</span> <span>&#34;same topic, different domain&#34;</span> <span>experiment</span> <span>with</span> <span>customized</span> <span>task</span> <span>types</span>
<span>[</span><span>INFO</span><span>]</span> <span>Results</span><span>:</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.751456081867218</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Services&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.6292878985404968</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Background Processing Using Web Workers&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.5090276598930359</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Database&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.5084458589553833</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Refer To Locales By ID&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.46428176760673523</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Test Your Application Locally&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.4586600363254547</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Writing Tests&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.4434031546115875</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;JUnit&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.4156876802444458</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Actionability&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.396766722202301</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;analysis_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.3869394063949585</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Edge Functions&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.368389755487442</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;diff_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.3524951934814453</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;bzl_library&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.29295891523361206</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;LINESTRING&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.2778087854385376</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Branching&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.26931506395339966</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Vector Columns&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.23397961258888245</span>
</pre></div>
</div>
<p>When using the default task types, the resultant vector is most similar to
<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing Your Database</a> i.e. the doc that the experiment started with:</p>
<div><div><pre><span></span><span>[</span><span>INFO</span><span>]</span> <span>Running</span> <span>&#34;same topic, different domain&#34;</span> <span>experiment</span> <span>with</span> <span>default</span> <span>task</span> <span>types</span>
<span>[</span><span>INFO</span><span>]</span> <span>Results</span><span>:</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Database&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.6590374708175659</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.571465790271759</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Services&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.46747612953186035</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Test Your Application Locally&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.43749818205833435</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Edge Functions&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.4073418378829956</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Writing Tests&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.3561333119869232</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Background Processing Using Web Workers&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.3353777527809143</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Vector Columns&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.3085843324661255</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;LINESTRING&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.30450767278671265</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Branching&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.29775649309158325</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;analysis_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.2946781814098358</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Actionability&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.2879413962364197</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;JUnit&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.2845016121864319</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Refer To Locales By ID&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.2824022173881531</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;diff_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.26220911741256714</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;bzl_library&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.2447129189968109</span>
</pre></div>
</div>
<p>In the <a href="#arithmetic-topic"><span>Different topic, same domain</span></a> experiment (<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx">Testing
Your Database</a> - <code><span>testing</span></code> + <code><span>vectors</span></code>) the resultant vector is most similar to
<a href="https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/ai/vector-columns.mdx">Vector Columns</a>, regardless of whether default or custom task types were used.</p>
<p>Custom task types:</p>
<div><div><pre><span></span><span>[</span><span>INFO</span><span>]</span> <span>Running</span> <span>&#34;different topic, same domain&#34;</span> <span>experiment</span> <span>with</span> <span>customized</span> <span>task</span> <span>types</span>
<span>[</span><span>INFO</span><span>]</span> <span>Results</span><span>:</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Vector Columns&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.6380605697631836</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Database&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.44831225275993347</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;LINESTRING&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.32693782448768616</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Background Processing Using Web Workers&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.2737721800804138</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Edge Functions&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.25883781909942627</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Branching&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.2509428560733795</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Refer To Locales By ID&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.2328835278749466</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;bzl_library&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.2133977860212326</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Test Your Application Locally&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.20613139867782593</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.16262517869472504</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Actionability&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.14792931079864502</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Writing Tests&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.14344163239002228</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Services&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.13723336160182953</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;diff_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.12111848592758179</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;JUnit&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.11599748581647873</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;analysis_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.0979730486869812</span>
</pre></div>
</div>
<p>Default task types:</p>
<div><div><pre><span></span><span>[</span><span>INFO</span><span>]</span> <span>Running</span> <span>&#34;different topic, same domain&#34;</span> <span>experiment</span> <span>with</span> <span>default</span> <span>task</span> <span>types</span>
<span>[</span><span>INFO</span><span>]</span> <span>Results</span><span>:</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Vector Columns&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.6698287129402161</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Database&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.6086233854293823</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Your Edge Functions&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.36533844470977783</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;LINESTRING&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.34430524706840515</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Branching&#34;</span> <span>(</span><span>Supabase</span><span>)</span> <span>=&gt;</span> <span>0.3141021430492401</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Test Your Application Locally&#34;</span> <span>(</span><span>CockroachDB</span><span>)</span> <span>=&gt;</span> <span>0.29872700572013855</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Background Processing Using Web Workers&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.28414368629455566</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;bzl_library&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.26424312591552734</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Refer To Locales By ID&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.2537899315357208</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.23542608320713043</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Writing Tests&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.22030793130397797</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Testing Services&#34;</span> <span>(</span><span>Angular</span><span>)</span> <span>=&gt;</span> <span>0.20675960183143616</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;Actionability&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.1959698647260666</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;diff_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.19095730781555176</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;JUnit&#34;</span> <span>(</span><span>Playwright</span><span>)</span> <span>=&gt;</span> <span>0.1832783967256546</span>
<span>[</span><span>INFO</span><span>]</span> <span>&#34;analysis_test&#34;</span> <span>(</span><span>Skylib</span><span>)</span> <span>=&gt;</span> <span>0.15578024089336395</span>
</pre></div>
</div>
<p>So, yes, it seems like word2vec-style vector arithmetic can work in technical
writing contexts. Make sure to set your <a href="https://technicalwriting.dev/embeddings/tasks/index.html#tasks"><span>task types</span></a> correctly.</p>
</section>
<section id="discussion">
<h2>Discussion<a href="#discussion" title="Link to this heading">§</a></h2>
<p>I still don’t really understand how it’s possible to semantically represent an
entire document as a single vector, let alone how adding and subtracting
single-word vectors from full-document vectors works.</p>
<p>How do we actually use this in technical writing workflows or documentation
experiences? I’m not sure. I was just curious to learn whether or not it would
work.</p>
</section>
<section id="appendix">
<h2>Appendix<a href="#appendix" title="Link to this heading">§</a></h2>
<section id="source-code">
<h3>Source code<a href="#source-code" title="Link to this heading">§</a></h3>
<p><code><span>experiments.py</span></code>:</p>
<div><div><pre><span></span><span>from</span><span> </span><span>json</span><span> </span><span>import</span> <span>load</span>
<span>from</span><span> </span><span>os</span><span> </span><span>import</span> <span>environ</span>
<span>from</span><span> </span><span>sys</span><span> </span><span>import</span> <span>exit</span>

<span>from</span><span> </span><span>requests</span><span> </span><span>import</span> <span>get</span>
<span>from</span><span> </span><span>sentence_transformers</span><span> </span><span>import</span> <span>SentenceTransformer</span>


<span>class</span><span> </span><span>Doc</span><span>:</span>

    <span>def</span><span> </span><span>__init__</span><span>(</span><span>self</span><span>,</span> <span>topic</span><span>,</span> <span>domain</span><span>,</span> <span>url</span><span>,</span> <span>length</span><span>,</span> <span>embedding</span><span>):</span>
        <span>self</span><span>.</span><span>topic</span> <span>=</span> <span>topic</span>
        <span>self</span><span>.</span><span>domain</span> <span>=</span> <span>domain</span>
        <span>self</span><span>.</span><span>url</span> <span>=</span> <span>url</span>
        <span>self</span><span>.</span><span>length</span> <span>=</span> <span>length</span>
        <span>self</span><span>.</span><span>embedding</span> <span>=</span> <span>embedding</span>
        <span>self</span><span>.</span><span>similarity</span> <span>=</span> <span>None</span>


<span>def</span><span> </span><span>init_docs</span><span>(</span><span>model</span><span>,</span> <span>task_types</span><span>):</span>
    <span>with</span> <span>open</span><span>(</span><span>&#34;data.json&#34;</span><span>,</span> <span>&#34;r&#34;</span><span>)</span> <span>as</span> <span>f</span><span>:</span>
        <span>data</span> <span>=</span> <span>load</span><span>(</span><span>f</span><span>)</span>
    <span>tokenizer</span> <span>=</span> <span>model</span><span>.</span><span>tokenizer</span>
    <span>docs</span> <span>=</span> <span>[]</span>
    <span>max_length</span> <span>=</span> <span>tokenizer</span><span>.</span><span>model_max_length</span>
    <span>for</span> <span>item</span> <span>in</span> <span>data</span><span>:</span>
        <span>url</span> <span>=</span> <span>item</span><span>[</span><span>&#34;url&#34;</span><span>]</span>
        <span>response</span> <span>=</span> <span>get</span><span>(</span><span>url</span><span>)</span>
        <span>text</span> <span>=</span> <span>response</span><span>.</span><span>text</span>
        <span>length</span> <span>=</span> <span>len</span><span>(</span><span>tokenizer</span><span>.</span><span>encode</span><span>(</span><span>text</span><span>))</span>
        <span>topic</span> <span>=</span> <span>item</span><span>[</span><span>&#34;topic&#34;</span><span>]</span>
        <span>domain</span> <span>=</span> <span>item</span><span>[</span><span>&#34;domain&#34;</span><span>]</span>
        <span>if</span> <span>length</span> <span>&gt;</span> <span>max_length</span><span>:</span>
            <span>exit</span><span>(</span><span>f</span><span>&#34;[ERROR] Document is too large: </span><span>{</span><span>topic</span><span>}</span><span>, </span><span>{</span><span>domain</span><span>}</span><span>&#34;</span><span>)</span>
        <span>prompt</span> <span>=</span> <span>&#34;title: </span><span>{topic}</span><span> | text: &#34;</span>
        <span>embedding</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>text</span><span>,</span> <span>prompt</span><span>=</span><span>prompt</span><span>)</span> <span>if</span> <span>task_types</span> <span>else</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>text</span><span>)</span>
        <span>doc</span> <span>=</span> <span>Doc</span><span>(</span><span>topic</span><span>,</span> <span>domain</span><span>,</span> <span>url</span><span>,</span> <span>length</span><span>,</span> <span>embedding</span><span>)</span>
        <span>docs</span><span>.</span><span>append</span><span>(</span><span>doc</span><span>)</span>
    <span>return</span> <span>docs</span>


<span>def</span><span> </span><span>create_domain_query</span><span>(</span><span>model</span><span>,</span> <span>task_types</span><span>):</span>
    <span>url</span> <span>=</span> <span>&#34;https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx&#34;</span>
    <span>response</span> <span>=</span> <span>get</span><span>(</span><span>url</span><span>)</span>
    <span>text</span> <span>=</span> <span>response</span><span>.</span><span>text</span>
    <span>if</span> <span>task_types</span><span>:</span>
        <span>doc</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>text</span><span>,</span> <span>prompt_name</span><span>=</span><span>&#34;Retrieval-query&#34;</span><span>)</span>
        <span>supabase</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;supabase&#34;</span><span>,</span> <span>prompt_name</span><span>=</span><span>&#34;Retrieval-query&#34;</span><span>)</span>
        <span>angular</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;angular&#34;</span><span>,</span> <span>prompt_name</span><span>=</span><span>&#34;Retrieval-query&#34;</span><span>)</span>
    <span>else</span><span>:</span>
        <span>doc</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>text</span><span>)</span>
        <span>supabase</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;supabase&#34;</span><span>)</span>
        <span>angular</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;angular&#34;</span><span>)</span>
    <span>return</span> <span>doc</span> <span>-</span> <span>supabase</span> <span>+</span> <span>angular</span>


<span>def</span><span> </span><span>create_topic_query</span><span>(</span><span>model</span><span>,</span> <span>task_types</span><span>):</span>
    <span>url</span> <span>=</span> <span>&#34;https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx&#34;</span>
    <span>response</span> <span>=</span> <span>get</span><span>(</span><span>url</span><span>)</span>
    <span>text</span> <span>=</span> <span>response</span><span>.</span><span>text</span>
    <span>if</span> <span>task_types</span><span>:</span>
        <span>doc</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>text</span><span>,</span> <span>prompt_name</span><span>=</span><span>&#34;Retrieval-query&#34;</span><span>)</span>
        <span>testing</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;testing&#34;</span><span>,</span> <span>prompt_name</span><span>=</span><span>&#34;Retrieval-query&#34;</span><span>)</span>
        <span>vectors</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;vectors&#34;</span><span>,</span> <span>prompt_name</span><span>=</span><span>&#34;Retrieval-query&#34;</span><span>)</span>
    <span>else</span><span>:</span>
        <span>doc</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>text</span><span>)</span>
        <span>testing</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;testing&#34;</span><span>)</span>
        <span>vectors</span> <span>=</span> <span>model</span><span>.</span><span>encode</span><span>(</span><span>&#34;vectors&#34;</span><span>)</span>
    <span>return</span> <span>doc</span> <span>-</span> <span>testing</span> <span>+</span> <span>vectors</span>


<span>def</span><span> </span><span>run_experiments</span><span>():</span>
    <span>environ</span><span>[</span><span>&#34;TOKENIZERS_PARALLELISM&#34;</span><span>]</span> <span>=</span> <span>&#34;false&#34;</span>
    <span>model</span> <span>=</span> <span>SentenceTransformer</span><span>(</span><span>&#34;google/embeddinggemma-300m&#34;</span><span>)</span>
    <span>for</span> <span>task_types</span> <span>in</span> <span>[</span><span>True</span><span>,</span> <span>False</span><span>]:</span>
        <span>print</span><span>(</span><span>f</span><span>&#39;[INFO] Running &#34;same topic, different domain&#34; experiment with </span><span>{</span><span>&#34;customized&#34;</span><span> </span><span>if</span><span> </span><span>task_types</span><span> </span><span>else</span><span> </span><span>&#34;default&#34;</span><span>}</span><span> task types&#39;</span><span>)</span>
        <span>docs</span> <span>=</span> <span>init_docs</span><span>(</span><span>model</span><span>,</span> <span>task_types</span><span>)</span>
        <span>query</span> <span>=</span> <span>create_domain_query</span><span>(</span><span>model</span><span>,</span> <span>task_types</span><span>)</span>
        <span>for</span> <span>doc</span> <span>in</span> <span>docs</span><span>:</span>
            <span>similarity</span> <span>=</span> <span>model</span><span>.</span><span>similarity</span><span>(</span><span>query</span><span>,</span> <span>doc</span><span>.</span><span>embedding</span><span>)</span><span>.</span><span>item</span><span>()</span>
            <span>doc</span><span>.</span><span>similarity</span> <span>=</span> <span>similarity</span>
        <span>docs</span><span>.</span><span>sort</span><span>(</span><span>key</span><span>=</span><span>lambda</span> <span>doc</span><span>:</span> <span>doc</span><span>.</span><span>similarity</span><span>,</span> <span>reverse</span><span>=</span><span>True</span><span>)</span>
        <span>print</span><span>(</span><span>f</span><span>&#39;[INFO] Results:&#39;</span><span>)</span>
        <span>for</span> <span>doc</span> <span>in</span> <span>docs</span><span>:</span>
            <span>print</span><span>(</span><span>f</span><span>&#39;[INFO] &#34;</span><span>{</span><span>doc</span><span>.</span><span>topic</span><span>}</span><span>&#34; (</span><span>{</span><span>doc</span><span>.</span><span>domain</span><span>}</span><span>) =&gt; </span><span>{</span><span>doc</span><span>.</span><span>similarity</span><span>}</span><span>&#39;</span><span>)</span>
        <span>print</span><span>()</span>
        <span>print</span><span>(</span><span>f</span><span>&#39;[INFO] Running &#34;different topic, same domain&#34; experiment with </span><span>{</span><span>&#34;customized&#34;</span><span> </span><span>if</span><span> </span><span>task_types</span><span> </span><span>else</span><span> </span><span>&#34;default&#34;</span><span>}</span><span> task types&#39;</span><span>)</span>
        <span>docs</span> <span>=</span> <span>init_docs</span><span>(</span><span>model</span><span>,</span> <span>task_types</span><span>)</span>
        <span>query</span> <span>=</span> <span>create_topic_query</span><span>(</span><span>model</span><span>,</span> <span>task_types</span><span>)</span>
        <span>for</span> <span>doc</span> <span>in</span> <span>docs</span><span>:</span>
            <span>similarity</span> <span>=</span> <span>model</span><span>.</span><span>similarity</span><span>(</span><span>query</span><span>,</span> <span>doc</span><span>.</span><span>embedding</span><span>)</span><span>.</span><span>item</span><span>()</span>
            <span>doc</span><span>.</span><span>similarity</span> <span>=</span> <span>similarity</span>
        <span>docs</span><span>.</span><span>sort</span><span>(</span><span>key</span><span>=</span><span>lambda</span> <span>doc</span><span>:</span> <span>doc</span><span>.</span><span>similarity</span><span>,</span> <span>reverse</span><span>=</span><span>True</span><span>)</span>
        <span>print</span><span>(</span><span>f</span><span>&#39;[INFO] Results:&#39;</span><span>)</span>
        <span>for</span> <span>doc</span> <span>in</span> <span>docs</span><span>:</span>
            <span>print</span><span>(</span><span>f</span><span>&#39;[INFO] &#34;</span><span>{</span><span>doc</span><span>.</span><span>topic</span><span>}</span><span>&#34; (</span><span>{</span><span>doc</span><span>.</span><span>domain</span><span>}</span><span>) =&gt; </span><span>{</span><span>doc</span><span>.</span><span>similarity</span><span>}</span><span>&#39;</span><span>)</span>
        <span>print</span><span>()</span>


<span>if</span> <span>__name__</span> <span>==</span> <span>&#34;__main__&#34;</span><span>:</span>
    <span>run_experiments</span><span>()</span>
</pre></div>
</div>
<p><code><span>data.json</span></code>:</p>
<div><div><pre><span></span><span>[</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Angular&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Background Processing Using Web Workers&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/ecosystem/web-workers.md&#34;</span> 
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Angular&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Refer To Locales By ID&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/i18n/locale-id.md&#34;</span> 
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Angular&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Testing&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/overview.md&#34;</span> 
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Angular&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Testing Services&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/angular/angular/refs/heads/main/adev/src/content/guide/testing/services.md&#34;</span> 
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;CockroachDB&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;LINESTRING&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/cockroachdb/docs/refs/heads/main/src/current/v25.4/linestring.md&#34;</span> 
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;CockroachDB&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Test Your Application Locally&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/cockroachdb/docs/refs/heads/main/src/current/v25.4/local-testing.md&#34;</span> 
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Skylib&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;analysis_test&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/bazelbuild/bazel-skylib/refs/heads/main/docs/analysis_test_doc.md&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Skylib&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;bzl_library&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/bazelbuild/bazel-skylib/refs/heads/main/docs/bzl_library.md&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Skylib&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;diff_test&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/bazelbuild/bazel-skylib/refs/heads/main/docs/diff_test_doc.md&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Playwright&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Actionability&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/microsoft/playwright/refs/heads/main/docs/src/actionability.md&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Playwright&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;JUnit&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/microsoft/playwright/refs/heads/main/docs/src/junit-java.md&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Playwright&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Writing Tests&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/microsoft/playwright/refs/heads/main/docs/src/writing-tests-java.md&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Supabase&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Branching&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/deployment/branching.mdx&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Supabase&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Testing Your Database&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/database/testing.mdx&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Supabase&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Testing Your Edge Functions&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/functions/unit-test.mdx&#34;</span>
  <span>},</span>
  <span>{</span>
    <span>&#34;domain&#34;</span><span>:</span> <span>&#34;Supabase&#34;</span><span>,</span>
    <span>&#34;topic&#34;</span><span>:</span> <span>&#34;Vector Columns&#34;</span><span>,</span>
    <span>&#34;url&#34;</span><span>:</span> <span>&#34;https://raw.githubusercontent.com/supabase/supabase/refs/heads/master/apps/docs/content/guides/ai/vector-columns.mdx&#34;</span>
  <span>}</span>
<span>]</span>
</pre></div>
</div>
<p>Note that I forgot to pin the URLs to specific commits. I.e. I used the
<code><span>HEAD</span></code> version of each URL. If you run the experiments a year or two from now
(October 2025), your cosine similarity scores will probably be different,
because the underlying text of the documents will probably have changed.</p>
</section>
</section>
</section>


    </div></div>
  </body>
</html>
