<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lynn.github.io/kumdor/">Original</a>
    <h1>The Sword of Kumdor</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        <!-- <p style="float:right;background:#ffc;padding:1em"><a href="#patch">Gimme the patch!</a></p> -->
        
        <blockquote>
          “What&#39;s going on!? A spaceship came crashing down! Oh my stars, look
          at that hole!”
        </blockquote>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/hmm.png" height="64"/> “The Sword of
          Kumdor” (クムドールの剣) is a touch-typing RPG for the
          NEC PC‑98, created by Michiaki Tsubaki in 1991. You play as
          the Milky Way&#39;s #1 typist, summoned to planet Kumdor to
          fight mysterious monsters by typing spells — but you lose all your
          keyboard keys <em>and</em> your QWERTY skills in a crash landing. Can
          you recover your talents and save the world??
        </p>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/ship.png" height="128"/> The game has a
          surreal atmosphere, quirky dialogue, and a distinctive visual style.
          Japanese fansites call it “my favorite childhood RPG” and
          “an underrated masterpiece.” I think it deserves more
          recognition, so I translated the game to English.
        </p>
        <figure>
          <img src="https://lynn.github.io/kumdor/assets/screen3.png" width="640" alt="Arriving on planet
          Kumdor. The player is in a crater created by their own crashed
          spaceship. A villager says: &#39;Look, there&#39;s someone in there. Are they
          alive? ...&#39;" "=""/>
        </figure>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/ponder.png" height="64"/><i>Kumdor</i> has
          the strangest control scheme ever. Outside of combat and
          spell-casting, only the <code>F</code>, <code>J</code>, and
          <code>Space</code> keys are used, so as to keep even a novice typist&#39;s
          hands in the home row position at all times. <code>F</code> walks
          forward and <code>Space</code> turns you 90° clockwise. You get used
          to it, sorta.
        </p>
      </div>
      <div>
        <h2 id="patch">The patch</h2>
        <p>
          Download the translation patch
          <a href="https://lynn.github.io/kumdor/kumdor-english.xdelta" download=""><strong>here</strong></a>.
        </p>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/hero.png" height="64"/> The translation is
          released as an <a href="http://xdelta.org/">xDelta</a> patch. To apply
          it, I suggest you use
          <a href="https://www.romhacking.net/utilities/598/">xdelta UI</a>, but if you prefer using the command line, try:
        </p>
        <pre>xdelta -d -s &#34;The Sword of Kumdor.hdm&#34; kumdor-english.xdelta kumdor-english.hdm</pre>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/machine.png" height="128"/>
          To run the patched game in an emulator, load it into FDD Slot #1 and
          reboot. You will need BIOS files (specifically <code>SOUND.ROM</code>)
          placed in the emulator folder,
          <strong>or else the game crashes</strong> when you walk out of the
          tutorial.
        </p>
        <h3>On typing funny symbols</h3>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/rhand.png" height="64"/>Your keyboard
          likely has fewer keys than the JIS keyboard used by the PC-98. As
          such, when playing in an emulator, you may have trouble typing
          <code>^</code> and <code>_</code>. In Neko Project II, you can use the
          on-screen keyboard, or create a text file next to
          <code>np21w.exe</code> called <code>key.txt</code> with the following
          contents:
        </p>
        <pre>TAB = ^
CTRL = SHIFT _</pre>
        <p>
          Now you can type these symbols by pressing Tab and Ctrl. In general,
          the layout of punctuation is different, so you may have to relearn
          some of the locations. (This might be a bit frustrating, but by the
          end, you will have actually mastered the PC-98 keyboard layout, which
          is the point of the game!)
        </p>
        <figure>
          <img src="https://lynn.github.io/kumdor/assets/screen2.png" width="640" alt="Fighting a monster in Sword of Kumdor. Text on the screen reads, &#39;A monster appears! Eff is casting a spell. 9 points of damage to your opponent!&#39; The player types back spells like &#39;dasafaa dasafaa&#39; using the keyboard to defeat monsters."/>
        </figure>
      </div>
      <div>
        <h2>Links</h2>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/down.png" height="64"/>If you&#39;ve never
          emulated PC-98 games before,
          <a href="https://gang-fight.com/projects/98faq/"><i>PC-98 Emulation For Beginners</i></a>
          is a great resource.
        </p>
        <p>
          My playtesting was greatly assisted by
          <a href="http://rocky75.web.fc2.com/kumu/">rocky75&#39;s fan site</a>,
          which contains a thorough
          <a href="http://rocky75.web.fc2.com/kumu/0.txt">tutorial</a> in
          Japanese. If you&#39;re stuck, I suggest referring to it with the help of
          your favorite machine translation service.
        </p>
        <p>
          I found
          <a href="https://lynn.github.io/kumdor/assets/kumap.jpg">this overworld map (spoiler!)</a> floating
          around on the Internet.
        </p>
        <p>
          You can browse
          <a href="https://archive.org/details/KumdolNoKenMac">the Mac version&#39;s manual</a>: also in Japanese, but contains plenty of cute illustrations.
          (Kumdor was released as a book with the game floppies on the inside.)
        </p>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/robot.png" height="64"/>
          Finally, there&#39;s my
          <a href="https://github.com/lynn/kumdor">code repository</a>, where
          all the translating and patch-writing and sprite-dumping happens.
        </p>
      </div>
      <div>
        <h2>Translation points</h2>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/sit.png" height="64"/>To make a delicious
          keyboard/fruit pun, I translated
          <ruby>クムの木<rt>Kum tree</rt></ruby>
          as &#34;keytree&#34;, so that <ruby>クムの実<rt>Kum fruit</rt></ruby> could be
          &#34;keylime&#34;. That makes <ruby>クム酒<rt>Kum-shu</rt></ruby> &#34;keywine&#34;.
        </p>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/vane.png" height="64"/>The &#34;whithervane&#34;
          is called <ruby>風見ダヌキ<rt>kazami-danuki</rt></ruby>
          (weather-seeing tanuki) in Japanese, which is a play on the actual
          word for a weather-vane,
          <ruby>風見鶏<rt>kazami-dori</rt></ruby> (weather-seeing chicken, like
          &#34;weathercock&#34;).
        </p>
        <p>
          I think the <ruby>ダイビング<rt>diving</rt></ruby> equipment shop that
          pivots into a <ruby>タイピング<rt>typing</rt></ruby> equipment shop is
          a visual kana pun.
        </p>
        <p>
          Fivetown is called <ruby>ヨゴンナ<rt>Yogonna</rt></ruby> in Japanese,
          which is
          <a href="https://en.wikipedia.org/wiki/Japanese_wordplay#Goroawase">goroawase</a>
          for 4567, the keys found there.
        </p>
        <p>
          Translating the spells was interesting: there&#39;s no way to do it
          without affecting the game balance. For example, to cast
          <code>CURE</code>, you need a different set of keyboard keys than for
          the original <code>NAOSU</code>. (Thankfully spells are just not very
          useful anyway! Shop items are easier to get and just as good.)
        </p>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/hero2.png" height="64"/> <i>Kumdor</i>
          came out two years after the highly successful release of
          <i>Mother</i> for the Famicom. There are some similar themes: an alien
          invader causes chaos on a modern low-fantasy planet, RPG tropes are
          subverted and riffed on, and all is resolved in a slightly psychedelic
          final encounter. I can&#39;t say for certain what inspired Tsubaki, but
          some of the &#34;mundanely funny&#34; dialogue in this game reminds me of
          Shigesato Itoi&#39;s style. I often kept the quirky, matter-of-factly
          voice of EarthBound&#39;s localization in the back of my mind when writing
          this translation.
        </p>
        <!--<details>
          <summary>Spoilers!</summary>
          <p>
            In the last dungeon, you meet nine strange foes that aren't named
            after letters or punctuation. They have interesting names and
            absolutely crazy designs. Translating their names was kind of like
            translating Pokémon.
          </p>
          <figure>
            <img src="kumdor-boss.png" alt="The Minibosses of Kumdor." />
          </figure>
          <table style="margin: auto">
            <thead>
              <tr>
                <th>Row</th>
                <th>Japanese</th>
                <th>Interpretation</th>
                <th>English</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="3">Top</td>
                <td>Hidama</td>
                <td>火玉 "fireball"</td>
                <td>Firesoul</td>
              </tr>
              <tr>
                <td>Bō</td>
                <td>棒 "stick"</td>
                <td>Stix</td>
              </tr>
              <tr>
                <td>Senju</td>
                <td>千手 "thousand-armed bodhisattva"</td>
                <td>Thoushand</td>
              </tr>
              <tr>
                <td rowspan="3">Middle</td>
                <td>Kasumi</td>
                <td>霞 "mist, haze"</td>
                <td>Haze</td>
              </tr>
              <tr>
                <td>Uzumaneki</td>
                <td>渦巻 "spiral" + 招き "beckon"</td>
                <td>Spiralure</td>
              </tr>
              <tr>
                <td>Modoki</td>
                <td>もどき "mock, pseudo"</td>
                <td>Mimicky</td>
              </tr>
              <tr>
                <td rowspan="3">Bottom</td>
                <td>Ōnetsu</td>
                <td>大 "big" + 熱 "heat"</td>
                <td>Heatwave</td>
              </tr>
              <tr>
                <td>Ishime</td>
                <td>石目 "grain (of rock)", lit. rock + eye</td>
                <td>Eyeron</td>
              </tr>
              <tr>
                <td>Ryū</td>
                <td>龍 "dragon"</td>
                <td>Qilin</td>
              </tr>
            </tbody>
          </table>
        </details>-->
      </div>
      <div>
        <h2 id="how">How I made this</h2>
        <div>
          <!-- <summary>Technobabble</summary> -->
          <!-- <h3 id="how">Tools</h3> -->
          <p>
            <img src="https://lynn.github.io/kumdor/assets/diamond.png" height="64"/>This
            translation is my first ever romhacking project. I had a lot of fun!
            I used <a href="https://github.com/nmlgc/np2debug">np2debug</a>,
            <a href="https://ghidra-sre.org/">Ghidra</a>, a hex editor, and
            Python. For translation, I relied on my own Japanese-reading and
            English-writing skills.
          </p>
          <h3>Patching text</h3>
          <p>
            <i>Kumdor</i> has a weird custom file system, so I had to treat the
            ROM as a unit rather than dumping files from it. Thankfully, the
            text is almost all consolidated in uncompressed sections of
            null-separated Shift-JIS data, so finding and dumping and
            reimporting it was super easy. Writing translations took about a
            month and a half. The game text is about 7,200 words in English.
          </p>
          <figure>
            <img src="https://lynn.github.io/kumdor/assets/tl.png" alt="Translating text strings."/>
          </figure>

          <h3>&#34;Touch typing&#34; means...</h3>
          <p>
            This intro was difficult to translate. The handwritten text is
            stored as thousands of little line segment coordinates in a strange
            data layout. I reverse-engineered the format by corrupting the data
            in weird ways and seeing what happens. Then I programmed a tool for
            editing this format, and handwrote a translation with a tablet pen.
            (You can see the process
            <a href="https://twitter.com/chordbug/status/1598341221008687104">here</a>.)
          </p>
          <figure>
            <img src="https://lynn.github.io/kumdor/assets/intro.png" alt="Left: the untranslated tutorial. Right: my handwritten translation."/>
          </figure>

          <h3>Removing copy protection</h3>
          <p>
            The popular dump of this game that floats around online triggers a
            copy protection check that freezes the game right before the final
            dungeon! I never really bothered to figure out what exactly it&#39;s
            checking. I used a debugger and Ghidra to find the instruction
            responsible for locking up the game, and disabled it.
          </p>
          <figure>
            <img src="https://lynn.github.io/kumdor/assets/ghidra.png" alt="Looking at disassembled source code in Ghidra."/>
          </figure>
          <h3>An overly elaborate grammar fix</h3>
          <p>
            <img src="https://lynn.github.io/kumdor/assets/computer.png" height="64"/> When picking
            up an item, the game joins two strings together with code somewhat
            like this:
          </p>
          <pre>pick_up_item:
  ...
  mov di, 0xc000            
  <span>mov cl, al                
  call write_item_name      </span>
  <span>mov cl, 0x1b              
  call write_common_string  </span>
  ...</pre>
          <p>
            This builds a string like
            <code>&#34;<span>呪文書</span><span>を拾った。</span>&#34;</code>, which I can only translate part-by-part as
            <code>&#34;<span>scroll</span><span> was obtained.</span>&#34;</code>. The grammar is awkward, and as
            a full sentence, it&#39;s missing capitalization.
          </p>
          <p>
            Dissatisfied, I got my hands dirty and wrote some assembly patches to
            print my own bits of text. I had to figure out a way to inject code
            of my own without moving any of the surrounding code, as that would
            dislocate a bunch of pointers.
          </p>
          <pre>pick_up_item:
  ...
  <s>mov di, 0xc000</s>            
  <span>call you_got_a            </span>
  <span>mov cl, al
  call write_item_name</span>
  <span>mov cl, 0x1b              
  call write_common_string</span>
  ...



<span>you_got_a:
  <span>mov di, 0xc000            </span>
  push ax
  mov cl, 0x60              
  call write_common_string  
  pop ax
  ret</span></pre>
          <p>
            All to get nice messages like
            <code><span>&#34;You got a </span><span>scroll</span><span>.</span>&#34;</code>. It was totally worth it.
          </p>
        </div>
      </div>
      <div>
        <h2>Thanks</h2>
        <ul>
          <li>PasokonDeacon, for playtesting and providing errata.</li>
          <li>SpeedyNoelle, for helping me get the game running at all.</li>
          <li>
            The PC-9800 Series Central Discord, for encouraging me to finish
            this thing.
          </li>
          <li>fluidvolt, for everything &lt;33</li>
        </ul>
      </div>

      <div>
        <h2>Bonus: Music</h2>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/guy.png" height="64"/>The game&#39;s
          soundtrack is a bit <em>outré</em> so I turned it off after an hour or
          so. I listened to suitably psychedelic electronic music instead and I
          can highly recommend this. For example:
        </p>
        <ul>
          <li>BBC Radiophonic Workshop</li>
          <li>Boards of Canada</li>
          <li>Gershon Kingsley</li>
          <li>Mort Garson</li>
          <li>Plone</li>
          <li>Raymond Scott</li>
        </ul>
        <p>
          <img src="https://lynn.github.io/kumdor/assets/zzz.png" height="64"/>Sorry, let me
          collapse somewhere out of your way.
        </p>
        <p>— <a href="https://foldr.moe">Lynn</a></p>
      </div>
    </div></div>
  </body>
</html>
