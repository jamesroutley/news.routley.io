<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/dzove855/Bash-web-server">Original</a>
    <h1>Pure Bash Web Server</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A purely bash web server, no socat, netcat, etc...</p>

<ul dir="auto">
<li>bash 5.2 (The patch will be included in bash5.2 - Alpha release already contains the patch)</li>
<li>if bash version is under 5.2, patched loadable accept builtin (<a href="http://git.savannah.gnu.org/cgit/bash.git/tree/examples/loadables/accept.c" rel="nofollow">http://git.savannah.gnu.org/cgit/bash.git/tree/examples/loadables/accept.c</a>) is needed, you have to apply accept.patch to your loadable accept.c file which is existed in bash source code, and than build and install the loadable accept builtin into BASH_LOADABLE_PATH specified in <code>bash-server.sh</code></li>
</ul>

<p dir="auto">The port can be set by the env var: HTTP_PORT</p>
<p dir="auto">The path to accept (Directory) can be set by using: BASH_LOADABLE_PATH</p>
<p dir="auto">Server Methods:</p>
<ul dir="auto">
<li>serveHtml (needs DOCUMENT_ROOT envvars) - This will serve the static files</li>
<li>script file - The script need a file as first argument which will be source. The file will need a function named runner, which will be run on each request</li>
</ul>
<p dir="auto">Basic authentication can be enabled by env var: NEED_AUTH, accounts and passwords are stored in users.csv</p>

<p dir="auto">Well there&#39;s a little problem... since accept doesn&#39;t close the connection (Or i&#39;m doing something wrong), the connection will go into TIME_WAIT.
This means that we need to wait the time the connection will be closed, after that we can reopen a connection.
I will have a look at the source code and probably provide some options, like a bind-address and a close when the FD is closed.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-update" aria-hidden="true" tabindex="-1" href="#update"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>UPDATE:</h3>
<p dir="auto">Accept has been patched by me. Now we can handle multiple request at the same time, without waiting the TIME_WAIT.</p>
<p dir="auto">To use the new accept, you will need to compile the accept from this repo, a pull request will be send to bash, but it will take some time.</p>
<p dir="auto">Now we can run multiple connection on the same time, since the connection is running in a subshell.</p>

<p dir="auto">Busion is used to source some functions from other repositorys instead of copy/paste (<a href="https://github.com/dzove855/busion">https://github.com/dzove855/busion</a>)</p>

<ul>
<li> Implement logging and provide a logging format like httpd</li>
<li> Implement multi processing (this will be a huge step, but we need to patch accept)</li>
<li> Implement urlencode/decode to provide readable get data</li>
<li> Implement content-type detection - Use mime type like nginx</li>
<li> Add basic auth</li>
<li> Add cookie handler</li>
<li> Add session handler</li>
</ul>
</article></div></div>
  </body>
</html>
