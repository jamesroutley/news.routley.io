<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mabez.dev/blog/posts/esp-rust-29-09-2023/">Original</a>
    <h1>Rust on Espressif chips</h1>
    
    <div id="readability-page-1" class="page"><div>
        
	  <p>This is the next quarterly update of the esp-rs effort, detailing the progress over Q3 2023.</p>
<h2 id="rust-xtensa-compiler">Rust Xtensa Compiler</h2>
<p>We had one big bugfix around hardware <a href="https://github.com/esp-rs/rust/issues/180">floating point unit for ESP32 &amp; ESP32-S3</a>, shout out to <a href="https://github.com/zRedShift">@zRedShift</a> for finding the bug and providing the fix in <a href="https://github.com/espressif/llvm-project/pull/76">llvm-project#76</a>. Along with the bugfix, <a href="https://github.com/zRedShift">@zRedShift</a> also contributed two code generation improvement patches, one to improve the performance of <a href="https://github.com/espressif/llvm-project/pull/77"><code>cttz</code></a> and another to improve the performance of <a href="https://github.com/espressif/llvm-project/pull/78"><code>abs</code>, <code>min</code> and <code>max</code></a>. The Xtensa-related LLVM patches upstream are still in review but are slowly making progress.</p>
<h2 id="esp-hal-no-std">esp-hal - no_std</h2>
<p>Q3 saw the <code>v0.11</code> and <code>v0.12</code> release of esp-hal. Highlights include updating the <code>embedded-hal-*</code> packages to <code>1.0.0-rc.1</code>, ready for the long awaited <code>1.0</code> release of <code>embedded-hal</code>; The addition of deep-sleep support for the <code>ESP32-S3</code>, and new cryptographic accelerator support for ECC, HMAC and RSA. We&#39;ve made a start on adding support for the low-power core of the ESP32-C6, with some basic GPIO drivers and support for loading the LP code from the main core. Check out the full <a href="https://github.com/esp-rs/esp-hal/blob/main/CHANGELOG.md">changelog</a> for all the details.</p>
<h2 id="esp-wifi-no-std">esp-wifi - no_std</h2>
<p>We added BLE support for the ESP32-C6 in <a href="https://github.com/esp-rs/esp-wifi/pull/262">esp-wifi#262</a>, improved the esp-now async API in <a href="https://github.com/esp-rs/esp-wifi/pull/232">#232</a> along with a bunch of other smaller fixes and improvements! We&#39;re gearing up for our first crates.io release, which is long overdue. We&#39;ve had all the pieces in place for a release, we just didn&#39;t get around to doing it! We&#39;re currently in the process of improving the docs, and doing some final testing before the release.</p>
<h2 id="esp-idf-hal-std">esp-idf-hal - std</h2>
<p>Async I2S, SPI, ADC and GPIO were added in <a href="https://github.com/esp-rs/esp-idf-hal/pull/279">esp-idf-hal#279</a>, with a follow up PR for UART in <a href="https://github.com/esp-rs/esp-idf-hal/pull/306">esp-idf-hal#306</a>. Huge props to <a href="https://github.com/ivmarkov">@ivmarkov</a> for the tremendous effort here. From the latest <code>v0.42.0</code> release, ESP-IDF version 4.3 is now deprecated for use with Rust. Please see <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/versions.html#support-periods">ESP-IDFs support schedule</a> for upgrade paths. See the full changelog for esp-idf-hal <a href="https://github.com/esp-rs/esp-idf-hal/blob/master/CHANGELOG.md">here</a>.</p>
<h2 id="esp-idf-svc-std">esp-idf-svc - std</h2>
<p>Bluetooth classic support (for the esp32 only at the moment) has been added, behind the <code>experimental</code> feature flag; BLE is also planned. We are also discussing how to go about adding generic Bluetooth traits in embedded-svc, <a href="https://github.com/esp-rs/embedded-svc/issues/32">here</a>. From the latest release, it will no longer be required to depend on the esp-idf-sys crate or the esp-idf-hal crate directly in your project, instead, this crate will be re-exported by esp-idf-svc as <code>esp_idf_svc::sys</code> and <code>esp_idf_svc::hal</code> respectively.</p>
<h2 id="matter-rs-rs-matter">matter-rs / rs-matter</h2>
<p>rs-matter (previously, matter-rs, but has been renamed due to an existing crate registered on crates.io) has had its first crates.io release! It is now async first (executor agnostic), with support for no_std out of the box, even including QR generation. The rs-matter repo now <a href="https://github.com/project-chip/rs-matter">has some examples</a> which can be run on std platforms, including the espidf std port! For <code>no_std</code> there are two examples of matter usage, <a href="https://github.com/bjoernQ/matter-rs-experiment">one using an esp32c3 (blocking)</a> and another using <a href="https://github.com/ivmarkov/rp-matter">a rp-2040 (async)</a>.</p>

<h3 id="espflash">espflash</h3>
<p>Just a small patch release to report, <code>v2.0.1</code> which added more help text on the CLI commands, and fixed a compilation issue in the <code>cargo</code> dependency.</p>
<h3 id="espsegs">espsegs</h3>
<p><a href="https://github.com/bjoernQ/espsegs">espsegs</a> is a tool to see what memory is being used by which sections and where on an esp. Once installed, you can simply point the tool to an elf file, and you&#39;ll get an output like below:</p>
<pre><code><span>❯ espsegs target\riscv32imc-unknown-none-elf\release\examples\embassy_dhcp --chip esp32c3
</span><span>
</span><span>.text_dummy  3c000000  458784 DROM  [█████████████                                           ]
</span><span>.rodata      3c070020   53060 DROM  [             █                                          ]
</span><span>.rodata.wifi 3c07cf64   21756 DROM  [              ▏                                         ]
</span><span>
</span><span>.rwdata_dumm 3fc80000   16948 DRAM  [██████                                                  ]
</span><span>.data        3fc84238    4652 DRAM  [      █                                                 ]
</span><span>.bss         3fc85468  121544 DRAM  [       ████████████████████████████████████████████     ]
</span><span>.data.wifi   3fca2f30     360 DRAM  [                                                    ▏   ]
</span><span>
</span><span>.trap        40380000    3188 IRAM  [    ▏                                                   ]
</span><span>.rwtext      40380c74    2080 IRAM  [     ▏                                                  ]
</span><span>.rwtext.wifi 40381494   11680 IRAM  [      ███                                               ]
</span><span>
</span><span>.text_init   42000020     244 IROM  [▏                                                       ]
</span><span>.text        42000114  402684 IROM  [███████████                                             ]
</span></code></pre>
<h2 id="rfcs">RFCs</h2>
<p>This section is mainly for users of esp-rs; we have various issues open in which we would like user feedback.</p>
<h3 id="esp-hal">esp-hal</h3>
<p>We are considering removing direct-boot support: <a href="https://github.com/esp-rs/esp-hal/issues/803">esp-hal#803</a>, if you think this might affect you, please state your case in that issue.</p>
<h2 id="talks">Talks</h2>
<p>Espressif recently hosted their annual developer conference, Espressif DevCon. Myself and my colleague <a href="https://github.com/JurajSadel">Juraj Sadel</a> did a short talk on using async in Rust, which you can check out below.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/QPp4WEjx5jU?si=ezdXBmUTHmCxFWk_" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
<p>I also did a talk at <a href="https://www.meetup.com/copenhagen-rust-community/">the Rust Copenhagen monthly meet up</a> in August. This talk is more focused on introducing embedded programming to those who already know Rust. Check it out below if you are interested.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/gdmUhzJfgzk?si=GA7F_QyzQU3X198S" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>
</div></div>
  </body>
</html>
