<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://thomasweng.com/pytorch_ros/">Original</a>
    <h1>Deploying Python 3 PyTorch Networks in Python 2 for ROS</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p>Scenario: you train a neural network in Python 3 with PyTorch, and want to deploy your network on a real robot using <a href="https://wiki.ros.org/">ROS</a>. However, ROS only supports Python 2 packages, and getting ROS to work with Python 3 is difficult.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" rel="footnote">1</a></sup></p>

<p>While <a href="https://docs.ros.org/en/rolling/index.html">ROS 2</a> does have support for Python 3, it is still in development. In the meantime, here is a possible workaround for running Python 3 networks on ROS 1.</p>

<p>The workaround is to load the weights of a Python 3 PyTorch model, process the weights into a format compatible with Python 2 PyTorch, then save the output as a text file to be loaded in Python 2.</p>

<p>In the following gist, <code>module_save_util.py</code> processes the Python 3 model and saves the weights for Python2: <a href="https://gist.github.com/thomasweng15/f0de0a3a0e91e5d50c867274dae0d821">link to gist</a>. <code>module_load_util.py</code> can then be called in Python 2 to load the processed weights.</p>

<p>In our case, we trained networks with PyTorch 1.8.0/1.8.1 and deployed with PyTorch 1.3.1. I cannot give any guarantees on whether the performance is the same after porting the weights to Python 2, though in my own experiments I did not see a drop. That said, it has been a while since I have done this solution so your mileage may vary.</p>

<p>Others at the Robotics Institute have proposed the following solutions, though I havenâ€™t tried them myself:</p>
<ul>
  <li>Write your learning node in C++ and load your PyTorch model with libtorch</li>
  <li><a href="https://robostack.github.io/">https://robostack.github.io/</a></li>
  <li><a href="https://medium.com/@beta_b0t/how-to-setup-ros-with-python-3-44a69ca36674">Medium: How to setup ROS with Python 3</a></li>
</ul>

<p>Credit goes to <a href="https://www.linkedin.com/in/sujay-bajracharya/">Sujay Bajracharya</a> for developing the solution in this post! If there is code in the gist above from other sources, I am happy to give credit as well.</p>

<p>Full gist:
</p>

<hr/>
<p>Footnotes</p>



  </div></div>
  </body>
</html>
