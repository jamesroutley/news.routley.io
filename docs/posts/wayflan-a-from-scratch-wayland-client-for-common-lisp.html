<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sr.ht/~shunter/wayflan/">Original</a>
    <h1>Wayflan: a from-scratch Wayland client for Common Lisp</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<div>
<div><h2 id="wayflan"><a href="#wayflan" rel="nofollow noopener">#</a>Wayflan</h2>
<p><a href="https://builds.sr.ht/~shunter/wayflan/commits/master/test.yml" rel="nofollow noopener"><img alt="builds.sr.ht status" src="https://builds.sr.ht/~shunter/wayflan/commits/test.yml.svg"/></a>
<a href="https://quickdocs.org/wayflan" rel="nofollow noopener"><img alt="Quicklisp status" src="https://quickdocs.org/badge/wayflan.svg"/></a></p>
<p><img alt="The library brand image: a crudely drawn plate of flan with an W on the roof" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/brand.png"/></p>
<p>Wayflan is a from-scratch Wayland client for Common Lisp. It does not bind to
the reference implementation <a href="https://wayland.freedesktop.org/" rel="nofollow noopener">libwayland</a>,
but rather writes to a Wayland socket directly. This gives Wayflan better
opportunity to integrate with Common Lisp&#39;s features without having to deal
with the drawbacks of C bindings -- and C callbacks.</p>
<p>Wayflan makes a good-faith effort to mimic libwayland behavior made outside the
Wayland spec, such as sending message data and file descriptors in the same
message, and searching for Wayland compositor sockets in the same path.</p>
<p><em>Wayflan is an ongoing project. Things may change to make Wayflan the best
client for Common Lisp projects, including making a better API. If you use
Wayflan in any projects, let me know! I&#39;d love to give a heads up and help
transition projects to any breaking changes I make along the way.</em></p>
<h3 id="features"><a href="#features" rel="nofollow noopener">#</a>Features</h3>
<ul>
<li>Closures can be used as callbacks</li>
<li>Enum values are translated into keywords</li>
<li><code>wl-include</code> generates code to implement protocol XML files</li>
</ul>
<h3 id="documentation"><a href="#documentation" rel="nofollow noopener">#</a>Documentation</h3>
<ul>
<li><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/doc/Getting-Started-With-Wayflan.md" rel="nofollow noopener">Getting Started with Wayflan</a></li>
<li><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/doc/API-Reference.md" rel="nofollow noopener">API Reference</a></li>
<li><a href="https://wayland.freedesktop.org/" rel="nofollow noopener">Wayland Home Page</a></li>
<li><a href="https://wayland-book.com/" rel="nofollow noopener">Wayland Book</a> - Teaches Wayland fundamentals and shares examples in C.</li>
<li><a href="https://wayland.app/protocols/" rel="nofollow noopener">Wayland Explorer</a> - Browse Wayland protocols online</li>
</ul>
<h3 id="quickstart"><a href="#quickstart" rel="nofollow noopener">#</a>Quickstart</h3>
<p>This is a brief version of the <a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/hello-world.lisp" rel="nofollow noopener">Hello World</a> example.</p>
<p>This snippet connects to a Wayland compositor to print all global variables the
client can bind to:</p>
<div><pre><span></span><span>(</span><span>require</span> <span>:wayflan</span><span>)</span> <span>;; or (require :wayflan-client)</span>
<span>(</span><span>use-package</span> <span>:wayflan-client</span><span>)</span>

<span>(</span><span>defun</span> <span>run</span> <span>()</span>
  <span>;; Try to connect to a compositor socket at $XDG_RUNTIME_DIR/$WAYLAND_DISPLAY.</span>
  <span>;; If $WAYLAND_DISPLAY describes an absolute path, connect to that directly.</span>
  <span>(</span><span>with-open-display</span> <span>(</span><span>display</span><span>)</span>
    <span>;; Create a registry to provide a list of all</span>
    <span>;; globals the client can bind to.</span>
    <span>(</span><span>let</span> <span>((</span><span>registry</span> <span>(</span><span>wl-display.get-registry</span> <span>display</span><span>)))</span>
      <span>;; Push an event-listening closure to a list that is called</span>
      <span>;; whenever the registry receives an event.</span>
      <span>(</span><span>push</span> <span>(</span><span>lambda</span> <span>(</span><span>event-name</span> <span>&amp;rest</span> <span>event-args</span><span>)</span>
              <span>;; The macro EVCASE dispatches based on the event automatically.</span>
              <span>;; See examples/hello-world.lisp</span>
              <span>(</span><span>when</span> <span>(</span><span>eq</span> <span>event-name</span> <span>:global</span><span>)</span>
                <span>(</span><span>destructuring-bind</span> <span>(</span><span>name</span> <span>interface</span> <span>version</span><span>)</span> <span>event-args</span>
                  <span>;; Print all globals, their interface names, and latest</span>
                  <span>;; supported version</span>
                  <span>(</span><span>format</span> <span>t</span> <span>&#34;#x~8,&#39;0X ~32S v~D~%&#34;</span>
                          <span>name</span> <span>interface</span> <span>version</span><span>))))</span>
            <span>(</span><span>wl-proxy-hooks</span> <span>registry</span><span>))</span>

      <span>;; Listen until all wl-registry events are processed</span>
      <span>(</span><span>format</span> <span>t</span> <span>&#34;wl-registry globals:~%&#34;</span><span>)</span>
      <span>(</span><span>wl-display-roundtrip</span> <span>display</span><span>))))</span>
</pre></div>
<p><strong>Output:</strong> (Abridged, YMMV)</p>
<div><pre><span></span><span>wl-registry</span> <span>globals:</span>
<span>#x00000001</span> <span>&#34;wl_shm&#34;</span>                         <span>v1</span>
<span>#x00000002</span> <span>&#34;wl_drm&#34;</span>                         <span>v2</span>
<span>#x00000004</span> <span>&#34;wl_compositor&#34;</span>                  <span>v4</span>
<span>#x00000005</span> <span>&#34;wl_subcompositor&#34;</span>               <span>v1</span>
<span>#x00000006</span> <span>&#34;wl_data_device_manager&#34;</span>         <span>v3</span>
<span>#x0000000C</span> <span>&#34;xdg_wm_base&#34;</span>                    <span>v2</span>
<span>#x00000012</span> <span>&#34;wp_presentation&#34;</span>                <span>v1</span>
<span>#x00000018</span> <span>&#34;wp_drm_lease_device_v1&#34;</span>         <span>v1</span>
<span>#x0000001D</span> <span>&#34;wp_viewporter&#34;</span>                  <span>v1</span>
<span>#x00000022</span> <span>&#34;xdg_activation_v1&#34;</span>              <span>v1</span>
<span>#x00000027</span> <span>&#34;wl_seat&#34;</span>                        <span>v7</span>
<span>#x00000029</span> <span>&#34;wl_output&#34;</span>                      <span>v4</span>
</pre></div>
<h3 id="more-examples"><a href="#more-examples" rel="nofollow noopener">#</a>More Examples</h3>
<p><strong><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/checkerboxed-demo.lisp" rel="nofollow noopener">Moving Checkerboard Demo</a></strong></p>
<p><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/checkerboxed-demo.lisp" rel="nofollow noopener"><img alt="Screenshot of checkerboxed-demo" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/examples/checkerboxed-demo.jpg"/></a></p>
<p><strong><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/cairo-demo.lisp" rel="nofollow noopener">Cairo Demo</a></strong></p>
<p><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/cairo-demo.lisp" rel="nofollow noopener"><img alt="Screenshot of cairo-demo" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/examples/cairo-demo.jpg"/></a></p>
<p><strong><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/wl-pointer-demo.lisp" rel="nofollow noopener">wl-pointer Demo</a></strong></p>
<p><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/wl-pointer-demo.lisp" rel="nofollow noopener"><img alt="Screenshot of wl-pointer-demo" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/examples/wl-pointer-demo.jpg"/></a></p>
<p><strong><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/wl-touch-demo.lisp" rel="nofollow noopener">wl-touch Demo</a></strong></p>
<p><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/wl-touch-demo.lisp" rel="nofollow noopener"><img alt="Screenshot of wl-touch-demo" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/examples/wl-touch-demo.jpg"/></a></p>
<p><strong><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/wl-keyboard-demo.lisp" rel="nofollow noopener">wl-keyboard Demo</a></strong></p>
<p><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/wl-keyboard-demo.lisp" rel="nofollow noopener"><img alt="Screenshot of wl-keyboard-demo" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/examples/wl-keyboard-demo.jpg"/></a></p>
<p><strong><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/Waycalc.lisp" rel="nofollow noopener">Waycalc</a></strong></p>
<p><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/Waycalc.lisp" rel="nofollow noopener"><img alt="Screenshot of Waycalc" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/examples/Waycalc.jpg"/></a></p>
<p><strong><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/Wayruler.lisp" rel="nofollow noopener">Wayruler</a></strong></p>
<p><a href="https://git.sr.ht/~shunter/wayflan/tree/HEAD/examples/Wayruler.lisp" rel="nofollow noopener"><img alt="Screenshot of Wayruler" src="https://git.sr.ht/~shunter/wayflan/blob/HEAD/examples/Wayruler.jpg"/></a></p>
<h3 id="dependencies"><a href="#dependencies" rel="nofollow noopener">#</a>Dependencies</h3>
<p>While these systems aren&#39;t a hard requirement, the examples make use of them,
and I recommend their use in your own applications:</p>
<ul>
<li><strong><a href="https://git.sr.ht/~shunter/posix-shm" rel="nofollow noopener">posix-shm</a></strong>, to create shared
memory objects for use in <code>wl-shm-pool</code>s.</li>
<li><strong>cl-cairo2</strong>, <strong>cl-pango</strong>, and <strong>cl-colors</strong> all combine together to
provide tooling for drawing to a buffer.</li>
<li><strong><a href="https://github.com/malcolmstill/cl-xkb/" rel="nofollow noopener">cl-xkb</a></strong> and
<strong>input-event-codes</strong>, to process keyboard events and mouse buttons,
respectively.</li>
</ul>
<p>Of these, <a href="https://git.sr.ht/~shunter/posix-shm" rel="nofollow noopener">posix-shm</a> and
<a href="https://github.com/malcolmstill/cl-xkb/" rel="nofollow noopener">cl-xkb</a> have been developed in
lock-step with Wayflan, so you might need to pull these to your workstation
directly.</p>
</div>
</div>
</div>
</div></div>
  </body>
</html>
