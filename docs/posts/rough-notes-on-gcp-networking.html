<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vishnubharathi.codes/blog/rough-notes-on-google-cloud-networking/">Original</a>
    <h1>Rough notes on GCP networking</h1>
    
    <div id="readability-page-1" class="page"><div>
        
        <article itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    



    
  </header>
  

  <div itemprop="articleBody">
    <p>I am publishing my rough notes on Google Cloud networking which I collected while watching the first few episodes of the <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=0hN-dyOV10c&amp;list=PLDGXb-1k3XY1RaEfzp_nDSJMPP0iAQEtP">Google Cloud Networking playlist</a>. lol, I don’t know how many more times I will need to revise them.</p>
<p>(Any images seen here are attributed to the presentation in the video series mentioned above. This blog post is more like watching those videos on fast-forward and I would definitely encourage you to check out the videos if you would like more clarity)</p>
<h2 id="VPC"><a href="#VPC" title="VPC"></a>VPC</h2><ul>
<li>VPC is a global construct<ul>
<li>You can create subnets that belong to a different region</li>
</ul>
</li>
<li>Shared VPC<ul>
<li>One host project has VPC and subnets</li>
<li>Share all or some subnets with other projects that host the project-level service</li>
</ul>
</li>
</ul>
<h2 id="Interconnecting-to-Google-Cloud"><a href="#Interconnecting-to-Google-Cloud" title="Interconnecting to Google Cloud"></a>Interconnecting to Google Cloud</h2><ul>
<li>Layer 3<ul>
<li>Dedicated (Direct peering)</li>
<li>Shared (Carrier peering)</li>
<li>Needs VPN setup to tunnel into private address space</li>
<li>No SLAs</li>
<li>Free of cost (but check latest)</li>
</ul>
</li>
<li>Layer 2<ul>
<li>Dedicated Interconnect<ul>
<li>Costly (because Gcloud has dedicated hardware)</li>
<li>Dedicated bandwidth</li>
</ul>
</li>
<li>Partner Interconnect<ul>
<li>Example: Equinix fabric</li>
<li>Shared bandwidth other people who are using the interconnect</li>
</ul>
</li>
<li>Has SLA</li>
</ul>
</li>
</ul>
<h2 id="Routing"><a href="#Routing" title="Routing"></a>Routing</h2><ul>
<li>Pre-programmed routes<ul>
<li>Automatically created.</li>
<li>User can’t delete or change these routes</li>
<li>Subnet routes are automatically created when a subnet is added to the network</li>
</ul>
</li>
<li>Default routes<ul>
<li>Pre-programmed 0.0.0.0/0 route to an internet gateway</li>
<li>Unlike pre-programmed routes, this can be changed.</li>
</ul>
</li>
<li>Cloud Router (CR)</li>
<li>Advanced Route<ul>
<li>Static forwarding to a VPN gateway when cloud routers/dynamic routing isn’t used.</li>
<li>Force some IPs to be routed to a third-party service</li>
</ul>
</li>
</ul>
<h2 id="VPC-Peering"><a href="#VPC-Peering" title="VPC Peering"></a>VPC Peering</h2><ul>
<li>In case of VPNs, you can adverstise only a few subnets between network. In case of VPC peering, it is binary. All subnets in VPC A will get advertised to all subnets in VPC B and vice versa. You are basically smashing two VPCs.</li>
<li>Security policies still exist in both the VPCs and there is no “single” security policy for the smashed up VPC. So, if something is going wrong, check the firewall rules associated with both VPCs.</li>
<li>Can not have overlapping IP ranges</li>
<li>Non-transitive in nature</li>
<li>Quotas and Limits:<ul>
<li>15,500 total VMs across all peering relationships</li>
<li>A network can have upto 25 peered networks</li>
</ul>
</li>
</ul>
<h2 id="Load-Balancers"><a href="#Load-Balancers" title="Load Balancers"></a>Load Balancers</h2><ul>
<li>Families (based on where they face)<ul>
<li>External load balancer: Internet-facing</li>
<li>Internal load balancer: Internal to google cloud</li>
</ul>
</li>
<li>Families (based on where they route to)<ul>
<li>Global</li>
<li>Regional</li>
</ul>
</li>
<li>Families (based on the level they operate at)<ul>
<li>Network Load balancers<ul>
<li>Layer 3 and 4.</li>
<li>These are external load balancers (internet-facing)</li>
<li>These are regional load balancers.</li>
<li>Highly available with multiple zones</li>
<li>Load balance TCP/UDP traffic and does not look at L7</li>
<li>Client IP is preserved, don’t need x-forwarded-for</li>
<li>It does not perform SSL termination, so your backend needs to do it</li>
<li>Client access can be controlled with the VPC Firewall</li>
<li>Balances traffic using 2, 3, or 5-tuple hashing<ul>
<li>2 tuple: {sourceIp, destIP}</li>
<li>3 tuple: {sourceIp, destIP, Protocol}</li>
<li>5 tuple: {sourceIp, destIP, sourcePort, destPort, Protocol}</li>
</ul>
</li>
<li>Session Affinity based on IP address</li>
<li>High performance = 1 million+ requests per second</li>
</ul>
</li>
<li>DNS-based Global LB<ul>
<li>This is how traditional public cloud usually had load balancing. But not how Google cloud load balancing works.</li>
<li><img src="https://github.com/scriptnull/vishnubharathi.codes/assets/4211715/145bb23d-d996-4292-bf20-26cbfc880b2b" alt="image"/></li>
<li>IP address of servers in different region are added as DNS entries for the domain.</li>
<li>The DNS server gives back the IP address when requested in a load balancer fashion (like round robin)</li>
<li>Disadvantage: DNS caching happens at multiple places (web browsers, internet providers ec.), so it might be pointing to a invalid IP address at one of those layers</li>
</ul>
</li>
<li>Google Global Load Balancer (L7)<ul>
<li>Built for powering Google search, Gmail and other Google products and then adopted inside Google cloud</li>
<li><img src="https://github.com/scriptnull/vishnubharathi.codes/assets/4211715/0e178e1f-c9c9-472b-9506-f76385ae5870" alt="image"/></li>
</ul>
</li>
<li>Single Global Anycast VIP (IPv4/IPv6) across region</li>
<li>Cross-region failure and fallback</li>
<li>Fast autoscaling</li>
<li>Highly available</li>
<li>Single point to apply global policies</li>
</ul>
</li>
<li>Internal Load Balancers<ul>
<li><img src="https://github.com/scriptnull/vishnubharathi.codes/assets/4211715/e918cf25-7f13-4697-8fb2-a8550125a5b0" alt="image"/></li>
</ul>
</li>
<li>L4 Regional LB<ul>
<li>Internal (RFC 1918) VIP</li>
<li>Client IP Preserved</li>
<li>TCP, HTTP, HTTPS health checks</li>
<li>No middle proxy (delivered through SDN), High performance, and no chokepoints</li>
</ul>
</li>
</ul>

  </div>
</article>



        
          

        
        

    </div></div>
  </body>
</html>
