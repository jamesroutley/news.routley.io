<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.draketo.de/software/guile-10x">Original</a>
    <h1>How GNU Guile is 10x better (2021)</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
<header>

<p role="doc-subtitle">#4 will shock you! :-)</p>
</header>



<p>
In <a href="https://www.youtube.com/watch?v=kylqq8pEgRs&amp;list=PL85XCvVPmGQhDOUIZBe6u388GydeACbTt&amp;index=8">Rust at Facebook by Fitzhardinge of the Mercurial team</a>, Jeremy says
that a new language must be 10x better at <b>something</b> than one of the
(other) incumbent languages.
</p>

<p>
So I asked on IRC: what’s the 10x advantage of <b><a href="http://gnu.org/s/guile">Guile</a></b>?
</p>

<p>
<i>This is not „which Scheme to choose“ (aside from one specific feature). For that question, see the <a href="https://wingolog.org/archives/2013/01/07/an-opinionated-guide-to-scheme-implementations">opinionated guide to scheme implementations</a>. For Guile&#39;s 10x advantages (some due to being Scheme), read on.</i>
</p>

<div markdown="1">
<p><a href="https://www.draketo.de/software/guile-10x.pdf"><img width="168" height="235" title="PDF" src="https://www.draketo.de/assets/pdf-thumbnail.png"/></a></p></div>
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>

</nav>
<div id="outline-container-powerful-core">
<h2 id="powerful-core"><span>1.</span> powerful core</h2>
<div id="text-powerful-core">
<p>
Macros (<code>define-syntax</code>) and <i>delimited continuations</i> enable creation of
high level concepts like <a href="https://github.com/wingo/fibers">fibers</a> without having to change the core.
</p>

<p>
Thanks to the efficient compiler, there is rarely a need to use macros
for performance instead of for semantics, so your code stays cleaner.
</p>

<p>
<i>thanks to stis.</i>
</p>

<blockquote>
<p>
“Delimited continuations are superior to Python&#39;s yield, the macrology
is superior to any language except Scheme, the hackability is better
then essentially all closed sorurce solutions of program languages.</p>
</blockquote>
</div>
</div>
<div id="outline-container-runtime-introspection-modification">
<h2 id="runtime-introspection-modification"><span>2.</span> runtime introspection and modification</h2>
<div id="text-runtime-introspection-modification">
<p>
Compared to C and Go, runtime access to running code is very useful.
You can jump into a module and modify anything during runtime.
</p>

<p>
<i>thanks to str1ngs for this point.</i>
</p>

<p>
While you even get a subset of this with Java using incremental
compilation and hot reloading of code in IntelliJ, at work we’re always
dancing around changes that change some method arguments or streams,
because those break hot reloading so you have to restart.
</p>

<p>
And for Javascript we can in theory replace every function, but in
practice at work we transpile everything with babel and webpack and
that breaks hot reloading, so we have to reload after every change.
</p>

<p>
In Guile you can either start in a REPL, or create a dedicated REPL in
the running program, or create a REPL socket for your development
environment and connect to that to hack on the running server.
</p>

<p>
Then you can re-define all top-level definitions in all modules.
</p>

<p>
As example str1ngs usually develops the <a href="http://www.nongnu.org/nomad/">Nomad web browser</a> like that.
</p>

<p>
And if you need a game loop as main thread, you can use it to drive the <a href="https://www.gnu.org/software/guile/docs/docs-2.2/guile-ref/Cooperative-REPL-Servers.html">cooperative repl server</a>.
</p>
</div>
</div>
<div id="outline-container-s-exps-Homoiconicity">
<h2 id="s-exps-Homoiconicity"><span>3.</span> s-expressions and homoiconicity</h2>
<div id="text-s-exps-Homoiconicity">
<p>
Compared to non-lisp languages, the regularity of s-expressions and
being able to treat code as data and the other way round
(<a href="https://en.wikipedia.org/wiki/Homoiconicity">homoiconicity</a>) is a big advantage.
</p>

<p>
<i>thanks to pinoaffe for this point.</i>
</p>

<p>
This is an essential elegance <a href="http://www.draketo.de/proj/wisp/why-wisp.html">I want to conserve in wisp</a>.
</p>

<p>
Wikipedia notes as advantage that 
</p>

<blockquote>
<p>
extending the language with new concepts typically becomes simpler, as data representing code can be passed between the meta and base layer of the program. — <a href="https://en.wikipedia.org/w/index.php?title=Homoiconicity&amp;oldid=1037434473#Uses_and_advantages">Homoiconicity: Uses and Advantages</a>
</p>
</blockquote>

<p>
and
</p>

<blockquote>
<p>
It can be much easier to understand how to manipulate the code since it can be more easily understood as simple data (since the format of the language itself is a data format).  — <a href="https://en.wikipedia.org/w/index.php?title=Homoiconicity&amp;oldid=1037434473#Uses_and_advantages">Homoiconicity: Uses and Advantages</a>
</p>
</blockquote>

<p>
For Wisp I use this a lot, because it allows me to do a first simple
pass over the code, add incremental improvements and finally have the
cleaned up code that I can pass to the language spec definition:
</p>

<div>
<pre><span>define</span><span> : </span><span>wisp-scheme-read-chunk</span> port
<span>         . </span><span>&#34;Read and parse one chunk of wisp-code&#34;</span>
     <span>let</span><span> : </span><span>:</span>  lines<span> : </span><span>wisp-scheme-read-chunk-lines</span> port
<span>          wisp-make-improper</span>
<span>            wisp-replace-empty-eof</span>
<span>              wisp-unescape-underscore-and-colon</span>
<span>                wisp-replace-paren-quotation-repr</span>
<span>                  wisp-propagate-source-properties</span>
<span>                    wisp-scheme-indentation-to-parens</span> lines
</pre>
</div>

<p>
Also this enables me to write a Question-Asking macro for
<a href="https://hg.sr.ht/~arnebab/dryads-wake/">dryads wake</a> without going totally insane. Usage:
</p>

<div>
<pre><span>Choose</span>
<span>    : </span><span>new</span> game
<span>      ,(first-encounter)</span>
<span>    : </span><span>load</span> game
<span>      ,(load-game)</span>
<span>    : </span><span>show</span> prologue
<span>      ,(prologue)</span> ,(<span>welcome-screen</span>)
<span>    : </span><span>exit</span>
<span>      We</span> hope you enjoyed our game!
</pre>
</div>

<p>
Definition:
</p>

<div>
<pre><span>define-syntax-rule</span><span> : </span><span>Choose</span><span> . </span>choices
<span>   . </span><span>&#34;Ask questions, apply consequences&#34;</span>
<span>   begin</span> 
<span>     say-lines</span><span> : </span>(<span>&#34;&#34;</span>) <span>;; </span><span>newline before question</span>
     <span>let</span> loop :
       <span>;; </span><span>Get the response via the Ask macro </span>
       <span>;; </span><span>to evaluate inline-code incrementally</span>
       <span>define</span> resp<span> : </span><span>string-&gt;number</span><span> : </span><span>Ask</span> choices
       <span>or</span>
<span>         cond</span>
<span>           : </span><span>equal?</span> resp <span>1</span>
<span>             Respond1</span> choices
<span>           : </span><span>equal?</span> resp <span>2</span>
<span>             Respond2</span> choices
<span>           : </span><span>equal?</span> resp <span>3</span>
<span>             Respond3</span> choices
<span>           : </span><span>equal?</span> resp <span>4</span>
<span>             Respond4</span> choices
<span>           : </span><span>equal?</span> resp <span>5</span>
<span>             Respond5</span> choices
<span>           : </span><span>equal?</span> resp <span>6</span>
<span>             Respond6</span> choices
<span>           else</span>
<span>             . </span><span>#f</span>
         loop

<span>define-syntax</span> Ask
<span>  lambda</span> (<span>x</span>)
    <span>syntax-case</span> x ()
<span>      : </span><span>_</span> (<span>choices</span> ...)
<span>        #`</span> begin
<span>           ask</span> (<span>QuoteFirsts</span> (<span>choices</span> ...))


</pre>
</div>

<p>
QuoteFirsts interprets the questions as data but leaves the answers as
code which can e.g. use <code>,(load-game)</code> to open the load game dialog.
</p>
</div>
</div>
<div id="outline-container-interface-c">
<h2 id="interface-c"><span>4.</span> interfacing with C and access from C</h2>
<div id="text-interface-c">
<p>
Most of Guile procedures can be called from C (for example when
embedding Guile) and it is easy to interoperate with C
from Guile Scheme.
</p>

<p>
<i>thanks to str1ngs for this points, too.</i>
</p>

<p>
I did not embed Guile in a C-program myself yet, but Guile provides
detailed examples and tutorials for this <a href="https://www.gnu.org/software/guile/learn/">in its Documentation</a>, with C
interfaces explicitly documented for most of its procedures.
</p>

<p>
<i>This is the <b>shocking</b> number 4: Guile is better for writing C-Programs than C itself. Consider yourself <b>shocked</b> :-) — and no, this argumentation is not complete. But if you’re here, the title led you here. <a href="https://www.youtube.com/watch?v=S2xHZPH5Sng">#legitbait</a>.</i>
</p>

<p>
<i>If you want to be <b>seriously shocked</b>, look at <a href="http://sph.mn/computer/guides/c/c-indent.html">c-indent</a>. Yes, that is Guile.</i>
</p>
</div>
</div>
<div id="outline-container-fibers">
<h2 id="fibers"><span>5.</span> fibers</h2>
<div id="text-fibers">
<p>
Fibers provide lightweight threads in Guile without having to change
anything in the core of Guile. They are reasonably performant and
provide concurrency as with Go-channels.
</p>

<p>
<i>thanks to stis for this point.</i>
</p>

<p>
With the name giving <code>fibers</code> and <code>channels</code> they provide an efficient
and scalable model for coordinated concurrency. See the <a href="https://github.com/wingo/fibers/wiki/Manual">manual</a> for
details.
</p>

<p>
You can test their raw efficiency using either the <a href="https://github.com/wingo/fibers/tree/master/benchmarks">webserver-benchmark</a>
or the <a href="https://github.com/atemerev/skynet/blob/master/guile-fibers/skynet.scm">guile-fibers entry in the skynet benchmark</a>.
</p>

<blockquote>
<p>
fibers is better than kludges like marking procedures and what
not and it is matched by very few languages. — stis
</p>
</blockquote>
</div>
</div>
<div id="outline-container-natural-script-writing">
<h2 id="natural-script-writing"><span>6.</span> embedded natural script writing</h2>
<div id="text-natural-script-writing">
<p>
For me, one 10x advantage over every other language is that I could
integrate <a href="https://www.draketo.de/software/wisp.html">wisp</a> and get an embedded script writing language for <a href="https://hg.sr.ht/~arnebab/dryads-wake/">dryads wake</a> 
(as embedded domain specific language: eDSL). There’s a talk that compares
this to other approaches (including ones I tried before):
<a href="https://fosdem.org/2017/schedule/event/naturalscriptwritingguile/">Natural script writing with Guile</a>. Here’s a real example:
</p>


<div>
<pre><span>define</span><span> : </span><span>first-encounter</span>
<span>    Enter</span><span> : </span><span>Juli</span> Fin :profile juli
<span>            Melter</span> Lark :profile melter
<span>            Rooted</span> Breeze :profile dryad
<span>            Old</span> One

<span>    Print</span>
<span>        Please</span> choose your name
<span>    game-state-init!</span>
<span>    game-state-name-set!</span><span> : </span><span>read-line</span>
<span>    game-state-id-set!</span><span> : </span><span>name-&gt;id</span><span> : </span><span>game-state-name</span>
<span>    game-state-scene-set!</span> first-encounter
<span>    save-state</span><span> : </span><span>game-state-id</span>
<span>    Print</span>
<span>        Welcome</span> ,(<span>string-append</span> (<span>game-state-name</span>) <span>&#34;!&#34;</span>)

<span>    Juli</span> Fin
<span>        Finally</span> we have our own home!

<span>    Melter</span> Lark
<span>        It</span> took long enough.

<span>    Juli</span> Fin
<span>        And</span> it is moist for sure.

<span>    Melter</span> Lark
<span>        I</span> will dry it out.

<span>    Rooted</span> Breeze :eerie
<span>        My</span> slumber breaks
<span>        my</span> mind awakes
<span>        who</span> are you strangers
<span>        in</span> my home?

<span>    Old</span> One
<span>        How</span> do you answer?
<span>        Juli</span> is ,(<span>score-&gt;description</span> (<span>profile-ability-score</span> (<span>game-state</span>)<span> &#39;juli &#39;explain))</span>
<span>            . </span>at explaining
        <span>and</span> ,(<span>score-&gt;description</span> (<span>profile-ability-score</span> (<span>game-state</span>)<span> &#39;juli &#39;fast-talk))</span>
<span>            . </span>at fast-talk.
<span>    Choose</span>
<span>        : </span><span>explain</span> your situation to appease the dryad
<span>          ,(explain-your-home)</span>
<span>        : </span><span>fast-talk</span> the dryad to get her to leave <span>and</span> risk her anger
<span>          ,(fast-talk-the-dryad)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-hackability">
<h2 id="hackability"><span>7.</span> hackability</h2>
<div id="text-hackability">
<p>
The language tower and infrastructure make it enjoyable to hack on and
extend Guile itself.
</p>

<p>
<i>thanks to stis for this point.</i>
</p>

<blockquote>
<p>
language tower and effective syntax extensions (define-syntax, etc.) -
without that, lokke might well not exist (such as it is), at least not
by now. — rlb (<a href="https://github.com/lokke-org/lokke">lokke</a> is Clojure on top of Guile)
</p>
</blockquote>
</div>
</div>
<div id="outline-container-info-manual">
<h2 id="info-manual"><span>8.</span> complete info-manual</h2>
<div id="text-info-manual">
<p>
Guile comes with a complete and very readable manual in info-format.
If you’ve ever tried to program Python without internet access (or
just without Google), you’ll know to deeply appreciate this.
</p>

<p>
You can find most answers by running
</p>

<pre>info guile
</pre>


<p>
in the shell, or calling
</p>

<pre>C-h i m Guile Reference
</pre>


<p>
in Emacs and starting a full-text search with <code>C-s {search terms} C-s</code>.
</p>
</div>
</div>
<div id="outline-container-prototyping-creativity">
<h2 id="prototyping-creativity"><span>9.</span> prototyping and creativity</h2>
<div id="text-prototyping-creativity">
<p>
Compared to Python and C++ Guile removes barriers to abstraction. This
is also possible with R, but Guile provides good enough performance
for these abstractions to make them practical to use. 
</p>

<p>
The low startup time helps for this, too.
</p>

<p>
<i>thanks to vijaymarupudi for this point.</i>
</p>

<blockquote>
<p>
“Guile is particularly great for prototyping and creativity, and its
performance allows for such experiments to be deployed to the world
with minimal changes.
</p>

<p>
I&#39;ve been using it a lot lately for data cleaning and modeling, and
it&#39;s been great” — vijaymarupudi
</p>
</blockquote>
</div>
</div>
<div id="outline-container-fun">
<h2 id="fun"><span>10.</span> lots of fun</h2>
<div id="text-fun">
<p>
Hacking in Guile/Scheme is just lots of fun.
</p>

<p>
<i>thanks to dsmith for this. Even though this sounds small and gets only a single line in this article, looking at the enthusiasm of people who hack on <a href="http://guix.gnu.org">Guix</a> shows that dsmith clearly has a point!</i>
</p>
</div>
</div>
<div id="outline-container-more">
<h2 id="more"><span>11.</span> More 10x advantages</h2>
<div id="text-more">
<p>
<i>After I wrote this article, people noted more advantages. I might work them into the article sometime later, but for now they live here:</i>
</p>

<ul>
<li><b>named lets</b>, I could be without map reduce and all that, just let me have a named let construct — stis</li>
<li><b>python-on-guile</b> has copyable generators and yield as an actual function that can be passed to other functions — stis writing about <a href="https://www.mail-archive.com/guile-devel%40gnu.org/msg15805.html">Python on Guile</a></li>
<li><a href="https://github.com/ijp/pfds">Purely Functional Datastructures</a> and <a href="https://github.com/ijp/fectors">fectors</a>.</li>
<li><a href="https://spritely.institute/hoot/">Hoot</a> lets you port your tools <a href="https://spritely.institute/news/building-interactive-web-pages-with-guile-hoot.html">to the browser</a> with minimal overhead — <a href="https://spritely.institute/news/make-a-game-with-hoot-for-the-lisp-game-jam.html">including games</a> like <a href="https://spritely.institute/news/goblinville-a-spring-lisp-game-jam-2025-retrospective.html">Goblinville</a>.</li>
</ul>
</div>
</div>
</div><div id="postamble">
<p> <span>2021-08-25 Mi 00:00</span> - <a href="http://www.draketo.de/ich/impressum">Impressum</a> - <span><a href="http://gnu.org/l/gpl">GPLv3 or later</a> (code), <a href="https://creativecommons.org/licenses/by-sa/4.0/">cc by-sa</a> (rest)</span>     </p>
</div></div>
  </body>
</html>
