<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nickdrozd.github.io/2023/05/06/python-abstraction-price.html">Original</a>
    <h1>The High Price of Abstraction in Python</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <blockquote>
  <p>Some say the price of holding heat is often too high </p>

  <p>– MF DOOM</p>
</blockquote>

<p>Suppose I am looping over a range of numbers to see if any of them matches some magic number:</p>

<figure><pre><code data-lang="python"><span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>1_000_000_000</span><span>):</span>
    <span>if</span> <span>i</span> <span>==</span> <span>-</span><span>1</span><span>:</span>
        <span>break</span></code></pre></figure>

<p>On my modest desktop, this takes <strong>60 seconds</strong> to execute.</p>

<p>But as everyone knows, using <a href="https://en.wikipedia.org/wiki/Magic_number_(programming)">magic numbers</a> in code is bad. It would be clearer and more maintainable to express the value as a variable:</p>

<figure><pre><code data-lang="python"><span>MAGIC_NUMBER</span> <span>=</span> <span>-</span><span>1</span>

<span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>1_000_000_000</span><span>):</span>
    <span>if</span> <span>i</span> <span>==</span> <span>MAGIC_NUMBER</span><span>:</span>
        <span>break</span></code></pre></figure>

<p>On my modest desktop, this takes <strong>70 seconds</strong> to execute. Ten seconds longer – that’s not great!</p>

<p>Okay, so forget about variables. A better form of abstraction would be to get the comparison logic out of the loop and centralize it in a function:</p>

<figure><pre><code data-lang="python"><span>def</span> <span>number_matches</span><span>(</span><span>num</span><span>:</span> <span>int</span><span>)</span> <span>-&gt;</span> <span>bool</span><span>:</span>
    <span>return</span> <span>num</span> <span>==</span> <span>-</span><span>1</span>

<span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>1_000_000_000</span><span>):</span>
    <span>if</span> <span>number_matches</span><span>(</span><span>i</span><span>):</span>
        <span>break</span></code></pre></figure>

<p>On my modest desktop, this one takes <strong>110 seconds</strong> to execute. The price to be paid for this minor organizational improverment is a <strong>catastrophic degradation of performance</strong>.</p>

<p>The situation is grim if you have some Python <a href="https://nickdrozd.github.io/2022/04/12/performance-hot-spots.html">hot spot</a> code that needs to be cleaned up. Because it’s a hot spot, any abstraction could have <strong>dire consequences</strong>, and so the range of acceptable changes is constrained.</p>

<p>On the other hand, this is great news if you have a hot spot that uses abstractions. <strong>It may be possible to trade a little maintainability for a lot of speedup.</strong> Inline some constants, inline some function calls, that kind of thing. It doesn’t look nice, but hey, it’s Python.</p>

  </div>
</article>

      </div>
    </div></div>
  </body>
</html>
