<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jemma.dev/blog/hash-except">Original</a>
    <h1>Hash#except in Ruby 3&#43;</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>This was the tip of the week in the <a href="https://rubyweekly.com/issues/585">January 6, 2022 Ruby Weekly Newsletter</a>.</p>

<hr/>

<p>If you’re an avid Rails user, you might be familiar with ActiveSupport’s <code>Hash#except</code> which has been around for <a href="https://jemma.dev/blog/f">roughly 15 years</a>. As of Ruby 3.0, <code>Hash#except</code> is now a native Ruby method too!</p>

<p>But… what does it do? <a href="https://jemma.dev/blog/he">Hash#except</a> gives us a hash excluding all of the keys we’ve passed as arguments. Let’s look at an example:</p>

<div><div><pre><code><span>jemma</span> <span>=</span> <span>{</span> <span>name: </span><span>&#34;Jemma&#34;</span><span>,</span> <span>username: </span><span>&#34;jemma&#34;</span><span>,</span> <span>password: </span><span>&#34;super secure&#34;</span> <span>}</span>

<span>jemma</span><span>.</span><span>except</span><span>(</span><span>:password</span><span>)</span>
<span># =&gt; { name: &#34;Jemma&#34;, username: &#34;jemma&#34; }</span>
</code></pre></div></div>

<p>Before Ruby 3.0, if we were in a repo which wasn’t using Rails, we could have done something like this:</p>

<div><div><pre><code><span>jemma</span> <span>=</span> <span>{</span> <span>name: </span><span>&#34;Jemma&#34;</span><span>,</span> <span>username: </span><span>&#34;jemma&#34;</span><span>,</span> <span>password: </span><span>&#34;super secure&#34;</span> <span>}</span>

<span>jemma</span><span>.</span><span>reject</span> <span>{</span> <span>|</span><span>k</span><span>,</span><span>_</span><span>|</span> <span>k</span> <span>==</span> <span>:password</span> <span>}</span>
<span># =&gt; { name: &#34;Jemma&#34;, username: &#34;jemma&#34; }</span>
</code></pre></div></div>

<p>While this works totally fine, it gets a little clunky if we’re trying to exclude multiple different keys. Yet <code>Hash#except</code> can also take multiple arguments:</p>

<div><div><pre><code><span>jemma</span> <span>=</span> <span>{</span> <span>name: </span><span>&#34;Jemma&#34;</span><span>,</span> <span>username: </span><span>&#34;jemma&#34;</span><span>,</span> <span>password: </span><span>&#34;super secure&#34;</span> <span>}</span>

<span>jemma</span><span>.</span><span>except</span><span>(</span><span>:name</span><span>,</span> <span>:password</span><span>)</span>
<span># =&gt;  { username: &#34;jemma&#34; }</span>
</code></pre></div></div>

<p><code>Hash#except</code> might look familiar because it’s the inverse of <a href="https://jemma.dev/blog/slice">Hash#slice</a>. <code>Hash#slice</code> will give us a hash containing key / value pairs whose keys we specify as arguments, while <code>Hash#except</code> will give us a hash containing key / value pairs whose keys we don’t specify as arguments.</p>

<p>We might be wondering, what happens if we pass a key that is not in the hash?</p>

<div><div><pre><code><span>jemma</span> <span>=</span> <span>{</span> <span>name: </span><span>&#34;Jemma&#34;</span><span>,</span> <span>username: </span><span>&#34;jemma&#34;</span><span>,</span> <span>password: </span><span>&#34;super secure&#34;</span> <span>}</span>

<span>jemma</span><span>.</span><span>except</span><span>(</span><span>&#34;key doesn&#39;t exist&#34;</span><span>)</span>
<span># =&gt; { name: &#34;Jemma&#34;, username: &#34;jemma&#34;, password: &#34;super secure&#34; }</span>
</code></pre></div></div>

<p>In this case, Ruby is technically still excluding this key from our hash - it just never appeared in the hash to begin with. (This is the same behavior as <code>Hash#slice</code>.)</p>


  </div>
  
</article>

      </div>
    </div></div>
  </body>
</html>
