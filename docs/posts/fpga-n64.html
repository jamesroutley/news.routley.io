<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://www.ultrafp64.com/">Original</a>
    <h1>FPGA N64</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
		<div id="primary">
			<main id="main" role="main">

<article id="post-5" class="page">

	
	<div>
		
<figure><img width="1024" height="577" src="http://www.ultrafp64.com/wp-content/uploads/2022/06/20220615_164630-1024x577.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/06/20220615_164630-1024x577.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/06/20220615_164630-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/06/20220615_164630-768x433.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/06/20220615_164630-1536x865.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/06/20220615_164630-2048x1154.jpg 2048w, http://www.ultrafp64.com/wp-content/uploads/2022/06/20220615_164630-1568x883.jpg 1568w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>











<div>
<div>
<h2 id="cpu-design"><strong>CPU design</strong></h2>



<ul><li>Full pipeline completed for standard MIPS instructions.</li><li>Interlocks and Bypass functions were tested and confirmed to be working.</li><li>Up to 150mhz without TLB, FPU and Cache cores. (The Goal of speed is 120Mhz for other cores)</li><li>CP0 Core completed sending internal registers.</li><li>64-bit pipeline With 64 Bit regs.</li><li>64bit loads and stores fully working.</li><li>TLB Core completed and used a duel clocked system to speed up </li><li>FPU Core completed and tested working</li><li>The FPU ALU¬† will be separate from the main ALU pipeline to simplify the FPGA logic and do fault finding much easier.</li><li>Cache memory with duel clocks. This is so we can start overclocking the CPU independent of the RCP core clock.</li><li>The instruction cache is completed and working. With this, we can now run the CPU interface with a 64-bit wide data bus, so no bottlenecks will happen here anymore.</li><li>Duel bus access. one for the instruction cache and one for the data cache. This allows the CPU able to get data for instructions and code without affecting each other. No more 32 bit muxed bus that the OG CPU uses for only 250Mbyte transfers. So almost a full 500mbyte access x2.</li></ul>
</div>



<div>
<h2 id="bus-design"><strong>Bus Design</strong></h2>



<ul><li>128-bit Ram access / DMA Channel (64 bit for normal data and 64 bits for the Z-buffer and coverage/alpha bits and always render 32bits ‚Äì no more dither)</li><li>32-bit address and register access to devices</li><li>64-bit extended bit access for RDP/VI Z-buffer and Color alpha extended bits</li><li>Job system where many cores can ask for ram at the same time and can be queued in the ram to keep data flow happening (This is a major issue with DDR3 ram and refreshing)</li><li>All cores can read and write independently, thus giving an internal memory throughput of 500M/Bytes full duplex (500Mbytes read and 500Mbytes Write at the same time)</li><li>Added direct RDP access to memory at 133mhz </li></ul>
</div>



<div>
<h2 id="mips-interface"><strong>MIPS Interface</strong></h2>



<ul><li>Standard access to registers and local memories (IMEM/DMEM and Rom access)</li><li>Ram access is via the DMA Channel as this would be able to byte-mask data</li><li>Interface for an original N64 CPU via the Nexys Video FMS Port</li><li>Confirmed all block and subblock access done (This is important for the cache memory access.</li><li>This will be later removed from the core as we will run the CPU directly to the internal buses allowing for up to 500mbyte/s and not the 250 it is with this bus</li><li>This is being removed as we no longer require the real CPU, but a simple switch between the two cores via a boot setup via a reg for debugging games.</li><li>Thanks To ElectronAsh, we have the original CPU on a board that I can use to get the main RCP core and other external accesses done without knowing if the CPU crashed due to my own bugs ‚Äì Cannot wait to fix this.</li></ul>
</div>
</div>



<div>
<div>
<h2 id="pif-si-interface"><strong>PIF/SI interface</strong></h2>



<ul><li>Have working controller inputs -Done</li><li>Works to be done on the memory paks and rumble pak -Done</li><li>BRAM Interface with DMA controller -Done</li><li>An internal CPU that would make the PIF ram look like the CIC seed is correct -Done</li><li>A new PIF controller using a 6502 core accesses the BRAM and external devices.¬† -Done</li><li>DMA controller that both reads and writes 64bytes at a time (not 64bits) This would be an improvement -Done</li><li>Custom BIOS for booting. -Done</li><li>EEPROM access ‚Äì Done</li></ul>
</div>



<div>
<h2 id="rom-reader"><strong>Rom Reader</strong></h2>



<ul><li>32 and 64-bit reads and writes via the Register bus and DMA controller. -Done</li><li>Changeable timing for rom reads -Done</li><li>We need to make this independent of the master clock (62.5mhz), so we can run higher speeds and keep the read latency time calculations. -Done</li><li>We have found some unaligned transfers that can happen.</li></ul>
</div>



<div>
<h2 id="ram-controller"><strong>Ram controller</strong></h2>



<ul><li>Full register setup ‚Äì Both the ram regs and the ram module regs are accessible</li><li>be able to read and write at the same time to the MIG7 ram controller</li><li>Full 2.2 gbit throughput ‚Äì 500mbyte read and 500mbyte write for normal N64 systems with more access for the RDP</li><li>Multiple cores to read and write at the same time.</li><li>Jobs are queued up so the latency of the DDR3 ram can be mitigated. We will work on a more extensive caching system on the memory controller of about 128kbyte for the RDP to run on, where half will be for the Z-buffer and the other half for the colour buffer.</li></ul>
</div>
</div>



<div>
<div>
<h2 id="rsp-core-completed"><strong>RSP Core</strong>¬†-completed</h2>



<ul><li>Entire DMA, Imem and Dmem are completed and working -Done</li><li>We can get this core up to 90mhz ‚Äì Overclocking I hear -Done</li><li>SU core tested and working -Done</li><li>Interlock working in the pipeline process. This includes the VU core as well -Done</li><li>the bypass also sorted for the EXE and WB stages in the main core</li><li>The main CPU core has been completely tested for ALU and load and stores -Done</li><li>CP0 is fully working ‚Äì Even the DMA üòâ -Done</li><li>VU core has been built, and some normal ALU ops are tested and confirmed, Just some special ops that need to be checked. -Done</li><li>Just the divide core to complete. -Done</li><li>Duel Opcodes are implemented, except for loads/Stores and MTC/MFC/CFC/CTC as we cannot write to the reg file at the same time a VU opcode is al to be processed. -Done</li><li>Bug testing to be completed as well. -Done</li></ul>
</div>



<div>
<h2 id="rdp-core-completed-with-one-masking-issue"><strong>RDP Core</strong> ‚Äì completed</h2>



<ul><li>The pipeline has been designed and tested. But does it work ‚Ä¶. Will find out(UPDATE). We do have fill commands working, But there is an issue with masking. -Done</li><li>Need to build the memory interface that can do both Z-buffer, Color image transfer and reads, Texture load and stores, and Masked stores that are all byte aligned. This has been done with some bugs in the TULT calls -Done</li><li>Fully working 18bit Z-buffer and coverage checks</li><li>Copy and Fill needs to be done directly from the memory controller -Done</li><li>The memory controller will be done after the SU and VU in the RSP are tested and done.-Done</li><li>Some Fill commands have been tested and confirmed working-Done</li><li>Some caching stuff to do to help with DDR3 latency ‚Äì working on</li><li>Full 8x 4K buffers for texture, image and Zbuffer line buffers</li></ul>
</div>



<div>
<h2 id="video-core"><strong>Video Core</strong>¬†</h2>



<ul><li>Have a scaling unit working ‚Äì some bugs on some interlaced games</li><li>Got HDMI core working</li><li>DMA fully working</li><li>Need to work on some AA stuff</li><li>Dithering can be selectable with 16bit colour outputs</li></ul>
</div>
</div>



<div>
<div>
<h2 id="audio-core">Audio Core</h2>



<ul><li>Audio going through the HDMI port and a DAC controller to check</li><li>Some work on a custom frequency that the audio core makes, but all output is 48khz, just polyphase, so there is no popping on the audio output</li><li>32bit output for the HDMI core</li><li>Got this running via HDMI, so no more DAC is needed</li></ul>
</div>
</div>



<p>Please also check <a rel="noreferrer noopener" href="https://n64brew.dev/wiki/Main_Page" target="_blank">N64Brew</a> for updates on the hardware details I have updated. I support these guys and the Discord channel ‚ÄúN64Brew‚Äù</p>



<p>This has been Five years in the making and written fully by myself. No leaks were used for the production of this core. Only emulators, reverse engineering and a lot of reading of patents. Coffee was overused as well</p>



<p>Many thanks to the N64Brew team and Decompiler teams as well for testing and source code access to find all the bugs.  </p>



<p><a href="https://www.twitch.tv/ultrafp64">https://www.twitch.tv/ultrafp64</a></p>



<p><a href="https://www.youtube.com/user/mazamars312/videos">https://www.youtube.com/user/mazamars312/videos</a></p>



<figure><img loading="lazy" width="1024" height="576" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_25_33_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_25_33_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_25_33_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_25_33_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_25_33_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_25_33_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_25_33_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_21_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_21_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_21_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_21_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_21_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_21_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_21_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure>
<figure><img loading="lazy" width="1024" height="576" data-id="43" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_48_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_48_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_48_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_48_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_48_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_48_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_48_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="45" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_53_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_53_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_53_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_53_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_53_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_53_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_26_53_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="39" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_23_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_23_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_23_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_23_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_23_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_23_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_23_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="40" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_26_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_26_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_26_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_26_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_26_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_26_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_26_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="42" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_43_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_43_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_43_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_43_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_43_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_43_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_43_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="44" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_47_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_47_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_47_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_47_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_47_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_47_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_27_47_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="41" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_07_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_07_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_07_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_07_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_07_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_07_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_07_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="46" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_16_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_16_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_16_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_16_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_16_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_16_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_28_16_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure><img loading="lazy" width="1024" height="576" data-id="48" src="https://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_30_10_Pro-1024x576.jpg" alt="" srcset="http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_30_10_Pro-1024x576.jpg 1024w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_30_10_Pro-300x169.jpg 300w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_30_10_Pro-768x432.jpg 768w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_30_10_Pro-1536x864.jpg 1536w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_30_10_Pro-1568x882.jpg 1568w, http://www.ultrafp64.com/wp-content/uploads/2022/03/WIN_20220401_08_30_10_Pro.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>
</figure>



<p>Where am I up to right now‚Ä¶.. Well, let‚Äôs just say I‚Äôm almost done üôÇ Finally!!!!</p>



<p>I have no issues with buying myself a coffee to help my coffee addiction üôÇ</p>



<div>
<div><p><a href="https://www.buymeacoffee.com/Ultrafp64" target="_blank" rel="You are welcome to buy me a coffee if you want tho support through this (https://www.buymeacoffee.com/Ultrafp64) noopener">Buy Me a Coffee</a></p></div>
</div>




	</div><!-- .entry-content -->

	</article><!-- #post-5 -->
			</main><!-- #main -->
		</div><!-- #primary -->
	</div></div>
  </body>
</html>
