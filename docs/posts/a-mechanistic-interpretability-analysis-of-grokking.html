<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.alignmentforum.org/posts/N6WM6hs7RQMKDhYjB/a-mechanistic-interpretability-analysis-of-grokking">Original</a>
    <h1>A Mechanistic Interpretability Analysis of Grokking</h1>
    
    <div id="readability-page-1" class="page"><div>
<div><p>The purpose of this post is to make myself feel better about not being able to solve a problem by stating it clearly so it&#39;s easier for the good samaritan(s) who respond to my request for help.</p>
<p>Contents:</p>
<ul>
<li><a href="#what-do-i-want-to-happen-and-why">What do I want to happen, and why?</a></li>
<li><a href="#how-have-i-tried-to-make-this-happen">How have I tried to make this happen?</a></li>
<li><a href="#what-did-i-expect-to-see">What did I expect to see?</a></li>
<li><a href="#what-am-i-seeing-instead">What am I seeing instead?</a></li>
<li><a href="#how-have-i-tried-to-resolve-the-issue-so-far">How have I tried to resolve the issue so far?</a></li>
</ul>
<h2 id="what-do-i-want-to-happen-and-why">What do I want to happen, and why?</h2>
<p>What?</p>
<ul>
<li>I want to have a struct, called <code>Cell</code></li>
<li>This <code>Cell</code> type should know what other cells it&#39;s ‘linked’ to</li>
</ul>
<p>Why?</p>
<ul>
<li>In my maze making program, cells make up the building blocks of a maze</li>
<li>To know whether two cells form a passage, or if a wall separates them, cells need to know if they are linked to one another</li>
</ul>
<h2 id="how-have-i-tried-to-make-this-happen">How have I tried to make this happen?</h2>
<h3 id="some-context">Some context</h3>
<p>So people know a bit about the other parts of the cell type. I initially declared the type as below, just specifying cell location in the overall maze grid and who its neighbouring cells are:</p>
<div><pre><span></span><span>#[derive(Debug)]</span>
<span>pub</span><span> </span><span>struct</span> <span>Cell</span><span> </span><span>{</span>
<span>    </span><span>row</span>: <span>u8</span><span>,</span>
<span>    </span><span>column</span>: <span>u8</span><span>,</span>
<span>    </span><span>north</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>east</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>south</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>west</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>}</span>
</pre></div>
<p>This compiled, so next step is to check the basic behaviour works. The below code does this by:</p>
<ul>
<li>declaring two cells</li>
<li>setting one cell as a neighbour to the other</li>
<li>printing the second cell&#39;s state</li>
</ul>
<div><pre><span></span><span>fn</span> <span>main</span><span>(){</span>
<span>    </span><span>let</span><span> </span><span>mut</span><span> </span><span>cell_one</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span> </span><span>{</span>
<span>        </span><span>row</span>: <span>1</span><span>,</span>
<span>        </span><span>column</span>: <span>1</span><span>,</span>
<span>        </span><span>north</span>:  <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>};</span>
<span>    </span><span>let</span><span> </span><span>mut</span><span> </span><span>cell_two</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span>{</span>
<span>        </span><span>row</span>: <span>0</span><span>,</span>
<span>        </span><span>column</span>: <span>0</span><span>,</span>
<span>        </span><span>north</span>: <span>Some</span><span>(</span><span>Box</span>::<span>new</span><span>(</span><span>cell_one</span><span>)),</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>};</span>
<span>    </span><span>println!</span><span>(</span><span>&#34;{:#?}&#34;</span><span>,</span><span> </span><span>cell_two</span><span>);</span>
<span>}</span>
</pre></div>
<p>Again, this compiles and prints what I expect - great.</p>
<h3 id="adding-in-the-ability-to-have-links">Adding in the ability to have links</h3>
<p>Onto the actual issue I’m having, which is extending the <code>Cell</code> type, so that it can keep track of whether it is linked to other cells.</p>
<p>Below is the Ruby implementation for the functionality that I’m trying to emulate in Rust (I’m following along with Jamis Buick’s <em>Mazes for Programmers</em>, where all the examples are in Ruby).</p>
<div><pre><span></span><span>class</span><span> </span><span>Cell</span>
<span>    </span><span>attr_reader</span><span> </span><span>:row</span><span>,</span><span> </span><span>:column</span>
<span>    </span><span>attr_accessor</span><span> </span><span>:north</span><span>,</span><span> </span><span>:south</span><span>,</span><span> </span><span>:east</span><span>,</span><span> </span><span>:west</span>

<span>def</span><span> </span><span>initialize</span><span>(</span><span>row</span><span>,</span><span> </span><span>column</span><span>)</span>
<span>    </span><span>@row</span><span>,</span><span> </span><span>@column</span><span> </span><span>=</span><span> </span><span>row</span><span>,</span><span> </span><span>column</span>
<span>    </span><span>@links</span><span> </span><span>=</span><span> </span><span>{}</span><span> </span><span># hash attribute for keeping track of linked cells</span>
</pre></div>
<p>In attempting to emulate this in Rust I updated the struct declaration with:</p>
<ul>
<li>new <code>links</code> field</li>
<li>where <code>links</code> is a hash map</li>
<li>and the keys for the hashmap are other cells</li>
<li>and the values are booleans</li>
</ul>
<p>So if two cells are linked then they will appear as keys in each other&#39;s <code>links</code> field, with the value set to <code>true</code> .</p>
<div><pre><span></span><span>#[derive(Debug)]</span>
<span>pub</span><span> </span><span>struct</span> <span>Cell</span><span> </span><span>{</span>
<span>    </span><span>row</span>: <span>u8</span><span>,</span>
<span>    </span><span>column</span>: <span>u8</span><span>,</span>
<span>    </span><span>north</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>east</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>south</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>west</span>: <span>Option</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>    </span><span>links</span>: <span>HashMap</span><span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;</span><span>,</span><span> </span><span>bool</span><span>&gt;</span><span> </span><span>//new hash map field for keeping track of linked cells</span>
<span>}</span>
</pre></div>
<p>The compiler was happy with this type declaration, so I went on to test the new <code>links</code> functionality. In the code below I added:</p>
<ul>
<li><code>cell_three</code>, a new <code>Cell</code> struct</li>
<li>an attempt to insert <code>cell_three</code> into <code>cell_two</code>’s <code>links</code> field</li>
</ul>
<div><pre><span></span><span>fn</span> <span>main</span><span>(){</span>
<span>    </span><span>let</span><span> </span><span>mut</span><span> </span><span>cell_one</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span> </span><span>{</span>
<span>        </span><span>row</span>: <span>1</span><span>,</span>
<span>        </span><span>column</span>: <span>1</span><span>,</span>
<span>        </span><span>north</span>:  <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>links</span>: <span>HashMap</span>::<span>new</span><span>()</span>
<span>    </span><span>};</span>
<span>    </span><span>let</span><span> </span><span>mut</span><span> </span><span>cell_two</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span>{</span>
<span>        </span><span>row</span>: <span>0</span><span>,</span>
<span>        </span><span>column</span>: <span>0</span><span>,</span>
<span>        </span><span>north</span>: <span>Some</span><span>(</span><span>Box</span>::<span>new</span><span>(</span><span>cell_one</span><span>)),</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>links</span>: <span>HashMap</span>::<span>new</span><span>()</span>
<span>    </span><span>};</span>
<span>    </span><span>let</span><span> </span><span>mut</span><span> </span><span>cell_three</span>: <span>Cell</span><span> </span><span>=</span><span> </span><span>Cell</span><span>{</span>
<span>        </span><span>row</span>: <span>0</span><span>,</span>
<span>        </span><span>column</span>: <span>1</span><span>,</span>
<span>        </span><span>north</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>east</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>south</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>west</span>: <span>None</span>::<span>&lt;</span><span>Box</span><span>&lt;</span><span>Cell</span><span>&gt;&gt;</span><span>,</span>
<span>        </span><span>links</span>: <span>HashMap</span>::<span>new</span><span>()</span>
<span>    </span><span>};</span>

<span>    </span><span>cell_two</span><span>.</span><span>links</span><span>.</span><span>insert</span><span>(</span><span>Box</span>::<span>new</span><span>(</span><span>cell_three</span><span>),</span><span> </span><span>true</span><span>);</span>
<span>    </span><span>println!</span><span>(</span><span>&#34;{:#?}&#34;</span><span>,</span><span> </span><span>cell_two</span><span>);</span>
<span>}</span>
</pre></div>
<h2 id="what-did-i-expect-to-see">What did I expect to see?</h2>
<p>I expected that <code>cell_three</code> would be moved into the <code>links</code> field as a key, with its value set to <code>true</code>. (I was going to work out how all the ownership worked later, initially I just wanted to do a &#39;quick test&#39; (quick test outcome: it was not a quick test)).</p>
<h2 id="what-am-i-seeing-instead">What am I seeing instead?</h2>
<p>Alas, this does not compile and I have the below error:</p>
<div><pre><span></span>error<span>[</span>E0599<span>]</span>:<span> </span>the<span> </span>method<span> </span><span>`</span>insert<span>`</span><span> </span>exists<span> </span><span>for</span><span> </span>struct<span> </span><span>`</span>HashMap&lt;Box&lt;Cell&gt;,<span> </span>bool&gt;<span>`</span>,<span> </span>but<span> </span>its<span> </span>trait<span> </span>bounds<span> </span>were<span> </span>not<span> </span>satisfied
</pre></div>
<p>Some hints from the error message:</p>
<div><pre><span></span>note:<span> </span>the<span> </span>following<span> </span>trait<span> </span>bounds<span> </span>were<span> </span>not<span> </span>satisfied:
<span>            </span><span>`</span>Box&lt;Cell&gt;:<span> </span>Eq<span>`</span>
<span>            </span><span>`</span>Box&lt;Cell&gt;:<span> </span>Hash<span>`</span>
</pre></div>
<h2 id="how-have-i-tried-to-resolve-the-issue-so-far">How have I tried to resolve the issue so far?</h2>
<p>I did some un-disciplined debugging where I can’t recall what I tried
or what error messages I received - classic flailing, basically.</p>
<p>I can at least recall the direction the flailing was headed towards / from / through / around:</p>
<ul>
<li>Based on the error message hint, I tried adding various traits into the <code>derive</code> annotation above the <code>Cell</code> type. This resulted in playing whack-a-mole with different trait errors, seemingly all the things I needed were mutually exclusive.</li>
<li>Changing the <code>links</code> from <code>HashMap</code> to a <code>BTreeMap</code>. Pure desperation.</li>
<li>Passing in references. Purer desperation.</li>
<li>Looking into lifetime errors I had been getting and reading/playing around with adding explicit lifetime annotations. Purest desperation.</li>
</ul>
<p>After a few hours I realised that there were clearly multiple, related, fundamental concepts that I was missing, so it’s time to reach out for help. At least I’ve described the problem clearly with this post.</p>
</div>
</div></div>
  </body>
</html>
