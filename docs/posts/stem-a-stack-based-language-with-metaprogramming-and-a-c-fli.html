<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ret2pop.nullring.xyz/blog/stem.html">Original</a>
    <h1>Stem, a stack-based language with metaprogramming and a C FLI</h1>
    
    <div id="readability-page-1" class="page"><div id="text-org75cc4ae">
<p>
To follow along, I suggest after following the instructions on the <a href="https://github.com/ret2pop/stem">github page</a> you go into the stem project folder, find the <code>stemlib</code> folder, go into it
with <code>cd stemlib</code>, and then run <code>stem repl.stem</code>. Here you will encounter what is known as the <i>REPL</i>, or the read, eval, print loop. What it is called
doesn’t matter. Just know that it runs stem code interactively.
</p>

<p>
A basic word that prints out the top thing on the stack and removes it is simply a period:
</p>
<div>
<pre><span># </span><span>this is a comment, used to explain code but doesn&#39;t affect the outcome at all.</span>
<span># </span><span>comments start with a &#39;#&#39;.</span>
<span>&#34;hello world\n&#34;</span> .
</pre>
</div>

<pre>hello world
</pre>


<p>
where the <code>\n</code> just signifies a newline character, basically just telling it to not print the “hello world” on the same line as the next thing printed.
You can print the entire stack like so:
</p>
<div>
<pre><span>1</span> <span>2</span> <span>3</span> [ <span>&#34;some quote&#34;</span> ] <span>&#34;string!&#34;</span>

?
</pre>
</div>

<pre>1
2
3
Q: [
some quote]
string!
</pre>

<p>
Which prints the entire stack, where the bottom-most thing is the top thing on the stack.
There are also some basic math operations you can do:
</p>
<div>
<pre><span>3</span> <span>4</span> <span>+</span> .
<span>3</span> <span>4</span> <span>-</span> .
<span>3</span> <span>4</span> <span>*</span> .
<span>3.0</span> <span>4</span> <span>/</span> .
</pre>
</div>

<pre>7
-1
12
0.750000
</pre>


<p>
One can independently verify that these results are accurate. These basic math operations take <i>two</i> things off of the stack, does the operation
on those two numbers, and then puts the new value back on the stack, deleting the old values. Then, the period character prints the value and pops
them off the stack.
</p>


<div id="org082ba51">
<p><img src="https://ret2pop.nullring.xyz/blog/img/stack.png" alt="stack.png" height="100px"/>
</p>
<p><span>Figure 2: </span>Demonstration of the stack effect of the plus word</p>
</div>

<p>
There are predefined words for other mathematical operations too, all listed here:
</p>

<div>
<pre><span>0.0</span> <span>sin</span> .
<span>0.0</span> <span>cos</span> .
<span>1.0</span> <span>exp</span> .
<span>2.5</span> floor .
<span>2.5</span> ceil .
<span>2.71828</span> ln .
</pre>
</div>

<pre>0.000000
1.000000
2.718282
2.000000
3.000000
0.999999
</pre>


<p>
These operations I will assume you are familiar with, and one can independently verify their (approximate) validity. There are also comparison
and logical operations:
</p>

<div>
<pre><span>&#34;hi&#34;</span> <span>&#34;hi&#34;</span> <span>=</span> .
<span>4</span> <span>3</span> <span>=</span> .
<span>3</span> <span>4</span> <span>&lt;</span> .
<span>3</span> <span>4</span> <span>&gt;</span> .
<span>3</span> <span>4</span> <span>&lt;=</span> .
<span>3</span> <span>4</span> <span>&gt;=</span> .
<span>1</span> <span>1</span> and .
<span>1</span> <span>0</span> and .
<span>0</span> <span>1</span> or .
<span>0</span> <span>0</span> or .
</pre>
</div>

<pre id="orgcfb8324">1
0
1
0
1
0
1
0
1
0
</pre>

<p>
Which compare the first number to the second number with a certain operation like “greater than or equals to”. The result is a zero or one, indicating
that the statement is either <i>true</i> or <i>false</i>, with 1 being true. With these statements, you can make decisions:
</p>
<div>
<pre><span>3</span> <span>4</span> <span>&lt;</span> [ <span>&#34;3 &lt; 4&#34;</span> . ] [ <span>&#34;3 &gt;= 4&#34;</span> . ] <span>if</span>
</pre>
</div>

<pre>3 &lt; 4
</pre>


<p>
where the word <code>if</code> just checks if the third thing from the top of the stack (the first thing you write) is a zero or a one, and if it is, then execute
whatever’s inside the first quote, otherwise execute the second quote. Note that this wording is a little bit confusing because the <i>first thing you write</i>
is also the <i>last thing on the stack</i> because adding new things to the stack puts the first thing <i>below</i> the second.
</p>


<div id="orgf16d2e4">
<p><img src="https://ret2pop.nullring.xyz/blog/img/stack2.png" alt="stack2.png"/>
</p>
<p><span>Figure 3: </span>Stack effect of if word</p>
</div>

<p>
Now, also observe that inside the quotes we are storing valid code. This will become important later on as we introduce the concept of <i>metaprogramming</i>. First,
though, we have to introduce a couple more important predefined words.
</p>

<div>
<pre>[ <span>&#34;hello world!\n&#34;</span> . ] <span>eval</span>
<span>3</span> <span>quote</span> .
[ <span>1</span> <span>2</span> ] [ <span>3</span> <span>4</span> ] <span>compose</span> .
<span>1</span> [ <span>2</span> <span>3</span> ] <span>curry</span> .
</pre>
</div>

<pre id="orge15bd2b">hello world!
Q: [
3
]
Q: [
1
2
3
4
]
Q: [
1
2
3
]
</pre>

<p>
<code>eval</code> evaluates the top of the stack as if it were a piece of code; <code>quote</code> puts the top of the stack in a quote and then pushes it back to
the top of the stack; <code>compose</code> combines two quotes into one; and <code>curry</code> puts a value in the front of the quote. Note that some of these operations
work for strings as well:
</p>
<div>
<pre><span>&#34;hello &#34;</span> <span>&#34;world\n&#34;</span> <span>compose</span> .
</pre>
</div>

<pre>hello world
</pre>


<p>
And some other words that we use to operate on quotes and strings are here:
</p>
<div>
<pre>[ <span>1</span> <span>2</span> <span>3</span> <span>4</span> ] <span>1</span> <span>cut</span> . .
<span>0</span> [ <span>5</span> <span>6</span> <span>7</span> <span>8</span> ] <span>vat</span> .
<span>&#34;hello\nworld\n&#34;</span> <span>6</span> <span>cut</span> . .
<span>1</span> <span>&#34;asdfghjkl;&#34;</span> <span>vat</span> .
</pre>
</div>

<pre id="org42bd2f0">Q: [
3
4
]
Q: [
1
2
]
5
world
hello
s
</pre>
<p>
<code>cut</code> cuts a string or quote into two, where the number in front tells <code>cut</code> <i>where</i> to cut. Note that normally in programming numbering starts
at 0, so 1 is actually the <i>second</i> element of the quote. <code>vat</code> gets the nth element, where n is the <i>first</i> value passed into <code>vat</code>. It also returns the quote or string
on the stack back after, with the value at that index on top. There are two more words that we have to define:
</p>
<div>
<pre><span>1</span> <span>2</span> <span>swap</span> . .
<span>1</span> <span>2</span> . .
<span>&#34;hello\n&#34;</span> <span>dup</span> . .
<span>1</span> <span>2</span> <span>5</span> [ <span>+</span> ] <span>dip</span> . .
</pre>
</div>

<pre>1
2
2
1
hello
hello
5
3
</pre>


<p>
<code>swap</code> just swaps the top two numbers on the stack, <code>dup</code> just duplicates the top of the stack,
and <code>dip</code> is just <code>eval</code> except it does the operation one layer below. In this example, it adds 1 and 2
instead of 2 and 5, thus you see a 5 and a 3 printed instead. Note that there are more words, but we won’t need them for now. Now, we are ready to investigate
how to define words in terms of other words, or so-called <i>compound words</i>.
</p>
</div></div>
  </body>
</html>
