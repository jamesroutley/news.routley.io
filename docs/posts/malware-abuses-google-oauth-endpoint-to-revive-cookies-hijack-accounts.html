<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.bleepingcomputer.com/news/security/malware-abuses-google-oauth-endpoint-to-revive-cookies-hijack-accounts/">Original</a>
    <h1>Malware abuses Google OAuth endpoint to &#39;revive&#39; cookies, hijack accounts</h1>
    
    <div id="readability-page-1" class="page"><div>
<p><img alt="Google" height="900" src="https://www.bleepstatic.com/content/hl-images/2023/12/29/google-flare.jpg" width="1600"/></p>
<p>Multiple information-stealing malware families are abusing an undocumented Google OAuth endpoint named &#34;MultiLogin&#34; to restore expired authentication cookies and log into users&#39; accounts, even if an account&#39;s password was reset.</p>
<p>Session cookies are a special type of browser cookie that contains authentication information, allowing a person to automatically log in to websites and services without entering their credentials.</p>
<p>These types of cookies are meant to have a limited lifespan, so they cannot be used indefinitely by threat actors to log into accounts if they are stolen.</p>
<p>In late November 2023, BleepingComputer reported on two information-stealers, namely Lumma and Rhadamanthys, who claimed they could <a href="https://www.bleepingcomputer.com/news/security/malware-dev-says-they-can-revive-expired-google-auth-cookies/" target="_blank">restore expired Google authentication cookies</a> stolen in attacks.</p>
<p>These cookies would allow the cybercriminals to gain unauthorized access to Google accounts even after the legitimate owners have logged out, reset their passwords, or their session has expired.</p>
<p>BleepingComputer has contacted Google multiple times over a month with questions about these claims and how they plan to mitigate the issue, but we never received a response.</p>
<h2>Exploiting Google OAuth endpoint</h2>
<p>A report published today by CloudSEK researchers sheds more light on how this zero-day exploit works and paints a dire picture regarding the scale of its exploitation.</p>
<p>The exploit was first revealed by a threat actor named PRISMA on October 20, 2023, who posted on Telegram that they discovered a way to restore expired Google authentication cookies.</p>
<p>After reverse engineering the exploit, CloudSEK discovered it uses an undocumented Google OAuth endpoint named &#34;MultiLogin,&#34; which is intended for synchronizing accounts across different Google services by accepting a vector of account IDs and auth-login tokens.</p>
<p>&#34;This request is used to set chrome accounts in browser in the Google authentication cookies for several google websites (e.g. youtube),&#34; explains a <a href="https://chromium.googlesource.com/chromium/src/google_apis/+/refs/heads/main/gaia/gaia_auth_fetcher.cc#:~:text=%22This%20request%20is%20used%20to%20set,not%20consistent%20with%20accounts%20in%20browser.%22" target="_blank" rel="nofollow noopener">description of the API endpoint</a> in the Google Chrome source code.</p>
<p>&#34;This request is part of Gaia Auth API, and is triggered whenever accounts in cookies are not consistent with accounts in browser,&#34; a variable in the source code further explains.</p>
<p>CloudSEK says that information-stealing malware abusing this endpoint extracts tokens and account IDs of Chrome profiles logged into a Google account. This stolen information contains two crucial pieces of data: service (GAIA ID) and encrypted_token.</p>
<p>The encrypted tokens are decrypted using an encryption stored in Chrome&#39;s &#39;Local State&#39; file. This same encryption key is also used to decrypt saved passwords in the browser.</p>
<p>Using the stolen token:GAIA pairs with the MultiLogin endpoint, the threat actors can regenerate expired Google Service cookies and maintain persistent access on compromised accounts.</p>
<div>
<figure><img alt="Using token:GAIA pairs read from a text file to generate requests to MultiLogin" height="305" src="https://www.bleepstatic.com/images/news/u/1220909/2023/Malware/71/exploited-endpoint.png" width="823"/><figcaption><strong>Using token:GAIA pairs read from a text file to generate requests to MultiLogin</strong></figcaption></figure></div>
<p>In a discussion with CloudSek researcher Pavan Karthick, BleepingComputer was told they reverse-engineered the exploit and were able to use it to regenerate expired Google authentication cookies, as shown below.</p>
<div>
<figure><img alt="Successful cookie regeneration following password reset" height="429" src="https://www.bleepstatic.com/images/news/u/1220909/2023/Malware/71/regeneration.png" width="1200"/><figcaption><strong>Successful cookie regeneration following password reset</strong></figcaption></figure></div>
<p>However, Karthick explained that the authentication cookie can only be regenerated once if a user resets their Google password. Otherwise, it can be regenerated multiple times, providing persistent access to the account.</p>
<h2>Malware devs rush to add exploit</h2>
<p>Lumma stealer first adopted the exploit on November 14, whose developers applied blackboxing techniques such as encrypting the token:GAIA pair with private keys to hide the mechanism from competitors and prevent the replication of the feature.</p>
<p>Still, others were able to copy the feature or incorporate PRISMA&#39;s exploit into their stealers, with Rhadamanthys being the first to follow on November 17.</p>
<p>Since then, numerous other information stealers have adopted the exploit, including Stealc on December 1, Medusa on December 11, RisePro on December 12, and Whitesnake on December 26.</p>
<p>So, at least six info-stealers currently claim the ability to regenerate Google cookies using this API endpoint.</p>
<p>Threat intelligence firm Hudson Rock has also published the following video on YouTube, where a cybercriminal demonstrates how the cookie restoration exploit works.</p>
<p><iframe allowfullscreen="allowfullscreen" frameborder="0" mozallowfullscreen="mozallowfullscreen" msallowfullscreen="msallowfullscreen" oallowfullscreen="oallowfullscreen" scrolling="no" src="//www.youtube.com/embed/NzAtZzzFoOs" webkitallowfullscreen="webkitallowfullscreen"></iframe></p>
<p>A subsequent release by Lumma updated the exploit to counteract Google&#39;s mitigations, suggesting that the tech giant knows about the actively exploited zero-day flaw.</p>
<p>Specifically, Lumma turned to using SOCKS proxies to evade Google&#39;s abuse detection measures and implemented encrypted communication between the malware and the MultiLogin endpoint.</p>
<p>However, since Google hasn&#39;t confirmed the abuse of the MultiLogin endpoint, the status of the exploitation and its mitigation efforts remain unclear at this time.</p>

</div></div>
  </body>
</html>
