<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.nathanmanousos.com/posts/chonky-menu">Original</a>
    <h1>Chonky Menu Re-Creation</h1>
    
    <div id="readability-page-1" class="page"><div><div><!-- <div class="pt-16 pl-5 absolute left-0 t-0 hidden lg:block">
        {!isHome && <SiteNav sidebar />}
      </div> --><main><header><hr/></header>

<p>This post contains 11 interactive illustrations for you to play with. The
final menu is at the bottom. Don’t feel bad if you just want to scroll through
fiddling with the demos, or <a href="https://www.youtube.com/watch?v=1VgrdLfDozo">watch the
video</a>!</p>
<p>I came across this fun menu design concept <a href="https://twitter.com/jmtrivedi/status/1610017363218563072">shared on Twitter</a> by Janum Trivedi. Go watch it, I’ll wait. Janum added lots of fun details to his menu prototype built in Swift, and I just <em>had</em> to try re-creating it using Javascript (technically <a href="https://www.imba.io">Imba</a>).</p>
<p>I don’t usually like to copy other people’s work. I hoped to add some value by putting together these interactive illustrations which show how various parts of the UI work.</p>
<h2 id="putting-something-on-the-page">Putting Something on the Page</h2>
<p>First I set up a menu, and calculated the vertical center of each row. The centers are visualized as horizontal black lines in the illustration below. An event listener tracks mouse movements in order to get the mouse Y position, which is visualized as a red line in the illustration.</p>
<figure><div></div><figcaption><p>Move your mouse (mobile users: press and hold briefly, then drag) over the
illustration to see a visualization of the mouse’s Y position.</p></figcaption></figure>
<p>Now that we have the mouse Y position, and each row’s center Y position, we can easily check which row is closest to the mouse by looping through the list of row positions and comparing them to the mouse position. I’ll store a reference to the closest row, and how far the mouse is from it, visualized in purple below.</p>
<figure><div></div><figcaption><p>Move your mouse over the illustration to see which mark is closest and how
far it is from the mouse.</p></figcaption></figure>
<h2 id="zoom--cursor">Zoom &amp; Cursor</h2>
<p>The original design had a white highlight behind the active menu item, which I’m calling the “cursor”.
With the closest row figured out, we can add a box with its Y position such that it is centered on the closest row.</p>
<p>The closest row also zooms in slightly, so I’ve added a CSS scale transform to the closest row. The cursor and zoom effect are visible in the following illustration.</p>
<figure><div></div><figcaption><p>Notice how the cursor (visualized as a green box) jumps to the row closest
to the mouse, and how that row scales up slightly.</p></figcaption></figure>
<h2 id="decay-into-radness">Decay into Radness</h2>
<p>So far, the movements are jumpy. We’ll be adding animations shortly. Lets first add what I’m calling “decay” to the cursor and menu content. In Janum’s original menu, the cursor and menu content gravitate towards the pointer (finger) as it slides past. To accomplish this, I’m using a math function that will translate the distance from the pointer to the closest row, into a decayed value that has the desired effect.</p>
<p>To do the decay, we need a function that for small inputs, returns a value close to that input, and as the input value gets larger, the output starts to slow its rate of increase, smoothly approaching a maximum value which it never passes.</p>
<p>I wasn’t sure what type of math function would work for this, but I had happened to see a <a href="https://twitter.com/gingerbeardman/status/1694993695152484624">Retweet from Matt Sephton</a> of a post by <a href="https://twitter.com/_phocom/status/1693217561381404801">@_phocom</a> which is a convenient reference of math functions that are useful in graphics and game programming.</p>
<p>Looking through these graphs, we have a clear winner: <code>tanh(x)</code>. It starts off at <code>Y=0</code>, increasing first quickly, then slowing down and never passing <code>Y=1</code>. The maximum value can be adjusted by multiplying the function by a constant, something like, <code>tanh(x) * max</code>, and the “slowness” of the initial decay can be controlled by manipulating the <code>X</code> value, I ended up with this function:</p>
<figure><div></div></figure>
<p>Which creates this graph:</p>
<figure><div></div><figcaption><p>Interactive graph of <code>tanh(x)</code>, the <a href="https://en.wikipedia.org/wiki/Hyperbolic_functions">hyperbolic tangent
function</a>.</p></figcaption></figure>
<p>The following illustration helps visualize this. You can drag the rectangles and they move together. The blue one follows your pointer and the red one has its Y position run through the decay function. The position of each box is plotted, and you’ll see the blue one traces out a <code>Y=X</code> graph while the red one traces a version of our <code>tanh(x)</code> function.</p>
<figure><div></div><figcaption><p>Drag the red and blue boxes to see the decay effect. The blue box will move
with your pointer and the red box has its movement passed through the decay
function causing it to smoothly stop at the maximum of 50. Notice how it
traces out the tanh(x) function’s graph.</p></figcaption></figure>
<p>To add this into the menu, I took the distance of the cursor to the closest menu item, passed it through this decay function and used that to calculate the new <code>Y</code> value of the cursor. I used a version with a slightly adjusted maximum for the menu content, so they have different movement, resulting in a subtle <a href="https://en.wikipedia.org/wiki/Parallax">parallax</a>.</p>
<p>Move your mouse across the illustration below to see the original value (purple) and decayed values (green
for the cursor’s center and blue for the menu content’s center).</p>
<figure><div></div><figcaption><p>Notice how the decayed values slow their movement as the cursor moves away
from the center, so they feel like they are trying to reach your cursor but
are held back. (The values are exaggerated slightly in this illustration).</p></figcaption></figure>
<h2 id="just-add-springs">Just add Springs</h2>
<p>So far there’s no animations. To make this menu feel natural, we’re going to animate it using a spring simulation. I tried using an off-the-shelf animation library but ran into lots of glitches, so I went looking for some spring animation code I could use. I remembered that Cheng Lou had shared <a href="https://chenglou.me/">his impressive website</a> which is full of springy animations, and <a href="https://github.com/chenglou/chenglou.github.io">the source code</a> is available on GitHub.</p>
<p>I found a simple <a href="https://github.com/chenglou/chenglou.github.io/blob/master/index.html#L92-L112">spring animation function</a> within the code, and (with his permission) I gave it a try. I created a component in my project called <code>SpringLayer</code> which accepts a set of values representing the x, y, width, height, opacity, and scale of the layer. By updating any of those values, the layer will animate to the new values using a spring simulation.</p>
<p>You can play with a <code>SpringLayer</code> in the illustration below. The green dot shows the current “destination” of the rectangle, any time that changes, the layer animates to the new positon. The same applies to all the animated values (like width and height).</p>
<figure><div></div><figcaption><p>Drag, click the arrow buttons, or use the <code>a/s/d/f</code> keys, to move the blue
square. Notice how you can interrupt the movement and the animation
continues to look smooth. Disable the spring to use a CSS transition
instead, and notice that interrupting the animation is less smooth.</p></figcaption></figure>
<p>The great thing about a spring simulation is that you can interrupt it and give it a new target value, and it will smoothy animate there. Because my animations will be updated every time the mouse moves, this is very important. The spring animations also give a pleasing, lifelike appearance.</p>
<p>So, I recklessly replaced all the elements of my menu that needed to animate with <code>SpringLayer</code>s and just set the whole thing to re-render sixty times a second. I thought surely this would cause performance issues because I’d be re-calculating a spring value for each property of each animated layer each frame, but I never had an issue (on desktop at least), so given that this is a prototype, I just went with it.</p>
<p>Adding springs everywhere ended up being easy way to make the animation work.</p>
<figure><div></div><figcaption><p>The same menu from before with animated SpringLayer components inserted in
place of div tags.</p></figcaption></figure>

<p>The menu is supposed to start out hidden, so I set its opacity to 0% and its scale to 25%, and added an activator button. When pressing on that button, I set the opacity and scale to 100%. Remeber these are “destination” values for the <code>SpringLayer</code>, so the springs go to work and animate the menu to those values.</p>
<p>The cursor doesn’t appear until you first slide your mouse into the menu. You can see a <code>wentIn</code> value in the data display in the illustration below which tracks whether the mouse has crossed over the Y position of the bottom of the menu since the last activation.</p>
<p>The remaining demos require you to press the activator circle to activate the menu.</p>
<figure><div></div><figcaption><p>Press down on the circle to activate the menu, then slide up to reveal the
cursor.</p></figcaption></figure>

<p>The coolest part of the original menu is the stretch effect that happens when you drag past the top or bottom of the menu. I can add this by setting a CSS transform value like <code>transform: scaleY(1.2)</code>, but that will stretch out from the center, in both directions. The menu needs to stretch only in the direction of the pointer, so I to dynamically update the origin (controlled by the <code>transform-origin</code> css property)</p>
<p>In the next illustration, you’ll see the origin visualized with a red dot. The distance past the top or bottom of the menu are visualized in green.</p>
<p>I also added a way to cancel the menu activation by dragging even further past the ends, which you can try in the illustration below.</p>
<figure><div></div><figcaption><p>Try dragging past the top or bottom to see the stretch effect. Notice how
the origin affects the stretch.</p></figcaption></figure>
<p>I don’t want the scale to continue forever as your mouse continues past the edge, so I run the distance past the edge through our same decay function from before, giving me a value that slows down as it approaches a maximum distance of my choice. Now I have a distance value that approaches a maximum, and I need to translate that into a stretch amount that approaches a maximum stretch. I do the conversion using a <code>range</code> function. <a href="https://www.trysmudford.com/blog/linear-interpolation-functions/">This post</a> by Trys Mudford explains <code>range</code>, and other “lerp” functions in Javascript.</p>
<h2 id="putting-it-all-together">Putting it all Together</h2>
<p>To finish the menu, I added the names, avatar images, and other polish to make it look like a real menu.</p>
<figure><div></div><figcaption>The final menu re-creation.</figcaption></figure>
<p>It was fun building this menu, and I learned a ton. I’m excited to make more fluid UI concepts like this using what I’ve learned.</p>
<p><em>All credit for the menu design goes to Janum, please <a href="https://twitter.com/jmtrivedi">follow him on Twitter</a>, he shares really cool prototypes.</em></p>
<figure><div><p><iframe src="https://www.youtube-nocookie.com/embed/1VgrdLfDozo" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></p></div><p><figcaption>Watch the video version of this post</figcaption></p></figure><hr/></main></div></div></div>
  </body>
</html>
