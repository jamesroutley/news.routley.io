<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://crypto.stackexchange.com/questions/31807/why-does-my-ssh-private-key-still-work-after-changing-some-bytes-in-the-file">Original</a>
    <h1>Why does my SSH private key still work after changing some bytes? (2016)</h1>
    
    <div id="readability-page-1" class="page"><div id="mainbar" role="main" aria-label="question and answers">

                
<div data-questionid="31807" data-position-on-page="0" data-score="80" id="question">
    


    <div>
        

        

<div>
    <p><span>$\begingroup$</span></p><div itemprop="text">
                
<p>I (for a test) just randomly altered a private RSA key by opening it up in Vim and changing a few bytes. It is the private part of an SSH key pair used for logging in on a remote system. Puzzlingly, it still allows me to login.</p>

<p>I did some research and found that it is a base64 encoded ASN.1 container, so I pulled all the relevant integers out with OpenSSL and it seems only $d$, the private exponent, has changed (and only slightly at that). Is it possible the additional cached values are therefore being used to decrypt the value sent from the server, in order to still allow me to be logging in? The public key can (as expected) still be derived due to the other integers in the ASN.1 still being the same.</p>

<p>As I&#39;m an encryption dufus I&#39;d appreciate some guidance on how the above is possible. I&#39;ve found when I modify the key in Vim by larger amounts it rejects me as expected. Thanks.</p>
    </div>

        

    <div>
        <div>
            

                <div>
<div>
    
    <div>
        <a href="https://crypto.stackexchange.com/users/18242/stackzofztuff"><p><img src="https://www.gravatar.com/avatar/43490fb1bcecc6bc5dee2c7592d9995c?s=64&amp;d=identicon&amp;r=PG&amp;f=1" alt="StackzOfZtuff&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    
</div>
                </div>
            <div>
                <div>
    <p>
        asked <span title="2016-01-09 19:15:55Z">Jan 9, 2016 at 19:15</span>
    </p>
    <div>
        <a href="https://crypto.stackexchange.com/users/30443/philpotter1987"><p><img src="https://www.gravatar.com/avatar/0b931582c0dad31cc111638b0159c1b4?s=64&amp;d=identicon&amp;r=PG" alt="PhilPotter1987&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    
</div>


            </div>
        </div>
    </div>
    <p><span>$\endgroup$</span>
</p></div>




            <p><span itemprop="commentCount">3</span></p>
    </div>

</div>



                <div id="answers">
                    


                                        
<div id="answer-31810" data-answerid="31810" data-parentid="31807" data-score="112" data-position-on-page="1" data-highest-scored="1" data-question-has-accepted-highest-score="1" itemprop="acceptedAnswer" itemscope="" itemtype="https://schema.org/Answer">
    <div>
        

        

<div>
    <p><span>$\begingroup$</span></p><div itemprop="text">
<p>An ASN.1-encoded SSH private key contains the following integers in order:</p>

<ul>
<li>The public modulus $n$ and exponent $e$;</li>
<li>The private exponent $d$;</li>
<li>The prime factors $p$ and $q$ of $n$;</li>
<li>The &#34;reduced&#34; private exponents $d_p=d\bmod(p-1)$ and $d_q=d\bmod(q-1)$;</li>
<li>The &#34;CRT coefficient&#34; $q_{\text{inv}}=q^{-1}\bmod p$.</li>
</ul>

<p>The observation that the value of $d$ in such a key may be irrelevant is due to the following: To speed up exponentiation modulo $n$ by a factor of about $4$, the <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Using_the_Chinese_remainder_algorithm" rel="noreferrer">Chinese Remainder Theorem</a> can be utilized to compute the result modulo $p$ and $q$ separately and subsequently combine them to obtain the &#34;real&#34; result modulo $n$. With this optimization, the values of <strong>$n$, $e$ and $d$ are not required</strong>, hence are ignored by typical implementations whenever $p$, $q$, $d_p$, $d_q$ and $q_{\text{inv}}$ are available*. This is why changing some characters in the middle of the key need not necessarily destroy it, depending on which of the components you change.</p>

<p><sub>*) at least for OpenSSH, they do not have to be present: setting $p=q=1$ and $d_p=d_q=q_{\text{inv}}=0$ makes the implementation use $n$ and $d$.</sub></p>

<p>To visualize the arrangement of the individual components, I created the following graphic from a typical 4096-bit RSA private key file:</p>

<p><a href="https://i.stack.imgur.com/izgDy.png" rel="noreferrer"><img src="https://i.stack.imgur.com/izgDy.png" alt="RSA private key with highlightning of the encoded numbers"/></a></p>

<p>The grey part right in the beginning is ASN.1 header data (encoding the fact that a sequence is about to follow, etc), followed by the integers forming the key as described above. The ASN.1 header data associated to each component (mostly a length field) is colored slightly brighter than the data representing the integer itself. Note that the pictured subdivision is not 100% accurate as one Base64 character encodes roughly $3/4$ raw bytes, hence some boundaries should actually run strictly within a single character.</p>
    </div>
    <div>
        <div>
            
            <div>
<div>
    
    <div>
        <a href="https://crypto.stackexchange.com/users/12164/e-sushi"><p><img src="https://i.stack.imgur.com/blJlL.png?s=64&amp;g=1" alt="e-sushi&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    <div>
        <p><a href="https://crypto.stackexchange.com/users/12164/e-sushi">e-sushi</a></p><p><span title="reputation score 17,527" dir="ltr">17.5k</span><span title="12 gold badges" aria-hidden="true"><span></span><span>12</span></span><span>12 gold badges</span><span title="79 silver badges" aria-hidden="true"><span></span><span>79</span></span><span>79 silver badges</span><span title="221 bronze badges" aria-hidden="true"><span></span><span>221</span></span><span>221 bronze badges</span>
        </p>
    </div>
</div>
            </div>


            <div>
                <div>
    <p>
        answered <span title="2016-01-09 20:10:26Z">Jan 9, 2016 at 20:10</span>
    </p>
    <div>
        <a href="https://crypto.stackexchange.com/users/18376/yyyyyyy"><p><img src="https://i.stack.imgur.com/tGxHS.png?s=64&amp;g=1" alt="yyyyyyy&#39;s user avatar" width="32" height="32"/></p></a>
    </div>
    <div itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <p><a href="https://crypto.stackexchange.com/users/18376/yyyyyyy">yyyyyyy</a><span itemprop="name">yyyyyyy</span></p><p><span title="reputation score 11,561" dir="ltr">11.6k</span><span title="4 gold badges" aria-hidden="true"><span></span><span>4</span></span><span>4 gold badges</span><span title="45 silver badges" aria-hidden="true"><span></span><span>45</span></span><span>45 silver badges</span><span title="64 bronze badges" aria-hidden="true"><span></span><span>64</span></span><span>64 bronze badges</span>
        </p>
    </div>
</div>


            </div>
        </div>
        
    
    </div>
    <p><span>$\endgroup$</span>
</p></div>




            <p><span itemprop="commentCount">6</span></p>
    </div>
</div>


                        


                            <h2 data-loc="1">
                                
                            </h2>
                </div>
            </div></div>
  </body>
</html>
