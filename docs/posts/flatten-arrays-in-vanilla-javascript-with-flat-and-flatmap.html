<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.wisdomgeek.com/development/flatten-arrays-in-vanilla-javascript-with-flat-and-flatmap/">Original</a>
    <h1>Flatten Arrays in Vanilla JavaScript with Flat() and FlatMap()</h1>
    
    <div id="readability-page-1" class="page"><div data-td-block-uid="tdi_70_ed8"><div><p>ES2019 introduced two methods on the array prototype that would make life so much simpler for developers. These are flat() and flatmap() which help in flattening arrays.</p><h2>Array.prototype.flat()</h2><p>As the name suggests, the flat() method returns a new array with elements of the subarray flattened into it, that is the sub-elements are concatenated into a single array.</p><p><span>- Advertisement -</span> <ins data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1198872678846288" data-ad-slot="2989761355"></ins> </p><pre><code>[[1, 2], [3, 4], [5, 6]].flat();

// [1, 2, 3, 4, 5, 6]</code></pre><p>By default, it flattens only one level deep, but it does take a depth argument which can be used to specify how many levels of depth we want to flatten.</p><pre><code>const twoLevelsDeep = [[1, [2, 2], 1]];

// depth = 1
twoLevelsDeep.flat();
// [1, [2, 2], 1]

// depth = 2
twoLevelsDeep.flat(2);
// [1, 2, 2, 1]
</code></pre><p><strong>Note: </strong>Infinity is a valid value for the depth if we want it to go all the way down.</p><h2>Array.prototype.flatMap()</h2><p>flatMap is a smarter version of map, which does mapping of an array and flattening in one go. It does map() first, and then flat() even though that is not the order in the naming of the function.</p><pre><code>const newArray = arrayObject.flatMap(callback(currentValue, index, array) { 
...
}, thisArg);</code></pre><p>As can be seen, the flatMap method takes in a callback function and a reference to this as arguments. The thisArg is optional and is the value used for the “this” variable inside the callback.</p><p>The callback function contains a reference to the current value and the index and array values are optional. The return value of the function is the flattened value of the array returned by the callback function.</p><p>This is a very common operation with nested data where you want to select children from an array of objects. But before that, let us look at a contrived example:</p><pre><code>let array = [1, 2, 3, 4];

<meta charset="utf-8"/>array.map(x =&gt; [x * 2]);
// [[2], [4], [6], [8]]

<meta charset="utf-8"/>array.flatMap(x =&gt; [x * 2]);
// [2, 4, 6, 8]

// only one level is flattened
<meta charset="utf-8"/>array.flatMap(x =&gt; [[x * 2]]);
// [[2], [4], [6], [8]]</code></pre><p>There is no way to specify the depth in a flatMap and it is set to 1 by default.</p><p>A more practical use case would be, if we wanted to check all the roles all users have:</p><pre><code>[
  { name: &#34;Saransh Kataria&#34; , roles: [&#39;system-admin&#39;, &#39;developer&#39;] },
  { name: &#34;Wisdom Geek&#34; , roles: [&#39;basic&#39;] },
].flatMap(x =&gt; x.<meta charset="utf-8"/>roles);

// Output =&gt; [&#34;<meta charset="utf-8"/>system-admin&#34;, &#34;<meta charset="utf-8"/>developer&#34;, &#34;basic&#34;]</code></pre><p>It is also possible to add or remove elements when using flatMap() which is not a possibility using map().</p><p>If we wanted to remove all negative items from an array:</p><pre><code>const numbers = [-1, 2, 3, -4, 5];

numbers.flatMap(number =&gt; {
  return number &lt; 0 ? [] : [number];
});

// [ 2, 3, 5]</code></pre><p>It can act as filter because of the empty array.</p><pre><code>const emptyNestedArray = [[], 1];

emptyNestedArray.flat();
// [ 1 ]</code></pre><p>Similarly, if we return an array with multiple elements from the callback, those would be added as individual items to the flattened array.</p><p>For example, if we wanted to add a number’s double and triple right after every element in an array:</p><pre><code>const numbers = [1, 2];
const appendedDoublesTriples = numbers.flatMap(number =&gt; {
  return [number, 2 * number, 3 * number];
});
console.log(<meta charset="utf-8"/>appendedDoublesTriples);
// logs [1, 2, 3, 2, 4, 6]</code></pre><p>And that is all there is to know about flat and flatMap(). Hope these were helpful and again, these were a part of ES2019, so we need to add polyfills if we are supporting browsers before that.</p></div></div></div>
  </body>
</html>
