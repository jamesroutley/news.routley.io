<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.deeplearning.ai/the-batch/the-paella-model-for-fast-image-generation-explained/">Original</a>
    <h1>Like diffusion but faster: The Paella model for fast image generation</h1>
    
    <div id="readability-page-1" class="page"><div><p>The ability to generate realistic images without waiting would unlock applications from engineering to entertainment and beyond. New work takes a step in that direction.</p><p><strong>What’s new: </strong>Dominic Rampas and colleagues at Technische Hochschule Ingolstadt and Wand Technologies released <a href="https://arxiv.org/abs/2211.07292?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">Paella</a>, a system that uses a process similar to diffusion to produce Stable Diffusion-quality images much more quickly.</p><p><strong>Key insight: </strong>An image generator’s speed depends on the number of steps it must take to produce an image: The fewer the steps, the speedier the generator. A <a href="https://arxiv.org/abs/2105.05233?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">diffusion model</a> learns to remove varying amounts of noise from each training example; at inference, given pure noise, it produces an image by subtracting noise iteratively over a few hundred steps. A <a href="https://arxiv.org/abs/2112.10752?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">latent diffusion model</a> reduces the number of steps to around a hundred by removing noise from a vector that represents the image rather than the image itself. Instead of a vector, using a selection of tokens from a predefined list makes it possible to do the same job in still fewer steps.</p><p><strong>How it works: </strong>Like a diffusion model, Paella learned to remove varying amounts of noise from tokens that represented an image and then produced a new image from noisy tokens. It was trained on 600 million image-text pairs from <a href="https://laion.ai/blog/laion-aesthetics/?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">LAION-Aesthetics</a>.</p><ul><li>Given an image of 256x256 pixels, a pretrained <a href="https://arxiv.org/abs/2012.09841?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">encoder-decoder</a> based on a convolutional neural network represented the image using 256 tokens selected from 8,192 tokens it had learned during pretraining.</li><li>The authors replaced a random fraction of the tokens with tokens chosen from the list at random. This is akin to adding noise to an example in training a diffusion model.</li><li>Given the image’s text description, <a href="https://arxiv.org/abs/2103.00020?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">CLIP</a>, which maps corresponding text and images to the same embedding, generated an embedding for it. (The authors used CLIP’s text-image embedding capability only for ablation experiments.)</li><li>Given the text embedding and the tokens with random replacements, a <a href="https://arxiv.org/abs/1505.04597?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">U-Net</a> (a convolutional neural network) learned to generate all the original tokens.</li><li>They repeated the foregoing steps 12 times, each time replacing a smaller fraction of the generated tokens. This iterative procedure trained the U-Net, guided by the remaining generated tokens, to remove a smaller amount of the remaining noise at each step.</li><li>At inference, given a text prompt, CLIP generated an embedding. Given a random selection of 256 tokens, the U-Net regenerated all the tokens over 12 steps. Given the tokens, the decoder generated an image.</li></ul><p><strong>Results:</strong> The authors evaluated Paella (573 million parameters) according to Fréchet inception distance (FID), which measures the difference between the distributions of original and generated images (lower is better). Paella achieved 26.7 FID on <a href="https://cocodataset.org/?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">MS-COCO</a>. Stable Diffusion v1.4 (860 million parameters) trained on <a href="https://laion.ai/blog/laion-aesthetics/?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">2.3 billion images</a> achieved 25.40 FID — somewhat better, but significantly slower. Running on an Nvidia A100 GPU, Paella took 0.5 seconds to produce a 256x256-pixel image in eight steps, while Stable Diffusion took 3.2 seconds. (The authors reported FID for 12 steps but speed for eight steps.)</p><p><strong>Why it matters: </strong>Efforts to accelerate diffusion have focused on <a href="https://twitter.com/EMostaque/status/1598131202044866560?utm_campaign=The%20Batch&amp;utm_source=hs_email&amp;utm_medium=email&amp;_hsenc=p2ANqtz-9sb00_4vxeZV9IwatG6RjF9THyqdWuQ47paEA_y055Eku8IYnLnfILzB5BWaMHlRPQipHJ" rel="noopener noreferrer">distilling models such as Stable Diffusion</a>. Instead, the authors rethought the architecture to reduce the number of diffusion steps.</p><p><strong>We’re thinking: </strong>The authors trained Paella on 64 NVIDIA A100s for two weeks using computation from Stability AI (the group behind Stable Diffusion). It’s great to see such partnerships between academia and industry that give researchers access to computation.</p></div></div>
  </body>
</html>
