<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://crystal-lang.org/2022/07/06/1.5.0-released.html">Original</a>
    <h1>Crystal 1.5</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p>We are delivering a new release with several bugfixes and improvements. Below we list the most important or interesting changes, without mentioning several bugfixes and smaller enhancements. For more details, visit the <a href="https://github.com/crystal-lang/crystal/releases/tag/1.5.0">changelog</a>. Breaking changes are marked with ⚠️.</p>

<p>Pre-built packages are available on <a href="https://github.com/crystal-lang/crystal/releases/tag/1.5.0">GitHub Releases</a> and our official distribution channels.
See <a href="https://crystal-lang.org/install/">crystal-lang.org/install</a> for installation instructions.</p>

<h2 id="stats">Stats</h2>

<p>In this release we included <a href="https://github.com/crystal-lang/crystal/pulls?q=is%3Apr+milestone%3A1.5.0">102 changes since the 1.4.1 release</a> by 23 contributors. We thank all the effort put into improving the language! ❤️</p>

<p>Below we list the most remarkable changes in the language and stdlib.</p>

<h2 id="️-parameters-of-methods-implementing-an-abstract-def-must-match-the-names">⚠️ Parameters of methods implementing an abstract <code><span>def</span></code> must match the names</h2>

<p>In order to provide better documentation and robustness, it is possible to explicitly associate arguments with their names (<a href="https://crystal-lang.org/reference/1.5/syntax_and_semantics/default_and_named_arguments.html#named-arguments">ref</a>):</p>

<div><div><pre><code><span>class</span> <span>Foo</span>
  <span>def</span> <span>foo</span><span>(</span><span>name</span> <span>:</span> <span>Int32</span><span>)</span> <span>:</span> <span>Nil</span>
    <span>p</span> <span>name</span>
  <span>end</span>
<span>end</span>

<span>Foo</span><span>.</span><span>new</span><span>.</span><span>foo</span> <span>name: </span><span>42</span>
</code></pre></div></div>

<p>As a consequence, it is sensible to consider that the name of an argument is part of its interface. Before 1.5.0, however, the compiler was not checking that the name of arguments matched between an implementation of an abstract method and its definition. That is, the following example compiled without error or warning:</p>

<div><div><pre><code><span>abstract</span> <span>class</span> <span>FooAbstract</span>
  <span>abstract</span> <span>def</span> <span>foo</span><span>(</span><span>number</span> <span>:</span> <span>Int32</span><span>)</span> <span>:</span> <span>Nil</span>
<span>end</span>

<span>class</span> <span>Foo</span> <span>&lt;</span> <span>FooAbstract</span>
  <span>def</span> <span>foo</span><span>(</span><span>name</span> <span>:</span> <span>Int32</span><span>)</span> <span>:</span> <span>Nil</span>
    <span>p</span> <span>name</span>
  <span>end</span>
<span>end</span>
</code></pre></div></div>

<p>Starting from 1.5.0 (<a href="https://github.com/crystal-lang/crystal/pull/11915">#11915</a>) the example above will raise a warning:</p>

<div><div><pre><code> 6 | def foo(name : Int32) : Nil
             ^---
Warning: positional parameter &#39;name&#39; corresponds to parameter &#39;number&#39; of the overridden method FooAbstract#foo(number : Int32), which has a different name and may affect named argument passing
</code></pre></div></div>

<h2 id="method-restrictions-from-instance-variables">Method restrictions from instance variables</h2>

<p>When an instance variable is assigned the value of an untyped method argument, then the argument is restricted to share the same type as the instance variable.</p>

<p>For instance, consider this code:</p>

<div><div><pre><code><span>class</span> <span>Foo</span>
  <span>@x</span> <span>:</span> <span>Int64</span>

  <span>def</span> <span>initialize</span><span>(</span><span>x</span><span>)</span>
    <span>@x</span> <span>=</span> <span>x</span>
  <span>end</span>
<span>end</span>
</code></pre></div></div>

<p>Up to 1.4.1, <code><span>x</span></code> in <code><span>initialize</span></code> is unrestricted. This had several issues:</p>

<ol>
  <li>
    <p>If the user passes an incorrect argument, like <code><span>Foo</span><span>.</span><span>new</span> <span>&#39;a&#39;</span></code>, instead of marking the error in the argument <code><span>&#39;a&#39;</span></code>, it blames <code><span>x</span></code> for not having the right type.</p>
  </li>
  <li>
    <p>No autocast is performed, for instance, if we pass an <code><span>Int32</span></code> instead: <code><span>Foo</span><span>.</span><span>new</span> <span>1</span></code> fails.</p>
  </li>
  <li>
    <p>The generated documentation doesn’t provide a hint of the type of the parameter <code><span>x</span></code>.</p>
  </li>
</ol>

<p>From 1.5.0, in an assignment like <code><span>@x</span> <span>=</span> <span>x</span></code>, parameter <code><span>x</span></code> gets the type of <code><span>@x</span></code>, effectively solving the three issues above. Details can be read from <a href="https://github.com/crystal-lang/crystal/pull/12103">#12103</a>.</p>

<blockquote>
  <p>Note: This new feature is expected to be backwards compatible. If for some reason it brings you a headache you can disable it passing <code><span>-</span><span>Dno_restrictions_augmenter</span></code> in the build options. Let us know in the <a href="https://github.com/crystal-lang/crystal/issues">issue tracker</a> about it.</p>
</blockquote>

<h2 id="annotations-allowed-on-method-arguments">Annotations allowed on method arguments</h2>

<p>It is now possible to add an annotation to a parameter of a method or macro. As illustration, imagine a linter that warns if a parameter is not used.</p>

<div><div><pre><code><span>def</span> <span>foo</span><span>(</span><span>x</span><span>);</span> <span>end</span>  <span># Warning: argument `x` is not used</span>
</code></pre></div></div>

<p>Then, we could signal the linter to not warn us in a particular case. Assume the following annotation provided by the linter:</p>

<div><div><pre><code><span>annotation</span> <span>MaybeUnused</span><span>;</span> <span>end</span>
</code></pre></div></div>

<p>Applying it to the parameter removes the warning (in this particular fictitious linter):</p>

<div><div><pre><code><span>def</span> <span>foo</span><span>(</span><span>@[MaybeUnused]</span> <span>x</span><span>);</span> <span>end</span>  <span># OK</span>
</code></pre></div></div>

<p>Details in <a href="https://github.com/crystal-lang/crystal/issues/12039">#12039</a>.</p>

<h2 id="constant-indexers-for-tuples">Constant indexers for tuples</h2>

<p>When using a constant to index a tuple or named tuple, the typechecker will correctly infer the precise type of the value accessed (<a href="https://github.com/crystal-lang/crystal/pull/12012">#12012</a>).</p>

<div><div><pre><code><span>KEY</span> <span>=</span> <span>&#34;s&#34;</span>
<span>foo</span> <span>=</span> <span>{</span><span>s: </span><span>&#34;String&#34;</span><span>,</span> <span>n: </span><span>0</span><span>}</span>

<span># Before 1.5.0 this failed; it would assume the type of foo[key] to be (String | Int32)</span>
<span>puts</span> <span>foo</span><span>[</span><span>KEY</span><span>].</span><span>size</span>
</code></pre></div></div>

<h2 id="additions-in-file-api">Additions in File API</h2>

<p>New method <a href="https://crystal-lang.org/api/1.5.0/File.html#delete%3F%28path%3APath%7CString%29%3ABool-class-method"><code><span>File</span><span>#delete?</span></code></a> that, instead of raising, returns <code><span>false</span></code> if the file doesn’t exist. Similarly, there’s a new <a href="https://crystal-lang.org/api/1.5.0/Dir.html#delete%3F%28path%3APath%7CString%29%3ABool-class-method"><code><span>Dir</span><span>#delete?</span></code></a>. Details in <a href="https://github.com/crystal-lang/crystal/pull/11887">#11887</a>.</p>

<p>Additionally, several <code><span>File</span></code> methods now also operate on an instance: <a href="https://crystal-lang.org/api/master/File.html#chmod%28permissions%3AInt%7CPermissions%29%3ANil-instance-method"><code><span>File</span><span>#chmod</span></code></a>, <a href="https://crystal-lang.org/api/master/File.html#chown%28uid%3AInt%3D-1%2Cgid%3AInt%3D-1%29%3ANil-instance-method"><code><span>File</span><span>#chown</span></code></a>, <a href="https://crystal-lang.org/api/master/File.html#utime%28atime%3ATime%2Cmtime%3ATime%29%3ANil-instance-method"><code><span>File</span><span>#utime</span></code></a>, and <a href="https://crystal-lang.org/api/master/File.html#touch%28time%3ATime%3DTime.utc%29%3ANil-instance-method"><code><span>File</span><span>#touch</span></code></a>. Details in <a href="https://github.com/crystal-lang/crystal/pull/11886">#11886</a>.</p>

<h2 id="strengthening-the-security-of-filetempfile">Strengthening the security of <code><span>File</span><span>.</span><span>tempfile</span></code></h2>

<p>As per <a href="https://github.com/crystal-lang/crystal/pull/12076">#12076</a>, the creation of temporary files don’t allow null characters in the strings forming the name of the file.</p>

<h2 id="no_color-compliance">NO_COLOR compliance</h2>

<p>The compiler and the interpreter supports the <a href="https://no-color.org">NO_COLOR</a> <a href="https://crystal-lang.org/reference/1.5/using_the_compiler/index.html#environment-variables">environment variable</a> to disable colored output on the terminal. This is enabled by setting any non-empty value to <code><span>NO_COLOR</span></code>. Details in <a href="https://github.com/crystal-lang/crystal/pull/11984">#11984</a>.</p>

<h2 id="a-big-step-towards-native-windows-support">A big step towards native Windows support</h2>

<p>The concurrency runtime on Windows is now backed by a functioning event loop (<a href="https://github.com/crystal-lang/crystal/pull/12149">#12149</a>).
This crossed an important check in the <a href="https://github.com/crystal-lang/crystal/issues/5430">road to native Windows support</a>. Additionally, we now have a Windows-compatible <code><span>Makefile</span></code>(<a href="https://github.com/crystal-lang/crystal/pull/11773">#11773</a>).</p>

<h2 id="improvements-in-the-interpreter">Improvements in the interpreter</h2>

<p>The interpreter is coming to shape! <a href="https://github.com/crystal-lang/crystal/pulls?q=is%3Apr+sort%3Aupdated-desc+milestone%3A1.5.0+label%3Atopic%3Acompiler%3Ainterpreter">A whole bunch of interpreter bugs</a> got fixed.
While it won’t be released in the binaries distributions yet, we will work towards incorporating it in the major platforms right after this release. Stay tuned!
You can build the compiler with interpreter support locally with <code><span>make</span> <span>interpreter</span><span>=</span><span>1</span></code>, see the <a href="https://crystal-lang.org/2021/12/29/crystal-i.html">interpreter introduction post for more info</a>.</p>

<hr/>

<p>We have been able to do all of this thanks to the continued support of <a href="https://www.84codes.com/">84codes</a>, <a href="https://nikolamotor.com/">Nikola Motor Company</a> and every other <a href="https://crystal-lang.org/sponsors">sponsor</a>. To maintain and increase the development pace, donations and sponsorships are essential. <a href="https://opencollective.com/crystal-lang">OpenCollective</a> is available for that. Reach out to <a href="mailto:crystal@manas.tech">crystal@manas.tech</a> if you’d like to become a direct sponsor or find other ways to support Crystal. We thank you in advance!</p>

      </div></div>
  </body>
</html>
