<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://planetscale.com/blog/introducing-planetscale-insights-advanced-query-monitoring">Original</a>
    <h1>PlanetScale Insights: Advanced query monitoring</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><p>If you&#39;ve ever experienced the frustration of debugging slow or costly queries, we&#39;ve got a treat for you. With PlanetScale Insights, you can now analyze and debug individual query performance during specified time frames without leaving your PlanetScale dashboard.</p><h2 id="what-is-planetscale-insights"><a href="#what-is-planetscale-insights"><strong>What is PlanetScale Insights</strong><span aria-label="Permalink to this section">#</span></a></h2><p>Insights is the next generation of our in-dashboard query statistics tool. This update brings an interactive graph that maps your PlanetScale database query performance to selected time frames for quick debugging. We&#39;re also introducing a new section that shows important metrics for all active queries running against the database over the past 24 hours.</p><figure><img src="https://cdn.sanity.io/images/f1avhira/production/7ae971dae03d3ea5dcba00a57a2ece3c10c8eb58-3342x1646.png" alt="PlanetScale Insights time-based graph selection"/></figure><figure><img src="https://cdn.sanity.io/images/f1avhira/production/82115438fa21fe8916ff0572b6140bbb3ce27127-3426x1542.png" alt="PlanetScale Insights queries list time frame"/></figure><h3><strong>Insights time-based graph</strong></h3><p>With the new Insights graph, you can monitor the following metrics at a glance:</p><ul><li>Rows read</li><li>Rows written</li><li>Query latency</li><li>Queries per second</li></ul><p>You can hover over a point on the graph to see the metrics in 10-minute increments. This will surface the total rows read, rows written, latency, or queries per second during the selected period.</p><p>Additionally, <a href="https://docs.planetscale.com/concepts/deploy-requests">deploy requests</a> will show up on the graph, allowing you to quickly see the impact of the latest schema changes.</p><h3><strong>Queries during the last 24 hours</strong></h3><p>We&#39;ve also added a new section that shows all queries that have run against your database over the past 24 hours.</p><p>If you have a lot of active queries, you can zoom in on a shorter time frame by dragging your cursor on the graph to select the period you want to analyze.</p><p>The following metrics are available for each query:</p><ul><li>Number of times the query has run</li><li>Total time the query has run</li><li>Time per query</li><li>Rows returned</li><li>Rows read</li><li>Rows affected</li></ul><p>We&#39;re especially excited to surface the rows read per query! One component of <a href="https://docs.planetscale.com/concepts/billing">PlanetScale billing includes total rows read per month</a>, so Insights is a great resource to help you monitor how your queries affect rows read.</p><p>You can also click on a query to drill down even further. On the individual query page, you&#39;ll find slow instances of the query, if applicable. We&#39;ve also included a new UI for generating an <a href="https://dev.mysql.com/blog-archive/mysql-explain-analyze/"><code>EXPLAIN</code> plan</a> for each individual query, with the option to open it up in the web console as well.</p><figure><img src="https://cdn.sanity.io/images/f1avhira/production/826f5e49a373e60afe3bfa4e12e9bf9af0ae523e-3406x1978.png" alt="PlanetScale Insights explain plan"/></figure><p><strong>Pricing and availability</strong></p><p>PlanetScale Insights is currently in beta. During the beta period, plan availability is as follows:</p><ul><li><strong>Free Hobby</strong> — Full Insights access for the previous 24 hours</li><li><a href="https://planetscale.com/pricing"><strong>Scaler and Teams</strong></a> — Full Insights access for the previous 7 days</li><li><strong>Enterprise</strong> — Customize your retention period</li></ul><p>To access Insights, select your database in the PlanetScale dashboard and click the &#34;Insights&#34; tab.</p><h2 id="insights-in-action"><a href="#insights-in-action"><strong>Insights in action</strong><span aria-label="Permalink to this section">#</span></a></h2><p>To help drive the power of Insights home, let&#39;s see it in action.</p><p>In this example, we&#39;ll walk through a practical use case using our very own database for our <a href="https://github.com/planetscale/beam">open-source Beam project</a>.</p><p>Say we deployed a schema change to the production database and later noticed the posts page is loading slower than usual. Instead of spending hours searching for the offending query, we come to the Insights page to begin debugging.</p><p>We first look at the graph to identify any anomalies, such as any spikes in <em>rows read</em> or <em>rows written</em>. If this performance impact coincided with a deployment, the deploy request would show up on the graph next to the spike. This provides direct insight into what schema change caused the performance issues.</p><figure><img src="https://cdn.sanity.io/images/f1avhira/production/8095d3a82727b9551df60c893654c1c0c21b6bff-3022x1082.png" alt="PlanetScale Insights slow query deploy request on graph"/></figure><p>Based on the graph, we can see that there was a large spike right at the time we merged deploy request #289. This information gives us more confidence that this performance impact is indeed a database issue.</p><p>Next, we can drill down further by looking at the &#34;<strong>Queries during the last 24 hours</strong>&#34; table. We&#39;ll sort by &#34;Rows read&#34; to quickly identify our largest queries and attempt to find the one that matches the spike on the graph.</p><figure><img src="https://cdn.sanity.io/images/f1avhira/production/c5e69424863727deb674c984765520c75d35a27c-3358x1232.png" alt="PlanetScale Insights example queries sorted by rows read"/></figure><p>Up at the top, we see one query that stands out. At <strong>1,043,729 rows read</strong>, it&#39;s reading many more rows than we expect. Clicking on the query brings up the detailed view, which includes a list of all instances of the query running slowly in the past 24 hours.</p><p>Taking a closer look, we notice that this query has been running slowly since the previous deployment that we saw on the graph. We can open that deploy request to see what changed.</p><figure><img src="https://cdn.sanity.io/images/f1avhira/production/7ad29bf982eeeb8397f6330ae2c959f8994e590c-2504x816.png" alt="PlanetScale Insights slow query instances"/></figure><p>We have now identified the problematic query and linked it back to a schema change from our deploy request. With this information, we can create a new development branch where we can attempt to fix the issue. With Insights, we can see performance metrics for any branch, including development branches. As we’re developing the fix, we can come back to the Insights graph to confirm that our changes worked.</p><p>Finally, after deploying it to production, we come back to the Insights page to confirm production performance is back to normal.</p><h2 id="try-it-yourself"><a href="#try-it-yourself"><strong>Try it yourself</strong><span aria-label="Permalink to this section">#</span></a></h2><p>You can give Insights a spin today in the PlanetScale dashboard. You can then access Insights by clicking the “Insights” tab from your database overview page.</p><p>For more information, check out our <a href="https://docs.planetscale.com/concepts/query-insights">Insights documentation</a>. We love hearing from you! If you have any questions or feedback, don’t hesitate to <a href="https://planetscale.com/contact">reach out to us</a>.</p></div></div></div></div>
  </body>
</html>
