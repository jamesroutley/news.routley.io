<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/luajit-remake/luajit-remake">Original</a>
    <h1>LuaJIT Remake: An ongoing attempt to re-engineer LuaJIT from scratch</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 dir="auto"><a id="user-content-luajit-remake-project" aria-hidden="true" href="#luajit-remake-project"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>LuaJIT Remake Project</h2>
<p dir="auto"><em>This is a work-in-progress.</em></p>
<p dir="auto">The ultimate goal of this project is to implement a multi-tier method-JIT for Lua.</p>
<p dir="auto">We employ an unique approach where the interpreter and the JIT tiers are automatically generated from a semantical description of the bytecodes. We believe this will ultimately result in less engineering cost, cleaner and more maintainable code, as well as the <em>generalizability</em> to support other languages.</p>
<p dir="auto">Currently we have implemented:</p>
<ul dir="auto">
<li>A feature-complete Lua 5.1 interpreter, which is automatically generated from a <a href="https://github.com/luajit-remake/luajit-remake/blob/master/annotated/bytecodes">semantical description of the LuaJIT bytecodes</a>.</li>
<li>A completely re-engineered Lua runtime. For example, our implementation of the Lua table uses hidden class, instead of a naive hash table as in Lua/LuaJIT.</li>
</ul>
<h3 dir="auto"><a id="user-content-interpreter-performance-comparison" aria-hidden="true" href="#interpreter-performance-comparison"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Interpreter performance comparison</h3>
<p dir="auto">On <a href="https://github.com/luajit-remake/luajit-remake/blob/master/luabench">a variety of benchmarks</a>, we demonstrate that our interpreter is 34.6% faster than LuaJIT&#39;s interpreter, and 185% faster than the official PUC Lua5.1 interpreter<sup><a href="#user-content-fn-1-6759b322ba8387986b111985dd48d788" id="user-content-fnref-1-6759b322ba8387986b111985dd48d788" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup>.</p>
<p dir="auto">The following figure illustrates our performance vs LuaJIT interpreter, normalized to PUC Lua&#39;s performance. Blue shadow indicates benchmarks where we do better than LuaJIT, and red shadow indicates benchmarks where LuaJIT does better than us.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/luajit-remake/luajit-remake/blob/master/miscellaneous/interpreter-perf-comparison.png"><img src="https://github.com/luajit-remake/luajit-remake/raw/master/miscellaneous/interpreter-perf-comparison.png" alt=""/></a></p>
<h3 dir="auto"><a id="user-content-the-jit" aria-hidden="true" href="#the-jit"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>The JIT</h3>
<p dir="auto">The work for implementing the JIT tiers is ongoing...</p>
<h3 dir="auto"><a id="user-content-building-and-testing" aria-hidden="true" href="#building-and-testing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building and Testing</h3>
<p dir="auto">To build the project, make sure you have <code>docker</code> and <code>python3</code> installed, and run:</p>
<div data-snippet-clipboard-copy-content="python3 ljr-build make release"><pre><code>python3 ljr-build make release
</code></pre></div>
<p dir="auto">Once the build is complete, you should see an executable <code>luajitr</code> in the repository root directory. You can use it to run your Lua script, or run <code>bash run_bench.sh</code> to run all the benchmarks.</p>
<h3 dir="auto"><a id="user-content-caveats" aria-hidden="true" href="#caveats"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Caveats</h3>
<p dir="auto">Please note that this is an ongoing project that is still far from production-ready.</p>
<p dir="auto">It currently comes with a number of caveats:</p>
<ol dir="auto">
<li>GC is not implemented. (For a fair benchmark comparison with other Lua implementations, we turned off GC for their implementations as well.)</li>
<li>It currently can only run on x86-64 Linux. I need to focus on the functionality implementations first before thinking about portability to other architecture/OS.</li>
<li>Some standard library functions, most notably the package library (<code>require</code> and <code>module</code>), are not implemented.</li>
</ol>
<h3 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h3>
<p dir="auto"><a href="https://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">Apache 2.0</a>.</p>
<section data-footnotes="">
<ol dir="auto">
<li id="user-content-fn-1-6759b322ba8387986b111985dd48d788">
<p dir="auto">The benchmarks are run on my laptop with Intel i7-12700H CPU and 32GB DDR4 memory. All benchmarks are repeated 5 times. Reported numbers are the geometric average over all benchmarks. <a href="#user-content-fnref-1-6759b322ba8387986b111985dd48d788" data-footnote-backref="" aria-label="Back to content"><g-emoji alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">â†©</g-emoji></a></p>
</li>
</ol>
</section>
</article>
          </div></div>
  </body>
</html>
