<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tech.michaelaltfield.net/2026/02/03/single-site-browser-firejail-proxychains/">Original</a>
    <h1>Persistent, Sandboxed, Single-Site Browser (firejail and proxychains)</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>This guide will describe how to setup a persistent browser (for <a href="https://mrrobot.fandom.com/wiki/E-Corp">Evil Corp</a>) that’s isolated in a sandbox (with firejail) and forced to use a SOCKS5 proxy to retain a static IP address (using proxychains)</p>
<p><a href="https://www.simonberens.com/single-site-browser-firejail-proxychains"><img loading="lazy" decoding="async" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_featuredImage1.jpg.pagespeed.ic.HVbLylMkJi.jpg" alt="Persistent, Sandboxed, Single-Site, Browser" width="1200" height="628" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_featuredImage1.jpg.pagespeed.ic.HVbLylMkJi.jpg 1200w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_featuredImage1-300x157.jpg.pagespeed.ic.OB9EDOr2nI.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_featuredImage1-1024x536.jpg.pagespeed.ic.oY7d354D5K.jpg 1024w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_featuredImage1-768x402.jpg.pagespeed.ic.Rr3pvqlCF5.jpg 768w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_featuredImage1-150x79.jpg.pagespeed.ic.noZ2z4gVak.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_featuredImage1-400x209.jpg.pagespeed.ic.OalXLI8Kpa.jpg 400w" sizes="auto, (max-width: 1200px) 100vw, 1200px"/></a></p>
<p>Have you ever been <strong>locked out of your own account</strong>, and then got an email for your service provider annoyingly letting you know that they’ve <strong>“blocked a login attempt — <em>for your protection?</em>“</strong></p>
<p>There’s countless reports of frustrated users who have <strong>permanently lost access to their own gmail accounts</strong> because of Google’s faulty “fraud protection” systems that locked the account owner out of their own account, <strong>due to false-positives</strong>.</p>

<p>Especially the past 10 years, large corporations have been using machine learning anomaly detection systems on their login pages. Unfortunately, sometimes this is (ab)used to have priority over credential authentication challenges.</p>
<blockquote><p>
Even if you enter your username, password, and 2FA credentials correctly on the very first login attempt, you may get locked out of your own account because you “look different”
</p></blockquote>
<p><strong>Even if you enter your username, password, and 2FA credentials correctly on the very first login attempt</strong>, you may get locked out of your own account because you “look different”.</p>
<p>These systems wouldn’t be so terrible if:</p>
<ol>
<li>The anomaly detection was account-specific, and</li>
<li>A user could disable anomaly detection (because it <a href="https://en.wikipedia.org/wiki/Information_security#Availability">causes more harm</a> than good)</li>
</ol>
<p>The biggest issue with machine-learning anonmoly-detection systems is that they’re frequently not trained on a specific user’s account.</p>
<div id="attachment_4354"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_tor-blocked1.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4354" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_tor-blocked1-225x300.jpg.pagespeed.ic.QxlTs4KQjk.jpg" alt="What do you mean Tor Browser is Blocked?" width="225" height="300" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_tor-blocked1-225x300.jpg.pagespeed.ic.QxlTs4KQjk.jpg 225w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_tor-blocked1-112x150.jpg.pagespeed.ic.hN_ObhQ7k9.jpg 112w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_tor-blocked1-400x534.jpg.pagespeed.ic.g0Vw3xuIrj.jpg 400w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_tor-blocked1.jpg.pagespeed.ic.SAUfTrQPzb.jpg 500w" sizes="auto, (max-width: 225px) 100vw, 225px"/></a></p><p id="caption-attachment-4354">I say: <a href="https://tails.net/">TAILS</a> is the most secure OS we have today</p></div>
<p>If, for example, I signed-up for my account using an IP address that’s a known Tor Exit node, then <strong>it is not an anomaly for my account to see a login attempt coming from a Tor Exit node</strong>.</p>
<p>And if <em>every</em> time I login to my Google account, it’s from a new IP address that has never been used before to login to my account, then <strong>it is not an anomaly for my account to see a login attempt from a new IP address</strong>. Or, say, if it’s very common for me to login from a different country almost every time I login, then <strong>it is not an anomaly to see a login attempt originating from a new geoip region</strong>.</p>
<p>And if <em>every</em> time I login, you fingerprint my browser and discover that, huh, you can’t actually associate my fingerprint with any prior history (even across the <a href="https://en.wikipedia.org/wiki/Panopticon">panoptic</a> dataset that you collect from almost all of the internet), then <strong>it is not an anomaly to see a login attempt originating from a new session whoose fingerprint you have 0 historical data-on</strong></p>
<p>As a freelance sysadmin, I frequently have clients who need me to login to their E-Corp service providers.</p>
<p>As a security- and privacy-conscious freelance sysadmin, <strong>I’m frequently locked out</strong> of these Google, Facebook, and Bank accounts — <strong>even when I enter the correct authentication credentials on the first try</strong>.</p>
<div id="attachment_4391"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_google-login-fail1.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4391" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-login-fail1.jpg.pagespeed.ic.FHNlGZDLWr.jpg" alt="Screenshot of a browser showing a failed google signin attempt, with the message &#34;Couldn&#39;t sign you in / Contact your domain admin for help.&#34;" width="648" height="639" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-login-fail1.jpg.pagespeed.ic.FHNlGZDLWr.jpg 648w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-login-fail1-300x296.jpg.pagespeed.ic.LHvGRPk0DH.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-login-fail1-150x148.jpg.pagespeed.ic.IUEfl1bQZR.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-login-fail1-400x394.jpg.pagespeed.ic.OLYrV0ua6m.jpg 400w" sizes="auto, (max-width: 648px) 100vw, 648px"/></a></p><p id="caption-attachment-4391">God damn it Google, I <em>am</em> the domain admin, and <em>you</em> locked me out (even though <strong>I entered the correct username and password</strong> on the first attempt!)</p></div>

<p>Since most of these service providers don’t let you simply turn-off their terribly faulty anomaly detection systems (that, in fact, <strong>cause more harm than good for users with strong passphrases and TOTP 2FA</strong> enabled), I’ve had to create a tool to minimize myself getting locked-out of my own accounts: Persistent, Sandboxed, Single-Site Browsers using firejail and proxychains.</p>
<p>It’s absurd that we have to do all of this just to prevent Google from stealing our gmail accounts and Meta from stealing our facebook accounts, but this is where we are in 2026: the age of AI-driven, false-positive, idiocracy-level distopia.</p>
<figure>
<figcaption>
Can’t see video above? Watch it on <a href="https://peertube.linuxrocks.online/w/iGvrM6NqrjpcnMRJjma5zu">PeerTube</a> or <a href="https://www.youtube.com/results?search_query=idiocracy+not+sure+scene+tattoo">YouTube</a><br/>
</figcaption></figure>

<p>If you’re a smart and privacy-conscious Internet user, hopefully you don’t use a persistent web browser. To protect yourself from persistent infections and fingerprint tracking, it’s best to <a href="https://tech.michaelaltfield.net/2019/03/03/ephemeral-firefox-in-ubuntu-01/">use an ephemeral browser</a> for your daily internet browsing.</p>
<p>It’s also a good idea to install some <a href="https://tech.michaelaltfield.net/2019/03/06/ephemeral-firefox-in-ubuntu-02/">privacy-focused extensions</a>, such as uBlock Origin (to block tracking scripts), Cookie AutoDelete (to wipe cookies as soon as you close a tab), Chameleon (to change your fingerprint every 30 seconds), etc.</p>
<p>And, finally, you should be completely blocking all requests to any multinational corporations that have a track record of installing tracking scripts or malware on a wide network of third-party domains. For domains owned by Google and Meta, it’s best to block all traffic to them in your daily-use ephemeral browser, and use a dedicated <a href="https://tech.michaelaltfield.net/2019/03/26/ephemeral-firefox-as-a-site-specific-browser-03/">single-site ephemeral browser</a> for such websites.</p>
<p>In many ways, the solution presented in this guide does the opposite of ^ these best-practices. You’ll still be using a single-site browser (eg blocked from accessing anything but Google’s services), but it will be persistent (not ephemeral) and vanilla (with no privacy- or security-extensions installed).</p>
<blockquote><p>
⚠ NOTE: This article is about harm reduction.</p>
<p>It is hazardous to your online privacy to use Google or Facebook accounts. It is a risk to your operational security to use a persistent browser. However, sometimes we cannot avoid using such services.</p>
<p>If you’re going to proceed with using a Google or a Facebook account, then following the steps outlined in this guide may reduce your risk of having much of your Internet browsing activities collected and sold by these companies — while also reducing the risk that you’ll get DOSed by those service providers’ faulty “fraud protection” systems.
</p></blockquote>
<p>It should go without saying that (without such protections in-place), this means that these services would likely be able to track much of your activity across many websites that you visit in this browser — but this risk is mitigated by making it a <a href="https://en.wikipedia.org/wiki/Site-specific_browser">single-site browser</a>.</p>
<p>The key to why this solution <em>should</em> prevent us from getting locked-out of our own accounts is the persistence. In this persistent browser, the service provider (eg Google) <em>should</em> be able to track your activity from login-to-login. <strong>They <em>should</em> see the cookies they installed</strong> in your browser at your last login. And, because we’re going to pass all of the traffic through a SOCKS5 proxy with a static IP address, <strong>they <em>should</em> see that the IP address you’re using is the same</strong> from login-to-login — even if you’re using a VPN.</p>
<h2>Assumptions</h2>
<p>This article assumes that you have ssh access to a server with a static IP address somewhere in the world.</p>
<h3>Software Versions</h3>
<p>This guide was published in 2026, and it uses the following software and versions:</p>
<ol>
<li>Debian 12 (bookworm)</li>
<li>Firejail v0.9.72</li>
<li>Proxychains v3.1</li>
</ol>
<p>If you’re using a different OS, firejail, or proxychains versions, then adaptations to the below commands &amp; files may be necessary.</p>
<h2>SOCKS proxy</h2>
<p>We use ssh to bind a secure tunnel to a server on a <a href="https://en.wikipedia.org/wiki/SOCKS">SOCKS proxy</a> at <code>127.0.0.1:9350</code>. Applications that are configured to use a SOCKS5 proxy at <code>127.0.0.1:9350</code> will pass their connections through the ssh tunnel, such that the destination of the connection appears to originate from the ssh static server’s IP address (as opposed to your ISP’s dynamic IP address).</p>
<p>This will ensure that, even if you’re a digital nomad that changes your physical location every month, the E-corp service that you’re trying to log-into will see that your connection is originating from the same location every time.</p>
<p>We can create the SOCKS proxy on <code>127.0.0.1:9350</code> using the following SSH command.</p>
<pre title="">ssh -ND 127.0.0.1:9350 example.com
</pre>
<p>Obviously, you’ll need to replace ‘<code>example.com</code>‘ with your server’s hostname or IP address.</p>
<h2>Firejail</h2>
<p>We use <a href="https://firejail.wordpress.com/">firejail</a> to jail the Single-Site Browser in a security sandbox at the kernel-level. This, for example, prevents this instance of Firefox from being able to access most of the user’s disk.</p>
<h2>Proxychains</h2>
<p>We use <a href="https://www.simonberens.com/p/TODO">proxychains</a> to force all of the traffic of our sandboxed (firejail-ed) firefox browser through our SOCKS proxy.</p>
<p>This is better than setting the proxy in the browser’s “Network Settings” — as it <em>forces</em> the browser to go through the proxy — eliminating the risk of browser misconfiguration leading to us bypassing the proxy (and therefore risking us getting locked out of our E-Corp accounts).</p>
<h2>The Script</h2>
<p>Before creating the script to launch our SSB, we need to create the SOCKS5 proxy by connecting to our ssh server.</p>
<pre title=""># create a SOCKS5 proxy to your ssh server; leave this open in the background
ssh -p &lt;ssh_server_port&gt; -ND 127.0.0.1:9350 &lt;ssh_server_user&gt;@&lt;ssh_server_host&gt;
</pre>
<p>For example</p>
<pre title="">user@disp1913:~$ ssh -p 22 -ND 127.0.0.1:9350 user1@example.com

</pre>
<p>As the example above shows, if everything goes OK then there should be no output. Just leave that running in a terminal in the background. If it closes, your SOCKS5 proxy will also close (and the proxychain-ed SSB won’t have internet access).</p>
<p>Now that we have an open ssh connection for our SOCKS5 proxy on ‘<code>localhost:9350</code>‘, let’s create a script that we’ll execute to launch our SSB. Before copying-and-pasting this into your terminal, you should change the first 4 variables. In our example, we’re creating an ssb for “Google” and using ‘example.com’ for the hostname of our SOCKS5 server. If you connect to your SOCKS5 server (over ssh) on a non-standard port, you should also change ‘<code>SOCKS_PORT</code>‘.</p>
<p>After editing the first 4 variables, <strong>copy and paste the following snippet into your terminal</strong>.</p>
<pre title="">############
# SETTINGS #
############

# define the new Site Specific Browser (SSB) name and 
SSB_NAME=google
SSB_URL=&#39;https://google.com&#39;
SOCKS_HOST=&#39;example.com&#39;
SOCKS_PORT=&#39;22&#39;

mkdir ~/.mozilla/firefox/${SSB_NAME}

# create the script to launch our SSB
cat &lt;&lt; EOF &gt; ~/.mozilla/firefox/${SSB_NAME}/${SSB_NAME}.sh
#!/bin/bash
################################################################################
# Author:  Michael Altfield &lt;michael@michaelaltfield.net&gt;
# Created: 2025-10-12
# Updated: 2025-10-12
# Version: 0.1
# Purpose: Start an Stateful Firefox that&#39;s Site-Specific
#    * https://tech.michaelaltfield.net/single-site-browser-firejail-proxychains
################################################################################
 
############
# SETTINGS #
############

SSB_NAME=&#34;${SSB_NAME}&#34;
SSB_URL=&#34;${SSB_URL}&#34;
PROFILE_PATH=&#34;\${HOME}/.mozilla/firefox/\${SSB_NAME}&#34;
SOCKS_HOST=&#34;${SOCKS_HOST}&#34;
SOCKS_PORT=&#34;${SOCKS_PORT}&#34;

#########################
# START SSH SOCKS PROXY #
#########################

if [[ ! \$(ps -ef | grep -i ssh | grep 9350) ]]; then
	ssh -p \${SOCKS_PORT} -ND 127.0.0.1:9350 \${SOCKS_HOST} &amp;
fi
 
##############################
# START SSB-SPECIFIC FIREFOX #
##############################
 
firejail --profile=firefox --whitelist=&#34;\${PROFILE_PATH}&#34; proxychains firefox -no-remote -new-instance -profile &#34;\${PROFILE_PATH}&#34; &#34;\${SSB_URL}&#34;
 
# clean exit
exit 0
EOF
chmod +x ~/.mozilla/firefox/${SSB_NAME}/${SSB_NAME}.sh

# create proxychains config file
cat &gt; ~/.mozilla/firefox/${SSB_NAME}/proxychains.conf &lt;&lt;&#39;EOF&#39;
strict_chain
#proxy_dns

[ProxyList]
socks5 127.0.0.1 9350
EOF
</pre>
<p>Now you can open the firejail-restricted and proxychain-ed SSB with the following commands</p>
<pre title="">cd ~/.mozilla/firefox/${SSB_NAME}
./${SSB_NAME}.sh
</pre>
<p>For example</p>
<pre title="">user@disp1913:~/.mozilla/firefox/google$ ./google.sh 
Reading profile /etc/firejail/firefox.profile
Reading profile /etc/firejail/whitelist-usr-share-common.inc
Reading profile /etc/firejail/firefox-common.profile
Reading profile /etc/firejail/disable-common.inc
Reading profile /etc/firejail/disable-devel.inc
Reading profile /etc/firejail/disable-exec.inc
Reading profile /etc/firejail/disable-interpreters.inc
Reading profile /etc/firejail/disable-proc.inc
Reading profile /etc/firejail/disable-programs.inc
Reading profile /etc/firejail/whitelist-common.inc
Reading profile /etc/firejail/whitelist-run-common.inc
Reading profile /etc/firejail/whitelist-runuser-common.inc
Reading profile /etc/firejail/whitelist-var-common.inc
Warning: networking feature is disabled in Firejail configuration file
Seccomp list in: !chroot, check list: @default-keep, prelist: unknown,
Parent pid 9522, child pid 9525
Warning: An abstract unix socket for session D-BUS might still be available. Use --net or remove unix from --protocol set.
Warning: cleaning all supplementary groups
Warning: cleaning all supplementary groups
Seccomp list in: !chroot, check list: @default-keep, prelist: unknown,
Warning: cleaning all supplementary groups
Warning: Replacing profile instead of stacking it. It is a legacy behavior that can result in relaxation of the protection. It is here as a temporary measure to unbreak the software that has been broken by switching to the stacking behavior.
Child process initialized in 110.35 ms
ProxyChains-3.1 (http://proxychains.sf.net)
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.160.144.191:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.160.144.191:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.107.221.82:80-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-199.232.17.91:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.160.144.191:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.36.137.203:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-173.194.69.147:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-199.232.17.91:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.107.243.93:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.120.208.123:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-34.107.221.82:80-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-142.251.31.94:80-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-142.251.31.94:80-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-142.251.31.94:80-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-199.232.17.91:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-199.232.17.91:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-199.232.17.91:443-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-142.251.31.94:80-&lt;&gt;&lt;&gt;-OK
|S-chain|-&lt;&gt;-127.0.0.1:9350-&lt;&gt;&lt;&gt;-2.17.190.73:80-&lt;&gt;&lt;&gt;-OK
</pre>
<p>After executing the above script, a new sandboxed, single-site browser profile will open.</p>
<div id="attachment_4349"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_google1.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4349" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google1.jpg.pagespeed.ic.LXySqZm5xg.jpg" alt="Screenshot of firefox browser showing Google website" width="1032" height="796" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google1.jpg.pagespeed.ic.LXySqZm5xg.jpg 1032w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google1-300x231.jpg.pagespeed.ic.6kKJmzgFjZ.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google1-1024x790.jpg.pagespeed.ic.sqZME4PD4d.jpg 1024w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google1-768x592.jpg.pagespeed.ic._UDDEdektv.jpg 768w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google1-150x116.jpg.pagespeed.ic.ObyuBfD9mh.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google1-400x309.jpg.pagespeed.ic.iX-tPJIWSW.jpg 400w" sizes="auto, (max-width: 1032px) 100vw, 1032px"/></a></p><p id="caption-attachment-4349">Executing the script opens a sandboxed browser profile</p></div>
<h2>The Config</h2>
<p>At this point you have a script to launch a firejail-ed and proxychain-ed firefox profile, but it is <em>not</em> a Single-Site Browser.</p>
<p>There’s a number of ways to restrict a firefox profile from being able to access all-but-one website. Probably <a href="https://tech.michaelaltfield.net/2019/03/26/ephemeral-firefox-as-a-site-specific-browser-03/#netfilter">the best way is to configure <code>firejail</code> with specific netfilter rules</a>, but that’s cumbersome and rots over time.</p>
<p>I’ve also used a number of proxy-related browser plugins, but those have also come-and-gone over the years, leaving me with a useless SSB more frequently than I’d like to roll-up my selves and fix its config.</p>
<p>In fact, the most durable <em>and</em> easy way to configure firefox as a SSB is to just set it to use a bullshit, non-existant proxy for all sites — and then just define a set of exceptions for the sites you <em>actually</em> want it to be able to reach.</p>
<p>First, open firefox settings. Then scroll down on the “General” tab, and click the “Settings” button under “Network Settings”</p>

		
		

<p id="proxy">Now, do the following</p>
<p>1. Change “No proxy” to “<code>Manual proxy configuration</code>”</p>
<div id="attachment_4353"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_network-settings3.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4353" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_network-settings3.jpg.pagespeed.ic.oWEBOHSkRc.jpg" alt="Screenshot of firefox browser showing the &#34;Connection Settings&#34; modal, and &#34;Manual proxy configuration&#34;, &#34;HTTP Proxy = 127.6.4.3&#34;, &#34;Port = 1337&#34;, &#34;Also use this proxy for HTTPS&#34;, and &#34;No proxy for ...&#34; fields highlighted" width="1032" height="796" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_network-settings3.jpg.pagespeed.ic.oWEBOHSkRc.jpg 1032w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_network-settings3-300x231.jpg.pagespeed.ic.FDjOGK959_.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_network-settings3-1024x790.jpg.pagespeed.ic.NkSYFMVjcp.jpg 1024w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_network-settings3-768x592.jpg.pagespeed.ic.TJ2gnZqOjT.jpg 768w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_network-settings3-150x116.jpg.pagespeed.ic.g7aNIBYLZS.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_network-settings3-400x309.jpg.pagespeed.ic.HnEpbXszqw.jpg 400w" sizes="auto, (max-width: 1032px) 100vw, 1032px"/></a></p><p id="caption-attachment-4353">Choose a bullshit manual proxy, and add exceptions for all the domains that we *do want* the browser to be able to reach</p></div>
<p>You should now be able to access gmail.</p>
<div id="attachment_4348"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_gmail1.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4348" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_gmail1.jpg.pagespeed.ic.QByGoPliPV.jpg" alt="Screenshot of firefox browser showing Gmail website" width="1032" height="796" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_gmail1.jpg.pagespeed.ic.QByGoPliPV.jpg 1032w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_gmail1-300x231.jpg.pagespeed.ic.LAyYT5rKmd.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_gmail1-1024x790.jpg.pagespeed.ic.9cqqS9IGwl.jpg 1024w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_gmail1-768x592.jpg.pagespeed.ic.dcNgJ7JEwu.jpg 768w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_gmail1-150x116.jpg.pagespeed.ic.0J0ZQxnd3K.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_gmail1-400x309.jpg.pagespeed.ic.eWys6GX2pb.jpg 400w" sizes="auto, (max-width: 1032px) 100vw, 1032px"/></a></p><p id="caption-attachment-4348">Our Network Settings proxy is configured to fail on non-google domains</p></div>
<p>But, as desired, your browser will fail to be able to load content from any non-google website (<a href="#proxy">whitelisted</a> above).</p>
<div id="attachment_4347"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_facebook-blocked1.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4347" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_facebook-blocked1.jpg.pagespeed.ic.8n9T8o3Zig.jpg" alt="Screenshot shows a firefox window trying to load &#34;www.facebook.com&#34; with error: The proxy server is refusing connections" width="1032" height="796" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_facebook-blocked1.jpg.pagespeed.ic.8n9T8o3Zig.jpg 1032w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_facebook-blocked1-300x231.jpg.pagespeed.ic.JohhUvZM7z.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_facebook-blocked1-1024x790.jpg.pagespeed.ic.QlSeXm4l0-.jpg 1024w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_facebook-blocked1-768x592.jpg.pagespeed.ic.DvoNYXl34Z.jpg 768w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_facebook-blocked1-150x116.jpg.pagespeed.ic.GOjWYVxKFA.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_facebook-blocked1-400x309.jpg.pagespeed.ic.W1gDyKrLqS.jpg 400w" sizes="auto, (max-width: 1032px) 100vw, 1032px"/></a></p><p id="caption-attachment-4347">Our Network Settings proxy is configured to fail on non-google domains</p></div>
<h2>Desktop Shortcut</h2>
<p>Finally, we create an <a href="https://wiki.archlinux.org/index.php/desktop_entries">xdg desktop entry</a> and create a symlink to it for a shortcut on the desktop.</p>
<pre title="">user@host:~$ export SSB_NAME=&#34;google&#34;
user@host:~$ export PROFILE_PATH=&#34;${HOME}/.mozilla/firefox/${SSB_NAME}&#34;
user@host:~$ [ ! -d $HOME/.local/share/ ] &amp;&amp; mkdir $HOME/.local/share/
user@host:~$ cat &lt;&lt; EOF &gt; $HOME/.local/share/${SSB_NAME}-ssb.desktop
[Desktop Entry]
Type=Application
Name=Ephemeral Firefox
Icon=firefox
Path=${PROFILE_PATH}
Exec=./${SSB_NAME}.sh
EOF
user@host:~$ ln -s $HOME/.local/share/${SSB_NAME}-ssb.desktop $HOME/Desktop/
user@host:~$ chmod +x $HOME/Desktop/${SSB_NAME}-ssb.desktop
user@host:~$ 
</pre>
<p>Now you can just double-click the icon on your desktop to start your new persistent SSB.</p>

<p>If you ever have an issue loading a site, you can troubleshoot new domains to add to the proxy whitelist by using the ‘<code>Network</code>‘ tab of the browser debugger.</p>
<div id="attachment_4350"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_google-anal1.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4350" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-anal1.jpg.pagespeed.ic.vjDu1Iyrli.jpg" alt="Screenshot of firefox browser showing the debugger open on the &#34;network&#34; tab, with a single row highlighted showing an error on &#39;ssl.google-anal...&#39; NS_ERROR_PROX..." width="1032" height="796" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-anal1.jpg.pagespeed.ic.vjDu1Iyrli.jpg 1032w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-anal1-300x231.jpg.pagespeed.ic.DyhgAp263Z.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-anal1-1024x790.jpg.pagespeed.ic.-JKpFdII1Y.jpg 1024w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-anal1-768x592.jpg.pagespeed.ic.5eV0zAPHXQ.jpg 768w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-anal1-150x116.jpg.pagespeed.ic.Bu4bE6da4E.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-anal1-400x309.jpg.pagespeed.ic.cab3HG1KCD.jpg 400w" sizes="auto, (max-width: 1032px) 100vw, 1032px"/></a></p><p id="caption-attachment-4350">Remember to always block google-anal…</p></div>
<p>The above screenshot shows that the browser failed to connect to ‘<code>ssl.google-analytics.com</code>‘ due to ‘<code>NS_ERROR_PROXY_CONNECTION_REFUSED</code>‘. If you actually <em>want</em> to connect to that domain, you can <a href="#proxy">add it to the whitelist</a></p>

<h2>DNS</h2>
<p>The script presented in this article has DNS leaks, so Evil Corp’s broken anomaly detection <em>might</em> still flag your login, if they did a fingerprint check that looks at your SSB’s DNS config (unlikely).</p>
<p>They’re still going to see the IP address of your SSH server. So, for the purposes of this article, it should be good-enough.</p>
<p>But <code>proxychains</code> <em>does</em> have a ‘<code>proxy_dns</code>‘ option. We just disabled it due to errors</p>
<pre title="">/usr/lib/proxychains3/proxyresolv: 16: dig: Permission denied
</pre>
<p>If you know how to update the ‘<code>proxychains</code>‘ config to force all dns queries through the SOCKS5 proxy without causing the error above, please comment on this article with how.</p>

<blockquote><p>
“Can’t login due to false-positives? Fuck you; wontfix”</p>
<p> -Google
</p></blockquote>
<div id="attachment_4375"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_google-help-fail1.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4375" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail1.jpg.pagespeed.ic.ynooq48AiL.jpg" alt="Screenshot of a web page displaying a knowledgebase article from &#34;Google Workspace Admin Help&#34; with a Question highlighted &#34;When does Google consider a sign-in attempt suspicious?&#34; And the answer is highlighted: &#34;...sign in from an unusual location...&#34;" width="691" height="675" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail1.jpg.pagespeed.ic.ynooq48AiL.jpg 691w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail1-300x293.jpg.pagespeed.ic.sVNGWfg53k.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail1-150x147.jpg.pagespeed.ic.0lm278IB5s.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail1-400x391.jpg.pagespeed.ic.0NuV0CnNza.jpg 400w" sizes="auto, (max-width: 691px) 100vw, 691px"/></a></p><p id="caption-attachment-4375">Google admits that they’ll lock you out of your own account if you sign in from a new location</p></div><div id="attachment_4376"><p><a href="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/single-site-browser-firejail-proxychains_google-help-fail2.jpg"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-4376" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail2.jpg.pagespeed.ic.APALLe8sHL.jpg" alt="Screenshot of a web page displaying a knowledgebase article from &#34;Google Workspace&#34; with the following text highlighted &#34;Problem / How can you turn off the login challenge permanently? ... Solution / ...Login challenges cannot be disabled permanently.&#34;" width="691" height="480" srcset="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail2.jpg.pagespeed.ic.APALLe8sHL.jpg 691w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail2-300x208.jpg.pagespeed.ic.AoGI2HMDNZ.jpg 300w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail2-150x104.jpg.pagespeed.ic.yLhmdSENjO.jpg 150w, https://tech.michaelaltfield.net/wp-content/uploads/sites/5/xsingle-site-browser-firejail-proxychains_google-help-fail2-400x278.jpg.pagespeed.ic.DI13maUwqC.jpg 400w" sizes="auto, (max-width: 691px) 100vw, 691px"/></a></p><p id="caption-attachment-4376">Google says “fuck you; won’t fix” to requests to disable their “login challenge” — even though it’s obviously broken (false-positives)</p></div>
<h2>What Google Says</h2>
<ol>
<li>Google admits that they’ll lock you out of your own account when their “risk-analysis system” sees you trying to login <a href="https://web.archive.org/web/20241217194937/https://support.google.com/a/answer/6002699#zippy=%2Cwhen-does-google-consider-a-sign-in-attempt-suspicious">from an unusual location</a></li>
<li>Google says that these broken <a href="https://web.archive.org/web/20230704212335/https://knowledge.workspace.google.com/kb/how-to-disable-login-challenge-security-method-permanently-000007696">Login challenges <em>cannot</em> be disabled permanently</a>
</li></ol>
<p>Translation: “Our risk-analysis system is broken. We know it. You know it. Fuck you; wontfix”</p>
<h2>Why are these Tech companies so dumb?</h2>
<p>For a long time, I couldn’t wrap my head around these companies’ positions. These are some of the most powerful companies in the world. They probably have a legitimately excellent team of security engineers on-staff, yet they’re employing such terrible systems that are so rife with false-positives, that they <em>must</em> know that they’re effectively issuing a DOS attack on probably thousands or tens of thousands of their uses. Right??</p>
<p><strong>What’s wrong with them?</strong></p>
<p>Unfortunately, these companies are usually very tight-lipped about such systems, and they appear to intentionally go out of their way to not answer user’s questions as to why they don’t fix this — or at least allow users to disable these faulty “protections” on a per-account basis so that their users are able to opt-into actual protections, which reduce their risk of being locked-out of their own accounts. However, if we think about the most popular services that Google provides, their history, and a segment of their user-base, we get a better idea.</p>
<p>The most elucidating comment I’ve read was written by user <code>Blindspots</code> on <a href="https://webapps.stackexchange.com/a/177034/267540">this stack exchange answer</a>:</p>
<blockquote><p>
It’s uncommon for companies like Google to share much about their abuse prevention systems or provide simple workarounds, such as allowing users to permanently secure accounts by username &amp; password alone. For Google, <strong>the risks posed by security compromises go far beyond the immediate impact felt by owners of compromised accounts.</strong>
</p></blockquote>
<p>If we read between the lines, then the full picture comes into focus:</p>
<p>One of the most commonly-used Google services is Gmail. Personally, I think almost everyone I know has a Gmail account (or did have, at least at one time). And when we think about the most notoriously difficult-to-manage problems on the Internet, managing email servers and preventing spam is definitely in the top-ten.</p>
<p>Try to remember all the times that someone gave you an <code>@gmail.com</code> address. Now, <strong>try to think of the most computer-illiterate person who gave you their <code>@gmail.com</code> account</strong>. If you could order the whole Gmail userbase by computer literacy, try to imagine the lowest 1%. Think grandmas, cops, and Trump supporters. Do you think their passwords are good? Do you think they maybe reused those passwords on another site that might store their email address and account password in plaintext, and then get hacked?</p>
<p>Most likely, Google’s been battle-worn from having to deal with their dumbest users getting their accounts hacked (and the attacker then using your grandma’s Gmail account to send spam — or worse) so much so that they’ve just given up on humanity and made a decision that <strong>it’s better to effectively issue a DOS attack on your smart users in exchange for not having to deal with your dumb users getting their accounts taken-over in droves</strong>.</p>
<p>Is that a valid excuse? Probably not. If Google buried a hard-to-get-to setting somewhere that let users with a &gt;50-character password disable this notoriously broken “protection,” I highly doubt you’d have many of those dumber users figuring out how to setup their accounts to opt-out of their their horrendously broken “risk-analysis system”</p>
<p>Or, for now, just setup a Persistent, Sandboxed, Single-Site Browser for all your <a href="https://mrrobot.fandom.com/wiki/E-Corp">Evil-Corp</a> needs.</p>
<h2>Links</h2>
<ol>
<li><a href="https://tech.michaelaltfield.net/2019/03/03/ephemeral-firefox-in-ubuntu-01/">Ephemeral Firefox in Ubuntu (1/3)</a></li>
<li><a href="https://tech.michaelaltfield.net/2019/03/06/ephemeral-firefox-in-ubuntu-02/">Ephemeral Firefox with Extensions (2/3)</a></li>
<li><a href="https://tech.michaelaltfield.net/2019/03/26/ephemeral-firefox-as-a-site-specific-browser-03/">Ephemeral Firefox as a Site-Specific Browser (3/3)</a></li>
<li><a href="https://firejail.wordpress.com/documentation/">Firejail Documentation</a></li>
<li><a href="https://github.com/haad/proxychains">Proxychains Repo</a></li>
<li><a href="https://en.wikipedia.org/wiki/Site-specific_browser#Applications">https://en.wikipedia.org/wiki/Site-specific_browser#Applications</a></li>
<li><a href="https://www.ghacks.net/2012/02/15/how-to-turn-chrome-or-firefox-into-a-single-site-browser/">How To Turn Chrome or Firefox Into A Single-Site Browser</a> Ghacks, 2012</li>
</ol>
<div itemtype="http://schema.org/Person" itemscope="" itemprop="author"><div><p><img loading="lazy" decoding="async" src="https://tech.michaelaltfield.net/wp-content/uploads/sites/5/2019/04/100x100xavatar_square_150.jpg.pagespeed.ic.lvLST4AWRQ.jpg" width="100" height="100" alt="headshot of Michael Altfield" itemprop="image"/></p><div><div itemprop="description"><p>Hi, I’m Michael Altfield. I write articles about opsec, privacy, and devops <a href="https://michaelaltfield.net/biography/">➡</a></p>
<p><a href="https://michaelaltfield.net/biography/">About Michael</a></p>
</div></div></div></div></div></div>
  </body>
</html>
