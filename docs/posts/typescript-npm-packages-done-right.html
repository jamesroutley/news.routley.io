<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.liblab.com/typescript-npm-packages-done-right/">Original</a>
    <h1>TypeScript NPM Packages Done Right</h1>
    
    <div id="readability-page-1" class="page"><div id="__blog-post-container" itemprop="articleBody"><p>Publishing packages to NPM is not a particularly difficult challenge by itself. However, configuring your TypeScript project for success might be. Will your package work on most projects? Will the users have type-hinting and autocompletion? Will it work with ES Modules (ESM) and CommonJS (CJS) style imports?</p><p>After reading this post, you will understand how to make your TypeScript package more accessible and usable in any (or most) JavaScript and TypeScript projects, including browser support!</p><h2 id="creating-a-typescript-project">Creating a TypeScript Project<a href="#creating-a-typescript-project" aria-label="Direct link to Creating a TypeScript Project" title="Direct link to Creating a TypeScript Project">​</a></h2><p>Chances are that if you are reading this, you already have a TypeScript project set up. If you do, you might want to skip to the next steps or stay around to check for discrepancies.</p><p>Let&#39;s start by creating our base Node.js project and adding TypeScript as a development dependency:</p><div><div><pre tabindex="0"><code><span><span>npm</span><span> init -y</span><br/></span><span><span></span><span>npm</span><span> </span><span>install</span><span> typescript --save-dev</span><br/></span></code></pre></div></div><p>You likely want to structure your code inside a <strong><code>src</code></strong> folder. So let&#39;s create your package&#39;s entry point inside of it:</p><div><div><pre tabindex="0"><code><span><span>mkdir</span><span> src</span><br/></span><span><span></span><span>touch</span><span> src/index.ts</span><br/></span></code></pre></div></div><p>Now, Node.js and browsers don&#39;t understand TypeScript, so we need to set up <strong><code>tsc</code></strong> (TypeScript compiler) to compile our TypeScript code to JavaScript. Let&#39;s add a <strong><code>tsconfig.json</code></strong> file to our project by running:</p><p>If we run <strong><code>npx tsc</code></strong> now, it will scan our folder and create <strong><code>.js</code></strong> files in the same directories as our <strong><code>.ts</code></strong> files (which is not desirable). Let&#39;s add better configuration before we run that and make a mess.</p><p>Add the following lines to <strong><code>tsconfig.json</code></strong>:</p><div><div><pre tabindex="0"><code><span><span>{</span><span></span><br/></span><span><span>    </span><span>&#34;compilerOptions&#34;</span><span>:</span><span> </span><span>{</span><span></span><br/></span><span><span>        </span><span></span><br/></span><span><span>        </span><span>&#34;rootDir&#34;</span><span>:</span><span> </span><span>&#34;./src&#34;</span><span>,</span><span> </span><span></span><br/></span><span><span>        </span><span>&#34;outDir&#34;</span><span>:</span><span> </span><span>&#34;./dist&#34;</span><span>,</span><span> </span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>Let&#39;s also add a &#34;build&#34; script to our <strong><code>package.json</code></strong>:</p><div><div><pre tabindex="0"><code><span><span>{</span><span></span><br/></span><span><span>    </span><span>&#34;scripts&#34;</span><span>:</span><span> </span><span>{</span><span></span><br/></span><span><span>        </span><span>&#34;build&#34;</span><span>:</span><span> </span><span>&#34;tsc&#34;</span><span></span><br/></span><span><span>    </span><span>}</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><p>If we run <strong><code>npm run build</code></strong> now, a new <strong><code>dist</code></strong> folder will appear with the compiled JavaScript. If you&#39;re using Git, make sure to add the <strong><code>dist</code></strong> folder to your <strong><code>.gitignore</code></strong>.</p><h2 id="setting-up-tsc-for-optimal-developer-experience">Setting up <code>tsc</code> for Optimal Developer Experience<a href="#setting-up-tsc-for-optimal-developer-experience" aria-label="Direct link to setting-up-tsc-for-optimal-developer-experience" title="Direct link to setting-up-tsc-for-optimal-developer-experience">​</a></h2><p>We can already compile our TypeScript to JavaScript. However, if you publish it to npm as is, you&#39;ll only be able to use it seamlessly in other JavaScript projects. Also, the default <strong><a href="https://www.typescriptlang.org/tsconfig#target" target="_blank" rel="noopener noreferrer">target</a></strong> configuration is &#34;es2016,&#34; and modern browsers only support up to &#34;es2015.&#34; So let&#39;s fix that!</p><p>First, let&#39;s change our <strong><a href="https://www.typescriptlang.org/tsconfig#target" target="_blank" rel="noopener noreferrer">target</a></strong> to <strong><code>es2015</code></strong> (or <strong><code>es6</code></strong> since they&#39;re the same).
<strong><a href="https://www.typescriptlang.org/tsconfig#esModuleInterop" target="_blank" rel="noopener noreferrer">esModuleInterop</a></strong> is <strong><code>true</code></strong> by default. Let&#39;s leave it as is since it increases compatibility by allowing ESM-style imports.</p><p>We are all using TypeScript for a reason: types! But if you build and ship your package right now, no types will be shipped with it. Let&#39;s fix that by setting <strong><a href="https://www.typescriptlang.org/tsconfig#declaration" target="_blank" rel="noopener noreferrer">declaration</a></strong> to <strong><code>true</code></strong>. This will generate declaration files (<strong><code>.d.ts</code></strong>) alongside our <strong><code>.js</code></strong> files. With that alone, your package will be usable in TypeScript projects from the get-go and provide type hints even in JavaScript projects.</p><p>The declaration files already go a long way in improving support and developer experience. However, we can go further by adding <strong><a href="https://www.typescriptlang.org/tsconfig#declarationMap" target="_blank" rel="noopener noreferrer">declarationMap</a></strong>. With that, sourcemaps (<strong><code>.d.ts.map</code></strong>) will be generated to map our declaration files (<strong><code>.d.ts</code></strong>) to our original TypeScript source code (<strong><code>.ts</code></strong>). This means that code editors can go to the original TypeScript code when using &#34;Go to definition,&#34; instead of the compiled JavaScript files.</p><p>While we&#39;re at it, <strong><a href="https://www.typescriptlang.org/tsconfig#sourceMap" target="_blank" rel="noopener noreferrer">sourceMap</a></strong> will add sourcemap files (<strong><code>.js.map</code></strong>) that allow debuggers and other tools to display the original TypeScript source code when actually working with the emitted JavaScript files.</p><blockquote><p><strong>Using declarationMap and/or sourceMap means we also need to publish our source code with the package to npm.</strong></p></blockquote><p>With all that, here is our final <strong><code>tsconfig.json</code></strong> file:</p><div><div><pre tabindex="0"><code><span><span>{</span><span></span><br/></span><span><span>    </span><span>&#34;compilerOptions&#34;</span><span>:</span><span> </span><span>{</span><span></span><br/></span><span><span>        </span><span>&#34;target&#34;</span><span>:</span><span> </span><span>&#34;es2015&#34;</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;module&#34;</span><span>:</span><span> </span><span>&#34;commonjs&#34;</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;strict&#34;</span><span>:</span><span> </span><span>true</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;esModuleInterop&#34;</span><span>:</span><span> </span><span>true</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;rootDir&#34;</span><span>:</span><span> </span><span>&#34;./src&#34;</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;outDir&#34;</span><span>:</span><span> </span><span>&#34;./dist&#34;</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;sourceMap&#34;</span><span>:</span><span> </span><span>true</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;declaration&#34;</span><span>:</span><span> </span><span>true</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;declarationMap&#34;</span><span>:</span><span> </span><span>true</span><span>,</span><span></span><br/></span><span><span>    </span><span>}</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><h2 id="packagejson">package.json<a href="#packagejson" aria-label="Direct link to package.json" title="Direct link to package.json">​</a></h2><p>Things are much simpler around here. We need to specify the entry point of our package when users import it. So let&#39;s set <strong><code>main</code></strong> to <strong><code>dist/index.js</code></strong>.</p><p>Other than the entry point, we also need to specify the main types declaration file. In this case, that would be <strong><code>dist/index.d.ts</code></strong>.</p><p>We also need to specify which files to ship with the package. Of course, we need to ship our built JavaScript files, but since we are using <strong><code>sourceMap</code></strong> and <strong><code>declarationMap</code></strong>, we also need to ship <strong><code>src</code></strong>.</p><p>Here&#39;s a reference <strong><code>package.json</code></strong> with all of that:</p><div><div><pre tabindex="0"><code><span><span>{</span><span></span><br/></span><span><span>    </span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;the-greatest-sdk&#34;</span><span>,</span><span> </span><span></span><br/></span><span><span>    </span><span>&#34;version&#34;</span><span>:</span><span> </span><span>&#34;1.0.3&#34;</span><span>,</span><span> </span><span></span><br/></span><span><span>    </span><span>&#34;main&#34;</span><span>:</span><span> </span><span>&#34;dist/index.js&#34;</span><span>,</span><span></span><br/></span><span><span>    </span><span>&#34;types&#34;</span><span>:</span><span> </span><span>&#34;dist/index.d.ts&#34;</span><span>,</span><span></span><br/></span><span><span>    </span><span>&#34;scripts&#34;</span><span>:</span><span> </span><span>{</span><span></span><br/></span><span><span>        </span><span>&#34;build&#34;</span><span>:</span><span> </span><span>&#34;tsc&#34;</span><span></span><br/></span><span><span>    </span><span>}</span><span>,</span><span></span><br/></span><span><span>    </span><span>&#34;keywords&#34;</span><span>:</span><span> </span><span>[</span><span>]</span><span>,</span><span> </span><span></span><br/></span><span><span>    </span><span>&#34;author&#34;</span><span>:</span><span> </span><span>&#34;liblab&#34;</span><span>,</span><span> </span><span></span><br/></span><span><span>    </span><span>&#34;license&#34;</span><span>:</span><span> </span><span>&#34;ISC&#34;</span><span>,</span><span></span><br/></span><span><span>    </span><span>&#34;files&#34;</span><span>:</span><span> </span><span>[</span><span></span><br/></span><span><span>        </span><span>&#34;dist&#34;</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;src&#34;</span><span></span><br/></span><span><span>    </span><span>]</span><span>,</span><span></span><br/></span><span><span>    </span><span>&#34;devDependencies&#34;</span><span>:</span><span> </span><span>{</span><span></span><br/></span><span><span>        </span><span>&#34;ts-node&#34;</span><span>:</span><span> </span><span>&#34;^10.9.1&#34;</span><span>,</span><span></span><br/></span><span><span>        </span><span>&#34;typescript&#34;</span><span>:</span><span> </span><span>&#34;^5.0.4&#34;</span><span></span><br/></span><span><span>    </span><span>}</span><span></span><br/></span><span><span></span><span>}</span><br/></span></code></pre></div></div><h2 id="publishing-to-npm">Publishing to NPM<a href="#publishing-to-npm" aria-label="Direct link to Publishing to NPM" title="Direct link to Publishing to NPM">​</a></h2><p>Publishing to NPM is not difficult. I strongly recommend taking a look at the <strong><a href="https://docs.npmjs.com/creating-and-publishing-unscoped-public-packages" target="_blank" rel="noopener noreferrer">official instructions</a></strong>, but here are the general steps:</p><ol><li>Make sure your <strong><code>package.json</code></strong> is set up appropriately.</li><li>Build the project (with <strong><code>npm run build</code></strong> if you followed the guide).</li><li>If you haven&#39;t already, authenticate to npm with <strong><code>npm login</code></strong> (you&#39;ll need an <strong><a href="https://www.npmjs.com/signup" target="_blank" rel="noopener noreferrer">npm account)</a></strong>.</li><li>Run <strong><code>npm publish</code></strong>.</li></ol><p>Keep in mind that if you update your package, you&#39;ll need to increase the <strong><code>version</code></strong> option in your <strong><code>package.json</code></strong> before publishing again.</p><p>There are more sophisticated (and recommended) ways to go about publishing, like using GitHub actions and releases, especially for open-source packages, but that’s out of scope for this post.</p><h2 id="conclusion">Conclusion<a href="#conclusion" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>By following the discussed approach your typescript npm packages will now provide better type-hinting, auto-completion and support ES Modules (ESM) and CommonJS (CJS) style imports, making them more accessible and usable by a wider audience.</p><p>Here at <a href="https://liblab.com/" target="_blank" rel="noopener noreferrer">liblab</a>, we know that preparing your project for NPM can be annoying. That&#39;s why our TypeScript SDKs come prepared with all the necessary adjustments for proper publishing to NPM. We&#39;ll even help you set up your CI/CD for seamless publishing. Contact us <a href="https://liblab.com/contact" target="_blank" rel="noopener noreferrer">here</a> to learn more about how we can help automate your API’s SDK creation.</p></div></div>
  </body>
</html>
