<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://justinmiller.io/posts/2023/12/27/hugo-as-wiki/">Original</a>
    <h1>Repurposing Hugo as a wiki</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
  
  <p><time datetime="2023-12-27T16:04:34-0800">Wed, Dec 27, 2023</time></p><p>As part of a project that I’m working on, I decided to see if I could repurpose the excellent <a href="https://gohugo.io">Hugo</a> website framework (which also powers this very site) as a single-user wiki of sorts.</p>
<p>Short version: <strong>yes</strong>!</p>
<p><img src="https://karthikbalakrishnan.com/blog/site.png" alt=""/></p>
<h3 id="requirements">Requirements</h3>
<p>The main features that I wanted were:</p>
<ul>
<li>
<p>The ability to, while writing a page, <strong>freely link</strong> to other topic pages that I know will (or at least plan to make) exist <em>in future</em>, without having to worry about if they exist <em>right now</em>.</p>
</li>
<li>
<p>An automatically-updating <strong>visual indication</strong> of whether a linked-to page does or does not exist yet.</p>
</li>
<li>
<p>A common <strong>“coming soon” page</strong> that the missing links will land on (i.e. no actual <a href="https://en.wikipedia.org/wiki/HTTP_404">404’s</a> for content linked in this manner; normal site 404 functionality is untouched).</p>
</li>
<li>
<p>The <strong>simplicity of writing</strong> in <a href="https://daringfireball.net/projects/markdown/">Markdown</a> that I am so used to already, especially because this is a technical project featuring lots of code syntax highlighting in the content.</p>
</li>
</ul>
<h3 id="why-not-ltwiki-software-xgt">Why not &lt;wiki software X&gt;?</h3>
<p>The main reason that I didn’t want to use an established wiki package like <a href="https://www.mediawiki.org/wiki/MediaWiki">MediaWiki</a>, the software behind Wikipedia, was that it seemed like overkill. For this project, I don’t need separate authors, I don’t need revisions of pages, and I <em>certainly</em> don’t need a database server.</p>
<p>Hugo exists to create static HTML websites, supports Markdown formatting, is fast, and has a powerful <a href="https://gohugo.io/content-management/shortcodes/">shortcode system</a> which can be extended.</p>
<p>So let’s make it happen. But first, before I get too far into the weeds, let’s take a look at the end result and how simple it is to use while writing.</p>
<h3 id="using-the-custom-shortcode">Using the custom shortcode</h3>
<p>I created a <a href="https://gohugo.io/templates/shortcode-templates/">custom shortcode</a> called <code>link</code>. Here’s how you use it.</p>
<ul>
<li>
<p>For linking to a page where the <a href="https://gohugo.io/content-management/urls/#slug">page slug</a> is the same as the word you want clickable:</p>
<p>This will produce the link text <u>other</u> linking to <code>/pages/other/</code>.</p>
</li>
<li>
<p>For linking to a page where you want to make clickable some custom text:</p>
<div><pre tabindex="0"><code data-lang="go"><span><span>{{<span>%</span> <span>link</span> <span>&#34;my text here&#34;</span> <span>other2</span> <span>%</span>}}
</span></span></code></pre></div><p>This will produce the link text <u>my text here</u> linking to <code>/pages/other2/</code>.</p>
</li>
</ul>
<p>That’s it. <strong>But critically</strong>: if in the above examples the pages <code>other</code> or <code>other2</code> don’t exist, the link will be styled in a noticeable way (in my case, red instead of blue) and will link to (also, in my case) <code>/pages/missing/</code>. Whenever I get around to adding said page, all existing links to it will auto-update and become blue in future.</p>
<h3 id="overview-of-components">Overview of components</h3>
<p>A few things need to happen to bring this configuration together.</p>
<ul>
<li>
<p>Enable Goldmark renderer <a href="https://gohugo.io/getting-started/configuration-markup/">“unsafe” mode</a>. This allows rendering of inline HTML in shortcodes. A reason why you would <em>not</em> want this enabled is if you have untrusted users and/or untrusted content. For me and this project, neither of these apply.</p>
<p>In your <code>hugo.yaml</code>:</p>
<div><pre tabindex="0"><code data-lang="yaml"><span><span><span>markup</span>:
</span></span><span><span>  <span>goldmark</span>:
</span></span><span><span>    <span>renderer</span>:
</span></span><span><span>      <span>unsafe</span>: <span>true</span>
</span></span></code></pre></div></li>
<li>
<p>Create and configure the common “missing” page and <a href="https://gohugo.io/content-management/cross-references/#ref-and-relref-configuration">make it so that unreachable-by-Hugo pages are not fatal errors</a> in the rendering process.</p>
<p>In your <code>hugo.yaml</code>:</p>
<div><pre tabindex="0"><code data-lang="yaml"><span><span><span>refLinksErrorLevel</span>: <span>WARNING</span>
</span></span><span><span><span>refLinksNotFoundURL</span>: <span>/pages/missing/</span>
</span></span></code></pre></div></li>
<li>
<p>Create the shortcode. As per above, I used the name <code>link</code>, which means I created a <code>layouts/shortcodes/link.html</code> containing the following:</p>
<div><pre tabindex="0"><code data-lang="go"><span><span>{{<span>-</span> <span>$</span><span>link</span> <span>:=</span> (<span>urls</span>.<span>RelRef</span> . (<span>cond</span> (<span>eq</span> (<span>len</span> .<span>Params</span>) <span>2</span>) (.<span>Get</span> <span>1</span>) (.<span>Get</span> <span>0</span>))) <span>-</span>}}
</span></span><span><span>&lt;<span>a</span> <span>href</span>=<span>&#34;{{ $link }}&#34;</span>{{ <span>if</span> <span>eq</span> <span>$</span><span>link</span> (<span>relref</span> . <span>&#34;missing&#34;</span>) }} <span>class</span>=<span>&#34;missing&#34;</span>{{ <span>end</span> }}&gt;{{ .<span>Get</span> <span>0</span> }}&lt;<span>/</span><span>a</span>&gt;
</span></span></code></pre></div><p>Please forgive the line wrapping. Since a shortcode gets replaced inline in your content, and since I didn’t want to add extra spacing or linebreaks in my content, the shortcode is just two (long-ish) lines.</p>
</li>
<li>
<p>Configure the <code>missing</code> class in your theme’s CSS.</p>
<div><pre tabindex="0"><code data-lang="css"><span><span><span>main</span>#content <span>a</span>.<span>missing</span> {
</span></span><span><span>  <span>color</span>: <span>#f00</span>;
</span></span><span><span>}
</span></span></code></pre></div></li>
</ul>
<h3 id="how-the-shortcode-works">How the shortcode works</h3>
<p>The shortcode took the most work, as the other bits were just a little configuration tweaking and some strategic web searching in order to puzzle through some minor issues. Here’s how it works.</p>
<h4 id="line-1-resolve-destination">Line 1: Resolve destination</h4>
<p>In the first line, a <code>$link</code> variable is created which benefits from the flexibility of specifying either one or two arguments to the shortcode — one if the page slug and linked text are the same, and two if they differ.</p>
<div><pre tabindex="0"><code data-lang="go"><span><span>{{<span>-</span> <span>$</span><span>link</span> <span>:=</span> (<span>urls</span>.<span>RelRef</span> . (<span>cond</span> (<span>eq</span> (<span>len</span> .<span>Params</span>) <span>2</span>) (.<span>Get</span> <span>1</span>) (.<span>Get</span> <span>0</span>))) <span>-</span>}}
</span></span></code></pre></div><p>I will add that spending a lot of time recently in Lisp and other similar languages which are composed of <a href="https://en.wikipedia.org/wiki/S-expression">S-expressions</a> has made Go syntax like <code>(cond (eq (len .Params) 2)...</code> much more natural to me.</p>
<p>The best part about the use of <a href="https://gohugo.io/functions/urls/relref/"><code>urls.RelRef</code></a> in the link buildup is that the links are filename- and reorganization-independent. If you use a destination page filename of <code>other.md</code>, a shortcode argument of <code>other</code> will find it. If you use a filename of <code>other-page.md</code> but a <code>slug</code> within its front matter of <code>other</code>, it will also work. If you change the location of resources but keep either of these the same, it will be found. And finally, if the page cannot be found (likely because it doesn’t exist yet, one of the requirements of tolerance in this system), the “missing” common page will be linked (in my configuration above, <code>/pages/missing/</code>).</p>
<h4 id="line-2-conditionally-style-link-text">Line 2: Conditionally style link text</h4>
<p>Moving on from the <code>$link</code> setup, the other line of the shortcode sets up a standard HTML anchor link <code>&lt;a&gt;</code> tag highlighting the shortcode’s first argument as the link text. Most importantly, if the link resolves to the common missing page, this can be detected and the custom “doesn’t exist yet” CSS is applied to the link.</p>
<div><pre tabindex="0"><code data-lang="go"><span><span>&lt;<span>a</span> <span>href</span>=<span>&#34;{{ $link }}&#34;</span>{{ <span>if</span> <span>eq</span> <span>$</span><span>link</span> (<span>urls</span>.<span>RelRef</span> . <span>&#34;missing&#34;</span>) }} <span>class</span>=<span>&#34;missing&#34;</span>{{ <span>end</span> }}&gt;{{ .<span>Get</span> <span>0</span> }}&lt;<span>/</span><span>a</span>&gt;
</span></span></code></pre></div><p>Astute readers and/or optimization nerds will notice that this technically relies on duplication of the <code>missing</code> term — once here and once in the <code>hugo.yaml</code> part which sets up the missing page for failed <code>urls.RelRef</code> resolution. While I would have liked to avoid this, no Hugo function exists to get at the same of the <code>refLinksNotFoundURL</code> variable specified in the site configuration. The closest I got was <a href="https://gohugo.io/methods/site/config/"><code>.Site.Config</code></a>, but that only exposes the <code>services</code> and <code>privacy</code> keys as a subset of the configuration. Argh, code duplication.</p>
<h3 id="exciting-conclusion">Exciting conclusion</h3>
<p>All in all, I’m quite happy with this. While I’ve only really begun the actual buildout of the site for which this system was contrived, it’s already reducing mental overhead and allowing me to see some structure to the site without having to worry about writing it all or even creating placeholder page files for now.</p>
<p>It’s definitely a case of <a href="https://xkcd.com/974/">The General Problem</a>, though.</p>
<p><a href="https://xkcd.com/974/"><img src="https://imgs.xkcd.com/comics/the_general_problem.png"/></a></p>
<p>What can I say? I’m most certainly a developer and <a href="https://two-wrongs.com/john-the-toolmaker">toolmaker</a> at heart. I prefer to take inspiration here from Abraham Lincoln as quoted in the previous link:</p>
<blockquote>
<p>If I had six hours to chop down a tree, I would spend the first four sharpening the axe.</p>
</blockquote>
<h3 id="bonus-visual-studio-code-snippets">Bonus: Visual Studio Code snippets</h3>
<p>Not content with a mere single level of <a href="https://www.wordnik.com/words/yak%20shaving">yak shaving</a>, and in keeping with the spirit of the preceding section, I also wanted a quick way to insert these shortcode-based links into my writing. I learned about <a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets">VS Code snippets</a> which are both easy and powerful, and I was able to create a project-specific <code>.vscode/snippets.code-snippets</code> file with the following:</p>
<div><pre tabindex="0"><code data-lang="json"><span><span>{
</span></span><span><span>  <span>&#34;Insert wiki page link&#34;</span>: {
</span></span><span><span>    <span>&#34;scope&#34;</span>: <span>&#34;markdown&#34;</span>,
</span></span><span><span>    <span>&#34;prefix&#34;</span>: <span>&#34;link&#34;</span>,
</span></span><span><span>    <span>&#34;body&#34;</span>: [<span>&#34;{{% link ${1:linked text} ${2:slug} %}}&#34;</span>]
</span></span><span><span>  }
</span></span><span><span>}
</span></span></code></pre></div><p>Then, in my project, whenever I type <code>link</code>, I can <code>Tab</code> to get a popup suggestion with tab-completion into the two fields for easy fill-out. And if I only want one shortcode argument, I can easily delete the second tabbed-to argument.</p>
<p><img src="https://karthikbalakrishnan.com/blog/tab.gif" alt=""/></p>

<p>In the process of writing this post in Hugo and about Hugo, I discovered a puzzler of a problem with including the example shortcode in the usage and snippets examples — the shortcode doesn’t actually exist on <em>this</em> site, but was still being interpreted by Hugo as a shortcode in this post’s content, causing the page render to fail. Bless <a href="https://liatas.com/posts/escaping-hugo-shortcodes/">this kind soul, Chris Liatas</a>, for writing about a technique to work around this using C-style code comments, thereby allowing me to display unparsed Hugo code in a post about Hugo code within a system running Hugo code.</p>
<hr/>
<p>
See the <a href="https://lobste.rs/s/i8qnvf">discussion</a> about this post on Lobsters.
</p>
  


  




</div>
    </div></div>
  </body>
</html>
