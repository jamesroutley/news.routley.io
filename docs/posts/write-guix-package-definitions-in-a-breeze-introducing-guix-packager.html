<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://guix.gnu.org/blog/2023/write-package-definitions-in-a-breeze/">Original</a>
    <h1>Write Guix package definitions in a breeze: Introducing Guix Packager</h1>
    
    <div id="readability-page-1" class="page"><div><article class="page" lang="en"><p lang="en">Ludovic Courtès, Philippe Virouleau — November 24, 2023</p><p>More than 28,000 packages are available in Guix today, not counting
third-party channels.  That’s a lot—the <a href="https://repology.org/">5th largest GNU/Linux
distro</a>!  But it’s nothing if the one package you
care about is missing.  So even you, dear reader, may one day find
yourself defining a package for your beloved deployment tool.  This post
introduces a new tool poised to significantly lower the barrier to
writing new packages.</p><p><a href="https://guix.gnu.org/manual/devel/en/html_node/Defining-Packages.html">Defining
packages</a>
for Guix is not all that hard but, as always, it’s much harder the first
time you do it, especially when starting from a blank page and/or not
being familiar with the programming environment of Guix.  <a href="https://guix-hpc.gitlabpages.inria.fr/guix-packager/">Guix
Packager</a> is a new
web user interface to get you started—<a href="https://guix-hpc.gitlabpages.inria.fr/guix-packager/">try
it!</a>.  It arrived
right in time as an aid to the <a href="https://hpc.guix.info/events/2023/workshop/program/#how-to-get-started-writing-guix-packages">packaging
tutorial</a>
given last week at the Workshop on Reproducible Software Environments.</p><p><img src="https://guix.gnu.org/static/blog/img/guix-packager.gif" alt="Screenshot showing the Guix Packager interface."/></p><p>The interface aims to be intuitive: fill in forms on the left
and it produces a correct, ready-to-use package definition on the right.
Importantly, it helps you avoid pitfalls that trip up many newcomers:</p><ul><li>When you add a dependency in one of the “Inputs” fields, it adds the
right variable name in the generated code <em>and</em> imports the right
<a href="https://guix.gnu.org/manual/devel/en/html_node/Package-Modules.html">package
module</a>.</li><li>Likewise, you can choose a license and be sure the <code>license</code> field
will refer to the right variable representing that license.</li><li>You can turn tests on and off, and add configure flags.  These
translate to a valid <code>arguments</code> field of your package, letting you
discover the likes of <a href="https://guix.gnu.org/cookbook/en/html_node/A-Scheme-Crash-Course.html">keyword
arguments</a>
and
<a href="https://guix.gnu.org/manual/en/html_node/G_002dExpressions.html">G-expressions</a>
without having to first dive into the manual.</li></ul><p>Pretty cool, no?</p><p>All the credit for this tool goes to co-worker and intrepid hacker
Philippe Virouleau.  A unique combination of paren aversion and web
development superpowers—unique in the Guix community—led
Philippe to develop the whole thing in a glimpse (says Ludovic!).</p><p>The purpose was to provide a single view to be able to edit a package recipe,
therefore the application is a <em>single-page application</em> (SPA) written in
using the UI library Philippe is most comfortable with: <a href="https://react.dev/">React</a>,
and <a href="https://mui.com/material-ui/">MaterialUI</a> for styling the components.
It&#39;s built with <a href="https://www.typescriptlang.org/">TypeScript</a>, and the library
part actually defines all the types needed to manipulate Guix packages and their
components (such as build systems or package sources).
One of the more challenging parts was to be able to provide fast and helpful “search as you
type” results over the 28k+ packages. It required a combination of
MaterialUI&#39;s <a href="https://mui.com/material-ui/react-autocomplete/#virtualization">virtualized inputs</a>,
as well as caching the packages data in the browser&#39;s local storage,
when possible (packaging metadata itself is fetched from
<code>https://guix.gnu.org/packages.json</code>, a generic representation of the
current package set).</p><p>While the feature set provides a great starting point, there are still a few
things that may be worth implementing.  For instance, only the GNU and
CMake build systems are supported so far; it would make sense to include
a few others (Python-related ones might be good candidates).</p><p>Running a local (development) version of the application can happen on
top of Guix, since—obviously—it&#39;s been developed with the <code>node</code>
version packaged in Guix, using the quite standard <code>packages.json</code> for
JavaScript dependencies installed through <code>npm</code>.  <a href="https://gitlab.inria.fr/guix-hpc/guix-packager/">Contributions
welcome!</a></p><p>This neat tool complements a set of steps we’ve taken over time to make
packaging in Guix approachable.  Indeed, while package definitions are
actually code written in the Scheme language, the <code>package</code> “language”
was designed <a href="https://arxiv.org/abs/1305.4584">from the get-go</a> to be
fully declarative—think JSON with parens instead of curly braces and
semicolons.  More recently we <a href="https://guix.gnu.org/en/blog/2021/the-big-change/">simplified the way package inputs are
specified</a> with an
eye on making package definitions less intimidating.</p><p>The <a href="https://guix.gnu.org/manual/devel/en/html_node/Invoking-guix-import.html"><code>guix import</code>
command</a>
also exists to make it easier to simplify packaging: it can generate a
package definition for anything available in other package
repositories such as PyPI, CRAN, Crates.io, and so forth.  If your
preference goes to curly braces rather than parens, it can also <a href="https://guix.gnu.org/manual/devel/en/html_node/Invoking-guix-import.html#index-JSON_002c-import">convert
a JSON package
description</a>
to Scheme code.  Once you have your first <code>.scm</code> file, <code>guix build</code>
prints hints for common errors such missing module imports (those
<code>#:use-module</code> stanzas).  We also put effort into providing <a href="https://guix.gnu.org/manual/devel/en/html_node/Defining-Packages.html">reference
documentation</a>,
a <a href="https://guix.gnu.org/en/videos/2020/packaging-part-two/">video
tutorial</a>, and
a <a href="https://guix.gnu.org/cookbook/en/html_node/Packaging-Tutorial.html">tutorial for more complex
packages</a>.</p><p>Do share your experience <a href="https://guix.gnu.org/contact">with us</a> and
until then, happy packaging!</p><p>Thanks to Felix Lechner and Timothy Sample for providing feedback on an
earlier draft of this post.</p><h4>About GNU Guix</h4><p><a href="https://guix.gnu.org">GNU Guix</a> is a transactional package manager and
an advanced distribution of the GNU system that <a href="https://www.gnu.org/distros/free-system-distribution-guidelines.html">respects user
freedom</a>.
Guix can be used on top of any system running the Hurd or the Linux
kernel, or it can be used as a standalone operating system distribution
for i686, x86_64, ARMv7, AArch64 and POWER9 machines.</p><p>In addition to standard package management features, Guix supports
transactional upgrades and roll-backs, unprivileged package management,
per-user profiles, and garbage collection.  When used as a standalone
GNU/Linux distribution, Guix offers a declarative, stateless approach to
operating system configuration management.  Guix is highly customizable
and hackable through <a href="https://www.gnu.org/software/guile">Guile</a>
programming interfaces and extensions to the
<a href="http://schemers.org">Scheme</a> language.</p><p>Unless otherwise stated, blog posts on this site are
copyrighted by their respective authors and published under the terms of
the <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA 4.0</a> license and those of the <a href="https://www.gnu.org/licenses/fdl-1.3.html">GNU Free Documentation License</a> (version 1.3 or later, with no Invariant Sections, no
Front-Cover Texts, and no Back-Cover Texts).</p></article></div></div>
  </body>
</html>
