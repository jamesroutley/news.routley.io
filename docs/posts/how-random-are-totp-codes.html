<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://shkspr.mobi/blog/2024/07/how-random-are-totp-codes/">Original</a>
    <h1>How random are TOTP codes?</h1>
    
    <div id="readability-page-1" class="page"><article><a href="https://shkspr.mobi/blog/wp-content/uploads/2024/07/Figure_1-fs8.png" itemprop="https://schema.org/image"></a><div itemprop="https://schema.org/articleBody"><p>I&#39;m pretty sure that the 2FA codes generated by my bank&#39;s TOTP app have a bias towards the number 8 - because <a href="https://en.wikipedia.org/wiki/Chinese_numerology#Eight">eight is an auspicious number</a>.</p><p>But is that just my stupid meaty brain noticing patterns where none exist?</p><p>The TOTP algorithm uses <a href="https://en.wikipedia.org/wiki/HMAC-based_one-time_password#Definition">HMAC, which in turn uses SHA-1</a>. My aforementioned brain is not clever enough to understand how that works. Although bigger, meatier brains have assured me it is fine.</p><p>What happens if I sample, say, the next 10 TOTP codes and plot how often digits appear?</p><p><img fetchpriority="high" decoding="async" src="https://shkspr.mobi/blog/wp-content/uploads/2024/07/Figure_1-fs8.png" alt="Histogram of distributions. 8 is clearly higher than the rest." width="640" height="443"/></p><p>HOLY SHIT! CONSPIRACY CONFIRMED! WTAF?!?!?</p><p>Don&#39;t believe me? Here&#39;s the code:</p><pre><code><span>import</span> pyotp</code></pre><p>OK, so maybe that&#39;s a coincidence. What happens if we check 100 generations?</p><p><img decoding="async" src="https://shkspr.mobi/blog/wp-content/uploads/2024/07/Figure_100-fs8.png" alt="Histogram of 100 runs. Still significant variation, although flattened." width="640" height="443"/></p><p>Quite a lot of noise in there - but lucky number 8 isn&#39;t quite as prominent.</p><p>After 10,000 generations, the variation is all but gone.</p><p><img decoding="async" src="https://shkspr.mobi/blog/wp-content/uploads/2024/07/Figure_10000-fs8.png" alt="Histogram showing almost no variation." width="640" height="443"/></p><p>There are about 30 million seconds in a year. TOTP codes change every 30 seconds. Which means, in a year, you&#39;ll see about a million of them:</p><p><img loading="lazy" decoding="async" src="https://shkspr.mobi/blog/wp-content/uploads/2024/07/Figure_1000000-fs8.png" alt="Histogram which is basically flat." width="640" height="443"/></p><p>Is it possible that a TOTP code could be formed which shows a clear bias to a specific number? Probably not.</p><p>I love being able to check the source code - but sometimes it&#39;s just as reassuring to measure the output.</p></div></article></div>
  </body>
</html>
