<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/arnarg/nixtml">Original</a>
    <h1>Nixtml: Static website and blog generator written in Nix</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/arnarg/nixtml/blob/main/logo.svg"><img alt="nixtml logo" src="https://github.com/arnarg/nixtml/raw/main/logo.svg" width="1000px"/></a>
</p>
<p dir="auto">A static website generator written in <strong>nix</strong>. Inspired by hugo.</p>

<div dir="auto" data-snippet-clipboard-copy-content="{
  description = &#34;My website generated using nixtml.&#34;;

  inputs = {
    nixpkgs.url = &#34;github:nixos/nixpkgs/nixos-unstable&#34;;
    flake-utils.url = &#34;github:numtide/flake-utils&#34;;
    nixtml.url = &#34;github:arnarg/nixtml&#34;;
  };

  outputs =
    {
      self,
      nixpkgs,
      flake-utils,
      nixtml,
    }:
    (flake-utils.lib.eachDefaultSystem (
      system:
      let
        pkgs = import nixpkgs { inherit system; };
      in
      {
        packages.blog = nixtml.lib.mkWebsite {
          inherit pkgs;

          name = &#34;my-blog&#34;;
          baseURL = &#34;https://my-blog.com&#34;;

          # Arbitrary metdata to be used in
          # templates.
          metadata = {
            lang = &#34;en&#34;;
            title = &#34;My Blog&#34;;
            description = &#34;This is my blog&#34;;
          };

          # Walk a directory of markdown files
          # and create a page for each of them.
          content.dir = ./content; 

          # Copy an entire directory and symlink
          # in the final website derivation.
          static.dir = ./static;

          # Collections are for paginating content
          # and generating RSS feeds.
          collections.blog = {
            path = &#34;posts&#34;;

            # Posts in the collection should be
            # grouped by optional tags in posts&#39;
            # frontmatter.
            taxonomies = [ &#34;tags&#34; ];
          };

          # Import any nixtml modules (good for
          # &#34;themes&#34;).
          imports = [ ./theme.nix ];
        };

        # Quickly build and serve website with
        # `nix run .#serve`.
        apps.serve = {
          type = &#34;app&#34;;
          program =
            (pkgs.writeShellScript &#34;serve-blog&#34; &#39;&#39;
              ${pkgs.python3}/bin/python -m http.server -d ${self.packages.${system}.blog} 8080
            &#39;&#39;).outPath;
        };
      }
    ));
}"><pre><span>{</span>
  <span><span>description</span></span> <span>=</span> <span>&#34;My website generated using nixtml.&#34;</span><span>;</span>

  <span><span>inputs</span></span> <span>=</span> <span>{</span>
    <span><span>nixpkgs</span><span>.</span><span>url</span></span> <span>=</span> <span>&#34;github:nixos/nixpkgs/nixos-unstable&#34;</span><span>;</span>
    <span><span>flake-utils</span><span>.</span><span>url</span></span> <span>=</span> <span>&#34;github:numtide/flake-utils&#34;</span><span>;</span>
    <span><span>nixtml</span><span>.</span><span>url</span></span> <span>=</span> <span>&#34;github:arnarg/nixtml&#34;</span><span>;</span>
  <span>}</span><span>;</span>

  <span><span>outputs</span></span> <span>=</span>
    <span>{</span>
      <span>self</span><span>,</span>
      <span>nixpkgs</span><span>,</span>
      <span>flake-utils</span><span>,</span>
      <span>nixtml</span><span>,</span><span></span>
    <span>}</span>:
    <span>(</span><span>flake-utils</span><span>.</span><span><span>lib</span><span>.</span><span>eachDefaultSystem</span></span> <span>(</span>
      <span>system</span>:
      <span>let</span>
        <span><span>pkgs</span></span> <span>=</span> <span><span>import</span></span> <span>nixpkgs</span> <span>{</span> <span>inherit</span> <span>system</span><span>;</span> <span>}</span><span>;</span>
      <span>in</span>
      <span>{</span>
        <span><span>packages</span><span>.</span><span>blog</span></span> <span>=</span> <span>nixtml</span><span>.</span><span><span>lib</span><span>.</span><span>mkWebsite</span></span> <span>{</span>
          <span>inherit</span> <span>pkgs</span><span>;</span>

          <span><span>name</span></span> <span>=</span> <span>&#34;my-blog&#34;</span><span>;</span>
          <span><span>baseURL</span></span> <span>=</span> <span>&#34;https://my-blog.com&#34;</span><span>;</span>

          <span># Arbitrary metdata to be used in</span>
          <span># templates.</span>
          <span><span>metadata</span></span> <span>=</span> <span>{</span>
            <span><span>lang</span></span> <span>=</span> <span>&#34;en&#34;</span><span>;</span>
            <span><span>title</span></span> <span>=</span> <span>&#34;My Blog&#34;</span><span>;</span>
            <span><span>description</span></span> <span>=</span> <span>&#34;This is my blog&#34;</span><span>;</span>
          <span>}</span><span>;</span>

          <span># Walk a directory of markdown files</span>
          <span># and create a page for each of them.</span>
          <span><span>content</span><span>.</span><span>dir</span></span> <span>=</span> <span>./content</span><span>;</span> 

          <span># Copy an entire directory and symlink</span>
          <span># in the final website derivation.</span>
          <span><span>static</span><span>.</span><span>dir</span></span> <span>=</span> <span>./static</span><span>;</span>

          <span># Collections are for paginating content</span>
          <span># and generating RSS feeds.</span>
          <span><span>collections</span><span>.</span><span>blog</span></span> <span>=</span> <span>{</span>
            <span><span>path</span></span> <span>=</span> <span>&#34;posts&#34;</span><span>;</span>

            <span># Posts in the collection should be</span>
            <span># grouped by optional tags in posts&#39;</span>
            <span># frontmatter.</span>
            <span><span>taxonomies</span></span> <span>=</span> <span>[</span> <span>&#34;tags&#34;</span> <span>]</span><span>;</span>
          <span>}</span><span>;</span>

          <span># Import any nixtml modules (good for</span>
          <span># &#34;themes&#34;).</span>
          <span><span>imports</span></span> <span>=</span> <span>[</span> <span>./theme.nix</span> <span>]</span><span>;</span>
        <span>}</span><span>;</span>

        <span># Quickly build and serve website with</span>
        <span># `nix run .#serve`.</span>
        <span><span>apps</span><span>.</span><span>serve</span></span> <span>=</span> <span>{</span>
          <span><span>type</span></span> <span>=</span> <span>&#34;app&#34;</span><span>;</span>
          <span><span>program</span></span> <span>=</span>
            <span>(</span><span>pkgs</span><span>.</span><span><span>writeShellScript</span></span> <span>&#34;serve-blog&#34;</span> <span>&#39;&#39;</span>
<span>              <span>${</span><span><span>pkgs</span><span>.</span><span><span>python3</span></span></span><span>}</span>/bin/python -m http.server -d <span>${</span><span><span>self</span><span>.</span><span><span>packages</span><span>.</span><span>${</span><span><span>system</span></span><span>}</span><span>.</span><span>blog</span></span></span><span>}</span> 8080</span>
<span>            &#39;&#39;</span><span>)</span><span>.</span><span><span>outPath</span></span><span>;</span>
        <span>}</span><span>;</span>
      <span>}</span>
    <span>)</span><span>)</span><span>;</span>
<span>}</span></pre></div>

<ul dir="auto">
<li><a href="https://github.com/arnarg/blog">My blog</a></li>
</ul>

<p dir="auto">Templates should be defined in modules under <code>website.layouts</code>. All templates should be a function to a string (or list of strings, that is automatically coerced to a string).</p>

<p dir="auto">In nixtml&#39;s lib there are functions for most commonly used HTML tags which can be used like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{lib, ...}: let
  inherit (lib.tags)
    html
    head
    body
    div
    ;
  inherit (lib) attrs;
in {
  website.layouts.base =
    { path, content, ... }@context:
    &#34;&lt;!DOCTYPE html&gt;\n&#34;
    +
      html
        [ (attrs.lang metadata.lang) ]
        [
          (head [ ] [ (partials.head context) ])
          (body
            [
              (attrs.classes [
                &#34;font-sans&#34;
                &#34;bg-white&#34;
              ])
            ]
            [
              (div
                [
                  (attrs.classes [ &#34;container&#34; ])
                ]
                [ content ]
              )
            ]
          )
        ];
}"><pre><span>{</span><span>lib</span><span>,</span> ...<span>}</span>: <span>let</span>
  <span>inherit</span> <span>(</span><span>lib</span><span>.</span><span><span>tags</span></span><span>)</span>
    <span>html</span>
    <span>head</span>
    <span>body</span>
    <span>div</span>
    <span>;</span>
  <span>inherit</span> <span>(</span><span>lib</span><span>)</span> <span>attrs</span><span>;</span>
<span>in</span> <span>{</span>
  <span><span>website</span><span>.</span><span>layouts</span><span>.</span><span>base</span></span> <span>=</span>
    <span>{</span> <span>path</span><span>,</span> <span>content</span><span>,</span> ... <span>}</span>@<span>context</span>:
    <span>&#34;&lt;!DOCTYPE html&gt;<span>\n</span>&#34;</span>
    <span>+</span>
      <span><span>html</span></span>
        <span>[</span> <span>(</span><span>attrs</span><span>.</span><span><span>lang</span></span> <span>metadata</span><span>.</span><span><span>lang</span></span><span>)</span> <span>]</span>
        <span>[</span>
          <span>(</span><span><span>head</span></span> <span>[</span> <span>]</span> <span>[</span> <span>(</span><span>partials</span><span>.</span><span><span>head</span></span> <span>context</span><span>)</span> <span>]</span><span>)</span>
          <span>(</span><span><span>body</span></span>
            <span>[</span>
              <span>(</span><span>attrs</span><span>.</span><span><span>classes</span></span> <span>[</span>
                <span>&#34;font-sans&#34;</span>
                <span>&#34;bg-white&#34;</span>
              <span>]</span><span>)</span>
            <span>]</span>
            <span>[</span>
              <span>(</span><span><span>div</span></span>
                <span>[</span>
                  <span>(</span><span>attrs</span><span>.</span><span><span>classes</span></span> <span>[</span> <span>&#34;container&#34;</span> <span>]</span><span>)</span>
                <span>]</span>
                <span>[</span> <span>content</span> <span>]</span>
              <span>)</span>
            <span>]</span>
          <span>)</span>
        <span>]</span><span>;</span>
<span>}</span></pre></div>

<p dir="auto">The above is equivalent to defining the markup using strings in nix:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{lib, ...}: {
  website.layouts.base =
    { path, content, ... }@context: &#39;&#39;
      &lt;!DOCTYPE html&gt;
      &lt;html lang=&#34;${metadata.lang}&#34;&gt;
        &lt;head&gt;
          ${partials.head context}
        &lt;/head&gt;
        &lt;body class=&#34;font-sant bg-white&#34;&gt;
          &lt;div class=&#34;container&#34;&gt;
            ${content}
          &lt;/div&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    &#39;&#39;;
}"><pre><span>{</span><span>lib</span><span>,</span> ...<span>}</span>: <span>{</span>
  <span><span>website</span><span>.</span><span>layouts</span><span>.</span><span>base</span></span> <span>=</span>
    <span>{</span> <span>path</span><span>,</span> <span>content</span><span>,</span> ... <span>}</span>@<span>context</span>: <span>&#39;&#39;</span>
<span>      &lt;!DOCTYPE html&gt;</span>
<span>      &lt;html lang=&#34;<span>${</span><span><span>metadata</span><span>.</span><span><span>lang</span></span></span><span>}</span>&#34;&gt;</span>
<span>        &lt;head&gt;</span>
<span>          <span>${</span><span><span>partials</span><span>.</span><span><span>head</span></span> <span>context</span></span><span>}</span></span>
<span>        &lt;/head&gt;</span>
<span>        &lt;body class=&#34;font-sant bg-white&#34;&gt;</span>
<span>          &lt;div class=&#34;container&#34;&gt;</span>
<span>            <span>${</span><span><span>content</span></span><span>}</span></span>
<span>          &lt;/div&gt;</span>
<span>        &lt;/body&gt;</span>
<span>      &lt;/html&gt;</span>
<span>    &#39;&#39;</span><span>;</span>
<span>}</span></pre></div>

<p dir="auto">Each template in <code>website.layouts</code> has a specific purpose.</p>
<ul dir="auto">
<li><code>website.layouts.base</code>: Used for the skeleton of each HTML file for the website. It gets passed the result of other rendered templates.</li>
<li><code>website.layouts.hom</code>: Used for <code>./index.md</code>, if found in <code>website.content.dir</code>. It gets passed the metadata in the markdown frontmatter as well as the HTML content generated from markdown.</li>
<li><code>website.layouts.page</code>: Used for any other markdown file found in <code>website.content.dir</code>. It gets passed the metadata in the markdown frontmatter as well as the HTML content generated from markdown.</li>
<li><code>website.layouts.collection</code>: Used for pagination pages for collections.</li>
<li><code>website.layouts.taxonomy</code>: Used for pagination pages for taxonomies in collections.</li>
<li><code>website.layouts.partials</code>: An attribute set of templates (functions to string or list of strings) that can be used to reduce repitition in the other standard templates.</li>
</ul>

<p dir="auto">By setting <code>website.content.dir</code> nixtml will traverse that directory, transform any markdown file it finds and output an HTML file in the final website derivation with the same path. For example, <code>${content.dir}/about.md</code> becomes <code>about/index.html</code> in the final website derivation.</p>

<p dir="auto">Collections allow you to group, paginate and list related content such as blog posts or portfolio pieces.</p>
<p dir="auto">Create a collection under <code>website.collections.&lt;name&gt;</code> and point it to a folder inside <code>website.content.dir</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="website.collections.blog = {
  path = &#34;blog/posts&#34;;     # ./content/blog/posts/
  pagination.perPage = 5;  # Number of items each listing page shows
  rss.enable = true;       # Generate /blog/index.xml
};"><pre><span>website</span><span>.</span><span><span>collections</span><span>.</span><span>blog</span></span> <span>=</span> <span>{</span>
  <span><span>path</span></span> <span>=</span> <span>&#34;blog/posts&#34;</span><span>;</span>     <span># ./content/blog/posts/</span>
  <span><span>pagination</span><span>.</span><span>perPage</span></span> <span>=</span> <span>5</span><span>;</span>  <span># Number of items each listing page shows</span>
  <span><span>rss</span><span>.</span><span>enable</span></span> <span>=</span> <span>true</span><span>;</span>       <span># Generate /blog/index.xml</span>
<span>}</span><span>;</span></pre></div>
<p dir="auto">nixtml automatically produces listing pages hosting <code>pagination.perPage</code> items per page (<code>blog/index.html</code>, <code>blog/page/2/index.html</code>, …) rendered with the <code>collection</code> layout template.</p>

<p dir="auto">You may want to allow readers to explore entries by common key–words such as tags, categories or authors. Activate any number of taxonomies with the list key <code>taxonomies</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="website.collections.blog = {
  path = &#34;blog/posts&#34;;
  taxonomies = [ &#34;tags&#34; &#34;series&#34; ];
};"><pre><span>website</span><span>.</span><span><span>collections</span><span>.</span><span>blog</span></span> <span>=</span> <span>{</span>
  <span><span>path</span></span> <span>=</span> <span>&#34;blog/posts&#34;</span><span>;</span>
  <span><span>taxonomies</span></span> <span>=</span> <span>[</span> <span>&#34;tags&#34;</span> <span>&#34;series&#34;</span> <span>]</span><span>;</span>
<span>}</span><span>;</span></pre></div>
<p dir="auto">In every markdown file inside that collection you can now list these terms in the YAML frontmatter:</p>
<div dir="auto" data-snippet-clipboard-copy-content="---
title: &#34;My Emacs Setup&#34;
date: 2024-07-15
tags:
  - emacs
  - productivity
series:
  - dotfiles
---
Post body…"><pre><span>---</span>
<span>title</span>: <span><span>&#34;</span>My Emacs Setup<span>&#34;</span></span>
<span>date</span>: <span>2024-07-15</span>
<span>tags</span>:
  - <span>emacs</span>
  - <span>productivity</span>
<span>series</span>:
  - <span>dotfiles</span>
<span>---</span>
Post body…</pre></div>
<p dir="auto">nixtml will then create pages such as <code>/blog/tags/emacs/index.html</code>, <code>/blog/tags/emacs/page/2/index.html</code> and so on using the <code>taxonomy</code> layout template.</p>
<p dir="auto">Inside collection or taxonomy templates you always receive the same context attribute set:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  # --- collection &amp; taxonomy -------------
  pageNumber,     # Current page number
  totalPages,     # Total amount of pages
  items,          # List of posts in this page
  hasNext,        # A next page exists (bool)
  hasPrev,        # A previous page exists (bool)
  nextPageURL,    # URL to next page
  prevPageURL,    # URL to previous page
  # --- only taxonomy --------------------
  title,          # The tag or term being shown
}"><pre><span>{</span>
  <span># --- collection &amp; taxonomy -------------</span>
  <span>pageNumber</span><span>,</span>     <span># Current page number</span>
  <span>totalPages</span><span>,</span>     <span># Total amount of pages</span>
  <span>items</span><span>,</span>          <span># List of posts in this page</span>
  <span>hasNext</span><span>,</span>        <span># A next page exists (bool)</span>
  <span>hasPrev</span><span>,</span>        <span># A previous page exists (bool)</span>
  <span>nextPageURL</span><span>,</span>    <span># URL to next page</span>
  <span>prevPageURL</span><span>,</span>    <span># URL to previous page</span>
  <span># --- only taxonomy --------------------</span>
  <span>title</span><span>,</span>          <span># The tag or term being shown</span><span></span>
<span>}</span></pre></div>

<p dir="auto">Look at the examples directory to see how to work with nixtml. They can be built with <code>nix build .#examples.simple</code> and <code>nix build .#examples.blog</code>.</p>
</article></div></div>
  </body>
</html>
