<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://devblogs.microsoft.com/oldnewthing/20251028-00/?p=111733">Original</a>
    <h1>How did the Windows 95 user interface code get to the Windows NT code base?</h1>
    
    <div id="readability-page-1" class="page"><div id="single-wrapper">
    
    <article data-clarity-region="article" id="post-111733">
        <div data-bi-area="body_article" data-bi-id="post_page_body_article">
            <p>A long time ago, somebody asked, “How did the new Windows 95 user interface get brought to the Windows NT code base? The development of Windows 95 lined up with the endgame of Windows NT 3.1, so how did the finished Windows 95 code get brought to the Windows NT code base for Windows NT 4.0? Did they reimplement it based on the existing specification? Was the code simply merged into the Windows NT code base?”</p>
<p>Members of the Windows 95 user interface team <a title="Optimizing the Chili&#39;s dining experience" href="https://devblogs.microsoft.com/oldnewthing/20130205-00/?p=5343"> met regularly with members of the Windows NT user interface team</a> to keep them aware of what was going on and even get their input on some ideas that the Windows 95 team were considering. The Windows NT user interface team were focused on shipping Windows NT, but they appreciated being kept in the loop.</p>
<p>During the late phases of the development of Windows 95, the Windows NT side of the house took a more active role in bringing the Windows 95 user interface to Windows NT. They started implementing the new window manager features that Windows 95 introduced, both in terms of new functions such as <code>Register­Class­Ex</code> and <code>Set­Scroll­Info</code>, as well as new behaviors such as having a Close button in the upper right corner. The window managers on Windows NT and Windows 95 both had ancestry in the Windows 3.1 window manager, so a lot of the designs were the same, but the code had long since diverged significantly, so it wasn’t so much merging the code as it was using the Windows 95 code as a reference implementation when reimplementing the features on Windows NT. (For example, the algorithm for walking the dialog tree in the face of <code>WS_<wbr/>EX_<wbr/>CONTROL­PARENT</code> remained the same, but the expression of the algorithm was different.)</p>
<p>The code for Explorer and other user-model components had an easier time. They were taken as-is into the Windows NT code base, warts and all, and the copy was then updated in-place to be more Windows NT-like. For example, the Windows 95 shell used <code>CHAR</code> as its base character, but Windows NT was Unicode-based, so the Windows NT folks had to replace <code>CHAR</code> to <code>WCHAR</code>, and they had to create Unicode variants of the existing shell interfaces, which is why we have <code>IShellLinkA</code> and <code>IShellLinkW</code>, for example. This in turn exposed other problems, such as code that used <code>sizeof(stringBuffer)</code> to calculate the size of a <code>CHAR</code> string buffer, that now had to be changed to <code>sizeof(stringBuffer) / sizeof(stringBuffer[0])</code> so that it returned the number of elements in the buffer rather than the number of bytes.</p>
<p>Whereas the window manager changes were one-way ports (from Windows 95 into Windows NT), the Explorer and other user-mode changes were bidirectional. The Windows NT team merged their changes back into the Windows 95 code base, so that when they took the next drop of the Windows 95 code base, they wouldn’t have to go back and fix the things that they had already fixed.</p>
<p>Since the code went back to Windows 95, all of the Windows NT-side changes had to be arranged so that they would have no effect on the existing Windows 95 code. The Windows NT team didn’t want to introduce any bugs into the Windows 95 code as part of their port. Protecting the changes was done in a variety of ways.</p>
<p>One was to enclose all the new code inside <code>#ifdef WINNT</code> directives so that they weren’t compiled by Windows 95, or <code>#ifdef</code>…<code>#else</code>…<code>#endif</code> blocks if the Windows NT version had to diverge from the Windows 95 version. Another was to use macros and typedefs like <code>TCHAR</code> and <code>LPCTSTR</code> so that the same code could compile both as Windows 95 and Windows NT, but using different base characters.</p>
<p>In the case of <code>sizeof</code> directives, a change from <code>sizeof(stringBuffer)</code> to <code>sizeof(stringBuffer) / sizeof(stringBuffer[0])</code> has no effect on Windows 95 because the <code>sizeof(stringBuffer[0])</code> is 1, and dividing by 1 has no effect, so that change could be left without protection. But the Windows NT team had another problem: How would they know whether a particular <code>sizeof</code> was one that had already been vetted for Windows NT compatibility, as opposed to one that came from fresh code changes to Windows 95 that need to be inspected? Their solution was to define a synonym macro</p>
<pre>#define SIZEOF sizeof
</pre>
<p>When the Windows NT team verified that a <code>sizeof</code> was correct, or when they fixed it to be correct, they changed the <code>sizeof</code> to <code>SIZEOF</code>. That way, they could search the code for lowercase <code>sizeof</code> to see what still had yet to be inspected. (The Windows 95 team were told to continue using <code>sizeof</code> in new code, so as not to mess up this convention.)</p>
<p>Now, all this happened decades ago when Microsoft used an internal source code system known as SLM, pronounced <i>slime</i>. Formally, it stood for Source Library Manager, but nobody knew that. We just called it SLM. SLM did not support branches, so moving changes from Windows 95 to Windows NT involved manually doing three-way merges for all of the files that changed since the last drop. I suspect that this manual process was largely automated, but it was not as simple as a <tt>git merge</tt>.</p>
<p><b>Bonus chatter</b>: The team responsible for porting the Windows 95 shell to Windows NT included <a href="https://www.youtube.com/@DavesGarage"> Dave Plummer, host of the YouTube channel Dave’s Garage</a>. They had custom business cards made which they used as calling cards. On one side was the email aliases of the team members, arranged in an attractive pattern. On the other side was the simple message: “You have been visited.”</p>
        </div><!-- .entry-content -->

        <!-- AI Disclaimer -->
            </article>
    
</div></div>
  </body>
</html>
