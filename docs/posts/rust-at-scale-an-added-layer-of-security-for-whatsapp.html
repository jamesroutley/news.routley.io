<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://engineering.fb.com/2026/01/27/security/rust-at-scale-security-whatsapp/">Original</a>
    <h1>Rust at Scale: An Added Layer of Security for WhatsApp</h1>
    
    <div id="readability-page-1" class="page"><div>

		<ul>
<li aria-level="1"><span>WhatsApp has adopted and rolled out a new layer of security for users – built with Rust – as part of its effort to harden defenses against malware threats.</span></li>
<li aria-level="1"><span>WhatsApp’s experience creating and distributing our media consistency library in Rust to billions of devices and browsers proves Rust is production ready at a global scale.</span></li>
</ul>
<h2><span>Our Media Handling Strategy</span></h2>
<p><span>WhatsApp provides default end-to-end encryption for over 3 billion people to message securely each and every day. Online security is an adversarial space, and to continue ensuring users can keep messaging securely, we’re constantly adapting and evolving our strategy against cyber-security threats – all while supporting the WhatsApp infrastructure to help people connect. </span></p>
<p><span>For example, WhatsApp, like many other applications, allows users to share media and other types of documents. WhatsApp helps protect users by warning about dangerous attachments like APKs, yet rare and sophisticated malware could be hidden within a seemingly benign file like an image or video. These maliciously crafted files might target unpatched vulnerabilities in the operating system, libraries distributed by the operating system, or the application itself.</span></p>
<p><span>To help protect against such potential threads, WhatsApp is increasingly using the Rust programming language, including in our media sharing functionality. Rust is a memory safe language offering numerous security benefits. We believe that this is the largest rollout globally of any library written in Rust.</span></p>
<p><span>To help explain why and how we rolled this out, we should first look back at a key OS-level vulnerability that sent an important signal to WhatsApp around hardening media-sharing defenses.</span></p>
<h2>2015 Android Vulnerability: A Wake-up Call for Media File Protections</h2>
<p><span>In 2015, Android devices, and the applications that ran on them, became vulnerable to the “</span><a href="https://www.cisa.gov/news-events/alerts/2015/07/28/stagefright-android-vulnerability" target="_blank" rel="noopener"><span>Stagefright” vulnerability</span></a><span>. The bug lay in the processing of media files by operating system-provided libraries, so WhatsApp and other applications could not patch the underlying vulnerability. Because it could often take months for people to update to the latest version of their software, we set out to find solutions that would keep WhatsApp users safe, even in the event of an operating system vulnerability. </span></p>
<p><span>At that time, we realized that a cross-platform C++ library already developed by WhatsApp to send and consistently format MP4 files (called “wamedia”) could be modified to detect files which do not adhere to the MP4 standard and might trigger bugs in a vulnerable OS library on the receiver side – hence putting a target’s security at risk. We rolled out this check and were able to protect WhatsApp users from the Stagefright vulnerability much more rapidly than by depending on users to update the OS itself.</span></p>
<p><span>But because media checks run automatically on download and process untrusted inputs, we identified early on that wamedia was a prime candidate for using a memory safe language. </span></p>
<p><img decoding="async" src="https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg" alt="" width="2100" height="1250" srcset="https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg 2100w, https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg?resize=916,545 916w, https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg?resize=768,457 768w, https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg?resize=1024,610 1024w, https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg?resize=1536,914 1536w, https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg?resize=2048,1219 2048w, https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg?resize=96,57 96w, https://engineering.fb.com/wp-content/uploads/2026/01/Rust-at-scale_inline.jpg?resize=192,114 192w" sizes="(max-width: 992px) 100vw, 62vw"/></p>
<h2><span>Our Solution: Rust at Scale</span></h2>
<p><span>Rather than an incremental rewrite, we developed the Rust version of wamedia in parallel with the original C++ version. We used differential fuzzing and extensive integration and unit tests to ensure compatibility between the two implementations.</span></p>
<p><span>Two major hurdles were the initial binary size increase due to bringing in the Rust standard library and the build system support required for the diverse platforms supported by WhatsApp. WhatsApp made a long-term bet to build that support. In the end, we replaced 160,000 lines of C++ (excluding tests) with 90,000 lines of Rust (including tests). The Rust version showed performance and runtime memory usage advantages over the C++. Given this success, Rust was fully rolled out to all WhatsApp users and many platforms: Android, iOS, Mac, Web, Wearables, and more. With this positive evidence in hand, memory safe languages will play an ever increasing part in WhatsApp’s overall approach to application and user security.</span></p>
<p><span>Over time, we’ve added more checks for non-conformant structures within certain file types to help protect downstream libraries from parser differential exploit attempts. Additionally, we check higher risk file types, even if structurally conformant, for risk indicators. For instance, PDFs are often a vehicle for malware, and more specifically, the presence of embedded files and scripting elements within a PDF further raise risks. We also detect when one file type masquerades as another, through a spoofed extension or MIME type. Finally, we uniformly flag known dangerous file types, such as executables or applications, for special handling in the application UX. Altogether, we call this ensemble of checks “Kaleidoscope.” This system protects people on WhatsApp from potentially malicious unofficial clients and attachments. Although format checks will not stop every attack, this layer of defense helps mitigate many of them.</span></p>
<p><span>Each month, these libraries are distributed to billions of phones, laptops, desktops, watches, and browsers running on multiple operating systems for people on WhatsApp, Messenger, and Instagram. This is the largest ever deployment of Rust code to a diverse set of end-user platforms and products that we are aware of. Our experience speaks to the production-readiness and unique value proposition of Rust on the client-side.</span></p>
<h2>How Rust Fits In To WhatsApp’s Approach to App Security</h2>
<p><span>This is just one example of WhatsApp’s many investments in security. It’s why we built default end-to-end encryption for personal messages and calls, offer <a href="https://blog.whatsapp.com/end-to-end-encrypted-backups-on-whatsapp" target="_blank" rel="noopener">end-to-end encrypted </a></span><span>backups</span><span>, and use </span><a href="https://tech.facebook.com/engineering/2023/4/strengthening-whatsapp-end-to-end-encryption-key-transparency/" target="_blank" rel="noopener"><span>key transparency technology</span></a><span> to verify a secure connection, provide additional </span><a href="https://engineering.fb.com/2023/11/08/security/whatsapp-calls-enhancing-security/" target="_blank" rel="noopener"><span>calling protections</span></a><span>, and more.</span></p>
<p><span>WhatsApp has a strong track record of being loud when we find issues and working to hold bad actors accountable. For example, WhatsApp </span><a href="https://www.whatsapp.com/security/advisories" target="_blank" rel="noopener"><span>reports CVEs</span></a><span> for important issues we find in our applications, even if we do not find evidence of exploitation. We do this to give people on WhatsApp the best chance of protecting themselves by seeing a security advisory and updating quickly.</span></p>
<p><span>To ensure application security, we first must identify and quantify the sources of risk. We do this through internal and external audits like </span><a href="https://research.nccgroup.com/2021/10/27/public-report-whatsapp-end-to-end-encrypted-backups-security-assessment/" target="_blank" rel="noopener"><span>NCC Group’s public assessment</span></a><span> of WhatsApp’s end-to-end encrypted backups, fuzzing, </span><a href="https://engineering.fb.com/2021/10/20/security/static-analysis-award/" target="_blank" rel="noopener"><span>static analysis</span></a><span>, supply chain management, and automated attack surface analysis. We also recently expanded our </span><a href="https://bugbounty.meta.com/" target="_blank" rel="noopener"><span>Bug Bounty program</span></a><span> to introduce the </span><a href="https://bugbounty.meta.com/blog/15th-anniversary-2025/" target="_blank" rel="noopener"><span>WhatsApp Research Proxy</span></a><span> – a tool that makes research into WhatsApp’s network protocol more effective.</span></p>
<p><span>Next, we reduce the identified risk. Like many others in the industry, we found that the majority of the high severity vulnerabilities we published were due to memory safety issues in code written in the C and C++ programming languages. To combat this we invest in three parallel strategies:</span></p>
<ol>
<li><span>Design the product to minimize unnecessary attack surface exposure.</span></li>
<li><span>Invest in security assurance for the remaining C and C++ code.</span></li>
<li><span>Default the choice of memory safe languages, and not C and C++, for new code.</span></li>
</ol>
<p><span>WhatsApp has added protections like CFI, hardened memory allocators, safer buffer handling APIs, and more. C and C++ developers have specialized security training, development guidelines, and automated security analysis on their changes. We also have strict SLAs for fixing issues uncovered by the risk identification process.</span></p>
<h2><span>Accelerating Rust Adoption to Enhance Security</span></h2>
<p><span>Rust enabled WhatsApp’s security team to develop a secure, high performance, cross-platform library to ensure media shared on the platform is consistent and safe across devices. This is an important step forward in adding additional security behind the scenes for users and part of our ongoing defense-in-depth approach. Security teams at WhatsApp and Meta are highlighting opportunities for high impact adoption of Rust to interested teams, and we anticipate accelerating adoption of Rust over the coming years. </span></p>

		
	</div></div>
  </body>
</html>
