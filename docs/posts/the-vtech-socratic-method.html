<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.leadedsolder.com/2025/04/22/vtech-socrates-pickup.html">Original</a>
    <h1>The VTech Socratic Method</h1>
    
    <div id="readability-page-1" class="page"><article>
    <p>We’ve had a lot of fun with VTech’s computers in the past on this blog. Usually, they’re relatively spartan computers with limited functionality, but they did make something very interesting in the late 80s. The Socrates is their hybrid video game console/computer design from 1988, and today we’ll start tearing into it.</p>

<h2 id="checking-it-out">Checking it out</h2>
<p>These machines are oddly inexpensive and plentiful on eBay. I suspect that, like most “educational” computers, they made way too many of these, selling them very cheaply in anticipation of big sales of cartridges to make a constant influx of cash over time. The classic razor-and-blades model. As a result, retail stores were allowed to slash the prices on seasonal sales, which flooded the market. Most of the boxes I see on eBay have two or three price tags stuck on top of each other, indicating they were certainly not bought at full MSRP.</p>

<p>As you might expect for an eBay transaction, my Socrates showed up late, completely filthy, and in a heavily-damaged, too-big box. Luckily, the Socrates is built of some pretty thick plastic. I spent a lot of time rubbing it down with wet wipes and paper towels soaked in Windex. I was not hopeful that the keyboard worked, as the sticker on top was wavy, which indicated water damage to me.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-hero.jpg" alt="The Socrates, as it arrived."/></p>

<p>In photos, I thought the big blue thing was a power button. It turns out to be a window looking into an expansion bay with a male edge connector inside it:</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-dummy-expansion.jpg" alt="Pulling hard on the thing on the side has removed it, exposing an expansion slot with a window pointing into it."/></p>

<p>This is apparently where you put expansion devices, such as the voice module. We’ll talk about that in a bit.</p>

<p>The back of the system has <em>two</em> coaxial RF jacks. One is for “Antenna In,” and the other is for “RF Out.” I guess they decided this would be simpler for the end user than putting the switcher/tap outside the computer like most systems do. This isn’t going to last long.</p>

<h2 id="disassembly">Disassembly</h2>
<p>“Educational,” eh? The way I learn best is by taking things apart. That’s how I got kicked out of the military museum. And the grocery store.</p>

<p>This thing is held together by an insane number of screws! The top of the case has a crudely cut hole hidden under a sticker, just like the Precomputer did.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-top-removed.jpg" alt="The top case is removed, showing the massive amount of the case taken up by D-cell battery holders. There&#39;s wires running everywhere, some held on by masking tape, others with hot glue. A fragile-looking ribbon cable runs to the RF modulator in the back."/></p>

<p>Lots of hot glue and masking tape, too. I’d like to say this is the first computer I’ve taken apart that had masking tape in it, but <a href="https://www.leadedsolder.com/2022/10/09/pwp50ha-nec-mini5-word-processor-pickup.html">the NEC Bungo word processor had a bunch of it inside</a>, holding the broken plastics of the printer together. Let’s call this the first <em>factory</em> masking tape.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-hot-glue.jpg" alt="Hot glue is all over the wires running into the PCB."/></p>

<p>There’s a weird rusty spot under the tape for this keyboard-IR-receiver cap.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-ir-board-caps-rust.jpg" alt="There&#39;s a rusty spot under a &#34;KWC&#34; branded 22µF/16V through-hole capacitor."/></p>

<p>I don’t think these capacitors leaked, not at this angle, but boy is that rusty spot ever suspicious. Am I going to ESR-test these caps? Absolutely not. We got stuff to do.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-motherboard.jpg" alt="The motherboard is exposed."/></p>

<p>The motherboard is removed, showing that there really are not that many parts, which helps explain the low cost. Toshiba dominates as supplier, as they did with the VTech Precomputer when I looked into that a few years ago. You can see <a href="https://upload.wikimedia.org/wikipedia/commons/2/23/VTech-Socrates-Motherboard-Flat.jpg">a much better scan of the Socrates motherboard on Wikimedia</a>.</p>

<p>Key parts, from left to right:</p>
<ul>
  <li>VTech mask ROM. 32-pin, so likely 1Mbit;</li>
  <li>Zilog Z84C0004PSC or Toshiba TMPZ84C00AP CPU (CMOS Z80);</li>
  <li>Dense QFP gate array VTEL 27-0769, a Toshiba TC17G032AF;</li>
  <li>Multiple Toshiba TMM41464AP-12 64K x 4 DRAMs;</li>
  <li>Toshiba TMP42C40P1844 4-bit microcontroller, probably for IR decoding because of where it’s placed;</li>
  <li>A huge number of passives, some of which are probably a DAC for generating colour video and audio.</li>
</ul>

<p>It’s a shame that so much is integrated into that gate array, but this was an inexpensive machine and large-scale integration keeps costs way down.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-voice-cartridge-connector-montage.jpg" alt="The solder side and parts side of the Voice Cartridge edge connector. The parts side has no pins on it, just a solid blob of ground pour."/></p>

<p>Judging from the “24” on the edge connector, I expected the expansion port to be 24-pins. It’s 12 pins on the top of the console… and then a big blob of ground on the bottom. The motherboard PCB reveals that this connector goes “TO VOICE CARTRIDGE.” With so few pins, this is probably for simple I/O devices and unlikely to be useful as a full general-purpose expansion port, but you never know.</p>

<h2 id="av-mod">AV Mod</h2>
<p>Blog superfriend <a href="https://re-enthused.com/">Johnny Blanchard of Re-Enthused</a> had already designed an AV mod for this machine in the past, so I asked him about it. He assured me that it was a very simple design, and so I decided to make it much more complicated.</p>

<p>One of the admitted flaws in Mr. Blanchard’s design was that the video output was pretty dim. A little bit of amplification never hurt anyone, and for that, I went to my standby: the TI THS7374 video amp.</p>

<p>To power that video amp, I added a 5-volt surface-mount LDO after discovering the RF module usually receives unregulated 12V from the rest of the system. The THS7374 really wants 3.3 - 5V, and feeding it twelve volts will blow it up. I know this from experience.</p>

<p>Since I wanted to show off a little bit, I initially used an extremely tiny, inexpensive LDO. After sobering up, I realized it would be extremely annoying to hand-solder. A SOT223 LDO was chosen to replace it – it’s not like I don’t have the board room – and I did a test print for alignment in the case. Everything fit well, so I proceeded to fabrication.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-av-board-v2-bare.png" alt="A later version of the PCB, incorporating more caps for filtering, but the basics are there: an audio and a video jack, and input pins for the ribbon originally meant for the RF module."/></p>

<p>This PCB has all the hallmarks of being a really bad idea, from abusing commodity connectors in new ways to straight up using tape as a structural element.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-av-board-v1-assembled.jpg" alt="The PCB is assembled. Yellow and green wires run from the video and sound jacks to the PCB."/></p>

<p>Here are some of the many board-design crimes I committed here:</p>
<ol>
  <li>Panel-mount RCA connectors are threaded through the PCB, then their ground ring is soldered up against a pad.</li>
  <li>The threaded connectors started to come loose from the locking nut as I heated them up, so I soldered the connector’s body against the pad, too. Hey, it’s good enough for Apple… too bad this is very poor strain relief.</li>
  <li>To make contact with the PCB, the “signal” part of those connectors are connected to the rest of the system by a length of wire soldered onto a surface-mount pad in probably the most strain-prone (and RFI-prone) fashion imaginable. I did some of the worst soldering in my life on this. I heat-shrinked the connector to try and hide it, but just made things worse.</li>
  <li>I marked the resistor R2 as “optional,” but didn’t include in the instructions what it did. It is a pull-down for the input video, but it would have probably been more useful if I had included <em>two</em> optional footprints, for implementing a voltage divider.</li>
  <li>There’s no positive physical mount inside the case to hold this PCB in place, because it’s much thinner than the old RF module. To fix this, I wedged the PCB up against the back of the case with two-sided 3M tape, which probably won’t hold long-term and provides even worse strain relief. I think a smarter idea would have been to do heat-set nuts of some kind through the case plastic (which, again, is mondo thick) although it would have been a pain to align it with the PCB. Hot glue, RTV, or a 3D-printed alignment shim is also an option to “finalize” this mod once it’s proven itself.</li>
</ol>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-av-board-v1-taped.jpg" alt="The board is literally taped into the case."/></p>

<p>For my punishment, at least it was also very annoying to assemble. I made the RCA jack holes a little too big out of paranoia, so it was extra work to centre the thing while also trying to screw it down into a hole that was too big for the nut. Loctite would have helped a lot, except I only remembered that I had it after finishing soldering down both jacks.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-av-board-v1-ports.jpg" alt="The ports are sticking through."/></p>

<p>A ribbon cable carries all the power and video information from the rest of the machine to the RF modulator. RF modulators are chunky and like to sink heat in general. As a result, I had a tricky time desoldering the old ribbon. The ground pins (2 and 4) did not want to let go of their position, and pin 3 frayed badly when it was being removed. All the hot glue that was holding the cable in place on the RF shield started to melt as well, contaminating the solder and making one heck of a stink in my shop.</p>

<p>After it was freed, I spent quite a bit of time trying to reform pin 3 back into a shape that could go through the new PCB. That’s something that I should have anticipated, and used bigger holes and better pin spacing to make easier on myself.</p>

<p>At last, we had an AV mod ready. Now it was time to find out if this filthy, untested toy computer actually worked. I decided to completely skip putting a scope on this, and instead decided to send it directly into a television set.</p>

<h2 id="power-up">Power up</h2>
<p>The Socrates takes 12-volt centre-positive power, so I dug out the RCA universal power supply I’ve used for a couple of projects. VTech suggests that you feed this sucker with a 850mA-capable supply. 10W feels like a lot for a system that mostly consists of a Z80 and some ASICs, but I’m not one to make things harder for myself. I reached for the “2500mA”-capable (we’ve proven previously that it is not) RCA universal power supply and fished through my bucket of universal tips until I found one that fit tightly enough that it wasn’t going to fall out.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-composite-mod-title-1.jpg" alt="The Socrates title screen is fired up, with a robot staring into the wonders of space. Copyright 1988 Video Technology Electronics Ltd."/></p>

<p>The Samsung 910MP LCD TV is terrible at all composite video, so perhaps this wasn’t the best choice of testbed – it was hard to tell whether this ringing chroma is the system’s fault, my mod’s fault, or the TV set. That said, I’m not going to cry if the set explodes. And it didn’t explode, instead showing me this relatively decent-looking video. The audio was exceptionally loud and bleepy, which feels like it could do with a volume-limiting resistor or two. That can be someone else’s project.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-composite-mod-title-2.jpg" alt="The robot now says &#34;Let&#39;s Learn And Play Together!&#34; His(?) eyes light up in what could be interpreted as fear, as he slowly comes to realize who he now belongs to."/></p>

<p>Oh yes, little robot. We’re going to learn and play a whole lot more.</p>

<h2 id="actually-play-it">Actually Play It</h2>
<p>To use the computer, I’d have to put batteries into the weirdo keyboard/controller combo device. Socrates keyboards interact with the system using infrared, and only infrared.</p>

<p>To power the keyboard, you need to insert four 1.5V AA batteries in this highly unusual Tetris-like configuration:</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-keyboard-battery-arrangement.jpg" alt="The keyboard says that you need to insert three batteries into the bottom row, and just one battery into the top."/></p>

<p>Electrically, it doesn’t make a difference, but it feels sort of like the keyboard was designed by space aliens. This decision was probably actually made for packaging reasons. I hoped that the negative terminal deep inside the keyboard wasn’t corroded from ancient batteries, because I couldn’t see it from outside, and plunked in a set of four Amazon alkalines.</p>

<p>Initially, I assumed that the switch on the back of the keyboard turned it on and off. They wouldn’t add it for no good reason. However, the “transmitting data” light flickered whenever I pushed a key in either mode.</p>

<p>To help figure out the switch mystery, I decided to open the keyboard up and take a look inside. Beware! The keyboard has different screw lengths, probably to compensate for the uneven clamping force of the hollow case. Make sure to pay attention to which screw goes where.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-keyboard-pcb-backside.jpg" alt="The backside of the keyboard PCB, along with the two controllers stuck into it."/></p>

<p>Unfortunately, the inside of the keyboard has this fragile-looking membrane attached to the PCB. My bravery ran out. As far as I can tell, there is no way to turn the keyboard off when the system is not in use, and it probably <a href="https://blog.jgc.org/2024/02/repairing-sort-of-dyson-fan-remote.html">uses a capacitor to provide momentary power when a button is pushed</a>, just like a TV remote. You’ll definitely want to take the batteries out when you’re not using it.</p>

<p>I could not find any information online about what the switch on the keyboard PCB does, although I’m sure that the manual – which, as far as I can tell, hasn’t been scanned – must explain it. Perhaps it switches between two encodings of the data to make up for background interference from another IR source?</p>

<p>It wasn’t all a waste, though: I was able to push out the gummed-up and very dirty game pads from the back of the keyboard. They are very nasty, but still seem to work. Let’s try a game.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-gamepad-removed.jpg" alt="A gamepad comes loose from the keyboard. The cord is dark grey with dirt, and so is the face of the gamepad itself."/></p>

<h2 id="around-the-world-around-the-world">Around the World, Around the World</h2>
<p>As far as I can tell, the d-pad on the right controller is hard to press, and the d-pad on the left controller has an unfortunate bias towards diagonal motion. Still, I was able to wrangle it enough to start a game of <em>Around The World</em><sup id="fnref:ia-aworld" role="doc-noteref"><a href="#fn:ia-aworld" rel="footnote">1</a></sup>, a cartridge which contains many sub-games. You just have to sit through this seemingly unskippable title screen animation first, where a plane lands slowly and then the robot (named Socrates?) appears.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-around-the-world-title.jpg" alt="The title screen for &#34;Around the World.&#34; A robot stares lifelessly into your eyes as a copyright &#34;1989 Video Technology&#34; floats through the ether. An airport control tower sits in the background."/></p>

<p>I gave a couple of the modes a try. There’s one where you guess which continent various hand-drawn replicas of landmarks are, which I didn’t do well on. For some reason, it seems to have a strong bias towards Australian monuments.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-country-guesser.jpg" alt="The game asks &#34;Hindi is the official language of:&#34; and I have selected India from a map, because I know where India is. The game responds &#34;Yes, India.&#34;"/></p>

<p>I did much better at this general-purpose country quiz, where it asked you to figure out which country is involved in a factoid and then click on it with the d-pad. Often, I knew the country but could not find out which blurry squiggle it was on the map. I wonder how much of this game has changed since 1988, what with the collapse of the Soviet Union and all.</p>

<p>Maybe if I had grown up with this game, I’d be a United Nations diplomat now. I bet they can afford <em>really good</em> old computers. Good news for you, though: absolutely nobody pays me for diplomacy.</p>

<p>Let’s move on to cracking this cartridge open and figuring out how it works.</p>

<h2 id="pirate-cartridge">Pirate Cartridge</h2>
<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-floppy-cartridge.jpg" alt="A plastic cartridge, shaped like a floppy disk, reads &#34;For use with Socrates Educational Video System. AWARENESS, Ages 7 and Up, Around The World: An Adventure in World Geography, copyright 1989 Video Technology&#34;"/></p>

<p>When opening the charmingly floppy-disk-shaped cartridge, the first thing I saw was… another RF shield. They were really paranoid about it if they were trying to insulate a mask ROM from producing unwanted interference.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-cartridge-opened.jpg" alt="The RF shield is on top of the board."/></p>

<p>When the RF shield is removed, the ROM is exposed. Like most other VTech products we’ve featured in the past, this is a Toshiba TC531xxx 1Mbit mask ROM. We know <a href="https://www.leadedsolder.com/2021/11/02/vtech-precomputer-1000.html">how to dump these ROMs from the VTech Precomputer exploration</a>, but MAME already contains this ROM, and I don’t feel like desoldering it right now.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-cartridge-opened-top.jpg" alt="A mask ROM IC and one solitary capacitor are exposed. The part number is VTECH 23-5013-00-0, the Toshiba part is TC531000CP-L318. Date code 89/18, made in Japan."/></p>

<p>The underside of the cartridge PCB provides no surprises: a 36-pin edge connector. It does seem like the PCB left some holes for an even larger ROM in the future, which is a little unusual of a way to do it, but indicates to me that VTech had larger plans for the Socrates and wanted to save on PCB spins. Just like they did on the Precomputer, being able to reuse a PCB for more than one design means that they can save by buying in bulk.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-cartridge-opened-bottom.jpg" alt="The underside of the cartridge PCB."/></p>

<p>I spent a half-hour taking measurements of the shell and PCB using a cheap digital caliper. Then I set about buzzing out the cartridge, using the known pinout of the ROM to guess what each pin on the edge connector did.</p>

<p>Unlike <a href="https://www.leadedsolder.com/2021/11/02/vtech-precomputer-1000.html">the Precomputer</a>, I’m not looking to fully decode the cartridge slot, but just to get some software running on the system. Someone else is welcome to figure out all the control signals and build expansion hardware for the cartridge slot in the future.</p>

<table>
  <thead>
    <tr>
      <th>Pin</th>
      <th>Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Ground</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <td>6</td>
      <td>D2</td>
    </tr>
    <tr>
      <td>7</td>
      <td>D1</td>
    </tr>
    <tr>
      <td>8</td>
      <td>D0</td>
    </tr>
    <tr>
      <td>9</td>
      <td>A0</td>
    </tr>
    <tr>
      <td>10</td>
      <td>A1</td>
    </tr>
    <tr>
      <td>11</td>
      <td>A10</td>
    </tr>
    <tr>
      <td>12</td>
      <td>A4</td>
    </tr>
    <tr>
      <td>13</td>
      <td>A5</td>
    </tr>
    <tr>
      <td>14</td>
      <td>A6</td>
    </tr>
    <tr>
      <td>15</td>
      <td>A7</td>
    </tr>
    <tr>
      <td>16</td>
      <td>A12</td>
    </tr>
    <tr>
      <td>17</td>
      <td>A16</td>
    </tr>
    <tr>
      <td>18</td>
      <td>+5V</td>
    </tr>
    <tr>
      <td>19</td>
      <td>A15</td>
    </tr>
    <tr>
      <td>20</td>
      <td>A14</td>
    </tr>
    <tr>
      <td>21</td>
      <td>A13</td>
    </tr>
    <tr>
      <td>22</td>
      <td>A8</td>
    </tr>
    <tr>
      <td>23</td>
      <td>A9</td>
    </tr>
    <tr>
      <td>24</td>
      <td>A11</td>
    </tr>
    <tr>
      <td>25</td>
      <td>A3</td>
    </tr>
    <tr>
      <td>26</td>
      <td>A2</td>
    </tr>
    <tr>
      <td>27</td>
      <td>D7</td>
    </tr>
    <tr>
      <td>28</td>
      <td>D6</td>
    </tr>
    <tr>
      <td>29</td>
      <td>D5</td>
    </tr>
    <tr>
      <td>30</td>
      <td>D4</td>
    </tr>
    <tr>
      <td>31</td>
      <td>D3</td>
    </tr>
    <tr>
      <td>32</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <td>33</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <td>34</td>
      <td>Unknown</td>
    </tr>
    <tr>
      <td>35</td>
      <td><span><code>ROM_CE</code></span></td>
    </tr>
    <tr>
      <td>36</td>
      <td>Unknown</td>
    </tr>
  </tbody>
</table>

<p>This pinout is very similar to the Precomputer, which is entirely reasonable. I’ll update this pinout later if I find out more information. Note that <strong>this pinout is untested</strong> as a result.</p>

<p>Before I sent away to have a cartridge made, I decided I would at least try to get my own code running in the emulator first.</p>

<h2 id="pulling-apart-the-cartridges-brains">Pulling Apart the Cartridge’s Brains</h2>
<p>It looked as if <em>Around the World</em> was already dumped in MAME; the <a href="http://adb.arcadeitalia.net/dettaglio_mess.php?software_name=aworld&amp;software_list=socrates&amp;search_id=2">Arcade Italia site had a listing for it</a>, and you could play it on the Internet Archive. I had to dig around for awhile to find it; it turns out it’s not a ROM, it’s in the “Software List.” It was listed as <code>27-5013-00-0.u1</code> in the <code>aworld.zip</code> bundle, rolls right off the tongue.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-mame-aworld.png" alt="Around the World, booting in MAME."/></p>

<p>I ran all the ROMs against <code>vbindiff</code>, trying to find commonalities in their header bytes. My hope was that I’d find some fixed signature that would tell the Socrates that a cartridge is installed, and where to jump into the code at. I found that all of the ROMs had identical bytes at position 0 and 2 (<span>$c3 </span> and <span>$40 </span>, respectively.) What about the byte in between? I had no idea…</p>

<p>By reading the MAME driver, I was able to determine that cartridges are mapped into the memory between <span>$4000 </span> and <span>$7fff </span>. This memory is, of course, bank switched, because we already know that cartridges are at least as big as 1Mbit. I opened the cartridge ROMs in MAME, running the debugger with my traditional watchpoint instruction:</p>

<div><div><pre><code>wpset 4000, 3fff, r, 1, { printf &#34;Read cart at %08x =&gt; %08x\n&#34;, wpaddr, wpdata; g }
</code></pre></div></div>

<p>This produced a big spam log of every time the emulator tried to hit the cartridge. From this trace, I found out that all the cartridges acted identically up to a point:</p>

<table>
  <thead>
    <tr>
      <th>Address</th>
      <th>Reads out…</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><span>$7ff0 </span></td>
      <td><span>$aa </span></td>
    </tr>
    <tr>
      <td><span>$7ff1 </span></td>
      <td><span>$55 </span></td>
    </tr>
    <tr>
      <td><span>$7ff2 </span></td>
      <td><span>$e7 </span></td>
    </tr>
    <tr>
      <td><span>$7ff3 </span></td>
      <td><span>$18 </span></td>
    </tr>
    <tr>
      <td><span>$4000 </span></td>
      <td><span>$c3 </span></td>
    </tr>
    <tr>
      <td><span>$4001 </span></td>
      <td>Varies, more below</td>
    </tr>
    <tr>
      <td><span>$4002 </span></td>
      <td><span>$40 </span></td>
    </tr>
  </tbody>
</table>

<p>So we know that the first four bytes read are some kind of signature. <span>$aa </span> and <span>$55 </span> are common sentinel bytes for “a device is actually at this address,” because their binary encoding is alternating ones and zeroes. Same goes for <span>$e7 </span> and <span>$18 </span>, which are the complement of each other. This is less a “signature” and more a check that the data bus coming off the cartridge is reliable, which would indicate that a ROM is attached. I do love how practical the VTech engineers tend to be.</p>

<p>After confirming the presence of a cartridge, the emulator would jump to reading from the cartridge at the <em>offset</em> defined by position <span>$4001 </span>. For instance, if that byte read <span>$e7 </span>, it would then start reading in more data from <span>$40e7 </span>.</p>

<p>I wasn’t sure if that meant it was <em>executing code</em> at those positions, or just reading in more header info, so I amended my watchpoint to include the program counter:</p>

<div><div><pre><code>wpset 4000, 3fff, r, 1, { printf &#34;PC = %08x: Read cart at %08x =&gt; %08x\n&#34;, pc, wpaddr, wpdata; g }
</code></pre></div></div>

<p>Once I did this, I found out that after reading the higher-memory values, the computer has already jumped to <span>$4000 </span>… <span>$c3 </span> is <a href="https://clrhome.org/table/">the Z80 opcode for unconditional jump</a>, <code>JP nn</code>, which also explains the <span>$40 </span> as that would form the upper byte of the target address. I really gotta memorize these things.</p>

<p>So now we know how to make the Socrates run Z80 code from a cartridge. How do we build something for it? My first step was to try and figure out if the BIOS had some helper function for printing a string. A lot of the carts had what looked like sane ASCII strings in their ROMs, so I assumed that there was some kind of call that could be made to print them to the screen.</p>

<p>It seemed that strings were prefixed with their length, like in Pascal, so “SELECT AN ACTIVITY” would first have the byte <span>$12 </span>.</p>

<h2 id="finding-printf">Finding Printf</h2>
<p>Since I did this before I knew about <a href="https://docs.mamedev.org/luascript/index.html">the complex Lua scripting available in MAME</a>, I found it very annoying to keep up with the page switching using just the debugger. Maybe there is an easy way to map “virtual” addresses to “real” ones right inside the debugger, but I have yet to figure it out.</p>

<p>After trying a few different ROMs until I could find one where the page-switching aperture was “just right” to have both the string and the BIOS calls mapped in at the same time, I figured out that the print routine seems to use <span>$0d </span> as a terminator on strings. 27-5045 (“State to State”) has a couple strings very early on, looks like starting at <span>$0d0 </span> offset.</p>

<p>I managed to figure out that the callsite that left the ROM and entered the BIOS before printing to the screen was at <span>$2080 </span>, so I wrote down in my little table that <span>$2080 </span> was probably their equivalent of printf. But I still didn’t know where the XY location was, or how the string was passed to it.</p>

<p>For the string pointer, I noticed that before calling into <span>$2080 </span>, the calling code was writing the string into a buffer at <span>$f040 </span>. I decided to breakpoint at the entry to <span>$2080 </span>, and then use MAME’s memory viewer to edit the string at <span>$f040 </span> before letting it continue. That worked:</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-subverted-f080.png" alt="The title screen to &#34;State to State&#34; now says copyright 1989 Hellorld."/></p>

<p>Eventually, I was able to trap some code at <span>$43e8 </span> that was trying to read the string length, and then using <code>ldir</code> to fill an internal buffer with the contents of the string. The sentinel <span>$0d </span> was indeed used as the terminator for the filling of the buffer, which makes me wonder why they had the length at all.</p>

<p>By working backward in the listing, I determined that a pointer to <span>$f0a9 </span> was somehow involved. Its content got written immediately before the call to <span>$2080 </span>. Normally, that value is is <span>$c84a </span>. I set a breakpoint right before it was written and changed the value of the register feeding into it. My first attempt was to change it to <span>$c000 </span>, which made the string appear at the far left of the screen.</p>

<p><img src="https://www.leadedsolder.com/assets/vtech-socrates-subverted-f0a9.png" alt="After tweaking f0a9 to the value $4444, the &#34;Video Technology&#34; string is now printed in the middle of the screen."/></p>

<p>After some more tweaking, I figured out that <span>$4444 </span> sets it to roughly the centre of the screen. It seems to be “the pixel address for the top left of the string.” On top of that, it seemed like the string’s colour is based on some sort of tile-based palette, as moving the black string out of the bottom row of the screen turned it white.</p>

<h2 id="writing-code-finally">Writing Code, Finally</h2>
<p>With this information, it seemed possible to now build a hello world cartridge. I fired up my favoured z80 assembler, <a href="https://k1.spdns.de/Develop/Projects/zasm/Distributions/">zasm</a>, and wrote a quick program to test my theories.</p>

<p>Unfortunately, the program only sorta worked. The emulated Socrates did indeed load the header and jump into running code, but there was bizarre corruption in the cartridge that was loaded into memory.</p>

<p>If I open the MAME memory viewer, you can see what’s happening here.</p>

<p><img src="https://www.leadedsolder.com/assets/socrates-0x4000-at-power-up.png" alt="At startup, the cartridge space has a bunch of stuff in it."/></p>

<p>At the system startup, there is a bunch of stuff loaded into the <span>$4000 </span> to <span>$7fff </span> range of memory that is supposed to be occupied by the cartridge.</p>

<p><img src="https://www.leadedsolder.com/assets/socrates-0x4000-at-cart-start.png" alt="By $4000, the cartridge space has different stuff in it, but mostly nonsense."/></p>

<p>By the time I get to my cartridge’s entry point (remember, only the above four bytes have been read from the cartridge ROM by this point) it now looks completely different, but only the first couple of bytes actually look like my program:</p>

<p><img src="https://www.leadedsolder.com/assets/socrates-0x4000-at-the-start-of-my-cart.png" alt="My actual program starts with c3 03 40 31 but that&#39;s the only overlap between what MAME thinks is there and what&#39;s in the ROM file."/></p>

<p>There’s a lot of <span>$c3 </span> and <span>$03 </span> nonsense in here, which seems to echo the start of the ROM. What’s going on?</p>

<p>I took a wild guess and looked at all the other ROMs. <span>$c9 </span> always followed the four bytes that were read from the ROM, but I would have expected MAME to catch that if it was important. Still, I added it anyway, and… that made things even worse as now the cartridge wouldn’t even load.</p>

<p>Confused, I decided to try and pad it out using the zasm <code>.org</code> pseudo. I ended up with a 64K ROM, which is not as large as the retail games’ 128kB ROMs. Now my code loaded completely into MAME and looked right. I’m not sure if this is a bug in MAME, an oddity of the Socrates page-switcher, or a bug in the Socrates BIOS itself, but it was definitely spooky stuff for a bit there, and it set me back for a few days. Let’s move on.</p>

<p>My next step was to change the volume levels for ch1 and ch2, as both of them are set to uninitialized SN76489 hum when the system starts up. This just took a write to <span>$12 </span> and <span>$13 </span>, as indicated in the MAME driver. Thanks, MAME driver!</p>

<p>Now, it was time to try and clear the screen, and then print a message. Figuring out where to call to print a message was easy, because we could watch for a string getting loaded. But if I just called the <span>$2080 </span> routine, I didn’t see anything change on the screen (except for the occasional couple pixels of lime green, that may have even been uninitialized memory.) More stepping through retail carts would be required. For now, I decided to focus on filling the screen with a colour and leave printing for later.</p>

<p>After some more poking, I realized that a lot of carts were setting the RAM page switching mode <span>$04 </span> and then writing to <span>$8000 </span> to <span>$ffff </span> to fill the screen. That write spans two pages (<span>$7fff </span> bytes), which made sense to me, so I cargo culted it.</p>

<p><img src="https://www.leadedsolder.com/assets/socrates-framebuffer-two-page-write.png" alt="The top half of the screen is yellow, and the bottom third or so is pink."/></p>

<p>One annoying thing is that the pages do not end on a clean row boundary. You can see that the pink starts partway through a line that is otherwise entirely yellow. That’s very annoying, but it shouldn’t be noticeable for a solid colour fill.</p>

<p>I noticed at this point that it wasn’t exactly “half” on each page, which makes sense as many of the BIOS functions seem to depend on globals and buffers above <span>$f000 </span>, even in this page mode.</p>

<h2 id="printing-education">Printing Education</h2>
<p>I was wondering where the font came from, as well. At first I assumed it was the BIOS, but as time went on I began to wonder if the ROM was being accessed to fetch it. I broke in the print routine, set a watch for anything in the cartridge range, and then stepped out of the print routine, letting it run to completion. A <em>lot</em> of reads from the cartridge were made, mostly in the range from <span>$7b26 </span> onward, which seemed mysterious.</p>

<p>I wrote a quick tool to pop open the ROM and take a peek at it to try and understand if there really was font data stored here. The font characters I’d been seeing were, at the widest, about 7 pixels tall by about 5 pixels wide, which is not an especially convenient format for a byte-based system. I assumed they had to have some padding.</p>

<p>I ran this same test against my own ROM and found that it was taking wild pointers into my cartridge space to, I assumed, do the same thing. Lots of calls to <code>ldir</code> from strange <span>$f000 </span>-onward pointers. So there’s <em>something</em> in the user area that tells the print routine where to look for a font, and I had missed the part of the official cartridges that sets it.</p>

<p>Unfortunately, I kept getting turned around trying to figure out where things were, and after a couple days of beating my head against it, I abandoned the project of “getting printf to work” for now. I would say that being able to write pixels to the screen is a good enough achievement for now.</p>

<h2 id="conclusion">Conclusion</h2>
<p>So we’ve managed to pick up an arbitrary educational computer off the side of the road, figure out its ROM pinout, make a composite mod for it, and draw pixels to the screen. Why am I still feeling dissatisfied? It’s because I don’t have printf working still.</p>

<p>Now that MAME has landed the Lua debugging tools, I plan to write some more functionality to help me figure out exactly what’s going on inside the Socrates BIOS, and how to call their print functions. Ideally, I would also like to build an ATTiny88-based flash cart for the system, so you could push code from a real computer for development.</p>

<p>Is the Socrates a cool system? I would say so: it’s not every day that you see a company build their own video logic, and it’s a good stepping stone for me to figure out just what was going on in the 90s.</p>

<h2 id="downloads">Downloads</h2>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Link</th>
      <th>Remarks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>VTech Socrates composite video/AV mod board</td>
      <td><a href="https://github.com/leaded-solder/vtech-socrates-av-mod">leaded-solder/vtech-socrates-av-mod</a></td>
      <td> </td>
    </tr>
    <tr>
      <td>VTech Socrates flash cartridge</td>
      <td>TBD</td>
      <td>Contact me if you want to test and debug this</td>
    </tr>
  </tbody>
</table>


  </article></div>
  </body>
</html>
