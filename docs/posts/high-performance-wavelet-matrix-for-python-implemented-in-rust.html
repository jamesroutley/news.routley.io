<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://pypi.org/project/wavelet-matrix/">Original</a>
    <h1>Show HN: High-Performance Wavelet Matrix for Python, Implemented in Rust</h1>
    
    <div id="readability-page-1" class="page"><div>
<p><a href="https://github.com/math-hiyoko/wavelet-matrix/actions/workflows/CI.yml" rel="nofollow"><img src="https://pypi-camo.freetls.fastly.net/e045d1e0810360f20189c0f8a606505ac197f352/68747470733a2f2f6769746875622e636f6d2f6d6174682d6869796f6b6f2f776176656c65742d6d61747269782f616374696f6e732f776f726b666c6f77732f43492e796d6c2f62616467652e7376673f6272616e63683d6d61696e" alt="CI"/></a>
<a href="https://codecov.io/gh/math-hiyoko/wavelet-matrix" rel="nofollow"><img src="https://pypi-camo.freetls.fastly.net/1affcb1124708306b5ba705d3e8ba560b827e0ce/68747470733a2f2f636f6465636f762e696f2f67682f6d6174682d6869796f6b6f2f776176656c65742d6d61747269782f67726170682f62616467652e7376673f746f6b656e3d54584252374d46324350" alt="codecov"/></a>
<img src="https://pypi-camo.freetls.fastly.net/e0913b5a440cd4a854debddda46bf530458177f6/68747470733a2f2f696d672e736869656c64732e696f2f707970692f762f776176656c65742d6d6174726978" alt="PyPI - Version"/>
<img src="https://pypi-camo.freetls.fastly.net/f44a05a3dae4e2a39726d2de5849220b95826d52/68747470733a2f2f696d672e736869656c64732e696f2f707970692f6c2f776176656c65742d6d6174726978" alt="PyPI - License"/>
<img src="https://pypi-camo.freetls.fastly.net/835ba3e2c4afcc7db5ae53f1c5d0983378e811b1/68747470733a2f2f696d672e736869656c64732e696f2f707970692f707976657273696f6e732f776176656c65742d6d6174726978" alt="PyPI - PythonVersion"/>
<img src="https://pypi-camo.freetls.fastly.net/525c1e1bc7c4846dc2346e514af06b6e1b4010fa/68747470733a2f2f696d672e736869656c64732e696f2f707970692f696d706c656d656e746174696f6e2f776176656c65742d6d6174726978" alt="PyPI - Implementation"/>
<img src="https://pypi-camo.freetls.fastly.net/f09edf2f9434f3e810a9e65836469f3f17ce8985/68747470733a2f2f696d672e736869656c64732e696f2f707970692f74797065732f776176656c65742d6d6174726978" alt="PyPI - Types"/>
<a href="https://pypistats.org/packages/wavelet-matrix" rel="nofollow"><img src="https://pypi-camo.freetls.fastly.net/5836e8f3db80156b3612f284181d1c0eaeafab12/68747470733a2f2f696d672e736869656c64732e696f2f707970692f646d2f776176656c65742d6d61747269783f6c6162656c3d50795049253230646f776e6c6f616473" alt="PyPI - Downloads"/></a>
<img src="https://pypi-camo.freetls.fastly.net/e8780910335f10d6c40e418fe910e6c711c71eba/68747470733a2f2f696d672e736869656c64732e696f2f707970692f666f726d61742f776176656c65742d6d6174726978" alt="PyPI - Format"/>
<img src="https://pypi-camo.freetls.fastly.net/436779fd226959885f9e49a067ed5aac503bd943/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f706f776572656425323062792d527573742d6f72616e6765" alt="Rust"/></p>
<p>High-performance indexed sequence structure powered by Rust, supporting fast rank/select and range queries with optional dynamic updates.</p>
<ul>
<li>PyPI: <a href="https://pypi.org/project/wavelet-matrix" rel="nofollow">https://pypi.org/project/wavelet-matrix</a></li>
<li>Document: <a href="https://math-hiyoko.github.io/wavelet-matrix" rel="nofollow">https://math-hiyoko.github.io/wavelet-matrix</a></li>
<li>Repository: <a href="https://github.com/math-hiyoko/wavelet-matrix" rel="nofollow">https://github.com/math-hiyoko/wavelet-matrix</a></li>
</ul>
<h2>Quick Start</h2>
<pre lang="bash">$<span> </span>pip<span> </span>install<span> </span>wavelet-matrix
</pre>
<h3>WaveletMatrix</h3>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span>from</span><span> </span><span>wavelet_matrix</span><span> </span><span>import</span> <span>WaveletMatrix</span>
<span>&gt;&gt;&gt;</span>
<span>&gt;&gt;&gt;</span> <span># Create a WaveletMatrix</span>
<span>&gt;&gt;&gt;</span> <span>data</span> <span>=</span> <span>[</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>]</span>
<span>&gt;&gt;&gt;</span> <span>wm</span> <span>=</span> <span>WaveletMatrix</span><span>(</span><span>data</span><span>)</span>
<span>&gt;&gt;&gt;</span> <span>wm</span>
<span>WaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>])</span>
</pre>
<h4>Count occurrences (rank)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># Count of 5 in the range [0, 9)</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>rank</span><span>(</span><span>value</span><span>=</span><span>5</span><span>,</span> <span>end</span><span>=</span><span>9</span><span>)</span>
<span>4</span>
</pre>
<h4>Find position (select)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># Find the index of 4th occurrence of value 5</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>select</span><span>(</span><span>value</span><span>=</span><span>5</span><span>,</span> <span>kth</span><span>=</span><span>4</span><span>)</span>
<span>6</span>
</pre>
<h4>Find k-th smallest (quantile)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># Find 8th smallest value in the range [2, 12)</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>quantile</span><span>(</span><span>start</span><span>=</span><span>2</span><span>,</span> <span>end</span><span>=</span><span>12</span><span>,</span> <span>kth</span><span>=</span><span>8</span><span>)</span>
<span>5</span>
</pre>
<h4>List top-k highest frequent values (topk)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># List values in [1, 10) with the top-2 highest frequencies.</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>topk</span><span>(</span><span>start</span><span>=</span><span>1</span><span>,</span> <span>end</span><span>=</span><span>10</span><span>,</span> <span>k</span><span>=</span><span>2</span><span>)</span>
<span>[{</span><span>&#39;value&#39;</span><span>:</span> <span>5</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>3</span><span>},</span> <span>{</span><span>&#39;value&#39;</span><span>:</span> <span>1</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>2</span><span>}]</span>
</pre>
<h4>Sum values in a range (range_sum)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># Sum of elements in the range [2, 8).</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>range_sum</span><span>(</span><span>start</span><span>=</span><span>2</span><span>,</span> <span>end</span><span>=</span><span>8</span><span>)</span>
<span>24</span>
</pre>
<h4>List intersection of two ranges (range_intersection)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># List the intersection of two ranges [0, 6) and [6, 11).</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>range_intersection</span><span>(</span><span>start1</span><span>=</span><span>0</span><span>,</span> <span>end1</span><span>=</span><span>6</span><span>,</span> <span>start2</span><span>=</span><span>6</span><span>,</span> <span>end2</span><span>=</span><span>11</span><span>)</span>
<span>[{</span><span>&#39;value&#39;</span><span>:</span> <span>1</span><span>,</span> <span>&#39;count1&#39;</span><span>:</span> <span>1</span><span>,</span> <span>&#39;count2&#39;</span><span>:</span> <span>1</span><span>},</span> <span>{</span><span>&#39;value&#39;</span><span>:</span> <span>5</span><span>,</span> <span>&#39;count1&#39;</span><span>:</span> <span>3</span><span>,</span> <span>&#39;count2&#39;</span><span>:</span> <span>2</span><span>}]</span>
</pre>
<h4>Count values in a range (range_freq)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># Count values c in the range [1, 9) such that 4 &lt;= c &lt; 6.</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>range_freq</span><span>(</span><span>start</span><span>=</span><span>1</span><span>,</span> <span>end</span><span>=</span><span>9</span><span>,</span> <span>lower</span><span>=</span><span>4</span><span>,</span> <span>upper</span><span>=</span><span>6</span><span>)</span>
<span>4</span>
</pre>
<h4>List values in a range (range_list)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># List values c in the range [1, 9) such that 4 &lt;= c &lt; 6.</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>range_list</span><span>(</span><span>start</span><span>=</span><span>1</span><span>,</span> <span>end</span><span>=</span><span>9</span><span>,</span> <span>lower</span><span>=</span><span>4</span><span>,</span> <span>upper</span><span>=</span><span>6</span><span>)</span>
<span>[{</span><span>&#39;value&#39;</span><span>:</span> <span>4</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>1</span><span>},</span> <span>{</span><span>&#39;value&#39;</span><span>:</span> <span>5</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>3</span><span>}]</span>
</pre>
<h4>List top-k maximum values (range_maxk)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># List values in [1, 9) with the top-2 maximum values.</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>range_maxk</span><span>(</span><span>start</span><span>=</span><span>1</span><span>,</span> <span>end</span><span>=</span><span>9</span><span>,</span> <span>k</span><span>=</span><span>2</span><span>)</span>
<span>[{</span><span>&#39;value&#39;</span><span>:</span> <span>6</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>1</span><span>},</span> <span>{</span><span>&#39;value&#39;</span><span>:</span> <span>5</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>3</span><span>}]</span>
</pre>
<h4>List top-k minimum values (range_mink)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># List values in [1, 9) with the top-2 minimum values.</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>range_mink</span><span>(</span><span>start</span><span>=</span><span>1</span><span>,</span> <span>end</span><span>=</span><span>9</span><span>,</span> <span>k</span><span>=</span><span>2</span><span>)</span>
<span>[{</span><span>&#39;value&#39;</span><span>:</span> <span>1</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>2</span><span>},</span> <span>{</span><span>&#39;value&#39;</span><span>:</span> <span>2</span><span>,</span> <span>&#39;count&#39;</span><span>:</span> <span>1</span><span>}]</span>
</pre>
<h4>Get the maximun value (prev_value)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># Get the maximum value c in the range [1, 9) such that c &lt; 7.</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>prev_value</span><span>(</span><span>start</span><span>=</span><span>1</span><span>,</span> <span>end</span><span>=</span><span>9</span><span>,</span> <span>upper</span><span>=</span><span>7</span><span>)</span>
<span>6</span>
</pre>
<h4>Get the minimun value (next_value)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span># Get the minimum value c in the range [1, 9) such that 4 &lt;= c.</span>
<span>&gt;&gt;&gt;</span> <span>wm</span><span>.</span><span>next_value</span><span>(</span><span>start</span><span>=</span><span>1</span><span>,</span> <span>end</span><span>=</span><span>9</span><span>,</span> <span>lower</span><span>=</span><span>4</span><span>)</span>
<span>4</span>
</pre>
<h3>Dynamic Wavelet Matrix</h3>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span>from</span><span> </span><span>wavelet_matrix</span><span> </span><span>import</span> <span>DynamicWaveletMatrix</span>
<span>&gt;&gt;&gt;</span>
<span>&gt;&gt;&gt;</span> <span># Create a DynamicWaveletMatrix</span>
<span>&gt;&gt;&gt;</span> <span># max_bit sets the maximum bit-width of stored values (auto-inferred if omitted).</span>
<span>&gt;&gt;&gt;</span> <span>data</span> <span>=</span> <span>[</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>]</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span> <span>=</span> <span>DynamicWaveletMatrix</span><span>(</span><span>data</span><span>,</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span>
<span>DynamicWaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>],</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
</pre>
<h4>Insert value (insert)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span>dwm</span>
<span>DynamicWaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>],</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
<span>&gt;&gt;&gt;</span> <span># Inserts 8 at index 4.</span>
<span>&gt;&gt;&gt;</span> <span># The bit width of the new value must not exceed max_bit.</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span><span>.</span><span>insert</span><span>(</span><span>index</span><span>=</span><span>4</span><span>,</span> <span>value</span><span>=</span><span>8</span><span>)</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span>
<span>DynamicWaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>8</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>],</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
</pre>
<h4>Remove value (remove)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span>dwm</span>
<span>DynamicWaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>8</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>],</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
<span>&gt;&gt;&gt;</span> <span># Remove the value at index 4.</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span><span>.</span><span>remove</span><span>(</span><span>index</span><span>=</span><span>4</span><span>)</span>
<span>8</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span>
<span>DynamicWaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>],</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
</pre>
<h4>Update value (update)</h4>
<pre lang="python3"><span>&gt;&gt;&gt;</span> <span>dwm</span>
<span>DynamicWaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>2</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>],</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
<span>&gt;&gt;&gt;</span> <span># Update the value at index 4 to 5</span>
<span>&gt;&gt;&gt;</span> <span># The bit width of the new value must not exceed max_bit.</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span><span>.</span><span>update</span><span>(</span><span>index</span><span>=</span><span>4</span><span>,</span> <span>value</span><span>=</span><span>5</span><span>)</span>
<span>2</span>
<span>&gt;&gt;&gt;</span> <span>dwm</span>
<span>DynamicWaveletMatrix</span><span>([</span><span>5</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>5</span><span>,</span> <span>1</span><span>,</span> <span>5</span><span>,</span> <span>6</span><span>,</span> <span>1</span><span>,</span> <span>3</span><span>,</span> <span>5</span><span>,</span> <span>0</span><span>],</span> <span>max_bit</span><span>=</span><span>4</span><span>)</span>
</pre>
<h2>Development</h2>
<h3>Running Tests</h3>
<pre lang="bash">$<span> </span>pip<span> </span>install<span> </span>-e<span> </span><span>&#34;.[dev]&#34;</span>

<span># Cargo test</span>
$<span> </span>cargo<span> </span><span>test</span><span> </span>--all<span> </span>--release

<span># Run tests</span>
$<span> </span>pytest<span> </span>--benchmark-skip

<span># Run benchmarks</span>
$<span> </span>pytest<span> </span>--benchmark-only
</pre>
<h3>Formating Code</h3>
<pre lang="bash"><span># Format Rust code</span>
$<span> </span>cargo<span> </span>fmt

<span># Format Python code</span>
$<span> </span>ruff<span> </span>format
</pre>
<h3>Generating Docs</h3>
<pre lang="bash">$<span> </span>pdoc<span> </span>wavelet_matrix<span> </span><span>\</span>
<span>      </span>--output-directory<span> </span>docs<span> </span><span>\</span>
<span>      </span>--no-search<span> </span><span>\</span>
<span>      </span>--no-show-source<span> </span><span>\</span>
<span>      </span>--docformat<span> </span>markdown<span> </span><span>\</span>
<span>      </span>--footer-text<span> </span><span>&#34;© 2025 Koki Watanabe&#34;</span>
</pre>
<h2>References</h2>
<ul>
<li>Francisco Claude, Gonzalo Navarro, Alberto Ordóñez,</li>
</ul>
</div></div>
  </body>
</html>
