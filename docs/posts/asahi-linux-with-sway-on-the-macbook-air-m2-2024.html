<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://daniel.lawrence.lu/blog/2024-12-01-asahi-linux-with-sway-on-the-macbook-air-m2/">Original</a>
    <h1>Asahi Linux with Sway on the MacBook Air M2 (2024)</h1>
    
    <div id="readability-page-1" class="page"><div>
<header>

<p>2024-12-01</p>
</header>
<p>I bought a MacBook Air M2.
As of writing, it’s very affordable with the 16 GB RAM, 256 GB SSD, 13.6” model available for $750.
As of writing, also Asahi Linux doesn’t support anything newer than M2.</p>
<p><a href="https://amzn.to/3ZqsRCx">buy on amazon</a></p>
<figure id="fig1"><img src="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-600.jpg" alt="" width="600" height="450" loading="lazy" decoding="async" srcset="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-600.jpg 600w, https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-1200.jpg 1200w, https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-2400.jpg 2400w, https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-3840.jpg 3840w" sizes="(max-width: 600px) 100vw, 600px"/><figcaption><p><a href="#fig1">FIGURE 1</a> Pic of my laptop.</p><details><summary>EXIF data</summary><dl><dt>Camera</dt><dd>FUJIFILM GFX100S</dd><dt>Lens</dt><dd>GF55mmF1.7 R WR</dd><dt>Aperture</dt><dd><data value="1.7">f/1.7</data></dd><dt>Shutter</dt><dd><data value="0.02380952381">1/42 s</data></dd><dt>ISO</dt><dd><data value="400">ISO 400</data></dd><dt>Software</dt><dd>Digital Camera GFX100S Ver2.12</dd><dt>Date</dt><dd><time datetime="2024-12-01T19:14:32">2024-12-01 19:14:32</time></dd></dl></details><details><summary>Download</summary><nav aria-label="Download sizes"><ul><li><a href="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-600.jpg">600 × 450</a></li><li><a href="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-1200.jpg">1200 × 900</a></li><li><a href="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-2400.jpg">2400 × 1800</a></li><li><a href="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-3840.jpg">3840 × 2880</a></li><li><a href="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9-7680.jpg">7680 × 5760</a></li><li><a href="https://i.dllu.net/2024-12-01-19-14-32_DSCF3120_58a0af3f29ead0118ef194dbccea00f020dbe0f8_a168a62312d435a9.jpg">original 11648 × 8736</a></li></ul></nav></details></figcaption></figure>
<p>I had previously used:</p>
<ul><li>2011-2015: MacBook Air 13.3” with Intel Core i5 1.8 GHz, 8 GB of RAM, and 256 GB SSD (aftermarket upgrade from OWC). I installed Arch Linux on it with the i3 window manager.</li><li>2014-2018: Dell XPS 13 Developer Edition. I used the Ubuntu 14.04 that came with it with the i3 window manager.</li><li>2018-2024: Lenovo Thinkpad X1 Carbon Gen 6 with Intel Core i7 8640U, 16 GB of RAM, and 1 TB SSD. I installed Arch Linux on it with Sway.</li></ul>

<p>On the <a href="https://asahilinux.org">Asahi Linux</a> there’s a one liner which you can paste into the Terminal.
It worked very well.
The only complaint is that it seemed to take hours to copy root.img and boot.img over at 150 KB/s.</p>
<p>Since I intended to run it with the <a href="https://swaywm.org/">Sway Window Manager</a>, and storage space is precious, I installed Fedora minimal.</p>

<p>I connected to wifi with</p>
<pre>nmcli device wifi list
nmcli device wifi connect &#39;my_ssid&#39; password &#39;mypassword&#39;
</pre>
<p>and then I installed a bunch of packages I use, such as:</p>
<pre>sudo dnf install @sway-desktop-environment fish alacritty rofi ruff rclone pavucontrol-qt i3status mako pass syncthing maim xdg-user-dirs firefox rustup openssl-devel ncdu fd-find neovim
</pre>
<p>Then, I cloned my <a href="https://github.com/dllu/dotfiles">personal dotfile git repo</a> and ran <code>setup.sh</code>.
Of course, my configs weren’t meant for the MacBook, so I had to make some changes (which I’ve pushed to the dotfiles).</p>

<p>By default, the whole row containing the notch is disabled, leading to a large-bezels look which I personally don’t like. There has got to be a way to use that screen real estate nicely!</p>
<p>I re-enabled that part of the screen with</p>
<pre>grubby --args=apple_dcp.show_notch=1 --update-kernel=ALL
</pre>
<p>Then, I put the Sway bar on the top to make a seamless appearance where the left and right side are used for useful information but the middle part is all black.
By experimentation I found that the notch is 56px tall.</p>
<pre>bar {
    position top
    status_command i3status
    modifier $mod
    tray_output primary
    # the height of the m2 macbook air&#39;s notch???
    height 56
    colors {
        background #000000
        statusline #cfcfd9
        separator #000000
        # border background text
        focused_workspace #0c0c0c #413459 #cfcfd9
        active_workspace #0c0c0c #413459 #cfcfd9
        inactive_workspace #0c0c0c #0c0c0c #cfcfd9
        urgent_workspace #2f343a #ff3300 #ffffff
    }
}
</pre>
<p>The full <code>i3status</code> shows a lot of information which might get occluded by the notch, and it doesn’t work with the MacBook battery levels by default, so I had to update the config:</p>
<pre>general {
        colors = true
        interval = 5
}

order += &#34;wireless _first_&#34;
order += &#34;ethernet _first_&#34;
order += &#34;battery 0&#34;
order += &#34;tztime local&#34;

wireless _first_ {
        format_up = &#34;W: (%quality at %essid) %ip&#34;
        format_down = &#34;W: down&#34;
}

ethernet _first_ {
        format_up = &#34;E: %ip (%speed)&#34;
        format_down = &#34;E: down&#34;
}

battery 0 {
        format = &#34;%status %percentage&#34;
        hide_seconds = true
        path = /sys/class/power_supply/macsmc-battery/uevent
}

tztime local {
        format = &#34;%Y-%m-%d %H:%M:%S&#34;
}
</pre>
<p>I usually don’t like having the bar on the top (as with macOS), since you won’t be able to move your mouse cursor to the top edge to, say, click on tabs.
Despite being mostly keyboard-driven, clicking on browser tabs with the mouse is something I still do often.</p>
<p>To fix that, I prevented the mouse cursor from entering the bar on the top, with</p>
<pre># use swaymsg -t get_inputs for the touchpad&#39;s identifier
input 1452:849:Apple_MTP_multi-touch map_to_region 0 56 2560 1608
</pre>
<h2 id="s3.1"><span id="using-waybar-instead" aria-hidden="true"></span><a href="#s3.1">3.1</a> <span>Using Waybar instead</span></h2>
<p>In around September 2025, I switched from the native Swaybar to Waybar.
Somehow, I was running into some issues with <code>swaymsg</code>‘s handling of battery levels, and my computer ricing was due for a slight visual update anyway.
It’s nice to save a tiny bit of screen real estate with icons instead of pure text, but of course, it is somewhat slower than Swaybar as it needs to render graphical stuff.
The Waybar is still situated behind the notch.</p>
<p>The new waybar config and css are at <a href="https://github.com/dllu/dotfiles/blob/main/waybar_config">waybar<em>config</em></a> and <a href="https://github.com/dllu/dotfiles/blob/main/waybar_style.css">waybar<em>style</em></a>.</p>
<figure id="fig2"><img src="https://i.dllu.net/waybar-screenshot-600.png" alt="" width="600" height="390" loading="lazy" decoding="async" srcset="https://i.dllu.net/waybar-screenshot-600.png 600w, https://i.dllu.net/waybar-screenshot-1200.png 1200w, https://i.dllu.net/waybar-screenshot-2400.png 2400w, https://i.dllu.net/waybar-screenshot.png 2560w" sizes="(max-width: 600px) 100vw, 600px"/><figcaption><p><a href="#fig2">FIGURE 2</a> Screenshot with Waybar.</p><details><summary>Download</summary><nav aria-label="Download sizes"><ul><li><a href="https://i.dllu.net/waybar-screenshot-600.png">600 × 390</a></li><li><a href="https://i.dllu.net/waybar-screenshot-1200.png">1200 × 780</a></li><li><a href="https://i.dllu.net/waybar-screenshot-2400.png">2400 × 1560</a></li><li><a href="https://i.dllu.net/waybar-screenshot.png">original 2560 × 1664</a></li></ul></nav></details></figcaption></figure>

<p>I am very impressed with how smooth and problem-free Asahi Linux is.
It is incredibly responsive and feels even smoother than my Arch Linux desktop with a 16 core AMD Ryzen 7945HX and 64GB of RAM.</p>
<p>The touchpad in particular is stunningly good and just as good as native macOS.
The mouse cursor movement and two finger scroll with inertia just feel incredibly natural, much better than my old Thinkpad X1 Carbon.</p>
<p>One of the main reasons for getting the laptop was to use it for line scan photography.
I was able to install the Alkeria SDK for ARM64 without any issues, even though it came as a deb file instead of an rpm.
I didn’t manage to get <code>alien</code> to work properly (something about the architecture arm64 not matching Fedora’s convention of calling it aarch64?) so I just used bsdtar to extract the contents into the filesystem root, yolo!!!
The M2 compiles my code super fast!</p>
<p>With high screen brightness and compiling lots of code, my battery went down from 100% to 60% after about 4.5 hours of use — not as good as the 15 hours of battery life on macOS but still pretty respectable.</p>
<p>That said, it isn’t perfect.
Common issues are:</p>
<ul><li>higher battery drainage during sleep, so I usually just shut it down entirely when not using it</li><li>no hardware acceleration for video decoding</li><li>some USB port quirks and external display quirks</li></ul>
<p>Still, fairly decent overall.</p>
<figure id="fig3"><img src="https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-600.jpg" alt="" width="600" height="450" loading="lazy" decoding="async" srcset="https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-600.jpg 600w, https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-1200.jpg 1200w, https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-2400.jpg 2400w, https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-3840.jpg 3840w, https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2.jpg 4032w" sizes="(max-width: 600px) 100vw, 600px"/><figcaption><p><a href="#fig3">FIGURE 3</a> Photo of me using my line scan camera with the Asahi Linux Macbook Air in London. Due to the Macbook’s tiny internal storage, I had to use an external 4 TB Crucial X8 SSD since the line scan camera racks up many gigabytes of data within seconds.</p><details><summary>EXIF data</summary><dl><dt>Camera</dt><dd>Apple iPhone 14 Pro Max</dd><dt>Lens</dt><dd>iPhone 14 Pro Max back triple camera 6.86mm f/1.78</dd><dt>Aperture</dt><dd><data value="1.8">f/1.8</data></dd><dt>Shutter</dt><dd><data value="0.006802721088">1/147 s</data></dd><dt>ISO</dt><dd><data value="64">ISO 64</data></dd><dt>Software</dt><dd>26.0</dd><dt>Date</dt><dd><time datetime="2025-09-13T10:21:19">2025-09-13 10:21:19</time></dd></dl></details><details><summary>Download</summary><nav aria-label="Download sizes"><ul><li><a href="https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-600.jpg">600 × 450</a></li><li><a href="https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-1200.jpg">1200 × 900</a></li><li><a href="https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-2400.jpg">2400 × 1800</a></li><li><a href="https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2-3840.jpg">3840 × 2880</a></li><li><a href="https://i.dllu.net/IMG_5067_165e0ae5cc7e50f2.jpg">original 4032 × 3024</a></li></ul></nav></details></figcaption></figure>


</div></div>
  </body>
</html>
