<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://int10h.org/blog/2015/04/cga-in-1024-colors-new-mode-illustrated/">Original</a>
    <h1>CGA in 1024 colors – a new mode (2015)</h1>
    
    <div id="readability-page-1" class="page"><article>
		
		<div>
			
			

<p><span>
Part <strong><em>#1</em></strong> of the 8088 MPH writeup series • continued in <a href="https://int10h.org/blog/2015/08/8088-mph-final-old-vs-new-cga-gory-details/" target="_blank">8088 MPH Final: Old vs. New CGA (and Other Gory Details)</a>
</span></p>

<p>By now you may have heard of the <a href="http://www.pouet.net/prod.php?which=65371" target="_blank">8088 MPH
demo</a>, the winning entry in
<a href="http://2015.revision-party.net/" target="_blank">Revision 2015</a>&#39;s Oldskool Demo compo
this month.  It&#39;s been my pleasure to combine efforts with the likes of
<a href="http://trixter.oldskool.org/" target="_blank">Trixter</a>,
<a href="http://www.reenigne.org/blog/" target="_blank">reenigne</a> and
<a href="https://scalibq.wordpress.com/" target="_blank">Scali</a> to make it happen - not only did
I get the opportunity to work alongside a bunch of extremely talented
wizards of code, we also achieved what we set out to do: break some
world records on the venerable (and yet much-maligned!) IBM PC, the
mommy and daddy of the x86 platform as we still know it today.</p>

<p>One of our &#34;hey, this hardware shouldn&#39;t be doing that!&#34;-moments was
extending the CGA&#39;s color palette by a cool order of magnitude or two. 
How&#39;d we pull that off? - reenigne has already posted an <a href="http://www.reenigne.org/blog/1k-colours-on-cga-how-its-done/" target="_blank">excellent
technical
article</a>
answering that very question.  To complement his writeup, I&#39;ll take a
bit of a different approach – here&#39;s my &#39;pictorial&#39; take on how we
arrived at this:</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k01_graffiti1k2.png" alt="8088 MPH 1K color CGA graffiti"/>
    
    
    <figcaption>
        <p>
        Old dog, posing with new tricks. (Not pictured: blood, sweat, tears.).
        
            
        
        </p> 
    </figcaption>
    
</figure>


<p>The idea that such multi-color trickery was possible came to me some
time ago, as I was looking at reenigne&#39;s code for patching up composite
CGA emulation in <a href="http://www.dosbox.com/" target="_blank">DOSBox</a>; messing with that
patch during development gave me a much better picture of composite
CGA&#39;s inner workings.  When I had ironed out the basic concept for this
hack, I divulged it to reenigne for &#39;peer review&#39; and for testing on
real hardware.  Soon enough, we had an improved recipe:</p>

<ul>
<li>Take two familiar (though officially undocumented) tweaks. Blend to
an even mixture producing a new effect.</li>
<li>Add one crucial new trick – an ingredient of reenigne&#39;s devising.</li>
<li>Test and calibrate until blue in the face.
</li>
</ul>

<p>Below is my rundown of how it all fits together.  Fair warning: the
&#39;target audience&#39; for this writeup is people who may not be overly
familiar with CGA, and/or come from other demo platforms.  As such,
there&#39;s a whole bunch of background that&#39;s already well-known in
CGA-land.  To prevent acute boredom, I decided to stick this TOC here –
feel free to skip to the interesting part(s):</p>


   

  

<h2 id="a-id-16-colors-rgbi-a-old-trick-1-16-color-graphics-over-rgbi"><a id="16_colors_rgbi"></a> Old Trick #1: 16-color graphics over RGBI</h2>

<p>A short crash course on CGA basics: the first graphics standard
available on PCs supports a 16KB memory buffer, and is driven by an
MC6845 CRTC (some later cards used alternatives).  Video output options
are composite NTSC through a standard RCA jack, and the more widely-used
DE9 connector, which outputs an RGBI signal (red, green, blue and
intensity).  The latter is what most people think of when they hear
&#34;CGA&#34;; this is a <em>digital (TTL)</em> signal, where each component can be
either on or off, hence 16 different colors.  Despite what arcade
hardware buffs would like you to think, CGA – in the strict sense – is
NOT analog RGB, and never was.</p>

<p>Standard (BIOS-supported) graphics modes are high-resolution (640x200)
in 2 colors, and medium-resolution (320x200) in 4 colors.  Not a lot of
wiggle room here: in hi-res mode, only one of the colors (foreground) is
redefinable – the background is always black; in medium-res, it&#39;s the
background color that&#39;s adjustable, while the other 3 are determined by
the infamously nasty <a href="http://en.wikipedia.org/wiki/Color_Graphics_Adapter#Standard_graphics_modes" target="_blank">fixed
palettes</a>.</p>

<p>Infuriatingly, in an almost-trollish move, IBM
<a href="https://archive.org/stream/bitsavers_ibmpccardsptionsandAdaptersVolume2Apr84_25079400/Technical_Reference_Options_and_Adapters_Volume_2_Apr84#page/n49/mode/2up/search/%22low-resolution+color+graphics+mode%22" target="_blank">mentioned</a>
an additional low-resolution 16-color mode - &#34;not supported in ROM&#34; -
with zero information on how to actually achieve it.  That nut was
cracked pretty early on, though.</p>

<h3 id="a-id-low-resolution-mode-a-low-resolution-mode"><a id="low_resolution_mode"></a> Low-resolution mode</h3>

<p>This is no graphics mode at all, but a modified 80-column <a href="http://www.techhelpmanual.com/89-video_memory_layouts.html" target="_blank">text
mode</a>.
Basically, you adjust CRTC registers to get 100 rows of text instead of
the usual 25; this gives you a character box of 8x2 pixels, a quarter of
the normal 8x8.  Filling the screen with one &#34;magic&#34; ASCII character,
0xDE, effectively splits each character cell into left and right
&#34;pixels&#34;, corresponding to the background and foreground colors.  These
two colors can be individually set to any of the 16 CGA values, as in
any CGA text mode, as long as you remember to turn off blinking.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k02_16c_low-resolution_cga_160x100.png" alt="CGA low resolution mode"/>
    
    
    <figcaption>
        <p>
        CGA low resolution mode
        
            
        
        </p> 
    </figcaption>
    
</figure>


<p>So there you have it; 160x100 @ 16c.  This mode was used in games <a href="http://www.mobygames.com/game/pc-booter/moon-bugs/screenshots" target="_blank">as
early as
1983</a>,
but never got wildly popular - probably because of the
&#34;<a href="http://en.wikipedia.org/wiki/Color_Graphics_Adapter#Limitations.2C_bugs_and_errata" target="_blank">snow</a>&#34;
that plagues IBM CGA cards in 80-column mode, unless you burn some
costly CPU time to avoid it.</p>

<h3 id="a-id-the-macrocom-method-a-the-macrocom-method"><a id="the_macrocom_method"></a> The Macrocom Method</h3>

<p>You may ask: since this is text mode, what&#39;s stopping you from using the
<em>entire</em> ASCII character set? Other than a healthy respect for your own
sanity, nothing really!  This was first attempted around the mid-&#39;80s by
a few brave souls at
<a href="http://www.mobygames.com/featured_article/feature,10/" target="_blank">Macrocom</a>, who
combined the 100-rows trick with ASCII art, to create what Trixter once
succinctly called &#34;ANSI from hell&#34;.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k03_16c_cga_ansi_from_hell.png" alt="CGA ANSI from Hell"/>
    
    
</figure>

 

<p>As you can see above, I&#39;ve experimented with this a little.  With
judicious use of the character set, you can <em>almost</em> fool somebody into
thinking that this is a 640x200 mode - although there&#39;s some inevitable
&#34;attribute clash&#34;, a little like the <a href="http://www.retroyak.com/clash-of-the-bright-dims/" target="_blank">ZX
Spectrum</a>: each 8x2
character cell can contain only two colors, foreground and background.
Also, you have to be a bit of a glutton for punishment to actually draw
in this mode from scratch... but that&#39;s a subject for a future post.</p>

<p>This trick isn&#39;t directly relevant to our demo: we were targeting
composite displays. Even if CGA&#39;s composite output didn&#39;t have its share
of bugs and quirks in 80-column mode – <a href="http://www.reenigne.org/blog/cga-why-the-80-column-text-mode-requires-the-border-color-to-be-set/" target="_blank">which it
does</a>
– there&#39;d be no way to see this level of detail over NTSC.  There&#39;s a
reason I mention this effect, however; the idea behind it does figure
into the story.  But more on that later.</p>

<h2 id="a-id-16-colors-composite-a-old-trick-2-16-color-graphics-over-composite"><a id="16_colors_composite"></a> Old Trick #2: 16-color graphics over composite</h2>

<p>Digital RGB monitors were still a luxury item at the time of CGA&#39;s
introduction, and IBM itself didn&#39;t offer one until a couple of years
later, coinciding with the release of the PC/XT.  But CGA also provided
composite output, giving out (mostly) NTSC-compatible video. At the
expense of resolution, there&#39;s more fun to be had here with color.</p>

<h3 id="a-id-direct-colors-a-direct-colors"><a id="direct_colors"></a> Direct colors</h3>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k04_cga_composite_direct_colors.png#floatleft" alt="Composite CGA, 16 direct colors"/>
    
    
</figure>


<p>On the composite output, the familiar 16-color CGA palette is
represented by a series of color signals, whose hue is determined by
their <strong>phase</strong> relative to a reference signal (the NTSC <em>color
burst</em>).  The <strong>frequency</strong> of the NTSC color clock (3.579545 MHz) works
out to exactly <strong>160</strong> color cycles per active CGA scanline.</p>

<p>These are directly generated by CGA hardware as color signals, so we&#39;ll
conveniently call them &#34;direct colors&#34;.  IBM had <a href="http://www.reenigne.org/blog/comparison-of-cga-card-versions/" target="_blank">two main
revisions</a>
of the CGA, which produce composite video somewhat differently:
&#39;new-style&#39; cards contain additional circuitry, which helps the palette
match its RGBI counterpart a little more closely.  For the demo, we
standardized on &#39;old-style&#39; cards, simply because we happened to have
done more testing on those (with somwhat better results), so all images
in this post will reflect &#39;old-style&#39; CGA colors.</p>

<p>If these 16 <em>direct</em> colors were all we had, it wouldn&#39;t be a whole lot
of fun, would it?  They&#39;re also shockingly ugly, esepcially on an
old-style CGA, which doesn’t help matters either.  Just look at that
palette... gross, dude.  Luckily, there&#39;s a way to go one better.</p>

<h3 id="a-id-artifact-colors-a-artifact-colors"><a id="artifact_colors"></a> Artifact colors</h3>

<p>Due to bandwidth restrictions, NTSC video doesn&#39;t fully separate
chrominance (color) from luminance.  Effectively, any high-resolution
detail – that is, detail with higher frequency than the NTSC color clock
– gets &#39;smeared&#39; when the signal is decoded. This is responsible for the
characteristic color bleed, seen in the form of fetching little fringes
at the edges of text characters and other fine detail.</p>

<p>Remember how you get 160 color cycles per active CGA scanline? Standard
CGA gives us either <strong>320</strong> or <strong>640</strong> active pixels per scanline,
depending on the video mode.  Ergo, we can switch pixels on and off at
<strong>2x</strong> or <strong>4x</strong> the frequency of the color carrier.  Since this
high-frequency detail cannot be fully separated from color information,
the upshot is this:</p>

<div>
     <p><strong><em>The hue of a pixel, or a fringe (transition between pixels), depends on its position within the color-cycle period.</em></strong>
     </p>
</div>
   

  

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k05_ntsc_color_wheel.png#floatleft" alt="NTSC color wheel"/>
    
    
</figure>


<p>This NTSC color cycle is sometimes represented as a wheel: one complete
period of this cycle equals a 360° revolution around the color wheel,
and we have 160 complete revolutions per scanline.</p>

<p>Let&#39;s say we&#39;re in hi-res (640x200) mode, where 4 pixels fit into one
such color cycle: moving one pixel left or right translates to moving
90° along the wheel, in either direction, and accordingly shifts the hue
by 90°.  Likewise, in 320x200 mode, we move in 180° increments of
hue-shift.</p>

<p>In short, manipulating detail at high resolutions is
effectively a method of generating color; being an artifact of NTSC&#39;s
imperfections, this is known as <em>artifact</em> color.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k06_cga_composite_fringing_artifacts.png" alt="CGA composite output: fringing and artifact colors"/>
    
    
</figure><p>

­</p>

<p>Various filters can be (and often are) employed on the receiving end to
recover some of the high-frequency detail, reducing color bleed and
making edge transitions somewhat sharper.  We&#39;re still dealing with
technology, not magic, so full separation of detail and color can never
quite be achieved, and the trade-off is a whole new set of artifacts (in
the form of &#34;echoing&#34; or &#34;ringing&#34;).  This trade-off may or may not be
acceptable, depending on what you&#39;re doing, but the above image doesn&#39;t
attempt to reproduce any such filtering.</p>

<h3 id="a-id-solid-artifact-colors-a-solid-artifact-colors"><a id="solid_artifact_colors"></a> Solid artifact colors</h3>

<p>All this business of &#34;fringing&#34; and &#34;bleeding&#34; sure sounds like a
bummer, and that&#39;s exactly what it is: the unwanted side-effect of a
less-than-ideal encoding scheme.  But like any good flaw, it can be
turned into an advantage by an enterprising soul, and this is where we
get to the fun part (your mileage may vary).</p>

<p>When you look at the interplay of color vs. detail over NTSC, a very
handy fact becomes apparent:</p>

<div>
     <p><strong><em>Any periodic composite signal, with the same frequency as the color carrier (160 per line), will be decoded as a solid, continuous color.</em></strong>
     </p>
</div>
   

  

<p>Our 16 <em>direct</em> colors are exactly this type of periodic composite
signal.  But hold on – with some simple high-resolution pixel-pushing,
we can manually put together our own periodic waveforms!  Any pattern of
dots will do, as long as it repeats at the right frequency.  This lets
us achieve solid colors that lie <em>outside</em> the direct color palette.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k07_cga_composite_solid_colors_1.png#floatleft" alt="CGA solid artifact colors 1"/>
    
    
</figure>


<p>The &#34;classic&#34; way of doing this on CGA is to set up BIOS mode 6 –
640x200 in 2 colors, white on black – and set the color-burst bit (which
is off by default, for a B&amp;W picture).  At this resolution we can
squeeze 4 pixels into a color clock period, and at 1 bit per pixel,
there are 16 possible patterns – giving us 16 solid artifact colors.</p>

<p>This is pretty much the same
<a href="http://laboratorium.net/archive/2009/03/08/why_did_the_applie_ii_have_six_colors" target="_blank">technique</a>
used by Steve Wozniak to generate color on the Apple ][.  In fact, on
an old-style CGA card, these 16 colors are <em>identical</em> to the 16 low-res
Apple colors (although you couldn&#39;t get them on a poster, like Apple
owners
<a href="http://beagle.applearchives.com/the_posters/poster_1.html" target="_blank">could</a>). 
More to the point: the pixels themselves are white, which carries no
color information; it&#39;s the detail that does the deed.</p>

<p>*But wait, there&#39;s more!*  Despite popular wisdom, CGA lets us one-up
the Apple, and then some.  OUR underlying pixels don&#39;t have to be white:
in 640x200 mode, we can play with the palette register and set any of
the 16 <em>direct</em> colors as the foreground (background is always black). 
By using the same pixel patterns with a different foreground color, we
get 16 <em>entirely new</em> sets of artifact colors, with 16 colors each.  We
can only use one such set at a time, but we get to pick and choose what
our 16 colors are.</p>

<p>Then there&#39;s 320x200 mode, which supports a palette of 4 direct colors. 
Only one of those, color #0 (background), is freely selectable.  For
the rest, intensity may be on or off, but we can only use
green/red/yellow or cyan/magneta/white; the undocumented cyan/red/white
palette involves disabling the color burst, making the composite picture
greyscale.</p>

<p>Since our pixels are twice as fat in this mode, only two of them can
squeeze into a color-clock cycle – but at 2 bits per pixel, the total
count of artifact colors is still 16.  The possible combinations of
palette, plus the user-defined background color, provide us with a whole
slew of other 16-color sets.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k08_cga_composite_solid_colors_2.png" alt="CGA solid artifact colors 2"/>
    
    
</figure><p>

­</p>

<p>This may be a good place to correct a bit of a misconception.  Since we
have 160 color cycles per scanline, many people treat CGA&#39;s graphics
modes over composite as 160x200 &#34;modes&#34;, but that&#39;s not quite accurate. 
Our <em>effective color resolution</em> is indeed 160x200, and it&#39;s impossible
to get finer detail than that using solid artifact colors.  But as we&#39;ve
seen, on NTSC the pixel grid and color grid are NOT one and the same –
which makes the question of horizontal resolution a bit fuzzy, depending
on how you&#39;re sampling and/or filtering the signal.  It even varies with
the specific color waveforms you&#39;re using.</p>

<p>IBM itself never documented any of these artifact color tricks, other
than one oblique reference to &#34;<a href="https://archive.org/stream/IbmPcjrTechnicalReference#page/n331/mode/2up/search/%22color+mixing+techniques%22" target="_blank">color mixing
techniques</a>&#34;
in the PCjr tech ref (if I&#39;m wrong about this, drop me a line and link
me!).  The concept is fairly old hat, however – it was used in games
very early on; some of the first ones I can think of were Microsoft&#39;s
<a href="http://www.mobygames.com/game/pc-booter/microsoft-decathlon/screenshots" target="_blank">Decathlon</a>
and <a href="http://www.mobygames.com/game/pc-booter/microsoft-flight-simulator-v10/screenshots" target="_blank">Flight
Simulator</a>,
both in 1982.  And the limitation has always been the same: the maximum
simultaneous color count you can get over composite CGA is 16.</p>

<p>....Or is it?  On the off chance that you&#39;ve been following me so far, and
you&#39;re still reading, you may have an idea of what the next step is.</p>

<h2 id="a-id-256-colors-a-256-colors"><a id="256_colors"></a> 256 colors</h2>

<p>We&#39;ve already observed that our choice of 16 artifact colors depends on
the palette and color register settings.  One fairly obvious strategy
seems to suggest itself here – change those registers at particular
scanlines on every frame, and get &gt;16 colors on screen that way. 
Right?</p>

<p><a href="https://int10h.org/blog/img/1k09_reenigne_chart1a00.png" target="_blank"><img src="https://int10h.org/blog/img/1k09_reenigne_chart1a00.png" title="CGA 256 colors chart.com" alt="CGA 256 colors chart.com" width="123" height="92"/></a></p>

<p>This has been done before on CGA, and you <em>can</em> actually exploit this
for 256 colors (as proven by reenigne - see the image to the left), but
that&#39;s <strong>not</strong> how we did our multi-color hacking in the demo.  We were
actually toying with the idea of including a static screen that uses
this technique, but I didn&#39;t have the time to pursue this; if anyone
manages to compose some nice artwork using this method, I&#39;d love to see
it – that&#39;s gotta be a bit of an artistic challenge.  But no, the way we
wrangled more color out of CGA is a whole other shenanigan... which I came
across by equal parts chance and morbid curiosity.</p>

<p>Recall how any color/dot pattern of the right length (four repeating
pixels in 640x200, or two in 320x200) produces a solid color on a
composite display?  Back when I was testing composite emulation for
DOSBox, that fact was fresh in my mind.  At around the same time, I was
experimenting with the &#34;ANSI from Hell&#34; graphical hack detailed
<a href="#the_macrocom_method">above</a>;
that&#39;s purely a text mode / RGBI trick, but it requires a close
familiarity with the ROM character set... closer than most sane people
would want or need.</p>

<p>Let&#39;s take another look at a particular section of the CGA ROM font, in
80-column mode, with the top 2 scanlines highlighted:</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k10_cga_charset_subset.png" alt="CGA ROM font subset"/>
    
    
</figure><p>

­</p>

<p>At this point, if you&#39;re a visually-oriented person, and if you&#39;ve been
following my drift, you&#39;re probably catching on.  Don&#39;t see it yet?
Here&#39;s a fatter clue:</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k11_ascii_0x55.png" alt="ASCII char 0x55"/>
    
    
</figure><p>

­</p>

<p>See those top 25% of the character bitmap?  Two dots of foreground and
two dots of background, doubled horizontally across.  We&#39;re in
hi-res/80-column mode, so there are two color cycles per character...
corresponding exactly to those two matching halves.  And those top two
scanlines are identical.</p>

<p>That&#39;s just the type of repeating pattern that gets us a solid artifact
color over NTSC.  In fact, it&#39;s the very same waveform that 320x200 mode
lets us play with.  Except that now we have it available in <em>text mode</em>:
you know, where we can freely assign a foreground AND a background to
each character, from the 16 direct colors.</p>

<p>That&#39;s 256 possibilities right there... this is the part that made me go
<em>&#34;I have a cunning plan&#34;</em>, in my best imitation of Blackadder&#39;s
<a href="https://int10h.org/blog/img/baldrick.jpg" target="_blank">Baldrick</a>
(just not out loud).  Indeed, it&#39;s possible to achieve &gt;16 colors on
CGA without any flickering, dithering, interlacing or per-scanline
effects.</p>

<p>Here&#39;s what the possible combinations work out to:</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k12_cga_artifact_colors_ascii_0x55.png" alt="CGA artifacts - ASCII char 0x55"/>
    
    
</figure>

 

<h2 id="a-id-512-colors-a-512-colors"><a id="512_colors"></a> 512 colors</h2>

<p>Oh, we&#39;re not done yet: once that lightbulb went off over my head, I had
another look at the CGA ROM font to see if any other useful bit
sequences emerge.  There are a few character bitmaps that give us the
exact same waveform as &#39;U&#39; does – &#39;H&#39;, &#39;V&#39;, &#39;Y&#39; and &#39;¥&#39; – but only one
with a <em>different</em> suitable bit sequence right where we need it: 0x13,
the double exclamation mark (&#39;‼&#39;).</p>

<p>The top two scanlines of &#39;U&#39; give us a bitmask of 11001100 for
foreground/background; &#39;‼&#39; is 01100110 – a single shift to the right, or
a 90° shift in phase.  This perfectly complements &#39;U&#39; in terms of having
a well-rounded palette, because we get all the colors that the &#34;...1100...&#34;
waveform has to offer: going from &#39;U&#39; to &#39;‼&#39; shifts the phase by 90°
(0110); 180° and 270° are achieved by flipping the foreground and
background colors for &#39;U&#39; and &#39;‼&#39; respectively – the same as going
&#39;0011&#39; and &#39;1001&#39;.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k13_cga_artifact_colors_ascii_0x13.png" alt="CGA artifacts - ASCII char 0x13"/>
    
    
</figure><p>

­</p>

<p>Okay, we&#39;ve pushed the envelope even further: 512 simultaneous colors! 
Granted, the real number is lower, because a good few are duplicates
(and others are very close).  But 512 seems to be the limit for this
technique: no other characters in our font fit the bill for solid
colors.  The CGA character ROM does have an <a href="http://www.seasip.info/VintagePC/cga.html" target="_blank">alternate &#39;thin&#39; 8x8
font</a>; but, besides the fact
that you&#39;d have to mod your card if you wanted to use it, the &#39;thin&#39;
font has none of the magic bit patterns in the right places, which makes
it useless for our purposes.</p>

<p>My kingdom for redefinable characters... alas, when you&#39;re dealing with
old PC hardware, IBM&#39;s penchant for cost-cutting over innovation can
<em>always</em> sneak up from behind and ruin your day – even in the most
unusual of places.</p>

<p>Still, I was pleased with my little discovery: extending the palette by
a factor of <strong>32</strong> has to count for something, right?  At this point, I
shared my ideas with reenigne.  Little did I know that he&#39;ll promptly
come up with a new devious scheme to double our color count yet
again...</p>

<h2 id="a-id-1024-colors-a-1024-colors"><a id="1024_colors"></a> 1024 colors</h2>

<p>This part is some next-level CRTC black magic which I could never have
figured out by myself – I&#39;m just a graphics guy; you might as well ask
me to wait for a full moon and chant the MC6845 spec-sheet backwards in
hexadecimal.  All credit goes to reenigne for this particular bit of mad
science, which, despite its complex execution, stems from a wonderfully
simple idea: our fixed character bitmaps don&#39;t play nice with what we&#39;re
trying to do? No problem – we&#39;ll <em>make</em> them play nice, or else.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k14_ascii_0xb0_0xb1.png#floatleft" alt="ASCII chars 0xb0, 0xb1"/>
    
    
</figure>


<p>See, there are two additional characters whose very <em>first</em> scanline
could be used; problem is, the second scanline is different, which would
ruin our solid color effect.  These are ASCII codes 0xB0 and 0xB1, the
&#39;shaded block&#39; characters. It would be quite convenient if we could just
tell that offending second scanline to buzz off, wouldn&#39;t it? As it
turns out, we can.</p>

<p>The lowdown on how this is done is all in reenigne&#39;s writeup, which is
linked to at the top of this post.  But this is the basic idea: by
starting a new CRTC frame <em>every other scanline</em> and twiddling with the
start address, it&#39;s possible to lay down our character rows so that the
first scanline of each gets duplicated twice!</p>

<p>Now we can make use of those two extra characters, and doing so gets us
two more 256-color sets:</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k15_cga_artifact_colors_ascii_0xb0_0xb1.png" alt="CGA artifacts - ASCII chars 0xb0, 0xb1"/>
    
    
</figure><p>

­</p>

<p>Naturally, there are downsides: having to mess with the CRTC every
couple of scanlines is quite taxing for the poor 4.77MHz 8088, so
there&#39;s not much you can do with this other than static pictures.  The
512-color variant, using only ASCII 0x55 and 0x13, doesn&#39;t suffer from
this – it&#39;s basically &#34;set and forget&#34;, requiring no more CPU
intervention than any 80-column text mode (the familiar overhead of
avoiding snow).</p>

<p>Then, there&#39;s that other problem which plagues 80-column CGA on
composite displays... the hardware bug that leads to bad hsync timing and
missing color burst.  There are ways to compensate for that, but none
that reliably works with <em>every</em> monitor and capture device out there. 
This proved to be an enduring headache in calibrating, determining the
actual colors, and obtaining a passable video capture of the entire
demo... but that&#39;s all covered elsewhere.</p>

<p>At any rate, we now have 1K colors on a 1981 IBM CGA, at an effective
resolution of 80x100 &#39;chunky pixels&#39;.  &#39;Chunky&#39; describes the memory
layout, but it also applies in the visual sense: we&#39;re really plumbing
the depths of resolution here.  160x100,  that&#39;s as low as you could go?
allow me to snicker, IBM - &#34;low-res&#34; just got <em>lower</em>, baby!</p>

<p>One might object that this isn&#39;t a lot of canvas.  Yeah, yeah: 80x100 is
a bit on the cramped side, &#39;artistically&#39; speaking; but the limitation
is part of the challenge, as it has always been in demos.  You can keep
your fancy 4K monitors - 0.008 megapixels should be enough for
anybody.</p>

<figure>
    
    
        <img src="https://int10h.org/blog/img/1k16_flowergirl_cga_1024_colors.png" alt="CGA flowergirl 1k colors"/>
    
    
</figure><p>

­</p>

<p>When we first showed Trixter the &#39;proof-of-concept&#39; 1024c drawings, his
response was, and I quote: &#34;HOLY F!@#$%G SHIT. WOW. I must know how
this works!!&#34;.   Achievement unlocked: getting THAT out of a veteran
8088/CGA hacker and demomaker is, by itself, almost as good as... well,
joining the team, &#39;making a demo about it&#39; and winning the oldskool
compo. :)</p>

<p>That&#39;s about it for my writeup.  If you made it this far,
congratulations!  There&#39;s more I could write about the tools and
techniques I used to actually compose these graphics... but we&#39;ll get to
that some other time.</p>



		</div>
		

	</article></div>
  </body>
</html>
