<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jvns.ca/blog/2024/10/01/terminal-colours/">Original</a>
    <h1>Terminal colours are tricky</h1>
    
    <div id="readability-page-1" class="page"><div>
     

<p>Yesterday I was thinking about how long it took me to get a colorscheme in my
terminal that I was mostly happy with (SO MANY YEARS), and it made me wonder
what about terminal colours made it so hard.</p>

<p>So I <a href="https://social.jvns.ca/@b0rk/113226972156366201">asked people on Mastodon</a> what problems
theyâ€™ve run into with colours in the terminal, and I got a ton of interesting
responses! Letâ€™s talk about some of the problems and a few possible ways to fix
them.</p>

<h3 id="problem-1-blue-on-black">problem 1: blue on black</h3>

<p>One of the top complaints was â€œblue on black is hard to readâ€. Hereâ€™s an
example of that: if I open Terminal.app, set the background to black, and run
<code>ls</code>, the directories are displayed in a blue that isnâ€™t that easy to read:</p>

<p><img src="https://jvns.ca/images/terminal-blue.png"/></p>

<p>To understand why weâ€™re seeing this blue, letâ€™s talk about ANSI colours!</p>

<h3 id="the-16-ansi-colours">the 16 ANSI colours</h3>

<p>Your terminal has 16 numbered colours â€“ black, red, green, yellow, blue,
magenta, cyan, white, and â€œbrightâ€ version of each of those.</p>

<p>Programs can use them by printing out an â€œANSI escape codeâ€ â€“ for example if
you want to see each of the 16 colours in your terminal, you can run this
Python program:</p>

<pre><code>def color(num, text):
    return f&#34;\033[38;5;{num}m{text}\033[0m&#34;

for i in range(16):
    print(color(i, f&#34;number {i:02}&#34;))
</code></pre>

<h3 id="what-are-the-ansi-colours">what are the ANSI colours?</h3>

<p>This made me wonder â€“ if blue is colour number 5, who decides what hex color
that should correspond to?</p>

<p>The answer seems to be â€œthereâ€™s no standard, terminal emulators just choose
colours and itâ€™s not very consistentâ€. Hereâ€™s a <a href="https://en.m.wikipedia.org/wiki/ANSI_escape_code#Colors">screenshot of a table from Wikipedia</a>, where you
can see that thereâ€™s a lot of variation:</p>

<p><img src="https://jvns.ca/images/wikipedia.png"/></p>

<h3 id="problem-1-5-bright-yellow-on-white">problem 1.5: bright yellow on white</h3>

<p>Bright yellow on white is even worse than blue on black, hereâ€™s what I get in
a terminal with the default settings:</p>

<p><img src="https://jvns.ca/images/terminal-yellow.png"/></p>

<p>Thatâ€™s almost impossible to read (and some other colours like light green cause
similar issues), so letâ€™s talk about solutions!</p>

<h3 id="two-ways-to-reconfigure-your-colours">two ways to reconfigure your colours</h3>

<p>If youâ€™re annoyed by these colour contrast issues (or maybe you just think the
default ANSI colours are ugly), you might think â€“ well, Iâ€™ll just choose a
different â€œblueâ€ and pick something I like better!</p>

<p>There are two ways you can do this:</p>

<p><strong>Way 1: Configure your terminal emulator</strong>: I think most modern terminal emulators
   have a way to reconfigure the colours, and some of them even come with some
   preinstalled themes that you might like better than the defaults.</p>

<p><strong>Way 2: Run a shell script</strong>: There are ANSI escape codes that you can print
out to tell your terminal emulator to reconfigure its colours. <a href="https://github.com/chriskempson/base16-shell/blob/master/scripts/base16-solarized-light.sh">Hereâ€™s a shell script that does that</a>,
from the <a href="https://github.com/chriskempson/base16-shell">base16-shell</a> project.
You can see that it has a few different conventions for changing the colours â€“
I guess different terminal emulators have different escape codes for changing
their colour palette, and so the script is trying to pick the right style of
escape code based on the <code>TERM</code> environment variable.</p>

<h3 id="what-are-the-pros-and-cons-of-the-2-ways-of-configuring-your-colours">what are the pros and cons of the 2 ways of configuring your colours?</h3>

<p>I prefer to use the â€œshell scriptâ€ method, because:</p>

<ul>
<li>if I switch terminal emulators for some reason, I donâ€™t need to a different configuration system, my colours still Just Work</li>
<li>I use <a href="https://github.com/chriskempson/base16-shell">base16-shell</a> with base16-vim to make my vim colours match my terminal colours, which is convenient</li>
</ul>

<p>The main advantage I can think of for configuring colours in your terminal
emulator is that, if you use a popular terminal emulator, there are probably a
lot of nice terminal themes out there that you can choose from. I think there are some more advantages Iâ€™m not thinking of though.</p>

<p>This is what my shell has looked like for probably the last 5 years (using the
solarized light base16 theme), and Iâ€™m pretty happy with it. Hereâ€™s <code>htop</code>:</p>

<p><img src="https://jvns.ca/images/terminal-my-colours.png"/></p>

<p>Okay, so letâ€™s say youâ€™ve found a terminal colorscheme that you like. What else
can go wrong?</p>

<h3 id="problem-2-programs-using-256-colours">problem 2: programs using 256 colours</h3>

<p>Hereâ€™s what some output of <code>fd</code>, a <code>find</code> alternative, looks like in my
colorscheme:</p>

<p><img src="https://jvns.ca/images/terminal-problem-fd.png"/></p>

<p>The contrast is pretty bad here, and I definitely donâ€™t have that lime green in
my normal colorscheme. Whatâ€™s going on?</p>

<p>We can see what color codes <code>fd</code> is using using the <code>unbuffer</code> program to
capture its output including the color codes:</p>

<pre><code>$ unbuffer fd . &gt; out
$ vim out
[38;5;48mbad-again.sh[0m
[38;5;48mbad.sh[0m
[38;5;48mbetter.sh[0m
out
</code></pre>

<p><code>[38;5;48</code> means â€œset the foreground color to color <code>48</code>â€. Terminals donâ€™t
only have 16 colours â€“ many terminals these days actually have 3 ways of
specifying colours:</p>

<ol>
<li>the 16 ANSI colours we already talked about</li>
<li>an extended set of 256 colours</li>
<li>a further extended set of 24-bit hex colours, like <code>#ffea03</code></li>
</ol>

<p>So <code>fd</code> is using one of the colours from the extended 256-color set. <code>bat</code> (a
<code>cat</code> alternative) does something similar â€“ hereâ€™s what it looks like by
default in my terminal.</p>

<p><img src="https://jvns.ca/images/terminal-bat.png"/></p>

<p>This looks fine though and it really seems like itâ€™s trying to work well with a
variety of terminal themes.</p>

<h3 id="some-newer-tools-seem-to-have-theme-support">some newer tools seem to have theme support</h3>

<p>I think itâ€™s interesting that some of these newer terminal tools (<code>fd</code>, <code>cat</code>,
<code>delta</code>, and probably more) have support for arbitrary custom themes. I guess
the downside of this approach is that the default theme might clash with your
terminalâ€™s background, but the upside is that it gives you a lot more control
over theming the toolâ€™s output than just choosing 16 ANSI colours.</p>

<p>I donâ€™t really use <code>bat</code>, but if I did Iâ€™d probably use <code>bat --theme ansi</code> to
just use the ANSI colours that I have set in my normal terminal colorscheme.</p>

<h3 id="problem-3-the-grays-in-solarized">problem 3: the grays in Solarized</h3>

<p>A bunch of people on Mastodon mentioned a specific issue with grays in the
Solarized theme: when I list a directory, the base16 Solarized Light theme
looks like this:</p>

<p><img src="https://jvns.ca/images/terminal-solarized-base16.png"/></p>

<p>but iTermâ€™s default Solarized Light theme looks like this:</p>

<p><img src="https://jvns.ca/images/terminal-solarized-iterm.png"/></p>

<p>This is because in the iTerm theme (which is the <a href="https://ethanschoonover.com/solarized/#the-values">original Solarized design</a>), colors 9-14 (the â€œbright blueâ€, â€œbright
redâ€, etc) are mapped to a series of grays, and when I run <code>ls</code>, itâ€™s trying to
use those â€œbrightâ€ colours to color my directories and executables.</p>

<p>My best guess for why the original Solarized theme is designed this way is to
make the grays available to the <a href="https://github.com/altercation/vim-colors-solarized/blob/528a59f26d12278698bb946f8fb82a63711eec21/colors/solarized.vim">vim Solarized colorscheme</a>.</p>

<p>Iâ€™m pretty sure I prefer the modified base16 version I use where the â€œbrightâ€
colours are actually colours instead of all being shades of gray though. (I
didnâ€™t actually realize the version I was using wasnâ€™t the â€œoriginalâ€ Solarized
theme until I wrote this post)</p>

<h3 id="problem-4-a-vim-theme-that-doesn-t-match-the-terminal-background">problem 4: a vim theme that doesnâ€™t match the terminal background</h3>

<p>If I my vim theme has a different background colour than my terminal theme, I
get this ugly border, like this:</p>

<p><img src="https://jvns.ca/images/terminal-vim-black-bg.png"/></p>

<p>This one is a pretty minor issue though and I think making your terminal
background match your vim background is pretty straightforward.</p>

<h3 id="problem-5-programs-setting-a-background-color">problem 5: programs setting a background color</h3>

<p>A few people mentioned problems with terminal applications setting an
unwanted background colour, so letâ€™s look at an example of that.</p>

<p>Here <code>ngrok</code> has set the background to color #16 (â€œblackâ€), but the
<code>base16-shell</code> script I use sets color 16 to be bright orange, so I get this,
which is pretty bad:</p>

<p><img src="https://jvns.ca/images/terminal-ngrok-solarized.png"/></p>

<p>I think the intention is for ngrok to look something like this:</p>

<p><img src="https://jvns.ca/images/terminal-ngrok-regular.png"/></p>

<p>I think <code>base16-shell</code> sets color #16 to orange (instead of black)
so that it can provide extra colours for use by <a href="https://github.com/chriskempson/base16-vim/blob/3be3cd82cd31acfcab9a41bad853d9c68d30478d/colors/base16-solarized-light.vim">base16-vim</a>.
This feels reasonable to me â€“ I use <code>base16-vim</code> in the terminal, so I guess Iâ€™m
using that feature and itâ€™s probably more important to me than <code>ngrok</code> (which I
rarely use) behaving a bit weirdly.</p>

<p>This particular issue is a maybe obscure clash between ngrok and my colorschem,
but I think this kind of clash is pretty common when a program sets an ANSI
background color that the user has remapped for some reason.</p>

<h3 id="a-nice-solution-to-contrast-issues-minimum-contrast">a nice solution to contrast issues: â€œminimum contrastâ€</h3>

<p>A bunch of terminals (iTerm2, <a href="https://github.com/Eugeny/tabby">tabby</a>, kittyâ€™s <a href="https://sw.kovidgoyal.net/kitty/conf/#opt-kitty.text_fg_override_threshold">text_fg_override_threshold</a>, and
folks tell me also Ghostty and Windows Terminal) have a â€œminimum
contrastâ€ feature that will automatically adjust colours to make sure they have enough contrast.</p>

<p>Hereâ€™s an example from iTerm. This ngrok accident from before has pretty bad
contrast, I find it pretty difficult to read:</p>

<p><img src="https://jvns.ca/images/terminal-ngrok-solarized.png"/></p>

<p>With â€œminimum contrastâ€ set to 40 in iTerm, it looks like this instead:</p>

<p><img src="https://jvns.ca/images/terminal-ngrok-solarized-contrast.png"/></p>

<p>I didnâ€™t have minimum contrast turned on before but I just turned it on today
because it makes such a big difference when something goes wrong with colours
in the terminal.</p>

<h3 id="problem-6-term-being-set-to-the-wrong-thing">problem 6: <code>TERM</code> being set to the wrong thing</h3>

<p>A few people mentioned that theyâ€™ll SSH into a system that doesnâ€™t support the
<code>TERM</code> environment variable that they have set locally, and then the colours
wonâ€™t work.</p>

<p>I think the way <code>TERM</code> works is that systems have a <code>terminfo</code> database, so if
the value of the <code>TERM</code> environment variable isnâ€™t in the systemâ€™s terminfo
database, then it wonâ€™t know how to output colours for that terminal. I donâ€™t
know too much about terminfo, but someone linked me to this <a href="https://twoot.site/@bean/113056942625234032">terminfo rant</a> that talks about a few other
issues with terminfo.</p>

<p>I donâ€™t have a system on hand to reproduce this one so I canâ€™t say for sure how
to fix it, but <a href="https://unix.stackexchange.com/questions/67537/prevent-ssh-client-passing-term-environment-variable-to-server">this stackoverflow question</a>
suggests running something like <code>TERM=xterm ssh</code> instead of <code>ssh</code>.</p>

<h3 id="problem-7-picking-good-colours-is-hard">problem 7: picking â€œgoodâ€ colours is hard</h3>

<p>A couple of problems people mentioned with designing / finding terminal colorschemes:</p>

<ul>
<li>some folks are colorblind and have trouble finding an appropriate colorscheme</li>
<li>accidentally making the background color too close to the cursor or selection color, so theyâ€™re hard to find</li>
<li>generally finding colours that work with every program is a struggle (for example you can see me having a problem with this with ngrok above!)</li>
</ul>

<h3 id="problem-8-making-nethack-mc-look-right">problem 8: making nethack/mc look right</h3>

<p>Another problem people mentioned is using a program like nethack or midnight
commander which you might expect to have a specific colourscheme based on the
default ANSI terminal colours.</p>

<p>For example, midnight commander has a really specific classic look:</p>

<p><img src="https://jvns.ca/images/terminal-mc-normal.png"/></p>

<p>But in my Solarized theme, midnight commander looks like this:</p>

<p><img src="https://jvns.ca/images/terminal-mc-solarized.png"/></p>

<p>The Solarized version feels like it could be disorienting if youâ€™re
very used to the â€œclassicâ€ look.</p>

<p>One solution Simon Tatham mentioned to this is using some palette customization
ANSI codes (like the ones base16 uses that I talked about earlier) to change
the color palette right before starting the program, for example remapping
yellow to a brighter yellow before starting Nethack so that the yellow
characters look better.</p>

<h3 id="problem-9-commands-disabling-colours-when-writing-to-a-pipe">problem 9: commands disabling colours when writing to a pipe</h3>

<p>If I run <code>fd | less</code>, I see something like this, with the colours disabled.</p>

<p><img src="https://jvns.ca/images/terminal-fd-bw.png"/></p>

<p>In general I find this useful â€“ if I pipe a command to <code>grep</code>, I donâ€™t want it
to print out all those color escape codes, I just want the plain text. But what if you want to see the colours?</p>

<p>To see the colours, you can run <code>unbuffer fd | less -r</code>! I just learned about
<code>unbuffer</code> recently and I think itâ€™s really cool, <code>unbuffer</code> opens a tty for the
command to write to so that it thinks itâ€™s writing to a TTY. It also fixes
issues with programs buffering their output when writing to a pipe, which is
why itâ€™s called <code>unbuffer</code>.</p>

<p>Hereâ€™s what the output of <code>unbuffer fd | less -r</code> looks like for me:</p>

<p><img src="https://jvns.ca/images/terminal-fd-color.png"/></p>

<h3 id="problem-10-unwanted-colour-in-ls-and-other-commands">problem 10: unwanted colour in <code>ls</code> and other commands</h3>

<p>Some people mentioned that they donâ€™t want <code>ls</code> to use colour at all, perhaps
because <code>ls</code> uses blue, itâ€™s hard to read on black, and maybe they donâ€™t feel like
customizing their terminalâ€™s colourscheme to make the blue more readable or
just donâ€™t find the use of colour helpful.</p>

<p>Some possible solutions to this one:</p>

<ul>
<li>you can run <code>ls --color=never</code>, which is probably easiest</li>
<li>you can also set <code>LS_COLORS</code> to customize the colours used by <code>ls</code>. I think some other programs other than <code>ls</code> support the <code>LS_COLORS</code> environment variable too.</li>
<li>also some programs support setting <code>NO_COLOR=true</code> (thereâ€™s a <a href="https://no-color.org/">list here</a>)</li>
</ul>

<p>Hereâ€™s an example of running <code>LS_COLORS=&#34;fi=0:di=0:ln=0:pi=0:so=0:bd=0:cd=0:or=0:ex=0&#34; ls</code>:</p>

<p><img src="https://jvns.ca/images/terminal-ls-colors.png"/></p>

<h3 id="problem-11-the-colours-in-vim">problem 11: the colours in vim</h3>

<p>I used to have a lot of problems with configuring my colours in vim â€“ Iâ€™d set
up my terminal colours in a way that I thought was okay, and then Iâ€™d start vim
and it would just be a disaster.</p>

<p>I think what was going on here is that today, there are two ways to set up a vim colorscheme in the terminal:</p>

<ol>
<li>using your ANSI terminal colours â€“ you tell vim which ANSI colour number to use for the background, for functions, etc.</li>
<li>using 24-bit hex colours â€“ instead of ANSI terminal colours, the vim colorscheme can use hex codes like #faea99 directly</li>
</ol>

<p>20 years ago when I started using vim, terminals with 24-bit hex color support
were a lot less common (or maybe they didnâ€™t exist at all), and vim certainly
didnâ€™t have support for using 24-bit colour in the terminal. From some quick
searching through git, it looks like <a href="https://github.com/vim/vim/commit/8a633e3427b47286869aa4b96f2bfc1fe65b25cd">vim added support for 24-bit colour in 2016</a>
â€“ just 8 years ago!</p>

<p>So to get colours to work properly in vim before 2016, you needed to synchronize
your terminal colorscheme and your vim colorscheme. <a href="https://github.com/chriskempson/base16-vim/blob/3be3cd82cd31acfcab9a41bad853d9c68d30478d/colors/base16-solarized-light.vim#L52-L71">Hereâ€™s what that looked like</a>,
the colorscheme needed to map the vim color classes like <code>cterm05</code> to ANSI colour numbers.</p>

<p>But in 2024, the story is really different! Vim (and Neovim, which I use now)
support 24-bit colours, and as of Neovim 0.10 (released in May 2024), the
<code>termguicolors</code> setting (which tells Vim to use 24-bit hex colours for
colorschemes) is <a href="https://neovim.io/doc/user/news-0.10.html">turned on by default</a> in any terminal with 24-bit
color support.</p>

<p>So this â€œyou need to synchronize your terminal colorscheme and your vim
colorschemeâ€ problem is not an issue anymore for me in 2024, since I
donâ€™t plan to use terminals without 24-bit color support in the future.</p>

<p>The biggest consequence for me of this whole thing is that I donâ€™t need base16
to set colors 16-21 to weird stuff anymore to integrate with vim â€“ I can just
use a terminal theme and a vim theme, and as long as the two themes use similar
colours (so itâ€™s not jarring for me to switch between them) thereâ€™s no problem.
I think I can just remove those parts from my <code>base16</code> shell script and totally
avoid the problem with ngrok and the weird orange background I talked about
above.</p>

<h3 id="some-more-problems-i-left-out">some more problems I left out</h3>

<p>I think there are a lot of issues around the intersection of multiple programs,
like using some combination tmux/ssh/vim that I couldnâ€™t figure out how to
reproduce well enough to talk about them. Also Iâ€™m sure I missed a lot of other
things too.</p>

<h3 id="base16-has-really-worked-for-me">base16 has really worked for me</h3>

<p>Iâ€™ve personally had a lot of success with using
<a href="https://github.com/chriskempson/base16-shell">base16-shell</a> with
<a href="https://github.com/chriskempson/base16-vim">base16-vim</a> â€“ I just need to add <a href="https://github.com/chriskempson/base16-shell?tab=readme-ov-file#fish">a couple of lines</a> to my
fish config to set it up (+ a few <code>.vimrc</code> lines) and then I can move on and
accept any remaining problems that that doesnâ€™t solve.</p>

<p>I donâ€™t think base16 is for everyone though, some limitations Iâ€™m aware
of with base16 that might make it not work for you:</p>

<ul>
<li>it comes with a limited set of builtin themes and you might not like any of them</li>
<li>the Solarized base16 theme (and maybe all of the themes?) sets the â€œbrightâ€
ANSI colours to be exactly the same as the normal colours, which might cause
a problem if youâ€™re relying on the â€œbrightâ€ colours to be different from the
regular ones</li>
<li>it sets colours 16-21 in order to give the vim colorschemes from <code>base16-vim</code>
access to more colours, which might not be relevant if you always use a
terminal with 24-bit color support, and can cause problems like the ngrok
issue above</li>
<li>also the way it sets colours 16-21 could be a problem in terminals that donâ€™t
have 256-color support, like the linux framebuffer terminal</li>
</ul>

<p>Apparently thereâ€™s a community fork of base16 called
<a href="https://github.com/tinted-theming/home">tinted-theming</a>, which I havenâ€™t
looked into much yet.</p>

<h3 id="some-other-colorscheme-tools">some other colorscheme tools</h3>

<p>Just one so far but Iâ€™ll link more if people tell me about them:</p>

<ul>
<li><a href="https://rootloops.sh/">rootloops.sh</a> for generating colorschemes (and <a href="https://hamvocke.com/blog/lets-create-a-terminal-color-scheme/">â€œletâ€™s create a terminal color schemeâ€</a>)</li>
</ul>

<h3 id="okay-that-was-a-lot">okay, that was a lot</h3>

<p>We talked about a lot in this post and  while I think learning about all these
details is kind of fun if Iâ€™m in the mood to do a deep dive, I find it SO
FRUSTRATING to deal with it when I just want my colours to work! Being
surprised by unreadable text and having to find a workaround is just not my
idea of a good day.</p>

<p>Personally Iâ€™m a zero-configuration kind of person and itâ€™s not that appealing
to me to have to put together a lot of custom configuration just to make my
colours in the terminal look acceptable. Iâ€™d much rather just have some
reasonable defaults that I donâ€™t have to change.</p>

<h3 id="minimum-contrast-seems-like-an-amazing-feature">minimum contrast seems like an amazing feature</h3>

<p>My one big takeaway from writing this was to turn on â€œminimum contrastâ€ in my
terminal, I think itâ€™s going to fix most of the occasional accidental
unreadable text issues I run into and Iâ€™m pretty excited about it.</p>

</div></div>
  </body>
</html>
