<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zig.news/xq/a-challenger-to-the-throne-of-vector-graphics-svg-is-dead-long-live-tinyvg-4on8">Original</a>
    <h1>TinyVG: A challenger to the throne of vector graphics</h1>
    
    <div id="readability-page-1" class="page"><div id="main-title">
            <p><img src="https://zig.news/images/8udRd_35R9eZo-Gd4-yRxTidjVwrypNmTzvO88NoaY4/s:1000:420/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL2tk/cXo0YmlhM3RseG00/cWdlZnY1LnBuZw" width="1000" height="420" alt="Cover image for A challenger to the throne of vector graphics. SVG is dead,  long live TinyVG!"/>
            </p>

          
        </div><div>

          <div data-article-id="100" id="article-body">
            

<p>No, seriously, hear me out!</p>

<p>I needed vector graphics for a Zig project and I figured that everyone inluding myself is using SVG. So I wanted to use SVG. What it learned in the process that <em>implementing</em> a new SVG library is hard.</p>

<p>First of all, SVG is built on top of several other technologies:</p>

<ul>
<li>XML</li>
<li>CSS</li>
<li>ECMAScript / JavaScript</li>
</ul>

<p>For the purpose of static graphics, we can ignore the scripting portion of that. But even without that, implementing both a good XML and CSS parser is a lot of work.</p>

<p>Then SVG on top. SVG is so complex that different implementations of SVG disagree how an image should look. Especially if that image contains <code>&lt;text&gt;</code>, as it depends on the system. What some of you probably learned by now is that if you want to have a redistributable SVG file, you have to have your authoring file in Inkscape, Illustrator, Batik, ... and you have your final file which has all texts converted to paths. Otherwise, the file will look very different on each machine. An example:<br/>
</p>

<div>
<pre><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;svg xmlns=&#34;http://www.w3.org/2000/svg&#34; version=&#34;1.1&#34; width=&#34;400&#34; height=&#34;150&#34; viewBox=&#34;0 0 400 150&#34;&gt;
  &lt;rect x=&#34;50&#34; y=&#34;50&#34; width=&#34;300&#34; height=&#34;50&#34; fill=&#34;red&#34; /&gt;
  &lt;text x=&#34;50&#34; y=&#34;100&#34; style=&#34;font-family: monospace; font-size: 50;&#34;&gt;Hello&lt;/text&gt;
&lt;/svg&gt;
</code></pre>
<div>
<p>
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 24 24"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewBox="0 0 24 24"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</p>
</div>
</div>



<p>How will this look in different browsers? Let&#39;s test!</p>



<p>ðŸ¤” That didn&#39;t go as expected. I <em>thought</em> that at least both files on my Linux machine look the same, but it seems like Firefox doesn&#39;t like the <code>font-size</code> specification, while Chrome and Edge do.</p>

<p>And there are more and more edge cases which make implementation SVG too complex. Files can be pulled in from external sources via <code>xlink</code>, file contents could be built by complex scripts, and so on. But even simpler files might break.</p>

<p><code>#FF000080</code> isn&#39;t a valid SVG color, but it&#39;s a valid HTML color. Chrome, Firefox and Edge show us a half-transparent red, while Inkscape and QtSvg show a black square.</p>

<p>All of this stuff made me realize: XML is meant to be an authoring file for vector graphics like <code>xcf</code> or <code>psd</code> which contains not only the final graphic information, but also how that graphic is constructed piece by piece.</p>

<p>What we really need is a format like PNG for vector graphics. Compact, versatile and simple to implement. What most of us don&#39;t need are <a href="https://dev.w3.org/SVG/tools/svgweb/samples/svg-files/anim1.svg">vector graphic animations</a> or <a href="https://dev.w3.org/SVG/tools/svgweb/samples/svg-files/snake.svg">vector graphic applications</a>. What we definitly don&#39;t need is a vector graphic format that can do <a href="https://twitter.com/pcwalton/status/1233786315163881474">raw sockets</a>.</p>

<p>After the reasearch I did to implement SVG in Zig, I was disappointed and angry that stuff like vector graphics is so complex and in my stubbornness I decided:</p>

<p><a href="https://zig.news/images/C6lVdV75bOf2UnCOsJ-9AWpMAbiQB03gV3nSzx4zig4/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL3Rq/bnJ1bXlwNHNzeWI5/bmE0aHZwLmpwZWc"><img src="https://zig.news/images/C6lVdV75bOf2UnCOsJ-9AWpMAbiQB03gV3nSzx4zig4/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL3Rq/bnJ1bXlwNHNzeWI5/bmE0aHZwLmpwZWc" alt="I&#39;ll make my own vector format, without blackjack and hookers." loading="lazy"/></a></p>



<p>I created a new format called <a href="https://tinyvg.tech/">Tiny Vector Graphics</a> or short TinyVG that tries to have 95% of the features we actually need from SVG (so shapes, colors, gradients, scalability) but not have all the things we typically don&#39;t need (animations, scripting, external resources, hierarchical document structure, ...).</p>

<p>As <a href="https://en.wikipedia.org/wiki/Log4Shell">recent developments</a> shows that complexity makes things susceptible to vulnerabilities, so it seems that <a href="https://phoboslab.org/log/2021/11/qoi-fast-lossless-image-compression">going the simple route</a> (like <a href="https://qoiformat.org/">QOI</a> did) is the right way.</p>

<h2>
  <a name="prior-art" href="#prior-art">
  </a>
  Prior Art
</h2>

<p>So before implementing a new graphics format, I looked at the things we have today:</p>

<ul>
<li>SVG is abundant. It is used nearly everywhere in Web and UI. Complexity is over the top.</li>
<li>
<a href="https://en.wikipedia.org/wiki/Haiku_Vector_Icon_Format">HVIF</a> seems promising, but the lack of documentation is shying me away</li>
<li>
<a href="https://de.wikipedia.org/wiki/Drawing_Interchange_Format">DXF</a> is mostly used in CAD, but doesn&#39;t seem to have widespread support outside of that realm.</li>
</ul>

<h2>
  <a name="design-goals" href="#design-goals">
  </a>
  Design Goals
</h2>

<p>Looking at these formats made me set my design goals:</p>

<ul>
<li>Compact binary encoding (Make it smaller than SVG)</li>
<li>Suitable for different platforms

<ul>
<li>GPU / Games</li>
<li>CPU / Desktop Applications</li>
<li>Web</li>
<li>Embedded</li>
</ul>


</li>
<li>Support a reasonable subset of SVG</li>
<li>Suitable for different use cases

<ul>
<li>Application/toolbar icons</li>
<li>Graphs and diagrams</li>
<li>Comics, mangas, pictures and other kinds of art</li>
</ul>


</li>
<li>Low implementation complexity (Make it simpler than SVG)</li>
</ul>

<p>Triggered by a discussion in the <a href="https://github.com/ziglang/zig/wiki/Community#discord">Zig discord</a>, I started to work on TinyVG in <a href="https://github.com/MasterQ32/TinyVG/commit/2ec91b389a0fa73f8eecc770b38953cd032f6330">September 2020</a> and in <a href="https://github.com/MasterQ32/TinyVG/commit/09c1dd277c4d1aa8aa01b0315bb7aa5a3f3fbe5a">May 2021</a> I got it to a state where I could live with it and use it for things in other projects:</p>

<p><a href="https://zig.news/images/36HL_eOd6fK6q52rxnBZvVINOjL5KRh8wNMN8f6PJ6M/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL21o/b3V2bTUyaW9zaTc2/azVjZzFyLnBuZw"><img src="https://zig.news/images/36HL_eOd6fK6q52rxnBZvVINOjL5KRh8wNMN8f6PJ6M/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL21o/b3V2bTUyaW9zaTc2/azVjZzFyLnBuZw" alt="Dunstwolke Android Application" loading="lazy"/></a></p>

<p>But then <a href="https://twitter.com/phoboslab">Dominic Szablewski</a> published the <a href="https://qoiformat.org/">The Quite OK Image Format</a> and showed me that there was interest in simpler formats. It inspired and motivated me to push for TinyVG completion and I got back to the project.</p>

<p>The project was already in an OK state, but I wanted to go better. I refactored pretty much everything, streamlined the design of the format and got some things right.</p>

<p>This work made TinyVG smaller <strong>and</strong> more flexible than before and <a href="https://tinyvg.tech/benchmark.htm">running benchmarks</a> with a SVG converter showed me that I was on the right path.</p>

<p>I got the file size down to 40% compared to optimized SVG while retaining visual fidelity:</p>

<p><a href="https://zig.news/images/-hRAAXTpD34XZXVR7S8Qdfp_Ndfj_R_E-yjHEbZ2CE8/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL3Bh/Z3Z3OXA2Ym0xbnFj/ZmVkYmV1LnBuZw"><img src="https://zig.news/images/-hRAAXTpD34XZXVR7S8Qdfp_Ndfj_R_E-yjHEbZ2CE8/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL3Bh/Z3Z3OXA2Ym0xbnFj/ZmVkYmV1LnBuZw" alt="Comparison between SVG and TVG" loading="lazy"/></a></p>

<p>The three images you see here are:</p>

<ul>
<li>(left) The original SVG file from the <a href="https://github.com/PapirusDevelopmentTeam/papirus-icon-theme">Papirus icon theme</a>
</li>
<li>(middle) My TinyVG software renderer output</li>
<li>(right) The TinyVG data rendered as SVG again</li>
</ul>

<p>There are <em>tiny</em> differences in the <a href="https://tinyvg.tech/benchmark/papirus.pdf">files</a>, but overall I&#39;m very happy with the conversion process.</p>



<p><a href="https://zig.news/images/Alwx6tYtALewaKjOSk0_5AI7Pl7MNtsvmRoJlhBcmJE/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL3Rq/dWNxMzk1bWpwamg3/N2JqNjhjLnBuZw"><img src="https://zig.news/images/Alwx6tYtALewaKjOSk0_5AI7Pl7MNtsvmRoJlhBcmJE/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL3Rq/dWNxMzk1bWpwamg3/N2JqNjhjLnBuZw" alt="tiger.svg rendered with TinyVG" loading="lazy"/></a></p>

<p>With this day, I release the <a href="https://github.com/TinyVG/specification/releases/tag/version1-rc1">first draft of the specification</a> into the wild and open for review.</p>

<h2>
  <a name="using-tinyvg" href="#using-tinyvg">
  </a>
  Using TinyVG
</h2>

<p>With the reference implementation is done and the first draft of the specification written, you can already go and try TinyVG!</p>

<p>On the <a href="https://tinyvg.tech/">website</a>, you can find the following things:</p>

<ul>
<li><a href="https://tinyvg.tech/download/specification.pdf">The current specification</a></li>
<li><a href="https://tinyvg.tech/download/text-format.txt">A description of the text format</a></li>
<li>Example files</li>
<li>Tooling to work with TinyVG, including a offline renderer and conversion tools.</li>
<li>A SDK containing a native library, a zig package and a polyfill</li>
<li><a href="https://tinyvg.tech/polyfill/index.htm">The polyfill demonstration</a></li>
<li>
<a href="https://tinyvg.tech/benchmark.htm">Benchmark Results</a> including comparison renderings and evaluation</li>
</ul>

<h2>
  <a name="mission-successful" href="#mission-successful">
  </a>
  Mission successful!
</h2>

<p>So let&#39;s recap if we succeeded in the goals set at the project start:</p>

<h3>
  <a name="compact-binary-encoding" href="#compact-binary-encoding">
  </a>
  Compact binary encoding
</h3>

<p>The benchmark shows that TinyVG is between 20% and 60% of an equivalent, optimized SVG file. This means the mission was a success in that regard. âœ…</p>

<h3>
  <a name="suitable-for-different-use-cases" href="#suitable-for-different-use-cases">
  </a>
  Suitable for different use cases
</h3>

<p>Both the <a href="https://tinyvg.tech/img/shield.png">Material Design</a> icon set as well as the <a href="https://tinyvg.tech/img/app-icon.png">Papirus</a> one can be converted to a large degree without any losses. This means that we can render application and toolbar icons very well.</p>

<p>The example files on the website also show examples for a <a href="https://tinyvg.tech/img/comic.png">comic</a>, a <a href="https://tinyvg.tech/img/chart.png">chart</a>, <a href="https://tinyvg.tech/img/flowchart.png">graph</a> and <a href="https://tinyvg.tech/img/tiger.png">art</a>.</p>

<p>So the planned use cases can be covered with TinyVG. âœ…</p>

<h3>
  <a name="support-a-reasonable-subset-of-svg" href="#support-a-reasonable-subset-of-svg">
  </a>
  Support a reasonable subset of SVG
</h3>

<p>This one is easily shown: We successfully converted a huge load of SVG files in the benchmark (roughly 3500 files) without much problems.</p>

<p>Perfect! âœ…</p>

<h3>
  <a name="suitable-for-applications" href="#suitable-for-applications">
  </a>
  Suitable for applications
</h3>

<p>There&#39;s both a CPU renderer implementation as well as a polyfill. This means we already have covered classic desktop applications as well as web content. There also is a Vulkan renderer implemented (not open source) for a older version of TinyVG, so GPU rendering also is covered.</p>

<p>But what about memory and cpu restricted environments like embedded platforms?</p>

<p>Let a photo speak for itself:</p>

<p><a href="https://zig.news/images/DOxgXVLRr-2khewPSfZYNMh1cn5qfo0CI6aK1TPv4ik/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL21t/N3Z2bWY1cjQzZDRn/M2RtMzd5LmpwZw"><img src="https://zig.news/images/DOxgXVLRr-2khewPSfZYNMh1cn5qfo0CI6aK1TPv4ik/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL21t/N3Z2bWY1cjQzZDRn/M2RtMzd5LmpwZw" alt="TinyVG graphics on a microcontroller" loading="lazy"/></a></p>

<p>This goal: Achieved! âœ…</p>

<h3>
  <a name="low-implementation-complexity" href="#low-implementation-complexity">
  </a>
  Low implementation complexity
</h3>

<p><em>Make it simpler than SVG</em>. Well, that&#39;s an easy one. But let&#39;s compare some real numbers!</p>

<p>The TinyVG SDK in total has roughly 4000 lines of Zig and 2000 lines of C#. The C# portion only implements <strong>only</strong> the SVG to TinyVG conversion, utilizing the <code>System.Xml.XmlSerializer</code> class for parsing XML. This means that there is low semantic checking and zero rendering involved. The Zig implementation though implements parsing the text <em>and</em> binary representation of TinyVG, and provides a software renderer as well. The code also includes the command line tools and native bindings.</p>

<p>To compare this to a SVG implementation, I&#39;ve chosen <a href="https://github.com/W3SS/libresvg">libresvg</a>, a Rust library. This library requires alone roughly 4000 lines of code for rendering SVG, while not implementing any rendering primivites itself (but using other libs for that). Also the parsing of XML is done via <a href="https://github.com/RazrFalcon/svgdom">another package</a> which has another 4000 lines of code to parse the SVG.</p>

<p>This shows that TinyVG can be fully implemented in a lower level language (Zig) with a low amount of code, while SVG requires substantially more code in languages with even a higher language of abstraction (C#, Rust).</p>

<p>Also the TinyVG spec is 14 pages long and won&#39;t grow by a lot if done more precise while the SVG 1.1 spec alone is 260 pages long, excluding the specifications for CSS, XML and ECMA-Script.</p>

<p>So I&#39;d say: This is definitly a success! âœ…</p>

<h2>
  <a name="contributing-and-community" href="#contributing-and-community">
  </a>
  Contributing and Community
</h2>

<p>If you are interested in TinyVG, you have the following option:</p>

<ul>
<li>Drop a comment here</li>
<li>Write me an email at <a href="mailto:contact@tinyvg.tech">contact@tinyvg.tech</a>
</li>
<li><a href="https://discord.gg/VfHSayTcgr">Join the Discord community</a></li>
<li><a href="https://github.com/TinyVG">Fork and contribute on GitHub</a></li>
</ul>

<h2>
  <a name="frequently-asked-questions" href="#frequently-asked-questions">
  </a>
  Frequently asked questions
</h2>

<blockquote>
<p>Did you have problems implementing TinyVG?</p>
</blockquote>

<h3>
  <a name="not" href="#not">
  </a>
  Not
</h3>

<p><a href="https://zig.news/images/ejU811YlXI7eQTxwa9D2ioCQBsYCzLf-tWpX1rITNk8/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzLzF1/MHoycXdjdjlkdDJ4/c3I4NXg1LnBuZw"><img src="https://zig.news/images/ejU811YlXI7eQTxwa9D2ioCQBsYCzLf-tWpX1rITNk8/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzLzF1/MHoycXdjdjlkdDJ4/c3I4NXg1LnBuZw" alt="Alt Text" loading="lazy"/></a></p>

<h3>
  <a name="at" href="#at">
  </a>
  At
</h3>

<p><a href="https://zig.news/images/SoNrXRP6ad7Jg_wLYEkteFqHyqkvgwdziyZ1dNSEKj0/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzLzU5/a2YyemwwNWw5M21l/azE4b3FpLnBuZw"><img src="https://zig.news/images/SoNrXRP6ad7Jg_wLYEkteFqHyqkvgwdziyZ1dNSEKj0/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzLzU5/a2YyemwwNWw5M21l/azE4b3FpLnBuZw" alt="Alt Text" loading="lazy"/></a></p>

<h3>
  <a name="all" href="#all">
  </a>
  All.
</h3>

<p><a href="https://zig.news/images/fO0EC49k-le0RZOw19Yh3KJgwfh6w3CAFJRmnkWlMDk/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL20x/anJxZ2JydGJpeHhy/OG5qdWx3LnBuZw"><img src="https://zig.news/images/fO0EC49k-le0RZOw19Yh3KJgwfh6w3CAFJRmnkWlMDk/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzL20x/anJxZ2JydGJpeHhy/OG5qdWx3LnBuZw" alt="Alt Text" loading="lazy"/></a></p>

<h3>
  <a name="see" href="#see">
  </a>
  See!
</h3>

<p><a href="https://zig.news/images/Aq-dlcy_hPcMOTx6r0TrdJaAn860WhMHDYc1dj0uS7I/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzLzg4/MmJxcWZpb2Z6OWp0/MmpwaDF5LnBuZw"><img src="https://zig.news/images/Aq-dlcy_hPcMOTx6r0TrdJaAn860WhMHDYc1dj0uS7I/w:880/mb:500000/aHR0cHM6Ly96aWcu/bmV3cy91cGxvYWRz/L2FydGljbGVzLzg4/MmJxcWZpb2Z6OWp0/MmpwaDF5LnBuZw" alt="Alt Text" loading="lazy"/></a></p>

<p><strong>Spoiler:</strong> <em>This section isn&#39;t really a FAQ, but I wanted to share these images anyways</em></p>


          </div>

        </div></div>
  </body>
</html>
