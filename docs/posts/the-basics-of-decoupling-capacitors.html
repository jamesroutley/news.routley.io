<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lcamtuf.substack.com/p/the-basics-of-decoupling-capacitors">Original</a>
    <h1>The basics of decoupling capacitors</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div class=""><div><div dir="auto"><p>Two decades ago, to build a portable music player, you had to clobber together several hundred electronic components. Today, you can accomplish the same with a single chip and a dozen passives. Heck, you might even get Wi-Fi and Bluetooth for free.</p><p>One of the few discrete components that survive and thrive in the face of growing integration is the humble decoupling capacitor. It’s not just that the device is hard to manufacture on the die of an integrated circuit; in the world high data speeds and low supply voltages, it has an increasingly important role to play in keeping the circuits humming along.</p><p>Among hobbyists, the understanding of decoupling caps continues to be hit-and-miss. Some folks skip them altogether and live to tell; others follow ancient lore of uncertain origins, producing monstrosities such as this:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png" width="1174" height="543" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/f5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:543,&#34;width&#34;:1174,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:null,&#34;alt&#34;:&#34;stm32&#34;,&#34;title&#34;:null,&#34;type&#34;:null,&#34;href&#34;:null,&#34;belowTheFold&#34;:false,&#34;internalRedirect&#34;:null}" alt="stm32" title="stm32" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff5ae9e5b-b8ce-4cfc-8a3c-495afcb057cc_1174x543.png 1456w" sizes="100vw"/></picture></div></a></figure></div><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png" width="817" height="330" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:330,&#34;width&#34;:817,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:10240,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F85ee913b-a94d-46f0-9590-ef087bd70fdd_817x330.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption><em>Decoupling capacitor galore. Found on the internet.</em></figcaption></figure></div><p>In this article, I’m hoping to cast some light on the actual role of decoupling capacitors in digital circuits — and to offer advice on how to integrate them into your designs without going overboard.</p><p>In a steady state, a typical CMOS integrated circuit needs very little power. The chip’s energy consumption is associated predominantly with state transitions — that is, toggling between “zero” and “one”. That’s because the process requires moving electrons back and forth to charge or discharge the gates of field effect transistors inside the chip.</p><p>Some internal state transitions require relatively little current, but others are more demanding; this is particularly true for the operation of larger transistors that drive output lines. To toggle them at at megahertz speeds — a task that demands rapid rise and fall times — the chip must momentarily source significant currents; the phenomenon lasts just picoseconds or nanoseconds, but can involve quite a few amps.</p><p>This poses a challenge. At high currents, PCB traces exhibit both resistive losses and inductive coupling; the demand response characteristics of the power supply also get in the way. In the end, even seemingly minor digital switching can cause significant voltage fluctuations and electrical noise across the entire circuit. </p><p>The following oscilloscope plot shows the effect of an AVR microcontroller repeatedly toggling a couple of unconnected output pins while running at the relatively low speed of 8 MHz:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg" width="1456" height="819" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:819,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:313770,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/jpeg&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F537abad0-f47d-4247-9355-e7e8b9737616_1600x900.jpeg 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption><em>Observed supply voltage noise for a simple MCU application.</em></figcaption></figure></div><p><span>The peak-to-peak amplitude of this noise, as sampled at the MCU supply pins, is almost 2 volts — about 40% of the nominal supply voltage. This in itself can be enough to destabilize the MCU. Just as important, because the chip no longer has a stable Vdd and GND reference shared with other parts of the circuit, interfacing it to other devices might prove difficult. It’s not that this setup is </span><em>bound</em><span> to malfunction, but unexplained and hard-to-diagnose issues can creep up with ease.</span></p><p>This brings us to the purpose of decoupling capacitors: they are placed across the voltage supply lines and physically close to the offending chip to handle switching transients while preventing high currents and minimizing voltage fluctuations in other parts of the circuitry.</p><p>To do this, the capacitors must have low impedance (i.e., be able to charge and discharge quickly); for this reason, multilayer ceramics (MLCCs) should be used instead of the comparatively sluggish electrolytic caps. But above all, to work effectively, the capacitors must be as close as practical to the chip’s supply pins. The following oscilloscope trace illustrates the point:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg" width="1456" height="791" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/b7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:791,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:345053,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/jpeg&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb7b997a2-b4f7-4d4c-8bf4-efedf77560ce_1600x869.jpeg 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption><em>The effect of capacitor distance on switching-induced noise.</em></figcaption></figure></div><p>The sizing of the capacitors is not critical; a single 100 nF MLCC, operated well clear of its maximum voltage, is typically enough to deal with all intrinsic switching currents of PIC, AVR, or ARM microcontrollers. More capacitance might be appropriate if the MCU is driving substantial loads. This can be accomplished with a single larger MLCC (e.g., 1 or 10 µF); with several smaller MLCCs in parallel; or with a small fast-acting MLCC coupled with a larger but slower aluminum-polymer cap (10-100 µF), the latter possibly placed some distance away.</p><p>A well-chosen decoupling capacitor can greatly reduce switching noise, but the device has a finite capacitance and a non-zero impedance (increasing not only toward DC but also toward very high frequencies — the latter due to parasitic inductance). In other words, some attenuated noise will still get through.</p><p>In sensitive circuits, the problem of high-frequency noise can be further mitigated by placing a small ferrite bead in line with the supply and ahead of the decoupling caps. The inductor provides a low impedance path (few milliohms) for DC signals while impeding megahertz-range AC much better than a capacitor can. Here’s an example from the spec for SAM S70 MCUs, recommending the use of two beads with an impedance of 470 Ω at 100 MHz on the supply lines for the USB transceiver and the phase-locked loop (PLL) clock multiplier:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png" width="1395" height="1006" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1006,&#34;width&#34;:1395,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:57412,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2953c87d-7eab-403d-875c-a0438b3cae18_1395x1006.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a><figcaption><em>Noise-filtering beads on MCU supply lines.</em></figcaption></figure></div><p>It should be underscored that the arrangement doesn’t eliminate switching noise; it merely contains it to the section between the MCU and the decoupling capacitor, protecting the remaining parts of your circuit. This is analogous to the use of ferrite EMI filters mounted on some cables and found inside quality power supplies.</p><p>A related trick is to put ferrite beads on MCU output lines; this takes the edge off fast-rising square wave signals, and can reduce needless inrush currents when operating slower buses such as I²C or SPI.</p><p>The datasheets for some digital chips will outline a suggested way of decoupling them. These recommendations should not be ignored, but are not to be taken as gospel. The manufacturer is trying to cover a variety of extremes, including:</p><ul><li><p>Circuits operated at the lowest permissible supply voltage,</p></li><li><p>Devices running at the maximum supported clock speed,</p></li><li><p>Peak utilization of on-chip peripherals,</p></li><li><p>The customer using the worst decoupling capacitors money can buy (e.g., the &#34;Y5V” variety that loses ~80% of rated capacitance when operated at elevated temperatures or near the cap’s maximum voltage).</p></li></ul><p>Further, the manufacturer is making assumptions about customers’ design preferences. A typical 100 nF MLCC costs about $0.005 a piece; in contrast, a 10 µF aluminum-polymer cap is about $0.25. A customer doing robotic assembly might favor a dozen MLCCs in lieu of a single MLCC paired with a polymer capacitor. A hobbyist soldering by hand might not.</p><p>Instead of blindly following the spec — a practice that still doesn’t guarantee success — it can more useful to validate your design in three ways:</p><ul><li><p>Examine circuit supply noise under normal operating conditions. If the peaks exceed maximum permissible supply ripple, minimum supply voltage, or maximum supply voltage for the digital components, you should improve the design.</p></li><li><p>If relevant in your project, confirm that signals on any high-speed output busses (e.g., USB) look correct, especially in terms of expected rise and fall times, noise, and any periodic glitches. Oscilloscope “eye diagrams” can help.</p></li><li><p>As a final test, observe the circuit with IC supply voltage reduced 10-20% from the design goal. If the digital circuitry continues to operate correctly, you likely have a good safety margin when it comes to switching noise.</p></li></ul><p>There is this old adage that for optimal decoupling, you must combine at least three capacitors, one or two decades (orders of magnitude) apart. The exact progression of recommended values changes from one oral account to another, but the bottom line is that if you don’t heed the warning, some terrible fate awaits.</p><p>The advice made some sense back when each of these capacitors would be made in a different technology. The lowest capacitance would be ceramic, offering low impedance but not packing enough punch to smooth out longer-lasting flukes; the middle cap could be tantalum, offering balanced performance but not excelling in any dimension; and the last one would be aluminum electrolytic, delivering poor high-frequency response but storing quite a bit of juice.</p><p>Today, low-cost MLCCs combine high capacitance and low impedance across a wide range of frequencies, so there’s usually little to be gained by playing such tricks — at least not for circuits operating at “hobby” speeds. A single 100 nF or 1 µF MLCC per each functionally distinct digital voltage supply line is almost always enough.</p><p>It is true that at very high frequencies — hundreds of megahertz — the capacitor’s residual inductance becomes a limiting factor. At that point, combining multiple different capacitors can offer somewhat better wideband noise suppression at the expense of potentially creating undesirable anti-resonance peaks in the system (rendering it ineffective at dealing with a handful of other frequencies). That said, a simpler solution with fewer side effects is to use a specialized low-inductance (“low-ESL”) MLCC.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg" width="1456" height="972" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/ec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg&#34;,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:972,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:1079142,&#34;alt&#34;:&#34;&#34;,&#34;title&#34;:null,&#34;type&#34;:&#34;image/jpeg&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;internalRedirect&#34;:null}" alt="" title="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fec140c0a-1bc3-4896-a878-ba41588ffbf3_1600x1068.jpeg 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p><em><span>For more articles about electronics, see </span><a href="https://lcamtuf.coredump.cx/offsite.shtml" rel="">this index page</a><span>.</span></em></p></div></div></div></article></div></div></div>
  </body>
</html>
