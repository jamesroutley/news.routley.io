<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://antonz.org/sqlean-time/">Original</a>
    <h1>Show HN: High-precision date/time in SQLite</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div><div><header></header><p>While SQLite provides a certain number of date functions, I wanted something more. So I&#39;ve created
<code>sqlean-time</code> — a high-precision date/time extension with a structured API and a rich set of functions.</p><blockquote><p><strong>Note</strong>. Adding extensions to SQLite is a breeze. Download a file, run one database command — and you are good to go.</p></blockquote><p><a href="#concepts">Concepts</a> •
<a href="#creating-time-values">Creating values</a> •
<a href="#extracting-time-fields">Extracting fields</a> •
<a href="#unix-time">Unix time</a> •
<a href="#time-comparison">Time comparison</a> •
<a href="#time-arithmetic">Time arithmetic</a> •
<a href="#rounding">Rounding</a> •
<a href="#formatting">Formatting</a> •
<a href="#acknowledgements">Acknowledgements</a> •
<a href="#installation-and-usage">Installation and usage</a></p><h2 id="concepts">Concepts</h2><p>This extension works with two types of values: Time and Duration.</p><div><pre tabindex="0"><code data-lang="text"><span><span>  Time
</span></span><span><span>
</span></span><span><span>  since     within
</span></span><span><span>  0-time    second
</span></span><span><span>┌─────────┬─────────────┐
</span></span><span><span>│ seconds │ nanoseconds │
</span></span><span><span>└─────────┴─────────────┘
</span></span><span><span>  64 bit    32 bit
</span></span></code></pre></div><p>Time is a pair (seconds, nanoseconds), where <code>seconds</code> is the 64-bit number of seconds since zero time (0001-01-01 00:00:00 UTC) and <code>nanoseconds</code> is the number of nanoseconds within the current second (0-999999999).</p><p>For maximum flexibility, you can store time values in their internal representation (a 13-byte BLOB). This allows you to represent dates for billions of years in the past and future with nanosecond precision.</p><p>Alternatively, you can store time values as a NUMBER (64-bit integer) of seconds (milli-, micro- or nanoseconds) since the Unix epoch (1970-01-01 00:00:00 UTC). In this case, the range of representable dates depends on the unit of time used:</p><ul><li>Seconds: billions of years into the past or future with second precision.</li><li>Milliseconds: 292 million years before or after 1970 with millisecond precision.</li><li>Microseconds: years from -290307 to 294246 with microsecond precision.</li><li>Nanoseconds: years from 1678 to 2262 with nanosecond precision.</li></ul><p>Time is always stored and operated in UTC, but you can convert it from/to a specific timezone offset.</p><div><pre tabindex="0"><code data-lang="text"><span><span>  Duration
</span></span><span><span>┌─────────────┐
</span></span><span><span>│ nanoseconds │
</span></span><span><span>└─────────────┘
</span></span><span><span>  64 bit
</span></span></code></pre></div><p>Duration is a 64-bit number of nanoseconds, so it can represent values up to about 290 years. You can store duration values as NUMBER.</p><p>The calendrical calculations always assume a Gregorian calendar, with no leap seconds.</p><h2 id="creating-time-values">Creating time values</h2><p>There are two basic constructors. For the current time:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_now</span>());
</span></span><span><span><span>-- 2024-08-06T21:22:15.431295000Z
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>2024-08-06T21:22:15.431295000Z
</span></span></code></pre></div><p>And for a specific date/time:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 2011-11-18T00:00:00Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>666777888</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35.666777888Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>0</span>, <span>3</span><span>*</span><span>3600</span>));
</span></span><span><span><span>-- 2011-11-18T12:56:35Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>666777888</span>, <span>3</span><span>*</span><span>3600</span>));
</span></span><span><span><span>-- 2011-11-18T12:56:35.666777888Z
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>2011-11-18T00:00:00Z
</span></span><span><span>2011-11-18T15:56:35Z
</span></span><span><span>2011-11-18T15:56:35.666777888Z
</span></span><span><span>2011-11-18T12:56:35Z
</span></span><span><span>2011-11-18T12:56:35.666777888Z
</span></span></code></pre></div><p>There are a number of functions for extracting different date/time fields:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>&#39;year    = &#39;</span> <span>||</span> <span>time_get_year</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;month   = &#39;</span> <span>||</span> <span>time_get_month</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;day     = &#39;</span> <span>||</span> <span>time_get_day</span>(<span>time_now</span>());
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;hour    = &#39;</span> <span>||</span> <span>time_get_hour</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;minute  = &#39;</span> <span>||</span> <span>time_get_minute</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;second  = &#39;</span> <span>||</span> <span>time_get_second</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;nanosec = &#39;</span> <span>||</span> <span>time_get_nano</span>(<span>time_now</span>());
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;weekday = &#39;</span> <span>||</span> <span>time_get_weekday</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;yearday = &#39;</span> <span>||</span> <span>time_get_yearday</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;isoyear = &#39;</span> <span>||</span> <span>time_get_isoyear</span>(<span>time_now</span>());
</span></span><span><span><span>select</span> <span>&#39;isoweek = &#39;</span> <span>||</span> <span>time_get_isoweek</span>(<span>time_now</span>());
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>year    = 2024
</span></span><span><span>month   = 8
</span></span><span><span>day     = 8
</span></span><span><span>hour    = 11
</span></span><span><span>minute  = 2
</span></span><span><span>second  = 29
</span></span><span><span>nanosec = 646015917
</span></span><span><span>weekday = 4
</span></span><span><span>yearday = 221
</span></span><span><span>isoyear = 2024
</span></span><span><span>isoweek = 32
</span></span></code></pre></div><p>There is also a generic <code>time_get</code> function for extracting time fields by name:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>&#39;millennium = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;millennium&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;century = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;century&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;decade  = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;decade&#39;</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;year    = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;year&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;quarter = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;quarter&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;month   = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;month&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;day     = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;day&#39;</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;hour    = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;hour&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;minute  = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;minute&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;second  = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;second&#39;</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;milli   = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;milli&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;micro   = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;micro&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;nano    = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;nano&#39;</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;isoyear = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;isoyear&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;isweek  = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;isoweek&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;isodow  = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;isodow&#39;</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;yearday = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;yearday&#39;</span>);
</span></span><span><span><span>select</span> <span>&#39;weekday = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;weekday&#39;</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>&#39;epoch   = &#39;</span> <span>||</span> <span>time_get</span>(<span>time_now</span>(), <span>&#39;epoch&#39;</span>);
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>millennium = 2
</span></span><span><span>century = 20
</span></span><span><span>decade  = 202
</span></span><span><span>year    = 2024
</span></span><span><span>quarter = 3
</span></span><span><span>month   = 8
</span></span><span><span>day     = 8
</span></span><span><span>hour    = 11
</span></span><span><span>minute  = 7
</span></span><span><span>second  = 8.800600319
</span></span><span><span>milli   = 800
</span></span><span><span>micro   = 800733
</span></span><span><span>nano    = 800750131
</span></span><span><span>isoyear = 2024
</span></span><span><span>isweek  = 32
</span></span><span><span>isodow  = 4
</span></span><span><span>yearday = 221
</span></span><span><span>weekday = 4
</span></span><span><span>epoch   = 1723115228.80122
</span></span></code></pre></div><h2 id="unix-time">Unix time</h2><p>There are functions for creating time values from Unix time (time since the Unix epoch — January 1, 1970 UTC):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_unix</span>(<span>1321631795</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_unix</span>(<span>1321631795</span>, <span>666777888</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35.666777888Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_milli</span>(<span>1321631795666</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35.666000000Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_micro</span>(<span>1321631795666777</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35.666777000Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_nano</span>(<span>1321631795666777888</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35.666777888Z
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>2011-11-18T15:56:35Z
</span></span><span><span>2011-11-18T15:56:35.666777888Z
</span></span><span><span>2011-11-18T15:56:35.666000000Z
</span></span><span><span>2011-11-18T15:56:35.666777000Z
</span></span><span><span>2011-11-18T15:56:35.666777888Z
</span></span></code></pre></div><p>And functions for converting time values back to Unix time:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_to_unix</span>(<span>time_now</span>());
</span></span><span><span><span>-- 1722979335
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_to_milli</span>(<span>time_now</span>());
</span></span><span><span><span>-- 1722979335431
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_to_micro</span>(<span>time_now</span>());
</span></span><span><span><span>-- 1722979335431295
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_to_nano</span>(<span>time_now</span>());
</span></span><span><span><span>-- 1722979335431295000
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>1723119379
</span></span><span><span>1723119379000
</span></span><span><span>1723119379000192
</span></span><span><span>1723119379000199404
</span></span></code></pre></div><p>Unix-like operating systems often record time as a 32-bit number of seconds, but since <code>time_to_unix</code> returns a 64-bit value, it is valid for billions of years into the past or future. <code>time_to_milli</code> can represent dates 292 million years before or after 1970, <code>time_to_micro</code> — years from -290307 to 294246, and <code>time_to_nano</code> — years from 1678 to 2262.</p><h2 id="time-comparison">Time comparison</h2><p><code>time_after</code>, <code>time_before</code> and <code>time_compare</code> compare time values:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_after</span>(<span>time_now</span>(), <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 1
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_before</span>(<span>time_now</span>(), <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 0
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_compare</span>(<span>time_now</span>(), <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 1
</span></span></span><span><span><span></span><span>select</span> <span>time_compare</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>), <span>time_now</span>());
</span></span><span><span><span>-- -1
</span></span></span><span><span><span></span><span>select</span> <span>time_compare</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>), <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 0
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><p><code>time_equal</code> reports whether two time values represent the same time instant:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_equal</span>(<span>time_now</span>(), <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 0
</span></span></span><span><span><span></span><span>select</span> <span>time_equal</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>), <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 1
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><h2 id="time-arithmetic">Time arithmetic</h2><p><code>time_add</code> adds duration to a time value (use negative duration to subtract):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_add</span>(<span>time_now</span>(), <span>24</span><span>*</span><span>dur_h</span>()));
</span></span><span><span><span>-- 2024-08-07T21:22:15.431295000Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_add</span>(<span>time_now</span>(), <span>60</span><span>*</span><span>dur_m</span>()));
</span></span><span><span><span>-- 2024-08-06T22:22:15.431295000Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_add</span>(<span>time_now</span>(), <span>5</span><span>*</span><span>dur_m</span>()<span>+</span><span>30</span><span>*</span><span>dur_s</span>()));
</span></span><span><span><span>-- 2024-08-06T21:27:45.431295000Z
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>2024-08-09T12:28:16.686654780Z
</span></span><span><span>2024-08-08T13:28:16.686695178Z
</span></span><span><span>2024-08-08T12:33:46.686707964Z
</span></span></code></pre></div><p>You can use the following duration constants:</p><ul><li><code>dur_us()</code> - 1 microsecond;</li><li><code>dur_ms()</code> - 1 millisecond;</li><li><code>dur_s()</code> - 1 second;</li><li><code>dur_m()</code> - 1 minute;</li><li><code>dur_h()</code> - 1 hour.</li></ul><p>Do not use <code>time_add</code> to add days, months or years. Use <code>time_add_date</code> instead.</p><p><code>time_add_date</code> adds a given number of years, months, and days to a time value (use negative values to subtract):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_fmt_date</span>(<span>time_add_date</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>), <span>5</span>));
</span></span><span><span><span>-- 2016-11-18
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_date</span>(<span>time_add_date</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>), <span>3</span>, <span>5</span>));
</span></span><span><span><span>-- 2015-04-18
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_date</span>(<span>time_add_date</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>), <span>3</span>, <span>5</span>, <span>-</span><span>10</span>));
</span></span><span><span><span>-- 2015-04-08
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>2016-11-18
</span></span><span><span>2015-04-18
</span></span><span><span>2015-04-08
</span></span></code></pre></div><p><code>time_sub</code> returns the duration between two time values (in nanoseconds):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_sub</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>19</span>), <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 86400000000000
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_sub</span>(
</span></span><span><span>  <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>16</span>, <span>56</span>, <span>35</span>),
</span></span><span><span>  <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>)
</span></span><span><span>);
</span></span><span><span><span>-- 3600000000000
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_sub</span>(<span>time_unix</span>(<span>1321631795</span>, <span>5000000</span>), <span>time_unix</span>(<span>1321631795</span>, <span>0</span>));
</span></span><span><span><span>-- 5000000
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>86400000000000
</span></span><span><span>3600000000000
</span></span><span><span>5000000
</span></span></code></pre></div><p><code>time_since</code> returns the time elapsed since a given time (in nanoseconds):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_since</span>(<span>time_now</span>());
</span></span><span><span><span>-- 5000
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><p><code>time_until</code> returns the duration until a given time (in nanoseconds):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_until</span>(<span>time_date</span>(<span>2024</span>, <span>9</span>, <span>1</span>));
</span></span><span><span><span>-- 2144479530297000
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><h2 id="rounding">Rounding</h2><p><code>time_trunc</code> truncates a time value to the precision specified by a given field:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>with</span> <span>t</span> <span>as</span> (
</span></span><span><span>    <span>select</span> <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>666777888</span>) <span>as</span> <span>v</span>
</span></span><span><span>)
</span></span><span><span><span>select</span> <span>&#39;original   = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>t</span>.<span>v</span>) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;millennium = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;millennium&#39;</span>)) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;century    = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;century&#39;</span>))    <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;decade     = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;decade&#39;</span>))     <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;year       = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;year&#39;</span>))       <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;quarter    = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;quarter&#39;</span>))    <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;month      = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;month&#39;</span>))      <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;week       = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;week&#39;</span>))       <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;day        = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;day&#39;</span>))        <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;hour       = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;hour&#39;</span>))       <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;minute     = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;minute&#39;</span>))     <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;second     = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;second&#39;</span>))     <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;milli      = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;milli&#39;</span>))      <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;micro      = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>&#39;micro&#39;</span>))      <span>from</span> <span>t</span>;
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>original   = 2011-11-18T15:56:35.666777888Z
</span></span><span><span>millennium = 2000-01-01T00:00:00Z
</span></span><span><span>century    = 2000-01-01T00:00:00Z
</span></span><span><span>decade     = 2010-01-01T00:00:00Z
</span></span><span><span>year       = 2011-01-01T00:00:00Z
</span></span><span><span>quarter    = 2011-10-01T00:00:00Z
</span></span><span><span>month      = 2011-11-01T00:00:00Z
</span></span><span><span>week       = 2011-11-12T00:00:00Z
</span></span><span><span>day        = 2011-11-18T00:00:00Z
</span></span><span><span>hour       = 2011-11-18T15:00:00Z
</span></span><span><span>minute     = 2011-11-18T15:56:00Z
</span></span><span><span>second     = 2011-11-18T15:56:35Z
</span></span><span><span>milli      = 2011-11-18T15:56:35.666000000Z
</span></span><span><span>micro      = 2011-11-18T15:56:35.666777000Z
</span></span></code></pre></div><p>Alternatively, <code>time_trunc</code> rounds a time value down to a multiple of a given duration:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>with</span> <span>t</span> <span>as</span> (
</span></span><span><span>    <span>select</span> <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>666777888</span>) <span>as</span> <span>v</span>
</span></span><span><span>)
</span></span><span><span><span>select</span> <span>&#39;t   = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>t</span>.<span>v</span>) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;12h = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>12</span><span>*</span><span>dur_h</span>())) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;1h  = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>dur_h</span>()))    <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;30m = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>30</span><span>*</span><span>dur_m</span>())) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;1m  = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>dur_m</span>()))    <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;30s = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>30</span><span>*</span><span>dur_s</span>())) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;1s  = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_trunc</span>(<span>t</span>.<span>v</span>, <span>dur_s</span>()))    <span>from</span> <span>t</span>;
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>t   = 2011-11-18T15:56:35.666777888Z
</span></span><span><span>12h = 2011-11-18T12:00:00Z
</span></span><span><span>1h  = 2011-11-18T15:00:00Z
</span></span><span><span>30m = 2011-11-18T15:30:00Z
</span></span><span><span>1m  = 2011-11-18T15:56:00Z
</span></span><span><span>30s = 2011-11-18T15:56:30Z
</span></span><span><span>1s  = 2011-11-18T15:56:35Z
</span></span></code></pre></div><p><code>time_round</code> rounds a time value to the nearest multiple of a given duration:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>with</span> <span>t</span> <span>as</span> (
</span></span><span><span>    <span>select</span> <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>666777888</span>) <span>as</span> <span>v</span>
</span></span><span><span>)
</span></span><span><span><span>select</span> <span>&#39;t   = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>t</span>.<span>v</span>) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;12h = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_round</span>(<span>t</span>.<span>v</span>, <span>12</span><span>*</span><span>dur_h</span>())) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;1h  = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_round</span>(<span>t</span>.<span>v</span>, <span>dur_h</span>()))    <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;30m = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_round</span>(<span>t</span>.<span>v</span>, <span>30</span><span>*</span><span>dur_m</span>())) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;1m  = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_round</span>(<span>t</span>.<span>v</span>, <span>dur_m</span>()))    <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;30s = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_round</span>(<span>t</span>.<span>v</span>, <span>30</span><span>*</span><span>dur_s</span>())) <span>from</span> <span>t</span> <span>union</span> <span>all</span>
</span></span><span><span><span>select</span> <span>&#39;1s  = &#39;</span> <span>||</span> <span>time_fmt_iso</span>(<span>time_round</span>(<span>t</span>.<span>v</span>, <span>dur_s</span>()))    <span>from</span> <span>t</span>;
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>t   = 2011-11-18T15:56:35.666777888Z
</span></span><span><span>12h = 2011-11-18T12:00:00Z
</span></span><span><span>1h  = 2011-11-18T16:00:00Z
</span></span><span><span>30m = 2011-11-18T16:00:00Z
</span></span><span><span>1m  = 2011-11-18T15:57:00Z
</span></span><span><span>30s = 2011-11-18T15:56:30Z
</span></span><span><span>1s  = 2011-11-18T15:56:36Z
</span></span></code></pre></div><h2 id="formatting">Formatting</h2><p><code>time_fmt_iso</code> returns an ISO 8601 time string for a given time value (optionally converts the time value to a given timezone offset before formatting):</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>666777888</span>), <span>3</span><span>*</span><span>3600</span>);
</span></span><span><span><span>-- 2011-11-18T18:56:35.666777888+03:00
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>, <span>666777888</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35.666777888Z
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>), <span>3</span><span>*</span><span>3600</span>);
</span></span><span><span><span>-- 2011-11-18T18:56:35+03:00
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_iso</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>));
</span></span><span><span><span>-- 2011-11-18T15:56:35Z
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>2011-11-18T18:56:35.666777888+03:00
</span></span><span><span>2011-11-18T15:56:35.666777888Z
</span></span><span><span>2011-11-18T18:56:35+03:00
</span></span><span><span>2011-11-18T15:56:35Z
</span></span></code></pre></div><p><code>time_fmt_datetime</code>, <code>time_fmt_date</code> and <code>time_fmt_time</code> return a datetime/date/time string for a given time value:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_fmt_datetime</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>), <span>3</span><span>*</span><span>3600</span>);
</span></span><span><span><span>-- 2011-11-18 18:56:35
</span></span></span><span><span><span></span><span>select</span> <span>time_fmt_datetime</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>));
</span></span><span><span><span>-- 2011-11-18 15:56:35
</span></span></span><span><span><span></span><span>select</span> <span>time_fmt_datetime</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 2011-11-18 00:00:00
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_date</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>), <span>12</span><span>*</span><span>3600</span>);
</span></span><span><span><span>-- 2011-11-19
</span></span></span><span><span><span></span><span>select</span> <span>time_fmt_date</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>));
</span></span><span><span><span>-- 2011-11-18
</span></span></span><span><span><span></span><span>select</span> <span>time_fmt_date</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 2011-11-18
</span></span></span><span><span><span></span>
</span></span><span><span><span>select</span> <span>time_fmt_time</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>), <span>3</span><span>*</span><span>3600</span>);
</span></span><span><span><span>-- 18:56:35
</span></span></span><span><span><span></span><span>select</span> <span>time_fmt_time</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>, <span>15</span>, <span>56</span>, <span>35</span>));
</span></span><span><span><span>-- 15:56:35
</span></span></span><span><span><span></span><span>select</span> <span>time_fmt_time</span>(<span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>));
</span></span><span><span><span>-- 00:00:00
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>2011-11-18 18:56:35
</span></span><span><span>2011-11-18 15:56:35
</span></span><span><span>2011-11-18 00:00:00
</span></span><span><span>2011-11-19
</span></span><span><span>2011-11-18
</span></span><span><span>2011-11-18
</span></span><span><span>18:56:35
</span></span><span><span>15:56:35
</span></span><span><span>00:00:00
</span></span></code></pre></div><p><code>time_parse</code> parses a formatted string and returns the time value it represents:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18T15:56:35.666777888Z&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_unix</span>(<span>1321631795</span>, <span>666777888</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18T19:26:35.666777888+03:30&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_unix</span>(<span>1321631795</span>, <span>666777888</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18T12:26:35.666777888-03:30&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_unix</span>(<span>1321631795</span>, <span>666777888</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18T15:56:35Z&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_unix</span>(<span>1321631795</span>, <span>0</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18T19:26:35+03:30&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_unix</span>(<span>1321631795</span>, <span>0</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18T12:26:35-03:30&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_unix</span>(<span>1321631795</span>, <span>0</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18 15:56:35&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_unix</span>(<span>1321631795</span>, <span>0</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;2011-11-18&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_date</span>(<span>2011</span>, <span>11</span>, <span>18</span>);
</span></span><span><span>
</span></span><span><span><span>select</span> <span>time_parse</span>(<span>&#39;15:56:35&#39;</span>)
</span></span><span><span>     <span>=</span> <span>time_date</span>(<span>1</span>, <span>1</span>, <span>1</span>, <span>15</span>, <span>56</span>, <span>35</span>);
</span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><p>Supports a limited set of layouts:</p><div><pre tabindex="0"><code data-lang="text"><span><span>2006-01-02T15:04:05.999999999+07:00     ISO 8601 with nanoseconds and timezone
</span></span><span><span>2006-01-02T15:04:05.999999999Z          ISO 8601 with nanoseconds, UTC
</span></span><span><span>2006-01-02T15:04:05+07:00               ISO 8601 with timezone
</span></span><span><span>2006-01-02T15:04:05Z                    ISO 8601, UTC
</span></span><span><span>2006-01-02 15:04:05                     Date and time, UTC
</span></span><span><span>2006-01-02                              Date only, UTC
</span></span><span><span>15:04:05                                Time only, UTC
</span></span></code></pre></div><h2 id="duration-constants">Duration constants</h2><p>There are functions that return common durations in nanoseconds:</p><div><pre tabindex="0"><code data-lang="sql"><span><span><span>select</span> <span>dur_ns</span>();
</span></span><span><span><span>-- 1
</span></span></span><span><span><span></span><span>select</span> <span>dur_us</span>();
</span></span><span><span><span>-- 1000
</span></span></span><span><span><span></span><span>select</span> <span>dur_ms</span>();
</span></span><span><span><span>-- 1000000
</span></span></span><span><span><span></span><span>select</span> <span>dur_s</span>();
</span></span><span><span><span>-- 1000000000
</span></span></span><span><span><span></span><span>select</span> <span>dur_m</span>();
</span></span><span><span><span>-- 60000000000
</span></span></span><span><span><span></span><span>select</span> <span>dur_h</span>();
</span></span><span><span><span>-- 3600000000000
</span></span></span></code></pre></div><codapi-snippet sandbox="sqlite" editor="basic" template="main.sql" output=""></codapi-snippet><div><pre tabindex="0"><code data-lang="text"><span><span>1
</span></span><span><span>1000
</span></span><span><span>1000000
</span></span><span><span>1000000000
</span></span><span><span>60000000000
</span></span><span><span>3600000000000
</span></span></code></pre></div><h2 id="acknowledgements">Acknowledgements</h2><p>While this extension is implemented in C, its design and implementation is largely based on Go&#39;s stdlib <a href="https://github.com/golang/go/tree/master/src/time">time</a> package (BSD 3-Clause License), which I think is awesome (except for the formatting part).</p><h2 id="installation-and-usage">Installation and usage</h2><ol><li><p>Download the <a href="https://github.com/nalgeon/sqlean/releases/latest">latest release</a></p></li><li><p>Use with SQLite command-line interface:</p></li></ol><pre tabindex="0"><code>sqlite&gt; .load ./time
sqlite&gt; select time_now();
</code></pre><p>See also:</p><ul><li><a href="https://antonz.org/install-sqlite-extension/">How to install an extension</a></li><li><a href="https://github.com/nalgeon/sqlean/blob/main/docs/time.md">Documentation</a></li><li><a href="https://antonz.org/sqlean/">SQLite extension suite</a></li></ul><p>──</p><p>P.S. <mark>Interactive examples</mark> in this post are powered by <a href="https://codapi.org/">codapi</a> — an open source tool I&#39;m building. Use it to embed live code snippets into your product docs, online course or blog.</p><p><a href="https://antonz.org/subscribe/">★ Subscribe</a> to keep up with new posts.</p></div></div></article></div></div></div>
  </body>
</html>
