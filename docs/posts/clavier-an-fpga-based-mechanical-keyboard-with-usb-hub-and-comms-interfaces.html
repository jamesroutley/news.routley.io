<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/lsartory/Clavier">Original</a>
    <h1>Clavier: An FPGA-based mechanical keyboard with USB hub and comms interfaces</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Clavier (French for ‘keyboard’) is an FPGA-based mechanical keyboard with an integrated USB hub, and numerous communication interfaces (JTAG, SPI, I²C, UART).</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/lsartory/Clavier/blob/main/Pictures/clavier-assembled.jpg"><img src="https://github.com/lsartory/Clavier/raw/main/Pictures/clavier-assembled.jpg" alt="Clavier assembled"/></a></p>

<ul dir="auto">
<li>Full size 105 keys ISO keyboard + one extra</li>
<li>Compatible with PCB mounted Cherry MX switches</li>
<li>N-key rollover</li>
<li>1000 Hz polling rate</li>
<li>No multiplexing, no ghosting</li>
<li>2-port USB 2.0 hub</li>
<li>JTAG, SPI, I²C, 2 × UART, and 8 × GPIOs</li>
<li>FPGA-based, VHDL only, no ALU</li>
<li>Fully open-source, including all design tools (see below)</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">What&#39;s the extra key for?</h3><a id="user-content-whats-the-extra-key-for" aria-label="Permalink: What&#39;s the extra key for?" href="#whats-the-extra-key-for"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">It&#39;s the coffee key.
Use it to lock your computer and go have a break.</p>
<p dir="auto">It can also be long-pressed for 5 seconds to reset the FPGA.</p>

<ul dir="auto">
<li><a href="https://www.kicad.org" rel="nofollow">KiCad</a> for the PCB</li>
<li><a href="https://www.freecad.org" rel="nofollow">FreeCAD</a> or <a href="https://openscad.org" rel="nofollow">OpenSCAD</a> for the housing</li>
<li><a href="https://github.com/YosysHQ/oss-cad-suite-build">OSS CAD Suite</a> (GHDL, Yosys, hdl, ghdl-yosys-plugin, nextpnr-ecp5, ecppack, and openFPGALoader) and <a href="https://www.gnu.org/software/make" rel="nofollow">GNU Make</a> for the FPGA</li>
</ul>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/lsartory/Clavier/blob/main/Pictures/clavier-pcb.png"><img src="https://github.com/lsartory/Clavier/raw/main/Pictures/clavier-pcb.png" alt="The PCB layout"/></a></p>
<p dir="auto">The PCB has 4 layers and requires no unusual capabilities to produce.
It is however not easy to assemble by hand mostly due to 0402 passives and the FPGA in BGA packaging.</p>

<p dir="auto">A PDF version of the schematics is available here, for convenience: <a href="https://github.com/lsartory/Clavier/blob/main/PCB/doc/clavier.pdf">PCB/doc/clavier.pdf</a>.</p>


<p dir="auto">An OpenSCAD version of the housing was created first and is fine for 3D printing.
The FreeCAD version was created afterwards for exporting to STEP, which is more suitable for CNC machining.
Both alternatives are functionally equivalent.</p>

<p dir="auto">The first version fits properly, but it turns out that it is not angled in a comfortable way.
To correct this, a second version was created with an angle of 8° that makes the front part much thinner.
This one is only available in FreeCAD.</p>


<p dir="auto">Simply run <code>make</code> in the FPGA subfolder.
If using OSS CAD Suite, make sure <a href="https://github.com/YosysHQ/oss-cad-suite-build?tab=readme-ov-file#installation">the environment is set</a> first.</p>

<p dir="auto">The integrated JTAG interface can be used to program the FPGA.
The switch <code>SW18</code> is used to toggle the interfaces on or off. The LED <code>D1</code> close by displays the current status.
Connect the JTAG interface with jumper cables, then run either <code>make prog-sram</code> or <code>make prog-flash</code>, depending on if the configuration needs to be permanent or not.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/lsartory/Clavier/blob/main/Pictures/clavier-jtag.jpg"><img src="https://github.com/lsartory/Clavier/raw/main/Pictures/clavier-jtag.jpg" alt="How to connect the JTAG interface"/></a></p>

<p dir="auto">Except for the GPIOs that are connected directly to the FPGA, communications are handled by the <a href="https://www.lcsc.com/datasheet/C18221627.pdf" rel="nofollow">CH347F</a>.</p>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/lsartory/Clavier/blob/main/Pictures/clavier.png"><img src="https://github.com/lsartory/Clavier/raw/main/Pictures/clavier.png" alt="Clavier render"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/lsartory/Clavier/blob/main/Pictures/clavier-housing.png"><img src="https://github.com/lsartory/Clavier/raw/main/Pictures/clavier-housing.png" alt="Clavier housing render"/></a></p>

<ul dir="auto">
<li>The PCB and housing are licensed under the <a href="https://spdx.org/licenses/CERN-OHL-P-2.0.html" rel="nofollow">CERN Open Hardware Licence Version 2 - Permissive</a>.</li>
<li>The FPGA code is licensed under the <a href="https://spdx.org/licenses/MIT.html" rel="nofollow">MIT Licence</a>.</li>
<li>The pictures are licensed under the <a href="https://creativecommons.org/licenses/by/4.0/" rel="nofollow">CC BY 4.0 License</a>.</li>
</ul>
</article></div></div>
  </body>
</html>
