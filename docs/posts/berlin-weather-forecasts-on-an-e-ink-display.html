<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://capnfabs.net/posts/weather-forecast-eink-dwd/">Original</a>
    <h1>Berlin weather forecasts on an E-ink display</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody" id="content"><p>Every few months, I become wildly dissatisfied with my relationship with my mobile phone and vow to take steps to change it. Typically, that has meant <em>removing reasons to pick it up</em> â€“ I want to be able to come home, throw my phone in a drawer and then not think about it until I leave home again.</p><p>In the past, this has resulted in:</p><ul><li>Suggestions to my friends that we should all get landlines because itâ€™d be â€œfunâ€</li><li>The same but with fax machines, because itâ€™s kinda lo-fi SMS<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup></li><li>Prototyping a thing which plays <a href="https://capnfabs.net/posts/why-is-this-floppy-disk-drive-clicking-incessantly/">Spotify playlists based on floppy disks</a> to deal with the fact that I miss CDs (maybe I should just buy a CD player).</li></ul><p>I think part of the problem with phones is that theyâ€™re devices for <em>everything</em>, and so moving back to single-task devices feels closer to what my lizard brain can handle.</p><p>To that effect: I thought it would be cool to have the weather forecast accessible somewhere in the morning as Iâ€™m choosing clothes, without having to pick up my phone.</p><p><a href="https://shop.pimoroni.com/products/inky-frame-7-3?variant=40541882056787">Pimoroni make a 7&#34; e-ink display with a tiny Wi-Fi-enabled computer attached</a>, so I bought one last week, and set about trying to get the weather forecast on it.</p><p>Here it is:</p><figure><img srcset="/posts/weather-forecast-eink-dwd/final-product_huff0bc31895d21e9b4638e176ede66fbd_1464530_652x652_fit_q95_box.jpg,
/posts/weather-forecast-eink-dwd/final-product_huff0bc31895d21e9b4638e176ede66fbd_1464530_1304x1304_fit_q95_box.jpg 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/final-product_huff0bc31895d21e9b4638e176ede66fbd_1464530_652x652_fit_q95_box.jpg" alt="A photo of an e-ink display with a weather forecast for the next 24 hours"/><figcaption><p>There were storms when I was writing this.</p></figcaption></figure><p>This post talks about the design choices; Iâ€™ll do one about wrangling weather data Soonâ„¢ï¸ (it was a <em>journey</em>).</p><h2 id="tell-me-more-about-this-e-ink-screen-thing">Tell me more about this e-ink screen thing</h2><p><a href="https://shop.pimoroni.com/products/inky-frame-7-3?variant=40541882056787">This is a 7&#34; colour e-ink display with a tiny Wi-Fi-enabled computer attached</a>. Everything comes preassembled.</p><p>The use of a colour e-ink display for the screen is the fundamental design choice here. Itâ€™s basically like the screen in a Kindle, just lower-resolution, and with seven colours. This means:</p><ul><li><p><strong>The image stays when the power cuts off</strong>. Alternatively: you can keep the screen on without using any electricity.</p></li><li><p><strong>Refresh time is long</strong>. On a typical black-and-white e-ink display, a full refresh takes maybe a couple seconds â€“ typically it <a href="https://electronics.stackexchange.com/questions/20276/why-does-flashing-prevent-ghosting-on-e-ink-displays">flashes everything black, and then white, before rendering the image</a> â€“ but this is a fancy 7-colour e-ink display, and so it takes approx 40 seconds â€“ it flashes through every colour in turn before rendering the image, and then renders every colour individually. The screen is unreadable during these updates.</p></li><li><p><strong>Youâ€™re limited to a very small number of colours.</strong> In this case, Black / White / Green / Blue / Red / Yellow / Orange. You cannot mix them; each dot is a single colour. If you want to use colours in between, the best you can do is to use a technique called <em><a href="https://en.wikipedia.org/wiki/Dither#Digital_photography_and_image_processing">dithering</a></em>, which kinda works if you squint, but this display has pretty large pixels, so you need to squint <em>a lot</em>.</p></li></ul><figure><img src="https://capnfabs.net/posts/weather-forecast-eink-dwd/dither.jpg" alt="A closeup photo of a full-colour photo rendered on a discrete colour e-ink display, showing dithering."/><figcaption><p>A closeup of the sample image that comes â€˜preinstalledâ€™</p></figcaption></figure><p>This means:</p><ul><li>We should prioritise updating <em>infrequently</em>.</li><li>We can probably power it for a really long time using batteries.</li><li>We should stick to designs with sharp edges, no motion, and single colours.</li></ul><h2 id="warnwetter-as-inspiration">WarnWetter as inspiration</h2><p>Hereâ€™s my screen again:</p><figure><img srcset="/posts/weather-forecast-eink-dwd/graph_hu4ce606f0183585df8de5fc1a672866bf_1089658_652x652_fit_q95_box.jpg,
/posts/weather-forecast-eink-dwd/graph_hu4ce606f0183585df8de5fc1a672866bf_1089658_1304x1304_fit_q95_box.jpg 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/graph_hu4ce606f0183585df8de5fc1a672866bf_1089658_652x652_fit_q95_box.jpg" alt="a photo of my weather forecast program running on the e-ink screen"/></figure><p>The two graphs are temperature (the red line) and rainfall (the blue bars). I basically lifted this design from the <a href="https://www.dwd.de/EN/ourservices/warnwetteapp/warnwetterapp.html">WarnWetter App</a> â€“ the official Android / iOS app from the Deutscher Wetterdienst (aka DWD, the German Weather Service).</p><figure><img src="https://capnfabs.net/posts/weather-forecast-eink-dwd/warnwetter.jpg" alt="A screenshot of the WarnWetter app"/><figcaption><p>Tuesdayâ€™s forecast in WarnWetter</p></figcaption></figure><h2 id="jumbo-max--min-temperature-numbers">Jumbo Max / Min temperature numbers</h2><p>I added the big numbers for the max and min temperatures because thatâ€™s what you <em>actually</em> care about when youâ€™re looking at the forecast.</p><p>The questions youâ€™re trying to answer are:</p><ul><li>â€œshould I wear shorts / a dress / that top thatâ€™s kinda halfway between a t-shirt and a sweaterâ€ and</li><li>â€œshould I bring a jacket if Iâ€™m out for drinks after workâ€</li></ul><p>â€¦and for those you need the numbers, not the graph.</p><p>It probably wasnâ€™t super necessary to put the graph in at all, actually. But having it helps answer the question â€œis it over yetâ€ on a hot summer day, and helps you answer the â€œJacket Questionâ€ with more precision in autumn and spring.</p><h2 id="yellow-bar-shows-current-time">Yellow bar shows current time</h2><p>The yellow bar goes from the time the screen last updated to the time that the next update is scheduled. That is: the current time is always somewhere in the yellow region.</p><p>This has two purposes:</p><ul><li><p>I do that â€œgoldfish memory thingâ€ where I look at the forecast, and then not remember what the time is, and then look for a clock, and then check the forecast again once I know what the time is. And I usually get distracted on the way ğŸ‘. Now I donâ€™t have to go looking for a clock.</p></li><li><p>This feature is how you check that the screen is still updating. The device will eventually be <em>battery powered</em>, so itâ€™s important to have a way of knowing if the batteries have died, given that the screen stays on even without power.</p></li></ul><h2 id="next-24hrs-only">Next 24hrs only</h2><p>This is <em>only</em> a 24 hour forecast â€“ the data source Iâ€™m using gives me a whole week of data, though, why not show more of that? I figured that most of the time when Iâ€™m looking at the 7-day forecast, itâ€™s because Iâ€™m planning, and if Iâ€™m planning Iâ€™m probably texting people, and if Iâ€™m texting people then Iâ€™m on my phone anyway, and can just use the app.</p><p>Plus, I donâ€™t have much space on this screen! Much better to stay focussed on the â€˜what should I wear todayâ€™ question.</p><h2 id="tiny-lightning-bolts">Tiny lightning bolts</h2><p>The little lightning bolt icons are a compromise. I originally wanted to have full weather icons above the temperature graph like the WarnWetter app â€“ I think theyâ€™re cute and useful! But putting icons on the screen turned out to be <em>super</em> painful.</p><p>First, youâ€™ve got to find a source of icons and/or draw them yourself. I thought about extracting them from the WarnWetter App directly, but those icons are designed for full-colour, and so Iâ€™d have to simplify them dramatically for my pixelly, 7-color display<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup>.</p><p>I then turned to the <a href="https://erikflowers.github.io/weather-icons/">WeatherIcons</a> project, which seemed promising, but all those lovely round edges pixellate badly, especially at small scales. Iâ€™ve only got 31 pixels per hour column to work with. If we were to do an icon every 3 hours (like what the app does!), weâ€™ve got 93 pixels and it kinda looks ok:</p><figure><img srcset="/posts/weather-forecast-eink-dwd/3hr_hu2140238198ca6cab6b5c845851e93d01_45885_652x652_fit_q95_box_3.png,
/posts/weather-forecast-eink-dwd/3hr_hu2140238198ca6cab6b5c845851e93d01_45885_1304x1304_fit_q95_box_3.png 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/3hr_hu2140238198ca6cab6b5c845851e93d01_45885_652x652_fit_q95_box_3.png" alt="This is supposed to be a storm with showers"/><figcaption><p>This is supposed to be a storm with showers</p></figcaption></figure><p>But, I couldnâ€™t figure out how the WarnWetter App was getting these three-hour icons; itâ€™s not obvious from the data that WarnWetterâ€™s servers are returning. The <em>hourly</em> icons were easy to figure out from the data, but that only leaves 31 pixels per icon, which is a lot of visual clutter. Plus, icons designed for the web are basically unusable at that resolution:</p><figure><img src="https://capnfabs.net/posts/weather-forecast-eink-dwd/1hr.png" alt="yuck"/><figcaption><p>yuck</p></figcaption></figure><p>Ok, so time to make my own icons. I thought Iâ€™d solve the â€˜visual clutterâ€™ problem by <em>only</em> doing icons for lightning and snow and slapping them on top of the rain graph columns when they apply:</p><figure><img src="https://capnfabs.net/posts/weather-forecast-eink-dwd/tiny-lightning.jpg" alt="they&amp;rsquo;re kinda cute"/><figcaption><p>theyâ€™re kinda cute</p></figcaption></figure><p>I opened <a href="https://www.aseprite.org">Aseprite</a>, a pixel-art editor, and whipped up this tiny lightning bolt, only using black and yellow (no intermediate colours!):</p><figure><img src="https://capnfabs.net/posts/weather-forecast-eink-dwd/aseprite.png" alt="a screenshot from Aseprite showing a lightning bolt design"/></figure><p>Then I tried to load it on to the deviceâ€¦ and it turns out that thereâ€™s not really software support for loading icons like this. The device / software supports jpegs, but jpegs donâ€™t support transparency, and are otherwise <em>definitely</em> overkill for what I need. The processor on this device is tiny and only has a small amount of RAM, and jpegs are designed for <em>photos</em> and <em>full-colour</em> displays. Consequently, I was worried that rendering that lightning bolt from jpeg would be a lot of work for the processor if you have to do it multiple times, and that might be bad for update speed and/or battery life (in addition to the transparency thing).</p><p>So, ok. I guess the only solution is to write code to draw this as a bunch of lines.</p><figure><img srcset="/posts/weather-forecast-eink-dwd/cursed-lightening_hu398692c1d695a58f4cb873de164e505a_292005_652x652_fit_q95_box_3.png,
/posts/weather-forecast-eink-dwd/cursed-lightening_hu398692c1d695a58f4cb873de164e505a_292005_1304x1304_fit_q95_box_3.png 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/cursed-lightening_hu398692c1d695a58f4cb873de164e505a_292005_652x652_fit_q95_box_3.png" alt="A screenshot of extremely repetitive code drawing a lightning bolt line by line."/></figure><p>Fifteen incredibly frustrating minutes later, I got my cute lilâ€™ lightning bolts. Iâ€™ll do the snow icons when weâ€™re closer to winter.</p><h2 id="overshoot-on-the-graph">Overshoot on the graph</h2><p>This one is more fun than practical: the temperature line will overshoot / undershoot the graph bounds if itâ€™s over by less than 0.5 of a degree (celsius); I did this by accident initially but I thought it looked cool and then productionised it.</p><figure><img srcset="/posts/weather-forecast-eink-dwd/overshoot_hu99e9f684eef3ebba4546638da5dcca11_979720_652x652_fit_q95_box.jpg,
/posts/weather-forecast-eink-dwd/overshoot_hu99e9f684eef3ebba4546638da5dcca11_979720_1304x1304_fit_q95_box.jpg 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/overshoot_hu99e9f684eef3ebba4546638da5dcca11_979720_652x652_fit_q95_box.jpg" alt="A line graph overshooting the bounds slightly"/><figcaption><p>Plus those horizontal lines get really noisy when theyâ€™re too dense together. If we can skip one by just overshooting a little itâ€™s much nicer.</p></figcaption></figure><p>Similarly, if it starts flooding, the rain graph just gives up on scaling things neatly and draws a bar that eats into as much of the rest of the screen as it wants. From the code:</p><figure><img src="https://capnfabs.net/posts/weather-forecast-eink-dwd/screenshot-chaos-rain.png" alt="The chaos the display is the least of my concerns if we get more than 10cm of rain in an hour"/><figcaption><p>10cm of rain in an hour would be flash-flooding for sure</p></figcaption></figure><h2 id="no-rain-today--prompt-engineering">â€œno rain todayâ€ / â€œprompt engineeringâ€</h2><p>You might have noticed that thereâ€™s a lot of screen real estate dedicated to rainfall â€“ but <a href="https://www.nationalgeographic.de/umwelt/2023/06/hitze-duerre-klimawandel-wird-brandenburg-zur-wueste">Brandenburg is one of the driest regions in Germany</a>, and days without rain are pretty common. I decided that itâ€™d be weird to just have a blank chart on those days, and to take the <a href="https://en.wikipedia.org/wiki/Intentionally_blank_page">â€œthis page intentionally left blankâ€</a> approach instead. So when thereâ€™s no rain, I made it show the words</p><blockquote><p>no rain today</p></blockquote><p>but thatâ€™s a little boring for something that takes up so much space. Maybe I could make it say something vaguely entertaining? The first idea that popped into my head was</p><blockquote><p>â€œno rain today, but maybe watch out for snakes?â€</p></blockquote><p>but itâ€™s more fun if it cycles through options. So I turned to ChatGPT<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup>:</p><figure><img srcset="/posts/weather-forecast-eink-dwd/chatgpt-1_hua1d6976a7fd7dc6ba045ef16106d9ec7_260025_652x652_fit_q95_box_3.png,
/posts/weather-forecast-eink-dwd/chatgpt-1_hua1d6976a7fd7dc6ba045ef16106d9ec7_260025_1304x1304_fit_q95_box_3.png 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/chatgpt-1_hua1d6976a7fd7dc6ba045ef16106d9ec7_260025_652x652_fit_q95_box_3.png" alt="fabian: give me 20 off-beat sentences suggestions that start with &#39;no rain today,&#39; I&#39;m going to use them as a loading screen for a weather app."/><figcaption><p>yeesh.</p></figcaption></figure><p>We have very different ideas of what â€œoff-beatâ€ means. Letâ€™s try again.</p><figure><img srcset="/posts/weather-forecast-eink-dwd/chatgpt-2_hu6fdd1532dc2d7e041d51d3e02dac9edf_178750_652x652_fit_q95_box_3.png,
/posts/weather-forecast-eink-dwd/chatgpt-2_hu6fdd1532dc2d7e041d51d3e02dac9edf_178750_1304x1304_fit_q95_box_3.png 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/chatgpt-2_hu6fdd1532dc2d7e041d51d3e02dac9edf_178750_652x652_fit_q95_box_3.png" alt="fabian: thanks, but can you make them weirder?"/><figcaption><p>yeeeeeeeesh.</p></figcaption></figure><p>I dunno, man, this isnâ€™t really what I had in mind, Iâ€™m getting a lot of â€œlive laugh loveâ€ energy from all of these ideas and itâ€™s making me deeply uncomfortable. I imagine someone reading one of these lines and then saying, â€œha! Iâ€™m so <em>quirky</em>!â€ with far too much enthusiasm.</p><p>Maybe itâ€™s too anchored on the whole â€˜rainâ€™ thing?</p><figure><img srcset="/posts/weather-forecast-eink-dwd/chatgpt-3_hu7d79556070d63fdcc9f3f116a2d10962_216313_652x652_fit_q95_box_3.png,
/posts/weather-forecast-eink-dwd/chatgpt-3_hu7d79556070d63fdcc9f3f116a2d10962_216313_1304x1304_fit_q95_box_3.png 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/chatgpt-3_hu7d79556070d63fdcc9f3f116a2d10962_216313_652x652_fit_q95_box_3.png" alt="fabian: can you make the suggestions less... rain-related?"/><figcaption><p>â€œthe pavementâ€¦ is practicingâ€¦ its sun salutations??â€ ğŸ˜ğŸ˜ğŸ˜ğŸ«£</p></figcaption></figure><p>By this point Iâ€™m about ready to give up. One last Hail Mary:</p><figure><img srcset="/posts/weather-forecast-eink-dwd/chatgpt-4_hue3ca4b997db31332b29536563aefebc2_177506_652x652_fit_q95_box_3.png,
/posts/weather-forecast-eink-dwd/chatgpt-4_hue3ca4b997db31332b29536563aefebc2_177506_1304x1304_fit_q95_box_3.png 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/chatgpt-4_hue3ca4b997db31332b29536563aefebc2_177506_652x652_fit_q95_box_3.png" alt="fabian: ok now add some existential dread"/></figure><p><em>YES OK</em> now we are in business (maybe I need to ask for â€™existential dreadâ€™ in all my ChatGPT interactions?).</p><figure><img srcset="/posts/weather-forecast-eink-dwd/desolation_hu08ecef18037ca67e3c14c315a33b49ab_1030424_652x652_fit_q95_box.jpg,
/posts/weather-forecast-eink-dwd/desolation_hu08ecef18037ca67e3c14c315a33b49ab_1030424_1304x1304_fit_q95_box.jpg 2x" src="https://capnfabs.net/posts/weather-forecast-eink-dwd/desolation_hu08ecef18037ca67e3c14c315a33b49ab_1030424_652x652_fit_q95_box.jpg" alt="no rain today... the earth remains parched; a reminder of our inner desolation."/><figcaption><p>love a touch of existential dread with my weather forecast.</p></figcaption></figure><h2 id="thats-it">Thatâ€™s it!</h2><p>This is normally the part of the blog post where I do a â€œcall to actionâ€, and say something like â€œhereâ€™s the code, have funâ€, but Iâ€™m not doing that today. This project is extremely hard-coded to both my Wi-Fi credentials, and the weather station closest to my house (Berlin-Alexanderplatz, 37m above sea level). Just figuring out how to identify the right ID for the weather station was super challenging, and I donâ€™t want to write all the code to handle that properly, or field the questions about how to do it ğŸ˜….<sup id="fnref:4"><a href="#fn:4" role="doc-noteref">4</a></sup></p><p><strong>But:</strong> the idea that Iâ€™m pulling on here is that thereâ€™s something great about purpose-specific tech with simple interaction models, especially when youâ€™ve <em>made it yours</em> like this.</p><p>It feels a little bit like noticing the way you move through the kitchen when youâ€™re cooking, and then adding storage so that youâ€™ve always got a wooden spoon or a small bowl within reach exactly when youâ€™re about to need it. Or a little like realising that you almost always dump your keys in a spot near the door, and then adding key hooks next to the door to make it official. We do this all the time in the physical world, so Iâ€™m a little sad that we settled for disappointing, distracting glass slabs as soon as it comes to anything involving data or the Internet. I guess small projects like this are a way of pulling in the opposite direction. âœ¨</p></div></div>
  </body>
</html>
