<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jacob.gold/posts/serving-200-million-requests-with-cgi-bin/">Original</a>
    <h1>Serving 200M requests per day with a CGI-bin</h1>
    
    <div id="readability-page-1" class="page"><div>

<article>
   
  <div><p>In the early 2000s, we used to write a lot of <a target="_blank" href="https://en.wikipedia.org/wiki/Common_Gateway_Interface">CGI</a> programs.</p>
<p>This was the primary way to make websites dynamic at the time. These CGI programs were usually written in Perl, but sometimes in C to increase performance.</p>
<p>The CGI mechanism is conceptually simple but powerful. When the web server receives an incoming request handled by a CGI script (e.g. <code>GET /~jakegold/cgi-bin/guestbook.cgi</code>), it:</p>
<ol>
<li>Sets up environment variables containing request metadata (HTTP headers, query parameters, request method, etc.)</li>
<li>Spawns a new process to execute the CGI program</li>
<li>Passes the request body (if any) to the program via stdin</li>
<li>Captures the program’s stdout as the HTTP response</li>
<li>Sends any error output from stderr to the error log</li>
</ol>
<p>The CGI program reads the environment variables to understand the request, processes it, and writes an HTTP response to stdout, starting with headers.</p>
<p>One of the nice features of this is that the CGI program exits after handling a single request, so all of its file descriptors and memory are automatically freed by the operating system. This made the terrible code of the time run quite reliably.</p>
<p>The developer experience was excellent as well. Deploying a new version of your CGI program was just a matter of copying it to the <code>cgi-bin/</code> directory on your web server.</p>
<h2 id="hug-of-death">Hug of death</h2>
<p>Typical web servers of this time had 1-2 CPUs and 1-4 GB of memory.</p>
<p>Most web servers ran Apache, which would fork an <code>httpd</code> process for every connection, each of which took a significant amount of memory. This would limit the maximum concurrency to fewer than 100 connections in most cases.</p>
<p>This made it incredibly easy to <a target="_blank" href="https://en.wikipedia.org/wiki/Slashdot_effect">Slashdot</a> a website just by linking to it from a popular site.</p>
<h2 id="modern-servers">Modern servers</h2>
<p>These days, we have servers with 384 CPU threads. Even a small VM can have 16 CPUs. The CPUs and memory are much faster as well.</p>
<p>Most importantly, CGI programs, because they run as separate processes, are excellent at taking advantage of many CPUs!</p>
<p>This got me curious about how fast CGI programs might run on relatively modern hardware. I ran these benchmarks on an older 16-thread AMD 3700X in my server closet.</p>
<p>I might try running them on something really large later.</p>
<h2 id="benchmarking-results">Benchmarking results</h2>
<p>To run a benchmark of CGI on a modern system, I created a little CGI program and ran it under Apache and (just for fun) a custom Go <code>net/http</code> server. I used <code>plow</code> to make concurrent HTTP requests and measure the results.</p>
<p>I haven’t analyzed the results in much detail (I need to go to sleep), but the basic takeaway is that CGI is impressively fast on modern servers.</p>
<p><strong>Using CGI on modest hardware, it’s possible to serve 2400+ requests per second or 200M+ requests per day.</strong></p>
<p>It’s almost never going to be the best choice these days, but it’s definitely viable.</p>
<h3 id="guestbookcgi"><code>guestbook.cgi</code></h3>
<p>I quickly wrote a little <a target="_blank" href="https://en.wikipedia.org/wiki/Guestbook">guestbook</a> program that could be used to allow visitors to leave comments at the bottom of a website.</p>
<p>It uses Go with SQLite and is about as simple as it can be while remaining realistic.</p>
<h3 id="the-code">The code</h3>
<p>I pushed the code and Dockerfiles to GitHub, in case they’re helpful or interesting to anyone else.</p>
<p><a target="_blank" href="https://github.com/Jacob2161/cgi-bin"></a><a href="https://github.com/Jacob2161/cgi-bin">https://github.com/Jacob2161/cgi-bin</a></p>
<div><pre tabindex="0"><code data-lang="go"><span><span><span>package</span> <span>main</span>
</span></span><span><span>
</span></span><span><span><span>import</span> (
</span></span><span><span>    <span>&#34;database/sql&#34;</span>
</span></span><span><span>    <span>&#34;fmt&#34;</span>
</span></span><span><span>    <span>&#34;html/template&#34;</span>
</span></span><span><span>    <span>&#34;log/slog&#34;</span>
</span></span><span><span>    <span>&#34;net/http&#34;</span>
</span></span><span><span>    <span>&#34;net/http/cgi&#34;</span>
</span></span><span><span>    <span>&#34;os&#34;</span>
</span></span><span><span>
</span></span><span><span>    <span>_</span> <span>&#34;github.com/mattn/go-sqlite3&#34;</span>
</span></span><span><span>)
</span></span><span><span>
</span></span><span><span><span>const</span> <span>guestbookHTML</span> = <span>`&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&#34;utf-8&#34;&gt;&lt;title&gt;Guestbook&lt;/title&gt;
</span></span></span><span><span><span>&lt;style&gt;body{font-family:sans-serif}form{margin-bottom:2em}textarea{width:100%;height:6em}&lt;/style&gt;
</span></span></span><span><span><span>&lt;/head&gt;&lt;body&gt;&lt;h2&gt;Guestbook&lt;/h2&gt;
</span></span></span><span><span><span>&lt;form method=&#34;post&#34; action=&#34;</span><span>{{</span><span>.ScriptURL</span><span>}}</span><span>&#34;&gt;
</span></span></span><span><span><span>&lt;label&gt;Name:&lt;br&gt;&lt;input name=&#34;name&#34; required&gt;&lt;/label&gt;&lt;br&gt;
</span></span></span><span><span><span>&lt;label&gt;Message:&lt;br&gt;&lt;textarea name=&#34;message&#34; required&gt;&lt;/textarea&gt;&lt;/label&gt;&lt;br&gt;
</span></span></span><span><span><span>&lt;button type=&#34;submit&#34;&gt;Sign&lt;/button&gt;&lt;/form&gt;
</span></span></span><span><span><span></span><span>{{</span><span>range</span> <span>.Entries</span><span>}}</span><span>&lt;div&gt;&lt;strong&gt;</span><span>{{</span><span>.Name</span><span>}}</span><span>&lt;/strong&gt; &lt;em&gt;</span><span>{{</span><span>.Created</span><span>}}</span><span>&lt;/em&gt;&lt;p&gt;</span><span>{{</span><span>.Message</span><span>}}</span><span>&lt;/p&gt;&lt;/div&gt;&lt;hr&gt;</span><span>{{</span><span>end</span><span>}}</span><span>
</span></span></span><span><span><span>&lt;/body&gt;&lt;/html&gt;`</span>
</span></span><span><span>
</span></span><span><span><span>type</span> <span>entry</span> <span>struct</span> {
</span></span><span><span>    <span>Name</span>    <span>string</span>
</span></span><span><span>    <span>Message</span> <span>string</span>
</span></span><span><span>    <span>Created</span> <span>string</span>
</span></span><span><span>}
</span></span><span><span>
</span></span><span><span><span>type</span> <span>page</span> <span>struct</span> {
</span></span><span><span>    <span>ScriptURL</span> <span>string</span>
</span></span><span><span>    <span>Entries</span>   []<span>entry</span>
</span></span><span><span>}
</span></span><span><span>
</span></span><span><span><span>const</span> (
</span></span><span><span>    <span>databaseFile</span> = <span>&#34;/tmp/guestbook.db&#34;</span>
</span></span><span><span>)
</span></span><span><span>
</span></span><span><span><span>var</span> (
</span></span><span><span>    <span>db</span>        <span>*</span><span>sql</span>.<span>DB</span>
</span></span><span><span>    <span>templates</span> = <span>template</span>.<span>Must</span>(<span>template</span>.<span>New</span>(<span>&#34;page&#34;</span>).<span>Parse</span>(<span>guestbookHTML</span>))
</span></span><span><span>)
</span></span><span><span>
</span></span><span><span><span>func</span> <span>main</span>() {
</span></span><span><span>    <span>_</span>, <span>err</span> <span>:=</span> <span>os</span>.<span>Stat</span>(<span>databaseFile</span>)
</span></span><span><span>    <span>createTable</span> <span>:=</span> <span>os</span>.<span>IsNotExist</span>(<span>err</span>)
</span></span><span><span>
</span></span><span><span>    <span>dsn</span> <span>:=</span> <span>fmt</span>.<span>Sprintf</span>(<span>&#34;file:%s?_journal_mode=WAL&amp;_synchronous=NORMAL&amp;_busy_timeout=5000&amp;_cache_size=10000&#34;</span>, <span>databaseFile</span>)
</span></span><span><span>    <span>db</span>, <span>err</span> = <span>sql</span>.<span>Open</span>(<span>&#34;sqlite3&#34;</span>, <span>dsn</span>)
</span></span><span><span>    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>        <span>slog</span>.<span>Error</span>(<span>&#34;open database failed&#34;</span>, <span>&#34;error&#34;</span>, <span>err</span>)
</span></span><span><span>        <span>os</span>.<span>Exit</span>(<span>1</span>)
</span></span><span><span>    }
</span></span><span><span>    <span>db</span>.<span>SetMaxOpenConns</span>(<span>1</span>)
</span></span><span><span>
</span></span><span><span>    <span>if</span> <span>createTable</span> {
</span></span><span><span>        <span>if</span> <span>_</span>, <span>err</span> = <span>db</span>.<span>Exec</span>(<span>`
</span></span></span><span><span><span>            CREATE TABLE guestbook(
</span></span></span><span><span><span>                id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span><span><span>                name TEXT NOT NULL,
</span></span></span><span><span><span>                message TEXT NOT NULL,
</span></span></span><span><span><span>                created DATETIME DEFAULT CURRENT_TIMESTAMP
</span></span></span><span><span><span>            );
</span></span></span><span><span><span>            CREATE INDEX index_guestbook_created ON guestbook(created);
</span></span></span><span><span><span>            CREATE INDEX index_guestbook_name ON guestbook(name);
</span></span></span><span><span><span>            CREATE INDEX index_guestbook_message ON guestbook(message);
</span></span></span><span><span><span>        `</span>); <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>            <span>slog</span>.<span>Error</span>(<span>&#34;create table failed&#34;</span>, <span>&#34;error&#34;</span>, <span>err</span>)
</span></span><span><span>            <span>os</span>.<span>Exit</span>(<span>1</span>)
</span></span><span><span>        }
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    <span>http</span>.<span>HandleFunc</span>(<span>&#34;/&#34;</span>, <span>func</span>(<span>w</span> <span>http</span>.<span>ResponseWriter</span>, <span>r</span> <span>*</span><span>http</span>.<span>Request</span>) {
</span></span><span><span>        <span>if</span> <span>r</span>.<span>Method</span> <span>==</span> <span>&#34;POST&#34;</span> {
</span></span><span><span>            <span>signHandler</span>(<span>w</span>, <span>r</span>)
</span></span><span><span>        } <span>else</span> {
</span></span><span><span>            <span>listHandler</span>(<span>w</span>, <span>r</span>)
</span></span><span><span>        }
</span></span><span><span>    })
</span></span><span><span>    <span>cgi</span>.<span>Serve</span>(<span>http</span>.<span>DefaultServeMux</span>)
</span></span><span><span>}
</span></span><span><span>
</span></span><span><span><span>func</span> <span>listHandler</span>(<span>w</span> <span>http</span>.<span>ResponseWriter</span>, <span>r</span> <span>*</span><span>http</span>.<span>Request</span>) {
</span></span><span><span>    <span>rows</span>, <span>err</span> <span>:=</span> <span>db</span>.<span>Query</span>(<span>`
</span></span></span><span><span><span>        SELECT 
</span></span></span><span><span><span>            name, message, created
</span></span></span><span><span><span>        FROM
</span></span></span><span><span><span>            guestbook
</span></span></span><span><span><span>        ORDER BY
</span></span></span><span><span><span>            created DESC
</span></span></span><span><span><span>        LIMIT
</span></span></span><span><span><span>            100
</span></span></span><span><span><span>    `</span>)
</span></span><span><span>    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>        <span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusInternalServerError</span>)
</span></span><span><span>        <span>return</span>
</span></span><span><span>    }
</span></span><span><span>    <span>defer</span> <span>rows</span>.<span>Close</span>()
</span></span><span><span>
</span></span><span><span>    <span>var</span> <span>entries</span> []<span>entry</span>
</span></span><span><span>    <span>for</span> <span>rows</span>.<span>Next</span>() {
</span></span><span><span>        <span>var</span> <span>e</span> <span>entry</span>
</span></span><span><span>        <span>if</span> <span>err</span> = <span>rows</span>.<span>Scan</span>(<span>&amp;</span><span>e</span>.<span>Name</span>, <span>&amp;</span><span>e</span>.<span>Message</span>, <span>&amp;</span><span>e</span>.<span>Created</span>); <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>            <span>slog</span>.<span>Error</span>(<span>&#34;scan row failed&#34;</span>, <span>&#34;error&#34;</span>, <span>err</span>)
</span></span><span><span>            <span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusInternalServerError</span>)
</span></span><span><span>            <span>return</span>
</span></span><span><span>        }
</span></span><span><span>        <span>entries</span> = append(<span>entries</span>, <span>e</span>)
</span></span><span><span>    }
</span></span><span><span>    <span>if</span> <span>err</span> = <span>rows</span>.<span>Err</span>(); <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>        <span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusInternalServerError</span>)
</span></span><span><span>        <span>return</span>
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    <span>scriptURL</span> <span>:=</span> <span>r</span>.<span>URL</span>.<span>RequestURI</span>()
</span></span><span><span>    <span>if</span> <span>scriptURL</span> <span>==</span> <span>&#34;&#34;</span> {
</span></span><span><span>        <span>scriptURL</span> = <span>os</span>.<span>Getenv</span>(<span>&#34;SCRIPT_NAME&#34;</span>)
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    <span>data</span> <span>:=</span> <span>page</span>{
</span></span><span><span>        <span>ScriptURL</span>: <span>scriptURL</span>,
</span></span><span><span>        <span>Entries</span>:   <span>entries</span>,
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    <span>w</span>.<span>Header</span>().<span>Set</span>(<span>&#34;Content-Type&#34;</span>, <span>&#34;text/html; charset=utf-8&#34;</span>)
</span></span><span><span>    <span>if</span> <span>err</span> <span>:=</span> <span>templates</span>.<span>Execute</span>(<span>w</span>, <span>data</span>); <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>        <span>slog</span>.<span>Error</span>(<span>&#34;execute template failed&#34;</span>, <span>&#34;error&#34;</span>, <span>err</span>)
</span></span><span><span>        <span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusInternalServerError</span>)
</span></span><span><span>        <span>return</span>
</span></span><span><span>    }
</span></span><span><span>}
</span></span><span><span>
</span></span><span><span><span>func</span> <span>signHandler</span>(<span>w</span> <span>http</span>.<span>ResponseWriter</span>, <span>r</span> <span>*</span><span>http</span>.<span>Request</span>) {
</span></span><span><span>    <span>if</span> <span>err</span> <span>:=</span> <span>r</span>.<span>ParseForm</span>(); <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>        <span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusBadRequest</span>)
</span></span><span><span>        <span>return</span>
</span></span><span><span>    }
</span></span><span><span>    <span>name</span>, <span>msg</span> <span>:=</span> <span>r</span>.<span>Form</span>.<span>Get</span>(<span>&#34;name&#34;</span>), <span>r</span>.<span>Form</span>.<span>Get</span>(<span>&#34;message&#34;</span>)
</span></span><span><span>    <span>if</span> <span>name</span> <span>==</span> <span>&#34;&#34;</span> <span>||</span> <span>msg</span> <span>==</span> <span>&#34;&#34;</span> {
</span></span><span><span>        <span>http</span>.<span>Redirect</span>(<span>w</span>, <span>r</span>, <span>&#34;/&#34;</span>, <span>http</span>.<span>StatusSeeOther</span>)
</span></span><span><span>        <span>return</span>
</span></span><span><span>    }
</span></span><span><span>    <span>if</span> <span>_</span>, <span>err</span> <span>:=</span> <span>db</span>.<span>Exec</span>(<span>`
</span></span></span><span><span><span>        INSERT INTO
</span></span></span><span><span><span>            guestbook (name, message)
</span></span></span><span><span><span>        VALUES
</span></span></span><span><span><span>            (?, ?)
</span></span></span><span><span><span>    `</span>, <span>name</span>, <span>msg</span>); <span>err</span> <span>!=</span> <span>nil</span> {
</span></span><span><span>        <span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusInternalServerError</span>)
</span></span><span><span>        <span>return</span>
</span></span><span><span>    }
</span></span><span><span>
</span></span><span><span>    <span>redirectURL</span> <span>:=</span> <span>r</span>.<span>URL</span>.<span>RequestURI</span>()
</span></span><span><span>    <span>if</span> <span>redirectURL</span> <span>==</span> <span>&#34;&#34;</span> {
</span></span><span><span>        <span>redirectURL</span> = <span>os</span>.<span>Getenv</span>(<span>&#34;SCRIPT_NAME&#34;</span>)
</span></span><span><span>    }
</span></span><span><span>    <span>http</span>.<span>Redirect</span>(<span>w</span>, <span>r</span>, <span>redirectURL</span>, <span>http</span>.<span>StatusSeeOther</span>)
</span></span><span><span>}
</span></span></code></pre></div><h2 id="benchmarking-writes-using-apache">Benchmarking writes using Apache</h2>
<p><a href="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-apache-writes.png"><img alt="cgi-bin writes Apache benchmark" loading="lazy" src="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-apache-writes.png"/></a></p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>jake@lab1:~$ plow <span>\
</span></span></span><span><span><span></span>  --method POST <span>\
</span></span></span><span><span><span></span>  --body <span>&#34;name=John+Carmack&amp;message=Hello+from+id+software%21&#34;</span> <span>\
</span></span></span><span><span><span></span>  --content <span>&#34;application/x-www-form-urlencoded&#34;</span> <span>\
</span></span></span><span><span><span></span>  --concurrency <span>16</span> <span>\
</span></span></span><span><span><span></span>  --requests <span>100000</span> <span>\
</span></span></span><span><span><span></span>    http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi
</span></span><span><span>Benchmarking http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi with <span>100000</span> request<span>(</span>s<span>)</span> using <span>16</span> connection<span>(</span>s<span>)</span>.
</span></span><span><span>@ Real-time charts is listening on http://<span>[</span>::<span>]</span>:18888
</span></span><span><span>
</span></span><span><span>Summary:
</span></span><span><span>  Elapsed      40.5s
</span></span><span><span>  Count       <span>100000</span>
</span></span><span><span>    3xx       <span>100000</span>
</span></span><span><span>  RPS       2468.836
</span></span><span><span>  Reads    0.509MB/s
</span></span><span><span>  Writes   0.494MB/s
</span></span><span><span>
</span></span><span><span>Statistics    Min     Mean    StdDev      Max   
</span></span><span><span>  Latency   3.815ms  6.473ms  2.391ms  135.391ms
</span></span><span><span>  RPS       1852.4   2468.33  133.46    2555.7  
</span></span><span><span>
</span></span><span><span>Latency Percentile:
</span></span><span><span>  P50        P75      P90      P95      P99      P99.9     P99.99 
</span></span><span><span>  5.974ms  6.757ms  8.123ms  9.285ms  14.436ms  38.758ms  84.111ms
</span></span><span><span>
</span></span><span><span>Latency Histogram:
</span></span><span><span>  6.117ms   <span>85451</span>  85.45%
</span></span><span><span>  7.311ms   <span>10800</span>  10.80%
</span></span><span><span>  9.719ms    <span>2951</span>   2.95%
</span></span><span><span>  16.576ms    <span>636</span>   0.64%
</span></span><span><span>  32.873ms    <span>121</span>   0.12%
</span></span><span><span>  49.686ms     <span>26</span>   0.03%
</span></span><span><span>  64.236ms     <span>11</span>   0.01%
</span></span><span><span>  98.211ms      <span>4</span>   0.00%
</span></span></code></pre></div><h2 id="benchmarking-reads-using-apache">Benchmarking reads using Apache</h2>
<p><a href="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-apache-reads.png"><img alt="cgi-bin reads Apache benchmark" loading="lazy" src="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-apache-reads.png"/></a></p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>jake@lab1:~$ plow <span>\
</span></span></span><span><span><span></span>  --method GET <span>\
</span></span></span><span><span><span></span>  --concurrency <span>16</span> <span>\
</span></span></span><span><span><span></span>  --requests <span>100000</span> <span>\
</span></span></span><span><span><span></span>    http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi
</span></span><span><span>Benchmarking http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi with <span>100000</span> request<span>(</span>s<span>)</span> using <span>16</span> connection<span>(</span>s<span>)</span>.
</span></span><span><span>@ Real-time charts is listening on http://<span>[</span>::<span>]</span>:18888
</span></span><span><span>
</span></span><span><span>Summary:
</span></span><span><span>  Elapsed         51s
</span></span><span><span>  Count        <span>100000</span>
</span></span><span><span>    2xx        <span>100000</span>
</span></span><span><span>  RPS        1959.026
</span></span><span><span>  Reads    20.631MB/s
</span></span><span><span>  Writes    0.166MB/s
</span></span><span><span>
</span></span><span><span>Statistics    Min     Mean    StdDev     Max   
</span></span><span><span>  Latency   4.733ms  8.16ms   1.981ms  31.142ms
</span></span><span><span>  RPS       1400.67  1958.64  135.64   2164.44 
</span></span><span><span>
</span></span><span><span>Latency Percentile:
</span></span><span><span>  P50        P75      P90      P95       P99      P99.9     P99.99 
</span></span><span><span>  7.659ms  8.535ms  9.789ms  13.716ms  15.605ms  17.946ms  22.223ms
</span></span><span><span>
</span></span><span><span>Latency Histogram:
</span></span><span><span>  7.164ms   <span>52606</span>  52.61%
</span></span><span><span>  8.352ms   <span>33022</span>  33.02%
</span></span><span><span>  10.08ms   <span>10155</span>  10.16%
</span></span><span><span>  14.053ms   <span>3046</span>   3.05%
</span></span><span><span>  15.03ms     <span>704</span>   0.70%
</span></span><span><span>  15.899ms    <span>365</span>   0.37%
</span></span><span><span>  17.223ms     <span>89</span>   0.09%
</span></span><span><span>  20.196ms     <span>13</span>   0.01%
</span></span></code></pre></div><h2 id="benchmarking-writes-using-go-nethttp">Benchmarking writes using Go net/http</h2>
<p><a href="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-gohttpd-writes.png"><img alt="cgi-bin writes gohttpd benchmark" loading="lazy" src="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-gohttpd-writes.png"/></a></p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>jake@lab1:~$ plow <span>\
</span></span></span><span><span><span></span>  --method POST <span>\
</span></span></span><span><span><span></span>  --body <span>&#34;name=John+Carmack&amp;message=Hello+from+id+software%21&#34;</span> <span>\
</span></span></span><span><span><span></span>  --content <span>&#34;application/x-www-form-urlencoded&#34;</span> <span>\
</span></span></span><span><span><span></span>  --concurrency <span>16</span> <span>\
</span></span></span><span><span><span></span>  --requests <span>100000</span> <span>\
</span></span></span><span><span><span></span>    http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi
</span></span><span><span>Benchmarking http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi with <span>100000</span> request<span>(</span>s<span>)</span> using <span>16</span> connection<span>(</span>s<span>)</span>.
</span></span><span><span>@ Real-time charts is listening on http://<span>[</span>::<span>]</span>:18888
</span></span><span><span>
</span></span><span><span>Summary:
</span></span><span><span>  Elapsed      36.4s
</span></span><span><span>  Count       <span>100000</span>
</span></span><span><span>    3xx       <span>100000</span>
</span></span><span><span>  RPS       2742.432
</span></span><span><span>  Reads    0.437MB/s
</span></span><span><span>  Writes   0.549MB/s
</span></span><span><span>
</span></span><span><span>Statistics    Min     Mean    StdDev      Max   
</span></span><span><span>  Latency   2.981ms  5.825ms  3.882ms  113.286ms
</span></span><span><span>  RPS       2263.09  2741.02   99.4     2819.35 
</span></span><span><span>
</span></span><span><span>Latency Percentile:
</span></span><span><span>  P50        P75      P90      P95      P99      P99.9     P99.99  
</span></span><span><span>  5.012ms  6.091ms  7.879ms  9.707ms  22.914ms  58.042ms  108.861ms
</span></span><span><span>
</span></span><span><span>Latency Histogram:
</span></span><span><span>  5.456ms    <span>94833</span>  94.83%
</span></span><span><span>  9.474ms     <span>4330</span>   4.33%
</span></span><span><span>  21.782ms     <span>627</span>   0.63%
</span></span><span><span>  38.597ms     <span>152</span>   0.15%
</span></span><span><span>  66.833ms      <span>38</span>   0.04%
</span></span><span><span>  97.435ms      <span>13</span>   0.01%
</span></span><span><span>  109.886ms      <span>6</span>   0.01%
</span></span><span><span>  112.707ms      <span>1</span>   0.00%
</span></span></code></pre></div><h2 id="benchmarking-reads-using-go-nethttp">Benchmarking reads using Go net/http</h2>
<p><a href="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-gohttpd-reads.png"><img alt="cgi-bin reads gohttpd benchmark" loading="lazy" src="https://parkerhiggins.net/images/cgi-bin-performance-benchmark-gohttpd-reads.png"/></a></p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>jake@lab1:~$ plow <span>\
</span></span></span><span><span><span></span>  --method GET <span>\
</span></span></span><span><span><span></span>  --concurrency <span>16</span> <span>\
</span></span></span><span><span><span></span>  --requests <span>100000</span> <span>\
</span></span></span><span><span><span></span>    http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi
</span></span><span><span>Benchmarking http://localhost:1111/~jakegold/cgi-bin/guestbook.cgi with <span>100000</span> request<span>(</span>s<span>)</span> using <span>16</span> connection<span>(</span>s<span>)</span>.
</span></span><span><span>@ Real-time charts is listening on http://<span>[</span>::<span>]</span>:18888
</span></span><span><span>
</span></span><span><span>Summary:
</span></span><span><span>  Elapsed       40.4s
</span></span><span><span>  Count        <span>100000</span>
</span></span><span><span>    2xx        <span>100000</span>
</span></span><span><span>  RPS        2469.613
</span></span><span><span>  Reads    25.921MB/s
</span></span><span><span>  Writes    0.210MB/s
</span></span><span><span>
</span></span><span><span>Statistics    Min     Mean    StdDev     Max   
</span></span><span><span>  Latency   3.969ms  6.471ms  1.269ms  27.326ms
</span></span><span><span>  RPS       2308.31  2469.49   41.47   2519.05 
</span></span><span><span>
</span></span><span><span>Latency Percentile:
</span></span><span><span>  P50        P75      P90     P95      P99      P99.9     P99.99 
</span></span><span><span>  6.249ms  7.079ms  8.061ms  8.77ms  10.599ms  14.446ms  20.813ms
</span></span><span><span>
</span></span><span><span>Latency Histogram:
</span></span><span><span>  6.035ms   <span>71273</span>  71.27%
</span></span><span><span>  7.346ms   <span>25248</span>  25.25%
</span></span><span><span>  8.528ms    <span>2674</span>   2.67%
</span></span><span><span>  10.116ms    <span>655</span>   0.66%
</span></span><span><span>  12.33ms     <span>114</span>   0.11%
</span></span><span><span>  17.163ms     <span>31</span>   0.03%
</span></span><span><span>  22.546ms      <span>4</span>   0.00%
</span></span><span><span>  27.326ms      <span>1</span>   0.00%
</span></span></code></pre></div>

  </div>

  
</article>
    </div></div>
  </body>
</html>
