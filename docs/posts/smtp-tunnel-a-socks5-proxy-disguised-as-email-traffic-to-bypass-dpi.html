<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/x011/smtp-tunnel-proxy">Original</a>
    <h1>Show HN: SMTP Tunnel â€“ A SOCKS5 proxy disguised as email traffic to bypass DPI</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<blockquote>
<p dir="auto"><strong>A high-speed covert tunnel that disguises TCP traffic as SMTP email communication to bypass Deep Packet Inspection (DPI) firewalls.</strong></p>
</blockquote>
<div data-snippet-clipboard-copy-content="â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application â”‚â”€â”€â”€â”€â”€â–¶â”‚   Client    â”‚â”€â”€â”€â”€â”€â–¶â”‚   Server    â”‚â”€â”€â”€â”€â”€â–¶â”‚  Internet    â”‚
â”‚  (Browser)  â”‚ TCP  â”‚ SOCKS5:1080 â”‚ SMTP â”‚  Port 587   â”‚ TCP  â”‚              â”‚
â”‚             â”‚â—€â”€â”€â”€â”€â”€â”‚             â”‚â—€â”€â”€â”€â”€â”€â”‚             â”‚â—€â”€â”€â”€â”€â”€â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                    â”‚
                            â”‚   Looks like       â”‚
                            â”‚   Email Traffic    â”‚
                            â–¼                    â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚     DPI Firewall               â”‚
                     â”‚  âœ… Sees: Normal SMTP Session  â”‚
                     â”‚  âŒ Cannot see: Tunnel Data    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"><pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application â”‚â”€â”€â”€â”€â”€â–¶â”‚   Client    â”‚â”€â”€â”€â”€â”€â–¶â”‚   Server    â”‚â”€â”€â”€â”€â”€â–¶â”‚  Internet    â”‚
â”‚  (Browser)  â”‚ TCP  â”‚ SOCKS5:1080 â”‚ SMTP â”‚  Port 587   â”‚ TCP  â”‚              â”‚
â”‚             â”‚â—€â”€â”€â”€â”€â”€â”‚             â”‚â—€â”€â”€â”€â”€â”€â”‚             â”‚â—€â”€â”€â”€â”€â”€â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                    â”‚
                            â”‚   Looks like       â”‚
                            â”‚   Email Traffic    â”‚
                            â–¼                    â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚     DPI Firewall               â”‚
                     â”‚  âœ… Sees: Normal SMTP Session  â”‚
                     â”‚  âŒ Cannot see: Tunnel Data    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ”’ <strong>TLS Encryption</strong></td>
<td>All traffic encrypted with TLS 1.2+ after STARTTLS</td>
</tr>
<tr>
<td>ğŸ­ <strong>DPI Evasion</strong></td>
<td>Initial handshake mimics real SMTP servers (Postfix)</td>
</tr>
<tr>
<td>âš¡ <strong>High Speed</strong></td>
<td>Binary streaming protocol after handshake - minimal overhead</td>
</tr>
<tr>
<td>ğŸ‘¥ <strong>Multi-User</strong></td>
<td>Per-user secrets, IP whitelists, and logging settings</td>
</tr>
<tr>
<td>ğŸ”‘ <strong>Authentication</strong></td>
<td>Per-user pre-shared keys with HMAC-SHA256</td>
</tr>
<tr>
<td>ğŸŒ <strong>SOCKS5 Proxy</strong></td>
<td>Standard proxy interface - works with any application</td>
</tr>
<tr>
<td>ğŸ“¡ <strong>Multiplexing</strong></td>
<td>Multiple connections over single tunnel</td>
</tr>
<tr>
<td>ğŸ›¡ï¸ <strong>IP Whitelist</strong></td>
<td>Per-user access control by IP address/CIDR</td>
</tr>
<tr>
<td>ğŸ“¦ <strong>Easy Install</strong></td>
<td>One-liner server installation with systemd service</td>
</tr>
<tr>
<td>ğŸ <strong>Client Packages</strong></td>
<td>Auto-generated ZIP files for each user</td>
</tr>
<tr>
<td>ğŸ”„ <strong>Auto-Reconnect</strong></td>
<td>Client automatically reconnects on connection loss</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<blockquote>
<p dir="auto">ğŸ“š For in-depth technical details, protocol specifications, and security analysis, see <a href="https://hamy.xyz/x011/smtp-tunnel-proxy/blob/main/TECHNICAL.md">TECHNICAL.md</a>.</p>
</blockquote>
<hr/>


<ul dir="auto">
<li><strong>Server</strong>: Linux VPS with Python 3.8+, port 587 open</li>
<li><strong>Client</strong>: Windows/macOS/Linux with Python 3.8+</li>
<li><strong>Domain name</strong>: Required for TLS certificate verification (free options: <a href="https://www.duckdns.org" rel="nofollow">DuckDNS</a>, <a href="https://www.noip.com" rel="nofollow">No-IP</a>, <a href="https://freedns.afraid.org" rel="nofollow">FreeDNS</a>)</li>
</ul>
<hr/>

<div dir="auto"><h3 tabindex="-1" dir="auto">Step 1ï¸âƒ£: Get a Domain Name</h3><a id="user-content-step-1ï¸âƒ£-get-a-domain-name" aria-label="Permalink: Step 1ï¸âƒ£: Get a Domain Name" href="#step-1ï¸âƒ£-get-a-domain-name"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Get a free domain pointing to your VPS:</p>
<ul dir="auto">
<li>ğŸ¦† <strong><a href="https://www.duckdns.org" rel="nofollow">DuckDNS</a></strong> - Recommended, simple and free</li>
<li>ğŸŒ <strong><a href="https://www.noip.com" rel="nofollow">No-IP</a></strong> - Free tier available</li>
<li>ğŸ†“ <strong><a href="https://freedns.afraid.org" rel="nofollow">FreeDNS</a></strong> - Many domain options</li>
</ul>
<p dir="auto">Example: <code>myserver.duckdns.org</code> â†’ <code>203.0.113.50</code> (your VPS IP)</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Step 2ï¸âƒ£: Run the Installer</h3><a id="user-content-step-2ï¸âƒ£-run-the-installer" aria-label="Permalink: Step 2ï¸âƒ£: Run the Installer" href="#step-2ï¸âƒ£-run-the-installer"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="curl -sSL https://raw.githubusercontent.com/x011/smtp-tunnel-proxy/main/install.sh | sudo bash"><pre>curl -sSL https://raw.githubusercontent.com/x011/smtp-tunnel-proxy/main/install.sh <span>|</span> sudo bash</pre></div>
<p dir="auto">The installer will:</p>
<ol dir="auto">
<li>ğŸ“¥ Download and install everything</li>
<li>â“ Ask for your domain name</li>
<li>ğŸ” Generate TLS certificates automatically</li>
<li>ğŸ‘¤ Offer to create your first user</li>
<li>ğŸ”¥ Configure firewall</li>
<li>ğŸš€ Start the service</li>
</ol>
<p dir="auto"><strong>That&#39;s it!</strong> Your server is ready.</p>

<div dir="auto" data-snippet-clipboard-copy-content="smtp-tunnel-adduser bob      # Add user + generate client ZIP
smtp-tunnel-listusers        # List all users
smtp-tunnel-deluser bob      # Remove a user"><pre>smtp-tunnel-adduser bob      <span><span>#</span> Add user + generate client ZIP</span>
smtp-tunnel-listusers        <span><span>#</span> List all users</span>
smtp-tunnel-deluser bob      <span><span>#</span> Remove a user</span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="smtp-tunnel-update           # Updates code, preserves config/certs/users"><pre>smtp-tunnel-update           <span><span>#</span> Updates code, preserves config/certs/users</span></pre></div>
<hr/>

<div dir="auto"><h3 tabindex="-1" dir="auto">Option A: Easy Way (Recommended)</h3><a id="user-content-option-a-easy-way-recommended" aria-label="Permalink: Option A: Easy Way (Recommended)" href="#option-a-easy-way-recommended"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li>Get your <code>username.zip</code> file from the server admin</li>
<li>Extract the ZIP file</li>
<li>Run the launcher:</li>
</ol>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Platform</th>
<th>How to Run</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸªŸ <strong>Windows</strong></td>
<td>Double-click <code>start.bat</code></td>
</tr>
<tr>
<td>ğŸ§ <strong>Linux</strong></td>
<td>Run <code>./start.sh</code></td>
</tr>
<tr>
<td>ğŸ <strong>macOS</strong></td>
<td>Run <code>./start.sh</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">The launcher will automatically install dependencies and start the client.</p>
<p dir="auto">âœ… You should see:</p>
<div data-snippet-clipboard-copy-content="SMTP Tunnel Proxy Client
User: alice

[INFO] Starting SMTP Tunnel...
[INFO] SOCKS5 proxy will be available at 127.0.0.1:1080

Connecting to myserver.duckdns.org:587
Connected - binary mode active
SOCKS5 proxy on 127.0.0.1:1080"><pre><code>SMTP Tunnel Proxy Client
User: alice

[INFO] Starting SMTP Tunnel...
[INFO] SOCKS5 proxy will be available at 127.0.0.1:1080

Connecting to myserver.duckdns.org:587
Connected - binary mode active
SOCKS5 proxy on 127.0.0.1:1080
</code></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="cd alice
pip install -r requirements.txt
python client.py"><pre><span>cd</span> alice
pip install -r requirements.txt
python client.py</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Option C: Custom Configuration</h3><a id="user-content-option-c-custom-configuration" aria-label="Permalink: Option C: Custom Configuration" href="#option-c-custom-configuration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="# Download files
scp root@myserver.duckdns.org:/etc/smtp-tunnel/ca.crt .

# Create config.yaml:
cat &gt; config.yaml &lt;&lt; EOF
client:
  server_host: &#34;myserver.duckdns.org&#34;
  server_port: 587
  socks_port: 1080
  username: &#34;alice&#34;
  secret: &#34;your-secret-from-admin&#34;
  ca_cert: &#34;ca.crt&#34;
EOF

# Run client
python client.py -c config.yaml"><pre><span><span>#</span> Download files</span>
scp root@myserver.duckdns.org:/etc/smtp-tunnel/ca.crt <span>.</span>

<span><span>#</span> Create config.yaml:</span>
cat <span>&gt;</span> config.yaml <span><span>&lt;&lt;</span> <span>EOF</span></span>
<span>client:</span>
<span>  server_host: &#34;myserver.duckdns.org&#34;</span>
<span>  server_port: 587</span>
<span>  socks_port: 1080</span>
<span>  username: &#34;alice&#34;</span>
<span>  secret: &#34;your-secret-from-admin&#34;</span>
<span>  ca_cert: &#34;ca.crt&#34;</span>
<span><span>EOF</span></span>

<span><span>#</span> Run client</span>
python client.py -c config.yaml</pre></div>
<hr/>

<div dir="auto"><h3 tabindex="-1" dir="auto">ğŸŒ Configure Your Applications</h3><a id="user-content--configure-your-applications" aria-label="Permalink: ğŸŒ Configure Your Applications" href="#-configure-your-applications"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Set SOCKS5 proxy to: <code>127.0.0.1:1080</code></p>

<ol dir="auto">
<li>Settings â†’ Network Settings â†’ Settings</li>
<li>Manual proxy configuration</li>
<li>SOCKS Host: <code>127.0.0.1</code>, Port: <code>1080</code></li>
<li>Select SOCKS v5</li>
<li>âœ… Check &#34;Proxy DNS when using SOCKS v5&#34;</li>
</ol>

<ol dir="auto">
<li>Install &#34;Proxy SwitchyOmega&#34; extension</li>
<li>Create profile with SOCKS5: <code>127.0.0.1:1080</code></li>
</ol>
<div dir="auto"><h4 tabindex="-1" dir="auto">ğŸªŸ Windows (System-wide)</h4><a id="user-content--windows-system-wide" aria-label="Permalink: ğŸªŸ Windows (System-wide)" href="#-windows-system-wide"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Settings â†’ Network &amp; Internet â†’ Proxy â†’ Manual setup â†’ <code>socks=127.0.0.1:1080</code></p>

<p dir="auto">System Preferences â†’ Network â†’ Advanced â†’ Proxies â†’ SOCKS Proxy â†’ <code>127.0.0.1:1080</code></p>

<div dir="auto" data-snippet-clipboard-copy-content="export ALL_PROXY=socks5://127.0.0.1:1080"><pre><span>export</span> ALL_PROXY=socks5://127.0.0.1:1080</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="# curl
curl -x socks5h://127.0.0.1:1080 https://ifconfig.me

# git
git config --global http.proxy socks5://127.0.0.1:1080

# Environment variable
export ALL_PROXY=socks5://127.0.0.1:1080"><pre><span><span>#</span> curl</span>
curl -x socks5h://127.0.0.1:1080 https://ifconfig.me

<span><span>#</span> git</span>
git config --global http.proxy socks5://127.0.0.1:1080

<span><span>#</span> Environment variable</span>
<span>export</span> ALL_PROXY=socks5://127.0.0.1:1080</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="# Should show your VPS IP
curl -x socks5://127.0.0.1:1080 https://ifconfig.me"><pre><span><span>#</span> Should show your VPS IP</span>
curl -x socks5://127.0.0.1:1080 https://ifconfig.me</pre></div>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">âš™ï¸ Configuration Reference</h2><a id="user-content-ï¸-configuration-reference" aria-label="Permalink: âš™ï¸ Configuration Reference" href="#ï¸-configuration-reference"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">ğŸ–¥ï¸ Server Options (<code>config.yaml</code>)</h3><a id="user-content-ï¸-server-options-configyaml" aria-label="Permalink: ğŸ–¥ï¸ Server Options (config.yaml)" href="#ï¸-server-options-configyaml"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>host</code></td>
<td>Listen interface</td>
<td><code>0.0.0.0</code></td>
</tr>
<tr>
<td><code>port</code></td>
<td>Listen port</td>
<td><code>587</code></td>
</tr>
<tr>
<td><code>hostname</code></td>
<td>SMTP hostname (must match certificate)</td>
<td><code>mail.example.com</code></td>
</tr>
<tr>
<td><code>cert_file</code></td>
<td>TLS certificate path</td>
<td><code>server.crt</code></td>
</tr>
<tr>
<td><code>key_file</code></td>
<td>TLS private key path</td>
<td><code>server.key</code></td>
</tr>
<tr>
<td><code>users_file</code></td>
<td>Path to users configuration</td>
<td><code>users.yaml</code></td>
</tr>
<tr>
<td><code>log_users</code></td>
<td>Global logging setting</td>
<td><code>true</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div dir="auto"><h3 tabindex="-1" dir="auto">ğŸ‘¥ User Options (<code>users.yaml</code>)</h3><a id="user-content--user-options-usersyaml" aria-label="Permalink: ğŸ‘¥ User Options (users.yaml)" href="#-user-options-usersyaml"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Each user can have individual settings:</p>
<div dir="auto" data-snippet-clipboard-copy-content="users:
  alice:
    secret: &#34;auto-generated-secret&#34;
    # whitelist:              # Optional: restrict to specific IPs
    #   - &#34;192.168.1.100&#34;
    #   - &#34;10.0.0.0/8&#34;        # CIDR notation supported
    # logging: true           # Optional: disable to stop logging this user

  bob:
    secret: &#34;another-secret&#34;
    whitelist:
      - &#34;203.0.113.50&#34;        # Bob can only connect from this IP
    logging: false            # Don&#39;t log Bob&#39;s activity"><pre><span>users</span>:
  <span>alice</span>:
    <span>secret</span>: <span><span>&#34;</span>auto-generated-secret<span>&#34;</span></span>
    <span><span>#</span> whitelist:              # Optional: restrict to specific IPs</span>
    <span><span>#</span>   - &#34;192.168.1.100&#34;</span>
    <span><span>#</span>   - &#34;10.0.0.0/8&#34;        # CIDR notation supported</span>
    <span><span>#</span> logging: true           # Optional: disable to stop logging this user</span>

  <span>bob</span>:
    <span>secret</span>: <span><span>&#34;</span>another-secret<span>&#34;</span></span>
    <span>whitelist</span>:
      - <span><span>&#34;</span>203.0.113.50<span>&#34;</span></span>        <span><span>#</span> Bob can only connect from this IP</span>
    <span>logging</span>: <span>false            </span><span><span>#</span> Don&#39;t log Bob&#39;s activity</span></pre></div>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>secret</code></td>
<td>User&#39;s authentication secret</td>
<td>Required</td>
</tr>
<tr>
<td><code>whitelist</code></td>
<td>Allowed IPs for this user (CIDR supported)</td>
<td>All IPs</td>
</tr>
<tr>
<td><code>logging</code></td>
<td>Enable activity logging for this user</td>
<td><code>true</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>server_host</code></td>
<td>Server domain name</td>
<td>Required</td>
</tr>
<tr>
<td><code>server_port</code></td>
<td>Server port</td>
<td><code>587</code></td>
</tr>
<tr>
<td><code>socks_port</code></td>
<td>Local SOCKS5 port</td>
<td><code>1080</code></td>
</tr>
<tr>
<td><code>socks_host</code></td>
<td>Local SOCKS5 interface</td>
<td><code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>username</code></td>
<td>Your username</td>
<td>Required</td>
</tr>
<tr>
<td><code>secret</code></td>
<td>Your authentication secret</td>
<td>Required</td>
</tr>
<tr>
<td><code>ca_cert</code></td>
<td>CA certificate for verification</td>
<td>Recommended</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>

<div dir="auto" data-snippet-clipboard-copy-content="# Check status
sudo systemctl status smtp-tunnel

# Restart after config changes
sudo systemctl restart smtp-tunnel

# View logs
sudo journalctl -u smtp-tunnel -n 100

# Uninstall
sudo /opt/smtp-tunnel/uninstall.sh"><pre><span><span>#</span> Check status</span>
sudo systemctl status smtp-tunnel

<span><span>#</span> Restart after config changes</span>
sudo systemctl restart smtp-tunnel

<span><span>#</span> View logs</span>
sudo journalctl -u smtp-tunnel -n 100

<span><span>#</span> Uninstall</span>
sudo /opt/smtp-tunnel/uninstall.sh</pre></div>
<hr/>
<div dir="auto"><h2 tabindex="-1" dir="auto">ğŸ”§ Command Line Options</h2><a id="user-content--command-line-options" aria-label="Permalink: ğŸ”§ Command Line Options" href="#-command-line-options"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<div dir="auto" data-snippet-clipboard-copy-content="python server.py [-c CONFIG] [-d]

  -c, --config    Config file (default: config.yaml)
  -d, --debug     Enable debug logging"><pre>python server.py [-c CONFIG] [-d]

  -c, --config    Config file (default: config.yaml)
  -d, --debug     Enable debug logging</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="python client.py [-c CONFIG] [--server HOST] [--server-port PORT]
                 [-p SOCKS_PORT] [-u USERNAME] [-s SECRET] [--ca-cert FILE] [-d]

  -c, --config      Config file (default: config.yaml)
  --server          Override server domain
  --server-port     Override server port
  -p, --socks-port  Override local SOCKS port
  -u, --username    Your username
  -s, --secret      Override secret
  --ca-cert         CA certificate path
  -d, --debug       Enable debug logging"><pre>python client.py [-c CONFIG] [--server HOST] [--server-port PORT]
                 [-p SOCKS_PORT] [-u USERNAME] [-s SECRET] [--ca-cert FILE] [-d]

  -c, --config      Config file (default: config.yaml)
  --server          Override server domain
  --server-port     Override server port
  -p, --socks-port  Override <span>local</span> SOCKS port
  -u, --username    Your username
  -s, --secret      Override secret
  --ca-cert         CA certificate path
  -d, --debug       Enable debug logging</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="smtp-tunnel-adduser &lt;username&gt; [-u USERS_FILE] [-c CONFIG] [--no-zip]
    Add a new user and generate client package

smtp-tunnel-deluser &lt;username&gt; [-u USERS_FILE] [-f]
    Remove a user (use -f to skip confirmation)

smtp-tunnel-listusers [-u USERS_FILE] [-v]
    List all users (use -v for detailed info)

smtp-tunnel-update
    Update server to latest version (preserves config/certs/users)"><pre>smtp-tunnel-adduser <span>&lt;</span>username<span>&gt;</span> [-u USERS_FILE] [-c CONFIG] [--no-zip]
    Add a new user and generate client package

smtp-tunnel-deluser <span>&lt;</span>username<span>&gt;</span> [-u USERS_FILE] [-f]
    Remove a user (use -f to skip confirmation)

smtp-tunnel-listusers [-u USERS_FILE] [-v]
    List all users (use -v <span>for</span> detailed info)

smtp-tunnel-update
    Update server to latest version (preserves config/certs/users)</pre></div>
<hr/>

<div data-snippet-clipboard-copy-content="smtp_proxy/
â”œâ”€â”€ ğŸ“„ server.py               # Server (runs on VPS)
â”œâ”€â”€ ğŸ“„ client.py               # Client (runs locally)
â”œâ”€â”€ ğŸ“„ common.py               # Shared utilities
â”œâ”€â”€ ğŸ“„ generate_certs.py       # Certificate generator
â”œâ”€â”€ ğŸ“„ config.yaml             # Server/client configuration
â”œâ”€â”€ ğŸ“„ users.yaml              # User database
â”œâ”€â”€ ğŸ“„ requirements.txt        # Python dependencies
â”œâ”€â”€ ğŸ“„ install.sh              # One-liner server installer
â”œâ”€â”€ ğŸ“„ smtp-tunnel.service     # Systemd unit file
â”œâ”€â”€ ğŸ”§ smtp-tunnel-adduser     # Add user script
â”œâ”€â”€ ğŸ”§ smtp-tunnel-deluser     # Remove user script
â”œâ”€â”€ ğŸ”§ smtp-tunnel-listusers   # List users script
â”œâ”€â”€ ğŸ”§ smtp-tunnel-update      # Update server script
â”œâ”€â”€ ğŸ“„ README.md               # This file
â””â”€â”€ ğŸ“„ TECHNICAL.md            # Technical documentation"><pre><code>smtp_proxy/
â”œâ”€â”€ ğŸ“„ server.py               # Server (runs on VPS)
â”œâ”€â”€ ğŸ“„ client.py               # Client (runs locally)
â”œâ”€â”€ ğŸ“„ common.py               # Shared utilities
â”œâ”€â”€ ğŸ“„ generate_certs.py       # Certificate generator
â”œâ”€â”€ ğŸ“„ config.yaml             # Server/client configuration
â”œâ”€â”€ ğŸ“„ users.yaml              # User database
â”œâ”€â”€ ğŸ“„ requirements.txt        # Python dependencies
â”œâ”€â”€ ğŸ“„ install.sh              # One-liner server installer
â”œâ”€â”€ ğŸ“„ smtp-tunnel.service     # Systemd unit file
â”œâ”€â”€ ğŸ”§ smtp-tunnel-adduser     # Add user script
â”œâ”€â”€ ğŸ”§ smtp-tunnel-deluser     # Remove user script
â”œâ”€â”€ ğŸ”§ smtp-tunnel-listusers   # List users script
â”œâ”€â”€ ğŸ”§ smtp-tunnel-update      # Update server script
â”œâ”€â”€ ğŸ“„ README.md               # This file
â””â”€â”€ ğŸ“„ TECHNICAL.md            # Technical documentation
</code></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">ğŸ“¦ Installation Paths (after install.sh)</h3><a id="user-content--installation-paths-after-installsh" aria-label="Permalink: ğŸ“¦ Installation Paths (after install.sh)" href="#-installation-paths-after-installsh"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div data-snippet-clipboard-copy-content="/opt/smtp-tunnel/              # Application files
/etc/smtp-tunnel/              # Configuration files
  â”œâ”€â”€ config.yaml
  â”œâ”€â”€ users.yaml
  â”œâ”€â”€ server.crt
  â”œâ”€â”€ server.key
  â””â”€â”€ ca.crt
/usr/local/bin/                # Management commands
  â”œâ”€â”€ smtp-tunnel-adduser
  â”œâ”€â”€ smtp-tunnel-deluser
  â”œâ”€â”€ smtp-tunnel-listusers
  â””â”€â”€ smtp-tunnel-update"><pre><code>/opt/smtp-tunnel/              # Application files
/etc/smtp-tunnel/              # Configuration files
  â”œâ”€â”€ config.yaml
  â”œâ”€â”€ users.yaml
  â”œâ”€â”€ server.crt
  â”œâ”€â”€ server.key
  â””â”€â”€ ca.crt
/usr/local/bin/                # Management commands
  â”œâ”€â”€ smtp-tunnel-adduser
  â”œâ”€â”€ smtp-tunnel-deluser
  â”œâ”€â”€ smtp-tunnel-listusers
  â””â”€â”€ smtp-tunnel-update
</code></pre></div>
<hr/>


<ul dir="auto">
<li>Check server is running: <code>systemctl status smtp-tunnel</code> or <code>ps aux | grep server.py</code></li>
<li>Check port is open: <code>netstat -tlnp | grep 587</code></li>
<li>Check firewall: <code>ufw status</code></li>
</ul>

<ul dir="auto">
<li>Verify <code>username</code> and <code>secret</code> match in users.yaml</li>
<li>Check server time is accurate (within 5 minutes)</li>
<li>Run <code>smtp-tunnel-listusers -v</code> to verify user exists</li>
</ul>

<ul dir="auto">
<li>Check user&#39;s whitelist in users.yaml</li>
<li>Your current IP must match a whitelist entry</li>
<li>CIDR notation is supported (e.g., <code>10.0.0.0/8</code>)</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">âŒ &#34;Certificate verify failed&#34;</h3><a id="user-content--certificate-verify-failed" aria-label="Permalink: âŒ &#34;Certificate verify failed&#34;" href="#-certificate-verify-failed"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Ensure you&#39;re using a domain name, not IP address</li>
<li>Verify <code>server_host</code> matches the certificate hostname</li>
<li>Ensure you have the correct <code>ca.crt</code> from the server</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="# Enable detailed logging
python server.py -d
python client.py -d

# View systemd logs
journalctl -u smtp-tunnel -f"><pre><span><span>#</span> Enable detailed logging</span>
python server.py -d
python client.py -d

<span><span>#</span> View systemd logs</span>
journalctl -u smtp-tunnel -f</pre></div>
<hr/>

<ul dir="auto">
<li>âœ… <strong>Always use a domain name</strong> for proper TLS verification</li>
<li>âœ… <strong>Always use <code>ca_cert</code></strong> to prevent man-in-the-middle attacks</li>
<li>âœ… <strong>Use <code>smtp-tunnel-adduser</code></strong> to generate strong secrets automatically</li>
<li>âœ… <strong>Use per-user IP whitelists</strong> if you know client IPs</li>
<li>âœ… <strong>Protect <code>users.yaml</code></strong> - contains all user secrets (chmod 600)</li>
<li>âœ… <strong>Disable logging</strong> for sensitive users with <code>logging: false</code></li>
</ul>
<blockquote>
<p dir="auto">ğŸ“š For detailed security analysis and threat model, see <a href="https://hamy.xyz/x011/smtp-tunnel-proxy/blob/main/TECHNICAL.md">TECHNICAL.md</a>.</p>
</blockquote>
<hr/>

<p dir="auto">This project is provided for educational and authorized use only. Use responsibly and in accordance with applicable laws.</p>
<hr/>

<p dir="auto">This tool is designed for legitimate privacy and censorship circumvention purposes. Users are responsible for ensuring their use complies with applicable laws and regulations.</p>
<hr/>
<p dir="auto"><em>Made with â¤ï¸ for internet freedom</em></p>
</article></div></div>
  </body>
</html>
