<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://solutionspace.blog/2022/06/18/map-data-v-false-assumptions-programmers-make/">Original</a>
    <h1>Map Data: False Assumptions Programmers Make</h1>
    
    <div id="readability-page-1" class="page"><div>
				
<p>Famously, engineers tend to make wrong assumptions about a lot of things: <a href="https://shinesolutions.com/2018/01/08/falsehoods-programmers-believe-about-names-with-examples/">Names</a> and <a href="https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time">time</a> are two well-known examples. Maps are a rich source of edge cases. Especially when you start dealing with global maps, be prepared: That weird situation you assume does not exist? Somewhere in the world, it does.</p>



<p>This article is part of a series about the specific challenges of working with map data. <a href="https://solutionspace.blog/2022/05/13/map-data-i-its-all-about-relations/">Part one of the series can be found here</a>.</p>



<figure><img data-attachment-id="1598" data-permalink="https://solutionspace.blog/2022/06/18/map-data-v-false-assumptions-programmers-make/exceptions-2/" data-orig-file="https://danielmescheder.files.wordpress.com/2022/04/exceptions.png" data-orig-size="768,1024" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="exceptions" data-image-description="" data-image-caption="" data-medium-file="https://danielmescheder.files.wordpress.com/2022/04/exceptions.png?w=225" data-large-file="https://danielmescheder.files.wordpress.com/2022/04/exceptions.png?w=736" src="https://danielmescheder.files.wordpress.com/2022/04/exceptions.png?w=768" alt="" srcset="https://danielmescheder.files.wordpress.com/2022/04/exceptions.png 768w, https://danielmescheder.files.wordpress.com/2022/04/exceptions.png?w=113 113w, https://danielmescheder.files.wordpress.com/2022/04/exceptions.png?w=225 225w" sizes="(max-width: 768px) 100vw, 768px"/></figure>



<p>In the following, let us consider some flawed assumptions.</p>



<h2>Assuming That Countries Have Simple Shapes</h2>



<p>The first wrong assumption is to think that a country shape can always be represented by a simple polygon. Most people will directly come up with counterexamples to this assumption: Countries can comprise islands, enclaves, or exclaves.</p>



<p>It gets more complex than that, however: The image above shows a snapshot of the town Baarle-Hertog (BE) and Baarle-Nassau (NL). Two things stand out: Not only is Baarle-Hertog a Belgian exclave with a very complicated shape, in some parts only covering a couple of houses, it also contains enclaves inside of the exclave.</p>



<p>Until 2015, there even existed a third-order enclave: <a href="https://en.wikipedia.org/wiki/Dahala_Khagrabari">Dahala Khagrabari</a> was a piece of India within a piece of Bangladesh within a piece of India within Bangladesh. In 2015, the situation was simplified in an exchange of land between the two countries. I like to think that this decision was a consequence of the violent resistance of rioting cartographers.</p>



<h2>Assuming That Everything Is A Country</h2>



<p>Here is an interesting question: If I point you to any arbitrary point of land in the world, will you always be able to tell me what country it is in?</p>



<p>I already went through one of the counterexamples to this in a <a href="https://solutionspace.blog/2022/05/23/map-data-ii-the-role-of-geopolitics/">previous article on geopolitics</a>: The answer may depend on the political stance that the viewer.</p>



<p>There are other counterexamples, however: Antarctica, is in some but not all areas claimed by countries. However, these claims are not typically part of a political map.</p>



<p>There are areas in the world that are simply no man’s land. (<a href="https://en.wikipedia.org/wiki/Terra_nullius">Terra Nullius</a> if you want to sound smart at the next cocktail party). <a href="https://en.wikipedia.org/wiki/Bir_Tawil">Bir Tawil</a> is an interesting case to study: This area between Egypt and Sudan is claimed by neither of the two bordering countries. It is the only geopolitically disputed area on earth in which both parties state “Nah, this is not mine, it’s yours!”.</p>



<p>The handling of dependent territories can sometimes be a source of misplaced assumptions. While it is politically speaking correct to state that Curaçao is part of the Kingdom of the Netherlands, if you run a query for the average temperature in the Netherlands, in many cases including data from Willemstad does not correspond to the intention of the query. Often, it is helpful to be very specific in which sense you use the word “country”.</p>



<p>There is also the question of what counts as a piece of land. Do man-made structures count? An offshore oil rig might not quite qualify <a href="https://en.m.wikipedia.org/wiki/Principality_of_Sealand">for most people</a>. But then, China has famously <a href="https://amp.theguardian.com/world/2022/mar/21/china-has-fully-militarized-three-islands-in-south-china-sea-us-admiral-says">created islands in the South China Sea</a> to reinforce its claim on these contested waters which is a more complicated debate.</p>



<h2>Assuming That Administrative Divisions Are Homogeneous</h2>



<p>Most countries have some form of administrative partitioning: Germany is subdivided into federated states (Bundesländer) which in turn may be divided into districts and municipalities. Belgium is divided into regions, provinces, and municipalities and also has an orthogonal concept of language community which is part of its administrative subdivision.</p>



<p>The first mistake that we could make is to assume that such divisions are somewhat similar <a href="https://en.m.wikipedia.org/wiki/List_of_administrative_divisions_by_country">across countries</a>. The reality is that each country applies a slightly different subdivision and the administrative layers have different meanings depending on the national context. This makes drawing sub-national divisions on a global map a tricky challenge. Take the following rendering of the OpenStreetMap data of a part of Europe:</p>



<figure><img data-attachment-id="1747" data-permalink="https://solutionspace.blog/image-6/" data-orig-file="https://danielmescheder.files.wordpress.com/2022/04/image-6.png" data-orig-size="1142,857" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-6" data-image-description="" data-image-caption="" data-medium-file="https://danielmescheder.files.wordpress.com/2022/04/image-6.png?w=300" data-large-file="https://danielmescheder.files.wordpress.com/2022/04/image-6.png?w=736" src="https://danielmescheder.files.wordpress.com/2022/04/image-6.png?w=1024" alt="" srcset="https://danielmescheder.files.wordpress.com/2022/04/image-6.png?w=1024 1024w, https://danielmescheder.files.wordpress.com/2022/04/image-6.png?w=150 150w, https://danielmescheder.files.wordpress.com/2022/04/image-6.png?w=300 300w, https://danielmescheder.files.wordpress.com/2022/04/image-6.png?w=768 768w, https://danielmescheder.files.wordpress.com/2022/04/image-6.png 1142w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>Source: OpenStreetMap</figcaption></figure>



<p>This depiction could be taken to imply that French provinces, German bundesländer, Belgian regions, Swiss cantons, and the countries making up the UK are somewhat comparable entities. However, their political meaning is very different. While we might not be too bothered by this particular image where the shape of these administrative geometries is more orientation to the viewer than a significant component of the map, this starts to play an important role when you represent statistical data on this same map as the dataset from Moldova may be hard to compare to the data from the UK.</p>



<p>Not every country has an administrative subdivision: The island nation of Kiribati and the Vatican are counterexamples that only have the national level.</p>



<p>You may be tempted to think that at least within a country, the administrative division should follow a homogeneous structure. However, you would be wrong again.</p>



<p>Canada is partitioned into ten provinces and three territories. Each province defines its own administrative subdivision.</p>



<p>Bosnia Herzegovina is composed of two entities: The Federation of Bosnia and Herzegovina (not to be confused with the state) and the Republika Srpska. The former breaks down into cantons and then municipalities while the latter is directly subdivided into municipalities.</p>



<p>Can we at least be sure that administrative areas of a given level form a complete partitioning of a given country? Again, the answer is no. While the county-level subdivision completely covers the 50 US states (but not DC), the same is not true for the municipality level. Municipal borders could even overlap with county borders.</p>



<p>The image below illustrates this with OpenStreetMap administrative areas of levels 6-10 around the Bay Area:</p>



<figure><img data-attachment-id="1754" data-permalink="https://solutionspace.blog/2022/06/18/map-data-v-false-assumptions-programmers-make/adminareas/" data-orig-file="https://danielmescheder.files.wordpress.com/2022/04/adminareas.png" data-orig-size="707,768" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="adminareas" data-image-description="" data-image-caption="" data-medium-file="https://danielmescheder.files.wordpress.com/2022/04/adminareas.png?w=276" data-large-file="https://danielmescheder.files.wordpress.com/2022/04/adminareas.png?w=707" src="https://danielmescheder.files.wordpress.com/2022/04/adminareas.png?w=707" alt="" srcset="https://danielmescheder.files.wordpress.com/2022/04/adminareas.png 707w, https://danielmescheder.files.wordpress.com/2022/04/adminareas.png?w=138 138w, https://danielmescheder.files.wordpress.com/2022/04/adminareas.png?w=276 276w" sizes="(max-width: 707px) 100vw, 707px"/><figcaption>Source: OpenStreetMap</figcaption></figure>



<p>As this is not very practical for the processing of statistical data, the United States Census Bureau defines subdivisions for statistical purposes that are decoupled from the administrative structure of a state.</p>



<h2>Assuming That Addressing Schemes Follow A Simple Rule</h2>



<p>Addresses are a <a href="https://www.mjt.me.uk/posts/falsehoods-programmers-believe-about-addresses/">well-known source of wrong assumptions</a>. I want to highlight a number of striking examples you will come across when working with global map data.</p>



<p>Every country has its own convention with regard to addressing formatting. Here is a typically-formatted address from the UK:</p>


<div><pre title="">75 Belford Road
Edinburgh EH4 3DR
</pre></div>


<p>Here is a typical address from Germany:</p>


<div><pre title="">Durlacher Allee 97
76137 Karlsruhe
</pre></div>


<p>However, the differences go beyond different post-code conventions and number placement. Take Colombia as an example where addresses are identified through a grid system based on <em>calles</em> and <em>carreras</em> which can result in something like the following:</p>


<div><pre title="">Carrera 94 C 
No. 129 A - 04
Bogotá
</pre></div>


<p>Japan also uses a grid and districts, but <a href="https://en.wikipedia.org/wiki/Japanese_addressing_system">it is more complicated than that</a>. Rural addresses in Bangladesh don’t have a postcode. In many countries, there are addresses that only consist of a place name and don’t have a street number or even a street name. Qatar and the UAE do not use postal codes and not all streets and buildings are numbered – mail is typically delivered to PO Boxes.</p>



<p>The more you start looking at address data, the more you arrive at the conclusion that the only thing they have in common is that they are a sequence of characters and while it is common to find elements like street name and house number, it is impossible to give any guarantees.</p>



<h2>Assuming That Time Zones Follow A Logical System</h2>



<p>Time zones are a typical element that a digital map needs to provide. They are required for many use cases such as “what will be the local time when I arrive at the destination?”. OpenStreetMap supports time zones with the <a href="https://wiki.openstreetmap.org/wiki/Key:timezone">timezone tag</a>. Importantly, time zones are also a well-known trap for unsuspecting programmers.</p>



<figure><img data-attachment-id="1777" data-permalink="https://solutionspace.blog/image-1-2/" data-orig-file="https://danielmescheder.files.wordpress.com/2022/05/image-1.png" data-orig-size="1920,1035" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-1" data-image-description="" data-image-caption="" data-medium-file="https://danielmescheder.files.wordpress.com/2022/05/image-1.png?w=300" data-large-file="https://danielmescheder.files.wordpress.com/2022/05/image-1.png?w=736" src="https://danielmescheder.files.wordpress.com/2022/05/image-1.png?w=1024" alt="" srcset="https://danielmescheder.files.wordpress.com/2022/05/image-1.png?w=1024 1024w, https://danielmescheder.files.wordpress.com/2022/05/image-1.png?w=150 150w, https://danielmescheder.files.wordpress.com/2022/05/image-1.png?w=300 300w, https://danielmescheder.files.wordpress.com/2022/05/image-1.png?w=768 768w, https://danielmescheder.files.wordpress.com/2022/05/image-1.png 1920w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>Time zones of the world (<a href="https://en.wikipedia.org/wiki/Time_zone#/media/File:World_Time_Zones_Map.png">Source</a>)</figcaption></figure>



<p>Faulty assumptions include the idea that time-zone offsets will remain constant (<a href="https://www.timeanddate.com/news/time/">they don’t</a>), or that daylight saving time is synchronized across time zones (<a href="https://en.wikipedia.org/wiki/Daylight_saving_time_by_country">it isn’t</a>).</p>



<p>A well-known gotcha of time zones is the assumption that offsets are always multiples of a full hour. There are many counterexamples to this assumption: Iran Standard Time is defined as UTC +03:30 and the Chatham Islands in New Zealand use Chatham Standard Time, which is defined as UTC +12:45.</p>



<p>It would be tempting to assume that no city can be part of two time zones. However, from 2016 to 2017 <a href="https://en.wikipedia.org/wiki/Nicosia">Nicosia, Cyprus</a> was de-facto split into one part following UTC+2 in winter and UTC+3 in summer and another part observing UTC+3 all year round.</p>



<h2>Assuming That Countries Do Not Change</h2>



<p>It is easy to assume that country shapes are relatively stable. This assumption, if true, would simplify a lot in map data processing: You could cut your map into country-sized pieces and not worry about the shape of these cuts going forward. A newer version of one country could be stitched to an older version of a neighboring country. </p>



<p>Furthermore, you could easily cache operations that require information derived from a country. Here is an example: The country might determine the address scheme to be used and if the country shape was ever updated, you would need to invalidate any formatted addresses in the modified area. If country shapes remain stable, you could cache any formatted address until the address information itself changes.</p>



<p>Unfortunately, this assumption is not exactly accurate. Above we already came across one example of a country border change: The land swap between India and Bangladesh. Country borders can also change because of armed conflict or political shifts. Many of the examples we talked about in the <a href="https://solutionspace.blog/2022/05/23/map-data-ii-the-role-of-geopolitics/">article on geopolitics</a> can be sources of change.</p>



<p>Borders can also change for technical reasons. Often, for example, a border is defined by a natural landmark such as a river. Someone might improve the shape of that river, thereby slightly modifying the border. A different situation is a new border crossing road being added. For the reasons we talked about when we investigated <a href="https://solutionspace.blog/2022/05/13/map-data-i-its-all-about-relations/">the role of relations</a> in a map, this modification would likely add a shape point on the border geometry, again slightly altering the shape.</p>



<p>How much does this happen? We can find out using the <a href="https://heigit.org/big-spatial-data-analytics-en/ohsome/">Ohsome API</a>. The following query will count the number of geometry changes during the year 2021 to an administrative area with admin_level=2 (i.e. a country) in a somewhat arbitrary bounding box around Luxemburg:</p>


<div><pre title="">curl -X GET &#39;https://api.ohsome.org/v1/contributions/count?bboxes=5.393,50.5,6.77,49.2&amp;filter=type=boundary and boundary=administrative and admin_level=2&amp;time=2021-01-01,2022-01-01&amp;contributionType=geometryChange&#39;
</pre></div>


<p>Returning</p>


<div><pre title="">{
    &#34;attribution&#34;: {
        &#34;url&#34;: &#34;https://ohsome.org/copyrights&#34;,
        &#34;text&#34;: &#34;© OpenStreetMap contributors&#34;
    },
    &#34;apiVersion&#34;: &#34;1.6.3&#34;,
    &#34;result&#34;: [
        {
            &#34;fromTimestamp&#34;: &#34;2021-01-01T00:00:00Z&#34;,
            &#34;toTimestamp&#34;: &#34;2022-01-01T00:00:00Z&#34;,
            &#34;value&#34;: 138.0
        }
    ]
}
</pre></div>


<p>As are able to see for yourself there were 138 country geometry changes around Luxemburg in this time period.</p>



<p>Another faulty assumption you could make is that countries do not change names – the current events around the <a href="https://www.aljazeera.com/news/2022/6/2/un-registers-turkiye-as-new-country-name-for-turkey">country formerly known as Turkey</a> shows that they do.</p>



<h2>Assuming That Buildings Do Not Overlap</h2>



<p>It is easy to make assumptions about how buildings and other geometric entities relate to each other. Can two buildings ever overlap each other or overlap with a street? Naively you might conclude that this is not possible.</p>



<p>However, a map is a two-dimensional representation of a three-dimensional world so it is absolutely possible that a building arches over a road or <a href="https://www.reddit.com/r/openstreetmap/comments/of3o3n/how_to_map_overlapping_buildings/">over another building</a>.</p>



<figure><img data-attachment-id="1779" data-permalink="https://solutionspace.blog/image-2-2/" data-orig-file="https://danielmescheder.files.wordpress.com/2022/05/image-2.png" data-orig-size="1449,794" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-2" data-image-description="" data-image-caption="" data-medium-file="https://danielmescheder.files.wordpress.com/2022/05/image-2.png?w=300" data-large-file="https://danielmescheder.files.wordpress.com/2022/05/image-2.png?w=736" src="https://danielmescheder.files.wordpress.com/2022/05/image-2.png?w=1024" alt="" srcset="https://danielmescheder.files.wordpress.com/2022/05/image-2.png?w=1024 1024w, https://danielmescheder.files.wordpress.com/2022/05/image-2.png?w=150 150w, https://danielmescheder.files.wordpress.com/2022/05/image-2.png?w=300 300w, https://danielmescheder.files.wordpress.com/2022/05/image-2.png?w=768 768w, https://danielmescheder.files.wordpress.com/2022/05/image-2.png 1449w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>Rue Wiertz in Brussels overlaps with the European Parlament building. (<a href="https://www.openstreetmap.org/#map=19/50.83867/4.37533">Source</a>)</figcaption></figure>



<h2>Assuming That The Road Network Is A Connected Graph</h2>



<p>Is routing between two points on the road network always possible? Islands are an obvious counterexample. While many larger islands with a road network do have ferry connections, not all do.</p>



<p>However, a decoupled routing graph can occur even without the presence of natural barriers: Not every piece of road is accessible to every vehicle type. Road networks that are part of factory zones are often private and closed to public traffic, some tunnels and bridges restrict the maximum height or weight of vehicles and some roads are simply closed to freight traffic.</p>



<p>These restrictions can create de-facto islands in the routing graph for certain vehicle classes.</p>



<h2>Assuming That There Are No Relevant Constructions Outside A Country’s Landmass</h2>



<p>It is common practice to cut a map into country-sized pieces and stitch them back together as needed. We have already discussed that this can be problematic in the face of changing country definitions. It is also important to be careful with how you deal with the water belts around a country as it could be tempting to focus only on a country’s landmass.</p>



<p>Doing this, however, might end up cutting out important constructions in the water like the Øresund Bridge between Copenhagen and Malmö.</p>



<figure><img data-attachment-id="1781" data-permalink="https://solutionspace.blog/image-3-3/" data-orig-file="https://danielmescheder.files.wordpress.com/2022/05/image-3.png" data-orig-size="4000,3000" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="image-3" data-image-description="" data-image-caption="" data-medium-file="https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=300" data-large-file="https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=736" src="https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=1024" alt="" srcset="https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=1024 1024w, https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=2048 2048w, https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=150 150w, https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=300 300w, https://danielmescheder.files.wordpress.com/2022/05/image-3.png?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>Øresund Bridge (<a href="https://upload.wikimedia.org/wikipedia/commons/0/01/%C3%98resund_Bridge_from_the_air_in_September_2015.jpg">Source</a>)</figcaption></figure>



<h2>Conclusion</h2>



<p>In this series of articles, I aimed to show some of the particular challenges you will come across when working with map data. While many of the typical data processing challenges also apply to map data, there are some particularities that set it apart. In this article, we saw that one particular challenge of map data is that everyone has an intuitive understanding of what a map ought to look like and will likely make assumptions based on this understanding. Assumptions that more often than not turn out to be false. The world is a big place and that edge case that you assumed will never occur – somewhere it will.</p>
			</div></div>
  </body>
</html>
