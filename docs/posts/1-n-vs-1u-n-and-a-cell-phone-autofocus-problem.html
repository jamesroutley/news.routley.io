<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2024/02/24/signext/">Original</a>
    <h1>1 &lt;&lt; n vs. 1U &lt;&lt; n and a cell phone autofocus problem</h1>
    
    
<p>
Maybe 15 years ago, I heard that a certain cell phone camera would lose 
the ability to autofocus for about two weeks, then it would go back to 
working for another two weeks, and so on.  It had something to do with 
the time (&lt;some unit&gt; since the epoch), the bits in use, and a fun 
little thing called <a href="https://en.wikipedia.org/wiki/Sign_extension">sign extension</a>.
</p>
<p>
I got some of this from a leaflet that was posted around where I worked 
at the time.  It was posted in areas where the public could see it, so 
I figure it&#39;s fair game.
</p>
<p>
Here&#39;s a nice little test program to show what I&#39;m talking about:
</p>
<pre class="terminal">#include &lt;stdio.h&gt;

static unsigned long set_bit_a(int bit) {
  return 1 &lt;&lt; bit;
}

static unsigned long set_bit_b(int bit) {
  return 1U &lt;&lt; bit;
}

int main() {
  printf(&#34;sizeof(unsigned long) here: %zd\n&#34;, sizeof(unsigned long));

  for (int i = 0; i &lt; 32; ++i) {
    printf(&#34;1 &lt;&lt; %d : 0x%lx | 0x%lx\n&#34;, i, set_bit_a(i), set_bit_b(i));
  }

  return 0;
}
</pre>
<p>
This does something mildly interesting when run on a 64 bit system:
</p>
<pre class="terminal">$ bin/exp/signext 
sizeof(unsigned long) here: 8
1 &lt;&lt; 0 : 0x1 | 0x1
1 &lt;&lt; 1 : 0x2 | 0x2
1 &lt;&lt; 2 : 0x4 | 0x4
1 &lt;&lt; 3 : 0x8 | 0x8
...
1 &lt;&lt; 28 : 0x10000000 | 0x10000000
1 &lt;&lt; 29 : 0x20000000 | 0x20000000
1 &lt;&lt; 30 : 0x40000000 | 0x40000000
1 &lt;&lt; 31 : 0xffffffff80000000 | 0x80000000
</pre>
<p>
Meanwhile, the same code on a 32 bit machine is relatively boring:
</p>
<pre class="terminal">$ ./t
sizeof(unsigned long) here: 4
1 &lt;&lt; 0 : 0x1 | 0x1
1 &lt;&lt; 1 : 0x2 | 0x2
1 &lt;&lt; 2 : 0x4 | 0x4
1 &lt;&lt; 3 : 0x8 | 0x8
...
1 &lt;&lt; 28 : 0x10000000 | 0x10000000
1 &lt;&lt; 29 : 0x20000000 | 0x20000000
1 &lt;&lt; 30 : 0x40000000 | 0x40000000
1 &lt;&lt; 31 : 0x80000000 | 0x80000000
</pre>
<p>
Gotta love it.
</p>

  </body>
</html>
