<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.pulumi.com/blog/converting-full-terraform-programs-to-pulumi/">Original</a>
    <h1>Converting Full Terraform Programs to Pulumi</h1>
    
    <div id="readability-page-1" class="page"><div><article><p>Posted on <time>Monday, Jun 12, 2023</time></p><section><p>Over the last 2 years, we’ve seen an increasing trend of cloud development teams migrating to Pulumi from Terraform. These teams often have experience with and meaningful investment in Terraform, but have also typically run into limits of expressivity, productivity, scalability, or reliability with their existing tools. One of the first questions we hear when they decide to move to Pulumi is “how will I migrate my existing Terraform projects over?”.</p><p>Today, we’re excited to announce new support for converting whole Terraform projects to Pulumi via the <code>pulumi convert</code> command in the Pulumi CLI. The new Terraform converter includes support for Terraform modules, core features of Terraform 1.4, and the majority of Terraform built-in functions, converting to Pulumi TypeScript, Python, Go, or C#. The new converter can significantly reduce the amount of time it takes to migrate Terraform to Pulumi. Let’s dig in to learn more about the new converter and how to use it.</p><p>Historically, we have offered a separate <a href="https://github.com/pulumi/tf2pulumi">tf2pulumi</a> tool to convert small snippets of Terraform to Pulumi. The new converter is no longer a separate tool. As of <a href="https://www.pulumi.com/docs/install/">v3.71.0</a>, you can run the new converter directly from the Pulumi CLI with the <code>pulumi convert --from terraform</code> command. And you can convert more than small snippets – the new converter supports converting full Terraform programs.</p><p>The new support in <code>pulumi convert</code> builds upon Pulumi’s <a href="https://www.pulumi.com/crosscode/">CrossCode</a> foundations for providing universal infrastructure as code support across a wide variety of programming languages and conversion tooling between them. It also introduces a new concept of <code>converter</code> plugin in the Pulumi engine, which allows conversion tools from other Infrastructure as Code platforms to be integrated into the same <code>pulumi convert</code> experience in the future, both as part of the core project, as well as by other ecosystem partners and contributors.</p><p>Several common use cases are supported via the new <code>pulumi convert --from terraform</code> support in the Pulumi CLI:</p><ul><li>Converting your organization’s existing Terraform projects to Pulumi</li><li>Converting your organization’s existing Terraform modules to Pulumi, to be consumed as part of existing Pulumi projects</li><li>Converting 3rd party open source Terraform modules or projects which address a use case you want to incorporate into your existing Pulumi projects</li></ul><h2 id="supported-terraform-features">Supported Terraform Features</h2><p>The following major features are supported:</p><ul><li>Variables, outputs, resources, and data sources</li><li>Terraform modules are converted to Pulumi components</li><li>Almost all HCL2 expression syntax</li></ul><p>In cases where the converter does not yet support a feature, the <code>pulumi convert</code> command succeeds but generates a TODO in the form of a call to a <pulumi-chooser type="language" options="typescript,python,go,csharp" option-style="none"><pulumi-choosable type="language" value="typescript"><code>notImplemented</code></pulumi-choosable>
<pulumi-choosable type="language" value="python"><code>not_implemented</code></pulumi-choosable>
<pulumi-choosable type="language" value="go"><code>notImplemented</code></pulumi-choosable>
<pulumi-choosable type="language" value="csharp"><code>NotImplemented</code></pulumi-choosable></pulumi-chooser> function that will need to be filled in manually. For most projects, the converter should be able to convert 90-95% of the code without any TODOs, with only a small percentage of items to address manually, significantly reducing migration time compared to doing an entire migration by hand. We are actively improving the converter by adding support for missing features and improving the overall quality of the converted code to reduce the amount of manual fix-ups required.</p><h2 id="converting-a-real-world-program">Converting a Real World Program</h2><p>Let’s walk through converting a Terraform codebase to Pulumi. <a href="https://github.com/avantoss/vault-infra">Avant Terraform Vault Setup</a> is an open source project that provides a high-availability installation of Vault using a variety of managed AWS services. It defines a fairly complex installation with dozens of AWS resources in over 1,000 lines of Terraform HCL, including the main program and a Vault module. Let’s convert it to Pulumi.</p><p>First, clone the repo and <code>cd</code> into the directory containing the Terraform project:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>$ git clone https://github.com/avantoss/vault-infra.git
</span></span><span><span>$ <span>cd</span> vault-infra/terraform/main
</span></span></code></pre></div><p>Next, run the converter:</p><div><pulumi-chooser type="language" options="typescript,python,go,csharp" mode=""><div><pulumi-choosable type="language" values="typescript" mode=""><div><pre tabindex="0"><code data-lang="bash"><span><span>$ pulumi convert --from terraform --language typescript --out pulumi
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="python" mode=""><div><pre tabindex="0"><code data-lang="bash"><span><span>$ pulumi convert --from terraform --language python --out pulumi
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="go" mode=""><div><pre tabindex="0"><code data-lang="bash"><span><span>$ pulumi convert --from terraform --language go --out pulumi
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="csharp" mode=""><div><pre tabindex="0"><code data-lang="bash"><span><span>$ pulumi convert --from terraform --language csharp --out pulumi
</span></span></code></pre></div></pulumi-choosable></div></pulumi-chooser></div><p><img src="https://www.pulumi.com/blog/converting-full-terraform-programs-to-pulumi/pulumi-convert-from-terraform.gif" alt="pulumi convert"/></p><p>The converted code is generated in the specified <code>pulumi</code> output directory. A complete Pulumi project is generated, including two primary code files specific to this this program’s conversion:</p><ul><li><pulumi-chooser type="language" options="javascript,typescript,python,go,csharp,fsharp,visualbasic,java,yaml" option-style="none"><pulumi-choosable type="language" value="javascript"><code>index.js</code></pulumi-choosable>
<pulumi-choosable type="language" value="typescript"><code>index.ts</code></pulumi-choosable>
<pulumi-choosable type="language" value="python"><code>__main__.py</code></pulumi-choosable>
<pulumi-choosable type="language" value="go"><code>main.go</code></pulumi-choosable>
<pulumi-choosable type="language" value="csharp"><code>Program.cs</code></pulumi-choosable>
<pulumi-choosable type="language" value="fsharp"><code>Program.fs</code></pulumi-choosable>
<pulumi-choosable type="language" value="visualbasic"><code>Program.vb</code></pulumi-choosable>
<pulumi-choosable type="language" value="java"><code>App.java</code></pulumi-choosable>
<pulumi-choosable type="language" value="yaml"><code>Pulumi.yaml</code></pulumi-choosable></pulumi-chooser>
contains the converted code for the main program</li><li><pulumi-chooser type="language" options="typescript,python,go,csharp" option-style="none"><pulumi-choosable type="language" value="typescript"><code>vault.ts</code></pulumi-choosable>
<pulumi-choosable type="language" value="python"><code>vault.py</code></pulumi-choosable>
<pulumi-choosable type="language" value="go"><code>vault.go</code></pulumi-choosable>
<pulumi-choosable type="language" value="csharp"><code>vault.cs</code></pulumi-choosable></pulumi-chooser> contains the <code>Vault</code> Pulumi component, converted from the Terraform module</li></ul><h3 id="addressing-todos">Addressing TODOs</h3><p>The file for the <code>Vault</code> component makes up the bulk of the implementation and contains some TODOs emitted by the converter that must be addressed manually.</p><p>For example, the converter doesn’t yet support the <code>replace</code>, <code>element</code>, and <code>split</code> built-in functions.</p><div><pulumi-chooser type="language" options="typescript,python,go,csharp" mode=""><div><pulumi-choosable type="language" values="typescript" mode=""><div><pre tabindex="0"><code data-lang="typescript"><span><span><span>const</span> <span>plainDomain</span> <span>=</span> <span>notImplemented</span><span>(</span><span>&#34;replace(element(split(\&#34;:\&#34;,var.vault_dns_address),1),\&#34;////\&#34;,\&#34;\&#34;)&#34;</span><span>);</span>
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="python" mode=""><div><pre tabindex="0"><code data-lang="python"><span><span><span>plain_domain</span> <span>=</span> <span>not_implemented</span><span>(</span><span>&#34;replace(element(split(</span><span>\&#34;</span><span>:</span><span>\&#34;</span><span>,var.vault_dns_address),1),</span><span>\&#34;</span><span>////</span><span>\&#34;</span><span>,</span><span>\&#34;\&#34;</span><span>)&#34;</span><span>)</span>
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="go" mode=""><div><pre tabindex="0"><code data-lang="go"><span><span><span>plainDomain</span> <span>:=</span> <span>notImplemented</span><span>(</span><span>&#34;replace(element(split(\&#34;:\&#34;,var.vault_dns_address),1),\&#34;////\&#34;,\&#34;\&#34;)&#34;</span><span>);</span>
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="csharp" mode=""><div><pre tabindex="0"><code data-lang="csharp"><span><span><span>var</span> <span>plainDomain</span> <span>=</span> <span>NotImplemented</span><span>(</span><span>&#34;replace(element(split(\&#34;:\&#34;,var.vault_dns_address),1),\&#34;////\&#34;,\&#34;\&#34;)&#34;</span><span>);</span>
</span></span></code></pre></div></pulumi-choosable></div></pulumi-chooser></div><p>We can fill in an implementation. Note that we get to use the full expressiveness of the native and familiar string manipulation libraries in our target programming language, instead of the relatively constrained options of the Terraform DSL.</p><div><pulumi-chooser type="language" options="typescript,python,go,csharp" mode=""><div><pulumi-choosable type="language" values="typescript" mode=""><div><pre tabindex="0"><code data-lang="typescript"><span><span><span>const</span> <span>plainDomain</span> <span>=</span> <span>pulumi</span><span>.</span><span>output</span><span>(</span><span>args</span><span>.</span><span>vaultDnsAddress</span><span>)</span>
</span></span><span><span>    <span>.</span><span>apply</span><span>(</span><span>a</span> <span>=&gt;</span> <span>a</span><span>.</span><span>split</span><span>(</span><span>&#34;:&#34;</span><span>)[</span><span>1</span><span>].</span><span>replace</span><span>(</span><span>&#34;//&#34;</span><span>,</span> <span>&#34;&#34;</span><span>));</span>
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="python" mode=""><div><pre tabindex="0"><code data-lang="python"><span><span><span>plain_domain</span> <span>=</span> <span>pulumi</span><span>.</span><span>Output</span><span>.</span><span>from_input</span><span>(</span><span>args</span><span>[</span><span>&#34;vaultDnsAddress&#34;</span><span>])</span> \
</span></span><span><span>    <span>.</span><span>apply</span><span>(</span><span>lambda</span> <span>a</span><span>:</span> <span>a</span><span>.</span><span>split</span><span>(</span><span>&#34;:&#34;</span><span>)[</span><span>1</span><span>]</span><span>.</span><span>replace</span><span>(</span><span>&#34;//&#34;</span><span>,</span> <span>&#34;&#34;</span><span>))</span>
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="go" mode=""><div><pre tabindex="0"><code data-lang="go"><span><span><span>plainDomain</span> <span>:=</span> <span>args</span><span>.</span><span>VaultDnsAddress</span><span>.</span><span>ToStringOutput</span><span>().</span><span>ApplyT</span><span>(</span><span>func</span><span>(</span><span>a</span> <span>string</span><span>)</span> <span>string</span> <span>{</span>
</span></span><span><span>	<span>return</span> <span>strings</span><span>.</span><span>ReplaceAll</span><span>(</span><span>strings</span><span>.</span><span>Split</span><span>(</span><span>a</span><span>,</span> <span>&#34;:&#34;</span><span>)[</span><span>1</span><span>],</span> <span>&#34;//&#34;</span><span>,</span> <span>&#34;&#34;</span><span>)</span>
</span></span><span><span><span>}).(</span><span>pulumi</span><span>.</span><span>StringOutput</span><span>)</span>
</span></span></code></pre></div></pulumi-choosable></div><div><pulumi-choosable type="language" values="csharp" mode=""><div><pre tabindex="0"><code data-lang="csharp"><span><span><span>var</span> <span>plainDomain</span> <span>=</span> <span>args</span><span>.</span><span>VaultDnsAddress</span>
</span></span><span><span>    <span>.</span><span>Apply</span><span>(</span><span>a</span> <span>=&gt;</span> <span>a</span><span>.</span><span>Split</span><span>(</span><span>&#39;:&#39;</span><span>)[</span><span>1</span><span>].</span><span>Replace</span><span>(</span><span>&#34;//&#34;</span><span>,</span> <span>&#34;&#34;</span><span>));</span>
</span></span></code></pre></div></pulumi-choosable></div></pulumi-chooser></div><h3 id="wrapping-up">Wrapping Up</h3><p>After addressing the remaining TODOs and some other tweaks so that the code compiles, we can now run the converted program with <code>pulumi up</code> to provision the Vault installation with Pulumi.</p><p>The converter has saved us a ton of time, converting over 1,000 lines of Terraform to a modern Pulumi language, with only a small number of manual fix-ups required. From here, we can leverage our IDE and compiler to further refactor and improve the code, one of the many benefits of Pulumi!</p><h2 id="importing-state">Importing State</h2><p>It’s great that the new converter can migrate Terraform projects to Pulumi for new deployments, but what if you want to import existing resource states from a <code>.tfstate</code> file to avoid unnecessarily recreating your infrastructure?</p><p>If you’re using TypeScript or Go, there is some additional code that can be added to your converted Pulumi program to import resource states from a <code>.tfstate</code> file. See the <a href="https://www.pulumi.com/docs/using-pulumi/adopting-pulumi/migrating-to-pulumi/from-terraform/#importing-resources">Importing Resources</a> reference documentation for more details.</p><p>We’re working to make this even more seamless with built-in support for importing state from <code>.tfstate</code> files in a future update coming soon.</p><h2 id="get-started">Get Started</h2><p>Support for the new <code>pulumi convert --from terraform</code> command is now available in v3.71.0 of the Pulumi CLI. <a href="https://www.pulumi.com/docs/install/">Download</a> the latest Pulumi CLI and give the new converter a try today. If you run into any issues, please <a href="https://github.com/pulumi/pulumi/issues/new/choose">let us know</a> or reach out in the <a href="https://slack.pulumi.com">Pulumi Community Slack</a> with any questions!</p></section><section><div><div><h4>Subscribe to the Pulumi Monthly Newsletter</h4></div></div></section></article></div></div>
  </body>
</html>
