<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.abctaylor.com/what-would-happen-to-low-latency-trading-if-exchanges-moved-to-the-cloud/">Original</a>
    <h1>Thoughts on low latency trading if exchanges went full cloud</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<div><h2>What would happen to low latency trading if exchanges moved to the cloud?</h2>


<div><p>A thought experiment on the winners, losers and new players in a cloud-driven stock, fx and commodity-trading world </p></div>




</div>



<div>
<div><figure><img width="2560" height="1920" src="https://blog.abctaylor.com/wp-content/uploads/2024/03/ull-blue-scaled.jpg" alt="Cisco Nexus switch with empty switchports" decoding="async" fetchpriority="high" srcset="https://blog.abctaylor.com/wp-content/uploads/2024/03/ull-blue-scaled.jpg 2560w, https://blog.abctaylor.com/wp-content/uploads/2024/03/ull-blue-300x225.jpg 300w, https://blog.abctaylor.com/wp-content/uploads/2024/03/ull-blue-1024x768.jpg 1024w, https://blog.abctaylor.com/wp-content/uploads/2024/03/ull-blue-768x576.jpg 768w, https://blog.abctaylor.com/wp-content/uploads/2024/03/ull-blue-1536x1152.jpg 1536w, https://blog.abctaylor.com/wp-content/uploads/2024/03/ull-blue-2048x1536.jpg 2048w" sizes="(max-width: 2560px) 100vw, 2560px"/></figure></div>
</div>
</div>
</div><div><div>
<p>A small UK stock exchange called Aquis hosts their matching engine in the cloud. Crypto exchanges are all cloud-based too. What if the NYSE, CME and others followed? The NASDAQ is already thinking about this since 2021. Let’s evaluate about how HFTs would adapt, and how small-time traders could benefit.</p>



<h2>A brief intro to ULL (ultra low latency) trading infra</h2>



<p>ULL trading firms go to a lot of trouble to get their servers and switches within the same buildings as the exchanges they trade with to reduce latency. Some firms don’t even use layer 1 switches to be competitive. </p>



<p>Most major exchanges run out of public data centres, for example:</p>



<ul>
<li>The <strong>NASDAQ </strong>is in an Equinix facility called NY11 in Carteret, NJ</li>



<li>The <strong>CME </strong>is in a site called Aurora</li>



<li>The <strong>LME </strong>sits in a Digital Realty facility Brick Lane (London), and so on</li>
</ul>



<p>The <strong>NYSE</strong> runs out of a facility in <strong>Mahwah, NJ, </strong>and whilst not a public colo, you can still rent a rack there.</p>



<p>You’ll pay heavily for a rack in one of these data centres. Individual quant traders cannot simply deploy ULL strategies here, due to the difficulty of sourcing the right hardware and getting set up in a site. You could go to a provider like Pico, but good infra is half of the competitive advantage when trading ULL (the other half is writing the trading strategy in low-level code and deploying it before other HFTs).</p>



<p>It’s not unthinkable that these facilities migrate to the cloud (which is where Coinbase’s trading happens).</p>



<h2>Can I trade stocks at low latency myself?</h2>



<ol>
<li>Reach out to Equinix, get a rack in NY4 with 5kVA power and about 4 cross connects</li>



<li>Reach out to Arista and get a <a href="https://www.arista.com/en/products/7130-layer-1-network-switches-quick-look" target="_blank" rel="noreferrer noopener">7130</a> low latency switch</li>



<li>Buy a Xilinx card that supports <a href="https://www.xilinx.com/products/boards-and-kits/x2-series/onload.html">Onload</a>, put it in a server, do this x2 for reliability</li>



<li>Buy a time server to handle PTP so you know exactly when the market opens</li>



<li>Become a member of the NYSE</li>



<li>Pay for market data</li>



<li>Get an Internet connection so you can connect your server to deploy strats</li>
</ol>



<p>You’re looking at six to seven figures of set up costs and about that in yearly running costs. In other words, it’s not happening. Similar pains will exist for trading FX with some bank like Citi, or futures with the CME.</p>



<h2>Low(ish) latency crypto</h2>



<p>Smart quant crypto traders will spin up many thousands of EC2 instances, measure latency to the exchange, and only keep the best instances, continually. This process allows them to eventually get EC2 instances to trade from probably in the same rack, or maybe on the same bare metal box, as the exchange. This is pretty good going. Traffic will still be routed through some sort of overlay network, but everyone has that penalty. There are no large upfront costs to setting up a strategy and market data is free.</p>



<h2>So, what happens if exchanges move?</h2>



<p>The NASDAQ is already bringing AWS infra into their facilities (<a href="https://www.datacenterdynamics.com/en/news/nasdaq-to-migrate-to-aws-use-on-premise-data-center-as-private-aws-local-zone/">link</a>). So let’s say the NYSE went full cloud tomorrow with AWS – what happens?</p>



<h5>You’re already behind</h5>



<p>ULL leaders like Jump Trading, XTX and PDT Partners probably already thought this through, so will already be ahead of you. They’d immediately deploy the abovementioned gameplan to continually find the lowest latency boxes. They’d probably try some EKS instances and bare metal instances too, in case the matching engines are now containerized, or bare-metal-ized.</p>



<h5>Time-keeping</h5>



<p>If you’re on a VM, you’re probably getting time via the hypervisor, but is it accurate enough? If you have a great strategy that needs to buy and sell two stocks 100 nanos (ns) after the open, and you know you’re <mark>3 mics</mark> (µs) away from the matching engine, you may want to send those two trades at 09:29:59.99999<mark>7</mark><mark>1</mark> at the hope your order arrives at <mark>100ns</mark> past 9.30am. Since 2023, high-precision PTP has been available on some EC2 instances (<a href="https://aws.amazon.com/about-aws/whats-new/2023/11/amazon-time-sync-service-microsecond-accurate-time/">link</a>), so it’s likely you’d want to be on one of these boxes. Amazon says the accuracy is “within microseconds” so this could be problematic. A strategy could be to send multiple trades at 09:29:59.99999{…, 4,5,6} and see if they get filled, but this risks double-trading (and breaking the exchange’s rules) which may well itself affect the strategy’s alpha.</p>



<h5>Market data</h5>



<p>The NYSE might make it your problem to deal with recording data, or they may make an S3 bucket available to anyone who pays them. Anyways, you probably want to pipe that directly into the strategy at filesystem level from the virtual NIC, and secondarily into Kafka/RedPanda and into something like kdb+ or ClickHouse to look at later.</p>



<h5>Strats/alphas</h5>



<p>Next, the strats. All HDL-written code for FPGAs becomes irrelevant, and winning strategies would quickly be ported to C, compiled with some optimal compiler for wahtever CPU the VM/container/bare metal box chosen is running on. For example, Intel has Math Kernel Library, whilst AMD has their own called AOCL. Strategies may even need to be compiled with optimizations for both.</p>



<h5>Optimisations</h5>



<ol>
<li><strong>Running some more lightweight OS</strong> like an ultra-thinned down Debian guest might yield some advantages to stock EC2 instances. This would be at the trade-off of increasing the time to build VMs, which will almost always land up somewhere useless for latency purposes.</li>



<li><strong>Going to bare metal even when the exchange is on EC2</strong> might still be better if you could remove some crucial mics of hypervisor overhead. The create and kill game might need to be played with EC2 Bare Metal, and this may offend Amazon.</li>



<li><strong>Hogging instances</strong> might pay, if this stops competitors getting good hosts. This would eat into PnL and is also wasteful on energy.</li>
</ol>



<h5>Nasty stuff that might happen</h5>



<ol>
<li>Bad players could do a ping test to many thousands of EC2 instances, find those which are also at very low latency to their good boxes (assuming these are competitors), and DDoS them during trading hours to hammer the hypervisor’s NIC. This would result in critical overhead occurring for competitors sending orders out.</li>



<li>Bad players could also generate large bursts of traffic on good EC2 instances they control on hypervisors believed to be close to the exchange, but don’t plan to trade on, to achieve the same thing in a less blatantly offensive way (e.g. say 40 servers in a rack, you guesstimate which physical box your trading VM is on, but also try find VMs on the other 39 good servers, and just generate spam traffic to add overhead to the actual NICs).</li>
</ol>



<h5>Unsolved problems</h5>



<ol>
<li>How would you short <strong>AMZN</strong> stock if there was an outage on AWS? This is super convenient for Amazon.</li>
</ol>



<h2>Winners and losers</h2>



<p>Smaller quant shops and sophisticated home traders are the winners, whilst professional HFTs would be losers due to their sophisticated hardware advantages becoming worthless.</p>



<p>Equinix is also a loser, and obviously Amazon is the biggest winner overall.</p>



<h2>Why did Aquis move?</h2>



<ol>
<li><strong>They probably can’t differentiate massively </strong>with LSEG or Euronext (who have way bigger tech spend), so being cloud-based is something different to do.</li>



<li><strong>AWS might have given them a good deal </strong>versus a colo, since Aquis doesn’t command the same sway someone like NYSE does to bless Equinix with a <s>cash cow</s> dairy farm.</li>



<li><strong>The UK is an HFT-hostile country</strong> (due to share trading taxes) where most UK ULL trading is on swaps and CFDs anyways, so they have little to lose by angering the HFTs by levelling the playing field.</li>
</ol>
</div>





</div></div>
  </body>
</html>
