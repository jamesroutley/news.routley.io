<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/musistudio/claude-code-router">Original</a>
    <h1>Claude Code Router</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/musistudio/claude-code-router/blob/main/README_zh.md">中文版</a></p>
<blockquote>
<p dir="auto">A powerful tool to route Claude Code requests to different models and customize any request.</p>
</blockquote>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/musistudio/claude-code-router/blob/main/blog/images/claude-code.png"><img src="https://github.com/musistudio/claude-code-router/raw/main/blog/images/claude-code.png" alt=""/></a></p>

<ul dir="auto">
<li><strong>Model Routing</strong>: Route requests to different models based on your needs (e.g., background tasks, thinking, long context).</li>
<li><strong>Multi-Provider Support</strong>: Supports various model providers like OpenRouter, DeepSeek, Ollama, Gemini, Volcengine, and SiliconFlow.</li>
<li><strong>Request/Response Transformation</strong>: Customize requests and responses for different providers using transformers.</li>
<li><strong>Dynamic Model Switching</strong>: Switch models on-the-fly within Claude Code using the <code>/model</code> command.</li>
<li><strong>GitHub Actions Integration</strong>: Trigger Claude Code tasks in your GitHub workflows.</li>
<li><strong>Plugin System</strong>: Extend functionality with custom transformers.</li>
</ul>


<p dir="auto">First, ensure you have <a href="https://docs.anthropic.com/en/docs/claude-code/quickstart" rel="nofollow">Claude Code</a> installed:</p>
<div dir="auto" data-snippet-clipboard-copy-content="npm install -g @anthropic-ai/claude-code"><pre>npm install -g @anthropic-ai/claude-code</pre></div>
<p dir="auto">Then, install Claude Code Router:</p>
<div dir="auto" data-snippet-clipboard-copy-content="npm install -g @musistudio/claude-code-router"><pre>npm install -g @musistudio/claude-code-router</pre></div>

<p dir="auto">Create and configure your <code>~/.claude-code-router/config.json</code> file. For more details, you can refer to <code>config.example.json</code>.</p>
<p dir="auto">The <code>config.json</code> file has several key sections:</p>
<ul dir="auto">
<li>
<p dir="auto"><strong><code>PROXY_URL</code></strong> (optional): You can set a proxy for API requests, for example: <code>&#34;PROXY_URL&#34;: &#34;http://127.0.0.1:7890&#34;</code>.</p>
</li>
<li>
<p dir="auto"><strong><code>LOG</code></strong> (optional): You can enable logging by setting it to <code>true</code>. The log file will be located at <code>$HOME/.claude-code-router.log</code>.</p>
</li>
<li>
<p dir="auto"><strong><code>APIKEY</code></strong> (optional): You can set a secret key to authenticate requests. When set, clients must provide this key in the <code>Authorization</code> header (e.g., <code>Bearer your-secret-key</code>) or the <code>x-api-key</code> header. Example: <code>&#34;APIKEY&#34;: &#34;your-secret-key&#34;</code>.</p>
</li>
<li>
<p dir="auto"><strong><code>HOST</code></strong> (optional): You can set the host address for the server. If <code>APIKEY</code> is not set, the host will be forced to <code>127.0.0.1</code> for security reasons to prevent unauthorized access. Example: <code>&#34;HOST&#34;: &#34;0.0.0.0&#34;</code>.</p>
</li>
<li>
<p dir="auto"><strong><code>Providers</code></strong>: Used to configure different model providers.</p>
</li>
<li>
<p dir="auto"><strong><code>Router</code></strong>: Used to set up routing rules. <code>default</code> specifies the default model, which will be used for all requests if no other route is configured.</p>
</li>
<li>
<p dir="auto"><strong><code>API_TIMEOUT_MS</code></strong>: Specifies the timeout for API calls in milliseconds.</p>
</li>
</ul>
<p dir="auto">Here is a comprehensive example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;APIKEY&#34;: &#34;your-secret-key&#34;,
  &#34;PROXY_URL&#34;: &#34;http://127.0.0.1:7890&#34;,
  &#34;LOG&#34;: true,
  &#34;API_TIMEOUT_MS&#34;: 600000,
  &#34;Providers&#34;: [
    {
      &#34;name&#34;: &#34;openrouter&#34;,
      &#34;api_base_url&#34;: &#34;https://openrouter.ai/api/v1/chat/completions&#34;,
      &#34;api_key&#34;: &#34;sk-xxx&#34;,
      &#34;models&#34;: [
        &#34;google/gemini-2.5-pro-preview&#34;,
        &#34;anthropic/claude-sonnet-4&#34;,
        &#34;anthropic/claude-3.5-sonnet&#34;,
        &#34;anthropic/claude-3.7-sonnet:thinking&#34;
      ],
      &#34;transformer&#34;: {
        &#34;use&#34;: [&#34;openrouter&#34;]
      }
    },
    {
      &#34;name&#34;: &#34;deepseek&#34;,
      &#34;api_base_url&#34;: &#34;https://api.deepseek.com/chat/completions&#34;,
      &#34;api_key&#34;: &#34;sk-xxx&#34;,
      &#34;models&#34;: [&#34;deepseek-chat&#34;, &#34;deepseek-reasoner&#34;],
      &#34;transformer&#34;: {
        &#34;use&#34;: [&#34;deepseek&#34;],
        &#34;deepseek-chat&#34;: {
          &#34;use&#34;: [&#34;tooluse&#34;]
        }
      }
    },
    {
      &#34;name&#34;: &#34;ollama&#34;,
      &#34;api_base_url&#34;: &#34;http://localhost:11434/v1/chat/completions&#34;,
      &#34;api_key&#34;: &#34;ollama&#34;,
      &#34;models&#34;: [&#34;qwen2.5-coder:latest&#34;]
    },
    {
      &#34;name&#34;: &#34;gemini&#34;,
      &#34;api_base_url&#34;: &#34;https://generativelanguage.googleapis.com/v1beta/models/&#34;,
      &#34;api_key&#34;: &#34;sk-xxx&#34;,
      &#34;models&#34;: [&#34;gemini-2.5-flash&#34;, &#34;gemini-2.5-pro&#34;],
      &#34;transformer&#34;: {
        &#34;use&#34;: [&#34;gemini&#34;]
      }
    },
    {
      &#34;name&#34;: &#34;volcengine&#34;,
      &#34;api_base_url&#34;: &#34;https://ark.cn-beijing.volces.com/api/v3/chat/completions&#34;,
      &#34;api_key&#34;: &#34;sk-xxx&#34;,
      &#34;models&#34;: [&#34;deepseek-v3-250324&#34;, &#34;deepseek-r1-250528&#34;],
      &#34;transformer&#34;: {
        &#34;use&#34;: [&#34;deepseek&#34;]
      }
    },
    {
      &#34;name&#34;: &#34;modelscope&#34;,
      &#34;api_base_url&#34;: &#34;https://api-inference.modelscope.cn/v1/chat/completions&#34;,
      &#34;api_key&#34;: &#34;&#34;,
      &#34;models&#34;: [&#34;Qwen/Qwen3-Coder-480B-A35B-Instruct&#34;, &#34;Qwen/Qwen3-235B-A22B-Thinking-2507&#34;],
      &#34;transformer&#34;: {
        &#34;use&#34;: [
          [
            &#34;maxtoken&#34;,
            {
              &#34;max_tokens&#34;: 65536
            }
          ],
          &#34;enhancetool&#34;
        ],
        &#34;Qwen/Qwen3-235B-A22B-Thinking-2507&#34;: {
          &#34;use&#34;: [&#34;reasoning&#34;]
        }
      }
    },
    {
      &#34;name&#34;: &#34;dashscope&#34;,
      &#34;api_base_url&#34;: &#34;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&#34;,
      &#34;api_key&#34;: &#34;&#34;,
      &#34;models&#34;: [&#34;qwen3-coder-plus&#34;],
      &#34;transformer&#34;: {
        &#34;use&#34;: [
          [
            &#34;maxtoken&#34;,
            {
              &#34;max_tokens&#34;: 65536
            }
          ],
          &#34;enhancetool&#34;
        ]
      }
    }
  ],
  &#34;Router&#34;: {
    &#34;default&#34;: &#34;deepseek,deepseek-chat&#34;,
    &#34;background&#34;: &#34;ollama,qwen2.5-coder:latest&#34;,
    &#34;think&#34;: &#34;deepseek,deepseek-reasoner&#34;,
    &#34;longContext&#34;: &#34;openrouter,google/gemini-2.5-pro-preview&#34;,
    &#34;longContextThreshold&#34;: 60000,
    &#34;webSearch&#34;: &#34;gemini,gemini-2.5-flash&#34;
  }
}"><pre>{
  <span>&#34;APIKEY&#34;</span>: <span><span>&#34;</span>your-secret-key<span>&#34;</span></span>,
  <span>&#34;PROXY_URL&#34;</span>: <span><span>&#34;</span>http://127.0.0.1:7890<span>&#34;</span></span>,
  <span>&#34;LOG&#34;</span>: <span>true</span>,
  <span>&#34;API_TIMEOUT_MS&#34;</span>: <span>600000</span>,
  <span>&#34;Providers&#34;</span>: [
    {
      <span>&#34;name&#34;</span>: <span><span>&#34;</span>openrouter<span>&#34;</span></span>,
      <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://openrouter.ai/api/v1/chat/completions<span>&#34;</span></span>,
      <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>sk-xxx<span>&#34;</span></span>,
      <span>&#34;models&#34;</span>: [
        <span><span>&#34;</span>google/gemini-2.5-pro-preview<span>&#34;</span></span>,
        <span><span>&#34;</span>anthropic/claude-sonnet-4<span>&#34;</span></span>,
        <span><span>&#34;</span>anthropic/claude-3.5-sonnet<span>&#34;</span></span>,
        <span><span>&#34;</span>anthropic/claude-3.7-sonnet:thinking<span>&#34;</span></span>
      ],
      <span>&#34;transformer&#34;</span>: {
        <span>&#34;use&#34;</span>: [<span><span>&#34;</span>openrouter<span>&#34;</span></span>]
      }
    },
    {
      <span>&#34;name&#34;</span>: <span><span>&#34;</span>deepseek<span>&#34;</span></span>,
      <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://api.deepseek.com/chat/completions<span>&#34;</span></span>,
      <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>sk-xxx<span>&#34;</span></span>,
      <span>&#34;models&#34;</span>: [<span><span>&#34;</span>deepseek-chat<span>&#34;</span></span>, <span><span>&#34;</span>deepseek-reasoner<span>&#34;</span></span>],
      <span>&#34;transformer&#34;</span>: {
        <span>&#34;use&#34;</span>: [<span><span>&#34;</span>deepseek<span>&#34;</span></span>],
        <span>&#34;deepseek-chat&#34;</span>: {
          <span>&#34;use&#34;</span>: [<span><span>&#34;</span>tooluse<span>&#34;</span></span>]
        }
      }
    },
    {
      <span>&#34;name&#34;</span>: <span><span>&#34;</span>ollama<span>&#34;</span></span>,
      <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>http://localhost:11434/v1/chat/completions<span>&#34;</span></span>,
      <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>ollama<span>&#34;</span></span>,
      <span>&#34;models&#34;</span>: [<span><span>&#34;</span>qwen2.5-coder:latest<span>&#34;</span></span>]
    },
    {
      <span>&#34;name&#34;</span>: <span><span>&#34;</span>gemini<span>&#34;</span></span>,
      <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://generativelanguage.googleapis.com/v1beta/models/<span>&#34;</span></span>,
      <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>sk-xxx<span>&#34;</span></span>,
      <span>&#34;models&#34;</span>: [<span><span>&#34;</span>gemini-2.5-flash<span>&#34;</span></span>, <span><span>&#34;</span>gemini-2.5-pro<span>&#34;</span></span>],
      <span>&#34;transformer&#34;</span>: {
        <span>&#34;use&#34;</span>: [<span><span>&#34;</span>gemini<span>&#34;</span></span>]
      }
    },
    {
      <span>&#34;name&#34;</span>: <span><span>&#34;</span>volcengine<span>&#34;</span></span>,
      <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://ark.cn-beijing.volces.com/api/v3/chat/completions<span>&#34;</span></span>,
      <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>sk-xxx<span>&#34;</span></span>,
      <span>&#34;models&#34;</span>: [<span><span>&#34;</span>deepseek-v3-250324<span>&#34;</span></span>, <span><span>&#34;</span>deepseek-r1-250528<span>&#34;</span></span>],
      <span>&#34;transformer&#34;</span>: {
        <span>&#34;use&#34;</span>: [<span><span>&#34;</span>deepseek<span>&#34;</span></span>]
      }
    },
    {
      <span>&#34;name&#34;</span>: <span><span>&#34;</span>modelscope<span>&#34;</span></span>,
      <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://api-inference.modelscope.cn/v1/chat/completions<span>&#34;</span></span>,
      <span>&#34;api_key&#34;</span>: <span><span>&#34;</span><span>&#34;</span></span>,
      <span>&#34;models&#34;</span>: [<span><span>&#34;</span>Qwen/Qwen3-Coder-480B-A35B-Instruct<span>&#34;</span></span>, <span><span>&#34;</span>Qwen/Qwen3-235B-A22B-Thinking-2507<span>&#34;</span></span>],
      <span>&#34;transformer&#34;</span>: {
        <span>&#34;use&#34;</span>: [
          [
            <span><span>&#34;</span>maxtoken<span>&#34;</span></span>,
            {
              <span>&#34;max_tokens&#34;</span>: <span>65536</span>
            }
          ],
          <span><span>&#34;</span>enhancetool<span>&#34;</span></span>
        ],
        <span>&#34;Qwen/Qwen3-235B-A22B-Thinking-2507&#34;</span>: {
          <span>&#34;use&#34;</span>: [<span><span>&#34;</span>reasoning<span>&#34;</span></span>]
        }
      }
    },
    {
      <span>&#34;name&#34;</span>: <span><span>&#34;</span>dashscope<span>&#34;</span></span>,
      <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions<span>&#34;</span></span>,
      <span>&#34;api_key&#34;</span>: <span><span>&#34;</span><span>&#34;</span></span>,
      <span>&#34;models&#34;</span>: [<span><span>&#34;</span>qwen3-coder-plus<span>&#34;</span></span>],
      <span>&#34;transformer&#34;</span>: {
        <span>&#34;use&#34;</span>: [
          [
            <span><span>&#34;</span>maxtoken<span>&#34;</span></span>,
            {
              <span>&#34;max_tokens&#34;</span>: <span>65536</span>
            }
          ],
          <span><span>&#34;</span>enhancetool<span>&#34;</span></span>
        ]
      }
    }
  ],
  <span>&#34;Router&#34;</span>: {
    <span>&#34;default&#34;</span>: <span><span>&#34;</span>deepseek,deepseek-chat<span>&#34;</span></span>,
    <span>&#34;background&#34;</span>: <span><span>&#34;</span>ollama,qwen2.5-coder:latest<span>&#34;</span></span>,
    <span>&#34;think&#34;</span>: <span><span>&#34;</span>deepseek,deepseek-reasoner<span>&#34;</span></span>,
    <span>&#34;longContext&#34;</span>: <span><span>&#34;</span>openrouter,google/gemini-2.5-pro-preview<span>&#34;</span></span>,
    <span>&#34;longContextThreshold&#34;</span>: <span>60000</span>,
    <span>&#34;webSearch&#34;</span>: <span><span>&#34;</span>gemini,gemini-2.5-flash<span>&#34;</span></span>
  }
}</pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">3. Running Claude Code with the Router</h3><a id="user-content-3-running-claude-code-with-the-router" aria-label="Permalink: 3. Running Claude Code with the Router" href="#3-running-claude-code-with-the-router"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Start Claude Code using the router:</p>

<blockquote>
<p dir="auto"><strong>Note</strong>: After modifying the configuration file, you need to restart the service for the changes to take effect:</p>

</blockquote>

<p dir="auto">The <code>Providers</code> array is where you define the different model providers you want to use. Each provider object requires:</p>
<ul dir="auto">
<li><code>name</code>: A unique name for the provider.</li>
<li><code>api_base_url</code>: The full API endpoint for chat completions.</li>
<li><code>api_key</code>: Your API key for the provider.</li>
<li><code>models</code>: A list of model names available from this provider.</li>
<li><code>transformer</code> (optional): Specifies transformers to process requests and responses.</li>
</ul>

<p dir="auto">Transformers allow you to modify the request and response payloads to ensure compatibility with different provider APIs.</p>
<ul dir="auto">
<li>
<p dir="auto"><strong>Global Transformer</strong>: Apply a transformer to all models from a provider. In this example, the <code>openrouter</code> transformer is applied to all models under the <code>openrouter</code> provider.</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;name&#34;: &#34;openrouter&#34;,
  &#34;api_base_url&#34;: &#34;https://openrouter.ai/api/v1/chat/completions&#34;,
  &#34;api_key&#34;: &#34;sk-xxx&#34;,
  &#34;models&#34;: [
    &#34;google/gemini-2.5-pro-preview&#34;,
    &#34;anthropic/claude-sonnet-4&#34;,
    &#34;anthropic/claude-3.5-sonnet&#34;
  ],
  &#34;transformer&#34;: { &#34;use&#34;: [&#34;openrouter&#34;] }
}"><pre>{
  <span>&#34;name&#34;</span>: <span><span>&#34;</span>openrouter<span>&#34;</span></span>,
  <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://openrouter.ai/api/v1/chat/completions<span>&#34;</span></span>,
  <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>sk-xxx<span>&#34;</span></span>,
  <span>&#34;models&#34;</span>: [
    <span><span>&#34;</span>google/gemini-2.5-pro-preview<span>&#34;</span></span>,
    <span><span>&#34;</span>anthropic/claude-sonnet-4<span>&#34;</span></span>,
    <span><span>&#34;</span>anthropic/claude-3.5-sonnet<span>&#34;</span></span>
  ],
  <span>&#34;transformer&#34;</span>: { <span>&#34;use&#34;</span>: [<span><span>&#34;</span>openrouter<span>&#34;</span></span>] }
}</pre></div>
</li>
<li>
<p dir="auto"><strong>Model-Specific Transformer</strong>: Apply a transformer to a specific model. In this example, the <code>deepseek</code> transformer is applied to all models, and an additional <code>tooluse</code> transformer is applied only to the <code>deepseek-chat</code> model.</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;name&#34;: &#34;deepseek&#34;,
  &#34;api_base_url&#34;: &#34;https://api.deepseek.com/chat/completions&#34;,
  &#34;api_key&#34;: &#34;sk-xxx&#34;,
  &#34;models&#34;: [&#34;deepseek-chat&#34;, &#34;deepseek-reasoner&#34;],
  &#34;transformer&#34;: {
    &#34;use&#34;: [&#34;deepseek&#34;],
    &#34;deepseek-chat&#34;: { &#34;use&#34;: [&#34;tooluse&#34;] }
  }
}"><pre>{
  <span>&#34;name&#34;</span>: <span><span>&#34;</span>deepseek<span>&#34;</span></span>,
  <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://api.deepseek.com/chat/completions<span>&#34;</span></span>,
  <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>sk-xxx<span>&#34;</span></span>,
  <span>&#34;models&#34;</span>: [<span><span>&#34;</span>deepseek-chat<span>&#34;</span></span>, <span><span>&#34;</span>deepseek-reasoner<span>&#34;</span></span>],
  <span>&#34;transformer&#34;</span>: {
    <span>&#34;use&#34;</span>: [<span><span>&#34;</span>deepseek<span>&#34;</span></span>],
    <span>&#34;deepseek-chat&#34;</span>: { <span>&#34;use&#34;</span>: [<span><span>&#34;</span>tooluse<span>&#34;</span></span>] }
  }
}</pre></div>
</li>
<li>
<p dir="auto"><strong>Passing Options to a Transformer</strong>: Some transformers, like <code>maxtoken</code>, accept options. To pass options, use a nested array where the first element is the transformer name and the second is an options object.</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;name&#34;: &#34;siliconflow&#34;,
  &#34;api_base_url&#34;: &#34;https://api.siliconflow.cn/v1/chat/completions&#34;,
  &#34;api_key&#34;: &#34;sk-xxx&#34;,
  &#34;models&#34;: [&#34;moonshotai/Kimi-K2-Instruct&#34;],
  &#34;transformer&#34;: {
    &#34;use&#34;: [
      [
        &#34;maxtoken&#34;,
        {
          &#34;max_tokens&#34;: 16384
        }
      ]
    ]
  }
}"><pre>{
  <span>&#34;name&#34;</span>: <span><span>&#34;</span>siliconflow<span>&#34;</span></span>,
  <span>&#34;api_base_url&#34;</span>: <span><span>&#34;</span>https://api.siliconflow.cn/v1/chat/completions<span>&#34;</span></span>,
  <span>&#34;api_key&#34;</span>: <span><span>&#34;</span>sk-xxx<span>&#34;</span></span>,
  <span>&#34;models&#34;</span>: [<span><span>&#34;</span>moonshotai/Kimi-K2-Instruct<span>&#34;</span></span>],
  <span>&#34;transformer&#34;</span>: {
    <span>&#34;use&#34;</span>: [
      [
        <span><span>&#34;</span>maxtoken<span>&#34;</span></span>,
        {
          <span>&#34;max_tokens&#34;</span>: <span>16384</span>
        }
      ]
    ]
  }
}</pre></div>
</li>
</ul>
<p dir="auto"><strong>Available Built-in Transformers:</strong></p>
<ul dir="auto">
<li><code>deepseek</code>: Adapts requests/responses for DeepSeek API.</li>
<li><code>gemini</code>: Adapts requests/responses for Gemini API.</li>
<li><code>openrouter</code>: Adapts requests/responses for OpenRouter API.</li>
<li><code>groq</code>: Adapts requests/responses for groq API.</li>
<li><code>maxtoken</code>: Sets a specific <code>max_tokens</code> value.</li>
<li><code>tooluse</code>: Optimizes tool usage for certain models via <code>tool_choice</code>.</li>
<li><code>gemini-cli</code> (experimental): Unofficial support for Gemini via Gemini CLI <a href="https://gist.github.com/musistudio/1c13a65f35916a7ab690649d3df8d1cd">gemini-cli.js</a>.</li>
</ul>
<p dir="auto"><strong>Custom Transformers:</strong></p>
<p dir="auto">You can also create your own transformers and load them via the <code>transformers</code> field in <code>config.json</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;transformers&#34;: [
    {
      &#34;path&#34;: &#34;$HOME/.claude-code-router/plugins/gemini-cli.js&#34;,
      &#34;options&#34;: {
        &#34;project&#34;: &#34;xxx&#34;
      }
    }
  ]
}"><pre>{
  <span>&#34;transformers&#34;</span>: [
    {
      <span>&#34;path&#34;</span>: <span><span>&#34;</span>$HOME/.claude-code-router/plugins/gemini-cli.js<span>&#34;</span></span>,
      <span>&#34;options&#34;</span>: {
        <span>&#34;project&#34;</span>: <span><span>&#34;</span>xxx<span>&#34;</span></span>
      }
    }
  ]
}</pre></div>

<p dir="auto">The <code>Router</code> object defines which model to use for different scenarios:</p>
<ul dir="auto">
<li><code>default</code>: The default model for general tasks.</li>
<li><code>background</code>: A model for background tasks. This can be a smaller, local model to save costs.</li>
<li><code>think</code>: A model for reasoning-heavy tasks, like Plan Mode.</li>
<li><code>longContext</code>: A model for handling long contexts (e.g., &gt; 60K tokens).</li>
<li><code>longContextThreshold</code> (optional): The token count threshold for triggering the long context model. Defaults to 60000 if not specified.</li>
<li><code>webSearch</code>: Used for handling web search tasks and this requires the model itself to support the feature. If you&#39;re using openrouter, you need to add the <code>:online</code> suffix after the model name.</li>
</ul>
<p dir="auto">You can also switch models dynamically in Claude Code with the <code>/model</code> command:
<code>/model provider_name,model_name</code>
Example: <code>/model openrouter,anthropic/claude-3.5-sonnet</code></p>

<p dir="auto">For more advanced routing logic, you can specify a custom router script via the <code>CUSTOM_ROUTER_PATH</code> in your <code>config.json</code>. This allows you to implement complex routing rules beyond the default scenarios.</p>
<p dir="auto">In your <code>config.json</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  &#34;CUSTOM_ROUTER_PATH&#34;: &#34;$HOME/.claude-code-router/custom-router.js&#34;
}"><pre>{
  <span>&#34;CUSTOM_ROUTER_PATH&#34;</span>: <span><span>&#34;</span>$HOME/.claude-code-router/custom-router.js<span>&#34;</span></span>
}</pre></div>
<p dir="auto">The custom router file must be a JavaScript module that exports an <code>async</code> function. This function receives the request object and the config object as arguments and should return the provider and model name as a string (e.g., <code>&#34;provider_name,model_name&#34;</code>), or <code>null</code> to fall back to the default router.</p>
<p dir="auto">Here is an example of a <code>custom-router.js</code> based on <code>custom-router.example.js</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// $HOME/.claude-code-router/custom-router.js

/**
 * A custom router function to determine which model to use based on the request.
 *
 * @param {object} req - The request object from Claude Code, containing the request body.
 * @param {object} config - The application&#39;s config object.
 * @returns {Promise&lt;string|null&gt;} - A promise that resolves to the &#34;provider,model_name&#34; string, or null to use the default router.
 */
module.exports = async function router(req, config) {
  const userMessage = req.body.messages.find((m) =&gt; m.role === &#34;user&#34;)?.content;

  if (userMessage &amp;&amp; userMessage.includes(&#34;explain this code&#34;)) {
    // Use a powerful model for code explanation
    return &#34;openrouter,anthropic/claude-3.5-sonnet&#34;;
  }

  // Fallback to the default router configuration
  return null;
};"><pre><span>// $HOME/.claude-code-router/custom-router.js</span>

<span>/**</span>
<span> * A custom router function to determine which model to use based on the request.</span>
<span> *</span>
<span> * <span>@param</span> {<span>object</span>} req - The request object from Claude Code, containing the request body.</span>
<span> * <span>@param</span> {<span>object</span>} config - The application&#39;s config object.</span>
<span> * <span>@returns</span> {<span>Promise&lt;string|null&gt;</span>} - A promise that resolves to the &#34;provider,model_name&#34; string, or null to use the default router.</span>
<span> */</span>
<span>module</span><span>.</span><span>exports</span> <span>=</span> <span>async</span> <span>function</span> <span>router</span><span>(</span><span>req</span><span>,</span> <span>config</span><span>)</span> <span>{</span>
  <span>const</span> <span>userMessage</span> <span>=</span> <span>req</span><span>.</span><span>body</span><span>.</span><span>messages</span><span>.</span><span>find</span><span>(</span><span>(</span><span>m</span><span>)</span> <span>=&gt;</span> <span>m</span><span>.</span><span>role</span> <span>===</span> <span>&#34;user&#34;</span><span>)</span><span>?.</span><span>content</span><span>;</span>

  <span>if</span> <span>(</span><span>userMessage</span> <span>&amp;&amp;</span> <span>userMessage</span><span>.</span><span>includes</span><span>(</span><span>&#34;explain this code&#34;</span><span>)</span><span>)</span> <span>{</span>
    <span>// Use a powerful model for code explanation</span>
    <span>return</span> <span>&#34;openrouter,anthropic/claude-3.5-sonnet&#34;</span><span>;</span>
  <span>}</span>

  <span>// Fallback to the default router configuration</span>
  <span>return</span> <span>null</span><span>;</span>
<span>}</span><span>;</span></pre></div>

<p dir="auto">Integrate Claude Code Router into your CI/CD pipeline. After setting up <a href="https://docs.anthropic.com/en/docs/claude-code/github-actions" rel="nofollow">Claude Code Actions</a>, modify your <code>.github/workflows/claude.yaml</code> to use the router:</p>
<div dir="auto" data-snippet-clipboard-copy-content="name: Claude Code

on:
  issue_comment:
    types: [created]
  # ... other triggers

jobs:
  claude:
    if: |
      (github.event_name == &#39;issue_comment&#39; &amp;&amp; contains(github.event.comment.body, &#39;@claude&#39;)) ||
      # ... other conditions
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Prepare Environment
        run: |
          curl -fsSL https://bun.sh/install | bash
          mkdir -p $HOME/.claude-code-router
          cat &lt;&lt; &#39;EOF&#39; &gt; $HOME/.claude-code-router/config.json
          {
            &#34;log&#34;: true,
            &#34;OPENAI_API_KEY&#34;: &#34;${{ secrets.OPENAI_API_KEY }}&#34;,
            &#34;OPENAI_BASE_URL&#34;: &#34;https://api.deepseek.com&#34;,
            &#34;OPENAI_MODEL&#34;: &#34;deepseek-chat&#34;
          }
          EOF
        shell: bash

      - name: Start Claude Code Router
        run: |
          nohup ~/.bun/bin/bunx @musistudio/claude-code-router@1.0.8 start &amp;
        shell: bash

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@beta
        env:
          ANTHROPIC_BASE_URL: http://localhost:3456
        with:
          anthropic_api_key: &#34;any-string-is-ok&#34;"><pre><span>name</span>: <span>Claude Code</span>

<span>on</span>:
  <span>issue_comment</span>:
    <span>types</span>: <span>[created]</span>
  <span><span>#</span> ... other triggers</span>

<span>jobs</span>:
  <span>claude</span>:
    <span>if</span>: <span>|</span>
<span>      (github.event_name == &#39;issue_comment&#39; &amp;&amp; contains(github.event.comment.body, &#39;@claude&#39;)) ||</span>
<span>      # ... other conditions</span>
<span></span>    <span>runs-on</span>: <span>ubuntu-latest</span>
    <span>permissions</span>:
      <span>contents</span>: <span>read</span>
      <span>pull-requests</span>: <span>read</span>
      <span>issues</span>: <span>read</span>
      <span>id-token</span>: <span>write</span>
    <span>steps</span>:
      - <span>name</span>: <span>Checkout repository</span>
        <span>uses</span>: <span>actions/checkout@v4</span>
        <span>with</span>:
          <span>fetch-depth</span>: <span>1</span>

      - <span>name</span>: <span>Prepare Environment</span>
        <span>run</span>: <span>|</span>
<span>          curl -fsSL https://bun.sh/install | bash</span>
<span>          mkdir -p $HOME/.claude-code-router</span>
<span>          cat &lt;&lt; &#39;EOF&#39; &gt; $HOME/.claude-code-router/config.json</span>
<span>          {</span>
<span>            &#34;log&#34;: true,</span>
<span>            &#34;OPENAI_API_KEY&#34;: &#34;${{ secrets.OPENAI_API_KEY }}&#34;,</span>
<span>            &#34;OPENAI_BASE_URL&#34;: &#34;https://api.deepseek.com&#34;,</span>
<span>            &#34;OPENAI_MODEL&#34;: &#34;deepseek-chat&#34;</span>
<span>          }</span>
<span>          EOF</span>
<span></span>        <span>shell</span>: <span>bash</span>

      - <span>name</span>: <span>Start Claude Code Router</span>
        <span>run</span>: <span>|</span>
<span>          nohup ~/.bun/bin/bunx @musistudio/claude-code-router@1.0.8 start &amp;</span>
<span></span>        <span>shell</span>: <span>bash</span>

      - <span>name</span>: <span>Run Claude Code</span>
        <span>id</span>: <span>claude</span>
        <span>uses</span>: <span>anthropics/claude-code-action@beta</span>
        <span>env</span>:
          <span>ANTHROPIC_BASE_URL</span>: <span>http://localhost:3456</span>
        <span>with</span>:
          <span>anthropic_api_key</span>: <span><span>&#34;</span>any-string-is-ok<span>&#34;</span></span></pre></div>
<p dir="auto">This setup allows for interesting automations, like running tasks during off-peak hours to reduce API costs.</p>

<ul dir="auto">
<li><a href="https://github.com/musistudio/claude-code-router/blob/main/blog/en/project-motivation-and-how-it-works.md">Project Motivation and How It Works</a></li>
<li><a href="https://github.com/musistudio/claude-code-router/blob/main/blog/en/maybe-we-can-do-more-with-the-route.md">Maybe We Can Do More with the Router</a></li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">❤️ Support &amp; Sponsoring</h2><a id="user-content-️-support--sponsoring" aria-label="Permalink: ❤️ Support &amp; Sponsoring" href="#️-support--sponsoring"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you find this project helpful, please consider sponsoring its development. Your support is greatly appreciated!</p>
<p dir="auto"><a href="https://ko-fi.com/F1F31GN2GM" rel="nofollow"><img src="https://camo.githubusercontent.com/70e2ef5e0263b261f9a2a314bb1d6919d1d43292eed117fe8fc766a68c7d96ea/68747470733a2f2f6b6f2d66692e636f6d2f696d672f676974687562627574746f6e5f736d2e737667" alt="ko-fi" data-canonical-src="https://ko-fi.com/img/githubbutton_sm.svg"/></a></p>
<markdown-accessiblity-table></markdown-accessiblity-table>

<p dir="auto">A huge thank you to all our sponsors for their generous support!</p>
<ul dir="auto">
<li>@Simon Leischnig</li>
<li><a href="https://github.com/duanshuaimin">@duanshuaimin</a></li>
<li><a href="https://github.com/vrgitadmin">@vrgitadmin</a></li>
<li>@*o</li>
<li><a href="https://github.com/ceilwoo">@ceilwoo</a></li>
<li>@*说</li>
<li>@*更</li>
<li>@K*g</li>
<li>@R*R</li>
<li><a href="https://github.com/bobleer">@bobleer</a></li>
<li>@*苗</li>
<li>@*划</li>
<li><a href="https://github.com/Clarence-pan">@Clarence-pan</a></li>
<li><a href="https://github.com/carter003">@carter003</a></li>
<li>@S*r</li>
<li>@*晖</li>
<li>@*敏</li>
<li>@Z*z</li>
<li>@*然</li>
<li><a href="https://github.com/cluic">@cluic</a></li>
<li>@*苗</li>
<li><a href="https://github.com/PromptExpert">@PromptExpert</a></li>
<li>@*应</li>
<li><a href="https://github.com/yusnake">@yusnake</a></li>
<li>@*飞</li>
<li>@董*</li>
<li>@*汀</li>
<li>@*涯</li>
<li>@*:-）</li>
<li>@**磊</li>
<li>@*琢</li>
<li>@*成</li>
<li>@Z*o</li>
<li>@*琨</li>
<li><a href="https://github.com/congzhangzh">@congzhangzh</a></li>
<li>@*_</li>
<li>@Z*m</li>
</ul>
<p dir="auto">(If your name is masked, please contact me via my homepage email to update it with your GitHub username.)</p>
</article></div></div>
  </body>
</html>
