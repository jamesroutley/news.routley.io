<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.agwa.name/blog/post/roots_intermediates_and_resellers">Original</a>
    <h1>The Difference Between Root Certificate Authorities, Intermediates and Resellers</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>
It happens every so often: some organization that sells publicly-trusted SSL
certificates does something monumentally stupid, like <a href="https://www.bleepingcomputer.com/news/security/trustico-states-they-stored-private-keys-for-customers-ssl-certificates/" rel="external">generating, storing,
and then intentionally disclosing all of their customers&#39; private keys</a> (Trustico),
<a href="https://groups.google.com/a/ccadb.org/g/public/c/kqtoGeEv5Fc" rel="external">letting private keys be stolen via XSS</a> (ZeroSSL),
or most recently, <a href="https://github.com/acmesh-official/acme.sh/issues/4659" rel="external">literally exploiting remote code execution in ACME clients
as part of their issuance process</a> (HiCA aka QuantumCA).
</p>

<p>
When this happens, people inevitably refer to the certificate provider
as a certificate authority (CA), which is an organization with the
power to issue trusted certificates for any domain name.  They fear that the integrity of
the Internet&#39;s certificate authority system has been compromised by the &#34;CA&#34;&#39;s incompetence.
Something must be done!
</p>

<p>
<strong>But none of the organizations listed above are CAs</strong> - they just take
certificate requests and forward them to real CAs, who validate the
request and issue the certificate.  The Internet is safe - from these
organizations, at least.
</p>

<p>
In this post, I&#39;m going to define terms like certificate authority,
root CA, intermediate CA, and reseller, and explain whom you do and do
not need to worry about.
</p>

<p>
Note that I&#39;m going to talk only about publicly-trusted SSL certificate
authorities - i.e those which are trusted by
mainstream web browsers.
</p>


<h4>Certificate Authority Certificates</h4>

<p>
&#34;Certificate authority&#34; is a label that can apply both to SSL certificates
and to organizations.  A certificate is a CA if it can be used
to issue certificates which will be accepted by browsers.
There are two types of CA certificates: root and intermediate.
</p>

<p>
Root CA certificates, also known as &#34;trust anchors&#34; or just &#34;roots&#34;, are shipped with
your browser.  If you poke around your browser&#39;s settings,
you can find a list of root CA certificates.
</p>

<p>
Intermediate CA certificates, also known as &#34;subordinate CAs&#34; or just
&#34;intermediates&#34;, are certificates with the &#34;CA&#34; boolean set to true in
the Basic Constraints extension, and which were issued by a root or
another intermediate.  If you decode an intermediate CA certificate with
openssl, you&#39;ll see this in the extensions section:
</p>

<p><code>X509v3 Basic Constraints: critical
    CA:TRUE</code></p><p>
When you connect to a website, your browser has to verify that the
website&#39;s certificate was issued by a CA certificate.  If the website&#39;s
certificate was issued by a root, it&#39;s easy because the browser already
knows the public key needed to verify the certificate&#39;s signature.
If the website&#39;s certificate was issued by an intermediate, the browser
has to retrieve the intermediate from elsewhere, and then verify that
the intermediate was issued by a CA certificate, recurring as necessary
until it reaches a root.  The web server can help the browser out by <a href="https://www.whatsmychaincert.com/" rel="external">sending
intermediate certificates</a> along with the website&#39;s certificate,
and some browsers are able to retrieve intermediates from the URL included
in the certificate&#39;s AIA (Authority Information Access) field.
</p>

<p>
The purpose of this post is to discuss organizations, so for the rest
of this post, when I say &#34;certificate authority&#34; or &#34;CA&#34; I am referring
to an organization, not a certificate, unless otherwise specified.
</p>

<h4>Certificate Authority Organizations</h4>

<p>
An organization is a certificate authority if and only if they hold
the private key for one or more certificate authority certificates.
Holding the private key for a CA certificate is a big deal because it
gives the organization the power to create certificates that are valid
for any domain name on the Internet.  These are essentially the Keys to
the Internet.
</p>

<p>
Unfortunately, figuring out who holds a CA certificate&#39;s private key is
not straightforward.  CA certificates contain an organization name in
their subject field, and many people reasonably assume that this must
be the organization which holds the private key.  But as I explained
earlier this year, <a href="https://www.agwa.name/blog/post/the_certificate_issuer_field_is_a_lie">this is often not the case</a>.
<strong>I spend a lot of time
researching the certificate ecosystem, and I am not exaggerating when I
say that I completely ignore the organization name in CA certificates.</strong>
It is useless.  You have to look at other sources, like audit statements
and the <a href="https://www.ccadb.org/" rel="external">CCADB</a>, to figure out who really holds a CA certificate&#39;s key.
Consequentially, just because you see a company&#39;s name in a CA certificate,
it does not mean that it has a key which can be used to create certificates.
</p>

<h4>Internal vs External Intermediate Certificates</h4>

<p>
CAs aren&#39;t allowed to issue website certificates directly from root certificates,
so any CA which operates a root certificate is going to have to issue themselves
at least one intermediate certificate.  Since the CA retains control of the private key
for the intermediate, these are called internally-operated intermediate certificates.
Most intermediate certificates are internally-operated.
</p>

<p>
CAs are also able to issue intermediate certificates whose private key is
held by another organization, making the other organization a
certificate authority too.  These are called externally-operated
intermediate certificates, and there are two reasons they exist.
</p>

<p>
The more legitimate reason is that the other organization operates, or intends to operate,
root certificates, and would like to issue certificates
which work in older browsers whose trust stores don&#39;t include their roots.
By getting an intermediate from a more-established CA, they can issue certificates
which chain back to a root that is in more trust stores.  This is called cross-signing,
and a well-known example is Identrust cross-signing Let&#39;s
Encrypt.
</p>

<p>
The less-savory reason is that the other organization would like to become
a certificate authority without having to go through the onerous process
of asking each browser to include them.  Historically, this was a huge loophole which allowed organizations to
become CAs with less oversight and thus less investment into security
and compliance.  Thankfully, this loophole is closing, and nowadays Mozilla
and Chrome require CAs to obtain approval before issuing externally-operated
intermediates to organizations which aren&#39;t already trusted CAs.
I would not be surprised if browsers eventually banned the practice outright,
leaving cross-signing as the only acceptable use case for externally-operated
intermediates.
</p>


<h4>Certificate Resellers</h4>

<p>
There&#39;s no standard definition of certificate reseller, but I
define it as any organization which provides certificates which
they do not issue themselves.  When someone requests a certificate from a
reseller, the reseller forwards the request to a certificate authority,
which validates the request and issues the certificate.  The reseller
has no access to the CA certificate&#39;s private key and no ability to cause
issuance themselves.  Typically, the reseller will use an API (ACME or
proprietary) to request certificates from the CA.  My company, <a href="https://sslmate.com" rel="external">SSLMate</a>,
is a reseller (though these days we mostly focus on <a href="https://sslmate.com/certspotter" rel="external">Certificate Transparency monitoring</a>).
</p>

<p>
The relationship between the reseller and the CA can take many forms.
In some cases, the reseller may enter into an explicit reseller agreement
with the CA and get access to special pricing or reseller-only APIs.  In other cases, the
reseller might obtain certificates from the CA using the same API and
pricing available to the general public.  The reseller might not even
pay the CA - there&#39;s nothing stopping someone from acting like a reseller
for free CAs like Let&#39;s Encrypt.  For example, <a href="https://dnsimple.com/ssl-certificates" rel="external">DNSimple</a> provides
paid certificates issued by Sectigo right alongside free certificates issued by
Let&#39;s Encrypt.  The CA might not know that their certificates are being resold - Let&#39;s
Encrypt, for instance, allows anyone to create an anonymous account.
</p>

<p>
An organization may be a reseller of multiple CAs, or even be <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1801345" rel="external">both
a reseller and a CA</a>.  A reseller might not get certificates
directly from a CA, but via a different reseller (SSLMate did this
in the early days because it was the only way to get good pricing
without making large purchase commitments).
</p>

<p>
A reseller might just provide certificates to customers, or they might use
the certificates to provide a larger service, such as web hosting or
a CDN (for example, <a href="https://developers.cloudflare.com/ssl/reference/certificate-authorities/" rel="external">Cloudflare</a>).
</p>

<h4>White-Label / Branded Intermediate Certificates</h4>

<p>
Ideally, it would be easy to distinguish a reseller from a CA.
However, most resellers are middlemen who provide no
value over getting a certificate directly from a CA, and they don&#39;t
want people to know this.  So, for the right price, a CA will
issue themselves an <strong>internally-operated</strong> intermediate CA certificate with the reseller&#39;s name in
the organization field, and when the reseller requests a certificate,
the CA will issue the certificate from the &#34;branded&#34; intermediate certificate
instead of from an intermediate certificate with the CA&#39;s name in it.
</p>

<p>
The reseller does not have access to the private key of the branded
intermediate certificate.  Except for the name, everything about the
branded intermediate certificate - like the security controls and the
validation process - is exactly the same as the CA&#39;s non-branded intermediates.
Thus, the mere existence of a branded intermediate certificate does not in any
way affect the integrity of the certificate authority ecosystem, regardless
of how untrustworthy, incompetent, or malicious the organization named in the
certificate is.
</p>

<h4>What Should Worry You?</h4>

<p>
I spend a lot of time worrying about bad certificate authorities, but
bad resellers don&#39;t concern me. <strong>A bad reseller can harm only their own
customers, but a bad certificate authority can harm the entire Internet.</strong>
Yeah, it sucks if you choose a reseller who screws you, but
it&#39;s no different from choosing a bad hosting provider, domain registrar,
or any of the myriad other vendors needed to host a website.  As always,
caveat emptor.  In contrast, you can pick the best, most trustworthy
certificate authority around, and some garbage CA you&#39;ve never heard of
can still issue an attacker a certificate for your domain.  This is
why web browsers tightly regulate CAs, but not resellers.
</p>

<p>
Unfortunately, this doesn&#39;t stop people from freaking out when a two-bit reseller
with a branded intermediate (such as Trustico, ZeroSSL, or HiCA/QuantumCA) does something awful.  People flood
the mozilla-dev-security-policy mailing list to voice their concerns,
including those who have little knowledge of certificates and have never posted there before.  These discussions
are a distraction from far more important issues.  While the HiCA discussion was devolving into
off-topic blather, 
the certificate authority Buypass <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1838421" rel="external">disclosed in an
incident report</a> that they have
a domain validation process which involves their employees manually looking up and interpreting CAA records.
They are far from the only CA which does domain validation manually despite it being easy to automate,
and it&#39;s troubling because having a human involved gives attackers an opening to exploit
mistakes, bribery, or coercion to get unauthorized certificates for any domain.  
Buypass&#39; incident response, which blames &#34;human error&#34; instead of addressing the root cause,
won&#39;t make headlines
on Hacker News or be shared on Twitter with the popcorn emoji, but it&#39;s actually far more concerning than
the worst comments a reseller has ever made.
</p>

<h4>About the Author</h4>

<p>
I&#39;ve reported over 50 certificate authority compliance issues, and uncovered
evidence that led to the distrust of multiple certificate authorities and
Certificate Transparency logs.  My research has prompted changes to ACME and
Mozilla&#39;s Root Store Policy.
My company, <a href="https://sslmate.com" rel="external">SSLMate</a>,
offers a <a href="https://sslmate.com/ct_search_api" rel="external">JSON API for searching Certificate Transparency logs</a>
and <a href="https://sslmate.com/certspotter" rel="external">Cert Spotter, a service to monitor your domains for unauthorized, expiring,
or incorrectly-installed certificates</a>.
</p>

<h4>If you liked this post, you might like:</h4>
<ul><li><a href="https://www.agwa.name/blog/post/the_certificate_issuer_field_is_a_lie">The SSL Certificate Issuer Field is a Lie</a></li><li><a href="https://www.agwa.name/blog/post/domain_pricing_is_very_confusing">The Difference Between Domain Registries and Registrars</a></li><li><a href="https://www.agwa.name/blog/post/checking_if_a_certificate_is_revoked_how_hard_can_it_be">Checking if a Certificate is Revoked: How Hard Can It Be?</a></li></ul>

<h4>Stay Tuned: Let&#39;s Encrypt Incident</h4>

<p>
By popular demand, I will be blogging about how I found
<a href="https://news.ycombinator.com/item?id=36342808" rel="external">the compliance bug
which prompted last week&#39;s Let&#39;s Encrypt downtime</a>.
Be sure to subscribe by <a href="https://buttondown.email/agwa" rel="external">email</a> or
<a href="https://www.agwa.name/blog/feed">RSS</a>, or follow me on <a href="https://follow.agwa.name/agwa" rel="external">Mastodon</a> or
<a href="https://twitter.com/__agwa" rel="external">Twitter</a>.
</p>


</div></div>
  </body>
</html>
