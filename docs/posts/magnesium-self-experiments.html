<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gwern.net/nootropic/magnesium">Original</a>
    <h1>Magnesium Self-Experiments</h1>
    
    <div id="readability-page-1" class="page"><div id="page-metadata">
        
        <p>3 magnesium self-experiments on magnesium l-threonate and magnesium citrate.</p>
        
      </div><div id="markdownBody">
        <p>The elemental metal magnesium (<a href="https://examine.com/supplements/Magnesium/" id="Bl0CqwqS" data-link-icon="Eχ" data-link-icon-type="text,sans" data-link-icon-color="#5e3b76" title="Magnesium benefits, dosage, and side effects">Examine.com</a>), like <a href="https://gwern.net/lithium" id="gwern-lithium" title="&#39;Lithium in ground-water and well-being&#39;, Gwern 2010">lithium</a> or potassium (which didn’t <a href="https://gwern.net/nootropic/nootropics#potassium" id="gwern-nootropic-nootropics--potassium">help me</a> &amp; <a href="https://gwern.net/zeo/potassium" id="gwern-zeo-potassium" title="&#39;Potassium sleep experiments&#39;, Gwern 2012">damaged my sleep</a>), plays many <a href="https://en.wikipedia.org/wiki/Magnesium_in_biology" id="jv6UV-zK" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Magnesium_in_biology#bodyContent" title="Magnesium in biology">biological roles</a> and has an RDA for me of 400mg which is higher than I likely get (most people apparently get less, with <a href="https://gwern.net/doc/nootropic/magnesium/2005-king.pdf" id="king-et-al-2005" data-link-icon="pdf" data-link-icon-type="svg" data-link-icon-color="#f40f02" title="&#39;Dietary Magnesium and C-reactive Protein Levels&#39;, King et al 2005">68% of American adults &lt;RDA</a>; and while I frequently eat oats, milk, peanut butter, and whole-wheat bread, I don’t eat many leafy greens and my tap water is very soft). The anecdotes are the usual positive effects: general benefits, life improvements, higher affect; the interesting bits are the claims that magnesium is anxiolytic and affects sleep (positively, if you don’t mind the increase in dreaming, which makes me wonder if the benefits ascribed to <a href="https://en.wikipedia.org/wiki/Isolation_tank" id="RPPE-Jj0" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Isolation_tank#bodyContent" title="Isolation tank">float tanks</a> might not be due to absorbing magnesium via the <a href="https://en.wikipedia.org/wiki/Epsomite" id="ChJI0CwP" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Epsomite#bodyContent" title="Epsomite">Epsom salts</a> which provide the buoyancy).</p>
        <section id="l-threonate">
          
          <p>There are a variety of substances to get magnesium from. Considerable enthusiasm for the new compound <a href="https://en.wikipedia.org/wiki/Magnesium_L-threonate" id="RQF-ur58" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Magnesium_L-threonate#bodyContent" title="Magnesium L-threonate">magnesium l-threonate</a> was stirred by 2 small animal rat studies finding that magnesium l-threonate was able to increase magnesium levels in the brain and improve learning/memory tasks. (There are no published human trials as of October 2015, and <a href="https://gwern.net/doc/www/old.reddit.com/a84bd51511044c7e47574518a24b2eaec58fc989.html" id="KV1_93EH" data-link-icon="reddit" data-link-icon-type="svg" data-link-icon-color="#ff4500" data-url-archive="/doc/www/old.reddit.com/a84bd51511044c7e47574518a24b2eaec58fc989.html" data-url-original="https://www.reddit.com/r/Nootropics/comments/3pk4yv/magnesium_lthreonatemagtein_publication_bias_in/">evidence of publication bias</a>, which I take as evidence against there being large effects in humans.) Animal studies mean very little, of course (see <a href="https://gwern.net/replication" id="gwern-replication" title="&#39;The Replication Crisis: Flaws in Mainstream Science&#39;, Gwern 2010">the appendix</a>), but I thought it’d be interesting to try using l-threonate, so I bought the <span data-year-original="2013" data-amount-original="30" data-year-current="2025" data-amount-current="44.87" title="CPI inflation-adjusted US dollar: from nominal $30 in 2013 → real $44.87 in 2025">$44.87<span><sup>$30</sup><sub>2013</sub></span></span> <a href="https://www.amazon.com/gp/product/B006P57AFM/" id="s6ZQg3EK" data-link-icon="amazon" data-link-icon-type="svg" data-link-icon-color="#ffce53">“Life Extension Neuro-Mag Magnesium L-Threonate with Calcium and Vitamin D<sub>3</sub> (205g)”</a>, which according to the <a href="https://www.lef.org/Vitamins-Supplements/Item01602/Neuro-Mag-Magnesium-L-Threonate-with-Calcium-and-Vitamin-D3.html" id="4RlyZhca">LEF product page</a> works out to ~60g of “Magtein™ magnesium L-threonate” <span>and ~4.31g elemental magnesium inasmuch as LEF claims <span>2000<sub><span title="2000 was 25 years ago.">25ya</span></sub></span>mg of threonate powder provides 144mg elemental magnesium or a 14:1 ratio. (I don’t need the calcium or vitamin D</span><sub>3</sub>, but this was the only magnesium l-threonate on Amazon.) Experiment-wise, I’ll probably look at sleep metrics and <a href="https://en.wikipedia.org/wiki/Mnemosyne_%28software%29" id="jWUB0YIc" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Mnemosyne_%28software%29#bodyContent" title="Mnemosyne (software)">Mnemosyne</a> performance; I put off designing a blind self-experiment until after trying some.</p>
          <p>The powder itself is quite bulky; the recommended dose to hit 200mg of absorbed magnesium leads to ~7g of powder (so capping will be difficult) and the container provides only 30 doses’ worth (or each dose costs <span data-year-original="2013" data-amount-original="1" data-year-current="2025" data-amount-current="1.5" title="CPI inflation-adjusted US dollar: from nominal $1 in 2013 → real $1.5 in 2025">$1.5<span><sup>$1</sup><sub>2013</sub></span></span>!). It’s described as lemon-flavored, and it is, but it’s sickly-sweet unpleasant and since it’s so much powder, takes half a glass of water to dissolve it entirely and wash it down. Subjectively, I notice nothing after taking it for a week. I may try a simple A-B-A analysis of sleep or Mnemosyne, but I’m not optimistic. And given the large expense of LEF’s “Magtein”, it’s probably a non-starter even if there seems to be an effect. For sleep effects, I will have to look at more reasonably priced magnesium sources.</p>
          <p>One thing I did do was piggyback on my <a href="https://gwern.net/nootropic/nootropics#noopept" id="gwern-nootropic-nootropics--noopept">Noopept self-experiment</a>: I blinded &amp; randomized the Noopept for a real experiment, but simply made sure to vary the Magtein without worrying about blinding or randomizing it. (The powder is quite bulky.) The correlation the experiment turned in was an odds-ratio of 1.9; interesting and in the right direction (higher is better), but since the magnesium part wasn’t random or blind, not a causal result.</p>
          
        </section>
        <section id="citrate">
          
          <section id="experiment-1">
            <h2><a href="#experiment-1" title="Link to section: § &#39;Experiment 1&#39;">Experiment 1</a></h2>
            <div>
              <blockquote>
                <p>Encouraged by TruBrain’s magnesium &amp; my magnesium l-threonate use, I design and run a blind random self-experiment to see whether magnesium citrate supplementation would improve my mood or productivity. I collected ~200 days of data at two dose levels. The analysis finds that the net effect was negative, but a more detailed look shows time-varying effects with a large initial benefit negated by an increasingly-negative effect. Combined with my expectations, the long half-life, and the higher-than-intended dosage, I infer that I overdosed on the magnesium. To verify this, I will be running a followup experiment with a much smaller dose.</p>
              </blockquote>
            </div>
            <p>The original magnesium l-threonate caused me no apparent problems by the time I finished off the powder and usage correlated with better days, further supporting the hypothesis that magnesium helps it. But l-threonate would be difficult to cap (and hence blind self-experiment) and is ruinously expensive on a per-dose basis. So I looked around for alternatives for the followup; one of the most common compounds suggested was the citrate form because it is reasonably well-absorbed and causes fewer digestive problems, so I could just take that. Magnesium oxide is widely available it looks cheap, but the absorption/bioavailability problem makes it unattractive: at a 3:5 ratio, an estimate of <em>4%</em> absorption, a ZMA formulation of an impressive-sounding 500mg would be 500 × <span>3⁄5</span> × 0.04 = 12mg or a small fraction of RDAs for male adults like 400mg elemental. (Calcium shouldn’t be a problem since I get 220mg of calcium from my multivitamin and I enjoy dairy products daily.)</p>
            <p>Finding an usable product on Amazon caused me some difficulties. I wanted a 500mg magnesium-citrate-only product at &lt;<span data-year-original="2014" data-amount-original="20" data-year-current="2025" data-amount-current="29.47" title="CPI inflation-adjusted US dollar: from nominal $20 in 2014 → real $29.47 in 2025">$29.47<span><sup>$20</sup><sub>2014</sub></span></span> for 120 doses, but I discovered most of the selection for “magnesium citrate” had sub-500mg doses, involved <em>calcium</em> citrate or other substances like zinc (not necessarily a bad thing, but would confound an experiment), were mostly magnesium <em>oxide</em> rather than citrate, or some still other problem. Ultimately I settled on <a href="https://www.amazon.com/Solgar-Magnesium-Citrate-120-tablets/dp/B00013Z0ZG/" id="l330TaFq" data-link-icon="amazon" data-link-icon-type="svg" data-link-icon-color="#ffce53">Solgar’s 120x400mg magnesium citrate</a> (<span data-year-original="2014" data-amount-original="13" data-year-current="2025" data-amount-current="19.16" title="CPI inflation-adjusted US dollar: from nominal $13 in 2014 → real $19.16 in 2025">$19.16<span><sup>$13</sup><sub>2014</sub></span></span>) as acceptable. (To compare with the bulkiness of the LEF vitamin D+l-threonate powder, <a href="https://ods.od.nih.gov/factsheets/Magnesium-HealthProfessional/" id="g2-1e6nf" title="Magnesium—Health Professional Fact Sheet">the Office of Dietary Supplements</a> says magnesium citrate is 16% magnesium, so to get 400mg of magnesium as claimed, would take 2.5g of material, rather than 7g for 200mg; even if l-threonate is absorbed 100% and citrate 50%, the citrate is ahead. The pills turn out to be wider and longer than my 00 pills; if I want to get them into my gel capsules, I have to crush them into fine powder. The powder from one pill turns out to take up 2 00 pills.)</p>
            <p>My impression after the first two days (2 doses of 400mg each, one with breakfast &amp; then lunch) was positive. I did not have the rumored digestion problems, and the first day went excellently: I was up until 1:30AM working and even then didn’t feel like going to bed—and I probably should have since I then slept abominably, which made the second day merely a good day. The third day I took none and it was an ordinary day. This is consistent with what I expected from the LEF l-threonate &amp; TruBrain glycinate/lycinate, and so it is worth investigating with a self-experiment.</p>
            
            <section id="experiment">
              <h3><a href="#experiment" title="Link to section: § &#39;Experiment&#39;">Experiment</a></h3>
              <p>The basic idea is to remedy a deficiency (not look for acute stimulant effects) and magnesium has a slow excretion rate<a href="#fn1" id="fnref1" role="doc-noteref"><sup>1</sup></a>, so week-long blocks seem appropriate. I can reuse the same methodology as the <a href="https://en.wikipedia.org/wiki/Lithium" id="KzM5_jn-" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Lithium#bodyContent" title="Lithium">lithium</a> self-experiment. The response variables will be the usual mood/productivity self-rating and, since I was originally interested in magnesium for possible sleep quality improvements, a standardized score of sleep latency + # of awakenings + time spent awake (the same variable as my <a href="#gwern-zeo-potassium">potassium sleep experiment</a>).</p>
              <p>Since each 400mg pill takes up 2 00 pills, that’s 4 gel caps a day to reach 800mg magnesium citrate (ie. 136mg elemental magnesium), or 224 gel caps (2x120) for the first batch of Solgar magnesium pills. Turning the Solgar tablets into gel capsules was difficult enough that I switched to <a href="https://www.amazon.com/Foods-Magnesium-Citrate-Powder-Ounces/dp/B004189JCW/" id="a1RjThck" data-link-icon="amazon" data-link-icon-type="svg" data-link-icon-color="#ffce53">NOW Food’s 227g magnesium citrate powder</a> for the second batch.</p>
              <section id="power">
                <h4><a href="#power" title="Link to section: § &#39;Power&#39;">Power</a></h4>
                <p>Reusing the magnesium correlation from the first Noopept self-experiment and using the <em>t</em>-test as an approximation</p>
                <div id="cb1">
                  <pre><code><span id="cb1-1"><span>pwr.t.test</span>(<span>d =</span> (<span>0.27</span> <span>/</span> <span>sd</span>(npt<span>$</span>MP)), <span>power =</span> <span>0.8</span>, <span>type=</span><span>&#34;paired&#34;</span>, <span>alternative=</span><span>&#34;greater&#34;</span>)</span>
<span id="cb1-2"><span># Paired t test power calculation</span></span>
<span id="cb1-3"><span>#</span></span>
<span id="cb1-4"><span># n = 50.61</span></span>
<span id="cb1-5"><span># ...</span></span></code></pre>
                </div>
                <p>50 pairs of active/placebos or 100 days. With 120 tablets and 4 tablets used up, that leaves me 58 doses. That might seem adequate except the paired <em>t</em>-test approximation is overly-optimistic, and I also expect the non-randomized non-blinded correlation is too high which means that is overly-optimistic as well. The power would be lower than I’d prefer. I decided to simply order another bottle of Solgar’s &amp; double the sample size to be safe.</p>
                <p>Is 200 enough? There are no canned power functions for the ordinal <a href="https://en.wikipedia.org/wiki/Logistic_regression" id="cS8lCmX7" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Logistic_regression#bodyContent" title="Logistic regression">logistic regression</a> I would be using, so the standard advice is to estimate power by simulation: generating thousands of new datasets where we know by construction that the binary magnesium variable increases MP by 0.27 (such as by bootstrapping the original Noopept experiment’s data), and seeing how often in this collection the cutoff of <a href="https://en.wikipedia.org/wiki/Statistical_significance" id="P2KpkSBK" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Statistical_significance#bodyContent" title="Statistical-significance">statistical-significance</a> is passed when the usual analysis is done (background: <a href="https://stats.stackexchange.com/questions/22406/power-analysis-for-ordinal-logistic-regression" id="edjgrrfW" data-link-icon="stack-exchange" data-link-icon-type="svg" data-link-icon-color="#f48024" title="Power analysis for ordinal logistic regression">CrossValidated</a> or <a href="https://www.lexjansen.com/pharmasug/2005/statisticspharmacokinetics/sp05.pdf" id="gOugBYSK" data-link-icon="pdf" data-link-icon-type="svg" data-link-icon-color="#f40f02">“Power Analysis and Sample Size Estimation using Bootstrap”</a>). In this case, we leave alpha at 0.05, reuse the Noopept experiment’s data with its Magtein correlation, and ask for the power when <em>n</em> = 200</p>
                <div id="cb2">
                  <pre><code><span id="cb2-1"><span>library</span>(boot)</span>
<span id="cb2-2"><span>library</span>(rms)</span>
<span id="cb2-3">npt <span>&lt;-</span> <span>read.csv</span>(<span>&#34;https://gwern.net/doc/nootropic/quantified-self/2013-gwern-noopept.csv&#34;</span>)</span>
<span id="cb2-4">n <span>&lt;-</span> <span>200</span></span>
<span id="cb2-5">magteinPower <span>&lt;-</span> <span>function</span>(dt, indices) {</span>
<span id="cb2-6">    d <span>&lt;-</span> dt[<span>sample</span>(<span>nrow</span>(dt), n, <span>replace=</span><span>TRUE</span>), ] <span># new dataset, possibly larger than the original</span></span>
<span id="cb2-7">    lmodel <span>&lt;-</span> <span>lrm</span>(MP <span>~</span> Noopept <span>+</span> Magtein, <span>data =</span> d)</span>
<span id="cb2-8">    <span>return</span>(<span>anova</span>(lmodel)[<span>8</span>])</span>
<span id="cb2-9">}</span>
<span id="cb2-10">bs <span>&lt;-</span> <span>boot</span>(<span>data=</span>npt, <span>statistic=</span>magteinPower, <span>R=</span><span>100000</span>, <span>parallel=</span><span>&#34;multicore&#34;</span>, <span>ncpus=</span><span>4</span>)</span>
<span id="cb2-11">alpha <span>&lt;-</span> <span>0.05</span></span>
<span id="cb2-12"><span>print</span>(<span>sum</span>(bs<span>$</span>t<span>&lt;=</span>alpha)<span>/</span><span>length</span>(bs<span>$</span>t))</span>
<span id="cb2-13"><span># [1] 0.7132</span></span></code></pre>
                </div>
                <p>So the power will be ~71%.</p>
                
              </section>
              <section id="data">
                <h4><a href="#data" title="Link to section: § &#39;Data&#39;">Data</a></h4>
                <ol>
                  <li>
                    <p>27 August–2 September: 0</p>
                    <p>3 September–9 September: 1</p>
                  </li>
                  <li>
                    <p>10 September–15 September: 0</p>
                    <p>16 September–21 September: 1</p>
                  </li>
                  <li>
                    <p>22 September–28 September: 0</p>
                    <p>29 September–5 October: 1</p>
                  </li>
                  <li>
                    <p>6 October–12 October: 0</p>
                    <p>13 October–19 October: 1</p>
                  </li>
                  <li>
                    <p>21 October–27 October: 1</p>
                    <p>28 October–2 November: 0</p>
                  </li>
                  <li>
                    <p>5 November–11 November: 1 (skipped 3/4 November)</p>
                    <p>During 11 November, I accidentally unblinded myself while cleaning my room. Hence, I refilled the active jar and began a fresh pair of blocks.</p>
                  </li>
                  <li>
                    <p>12–17 November: 0</p>
                    <p>18–24 November: 1</p>
                  </li>
                  <li>
                    <p>25–29 November: 0; on 30 November, I again unblinded myself and started over later.</p>
                  </li>
                  <li>
                    <p>2–8 December: 1</p>
                    <p>9–15 December: 0</p>
                  </li>
                  <li>
                    <p>16–17 December: 0</p>
                    <p>18–19 December: 1</p>
                    <p>At this point, I discovered I had run out of magnesium pills and had forgotten to order the magnesium citrate powder I’d intended to. I still had a lot of Noopept pills for the concurrently running second Noopept self-experiment, but since I wanted to wrap up some other experiments with a big analysis at the end of the year, I decided to halt and resume in January <span>2014<sub><span title="2014 was 11 years ago.">11ya</span></sub></span>.</p>
                  </li>
                  <li>
                    <p>25–2014-01-31: 0</p>
                    <p>1 February–7 February: 1</p>
                    <p>For this batch, I tried out <a href="https://www.amazon.com/dp/B004189JCW/" id="-cqG97W1" data-link-icon="amazon" data-link-icon-type="svg" data-link-icon-color="#ffce53">“NOW Foods Magnesium Citrate Powder”</a> (<span data-year-original="2014" data-amount-original="7" data-year-current="2025" data-amount-current="10.32" title="CPI inflation-adjusted US dollar: from nominal $7 in 2014 → real $10.32 in 2025">$10.32<span><sup>$7</sup><sub>2014</sub></span></span> for 227g); the powder was still a bit sticky but much easier to work with than the Solgar pills, and the 227g made 249 gel capsule pills. The package estimates 119 serving of 315mg elemental magnesium, so a ratio of 0.315g magnesium for 1.9g magnesium citrate, implying that each gel cap pill then contains 0.152g magnesium ((119×315) ⧸ 249 = 150) and since I want a total dose of 0.8g, I need 5 of the gel cap pills a day or 35 per block.</p>
                  </li>
                  <li>
                    <p>9–15 February: 1 (skipped 8 February)</p>
                    <p>16–22 February: 0</p>
                  </li>
                  <li>
                    <p>23–1 March: 1</p>
                    <p>2–8 March: 0</p>
                  </li>
                  <li>
                    <p>9–15 March: 1</p>
                    <p>16–22 March: 0</p>
                  </li>
                  <li>
                    <p>23–29 March: 0</p>
                    <p>30 March–5 April: 1</p>
                  </li>
                  <li>
                    <p>6–12 April: 0</p>
                    <p>13–19 April: 1</p>
                  </li>
                  <li>
                    <p>20–26 April: 0</p>
                    <p>27 April–3 May: 1 <!-- subsequent non-randomized: 4 May --></p>
                  </li>
                </ol>
                <p>Subjectively, I have no particular comments, other than that (like the threonate), I noticed no diarrhea.</p>
              </section>
              <section id="analysis">
                <h4><a href="#analysis" title="Link to section: § &#39;Analysis&#39;">Analysis</a></h4>
                <p>Some prep:</p>
                <div id="cb3">
                  <pre><code><span id="cb3-1">magnesium <span>&lt;-</span> <span>read.csv</span>(<span>&#34;magnesium.csv&#34;</span>)</span>
<span id="cb3-2">mp <span>&lt;-</span> <span>read.csv</span>(<span>&#34;~/selfexperiment/mp.csv&#34;</span>)</span>
<span id="cb3-3">mp<span>$</span>MP <span>&lt;-</span> <span>as.integer</span>(<span>as.character</span>(mp<span>$</span>MP))</span>
<span id="cb3-4"><span>rm</span>(magnesium<span>$</span>MP)</span>
<span id="cb3-5">magnesium <span>&lt;-</span> <span>merge</span>(mp, magnesium, <span>all=</span><span>TRUE</span>)</span>
<span id="cb3-6"><span>write.csv</span>(magnesium, <span>file=</span><span>&#34;magnesium.csv&#34;</span>, <span>row.names=</span><span>FALSE</span>)</span></code></pre>
                </div>
                <p>The basic question: did the magnesium citrate increase MP?</p>
                <div id="cb4">
                  <pre><code><span id="cb4-1">magnesium <span>&lt;-</span> <span>read.csv</span>(<span>&#34;https://gwern.net/doc/nootropic/quantified-self/20132014-magnesium.csv&#34;</span>)</span>
<span id="cb4-2"><span>summary</span>(<span>lm</span>(MP <span>~</span> Magnesium.citrate, <span>data=</span>magnesium))</span>
<span id="cb4-3"><span># Coefficients:</span></span>
<span id="cb4-4"><span>#                    Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb4-5"><span># (Intercept)        3.276515   0.056677   57.81   &lt;2e-16</span></span>
<span id="cb4-6"><span># Magnesium.citrate -0.000543   0.000144   -3.79    2e-04</span></span>
<span id="cb4-7"><span>#</span></span>
<span id="cb4-8"><span># Residual standard error: 0.671 on 206 degrees of freedom</span></span>
<span id="cb4-9"><span>#   (678 observations deleted due to missingness)</span></span>
<span id="cb4-10"><span># Multiple R-squared:  0.065,   Adjusted R-squared:  0.0605</span></span>
<span id="cb4-11"><span># F-statistic: 14.3 on 1 and 206 DF,  p-value: 0.000201</span></span>
<span id="cb4-12"><span>mean</span>(<span>-</span><span>0.000543</span> <span>*</span> <span>c</span>(<span>136</span>, <span>800</span>))</span>
<span id="cb4-13"><span># [1] -0.2541</span></span></code></pre>
                </div>
                <p>The initial results are a shock: the mean effect of the magnesium citrate comes in at almost the exact same magnitude (-0.25) as had been estimated for the Magtein back in the original Noopept analysis (0.26), except the estimated average effect is <em>negative</em>, as in, the magnesium citrate was harmful, and statistically-significantly so. Huh?</p>
                <p>This was so unexpected that I wondered if I had somehow accidentally put the magnesium pills into the placebo pill baggie or had swapped values while typing up the data into a spreadsheet, and checked into that. The spreadsheet accorded with the log above, which rules out data entry mistakes; and looking over the log, I discovered that some earlier slip-ups were able to rule out the pill-swap: I had carelessly put in some placebo pills made using rice, in order to get rid of them, and that led to me being unblinded twice before I became irritated enough to pick them all out of the bag of placebos—but how could that happen if I had swapped the groups of pills?</p>
                <p>So I began looking further into the data to see just what had happened (perhaps bad luck on a few days?), and turned to a plot:</p>
                <div id="cb5">
                  <pre><code><span id="cb5-1"><span>library</span>(ggplot2)</span>
<span id="cb5-2">magnesium<span>$</span>Date <span>&lt;-</span> <span>as.Date</span>(magnesium<span>$</span>Date)</span>
<span id="cb5-3"><span>with</span>(magnesium[<span>559</span><span>:</span><span>nrow</span>(magnesium),],</span>
<span id="cb5-4"><span>qplot</span>(Date, MP, <span>color=</span><span>as.factor</span>(Magnesium.citrate), <span>legend=</span><span>&#34;Magnesium citrate&#34;</span>, <span>size=</span><span>I</span>(<span>7</span>)) <span>+</span></span>
<span id="cb5-5">       <span>scale_colour_manual</span>(<span>values=</span><span>c</span>(<span>&#34;gray49&#34;</span>, <span>&#34;red1&#34;</span>, <span>&#34;red3&#34;</span>), <span>name =</span> <span>&#34;Magnesium&#34;</span>))</span></code></pre>
                </div>
                <figure>
                  <p><img alt="MP categorical data plotted by date, colored by size of magnesium dose" data-aspect-ratio="175 / 104" decoding="async" height="832" loading="lazy" src="https://gwern.net/doc/nootropic/magnesium/2013-2014-gwern-magnesium-rawdata.png" width="1400"/></p>
                  <figcaption>
                    <p>MP categorical data plotted by date, colored by size of magnesium dose</p>
                  </figcaption>
                </figure>
                <p>One thing I notice looking at the data is that the red magnesium-free days seem to dominate the upper ranks towards the end, and blues appear mostly at the bottom, although this is a little hard to see because good days in general start to become sparse towards the end. Now, why would days start to be worse towards the end, and magnesium-dose days in particular?</p>
                <p>The grim surmise is: an accumulating overdose—no immediate acute effect, but the magnesium builds up, dragging down all days, but especially magnesium-dose days. The generally recognized symptoms of <a href="https://en.wikipedia.org/wiki/Hypermagnesemia" id="qyacYFTu" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Hypermagnesemia#bodyContent" title="Hypermagnesemia">hypermagnesemia</a> don’t include effect on mood or cognition, aside from <a href="https://chemocare.com/sideeffect/hypermagnesemia" id="KRCBFBvv" title="Hypermagnesemia">“muscle weakness, confusion, and decreased reflexes…poor appetite that does not improve”</a>, but it seems plausible that below medically-recognizable levels of distress like hypermagnesemia might still cause mental changes, and I wouldn’t expect any psychological research to have been done on this topic.</p>
                <p>A picture is worth a thousand words, particularly in this case where there seems to be temporal effects, different trends for the conditions, and general confusion. So, I drag up 2.5 years of MP data (for context), plot all the data, color by magnesium/non-magnesium, and fit different LOESS lines to each as a sort of smoothed average (since categorical data is hard to interpret as a bunch of dots), which yields:</p>
                <div id="cb6">
                  <pre><code><span id="cb6-1">magnesium[<span>is.na</span>(magnesium<span>$</span>Magnesium.citrate),]<span>$</span>Magnesium.citrate <span>&lt;-</span> <span>-</span><span>1</span></span>
<span id="cb6-2"><span>ggplot</span>(<span>data =</span> magnesium, <span>aes</span>(<span>x=</span>Date, <span>y=</span>MP, <span>col=</span><span>as.factor</span>(magnesium<span>$</span>Magnesium.citrate))) <span>+</span></span>
<span id="cb6-3"> <span>geom_point</span>(<span>size=</span><span>I</span>(<span>4</span>)) <span>+</span></span>
<span id="cb6-4"> <span>stat_smooth</span>() <span>+</span></span>
<span id="cb6-5"> <span>scale_colour_manual</span>(<span>values=</span><span>c</span>(<span>&#34;gray49&#34;</span>, <span>&#34;grey35&#34;</span>, <span>&#34;red1&#34;</span>, <span>&#34;red3&#34;</span> ),</span>
<span id="cb6-6">                     <span>name =</span> <span>&#34;Magnesium&#34;</span>)</span></code></pre>
                </div>
                <figure>
                  <p><img alt="Full MP dataseries, with smoothed moving averages of no magnesium, 136mg, &amp; 800mg doses" data-aspect-ratio="1400 / 831" decoding="async" height="831" loading="lazy" src="https://gwern.net/doc/nootropic/magnesium/2013-2014-gwern-magnesium-smoothed.jpg" width="1400"/></p>
                  <figcaption>
                    <p>Full MP dataseries, with smoothed moving averages of no magnesium, 136mg, &amp; 800mg doses</p>
                  </figcaption>
                </figure>
                <p>That really says it all: there’s an initial spike in MP, which reads like the promised stimulative effects possibly due to fixing a deficiency (a spike which doesn’t seem to have any counterparts in the previous history of MP), followed by a drastic plunge in the magnesium days but not so much the control days (indicating an acute effect when overloaded with magnesium), a partial recovery during the non-experimental Christmas break, another plunge, and finally recovery after the experiment has ended.</p>
                <p>We can verify the negative correlation with the date &amp; an interaction between magnesium and the date; I don’t know whether to treat the magnesium dose as a linear, categorical, or logical, so I’ll try all of them:</p>
                <div id="cb7">
                  <pre><code><span id="cb7-1">magnesium <span>&lt;-</span> <span>read.csv</span>(<span>&#34;https://gwern.net/doc/nootropic/quantified-self/20132014-magnesium.csv&#34;</span>)</span>
<span id="cb7-2">magnesium<span>$</span>Date <span>&lt;-</span> <span>as.integer</span>(magnesium<span>$</span>Date)</span>
<span id="cb7-3">slm <span>&lt;-</span> <span>step</span>(<span>lm</span>(MP <span>~</span> Magnesium.citrate <span>*</span> <span>as.logical</span>(Magnesium.citrate) <span>*</span></span>
<span id="cb7-4">                    <span>as.factor</span>(Magnesium.citrate) <span>*</span> Date <span>*</span> Noopept, <span>data=</span>magnesium))</span>
<span id="cb7-5"><span># MP ~ as.logical(Magnesium.citrate) + Date + as.logical(Magnesium.citrate):Date</span></span>
<span id="cb7-6"><span>summary</span>(slm)</span>
<span id="cb7-7"><span># Coefficients:</span></span>
<span id="cb7-8"><span>#                                         Estimate Std. Error t value Pr(&gt;|t|)</span></span>
<span id="cb7-9"><span># (Intercept)                             3.942875   0.571166    6.90  6.3e-11</span></span>
<span id="cb7-10"><span># as.logical(Magnesium.citrate)TRUE       1.217860   0.806212    1.51    0.132</span></span>
<span id="cb7-11"><span># Date                                   -0.000992   0.000830   -1.20    0.233</span></span>
<span id="cb7-12"><span># as.logical(Magnesium.citrate)TRUE:Date -0.002105   0.001173   -1.79    0.074</span></span>
<span id="cb7-13"><span>#</span></span>
<span id="cb7-14"><span># Residual standard error: 0.664 on 204 degrees of freedom</span></span>
<span id="cb7-15"><span>#   (678 observations deleted due to missingness)</span></span>
<span id="cb7-16"><span># Multiple R-squared:  0.0933,  Adjusted R-squared:  0.08</span></span>
<span id="cb7-17"><span># F-statistic:    7 on 3 and 204 DF,  p-value: 0.000167</span></span></code></pre>
                </div>
                <p>As feared and consistent with the accumulating overdose hypothesis, scores decrease over time and they decrease if magnesium is used that day. (The interaction isn’t statistically-significant, but I am not surprised: I powered this self-experiment to detect one main effect, not two main effects and an interaction.)</p>
                <p>But at least initially, the magnesium seemed to be remarkably useful. The crossover point, using this linear model, would have been somewhere around 20 days of the early small magnesium doses:</p>
                <div id="cb8">
                  <pre><code><span id="cb8-1"><span>## Extract estimated MP for continuous small magnesium dosing, then for no magnesium dosing;</span></span>
<span id="cb8-2"><span>## compare them pair-wise to see which is bigger, and count how many days favor magnesium dosing.</span></span>
<span id="cb8-3"><span>with</span>(magnesium[<span>!</span><span>is.na</span>(magnesium<span>$</span>Magnesium.citrate),], <span>sum</span>(<span>predict</span>(slm, <span>newdata=</span><span>data.frame</span>(<span>Date=</span>Date, <span>Magnesium.citrate=</span><span>136</span>)) <span>&gt;</span></span>
<span id="cb8-4">                                                          <span>predict</span>(slm, <span>newdata=</span><span>data.frame</span>(<span>Date=</span>Date, <span>Magnesium.citrate=</span><span>0</span>))))</span>
<span id="cb8-5"><span># [1] 20</span></span></code></pre>
                </div>
                <p>The final question is: since I was taking an overdose, how did I mess up? I thought I was making sure I got at least the right RDA of elemental magnesium by aiming for 800mg of elemental magnesium and carefully converting from raw powder weight. So I went back to the original references, and scrutinizing them closely, they really were talking about elemental magnesium and indicating I should be getting 400mg elemental a day, but I did notice something: I got the dose wrong for the Solgar pills, it wasn’t 800mg elemental, it was 800mg of <em>citrate</em>—I misread the label. So I went from taking ~130mg of elemental magnesium in the first period to ~800mg in the second; I don’t think it is an accident that the second period seems to have been much worse (between the plot and the time trend).</p>
                <p>I find this very troubling. The magnesium supplementation was harmful enough to do a lot of cumulative damage over the months involved (I could have done a <em>lot</em> of writing September 2013–June <span>2014<sub><span title="2014 was 11 years ago.">11ya</span></sub></span>), but not so blatantly harmful enough as to be noticeable without a randomized blind self-experiment or at least systematic data collection—neither of which are common among people who would be supplementing magnesium I would much prefer it if my magnesium overdose had come with visible harm (such as waking up in the middle of the night after a nightmare soaked in sweat), since then I’d know quickly and surely, as would anyone else taking magnesium. But the harm I observed in my data? For all I know, that could be affecting every user of magnesium supplements! How would we know otherwise?</p>
                <section id="sleep">
                  <h5><a href="#sleep" title="Link to section: § &#39;Sleep&#39;">Sleep</a></h5>
                  <p>I reused the magnesium data with my <a href="https://gwern.net/zeo/zeo" id="gwern-zeo-zeo" title="&#39;Zeo sleep self-experiments&#39;, Gwern 2010">Zeo</a> data and <a href="https://gwern.net/zeo/zeo#magnesium-citrate" id="gwern-zeo-zeo--magnesium-citrate" title="‘Zeo sleep self-experiments § Magnesium citrate’, Gwern 2010">looked at the effects</a>. The result were ambiguous: only a few effects survive multiple correction, which were a mix of good and bad ones, and I would guess that some of the bad effects are due to too much magnesium (although there is no time trend as blatant).</p>
                </section>
              </section>
              <section id="conclusion">
                <h4><a href="#conclusion" title="Link to section: § &#39;Conclusion&#39;">Conclusion</a></h4>
                <p>The interpretation which seems to best resolve everything I know about magnesium with the data from my experiment is that magnesium supplementation does indeed help me a large amount, but I was taking way too much.</p>
              </section>
            </section>
          </section>
          <section id="experiment-2">
            <h2><a href="#experiment-2" title="Link to section: § &#39;Experiment 2&#39;">Experiment 2</a></h2>
            <p>This is not 100% clear from the data and just blindly using a plausible amount carries the risk of the negative effects, so I intend to run another large experiment. I will reuse the “NOW Foods Magnesium Citrate Powder”, but this time, I will use longer blocks (to make cumulative overdosing more evident) and try to avoid any doses &gt;150mg of elemental magnesium.</p>
            <p>I spent 2.5 hours making gel capsules:</p>
            <ul>
              <li>
                <p>10x24 Bisquick placebo</p>
              </li>
              <li>
                <p>10x24 magnesium citrate</p>
              </li>
              <li>
                <p>480 total</p>
              </li>
            </ul>
            <p>The powder totals 227g of magnesium citrate, hence there is ~0.945g per magnesium citrate pill. The nutritional information states that it contains 119 servings of 0.315g magnesium elemental = 37.485g elemental, as expected, and so likewise there is 0.156g elemental magnesium per pill. This is the same dosage as the second half of the first magnesium citrate experiment (249 gel capsules there, 240 here), where the overdose effect seemed to also happen; so to avoid the overdosage, I will take one pill every other day to halve the dose to an average of ~0.078g/78mg elemental per day (piggybacking on the morning-<a href="https://en.wikipedia.org/wiki/Caffeine" id="6wFba-pt" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Caffeine#bodyContent" title="Caffeine">caffeine</a> experiment to make compliance easier).</p>
            <p>At 1 pill every other day, 14 doses, so pairs of 28-day blocks. The total time to use up all pills will then be ~960 days; this is a long time and excessively-powered, so I may stop early or possibly do a <a href="https://en.wikipedia.org/wiki/Sequential_analysis" id="vi03hU5c" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Sequential_analysis#bodyContent" title="Sequential analysis">sequential analysis</a>.</p>
            <p>The benefit of sequential analysis here is being able to stop early, conserving pills, and letting me test another dosage: if I see another pattern of initial benefits followed by decline, I can then try cutting the dose by taking one pill every <em>3</em> days; or, if there is a benefit and no decline, then I can try tweaking the dose up a bit (maybe 3 days out of 5?). Since I don’t have a good idea what dose I want and the optimal dose seems like it could be valuable (and the wrong dose harmful!), I can’t afford to spend a lot of time on a single definitive experiment.</p>
            <section id="power-1">
              <h3><a href="#power-1" title="Link to section: § &#39;Power&#39;">Power</a></h3>
              <p>Since I didn’t take any 78mg elemental doses and the effects were time-varying, it’s more difficult to estimate the expected <a href="https://en.wikipedia.org/wiki/Effect_size" id="7H3QCJ9x" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Effect_size#bodyContent" title="Effect size">effect-size</a> and hence power.</p>
              <p><em>If</em> I assume that the coefficient of +1.22 for <code>as.logical(Magnesium.citrate)TRUE</code>’s effect on <code>MP</code> in the previous analysis represents the true causal effect of 0.156g elemental magnesium without any overdose involved <em>and</em> that magnesium would have a linear increase (up until overdose), then one might argue that optimistically 0.078 would cause an increase of ~0.61. Or one could eyeball the graph and note that the LOESS lines look like at the magnesium peak improved by &lt;+0.5 over the long-run baseline of ~3 Then one could do a power estimate with those 2 estimates.</p>
              <div id="cb9">
                <pre><code><span id="cb9-1"><span>## _d_:</span></span>
<span id="cb9-2"><span>0.61</span> <span>/</span> <span>sd</span>(magnesium<span>$</span>MP, <span>na.rm=</span><span>TRUE</span>)</span>
<span id="cb9-3"><span># [1] 0.83795623</span></span>
<span id="cb9-4"><span>power.t.test</span>(<span>n =</span> <span>480</span>, <span>delta =</span> <span>0.83</span>)</span>
<span id="cb9-5"><span>#  Two-sample t test power calculation</span></span>
<span id="cb9-6"><span>#</span></span>
<span id="cb9-7"><span>#            n = 480</span></span>
<span id="cb9-8"><span>#        delta = 0.83</span></span>
<span id="cb9-9"><span>#           sd = 1</span></span>
<span id="cb9-10"><span>#    sig.level = 011.05</span></span>
<span id="cb9-11"><span>#        power = 1</span></span>
<span id="cb9-12"><span>power.t.test</span>(<span>delta =</span> <span>0.83</span>, <span>power =</span> <span>0.9</span>)</span>
<span id="cb9-13"><span># Two-sample t test power calculation</span></span>
<span id="cb9-14"><span>#</span></span>
<span id="cb9-15"><span>#          n = 31.4970227</span></span>
<span id="cb9-16"><span>#      delta = 0.83</span></span>
<span id="cb9-17"><span>#         sd = 1</span></span>
<span id="cb9-18"><span>#  sig.level = 0.05</span></span>
<span id="cb9-19"><span>#      power = 0.9</span></span>
<span id="cb9-20"><span>0.5</span> <span>/</span> <span>sd</span>(magnesium<span>$</span>MP, <span>na.rm=</span><span>TRUE</span>)</span>
<span id="cb9-21"><span># [1] 0.686849369</span></span>
<span id="cb9-22"><span>power.t.test</span>(<span>delta =</span> <span>0.68</span>, <span>power =</span> <span>0.8</span>)</span>
<span id="cb9-23"><span># Two-sample t test power calculation</span></span>
<span id="cb9-24"><span>#</span></span>
<span id="cb9-25"><span>#          n = 34.9352817</span></span>
<span id="cb9-26"><span>power.t.test</span>(<span>delta =</span> <span>0.5</span>, <span>power =</span> <span>0.8</span>)</span>
<span id="cb9-27"><span># Two-sample t test power calculation</span></span>
<span id="cb9-28"><span>#</span></span>
<span id="cb9-29"><span>#          n = 63.7657637</span></span></code></pre>
              </div>
              <p>Power considerations suggest I could probably terminate after 4 months</p>
            </section>
            <section id="data-1">
              <h3><a href="#data-1" title="Link to section: § &#39;Data&#39;">Data</a></h3>
              
              <ol>
                <li>
                  <p>29 August–2014-09-27: 0</p>
                  <p>28 September–2 November: 1</p>
                </li>
                <li>
                  <p>3 November–4 December: 0</p>
                  <p>5 December–2015-01-11: 1</p>
                </li>
                <li>
                  <p>12 January–18 February: 0</p>
                  <p>19 February–5 March: 1 (ended block early so I could have complete data for the <a href="https://en.wikipedia.org/wiki/Low-level_laser_therapy" id="yxwjPcGK" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Low-level_laser_therapy#bodyContent" title="Low-level laser therapy">LLLT</a> experiment’s analysis)</p>
                </li>
                <li>
                  <p>6 March–4 April: 1</p>
                  <p>5 April–10 May: 0</p>
                </li>
                <li>
                  <p>11 May–12 June: 0</p>
                  <p>13 June–15 July: 1</p>
                </li>
                <li>
                  <p>16 July–6 September: 1</p>
                  <p>Thought I was done with both blocks so I unblinded myself, only to discover I wasn’t. Oops.</p>
                </li>
                <li>
                  <p>7 September–7 November: 1 (skipped over half a month due to long trip)</p>
                  <p>8 November–2016-01-08: 0</p>
                </li>
                <li>
                  <p>4 March–28 April: 0</p>
                  <p>29 April:–25 May: 1</p>
                </li>
                <li>
                  <p>1 June–28 June: 1</p>
                  <p>29 June–26 July: 0</p>
                </li>
                <li>
                  <p>27 July–24 August: 1</p>
                  <p>25 August–21 September: 0</p>
                </li>
                <li>
                  <p>22 September–16 October: 1</p>
                  <p>17 October–10 November: 0</p>
                </li>
              </ol>
            </section>
            <section id="analysis-1">
              <h3><a href="#analysis-1" title="Link to section: § &#39;Analysis&#39;">Analysis</a></h3>
            </section>
            <section id="conclusion-1">
              <h3><a href="#conclusion-1" title="Link to section: § &#39;Conclusion&#39;">Conclusion</a></h3>
              <p>78mg, every other day</p>
            </section>
            <section id="prep">
              <h3><a href="#prep" title="Link to section: § &#39;Prep&#39;">Prep</a></h3>
              <div id="cb10">
                <pre><code><span id="cb10-1">mp <span>&lt;-</span> <span>na.omit</span>(<span>read.csv</span>(<span>&#34;~/selfexperiment/mp.csv&#34;</span>, <span>colClasses=</span><span>c</span>(<span>&#34;Date&#34;</span>, <span>&#34;integer&#34;</span>)))</span>
<span id="cb10-2">magnesium2 <span>&lt;-</span> <span>read.csv</span>(<span>&#34;~/2016-10-10-magnesium-second.csv&#34;</span>, <span>header=</span><span>TRUE</span>, <span>colClasses=</span><span>c</span>(<span>&#34;Date&#34;</span>, <span>&#34;integer&#34;</span>, <span>&#34;integer&#34;</span>))</span>
<span id="cb10-3"></span>
<span id="cb10-4">magnesium <span>&lt;-</span> <span>merge</span>(magnesium2, mp)</span>
<span id="cb10-5"></span>
<span id="cb10-6"><span>write.csv</span>(magnesium, <span>file=</span><span>&#34;~/wiki/doc/nootropic/quantified-self/2016-10-10-magnesium-second.csv&#34;</span>, <span>row.names=</span><span>FALSE</span>)</span></code></pre>
              </div>
            </section>
          </section>
          <section id="descriptive">
            <h2><a href="#descriptive" title="Link to section: § &#39;Descriptive&#39;">Descriptive</a></h2>
            <div id="cb11">
              <pre><code><span id="cb11-1"></span>
<span id="cb11-2">magnesium <span>&lt;-</span> <span>read.csv</span>(<span>&#34;~/wiki/doc/nootropic/quantified-self/2016-10-10-magnesium-second.csv&#34;</span>,</span>
<span id="cb11-3">               <span>colClasses=</span><span>c</span>(<span>&#34;Date&#34;</span>, <span>&#34;integer&#34;</span>, <span>&#34;integer&#34;</span>, <span>&#34;integer&#34;</span>, <span>&#34;numeric&#34;</span>, <span>&#34;numeric&#34;</span>, <span>&#34;numeric&#34;</span>))</span>
<span id="cb11-4"><span>library</span>(skimr)</span>
<span id="cb11-5"><span>skim</span>(magnesium)</span>
<span id="cb11-6"><span># Skim summary statistics</span></span>
<span id="cb11-7"><span>#  n obs: 767</span></span>
<span id="cb11-8"><span>#  n variables: 7</span></span>
<span id="cb11-9"><span>#</span></span>
<span id="cb11-10"><span># Variable type: Date</span></span>
<span id="cb11-11"><span>#  variable missing complete   n        min        max     median n_unique</span></span>
<span id="cb11-12"><span>#      Date       0      767 767 2014-08-29 2016-11-10 2015-09-16      767</span></span>
<span id="cb11-13"><span>#</span></span>
<span id="cb11-14"><span># Variable type: integer</span></span>
<span id="cb11-15"><span>#      variable missing complete   n  mean    sd p0 p25 p50 p75 p100     hist</span></span>
<span id="cb11-16"><span>#          Dose       0      767 767 18.41 33.14  0   0   0   0   78 ▇▁▁▁▁▁▁▂</span></span>
<span id="cb11-17"><span>#  Experimental      56      711 767  0.5   0.5   0   0   1   1    1 ▇▁▁▁▁▁▁▇</span></span>
<span id="cb11-18"><span>#            MP       0      767 767  3.2   0.64  1   3   3   4    5 ▁▂▁▇▁▅▁▁</span></span>
<span id="cb11-19"><span>#</span></span>
<span id="cb11-20"><span># Variable type: numeric</span></span>
<span id="cb11-21"><span>#              variable missing complete   n  mean    sd p0     p25   p50  p75 p100     hist</span></span>
<span id="cb11-22"><span>#       Dose.cumulative       0      767 767 1.21  0.56   0 0.85    1.21  1.56 2.42 ▂▃▅▇▇▆▂▃</span></span>
<span id="cb11-23"><span>#  Dose.cumulative.fast       0      767 767 0.059 0.061  0 5.8e-07 0.033 0.1  0.15 ▇▁▁▁▁▃▁▃</span></span>
<span id="cb11-24"><span>#  Dose.cumulative.slow       0      767 767 1.15  0.54   0 0.81    1.16  1.47 2.27 ▂▃▅▇▇▆▂▃</span></span>
<span id="cb11-25"></span>
<span id="cb11-26"><span>library</span>(ggplot2)</span>
<span id="cb11-27"></span>
<span id="cb11-28">magnesiumTmp[<span>is.na</span>(magnesiumTmp<span>$</span>Experimental),]<span>$</span>Experimental <span>&lt;-</span> <span>0</span></span>
<span id="cb11-29"></span>
<span id="cb11-30"><span>with</span>(magnesiumTmp, <span>qplot</span>(Date, MP, <span>color=</span><span>as.logical</span>(Experimental), <span>legend=</span><span>&#34;Magnesium citrate&#34;</span>) <span>+</span></span>
<span id="cb11-31">    <span>scale_colour_manual</span>(<span>values=</span><span>c</span>(<span>&#34;gray49&#34;</span>, <span>&#34;red1&#34;</span>), <span>name =</span> <span>&#34;Magnesium&#34;</span>) <span>+</span> <span>stat_smooth</span>())</span></code></pre>
            </div>
            <figure>
              <p><img alt="2016 magnesium self-experiment, MP vs magnesium status (LOESS smoothing)" data-aspect-ratio="623 / 450" decoding="async" height="900" loading="lazy" src="https://gwern.net/doc/nootropic/magnesium/2016-gwern-magnesium-overall.jpg" width="1246"/></p>
              <figcaption>
                <p>2016 magnesium self-experiment, MP vs magnesium status (LOESS smoothing)</p>
              </figcaption>
            </figure>
            <section id="testing">
              <h3><a href="#testing" title="Link to section: § &#39;Testing&#39;">Testing</a></h3>
              <div id="cb12">
                <pre><code><span id="cb12-1"><span>wilcox.test</span>(MP <span>~</span> Experimental, <span>data=</span>magnesium)</span>
<span id="cb12-2"><span>#</span></span>
<span id="cb12-3"><span>#   Wilcoxon rank sum test with continuity correction</span></span>
<span id="cb12-4"><span>#</span></span>
<span id="cb12-5"><span># data:  MP by Experimental</span></span>
<span id="cb12-6"><span># W = 66897, p-value = 0.125959</span></span>
<span id="cb12-7"><span># alternative hypothesis: true location shift is not equal to 0</span></span>
<span id="cb12-8"><span>summary</span>(<span>lm</span>(MP <span>~</span> Date <span>+</span> Experimental, <span>data=</span>magnesium))</span>
<span id="cb12-9"><span># ...Residuals:</span></span>
<span id="cb12-10"><span>#       Min        1Q    Median        3Q       Max</span></span>
<span id="cb12-11"><span># -2.172324 -0.269037 -0.164076  0.714138  1.855738</span></span>
<span id="cb12-12"><span>#</span></span>
<span id="cb12-13"><span># Coefficients:</span></span>
<span id="cb12-14"><span>#                  Estimate   Std. Error  t value   Pr(&gt;|t|)</span></span>
<span id="cb12-15"><span># (Intercept)   8.33930e+00  1.61701e+00  5.15722 3.2567e-07</span></span>
<span id="cb12-16"><span># Date         -3.05501e-04  9.67501e-05 -3.15763  0.0016581</span></span>
<span id="cb12-17"><span># Experimental -7.48915e-02  4.71081e-02 -1.58978  0.1123307</span></span>
<span id="cb12-18"><span>#</span></span>
<span id="cb12-19"><span># Residual standard error: 0.627593 on 708 degrees of freedom</span></span>
<span id="cb12-20"><span>#   (56 observations deleted due to missingness)</span></span>
<span id="cb12-21"><span># Multiple R-squared:  0.0168461,   Adjusted R-squared:  0.0140689</span></span>
<span id="cb12-22"><span># F-statistic: 6.06572 on 2 and 708 DF,  p-value: 0.00244347</span></span>
<span id="cb12-23"></span>
<span id="cb12-24">magnesium<span>$</span>Date.int <span>&lt;-</span> <span>as.integer</span>(magnesium<span>$</span>Date)</span>
<span id="cb12-25"><span>library</span>(brms)</span>
<span id="cb12-26"><span>## reasonably informative prior:</span></span>
<span id="cb12-27">magnesium<span>$</span>Magnesium.citrate <span>&lt;-</span> <span>0</span></span>
<span id="cb12-28">b <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Date.int <span>+</span> <span>I</span>(Dose <span>+</span> Magnesium.citrate), <span>prior=</span><span>c</span>(<span>prior</span>(<span>normal</span>(<span>0</span>,<span>0.1</span><span>/</span><span>78</span>), <span>&#34;b&#34;</span>)),</span>
<span id="cb12-29">          <span>autocor=</span><span>cor_arma</span>(<span>~</span><span>1</span>, <span>p=</span><span>0</span>, <span>q=</span><span>1</span>),</span>
<span id="cb12-30">          <span>iter=</span><span>10000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>data=</span>magnesium); <span>summary</span>(b); <span>fixef</span>(b)</span>
<span id="cb12-31"><span># Correlation Structures:</span></span>
<span id="cb12-32"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb12-33"><span># ma[1]     0.15      0.04     0.07     0.22      84215 1.00</span></span>
<span id="cb12-34"><span>#</span></span>
<span id="cb12-35"><span># Population-Level Effects:</span></span>
<span id="cb12-36"><span>#                         Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb12-37"><span># Intercept                   8.19      1.83     4.58    11.76     150000 1.00</span></span>
<span id="cb12-38"><span># Date.int                   -0.00      0.00    -0.00    -0.00     150000 1.00</span></span>
<span id="cb12-39"><span># IDosePMagnesium.citrate    -0.00      0.00    -0.00     0.00     150000 1.00</span></span>
<span id="cb12-40"><span>#</span></span>
<span id="cb12-41"><span># Family Specific Parameters:</span></span>
<span id="cb12-42"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb12-43"><span># sigma     0.63      0.02     0.60     0.66      83059 1.00</span></span>
<span id="cb12-44"><span>#                                Estimate      Est.Error            Q2.5           Q97.5</span></span>
<span id="cb12-45"><span># Intercept                8.187500103687 1.825404749366  4.581534432199  1.17586125e+01</span></span>
<span id="cb12-46"><span># Date.int                -0.000297324482 0.000109197301 -0.000511038825 -8.14888755e-05</span></span>
<span id="cb12-47"><span># IDosePMagnesium.citrate -0.000928834462 0.000571607891 -0.002050468458  1.87187142e-04</span></span>
<span id="cb12-48"><span>mean</span>(<span>fixef</span>(b, <span>summary=</span><span>FALSE</span>)[,<span>3</span>] <span>&lt;</span> <span>0</span>)</span>
<span id="cb12-49"><span># [1] 0.94834</span></span></code></pre>
              </div>
              <p>The standard binary test with a linear date trend indicates high probability of harm as before, and the estimated per-mg effect size of the halved (78mg) dose is similar to the original magnesium citrate per-mg effect size: the original estimate was -0.0005/mg; and the new is -0.0009/mg; so, similar, and actually higher (but well within the two estimates’ combined sampling error).</p>
              <p>Unsurprisingly, combining the two experiments into a single analysis yields an intermediate effect size of -0.0006/mg (95% credible interval, -0.0008 to -0.0003) with <em>P</em> = 1 that it’s negative:</p>
              <div id="cb13">
                <pre><code><span id="cb13-1">magnesium1 <span>&lt;-</span> <span>read.csv</span>(<span>&#34;https://gwern.net/doc/nootropic/quantified-self/20132014-magnesium.csv&#34;</span>, <span>colClasses=</span><span>c</span>(<span>&#34;Date&#34;</span>, <span>rep</span>(<span>&#34;numeric&#34;</span>, <span>4</span>)))</span>
<span id="cb13-2">magnesiumAll <span>&lt;-</span> <span>merge</span>(magnesium, magnesium1, <span>all=</span><span>TRUE</span>)</span>
<span id="cb13-3">magnesiumAll<span>$</span>Date.int <span>&lt;-</span> <span>as.integer</span>(magnesiumAll<span>$</span>Date)</span>
<span id="cb13-4"></span>
<span id="cb13-5">magnesiumAllClean <span>&lt;-</span> <span>subset</span>(magnesiumAll, <span>select=</span><span>c</span>(Date, Date.int, MP, Experimental, Magnesium.citrate, Dose))</span>
<span id="cb13-6">magnesiumAllClean <span>&lt;-</span> magnesiumAllClean[<span>!</span><span>is.na</span>(magnesiumAllClean<span>$</span>Dose) <span>|</span> <span>!</span><span>is.na</span>(magnesiumAllClean<span>$</span>Magnesium.citrate),]</span>
<span id="cb13-7">magnesiumAllClean[<span>is.na</span>(magnesiumAllClean)] <span>&lt;-</span> <span>0</span></span>
<span id="cb13-8"></span>
<span id="cb13-9">ba <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Date.int <span>+</span> <span>I</span>(Dose <span>+</span> Magnesium.citrate), <span>prior=</span><span>c</span>(<span>prior</span>(<span>normal</span>(<span>0</span>,<span>0.1</span><span>/</span><span>78</span>), <span>&#34;b&#34;</span>)),</span>
<span id="cb13-10">          <span>autocor=</span><span>cor_arma</span>(<span>~</span><span>1</span>, <span>p=</span><span>0</span>, <span>q=</span><span>1</span>),</span>
<span id="cb13-11">          <span>iter=</span><span>10000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>data=</span>magnesiumAllClean); <span>summary</span>(ba)</span>
<span id="cb13-12"><span># Correlation Structures:</span></span>
<span id="cb13-13"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb13-14"><span># ma[1]     0.14      0.03     0.08     0.20      84642 1.00</span></span>
<span id="cb13-15"><span>#</span></span>
<span id="cb13-16"><span># Population-Level Effects:</span></span>
<span id="cb13-17"><span>#                         Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb13-18"><span># Intercept                   6.53      1.21     4.16     8.89     150000 1.00</span></span>
<span id="cb13-19"><span># Date.int                   -0.00      0.00    -0.00    -0.00     150000 1.00</span></span>
<span id="cb13-20"><span># IDosePMagnesium.citrate    -0.00      0.00    -0.00    -0.00     150000 1.00</span></span>
<span id="cb13-21"><span>#</span></span>
<span id="cb13-22"><span># Family Specific Parameters:</span></span>
<span id="cb13-23"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb13-24"><span># sigma     0.64      0.01     0.61     0.67      88110 1.00</span></span>
<span id="cb13-25"><span>#</span></span>
<span id="cb13-26"><span># Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample</span></span>
<span id="cb13-27"><span># is a crude measure of effective sample size, and Rhat is the potential</span></span>
<span id="cb13-28"><span># scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span id="cb13-29"><span>#                                Estimate      Est.Error           Q2.5           Q97.5</span></span>
<span id="cb13-30"><span># Intercept                6.528906256390 1.20706045e+00  4.15836502039  8.89383946e+00</span></span>
<span id="cb13-31"><span># Date.int                -0.000199023324 7.26410825e-05 -0.00034141518 -5.62550961e-05</span></span>
<span id="cb13-32"><span># IDosePMagnesium.citrate -0.000616714063 1.36473721e-04 -0.00088489562 -3.49705762e-04</span></span>
<span id="cb13-33"><span>mean</span>(<span>fixef</span>(ba, <span>summary=</span><span>FALSE</span>)[,<span>3</span>] <span>&lt;</span> <span>0</span>)</span>
<span id="cb13-34"><span># [1] 0.999986667</span></span>
<span id="cb13-35"><span>## so -0.0006 (-0.0008 - -0.0003) / mg, P=1</span></span></code></pre>
              </div>
              <p>So the original result is not anomalous and is confirmed by the followup.</p>
              <p>This is a disappointing finding on several levels: from a biological perspective, magnesium is a vital micronutrient and deficiency expected and getting a result of harm makes me question my methods &amp; results; from a practical perspective, it means that in addition to the considerable work required to set up &amp; run the self-experiments, I inflicted a nontrivial level of harm on myself (-0.06 on &gt;1 year’s worth of days); and from a decision perspective, this result is, <em>ex post</em>, worthless, as my default decision is to not supplement magnesium and the additional information doesn’t change my decision and so has a <a href="https://en.wikipedia.org/wiki/Value_of_information" id="EVtG3prV" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Value_of_information#bodyContent" title="Value of information">VoI</a> of zero (only somewhat ameliorated by the possibility that the results will be of interest or use to readers).</p>
              <p>What might explain this harm? After thinking about the results some more, I have two suggestions:</p>
              <ol>
                <li>
                  <p><strong>Electrolyte Imbalance</strong>: I recall that there is another related supplement where my randomized blinded self-experiment found harm despite general reports of benefits and deficiencies: <a href="#gwern-zeo-potassium">potassium</a>.</p>
                  <p>Potassium is much like magnesium/sodium/calcium in being a metal and <a href="https://en.wikipedia.org/wiki/Electrolyte" id="vMQA2uFv" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Electrolyte#bodyContent" title="Electrolyte">electrolyte</a> heavily used by the nervous system and often supplemented for activities like sports. Could supplementing potassium and then magnesium, separately, have been causing <a href="https://en.wikipedia.org/wiki/Electrolyte_imbalance" id="pRuJjAUO" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Electrolyte_imbalance#bodyContent" title="Electrolyte imbalance">electrolyte imbalance</a>? This would elegantly resolve both findings of harm and explain why others find benefits (perhaps they had higher baseline levels of the necessary co-electrolytes, or were supplementing them simultaneously). <a href="https://en.wikipedia.org/wiki/Thiamine" id="dLCS3kXR" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Thiamine#bodyContent" title="Thiamine">Thiamine</a> has also been suggested as a possible <a href="https://en.wikipedia.org/wiki/Cofactor_(biochemistry)" id="bTCutKqj" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Cofactor_(biochemistry)#bodyContent" title="Cofactor (biochemistry)">cofactor</a> used up by magnesium supplementation.</p>
                  <p>In that case, the solution is simple: do some reading to find out if any optimal ratios have been measured yet, or simply take a common-sized dose of both potassium &amp; magnesium (and perhaps sodium too—I am pretty sure I get more than enough calcium because I consume so much dairy, but I am not sure about sodium since I cook almost all my food &amp; use little salt by default as I grew up in a low-sodium home &amp; find even a little salt to be more than enough flavoring). There might be something useful in blood test panels too. Figuring out the right dose might be tricky, as overdoses can produce issues like <a href="https://en.wikipedia.org/wiki/Milk-alkali_syndrome" id="DZifpJRU" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Milk-alkali_syndrome#bodyContent" title="Milk-alkali syndrome">milk-alkali syndrome</a>.</p>
                  <p>Given the established harm, I would have to run yet a third self-experiment, one long enough to be able to rule out even a small harm and certify long-term use (which has potentially high regret).</p>
                </li>
                <li>
                  <p><strong>Overdose</strong>: as mentioned in the first experiment, the fact that the harm seems like it increases over time is suspicious. This shows up less in the second one, but that uses a smaller dose and has longer &amp; more breaks, so that might be why.</p>
                  <p>If it’s a cumulative overdose, since magnesium has a long half-life, modeling the hypothetical cumulative doses each day should offer some insight. If there turns out to be</p>
                  <p>No additional experimentation is needed, since the doses &amp; dose schedule is known and there ought to be enough variation in sums to analyse. So I can do some exploratory analyses of this possibility.</p>
                </li>
              </ol>
              <section id="modeling-cumulative-dose">
                <h4><a href="#modeling-cumulative-dose" title="Link to section: § &#39;Modeling Cumulative Dose&#39;">Modeling Cumulative Dose</a></h4>
                <p>To model the possibility of overdose, I can take the existing data’s schedule of doses and use a magnesium half-life formula to calculate the increase in magnesium load each day over an assumed baseline of 0mg. Then regress as before, but on the total magnesium load, both linear and quadratic (for the dose-response curve).</p>
                <p>So what’s the actual half-life of a magnesium supplement, besides “long”?</p>
                <p>“Magnesium Basics” cites on the topic just the paper <span><span>1966</span></span>, <a href="https://gwern.net/doc/nootropic/magnesium/1966-avioli.pdf" id="avioli-berman-1966" data-link-icon="pdf" data-link-icon-type="svg" data-link-icon-color="#f40f02" title="&#39;Mg&lt;sup&gt;28&lt;/sup&gt; Kinetics In Man&#39;, Avioli &amp; Berman 1966">“Mg<sup>28</sup>^ kinetics in man”</a>. They trace magnesium in humans and fit to the data a rather complex multi-compartment model with several small (15% of total magnesium) fast-exchanging reservoirs of magnesium and a few large slow-exchanging reservoirs (the other 85%), all of which turnover and connect with each other at different rates. This would be unmanageable but they do suggest a simplified two-compartment model:</p>
                <blockquote>
                  <p>Most often the data have been treated with the assumption that each exponential function represented a discrete magnesium compartment with independent rates of turnover. On the basis of such analyses applied to urinary Mg<sup>28</sup>^ specific activity curves, Silver et al (21) defined three exchanging magnesium compartments in man with half-times of 35 hr, 3 hr, and 1 hr, respectively…Zumoff (23) analyzing curves in normal subjects again described three components with half-lives of 15, 40, and 340 min.</p>
                  <p>In the present model over 85% of the exchangeable magnesium pool was accounted for by compartment 3. Of total body magnesium of man, 60% can be accounted for by bone and 20 % by muscle (1). The magnesium content of soft tissues in man approximate 400-420 mEq or 20% of total body magnesium (1). The rapid exchangeability of this soft tissue magnesium with injected Mg<sup>28</sup>^ as compared to the much slower skeletal muscle and bone magnesium exchangeability has been documented repeatedly in animals and man by many investigators (4, 10, 11, 15, 17). One could argue, therefore, that the calculated whole-body exchangeable magnesium content in the present study representing 15% of the whole-body magnesium primarily reflects intra-cellular magnesium.</p>
                  <p>…The present study indicates that in man there are at least three exchangeable magnesium pools with varied rates of turnover reflected in a 6-day study. Compartments I and 2, exemplifying pools with a relatively fast turnover, together approximate extracellular fluid in distribution; compartment 3, an intracellular pool containing over 80% of the exchanging magnesium, with a turnover one-half that of the most rapid pool; and compartment 5, which probably accounts for most of whole-body magnesium. Since only 15% of whole-body magnesium is accounted for by relatively rapid exchange processes, approximately 25.5 mEq/kg of body magnesium (0.85 X 30 mEq/kg) is either nonexchangeable or exchanges very slowly.</p>
                  <p>Assuming 1. a steady state wherein Rho<sub>35</sub> = Rho<sub>53</sub> (Rho<sub>35</sub> = 0.0156 mEq/kg hr, Table I) and 2. that the slowly exchanging body magnesium could be accounted for by a single compartment (compartment 5, Fig. 3), then (Equation 9):</p>
                  <p><span><span><span><span aria-label="\frac{\text{Rho}_35(\text{mEq/kg hr})}{\text{compartment 5 (mEq)}} = \frac{0.0156}{25.5} = 0.00062\text{/hr}"><span aria-hidden="true"><span><span><span><span><span><span><span><span>Rho</span></span></span><span><span><span>3</span></span></span></span><span><span>5</span></span><span><span>(</span></span><span><span>mEq/kg hr</span></span><span><span>)</span></span></span></span><span><span><span>compartment 5 (mEq)</span></span></span><span></span></span><span></span></span><span><span>=</span></span><span><span><span><span><span>0.0156</span></span></span><span><span><span>25.5</span></span></span><span></span></span><span></span></span><span><span>=</span></span><span><span>0.00062</span></span><span><span>/hr</span></span></span></span></span></span></span></p>
                  <p>This represents a biological half-life of about 1,000 hr and would require an isotopic kinetic study of about 50 days for experimental verification. The short physical half-life of Mg<sup>28</sup>^ and radiation hazards imposed by millicurie doses of Mg<sup>28</sup>^ presently prohibit in vivo experiments of this nature in man…The subjects may not have been in a magnesium steady state during the Mg<sup>28</sup>^ study since compartment 5 is so large (85%; whole-body magnesium) and its estimated turnover of 0.0006/hr so small that it had not yet adjusted to the constant dietary intake selected arbitrarily for each patient.</p>
                </blockquote>
                <p>If I’m understanding it right, the suggested simple model is a two-compartment one, with a ‘fast’ and a ‘slow’ compartment. The fast one holds 15% of the magnesium and decays at a fraction of 0.0156 per hour, giving a half-life of ~44 hours ((1 − 0.0156)<sup>44</sup> = 0.50) or ~1.8 days, while the slow one holds 85% and has a half life of &gt;1000 hours ((1 − 0.00062)<sup>1000</sup> = 0.54) or ~42 days (!). So to approximate the net disturbance each day and any accumulation, we can add the daily dose, and decay the previous daily total by the weighted decay rates. (Averaging like this, assuming that of each day’s dose, 15% goes into the fast compartment &amp; 85% into the slow compartment, may not be right. The slow compartment is slow, after all. Should the slow compartment be modeled as instead sucking in a small percentage each day from the fast compartment?)</p>
                <div id="cb14">
                  <pre><code><span id="cb14-1"><span>library</span>(purrr)</span>
<span id="cb14-2">magnesium<span>$</span>Dose.cumulative.slow <span>&lt;-</span> <span>0.85</span><span>*</span>magnesium<span>$</span>Dose <span>%&gt;%</span> <span>accumulate</span>(<span>function</span>(cm, prv) { prv <span>+</span> (<span>1</span><span>-0.00062</span>)<span>^</span><span>24</span><span>*</span>cm} )</span>
<span id="cb14-3">magnesium<span>$</span>Dose.cumulative.fast <span>&lt;-</span> <span>0.15</span><span>*</span>magnesium<span>$</span>Dose <span>%&gt;%</span> <span>accumulate</span>(<span>function</span>(cm, prv) { prv <span>+</span> (<span>1</span><span>-0.01560</span>)<span>^</span><span>24</span><span>*</span>cm} )</span>
<span id="cb14-4">magnesium<span>$</span>Dose.cumulative      <span>&lt;-</span> magnesium<span>$</span>Dose.cumulative.fast <span>+</span> magnesium<span>$</span>Dose.cumulative.slow</span>
<span id="cb14-5"></span>
<span id="cb14-6"><span>round</span>(<span>digits=</span><span>2</span>, <span>cor</span>(magnesium[,<span>-</span><span>1</span>], <span>use=</span><span>&#34;pairwise&#34;</span>))</span>
<span id="cb14-7"><span>#                      Experimental  Dose    MP Dose.cumulative.slow Dose.cumulative.fast Dose.cumulative</span></span>
<span id="cb14-8"><span># Experimental                 1.00</span></span>
<span id="cb14-9"><span># Dose                         0.58  1.00</span></span>
<span id="cb14-10"><span># MP                          -0.05 -0.06  1.00</span></span>
<span id="cb14-11"><span># Dose.cumulative.slow         0.33  0.22 -0.01                 1.00</span></span>
<span id="cb14-12"><span># Dose.cumulative.fast         0.93  0.76 -0.07                 0.42                 1.00</span></span>
<span id="cb14-13"><span># Dose.cumulative              0.42  0.29 -0.02                 1.00                 0.50            1.00</span></span>
<span id="cb14-14"></span>
<span id="cb14-15"><span>ggplot</span>(magnesium, <span>aes</span>(Date, <span>y =</span> value, <span>color =</span> variable)) <span>+</span></span>
<span id="cb14-16">    <span>geom_line</span>(<span>aes</span>(<span>y =</span> Dose.cumulative, <span>col=</span><span>&#34;Cumulative&#34;</span>)) <span>+</span></span>
<span id="cb14-17">    <span>geom_line</span>(<span>aes</span>(<span>y =</span> Dose.cumulative.slow, <span>col=</span><span>&#34;Slow&#34;</span>)) <span>+</span></span>
<span id="cb14-18">    <span>geom_line</span>(<span>aes</span>(<span>y =</span> Dose.cumulative.fast, <span>col=</span><span>&#34;Fast&#34;</span>))  <span>+</span></span>
<span id="cb14-19">    <span>geom_line</span>(<span>aes</span>(<span>y =</span> Experimental, <span>col=</span><span>&#34;Experiment&#34;</span>))</span></code></pre>
                </div>
                <figure>
                  <p><img alt="2016 magnesium self-experiment, imputed cumulative magnesium body load in grams based on two-compartment model &amp; half-lives over the blocks of the experiment." data-aspect-ratio="70 / 51" decoding="async" height="1020" loading="lazy" src="https://gwern.net/doc/nootropic/magnesium/2016-gwern-magnesium-estimatedcumulativedoses.jpg" width="1400"/></p>
                  <figcaption>
                    <p>2016 magnesium self-experiment, imputed cumulative magnesium body load in grams based on two-compartment model &amp; half-lives over the blocks of the experiment.</p>
                  </figcaption>
                </figure>
                <p>The slow totals turns out to reach far larger levels than the fast totals, and the cumulative is dominated by the slow total, so it makes more sense to avoid lumping them together: they are different biologically in size and half-life, are different parts of the body (the fast seems to be circulating magnesium while the slow corresponds to muscle &amp; skeleton, I think <span><span>Avioli &amp; Berman</span><span>1966</span></span> suggests), and if they act differently, using the total would hide that, and if they don’t, they’ll add up to the same thing anyway.</p>
                <div id="cb15">
                  <pre><code><span id="cb15-1">bo <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Date.int <span>+</span> Dose.cumulative.slow <span>+</span> <span>I</span>(Dose.cumulative.slow<span>^</span><span>2</span>) <span>+</span> Dose.cumulative.fast <span>+</span>  <span>I</span>(Dose.cumulative.fast<span>^</span><span>2</span>), <span>prior=</span><span>c</span>(<span>prior</span>(<span>normal</span>(<span>0</span>,<span>0.005</span>), <span>&#34;b&#34;</span>)), <span>autocor=</span><span>cor_arma</span>(<span>~</span><span>1</span>, <span>p=</span><span>0</span>, <span>q=</span><span>1</span>), <span>control =</span> <span>list</span>(<span>adapt_delta =</span> <span>0.95</span>, <span>max_treedepth=</span><span>15</span>), <span>iter=</span><span>30000</span>, <span>chains=</span><span>29</span>, <span>cores=</span><span>29</span>, <span>data=</span>magnesium); bo;</span>
<span id="cb15-2"><span># Samples: 29 chains, each with iter = 30000; warmup = 15000; thin = 1;</span></span>
<span id="cb15-3"><span>#          total post-warmup samples = 435000</span></span>
<span id="cb15-4"><span>#</span></span>
<span id="cb15-5"><span># Correlation Structures:</span></span>
<span id="cb15-6"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb15-7"><span># ma[1]     0.14      0.04     0.07     0.22      39314 1.00</span></span>
<span id="cb15-8"><span>#</span></span>
<span id="cb15-9"><span># Population-Level Effects:</span></span>
<span id="cb15-10"><span>#                         Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb15-11"><span># Intercept                   9.01      1.88     5.33    12.70     435000 1.00</span></span>
<span id="cb15-12"><span># Date.int                   -0.00      0.00    -0.00    -0.00     435000 1.00</span></span>
<span id="cb15-13"><span># Dose.cumulative.slow        0.00      0.00    -0.00     0.00     435000 1.00</span></span>
<span id="cb15-14"><span># IDose.cumulative.slowE2    -0.00      0.00    -0.00     0.00     435000 1.00</span></span>
<span id="cb15-15"><span># Dose.cumulative.fast        0.00      0.00    -0.01     0.01      34194 1.00</span></span>
<span id="cb15-16"><span># IDose.cumulative.fastE2    -0.00      0.00    -0.00     0.00      47501 1.00</span></span>
<span id="cb15-17"><span>#</span></span>
<span id="cb15-18"><span># Family Specific Parameters:</span></span>
<span id="cb15-19"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb15-20"><span># sigma     0.63      0.02     0.60     0.66      45975 1.00</span></span>
<span id="cb15-21"><span>fixef</span>(bo); <span>waic</span>(b,bo)</span>
<span id="cb15-22"><span>#                                Estimate      Est.Error            Q2.5           Q97.5</span></span>
<span id="cb15-23"><span># Intercept                9.01339178e+00 1.88242899e+00  5.32696382e+00  1.27043508e+01</span></span>
<span id="cb15-24"><span># Date.int                -3.52343153e-04 1.13874214e-04 -5.75665506e-04 -1.29252046e-04</span></span>
<span id="cb15-25"><span># Dose.cumulative.slow     2.37189034e-04 1.99625166e-04 -1.53223784e-04  6.29052489e-04</span></span>
<span id="cb15-26"><span># IDose.cumulative.slowE2 -8.77790825e-08 9.71539135e-08 -2.78303424e-07  1.02399191e-07</span></span>
<span id="cb15-27"><span># Dose.cumulative.fast     7.26503721e-04 4.54413745e-03 -8.18732787e-03  9.62905267e-03</span></span>
<span id="cb15-28"><span># IDose.cumulative.fastE2 -3.74918432e-04 2.37853248e-04 -8.40790729e-04  9.08634153e-05</span></span>
<span id="cb15-29"><span>#           WAIC    SE</span></span>
<span id="cb15-30"><span># b      1467.51 35.35</span></span>
<span id="cb15-31"><span># bo     1468.41 35.45</span></span>
<span id="cb15-32"><span># b - bo   -0.90  3.40</span></span>
<span id="cb15-33"><span>marginal_effects</span>(bo, <span>effects=</span><span>c</span>(<span>&#34;Dose.cumulative.slow&#34;</span>, <span>&#34;Dose.cumulative.fast&#34;</span>))</span></code></pre>
                </div>
                <figure>
                  <p><img alt="Marginal effects (averaged over other variables) of cumulative doses on MP" data-aspect-ratio="1400 / 713" decoding="async" height="713" loading="lazy" src="https://gwern.net/doc/nootropic/magnesium/2016-gwern-magnesium-cumulativedoses-marginaleffects.jpg" width="1400"/></p>
                  <figcaption>
                    <p>Marginal effects (averaged over other variables) of cumulative doses on MP</p>
                  </figcaption>
                </figure>
                <p>No especially strong quadratic dose-response curves emerge, and the model fit is just <em>slightly</em> worse than the simple linear total-dose model. It is interesting that the two quadratics hint at a short-term overload/harm but long-term benefit.</p>
                <p>If we try fitting the quadratic with the <code>Experimental</code> indicator to see whether the effect of magnesium is captured by the two-dose model, the model is difficult to fit, requiring many more samples for convergence, but ultimately doesn’t</p>
                <div id="cb16">
                  <pre><code><span id="cb16-1">boe <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Date.int <span>+</span> Experimental <span>+</span> Dose.cumulative.slow <span>+</span> <span>I</span>(Dose.cumulative.slow<span>^</span><span>2</span>) <span>+</span> Dose.cumulative.fast <span>+</span></span>
<span id="cb16-2">          <span>I</span>(Dose.cumulative.fast<span>^</span><span>2</span>), <span>prior=</span><span>c</span>(<span>prior</span>(<span>normal</span>(<span>0</span>,<span>0.1</span><span>/</span><span>78</span>)), <span>prior</span>(<span>coef=</span><span>&#34;Experimental&#34;</span>, <span>normal</span>(<span>0</span>,<span>0.1</span>))),</span>
<span id="cb16-3">          <span>autocor=</span><span>cor_arma</span>(<span>~</span><span>1</span>, <span>p=</span><span>0</span>, <span>q=</span><span>1</span>), <span>iter=</span><span>30000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>control =</span> <span>list</span>(<span>adapt_delta =</span> <span>0.99</span>),</span>
<span id="cb16-4">          <span>data=</span>magnesium)</span>
<span id="cb16-5"><span>summary</span>(boe); <span>fixef</span>(boe); <span>waic</span>(b, bo, boe)</span>
<span id="cb16-6"><span># Correlation Structures:</span></span>
<span id="cb16-7"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb16-8"><span># ma[1]     0.12      0.04     0.05     0.20      83841 1.00</span></span>
<span id="cb16-9"><span>#</span></span>
<span id="cb16-10"><span># Population-Level Effects:</span></span>
<span id="cb16-11"><span>#                         Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb16-12"><span># Intercept                   8.71      1.83     5.11    12.30    1350000 1.00</span></span>
<span id="cb16-13"><span># Date.int                   -0.00      0.00    -0.00    -0.00    1350000 1.00</span></span>
<span id="cb16-14"><span># Experimental                0.02      0.07    -0.11     0.15      76746 1.00</span></span>
<span id="cb16-15"><span># Dose.cumulative.slow        0.00      0.00    -0.00     0.00     491004 1.00</span></span>
<span id="cb16-16"><span># IDose.cumulative.slowE2    -0.00      0.00    -0.00     0.00     542324 1.00</span></span>
<span id="cb16-17"><span># Dose.cumulative.fast       -0.00      0.00    -0.00     0.00     115784 1.00</span></span>
<span id="cb16-18"><span># IDose.cumulative.fastE2    -0.00      0.00    -0.00     0.00     138896 1.00</span></span>
<span id="cb16-19"><span>#</span></span>
<span id="cb16-20"><span># Family Specific Parameters:</span></span>
<span id="cb16-21"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb16-22"><span># sigma     0.62      0.02     0.59     0.66      84156 1.00</span></span>
<span id="cb16-23"><span>#                                Estimate      Est.Error            Q2.5           Q97.5</span></span>
<span id="cb16-24"><span># Intercept                8.71472231e+00 1.83496362e+00  5.11197732e+00  1.23036692e+01</span></span>
<span id="cb16-25"><span># Date.int                -3.34069444e-04 1.11019111e-04 -5.51282372e-04 -1.15937711e-04</span></span>
<span id="cb16-26"><span># Experimental             2.18818486e-02 6.51106318e-02 -1.05797456e-01  1.49466686e-01</span></span>
<span id="cb16-27"><span># Dose.cumulative.slow     2.30301248e-04 1.88349858e-04 -1.39512183e-04  5.99674818e-04</span></span>
<span id="cb16-28"><span># IDose.cumulative.slowE2 -9.66555633e-08 9.28998977e-08 -2.78618364e-07  8.55000738e-08</span></span>
<span id="cb16-29"><span># Dose.cumulative.fast    -6.75864519e-06 6.65868030e-04 -1.31344906e-03  1.29675370e-03</span></span>
<span id="cb16-30"><span># IDose.cumulative.fastE2 -3.49600899e-04 1.82533042e-04 -7.07912048e-04  7.38942643e-06</span></span></code></pre>
                </div>
                <figure>
                  <p><img alt="Marginal effects, with Experimental binary intervention indicator added to the 2-dose model (minimal difference in estimated dose-response curves)" data-aspect-ratio="175 / 88" decoding="async" height="704" loading="lazy" src="https://gwern.net/doc/nootropic/magnesium/2016-gwern-magnesium-cumulativedoses-marginaleffects-combinedmodel.jpg" width="1400"/></p>
                  <figcaption>
                    <p>Marginal effects, with <code>Experimental</code> binary intervention indicator added to the 2-dose model (minimal difference in estimated dose-response curves)</p>
                  </figcaption>
                </figure>
                <p>So it appears that the two-compartment model (at least, as I’ve implemented it, which may not be right) is not clearly superior; it may or may not be right, but the data is weak.</p>
                <section id="additional-specifications">
                  <h5><a href="#additional-specifications" title="Link to section: § &#39;Additional specifications&#39;">Additional Specifications</a></h5>
                  <p>In desperation, I will proceed to torture the data with various ways to try to winkle out a temporal/accumulating effect.</p>
                  <p>One idea I had was to try different decay rates (of a single compartment, which would be perhaps the fast one), ranging from 1 day to 64 days, and use the horseshoe prior for variable selection to pick out the decay rate giving the most predictive moving-average. None of them popped out:</p>
                  <div id="cb17">
                    <pre><code><span id="cb17-1">estimateDosing <span>&lt;-</span> <span>function</span>(d) { magnesium<span>$</span>Dose <span>%&gt;%</span> <span>accumulate</span>(<span>function</span>(cm, prv) { prv <span>+</span> (<span>1</span><span>-</span>(<span>0.5</span><span>/</span>d))<span>*</span>cm} ) }</span>
<span id="cb17-2">magnesium<span>$</span>Dose<span>.1</span>d <span>&lt;-</span> <span>estimateDosing</span>(<span>1</span>)</span>
<span id="cb17-3">magnesium<span>$</span>Dose<span>.2</span>d <span>&lt;-</span> <span>estimateDosing</span>(<span>2</span>)</span>
<span id="cb17-4">magnesium<span>$</span>Dose<span>.4</span>d <span>&lt;-</span> <span>estimateDosing</span>(<span>4</span>)</span>
<span id="cb17-5">magnesium<span>$</span>Dose<span>.8</span>d <span>&lt;-</span> <span>estimateDosing</span>(<span>8</span>)</span>
<span id="cb17-6">magnesium<span>$</span>Dose<span>.16</span>d <span>&lt;-</span> <span>estimateDosing</span>(<span>16</span>)</span>
<span id="cb17-7">magnesium<span>$</span>Dose<span>.32</span>d <span>&lt;-</span> <span>estimateDosing</span>(<span>32</span>)</span>
<span id="cb17-8">magnesium<span>$</span>Dose<span>.64</span>d <span>&lt;-</span> <span>estimateDosing</span>(<span>64</span>)</span>
<span id="cb17-9"></span>
<span id="cb17-10">bod <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Date.int <span>+</span> Dose <span>+</span> Dose<span>.1</span>d <span>+</span> Dose<span>.2</span>d <span>+</span> Dose<span>.4</span>d <span>+</span> Dose<span>.8</span>d <span>+</span> Dose<span>.16</span>d <span>+</span> Dose<span>.32</span>d <span>+</span> Dose<span>.64</span>d,</span>
<span id="cb17-11">    <span>prior=</span><span>c</span>(<span>set_prior</span>(<span>&#34;horseshoe(1, par_ratio=(1/7))&#34;</span>)), <span>iter=</span><span>15000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>data=</span>magnesium)</span>
<span id="cb17-12"><span>summary</span>(bod); <span>fixef</span>(bod)</span>
<span id="cb17-13"><span># Population-Level Effects:</span></span>
<span id="cb17-14"><span>#           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb17-15"><span># Intercept     6.38      2.24     2.65    10.73      11367 1.00</span></span>
<span id="cb17-16"><span># Date.int     -0.00      0.00    -0.00     0.00      11203 1.00</span></span>
<span id="cb17-17"><span># Dose         -0.00      0.00    -0.00     0.00      22772 1.00</span></span>
<span id="cb17-18"><span># Dose.1d      -0.00      0.00    -0.00     0.00      16871 1.00</span></span>
<span id="cb17-19"><span># Dose.2d      -0.00      0.00    -0.00     0.00       9947 1.00</span></span>
<span id="cb17-20"><span># Dose.4d      -0.00      0.00    -0.00     0.00      13362 1.00</span></span>
<span id="cb17-21"><span># Dose.8d      -0.00      0.00    -0.00     0.00       4789 1.01</span></span>
<span id="cb17-22"><span># Dose.16d      0.00      0.00    -0.00     0.00       3778 1.01</span></span>
<span id="cb17-23"><span># Dose.32d      0.00      0.00    -0.00     0.00       3681 1.01</span></span>
<span id="cb17-24"><span># Dose.64d     -0.00      0.00    -0.00     0.00       4858 1.01</span></span>
<span id="cb17-25"><span>#</span></span>
<span id="cb17-26"><span># Family Specific Parameters:</span></span>
<span id="cb17-27"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb17-28"><span># sigma     0.63      0.02     0.60     0.67      23631 1.00</span></span>
<span id="cb17-29"><span># ...</span></span>
<span id="cb17-30"><span>#                  Estimate      Est.Error            Q2.5          Q97.5</span></span>
<span id="cb17-31"><span># Intercept  6.37662456e+00 2.235888108006  2.649424916291 1.07293860e+01</span></span>
<span id="cb17-32"><span># Date.int  -1.87427217e-04 0.000135929535 -0.000451826065 4.02780509e-05</span></span>
<span id="cb17-33"><span># Dose      -9.83247484e-05 0.000398884863 -0.001201592100 5.62706619e-04</span></span>
<span id="cb17-34"><span># Dose.1d   -1.14355053e-04 0.000490526386 -0.001424678384 6.96386862e-04</span></span>
<span id="cb17-35"><span># Dose.2d   -1.23935090e-04 0.000432495370 -0.001206503256 5.95745260e-04</span></span>
<span id="cb17-36"><span># Dose.4d   -1.84854122e-04 0.000372559311 -0.001123141480 3.49011680e-04</span></span>
<span id="cb17-37"><span># Dose.8d   -1.63414873e-04 0.000337226934 -0.001082742030 2.72433040e-04</span></span>
<span id="cb17-38"><span># Dose.16d   5.59172067e-05 0.000248260879 -0.000414186231 6.79183708e-04</span></span>
<span id="cb17-39"><span># Dose.32d   1.55059360e-04 0.000227871520 -0.000104605208 7.47809143e-04</span></span>
<span id="cb17-40"><span># Dose.64d  -7.71631435e-05 0.000106139588 -0.000342571572 5.31762310e-05</span></span></code></pre>
                  </div>
                  <p>A similar method is lagging, just shifting the dose and estimating an attenuation, which didn’t work either:</p>
                  <div id="cb18">
                    <pre><code><span id="cb18-1">magnesium<span>$</span>Lag<span>.1</span> <span>&lt;-</span> <span>c</span>(<span>rep</span>(<span>0</span>,<span>1</span>), magnesium<span>$</span>Dose)[<span>1</span><span>:</span><span>nrow</span>(magnesium)]</span>
<span id="cb18-2">magnesium<span>$</span>Lag<span>.2</span> <span>&lt;-</span> <span>c</span>(<span>rep</span>(<span>0</span>,<span>2</span>), magnesium<span>$</span>Dose)[<span>1</span><span>:</span><span>nrow</span>(magnesium)]</span>
<span id="cb18-3">magnesium<span>$</span>Lag<span>.3</span> <span>&lt;-</span> <span>c</span>(<span>rep</span>(<span>0</span>,<span>3</span>), magnesium<span>$</span>Dose)[<span>1</span><span>:</span><span>nrow</span>(magnesium)]</span>
<span id="cb18-4">magnesium<span>$</span>Lag<span>.4</span> <span>&lt;-</span> <span>c</span>(<span>rep</span>(<span>0</span>,<span>4</span>), magnesium<span>$</span>Dose)[<span>1</span><span>:</span><span>nrow</span>(magnesium)]</span>
<span id="cb18-5">magnesium<span>$</span>Lag<span>.5</span> <span>&lt;-</span> <span>c</span>(<span>rep</span>(<span>0</span>,<span>5</span>), magnesium<span>$</span>Dose)[<span>1</span><span>:</span><span>nrow</span>(magnesium)]</span>
<span id="cb18-6">magnesium<span>$</span>Lag<span>.6</span> <span>&lt;-</span> <span>c</span>(<span>rep</span>(<span>0</span>,<span>6</span>), magnesium<span>$</span>Dose)[<span>1</span><span>:</span><span>nrow</span>(magnesium)]</span>
<span id="cb18-7">magnesium<span>$</span>Lag<span>.7</span> <span>&lt;-</span> <span>c</span>(<span>rep</span>(<span>0</span>,<span>7</span>), magnesium<span>$</span>Dose)[<span>1</span><span>:</span><span>nrow</span>(magnesium)]</span>
<span id="cb18-8">bol <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Date.int <span>+</span> Dose <span>+</span> Lag<span>.1</span> <span>+</span> Lag<span>.2</span> <span>+</span> Lag<span>.3</span> <span>+</span> Lag<span>.4</span> <span>+</span> Lag<span>.5</span> <span>+</span> Lag<span>.6</span> <span>+</span> Lag<span>.7</span>,</span>
<span id="cb18-9">    <span>prior=</span><span>c</span>(<span>prior</span>(<span>normal</span>(<span>0</span>,<span>0.01</span>))), <span>iter=</span><span>5000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>data=</span>magnesium)</span>
<span id="cb18-10"><span>summary</span>(bol); <span>fixef</span>(bol)</span>
<span id="cb18-11"><span># Population-Level Effects:</span></span>
<span id="cb18-12"><span>#           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb18-13"><span># Intercept     8.34      1.62     5.16    11.52      75000 1.00</span></span>
<span id="cb18-14"><span># Date.int     -0.00      0.00    -0.00    -0.00      75000 1.00</span></span>
<span id="cb18-15"><span># Dose          0.00      0.00    -0.00     0.00      75000 1.00</span></span>
<span id="cb18-16"><span># Lag.1         0.00      0.00    -0.00     0.00      75000 1.00</span></span>
<span id="cb18-17"><span># Lag.2        -0.00      0.00    -0.01     0.00      60789 1.00</span></span>
<span id="cb18-18"><span># Lag.3        -0.00      0.00    -0.01     0.00      62034 1.00</span></span>
<span id="cb18-19"><span># Lag.4        -0.00      0.00    -0.01     0.00      62263 1.00</span></span>
<span id="cb18-20"><span># Lag.5         0.00      0.00    -0.00     0.01      60792 1.00</span></span>
<span id="cb18-21"><span># Lag.6         0.00      0.00    -0.00     0.00      75000 1.00</span></span>
<span id="cb18-22"><span># Lag.7        -0.00      0.00    -0.00     0.00      75000 1.00</span></span>
<span id="cb18-23"><span>#</span></span>
<span id="cb18-24"><span># Family Specific Parameters:</span></span>
<span id="cb18-25"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb18-26"><span># sigma     0.64      0.02     0.60     0.67      68165 1.00</span></span>
<span id="cb18-27"><span>#</span></span>
<span id="cb18-28"><span># Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample</span></span>
<span id="cb18-29"><span># is a crude measure of effective sample size, and Rhat is the potential</span></span>
<span id="cb18-30"><span># scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span id="cb18-31"><span>#                  Estimate      Est.Error            Q2.5          Q97.5</span></span>
<span id="cb18-32"><span># Intercept  8.343749825167 1.62108462e+00  5.164844564711 11.52433155127</span></span>
<span id="cb18-33"><span># Date.int  -0.000305389794 9.69037305e-05 -0.000495385229 -0.00011560533</span></span>
<span id="cb18-34"><span># Dose       0.001125326534 1.89417227e-03 -0.002587631351  0.00483233217</span></span>
<span id="cb18-35"><span># Lag.1      0.000259731777 1.88856710e-03 -0.003464743028  0.00398431704</span></span>
<span id="cb18-36"><span># Lag.2     -0.002630603643 2.58733392e-03 -0.007694762066  0.00246824541</span></span>
<span id="cb18-37"><span># Lag.3     -0.003248745460 2.58131724e-03 -0.008338464544  0.00179576211</span></span>
<span id="cb18-38"><span># Lag.4     -0.000669146992 2.56489651e-03 -0.005715930399  0.00435186920</span></span>
<span id="cb18-39"><span># Lag.5      0.002623359249 2.59021313e-03 -0.002451459184  0.00773690535</span></span>
<span id="cb18-40"><span># Lag.6      0.000608268232 1.89271318e-03 -0.003081445775  0.00433930503</span></span>
<span id="cb18-41"><span># Lag.7     -0.000160728821 1.89947146e-03 -0.003881042703  0.00358413020</span></span></code></pre>
                  </div>
                  <p>brms does support formal ARIMA time-series models, so I considered similar ones which add ARIMA (to the response variable, <code>MP</code>) with lags up to 7 days and a moving-average, a 1-day lag+moving-average, and just a moving-average. (<a href="https://github.com/paul-buerkner/brms#Overview" id="UCnrTfKm" data-link-icon="R" data-link-icon-type="text" data-link-icon-color="#1b61b1" title="&#39;brms: an R package for Bayesian generalized multivariate non-linear multilevel models using Stan&#39;, Bürkner 2025">brms</a> does not, as far as I can tell, support inference on the ARIMA parameters themselves other than in the generic sense of allowing you to fit multiple discrete models and then comparing with <code>waic</code>/<code>loo</code> etc.)</p>
                  <div id="cb19">
                    <pre><code><span id="cb19-1">barma71 <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Dose, <span>autocor=</span><span>cor_arma</span>(<span>~</span><span>1</span>, <span>p=</span><span>7</span>, <span>q=</span><span>1</span>), <span>iter=</span><span>5000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>data=</span>magnesium); <span>summary</span>(barma71); <span>fixef</span>(barma71)</span>
<span id="cb19-2"><span># Correlation Structures:</span></span>
<span id="cb19-3"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-4"><span># ar[1]     0.13      0.52    -0.79     0.94      13907 1.00</span></span>
<span id="cb19-5"><span># ar[2]    -0.04      0.09    -0.20     0.12      15956 1.00</span></span>
<span id="cb19-6"><span># ar[3]     0.02      0.05    -0.08     0.11      30385 1.00</span></span>
<span id="cb19-7"><span># ar[4]    -0.03      0.04    -0.11     0.05      44092 1.00</span></span>
<span id="cb19-8"><span># ar[5]     0.03      0.04    -0.05     0.12      35208 1.00</span></span>
<span id="cb19-9"><span># ar[6]     0.00      0.05    -0.09     0.09      32015 1.00</span></span>
<span id="cb19-10"><span># ar[7]     0.02      0.04    -0.05     0.10      50915 1.00</span></span>
<span id="cb19-11"><span># ma[1]     0.01      0.52    -0.79     0.93      13888 1.00</span></span>
<span id="cb19-12"><span>#</span></span>
<span id="cb19-13"><span># Population-Level Effects:</span></span>
<span id="cb19-14"><span>#           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-15"><span># Intercept     8.22      1.93     4.42    12.01      74914 1.00</span></span>
<span id="cb19-16"><span># Date.int     -0.00      0.00    -0.00    -0.00      74892 1.00</span></span>
<span id="cb19-17"><span># Dose         -0.00      0.00    -0.00     0.00      75000 1.00</span></span>
<span id="cb19-18"><span>#</span></span>
<span id="cb19-19"><span># Family Specific Parameters:</span></span>
<span id="cb19-20"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-21"><span># sigma     0.63      0.02     0.60     0.66      60937 1.00</span></span>
<span id="cb19-22"><span>#</span></span>
<span id="cb19-23"><span># Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample</span></span>
<span id="cb19-24"><span># is a crude measure of effective sample size, and Rhat is the potential</span></span>
<span id="cb19-25"><span># scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span id="cb19-26"><span># Warning message:</span></span>
<span id="cb19-27"><span># There were 17 divergent transitions after warmup. Increasing adapt_delta above 0.8 may help.</span></span>
<span id="cb19-28"><span># See https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span id="cb19-29"><span>#                  Estimate      Est.Error            Q2.5           Q97.5</span></span>
<span id="cb19-30"><span># Intercept  8.222000498575 1.932432753905  4.416327738099  1.20085926e+01</span></span>
<span id="cb19-31"><span># Date.int  -0.000299167802 0.000115613136 -0.000525771625 -7.13583711e-05</span></span>
<span id="cb19-32"><span># Dose      -0.001149187774 0.000597896272 -0.002324613368  2.89226774e-05</span></span>
<span id="cb19-33"></span>
<span id="cb19-34">barma11 <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Dose, <span>autocor=</span><span>cor_arma</span>(<span>~</span><span>1</span>, <span>p=</span><span>1</span>, <span>q=</span><span>1</span>), <span>iter=</span><span>5000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>data=</span>magnesium); <span>summary</span>(bama11); <span>fixef</span>(bama11)</span>
<span id="cb19-35"><span># Correlation Structures:</span></span>
<span id="cb19-36"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-37"><span># ar[1]    -0.10      0.27    -0.62     0.44      28289 1.00</span></span>
<span id="cb19-38"><span># ma[1]     0.25      0.27    -0.31     0.72      28510 1.00</span></span>
<span id="cb19-39"><span>#</span></span>
<span id="cb19-40"><span># Population-Level Effects:</span></span>
<span id="cb19-41"><span>#           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-42"><span># Intercept     3.22      0.03     3.17     3.28      47473 1.00</span></span>
<span id="cb19-43"><span># Dose         -0.00      0.00    -0.00     0.00      75000 1.00</span></span>
<span id="cb19-44"><span>#</span></span>
<span id="cb19-45"><span># Family Specific Parameters:</span></span>
<span id="cb19-46"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-47"><span># sigma     0.63      0.02     0.60     0.66      43505 1.00</span></span>
<span id="cb19-48"></span>
<span id="cb19-49">bma <span>&lt;-</span> <span>brm</span>(MP <span>~</span> Date.int <span>+</span> Dose, <span>autocor=</span><span>cor_arma</span>(<span>~</span><span>1</span>, <span>p=</span><span>0</span>, <span>q=</span><span>1</span>), <span>iter=</span><span>10000</span>, <span>chains=</span><span>30</span>, <span>cores=</span><span>30</span>, <span>data=</span>magnesium); <span>summary</span>(bma); <span>fixef</span>(bma)</span>
<span id="cb19-50"><span># Correlation Structures:</span></span>
<span id="cb19-51"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-52"><span># ma[1]     0.15      0.04     0.07     0.22      85325 1.00</span></span>
<span id="cb19-53"><span>#</span></span>
<span id="cb19-54"><span># Population-Level Effects:</span></span>
<span id="cb19-55"><span>#           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-56"><span># Intercept     8.25      1.84     4.65    11.83     150000 1.00</span></span>
<span id="cb19-57"><span># Date.int     -0.00      0.00    -0.00    -0.00     150000 1.00</span></span>
<span id="cb19-58"><span># Dose         -0.00      0.00    -0.00     0.00     150000 1.00</span></span>
<span id="cb19-59"><span>#</span></span>
<span id="cb19-60"><span># Family Specific Parameters:</span></span>
<span id="cb19-61"><span>#       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat</span></span>
<span id="cb19-62"><span># sigma     0.63      0.02     0.60     0.66      85214 1.00</span></span>
<span id="cb19-63"><span>#</span></span>
<span id="cb19-64"><span># Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample</span></span>
<span id="cb19-65"><span># is a crude measure of effective sample size, and Rhat is the potential</span></span>
<span id="cb19-66"><span># scale reduction factor on split chains (at convergence, Rhat = 1).</span></span>
<span id="cb19-67"><span>#                  Estimate      Est.Error            Q2.5           Q97.5</span></span>
<span id="cb19-68"><span># Intercept  8.246820322945 1.836822995887  4.649351298371  1.18301614e+01</span></span>
<span id="cb19-69"><span># Date.int  -0.000300629617 0.000109882242 -0.000515036715 -8.53722332e-05</span></span>
<span id="cb19-70"><span># Dose      -0.001156989930 0.000636009833 -0.002405544347  8.80188844e-05</span></span></code></pre>
                  </div>
                  <p>While I was at it, I threw some decision-tree methods, <a href="https://en.wikipedia.org/wiki/Random_forest" id="XUQh8jzp" data-link-icon="wikipedia" data-link-icon-type="svg" data-url-iframe="https://en.m.wikipedia.org/wiki/Random_forest#bodyContent" title="Random forest">random forests</a> &amp; XGBoost, at it. Neither one performs much above chance, and both overfit:</p>
                  <div id="cb20">
                    <pre><code><span id="cb20-1"><span>library</span>(randomForest)</span>
<span id="cb20-2">r <span>&lt;-</span> <span>randomForest</span>(MP <span>~</span> Date.int <span>+</span> Dose <span>+</span> Dose<span>.1</span>d <span>+</span> Dose<span>.2</span>d <span>+</span> Dose<span>.4</span>d <span>+</span> Dose<span>.8</span>d <span>+</span> Dose<span>.16</span>d <span>+</span> Dose<span>.32</span>d <span>+</span></span>
<span id="cb20-3">    Dose<span>.64</span>d <span>+</span> Lag<span>.1</span> <span>+</span> Lag<span>.2</span> <span>+</span> Lag<span>.3</span> <span>+</span> Lag<span>.4</span> <span>+</span> Lag<span>.5</span> <span>+</span> Lag<span>.6</span> <span>+</span> Lag<span>.7</span>, <span>data=</span>magnesium, <span>importance=</span><span>TRUE</span>); r</span>
<span id="cb20-4"><span>#                Type of random forest: regression</span></span>
<span id="cb20-5"><span>#                      Number of trees: 500</span></span>
<span id="cb20-6"><span># No. of variables tried at each split: 5</span></span>
<span id="cb20-7"><span>#</span></span>
<span id="cb20-8"><span>#           Mean of squared residuals: 0.45309365</span></span>
<span id="cb20-9"><span>#                     % Var explained: -11.5</span></span>
<span id="cb20-10"></span>
<span id="cb20-11"><span>library</span>(xgboost)</span>
<span id="cb20-12">xdf <span>&lt;-</span> <span>as.matrix</span>(<span>subset</span>(magnesium, <span>select=</span><span>c</span>(<span>&#34;Date.int&#34;</span>, <span>&#34;Dose&#34;</span>, <span>&#34;Dose.1d&#34;</span>, <span>&#34;Dose.2d&#34;</span>,</span>
<span id="cb20-13">    <span>&#34;Dose.4d&#34;</span>, <span>&#34;Dose.8d&#34;</span>, <span>&#34;Dose.16d&#34;</span>, <span>&#34;Dose.32d&#34;</span>, <span>&#34;Dose.64d&#34;</span>, <span>&#34;Lag.1&#34;</span>, <span>&#34;Lag.2&#34;</span>, <span>&#34;Lag.3&#34;</span>,</span>
<span id="cb20-14">    <span>&#34;Lag.4&#34;</span>, <span>&#34;Lag.5&#34;</span>, <span>&#34;Lag.6&#34;</span>, <span>&#34;Lag.7&#34;</span>)))</span>
<span id="cb20-15">xdt <span>&lt;-</span> <span>xgb.DMatrix</span>(<span>data=</span>xdf, <span>label=</span>magnesium<span>$</span>MP)</span>
<span id="cb20-16">xc <span>&lt;-</span> <span>xgb.cv</span>(<span>data=</span>xdt, <span>nrounds=</span><span>20</span>, <span>nfold=</span><span>5</span>); xc</span>
<span id="cb20-17"><span># ##### xgb.cv 5-folds</span></span>
<span id="cb20-18"><span>#  iter train_rmse_mean train_rmse_std test_rmse_mean test_rmse_std</span></span>
<span id="cb20-19"><span>#     1       1.9971932  0.00887113498      1.9965942 0.05663487645</span></span>
<span id="cb20-20"><span>#     2       1.4694444  0.00571063963      1.4738914 0.05622243389</span></span>
<span id="cb20-21"><span>#     3       1.1169894  0.00287774687      1.1322150 0.05330744639</span></span>
<span id="cb20-22"><span>#     4       0.8827894  0.00270631089      0.9221848 0.04989199156</span></span>
<span id="cb20-23"><span>#     5       0.7319208  0.00266308260      0.7998346 0.03957045891</span></span>
<span id="cb20-24"><span>#     6       0.6377054  0.00365968636      0.7273444 0.03119305256</span></span>
<span id="cb20-25"><span>#     7       0.5729780  0.00505585174      0.6925404 0.02332950090</span></span>
<span id="cb20-26"><span>#     8       0.5344652  0.00388501024      0.6750268 0.01660751560</span></span>
<span id="cb20-27"><span>#     9       0.5110230  0.00628505720      0.6688250 0.01083822294</span></span>
<span id="cb20-28"><span>#    10       0.4895788  0.00609432403      0.6633326 0.00994656782</span></span>
<span id="cb20-29"><span>#    11       0.4764658  0.00665422484      0.6616298 0.00788831770</span></span>
<span id="cb20-30"><span>#    12       0.4673910  0.00639055653      0.6622510 0.00830873304</span></span>
<span id="cb20-31"><span>#    13       0.4553722  0.00896999151      0.6623134 0.00798312374</span></span>
<span id="cb20-32"><span>#    14       0.4453348  0.01095618562      0.6634832 0.00916942418</span></span>
<span id="cb20-33"><span>#    15       0.4346564  0.01193689604      0.6643090 0.01121566110</span></span>
<span id="cb20-34"><span>#    16       0.4234282  0.01007038727      0.6668124 0.01150062806</span></span>
<span id="cb20-35"><span>#    17       0.4130764  0.01161052529      0.6686780 0.01166914274</span></span>
<span id="cb20-36"><span>#    18       0.4054248  0.01099076020      0.6720958 0.01327700370</span></span>
<span id="cb20-37"><span>#    19       0.3971520  0.01330724769      0.6726724 0.01219097106</span></span>
<span id="cb20-38"><span>#    20       0.3901480  0.01375990240      0.6741852 0.01182116611</span></span></code></pre>
                  </div>
                  
                  
                  
                  
                </section>
              </section>
            </section>
          </section>
        </section>
        <section id="external-links">
          
          <ul>
            <li>
              <p>Magnesium (first): <a href="https://gwern.net/doc/www/old.reddit.com/09a7e75fd2c71c425092257d458c652705ab8577.html" id="5RVcSdEB" data-link-icon="reddit" data-link-icon-type="svg" data-link-icon-color="#ff4500" data-url-archive="/doc/www/old.reddit.com/09a7e75fd2c71c425092257d458c652705ab8577.html" data-url-original="https://www.reddit.com/r/Nootropics/comments/2cdiih/magnesium_selfexperiment_benefit_but_then_overdose/">1</a></p>
            </li>
            <li>
              <p><a href="https://gwern.net/doc/www/old.reddit.com/027d1631e89ed1f215d606f289ba32fc58db5eff.html" id="3oQtUskq" data-link-icon="reddit" data-link-icon-type="svg" data-link-icon-color="#ff4500" data-url-archive="/doc/www/old.reddit.com/027d1631e89ed1f215d606f289ba32fc58db5eff.html" data-url-original="https://www.reddit.com/r/Nootropics/comments/ayftoc/best_brain_fog_relieve_i_ever_get_is_when_i_stop/">Magnesium brain fog</a></p>
            </li>
          </ul>
        </section>
        
        <section id="backlinks-section">
          <a id="backlinks" href="https://gwern.net/metadata/annotation/backlink/%252Fnootropic%252Fmagnesium.html" title="Reverse citations/backlinks for this page (the list of other pages which link to this page)." data-link-icon="arrows-pointing-inwards-to-dot" data-link-icon-type="svg">[Backlinks (what links here)]</a>
        </section>
        <section id="similars-section">
          <a id="similars" href="https://gwern.net/metadata/annotation/similar/%252Fnootropic%252Fmagnesium.html" title="Similar links for this link (by text embedding). Lazily-transcluded version at footer of page for easier scrolling." data-link-icon="≈" data-link-icon-type="text">[Similar links by topic]</a>
        </section>
        <section id="link-bibliography-section">
          <!-- NOTE: In theory, '.collapse' on a '<h1>' is redundant with the '<section>'; but added to parallel Pandoc-generated headers which set all attributes/classes on both. -->
          <a id="link-bibliography" href="https://gwern.net/metadata/annotation/link-bibliography/%252Fnootropic%252Fmagnesium.html" title="Bibliography of links cited in this page (forward citations). Lazily-transcluded version at footer of page for easier scrolling." data-link-icon="bibliography" data-link-icon-type="svg">[Bibliography of links/references used in page]</a>
        </section>
      </div></div>
  </body>
</html>
