<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/adityaathalye/shite">Original</a>
    <h1>Show HN: Shite â€“ little hot-reloadin&#39; static site maker from shell</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 dir="auto"><a id="user-content-shite" aria-hidden="true" href="#shite"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>shite</h2>
<p dir="auto">The little hot-reloadin&#39; static site generator from shell. Assumes Bash 4.4+.</p>
<p dir="auto">WARNING: Here be yaks!</p>
<p dir="auto"><code>shite</code>&#39;s job is to help me make my website: <a href="https://evalapply.org" rel="nofollow">https://evalapply.org</a>
Thus, <code>shite</code>&#39;s scope, (mis)feature set, polish will always be production-grade,
where production is &#34;works on my machine(s)&#34; :)</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adityaathalye/shite/blob/master/demo/shite-demo-02-hotreload-content-edits-5fps-1024px.gif"><img src="https://github.com/adityaathalye/shite/raw/master/demo/shite-demo-02-hotreload-content-edits-5fps-1024px.gif" alt="much write. such Bash. very hotreload. wow." title="much write. such Bash. very hotreload. wow." data-animated-image=""/></a></p>

<p dir="auto"><strong>Table of Contents</strong></p>
<ul dir="auto">
<li><a href="#shite">shite</a></li>
<li><a href="#introduction">Introduction</a>
<ul dir="auto">
<li><a href="#dreams-and-desires">Dreams and desires</a></li>
<li><a href="#backstory">Backstory</a></li>
</ul>
</li>
<li><a href="#usage-demo">Usage Demo</a>
<ul dir="auto">
<li><a href="#hot-reloaded-shite-editing">Hot-reloaded shite editing</a>
<ul dir="auto">
<li><a href="#hotreload-begins">hotreload begins</a></li>
<li><a href="#hotreload-content-edits">hotreload content edits</a></li>
<li><a href="#hotreload-style-edits">hotreload style edits</a></li>
<li><a href="#hotreload-template-edits">hotreload template edits</a></li>
<li><a href="#hot-rebuild-indices-and-feeds">hot rebuild indices and feeds</a></li>
</ul>
</li>
<li><a href="#full-site-builds">Full site builds</a></li>
<li><a href="#environment-variables-and-debug-flags">Environment Variables and Debug flags</a></li>
</ul>
</li>
<li><a href="#design-and-internals">Design and Internals</a>
<ul dir="auto">
<li><a href="#file-and-url-naming-scheme">File and URL naming scheme</a></li>
<li><a href="#code-organisation">Code organisation</a></li>
<li><a href="#calling-the-code">Calling the code</a></li>
<li><a href="#templating-system">Templating system</a></li>
<li><a href="#metadata-and-front-matter-system">Metadata and front matter system</a>
<ul dir="auto">
<li><a href="#for-orgmode-content">For orgmode content</a></li>
<li><a href="#for-markdown-content">For markdown content</a></li>
<li><a href="#for-html-content">For html content</a></li>
</ul>
</li>
<li><a href="#bashful-hot-reloading-sans-javascript">Bashful Hot Reloading Sans Javascript</a>
<ul dir="auto">
<li><a href="#the-event-system">The event system</a></li>
<li><a href="#liveness-criterion">Liveness criterion</a></li>
<li><a href="#hot-reload-scenarios">Hot reload scenarios</a></li>
<li><a href="#hot-reload-behaviour">Hot reload behaviour</a></li>
</ul>
</li>
<li><a href="#unrealised-ambitions">Unrealised Ambitions</a>
<ul dir="auto">
<li><a href="#from-any-source-dir-to-any-publish-dir-from-anywhere-on-my-box">From any source dir to any publish dir from anywhere on my box</a></li>
<li><a href="#hot-deployment">Hot deployment</a></li>
<li><a href="#hot-deployment-with-local-hot-reload">Hot deployment with local hot reload</a></li>
<li><a href="#more-creature-comforts">More creature comforts</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#license">License</a></li>
</ul>


<p dir="auto">Well, <code>shite</code> aims to make websites.</p>
<ul dir="auto">
<li>
<p dir="auto">It is a wee publishing system made of pipelined workflows, optionally driven
by streams of file events (for the hotreloadin&#39; bits).</p>
</li>
<li>
<p dir="auto">It will not surprise a Perl/PHP gentleperson hacker from the last century.</p>
</li>
<li>
<p dir="auto">It exists because one whistles silly tunes and shaves yaks.</p>
</li>
</ul>
<p dir="auto">This is baaasically what it does (ref: the <code>shite_templating_publish_sources</code> function).</p>
<div dir="auto" data-snippet-clipboard-copy-content="cat &#34;${watch_dir}/sources/${url_slug}&#34; |
    __shite_templating_compile_source_to_html ${file_type} |
    __shite_templating_wrap_content_html ${content_type} |
    __shite_templating_wrap_page_html |
    ${html_formatter_fn} |
    tee &#34;${watch_dir}/public/${slug}.html&#34;
"><pre>cat <span><span>&#34;</span><span>${watch_dir}</span>/sources/<span>${url_slug}</span><span>&#34;</span></span> <span>|</span>
    __shite_templating_compile_source_to_html <span>${file_type}</span> <span>|</span>
    __shite_templating_wrap_content_html <span>${content_type}</span> <span>|</span>
    __shite_templating_wrap_page_html <span>|</span>
    <span>${html_formatter_fn}</span> <span>|</span>
    tee <span><span>&#34;</span><span>${watch_dir}</span>/public/<span>${slug}</span>.html<span>&#34;</span></span>
</pre></div>
<ul dir="auto">
<li>It publishes content from org-mode files.</li>
<li>And html, and markdown.</li>
<li>It hot-builds.</li>
<li>It hot-reloads (no Javascript).</li>
<li>It does neither if you disdain creature comforts.</li>
<li>It does not <em>demand</em> any server process for local publishing.</li>
<li>It is quite small.
<div dir="auto" data-snippet-clipboard-copy-content="# The complete &#34;business logic&#34; is 300-ish lines as of this comment,
# counted as all lines except comments and blank lines.
grep -E -v &#34;\s?\#|^$&#34; \
    ./bin/{events,metadata,templating,utils,hotreload}.sh |
   wc -l"><pre><span><span>#</span> The complete &#34;business logic&#34; is 300-ish lines as of this comment,</span>
<span><span>#</span> counted as all lines except comments and blank lines.</span>
grep -E -v <span><span>&#34;</span>\s?\#|^$<span>&#34;</span></span> \
    ./bin/{events,metadata,templating,utils,hotreload}.sh <span>|</span>
   wc -l</pre></div>
</li>
<li>It is Bash-ful.</li>
<li>I <em>like</em> it.</li>
</ul>
<p dir="auto">Before you get too exshited, may I warn you that the MIT license means I don&#39;t
have to give a shite if this little shite maker fails to make your shite work.
<a href="#contributing">Contributing</a> is replete with more warnings.</p>
<p dir="auto">And last but not least, I hereby decree that all texsht herein be read in Sean
Connery voish.</p>
<h2 dir="auto"><a id="user-content-dreams-and-desires" aria-hidden="true" href="#dreams-and-desires"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Dreams and desires</h2>
<p dir="auto">In my <code>shite</code> dreams, I desire...</p>
<ul dir="auto">
<li>
<p dir="auto">Above all, to keep it (the &#34;business logic&#34;) <em>small</em>. Small enough to cache,
debug, and refactor in my head.</p>
</li>
<li>
<p dir="auto">To install and use without superuser permission.</p>
</li>
<li>
<p dir="auto">To <em>extremely</em> avoid toolchains and build dependencies. No gems / npms / venvs
/ what-have-yous. Thus, Bash is the language, because Bash is everywhere. And
standard packages like <code>pandoc</code> or <code>tidy</code>, when one needs <em>specific</em> advanced
functionality.</p>
</li>
<li>
<p dir="auto">Dependency-free templating with plain-ol&#39; HTML set in good ol&#39; heredocs.</p>
</li>
<li>
<p dir="auto">Simple metadata system, content namespacing, static asset organisation etc.</p>
</li>
<li>
<p dir="auto">Web server optional (or any kind of server process for that matter). We aim
for static sites, after all, which work just fine with <code>file://</code> navigation.</p>
</li>
<li>
<p dir="auto">To construct it from small, composable, purely functional, Unix-tool-like
parts, because I like that sort of stuff a lot.</p>
</li>
<li>
<p dir="auto">To give myself a seamless REPL-like edit-save-build-preview workflow.</p>
<ul dir="auto">
<li>Hot-build page processing (compile + build on save.)</li>
<li>Javascript-free browser hot-reloading. It works. It&#39;s terrible. It&#39;s awesome!</li>
<li>TODO: Potentially also extend the same mechanism to hot-deploy, on git push
to a private repo on my own VPS somewhere. Maybe.</li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-backstory" aria-hidden="true" href="#backstory"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Backstory</h2>
<p dir="auto">I accidentally restarted blogging after a long haitus. Before I could get words
into the cloud, I muddled about with &#34;modern&#34; Static Site Generators. Because
WordPress is so last century (or so I told myself). Then I got annoyed by the
SSG Jamstack bespoke templating building etc. magic. Now I am on the dark
path of making this. It is being blogged about at:
<a href="https://www.evalapply.org/posts/shite-the-static-sites-from-shell-part-1/" rel="nofollow">shite: static sites from shell: part 1/2</a></p>

<p dir="auto">I use shite mainly in &#34;hotreload&#34; mode, mainly to write posts (in orgmode) and
live preview them (in Firefox). Less mainly, to hot-preview modifications to
styles and/or page templates. Least mainly, after labouring on a post interminably,
I use it in &#34;don&#39;t hotreload&#34; mode to do a full site rebuild.</p>
<p dir="auto">shite demo examples below.</p>
<h2 dir="auto"><a id="user-content-hot-reloaded-shite-editing" aria-hidden="true" href="#hot-reloaded-shite-editing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hot-reloaded shite editing</h2>
<p dir="auto">Basically this means that if I create, update, delete any file under <code>sources</code>,
it must automatically translate to HTML, be published locally to <code>public</code>, and
cause an appropriate page navigation or reload action in the web browser, where
my site is open.</p>
<h3 dir="auto"><a id="user-content-hotreload-begins" aria-hidden="true" href="#hotreload-begins"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>hotreload begins</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adityaathalye/shite/blob/master/demo/shite-demo-01-hotreload-begins-5fps-1024px.gif"><img src="https://github.com/adityaathalye/shite/raw/master/demo/shite-demo-01-hotreload-begins-5fps-1024px.gif" alt="invoke shite in hotreload mode" title="invoke shite in hotreload mode" data-animated-image=""/></a></p>
<p dir="auto">Call the &#34;main&#34; script in a clean new terminal session or tmux pane.</p>

<p dir="auto">It helpfully opens the index file in Firefox, according to the defaults I&#39;ve set
in <code>shite_global_data</code> array in <code>./shite.sh</code>.</p>
<h3 dir="auto"><a id="user-content-hotreload-content-edits" aria-hidden="true" href="#hotreload-content-edits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>hotreload content edits</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adityaathalye/shite/blob/master/demo/shite-demo-02-hotreload-content-edits-5fps-1024px.gif"><img src="https://github.com/adityaathalye/shite/raw/master/demo/shite-demo-02-hotreload-content-edits-5fps-1024px.gif" alt="hotreload content edits" title="hotreload content edits" data-animated-image=""/></a></p>
<p dir="auto">In your Emacs or Vim, open some content file under <code>sources</code>. Edit, save, and
watch the content appear in the browser. (Yes specifying Emacs/Vim is goofy,
because I trigger <em>hot</em> actions based on inotify events. Apparently different
editors do file updates differently. I use Emacs or Vim, so I watch for the
events they cause, so it works on my machine. :)).</p>
<p dir="auto">Frequently the browser remembers the scroll position, which is neat. Sometimes
the hotreload is, well, shite. So I just hit space and save the content file to
trigger hotreload again.</p>
<h3 dir="auto"><a id="user-content-hotreload-style-edits" aria-hidden="true" href="#hotreload-style-edits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>hotreload style edits</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adityaathalye/shite/blob/master/demo/shite-demo-03-hotreload-style-edits-5fps-1024px.gif"><img src="https://github.com/adityaathalye/shite/raw/master/demo/shite-demo-03-hotreload-style-edits-5fps-1024px.gif" alt="hotreload style edits" title="hotreload style edits" data-animated-image=""/></a></p>
<p dir="auto">Go to some static asset, like a CSS stylesheet. Alter a thing, like background
color value. Save and watch the color change in the browser.</p>
<h3 dir="auto"><a id="user-content-hotreload-template-edits" aria-hidden="true" href="#hotreload-template-edits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>hotreload template edits</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adityaathalye/shite/blob/master/demo/shite-demo-04-hotreload-template-updates-5fps-1024px.gif"><img src="https://github.com/adityaathalye/shite/raw/master/demo/shite-demo-04-hotreload-template-updates-5fps-1024px.gif" alt="hotreload template edits" title="hotreload template edits" data-animated-image=""/></a></p>
<p dir="auto">Tweak some template fragment in <code>templates.sh</code>---say, blog post template. Then
switch to some blog post content file and modify it to trigger page build with
the modified template (e.g. hit space and save).</p>
<h3 dir="auto"><a id="user-content-hot-rebuild-indices-and-feeds" aria-hidden="true" href="#hot-rebuild-indices-and-feeds"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>hot rebuild indices and feeds</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adityaathalye/shite/blob/master/demo/shite-demo-05-hotreload-rebuild-indices-feeds-5fps-1024px.gif"><img src="https://github.com/adityaathalye/shite/raw/master/demo/shite-demo-05-hotreload-rebuild-indices-feeds-5fps-1024px.gif" alt="hot rebuild indices and feeds" title="hot rebuild indices and feeds" data-animated-image=""/></a></p>
<p dir="auto">This is a hack. The root index.org page under sources is special. If I modify it,
then it means I want to rebuild posts lists for the index page, for tags, and
also rebuild related meta-files like the RSS feed, sitemap, robots.txt etc.</p>
<h2 dir="auto"><a id="user-content-full-site-builds" aria-hidden="true" href="#full-site-builds"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Full site builds</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adityaathalye/shite/blob/master/demo/shite-demo-06-dont-hotreload-full-site-rebuild-5fps-1024px.gif"><img src="https://github.com/adityaathalye/shite/raw/master/demo/shite-demo-06-dont-hotreload-full-site-rebuild-5fps-1024px.gif" alt="full site build" title="full site build" data-animated-image=""/></a></p>
<p dir="auto">In a clean new terminal session call <code>shite.sh</code> with &#34;no&#34;, and optionally
with the <code>base_url</code> of the deployment environment:</p>
<p dir="auto">Rebuild full site for &#34;local&#34; file:/// navigation. Truly &#34;serverless&#34; :)</p>

<p dir="auto">Rebuild full site for publication under my domain.</p>
<div dir="auto" data-snippet-clipboard-copy-content="./shite.sh &#34;no&#34; &#34;https://evalapply.org&#34;"><pre>./shite.sh <span><span>&#34;</span>no<span>&#34;</span></span> <span><span>&#34;</span>https://evalapply.org<span>&#34;</span></span></pre></div>
<h2 dir="auto"><a id="user-content-environment-variables-and-debug-flags" aria-hidden="true" href="#environment-variables-and-debug-flags"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Environment Variables and Debug flags</h2>
<p dir="auto">These flags alter the behaviour of the system.</p>
<ul dir="auto">
<li>Setting <code>SHITE_HOTRELOAD</code> to &#34;yes&#34; will run the event system in &#34;monitor&#34; mode,
which in turn drives hotreload behaviour. Setting it to &#34;no&#34; will suppress
browser hotreload.</li>
<li>Setting <code>SHITE_DEBUG_TEMPLATES</code> to &#34;debug&#34; will cause templates to be sourced
first, before publishing any templated source content.</li>
</ul>

<p dir="auto"><code>shite</code> is quite Unixy inside. Or so I&#39;d like to think.</p>
<p dir="auto">Code is functional programming-style Bash. Everything is a function. Most
functions are pure functions---little Unix tools in themselves. Most logic
is pipeline-oriented. This works surprisingly well, because
<a href="https://www.evalapply.org/posts/shell-aint-a-bad-place-to-fp-part-1-doug-mcilroys-pipeline/" rel="nofollow">Shell ain&#39;t a bad place to FP</a>.</p>
<p dir="auto">I also wanted a live interactive REPL-like experience when writing with <code>shite</code>,
because I like working in live/interactive runtimes like Clojure and Emacs.</p>
<p dir="auto">So, <code>shite</code> has become this fully reactive event-driven system capable of hot
build-and-reload-on-save.</p>
<h2 dir="auto"><a id="user-content-file-and-url-naming-scheme" aria-hidden="true" href="#file-and-url-naming-scheme"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>File and URL naming scheme</h2>
<p dir="auto">There are three main directory namespaces:</p>
<ul dir="auto">
<li><code>sources</code> housing the &#34;source&#34; content, such as blog posts written in orgmode,
as well as CSS, Javascript, and other static assets.</li>
<li><code>public</code> target for the compiled / built artefacts</li>
<li><code>bin</code> for the shite-building code</li>
</ul>
<p dir="auto">The URL naming scheme follows sub-directory structure under <code>sources</code>, and is
replicated as-is under the <code>pubilic</code> directory structure. Since this is a bog
standard URL namespacing scheme, it also, applies directly to published content.
Like so:</p>
<div data-snippet-clipboard-copy-content="file:///absolute/path/to/shite/posts/slug/index.html

http://localhost:8080/posts/slug/index.html

https://your-domain-name.com/posts/slug/index.html"><pre lang="text"><code>file:///absolute/path/to/shite/posts/slug/index.html

http://localhost:8080/posts/slug/index.html

https://your-domain-name.com/posts/slug/index.html
</code></pre></div>
<h2 dir="auto"><a id="user-content-code-organisation" aria-hidden="true" href="#code-organisation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Code organisation</h2>
<p dir="auto">All &#34;public&#34; functions are namespaced as <code>shite_the_func_name</code>. All &#34;private&#34;
functions are namespaced as <code>__shite_the_func_name</code>.</p>
<p dir="auto">Functions exist to:</p>
<ul dir="auto">
<li>define common page fragments (meta, header, footer etc.)</li>
<li>compose full pages from components, metadata, and body content</li>
<li>assemble the site... build and publish sources into public targets</li>
<li>detect and process event streams to drive various site building features
site builds, and browser hot reloading</li>
<li>react to processed events and drive hot compile of pages, hot build of site,
and browser hot reload / navigation</li>
<li>provide convenience utilities for manual builds, local development</li>
</ul>
<h2 dir="auto"><a id="user-content-calling-the-code" aria-hidden="true" href="#calling-the-code"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Calling the code</h2>
<p dir="auto">In a clean new terminal session:</p>
<ul dir="auto">
<li>CD to the root of this project</li>
<li>Source the dev utility code into the environment. This will bring in all the
business logic, templates, as well as dev utility functions.
<div dir="auto" data-snippet-clipboard-copy-content="source ./bin/utils_dev.sh"><pre><span>source</span> ./bin/utils_dev.sh</pre></div>
</li>
<li>Hit <code>shitTABTAB</code> or <code>__shiTABTAB</code> at the command line for autocompletions.</li>
<li>Enter <code>type -a func_name</code> to print the function&#39;s definition and read its API.</li>
<li>Set <code>shite_global_data</code> and <code>shite_page_data</code> as needed.</li>
<li>Call functions at the command line. Call them individually, and/or composed
with other functions to test / exercise parts of the system.</li>
</ul>
<h2 dir="auto"><a id="user-content-templating-system" aria-hidden="true" href="#templating-system"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Templating system</h2>
<p dir="auto">Templates exist for page fragments (like header, footer, navigation), and for
full page definitions (like the default page template). These are written as
plain HTML wrapped in heredocs. <code>./bin/templates.sh</code> provides these.</p>
<p dir="auto">Templates are filled-in with variable data from different sources:</p>
<ul dir="auto">
<li>Bash associative arrays: <code>shite_global_data</code> contains site-wide metadata,
and <code>shite_page_data</code> contains page-specific metadata. Some outside process
must pre-set these arrays prior to processing any page.</li>
<li>stdin: to inject content into the templates that are wrappers for content.</li>
<li>function calls: to expand fragments like HTML metadata, links etc.</li>
</ul>
<p dir="auto">For example, a full page may be constructed as follows:</p>
<div dir="auto" data-snippet-clipboard-copy-content="cat ./sample/hello.md |
    pandoc -f markdown -t html |
    cat &lt;&lt;EOF
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
        &lt;head&gt;
            $(shite_template_common_meta)
            $(shite_template_common_links)
            ${shite_page_data[canonical_url]}
        &lt;/head&gt;
        &lt;body ${shite_page_data[page_id]}&gt;
            $(shite_template_common_header)
            &lt;main&gt;
              $(cat -)
            &lt;/main&gt;
            $(shite_template_common_footer)
        &lt;/body&gt;
    &lt;/html&gt;
EOF"><pre>cat ./sample/hello.md <span>|</span>
    pandoc -f markdown -t html <span>|</span>
    cat <span><span>&lt;&lt;</span><span>EOF</span></span>
<span>    &lt;!DOCTYPE html&gt;</span>
<span>    &lt;html&gt;</span>
<span>        &lt;head&gt;</span>
<span>            <span><span>$(</span>shite_template_common_meta<span>)</span></span></span>
<span>            <span><span>$(</span>shite_template_common_links<span>)</span></span></span>
<span>            <span>${shite_page_data[canonical_url]}</span></span>
<span>        &lt;/head&gt;</span>
<span>        &lt;body <span>${shite_page_data[page_id]}</span>&gt;</span>
<span>            <span><span>$(</span>shite_template_common_header<span>)</span></span></span>
<span>            &lt;main&gt;</span>
<span>              <span><span>$(</span>cat -<span>)</span></span></span>
<span>            &lt;/main&gt;</span>
<span>            <span><span>$(</span>shite_template_common_footer<span>)</span></span></span>
<span>        &lt;/body&gt;</span>
<span>    &lt;/html&gt;</span>
<span><span>EOF</span></span></pre></div>
<h2 dir="auto"><a id="user-content-metadata-and-front-matter-system" aria-hidden="true" href="#metadata-and-front-matter-system"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Metadata and front matter system</h2>
<p dir="auto"><code>shite</code>&#39;s metadata system is defined as key-value pairs. Keys name the metadata
items, and would be associated with whatever value of that type. Examples below.</p>
<p dir="auto">As noted earlier, run-time metadata is carried in the environment by the
associative arrays <code>shite_global_data</code> and <code>shite_page_data</code>. These maybe be
populated by direct construction, as well as updated from external sources.</p>
<p dir="auto">Each page may specify its own metadata in &#34;front matter&#34; at the top of the page.
This will be used in addition page metadata derived from other sources.</p>
<p dir="auto"><code>shite</code> expects us to write front matter using syntax that is compatible with
the given content type, as follows.</p>
<h3 dir="auto"><a id="user-content-for-orgmode-content" aria-hidden="true" href="#for-orgmode-content"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>For orgmode content</h3>
<p dir="auto">Use comment lines <code># SHITE_META</code> to demarcate the org-style metadata that <code>shite</code>
should also parse as page-specific metadata.</p>
<div data-snippet-clipboard-copy-content="# SHITE_META
#+title: This is a Title
#+slug: this/is/a/slug
#+date: Friday 26 August 2022 03:38:01 PM IST
#+tags: foo bar baz quxx
# SHITE_META
#+more_org_metadata: but not processed as shite metadata
#+still_more_org_metadata: and still not processed as shite metadata

* this is a top level heading

this is some orgmode content

#+TOC: headlines 1 local

** this is a sub heading
   - this is a point
   - this is another point
   - a third point"><pre lang="org"><code># SHITE_META
#+title: This is a Title
#+slug: this/is/a/slug
#+date: Friday 26 August 2022 03:38:01 PM IST
#+tags: foo bar baz quxx
# SHITE_META
#+more_org_metadata: but not processed as shite metadata
#+still_more_org_metadata: and still not processed as shite metadata

* this is a top level heading

this is some orgmode content

#+TOC: headlines 1 local

** this is a sub heading
   - this is a point
   - this is another point
   - a third point
</code></pre></div>
<h3 dir="auto"><a id="user-content-for-markdown-content" aria-hidden="true" href="#for-markdown-content"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>For markdown content</h3>
<p dir="auto">Write Jekyll-style YAML front matter, boxed between <code>---</code> separators.</p>
<div dir="auto" data-snippet-clipboard-copy-content="---
TITLE: This is a Title
slug: this/is/a/slug
DATE: Friday 26 August 2022 03:38:01 PM IST
TAGS: foo BAR baz QUXX
---

# this is a heading

this is some markdown content

## this is a subheading
  - this is a point
  - this is another point
  - a third point"><pre><span>---</span>
<span>TITLE</span>: <span>This is a Title</span>
<span>slug</span>: <span>this/is/a/slug</span>
<span>DATE</span>: <span>Friday 26 August 2022 03:38:01 PM IST</span>
<span>TAGS</span>: <span>foo BAR baz QUXX</span>
<span>---</span>

<span><span>#</span><span> </span>this is a heading</span>

this is some markdown content

<span><span>##</span><span> </span>this is a subheading</span>
  <span>-</span> this is a point
  <span>-</span> this is another point
  <span>-</span> a third point</pre></div>
<h3 dir="auto"><a id="user-content-for-html-content" aria-hidden="true" href="#for-html-content"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>For html content</h3>
<p dir="auto">We can simply use standard <code>&lt;meta&gt;</code> tags, that obey this convention:
<code>&lt;meta name=&#34;KEY&#34; content=&#34;value&#34;&gt;</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="&lt;meta name=&#34;TITLE&#34; content=&#34;This is a Title&#34;&gt;
&lt;meta name=&#34;slug&#34; content=&#34;this/is/a/slug&#34;&gt;
&lt;meta name=&#34;DATE&#34; content=&#34;Friday 26 August 2022 03:38:01 PM IST&#34;&gt;
&lt;meta name=&#34;TAGS&#34; content=&#34;foo BAR baz QUXX&#34;&gt;

&lt;h1&gt;This is a heading&lt;/h1&gt;
&lt;p&gt;This is some text&lt;/p&gt;
&lt;h2&gt;This is a subheading&lt;/h2&gt;
&lt;p&gt;
  &lt;ul&gt;
    &lt;li&gt;This is a point&lt;/li&gt;
    &lt;li&gt;This is another point.&lt;/li&gt;
    &lt;li&gt;This is a third point.&lt;/li&gt;
  &lt;/ul&gt;
&lt;/p&gt;"><pre><span>&lt;</span><span>meta</span> <span>name</span>=&#34;<span>TITLE</span>&#34; <span>content</span>=&#34;<span>This is a Title</span>&#34;<span>&gt;</span>
<span>&lt;</span><span>meta</span> <span>name</span>=&#34;<span>slug</span>&#34; <span>content</span>=&#34;<span>this/is/a/slug</span>&#34;<span>&gt;</span>
<span>&lt;</span><span>meta</span> <span>name</span>=&#34;<span>DATE</span>&#34; <span>content</span>=&#34;<span>Friday 26 August 2022 03:38:01 PM IST</span>&#34;<span>&gt;</span>
<span>&lt;</span><span>meta</span> <span>name</span>=&#34;<span>TAGS</span>&#34; <span>content</span>=&#34;<span>foo BAR baz QUXX</span>&#34;<span>&gt;</span>

<span>&lt;</span><span>h1</span><span>&gt;</span>This is a heading<span>&lt;/</span><span>h1</span><span>&gt;</span>
<span>&lt;</span><span>p</span><span>&gt;</span>This is some text<span>&lt;/</span><span>p</span><span>&gt;</span>
<span>&lt;</span><span>h2</span><span>&gt;</span>This is a subheading<span>&lt;/</span><span>h2</span><span>&gt;</span>
<span>&lt;</span><span>p</span><span>&gt;</span>
  <span>&lt;</span><span>ul</span><span>&gt;</span>
    <span>&lt;</span><span>li</span><span>&gt;</span>This is a point<span>&lt;/</span><span>li</span><span>&gt;</span>
    <span>&lt;</span><span>li</span><span>&gt;</span>This is another point.<span>&lt;/</span><span>li</span><span>&gt;</span>
    <span>&lt;</span><span>li</span><span>&gt;</span>This is a third point.<span>&lt;/</span><span>li</span><span>&gt;</span>
  <span>&lt;/</span><span>ul</span><span>&gt;</span>
<span>&lt;/</span><span>p</span><span>&gt;</span></pre></div>
<h2 dir="auto"><a id="user-content-bashful-hot-reloading-sans-javascript" aria-hidden="true" href="#bashful-hot-reloading-sans-javascript"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Bashful Hot Reloading Sans Javascript</h2>
<p dir="auto">Here be Yaks!</p>
<p dir="auto">Being entirely spoiled by Clojure/Lisp/Spreadsheet style insta-gratifying live
interactive workflows, I want hot reload and hot navigate in shite-making too.</p>
<p dir="auto">But there does not seem to exist a standalone live web development server / tool
that does not also want me to download half the known Internet as dependencies.
As I said before, a thing I <em>extremely</em> do <em>not</em> want to do.</p>
<p dir="auto">DuckSearch delivered Emacs impatient-mode, which is quite hot, but I don&#39;t want
to hardwire this my Emacs. Luckily, it also delivered this exciting brainwave
featuring &#39;inotify-tools&#39; and &#39;xdotool&#39;:
<a href="https://github.com/traviscross/inotify-refresh">github.com/traviscross/inotify-refresh</a></p>
<p dir="auto">Hot copy!</p>
<p dir="auto">Because what could be hotter than my computer slammin&#39; that F5 key <em>for</em> me? As
if it <em>knew</em> what I really wanted deep down in my heart.</p>
<h3 dir="auto"><a id="user-content-the-event-system" aria-hidden="true" href="#the-event-system"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>The event system</h3>
<p dir="auto">The event subsystem is orthogonal to everything else, and composes with the rest
of the system.</p>
<p dir="auto">The design is bog standard streaming architecture, viz. watch for file system
events, then filter, deduplicate, analyse, and route them (tee) to different
event processors. Currently there are just two such processors; one to compile
and publish the page or asset associated with the event, another to hot reload
the browser (or hot navigate) depending on the same event.</p>
<p dir="auto">Baaasically this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# detect file events
__shite_detect_changes ${watch_dir} &#39;create,modify,close_write,moved_to,delete&#39; |
    __shite_events_gen_csv ${watch_dir} |
    # hot-compile-and-publish content, HTML, static, etc.
    tee &gt;(shite_templating_publish_sources &gt; /dev/null) |
    # browser hot-reload
    tee &gt;(__shite_hot_cmd_public_events ${window_id} ${base_url} |
              __shite_hot_cmd_exec)"><pre><span><span>#</span> detect file events</span>
__shite_detect_changes <span>${watch_dir}</span> <span><span>&#39;</span>create,modify,close_write,moved_to,delete<span>&#39;</span></span> <span>|</span>
    __shite_events_gen_csv <span>${watch_dir}</span> <span>|</span>
    <span><span>#</span> hot-compile-and-publish content, HTML, static, etc.</span>
    tee <span><span>&gt;(</span>shite_templating_publish_sources <span>&gt;</span> /dev/null<span>)</span></span> <span>|</span>
    <span><span>#</span> browser hot-reload</span>
    tee <span><span>&gt;(</span>__shite_hot_cmd_public_events <span>${window_id}</span> <span>${base_url}</span> <span>|</span></span>
<span>              __shite_hot_cmd_exec<span>)</span></span></pre></div>
<p dir="auto">Events are simply a stream of CSV records structured like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="unix_epoch_seconds,event_type,base_dir,sub_dir,url_slug,file_type,content_type`"><pre>unix_epoch_seconds,event_type,base_dir,sub_dir,url_slug,file_type,content_type<span><span>`</span></span></pre></div>
<p dir="auto">We use different parts of the event record to cause different kinds of actions.</p>
<h3 dir="auto"><a id="user-content-liveness-criterion" aria-hidden="true" href="#liveness-criterion"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Liveness criterion</h3>
<p dir="auto">The afore-linked inotify-refresh script tries to <em>periodically</em> refresh a set of
browser windows. We, however, want to be <em>very</em> eager. Any edit action on our
content files and/or static assets must insta-trigger hot reload/navigate actions
in the browser tab that&#39;s displaying our shite.</p>
<h3 dir="auto"><a id="user-content-hot-reload-scenarios" aria-hidden="true" href="#hot-reload-scenarios"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hot reload scenarios</h3>
<p dir="auto">We want to define distinct reload scenarios: Mutually exclusive, collectively
exhaustive buckets into which we can map file events we want to monitor.</p>
<p dir="auto">If we do this, then we can model updates as a sort of write-ahead-log, punching
events through an analysis pipeline, associate them with the exact-match scenario,
and then finally cause the action. For example:</p>
<p dir="auto">Refresh current tab when</p>
<ul dir="auto">
<li>static asset create, modify, move, delete</li>
</ul>
<p dir="auto">Go home when</p>
<ul dir="auto">
<li>current page deleted</li>
</ul>
<p dir="auto">Navigate to content when</p>
<ul dir="auto">
<li>current page content modified</li>
<li>any content page moved or created or modified</li>
</ul>
<h3 dir="auto"><a id="user-content-hot-reload-behaviour" aria-hidden="true" href="#hot-reload-behaviour"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hot reload behaviour</h3>
<p dir="auto">Since we are making the computer emulate our own keyboard actions, it can mess
with our personly actions. If we stick to writing our shite in our text editor,
and let the computer do the hotreloady thing, we should remain non-annoyed.</p>
<h2 dir="auto"><a id="user-content-unrealised-ambitions" aria-hidden="true" href="#unrealised-ambitions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Unrealised Ambitions</h2>
<p dir="auto">There are many Yaks in the world.</p>
<h3 dir="auto"><a id="user-content-from-any-source-dir-to-any-publish-dir-from-anywhere-on-my-box" aria-hidden="true" href="#from-any-source-dir-to-any-publish-dir-from-anywhere-on-my-box"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>From any source dir to any publish dir from anywhere on my box</h3>
<p dir="auto">For truly pervasive multi-site publishing mojo:</p>
<ul dir="auto">
<li><code>shite</code> should be available on my PATH</li>
<li>I should be able to configure any source / public pair per site</li>
<li>Everything else should &#34;just work&#34; as it does</li>
</ul>
<p dir="auto">This is a small yak. I&#39;ll probably yakshave it soon.</p>
<h3 dir="auto"><a id="user-content-hot-deployment" aria-hidden="true" href="#hot-deployment"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hot deployment</h3>
<p dir="auto">Obviously one can use the CI jobs of popular git hosts to trigger <code>shite</code> builds.
But why use clunky current-century tech, when we have already advanced to the
state of the art of the late 1900s... fully streaming and fully reactive?</p>
<p dir="auto">Sarcasam aside, I don&#39;t see why the same event system cannot be used to add
hot-deploy support, on a remote machine I run.</p>
<p dir="auto">On the remote box:</p>
<ul dir="auto">
<li>a web server serves the public pages of the site</li>
<li>a clone of the site <code>sources</code> is enshrined</li>
<li>the selfsame hotreload process is live against <code>sources</code>
(minus the browser-watching).</li>
<li>a git checkout auto-triggers on receiving a git push</li>
<li>which should cause hot-build against the modified sources (with some special
case to trigger full build if a template changes)</li>
</ul>
<p dir="auto">On my local box:</p>
<ul dir="auto">
<li>edit, preview locally with local hotreloadin&#39;</li>
<li>git commit, push sources to remote</li>
<li>hit F5 on the appropriate public URL <code>https://mydomain.com/posts/hello/index.html</code></li>
<li>the hot-build should have completed in the time it takes to get to F5</li>
</ul>
<h3 dir="auto"><a id="user-content-hot-deployment-with-local-hot-reload" aria-hidden="true" href="#hot-deployment-with-local-hot-reload"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Hot deployment with local hot reload</h3>
<p dir="auto">Do something over SSH to bring browser refresh back to local box, in case of hot
deploys to remote server.</p>
<ul dir="auto">
<li>maybe Shell &#34;Session Portability&#34;?
<a href="https://www.youtube.com/watch?v=uqHjc7hlqd0&amp;t=2436s" title="Video: Shell Session Portability over SSH" rel="nofollow">video</a>,
<a href="http://talk.jpnc.info/bash_oscon_2014.pdf" title="Slides: Shell Session Portability over SSH" rel="nofollow">slides</a>.</li>
<li>maybe tap the browser hotreload commands and stream only those back to my box,
with a &#34;server-mode&#34; for hot-publish at the remote box and a &#34;client-mode&#34; for
hot-reload on my local box?</li>
<li>maybe I&#39;ll find out it all &#34;just work&#34; with Emacs/TRAMP?</li>
</ul>
<h3 dir="auto"><a id="user-content-more-creature-comforts" aria-hidden="true" href="#more-creature-comforts"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>More creature comforts</h3>
<p dir="auto">Maybe some &#34;Dev-ing/Drafting&#34; time setup/Teardown scenario? Maybe a &#39;dev_server&#39;
function that we use to kick start a new shite writing session?</p>
<ul dir="auto">
<li>xdg-open a new tab in the default browser (say, firefox), and goto the home
page of the shite based on config.</li>
<li>xdotool &#39;set_window --name&#39; to a UUID for the life of the session.</li>
<li>Close the tab when we kill the dev session.</li>
</ul>

<p dir="auto">If you got all the way down here, and <em>still</em> want to contribute...</p>
<p dir="auto">Why?</p>
<p dir="auto">Why in the name of all that is holy and good, would you want to? Is it not
blindingly obvious that this is the work of a goofball? Haven&#39;t you heard that
Bash is Not Even A Real Programming Language? And isn&#39;t it face-slappingly
obvious that your PRs will languish eternally, and your comments will fall into
a nameless void?</p>
<p dir="auto">Yes, sending patches is a terrible idea.</p>
<p dir="auto"><em>But</em> please email me your hopes and dreams about your shite maker! I read email
at my firstname dot lastname at gmail.</p>
<p dir="auto">Together we can whistle silly tunes, and co-yak-shave our respective yaks, in
our own special ways.</p>
<p dir="auto">May The Source be with us.</p>

<p dir="auto">This work is dual-licensed under the MIT license and the CC By-SA 4.0 license.</p>
<ul dir="auto">
<li>The Bash source code for making shite is licensed under the MIT license.</li>
<li>My website&#39;s content which I&#39;ve included in this project, for demo purposes,
commit is licensed under the Creative Commons Attribution-ShareAlike 4.0
International License (CC By-SA 4.0).</li>
</ul>
<p dir="auto">SPDX-License-Identifier: mit OR cc-by-sa-4.0</p>
</article>
          </div></div>
  </body>
</html>
