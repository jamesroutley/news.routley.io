<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://docs.python.org/3/whatsnew/3.12.html">Original</a>
    <h1>What&#39;s New in Python 3.12</h1>
    
    <div id="readability-page-1" class="page"><div>
        <div>
          <div role="main">
            
  <section id="what-s-new-in-python-3-12">

<dl>
<dt>Editor</dt>
<dd><p>Adam Turner</p>
</dd>
</dl>
<p>This article explains the new features in Python 3.12, compared to 3.11.
Python 3.12 was released on October 2, 2023.
For full details, see the <a href="https://www.wildlondon.org.uk/blog/chris-farthing/changelog.html#changelog"><span>changelog</span></a>.</p>
<div>
<p>See also</p>
<p><span id="index-0"></span><a href="https://peps.python.org/pep-0693/"><strong>PEP 693</strong></a> – Python 3.12 Release Schedule</p>
</div>
<section id="summary-release-highlights">
<h2>Summary – Release highlights<a href="#summary-release-highlights" title="Permalink to this headline">¶</a></h2>
<p>Python 3.12 is the latest stable release of the Python programming language,
with a mix of changes to the language and the standard library.
The library changes focus on cleaning up deprecated APIs, usability, and correctness.
Of note, the <code><span>distutils</span></code> package has been removed from the standard library.
Filesystem support in <a href="https://www.wildlondon.org.uk/blog/library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code><span>os</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#module-pathlib" title="pathlib: Object-oriented filesystem paths"><code><span>pathlib</span></code></a> has seen a number of improvements,
and several modules have better performance.</p>
<p>The language changes focus on usability,
as <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-f-string"><span>f-strings</span></a> have had many limitations removed
and ‘Did you mean …’ suggestions continue to improve.
The new <a href="#whatsnew312-pep695"><span>type parameter syntax</span></a>
and <a href="https://www.wildlondon.org.uk/blog/reference/simple_stmts.html#type"><code><span>type</span></code></a> statement improve ergonomics for using <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-generic-type"><span>generic types</span></a> and <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-type-alias"><span>type aliases</span></a> with static type checkers.</p>
<p>This article doesn’t attempt to provide a complete specification of all new features,
but instead gives a convenient overview.
For full details, you should refer to the documentation,
such as the  <a href="https://www.wildlondon.org.uk/blog/library/index.html#library-index"><span>Library Reference</span></a>
and <a href="https://www.wildlondon.org.uk/blog/reference/index.html#reference-index"><span>Language Reference</span></a>.
If you want to understand the complete implementation and design rationale for a change,
refer to the PEP for a particular new feature;
but note that PEPs usually are not kept up-to-date
once a feature has been fully implemented.</p>
<hr/>
<p>New syntax features:</p>
<ul>
<li><p><a href="#whatsnew312-pep695"><span>PEP 695</span></a>, type parameter syntax and the <a href="https://www.wildlondon.org.uk/blog/reference/simple_stmts.html#type"><code><span>type</span></code></a> statement</p></li>
</ul>
<p>New grammar features:</p>
<ul>
<li><p><a href="#whatsnew312-pep701"><span>PEP 701</span></a>, <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-f-string"><span>f-strings</span></a> in the grammar</p></li>
</ul>
<p>Interpreter improvements:</p>
<ul>
<li><p><a href="#whatsnew312-pep684"><span>PEP 684</span></a>, a unique per-interpreter <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-global-interpreter-lock"><span>GIL</span></a></p></li>
<li><p><a href="#whatsnew312-pep669"><span>PEP 669</span></a>, low impact monitoring</p></li>
<li><p><a href="#improved-error-messages">Improved ‘Did you mean …’ suggestions</a>
for <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#NameError" title="NameError"><code><span>NameError</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#ImportError" title="ImportError"><code><span>ImportError</span></code></a>, and <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a> exceptions</p></li>
</ul>
<p>Python data model improvements:</p>
<ul>
<li><p><a href="#whatsnew312-pep688"><span>PEP 688</span></a>, using the <a href="https://www.wildlondon.org.uk/blog/c-api/buffer.html#bufferobjects"><span>buffer protocol</span></a> from Python</p></li>
</ul>
<p>Significant improvements in the standard library:</p>
<ul>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.Path" title="pathlib.Path"><code><span>pathlib.Path</span></code></a> class now supports subclassing</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code><span>os</span></code></a> module received several improvements for Windows support</p></li>
<li><p>A <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3-cli"><span>command-line interface</span></a> has been added to the
<a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code><span>sqlite3</span></code></a> module</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/functions.html#isinstance" title="isinstance"><code><span>isinstance()</span></code></a> checks against <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.runtime_checkable" title="typing.runtime_checkable"><code><span>runtime-checkable</span> <span>protocols</span></code></a> enjoy a speed up of between two and 20 times</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a> package has had a number of performance improvements,
with some benchmarks showing a 75% speed up.</p></li>
<li><p>A <a href="https://www.wildlondon.org.uk/blog/library/uuid.html#uuid-cli"><span>command-line interface</span></a> has been added to the
<a href="https://www.wildlondon.org.uk/blog/library/uuid.html#module-uuid" title="uuid: UUID objects (universally unique identifiers) according to RFC 4122"><code><span>uuid</span></code></a> module</p></li>
<li><p>Due to the changes in <a href="#whatsnew312-pep701"><span>PEP 701</span></a>,
producing tokens via the <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code><span>tokenize</span></code></a> module is up to 64% faster.</p></li>
</ul>
<p>Security improvements:</p>
<ul>
<li><p>Replace the builtin <a href="https://www.wildlondon.org.uk/blog/library/hashlib.html#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code><span>hashlib</span></code></a> implementations of
SHA1, SHA3, SHA2-384, SHA2-512, and MD5 with formally verified code from the
<a href="https://github.com/hacl-star/hacl-star/">HACL*</a> project.
These builtin implementations remain as fallbacks that are only used when
OpenSSL does not provide them.</p></li>
</ul>
<p>C API improvements:</p>
<ul>
<li><p><a href="#whatsnew312-pep697"><span>PEP 697</span></a>, unstable C API tier</p></li>
<li><p><a href="#whatsnew312-pep683"><span>PEP 683</span></a>, immortal objects</p></li>
</ul>
<p>CPython implementation improvements:</p>
<ul>
<li><p><a href="#whatsnew312-pep709"><span>PEP 709</span></a>, comprehension inlining</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/howto/perf_profiling.html#perf-profiling"><span>CPython support</span></a> for the Linux <code><span>perf</span></code> profiler</p></li>
<li><p>Implement stack overflow protection on supported platforms</p></li>
</ul>
<p>New typing features:</p>
<ul>
<li><p><a href="#whatsnew312-pep692"><span>PEP 692</span></a>, using <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.TypedDict" title="typing.TypedDict"><code><span>TypedDict</span></code></a> to
annotate <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-argument"><span>**kwargs</span></a></p></li>
<li><p><a href="#whatsnew312-pep698"><span>PEP 698</span></a>, <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.override" title="typing.override"><code><span>typing.override()</span></code></a> decorator</p></li>
</ul>
<p>Important deprecations, removals or restrictions:</p>
<ul>
<li><p><span id="index-1"></span><a href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a>: Remove <code><span>wstr</span></code> from Unicode objects in Python’s C API,
reducing the size of every <a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#str" title="str"><code><span>str</span></code></a> object by at least 8 bytes.</p></li>
<li><p><span id="index-2"></span><a href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a>: Remove the <code><span>distutils</span></code> package.
See <a href="https://peps.python.org/pep-0632/#migration-advice">the migration guide</a>
for advice replacing the APIs it provided.
The third-party <a href="https://setuptools.pypa.io/en/latest/deprecated/distutils-legacy.html">Setuptools</a>
package continues to provide <code><span>distutils</span></code>,
if you still require it in Python 3.12 and beyond.</p></li>
<li><p><a href="https://github.com/python/cpython/issues/95299">gh-95299</a>: Do not pre-install <code><span>setuptools</span></code> in virtual environments
created with <a href="https://www.wildlondon.org.uk/blog/library/venv.html#module-venv" title="venv: Creation of virtual environments."><code><span>venv</span></code></a>.
This means that <code><span>distutils</span></code>, <code><span>setuptools</span></code>, <code><span>pkg_resources</span></code>,
and <code><span>easy_install</span></code> will no longer available by default; to access these
run <code><span>pip</span> <span>install</span> <span>setuptools</span></code> in the <a href="https://www.wildlondon.org.uk/blog/library/venv.html#venv-explanation"><span>activated</span></a>
virtual environment.</p></li>
<li><p>The <code><span>asynchat</span></code>, <code><span>asyncore</span></code>, and <code><span>imp</span></code> modules have been
removed, along with several <a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase" title="unittest.TestCase"><code><span>unittest.TestCase</span></code></a>
<a href="#unittest-testcase-removed-aliases">method aliases</a>.</p></li>
</ul>
</section>
<section id="new-features">
<h2>New Features<a href="#new-features" title="Permalink to this headline">¶</a></h2>
<section id="pep-695-type-parameter-syntax">
<span id="whatsnew312-pep695"></span><h3>PEP 695: Type Parameter Syntax<a href="#pep-695-type-parameter-syntax" title="Permalink to this headline">¶</a></h3>
<p>Generic classes and functions under <span id="index-3"></span><a href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> were declared using a verbose syntax
that left the scope of type parameters unclear and required explicit declarations of
variance.</p>
<p><span id="index-4"></span><a href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a> introduces a new, more compact and explicit way to create
<a href="https://www.wildlondon.org.uk/blog/reference/compound_stmts.html#generic-classes"><span>generic classes</span></a> and <a href="https://www.wildlondon.org.uk/blog/reference/compound_stmts.html#generic-functions"><span>functions</span></a>:</p>
<div><div><pre><span></span><span>def</span> <span>max</span><span>[</span><span>T</span><span>](</span><span>args</span><span>:</span> <span>Iterable</span><span>[</span><span>T</span><span>])</span> <span>-&gt;</span> <span>T</span><span>:</span>
    <span>...</span>

<span>class</span> <span>list</span><span>[</span><span>T</span><span>]:</span>
    <span>def</span> <span>__getitem__</span><span>(</span><span>self</span><span>,</span> <span>index</span><span>:</span> <span>int</span><span>,</span> <span>/</span><span>)</span> <span>-&gt;</span> <span>T</span><span>:</span>
        <span>...</span>

    <span>def</span> <span>append</span><span>(</span><span>self</span><span>,</span> <span>element</span><span>:</span> <span>T</span><span>)</span> <span>-&gt;</span> <span>None</span><span>:</span>
        <span>...</span>
</pre></div>
</div>
<p>In addition, the PEP introduces a new way to declare <a href="https://www.wildlondon.org.uk/blog/library/typing.html#type-aliases"><span>type aliases</span></a>
using the <a href="https://www.wildlondon.org.uk/blog/reference/simple_stmts.html#type"><code><span>type</span></code></a> statement, which creates an instance of
<a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.TypeAliasType" title="typing.TypeAliasType"><code><span>TypeAliasType</span></code></a>:</p>
<div><div><pre><span></span><span>type</span> <span>Point</span> <span>=</span> <span>tuple</span><span>[</span><span>float</span><span>,</span> <span>float</span><span>]</span>
</pre></div>
</div>
<p>Type aliases can also be <a href="https://www.wildlondon.org.uk/blog/reference/compound_stmts.html#generic-type-aliases"><span>generic</span></a>:</p>
<div><div><pre><span></span><span>type</span> <span>Point</span><span>[</span><span>T</span><span>]</span> <span>=</span> <span>tuple</span><span>[</span><span>T</span><span>,</span> <span>T</span><span>]</span>
</pre></div>
</div>
<p>The new syntax allows declaring <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.TypeVarTuple" title="typing.TypeVarTuple"><code><span>TypeVarTuple</span></code></a>
and <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.ParamSpec" title="typing.ParamSpec"><code><span>ParamSpec</span></code></a> parameters, as well as <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.TypeVar" title="typing.TypeVar"><code><span>TypeVar</span></code></a>
parameters with bounds or constraints:</p>
<div><div><pre><span></span><span>type</span> <span>IntFunc</span><span>[</span><span>**</span><span>P</span><span>]</span> <span>=</span> <span>Callable</span><span>[</span><span>P</span><span>,</span> <span>int</span><span>]</span>  <span># ParamSpec</span>
<span>type</span> <span>LabeledTuple</span><span>[</span><span>*</span><span>Ts</span><span>]</span> <span>=</span> <span>tuple</span><span>[</span><span>str</span><span>,</span> <span>*</span><span>Ts</span><span>]</span>  <span># TypeVarTuple</span>
<span>type</span> <span>HashableSequence</span><span>[</span><span>T</span><span>:</span> <span>Hashable</span><span>]</span> <span>=</span> <span>Sequence</span><span>[</span><span>T</span><span>]</span>  <span># TypeVar with bound</span>
<span>type</span> <span>IntOrStrSequence</span><span>[</span><span>T</span><span>:</span> <span>(</span><span>int</span><span>,</span> <span>str</span><span>)]</span> <span>=</span> <span>Sequence</span><span>[</span><span>T</span><span>]</span>  <span># TypeVar with constraints</span>
</pre></div>
</div>
<p>The value of type aliases and the bound and constraints of type variables
created through this syntax are evaluated only on demand (see
<a href="https://www.wildlondon.org.uk/blog/reference/executionmodel.html#lazy-evaluation"><span>lazy evaluation</span></a>). This means type aliases are able to
refer to other types defined later in the file.</p>
<p>Type parameters declared through a type parameter list are visible within the
scope of the declaration and any nested scopes, but not in the outer scope. For
example, they can be used in the type annotations for the methods of a generic
class or in the class body. However, they cannot be used in the module scope after
the class is defined. See <a href="https://www.wildlondon.org.uk/blog/reference/compound_stmts.html#type-params"><span>Type parameter lists</span></a> for a detailed description of the
runtime semantics of type parameters.</p>
<p>In order to support these scoping semantics, a new kind of scope is introduced,
the <a href="https://www.wildlondon.org.uk/blog/reference/executionmodel.html#annotation-scopes"><span>annotation scope</span></a>. Annotation scopes behave for the
most part like function scopes, but interact differently with enclosing class scopes.
In Python 3.13, <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-annotation"><span>annotations</span></a> will also be evaluated in
annotation scopes.</p>
<p>See <span id="index-5"></span><a href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a> for more details.</p>
<p>(PEP written by Eric Traut. Implementation by Jelle Zijlstra, Eric Traut,
and others in <a href="https://github.com/python/cpython/issues/103764">gh-103764</a>.)</p>
</section>
<section id="pep-701-syntactic-formalization-of-f-strings">
<span id="whatsnew312-pep701"></span><h3>PEP 701: Syntactic formalization of f-strings<a href="#pep-701-syntactic-formalization-of-f-strings" title="Permalink to this headline">¶</a></h3>
<p><span id="index-6"></span><a href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a> lifts some restrictions on the usage of <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-f-string"><span>f-strings</span></a>.
Expression components inside f-strings can now be any valid Python expression,
including strings reusing the same quote as the containing f-string,
multi-line expressions, comments, backslashes, and unicode escape sequences.
Let’s cover these in detail:</p>
<ul>
<li><p>Quote reuse: in Python 3.11, reusing the same quotes as the enclosing f-string
raises a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a>, forcing the user to either use other available
quotes (like using double quotes or triple quotes if the f-string uses single
quotes). In Python 3.12, you can now do things like this:</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>songs</span> <span>=</span> <span>[</span><span>&#39;Take me back to Eden&#39;</span><span>,</span> <span>&#39;Alkaline&#39;</span><span>,</span> <span>&#39;Ascensionism&#39;</span><span>]</span>
<span>&gt;&gt;&gt; </span><span>f</span><span>&#34;This is the playlist: </span><span>{</span><span>&#34;, &#34;</span><span>.</span><span>join</span><span>(</span><span>songs</span><span>)</span><span>}</span><span>&#34;</span>
<span>&#39;This is the playlist: Take me back to Eden, Alkaline, Ascensionism&#39;</span>
</pre></div>
</div>
<p>Note that before this change there was no explicit limit in how f-strings can
be nested, but the fact that string quotes cannot be reused inside the
expression component of f-strings made it impossible to nest f-strings
arbitrarily. In fact, this is the most nested f-string that could be written:</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>f</span><span>&#34;&#34;&#34;</span><span>{</span><span>f</span><span>&#39;&#39;&#39;</span><span>{</span><span>f</span><span>&#39;</span><span>{</span><span>f</span><span>&#34;</span><span>{</span><span>1</span><span>+</span><span>1</span><span>}</span><span>&#34;</span><span>}</span><span>&#39;</span><span>}</span><span>&#39;&#39;&#39;</span><span>}</span><span>&#34;&#34;&#34;</span>
<span>&#39;2&#39;</span>
</pre></div>
</div>
<p>As now f-strings can contain any valid Python expression inside expression
components, it is now possible to nest f-strings arbitrarily:</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>f</span><span>&#34;</span><span>{</span><span>f</span><span>&#34;</span><span>{</span><span>f</span><span>&#34;</span><span>{</span><span>f</span><span>&#34;</span><span>{</span><span>f</span><span>&#34;</span><span>{</span><span>f</span><span>&#34;</span><span>{</span><span>1</span><span>+</span><span>1</span><span>}</span><span>&#34;</span><span>}</span><span>&#34;</span><span>}</span><span>&#34;</span><span>}</span><span>&#34;</span><span>}</span><span>&#34;</span><span>}</span><span>&#34;</span>
<span>&#39;2&#39;</span>
</pre></div>
</div>
</li>
<li><p>Multi-line expressions and comments: In Python 3.11, f-string expressions
must be defined in a single line, even if the expression within the f-string
could normally span multiple lines
(like literal lists being defined over multiple lines),
making them harder to read. In Python 3.12 you can now define f-strings
spanning multiple lines, and add inline comments:</p>
<div><div><pre><span></span>&gt;&gt;&gt; f&#34;This is the playlist: {&#34;, &#34;.join([
...     &#39;Take me back to Eden&#39;,  # My, my, those eyes like fire
...     &#39;Alkaline&#39;,              # Not acid nor alkaline
...     &#39;Ascensionism&#39;           # Take to the broken skies at last
... ])}&#34;
&#39;This is the playlist: Take me back to Eden, Alkaline, Ascensionism&#39;
</pre></div>
</div>
</li>
<li><p>Backslashes and unicode characters: before Python 3.12 f-string expressions
couldn’t contain any <code><span>\</span></code> character. This also affected unicode <a href="https://www.wildlondon.org.uk/blog/reference/lexical_analysis.html#escape-sequences"><span>escape
sequences</span></a> (such as <code><span>\N{snowman}</span></code>) as these contain
the <code><span>\N</span></code> part that previously could not be part of expression components of
f-strings. Now, you can define expressions like this:</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>print</span><span>(</span><span>f</span><span>&#34;This is the playlist: </span><span>{</span><span>&#34;</span><span>\n</span><span>&#34;</span><span>.</span><span>join</span><span>(</span><span>songs</span><span>)</span><span>}</span><span>&#34;</span><span>)</span>
<span>This is the playlist: Take me back to Eden</span>
<span>Alkaline</span>
<span>Ascensionism</span>
<span>&gt;&gt;&gt; </span><span>print</span><span>(</span><span>f</span><span>&#34;This is the playlist: </span><span>{</span><span>&#34;</span><span>\N{BLACK HEART SUIT}</span><span>&#34;</span><span>.</span><span>join</span><span>(</span><span>songs</span><span>)</span><span>}</span><span>&#34;</span><span>)</span>
<span>This is the playlist: Take me back to Eden♥Alkaline♥Ascensionism</span>
</pre></div>
</div>
</li>
</ul>
<p>See <span id="index-7"></span><a href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a> for more details.</p>
<p>As a positive side-effect of how this feature has been implemented (by parsing f-strings
with <span id="index-8"></span><a href="https://peps.python.org/pep-0617/"><strong>the PEG parser</strong></a>), now error messages for f-strings are more precise
and include the exact location of the error. For example, in Python 3.11, the following
f-string raises a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a>:</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>my_string</span> <span>=</span> <span>f</span><span>&#34;</span><span>{</span><span>x</span><span> </span><span>z</span><span> </span><span>y</span><span>}</span><span>&#34;</span> <span>+</span> <span>f</span><span>&#34;</span><span>{</span><span>1</span><span> </span><span>+</span><span> </span><span>1</span><span>}</span><span>&#34;</span>
  File <span>&#34;&lt;stdin&gt;&#34;</span>, line <span>1</span>
<span>    </span><span>(</span><span>x</span> <span>z</span> <span>y</span><span>)</span>
<span>     </span><span>^^^</span>
<span>SyntaxError</span>: <span>f-string: invalid syntax. Perhaps you forgot a comma?</span>
</pre></div>
</div>
<p>but the error message doesn’t include the exact location of the error within the line and
also has the expression artificially surrounded by parentheses. In Python 3.12, as f-strings
are parsed with the PEG parser, error messages can be more precise and show the entire line:</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>my_string</span> <span>=</span> <span>f</span><span>&#34;</span><span>{</span><span>x</span><span> </span><span>z</span><span> </span><span>y</span><span>}</span><span>&#34;</span> <span>+</span> <span>f</span><span>&#34;</span><span>{</span><span>1</span><span> </span><span>+</span><span> </span><span>1</span><span>}</span><span>&#34;</span>
  File <span>&#34;&lt;stdin&gt;&#34;</span>, line <span>1</span>
<span>    </span><span>my_string</span> <span>=</span> <span>f</span><span>&#34;</span><span>{</span><span>x</span><span> </span><span>z</span><span> </span><span>y</span><span>}</span><span>&#34;</span> <span>+</span> <span>f</span><span>&#34;</span><span>{</span><span>1</span><span> </span><span>+</span><span> </span><span>1</span><span>}</span><span>&#34;</span>
<span>                   </span><span>^^^</span>
<span>SyntaxError</span>: <span>invalid syntax. Perhaps you forgot a comma?</span>
</pre></div>
</div>
<p>(Contributed by Pablo Galindo, Batuhan Taskaya, Lysandros Nikolaou, Cristián
Maureira-Fredes and Marta Gómez in <a href="https://github.com/python/cpython/issues/102856">gh-102856</a>. PEP written by Pablo Galindo,
Batuhan Taskaya, Lysandros Nikolaou and Marta Gómez).</p>
</section>
<section id="pep-684-a-per-interpreter-gil">
<span id="whatsnew312-pep684"></span><h3>PEP 684: A Per-Interpreter GIL<a href="#pep-684-a-per-interpreter-gil" title="Permalink to this headline">¶</a></h3>
<p><span id="index-9"></span><a href="https://peps.python.org/pep-0684/"><strong>PEP 684</strong></a> introduces a per-interpreter <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-global-interpreter-lock"><span>GIL</span></a>,
so that sub-interpreters may now be created with a unique GIL per interpreter.
This allows Python programs to take full advantage of multiple CPU
cores. This is currently only available through the C-API,
though a Python API is <span id="index-10"></span><a href="https://peps.python.org/pep-0554/"><strong>anticipated for 3.13</strong></a>.</p>
<p>Use the new <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_NewInterpreterFromConfig" title="Py_NewInterpreterFromConfig"><code><span>Py_NewInterpreterFromConfig()</span></code></a> function to
create an interpreter with its own GIL:</p>
<div><div><pre><span></span><span>PyInterpreterConfig</span> <span>config</span> <span>=</span> <span>{</span>
    <span>.</span><span>check_multi_interp_extensions</span> <span>=</span> <span>1</span><span>,</span>
    <span>.</span><span>gil</span> <span>=</span> <span>PyInterpreterConfig_OWN_GIL</span><span>,</span>
<span>};</span>
<span>PyThreadState</span> <span>*</span><span>tstate</span> <span>=</span> <span>NULL</span><span>;</span>
<span>PyStatus</span> <span>status</span> <span>=</span> <span>Py_NewInterpreterFromConfig</span><span>(</span><span>&amp;</span><span>tstate</span><span>,</span> <span>&amp;</span><span>config</span><span>);</span>
<span>if</span> <span>(</span><span>PyStatus_Exception</span><span>(</span><span>status</span><span>))</span> <span>{</span>
    <span>return</span> <span>-</span><span>1</span><span>;</span>
<span>}</span>
<span>/*</span> <span>The</span> <span>new</span> <span>interpreter</span> <span>is</span> <span>now</span> <span>active</span> <span>in</span> <span>the</span> <span>current</span> <span>thread</span><span>.</span> <span>*/</span>
</pre></div>
</div>
<p>For further examples how to use the C-API for sub-interpreters with a
per-interpreter GIL, see <a href="https://github.com/python/cpython/tree/3.12/Modules/_xxsubinterpretersmodule.c">Modules/_xxsubinterpretersmodule.c</a>.</p>
<p>(Contributed by Eric Snow in <a href="https://github.com/python/cpython/issues/104210">gh-104210</a>, etc.)</p>
</section>
<section id="pep-669-low-impact-monitoring-for-cpython">
<span id="whatsnew312-pep669"></span><h3>PEP 669: Low impact monitoring for CPython<a href="#pep-669-low-impact-monitoring-for-cpython" title="Permalink to this headline">¶</a></h3>
<p><span id="index-11"></span><a href="https://peps.python.org/pep-0669/"><strong>PEP 669</strong></a> defines a new <a href="https://www.wildlondon.org.uk/blog/library/sys.monitoring.html#module-sys.monitoring" title="sys.monitoring: Access and control event monitoring"><code><span>API</span></code></a> for profilers,
debuggers, and other tools to monitor events in CPython.
It covers a wide range of events, including calls,
returns, lines, exceptions, jumps, and more.
This means that you only pay for what you use, providing support
for near-zero overhead debuggers and coverage tools.
See  <a href="https://www.wildlondon.org.uk/blog/library/sys.monitoring.html#module-sys.monitoring" title="sys.monitoring: Access and control event monitoring"><code><span>sys.monitoring</span></code></a> for details.</p>
<p>(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/103082">gh-103082</a>.)</p>
</section>
<section id="pep-688-making-the-buffer-protocol-accessible-in-python">
<span id="whatsnew312-pep688"></span><h3>PEP 688: Making the buffer protocol accessible in Python<a href="#pep-688-making-the-buffer-protocol-accessible-in-python" title="Permalink to this headline">¶</a></h3>
<p><span id="index-12"></span><a href="https://peps.python.org/pep-0688/"><strong>PEP 688</strong></a> introduces a way to use the <a href="https://www.wildlondon.org.uk/blog/c-api/buffer.html#bufferobjects"><span>buffer protocol</span></a>
from Python code. Classes that implement the <a href="https://www.wildlondon.org.uk/blog/reference/datamodel.html#object.__buffer__" title="object.__buffer__"><code><span>__buffer__()</span></code></a> method
are now usable as buffer types.</p>
<p>The new <a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#collections.abc.Buffer" title="collections.abc.Buffer"><code><span>collections.abc.Buffer</span></code></a> ABC provides a standard
way to represent buffer objects, for example in type annotations.
The new <a href="https://www.wildlondon.org.uk/blog/library/inspect.html#inspect.BufferFlags" title="inspect.BufferFlags"><code><span>inspect.BufferFlags</span></code></a> enum represents the flags that
can be used to customize buffer creation.
(Contributed by Jelle Zijlstra in <a href="https://github.com/python/cpython/issues/102500">gh-102500</a>.)</p>
</section>
<section id="pep-709-comprehension-inlining">
<span id="whatsnew312-pep709"></span><h3>PEP 709: Comprehension inlining<a href="#pep-709-comprehension-inlining" title="Permalink to this headline">¶</a></h3>
<p>Dictionary, list, and set comprehensions are now inlined, rather than creating a
new single-use function object for each execution of the comprehension. This
speeds up execution of a comprehension by up to two times.
See <span id="index-13"></span><a href="https://peps.python.org/pep-0709/"><strong>PEP 709</strong></a> for further details.</p>
<p>Comprehension iteration variables remain isolated and don’t overwrite a
variable of the same name in the outer scope, nor are they visible after the
comprehension. Inlining does result in a few visible behavior changes:</p>
<ul>
<li><p>There is no longer a separate frame for the comprehension in tracebacks,
and tracing/profiling no longer shows the comprehension as a function call.</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/symtable.html#module-symtable" title="symtable: Interface to the compiler&#39;s internal symbol tables."><code><span>symtable</span></code></a> module will no longer produce child symbol tables for each
comprehension; instead, the comprehension’s locals will be included in the
parent function’s symbol table.</p></li>
<li><p>Calling <a href="https://www.wildlondon.org.uk/blog/library/functions.html#locals" title="locals"><code><span>locals()</span></code></a> inside a comprehension now includes variables
from outside the comprehension, and no longer includes the synthetic <code><span>.0</span></code>
variable for the comprehension “argument”.</p></li>
<li><p>A comprehension iterating directly over <code><span>locals()</span></code> (e.g. <code><span>[k</span> <span>for</span> <span>k</span> <span>in</span>
<span>locals()]</span></code>) may see “RuntimeError: dictionary changed size during iteration”
when run under tracing (e.g. code coverage measurement). This is the same
behavior already seen in e.g. <code><span>for</span> <span>k</span> <span>in</span> <span>locals():</span></code>. To avoid the error, first
create a list of keys to iterate over: <code><span>keys</span> <span>=</span> <span>list(locals());</span> <span>[k</span> <span>for</span> <span>k</span> <span>in</span>
<span>keys]</span></code>.</p></li>
</ul>
<p>(Contributed by Carl Meyer and Vladimir Matveev in <span id="index-14"></span><a href="https://peps.python.org/pep-0709/"><strong>PEP 709</strong></a>.)</p>
</section>
<section id="improved-error-messages">
<h3>Improved Error Messages<a href="#improved-error-messages" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Modules from the standard library are now potentially suggested as part of
the error messages displayed by the interpreter when a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#NameError" title="NameError"><code><span>NameError</span></code></a> is
raised to the top level. (Contributed by Pablo Galindo in <a href="https://github.com/python/cpython/issues/98254">gh-98254</a>.)</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>sys</span><span>.</span><span>version_info</span>
<span>Traceback (most recent call last):</span>
  File <span>&#34;&lt;stdin&gt;&#34;</span>, line <span>1</span>, in <span>&lt;module&gt;</span>
<span>NameError</span>: <span>name &#39;sys&#39; is not defined. Did you forget to import &#39;sys&#39;?</span>
</pre></div>
</div>
</li>
<li><p>Improve the error suggestion for <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#NameError" title="NameError"><code><span>NameError</span></code></a> exceptions for instances.
Now if a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#NameError" title="NameError"><code><span>NameError</span></code></a> is raised in a method and the instance has an
attribute that’s exactly equal to the name in the exception, the suggestion
will include <code><span>self.&lt;NAME&gt;</span></code> instead of the closest match in the method
scope. (Contributed by Pablo Galindo in <a href="https://github.com/python/cpython/issues/99139">gh-99139</a>.)</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>class</span> <span>A</span><span>:</span>
<span>... </span>   <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>):</span>
<span>... </span>       <span>self</span><span>.</span><span>blech</span> <span>=</span> <span>1</span>
<span>...</span>
<span>... </span>   <span>def</span> <span>foo</span><span>(</span><span>self</span><span>):</span>
<span>... </span>       <span>somethin</span> <span>=</span> <span>blech</span>
<span>...</span>
<span>&gt;&gt;&gt; </span><span>A</span><span>()</span><span>.</span><span>foo</span><span>()</span>
<span>Traceback (most recent call last):</span>
  File <span>&#34;&lt;stdin&gt;&#34;</span>, line <span>1</span>
<span>    </span><span>somethin</span> <span>=</span> <span>blech</span>
<span>               </span><span>^^^^^</span>
<span>NameError</span>: <span>name &#39;blech&#39; is not defined. Did you mean: &#39;self.blech&#39;?</span>
</pre></div>
</div>
</li>
<li><p>Improve the <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a> error message when the user types <code><span>import</span> <span>x</span>
<span>from</span> <span>y</span></code> instead of <code><span>from</span> <span>y</span> <span>import</span> <span>x</span></code>. (Contributed by Pablo Galindo in <a href="https://github.com/python/cpython/issues/98931">gh-98931</a>.)</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>import</span> <span>a.y.z</span> <span>from</span> <span>b.y.z</span>
<span>Traceback (most recent call last):</span>
  File <span>&#34;&lt;stdin&gt;&#34;</span>, line <span>1</span>
<span>    </span><span>import</span> <span>a.y.z</span> <span>from</span> <span>b.y.z</span>
<span>    </span><span>^^^^^^^^^^^^^^^^^^^^^^^</span>
<span>SyntaxError</span>: <span>Did you mean to use &#39;from ... import ...&#39; instead?</span>
</pre></div>
</div>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#ImportError" title="ImportError"><code><span>ImportError</span></code></a> exceptions raised from failed <code><span>from</span> <span>&lt;module&gt;</span> <span>import</span>
<span>&lt;name&gt;</span></code> statements now include suggestions for the value of <code><span>&lt;name&gt;</span></code> based on the
available names in <code><span>&lt;module&gt;</span></code>. (Contributed by Pablo Galindo in <a href="https://github.com/python/cpython/issues/91058">gh-91058</a>.)</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>from</span> <span>collections</span> <span>import</span> <span>chainmap</span>
<span>Traceback (most recent call last):</span>
  File <span>&#34;&lt;stdin&gt;&#34;</span>, line <span>1</span>, in <span>&lt;module&gt;</span>
<span>ImportError</span>: <span>cannot import name &#39;chainmap&#39; from &#39;collections&#39;. Did you mean: &#39;ChainMap&#39;?</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="new-features-related-to-type-hints">
<h2>New Features Related to Type Hints<a href="#new-features-related-to-type-hints" title="Permalink to this headline">¶</a></h2>
<p>This section covers major changes affecting <span id="index-15"></span><a href="https://peps.python.org/pep-0484/"><strong>type hints</strong></a> and
the <a href="https://www.wildlondon.org.uk/blog/library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code><span>typing</span></code></a> module.</p>
<section id="pep-692-using-typeddict-for-more-precise-kwargs-typing">
<span id="whatsnew312-pep692"></span><h3>PEP 692: Using <code><span>TypedDict</span></code> for more precise <code><span>**kwargs</span></code> typing<a href="#pep-692-using-typeddict-for-more-precise-kwargs-typing" title="Permalink to this headline">¶</a></h3>
<p>Typing <code><span>**kwargs</span></code> in a function signature as introduced by <span id="index-16"></span><a href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> allowed
for valid annotations only in cases where all of the <code><span>**kwargs</span></code> were of the
same type.</p>
<p><span id="index-17"></span><a href="https://peps.python.org/pep-0692/"><strong>PEP 692</strong></a> specifies a more precise way of typing <code><span>**kwargs</span></code> by relying on
typed dictionaries:</p>
<div><div><pre><span></span><span>from</span> <span>typing</span> <span>import</span> <span>TypedDict</span><span>,</span> <span>Unpack</span>

<span>class</span> <span>Movie</span><span>(</span><span>TypedDict</span><span>):</span>
  <span>name</span><span>:</span> <span>str</span>
  <span>year</span><span>:</span> <span>int</span>

<span>def</span> <span>foo</span><span>(</span><span>**</span><span>kwargs</span><span>:</span> <span>Unpack</span><span>[</span><span>Movie</span><span>]):</span> <span>...</span>
</pre></div>
</div>
<p>See <span id="index-18"></span><a href="https://peps.python.org/pep-0692/"><strong>PEP 692</strong></a> for more details.</p>
<p>(Contributed by Franek Magiera in <a href="https://github.com/python/cpython/issues/103629">gh-103629</a>.)</p>
</section>
<section id="pep-698-override-decorator-for-static-typing">
<span id="whatsnew312-pep698"></span><h3>PEP 698: Override Decorator for Static Typing<a href="#pep-698-override-decorator-for-static-typing" title="Permalink to this headline">¶</a></h3>
<p>A new decorator <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.override" title="typing.override"><code><span>typing.override()</span></code></a> has been added to the <a href="https://www.wildlondon.org.uk/blog/library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code><span>typing</span></code></a>
module. It indicates to type checkers that the method is intended to override
a method in a superclass. This allows type checkers to catch mistakes where
a method that is intended to override something in a base class
does not in fact do so.</p>
<p>Example:</p>
<div><div><pre><span></span><span>from</span> <span>typing</span> <span>import</span> <span>override</span>

<span>class</span> <span>Base</span><span>:</span>
  <span>def</span> <span>get_color</span><span>(</span><span>self</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
    <span>return</span> <span>&#34;blue&#34;</span>

<span>class</span> <span>GoodChild</span><span>(</span><span>Base</span><span>):</span>
  <span>@override</span>  <span># ok: overrides Base.get_color</span>
  <span>def</span> <span>get_color</span><span>(</span><span>self</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
    <span>return</span> <span>&#34;yellow&#34;</span>

<span>class</span> <span>BadChild</span><span>(</span><span>Base</span><span>):</span>
  <span>@override</span>  <span># type checker error: does not override Base.get_color</span>
  <span>def</span> <span>get_colour</span><span>(</span><span>self</span><span>)</span> <span>-&gt;</span> <span>str</span><span>:</span>
    <span>return</span> <span>&#34;red&#34;</span>
</pre></div>
</div>
<p>See <span id="index-19"></span><a href="https://peps.python.org/pep-0698/"><strong>PEP 698</strong></a> for more details.</p>
<p>(Contributed by Steven Troxler in <a href="https://github.com/python/cpython/issues/101561">gh-101561</a>.)</p>
</section>
</section>
<section id="other-language-changes">
<h2>Other Language Changes<a href="#other-language-changes" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>The parser now raises <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a> when parsing source code containing
null bytes. (Contributed by Pablo Galindo in <a href="https://github.com/python/cpython/issues/96670">gh-96670</a>.)</p></li>
<li><p>A backslash-character pair that is not a valid escape sequence now generates
a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxWarning" title="SyntaxWarning"><code><span>SyntaxWarning</span></code></a>, instead of <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a>.
For example, <code><span>re.compile(&#34;\d+\.\d+&#34;)</span></code> now emits a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxWarning" title="SyntaxWarning"><code><span>SyntaxWarning</span></code></a>
(<code><span>&#34;\d&#34;</span></code> is an invalid escape sequence, use raw strings for regular
expression: <code><span>re.compile(r&#34;\d+\.\d+&#34;)</span></code>).
In a future Python version, <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a> will eventually be raised,
instead of <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxWarning" title="SyntaxWarning"><code><span>SyntaxWarning</span></code></a>.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/98401">gh-98401</a>.)</p></li>
<li><p>Octal escapes with value larger than <code><span>0o377</span></code> (ex: <code><span>&#34;\477&#34;</span></code>), deprecated
in Python 3.11, now produce a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxWarning" title="SyntaxWarning"><code><span>SyntaxWarning</span></code></a>, instead of
<a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a>.
In a future Python version they will be eventually a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a>.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/98401">gh-98401</a>.)</p></li>
<li><p>Variables used in the target part of comprehensions that are not stored to
can now be used in assignment expressions (<code><span>:=</span></code>).
For example, in <code><span>[(b</span> <span>:=</span> <span>1)</span> <span>for</span> <span>a,</span> <span>b.prop</span> <span>in</span> <span>some_iter]</span></code>, the assignment to
<code><span>b</span></code> is now allowed. Note that assigning to variables stored to in the target
part of comprehensions (like <code><span>a</span></code>) is still disallowed, as per <span id="index-20"></span><a href="https://peps.python.org/pep-0572/"><strong>PEP 572</strong></a>.
(Contributed by Nikita Sobolev in <a href="https://github.com/python/cpython/issues/100581">gh-100581</a>.)</p></li>
<li><p>Exceptions raised in a class or type’s <code><span>__set_name__</span></code> method are no longer
wrapped by a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#RuntimeError" title="RuntimeError"><code><span>RuntimeError</span></code></a>. Context information is added to the
exception as a <span id="index-21"></span><a href="https://peps.python.org/pep-0678/"><strong>PEP 678</strong></a> note. (Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/77757">gh-77757</a>.)</p></li>
<li><p>When a <code><span>try-except*</span></code> construct handles the entire <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#ExceptionGroup" title="ExceptionGroup"><code><span>ExceptionGroup</span></code></a>
and raises one other exception, that exception is no longer wrapped in an
<a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#ExceptionGroup" title="ExceptionGroup"><code><span>ExceptionGroup</span></code></a>. Also changed in version 3.11.4. (Contributed by Irit
Katriel in <a href="https://github.com/python/cpython/issues/103590">gh-103590</a>.)</p></li>
<li><p>The Garbage Collector now runs only on the eval breaker mechanism of the
Python bytecode evaluation loop instead of object allocations. The GC can
also run when <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_CheckSignals" title="PyErr_CheckSignals"><code><span>PyErr_CheckSignals()</span></code></a> is called so C extensions that
need to run for a long time without executing any Python code also have a
chance to execute the GC periodically. (Contributed by Pablo Galindo in
<a href="https://github.com/python/cpython/issues/97922">gh-97922</a>.)</p></li>
<li><p>All builtin and extension callables expecting boolean parameters now accept
arguments of any type instead of just <a href="https://www.wildlondon.org.uk/blog/library/functions.html#bool" title="bool"><code><span>bool</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/functions.html#int" title="int"><code><span>int</span></code></a>.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/60203">gh-60203</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#memoryview" title="memoryview"><code><span>memoryview</span></code></a> now supports the half-float type (the “e” format code).
(Contributed by Donghee Na and Antoine Pitrou in <a href="https://github.com/python/cpython/issues/90751">gh-90751</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/functions.html#slice" title="slice"><code><span>slice</span></code></a> objects are now hashable, allowing them to be used as dict keys and
set items. (Contributed by Will Bradshaw, Furkan Onder, and Raymond Hettinger in <a href="https://github.com/python/cpython/issues/101264">gh-101264</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/functions.html#sum" title="sum"><code><span>sum()</span></code></a> now uses Neumaier summation to improve accuracy and commutativity
when summing floats or mixed ints and floats.
(Contributed by Raymond Hettinger in <a href="https://github.com/python/cpython/issues/100425">gh-100425</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/ast.html#ast.parse" title="ast.parse"><code><span>ast.parse()</span></code></a> now raises <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SyntaxError" title="SyntaxError"><code><span>SyntaxError</span></code></a> instead of <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#ValueError" title="ValueError"><code><span>ValueError</span></code></a>
when parsing source code containing null bytes. (Contributed by Pablo Galindo
in <a href="https://github.com/python/cpython/issues/96670">gh-96670</a>.)</p></li>
<li><p>The extraction methods in <a href="https://www.wildlondon.org.uk/blog/library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code><span>tarfile</span></code></a>, and <a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.unpack_archive" title="shutil.unpack_archive"><code><span>shutil.unpack_archive()</span></code></a>,
have a new a <em>filter</em> argument that allows limiting tar features than may be
surprising or dangerous, such as creating files outside the destination
directory.
See <a href="https://www.wildlondon.org.uk/blog/library/tarfile.html#tarfile-extraction-filter"><span>tarfile extraction filters</span></a> for details.
In Python 3.14, the default will switch to <code><span>&#39;data&#39;</span></code>.
(Contributed by Petr Viktorin in <span id="index-22"></span><a href="https://peps.python.org/pep-0706/"><strong>PEP 706</strong></a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/types.html#types.MappingProxyType" title="types.MappingProxyType"><code><span>types.MappingProxyType</span></code></a> instances are now hashable if the underlying
mapping is hashable.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/87995">gh-87995</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/howto/perf_profiling.html#perf-profiling"><span>support for the perf profiler</span></a> through the new
environment variable <span id="index-23"></span><a href="https://www.wildlondon.org.uk/blog/using/cmdline.html#envvar-PYTHONPERFSUPPORT"><code><span>PYTHONPERFSUPPORT</span></code></a>
and command-line option <a href="https://www.wildlondon.org.uk/blog/using/cmdline.html#cmdoption-X"><code><span>-X</span> <span>perf</span></code></a>,
as well as the new <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.activate_stack_trampoline" title="sys.activate_stack_trampoline"><code><span>sys.activate_stack_trampoline()</span></code></a>,
<a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.deactivate_stack_trampoline" title="sys.deactivate_stack_trampoline"><code><span>sys.deactivate_stack_trampoline()</span></code></a>,
and <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.is_stack_trampoline_active" title="sys.is_stack_trampoline_active"><code><span>sys.is_stack_trampoline_active()</span></code></a> functions.
(Design by Pablo Galindo. Contributed by Pablo Galindo and Christian Heimes
with contributions from Gregory P. Smith [Google] and Mark Shannon
in <a href="https://github.com/python/cpython/issues/96123">gh-96123</a>.)</p></li>
</ul>
</section>
<section id="new-modules">
<h2>New Modules<a href="#new-modules" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>None.</p></li>
</ul>
</section>
<section id="improved-modules">
<h2>Improved Modules<a href="#improved-modules" title="Permalink to this headline">¶</a></h2>
<section id="array">
<h3>array<a href="#array" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/array.html#array.array" title="array.array"><code><span>array.array</span></code></a> class now supports subscripting, making it a
<a href="https://www.wildlondon.org.uk/blog/glossary.html#term-generic-type"><span>generic type</span></a>. (Contributed by Jelle Zijlstra in <a href="https://github.com/python/cpython/issues/98658">gh-98658</a>.)</p></li>
</ul>
</section>
<section id="asyncio">
<h3>asyncio<a href="#asyncio" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The performance of writing to sockets in <a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a> has been
significantly improved. <code><span>asyncio</span></code> now avoids unnecessary copying when
writing to sockets and uses <a href="https://www.wildlondon.org.uk/blog/library/socket.html#socket.socket.sendmsg" title="socket.socket.sendmsg"><code><span>sendmsg()</span></code></a> if the platform
supports it. (Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/91166">gh-91166</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/asyncio-task.html#asyncio.eager_task_factory" title="asyncio.eager_task_factory"><code><span>asyncio.eager_task_factory()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/asyncio-task.html#asyncio.create_eager_task_factory" title="asyncio.create_eager_task_factory"><code><span>asyncio.create_eager_task_factory()</span></code></a>
functions to allow opting an event loop in to eager task execution,
making some use-cases 2x to 5x faster.
(Contributed by Jacob Bower &amp; Itamar Oren in <a href="https://github.com/python/cpython/issues/102853">gh-102853</a>, <a href="https://github.com/python/cpython/issues/104140">gh-104140</a>, and <a href="https://github.com/python/cpython/issues/104138">gh-104138</a>)</p></li>
<li><p>On Linux, <a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a> uses <a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.PidfdChildWatcher" title="asyncio.PidfdChildWatcher"><code><span>asyncio.PidfdChildWatcher</span></code></a> by default
if <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.pidfd_open" title="os.pidfd_open"><code><span>os.pidfd_open()</span></code></a> is available and functional instead of
<a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.ThreadedChildWatcher" title="asyncio.ThreadedChildWatcher"><code><span>asyncio.ThreadedChildWatcher</span></code></a>.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/98024">gh-98024</a>.)</p></li>
<li><p>The event loop now uses the best available child watcher for each platform
(<a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.PidfdChildWatcher" title="asyncio.PidfdChildWatcher"><code><span>asyncio.PidfdChildWatcher</span></code></a> if supported and
<a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.ThreadedChildWatcher" title="asyncio.ThreadedChildWatcher"><code><span>asyncio.ThreadedChildWatcher</span></code></a> otherwise), so manually
configuring a child watcher is not recommended.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/94597">gh-94597</a>.)</p></li>
<li><p>Add <em>loop_factory</em> parameter to <a href="https://www.wildlondon.org.uk/blog/library/asyncio-runner.html#asyncio.run" title="asyncio.run"><code><span>asyncio.run()</span></code></a> to allow specifying
a custom event loop factory.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/99388">gh-99388</a>.)</p></li>
<li><p>Add C implementation of <a href="https://www.wildlondon.org.uk/blog/library/asyncio-task.html#asyncio.current_task" title="asyncio.current_task"><code><span>asyncio.current_task()</span></code></a> for 4x-6x speedup.
(Contributed by Itamar Oren and Pranav Thulasiram Bhat in <a href="https://github.com/python/cpython/issues/100344">gh-100344</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/asyncio-task.html#asyncio.iscoroutine" title="asyncio.iscoroutine"><code><span>asyncio.iscoroutine()</span></code></a> now returns <code><span>False</span></code> for generators as
<a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a> does not support legacy generator-based coroutines.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/102748">gh-102748</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/asyncio-task.html#asyncio.wait" title="asyncio.wait"><code><span>asyncio.wait()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/asyncio-task.html#asyncio.as_completed" title="asyncio.as_completed"><code><span>asyncio.as_completed()</span></code></a> now accepts generators
yielding tasks.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/78530">gh-78530</a>.)</p></li>
</ul>
</section>
<section id="calendar">
<h3>calendar<a href="#calendar" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add enums <a href="https://www.wildlondon.org.uk/blog/library/calendar.html#calendar.Month" title="calendar.Month"><code><span>calendar.Month</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/calendar.html#calendar.Day" title="calendar.Day"><code><span>calendar.Day</span></code></a>
defining months of the year and days of the week.
(Contributed by Prince Roshan in <a href="https://github.com/python/cpython/issues/103636">gh-103636</a>.)</p></li>
</ul>
</section>
<section id="csv">
<h3>csv<a href="#csv" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/csv.html#csv.QUOTE_NOTNULL" title="csv.QUOTE_NOTNULL"><code><span>csv.QUOTE_NOTNULL</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/csv.html#csv.QUOTE_STRINGS" title="csv.QUOTE_STRINGS"><code><span>csv.QUOTE_STRINGS</span></code></a> flags to
provide finer grained control of <code><span>None</span></code> and empty strings by
<a href="https://www.wildlondon.org.uk/blog/library/csv.html#csv.writer" title="csv.writer"><code><span>csv.writer</span></code></a> objects.</p></li>
</ul>
</section>
<section id="dis">
<h3>dis<a href="#dis" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Pseudo instruction opcodes (which are used by the compiler but
do not appear in executable bytecode) are now exposed in the
<a href="https://www.wildlondon.org.uk/blog/library/dis.html#module-dis" title="dis: Disassembler for Python bytecode."><code><span>dis</span></code></a> module.
<a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-HAVE_ARGUMENT"><code><span>HAVE_ARGUMENT</span></code></a> is still relevant to real opcodes,
but it is not useful for pseudo instructions. Use the new
<a href="https://www.wildlondon.org.uk/blog/library/dis.html#dis.hasarg" title="dis.hasarg"><code><span>dis.hasarg</span></code></a> collection instead.
(Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/94216">gh-94216</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#dis.hasexc" title="dis.hasexc"><code><span>dis.hasexc</span></code></a> collection to signify instructions that set
an exception handler. (Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/94216">gh-94216</a>.)</p></li>
</ul>
</section>
<section id="fractions">
<h3>fractions<a href="#fractions" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Objects of type <a href="https://www.wildlondon.org.uk/blog/library/fractions.html#fractions.Fraction" title="fractions.Fraction"><code><span>fractions.Fraction</span></code></a> now support float-style
formatting. (Contributed by Mark Dickinson in <a href="https://github.com/python/cpython/issues/100161">gh-100161</a>.)</p></li>
</ul>
</section>
<section id="importlib-resources">
<h3>importlib.resources<a href="#importlib-resources" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/importlib.resources.html#importlib.resources.as_file" title="importlib.resources.as_file"><code><span>importlib.resources.as_file()</span></code></a> now supports resource directories.
(Contributed by Jason R. Coombs in <a href="https://github.com/python/cpython/issues/97930">gh-97930</a>.)</p></li>
</ul>
</section>
<section id="inspect">
<h3>inspect<a href="#inspect" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/inspect.html#inspect.markcoroutinefunction" title="inspect.markcoroutinefunction"><code><span>inspect.markcoroutinefunction()</span></code></a> to mark sync functions that return
a <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-coroutine"><span>coroutine</span></a> for use with <a href="https://www.wildlondon.org.uk/blog/library/inspect.html#inspect.iscoroutinefunction" title="inspect.iscoroutinefunction"><code><span>inspect.iscoroutinefunction()</span></code></a>.
(Contributed Carlton Gibson in <a href="https://github.com/python/cpython/issues/99247">gh-99247</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/inspect.html#inspect.getasyncgenstate" title="inspect.getasyncgenstate"><code><span>inspect.getasyncgenstate()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/inspect.html#inspect.getasyncgenlocals" title="inspect.getasyncgenlocals"><code><span>inspect.getasyncgenlocals()</span></code></a>
for determining the current state of asynchronous generators.
(Contributed by Thomas Krennwallner in <a href="https://github.com/python/cpython/issues/79940">gh-79940</a>.)</p></li>
<li><p>The performance of <a href="https://www.wildlondon.org.uk/blog/library/inspect.html#inspect.getattr_static" title="inspect.getattr_static"><code><span>inspect.getattr_static()</span></code></a> has been considerably
improved. Most calls to the function should be at least 2x faster than they
were in Python 3.11, and some may be 6x faster or more. (Contributed by Alex
Waygood in <a href="https://github.com/python/cpython/issues/103193">gh-103193</a>.)</p></li>
</ul>
</section>
<section id="itertools">
<h3>itertools<a href="#itertools" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/itertools.html#itertools.batched" title="itertools.batched"><code><span>itertools.batched()</span></code></a> for collecting into even-sized
tuples where the last batch may be shorter than the rest.
(Contributed by Raymond Hettinger in <a href="https://github.com/python/cpython/issues/98363">gh-98363</a>.)</p></li>
</ul>
</section>
<section id="math">
<h3>math<a href="#math" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/math.html#math.sumprod" title="math.sumprod"><code><span>math.sumprod()</span></code></a> for computing a sum of products.
(Contributed by Raymond Hettinger in <a href="https://github.com/python/cpython/issues/100485">gh-100485</a>.)</p></li>
<li><p>Extend <a href="https://www.wildlondon.org.uk/blog/library/math.html#math.nextafter" title="math.nextafter"><code><span>math.nextafter()</span></code></a> to include a <em>steps</em> argument
for moving up or down multiple steps at a time.
(By Matthias Goergens, Mark Dickinson, and Raymond Hettinger in <a href="https://github.com/python/cpython/issues/94906">gh-94906</a>.)</p></li>
</ul>
</section>
<section id="os">
<h3>os<a href="#os" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.PIDFD_NONBLOCK" title="os.PIDFD_NONBLOCK"><code><span>os.PIDFD_NONBLOCK</span></code></a> to open a file descriptor
for a process with <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.pidfd_open" title="os.pidfd_open"><code><span>os.pidfd_open()</span></code></a> in non-blocking mode.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/93312">gh-93312</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/os.html#os.DirEntry" title="os.DirEntry"><code><span>os.DirEntry</span></code></a> now includes an <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.DirEntry.is_junction" title="os.DirEntry.is_junction"><code><span>os.DirEntry.is_junction()</span></code></a>
method to check if the entry is a junction.
(Contributed by Charles Machalow in <a href="https://github.com/python/cpython/issues/99547">gh-99547</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.listdrives" title="os.listdrives"><code><span>os.listdrives()</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.listvolumes" title="os.listvolumes"><code><span>os.listvolumes()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.listmounts" title="os.listmounts"><code><span>os.listmounts()</span></code></a>
functions on Windows for enumerating drives, volumes and mount points.
(Contributed by Steve Dower in <a href="https://github.com/python/cpython/issues/102519">gh-102519</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/os.html#os.stat" title="os.stat"><code><span>os.stat()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.lstat" title="os.lstat"><code><span>os.lstat()</span></code></a> are now more accurate on Windows.
The <code><span>st_birthtime</span></code> field will now be filled with the creation time
of the file, and <code><span>st_ctime</span></code> is deprecated but still contains the
creation time (but in the future will return the last metadata change,
for consistency with other platforms). <code><span>st_dev</span></code> may be up to 64 bits
and <code><span>st_ino</span></code> up to 128 bits depending on your file system, and
<code><span>st_rdev</span></code> is always set to zero rather than incorrect values.
Both functions may be significantly faster on newer releases of
Windows. (Contributed by Steve Dower in <a href="https://github.com/python/cpython/issues/99726">gh-99726</a>.)</p></li>
</ul>
</section>
<section id="os-path">
<h3>os.path<a href="#os-path" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/os.path.html#os.path.isjunction" title="os.path.isjunction"><code><span>os.path.isjunction()</span></code></a> to check if a given path is a junction.
(Contributed by Charles Machalow in <a href="https://github.com/python/cpython/issues/99547">gh-99547</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/os.path.html#os.path.splitroot" title="os.path.splitroot"><code><span>os.path.splitroot()</span></code></a> to split a path into a triad
<code><span>(drive,</span> <span>root,</span> <span>tail)</span></code>. (Contributed by Barney Gale in <a href="https://github.com/python/cpython/issues/101000">gh-101000</a>.)</p></li>
</ul>
</section>
<section id="pathlib">
<h3>pathlib<a href="#pathlib" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add support for subclassing <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.PurePath" title="pathlib.PurePath"><code><span>pathlib.PurePath</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.Path" title="pathlib.Path"><code><span>pathlib.Path</span></code></a>, plus their Posix- and Windows-specific variants.
Subclasses may override the <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.PurePath.with_segments" title="pathlib.PurePath.with_segments"><code><span>pathlib.PurePath.with_segments()</span></code></a> method
to pass information between path instances.</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.Path.walk" title="pathlib.Path.walk"><code><span>pathlib.Path.walk()</span></code></a> for walking the directory trees and generating
all file or directory names within them, similar to <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.walk" title="os.walk"><code><span>os.walk()</span></code></a>.
(Contributed by Stanislav Zmiev in <a href="https://github.com/python/cpython/issues/90385">gh-90385</a>.)</p></li>
<li><p>Add <em>walk_up</em> optional parameter to <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.PurePath.relative_to" title="pathlib.PurePath.relative_to"><code><span>pathlib.PurePath.relative_to()</span></code></a>
to allow the insertion of <code><span>..</span></code> entries in the result; this behavior is
more consistent with <a href="https://www.wildlondon.org.uk/blog/library/os.path.html#os.path.relpath" title="os.path.relpath"><code><span>os.path.relpath()</span></code></a>.
(Contributed by Domenico Ragusa in <a href="https://github.com/python/cpython/issues/84538">gh-84538</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.Path.is_junction" title="pathlib.Path.is_junction"><code><span>pathlib.Path.is_junction()</span></code></a> as a proxy to <a href="https://www.wildlondon.org.uk/blog/library/os.path.html#os.path.isjunction" title="os.path.isjunction"><code><span>os.path.isjunction()</span></code></a>.
(Contributed by Charles Machalow in <a href="https://github.com/python/cpython/issues/99547">gh-99547</a>.)</p></li>
<li><p>Add <em>case_sensitive</em> optional parameter to <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.Path.glob" title="pathlib.Path.glob"><code><span>pathlib.Path.glob()</span></code></a>,
<a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.Path.rglob" title="pathlib.Path.rglob"><code><span>pathlib.Path.rglob()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/pathlib.html#pathlib.PurePath.match" title="pathlib.PurePath.match"><code><span>pathlib.PurePath.match()</span></code></a> for matching
the path’s case sensitivity, allowing for more precise control over the matching process.</p></li>
</ul>
</section>
<section id="pdb">
<h3>pdb<a href="#pdb" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add convenience variables to hold values temporarily for debug session
and provide quick access to values like the current frame or the return
value.
(Contributed by Tian Gao in <a href="https://github.com/python/cpython/issues/103693">gh-103693</a>.)</p></li>
</ul>
</section>
<section id="random">
<h3>random<a href="#random" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/random.html#random.binomialvariate" title="random.binomialvariate"><code><span>random.binomialvariate()</span></code></a>.
(Contributed by Raymond Hettinger in <a href="https://github.com/python/cpython/issues/81620">gh-81620</a>.)</p></li>
<li><p>Add a default of <code><span>lambd=1.0</span></code> to <a href="https://www.wildlondon.org.uk/blog/library/random.html#random.expovariate" title="random.expovariate"><code><span>random.expovariate()</span></code></a>.
(Contributed by Raymond Hettinger in <a href="https://github.com/python/cpython/issues/100234">gh-100234</a>.)</p></li>
</ul>
</section>
<section id="shutil">
<h3>shutil<a href="#shutil" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.make_archive" title="shutil.make_archive"><code><span>shutil.make_archive()</span></code></a> now passes the <em>root_dir</em> argument to custom
archivers which support it.
In this case it no longer temporarily changes the current working directory
of the process to <em>root_dir</em> to perform archiving.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/74696">gh-74696</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.rmtree" title="shutil.rmtree"><code><span>shutil.rmtree()</span></code></a> now accepts a new argument <em>onexc</em> which is an
error handler like <em>onerror</em> but which expects an exception instance
rather than a <em>(typ, val, tb)</em> triplet. <em>onerror</em> is deprecated and
will be removed in Python 3.14.
(Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/102828">gh-102828</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.which" title="shutil.which"><code><span>shutil.which()</span></code></a> now consults the <em>PATHEXT</em> environment variable to
find matches within <em>PATH</em> on Windows even when the given <em>cmd</em> includes
a directory component.
(Contributed by Charles Machalow in <a href="https://github.com/python/cpython/issues/103179">gh-103179</a>.)</p>
<p><a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.which" title="shutil.which"><code><span>shutil.which()</span></code></a> will call <code><span>NeedCurrentDirectoryForExePathW</span></code> when
querying for executables on Windows to determine if the current working
directory should be prepended to the search path.
(Contributed by Charles Machalow in <a href="https://github.com/python/cpython/issues/103179">gh-103179</a>.)</p>
<p><a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.which" title="shutil.which"><code><span>shutil.which()</span></code></a> will return a path matching the <em>cmd</em> with a component
from <code><span>PATHEXT</span></code> prior to a direct match elsewhere in the search path on
Windows.
(Contributed by Charles Machalow in <a href="https://github.com/python/cpython/issues/103179">gh-103179</a>.)</p>
</li>
</ul>
</section>
<section id="sqlite3">
<h3>sqlite3<a href="#sqlite3" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add a <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3-cli"><span>command-line interface</span></a>.
(Contributed by Erlend E. Aasland in <a href="https://github.com/python/cpython/issues/77617">gh-77617</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.Connection.autocommit" title="sqlite3.Connection.autocommit"><code><span>sqlite3.Connection.autocommit</span></code></a> attribute
to <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.Connection" title="sqlite3.Connection"><code><span>sqlite3.Connection</span></code></a>
and the <em>autocommit</em> parameter to <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.connect" title="sqlite3.connect"><code><span>sqlite3.connect()</span></code></a>
to control <span id="index-24"></span><a href="https://peps.python.org/pep-0249/"><strong>PEP 249</strong></a>-compliant
<a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3-transaction-control-autocommit"><span>transaction handling</span></a>.
(Contributed by Erlend E. Aasland in <a href="https://github.com/python/cpython/issues/83638">gh-83638</a>.)</p></li>
<li><p>Add <em>entrypoint</em> keyword-only parameter to
<a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.Connection.load_extension" title="sqlite3.Connection.load_extension"><code><span>sqlite3.Connection.load_extension()</span></code></a>,
for overriding the SQLite extension entry point.
(Contributed by Erlend E. Aasland in <a href="https://github.com/python/cpython/issues/103015">gh-103015</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.Connection.getconfig" title="sqlite3.Connection.getconfig"><code><span>sqlite3.Connection.getconfig()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.Connection.setconfig" title="sqlite3.Connection.setconfig"><code><span>sqlite3.Connection.setconfig()</span></code></a> to <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.Connection" title="sqlite3.Connection"><code><span>sqlite3.Connection</span></code></a>
to make configuration changes to a database connection.
(Contributed by Erlend E. Aasland in <a href="https://github.com/python/cpython/issues/103489">gh-103489</a>.)</p></li>
</ul>
</section>
<section id="statistics">
<h3>statistics<a href="#statistics" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Extend <a href="https://www.wildlondon.org.uk/blog/library/statistics.html#statistics.correlation" title="statistics.correlation"><code><span>statistics.correlation()</span></code></a> to include as a <code><span>ranked</span></code> method
for computing the Spearman correlation of ranked data.
(Contributed by Raymond Hettinger in <a href="https://github.com/python/cpython/issues/95861">gh-95861</a>.)</p></li>
</ul>
</section>
<section id="sys">
<h3>sys<a href="#sys" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/sys.monitoring.html#module-sys.monitoring" title="sys.monitoring: Access and control event monitoring"><code><span>sys.monitoring</span></code></a> namespace to expose the new <a href="#whatsnew312-pep669"><span>PEP 669</span></a> monitoring API.
(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/103082">gh-103082</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.activate_stack_trampoline" title="sys.activate_stack_trampoline"><code><span>sys.activate_stack_trampoline()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.deactivate_stack_trampoline" title="sys.deactivate_stack_trampoline"><code><span>sys.deactivate_stack_trampoline()</span></code></a> for activating and deactivating
stack profiler trampolines,
and <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.is_stack_trampoline_active" title="sys.is_stack_trampoline_active"><code><span>sys.is_stack_trampoline_active()</span></code></a> for querying if stack profiler
trampolines are active.
(Contributed by Pablo Galindo and Christian Heimes
with contributions from Gregory P. Smith [Google] and Mark Shannon
in <a href="https://github.com/python/cpython/issues/96123">gh-96123</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_exc" title="sys.last_exc"><code><span>sys.last_exc</span></code></a> which holds the last unhandled exception that
was raised (for post-mortem debugging use cases). Deprecate the
three fields that have the same information in its legacy form:
<a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_type" title="sys.last_type"><code><span>sys.last_type</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_value" title="sys.last_value"><code><span>sys.last_value</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_traceback" title="sys.last_traceback"><code><span>sys.last_traceback</span></code></a>.
(Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/102778">gh-102778</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys._current_exceptions" title="sys._current_exceptions"><code><span>sys._current_exceptions()</span></code></a> now returns a mapping from thread-id to an
exception instance, rather than to a <code><span>(typ,</span> <span>exc,</span> <span>tb)</span></code> tuple.
(Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/103176">gh-103176</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.setrecursionlimit" title="sys.setrecursionlimit"><code><span>sys.setrecursionlimit()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.getrecursionlimit" title="sys.getrecursionlimit"><code><span>sys.getrecursionlimit()</span></code></a>.
The recursion limit now applies only to Python code. Builtin functions do
not use the recursion limit, but are protected by a different mechanism
that prevents recursion from causing a virtual machine crash.</p></li>
</ul>
</section>
<section id="tempfile">
<h3>tempfile<a href="#tempfile" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/tempfile.html#tempfile.NamedTemporaryFile" title="tempfile.NamedTemporaryFile"><code><span>tempfile.NamedTemporaryFile</span></code></a> function has a new optional parameter
<em>delete_on_close</em> (Contributed by Evgeny Zorin in <a href="https://github.com/python/cpython/issues/58451">gh-58451</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/tempfile.html#tempfile.mkdtemp" title="tempfile.mkdtemp"><code><span>tempfile.mkdtemp()</span></code></a> now always returns an absolute path, even if the
argument provided to the <em>dir</em> parameter is a relative path.</p></li>
</ul>
</section>
<section id="threading">
<span id="whatsnew-typing-py312"></span><h3>threading<a href="#threading" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/threading.html#threading.settrace_all_threads" title="threading.settrace_all_threads"><code><span>threading.settrace_all_threads()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/threading.html#threading.setprofile_all_threads" title="threading.setprofile_all_threads"><code><span>threading.setprofile_all_threads()</span></code></a> that allow to set tracing and
profiling functions in all running threads in addition to the calling one.
(Contributed by Pablo Galindo in <a href="https://github.com/python/cpython/issues/93503">gh-93503</a>.)</p></li>
</ul>
</section>
<section id="tkinter">
<h3>tkinter<a href="#tkinter" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><code><span>tkinter.Canvas.coords()</span></code> now flattens its arguments.
It now accepts not only coordinates as separate arguments
(<code><span>x1,</span> <span>y1,</span> <span>x2,</span> <span>y2,</span> <span>...</span></code>) and a sequence of coordinates
(<code><span>[x1,</span> <span>y1,</span> <span>x2,</span> <span>y2,</span> <span>...]</span></code>), but also coordinates grouped in pairs
(<code><span>(x1,</span> <span>y1),</span> <span>(x2,</span> <span>y2),</span> <span>...</span></code> and <code><span>[(x1,</span> <span>y1),</span> <span>(x2,</span> <span>y2),</span> <span>...]</span></code>),
like <code><span>create_*()</span></code> methods.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/94473">gh-94473</a>.)</p></li>
</ul>
</section>
<section id="tokenize">
<h3>tokenize<a href="#tokenize" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code><span>tokenize</span></code></a> module includes the changes introduced in <span id="index-25"></span><a href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a>.
(Contributed by Marta Gómez Macías and Pablo Galindo in <a href="https://github.com/python/cpython/issues/102856">gh-102856</a>.)
See <a href="#whatsnew312-porting-to-python312"><span>Porting to Python 3.12</span></a> for more information on the
changes to the <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code><span>tokenize</span></code></a> module.</p></li>
</ul>
</section>
<section id="types">
<h3>types<a href="#types" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/library/types.html#types.get_original_bases" title="types.get_original_bases"><code><span>types.get_original_bases()</span></code></a> to allow for further introspection of
<a href="https://www.wildlondon.org.uk/blog/library/typing.html#user-defined-generics"><span>User-defined generic types</span></a> when subclassed. (Contributed by
James Hilton-Balfe and Alex Waygood in <a href="https://github.com/python/cpython/issues/101827">gh-101827</a>.)</p></li>
</ul>
</section>
<section id="typing">
<h3>typing<a href="#typing" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/functions.html#isinstance" title="isinstance"><code><span>isinstance()</span></code></a> checks against
<a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.runtime_checkable" title="typing.runtime_checkable"><code><span>runtime-checkable</span> <span>protocols</span></code></a> now use
<a href="https://www.wildlondon.org.uk/blog/library/inspect.html#inspect.getattr_static" title="inspect.getattr_static"><code><span>inspect.getattr_static()</span></code></a> rather than <a href="https://www.wildlondon.org.uk/blog/library/functions.html#hasattr" title="hasattr"><code><span>hasattr()</span></code></a> to lookup whether
attributes exist. This means that descriptors and <a href="https://www.wildlondon.org.uk/blog/reference/datamodel.html#object.__getattr__" title="object.__getattr__"><code><span>__getattr__()</span></code></a>
methods are no longer unexpectedly evaluated during <code><span>isinstance()</span></code> checks
against runtime-checkable protocols. However, it may also mean that some
objects which used to be considered instances of a runtime-checkable protocol
may no longer be considered instances of that protocol on Python 3.12+, and
vice versa. Most users are unlikely to be affected by this change.
(Contributed by Alex Waygood in <a href="https://github.com/python/cpython/issues/102433">gh-102433</a>.)</p></li>
<li><p>The members of a runtime-checkable protocol are now considered “frozen” at
runtime as soon as the class has been created. Monkey-patching attributes
onto a runtime-checkable protocol will still work, but will have no impact on
<a href="https://www.wildlondon.org.uk/blog/library/functions.html#isinstance" title="isinstance"><code><span>isinstance()</span></code></a> checks comparing objects to the protocol. For example:</p>
<div><div><pre><span></span><span>&gt;&gt;&gt; </span><span>from</span> <span>typing</span> <span>import</span> <span>Protocol</span><span>,</span> <span>runtime_checkable</span>
<span>&gt;&gt;&gt; </span><span>@runtime_checkable</span>
<span>... </span><span>class</span> <span>HasX</span><span>(</span><span>Protocol</span><span>):</span>
<span>... </span>    <span>x</span> <span>=</span> <span>1</span>
<span>...</span>
<span>&gt;&gt;&gt; </span><span>class</span> <span>Foo</span><span>:</span> <span>...</span>
<span>...</span>
<span>&gt;&gt;&gt; </span><span>f</span> <span>=</span> <span>Foo</span><span>()</span>
<span>&gt;&gt;&gt; </span><span>isinstance</span><span>(</span><span>f</span><span>,</span> <span>HasX</span><span>)</span>
<span>False</span>
<span>&gt;&gt;&gt; </span><span>f</span><span>.</span><span>x</span> <span>=</span> <span>1</span>
<span>&gt;&gt;&gt; </span><span>isinstance</span><span>(</span><span>f</span><span>,</span> <span>HasX</span><span>)</span>
<span>True</span>
<span>&gt;&gt;&gt; </span><span>HasX</span><span>.</span><span>y</span> <span>=</span> <span>2</span>
<span>&gt;&gt;&gt; </span><span>isinstance</span><span>(</span><span>f</span><span>,</span> <span>HasX</span><span>)</span>  <span># unchanged, even though HasX now also has a &#34;y&#34; attribute</span>
<span>True</span>
</pre></div>
</div>
<p>This change was made in order to speed up <code><span>isinstance()</span></code> checks against
runtime-checkable protocols.</p>
</li>
<li><p>The performance profile of <a href="https://www.wildlondon.org.uk/blog/library/functions.html#isinstance" title="isinstance"><code><span>isinstance()</span></code></a> checks against
<a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.runtime_checkable" title="typing.runtime_checkable"><code><span>runtime-checkable</span> <span>protocols</span></code></a> has changed
significantly. Most <code><span>isinstance()</span></code> checks against protocols with only a few
members should be at least 2x faster than in 3.11, and some may be 20x
faster or more. However, <code><span>isinstance()</span></code> checks against protocols with fourteen
or more members may be slower than in Python 3.11. (Contributed by Alex
Waygood in <a href="https://github.com/python/cpython/issues/74690">gh-74690</a> and <a href="https://github.com/python/cpython/issues/103193">gh-103193</a>.)</p></li>
<li><p>All <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.TypedDict" title="typing.TypedDict"><code><span>typing.TypedDict</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.NamedTuple" title="typing.NamedTuple"><code><span>typing.NamedTuple</span></code></a> classes now have the
<code><span>__orig_bases__</span></code> attribute. (Contributed by Adrian Garcia Badaracco in
<a href="https://github.com/python/cpython/issues/103699">gh-103699</a>.)</p></li>
<li><p>Add <code><span>frozen_default</span></code> parameter to <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.dataclass_transform" title="typing.dataclass_transform"><code><span>typing.dataclass_transform()</span></code></a>.
(Contributed by Erik De Bonte in <a href="https://github.com/python/cpython/issues/99957">gh-99957</a>.)</p></li>
</ul>
</section>
<section id="unicodedata">
<h3>unicodedata<a href="#unicodedata" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The Unicode database has been updated to version 15.0.0. (Contributed by
Benjamin Peterson in <a href="https://github.com/python/cpython/issues/96734">gh-96734</a>).</p></li>
</ul>
</section>
<section id="unittest">
<h3>unittest<a href="#unittest" title="Permalink to this headline">¶</a></h3>
<p>Add a <code><span>--durations</span></code> command line option, showing the N slowest test cases:</p>
<div><div><pre><span></span><span>python3</span> <span>-</span><span>m</span> <span>unittest</span> <span>--</span><span>durations</span><span>=</span><span>3</span> <span>lib</span><span>.</span><span>tests</span><span>.</span><span>test_threading</span>
<span>.....</span>
<span>Slowest</span> <span>test</span> <span>durations</span>
<span>----------------------------------------------------------------------</span>
<span>1.210</span><span>s</span>     <span>test_timeout</span> <span>(</span><span>Lib</span><span>.</span><span>test</span><span>.</span><span>test_threading</span><span>.</span><span>BarrierTests</span><span>)</span>
<span>1.003</span><span>s</span>     <span>test_default_timeout</span> <span>(</span><span>Lib</span><span>.</span><span>test</span><span>.</span><span>test_threading</span><span>.</span><span>BarrierTests</span><span>)</span>
<span>0.518</span><span>s</span>     <span>test_timeout</span> <span>(</span><span>Lib</span><span>.</span><span>test</span><span>.</span><span>test_threading</span><span>.</span><span>EventTests</span><span>)</span>

<span>(</span><span>0.000</span> <span>durations</span> <span>hidden</span><span>.</span>  <span>Use</span> <span>-</span><span>v</span> <span>to</span> <span>show</span> <span>these</span> <span>durations</span><span>.</span><span>)</span>
<span>----------------------------------------------------------------------</span>
<span>Ran</span> <span>158</span> <span>tests</span> <span>in</span> <span>9.869</span><span>s</span>

<span>OK</span> <span>(</span><span>skipped</span><span>=</span><span>3</span><span>)</span>
</pre></div>
</div>
<p>(Contributed by Giampaolo Rodola in <a href="https://github.com/python/cpython/issues/48330">gh-48330</a>)</p>
</section>
<section id="uuid">
<h3>uuid<a href="#uuid" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Add a <a href="https://www.wildlondon.org.uk/blog/library/uuid.html#uuid-cli"><span>command-line interface</span></a>.
(Contributed by Adam Chhina in <a href="https://github.com/python/cpython/issues/88597">gh-88597</a>.)</p></li>
</ul>
</section>
</section>
<section id="optimizations">
<h2>Optimizations<a href="#optimizations" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Remove <code><span>wstr</span></code> and <code><span>wstr_length</span></code> members from Unicode objects.
It reduces object size by 8 or 16 bytes on 64bit platform. (<span id="index-26"></span><a href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a>)
(Contributed by Inada Naoki in <a href="https://github.com/python/cpython/issues/92536">gh-92536</a>.)</p></li>
<li><p>Add experimental support for using the BOLT binary optimizer in the build
process, which improves performance by 1-5%.
(Contributed by Kevin Modzelewski in <a href="https://github.com/python/cpython/issues/90536">gh-90536</a> and tuned by Donghee Na in <a href="https://github.com/python/cpython/issues/101525">gh-101525</a>)</p></li>
<li><p>Speed up the regular expression substitution (functions <a href="https://www.wildlondon.org.uk/blog/library/re.html#re.sub" title="re.sub"><code><span>re.sub()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/re.html#re.subn" title="re.subn"><code><span>re.subn()</span></code></a> and corresponding <code><span>re.Pattern</span></code> methods) for
replacement strings containing group references by 2–3 times.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/91524">gh-91524</a>.)</p></li>
<li><p>Speed up <a href="https://www.wildlondon.org.uk/blog/library/asyncio-task.html#asyncio.Task" title="asyncio.Task"><code><span>asyncio.Task</span></code></a> creation by deferring expensive string formatting.
(Contributed by Itamar Oren in <a href="https://github.com/python/cpython/issues/103793">gh-103793</a>.)</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#tokenize.tokenize" title="tokenize.tokenize"><code><span>tokenize.tokenize()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#tokenize.generate_tokens" title="tokenize.generate_tokens"><code><span>tokenize.generate_tokens()</span></code></a> functions are
up to 64% faster as a side effect of the changes required to cover <span id="index-27"></span><a href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a> in
the <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#module-tokenize" title="tokenize: Lexical scanner for Python source code."><code><span>tokenize</span></code></a> module. (Contributed by Marta Gómez Macías and Pablo Galindo
in <a href="https://github.com/python/cpython/issues/102856">gh-102856</a>.)</p></li>
<li><p>Speed up <a href="https://www.wildlondon.org.uk/blog/library/functions.html#super" title="super"><code><span>super()</span></code></a> method calls and attribute loads via the
new <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_SUPER_ATTR"><code><span>LOAD_SUPER_ATTR</span></code></a> instruction. (Contributed by Carl Meyer and
Vladimir Matveev in <a href="https://github.com/python/cpython/issues/103497">gh-103497</a>.)</p></li>
</ul>
</section>
<section id="cpython-bytecode-changes">
<h2>CPython bytecode changes<a href="#cpython-bytecode-changes" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Remove the <code><span>LOAD_METHOD</span></code> instruction. It has been merged into
<a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_ATTR"><code><span>LOAD_ATTR</span></code></a>. <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_ATTR"><code><span>LOAD_ATTR</span></code></a> will now behave like the old
<code><span>LOAD_METHOD</span></code> instruction if the low bit of its oparg is set.
(Contributed by Ken Jin in <a href="https://github.com/python/cpython/issues/93429">gh-93429</a>.)</p></li>
<li><p>Remove the <code><span>JUMP_IF_FALSE_OR_POP</span></code> and <code><span>JUMP_IF_TRUE_OR_POP</span></code>
instructions. (Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/102859">gh-102859</a>.)</p></li>
<li><p>Remove the <code><span>PRECALL</span></code> instruction. (Contributed by Mark Shannon in
<a href="https://github.com/python/cpython/issues/92925">gh-92925</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-BINARY_SLICE"><code><span>BINARY_SLICE</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-STORE_SLICE"><code><span>STORE_SLICE</span></code></a> instructions.
(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/94163">gh-94163</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-CALL_INTRINSIC_1"><code><span>CALL_INTRINSIC_1</span></code></a> instructions.
(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/99005">gh-99005</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-CALL_INTRINSIC_2"><code><span>CALL_INTRINSIC_2</span></code></a> instruction.
(Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/101799">gh-101799</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-CLEANUP_THROW"><code><span>CLEANUP_THROW</span></code></a> instruction.
(Contributed by Brandt Bucher in <a href="https://github.com/python/cpython/issues/90997">gh-90997</a>.)</p></li>
<li><p>Add the <code><span>END_SEND</span></code> instruction.
(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/103082">gh-103082</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_FAST_AND_CLEAR"><code><span>LOAD_FAST_AND_CLEAR</span></code></a> instruction as part of the
implementation of <span id="index-28"></span><a href="https://peps.python.org/pep-0709/"><strong>PEP 709</strong></a>. (Contributed by Carl Meyer in <a href="https://github.com/python/cpython/issues/101441">gh-101441</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_FAST_CHECK"><code><span>LOAD_FAST_CHECK</span></code></a> instruction.
(Contributed by Dennis Sweeney in <a href="https://github.com/python/cpython/issues/93143">gh-93143</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_FROM_DICT_OR_DEREF"><code><span>LOAD_FROM_DICT_OR_DEREF</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_FROM_DICT_OR_GLOBALS"><code><span>LOAD_FROM_DICT_OR_GLOBALS</span></code></a>,
and <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_LOCALS"><code><span>LOAD_LOCALS</span></code></a> opcodes as part of the implementation of <span id="index-29"></span><a href="https://peps.python.org/pep-0695/"><strong>PEP 695</strong></a>.
Remove the <code><span>LOAD_CLASSDEREF</span></code> opcode, which can be replaced with
<a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_LOCALS"><code><span>LOAD_LOCALS</span></code></a> plus <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_FROM_DICT_OR_DEREF"><code><span>LOAD_FROM_DICT_OR_DEREF</span></code></a>. (Contributed
by Jelle Zijlstra in <a href="https://github.com/python/cpython/issues/103764">gh-103764</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-LOAD_SUPER_ATTR"><code><span>LOAD_SUPER_ATTR</span></code></a> instruction. (Contributed by Carl Meyer and
Vladimir Matveev in <a href="https://github.com/python/cpython/issues/103497">gh-103497</a>.)</p></li>
<li><p>Add the <a href="https://www.wildlondon.org.uk/blog/library/dis.html#opcode-RETURN_CONST"><code><span>RETURN_CONST</span></code></a> instruction. (Contributed by Wenyang Wang in <a href="https://github.com/python/cpython/issues/101632">gh-101632</a>.)</p></li>
</ul>
</section>
<section id="demos-and-tools">
<h2>Demos and Tools<a href="#demos-and-tools" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Remove the <code><span>Tools/demo/</span></code> directory which contained old demo scripts. A copy
can be found in the <a href="https://github.com/gvanrossum/old-demos">old-demos project</a>.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/97681">gh-97681</a>.)</p></li>
<li><p>Remove outdated example scripts of the <code><span>Tools/scripts/</span></code> directory.
A copy can be found in the <a href="https://github.com/gvanrossum/old-demos">old-demos project</a>.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/97669">gh-97669</a>.)</p></li>
</ul>
</section>
<section id="deprecated">
<h2>Deprecated<a href="#deprecated" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code><span>argparse</span></code></a>: The <em>type</em>, <em>choices</em>, and <em>metavar</em> parameters
of <code><span>argparse.BooleanOptionalAction</span></code> are deprecated
and will be removed in 3.14.
(Contributed by Nikita Sobolev in <a href="https://github.com/python/cpython/issues/92248">gh-92248</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code><span>ast</span></code></a>: The following <a href="https://www.wildlondon.org.uk/blog/library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code><span>ast</span></code></a> features have been deprecated in documentation since
Python 3.8, now cause a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> to be emitted at runtime
when they are accessed or used, and will be removed in Python 3.14:</p>
<ul>
<li><p><code><span>ast.Num</span></code></p></li>
<li><p><code><span>ast.Str</span></code></p></li>
<li><p><code><span>ast.Bytes</span></code></p></li>
<li><p><code><span>ast.NameConstant</span></code></p></li>
<li><p><code><span>ast.Ellipsis</span></code></p></li>
</ul>
<p>Use <a href="https://www.wildlondon.org.uk/blog/library/ast.html#ast.Constant" title="ast.Constant"><code><span>ast.Constant</span></code></a> instead.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/90953">gh-90953</a>.)</p>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a>:</p>
<ul>
<li><p>The child watcher classes <a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.MultiLoopChildWatcher" title="asyncio.MultiLoopChildWatcher"><code><span>asyncio.MultiLoopChildWatcher</span></code></a>,
<a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.FastChildWatcher" title="asyncio.FastChildWatcher"><code><span>asyncio.FastChildWatcher</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.AbstractChildWatcher" title="asyncio.AbstractChildWatcher"><code><span>asyncio.AbstractChildWatcher</span></code></a>
and <a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.SafeChildWatcher" title="asyncio.SafeChildWatcher"><code><span>asyncio.SafeChildWatcher</span></code></a> are deprecated and
will be removed in Python 3.14.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/94597">gh-94597</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.set_child_watcher" title="asyncio.set_child_watcher"><code><span>asyncio.set_child_watcher()</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.get_child_watcher" title="asyncio.get_child_watcher"><code><span>asyncio.get_child_watcher()</span></code></a>,
<a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.set_child_watcher" title="asyncio.AbstractEventLoopPolicy.set_child_watcher"><code><span>asyncio.AbstractEventLoopPolicy.set_child_watcher()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/asyncio-policy.html#asyncio.AbstractEventLoopPolicy.get_child_watcher" title="asyncio.AbstractEventLoopPolicy.get_child_watcher"><code><span>asyncio.AbstractEventLoopPolicy.get_child_watcher()</span></code></a> are deprecated
and will be removed in Python 3.14.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/94597">gh-94597</a>.)</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/asyncio-eventloop.html#asyncio.get_event_loop" title="asyncio.get_event_loop"><code><span>get_event_loop()</span></code></a> method of the
default event loop policy now emits a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> if there
is no current event loop set and it decides to create one.
(Contributed by Serhiy Storchaka and Guido van Rossum in <a href="https://github.com/python/cpython/issues/100160">gh-100160</a>.)</p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/calendar.html#module-calendar" title="calendar: Functions for working with calendars, including some emulation of the Unix cal program."><code><span>calendar</span></code></a>: <code><span>calendar.January</span></code> and <code><span>calendar.February</span></code> constants are deprecated and
replaced by <a href="https://www.wildlondon.org.uk/blog/library/calendar.html#calendar.JANUARY" title="calendar.JANUARY"><code><span>calendar.JANUARY</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/calendar.html#calendar.FEBRUARY" title="calendar.FEBRUARY"><code><span>calendar.FEBRUARY</span></code></a>.
(Contributed by Prince Roshan in <a href="https://github.com/python/cpython/issues/103636">gh-103636</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#module-collections.abc" title="collections.abc: Abstract base classes for containers"><code><span>collections.abc</span></code></a>: Deprecated <a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#collections.abc.ByteString" title="collections.abc.ByteString"><code><span>collections.abc.ByteString</span></code></a>.
Prefer <code><span>Sequence</span></code> or <a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#collections.abc.Buffer" title="collections.abc.Buffer"><code><span>collections.abc.Buffer</span></code></a>.
For use in typing, prefer a union, like <code><span>bytes</span> <span>|</span> <span>bytearray</span></code>, or <a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#collections.abc.Buffer" title="collections.abc.Buffer"><code><span>collections.abc.Buffer</span></code></a>.
(Contributed by Shantanu Jain in <a href="https://github.com/python/cpython/issues/91896">gh-91896</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/datetime.html#module-datetime" title="datetime: Basic date and time types."><code><span>datetime</span></code></a>: <a href="https://www.wildlondon.org.uk/blog/library/datetime.html#datetime.datetime" title="datetime.datetime"><code><span>datetime.datetime</span></code></a>’s <a href="https://www.wildlondon.org.uk/blog/library/datetime.html#datetime.datetime.utcnow" title="datetime.datetime.utcnow"><code><span>utcnow()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/datetime.html#datetime.datetime.utcfromtimestamp" title="datetime.datetime.utcfromtimestamp"><code><span>utcfromtimestamp()</span></code></a> are deprecated and will be
removed in a future version. Instead, use timezone-aware objects to represent
datetimes in UTC: respectively, call <a href="https://www.wildlondon.org.uk/blog/library/datetime.html#datetime.datetime.now" title="datetime.datetime.now"><code><span>now()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/library/datetime.html#datetime.datetime.fromtimestamp" title="datetime.datetime.fromtimestamp"><code><span>fromtimestamp()</span></code></a>  with the <em>tz</em> parameter set to
<a href="https://www.wildlondon.org.uk/blog/library/datetime.html#datetime.UTC" title="datetime.UTC"><code><span>datetime.UTC</span></code></a>.
(Contributed by Paul Ganssle in <a href="https://github.com/python/cpython/issues/103857">gh-103857</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code><span>email</span></code></a>: Deprecate the <em>isdst</em> parameter in <a href="https://www.wildlondon.org.uk/blog/library/email.utils.html#email.utils.localtime" title="email.utils.localtime"><code><span>email.utils.localtime()</span></code></a>.
(Contributed by Alan Williams in <a href="https://github.com/python/cpython/issues/72346">gh-72346</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/importlib.html#module-importlib.abc" title="importlib.abc: Abstract base classes related to import"><code><span>importlib.abc</span></code></a>: Deprecated the following classes, scheduled for removal in
Python 3.14:</p>
<ul>
<li><p><code><span>importlib.abc.ResourceReader</span></code></p></li>
<li><p><code><span>importlib.abc.Traversable</span></code></p></li>
<li><p><code><span>importlib.abc.TraversableResources</span></code></p></li>
</ul>
<p>Use <a href="https://www.wildlondon.org.uk/blog/library/importlib.resources.abc.html#module-importlib.resources.abc" title="importlib.resources.abc: Abstract base classes for resources"><code><span>importlib.resources.abc</span></code></a> classes instead:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/importlib.resources.abc.html#importlib.resources.abc.Traversable" title="importlib.resources.abc.Traversable"><code><span>importlib.resources.abc.Traversable</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/importlib.resources.abc.html#importlib.resources.abc.TraversableResources" title="importlib.resources.abc.TraversableResources"><code><span>importlib.resources.abc.TraversableResources</span></code></a></p></li>
</ul>
<p>(Contributed by Jason R. Coombs and Hugo van Kemenade in <a href="https://github.com/python/cpython/issues/93963">gh-93963</a>.)</p>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code><span>itertools</span></code></a>: Deprecate the support for copy, deepcopy, and pickle operations,
which is undocumented, inefficient, historically buggy, and inconsistent.
This will be removed in 3.14 for a significant reduction in code
volume and maintenance burden.
(Contributed by Raymond Hettinger in <a href="https://github.com/python/cpython/issues/101588">gh-101588</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/multiprocessing.html#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code><span>multiprocessing</span></code></a>: In Python 3.14, the default <a href="https://www.wildlondon.org.uk/blog/library/multiprocessing.html#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code><span>multiprocessing</span></code></a>
start method will change to a safer one on Linux, BSDs,
and other non-macOS POSIX platforms where <code><span>&#39;fork&#39;</span></code> is currently
the default (<a href="https://github.com/python/cpython/issues/84559">gh-84559</a>). Adding a runtime warning about this was deemed too
disruptive as the majority of code is not expected to care. Use the
<a href="https://www.wildlondon.org.uk/blog/library/multiprocessing.html#multiprocessing.get_context" title="multiprocessing.get_context"><code><span>get_context()</span></code></a> or
<a href="https://www.wildlondon.org.uk/blog/library/multiprocessing.html#multiprocessing.set_start_method" title="multiprocessing.set_start_method"><code><span>set_start_method()</span></code></a> APIs to explicitly specify when
your code <em>requires</em> <code><span>&#39;fork&#39;</span></code>.  See <a href="https://www.wildlondon.org.uk/blog/library/multiprocessing.html#multiprocessing-start-methods"><span>contexts and start methods</span></a>.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/pkgutil.html#module-pkgutil" title="pkgutil: Utilities for the import system."><code><span>pkgutil</span></code></a>: <a href="https://www.wildlondon.org.uk/blog/library/pkgutil.html#pkgutil.find_loader" title="pkgutil.find_loader"><code><span>pkgutil.find_loader()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/pkgutil.html#pkgutil.get_loader" title="pkgutil.get_loader"><code><span>pkgutil.get_loader()</span></code></a>
are deprecated and will be removed in Python 3.14;
use <a href="https://www.wildlondon.org.uk/blog/library/importlib.html#importlib.util.find_spec" title="importlib.util.find_spec"><code><span>importlib.util.find_spec()</span></code></a> instead.
(Contributed by Nikita Sobolev in <a href="https://github.com/python/cpython/issues/97850">gh-97850</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/pty.html#module-pty" title="pty: Pseudo-Terminal Handling for Unix. (Unix)"><code><span>pty</span></code></a>: The module has two undocumented <code><span>master_open()</span></code> and <code><span>slave_open()</span></code>
functions that have been deprecated since Python 2 but only gained a
proper <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> in 3.12. Remove them in 3.14.
(Contributed by Soumendra Ganguly and Gregory P. Smith in <a href="https://github.com/python/cpython/issues/85984">gh-85984</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code><span>os</span></code></a>:</p>
<ul>
<li><p>The <code><span>st_ctime</span></code> fields return by <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.stat" title="os.stat"><code><span>os.stat()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.lstat" title="os.lstat"><code><span>os.lstat()</span></code></a> on
Windows are deprecated. In a future release, they will contain the last
metadata change time, consistent with other platforms. For now, they still
contain the creation time, which is also available in the new <code><span>st_birthtime</span></code>
field. (Contributed by Steve Dower in <a href="https://github.com/python/cpython/issues/99726">gh-99726</a>.)</p></li>
<li><p>On POSIX platforms, <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.fork" title="os.fork"><code><span>os.fork()</span></code></a> can now raise a
<a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> when it can detect being called from a
multithreaded process. There has always been a fundamental incompatibility
with the POSIX platform when doing so. Even if such code <em>appeared</em> to work.
We added the warning to to raise awareness as issues encounted by code doing
this are becoming more frequent. See the <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.fork" title="os.fork"><code><span>os.fork()</span></code></a> documentation for
more details along with <a href="https://discuss.python.org/t/33555">this discussion on fork being incompatible with threads</a> for <em>why</em> we’re now surfacing this
longstanding platform compatibility problem to developers.</p></li>
</ul>
<p>When this warning appears due to usage of <a href="https://www.wildlondon.org.uk/blog/library/multiprocessing.html#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code><span>multiprocessing</span></code></a> or
<a href="https://www.wildlondon.org.uk/blog/library/concurrent.futures.html#module-concurrent.futures" title="concurrent.futures: Execute computations concurrently using threads or processes."><code><span>concurrent.futures</span></code></a> the fix is to use a different
<a href="https://www.wildlondon.org.uk/blog/library/multiprocessing.html#module-multiprocessing" title="multiprocessing: Process-based parallelism."><code><span>multiprocessing</span></code></a> start method such as <code><span>&#34;spawn&#34;</span></code> or <code><span>&#34;forkserver&#34;</span></code>.</p>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code><span>shutil</span></code></a>: The <em>onerror</em> argument of <a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.rmtree" title="shutil.rmtree"><code><span>shutil.rmtree()</span></code></a> is deprecated and will be removed
in Python 3.14. Use <em>onexc</em> instead. (Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/102828">gh-102828</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code><span>sqlite3</span></code></a>:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3-default-converters"><span>default adapters and converters</span></a> are now deprecated.
Instead, use the <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3-adapter-converter-recipes"><span>Adapter and converter recipes</span></a>
and tailor them to your needs.
(Contributed by Erlend E. Aasland in <a href="https://github.com/python/cpython/issues/90016">gh-90016</a>.)</p></li>
<li><p>In <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.Cursor.execute" title="sqlite3.Cursor.execute"><code><span>execute()</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> is now emitted
when <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3-placeholders"><span>named placeholders</span></a> are used together with
parameters supplied as a <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-sequence"><span>sequence</span></a> instead of as a <a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#dict" title="dict"><code><span>dict</span></code></a>.
Starting from Python 3.14, using named placeholders with parameters supplied
as a sequence will raise a <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#sqlite3.ProgrammingError" title="sqlite3.ProgrammingError"><code><span>ProgrammingError</span></code></a>.
(Contributed by Erlend E. Aasland in <a href="https://github.com/python/cpython/issues/101698">gh-101698</a>.)</p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sys.html#module-sys" title="sys: Access system-specific parameters and functions."><code><span>sys</span></code></a>: The <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_type" title="sys.last_type"><code><span>sys.last_type</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_value" title="sys.last_value"><code><span>sys.last_value</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_traceback" title="sys.last_traceback"><code><span>sys.last_traceback</span></code></a>
fields are deprecated. Use <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.last_exc" title="sys.last_exc"><code><span>sys.last_exc</span></code></a> instead.
(Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/102778">gh-102778</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code><span>tarfile</span></code></a>: Extracting tar archives without specifying <em>filter</em> is deprecated until
Python 3.14, when <code><span>&#39;data&#39;</span></code> filter will become the default.
See <a href="https://www.wildlondon.org.uk/blog/library/tarfile.html#tarfile-extraction-filter"><span>Extraction filters</span></a> for details.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code><span>typing</span></code></a>:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.Hashable" title="typing.Hashable"><code><span>typing.Hashable</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.Sized" title="typing.Sized"><code><span>typing.Sized</span></code></a> aliases for <a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#collections.abc.Hashable" title="collections.abc.Hashable"><code><span>collections.abc.Hashable</span></code></a>
and <a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#collections.abc.Sized" title="collections.abc.Sized"><code><span>collections.abc.Sized</span></code></a>. (<a href="https://github.com/python/cpython/issues/94309">gh-94309</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.ByteString" title="typing.ByteString"><code><span>typing.ByteString</span></code></a>, deprecated since Python 3.9, now causes a
<a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> to be emitted when it is used.
(Contributed by Alex Waygood in <a href="https://github.com/python/cpython/issues/91896">gh-91896</a>.)</p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code><span>xml.etree.ElementTree</span></code></a>: The module now emits <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a>
when testing the truth value of an <a href="https://www.wildlondon.org.uk/blog/library/xml.etree.elementtree.html#xml.etree.ElementTree.Element" title="xml.etree.ElementTree.Element"><code><span>xml.etree.ElementTree.Element</span></code></a>.
Before, the Python implementation emitted <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#FutureWarning" title="FutureWarning"><code><span>FutureWarning</span></code></a>, and the C
implementation emitted nothing.
(Contributed by Jacob Walls in <a href="https://github.com/python/cpython/issues/83122">gh-83122</a>.)</p></li>
<li><p>The 3-arg signatures (type, value, traceback) of <a href="https://www.wildlondon.org.uk/blog/reference/datamodel.html#coroutine.throw" title="coroutine.throw"><code><span>coroutine</span> <span>throw()</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/reference/expressions.html#generator.throw" title="generator.throw"><code><span>generator</span> <span>throw()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/reference/expressions.html#agen.athrow" title="agen.athrow"><code><span>async</span> <span>generator</span> <span>throw()</span></code></a> are deprecated and
may be removed in a future version of Python. Use the single-arg versions
of these functions instead. (Contributed by Ofey Chan in <a href="https://github.com/python/cpython/issues/89874">gh-89874</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> is now raised when <code><span>__package__</span></code> on a
module differs from <code><span>__spec__.parent</span></code> (previously it was
<a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#ImportWarning" title="ImportWarning"><code><span>ImportWarning</span></code></a>).
(Contributed by Brett Cannon in <a href="https://github.com/python/cpython/issues/65961">gh-65961</a>.)</p></li>
<li><p>Setting <code><span>__package__</span></code> or <code><span>__cached__</span></code> on a module is deprecated,
and will cease to be set or taken into consideration by the import system in Python 3.14.
(Contributed by Brett Cannon in <a href="https://github.com/python/cpython/issues/65961">gh-65961</a>.)</p></li>
<li><p>The bitwise inversion operator (<code><span>~</span></code>) on bool is deprecated. It will throw an
error in Python 3.14. Use <code><span>not</span></code> for logical negation of bools instead.
In the rare case that you really need the bitwise inversion of the underlying
<code><span>int</span></code>, convert to int explicitly: <code><span>~int(x)</span></code>. (Contributed by Tim Hoffmann
in <a href="https://github.com/python/cpython/issues/103487">gh-103487</a>.)</p></li>
<li><p>Accessing <code><span>co_lnotab</span></code> on code objects was deprecated in Python 3.10 via <span id="index-30"></span><a href="https://peps.python.org/pep-0626/"><strong>PEP 626</strong></a>,
but it only got a proper <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#DeprecationWarning" title="DeprecationWarning"><code><span>DeprecationWarning</span></code></a> in 3.12,
therefore it will be removed in 3.14.
(Contributed by Nikita Sobolev in <a href="https://github.com/python/cpython/issues/101866">gh-101866</a>.)</p></li>
</ul>
<section id="pending-removal-in-python-3-13">
<h3>Pending Removal in Python 3.13<a href="#pending-removal-in-python-3-13" title="Permalink to this headline">¶</a></h3>
<p>The following modules and APIs have been deprecated in earlier Python releases,
and will be removed in Python 3.13.</p>
<p>Modules (see <span id="index-31"></span><a href="https://peps.python.org/pep-0594/"><strong>PEP 594</strong></a>):</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/aifc.html#module-aifc" title="aifc: Read and write audio files in AIFF or AIFC format. (deprecated)"><code><span>aifc</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/audioop.html#module-audioop" title="audioop: Manipulate raw audio data. (deprecated)"><code><span>audioop</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/cgi.html#module-cgi" title="cgi: Helpers for running Python scripts via the Common Gateway Interface. (deprecated)"><code><span>cgi</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/cgitb.html#module-cgitb" title="cgitb: Configurable traceback handler for CGI scripts. (deprecated)"><code><span>cgitb</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/chunk.html#module-chunk" title="chunk: Module to read IFF chunks. (deprecated)"><code><span>chunk</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/crypt.html#module-crypt" title="crypt: The crypt() function used to check Unix passwords. (deprecated) (Unix)"><code><span>crypt</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/imghdr.html#module-imghdr" title="imghdr: Determine the type of image contained in a file or byte stream. (deprecated)"><code><span>imghdr</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/mailcap.html#module-mailcap" title="mailcap: Mailcap file handling. (deprecated)"><code><span>mailcap</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/msilib.html#module-msilib" title="msilib: Creation of Microsoft Installer files, and CAB files. (deprecated) (Windows)"><code><span>msilib</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/nis.html#module-nis" title="nis: Interface to Sun&#39;s NIS (Yellow Pages) library. (deprecated) (Unix)"><code><span>nis</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/nntplib.html#module-nntplib" title="nntplib: NNTP protocol client (requires sockets). (deprecated)"><code><span>nntplib</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/ossaudiodev.html#module-ossaudiodev" title="ossaudiodev: Access to OSS-compatible audio devices. (deprecated) (Linux, FreeBSD)"><code><span>ossaudiodev</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/pipes.html#module-pipes" title="pipes: A Python interface to Unix shell pipelines. (deprecated) (Unix)"><code><span>pipes</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sndhdr.html#module-sndhdr" title="sndhdr: Determine type of a sound file. (deprecated)"><code><span>sndhdr</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/spwd.html#module-spwd" title="spwd: The shadow password database (getspnam() and friends). (deprecated) (Unix)"><code><span>spwd</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sunau.html#module-sunau" title="sunau: Provide an interface to the Sun AU sound format. (deprecated)"><code><span>sunau</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/telnetlib.html#module-telnetlib" title="telnetlib: Telnet client class. (deprecated)"><code><span>telnetlib</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/uu.html#module-uu" title="uu: Encode and decode files in uuencode format. (deprecated)"><code><span>uu</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/xdrlib.html#module-xdrlib" title="xdrlib: Encoders and decoders for the External Data Representation (XDR). (deprecated)"><code><span>xdrlib</span></code></a></p></li>
</ul>
<p>Other modules:</p>
<ul>
<li><p><code><span>lib2to3</span></code>, and the <strong>2to3</strong> program (<a href="https://github.com/python/cpython/issues/84540">gh-84540</a>)</p></li>
</ul>
<p>APIs:</p>
<ul>
<li><p><code><span>configparser.LegacyInterpolation</span></code> (<a href="https://github.com/python/cpython/issues/90765">gh-90765</a>)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/locale.html#locale.getdefaultlocale" title="locale.getdefaultlocale"><code><span>locale.getdefaultlocale()</span></code></a> (<a href="https://github.com/python/cpython/issues/90817">gh-90817</a>)</p></li>
<li><p><code><span>turtle.RawTurtle.settiltangle()</span></code> (<a href="https://github.com/python/cpython/issues/50096">gh-50096</a>)</p></li>
<li><p><code><span>unittest.findTestCases()</span></code> (<a href="https://github.com/python/cpython/issues/50096">gh-50096</a>)</p></li>
<li><p><code><span>unittest.getTestCaseNames()</span></code> (<a href="https://github.com/python/cpython/issues/50096">gh-50096</a>)</p></li>
<li><p><code><span>unittest.makeSuite()</span></code> (<a href="https://github.com/python/cpython/issues/50096">gh-50096</a>)</p></li>
<li><p><code><span>unittest.TestProgram.usageExit()</span></code> (<a href="https://github.com/python/cpython/issues/67048">gh-67048</a>)</p></li>
<li><p><code><span>webbrowser.MacOSX</span></code> (<a href="https://github.com/python/cpython/issues/86421">gh-86421</a>)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/functions.html#classmethod" title="classmethod"><code><span>classmethod</span></code></a> descriptor chaining (<a href="https://github.com/python/cpython/issues/89519">gh-89519</a>)</p></li>
</ul>
</section>
<section id="pending-removal-in-python-3-14">
<h3>Pending Removal in Python 3.14<a href="#pending-removal-in-python-3-14" title="Permalink to this headline">¶</a></h3>
<p>The following APIs have been deprecated
and will be removed in Python 3.14.</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/argparse.html#module-argparse" title="argparse: Command-line option and argument parsing library."><code><span>argparse</span></code></a>: The <em>type</em>, <em>choices</em>, and <em>metavar</em> parameters
of <code><span>argparse.BooleanOptionalAction</span></code></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/ast.html#module-ast" title="ast: Abstract Syntax Tree classes and manipulation."><code><span>ast</span></code></a>:</p>
<ul>
<li><p><code><span>ast.Num</span></code></p></li>
<li><p><code><span>ast.Str</span></code></p></li>
<li><p><code><span>ast.Bytes</span></code></p></li>
<li><p><code><span>ast.NameConstant</span></code></p></li>
<li><p><code><span>ast.Ellipsis</span></code></p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a>:</p>
<ul>
<li><p><code><span>asyncio.MultiLoopChildWatcher</span></code></p></li>
<li><p><code><span>asyncio.FastChildWatcher</span></code></p></li>
<li><p><code><span>asyncio.AbstractChildWatcher</span></code></p></li>
<li><p><code><span>asyncio.SafeChildWatcher</span></code></p></li>
<li><p><code><span>asyncio.set_child_watcher()</span></code></p></li>
<li><p><code><span>asyncio.get_child_watcher()</span></code>,</p></li>
<li><p><code><span>asyncio.AbstractEventLoopPolicy.set_child_watcher()</span></code></p></li>
<li><p><code><span>asyncio.AbstractEventLoopPolicy.get_child_watcher()</span></code></p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/collections.abc.html#module-collections.abc" title="collections.abc: Abstract base classes for containers"><code><span>collections.abc</span></code></a>: <code><span>collections.abc.ByteString</span></code>.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/email.html#module-email" title="email: Package supporting the parsing, manipulating, and generating email messages."><code><span>email</span></code></a>: the <em>isdst</em> parameter in <a href="https://www.wildlondon.org.uk/blog/library/email.utils.html#email.utils.localtime" title="email.utils.localtime"><code><span>email.utils.localtime()</span></code></a>.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/importlib.html#module-importlib.abc" title="importlib.abc: Abstract base classes related to import"><code><span>importlib.abc</span></code></a>:</p>
<ul>
<li><p><code><span>importlib.abc.ResourceReader</span></code></p></li>
<li><p><code><span>importlib.abc.Traversable</span></code></p></li>
<li><p><code><span>importlib.abc.TraversableResources</span></code></p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/itertools.html#module-itertools" title="itertools: Functions creating iterators for efficient looping."><code><span>itertools</span></code></a>: Support for copy, deepcopy, and pickle operations.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/pkgutil.html#module-pkgutil" title="pkgutil: Utilities for the import system."><code><span>pkgutil</span></code></a>:</p>
<ul>
<li><p><code><span>pkgutil.find_loader()</span></code></p></li>
<li><p><code><span>pkgutil.get_loader()</span></code>.</p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/pty.html#module-pty" title="pty: Pseudo-Terminal Handling for Unix. (Unix)"><code><span>pty</span></code></a>:</p>
<ul>
<li><p><code><span>pty.master_open()</span></code></p></li>
<li><p><code><span>pty.slave_open()</span></code></p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/shutil.html#module-shutil" title="shutil: High-level file operations, including copying."><code><span>shutil</span></code></a>: The <em>onerror</em> argument of <a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.rmtree" title="shutil.rmtree"><code><span>shutil.rmtree()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/typing.html#module-typing" title="typing: Support for type hints (see :pep:`484`)."><code><span>typing</span></code></a>: <code><span>typing.ByteString</span></code></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code><span>xml.etree.ElementTree</span></code></a>: Testing the truth value of an <a href="https://www.wildlondon.org.uk/blog/library/xml.etree.elementtree.html#xml.etree.ElementTree.Element" title="xml.etree.ElementTree.Element"><code><span>xml.etree.ElementTree.Element</span></code></a>.</p></li>
<li><p>The <code><span>__package__</span></code> and <code><span>__cached__</span></code> attributes on module objects.</p></li>
<li><p>The <code><span>co_lnotab</span></code> attribute of code objects.</p></li>
</ul>
</section>
<section id="pending-removal-in-future-versions">
<h3>Pending Removal in Future Versions<a href="#pending-removal-in-future-versions" title="Permalink to this headline">¶</a></h3>
<p>The following APIs were deprecated in earlier Python versions and will be removed,
although there is currently no date scheduled for their removal.</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/array.html#module-array" title="array: Space efficient arrays of uniformly typed numeric values."><code><span>array</span></code></a>’s <code><span>&#39;u&#39;</span></code> format code (<a href="https://github.com/python/cpython/issues/57281">gh-57281</a>)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/typing.html#typing.Text" title="typing.Text"><code><span>typing.Text</span></code></a> (<a href="https://github.com/python/cpython/issues/92332">gh-92332</a>)</p></li>
<li><p>Currently Python accepts numeric literals immediately followed by keywords,
for example <code><span>0in</span> <span>x</span></code>, <code><span>1or</span> <span>x</span></code>, <code><span>0if</span> <span>1else</span> <span>2</span></code>.  It allows confusing
and ambiguous expressions like <code><span>[0x1for</span> <span>x</span> <span>in</span> <span>y]</span></code> (which can be
interpreted as <code><span>[0x1</span> <span>for</span> <span>x</span> <span>in</span> <span>y]</span></code> or <code><span>[0x1f</span> <span>or</span> <span>x</span> <span>in</span> <span>y]</span></code>).
A syntax warning is raised if the numeric literal is
immediately followed by one of keywords <a href="https://www.wildlondon.org.uk/blog/reference/expressions.html#and"><code><span>and</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/reference/compound_stmts.html#else"><code><span>else</span></code></a>,
<a href="https://www.wildlondon.org.uk/blog/reference/compound_stmts.html#for"><code><span>for</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/reference/compound_stmts.html#if"><code><span>if</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/reference/expressions.html#in"><code><span>in</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/reference/expressions.html#is"><code><span>is</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/reference/expressions.html#or"><code><span>or</span></code></a>.
In a future release it will be changed to a syntax error. (<a href="https://github.com/python/cpython/issues/87999">gh-87999</a>)</p></li>
</ul>
</section>
</section>
<section id="removed">
<h2>Removed<a href="#removed" title="Permalink to this headline">¶</a></h2>
<section id="asynchat-and-asyncore">
<h3>asynchat and asyncore<a href="#asynchat-and-asyncore" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>These two modules have been removed
according to the schedule in <span id="index-32"></span><a href="https://peps.python.org/pep-0594/"><strong>PEP 594</strong></a>,
having been deprecated in Python 3.6.
Use <a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a> instead.
(Contributed by Nikita Sobolev in <a href="https://github.com/python/cpython/issues/96580">gh-96580</a>.)</p></li>
</ul>
</section>
<section id="configparser">
<h3>configparser<a href="#configparser" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Several names deprecated in the <a href="https://www.wildlondon.org.uk/blog/library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code><span>configparser</span></code></a> way back in 3.2 have
been removed per <a href="https://github.com/python/cpython/issues/89336">gh-89336</a>:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/configparser.html#configparser.ParsingError" title="configparser.ParsingError"><code><span>configparser.ParsingError</span></code></a> no longer has a <code><span>filename</span></code> attribute
or argument. Use the <code><span>source</span></code> attribute and argument instead.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/configparser.html#module-configparser" title="configparser: Configuration file parser."><code><span>configparser</span></code></a> no longer has a <code><span>SafeConfigParser</span></code> class. Use the
shorter <a href="https://www.wildlondon.org.uk/blog/library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code><span>ConfigParser</span></code></a> name instead.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/configparser.html#configparser.ConfigParser" title="configparser.ConfigParser"><code><span>configparser.ConfigParser</span></code></a> no longer has a <code><span>readfp</span></code> method.
Use <a href="https://www.wildlondon.org.uk/blog/library/configparser.html#configparser.ConfigParser.read_file" title="configparser.ConfigParser.read_file"><code><span>read_file()</span></code></a> instead.</p></li>
</ul>
</li>
</ul>
</section>
<section id="distutils">
<h3>distutils<a href="#distutils" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove the <code><span>distutils</span></code> package. It was deprecated in Python 3.10 by
<span id="index-33"></span><a href="https://peps.python.org/pep-0632/"><strong>PEP 632</strong></a> “Deprecate distutils module”. For projects still using
<code><span>distutils</span></code> and cannot be updated to something else, the <code><span>setuptools</span></code>
project can be installed: it still provides <code><span>distutils</span></code>.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/92584">gh-92584</a>.)</p></li>
</ul>
</section>
<section id="ensurepip">
<h3>ensurepip<a href="#ensurepip" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove the bundled setuptools wheel from <a href="https://www.wildlondon.org.uk/blog/library/ensurepip.html#module-ensurepip" title="ensurepip: Bootstrapping the &#34;pip&#34; installer into an existing Python installation or virtual environment."><code><span>ensurepip</span></code></a>,
and stop installing setuptools in environments created by <a href="https://www.wildlondon.org.uk/blog/library/venv.html#module-venv" title="venv: Creation of virtual environments."><code><span>venv</span></code></a>.</p>
<p><code><span>pip</span> <span>(&gt;=</span> <span>22.1)</span></code> does not require setuptools to be installed in the
environment. <code><span>setuptools</span></code>-based (and <code><span>distutils</span></code>-based) packages
can still be used with <code><span>pip</span> <span>install</span></code>, since pip will provide
<code><span>setuptools</span></code> in the build environment it uses for building a
package.</p>
<p><code><span>easy_install</span></code>, <code><span>pkg_resources</span></code>, <code><span>setuptools</span></code> and <code><span>distutils</span></code>
are no longer provided by default in environments created with
<code><span>venv</span></code> or bootstrapped with <code><span>ensurepip</span></code>, since they are part of
the <code><span>setuptools</span></code> package. For projects relying on these at runtime,
the <code><span>setuptools</span></code> project should be declared as a dependency and
installed separately (typically, using pip).</p>
<p>(Contributed by Pradyun Gedam in <a href="https://github.com/python/cpython/issues/95299">gh-95299</a>.)</p>
</li>
</ul>
</section>
<section id="enum">
<h3>enum<a href="#enum" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove <a href="https://www.wildlondon.org.uk/blog/library/enum.html#module-enum" title="enum: Implementation of an enumeration class."><code><span>enum</span></code></a>’s <code><span>EnumMeta.__getattr__</span></code>, which is no longer needed for
enum attribute access.
(Contributed by Ethan Furman in <a href="https://github.com/python/cpython/issues/95083">gh-95083</a>.)</p></li>
</ul>
</section>
<section id="ftplib">
<h3>ftplib<a href="#ftplib" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove <a href="https://www.wildlondon.org.uk/blog/library/ftplib.html#module-ftplib" title="ftplib: FTP protocol client (requires sockets)."><code><span>ftplib</span></code></a>’s <code><span>FTP_TLS.ssl_version</span></code> class attribute: use the
<em>context</em> parameter instead.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94172">gh-94172</a>.)</p></li>
</ul>
</section>
<section id="gzip">
<h3>gzip<a href="#gzip" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove the <code><span>filename</span></code> attribute of <a href="https://www.wildlondon.org.uk/blog/library/gzip.html#module-gzip" title="gzip: Interfaces for gzip compression and decompression using file objects."><code><span>gzip</span></code></a>’s <a href="https://www.wildlondon.org.uk/blog/library/gzip.html#gzip.GzipFile" title="gzip.GzipFile"><code><span>gzip.GzipFile</span></code></a>,
deprecated since Python 2.6, use the <a href="https://www.wildlondon.org.uk/blog/library/gzip.html#gzip.GzipFile.name" title="gzip.GzipFile.name"><code><span>name</span></code></a> attribute
instead. In write mode, the <code><span>filename</span></code> attribute added <code><span>&#39;.gz&#39;</span></code> file
extension if it was not present.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94196">gh-94196</a>.)</p></li>
</ul>
</section>
<section id="hashlib">
<h3>hashlib<a href="#hashlib" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove the pure Python implementation of <a href="https://www.wildlondon.org.uk/blog/library/hashlib.html#module-hashlib" title="hashlib: Secure hash and message digest algorithms."><code><span>hashlib</span></code></a>’s
<a href="https://www.wildlondon.org.uk/blog/library/hashlib.html#hashlib.pbkdf2_hmac" title="hashlib.pbkdf2_hmac"><code><span>hashlib.pbkdf2_hmac()</span></code></a>, deprecated in Python 3.10. Python 3.10 and
newer requires OpenSSL 1.1.1 (<span id="index-34"></span><a href="https://peps.python.org/pep-0644/"><strong>PEP 644</strong></a>): this OpenSSL version provides
a C implementation of <a href="https://www.wildlondon.org.uk/blog/library/hashlib.html#hashlib.pbkdf2_hmac" title="hashlib.pbkdf2_hmac"><code><span>pbkdf2_hmac()</span></code></a> which is faster.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94199">gh-94199</a>.)</p></li>
</ul>
</section>
<section id="importlib">
<h3>importlib<a href="#importlib" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Many previously deprecated cleanups in <a href="https://www.wildlondon.org.uk/blog/library/importlib.html#module-importlib" title="importlib: The implementation of the import machinery."><code><span>importlib</span></code></a> have now been
completed:</p>
<ul>
<li><p>References to, and support for <code><span>module_repr()</span></code> has been removed.
(Contributed by Barry Warsaw in <a href="https://github.com/python/cpython/issues/97850">gh-97850</a>.)</p></li>
<li><p><code><span>importlib.util.set_package</span></code>, <code><span>importlib.util.set_loader</span></code> and
<code><span>importlib.util.module_for_loader</span></code> have all been removed. (Contributed by
Brett Cannon and Nikita Sobolev in <a href="https://github.com/python/cpython/issues/65961">gh-65961</a> and <a href="https://github.com/python/cpython/issues/97850">gh-97850</a>.)</p></li>
<li><p>Support for <code><span>find_loader()</span></code> and <code><span>find_module()</span></code> APIs have been
removed.  (Contributed by Barry Warsaw in <a href="https://github.com/python/cpython/issues/98040">gh-98040</a>.)</p></li>
<li><p><code><span>importlib.abc.Finder</span></code>, <code><span>pkgutil.ImpImporter</span></code>, and <code><span>pkgutil.ImpLoader</span></code>
have been removed.  (Contributed by Barry Warsaw in <a href="https://github.com/python/cpython/issues/98040">gh-98040</a>.)</p></li>
</ul>
</li>
</ul>
</section>
<section id="imp">
<h3>imp<a href="#imp" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The <code><span>imp</span></code> module has been removed.  (Contributed by Barry Warsaw in
<a href="https://github.com/python/cpython/issues/98040">gh-98040</a>.)</p>
<p>To migrate, consult the following correspondence table:</p>
<blockquote>
</blockquote>
<p>Replace <code><span>imp.load_source()</span></code> with:</p>
<div><div><pre><span></span><span>import</span> <span>importlib.util</span>
<span>import</span> <span>importlib.machinery</span>

<span>def</span> <span>load_source</span><span>(</span><span>modname</span><span>,</span> <span>filename</span><span>):</span>
    <span>loader</span> <span>=</span> <span>importlib</span><span>.</span><span>machinery</span><span>.</span><span>SourceFileLoader</span><span>(</span><span>modname</span><span>,</span> <span>filename</span><span>)</span>
    <span>spec</span> <span>=</span> <span>importlib</span><span>.</span><span>util</span><span>.</span><span>spec_from_file_location</span><span>(</span><span>modname</span><span>,</span> <span>filename</span><span>,</span> <span>loader</span><span>=</span><span>loader</span><span>)</span>
    <span>module</span> <span>=</span> <span>importlib</span><span>.</span><span>util</span><span>.</span><span>module_from_spec</span><span>(</span><span>spec</span><span>)</span>
    <span># The module is always executed and not cached in sys.modules.</span>
    <span># Uncomment the following line to cache the module.</span>
    <span># sys.modules[module.__name__] = module</span>
    <span>loader</span><span>.</span><span>exec_module</span><span>(</span><span>module</span><span>)</span>
    <span>return</span> <span>module</span>
</pre></div>
</div>
</li>
<li><p>Remove <code><span>imp</span></code> functions and attributes with no replacements:</p>
<ul>
<li><p>Undocumented functions:</p>
<ul>
<li><p><code><span>imp.init_builtin()</span></code></p></li>
<li><p><code><span>imp.load_compiled()</span></code></p></li>
<li><p><code><span>imp.load_dynamic()</span></code></p></li>
<li><p><code><span>imp.load_package()</span></code></p></li>
</ul>
</li>
<li><p><code><span>imp.lock_held()</span></code>, <code><span>imp.acquire_lock()</span></code>, <code><span>imp.release_lock()</span></code>:
the locking scheme has changed in Python 3.3 to per-module locks.</p></li>
<li><p><code><span>imp.find_module()</span></code> constants: <code><span>SEARCH_ERROR</span></code>, <code><span>PY_SOURCE</span></code>,
<code><span>PY_COMPILED</span></code>, <code><span>C_EXTENSION</span></code>, <code><span>PY_RESOURCE</span></code>, <code><span>PKG_DIRECTORY</span></code>,
<code><span>C_BUILTIN</span></code>, <code><span>PY_FROZEN</span></code>, <code><span>PY_CODERESOURCE</span></code>, <code><span>IMP_HOOK</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="io">
<h3>io<a href="#io" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove <a href="https://www.wildlondon.org.uk/blog/library/io.html#module-io" title="io: Core tools for working with streams."><code><span>io</span></code></a>’s <code><span>io.OpenWrapper</span></code> and <code><span>_pyio.OpenWrapper</span></code>, deprecated in Python
3.10: just use <a href="https://www.wildlondon.org.uk/blog/library/functions.html#open" title="open"><code><span>open()</span></code></a> instead. The <a href="https://www.wildlondon.org.uk/blog/library/functions.html#open" title="open"><code><span>open()</span></code></a> (<a href="https://www.wildlondon.org.uk/blog/library/io.html#io.open" title="io.open"><code><span>io.open()</span></code></a>)
function is a built-in function. Since Python 3.10, <code><span>_pyio.open()</span></code> is
also a static method.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94169">gh-94169</a>.)</p></li>
</ul>
</section>
<section id="locale">
<h3>locale<a href="#locale" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove <a href="https://www.wildlondon.org.uk/blog/library/locale.html#module-locale" title="locale: Internationalization services."><code><span>locale</span></code></a>’s <code><span>locale.format()</span></code> function, deprecated in Python 3.7:
use <a href="https://www.wildlondon.org.uk/blog/library/locale.html#locale.format_string" title="locale.format_string"><code><span>locale.format_string()</span></code></a> instead.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94226">gh-94226</a>.)</p></li>
<li><p><code><span>smtpd</span></code>: The module has been removed according to the schedule in <span id="index-35"></span><a href="https://peps.python.org/pep-0594/"><strong>PEP 594</strong></a>,
having been deprecated in Python 3.4.7 and 3.5.4.
Use <a href="https://pypi.org/project/aiosmtpd/">aiosmtpd</a> PyPI module or any other
<a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a>-based server instead.
(Contributed by Oleg Iarygin in <a href="https://github.com/python/cpython/issues/93243">gh-93243</a>.)</p></li>
</ul>
</section>
<section id="id2">
<h3>sqlite3<a href="#id2" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>The following undocumented <a href="https://www.wildlondon.org.uk/blog/library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><code><span>sqlite3</span></code></a> features, deprecated in Python
3.10, are now removed:</p>
<ul>
<li><p><code><span>sqlite3.enable_shared_cache()</span></code></p></li>
<li><p><code><span>sqlite3.OptimizedUnicode</span></code></p></li>
</ul>
<p>If a shared cache must be used, open the database in URI mode using the
<code><span>cache=shared</span></code> query parameter.</p>
<p>The <code><span>sqlite3.OptimizedUnicode</span></code> text factory has been an alias for
<a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#str" title="str"><code><span>str</span></code></a> since Python 3.3. Code that previously set the text factory to
<code><span>OptimizedUnicode</span></code> can either use <code><span>str</span></code> explicitly, or rely on the
default value which is also <code><span>str</span></code>.</p>
<p>(Contributed by Erlend E. Aasland in <a href="https://github.com/python/cpython/issues/92548">gh-92548</a>.)</p>
</li>
</ul>
</section>
<section id="ssl">
<h3>ssl<a href="#ssl" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove <a href="https://www.wildlondon.org.uk/blog/library/ssl.html#module-ssl" title="ssl: TLS/SSL wrapper for socket objects"><code><span>ssl</span></code></a>’s <code><span>ssl.RAND_pseudo_bytes()</span></code> function, deprecated in Python 3.6:
use <a href="https://www.wildlondon.org.uk/blog/library/os.html#os.urandom" title="os.urandom"><code><span>os.urandom()</span></code></a> or <a href="https://www.wildlondon.org.uk/blog/library/ssl.html#ssl.RAND_bytes" title="ssl.RAND_bytes"><code><span>ssl.RAND_bytes()</span></code></a> instead.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94199">gh-94199</a>.)</p></li>
<li><p>Remove the <code><span>ssl.match_hostname()</span></code> function.
It was deprecated in Python 3.7. OpenSSL performs
hostname matching since Python 3.7, Python no longer uses the
<code><span>ssl.match_hostname()</span></code> function.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94199">gh-94199</a>.)</p></li>
<li><p>Remove the <code><span>ssl.wrap_socket()</span></code> function, deprecated in Python 3.7:
instead, create a <a href="https://www.wildlondon.org.uk/blog/library/ssl.html#ssl.SSLContext" title="ssl.SSLContext"><code><span>ssl.SSLContext</span></code></a> object and call its
<a href="https://www.wildlondon.org.uk/blog/library/ssl.html#ssl.SSLContext.wrap_socket" title="ssl.SSLContext.wrap_socket"><code><span>ssl.SSLContext.wrap_socket</span></code></a> method. Any package that still uses
<code><span>ssl.wrap_socket()</span></code> is broken and insecure. The function neither sends a
SNI TLS extension nor validates server hostname. Code is subject to <a href="https://cwe.mitre.org/data/definitions/295.html">CWE-295</a>: Improper Certificate
Validation.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94199">gh-94199</a>.)</p></li>
</ul>
</section>
<section id="id3">
<h3>unittest<a href="#id3" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove many long-deprecated <a href="https://www.wildlondon.org.uk/blog/library/unittest.html#module-unittest" title="unittest: Unit testing framework for Python."><code><span>unittest</span></code></a> features:</p>
<ul id="unittest-testcase-removed-aliases">
<li><p>A number of <a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase" title="unittest.TestCase"><code><span>TestCase</span></code></a> method aliases:</p>
<table>
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr><th><p>Deprecated alias</p></th>
<th><p>Method Name</p></th>
<th><p>Deprecated in</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><code><span>failUnless</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><code><span>assertTrue()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr><td><p><code><span>failIf</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertFalse" title="unittest.TestCase.assertFalse"><code><span>assertFalse()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr><td><p><code><span>failUnlessEqual</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code><span>assertEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr><td><p><code><span>failIfEqual</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertNotEqual" title="unittest.TestCase.assertNotEqual"><code><span>assertNotEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr><td><p><code><span>failUnlessAlmostEqual</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><code><span>assertAlmostEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr><td><p><code><span>failIfAlmostEqual</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><code><span>assertNotAlmostEqual()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr><td><p><code><span>failUnlessRaises</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertRaises" title="unittest.TestCase.assertRaises"><code><span>assertRaises()</span></code></a></p></td>
<td><p>3.1</p></td>
</tr>
<tr><td><p><code><span>assert_</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><code><span>assertTrue()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr><td><p><code><span>assertEquals</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><code><span>assertEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr><td><p><code><span>assertNotEquals</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertNotEqual" title="unittest.TestCase.assertNotEqual"><code><span>assertNotEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr><td><p><code><span>assertAlmostEquals</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><code><span>assertAlmostEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr><td><p><code><span>assertNotAlmostEquals</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><code><span>assertNotAlmostEqual()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr><td><p><code><span>assertRegexpMatches</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertRegex" title="unittest.TestCase.assertRegex"><code><span>assertRegex()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr><td><p><code><span>assertRaisesRegexp</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertRaisesRegex" title="unittest.TestCase.assertRaisesRegex"><code><span>assertRaisesRegex()</span></code></a></p></td>
<td><p>3.2</p></td>
</tr>
<tr><td><p><code><span>assertNotRegexpMatches</span></code></p></td>
<td><p><a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase.assertNotRegex" title="unittest.TestCase.assertNotRegex"><code><span>assertNotRegex()</span></code></a></p></td>
<td><p>3.5</p></td>
</tr>
</tbody>
</table>
<p>You can use <a href="https://github.com/isidentical/teyit">https://github.com/isidentical/teyit</a> to automatically modernise
your unit tests.</p>
</li>
<li><p>Undocumented and broken <a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestCase" title="unittest.TestCase"><code><span>TestCase</span></code></a> method
<code><span>assertDictContainsSubset</span></code> (deprecated in Python 3.2).</p></li>
<li><p>Undocumented <a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TestLoader.loadTestsFromModule" title="unittest.TestLoader.loadTestsFromModule"><code><span>TestLoader.loadTestsFromModule</span></code></a> parameter <em>use_load_tests</em>
(deprecated and ignored since Python 3.2).</p></li>
<li><p>An alias of the <a href="https://www.wildlondon.org.uk/blog/library/unittest.html#unittest.TextTestResult" title="unittest.TextTestResult"><code><span>TextTestResult</span></code></a> class:
<code><span>_TextTestResult</span></code> (deprecated in Python 3.2).</p></li>
</ul>
<p>(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/89325">gh-89325</a>.)</p>
</li>
</ul>
</section>
<section id="webbrowser">
<h3>webbrowser<a href="#webbrowser" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove support for obsolete browsers from <a href="https://www.wildlondon.org.uk/blog/library/webbrowser.html#module-webbrowser" title="webbrowser: Easy-to-use controller for web browsers."><code><span>webbrowser</span></code></a>.
The removed browsers include: Grail, Mosaic, Netscape, Galeon, Skipstone,
Iceape, Firebird, and Firefox versions 35 and below (<a href="https://github.com/python/cpython/issues/102871">gh-102871</a>).</p></li>
</ul>
</section>
<section id="xml-etree-elementtree">
<h3>xml.etree.ElementTree<a href="#xml-etree-elementtree" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove the <code><span>ElementTree.Element.copy()</span></code> method of the
pure Python implementation, deprecated in Python 3.10, use the
<a href="https://www.wildlondon.org.uk/blog/library/copy.html#copy.copy" title="copy.copy"><code><span>copy.copy()</span></code></a> function instead.  The C implementation of <a href="https://www.wildlondon.org.uk/blog/library/xml.etree.elementtree.html#module-xml.etree.ElementTree" title="xml.etree.ElementTree: Implementation of the ElementTree API."><code><span>xml.etree.ElementTree</span></code></a>
has no <code><span>copy()</span></code> method, only a <code><span>__copy__()</span></code> method.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94383">gh-94383</a>.)</p></li>
</ul>
</section>
<section id="zipimport">
<h3>zipimport<a href="#zipimport" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove <a href="https://www.wildlondon.org.uk/blog/library/zipimport.html#module-zipimport" title="zipimport: Support for importing Python modules from ZIP archives."><code><span>zipimport</span></code></a>’s <code><span>find_loader()</span></code> and <code><span>find_module()</span></code> methods,
deprecated in Python 3.10: use the <code><span>find_spec()</span></code> method instead.  See
<span id="index-36"></span><a href="https://peps.python.org/pep-0451/"><strong>PEP 451</strong></a> for the rationale.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94379">gh-94379</a>.)</p></li>
</ul>
</section>
<section id="others">
<h3>Others<a href="#others" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove the <code><span>suspicious</span></code> rule from the documentation <code><span>Makefile</span></code> and
<code><span>Doc/tools/rstlint.py</span></code>, both in favor of <a href="https://github.com/sphinx-contrib/sphinx-lint">sphinx-lint</a>.
(Contributed by Julien Palard in <a href="https://github.com/python/cpython/issues/98179">gh-98179</a>.)</p></li>
<li><p>Remove the <em>keyfile</em> and <em>certfile</em> parameters from the
<a href="https://www.wildlondon.org.uk/blog/library/ftplib.html#module-ftplib" title="ftplib: FTP protocol client (requires sockets)."><code><span>ftplib</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/imaplib.html#module-imaplib" title="imaplib: IMAP4 protocol client (requires sockets)."><code><span>imaplib</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/library/poplib.html#module-poplib" title="poplib: POP3 protocol client (requires sockets)."><code><span>poplib</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/smtplib.html#module-smtplib" title="smtplib: SMTP protocol client (requires sockets)."><code><span>smtplib</span></code></a> modules,
and the <em>key_file</em>, <em>cert_file</em> and <em>check_hostname</em> parameters from the
<a href="https://www.wildlondon.org.uk/blog/library/http.client.html#module-http.client" title="http.client: HTTP and HTTPS protocol client (requires sockets)."><code><span>http.client</span></code></a> module,
all deprecated since Python 3.6. Use the <em>context</em> parameter
(<em>ssl_context</em> in <a href="https://www.wildlondon.org.uk/blog/library/imaplib.html#module-imaplib" title="imaplib: IMAP4 protocol client (requires sockets)."><code><span>imaplib</span></code></a>) instead.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94172">gh-94172</a>.)</p></li>
</ul>
</section>
</section>
<section id="porting-to-python-3-12">
<span id="whatsnew312-porting-to-python312"></span><h2>Porting to Python 3.12<a href="#porting-to-python-3-12" title="Permalink to this headline">¶</a></h2>
<p>This section lists previously described changes and other bugfixes
that may require changes to your code.</p>
<section id="changes-in-the-python-api">
<h3>Changes in the Python API<a href="#changes-in-the-python-api" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>More strict rules are now applied for numerical group references and
group names in regular expressions.
Only sequence of ASCII digits is now accepted as a numerical reference.
The group name in bytes patterns and replacement strings can now only
contain ASCII letters and digits and underscore.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/91760">gh-91760</a>.)</p></li>
<li><p>Remove <code><span>randrange()</span></code> functionality deprecated since Python 3.10.  Formerly,
<code><span>randrange(10.0)</span></code> losslessly converted to <code><span>randrange(10)</span></code>. Now, it raises a
<a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#TypeError" title="TypeError"><code><span>TypeError</span></code></a>. Also, the exception raised for non-integer values such as
<code><span>randrange(10.5)</span></code> or <code><span>randrange(&#39;10&#39;)</span></code> has been changed from <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#ValueError" title="ValueError"><code><span>ValueError</span></code></a> to
<a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#TypeError" title="TypeError"><code><span>TypeError</span></code></a>.  This also prevents bugs where <code><span>randrange(1e25)</span></code> would silently
select from a larger range than <code><span>randrange(10**25)</span></code>.
(Originally suggested by Serhiy Storchaka <a href="https://github.com/python/cpython/issues/86388">gh-86388</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/argparse.html#argparse.ArgumentParser" title="argparse.ArgumentParser"><code><span>argparse.ArgumentParser</span></code></a> changed encoding and error handler
for reading arguments from file (e.g. <code><span>fromfile_prefix_chars</span></code> option)
from default text encoding (e.g. <a href="https://www.wildlondon.org.uk/blog/library/locale.html#locale.getpreferredencoding" title="locale.getpreferredencoding"><code><span>locale.getpreferredencoding(False)</span></code></a>)
to <a href="https://www.wildlondon.org.uk/blog/glossary.html#term-filesystem-encoding-and-error-handler"><span>filesystem encoding and error handler</span></a>.
Argument files should be encoded in UTF-8 instead of ANSI Codepage on Windows.</p></li>
<li><p>Remove the <code><span>asyncore</span></code>-based <code><span>smtpd</span></code> module deprecated in Python 3.4.7
and 3.5.4.  A recommended replacement is the
<a href="https://www.wildlondon.org.uk/blog/library/asyncio.html#module-asyncio" title="asyncio: Asynchronous I/O."><code><span>asyncio</span></code></a>-based <a href="https://pypi.org/project/aiosmtpd/">aiosmtpd</a> PyPI module.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/shlex.html#shlex.split" title="shlex.split"><code><span>shlex.split()</span></code></a>: Passing <code><span>None</span></code> for <em>s</em> argument now raises an
exception, rather than reading <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.stdin" title="sys.stdin"><code><span>sys.stdin</span></code></a>. The feature was deprecated
in Python 3.9.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/94352">gh-94352</a>.)</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/library/os.html#module-os" title="os: Miscellaneous operating system interfaces."><code><span>os</span></code></a> module no longer accepts bytes-like paths, like
<a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#bytearray" title="bytearray"><code><span>bytearray</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#memoryview" title="memoryview"><code><span>memoryview</span></code></a> types: only the exact
<a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#bytes" title="bytes"><code><span>bytes</span></code></a> type is accepted for bytes strings.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/98393">gh-98393</a>.)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/syslog.html#syslog.openlog" title="syslog.openlog"><code><span>syslog.openlog()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/syslog.html#syslog.closelog" title="syslog.closelog"><code><span>syslog.closelog()</span></code></a> now fail if used in subinterpreters.
<a href="https://www.wildlondon.org.uk/blog/library/syslog.html#syslog.syslog" title="syslog.syslog"><code><span>syslog.syslog()</span></code></a> may still be used in subinterpreters,
but now only if <a href="https://www.wildlondon.org.uk/blog/library/syslog.html#syslog.openlog" title="syslog.openlog"><code><span>syslog.openlog()</span></code></a> has already been called in the main interpreter.
These new restrictions do not apply to the main interpreter,
so only a very small set of users might be affected.
This change helps with interpreter isolation.  Furthermore, <a href="https://www.wildlondon.org.uk/blog/library/syslog.html#module-syslog" title="syslog: An interface to the Unix syslog library routines. (Unix)"><code><span>syslog</span></code></a> is a wrapper
around process-global resources, which are best managed from the main interpreter.
(Contributed by Donghee Na in <a href="https://github.com/python/cpython/issues/99127">gh-99127</a>.)</p></li>
<li><p>The undocumented locking behavior of <a href="https://www.wildlondon.org.uk/blog/library/functools.html#functools.cached_property" title="functools.cached_property"><code><span>cached_property()</span></code></a>
is removed, because it locked across all instances of the class, leading to high
lock contention. This means that a cached property getter function could now run
more than once for a single instance, if two threads race. For most simple
cached properties (e.g. those that are idempotent and simply calculate a value
based on other attributes of the instance) this will be fine.  If
synchronization is needed, implement locking within the cached property getter
function or around multi-threaded access points.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys._current_exceptions" title="sys._current_exceptions"><code><span>sys._current_exceptions()</span></code></a> now returns a mapping from thread-id to an
exception instance, rather than to a <code><span>(typ,</span> <span>exc,</span> <span>tb)</span></code> tuple.
(Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/103176">gh-103176</a>.)</p></li>
<li><p>When extracting tar files using <a href="https://www.wildlondon.org.uk/blog/library/tarfile.html#module-tarfile" title="tarfile: Read and write tar-format archive files."><code><span>tarfile</span></code></a> or
<a href="https://www.wildlondon.org.uk/blog/library/shutil.html#shutil.unpack_archive" title="shutil.unpack_archive"><code><span>shutil.unpack_archive()</span></code></a>, pass the <em>filter</em> argument to limit features
that may be surprising or dangerous.
See <a href="https://www.wildlondon.org.uk/blog/library/tarfile.html#tarfile-extraction-filter"><span>Extraction filters</span></a> for details.</p></li>
<li><p>The output of the <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#tokenize.tokenize" title="tokenize.tokenize"><code><span>tokenize.tokenize()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#tokenize.generate_tokens" title="tokenize.generate_tokens"><code><span>tokenize.generate_tokens()</span></code></a>
functions is now changed due to the changes introduced in <span id="index-37"></span><a href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a>. This
means that <code><span>STRING</span></code> tokens are not emitted any more for f-strings and the
tokens described in <span id="index-38"></span><a href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a> are now produced instead: <code><span>FSTRING_START</span></code>,
<code><span>FSTRING_MIDDLE</span></code> and <code><span>FSTRING_END</span></code> are now emitted for f-string “string”
parts in addition to the appropriate tokens for the tokenization in the
expression components. For example for the f-string <code><span>f&#34;start</span> <span>{1+1}</span> <span>end&#34;</span></code>
the old version of the tokenizer emitted:</p>
<div><div><pre><span></span><span>1</span><span>,</span><span>0</span><span>-</span><span>1</span><span>,</span><span>18</span><span>:</span>           <span>STRING</span>         <span>&#39;f&#34;start {1+1} end&#34;&#39;</span>
</pre></div>
</div>
<p>while the new version emits:</p>
<div><div><pre><span></span><span>1</span><span>,</span><span>0</span><span>-</span><span>1</span><span>,</span><span>2</span><span>:</span>            <span>FSTRING_START</span>  <span>&#39;f&#34;&#39;</span>
<span>1</span><span>,</span><span>2</span><span>-</span><span>1</span><span>,</span><span>8</span><span>:</span>            <span>FSTRING_MIDDLE</span> <span>&#39;start &#39;</span>
<span>1</span><span>,</span><span>8</span><span>-</span><span>1</span><span>,</span><span>9</span><span>:</span>            <span>OP</span>             <span>&#39;{&#39;</span>
<span>1</span><span>,</span><span>9</span><span>-</span><span>1</span><span>,</span><span>10</span><span>:</span>           <span>NUMBER</span>         <span>&#39;1&#39;</span>
<span>1</span><span>,</span><span>10</span><span>-</span><span>1</span><span>,</span><span>11</span><span>:</span>          <span>OP</span>             <span>&#39;+&#39;</span>
<span>1</span><span>,</span><span>11</span><span>-</span><span>1</span><span>,</span><span>12</span><span>:</span>          <span>NUMBER</span>         <span>&#39;1&#39;</span>
<span>1</span><span>,</span><span>12</span><span>-</span><span>1</span><span>,</span><span>13</span><span>:</span>          <span>OP</span>             <span>&#39;}&#39;</span>
<span>1</span><span>,</span><span>13</span><span>-</span><span>1</span><span>,</span><span>17</span><span>:</span>          <span>FSTRING_MIDDLE</span> <span>&#39; end&#39;</span>
<span>1</span><span>,</span><span>17</span><span>-</span><span>1</span><span>,</span><span>18</span><span>:</span>          <span>FSTRING_END</span>    <span>&#39;&#34;&#39;</span>
</pre></div>
</div>
<p>Additionally, there may be some minor behavioral changes as a consequence of the
changes required to support <span id="index-39"></span><a href="https://peps.python.org/pep-0701/"><strong>PEP 701</strong></a>. Some of these changes include:</p>
<ul>
<li><p>The <code><span>type</span></code> attribute of the tokens emitted when tokenizing some invalid Python
characters such as <code><span>!</span></code> has changed from <code><span>ERRORTOKEN</span></code> to <code><span>OP</span></code>.</p></li>
<li><p>Incomplete single-line strings now also raise <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#tokenize.TokenError" title="tokenize.TokenError"><code><span>tokenize.TokenError</span></code></a> as incomplete
multiline strings do.</p></li>
<li><p>Some incomplete or invalid Python code now raises <a href="https://www.wildlondon.org.uk/blog/library/tokenize.html#tokenize.TokenError" title="tokenize.TokenError"><code><span>tokenize.TokenError</span></code></a> instead of
returning arbitrary <code><span>ERRORTOKEN</span></code> tokens when tokenizing it.</p></li>
<li><p>Mixing tabs and spaces as indentation in the same file is not supported anymore and will
raise a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#TabError" title="TabError"><code><span>TabError</span></code></a>.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="build-changes">
<h2>Build Changes<a href="#build-changes" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Python no longer uses <code><span>setup.py</span></code> to build shared C extension modules.
Build parameters like headers and libraries are detected in <code><span>configure</span></code>
script. Extensions are built by <code><span>Makefile</span></code>. Most extensions use
<code><span>pkg-config</span></code> and fall back to manual detection.
(Contributed by Christian Heimes in <a href="https://github.com/python/cpython/issues/93939">gh-93939</a>.)</p></li>
<li><p><code><span>va_start()</span></code> with two parameters, like <code><span>va_start(args,</span> <span>format),</span></code>
is now required to build Python.
<code><span>va_start()</span></code> is no longer called with a single parameter.
(Contributed by Kumar Aditya in <a href="https://github.com/python/cpython/issues/93207">gh-93207</a>.)</p></li>
<li><p>CPython now uses the ThinLTO option as the default link time optimization policy
if the Clang compiler accepts the flag.
(Contributed by Donghee Na in <a href="https://github.com/python/cpython/issues/89536">gh-89536</a>.)</p></li>
<li><p>Add <code><span>COMPILEALL_OPTS</span></code> variable in <code><span>Makefile</span></code> to override <a href="https://www.wildlondon.org.uk/blog/library/compileall.html#module-compileall" title="compileall: Tools for byte-compiling all Python source files in a directory tree."><code><span>compileall</span></code></a>
options (default: <code><span>-j0</span></code>) in <code><span>make</span> <span>install</span></code>. Also merged the 3
<code><span>compileall</span></code> commands into a single command to build .pyc files for all
optimization levels (0, 1, 2) at once.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/99289">gh-99289</a>.)</p></li>
<li><p>Add platform triplets for 64-bit LoongArch:</p>
<ul>
<li><p>loongarch64-linux-gnusf</p></li>
<li><p>loongarch64-linux-gnuf32</p></li>
<li><p>loongarch64-linux-gnu</p></li>
</ul>
<p>(Contributed by Zhang Na in <a href="https://github.com/python/cpython/issues/90656">gh-90656</a>.)</p>
</li>
<li><p><code><span>PYTHON_FOR_REGEN</span></code> now require Python 3.10 or newer.</p></li>
<li><p>Autoconf 2.71 and aclocal 1.16.4 is now required to regenerate
<code><span>!configure</span></code>.
(Contributed by Christian Heimes in <a href="https://github.com/python/cpython/issues/89886">gh-89886</a>.)</p></li>
<li><p>Windows builds and macOS installers from python.org now use OpenSSL 3.0.</p></li>
</ul>
</section>
<section id="c-api-changes">
<h2>C API Changes<a href="#c-api-changes" title="Permalink to this headline">¶</a></h2>
<section id="id4">
<h3>New Features<a href="#id4" title="Permalink to this headline">¶</a></h3>
<ul id="whatsnew312-pep697">
<li><p><span id="index-40"></span><a href="https://peps.python.org/pep-0697/"><strong>PEP 697</strong></a>: Introduce the <a href="https://www.wildlondon.org.uk/blog/c-api/stable.html#unstable-c-api"><span>Unstable C API tier</span></a>,
intended for low-level tools like debuggers and JIT compilers.
This API may change in each minor release of CPython without deprecation
warnings.
Its contents are marked by the <code><span>PyUnstable_</span></code> prefix in names.</p>
<p>Code object constructors:</p>
<ul>
<li><p><code><span>PyUnstable_Code_New()</span></code> (renamed from <code><span>PyCode_New</span></code>)</p></li>
<li><p><code><span>PyUnstable_Code_NewWithPosOnlyArgs()</span></code> (renamed from <code><span>PyCode_NewWithPosOnlyArgs</span></code>)</p></li>
</ul>
<p>Extra storage for code objects (<span id="index-41"></span><a href="https://peps.python.org/pep-0523/"><strong>PEP 523</strong></a>):</p>
<ul>
<li><p><code><span>PyUnstable_Eval_RequestCodeExtraIndex()</span></code> (renamed from <code><span>_PyEval_RequestCodeExtraIndex</span></code>)</p></li>
<li><p><code><span>PyUnstable_Code_GetExtra()</span></code> (renamed from <code><span>_PyCode_GetExtra</span></code>)</p></li>
<li><p><code><span>PyUnstable_Code_SetExtra()</span></code> (renamed from <code><span>_PyCode_SetExtra</span></code>)</p></li>
</ul>
<p>The original names will continue to be available until the respective
API changes.</p>
<p>(Contributed by Petr Viktorin in <a href="https://github.com/python/cpython/issues/101101">gh-101101</a>.)</p>
</li>
<li><p><span id="index-42"></span><a href="https://peps.python.org/pep-0697/"><strong>PEP 697</strong></a>: Add an API for extending types whose instance memory layout is
opaque:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_Spec.basicsize" title="PyType_Spec.basicsize"><code><span>PyType_Spec.basicsize</span></code></a> can be zero or negative to specify
inheriting or extending the base class size.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/object.html#c.PyObject_GetTypeData" title="PyObject_GetTypeData"><code><span>PyObject_GetTypeData()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/object.html#c.PyType_GetTypeDataSize" title="PyType_GetTypeDataSize"><code><span>PyType_GetTypeDataSize()</span></code></a>
added to allow access to subclass-specific instance data.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_ITEMS_AT_END" title="Py_TPFLAGS_ITEMS_AT_END"><code><span>Py_TPFLAGS_ITEMS_AT_END</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/object.html#c.PyObject_GetItemData" title="PyObject_GetItemData"><code><span>PyObject_GetItemData()</span></code></a>
added to allow safely extending certain variable-sized types, including
<a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_Type" title="PyType_Type"><code><span>PyType_Type</span></code></a>.</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.Py_RELATIVE_OFFSET" title="Py_RELATIVE_OFFSET"><code><span>Py_RELATIVE_OFFSET</span></code></a> added to allow defining
<a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.PyMemberDef" title="PyMemberDef"><code><span>members</span></code></a> in terms of a subclass-specific struct.</p></li>
</ul>
<p>(Contributed by Petr Viktorin in <a href="https://github.com/python/cpython/issues/103509">gh-103509</a>.)</p>
</li>
<li><p>Add the new <a href="https://www.wildlondon.org.uk/blog/c-api/stable.html#limited-c-api"><span>limited C API</span></a> function <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromMetaclass" title="PyType_FromMetaclass"><code><span>PyType_FromMetaclass()</span></code></a>,
which generalizes the existing <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code><span>PyType_FromModuleAndSpec()</span></code></a> using
an additional metaclass argument.
(Contributed by Wenzel Jakob in <a href="https://github.com/python/cpython/issues/93012">gh-93012</a>.)</p></li>
<li><p>API for creating objects that can be called using
<a href="https://www.wildlondon.org.uk/blog/c-api/call.html#vectorcall"><span>the vectorcall protocol</span></a> was added to the
<a href="https://www.wildlondon.org.uk/blog/c-api/stable.html#stable"><span>Limited API</span></a>:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_HAVE_VECTORCALL" title="Py_TPFLAGS_HAVE_VECTORCALL"><code><span>Py_TPFLAGS_HAVE_VECTORCALL</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/call.html#c.PyVectorcall_NARGS" title="PyVectorcall_NARGS"><code><span>PyVectorcall_NARGS()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/call.html#c.PyVectorcall_Call" title="PyVectorcall_Call"><code><span>PyVectorcall_Call()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/call.html#c.vectorcallfunc" title="vectorcallfunc"><code><span>vectorcallfunc</span></code></a></p></li>
</ul>
<p>The <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_HAVE_VECTORCALL" title="Py_TPFLAGS_HAVE_VECTORCALL"><code><span>Py_TPFLAGS_HAVE_VECTORCALL</span></code></a> flag is now removed from a class
when the class’s <a href="https://www.wildlondon.org.uk/blog/reference/datamodel.html#object.__call__" title="object.__call__"><code><span>__call__()</span></code></a> method is reassigned.
This makes vectorcall safe to use with mutable types (i.e. heap types
without the immutable flag, <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code><span>Py_TPFLAGS_IMMUTABLETYPE</span></code></a>).
Mutable types that do not override <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.PyTypeObject.tp_call" title="PyTypeObject.tp_call"><code><span>tp_call</span></code></a> now
inherit the <code><span>Py_TPFLAGS_HAVE_VECTORCALL</span></code> flag.
(Contributed by Petr Viktorin in <a href="https://github.com/python/cpython/issues/93274">gh-93274</a>.)</p>
<p>The <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_DICT" title="Py_TPFLAGS_MANAGED_DICT"><code><span>Py_TPFLAGS_MANAGED_DICT</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_WEAKREF" title="Py_TPFLAGS_MANAGED_WEAKREF"><code><span>Py_TPFLAGS_MANAGED_WEAKREF</span></code></a>
flags have been added. This allows extensions classes to support object
<code><span>__dict__</span></code> and weakrefs with less bookkeeping,
using less memory and with faster access.</p>
</li>
<li><p>API for performing calls using
<a href="https://www.wildlondon.org.uk/blog/c-api/call.html#vectorcall"><span>the vectorcall protocol</span></a> was added to the
<a href="https://www.wildlondon.org.uk/blog/c-api/stable.html#stable"><span>Limited API</span></a>:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/call.html#c.PyObject_Vectorcall" title="PyObject_Vectorcall"><code><span>PyObject_Vectorcall()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/call.html#c.PyObject_VectorcallMethod" title="PyObject_VectorcallMethod"><code><span>PyObject_VectorcallMethod()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/call.html#c.PY_VECTORCALL_ARGUMENTS_OFFSET" title="PY_VECTORCALL_ARGUMENTS_OFFSET"><code><span>PY_VECTORCALL_ARGUMENTS_OFFSET</span></code></a></p></li>
</ul>
<p>This means that both the incoming and outgoing ends of the vector call
protocol are now available in the <a href="https://www.wildlondon.org.uk/blog/c-api/stable.html#stable"><span>Limited API</span></a>. (Contributed
by Wenzel Jakob in <a href="https://github.com/python/cpython/issues/98586">gh-98586</a>.)</p>
</li>
<li><p>Add two new public functions,
<a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyEval_SetProfileAllThreads" title="PyEval_SetProfileAllThreads"><code><span>PyEval_SetProfileAllThreads()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyEval_SetTraceAllThreads" title="PyEval_SetTraceAllThreads"><code><span>PyEval_SetTraceAllThreads()</span></code></a>, that allow to set tracing and profiling
functions in all running threads in addition to the calling one. (Contributed
by Pablo Galindo in <a href="https://github.com/python/cpython/issues/93503">gh-93503</a>.)</p></li>
<li><p>Add new function <a href="https://www.wildlondon.org.uk/blog/c-api/function.html#c.PyFunction_SetVectorcall" title="PyFunction_SetVectorcall"><code><span>PyFunction_SetVectorcall()</span></code></a> to the C API
which sets the vectorcall field of a given <a href="https://www.wildlondon.org.uk/blog/c-api/function.html#c.PyFunctionObject" title="PyFunctionObject"><code><span>PyFunctionObject</span></code></a>.
(Contributed by Andrew Frost in <a href="https://github.com/python/cpython/issues/92257">gh-92257</a>.)</p></li>
<li><p>The C API now permits registering callbacks via <a href="https://www.wildlondon.org.uk/blog/c-api/dict.html#c.PyDict_AddWatcher" title="PyDict_AddWatcher"><code><span>PyDict_AddWatcher()</span></code></a>,
<a href="https://www.wildlondon.org.uk/blog/c-api/dict.html#c.PyDict_Watch" title="PyDict_Watch"><code><span>PyDict_Watch()</span></code></a> and related APIs to be called whenever a dictionary
is modified. This is intended for use by optimizing interpreters, JIT
compilers, or debuggers.
(Contributed by Carl Meyer in <a href="https://github.com/python/cpython/issues/91052">gh-91052</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_AddWatcher" title="PyType_AddWatcher"><code><span>PyType_AddWatcher()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_Watch" title="PyType_Watch"><code><span>PyType_Watch()</span></code></a> API to register
callbacks to receive notification on changes to a type.
(Contributed by Carl Meyer in <a href="https://github.com/python/cpython/issues/91051">gh-91051</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/c-api/code.html#c.PyCode_AddWatcher" title="PyCode_AddWatcher"><code><span>PyCode_AddWatcher()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/code.html#c.PyCode_ClearWatcher" title="PyCode_ClearWatcher"><code><span>PyCode_ClearWatcher()</span></code></a>
APIs to register callbacks to receive notification on creation and
destruction of code objects.
(Contributed by Itamar Oren in <a href="https://github.com/python/cpython/issues/91054">gh-91054</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/c-api/frame.html#c.PyFrame_GetVar" title="PyFrame_GetVar"><code><span>PyFrame_GetVar()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/frame.html#c.PyFrame_GetVarString" title="PyFrame_GetVarString"><code><span>PyFrame_GetVarString()</span></code></a> functions to
get a frame variable by its name.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/91248">gh-91248</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code><span>PyErr_GetRaisedException()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_SetRaisedException" title="PyErr_SetRaisedException"><code><span>PyErr_SetRaisedException()</span></code></a>
for saving and restoring the current exception.
These functions return and accept a single exception object,
rather than the triple arguments of the now-deprecated
<a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_Fetch" title="PyErr_Fetch"><code><span>PyErr_Fetch()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_Restore" title="PyErr_Restore"><code><span>PyErr_Restore()</span></code></a>.
This is less error prone and a bit more efficient.
(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/101578">gh-101578</a>.)</p></li>
<li><p>Add <code><span>_PyErr_ChainExceptions1</span></code>, which takes an exception instance,
to replace the legacy-API <code><span>_PyErr_ChainExceptions</span></code>, which is now
deprecated. (Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/101578">gh-101578</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyException_GetArgs" title="PyException_GetArgs"><code><span>PyException_GetArgs()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyException_SetArgs" title="PyException_SetArgs"><code><span>PyException_SetArgs()</span></code></a>
as convenience functions for retrieving and modifying
the <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#BaseException.args" title="BaseException.args"><code><span>args</span></code></a> passed to the exception’s constructor.
(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/101578">gh-101578</a>.)</p></li>
<li><p>Add <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_DisplayException" title="PyErr_DisplayException"><code><span>PyErr_DisplayException()</span></code></a>, which takes an exception instance,
to replace the legacy-api <code><span>PyErr_Display()</span></code>. (Contributed by
Irit Katriel in <a href="https://github.com/python/cpython/issues/102755">gh-102755</a>).</p></li>
</ul>
<ul id="whatsnew312-pep683">
<li><p><span id="index-43"></span><a href="https://peps.python.org/pep-0683/"><strong>PEP 683</strong></a>: Introduce <em>Immortal Objects</em>, which allows objects
to bypass reference counts, and related changes to the C-API:</p>
<ul>
<li><dl>
<dt><code><span>_Py_IMMORTAL_REFCNT</span></code>: The reference count that defines an object</dt><dd><p>as immortal.</p>
</dd>
</dl>
</li>
<li><p><code><span>_Py_IsImmortal</span></code> Checks if an object has the immortal reference count.</p></li>
<li><dl>
<dt><code><span>PyObject_HEAD_INIT</span></code> This will now initialize reference count to</dt><dd><p><code><span>_Py_IMMORTAL_REFCNT</span></code> when used with <code><span>Py_BUILD_CORE</span></code>.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code><span>SSTATE_INTERNED_IMMORTAL</span></code> An identifier for interned unicode objects</dt><dd><p>that are immortal.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code><span>SSTATE_INTERNED_IMMORTAL_STATIC</span></code> An identifier for interned unicode</dt><dd><p>objects that are immortal and static</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code><span>sys.getunicodeinternedsize</span></code> This returns the total number of unicode</dt><dd><p>objects that have been interned. This is now needed for <code><span>refleak.py</span></code> to
correctly track reference counts and allocated blocks</p>
</dd>
</dl>
</li>
</ul>
<p>(Contributed by Eddie Elizondo in <a href="https://github.com/python/cpython/issues/84436">gh-84436</a>.)</p>
</li>
<li><p><span id="index-44"></span><a href="https://peps.python.org/pep-0684/"><strong>PEP 684</strong></a>: Add the new <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_NewInterpreterFromConfig" title="Py_NewInterpreterFromConfig"><code><span>Py_NewInterpreterFromConfig()</span></code></a>
function and <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyInterpreterConfig" title="PyInterpreterConfig"><code><span>PyInterpreterConfig</span></code></a>, which may be used
to create sub-interpreters with their own GILs.
(See <a href="#whatsnew312-pep684"><span>PEP 684: A Per-Interpreter GIL</span></a> for more info.)
(Contributed by Eric Snow in <a href="https://github.com/python/cpython/issues/104110">gh-104110</a>.)</p></li>
<li><p>In the limited C API version 3.12, <a href="https://www.wildlondon.org.uk/blog/c-api/refcounting.html#c.Py_INCREF" title="Py_INCREF"><code><span>Py_INCREF()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/refcounting.html#c.Py_DECREF" title="Py_DECREF"><code><span>Py_DECREF()</span></code></a> functions are now implemented as opaque function calls to
hide implementation details.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/105387">gh-105387</a>.)</p></li>
</ul>
</section>
<section id="id5">
<h3>Porting to Python 3.12<a href="#id5" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Legacy Unicode APIs based on <code><span>Py_UNICODE*</span></code> representation has been removed.
Please migrate to APIs based on UTF-8 or <code><span>wchar_t*</span></code>.</p></li>
<li><p>Argument parsing functions like <a href="https://www.wildlondon.org.uk/blog/c-api/arg.html#c.PyArg_ParseTuple" title="PyArg_ParseTuple"><code><span>PyArg_ParseTuple()</span></code></a> doesn’t support
<code><span>Py_UNICODE*</span></code> based format (e.g. <code><span>u</span></code>, <code><span>Z</span></code>) anymore. Please migrate
to other formats for Unicode like <code><span>s</span></code>, <code><span>z</span></code>, <code><span>es</span></code>, and <code><span>U</span></code>.</p></li>
<li><p><code><span>tp_weaklist</span></code> for all static builtin types is always <code><span>NULL</span></code>.
This is an internal-only field on <code><span>PyTypeObject</span></code>
but we’re pointing out the change in case someone happens to be
accessing the field directly anyway.  To avoid breakage, consider
using the existing public C-API instead, or, if necessary, the
(internal-only) <code><span>_PyObject_GET_WEAKREFS_LISTPTR()</span></code> macro.</p></li>
<li><p>This internal-only <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.PyTypeObject.tp_subclasses" title="PyTypeObject.tp_subclasses"><code><span>PyTypeObject.tp_subclasses</span></code></a> may now not be
a valid object pointer.  Its type was changed to <span><span>void</span><span>*</span></span> to
reflect this.  We mention this in case someone happens to be accessing the
internal-only field directly.</p>
<p>To get a list of subclasses, call the Python method
<a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#class.__subclasses__" title="class.__subclasses__"><code><span>__subclasses__()</span></code></a> (using <a href="https://www.wildlondon.org.uk/blog/c-api/call.html#c.PyObject_CallMethod" title="PyObject_CallMethod"><code><span>PyObject_CallMethod()</span></code></a>,
for example).</p>
</li>
<li><p>Add support of more formatting options (left aligning, octals, uppercase
hexadecimals, <code><span>intmax_t</span></code>, <code><span>ptrdiff_t</span></code>, <code><span>wchar_t</span></code> C
strings, variable width and precision) in <a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code><span>PyUnicode_FromFormat()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_FromFormatV" title="PyUnicode_FromFormatV"><code><span>PyUnicode_FromFormatV()</span></code></a>.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/98836">gh-98836</a>.)</p></li>
<li><p>An unrecognized format character in <a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code><span>PyUnicode_FromFormat()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_FromFormatV" title="PyUnicode_FromFormatV"><code><span>PyUnicode_FromFormatV()</span></code></a> now sets a <a href="https://www.wildlondon.org.uk/blog/library/exceptions.html#SystemError" title="SystemError"><code><span>SystemError</span></code></a>.
In previous versions it caused all the rest of the format string to be
copied as-is to the result string, and any extra arguments discarded.
(Contributed by Serhiy Storchaka in <a href="https://github.com/python/cpython/issues/95781">gh-95781</a>.)</p></li>
<li><p>Fix wrong sign placement in <a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_FromFormat" title="PyUnicode_FromFormat"><code><span>PyUnicode_FromFormat()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_FromFormatV" title="PyUnicode_FromFormatV"><code><span>PyUnicode_FromFormatV()</span></code></a>.
(Contributed by Philip Georgi in <a href="https://github.com/python/cpython/issues/95504">gh-95504</a>.)</p></li>
<li><p>Extension classes wanting to add a <code><span>__dict__</span></code> or weak reference slot
should use <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_DICT" title="Py_TPFLAGS_MANAGED_DICT"><code><span>Py_TPFLAGS_MANAGED_DICT</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_WEAKREF" title="Py_TPFLAGS_MANAGED_WEAKREF"><code><span>Py_TPFLAGS_MANAGED_WEAKREF</span></code></a> instead of <code><span>tp_dictoffset</span></code> and
<code><span>tp_weaklistoffset</span></code>, respectively.
The use of <code><span>tp_dictoffset</span></code> and <code><span>tp_weaklistoffset</span></code> is still
supported, but does not fully support multiple inheritance
(<a href="https://github.com/python/cpython/issues/95589">gh-95589</a>), and performance may be worse.
Classes declaring <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_MANAGED_DICT" title="Py_TPFLAGS_MANAGED_DICT"><code><span>Py_TPFLAGS_MANAGED_DICT</span></code></a> should call
<code><span>_PyObject_VisitManagedDict()</span></code> and <code><span>_PyObject_ClearManagedDict()</span></code>
to traverse and clear their instance’s dictionaries.
To clear weakrefs, call <a href="https://www.wildlondon.org.uk/blog/c-api/weakref.html#c.PyObject_ClearWeakRefs" title="PyObject_ClearWeakRefs"><code><span>PyObject_ClearWeakRefs()</span></code></a>, as before.</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_FSDecoder" title="PyUnicode_FSDecoder"><code><span>PyUnicode_FSDecoder()</span></code></a> function no longer accepts bytes-like
paths, like <a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#bytearray" title="bytearray"><code><span>bytearray</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#memoryview" title="memoryview"><code><span>memoryview</span></code></a> types: only the exact
<a href="https://www.wildlondon.org.uk/blog/library/stdtypes.html#bytes" title="bytes"><code><span>bytes</span></code></a> type is accepted for bytes strings.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/98393">gh-98393</a>.)</p></li>
<li><p>The <a href="https://www.wildlondon.org.uk/blog/c-api/refcounting.html#c.Py_CLEAR" title="Py_CLEAR"><code><span>Py_CLEAR</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/c-api/refcounting.html#c.Py_SETREF" title="Py_SETREF"><code><span>Py_SETREF</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/refcounting.html#c.Py_XSETREF" title="Py_XSETREF"><code><span>Py_XSETREF</span></code></a>
macros now only evaluate their arguments once. If an argument has side
effects, these side effects are no longer duplicated.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/98724">gh-98724</a>.)</p></li>
<li><p>The interpreter’s error indicator is now always normalized. This means
that <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_SetObject" title="PyErr_SetObject"><code><span>PyErr_SetObject()</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_SetString" title="PyErr_SetString"><code><span>PyErr_SetString()</span></code></a> and the other
functions that set the error indicator now normalize the exception
before storing it. (Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/101578">gh-101578</a>.)</p></li>
<li><p><code><span>_Py_RefTotal</span></code> is no longer authoritative and only kept around
for ABI compatibility.  Note that it is an internal global and only
available on debug builds.  If you happen to be using it then you’ll
need to start using <code><span>_Py_GetGlobalRefTotal()</span></code>.</p></li>
<li><p>The following functions now select an appropriate metaclass for the newly
created type:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromSpec" title="PyType_FromSpec"><code><span>PyType_FromSpec()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromSpecWithBases" title="PyType_FromSpecWithBases"><code><span>PyType_FromSpecWithBases()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code><span>PyType_FromModuleAndSpec()</span></code></a></p></li>
</ul>
<p>Creating classes whose metaclass overrides <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.PyTypeObject.tp_new" title="PyTypeObject.tp_new"><code><span>tp_new</span></code></a>
is deprecated, and in Python 3.14+ it will be disallowed.
Note that these functions ignore <code><span>tp_new</span></code> of the metaclass, possibly
allowing incomplete initialization.</p>
<p>Note that <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromMetaclass" title="PyType_FromMetaclass"><code><span>PyType_FromMetaclass()</span></code></a> (added in Python 3.12)
already disallows creating classes whose metaclass overrides <code><span>tp_new</span></code>
(<a href="https://www.wildlondon.org.uk/blog/reference/datamodel.html#object.__new__" title="object.__new__"><code><span>__new__()</span></code></a> in Python).</p>
<p>Since <code><span>tp_new</span></code> overrides almost everything <code><span>PyType_From*</span></code> functions do,
the two are incompatible with each other.
The existing behavior – ignoring the metaclass for several steps
of type creation – is unsafe in general, since (meta)classes assume that
<code><span>tp_new</span></code> was called.
There is no simple general workaround. One of the following may work for you:</p>
<ul>
<li><p>If you control the metaclass, avoid using <code><span>tp_new</span></code> in it:</p>
<ul>
<li><p>If initialization can be skipped, it can be done in
<a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.PyTypeObject.tp_init" title="PyTypeObject.tp_init"><code><span>tp_init</span></code></a> instead.</p></li>
<li><p>If the metaclass doesn’t need to be instantiated from Python,
set its <code><span>tp_new</span></code> to <code><span>NULL</span></code> using
the <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_DISALLOW_INSTANTIATION" title="Py_TPFLAGS_DISALLOW_INSTANTIATION"><code><span>Py_TPFLAGS_DISALLOW_INSTANTIATION</span></code></a> flag.
This makes it acceptable for <code><span>PyType_From*</span></code> functions.</p></li>
</ul>
</li>
<li><p>Avoid <code><span>PyType_From*</span></code> functions: if you don’t need C-specific features
(slots or setting the instance size), create types by <a href="https://www.wildlondon.org.uk/blog/c-api/call.html#call"><span>calling</span></a>
the metaclass.</p></li>
<li><p>If you <em>know</em> the <code><span>tp_new</span></code> can be skipped safely, filter the deprecation
warning out using <a href="https://www.wildlondon.org.uk/blog/library/warnings.html#warnings.catch_warnings" title="warnings.catch_warnings"><code><span>warnings.catch_warnings()</span></code></a> from Python.</p></li>
</ul>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/veryhigh.html#c.PyOS_InputHook" title="PyOS_InputHook"><code><span>PyOS_InputHook</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/veryhigh.html#c.PyOS_ReadlineFunctionPointer" title="PyOS_ReadlineFunctionPointer"><code><span>PyOS_ReadlineFunctionPointer</span></code></a> are no
longer called in <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#sub-interpreter-support"><span>subinterpreters</span></a>. This is
because clients generally rely on process-wide global state (since these
callbacks have no way of recovering extension module state).</p>
<p>This also avoids situations where extensions may find themselves running in a
subinterpreter that they don’t support (or haven’t yet been loaded in). See
<a href="https://github.com/python/cpython/issues/104668">gh-104668</a> for more info.</p>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/long.html#c.PyLongObject" title="PyLongObject"><code><span>PyLongObject</span></code></a> has had its internals changed for better performance.
Although the internals of <a href="https://www.wildlondon.org.uk/blog/c-api/long.html#c.PyLongObject" title="PyLongObject"><code><span>PyLongObject</span></code></a> are private, they are used
by some extension modules.
The internal fields should no longer be accessed directly, instead the API
functions beginning <code><span>PyLong_...</span></code> should be used instead.
Two new <em>unstable</em> API functions are provided for efficient access to the
value of <a href="https://www.wildlondon.org.uk/blog/c-api/long.html#c.PyLongObject" title="PyLongObject"><code><span>PyLongObject</span></code></a>s which fit into a single machine word:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/long.html#c.PyUnstable_Long_IsCompact" title="PyUnstable_Long_IsCompact"><code><span>PyUnstable_Long_IsCompact()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/long.html#c.PyUnstable_Long_CompactValue" title="PyUnstable_Long_CompactValue"><code><span>PyUnstable_Long_CompactValue()</span></code></a></p></li>
</ul>
</li>
<li><p>Custom allocators, set via <a href="https://www.wildlondon.org.uk/blog/c-api/memory.html#c.PyMem_SetAllocator" title="PyMem_SetAllocator"><code><span>PyMem_SetAllocator()</span></code></a>, are now
required to be thread-safe, regardless of memory domain.  Allocators
that don’t have their own state, including “hooks”, are not affected.
If your custom allocator is not already thread-safe and you need
guidance then please create a new GitHub issue
and CC <code><span>@ericsnowcurrently</span></code>.</p></li>
</ul>
</section>
<section id="id6">
<h3>Deprecated<a href="#id6" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>In accordance with <span id="index-45"></span><a href="https://peps.python.org/pep-0699/"><strong>PEP 699</strong></a>, the <code><span>ma_version_tag</span></code> field in <a href="https://www.wildlondon.org.uk/blog/c-api/dict.html#c.PyDictObject" title="PyDictObject"><code><span>PyDictObject</span></code></a>
is deprecated for extension modules. Accessing this field will generate a compiler
warning at compile time. This field will be removed in Python 3.14.
(Contributed by Ramvikrams and Kumar Aditya in <a href="https://github.com/python/cpython/issues/101193">gh-101193</a>. PEP by Ken Jin.)</p></li>
<li><p>Deprecate global configuration variable:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_DebugFlag" title="Py_DebugFlag"><code><span>Py_DebugFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.parser_debug" title="PyConfig.parser_debug"><code><span>PyConfig.parser_debug</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_VerboseFlag" title="Py_VerboseFlag"><code><span>Py_VerboseFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.verbose" title="PyConfig.verbose"><code><span>PyConfig.verbose</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_QuietFlag" title="Py_QuietFlag"><code><span>Py_QuietFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.quiet" title="PyConfig.quiet"><code><span>PyConfig.quiet</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_InteractiveFlag" title="Py_InteractiveFlag"><code><span>Py_InteractiveFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.interactive" title="PyConfig.interactive"><code><span>PyConfig.interactive</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_InspectFlag" title="Py_InspectFlag"><code><span>Py_InspectFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.inspect" title="PyConfig.inspect"><code><span>PyConfig.inspect</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_OptimizeFlag" title="Py_OptimizeFlag"><code><span>Py_OptimizeFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.optimization_level" title="PyConfig.optimization_level"><code><span>PyConfig.optimization_level</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_NoSiteFlag" title="Py_NoSiteFlag"><code><span>Py_NoSiteFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.site_import" title="PyConfig.site_import"><code><span>PyConfig.site_import</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_BytesWarningFlag" title="Py_BytesWarningFlag"><code><span>Py_BytesWarningFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.bytes_warning" title="PyConfig.bytes_warning"><code><span>PyConfig.bytes_warning</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_FrozenFlag" title="Py_FrozenFlag"><code><span>Py_FrozenFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.pathconfig_warnings" title="PyConfig.pathconfig_warnings"><code><span>PyConfig.pathconfig_warnings</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_IgnoreEnvironmentFlag" title="Py_IgnoreEnvironmentFlag"><code><span>Py_IgnoreEnvironmentFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.use_environment" title="PyConfig.use_environment"><code><span>PyConfig.use_environment</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_DontWriteBytecodeFlag" title="Py_DontWriteBytecodeFlag"><code><span>Py_DontWriteBytecodeFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.write_bytecode" title="PyConfig.write_bytecode"><code><span>PyConfig.write_bytecode</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_NoUserSiteDirectory" title="Py_NoUserSiteDirectory"><code><span>Py_NoUserSiteDirectory</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.user_site_directory" title="PyConfig.user_site_directory"><code><span>PyConfig.user_site_directory</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_UnbufferedStdioFlag" title="Py_UnbufferedStdioFlag"><code><span>Py_UnbufferedStdioFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.buffered_stdio" title="PyConfig.buffered_stdio"><code><span>PyConfig.buffered_stdio</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_HashRandomizationFlag" title="Py_HashRandomizationFlag"><code><span>Py_HashRandomizationFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.use_hash_seed" title="PyConfig.use_hash_seed"><code><span>PyConfig.use_hash_seed</span></code></a>
and <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.hash_seed" title="PyConfig.hash_seed"><code><span>PyConfig.hash_seed</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_IsolatedFlag" title="Py_IsolatedFlag"><code><span>Py_IsolatedFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.isolated" title="PyConfig.isolated"><code><span>PyConfig.isolated</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_LegacyWindowsFSEncodingFlag" title="Py_LegacyWindowsFSEncodingFlag"><code><span>Py_LegacyWindowsFSEncodingFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyPreConfig.legacy_windows_fs_encoding" title="PyPreConfig.legacy_windows_fs_encoding"><code><span>PyPreConfig.legacy_windows_fs_encoding</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_LegacyWindowsStdioFlag" title="Py_LegacyWindowsStdioFlag"><code><span>Py_LegacyWindowsStdioFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.legacy_windows_stdio" title="PyConfig.legacy_windows_stdio"><code><span>PyConfig.legacy_windows_stdio</span></code></a></p></li>
<li><p><code><span>Py_FileSystemDefaultEncoding</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code><span>PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code><span>Py_HasFileSystemDefaultEncoding</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code><span>PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code><span>Py_FileSystemDefaultEncodeErrors</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.filesystem_errors" title="PyConfig.filesystem_errors"><code><span>PyConfig.filesystem_errors</span></code></a></p></li>
<li><p><code><span>Py_UTF8Mode</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyPreConfig.utf8_mode" title="PyPreConfig.utf8_mode"><code><span>PyPreConfig.utf8_mode</span></code></a> (see <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.Py_PreInitialize" title="Py_PreInitialize"><code><span>Py_PreInitialize()</span></code></a>)</p></li>
</ul>
<p>The <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.Py_InitializeFromConfig" title="Py_InitializeFromConfig"><code><span>Py_InitializeFromConfig()</span></code></a> API should be used with
<a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig" title="PyConfig"><code><span>PyConfig</span></code></a> instead.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/77782">gh-77782</a>.)</p>
</li>
<li><p>Creating <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code><span>immutable</span> <span>types</span></code></a> with mutable
bases is deprecated and will be disabled in Python 3.14. (<a href="https://github.com/python/cpython/issues/95388">gh-95388</a>)</p></li>
<li><p>The <code><span>structmember.h</span></code> header is deprecated, though it continues to be
available and there are no plans to remove it.</p>
<p>Its contents are now available just by including <code><span>Python.h</span></code>,
with a <code><span>Py</span></code> prefix added if it was missing:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.PyMemberDef" title="PyMemberDef"><code><span>PyMemberDef</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.PyMember_GetOne" title="PyMember_GetOne"><code><span>PyMember_GetOne()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.PyMember_SetOne" title="PyMember_SetOne"><code><span>PyMember_SetOne()</span></code></a></p></li>
<li><p>Type macros like <a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.Py_T_INT" title="Py_T_INT"><code><span>Py_T_INT</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.Py_T_DOUBLE" title="Py_T_DOUBLE"><code><span>Py_T_DOUBLE</span></code></a>, etc.
(previously <code><span>T_INT</span></code>, <code><span>T_DOUBLE</span></code>, etc.)</p></li>
<li><p>The flags <a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.Py_READONLY" title="Py_READONLY"><code><span>Py_READONLY</span></code></a> (previously <code><span>READONLY</span></code>) and
<a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.Py_AUDIT_READ" title="Py_AUDIT_READ"><code><span>Py_AUDIT_READ</span></code></a> (previously all uppercase)</p></li>
</ul>
<p>Several items are not exposed from <code><span>Python.h</span></code>:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.T_OBJECT" title="T_OBJECT"><code><span>T_OBJECT</span></code></a> (use <a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.Py_T_OBJECT_EX" title="Py_T_OBJECT_EX"><code><span>Py_T_OBJECT_EX</span></code></a>)</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.T_NONE" title="T_NONE"><code><span>T_NONE</span></code></a> (previously undocumented, and pretty quirky)</p></li>
<li><p>The macro <code><span>WRITE_RESTRICTED</span></code> which does nothing.</p></li>
<li><p>The macros <code><span>RESTRICTED</span></code> and <code><span>READ_RESTRICTED</span></code>, equivalents of
<a href="https://www.wildlondon.org.uk/blog/c-api/structures.html#c.Py_AUDIT_READ" title="Py_AUDIT_READ"><code><span>Py_AUDIT_READ</span></code></a>.</p></li>
<li><p>In some configurations, <code><span>&lt;stddef.h&gt;</span></code> is not included from <code><span>Python.h</span></code>.
It should be included manually when using <code><span>offsetof()</span></code>.</p></li>
</ul>
<p>The deprecated header continues to provide its original
contents under the original names.
Your old code can stay unchanged, unless the extra include and non-namespaced
macros bother you greatly.</p>
<p>(Contributed in <a href="https://github.com/python/cpython/issues/47146">gh-47146</a> by Petr Viktorin, based on
earlier work by Alexander Belopolsky and Matthias Braun.)</p>
</li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_Fetch" title="PyErr_Fetch"><code><span>PyErr_Fetch()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_Restore" title="PyErr_Restore"><code><span>PyErr_Restore()</span></code></a> are deprecated.
Use <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code><span>PyErr_GetRaisedException()</span></code></a> and
<a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_SetRaisedException" title="PyErr_SetRaisedException"><code><span>PyErr_SetRaisedException()</span></code></a> instead.
(Contributed by Mark Shannon in <a href="https://github.com/python/cpython/issues/101578">gh-101578</a>.)</p></li>
<li><p><code><span>PyErr_Display()</span></code> is deprecated. Use <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_DisplayException" title="PyErr_DisplayException"><code><span>PyErr_DisplayException()</span></code></a>
instead. (Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/102755">gh-102755</a>).</p></li>
<li><p><code><span>_PyErr_ChainExceptions</span></code> is deprecated. Use <code><span>_PyErr_ChainExceptions1</span></code>
instead. (Contributed by Irit Katriel in <a href="https://github.com/python/cpython/issues/102192">gh-102192</a>.)</p></li>
<li><p>Using <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromSpec" title="PyType_FromSpec"><code><span>PyType_FromSpec()</span></code></a>, <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromSpecWithBases" title="PyType_FromSpecWithBases"><code><span>PyType_FromSpecWithBases()</span></code></a>
or <a href="https://www.wildlondon.org.uk/blog/c-api/type.html#c.PyType_FromModuleAndSpec" title="PyType_FromModuleAndSpec"><code><span>PyType_FromModuleAndSpec()</span></code></a> to create a class whose metaclass
overrides <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.PyTypeObject.tp_new" title="PyTypeObject.tp_new"><code><span>tp_new</span></code></a> is deprecated.
Call the metaclass instead.</p></li>
</ul>
<section id="id7">
<h4>Pending Removal in Python 3.14<a href="#id7" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>The <code><span>ma_version_tag</span></code> field in <a href="https://www.wildlondon.org.uk/blog/c-api/dict.html#c.PyDictObject" title="PyDictObject"><code><span>PyDictObject</span></code></a> for extension modules
(<span id="index-46"></span><a href="https://peps.python.org/pep-0699/"><strong>PEP 699</strong></a>; <a href="https://github.com/python/cpython/issues/101193">gh-101193</a>).</p></li>
<li><p>Global configuration variables:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_DebugFlag" title="Py_DebugFlag"><code><span>Py_DebugFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.parser_debug" title="PyConfig.parser_debug"><code><span>PyConfig.parser_debug</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_VerboseFlag" title="Py_VerboseFlag"><code><span>Py_VerboseFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.verbose" title="PyConfig.verbose"><code><span>PyConfig.verbose</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_QuietFlag" title="Py_QuietFlag"><code><span>Py_QuietFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.quiet" title="PyConfig.quiet"><code><span>PyConfig.quiet</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_InteractiveFlag" title="Py_InteractiveFlag"><code><span>Py_InteractiveFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.interactive" title="PyConfig.interactive"><code><span>PyConfig.interactive</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_InspectFlag" title="Py_InspectFlag"><code><span>Py_InspectFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.inspect" title="PyConfig.inspect"><code><span>PyConfig.inspect</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_OptimizeFlag" title="Py_OptimizeFlag"><code><span>Py_OptimizeFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.optimization_level" title="PyConfig.optimization_level"><code><span>PyConfig.optimization_level</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_NoSiteFlag" title="Py_NoSiteFlag"><code><span>Py_NoSiteFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.site_import" title="PyConfig.site_import"><code><span>PyConfig.site_import</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_BytesWarningFlag" title="Py_BytesWarningFlag"><code><span>Py_BytesWarningFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.bytes_warning" title="PyConfig.bytes_warning"><code><span>PyConfig.bytes_warning</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_FrozenFlag" title="Py_FrozenFlag"><code><span>Py_FrozenFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.pathconfig_warnings" title="PyConfig.pathconfig_warnings"><code><span>PyConfig.pathconfig_warnings</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_IgnoreEnvironmentFlag" title="Py_IgnoreEnvironmentFlag"><code><span>Py_IgnoreEnvironmentFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.use_environment" title="PyConfig.use_environment"><code><span>PyConfig.use_environment</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_DontWriteBytecodeFlag" title="Py_DontWriteBytecodeFlag"><code><span>Py_DontWriteBytecodeFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.write_bytecode" title="PyConfig.write_bytecode"><code><span>PyConfig.write_bytecode</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_NoUserSiteDirectory" title="Py_NoUserSiteDirectory"><code><span>Py_NoUserSiteDirectory</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.user_site_directory" title="PyConfig.user_site_directory"><code><span>PyConfig.user_site_directory</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_UnbufferedStdioFlag" title="Py_UnbufferedStdioFlag"><code><span>Py_UnbufferedStdioFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.buffered_stdio" title="PyConfig.buffered_stdio"><code><span>PyConfig.buffered_stdio</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_HashRandomizationFlag" title="Py_HashRandomizationFlag"><code><span>Py_HashRandomizationFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.use_hash_seed" title="PyConfig.use_hash_seed"><code><span>PyConfig.use_hash_seed</span></code></a>
and <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.hash_seed" title="PyConfig.hash_seed"><code><span>PyConfig.hash_seed</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_IsolatedFlag" title="Py_IsolatedFlag"><code><span>Py_IsolatedFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.isolated" title="PyConfig.isolated"><code><span>PyConfig.isolated</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_LegacyWindowsFSEncodingFlag" title="Py_LegacyWindowsFSEncodingFlag"><code><span>Py_LegacyWindowsFSEncodingFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyPreConfig.legacy_windows_fs_encoding" title="PyPreConfig.legacy_windows_fs_encoding"><code><span>PyPreConfig.legacy_windows_fs_encoding</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_LegacyWindowsStdioFlag" title="Py_LegacyWindowsStdioFlag"><code><span>Py_LegacyWindowsStdioFlag</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.legacy_windows_stdio" title="PyConfig.legacy_windows_stdio"><code><span>PyConfig.legacy_windows_stdio</span></code></a></p></li>
<li><p><code><span>Py_FileSystemDefaultEncoding</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code><span>PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code><span>Py_HasFileSystemDefaultEncoding</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.filesystem_encoding" title="PyConfig.filesystem_encoding"><code><span>PyConfig.filesystem_encoding</span></code></a></p></li>
<li><p><code><span>Py_FileSystemDefaultEncodeErrors</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.filesystem_errors" title="PyConfig.filesystem_errors"><code><span>PyConfig.filesystem_errors</span></code></a></p></li>
<li><p><code><span>Py_UTF8Mode</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyPreConfig.utf8_mode" title="PyPreConfig.utf8_mode"><code><span>PyPreConfig.utf8_mode</span></code></a> (see <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.Py_PreInitialize" title="Py_PreInitialize"><code><span>Py_PreInitialize()</span></code></a>)</p></li>
</ul>
<p>The <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.Py_InitializeFromConfig" title="Py_InitializeFromConfig"><code><span>Py_InitializeFromConfig()</span></code></a> API should be used with
<a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig" title="PyConfig"><code><span>PyConfig</span></code></a> instead.</p>
</li>
<li><p>Creating <a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_IMMUTABLETYPE" title="Py_TPFLAGS_IMMUTABLETYPE"><code><span>immutable</span> <span>types</span></code></a> with mutable
bases (<a href="https://github.com/python/cpython/issues/95388">gh-95388</a>).</p></li>
</ul>
</section>
<section id="pending-removal-in-python-3-15">
<h4>Pending Removal in Python 3.15<a href="#pending-removal-in-python-3-15" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/import.html#c.PyImport_ImportModuleNoBlock" title="PyImport_ImportModuleNoBlock"><code><span>PyImport_ImportModuleNoBlock()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/import.html#c.PyImport_ImportModule" title="PyImport_ImportModule"><code><span>PyImport_ImportModule()</span></code></a></p></li>
<li><p><code><span>Py_UNICODE_WIDE</span></code> type: use <code><span>wchar_t</span></code></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.Py_UNICODE" title="Py_UNICODE"><code><span>Py_UNICODE</span></code></a> type: use <code><span>wchar_t</span></code></p></li>
<li><p>Python initialization functions:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/sys.html#c.PySys_ResetWarnOptions" title="PySys_ResetWarnOptions"><code><span>PySys_ResetWarnOptions()</span></code></a>: clear <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.warnoptions" title="sys.warnoptions"><code><span>sys.warnoptions</span></code></a> and
<code><span>warnings.filters</span></code></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_GetExecPrefix" title="Py_GetExecPrefix"><code><span>Py_GetExecPrefix()</span></code></a>: get <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.exec_prefix" title="sys.exec_prefix"><code><span>sys.exec_prefix</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_GetPath" title="Py_GetPath"><code><span>Py_GetPath()</span></code></a>: get <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.path" title="sys.path"><code><span>sys.path</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_GetPrefix" title="Py_GetPrefix"><code><span>Py_GetPrefix()</span></code></a>: get <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.prefix" title="sys.prefix"><code><span>sys.prefix</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_GetProgramFullPath" title="Py_GetProgramFullPath"><code><span>Py_GetProgramFullPath()</span></code></a>: get <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.executable" title="sys.executable"><code><span>sys.executable</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_GetProgramName" title="Py_GetProgramName"><code><span>Py_GetProgramName()</span></code></a>: get <a href="https://www.wildlondon.org.uk/blog/library/sys.html#sys.executable" title="sys.executable"><code><span>sys.executable</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.Py_GetPythonHome" title="Py_GetPythonHome"><code><span>Py_GetPythonHome()</span></code></a>: get <a href="https://www.wildlondon.org.uk/blog/c-api/init_config.html#c.PyConfig.home" title="PyConfig.home"><code><span>PyConfig.home</span></code></a> or
the <span id="index-47"></span><a href="https://www.wildlondon.org.uk/blog/using/cmdline.html#envvar-PYTHONHOME"><code><span>PYTHONHOME</span></code></a> environment variable</p></li>
</ul>
</li>
</ul>
</section>
<section id="id8">
<h4>Pending Removal in Future Versions<a href="#id8" title="Permalink to this headline">¶</a></h4>
<p>The following APIs are deprecated and will be removed,
although there is currently no date scheduled for their removal.</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/typeobj.html#c.Py_TPFLAGS_HAVE_FINALIZE" title="Py_TPFLAGS_HAVE_FINALIZE"><code><span>Py_TPFLAGS_HAVE_FINALIZE</span></code></a>: unneeded since Python 3.8</p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_Fetch" title="PyErr_Fetch"><code><span>PyErr_Fetch()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code><span>PyErr_GetRaisedException()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_NormalizeException" title="PyErr_NormalizeException"><code><span>PyErr_NormalizeException()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_GetRaisedException" title="PyErr_GetRaisedException"><code><span>PyErr_GetRaisedException()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_Restore" title="PyErr_Restore"><code><span>PyErr_Restore()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_SetRaisedException" title="PyErr_SetRaisedException"><code><span>PyErr_SetRaisedException()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/module.html#c.PyModule_GetFilename" title="PyModule_GetFilename"><code><span>PyModule_GetFilename()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/module.html#c.PyModule_GetFilenameObject" title="PyModule_GetFilenameObject"><code><span>PyModule_GetFilenameObject()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/sys.html#c.PyOS_AfterFork" title="PyOS_AfterFork"><code><span>PyOS_AfterFork()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/sys.html#c.PyOS_AfterFork_Child" title="PyOS_AfterFork_Child"><code><span>PyOS_AfterFork_Child()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/slice.html#c.PySlice_GetIndicesEx" title="PySlice_GetIndicesEx"><code><span>PySlice_GetIndicesEx()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/slice.html#c.PySlice_Unpack" title="PySlice_Unpack"><code><span>PySlice_Unpack()</span></code></a> and <a href="https://www.wildlondon.org.uk/blog/c-api/slice.html#c.PySlice_AdjustIndices" title="PySlice_AdjustIndices"><code><span>PySlice_AdjustIndices()</span></code></a></p></li>
<li><p><code><span>PyUnicode_AsDecodedObject()</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/codec.html#c.PyCodec_Decode" title="PyCodec_Decode"><code><span>PyCodec_Decode()</span></code></a></p></li>
<li><p><code><span>PyUnicode_AsDecodedUnicode()</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/codec.html#c.PyCodec_Decode" title="PyCodec_Decode"><code><span>PyCodec_Decode()</span></code></a></p></li>
<li><p><code><span>PyUnicode_AsEncodedObject()</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/codec.html#c.PyCodec_Encode" title="PyCodec_Encode"><code><span>PyCodec_Encode()</span></code></a></p></li>
<li><p><code><span>PyUnicode_AsEncodedUnicode()</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/codec.html#c.PyCodec_Encode" title="PyCodec_Encode"><code><span>PyCodec_Encode()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/unicode.html#c.PyUnicode_READY" title="PyUnicode_READY"><code><span>PyUnicode_READY()</span></code></a>: unneeded since Python 3.12</p></li>
<li><p><code><span>PyErr_Display()</span></code>: use <a href="https://www.wildlondon.org.uk/blog/c-api/exceptions.html#c.PyErr_DisplayException" title="PyErr_DisplayException"><code><span>PyErr_DisplayException()</span></code></a></p></li>
<li><p><code><span>_PyErr_ChainExceptions()</span></code>: use <code><span>_PyErr_ChainExceptions1</span></code></p></li>
<li><p><code><span>PyBytesObject.ob_shash</span></code> member:
call <a href="https://www.wildlondon.org.uk/blog/c-api/object.html#c.PyObject_Hash" title="PyObject_Hash"><code><span>PyObject_Hash()</span></code></a> instead</p></li>
<li><p><code><span>PyDictObject.ma_version_tag</span></code> member</p></li>
<li><p>Thread Local Storage (TLS) API:</p>
<ul>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_create_key" title="PyThread_create_key"><code><span>PyThread_create_key()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_tss_alloc" title="PyThread_tss_alloc"><code><span>PyThread_tss_alloc()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_delete_key" title="PyThread_delete_key"><code><span>PyThread_delete_key()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_tss_free" title="PyThread_tss_free"><code><span>PyThread_tss_free()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_set_key_value" title="PyThread_set_key_value"><code><span>PyThread_set_key_value()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_tss_set" title="PyThread_tss_set"><code><span>PyThread_tss_set()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_get_key_value" title="PyThread_get_key_value"><code><span>PyThread_get_key_value()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_tss_get" title="PyThread_tss_get"><code><span>PyThread_tss_get()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_delete_key_value" title="PyThread_delete_key_value"><code><span>PyThread_delete_key_value()</span></code></a>: use <a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_tss_delete" title="PyThread_tss_delete"><code><span>PyThread_tss_delete()</span></code></a></p></li>
<li><p><a href="https://www.wildlondon.org.uk/blog/c-api/init.html#c.PyThread_ReInitTLS" title="PyThread_ReInitTLS"><code><span>PyThread_ReInitTLS()</span></code></a>: unneeded since Python 3.7</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="id9">
<h3>Removed<a href="#id9" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Remove the <code><span>token.h</span></code> header file. There was never any public tokenizer C
API. The <code><span>token.h</span></code> header file was only designed to be used by Python
internals.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/92651">gh-92651</a>.)</p></li>
<li><p>Legacy Unicode APIs have been removed. See <span id="index-48"></span><a href="https://peps.python.org/pep-0623/"><strong>PEP 623</strong></a> for detail.</p>
<ul>
<li><p><code><span>PyUnicode_WCHAR_KIND</span></code></p></li>
<li><p><code><span>PyUnicode_AS_UNICODE()</span></code></p></li>
<li><p><code><span>PyUnicode_AsUnicode()</span></code></p></li>
<li><p><code><span>PyUnicode_AsUnicodeAndSize()</span></code></p></li>
<li><p><code><span>PyUnicode_AS_DATA()</span></code></p></li>
<li><p><code><span>PyUnicode_FromUnicode()</span></code></p></li>
<li><p><code><span>PyUnicode_GET_SIZE()</span></code></p></li>
<li><p><code><span>PyUnicode_GetSize()</span></code></p></li>
<li><p><code><span>PyUnicode_GET_DATA_SIZE()</span></code></p></li>
</ul>
</li>
<li><p>Remove the <code><span>PyUnicode_InternImmortal()</span></code> function macro.
(Contributed by Victor Stinner in <a href="https://github.com/python/cpython/issues/85858">gh-85858</a>.)</p></li>
<li><p>Remove <code><span>Jython</span></code> compatibility hacks from several stdlib modules and tests.
(Contributed by Nikita Sobolev in <a href="https://github.com/python/cpython/issues/99482">gh-99482</a>.)</p></li>
<li><p>Remove <code><span>_use_broken_old_ctypes_structure_semantics_</span></code> flag
from <a href="https://www.wildlondon.org.uk/blog/library/ctypes.html#module-ctypes" title="ctypes: A foreign function library for Python."><code><span>ctypes</span></code></a> module.
(Contributed by Nikita Sobolev in <a href="https://github.com/python/cpython/issues/99285">gh-99285</a>.)</p></li>
</ul>
</section>
</section>
</section>


            
          </div>
        </div>
      </div></div>
  </body>
</html>
