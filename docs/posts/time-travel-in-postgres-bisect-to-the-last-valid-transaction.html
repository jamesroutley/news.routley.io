<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://neon.tech/blog/time-travel-with-postgres/">Original</a>
    <h1>Time travel in Postgres. Bisect to the last valid transaction</h1>
    
    <div id="readability-page-1" class="page"><div>
<figure><img src="https://neon.tech/_gatsby/file/a90a440d21536bbd57950adbc46ecf7a/image-2.jpg?u=https%3A%2F%2Fneon-hwp.dreamhosters.com%2Fwp-content%2Fuploads%2F2022%2F12%2Fimage-2.jpg" alt=""/></figure>



<p>One unfortunate scenario you might run into is running a SQL query that accidentally results in data loss. To deal with this issue, you would typically need to have backups and then roll back your database to a previous state.</p>



<p>Neon’s database branching feature enables you to create copies of your database at any point in time to restore your data to a previous state within seconds.</p>



<figure><img src="https://neon.tech/_gatsby/file/45a3dfa8a1b75db690f0e81d9616fe26/image-4.png?u=https%3A%2F%2Fneon-hwp.dreamhosters.com%2Fwp-content%2Fuploads%2F2022%2F12%2Fimage-4.png" alt=""/></figure>



<p>This article will cover how Neon’s data branching works and how you can use it for disaster recovery. If you prefer to watch a video instead, you can check out this <a href="https://neon.tech/developer-days-1/">Developer Days</a> talk, presented by one of Neon’s Co-Founders, <a href="https://github.com/kelvich">Stas Kelvich</a>.</p>



<figure><p>
<iframe loading="lazy" title="All-Things-Branching" width="500" height="281" src="https://www.youtube.com/embed/Qq6wzfopJ38?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</p></figure>



<h2>What is a branch?</h2>



<p>A branch acts as an isolated environment for working with your database. It is a <a href="https://en.wikipedia.org/wiki/Copy-on-write">copy-on-write</a> clone of your data where you can make modifications without affecting the originating data. Each Neon project has a <a href="https://neon.tech/docs/reference/glossary#root-branch">root branch</a> called the main, and you can create more branches depending on your needs.</p>



<h2>Creating a branch</h2>



<p>To get started, you first need to create a project in the<a href="https://console.neon.tech/sign_in"> console</a>.</p>



<p>To create a branch via the console, navigate to the Branches tab and click on “New Branch”</p>



<figure><img src="https://neon.tech/_gatsby/file/61b344a7037bbba0796ec494cf168733/image-5.png?u=https%3A%2F%2Fneon-hwp.dreamhosters.com%2Fwp-content%2Fuploads%2F2022%2F12%2Fimage-5.png" alt=""/></figure>



<p>You will then need to select a parent branch. If this is your first branch, then the parent branch will be main. When it comes to which data you want this branch to copy, you have several options:</p>



<ul>
<li><strong>Head</strong>: creates a branch with all data from the parent branch up to the current point in time.</li>



<li><strong>Time</strong>: creates a branch and pulls all data from the parent branch up to a certain point in time. This feature enables you to restore your database to a previous state within a specific time window. During the technical preview, we offer a window of 7 days.</li>



<li><strong>LSN</strong>: creates a branch and pulls all data from the parent branch up to a certain LSN (<a href="https://neon.tech/docs/reference/glossary/#lsn">Log Sequence Number</a>). This is a pointer to a location in the WAL (<a href="https://neon.tech/docs/reference/glossary/#wal">Write-Ahead Log</a>), which is the log of changes made to the database cluster.</li>
</ul>



<figure><img src="https://neon.tech/_gatsby/file/2a5b0c4e45686e2fccb5e8e81c22911a/image-6.png?u=https%3A%2F%2Fneon-hwp.dreamhosters.com%2Fwp-content%2Fuploads%2F2022%2F12%2Fimage-6.png" alt=""/></figure>



<p>If you have a rough idea of when the database was in the correct state, pick the “Time” option.</p>



<p>Alternatively, you can also create branches via the <a href="https://neon.tech/api-reference/v2/">Neon API</a>. To do that, you will first need to generate an API key. Go to the profile icon in the upper right corner and choose the “Account” option from the dropdown menu. Next, go to the Developer Settings tab and click on “Generate new API key”</p>



<figure><img src="https://neon.tech/_gatsby/file/8307c697b09926760fe505802f1a9102/image-7.png?u=https%3A%2F%2Fneon-hwp.dreamhosters.com%2Fwp-content%2Fuploads%2F2022%2F12%2Fimage-7.png" alt=""/></figure>



<p>Now that you have an API key, you can send a request to the API to create branches. Here’s an example cURL command:</p>


<div language="bash"><pre><code><span>curl</span><span> -X </span><span>\</span><span>\</span><span>
</span><span>POST -H </span><span>\</span><span>\</span><span>
</span><span></span><span>&#34;Authorization: Bearer </span><span>$NEON_API_KEY</span><span>&#34;</span><span> </span><span>&#34;accept: application/json&#34;</span><span>
</span><span></span><span>&#34;&lt;https://neon.tech/api-reference/v2/projects/</span><span>$PROJECT_ID</span><span>/branches&gt;&#34;</span><span> </span><span>|</span><span> jq</span></code></pre></div>


<p>You are sending a `POST` request to the create branch endpoint. You are passing the API key in the request’s header and you’re passing your project ID as a variable. Finally, you’re formatting the JSON response using `jq`, an optional third-party tool (see <a href="https://stedolan.github.io/jq/">jq</a> for more information) </p>



<h2>How to get the most accurate rollback</h2>



<p>Rolling back your database to a certain point in time can be good enough. However, this solution might not work for you if you are not 100% confident when the data loss occurred precisely.</p>



<p>Fortunately, you can leverage Neon’s ability to create point-in-time branches with data up to a particular Log Sequence Number (LSN) to determine precisely when the data loss occurred. Let us take a look at an example:</p>



<p>Imagine you have the following users table:</p>


<div language="bash"><pre><code><span>|</span><span> Name  </span><span>|</span><span>
</span><span></span><span>|</span><span> ----- </span><span>|</span><span>
</span><span></span><span>|</span><span> Bob   </span><span>|</span><span>
</span><span></span><span>|</span><span> Alice </span><span>|</span><span>
</span><span></span><span>|</span><span> Mike  </span><span>|</span><span>
</span><span></span><span>|</span><span> John  </span><span>|</span><span>
</span><span></span><span>|</span><span> Sarah </span><span>|</span><span>
</span><span></span><span>|</span><span> Lilly </span><span>|</span></code></pre></div>


<p>Then for some reason, you wanted to remove Alice from the list manually, so you ran the following query:</p>


<div language="bash"><pre><code><span>DELETE FROM </span><span>users</span><span> WHERE name </span><span>!=</span><span> </span><span>&#34;Alice&#34;</span></code></pre></div>


<p>The next day, you noticed your mistake and discovered that you deleted all users from the table instead of Alice. Unfortunately, you are not sure when exactly the query finished executing and rolling back to an arbitrary date is not an option.</p>



<p>Since Neon offers the ability to create point-in-time branches, you can generate a sequence of branches that include past data in chronological order between two LSNs. You can then go through this list of branches and accurately determine when the disaster occurred.</p>



<p>To generate the list of branches, you will first need to define a start LSN and an end LSN.</p>



<p>To get the start LSN, you can create a branch where you are sure that that data was in a proper state (e.g., one day ago). You can then run the following query to return the LSN</p>


<div language="bash"><pre><code><span>SELECT pg_current_wal_flush_lsn</span><span>(</span><span>)</span><span>
</span><span>// returns a hexadecimal value </span><span>(</span><span>e.g. 1E9F3918</span><span>)</span><span> this will be the start //value of the list</span></code></pre></div>


<p>You then need to run the same query on the branch containing the incorrect data. The returned value will be the end LSN.</p>



<p>After generating the list of branches, you will notice that you have a search problem where the goal is to find the LSN that resulted in the incorrect data.</p>



<p>Since we have a sorted sequence of LSN values, we can leverage the “<a href="https://en.wikipedia.org/wiki/Binary_search_algorithm">binary search</a>” algorithm.</p>



<p>Here is a quick summary of how it works:</p>



<ol>
<li>Divide the list into two halves, and compare the target item with the middle item in the list. If the target is equal to the middle item, you have found it, and the search is over.</li>



<li>If the target is less than the middle item, the target must be in the left half of the list. Repeat the same process on the left half of the list until you find the target or narrow it down to a single item.</li>



<li>If the target is greater than the middle item, the target must be in the right half of the list. Repeat the same process on the right half of the list until you find the target or narrow it down to a single item.</li>



<li>Continue dividing the list and comparing the target with the middle item until you find the target or narrow it down to a single item.</li>
</ol>



<p>Instead of checking for equality, we will need to write a validation function that ensures the correctness of the database. In our example, we can use the following query:</p>


<div language="bash"><pre><code><span>SELECT count </span><span>(</span><span>*</span><span>)</span><span> FROM </span><span>users</span><span>;</span><span> </span><span>&gt;</span><span> </span><span>1</span><span>
</span><span>// If the row count of the </span><span>`</span><span>users</span><span>`</span><span> table is greater than </span><span>1</span><span>, </span><span>then</span><span> our database is </span><span>in</span><span> the proper state.</span></code></pre></div>


<p>Depending on your database schema and the type of data loss that occurred, this validation function will be different.</p>



<figure><img src="https://neon.tech/_gatsby/file/744a57824cbd978e6a53b4a5ad66d74f/image-8.png?u=https%3A%2F%2Fneon-hwp.dreamhosters.com%2Fwp-content%2Fuploads%2F2022%2F12%2Fimage-8.png" alt=""/></figure>



<p>Here is a complete example script using Python and Neon’s API:</p>


<div language="javascript"><pre><code><span>#!/usr/bin/env python3</span><span>
</span><span></span><span>import</span><span> psycopg2
</span><span></span><span>import</span><span> requests
</span>
<!-- -->
<!-- -->
<span></span><span>
</span><span></span><span>
</span><span>start </span><span>=</span><span> 0xDB26C50
</span><span></span><span>
</span><span>end   </span><span>=</span><span> 0x1E9F3918
</span>
<span></span><span>
</span><span>project </span><span>=</span><span> </span><span>&#34;floral-frog-746773&#34;</span><span>
</span><span>db_creds </span><span>=</span><span> </span><span>&#34;stas:XXX&#34;</span><span>
</span><span>headers </span><span>=</span><span> </span><span>{</span><span>
</span><span>    </span><span>&#34;Authorization&#34;</span><span>:</span><span> </span><span>&#34;Bearer XXX&#34;</span><span>,
</span><span>    </span><span>&#34;Content-Type&#34;</span><span>:</span><span> </span><span>&#34;application/json&#34;</span><span>
</span><span></span><span>}</span><span>
</span>
<span>def query_branch</span><span>(</span><span>query, branch</span><span>)</span><span>:
</span><span>    endpoint_name </span><span>=</span><span> branch</span><span>[</span><span>&#39;endpoints&#39;</span><span>]</span><span>[</span><span>0</span><span>]</span><span>[</span><span>&#39;id&#39;</span><span>]</span><span>
</span><span>    connstr </span><span>=</span><span> f</span><span>&#34;postgres://{db_creds}@{endpoint_name}.cloud.stage.neon.tech/main&#34;</span><span>
</span><span>    conn </span><span>=</span><span> psycopg2.connect</span><span>(</span><span>connstr</span><span>)</span><span>
</span><span>    cursor </span><span>=</span><span> conn.cursor</span><span>(</span><span>)</span><span>
</span><span>    cursor.execute</span><span>(</span><span>query</span><span>)</span><span>
</span><span>    result </span><span>=</span><span> cursor.fetchall</span><span>(</span><span>)</span><span>[</span><span>0</span><span>]</span><span>[</span><span>0</span><span>]</span><span>
</span><span>    print</span><span>(</span><span>f</span><span>&#34;Checking </span><span>\&#34;</span><span>{query}</span><span>\&#34;</span><span> at lsn </span><span>\&#34;</span><span>{branch[&#39;branch&#39;][&#39;parent_lsn&#39;]}</span><span>\&#34;</span><span>: -&gt; {result}&#34;</span><span>)</span><span>
</span><span>    </span><span>return</span><span> result
</span>
<span>def create_branch</span><span>(</span><span>parent_id, lsn</span><span>)</span><span>:
</span><span>    branch </span><span>=</span><span> requests.post</span><span>(</span><span>f</span><span>&#39;https://console.stage.neon.tech/api/v2/projects/{project}/branches&#39;</span><span>,
</span><span>        </span><span>headers</span><span>=</span><span>headers,
</span><span>        </span><span>data</span><span>=</span><span>f</span><span>&#39;{{&#34;branch&#34;:{{&#34;name&#34;:&#34;branch_{lsn}&#34;,&#34;parent_id&#34;:&#34;{parent_id}&#34;,&#34;parent_lsn&#34;:&#34;{lsn}&#34;}}}}&#39;</span><span>
</span><span>    </span><span>)</span><span>.json</span><span>(</span><span>)</span><span>
</span><span>    print</span><span>(</span><span>f</span><span>&#34;Creating branch at lsn = {lsn}&#34;</span><span>)</span><span>
</span><span>    </span><span>return</span><span> branch
</span>
<span>def delete_branch</span><span>(</span><span>branch, lsn</span><span>)</span><span>:    branch_id </span><span>=</span><span> branch</span><span>[</span><span>&#39;branch&#39;</span><span>]</span><span>[</span><span>&#39;id&#39;</span><span>]</span><span>    branch </span><span>=</span><span> requests.delete</span><span>(</span><span>f</span><span>&#39;https://console.neon.tech/api/v2/projects/{project}/branches/{branch_id}&#39;</span><span>,        </span><span>headers</span><span>=</span><span>headers    </span><span>)</span><span>.json</span><span>(</span><span>)</span><span>    print</span><span>(</span><span>f</span><span>&#34;Deleted branch at lsn = {lsn}&#34;</span><span>)</span><span>    time.sleep</span><span>(</span><span>2</span><span>)</span><span>    </span><span>return</span><span> branch
</span><span>def query_at_lsn</span><span>(</span><span>parent_id, query, lsni</span><span>)</span><span>:
</span><span>    lsn </span><span>=</span><span> f</span><span>&#34;0/{lsni:X}&#34;</span><span>
</span><span>    branch </span><span>=</span><span> create_branch</span><span>(</span><span>parent_id, lsn</span><span>)</span><span>
</span><span>    </span><span>return</span><span> query_branch</span><span>(</span><span>query, branch</span><span>)</span><span>
</span>
<span>def bsearch_rightmost</span><span>(</span><span>parent_id, l, r, query</span><span>)</span><span>:
</span><span>    </span><span>while</span><span> l </span><span>&lt;</span><span> r:
</span><span>        m </span><span>=</span><span> </span><span>(</span><span>l + r</span><span>)</span><span>//2
</span><span>        </span><span>if</span><span> query_at_lsn</span><span>(</span><span>parent_id, query, m</span><span>)</span><span>:
</span><span>            l </span><span>=</span><span> m + </span><span>1</span><span>
</span>        else:
<span>            r </span><span>=</span><span> m
</span><span>    print</span><span>(</span><span>f</span><span>&#34;Converged at 0/{l:X}&#34;</span><span>)</span><span>
</span>
<span></span><span>
</span><span>resp </span><span>=</span><span> requests.get</span><span>(</span><span>f</span><span>&#39;https://console.stage.neon.tech/api/v2/projects/{project}/branches&#39;</span><span>, </span><span>headers</span><span>=</span><span>headers</span><span>)</span><span>
</span><span>main_branch_id </span><span>=</span><span> next</span><span>(</span><span>b </span><span>for</span><span> </span><span>b</span><span> </span><span>in</span><span> </span><span>(</span><span>resp.json</span><span>(</span><span>)</span><span>[</span><span>&#39;branches&#39;</span><span>]</span><span>)</span><span> </span><span>if</span><span> b</span><span>[</span><span>&#39;name&#39;</span><span>]</span><span> </span><span>==</span><span> </span><span>&#34;main&#34;</span><span>)</span><span>[</span><span>&#34;id&#34;</span><span>]</span><span>
</span><span>print</span><span>(</span><span>f</span><span>&#34;Main branch id is: </span><span>\&#34;</span><span>{main_branch_id}&#34;</span><span>)</span><span>
</span>
<span></span><span>
</span><span>bsearch_rightmost</span><span>(</span><span>main_branch_id, start, end, </span><span>&#34;select exists(select name from users where name=&#39;neon&#39;)&#34;</span><span>)</span><span>
</span><span>print</span><span>(</span><span>&#34;Finishing&#34;</span><span>)</span></code></pre></div>


<p>After running the following script, you will get the following output which returns the LSN:</p>


<div language="bash"><pre><code><span>&gt;</span><span> python3 neon_bisect.py
</span><span>Main branch </span><span>id</span><span> is: </span><span>&#34;br-rough-queen-879713
</span><span>Creating branch at lsn = 0/1628D2B4
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/1628D2B4</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/1A6405E6
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/1A6405E6</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/18466C4D
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/18466C4D</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/17379F81
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/17379F81</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16B0391B
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16B0391B</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/166C85E8
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/166C85E8</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/168E5F82
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/168E5F82</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/169F4C4F
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/169F4C4F</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/1696D5E9
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/1696D5E9</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16929AB6
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16929AB6</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16907D1C
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16907D1C</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16918BE9
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16918BE9</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16921350
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16921350</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16925703
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16925703</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/1692352A
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/1692352A</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16924617
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924617</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16924E8D
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924E8D</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16924A52
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A52</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16924C70
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924C70</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16924B61
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924B61</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16924ADA
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924ADA</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16924A96
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A96</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16924A74
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A74</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16924A85
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A85</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16924A8E
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A8E</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16924A8A
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A8A</span><span>&#34;: -&gt; False
</span><span>Creating branch at lsn = 0/16924A88
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A88</span><span>&#34;: -&gt; True
</span><span>Creating branch at lsn = 0/16924A89
</span><span>Checking &#34;</span><span>select</span><span> exists</span><span>(</span><span>select name from </span><span>users</span><span> where </span><span>name</span><span>=</span><span>&#39;neon&#39;</span><span>)</span><span>&#34; at lsn &#34;</span><span>0</span><span>/16924A89&#34;: -</span><span>&gt;</span><span> False
</span><span>Converged at </span><span>0</span><span>/16924A89
</span>Finishing</code></pre></div>


<p>Now you can create a branch using this LSN value and restore your database to the correct state.</p>



<h2>Final thoughts</h2>



<p>In this article, you learned how to create branches for your Neon project and how you can leverage Neon’s API along with point-in-time branches to restore your database to a correct state.</p>



<p>Neon is currently in <a href="https://neon.tech/docs/introduction/technical-preview-free-tier/">Technical Preview</a>, meaning you can <a href="https://console.neon.tech/sign_in">sign up</a> and try out the platform. If you have any feedback, feel free to email us at <a href="mailto:feedback@neon.tech">feedback@neon.tech</a>, we would love to hear from you.</p>



<p>Finally, if you would like to keep up with our latest updates, make sure to subscribe to our newsletter down below.</p>
</div></div>
  </body>
</html>
