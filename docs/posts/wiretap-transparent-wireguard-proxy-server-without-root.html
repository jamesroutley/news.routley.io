<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/sandialabs/wiretap">Original</a>
    <h1>Show HN: Wiretap – Transparent WireGuard proxy server without root</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><div dir="auto">

<p dir="auto">Wiretap is a transparent, VPN-like proxy server that tunnels traffic via WireGuard and requires no special privileges to run.</p>
</div>
<p dir="auto">In this diagram, the client has generated and installed a WireGuard configuration file that will route traffic destined for <code>10.0.0.0/24</code> through a WireGuard interface. Wiretap is then deployed to the server with a configuration that connects to the client as a WireGuard peer. The client can then interact with resources local to the server as if on the same network.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/sandialabs/wiretap/blob/main/media/Wiretap_Animated.drawio.gif"><img src="https://github.com/sandialabs/wiretap/raw/main/media/Wiretap_Animated.drawio.gif" alt="Wiretap Diagram" data-animated-image=""/></a></p>
<h2 dir="auto"><a id="user-content-quick-start" aria-hidden="true" href="#quick-start"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Quick Start</h2>
<ol dir="auto">
<li>Download binaries from the <a href="https://github.com/sandialabs/wiretap/releases">releases</a> page, one for your client machine and one for your server (if different os/arch)</li>
<li>Run <code>./wiretap configure --port &lt;port&gt; --endpoint &lt;socket&gt; --routes &lt;routes&gt;</code> with the appropriate arguments</li>
<li>Import the resulting <code>wiretap.conf</code> file into WireGuard on the client machine</li>
<li>Copy and paste the arguments output from the configure command into Wiretap on the server machine</li>
</ol>
<h2 dir="auto"><a id="user-content-requirements" aria-hidden="true" href="#requirements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Requirements</h2>
<h3 dir="auto"><a id="user-content-client-system" aria-hidden="true" href="#client-system"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Client System</h3>
<ul dir="auto">
<li>WireGuard - <a href="https://www.wireguard.com/install/" rel="nofollow">https://www.wireguard.com/install/</a></li>
<li>Privileged access to configure WireGuard</li>
</ul>
<h3 dir="auto"><a id="user-content-server-system" aria-hidden="true" href="#server-system"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Server System</h3>
<ul dir="auto">
<li>UDP access to client system&#39;s WireGuard endpoint (i.e., UDP traffic can be sent out and come back on at least one port)</li>
</ul>
<p dir="auto">While not ideal, Wiretap can still work with outbound TCP instead of UDP. See the <a href="#tcp-tunneling">TCP Tunneling</a> section for a step-by-step guide.</p>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<p dir="auto">Grab a binary from the <a href="https://github.com/sandialabs/wiretap/releases">releases</a> page. You may want two binaries if the OS/ARCH are different on the client and server machines.</p>
<p dir="auto">If you want to compile it yourself or can&#39;t find the OS/ARCH you&#39;re looking for, install Go (&gt;=1.19) from <a href="https://go.dev/dl/" rel="nofollow">https://go.dev/dl/</a> and use the provided <a href="https://github.com/sandialabs/wiretap/blob/main/src/Makefile">Makefile</a>.</p>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<h3 dir="auto"><a id="user-content-configure" aria-hidden="true" href="#configure"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Configure</h3>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/sandialabs/wiretap/blob/main/media/Wiretap_Arguments.svg"><img src="https://github.com/sandialabs/wiretap/raw/main/media/Wiretap_Arguments.svg" alt="Wiretap Configure Arguments"/></a></p>
<p dir="auto">On the client machine, run Wiretap in configure mode to build a config</p>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap configure --port &lt;port&gt; --endpoint &lt;socket&gt; --routes &lt;routes&gt;"><pre>./wiretap configure --port <span>&lt;</span>port<span>&gt;</span> --endpoint <span>&lt;</span>socket<span>&gt;</span> --routes <span>&lt;</span>routes<span>&gt;</span></pre></div>
<p dir="auto">Following the example in the diagram:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap configure --port 1337 --endpoint 1.3.3.7:1337 --routes 10.0.0.0/24"><pre>./wiretap configure --port 1337 --endpoint 1.3.3.7:1337 --routes 10.0.0.0/24</pre></div>
<div data-snippet-clipboard-copy-content="
Configuration successfully generated.
Import the config into WireGuard locally and pass the arguments below to Wiretap on the remote machine.

config: wiretap.conf
────────────────────────────────
[Interface]
PrivateKey = qCvx4DBXqemoO8B7eRI2H9Em8zJn++rIBKO+F+ufQWE=
Address = 192.168.0.2/32
Address = fd::2/128
ListenPort = 1337

[Peer]
PublicKey = 6NxBlwJHujEFr5n9qvFAUyinj0l7Wadd/ZDQMCqTJAA=
AllowedIPs = 10.0.0.0/24,a::/128
────────────────────────────────

args: serve --private qGrU0juci5PLJ1ydSufE/UwlErL/bqfcz6uWil705UU= --public ZhRIAcGVwT7l9dhEXv7cvYKwLxOZJR4bgU4zePZaT04= --endpoint 1.3.3.7:1337
"><pre><code>
Configuration successfully generated.
Import the config into WireGuard locally and pass the arguments below to Wiretap on the remote machine.

config: wiretap.conf
────────────────────────────────
[Interface]
PrivateKey = qCvx4DBXqemoO8B7eRI2H9Em8zJn++rIBKO+F+ufQWE=
Address = 192.168.0.2/32
Address = fd::2/128
ListenPort = 1337

[Peer]
PublicKey = 6NxBlwJHujEFr5n9qvFAUyinj0l7Wadd/ZDQMCqTJAA=
AllowedIPs = 10.0.0.0/24,a::/128
────────────────────────────────

args: serve --private qGrU0juci5PLJ1ydSufE/UwlErL/bqfcz6uWil705UU= --public ZhRIAcGVwT7l9dhEXv7cvYKwLxOZJR4bgU4zePZaT04= --endpoint 1.3.3.7:1337

</code></pre></div>
<p dir="auto">Install the resulting config either by copying and pasting the output or by importing the new <code>wiretap.conf</code> file into WireGuard:</p>
<ul dir="auto">
<li>If using a GUI, select the menu option similar to <em>Import Tunnel(s) From File</em></li>
<li>If you have <code>wg-quick</code> installed, <code>sudo wg-quick up ./wiretap.conf</code></li>
</ul>
<p dir="auto">Don&#39;t forget to disable or remove the tunnel when you&#39;re done (e.g., <code>sudo wg-quick down ./wiretap.conf</code>)</p>
<h3 dir="auto"><a id="user-content-deploy" aria-hidden="true" href="#deploy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Deploy</h3>
<p dir="auto">On the remote machine, upload the binary and then copy the command with the private and public keys to start Wiretap in server mode:</p>
<div data-snippet-clipboard-copy-content=".\wiretap.exe serve --private qGrU0juci5PLJ1ydSufE/UwlErL/bqfcz6uWil705UU= --public ZhRIAcGVwT7l9dhEXv7cvYKwLxOZJR4bgU4zePZaT04= --endpoint 1.3.3.7:1337"><pre><code>.\wiretap.exe serve --private qGrU0juci5PLJ1ydSufE/UwlErL/bqfcz6uWil705UU= --public ZhRIAcGVwT7l9dhEXv7cvYKwLxOZJR4bgU4zePZaT04= --endpoint 1.3.3.7:1337
</code></pre></div>
<p dir="auto">Confirm that the client and server have successfully completed the handshake. The client should see a successful handshake in whatever WireGuard interface is running. If using the command-line tools, check with <code>wg show</code>.</p>
<h3 dir="auto"><a id="user-content-add-peers-optional" aria-hidden="true" href="#add-peers-optional"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Add Peers (optional)</h3>
<p dir="auto">You can create new configurations after deployment for sharing access to the target network with others.</p>
<p dir="auto">To test access to the Wiretap API running on the server, run:</p>

<div data-snippet-clipboard-copy-content="response: pong
  from: a::
  time: 2.685600 milliseconds"><pre><code>response: pong
  from: a::
  time: 2.685600 milliseconds
</code></pre></div>
<p dir="auto">A successful <code>pong</code> message indicates that the API is responsive and commands like <code>add</code> will now work.</p>
<p dir="auto">Adding a peer is very similar to configuring Wiretap initially. It will generate a configuration file you can share, but it will not output arguments that need to be passed to the server because that information is passed via the API. If you&#39;re generating a configuration for someone else, get their address information for the endpoint and port flags.</p>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap add --port 1337 --endpoint 1.3.3.8:1337 --routes 10.0.0.0/24"><pre>./wiretap add --port 1337 --endpoint 1.3.3.8:1337 --routes 10.0.0.0/24</pre></div>
<div data-snippet-clipboard-copy-content="
Configuration successfully generated and pushed to server.
Import this config locally or send it to a friend.

config: wiretap_1.conf
────────────────────────────────
[Interface]
PrivateKey = UJsLCSTg6xqfrKJtXQioaek/mCj4gzOdUIrp/+NkJ3Q=
Address = 192.168.0.3/32
Address = fd::3/128
ListenPort = 1337

[Peer]
PublicKey = 7mVguCBt7qxMsjDHR7WzzzNXbyBi5Q35gMvyUxjWMWc=
AllowedIPs = 10.0.0.0/24,a::/128
────────────────────────────────
"><pre><code>
Configuration successfully generated and pushed to server.
Import this config locally or send it to a friend.

config: wiretap_1.conf
────────────────────────────────
[Interface]
PrivateKey = UJsLCSTg6xqfrKJtXQioaek/mCj4gzOdUIrp/+NkJ3Q=
Address = 192.168.0.3/32
Address = fd::3/128
ListenPort = 1337

[Peer]
PublicKey = 7mVguCBt7qxMsjDHR7WzzzNXbyBi5Q35gMvyUxjWMWc=
AllowedIPs = 10.0.0.0/24,a::/128
────────────────────────────────

</code></pre></div>
<p dir="auto">At this point, the server will attempt to reach out to the provided endpoint. Share the config file and have the recipient import it into WireGuard for Wiretap to connect.</p>
<blockquote>
<p dir="auto"><span><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>Note</span>
To add another peer on the same machine, you will need to specify an unused port, unused routes, and disable the API route.</p>
</blockquote>
<h2 dir="auto"><a id="user-content-help" aria-hidden="true" href="#help"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Help</h2>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap --help --show-hidden"><pre>./wiretap --help --show-hidden</pre></div>
<div data-snippet-clipboard-copy-content="Usage:
  wiretap [flags]
  wiretap [command]

Available Commands:
  add         Add peer to wiretap
  configure   Build wireguard config
  help        Help about any command
  ping        Ping wiretap server API
  serve       Listen and proxy traffic into target network

Flags:
  -h, --help          help for wiretap
      --show-hidden   show hidden flag options
  -v, --version       version for wiretap

Use &#34;wiretap [command] --help&#34; for more information about a command."><pre><code>Usage:
  wiretap [flags]
  wiretap [command]

Available Commands:
  add         Add peer to wiretap
  configure   Build wireguard config
  help        Help about any command
  ping        Ping wiretap server API
  serve       Listen and proxy traffic into target network

Flags:
  -h, --help          help for wiretap
      --show-hidden   show hidden flag options
  -v, --version       version for wiretap

Use &#34;wiretap [command] --help&#34; for more information about a command.
</code></pre></div>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<ul dir="auto">
<li>Network
<ul dir="auto">
<li>IPv4</li>
<li>IPv6</li>
<li>ICMPv4: Echo requests and replies</li>
<li>ICMPv6: Echo requests and replies</li>
</ul>
</li>
<li>Transport
<ul dir="auto">
<li>TCP
<ul dir="auto">
<li>Transparent connections</li>
<li>RST response when port is unreachable</li>
</ul>
</li>
<li>UDP
<ul dir="auto">
<li>Transparent &#34;connections&#34;</li>
<li>ICMP Destination Unreachable when port is unreachable</li>
</ul>
</li>
</ul>
</li>
<li>API
<ul dir="auto">
<li>API internal to Wiretap for dynamic configuration</li>
<li>Add peers after deployment for multi-user support</li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-demo" aria-hidden="true" href="#demo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Demo</h2>
<p dir="auto">The demo has three hosts and two networks:</p>
<div data-snippet-clipboard-copy-content="┌──────────┐
│ client   │
│          │
│ 10.1.0.2 │
│ fd:1::2  ├┬───────────────────────┐
├──────────┼│ exposed network       │
├──────────┼│ 10.1.0.0/16,fd:1::/64 │
│ 10.1.0.3 ├┴───────────────────────┘
│ fd:1::3  │
│          │
│ server   │
│          │
│ 10.2.0.3 │
│ fd:2::3  ├┬───────────────────────┐
├──────────┼│ target network        │
├──────────┼│ 10.2.0.0/16,fd:2::/64 │
│ 10.2.0.4 ├┴───────────────────────┘
│ fd:2::4  │
│          │
│ target   │
└──────────┘"><pre><code>┌──────────┐
│ client   │
│          │
│ 10.1.0.2 │
│ fd:1::2  ├┬───────────────────────┐
├──────────┼│ exposed network       │
├──────────┼│ 10.1.0.0/16,fd:1::/64 │
│ 10.1.0.3 ├┴───────────────────────┘
│ fd:1::3  │
│          │
│ server   │
│          │
│ 10.2.0.3 │
│ fd:2::3  ├┬───────────────────────┐
├──────────┼│ target network        │
├──────────┼│ 10.2.0.0/16,fd:2::/64 │
│ 10.2.0.4 ├┴───────────────────────┘
│ fd:2::4  │
│          │
│ target   │
└──────────┘
</code></pre></div>
<h3 dir="auto"><a id="user-content-video" aria-hidden="true" href="#video"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Video</h3>
<p dir="auto">
<details open="">
  <summary>
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path fill-rule="evenodd" d="M16 3.75a.75.75 0 00-1.136-.643L11 5.425V4.75A1.75 1.75 0 009.25 3h-7.5A1.75 1.75 0 000 4.75v6.5C0 12.216.784 13 1.75 13h7.5A1.75 1.75 0 0011 11.25v-.675l3.864 2.318A.75.75 0 0016 12.25v-8.5zm-5 5.075l3.5 2.1v-5.85l-3.5 2.1v1.65zM9.5 6.75v-2a.25.25 0 00-.25-.25h-7.5a.25.25 0 00-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-4.5z"></path>
</svg>
    <span aria-label="Video description wiretap_demo.mp4">wiretap_demo.mp4</span>
    <span></span>
  </summary>

  <video src="https://user-images.githubusercontent.com/26662746/202822223-af752660-f263-43dc-bdf1-63140bab316b.mp4" data-canonical-src="https://user-images.githubusercontent.com/26662746/202822223-af752660-f263-43dc-bdf1-63140bab316b.mp4" controls="controls" muted="muted">

  </video>
</details>

</p>
<h3 dir="auto"><a id="user-content-step-by-step" aria-hidden="true" href="#step-by-step"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Step-By-Step</h3>
<p dir="auto">You have unprivileged access to the server host and want to reach the target host from the client host using Wiretap.</p>
<h4 dir="auto"><a id="user-content-setup" aria-hidden="true" href="#setup"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Setup</h4>
<p dir="auto">Clone this repo.</p>
<p dir="auto">Start the demo containers with:</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker compose up --build"><pre>docker compose up --build</pre></div>
<p dir="auto">Open new tabs for interactive sessions with the client and server machines:</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker exec -it wiretap-client-1 bash"><pre>docker <span>exec</span> -it wiretap-client-1 bash</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="docker exec -it wiretap-server-1 bash"><pre>docker <span>exec</span> -it wiretap-server-1 bash</pre></div>
<h4 dir="auto"><a id="user-content-observe-network-limitations" aria-hidden="true" href="#observe-network-limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Observe Network Limitations</h4>
<p dir="auto">The target network, and therefore the target host, is unreachable from the client machine. Both the server and target hosts are running a web service on port 80, so try interacting with each of the services from each of the hosts:</p>
<p dir="auto">Accessing the server&#39;s web service from the client should work:</p>
<div dir="auto" data-snippet-clipboard-copy-content="client$ curl http://10.1.0.3"><pre>client$ curl http://10.1.0.3</pre></div>
<p dir="auto">Accessing the target web service from the client should not work, but doing the same thing from the server machine will:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# fails
client$ curl http://10.2.0.4"><pre><span><span>#</span> fails</span>
client$ curl http://10.2.0.4</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="server$ curl http://10.2.0.4"><pre>server$ curl http://10.2.0.4</pre></div>
<h4 dir="auto"><a id="user-content-configure-1" aria-hidden="true" href="#configure-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Configure</h4>
<p dir="auto">Configure Wiretap from the client machine. Remember, <code>--endpoint</code> is how the server machine should reach the client and <code>--routes</code> determines which traffic is routed through Wiretap.</p>
<ul dir="auto">
<li><code>--endpoint</code> needs to be the client address and the default WireGuard port: <code>10.1.0.2:51820</code></li>
<li><code>--routes</code> needs to be the subnet of the target network: <code>10.2.0.0/16</code>. But there is also an IPv6 subnet, so we should also put <code>fd:2::/64</code>. If you just wanted to route traffic to the target host, you could put <code>10.2.0.4/32</code> here instead</li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap_linux_amd64 configure --endpoint 10.1.0.2:51820 --routes 10.2.0.0/16,fd:2::/64"><pre>./wiretap_linux_amd64 configure --endpoint 10.1.0.2:51820 --routes 10.2.0.0/16,fd:2::/64</pre></div>
<p dir="auto">Install the newly created WireGuard config with:</p>
<div dir="auto" data-snippet-clipboard-copy-content="wg-quick up ./wiretap.conf"><pre>wg-quick up ./wiretap.conf</pre></div>
<p dir="auto">Copy and paste the Wiretap arguments printed by the configure command into the server machine prompt. It should look like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap_linux_amd64 serve --private &lt;key&gt; --public &lt;key&gt; --endpoint 10.1.0.2:51820"><pre>./wiretap_linux_amd64 serve --private <span>&lt;</span>key<span>&gt;</span> --public <span>&lt;</span>key<span>&gt;</span> --endpoint 10.1.0.2:51820</pre></div>
<h4 dir="auto"><a id="user-content-test" aria-hidden="true" href="#test"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Test</h4>
<p dir="auto">The WireGuard handshake should be complete. Confirm with:</p>

<p dir="auto">If the handshake was successful the client should be able to reach the target network transparently. Confirm by running the same test that failed before:</p>
<div dir="auto" data-snippet-clipboard-copy-content="client$ curl http://10.2.0.4"><pre>client$ curl http://10.2.0.4</pre></div>
<p dir="auto">That&#39;s it! Try scanning, pinging, and anything else you can think of (please submit an issue if you think something should work but doesn&#39;t!). Here are a few ideas:</p>
<ul dir="auto">
<li>HTTP
<ul dir="auto">
<li><code>curl http://10.2.0.4</code></li>
<li><code>curl http://[fd:2::4]</code></li>
</ul>
</li>
<li>Nmap
<ul dir="auto">
<li><code>nmap 10.2.0.4 -v</code></li>
<li><code>nmap -6 fd:2::4 -v</code></li>
</ul>
</li>
<li>ICMP
<ul dir="auto">
<li><code>ping 10.2.0.4</code></li>
<li><code>ping fd:2::4</code></li>
</ul>
</li>
<li>UDP
<ul dir="auto">
<li><code>nmap -sU 10.2.0.4 -v</code></li>
<li><code>nmap -sU -6 fd:2::4 -v</code></li>
</ul>
</li>
</ul>
<h4 dir="auto"><a id="user-content-teardown" aria-hidden="true" href="#teardown"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Teardown</h4>
<p dir="auto">To bring down the WireGuard interface on the client machine, run:</p>
<div dir="auto" data-snippet-clipboard-copy-content="wg-quick down ./wiretap.conf"><pre>wg-quick down ./wiretap.conf</pre></div>
<h2 dir="auto"><a id="user-content-how-it-works" aria-hidden="true" href="#how-it-works"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How It Works</h2>
<p dir="auto">A traditional VPN can&#39;t be installed by unprivileged users because VPNs rely on dangerous operations like changing network routes and working with raw packets.</p>
<p dir="auto">Wiretap bypasses this requirement by rerouting traffic to a user-space TCP/IP network stack, where a listener accepts connections on behalf of the true destination. Then it creates a new connection to the true destination and copies data between the endpoint and the peer. This is similar to how <a href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a> works, but relies on WireGuard as the tunneling mechanism rather than SSH.</p>
<h2 dir="auto"><a id="user-content-experimental" aria-hidden="true" href="#experimental"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Experimental</h2>
<h3 dir="auto"><a id="user-content-tcp-tunneling" aria-hidden="true" href="#tcp-tunneling"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>TCP Tunneling</h3>
<blockquote>
<p dir="auto"><span><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>Note</span>
Performance will suffer, only use TCP Tunneling as a last resort</p>
</blockquote>
<p dir="auto">If you have <em>no</em> outbound UDP access, you can still use Wiretap, but you&#39;ll need to tunnel WireGuard traffic through TCP. This should only be used as a last resort. From WireGuard&#39;s <a href="https://www.wireguard.com/known-limitations/" rel="nofollow">Known Limitations</a> page:</p>
<blockquote>
<p dir="auto"><strong>TCP Mode</strong></p>
<p dir="auto">WireGuard explicitly does not support tunneling over TCP, due to the classically terrible network performance of tunneling TCP-over-TCP. Rather, transforming WireGuard&#39;s UDP packets into TCP is the job of an upper layer of obfuscation (see previous point), and can be accomplished by projects like <a href="https://github.com/rfc1036/udptunnel">udptunnel</a> and <a href="https://github.com/wangyu-/udp2raw-tunnel">udp2raw</a>.</p>
</blockquote>
<p dir="auto">Another great tool that has similar cross-platform capabilities to Wiretap is <a href="https://github.com/jpillora/chisel">Chisel</a>. We can use chisel to forward a UDP port to the remote system over TCP. To use:</p>
<p dir="auto">Run chisel server on the client system, specifying a TCP port you can reach from the server system:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./chisel server --port 8080"><pre>./chisel server --port 8080</pre></div>
<p dir="auto">On the server system, forward the port with this command using the same TCP port you specified in the previous command and using the ListenPort you specified when configuring Wiretap (the default is 51820). The format is <code>&lt;localport&gt;:0.0.0.0:&lt;remoteport&gt;/udp</code>.</p>
<p dir="auto">In this example, we&#39;re forwarding 51821/udp on the server to 51820 on the client:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./chisel client &lt;endpoint address&gt;:8080 51821:0.0.0.0:51820/udp"><pre>./chisel client <span>&lt;</span>endpoint address<span>&gt;</span>:8080 51821:0.0.0.0:51820/udp</pre></div>
<p dir="auto">Finally, run Wiretap with the forwarded local port as your endpoint on the server system:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap serve --private &lt;key&gt; --public &lt;key&gt; --endpoint localhost:51821"><pre>./wiretap serve --private <span>&lt;</span>key<span>&gt;</span> --public <span>&lt;</span>key<span>&gt;</span> --endpoint localhost:51821</pre></div>
<h3 dir="auto"><a id="user-content-nested-tunnels" aria-hidden="true" href="#nested-tunnels"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Nested Tunnels</h3>
<p dir="auto">It is possible to nest multiple WireGuard tunnels using Wiretap, allowing for multiple hops without requiring root on any of the intermediate nodes.</p>
<p dir="auto">Using this network as an example, we can deploy Wiretap to both hop 1 and hop 2 machines in order to access the target machine on network 3.</p>
<div data-snippet-clipboard-copy-content="                ┌──────────────────────────────────┐
┌───────────────┼───────────────┐  ┌───────────────┼────────────────┐
│ ┌──────────┐  │  ┌──────────┐ │  │  ┌──────────┐ │   ┌──────────┐ │
│ │          │  │  │          │ │  │  │          │ │   │          │ │
│ │ client   ├──┼─►│ hop 1    ├─┼──┼─►│ hop 2    ├─┼──►│ target   │ │
│ │          │  │  │          │ │  │  │          │ │   │          │ │
│ └──────────┘  │  └──────────┘ │  │  └──────────┘ │   └──────────┘ │
└───────────────┼───────────────┘  └───────────────┼────────────────┘
 network 1:     └──────────────────────────────────┘     network 3:
 10.0.1.0/24                  network 2:                 10.0.3.0/24
                              10.0.2.0/24"><pre><code>                ┌──────────────────────────────────┐
┌───────────────┼───────────────┐  ┌───────────────┼────────────────┐
│ ┌──────────┐  │  ┌──────────┐ │  │  ┌──────────┐ │   ┌──────────┐ │
│ │          │  │  │          │ │  │  │          │ │   │          │ │
│ │ client   ├──┼─►│ hop 1    ├─┼──┼─►│ hop 2    ├─┼──►│ target   │ │
│ │          │  │  │          │ │  │  │          │ │   │          │ │
│ └──────────┘  │  └──────────┘ │  │  └──────────┘ │   └──────────┘ │
└───────────────┼───────────────┘  └───────────────┼────────────────┘
 network 1:     └──────────────────────────────────┘     network 3:
 10.0.1.0/24                  network 2:                 10.0.3.0/24
                              10.0.2.0/24
</code></pre></div>
<p dir="auto">After deploying Wiretap to hop 1 normally, re-run the configure command but forgo the endpoint argument because Wiretap currently has no way of tunneling traffic <em>back</em> to the client machine if initiated from the server side of the network. In the future Wiretap may support routing between multiple instances of Wiretap.</p>
<blockquote>
<p dir="auto"><span><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>Note</span>
Make sure the routes and port are different from the initial configuration</p>
</blockquote>
<div dir="auto" data-snippet-clipboard-copy-content="./wiretap configure --port 51821 --routes 10.0.3.0/24"><pre>./wiretap configure --port 51821 --routes 10.0.3.0/24</pre></div>
<p dir="auto">Then deploy Wiretap to hop 2 with the resulting arguments. Because no endpoint was provided, the Endpoint parameter needs to be provided manually to the config file. This depends on the client being able to access hop 2 <em>through the first hop&#39;s instance of Wiretap</em>! Add the endpoint to the peer section of the new Wiretap config:</p>
<div data-snippet-clipboard-copy-content="Endpoint = 10.0.2.2:51820"><pre><code>Endpoint = 10.0.2.2:51820
</code></pre></div>
<p dir="auto">Finally, import the config into WireGuard on the client system. The client system will handshake with Wiretap on hop 2 via the tunnel to hop 1, and then all future connections to 10.0.3.0/24 will be routed to network 3 through both hops.</p>
</article>
          </div></div>
  </body>
</html>
