<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://drewdevault.com/2022/09/02/2022-09-02-In-praise-of-qemu.html">Original</a>
    <h1>In Praise of QEMU</h1>
    
    <div id="readability-page-1" class="page"><div>
  <article>
    <p><a href="https://www.qemu.org/">qemu</a> is another in a long line of great software started by <a href="https://bellard.org/">Fabrice
Bellard</a>. It provides virtual machines for a wide variety of software
architectures. Combined with KVM, it forms the foundation of nearly all cloud
services, and it runs SourceHut in our self-hosted datacenters. Much like
Bellardâ€™s ffmpeg revolutionized the multimedia software industry, qemu
revolutionized virtualisation.</p>
<p>qemu comes with a large variety of studiously implemented virtual devices, from
standard real-world hardware like e1000 network interfaces to accelerated
virtual hardware like virtio drives. One can, with the right combination of
command line arguments, produce a virtual machine of essentially any
configuration, either for testing novel configurations or for running
production-ready virtual machines. Network adapters, mouse &amp; keyboard, IDE or
SCSI or SATA drives, sound cards, graphics cards, serial portsÂ â€” the
works. Lower level, often arch-specific features, such as AHCI devices, SMP,
NUMA, and so on, are also available and invaluable for testing any conceivable
system configurations. And these configurations <em>work</em>, and work reliably.</p>
<p>I have relied on this testing quite a bit when working on kernels, particularly
on <a href="https://drewdevault.com/2022/06/13/helios.html">my own Helios kernel</a>. With a little bit of command line magic, I can run
a fully virtualised system with a serial driver connected to the parent
terminal, with a hardware configuration appropriate to whatever I happen to be
testing, in a manner such that running and testing my kernel is no different
from running any other program. With -gdb I can set up gdb remote debugging and
even debug my kernel as if it were a typical program. Anyone who remembers osdev
in the Bochs days â€” or even earlier â€” understands the unprecedented
luxury of such a development environment. Should I ever find myself working on a
hardware configuration which is unsupported by qemu, my very first step will be
patching qemu to support it. In my reckoning, qemu support is nearly as
important for bringing up a new system as a C compiler is.</p>
<p>And qemuâ€™s implementation in C is simple, robust, and comprehensive. On the
several occasions when Iâ€™ve had to read the code, it has been a pleasure.
Furthermore, the comprehensive approach allows you to build out a virtualisation
environment tuned precisely to your needs, whatever they may be, and it is
accommodating of many needs. Sure, itâ€™s low level â€” running a qemu command
line is certainly more intimidating than, say, VirtualBox â€” but the
trade-off in power afforded to the user opens up innumerable use-cases that are
simply not available on any other virtualisation platform.</p>
<p>One of my favorite, lesser-known features of qemu is qemu-user, which allows you
to register a <a href="https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html">binfmt</a> handler to run executables compiled for an arbitrary
architecture on Linux. Combined with a little chroot, this has made cross-arch
development easier than it has ever been before, something I frequently rely on
when working on <a href="https://harelang.org/">Hare</a>. If you do cross-architecture work and you havenâ€™t set
up qemu-user yet, youâ€™re missing out.</p>
<pre><code>$ uname -a
Linux taiga 5.15.63-0-lts #1-Alpine SMP Fri, 26 Aug 2022 07:02:59 +0000 x86_64 GNU/Linux
$ doas chroot roots/alpine-riscv64/ /bin/sh
# uname -a
Linux taiga 5.15.63-0-lts #1-Alpine SMP Fri, 26 Aug 2022 07:02:59 +0000 riscv64 Linux
</code></pre><!-- Inline styles because lazy -->
<p><small>This is amazing.</small></p>
<p>qemu also holds a special place in my heart as one of the first projects I
contributed to over email ðŸ™‚ And they still use email today, and even <a href="https://qemu.readthedocs.io/en/v6.2.0/devel/submitting-a-patch.html#if-you-cannot-send-patch-emails">recommend
SourceHut</a> to make the process easier for novices.</p>
<p>So, to Fabrice, and the thousands of other contributors to qemu, I offer my
thanks. qemu is one of my favorite pieces of software.</p>

  </article>
</div><section>
  <h2>
    Articles from blogs I read
    <small>
      Generated by
      <a href="https://git.sr.ht/~sircmpwn/openring">openring</a>
    </small>
  </h2>
  <section>
    
    <div>
      <h4>
        <a href="https://sourcehut.org/blog/2022-08-23-how-does-our-consultancy-work/" target="_blank" rel="noopener">How does SourceHut&#39;s free software consultancy work?</a>
      </h4>
      <p>SourceHut offers a consultancy in which we offer our services as experts in
free software to work exclusively on free software development. Through this
work we have developed improvements to Wayland, graphics, virtual reality,
email, and more, entirely throâ€¦</p>
      <p><small>
        via <a href="https://sourcehut.org/blog/">Blogs on Sourcehut</a>
      </small>
      <small>August 23, 2022</small>
    </p></div>
    
    <div>
      <h4>
        <a href="https://emersion.fr/blog/2022/status-update-44/" target="_blank" rel="noopener">Status update, August 2022</a>
      </h4>
      <p>Hi all!
This month Iâ€™ve been pondering offline-first apps. The online aspect of modern
apps is an important feature for many use-cases: it enables collaboration
between multiple people and seamless transition between devices (e.g. I often
switch between my peâ€¦</p>
      <p><small>
        via <a href="https://emersion.fr/blog/">emersion</a>
      </small>
      <small>August 14, 2022</small>
    </p></div>
    
    <div>
      <h4>
        <a href="https://go.dev/blog/go1.19" target="_blank" rel="noopener">Go 1.19 is released!</a>
      </h4>
      <p>Go 1.19 adds richer doc comments, performance improvements, and more.</p>
      <p><small>
        via <a href="https://blog.golang.org/feed.atom">The Go Blog</a>
      </small>
      <small>August 2, 2022</small>
    </p></div>
    
  </section>
</section></div>
  </body>
</html>
