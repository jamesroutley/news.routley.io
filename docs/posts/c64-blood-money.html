<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lemmings.info/c64-blood-money/">Original</a>
    <h1>C64 Blood Money</h1>
    
    <div id="readability-page-1" class="page"><article>
                
<p>While I still remember the details, I thought I’d go over my port of <strong>Blood Money</strong> to the <strong>C64</strong>. It had some really cool bits in it, and I had great fun doing it. Some parts make me cringe a little now, so it’d be interesting to revive it, and see if I can get it building again – or at the very least, go over the code again…</p>



<p>One thing that DID bug me, even back then, was the crappy starfield. It was just some characters stuck in the map, and it sucked.</p>


<div>
<figure><img decoding="async" width="650" height="359" src="https://lemmings.info/wp-content/uploads/2024/05/image.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image.png 650w, https://lemmings.info/wp-content/uploads/2024/05/image-300x166.png 300w" sizes="(max-width: 650px) 100vw, 650px"/></figure></div>


<p>So what were the main components?</p>



<ol>
<li>Multi-Directional scrolling</li>



<li>Sprite Multiplexor</li>



<li>Scripting</li>



<li>Sprite compression</li>



<li>Turrets</li>



<li>Character sprites</li>



<li>Bullets / Weapons</li>



<li>Collision</li>



<li>Shop</li>



<li>Front End</li>
</ol>



<p>These are the major parts and we’ll take them one at a time. Before that, I want to briefly look over the code, and talk about the devkit – <strong>PDS</strong>. Programmers Development System. This was a lovely system, and one I’m sad I didn’t find while raiding the <strong>DMA </strong>Offices.</p>



<p>The <strong>PDS</strong> system consisted of a <strong>PC ISA</strong> card, and a <strong>C64</strong> cartridge. The ISA card was common for all systems, while the target cartridge was custom for each platform.</p>


<div>
<figure><img loading="lazy" decoding="async" width="1024" height="739" src="https://lemmings.info/wp-content/uploads/2024/05/image-1-1024x739.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-1-1024x739.png 1024w, https://lemmings.info/wp-content/uploads/2024/05/image-1-300x216.png 300w, https://lemmings.info/wp-content/uploads/2024/05/image-1-768x554.png 768w, https://lemmings.info/wp-content/uploads/2024/05/image-1-1536x1108.png 1536w, https://lemmings.info/wp-content/uploads/2024/05/image-1.png 1788w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure></div>


<p>As I can’t find a <strong>C64 </strong>image, here’s the <strong>Sam Coupé</strong> (<strong>Z80</strong>) one to show what it might look like.</p>



<p><img decoding="async" src="https://www.worldofsam.org/sites/default/files/2018-08/1930902_10155032479666879_3329198604205518881_n.jpg" alt="PDS development system | World of SAM"/></p>


<div>
<figure><img loading="lazy" decoding="async" width="400" height="300" src="https://lemmings.info/wp-content/uploads/2024/05/image-2.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-2.png 400w, https://lemmings.info/wp-content/uploads/2024/05/image-2-300x225.png 300w" sizes="auto, (max-width: 400px) 100vw, 400px"/></figure></div>


<p>This is the <strong>Z80 </strong>program, but the <strong>6502 </strong>one was the same. It consisted of a built in text editor/assembler/debugger. The text editor could hold 8 files up to a maximum of <strong>32k </strong>each, though you could include as many files as you like. It assembled before your finger left the key, and squired down in under a second. This was a massive speed boost from the 20 minutes I sometimes spent waiting on the <strong>C64</strong> to disk assemble using a fast parallel disk interface.</p>


<div>
<figure><img loading="lazy" decoding="async" width="896" height="973" src="https://lemmings.info/wp-content/uploads/2024/05/image-3.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-3.png 896w, https://lemmings.info/wp-content/uploads/2024/05/image-3-276x300.png 276w, https://lemmings.info/wp-content/uploads/2024/05/image-3-768x834.png 768w" sizes="auto, (max-width: 896px) 100vw, 896px"/></figure></div>


<p>The other good thing about <strong>PDS</strong>, is it remembers the start date, and the last time you touched it – which is very cool and handy. So I started this on 7th of August 1989…. though, this probably isn’t right. This was the month the office opened, and I was still working on <strong>Ballistix </strong>at this point. However, I did create a <strong>C64 </strong>framework, and then probably based the game off that. The date below 2/10/89 looks better, and the end date looks about right 25/4/90. Games back then took about 6 months, so this also fits.</p>



<p>So in the main code of all my <strong>C64 </strong>games, I setup equates (constants), and zero page and normal variables. On the <strong>6502 </strong>there are <strong>256 </strong>bytes of fast zero page, <strong>2</strong> are taken with <strong>I/O </strong>control, and the rest are available for use. Zero page instructions typically take <strong>1</strong> cycle less to operate, so are highly desirable for critical code optimisations.</p>


<div>
<figure><img loading="lazy" decoding="async" width="758" height="965" src="https://lemmings.info/wp-content/uploads/2024/05/image-4.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-4.png 758w, https://lemmings.info/wp-content/uploads/2024/05/image-4-236x300.png 236w" sizes="auto, (max-width: 758px) 100vw, 758px"/></figure></div>


<p>These are some of the constants. At the top you can see the big ticket items – memory map etc. There’s a couple of interesting items here – <strong>Charmasks</strong>/<strong>Shipmasks</strong>, and <strong>down_load</strong>. The collision in <strong>Blood Money</strong> wasn’t character based, it was bitmap based. I actually read the background tiles, and then masked whatever frame of the ship was active onto these characters. This was pretty slow, but allowed proper collision to the background – something that was vital in later levels. I’ll discuss this mode later of course…</p>



<p><strong>down_load</strong> – this was where the debugger/downloader code lived. Whenever the <strong>C64 </strong>hit a <strong>BRK </strong>instruction, I would detect this in the <strong>IRQ </strong>it generated, and jumped to the <strong>PDS </strong>debugger code.</p>


<div>
<figure><img loading="lazy" decoding="async" width="710" height="1009" src="https://lemmings.info/wp-content/uploads/2024/05/image-5.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-5.png 710w, https://lemmings.info/wp-content/uploads/2024/05/image-5-211x300.png 211w" sizes="auto, (max-width: 710px) 100vw, 710px"/></figure></div>


<p>This is how I allocated Zero Page variables. Prior to having good macros, I’d have to work these out manually, but now I was able to simple set a name and how many bytes I wanted, and the label would be set. I still use this method for variable allocation when need be – it’s really useful.</p>


<div>
<figure><img loading="lazy" decoding="async" width="593" height="1024" src="https://lemmings.info/wp-content/uploads/2024/05/image-7.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-7.png 593w, https://lemmings.info/wp-content/uploads/2024/05/image-7-174x300.png 174w" sizes="auto, (max-width: 593px) 100vw, 593px"/></figure></div>


<p>I use the same method for sprite variable allocation. Have to say… this is a lot of variables for each sprite – oh well….</p>


<div>
<figure><img loading="lazy" decoding="async" width="715" height="1024" src="https://lemmings.info/wp-content/uploads/2024/05/image-8-715x1024.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-8-715x1024.png 715w, https://lemmings.info/wp-content/uploads/2024/05/image-8-210x300.png 210w, https://lemmings.info/wp-content/uploads/2024/05/image-8.png 718w" sizes="auto, (max-width: 715px) 100vw, 715px"/></figure></div>


<p>And this is where I defined general variables, and player structure. There’s <strong>2</strong> of everything as <strong>Blood Money</strong> is a simultaneous <strong>2</strong> player game. This really effected the multiplexor – but more on that later….</p>


<div>
<figure><img loading="lazy" decoding="async" width="781" height="656" src="https://lemmings.info/wp-content/uploads/2024/05/image-9.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-9.png 781w, https://lemmings.info/wp-content/uploads/2024/05/image-9-300x252.png 300w, https://lemmings.info/wp-content/uploads/2024/05/image-9-768x645.png 768w" sizes="auto, (max-width: 781px) 100vw, 781px"/></figure></div>


<p>Lastly for today, is the start up code, we take over everything and nuke stack and zero page, flick out <strong>ROMs </strong>etc and setup <strong>IRQs</strong> – the usual…</p>


<div>
<figure><img loading="lazy" decoding="async" width="558" height="1024" src="https://lemmings.info/wp-content/uploads/2024/05/image-10-558x1024.png" alt="" srcset="https://lemmings.info/wp-content/uploads/2024/05/image-10-558x1024.png 558w, https://lemmings.info/wp-content/uploads/2024/05/image-10-164x300.png 164w, https://lemmings.info/wp-content/uploads/2024/05/image-10.png 561w" sizes="auto, (max-width: 558px) 100vw, 558px"/></figure></div>


<p>The <strong>IRQs</strong> in <strong>Blood Money</strong> are complicated, and heavily tied to the multiplexor, so I’ll talk about that next time…..</p>



<p>Also just to say…. as this was just my second game, and only a couple of months after the office opened, I’m amazed at the level of commenting in the source! 😂</p>




                                                     
                     

                
                
	<nav aria-label="Posts">
		<h2>Post navigation</h2>
		
	</nav>                          </article></div>
  </body>
</html>
