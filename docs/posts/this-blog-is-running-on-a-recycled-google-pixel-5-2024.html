<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.ctms.me/posts/2024-08-29-running-this-blog-on-a-pixel-5/">Original</a>
    <h1>This blog is running on a recycled Google Pixel 5 (2024)</h1>
    
    <div id="readability-page-1" class="page"><section>
			<p>If you glance over this blog, you will see that I am an avid Android fan. After setting up numerous Linux <code>proot</code> desktops on phones, I wanted to see if I use a phone as a server and run my blog from an Android phone. Since you are reading this, I was successful.</p>
<p>I was inspired my a few Mastodon posts earlier this week to give it a go. First, I stumbled on a post from <a href="https://sunny.garden/@kaimac/113030644224867695">@kaimac</a> who is running a site from an ESP32 microcontroller. In the comments of that post, I saw <a href="https://post.lurk.org/@computersandblues/112570463568163343">a mention</a> to <a href="https://compost.party">compost.party</a> created by user <a href="https://post.lurk.org/@computersandblues">@computersandblues</a> that runs completely on an Android device and a solar panel. Last, <a href="https://bladerunner.social/@stevelord">@stevelord</a> who is essentially running <a href="https://thedorkweb.bearblog.dev/my-openwrt-home-server/">a homelab on a TP-Link router</a> with OpenWRT installed.</p>
<p>I think a lot about power consumption of my homelab and I also love using old hardware for random projects to give them new life. I was truly inspired by the above works, so I got right down to business.</p>
<h2 id="the-hardware">The hardware</h2>
<p>I looked through the devices I had laying around and I chose a Google Pixel 5 my brother-in-law gave me after he upgraded. The Pixel 5 is carrier locked to Verizon, which is notorious for making it impossible to also unlock the bootloader and install custom ROMs. At first I wanted a device that I could install PostmarketOS to run a proper Linux server. In the end, I’m glad I didn’t go that route.</p>
<p>Another reason I chose the Pixel 5 is because it supports USB-OTG and can use docks with hard-wired internet. I didn’t want to run the site on wifi and having an ethernet connection was mandatory.</p>
<p>Last, it is the most current phone I have. This device is open to the internet, so I wanted to make sure it is an updated as possible.</p>
<h4 id="solar-powered-blog">Solar powered blog!</h4>
<p>This summer I’ve been testing using a 100w solar panel I got from <a href="https://www.harborfreight.com/100-watt-monocrystalline-solar-panel-57325.html">Harbor Freight Tools</a> so I can learn more about how it all works before diving into larger projects. I have that panel connected to a <a href="https://www.jackery.com/products/explorer-160-portable-power-station">Jackery 160w power station</a> to keep it charged up and we use it to charge our mobile devices. I got the Jackery last year as a power bank I use while on jobsites.</p>
<p>Since I already have this set up, I am now using it to power this blog. I’m happy with this setup as I’ve been getting more into <a href="https://permacomputing.net">permacomputing</a>. Having a website that is fully offgrid using recycled parts is exciting!</p>
<h2 id="what-i-used-to-create-the-site-termux-is-the-goat">What I used to create the site (Termux is the GOAT)</h2>
<p>While considering what projects I could do with this phone, I was thinking I was going to install a <code>proot</code> desktop and then run from within a Linux environment. Before I started I decided to check out a few packages that are in <a href="https://termux.dev/en/">Termux</a> (the flat out amazing terminal emulator) to see how far I could push it.</p>
<p>I checked for some basics and read about setting up an <code>ssh</code> connection. Then I randomly searched for <a href="https://gohugo.io">Hugo</a>, which is what my blog was already built on. Sure enough, it is right there in the Termux repos! Turns out, it has been in there for a long time. I see a lot of posts from 2018 with people using it.</p>
<h2 id="how-has-it-been-going">How has it been going</h2>
<p>Great! Site is fast and reliable. I ran into a few hiccups on the first day or so, which were mostly around the version of Hugo on my server and the newer version I am using on the phone. The other is related to my solar setup and keeping an eye on the battery levels.</p>
<p>To be honest, I don’t think anyone can tell it is running on an Android phone instead of a x86 Linux box or a hyperscaler VPS.</p>
<p>At the moment I have no plans to change this setup and will leave it as-is until some issue arises. But, there’s really not much to report other than it works fantastic.</p>
<p>Below are my longform notes on how I set it up. But, the short version is it was way simpler than I thought it would be. You can get up and running with a Hugo site by just installing <code>git</code>, <code>screen</code>, your favorite text editor, and <code>hugo</code> straight from the repos.</p>
<p>Not included in this post is how I add new posts to the phone. I can use <code>scp</code> to send a files, but I prefer to use <a href="https://github.com/sigoden/dufs">dufs</a> that is a static file server in that can be accessed in the browser. Using <code>dufs</code> I can upload files and make quick edits straight in the browser from any device. Surprise! <code>dufs</code> is also in the Termux repos and is so easy to get up and running. Again, message me if you’d like to see a write-up about it.</p>
<hr/>
<h2 id="installs">Installs</h2>
<p>Of course I need some basic utilities. These are the utilities I need to have at a minimum when working with a Linux system:</p>
<ul>
<li>rsync</li>
<li>openssh</li>
<li>git</li>
<li>wget</li>
<li>curl</li>
<li>fish shell</li>
<li>cronie</li>
<li>termux-services</li>
<li>iperf3</li>
<li>speedtest-go</li>
<li>screen</li>
<li>helix</li>
<li>hugo</li>
</ul>
<p>Restart Termux and use <code>sv-enable</code> to run certain items as services. I do this for <code>sshd</code> and <code>cronie</code>. It looks like this:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>$ sv-enable sshd
</span></span><span><span>$ sv-enable cronie
</span></span></code></pre></div><p>After running <code>sv-enable</code>, restart Termux.</p>
<h4 id="openssh">openssh</h4>
<p>I could build all of this straight from the phone using either the touchscreen keyboard or connecting a standard keyboard and mouse either with a USB-C dock or bluetooth. But, I want to manage this like all of my other servers, which is to <code>ssh</code> into the device and work from my desk.</p>
<p>There is an <a href="https://wiki.termux.com/wiki/Remote_Access#Using_the_SSH_server">official guide</a> for setting up an <code>ssh</code> server. All I will add here is some pointers I learned along the way.</p>
<ol>
<li>Adding an <code>ssh</code> key is simple and should be one of the first steps done. After generating the key and importing with <code>ssh-copy-id</code> from the desktop, edit the <code>sshd</code> file in <code>$PREFIX/etc/ssh/sshd_config</code>.</li>
<li>Termux generates its own username and cannot be changed. Run <code>whoami</code> to see what it is.</li>
<li>It is the same for the <code>ssh</code> port. As far as I can tell you cannot change the port, which is automatically set to <strong>8022</strong>.</li>
</ol>
<h2 id="running-the-site">Running the site</h2>
<p>There are lots of guides out there on how to setup a <code>hugo</code> site. I have an existing site that I migrated from a VM to this phone, so my notes do not include how to get a <code>hugo</code> site running. I also do not need to do any port forwarding as I already have a reverse proxy that I just changed where it points for my blog.</p>
<p><strong>I would like to hear feedback if there is a need to add those notes here. Message me on Mastodon or by email using the links at the bottom of this post.</strong></p>
<p>Below are notes on how I use the package <code>cronie</code> to start the blog using <code>screen</code> and the automatically reload the blog occasionally. <code>cronie</code> is for setting up <code>cron</code> tasks. Once installed and enabled, run <code>crontab -e</code> like usual to setup tasks.</p>
<p>This is how I do it.</p>
<p>First, set a <code>fish</code> alias for the command to reload the blog:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>alias blog_run<span>=</span><span>&#39;cd /data/data/com.termux/files/home/&lt;website_root_dir&gt; &amp;&amp; /data/data/com.termux/files/usr/bin/hugo serve --bind=0.0.0.0 --baseURL=https://blog.ctms.me --appendPort=false --environment=production --disableFastRender --cacheDir /data/data/com.termux/files/home/&lt;website_root_dir&gt;/cache&#39;</span>
</span></span><span><span>
</span></span><span><span>funcsave blog_run
</span></span></code></pre></div><p>Now, create a script and place in <code>~/scripts</code> that closes a previous instance of <code>screen</code>, clears the cache, and then starts a new <code>screen</code> session titled “hugo” and execute the alias:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span><span>#! /bin/bash
</span></span></span><span><span><span></span>screen -X -S <span>&#34;hugo&#34;</span> quit
</span></span><span><span>rm -rf /data/data/com.termux/files/home/&lt;website_root_dir/cache/&lt;site_name_dir&gt;/filecache/getresource/
</span></span><span><span>screen -S hugo -d -m fish -c <span>&#39;blog_run; exec fish&#39;</span>
</span></span></code></pre></div><p>Last, set it to run with <code>cron</code></p>
<div><pre tabindex="0"><code data-lang="gdscript3"><span><span><span>*/</span><span>5</span> <span>*</span> <span>*</span> <span>*</span> <span>*</span> cd <span>/</span>data<span>/</span>data<span>/</span>com<span>.</span>termux<span>/</span>files<span>/</span>home<span>/</span>scripts <span>&amp;&amp;</span> sh blog_reload<span>.</span>sh
</span></span></code></pre></div><h2 id="backing-up">Backing up</h2>
<p>Since Termux supports <code>ssh</code> connections, I can use it on remote machines to pull the files from the phone using <code>rsync</code>.</p>
<p>First, need to install <code>rsync</code> on the phone with <code>pkg install rsync</code>.</p>
<h4 id="desktop-backup">Desktop backup</h4>
<p>Now we can run it from my desktop to pull the files:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>rsync -aP pixel:~/&lt;website_root_dir&gt; /local/dir/pixel_blog/
</span></span></code></pre></div><p>On my desktop, I have this for <code>cron</code></p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>@reboot sleep <span>30</span> <span>&amp;&amp;</span> rsync -aP pixel:~/&lt;website_root_dir&gt; /local/dir/pixel_blog/ &gt;&gt; $HOME/logs/pixel-hugo-backup.log 2&gt;&amp;<span>1</span>
</span></span></code></pre></div><h4 id="nas-backup">nas backup</h4>
<p>This is the same configuration. The only difference is the backup location and the <code>cron</code> timing.</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>rsync -aP pixel:~/&lt;website_root_dir&gt; /local/dir/pixel_blog
</span></span></code></pre></div><p>The automation:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span><span>5</span> <span>6</span> * * * rsync -aP pixel:~/&lt;website_root_dir&gt; /local/dir/pixel_blog &gt;&gt; $HOME/logs/pixel-hugo-backup.log 2&gt;&amp;<span>1</span>
</span></span></code></pre></div><h4 id="git-backup">git backup</h4>
<p>I have a local self-hosted git instance I push backups to, but you can totally set it up to send them to Github or whatever forge you use. No instructions here because there are plenty of guides out there on how to set this up.</p>

    <p>
        - - - - -
    </p>
    <p>
        <i>Thank you for reading! If you would like to comment on this post you can start a conversation on the Fediverse. Message me on Mastodon at <a href="https://masto.ctms.me/@cinimodev"><strong>@cinimodev@masto.ctms.me</strong></a>. Or, you may email me at <a href="mailto:blog.discourse904@8alias.com"><strong>blog.discourse904@8alias.com</strong></a>. This is an intentionally masked email address that will be forwarded to the correct inbox.</i>
    </p>



		</section></div>
  </body>
</html>
