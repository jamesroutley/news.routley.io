<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.biscuitsec.org/blog/biscuit-3-0/">Original</a>
    <h1>Biscuit 3.0</h1>
    
    <div id="readability-page-1" class="page"><div role="document">
  <div>
    <div>
      <div>
        <article>
          
          <p>The reference implementation of rust has been released, will full support for the latest spec additions</p>
          <h2 id="the-biscuit-specification-and-the-library-ecosystem">The biscuit specification and the library ecosystem</h2>
<p>Biscuit is published as specification, along with several implementations.
Amongst them, <a href="https://github.com/biscuit-auth/biscuit-rust"><code>biscuit-rust</code></a> is the reference implementation. It
is used when programming in rust, but it also powers <a href="https://github.com/biscuit-auth/biscuit-wasm"><code>biscuit-wasm</code></a>
which provides support for javascript applications (both client-side and
server-side), and <a href="https://github.com/biscuit-auth/biscuit-web-components"><code>biscuit-web-components</code></a> which provides
in-browser interactive tooling.</p>
<h2 id="biscuit-v3">Biscuit v3</h2>
<p>Motivated by <a href="https://www.biscuitsec.org/blog/third-party-blocks-why-how-when-who/">third-party blocks</a>, a new specification
version was released. In addition to third-party blocks, a few other changes
have been included in the new version.</p>
<ul>
<li>support for <code>check all</code></li>
<li>support for bitwise operators</li>
<li>support for <code>!=</code></li>
<li>support for authorizer snapshots</li>
</ul>
<h3 id="a-word-on-biscuit-versions">A word on biscuit versions</h3>
<p>The currently supported biscuit versions are <code>v2</code> and <code>v3</code>. Those two versions
are compatible and <code>v3</code> is opt-in: if you don&#39;t use any new feature from
biscuit v3, the generated tokens will work with implementations only supporting
<code>v2</code> biscuits. Of course, <code>v2</code> biscuits continue being supported by new
implementations. It is even possible to attenuate a <code>v2</code> biscuit with <code>v3</code>
features.</p>
<h2 id="biscuit-rust-v3-0-0">biscuit-rust v3.0.0</h2>
<p>The last stable release of <code>biscuit-rust</code> was <code>v2.2.0</code>, published ten months
ago. While support for third-party blocks and other <code>v3</code> features make for
the bulk of the changes, the library itself has been improved. The biggest
improvement would be the datalog macros (introduced in <code>v2.2.0</code>) which are now
covering all use-cases in a performant fashion.</p>
<h3 id="third-party-blocks">Third-party blocks</h3>
<p>Third-party blocks allow cross-domain authorization with fine-grained access
rules. This is an exciting development, since it makes distributed auth
patterns possible with no out-of-band synchronisation required: all required
information can be carried in a single biscuit token.</p>
<p>See more on <a href="https://www.biscuitsec.org/blog/third-party-blocks-why-how-when-who/">the post introducing third-party blocks</a>.</p>
<pre data-lang="biscuit-datalog"><code data-lang="biscuit-datalog"><span>// authority block, emitted by the login service.
</span><span>// it only allows read access to the `file1` resource
</span><span>user(&#34;clementd&#34;);
</span><span>right(&#34;file1&#34;, &#34;read&#34;);
</span><span>// the fact `member(&#34;pink-floyd-fans&#34;)`; has to come from a block
</span><span>// signed by the social network: this is enforced via the public key check
</span><span>// so the token is effectively inert as long as it is not augmented by the
</span><span>// social network service.
</span><span>check if member(&#34;pink-floyd-fans&#34;) trusting ed25519/398ad724c0da3756bb8709a85179a3ff9c34f8ec08317c3d8f79d75db7eab014;
</span><span>
</span><span>// block provided by the social network
</span><span>// it provides the proof that the holder is part of the pink-floyd-fans group, but adds
</span><span>// a check: the proof is valid only for a limited amount of time
</span><span>// this block carries a signature that can be verified with the following
</span><span>// public key: 398ad724c0da3756bb8709a85179a3ff9c34f8ec08317c3d8f79d75db7eab014
</span><span>member(&#34;pink-floyd-fans&#34;);
</span><span>check if time($time), $time &lt; 2022-08-01T00:00;
</span><span>
</span><span>// verifier policy.
</span><span>allow if right(&#34;file1&#34;, &#34;read&#34;);
</span></code></pre>
<h3 id="datalog-macros">Datalog macros</h3>
<p>Biscuit comes with a powerful DSL for authorization rules. A common pain
point with using DSLs is using dynamic values within an embedded program.
Concatenating strings opens the door to nasty security issues. SQL injections
are the infamous example of this kind of problem. Another frustrating issue
(at least for rust developers) is that when an embedded program is defined in
a regular string, it becomes opaque up until it is parsed at runtime. So we get
runtime errors on static elements, doubled with performance issues.</p>
<p><code>biscuit-rust</code> provides a solution to both these issues:</p>
<ul>
<li>a parameter injection syntax allows splicing dynamic values with no risk
of injections;</li>
<li>a series of macros move datalog parsing to compile-time, providing both static
guarantees and performant code.</li>
</ul>
<pre data-lang="rust"><code data-lang="rust"><span>let</span><span> user_id = &#34;</span><span>1234</span><span>&#34;;
</span><span>let</span><span> expiration = SystemTime::now() + Duration::from_secs(</span><span>86400</span><span>);
</span><span>let mut</span><span> authority = biscuit!(</span><span>r</span><span>#&#34;
</span><span>  user({user_id});
</span><span>  check if time($time), $time &lt; {expiration};
</span><span>  </span><span>&#34;#
</span><span>);
</span><span>
</span><span>let</span><span> rights = [&#34;</span><span>read</span><span>&#34;, &#34;</span><span>write</span><span>&#34;];
</span><span>for</span><span> right in rights {
</span><span>  biscuit_merge!(&amp;</span><span>mut</span><span> authority, </span><span>r</span><span>#&#34;
</span><span>    right({right});
</span><span>  </span><span>&#34;#);
</span><span>}
</span></code></pre>
<p>Do note that the parameter injection syntax is also available for runtime
parsing:</p>
<pre data-lang="rust"><code data-lang="rust"><span>let</span><span> user_id = &#34;</span><span>1234</span><span>&#34;;
</span><span>let</span><span> expiration = SystemTime::now() + Duration::from_secs(</span><span>86400</span><span>);
</span><span>let mut</span><span> params = HashMap::new();
</span><span>params.</span><span>insert</span><span>(&#34;</span><span>user_id</span><span>&#34;.</span><span>to_string</span><span>(), user_id.</span><span>into</span><span>());
</span><span>params.</span><span>insert</span><span>(&#34;</span><span>expiration</span><span>&#34;.</span><span>to_string</span><span>(), expiration.</span><span>into</span><span>());
</span><span>
</span><span>let mut</span><span> authority = BiscuitBuilder::new();
</span><span>authority.</span><span>add_code_with_params</span><span>(
</span><span>    </span><span>r</span><span>#&#34;</span><span> user({user_id}); check if time($time), $time &lt; {expiration}; </span><span>&#34;#,
</span><span>    params,
</span><span>    HashMap::new(),
</span><span>)?;
</span><span>
</span><span>let</span><span> rights = [&#34;</span><span>read</span><span>&#34;, &#34;</span><span>write</span><span>&#34;];
</span><span>for</span><span> right in rights {
</span><span>    </span><span>let mut</span><span> fact: Fact = </span><span>r</span><span>#&#34;</span><span>right({right})</span><span>&#34;#.</span><span>try_into</span><span>()?;
</span><span>    fact.</span><span>set</span><span>(&#34;</span><span>right</span><span>&#34;, right)?;
</span><span>    authority.</span><span>add_fact</span><span>(fact)?;
</span><span>}
</span></code></pre>
<p>This feature is what makes possible to provide safe interpolation in <code>biscuit- wasm</code>.</p>

<p>Another addition to the biscuit spec is <em>authorizer snapshots</em>. It is possible
to save the current state of an authorizer to a file, and then to load it back.</p>
<p>This allows authorizer evaluation: create an authorizer, pre-evaluate rules,
store it somewhere, and then resume execution once you have more context. This
can be useful in systems that enforce a strict authentication/authorization
separation.</p>
<p>Another use-case is <em>post-hoc inspection</em>. After performing authorization, you
can dump the full context to a file, and inspect it with the CLI afterwards. If
you have ever tried to debug authorization issues after the fact, then you might
find this useful.</p>
<pre><code><span>&gt; biscuit inspect-snapshot snapshot-file
</span><span>time(2023-03-30T09:39:39Z);
</span><span>user(&#34;1234&#34;);
</span><span>right(&#34;file1&#34;, &#34;read&#34;);
</span><span>time(2023-03-30T09:39:39Z);
</span><span>
</span><span>check if time($time), $time &lt; 2023-03-31T00:00:00Z;
</span><span>
</span><span>allow if right(&#34;file2&#34;, &#34;read&#34;);
</span></code></pre>
<h2 id="biscuit-wasm-v0-4-0">biscuit-wasm v0.4.0</h2>
<p>In addition to the <a href="https://github.com/biscuit-auth/biscuit-rust"><code>biscuit-rust</code></a> release, a release of
<a href="https://github.com/biscuit-auth/biscuit-wasm"><code>biscuit-wasm</code></a> is planned for the upcoming days.
<code>biscuit-wasm-0.4.0</code> will bundle all of the improvements from
<code>biscuit-rust-3.0.0</code> and will also pack JS-specific improvements. The most
important one is the JS counterpart to datalog macros in rust: tagged templates.</p>
<p>This is javascript, so there is no way to move datalog parsing to compile-time,
but at least parameter injection is handled nicely.</p>
<pre data-lang="javascript"><code data-lang="javascript"><span>let </span><span>user_id </span><span>= &#34;</span><span>1234</span><span>&#34;;
</span><span>let </span><span>expiration </span><span>= new Date(new Date().</span><span>getTime</span><span>() + </span><span>86400000</span><span>);
</span><span>let </span><span>authority </span><span>=
</span><span>  </span><span>biscuit</span><span>`</span><span>user(${</span><span>user_id</span><span>});
</span><span>          check if time($time), $time &lt; ${</span><span>expiration</span><span>}</span><span>`;
</span><span>
</span><span>for </span><span>(</span><span>let </span><span>right </span><span>of [&#34;</span><span>read</span><span>&#34;, &#34;</span><span>write</span><span>&#34;]) {
</span><span>   </span><span>authority</span><span>.</span><span>add_fact</span><span>(</span><span>fact</span><span>`</span><span>right(${</span><span>right</span><span>})</span><span>`);  
</span><span>}
</span><span>
</span><span>let </span><span>token </span><span>= </span><span>authority</span><span>.</span><span>build</span><span>(</span><span>secretKey</span><span>);
</span><span>let </span><span>auth </span><span>= </span><span>authorizer</span><span>`</span><span>time(${</span><span>new </span><span>Date()}); allow if user($u);</span><span>`;
</span><span>auth</span><span>.</span><span>authorize</span><span>();
</span><span>let </span><span>facts </span><span>= </span><span>auth</span><span>.</span><span>query</span><span>(</span><span>rule</span><span>`</span><span>u($id) &lt;- user($id)</span><span>`);
</span></code></pre>
<h2 id="other-ongoing-projects">Other ongoing projects</h2>
<p>While biscuit-rust and biscuit-wasm are where most of the work happens, there
are a few areas where things have happened.</p>
<ul>
<li><a href="https://github.com/biscuit-auth/biscuit-cli">biscuit-cli</a> allows manipulating and inspecting biscuits on the
command line;</li>
<li><a href="https://github.com/dmunch/biscuit-net">biscuit-dotnet</a> has been released recently, providing biscuit
support to the dotnet platform;</li>
<li><a href="https://github.com/biscuit-auth/biscuit-web-components">biscuit-web-components</a> provide an embeddable editor
and token inspector.</li>
</ul>
<h3 id="syntax-highlighting-with-tree-sitter">Syntax highlighting with tree-sitter</h3>
<p><a href="https://tree-sitter.github.io">Tree-sitter</a> allows to provide syntax
highlighting and more advanced features (AST-based navigation) in a cross-editor
way. There are plugins for emacs and neovim, and modern editors like helix
support it out of the box. Not only this makes editing biscuit-datalog files
more convenient, but when paired with language injection, it also means that
editing a datalog snippet inside your programming language benefits from syntax
highlighting.</p>
<figure>
<p><img src="https://www.biscuitsec.org/img/biscuit-3-editor-2.png" alt="A code editor with a datalog program in it"/></p>
<figcaption>Typing the contents of a biscuit token from within a code editor</figcaption>
</figure>
<figure>
<p><img src="https://www.biscuitsec.org/img/biscuit-3-editor-3.png" alt="A datalog block within a markdown document"/></p>
<figcaption>Datalog syntax highlighting within a markdown code fence</figcaption>
</figure>
<figure>
<p><img src="https://www.biscuitsec.org/img/biscuit-3-editor-1.png" alt="A datalog snippet inside a javascript typed template string"/></p>
<figcaption>Datalog syntax highlighting within javascript tagged template string</figcaption>
</figure>
<p>In addition to the editor-agnostic grammar, editor-specific queries are needed
for highlighting and AST manipulation. As of now, those queries are only written
for the <a href="https://helix-editor.com">helix</a> editor, but it is a fun project to add
support for other editors. Reach out to <code>clementd</code> on <a href="https://matrix.to/#/!MXwhyfCFLLCfHSYJxg:matrix.org">matrix</a> if you
want to try!</p>
<h2 id="a-word-on-outscale">A word on <a href="https://outscale.com">Outscale</a></h2>
<p>I (<a href="https://clementd.wtf">Clément Delafargue</a>) have joined <a href="https://outscale.com">Outscale</a>
last week, and working on biscuit is now a part of my job, since Outscale is
investing in biscuit. That&#39;s great news since it allows me to dedicate way more
time to biscuit. Some of my coworkers will also contribute to biscuit, so we
are planning to carry out improvements in several areas, including tutorials
and documentation.</p>
<p><a href="https://outscale.com">Outscale</a> is a French IaaS cloud provider, a brand
of Dassault Systèmes, providing services to customers with strong data security
and sovereignity constraints.</p>
<h2 id="let-s-have-a-chat">Let&#39;s have a chat!</h2>
<p>Please come have a chat on <a href="https://matrix.to/#/!MXwhyfCFLLCfHSYJxg:matrix.org">our matrix room</a> if you have questions about
biscuit. There is a lot to discover!</p>

        </article>
      </div>
    </div>
  </div>
</div></div>
  </body>
</html>
