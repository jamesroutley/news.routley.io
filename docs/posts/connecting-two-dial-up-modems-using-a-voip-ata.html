<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gekk.info/articles/ata-config.html">Original</a>
    <h1>Connecting two dial-up modems using a VoIP ATA</h1>
    
    <div id="readability-page-1" class="page">﻿



	<title>Configuring SPA122 ATA For Dial-Through</title>
	
	
	
	<meta name="twitter:card" content="summary"/>
	<meta name="twitter:title" content="Configuring SPA122 ATA For Dial-Through"/>
	<meta name="twitter:description" content="How to make modems work in 2020 using VoIP"/>
	<meta name="twitter:image" content="https://gekk.info/articles/images/modem.png"/>

	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	


<p><strong><a href="https://gekk.info/">gekk.info</a> « <a href="https://gekk.info/articles/index.html">articles</a></strong></p>

<p>Configuring SPA122 ATA For Dial-Through</p>

<p><a href="https://gekk.info/articles/images/img48.jpg">
<img alt="Two laptops connected via modem over a VoIP ATA" height="480" src="https://gekk.info/articles/images/img48_small1.jpg" width="640"/><!-- MSComment="autothumbnail" xthumbnail-orig-image="file:///C:/Users/dthom/Documents/My Web Sites/images/img48.jpg" --></a></p>
<p><sub>Two laptops communicating over modems using a VoIP ATA (don&#39;t mind the 
two screens not matching - Windows 98 Hyperterminal isn&#39;t so hot)</sub></p>



<p><a href="#Intro">Intro</a></p>

<p>This guide will explain some ways to set up a VoIP ATA so that you can 
place calls between computers with modems (although any other pair of telephone devices 
will work.)</p>
<p>When done, you will be able to:</p>
<ul>
	<li><strong>Connect two or more computers with modems directly together</strong></li>
	<li><strong>Connect a computer with a modem to another one elsewhere in your 
	house over your LAN</strong></li>
	<li><strong>Connect a computer with a modem to another one in someone elses 
	house over the internet</strong></li>
</ul>
<p>To make this work, you will <strong>ideally</strong> have:</p>
<p>
<a href="https://gekk.info/articles/images/img5A.jpg">
<img alt="Cisco SPA122 ATA" height="186" src="https://gekk.info/articles/images/img5A_small.jpg" width="320"/><!-- MSComment="autothumbnail" xthumbnail-orig-image="file:///C:/Users/dthom/Documents/My Web Sites/images/img5A.jpg" --></a></p>
<ul>
	<li>A <strong>Cisco SPA122</strong> (pictured above)</li>
</ul>
<p>This procedure is written for that device specifically, and there are tons of 
them on eBay for under $30.</p>
<ul>
	<li><strong>Cisco SPA2102</strong></li>
	<li><strong>Linksys SPA2102</strong></li>
	<li><strong>Linksys PAP2T</strong></li>
	<li><strong>Sipura SPA2100</strong></li>
</ul>
<p>All of these are <em>literally the same device,</em> with different firmware. 
It&#39;ll probably only take you a few minutes to figure out how to find the 
matching fields, so if you have any of these, use it.</p>
<p>You <em>cannot </em>do this with any ATA made by Grandstream. You <em>may</em> 
be able to use ATAs from other vendors, but I do not cover those procedures.</p>
<p><strong>There are 
two important caveats to these devices:</strong></p>

<h2><a name="single_ATA">Using a single ATA</a></h2>
<h3>Basic Network Setup</h3>
<ol>
	<li>Plug in power, but do <em>not</em> connect to your LAN.</li>
	<li>Plug in a PC to the <em>Ethernet</em> port - the yellow one, 
	not the blue one</li>
	<li>You&#39;ll get an IP eventually. (If you don&#39;t, factory reset the device 
	(hold the button for 30, wait five minutes and try again))</li>
	<li>In a web browser, go to <strong>192.168.15.1</strong></li>
	<li>Log in as <em>admin / admin</em></li>
	<li>Go to <strong>Administration</strong>, then <strong>User List</strong><ol>
		<li>Edit <strong>admin</strong></li>
		<li>Change the password to something new, whatever you like - if you don&#39;t do this, the 
		next step will refuse to work.</li>
	</ol>
	</li>
	<li>Go to <strong>Web Access Management</strong><ol>
		<li>Enable <strong>Remote Management</strong></li>
	</ol>
	</li>
	<li>Plug the <em><strong>blue</strong></em><strong> Ethernet port </strong>into your LAN,
	<strong>not the yellow one!</strong></li>
	<li>Go to the <strong>Status</strong> page, then<strong> Internet Status</strong>,<strong>
	</strong>and find the IP address</li>
	<li>Plug your PC back into your normal network</li>
	<li>Put that IP into your web browser</li>
	<li>You should get the config interface. Now you can access the web config 
	from anywhere on your network.</li>
</ol>
<p>You should be aware that the SPA122 acts as a full-blown broadband router 
by default - anything plugged into the yellow port will be NATed to the IP on 
the blue port.</p>
<h3>VoIP Setup</h3>
<p>Once you have web access to the SPA as above, you can configure the ports. We 
will use the bogus number <em>9095551010</em>, but if you want to use another 
one, just replace it (in yellow) below.</p>
<ol>
	<li>Log into the web interface</li>
	<li>Go to the <strong>Voice</strong> section, then <strong>Line 1</strong><ol>
		<li>Set <strong>Make Call Without Reg</strong> and <strong>Ans Call 
		Without Reg </strong>to <strong>yes</strong></li>
		<li>Set <strong>User ID</strong> to <strong>100</strong></li>
		<li>Scroll down and find <strong>Dialplan</strong>, and replace its 
		contents with the following:<ul>
			<li>
			(*xx|[3469]11|0|00|[2-9]xxxxxx|1xxx[2-9]xxxxxxS0|xxxxxxxxxxxx.|&lt;<span><strong><span>9095551010</span></strong></span>:101&gt;S0&lt;:@127.0.0.1:5061&gt;|)</li>
		</ul>
		</li>
		<li>Under the <strong>Audio Configuration</strong> section, set 
		everything that says <strong>Fax</strong> to <strong>no</strong></li>
		<li>Click <strong>Submit</strong> and wait about two minutes, then click 
		on the <strong>Voice</strong> tab again if it doesn&#39;t redirect</li>
	</ol>
	</li>
	<li>Go to <strong>Line 2</strong><ol>
		<li>Set <strong>Make Call Without Reg</strong> and <strong>Ans Call 
		Without Reg </strong>to <strong>yes</strong></li>
		<li>Set <strong>User ID</strong> to <strong>101</strong></li>
		<li>Scroll down and find <strong>Dialplan</strong>, and replace its 
		contents with the following (it&#39;s different, so don&#39;t just reuse the 
		first one!):<ul>
			<li>
			(*xx|[3469]11|0|00|[2-9]xxxxxx|1xxx[2-9]xxxxxxS0|xxxxxxxxxxxx.|&lt;<span><strong><span>9095551010</span></strong></span>:100&gt;S0&lt;:@127.0.0.1:5060&gt;|)</li>
		</ul>
		</li>
		<li>Under the <strong>Audio Configuration</strong> section, set 
		everything that says <strong>Fax</strong> to <strong>no</strong></li>
		<li>Click <strong>Submit</strong> and wait about two minutes, then click 
		on the <strong>Voice</strong> tab again if it doesn&#39;t redirect</li>
	</ol>
	</li>
	<li>Configuration is complete!</li>
</ol>
<p>This config instructs the ATA 
that if you dial this bogus number<em> </em>from either port, it should just 
immediately call the other port.</p>
<p>Leave the ATA plugged into a network (it won&#39;t work without some kind of 
network connection,) connect modems to both ports, tell one to listen for connections, and then have the other one dial 
9095551010, and you&#39;re off to the races! See the Troubleshooting section if you 
have problems.</p>
<h2><a name="Two_ATAs">Using two ATAs</a></h2>
<p>Note: I have not tested this for lack of hardware, but I have little doubt that it will work. Let me know if it doesn&#39;t.</p>
<p>In this config, you&#39;ll call between two ATAs <strong>in your 
house, on the same LAN.</strong></p>
<p>There are countless ways that interfacing two ATAs could work. I&#39;m going to 
explain how to do this with <em>two identical SPA122s</em>. If your other ATA is 
another model, you&#39;ll need to figure out how to adapt these steps to that model.</p>
<p>Configure <strong>two</strong> <strong>SPA122s,</strong> exactly as in the &#34;Using 
one ATA&#34; section, but with these changes:</p>
<ol>
	<li>Make sure you have fixed IPs on both devices<ol>
		<li>Under the IP settings in the Network section, assign a static IP 
		address to each SPA; let&#39;s say <strong>192.168.1.100</strong> 
		for the first one 
	and <strong>192.168.1.101 </strong>for the second.</li>
		<li>You could also make a static DHCP lease if you know how to do that.</li>
	</ol>
	</li>
	<li>When you assign the <em>User ID</em> field to each line, use unique 
	numbers on both devices, like this:<ul>
		<li>ATA 1, line 1: 100</li>
		<li>ATA 1, line 2: 101</li>
		<li>ATA 2, line 1: 102</li>
		<li>ATA 2, line 2: 103</li>
	</ul>
	</li>
	<li>Since there are now four ports that can all call between each other, 
	we&#39;ll use a more complex dialplan that assigns an &#34;extension&#34; to every port:
	<ol>
		<li>Use this <strong>Dialplan</strong> for both lines on both ATAs:</li>
		<li>Remember to replace the IPs (in blue) with the ones you used.</li>
		<li>You can change the phone numbers (yellow) for each port as you see 
		fit.</li>
	</ol>
	</li>
</ol>
<p>After doing all of the above, you will now have two ATAs (at the IPs in blue) that can call 
between any of their ports (the extensions defined in lavender) with the bogus numbers 
(defined in yellow.) So if you&#39;re on ATA 1 
and you want to call port 1 on ATA 2, you call 9095551012, and if you&#39;re on ATA 
2 and you want to call port 2 on ATA 1, you call 9095551011.</p>
<p>This configuration can be used on a LAN, so you can put the two ATAs in two 
different rooms. You might also be able to plug the two ATAs directly into each 
other, using the blue Ethernet jacks, and have a self contained four-line 
telephone network, but I haven&#39;t tested that yet.</p>
<h2><a name="ATAs_over_internet">Calling Over The Internet</a></h2>
<p>Note: I have not tested this for lack of hardware, but I have little doubt that it will work. Let me know if it doesn&#39;t.</p>
<p>Assuming you and a friend both have ATAs you want to call between, configure 
them the same as the last section, with the following changes:</p>
<ol>
	<li>Assuming you&#39;re behind a normal internet router, you&#39;ll need to forward 
	UDP ports 5060 and 5061 to the ATAs on both ends.</li>
	<li>Build your dialplans just like above, but replace the private IP of the 
	other ATA with your friends public IP, meaning:<ol>
		<li>In your ATA, replace 192.168.1.101 with your friends WAN IP</li>
		<li>In your friends ATA, replace 192.168.1.100 with your WAN IP.</li>
	</ol>
	</li>
</ol>
<p>That should be all that&#39;s needed.</p>

<p>This should <em>just work</em>, but here are a couple things you can do if it 
doesn&#39;t:</p>
<ol>
	<li>Test basic dialing functionality:<ol>
		<li>Get a plain, basic telephone and plug it into one port</li>
		<li>Try to dial <em>9095551010</em>. Regardless of what&#39;s plugged into the other 
		port, you should hear ringing. If you hear busy signal or dead air, you 
		missed a config step.</li>
		<li>If you have a second phone, plug it into the other port. Test 
		dialing <em>9095551010</em> from either one; it should ring the other set and 
		you should be able to pick up and talk.</li>
		<li>If all of the above works then there&#39;s nothing wrong with the ATA 
		dialing</li>
	</ol>
	</li>
	<li>Apply data optimization settings:<ol>
		<li>The instructions given earlier include the <strong>necessary</strong> 
		step of disabling fax detection, but if that isn&#39;t enough, you can do 
		this too.</li>
		<li>In <strong>Line 1</strong> and <strong>Line 2</strong>, apply the 
		settings below. They will tell the ATA not to try to &#34;help&#34; and should 
		cause it to just pass through audio unmodified.<ol>
			<li>After applying the settings to Line 1 and hitting Submit, make 
			sure you wait for the page to reload before moving on to Line 2.</li>
		</ol>
		</li>
		<li>In the <strong>Network Settings</strong> section:<ul>
			<li><strong>Network Jitter Level</strong>: Extremely high</li>
			<li><strong>Jitter Buffer Adjustment:</strong> No</li>
		</ul>
		</li>
		<li>In the <strong>Audio Configuration</strong> section:<ul>
			<li><strong>Preferred Codec: </strong>g711u</li>
			<li><strong>Second</strong> and <strong>Third</strong> <strong>
			Preferred Codec:</strong> Unspecified</li>
			<li><strong>G729a Enable:</strong> No</li>
			<li><strong>Silence Supp Enable:</strong> No</li>
			<li><strong>Echo Canc Enable:</strong> No</li>
			<li><strong>Everything that says Fax:</strong> No</li>
			<li><strong>Modem Line</strong>: Yes</li>
		</ul>
		</li>
	</ol>
	</li>
	<li><strong>If you&#39;re not getting any dialtone</strong>, check that the SPA has an active 
	Ethernet link on the blue port. If it doesn&#39;t have a connection and a 
	valid IP, it&#39;ll shut off the voice module.</li>
	<li>
	<p>You will not get a 56k connection speed no matter what you do - the V.90 
	and V.92 specifications explicitly state that the modems you have (&#34;analog 
	modems&#34;) are only capable of originating a 33.6 connection. You need special 
	ISP equipment to originate a 56k connection.</p>

	</li>
</ol>

<p>As I said earlier in this document, there&#39;s a big question of what to do once 
you&#39;ve gotten the dialing part taken care of. I&#39;m still working on this part, 
but here are some starting points.</p>
<h2>Internet Access</h2>
<p>One of the most obvious end goals is to get online. You&#39;ll need a host system 
for this, something that can connect to your home internet that also has a 
modem. I used a 2012 Dell laptop for my tests.</p>
<p>I was able to <a href="https://gekk.info/articles/ras_2k3.html">set up RAS on <em>Windows Server 2003</em></a>, 
dial into it from Windows 98 on a Pentium 3 laptop with no ethernet 
jack, and get connected at <strong>33.6kbps</strong>. Because Windows supports 
software compression for dialup connections, I&#39;m able to get a sustained <strong>
14KB/s of throughput</strong> with ideal data.</p>
<p>You can also do this on Linux (<a href="https://dogemicrosystems.ca/wiki/Dial_up_server">here&#39;s 
a guide</a> for doing it with a Raspberry Pi specifically), but personally I 
find it <em>much more irritating and broken.</em> Namely, I couldn&#39;t actually 
get it to work - I tried, and it just wouldn&#39;t go, and I don&#39;t know why. The 
Windows approach is finicky too, but I&#39;m able to replicate my steps there, 
whereas on Linux I just plain can&#39;t, so my rec is to just do it on Windows.</p>
<h2>Direct-Connection Networking</h2>
<p>There&#39;s a lot of older software that supports direct dialup - all DOS 
multiplayer games, for instance, as well as some early Windows multiplayer 
games. If you&#39;re looking for something to try this out with a friend, download 
the Doom 95 shareware release - it supports direct dialup multiplayer and should 
run on just about anything, albeit pretty slowly on some machines.</p>
<p>You should also be able to do this with some file sharing software and 
communication apps like Netmeeting, though I haven&#39;t tried any of that.</p>
<h2>Direct System Access</h2>
<p>Another notion that might come to mind is the ability to dial in to a system, like an old Unix or VMS machine, for instance, or a modern Linux system, and get connected directly to 
a shell account.</p>
<p>This is really no different than just plugging directly into the serial port on 
the machine in question, except that you need something that will acknowledge an 
incoming phone call from a modem and start a new login process. On Linux that&#39;s 
mgetty. You can adapt the instructions from the
<a href="https://dogemicrosystems.ca/wiki/Dial_up_server">Raspberry Pi guide</a> 
for this - just set up your dialin user with /bin/bash instead of ppp to get a 
shell after dialing in.</p>

<hr/>
	<p>If this was interesting to you, or if you did something interesting with it, email me: <a href="mailto:articles@gekk.info">articles@gekk.info</a></p>
	<p>If you like my work, consider <a href="https://ko-fi.com/gravis">
	tossing me a few bucks</a>. It takes a lot of effort and payment helps me 
stay 
	motivated.</p>

	<p><a href="https://gekk.info/articles/index.html">List of Articles</a></p>
	



</div>
  </body>
</html>
