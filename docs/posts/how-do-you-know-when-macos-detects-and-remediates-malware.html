<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://eclecticlight.co/2023/01/04/how-do-you-know-when-macos-detects-and-remediates-malware/">Original</a>
    <h1>How do you know when macOS detects and remediates malware?</h1>
    
    <div id="readability-page-1" class="page"><article id="post-69592">
	
	<!-- .entry-header -->

	
		<div data-first_letter="O">
		<p>Over the last week or so, in test virtual machines, I’ve been deliberately running malicious software that macOS has detected and removed (‘remediated’). Following <a href="https://eclecticlight.co/2023/01/03/can-you-rely-on-macos-ventura-for-malware-protection/">yesterday’s assessment</a> of the effectiveness of protection provided by macOS, this article looks at how well the user is informed about malware detections.</p>
<h4>Detection</h4>
<p>When malware is detected as the user is trying to open or run it, alerts are clear, apart from the terminology used.</p>
<p>It’s some years since Apple referred to malware using regular names. Since then, sources such as the XProtect Yara data file refer to all malware using semi-randomised hex. For example, the alert below cites the name of MACOS.2070d41, which is unique to Apple. This turns out to mean a variant of what’s generally known as XCSSET, which Apple has also previously referred to as DubRobber A.</p>
<p><span><img data-attachment-id="69590" data-permalink="https://eclecticlight.co/xprxcs02/" data-orig-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprxcs02.png" data-orig-size="664,611" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="xprxcs02" data-image-description="" data-image-caption="" data-medium-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprxcs02.png?w=300" data-large-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprxcs02.png?w=664" src="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprxcs02.png?w=940" alt="xprxcs02" srcset="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprxcs02.png 664w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprxcs02.png?w=150 150w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprxcs02.png?w=300 300w" sizes="(max-width: 664px) 100vw, 664px"/></span></p>
<p>Other alerts use newer names, in common with codenames used for the scanning modules in XProtect Remediator, such as SnowDrift, although why it has been capitalised in the alert below is a mystery.</p>
<p><span><img data-attachment-id="69582" data-permalink="https://eclecticlight.co/xprmensis01/" data-orig-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprmensis01.png" data-orig-size="666,610" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="xprmensis01" data-image-description="" data-image-caption="" data-medium-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprmensis01.png?w=300" data-large-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprmensis01.png?w=666" src="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprmensis01.png?w=940" alt="xprmensis01" srcset="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprmensis01.png 666w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprmensis01.png?w=150 150w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprmensis01.png?w=300 300w" sizes="(max-width: 666px) 100vw, 666px"/></span></p>
<p>SnowDrift refers to what everyone else knows as CloudMensis.</p>
<p>None of Apple’s obscure naming systems informs the user, just leaves them puzzled, and unless they have the presence of mind to take a screenshot, they won’t recall the name shown in the alert.</p>
<p>Apple is in the unique position of being able to agree common terminology with security researchers. It’s high time that Apple fixed this and stopped confusing users.</p>
<h4>XProtect Remediator</h4>
<p>Detections and remediations by XProtect Remediator aren’t reported to the user in notifications, alerts, or any other overt means of informing them. Instead, they’re written in entries made in the Unified log, and made accessible to apps with access to the Endpoint Security framework. The latter only applies in macOS Ventura, though, which now supports <code>es_event_xp_malware_detected_t</code> and <code>es_event_xp_malware_remediated_t</code> events recording detection and remediation. For ordinary users relying on the utilities bundled in Ventura, this effectively conceals all malware detection and remediation, other than those reported in alerts as shown above.</p>
<p><span><img data-attachment-id="69587" data-permalink="https://eclecticlight.co/xprdet01/" data-orig-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg" data-orig-size="3024,235" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="xprdet01" data-image-description="" data-image-caption="" data-medium-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=300" data-large-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=940" src="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=940" alt="xprdet01" srcset="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=940 940w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=1880 1880w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=150 150w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=300 300w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=768 768w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet01.jpg?w=1024 1024w" sizes="(max-width: 940px) 100vw, 940px"/></span></p>
<p>Advanced users with experience of accessing the Unified log can retrieve log entries written by XProtect Remediator’s scanning modules, like those above reporting a successful remediation of DubRobber payload during testing.</p>
<p><span><img data-attachment-id="69588" data-permalink="https://eclecticlight.co/xprdet02/" data-orig-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg" data-orig-size="2973,265" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="xprdet02" data-image-description="" data-image-caption="" data-medium-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=300" data-large-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=940" src="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=940" alt="xprdet02" srcset="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=940 940w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=1880 1880w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=150 150w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=300 300w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=768 768w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet02.jpg?w=1024 1024w" sizes="(max-width: 940px) 100vw, 940px"/></span></p>
<p>They can also be accessed more readily using my free utility <a href="https://eclecticlight.co/consolation-t2m2-and-log-utilities/">XProCheck</a>. In the excerpt above, DubRobber payload is first detected then remediated, following which two potential detections of CloudMensis (SnowDrift) are reported, but no remediation of those was attempted. To put that more directly, XProtect Remediator discovered two rogue files which it suspects could be malware, but the user wasn’t notified of their presence, and is left none the wiser.</p>
<p>At present, with the exception of the command tool <code>eslogger</code>, macOS contains no app that can monitor Endpoint Security events for the user. Although several third-party security products do use Endpoint Security, few if any detail which events they monitor. As those reporting detections and remediations are only available in macOS Ventura, I have yet to discover any vendor whose products will report <code>es_event_xp_malware_detected_t</code> and <code>es_event_xp_malware_remediated_t</code> events.</p>
<p>Using <code>eslogger</code> isn’t simple either. That tool has to be left running to gather records of events into a text file, which the user has to monitor and maintain. Using the details I published <a href="https://eclecticlight.co/2022/12/29/checking-macos-malware-scans-endpoint-security-or-the-log/">here previously</a>, I gathered those two event types during my tests using malware samples. Each event generates a substantial quantity of JSON data which appears to be undocumented.</p>
<p><span><img data-attachment-id="69589" data-permalink="https://eclecticlight.co/xprdet03/" data-orig-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg" data-orig-size="1857,1069" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="xprdet03" data-image-description="" data-image-caption="" data-medium-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=300" data-large-file="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=940" src="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=940" alt="xprdet03" srcset="https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=940 940w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=150 150w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=300 300w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=768 768w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg?w=1024 1024w, https://eclecticlightdotcom.files.wordpress.com/2023/01/xprdet03.jpg 1857w" sizes="(max-width: 940px) 100vw, 940px"/></span></p>
<p>Above is the first half of the data for a single successful detection, in this case not by an XProtect Remediator scan, but by the regular XProtect service.</p>
<h4>Summary</h4>
<p>Currently:</p>
<ul>
<li>Apple uses two different and obscure naming systems for malware, neither of which matches that used by everyone else. These make it harder for users to understand detection alerts.</li>
<li>In macOS Catalina to Monterey, XProtect Remediator detection and remediation reports are only written in the Unified log, and are therefore inaccessible to the great majority of users.</li>
<li>In Ventura, detection and remediation reports are also available to Endpoint Security clients. The only client bundled with macOS is a command tool which must be left running at all times if it’s to get events and record them to a log. That isn’t a practical solution for users.</li>
<li>Although some third-party security products are capable of recording detection and remediation events, it’s not clear which if any do, or whether they alert the user. Most of those products also require significant subscriptions.</li>
<li>As a result, the great majority of users are oblivious of the detection and remediation of malware on their Macs, which occurs in complete secrecy. The answer to my question in the title of this article is therefore that you don’t know.</li>
</ul>
	</div><!-- .entry-content -->

	
	<!-- .entry-footer -->

</article></div>
  </body>
</html>
