<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/PiLiDAR/PiLiDAR">Original</a>
    <h1>Raspberry Pi Lidar Scanner</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">


<ul dir="auto">
<li>
<p dir="auto"><strong>LiDAR</strong>: custom serial driver for LDRobot <strong>LD06</strong>, <strong>LD19</strong> or <strong>STL27L</strong></p>
<ul dir="auto">
<li>CRC package integrity check</li>
<li><a href="https://github.com/Pioreactor/rpi_hardware_pwm">Hardware PWM</a> calibrated using curve fitting</li>
<li>2D live visualization and export (numpy or CSV)</li>
</ul>
</li>
<li>
<p dir="auto"><strong>Panorama</strong>: 6K 360° spherical map</p>
<ul dir="auto">
<li>stitched from fisheye photos using <a href="https://hugin.sourceforge.io/" rel="nofollow"><strong>Hugin</strong> Panorama photo stitcher</a></li>
<li>constant camera exposure by reading EXIF data of automatic</li>
<li>constant white balance by iterative optimization of color gains</li>
</ul>
</li>
<li>
<p dir="auto"><strong>3D Scene</strong>: assembly of 3D scenes from 2D planes based on angle and offsets</p>
<ul dir="auto">
<li>sampling <strong>vertex colors from panorama</strong></li>
<li>Open3D visualization and export (PCD, PLY or <a href="https://github.com/davidcaron/pye57">e57</a>)</li>
<li>aligning multiple scenes using <strong>global registration</strong> and <strong>ICP fine-tuning</strong></li>
<li><strong>Poisson Surface Meshing</strong> (very slow on Pi4, recommended to run on PC)</li>
</ul>
</li>
</ul>

<p dir="auto">single scans, no registration, no post processing.</p>
<p dir="auto"><a href="https://sketchfab.com/models/7997b63a3cb747f99b8f161862318bec/embed?autostart=1&amp;ui_animations=0&amp;ui_stop=0&amp;ui_inspector=0&amp;ui_watermark_link=0&amp;ui_watermark=0&amp;ui_ar=0&amp;ui_help=0&amp;ui_settings=0&amp;ui_vr=0&amp;ui_fullscreen=0&amp;ui_annotations=0" rel="nofollow"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/exterior.jpeg" alt="Exterior"/></a></p>
<p dir="auto"><em>Exterior Scan (colormapped Intensity)</em></p>
<p dir="auto"><a href="https://sketchfab.com/models/0311c098c57b458abe3a5d3dda9fe92b/embed?autospin=0&amp;autostart=1&amp;ui_animations=0&amp;ui_inspector=0&amp;ui_watermark_link=0&amp;ui_watermark=0&amp;ui_ar=0&amp;ui_help=0&amp;ui_settings=0&amp;ui_vr=0&amp;ui_fullscreen=0&amp;ui_annotations=0" rel="nofollow"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/interior.jpeg" alt="Interior"/></a></p>
<p dir="auto"><em>Interior Scan (Vertex Colors)</em></p>

<ul dir="auto">
<li>
<p dir="auto">LDRobot LD06, LD19 or STL27L LiDAR</p>
</li>
<li>
<p dir="auto">Raspberry Pi HQ Camera with ArduCam M12 Lens <a href="https://www.arducam.com/doc/Arducam_M12_Lens_Kit_for_Pi_HQ_Camera.pdf" rel="nofollow">(M25156H18, p.7)</a></p>
</li>
<li>
<p dir="auto">Raspberry Pi 4</p>
</li>
<li>
<p dir="auto">NEMA17 42-23 stepper with A4988 driver</p>
</li>
<li>
<p dir="auto">Power Supply:</p>
<ul dir="auto">
<li>v1: 2x <em>18650</em> Batteries (7.2V) with step-down converter</li>
<li>v2: 10.000 mAh USB Powerbank with step-up converter</li>
</ul>
</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/PiLiDAR/PiLiDAR/blob/main/images/pilidar_covershot.jpg"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/pilidar_covershot.jpg" alt="PiLiDAR v1"/></a>
<em>Rev. 1 using 2x 18650 Batteries and Buck Converter</em></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/PiLiDAR/PiLiDAR/blob/main/images/pilidar_covershot_v2.jpg"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/pilidar_covershot_v2.jpg" alt="PiLiDAR v2"/></a>
<em>Rev. 2 using 10.000 mAh Powerbank and Boost Converter</em></p>
<div dir="auto"><h3 tabindex="-1" dir="auto">stepper driver, motor and gearbox</h3><a id="user-content-stepper-driver-motor-and-gearbox" aria-label="Permalink: stepper driver, motor and gearbox" href="#stepper-driver-motor-and-gearbox"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>A4988 bipolar stepper driver (<a href="https://www.youtube.com/watch?v=PMS5jY7RTjo" rel="nofollow">tutorial</a>)</li>
<li>NEMA17 42x42x23 bipolar stepper (<a href="https://www.omc-stepperonline.com/e-series-nema-17-bipolar-1-8deg-17ncm-24-07oz-in-1a-42x42x23mm-4-wires-17he08-1004s" rel="nofollow">17HE08-1004S</a>, 17 Ncm torque)</li>
<li>3D-printed planetary reduction gearbox (see <a href="#fdm--3d-printing">FDM / 3D printing</a>)</li>
</ul>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/PiLiDAR/PiLiDAR/blob/main/images/lidar_comparison.jpg"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/lidar_comparison.jpg" alt="LD06 vs. STL27L"/></a>
<em>angular resolution of LD06 (left) vs. STL27L (right)</em></p>
<p dir="auto">LD06:</p>
<ul dir="auto">
<li>sampling frequency: 4500 Hz</li>
<li>baudrate 230400</li>
<li><a href="https://www.inno-maker.com/product/lidar-ld06/" rel="nofollow">Sales page</a></li>
<li><a href="https://www.inno-maker.com/wp-content/uploads/2020/11/LDROBOT_LD06_Datasheet.pdf" rel="nofollow">mechanical Datasheet</a></li>
<li><a href="https://storage.googleapis.com/mauser-public-images/prod_description_document/2021/315/8fcea7f5d479f4f4b71316d80b77ff45_096-6212_a.pdf" rel="nofollow">Protocol Description</a></li>
</ul>
<p dir="auto">STL27L:</p>
<ul dir="auto">
<li>sampling frequency: 21600 Hz</li>
<li>baudrate 921600</li>
<li><a href="https://github.com/May-DFRobot/DFRobot/blob/master/SEN0589_Datasheet.pdf">datasheet</a></li>
<li><a href="https://www.waveshare.com/wiki/DTOF_LIDAR_STL27L" rel="nofollow">wiki</a></li>
<li>ROS2 driver <a href="https://github.com/ldrobotSensorTeam/ldlidar_stl_ros2?tab=readme-ov-file#Instructions">git</a></li>
</ul>
<p dir="auto">Scan duration:
12s initialisation
17s shooting 4x photos
1:24m scanning 0.167° x 0.18°
37s stitching, cleanup</p>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/PiLiDAR/PiLiDAR/blob/main/images/pilidar_breadboard.jpg"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/pilidar_breadboard.jpg" alt="breadboard version 2"/></a>
<em>Breadboard Rev. 2</em></p>

<ul dir="auto">
<li>UART Tx (yellow)</li>
<li>PWM (white)</li>
<li>GND (black)</li>
<li>VCC 5V (red)</li>
</ul>

<ul dir="auto">
<li>LD06 UART0 Rx: GP15</li>
<li>LD06 PWM0: GP18</li>
<li>Power Button: GP03</li>
<li>Scan Button: GP17</li>
<li>A4988 direction: GP26, step: GP19</li>
<li>A4988 microstepping mode: GP5, GP6, GP13</li>
</ul>

<div dir="auto"><h3 tabindex="-1" dir="auto">Power Button (Wakeup &amp; Shutdown)</h3><a id="user-content-power-button-wakeup--shutdown" aria-label="Permalink: Power Button (Wakeup &amp; Shutdown)" href="#power-button-wakeup--shutdown"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>
<p dir="auto">Wakeup is hardwired to Pin 3</p>
</li>
<li>
<p dir="auto">enable gpio-shutdown</p>
<div data-snippet-clipboard-copy-content="  echo &#34;dtoverlay=gpio-shutdown&#34; &gt;&gt; /boot/firmware/config.txt "><pre><code>  echo &#34;dtoverlay=gpio-shutdown&#34; &gt;&gt; /boot/firmware/config.txt 
</code></pre></div>
</li>
<li>
<p dir="auto">if necesessary:</p>
<div data-snippet-clipboard-copy-content="  sudo nano /etc/systemd/logind.conf
  HandlePowerKey=poweroff"><pre><code>  sudo nano /etc/systemd/logind.conf
  HandlePowerKey=poweroff
</code></pre></div>
</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">enable i2c-GPIO for GY-521 Accelerometer</h3><a id="user-content-enable-i2c-gpio-for-gy-521-accelerometer" aria-label="Permalink: enable i2c-GPIO for GY-521 Accelerometer" href="#enable-i2c-gpio-for-gy-521-accelerometer"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">GY-521 (MPU 6060): Accelerometer, Gyroscope and thermometer</p>
<p dir="auto">Since GPIO3 is hardwired to the Power Button, we need to use i2c-GPIO to map custom i2c pins (<a href="https://www.instructables.com/Raspberry-PI-Multiple-I2c-Devices/" rel="nofollow">tutorial</a>). Unlike serial is not getting crossed, so we connect SDA-SDA and SCL-SCL.</p>
<p dir="auto">disable ic2_arm and enable i2c-gpio in /boot/firmware/config.txt</p>
<div data-snippet-clipboard-copy-content="dtparam=i2c_arm=off
dtoverlay=i2c-gpio,bus=3,i2c_gpio_delay_us=1,i2c_gpio_sda=22,i2c_gpio_scl=27"><pre><code>dtparam=i2c_arm=off
dtoverlay=i2c-gpio,bus=3,i2c_gpio_delay_us=1,i2c_gpio_sda=22,i2c_gpio_scl=27
</code></pre></div>
<p dir="auto">search for devices on i2c bus 3:</p>


<div data-snippet-clipboard-copy-content="# CPU fan at lower temp
echo &#34;dtoverlay=gpio-fan,gpiopin=4,temp=45000&#34; &gt;&gt; /boot/firmware/config.txt


# Power LED Heartbeat:
echo &#34;dtparam=pwr_led_trigger=timer&#34; &gt;&gt; /boot/firmware/config.txt"><pre><code># CPU fan at lower temp
echo &#34;dtoverlay=gpio-fan,gpiopin=4,temp=45000&#34; &gt;&gt; /boot/firmware/config.txt


# Power LED Heartbeat:
echo &#34;dtparam=pwr_led_trigger=timer&#34; &gt;&gt; /boot/firmware/config.txt
</code></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Scan Button: register GPIO interrupt</h3><a id="user-content-scan-button-register-gpio-interrupt" aria-label="Permalink: Scan Button: register GPIO interrupt" href="#scan-button-register-gpio-interrupt"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">make script executable:</p>
<div data-snippet-clipboard-copy-content="chmod +x gpio_interrupt.py"><pre><code>chmod +x gpio_interrupt.py
</code></pre></div>
<p dir="auto">create new service for autostart</p>
<div data-snippet-clipboard-copy-content="sudo nano /etc/systemd/system/pilidar.service"><pre><code>sudo nano /etc/systemd/system/pilidar.service
</code></pre></div>
<p dir="auto">content:</p>
<div data-snippet-clipboard-copy-content="[Unit]
Description=PiLiDAR-Button
After=network.target

[Service]
Type=simple
User=pi
Environment=LG_WD=/tmp
ExecStart=/usr/bin/python3 /home/pi/PiLiDAR/gpio_interrupt.py
Restart=no

[Install]
WantedBy=multi-user.target"><pre><code>[Unit]
Description=PiLiDAR-Button
After=network.target

[Service]
Type=simple
User=pi
Environment=LG_WD=/tmp
ExecStart=/usr/bin/python3 /home/pi/PiLiDAR/gpio_interrupt.py
Restart=no

[Install]
WantedBy=multi-user.target
</code></pre></div>
<p dir="auto">reload daemon, enable and start service:</p>
<div data-snippet-clipboard-copy-content="sudo systemctl daemon-reload
sudo systemctl enable pilidar.service
sudo systemctl start pilidar.service"><pre><code>sudo systemctl daemon-reload
sudo systemctl enable pilidar.service
sudo systemctl start pilidar.service
</code></pre></div>
<p dir="auto">check service if necessary:</p>
<div data-snippet-clipboard-copy-content="sudo systemctl status pilidar.service"><pre><code>sudo systemctl status pilidar.service
</code></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">set Permission for UART on Raspberry Pi</h3><a id="user-content-set-permission-for-uart-on-raspberry-pi" aria-label="Permalink: set Permission for UART on Raspberry Pi" href="#set-permission-for-uart-on-raspberry-pi"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">temporary solution:</p>
<div data-snippet-clipboard-copy-content="sudo chmod a+rw /dev/ttyS0"><pre><code>sudo chmod a+rw /dev/ttyS0
</code></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto">old solution: make it permanent by disabling password for chmod:</h4><a id="user-content-old-solution-make-it-permanent-by-disabling-password-for-chmod" aria-label="Permalink: old solution: make it permanent by disabling password for chmod:" href="#old-solution-make-it-permanent-by-disabling-password-for-chmod"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div data-snippet-clipboard-copy-content="sudo visudo
pi ALL=(ALL:ALL) NOPASSWD: /usr/bin/chmod a+rw /dev/ttyS0"><pre><code>sudo visudo
pi ALL=(ALL:ALL) NOPASSWD: /usr/bin/chmod a+rw /dev/ttyS0
</code></pre></div>
<p dir="auto">then execute the <em>temporary</em> solution from python:</p>
<div data-snippet-clipboard-copy-content="import subprocess
command = &#34;sudo chmod a+rw /dev/ttyS0&#34;
process = subprocess.Popen(command.split(), stdout=subprocess.PIPE)
output, error = process.communicate()"><pre><code>import subprocess
command = &#34;sudo chmod a+rw /dev/ttyS0&#34;
process = subprocess.Popen(command.split(), stdout=subprocess.PIPE)
output, error = process.communicate()
</code></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto">new solution: grant permissions to the serial port using udev rules</h4><a id="user-content-new-solution-grant-permissions-to-the-serial-port-using-udev-rules" aria-label="Permalink: new solution: grant permissions to the serial port using udev rules" href="#new-solution-grant-permissions-to-the-serial-port-using-udev-rules"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">(TODO: check and remove old!)</p>
<ul dir="auto">
<li>forget about <code>visudo</code> and the subprocess call above.</li>
<li>Open a terminal and run the following command: <code>sudo nano /etc/udev/rules.d/50-ttyS0.rules</code></li>
<li>Write the following line in the file and save it: <code>KERNEL==&#34;ttyS0&#34;,GROUP=&#34;dialout&#34;,MODE=&#34;0660&#34;</code></li>
<li>Run the following command to check if your user is a member of the dialout group: <code>groups</code></li>
<li>If you see <code>dialout</code> in the output, you are already a member of the group. If not, run the following command to add your user to the group: <code>sudo usermod -a -G dialout pi</code></li>
<li>Run the following command to reload the udev rules: <code>sudo udevadm control --reload-rules</code></li>
<li>Unplug and replug the serial device, or reboot the system, to apply the changes.</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">Hardware PWM on Raspberry Pi</h3><a id="user-content-hardware-pwm-on-raspberry-pi" aria-label="Permalink: Hardware PWM on Raspberry Pi" href="#hardware-pwm-on-raspberry-pi"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">enable GPIO_18 (PWM0) and GPIO_19 (PWM1)</p>
<div data-snippet-clipboard-copy-content="echo &#34;dtoverlay=pwm-2chan&#34; &gt;&gt; /boot/firmware/config.txt "><pre><code>echo &#34;dtoverlay=pwm-2chan&#34; &gt;&gt; /boot/firmware/config.txt 
</code></pre></div>
<p dir="auto">check if &#34;pwm_bcm2835&#34; now exists:</p>

<p dir="auto">Install <a href="https://github.com/Pioreactor/rpi_hardware_pwm">RPi Hardware PWM library</a>:</p>
<div data-snippet-clipboard-copy-content="pip install rpi-hardware-pwm"><pre><code>pip install rpi-hardware-pwm
</code></pre></div>

<p dir="auto">install Hugin with enblend plugin</p>
<div data-snippet-clipboard-copy-content="sudo apt-get install hugin-tools enblend"><pre><code>sudo apt-get install hugin-tools enblend
</code></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">power switching the USB port</h3><a id="user-content-power-switching-the-usb-port" aria-label="Permalink: power switching the USB port" href="#power-switching-the-usb-port"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">using <a href="https://www.baeldung.com/linux/control-usb-power-supply" rel="nofollow">uhubctl</a> cli tool. install:</p>
<div data-snippet-clipboard-copy-content="sudo apt-get install uhubctl"><pre><code>sudo apt-get install uhubctl
</code></pre></div>
<p dir="auto">list all available hubs and devices</p>

<p dir="auto">powering Raspberry Pi&#39;s USB-3-Ports (Hub 2) off / on</p>
<div data-snippet-clipboard-copy-content="sudo uhubctl -l 2 -a off
sudo uhubctl -l 2 -a on"><pre><code>sudo uhubctl -l 2 -a off
sudo uhubctl -l 2 -a on
</code></pre></div>

<p dir="auto">start jupyter for network access:</p>
<div data-snippet-clipboard-copy-content="jupyter notebook --ip 192.168.1.16 --no-browser PiLiDAR.ipynb"><pre><code>jupyter notebook --ip 192.168.1.16 --no-browser PiLiDAR.ipynb
</code></pre></div>


<ul dir="auto">
<li>
<p dir="auto">Housing and additional parts (obj and 3mf)  in <a href="https://ntietz.com/PiLiDAR/PiLiDAR/blob/main/mechanical_design/v2/export">mechanical_design/v2/export</a>.</p>
</li>
<li>
<p dir="auto">M12 to C-Mount lens adapter (<a href="https://www.thingiverse.com/thing:4444398" rel="nofollow">thingiverse.com</a>)</p>
</li>
<li>
<p dir="auto">NEMA17 planetary reduction gearbox (<a href="https://www.printables.com/de/model/782336-nema17-planetary-gearbox-fixed" rel="nofollow">printables.com</a>)</p>
</li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/PiLiDAR/PiLiDAR/blob/main/images/CAD_v2.jpg"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/CAD_v2.jpg" alt="CAD model"/></a>
<em>Housing CAD model Rev. 2</em></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/PiLiDAR/PiLiDAR/blob/main/images/FDM.jpg"><img src="https://ntietz.com/PiLiDAR/PiLiDAR/raw/main/images/FDM.jpg" alt="3D printing"/></a>
<em>FDM printing the old front panel (Rev. 1) in PETG</em></p>


<p dir="auto">baudrate 230400, data bits 8, no parity, 1 stopbit</p>
<p dir="auto">total package size: 48 Byte, big endian.</p>
<ul dir="auto">
<li>starting character：Length 1 Byte, fixed value 0x54, means the beginning of data packet;</li>
<li>Data Length: Length 1 Byte, the first three digits reserved, the last five digits represent the number of measured points in a packet, currently fixed value 12;</li>
<li>speed：Length 2 Byte, in degrees per second;</li>
<li>Start angle: Length: 2 Byte; unit: 0.01 degree;</li>
<li>Data: Length 36 Byte; containing 12 data points with 3 Byte each: 2 Byte distance (unit: 1 mm), 1 Byte luminance. For white objects within 6m, the typical luminance is around 200.</li>
<li>End Angle: Length: 2 Byte; unit: 0.01 degree；</li>
<li>Timestamp: Length 2 Bytes in ms, recount if reaching to MAX 30000；</li>
<li>CRC check: Length 1 Byte</li>
</ul>
<p dir="auto">The Angle value of each data point is obtained by linear interpolation of the starting angle and the ending angle.</p>
<div data-snippet-clipboard-copy-content="step = (end_angle – start_angle)/(len – 1)  
angle = start_angle + step*i  "><pre><code>step = (end_angle – start_angle)/(len – 1)  
angle = start_angle + step*i  
</code></pre></div>
<p dir="auto">len is the length of the packet, and the i value range is [0, len].</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">remote Open3D Visualization</h2><a id="user-content-remote-open3d-visualization" aria-label="Permalink: remote Open3D Visualization" href="#remote-open3d-visualization"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">using <del><a href="https://www.open3d.org/docs/release/tutorial/visualization/web_visualizer.html" rel="nofollow"><em>Web Visualizer</em></a></del> <a href="https://plotly.com/python/" rel="nofollow">Plotly</a> to display 3D pointclouds works great in Jupyter.</p>
<p dir="auto">Plotly seems to render client-sided, unlike Open3D Web Visualizer which renders host-sided and streams jpg sequences, which strains the Pi&#39;s both CPU and WIFI.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Dumping Scans to USB Storage</h2><a id="user-content-dumping-scans-to-usb-storage" aria-label="Permalink: Dumping Scans to USB Storage" href="#dumping-scans-to-usb-storage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li>Clone the Repo and run the installer:
<div data-snippet-clipboard-copy-content="cd /home/pi/PiLiDAR
git clone https://github.com/LaserBorg/usb_dump --depth 1
cd usb_dump &amp;&amp; chmod +x install.sh &amp;&amp; ./install.sh &#34;$(pwd)&#34;"><pre><code>cd /home/pi/PiLiDAR
git clone https://github.com/LaserBorg/usb_dump --depth 1
cd usb_dump &amp;&amp; chmod +x install.sh &amp;&amp; ./install.sh &#34;$(pwd)&#34;
</code></pre></div>
</li>
<li>Create the config file:
<div data-snippet-clipboard-copy-content="echo &#39;{&#34;source_directories&#34;: [&#34;/home/pi/PiLiDAR/scans&#34;], &#34;target_root_directory&#34;: null}&#39; &gt; usbdump.json"><pre><code>echo &#39;{&#34;source_directories&#34;: [&#34;/home/pi/PiLiDAR/scans&#34;], &#34;target_root_directory&#34;: null}&#39; &gt; usbdump.json
</code></pre></div>
</li>
</ol>

<ul dir="auto">
<li>
<p dir="auto">Check the log file:</p>

</li>
<li>
<p dir="auto">to uninstall the service, run</p>
<div data-snippet-clipboard-copy-content="chmod +x uninstall.sh &amp;&amp; ./uninstall.sh"><pre><code>chmod +x uninstall.sh &amp;&amp; ./uninstall.sh
</code></pre></div>
</li>
<li>
<p dir="auto">if the mount point is still persistend after being removed, just delete them.</p>
<div data-snippet-clipboard-copy-content="sudo rm -rf /media/pi/&lt;your device name&gt;"><pre><code>sudo rm -rf /media/pi/&lt;your device name&gt;
</code></pre></div>
</li>
</ul>


<p dir="auto">get <a href="https://files.waveshare.com/upload/6/63/CP210x_Universal_Windows_Driver.zip" rel="nofollow">CP210x_Universal_Windows_Driver.zip</a> here:</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">RPi.GPIO RuntimeError: Failed to add edge detection</h3><a id="user-content-rpigpio-runtimeerror-failed-to-add-edge-detection" aria-label="Permalink: RPi.GPIO RuntimeError: Failed to add edge detection" href="#rpigpio-runtimeerror-failed-to-add-edge-detection"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">current bookworm version has deprecated sysfs GPIO interface removed.</p>
<div data-snippet-clipboard-copy-content="sudo apt remove python3-rpi.gpio
sudo apt update

sudo apt install python3-rpi-lgpio

# or in an env without system packages:
pip3 install rpi-lgpio"><pre><code>sudo apt remove python3-rpi.gpio
sudo apt update

sudo apt install python3-rpi-lgpio

# or in an env without system packages:
pip3 install rpi-lgpio
</code></pre></div>
<p dir="auto">LGPIO creates temp-files (<a href="https://github.com/joan2937/lg/issues/12" data-hovercard-type="issue" data-hovercard-url="/joan2937/lg/issues/12/hovercard">issue</a>) like &#34;.lgd-nfy0&#34;. gpio-interrupt.py executes &#39;export LG_WD=/tmp&#39; to set it&#39;s CWD.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">poor performance of VS Code on Raspberry Pi</h3><a id="user-content-poor-performance-of-vs-code-on-raspberry-pi" aria-label="Permalink: poor performance of VS Code on Raspberry Pi" href="#poor-performance-of-vs-code-on-raspberry-pi"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">disable hardware acceleration for VS Code (<a href="https://code.visualstudio.com/docs/setup/raspberry-pi" rel="nofollow">source</a>)</p>
<div data-snippet-clipboard-copy-content="Preferences: Configure Runtime Arguments  
Set &#34;disable-hardware-acceleration&#34;: true"><pre><code>Preferences: Configure Runtime Arguments  
Set &#34;disable-hardware-acceleration&#34;: true
</code></pre></div>

<p dir="auto">there is no wheel for arm64. build requires libxerces:</p>
<div data-snippet-clipboard-copy-content="sudo apt install libxerces-c-dev
pip install pye57"><pre><code>sudo apt install libxerces-c-dev
pip install pye57
</code></pre></div>

<p dir="auto"><a href="https://u-labs.de/portal/raspberry-pi-wlan-verbindung-nachtraeglich-einrichten-oder-aendern-so-geht-es-grafisch-konsole/" rel="nofollow">tutorial</a>:</p>
<div data-snippet-clipboard-copy-content="sudo nano /etc/wpa_supplicant/wpa_supplicant.conf

# make sure country code is set:
country=DE"><pre><code>sudo nano /etc/wpa_supplicant/wpa_supplicant.conf

# make sure country code is set:
country=DE
</code></pre></div>
<p dir="auto">add entry to wpa_supplicant.conf</p>
<div data-snippet-clipboard-copy-content="sudo wpa_passphrase &#34;YOUR_SSID&#34; &#34;YOUR_PASSWORD&#34; | sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf"><pre><code>sudo wpa_passphrase &#34;YOUR_SSID&#34; &#34;YOUR_PASSWORD&#34; | sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf
</code></pre></div>

<p dir="auto">inspirations</p>
<ul dir="auto">
<li><a href="https://github.com/henjin0/LIDAR_LD06_python_loder">LIDAR_LD06_python_loder</a> and <a href="https://github.com/henjin0/Lidar_LD06_for_Arduino">Lidar_LD06_for_Arduino</a> by Inoue Minoru (&#34;<a href="https://github.com/henjin0">henjin0</a>&#34;)</li>
<li><a href="https://github.com/ShaunPrice/360-camera">ShaunPrice&#39;s</a> StereoPi-supporting fork of <a href="https://github.com/BrianBock/360-camera">BrianBock&#39;s</a> 360-camera script (Article on <a href="https://medium.com/stereopi/stitching-360-panorama-with-raspberry-pi-cm3-stereopi-and-two-fisheye-cameras-step-by-step-guide-aeca3ff35871" rel="nofollow">Medium</a>)</li>
</ul>
<p dir="auto">another Lidar implementation in Python</p>
<ul dir="auto">
<li><a href="https://github.com/Paradoxdruid/pyLIDAR">pyLIDAR</a></li>
</ul>
<p dir="auto">hardware PWM using <a href="https://gpiozero.readthedocs.io/en/stable/migrating_from_rpigpio.html#pwm-pulse-width-modulation" rel="nofollow">GPIOZero</a></p>
<p dir="auto">ICP implementations:</p>
<ul dir="auto">
<li>Aeva <a href="https://github.com/aevainc/Doppler-ICP/blob/main/README.md">Doppler-ICP</a></li>
<li>Photogrammetry &amp; Robotics Bonn <a href="https://github.com/PRBonn/kiss-icp">KISS-ICP</a> and <a href="https://github.com/PRBonn/lidar-visualizer">Lidar-Visualizer</a></li>
</ul>
<p dir="auto">3D Demo Data for global registration, ICP, meshing etc.:</p>
<ul dir="auto">
<li><a href="https://github.com/isl-org/open3d_downloads/releases/download/20220201-data/BunnyMesh.ply">BunnyMesh.ply</a> from <a href="https://github.com/isl-org/open3d_downloads/releases/tag/20220201-data">20220201-data</a></li>
<li><a href="https://github.com/isl-org/open3d_downloads/releases/download/20220301-data/DemoICPPointClouds.zip">DemoICPPointClouds.zip</a> from <a href="https://github.com/isl-org/open3d_downloads/releases/tag/20220301-data">20220301-data</a></li>
</ul>
<p dir="auto">Using a MOSFET for switching: <a href="https://elinux.org/RPi_GPIO_Interface_Circuits#Using_a_FET" rel="nofollow">tutorial</a></p>
<p dir="auto">A4988 Enable, Sleep and Reset <a href="https://www.youtube.com/watch?v=PMS5jY7RTjo" rel="nofollow">tutorial</a></p>
</article></div></div>
  </body>
</html>
