<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://onestepcode.com/joi-js-custom-error-messages/?utm_source=rss&amp;utm_medium=rss&amp;utm_campaign=joi-js-custom-error-messages">Original</a>
    <h1>Adding custom error messages to Joi js validation</h1>
    
    <div id="readability-page-1" class="page"><div>
						
<p><a href="https://joi.dev/">Joi</a> is a powerful JavaScript validation library. You can use it to validate the input you receive to your API, among other uses. </p>



<p>While it comes pretty good error messages out of the box, let’s see some ways to customize them.</p>



<p>You can test any of the examples below using <a href="https://joi.dev/tester/">Joi’s playground</a>.</p>



<h2>Adding custom labels</h2>



<p>Let’s define a schema that accepts a <code>matrix</code> 2D array field.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Joi.object({
  matrix: Joi.array().items(Joi.array().items(Joi.number()))
})</pre>



<p>The following object wouldn’t pass validation because it has a string <code>a</code> among its elements.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">{ 
 matrix: [[0, 1, 2], [&#39;a&#39;, 1, 2]]
}</pre>



<p>By default, Joi returns the following error message:</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation Error: &#34;matrix[1][0]&#34; must be a number</pre>



<p>The error message includes the full path of the invalid value. The top-most key is <code>matrix</code>. Then, each array element is identified by its array index, starting from <code>0</code>.</p>



<p>We can override the default key with <code><a href="https://joi.dev/api/#anylabelname">label</a></code>:</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Joi.object({
  matrix: Joi.array().items(
    Joi.array().items(Joi.number().label(&#34;matrix value&#34;))
  ),
});</pre>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation Error: &#34;matrix value&#34; must be a number</pre>



<p>We can do the same for any key. Or even specify labels for each array element. </p>



<p>For example, let’s add a label for the elements passed to the <code>matrix</code> array.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Joi.object({
  matrix: Joi.array().items(
    Joi.array().items(Joi.number()).label(&#34;matrix row&#34;)
  ),
});</pre>



<p>Now, the error message will be::</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">{ 
 matrix: [[0, 1, 2], &#39;a&#39;],
}</pre>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation Error: &#34;matrix row&#34; must be an array</pre>



<h2>Return the key name instead of full path in error messages</h2>



<p>Let’s define the following deeply nested schema:</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">const schema = Joi.object({
  a: {
    b: {
      c: {
        d: {
          e: Joi.number(),
        },
      },
    },
  },
});</pre>



<p>Validating the following object, yields the error message:</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">const obj = {
  a: {
    b: {
      c: {
        d: {
          e: &#34;a&#34;,
        },
      },
    },
  },
};</pre>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation Error: &#34;a.b.c.d.e&#34; must be a number</pre>



<p>See the faulty field is identified with its full path in the object. </p>



<p>We can tweak this behavior by setting the <code>errors.label</code> <a href="https://joi.dev/api/#anyvalidatevalue-options">option</a> to <code>key</code>. The default value is <code>path</code>.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">schema.validate(obj, {errors: {label: &#39;key&#39;}})</pre>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation error: &#34;e&#34; must be a number</pre>



<p>Additionally, we can delete the quotes that wrap the label with the <code>errors.wrap</code> option:</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">schema.validate(obj, {errors: {label: &#39;key&#39;, wrap: {label: false}}})</pre>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation error: e must be a number</pre>



<p>See more information about the <code>wrap</code> and <code>label</code> options in the <code><a href="https://joi.dev/api/#anyvalidatevalue-options">any.validate</a></code> documentation</p>



<h2>Add custom error messages to Joi validation</h2>



<p>To pass custom error messages, we first need to identify the associated error type. For example, a numerical field being less than the specified <a href="https://joi.dev/api/?v=17.6.0#numberminlimit">minimum value</a> is associated to a <code><a href="https://joi.dev/api/?v=17.6.0#numbermin">number.min</a></code> error type.</p>



<p>Once we have identified the error type, we can ask Joi to override the predefined error message with the <code><a href="https://joi.dev/api/?v=17.6.0#anymessagesmessages">messages</a></code> method.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Joi.object({
  age: Joi.number()
    .integer()
    .min(18)
    .messages({ &#34;number.min&#34;: &#34;You must be at least 18 years old&#34; }),
});</pre>



<p>See the <code>messages</code> method accepts an object where each key corresponds to the error type and the value is the desired error message. </p>



<p>With this configuration, the following object will return the error message:</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">{ 
 age: 1,
}</pre>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation Error: You must be at least 18 years old</pre>



<p>You can find the full list of error types in <a href="https://joi.dev/api/?v=17.6.0#list-of-errors">Joi’s documentation</a>.</p>



<h2>Referencing the values of other fields in error messages</h2>



<p>Let’s include the actual field values in the error message. We can do so with Joi’s <a href="https://joi.dev/api/?v=17.6.0#template-syntax">templating syntax</a>.</p>



<p>Let’s create a schema that requires both a <code>name</code> and <code>age</code> fields. </p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Joi.object({
  name: Joi.string().required(),
  age: Joi.number()
    .required()
    .messages({ &#34;any.required&#34;: &#34;You must tells us your age, {name}&#34; }),
});</pre>



<p>If we don’t set the <code>age</code>, Joi will return an error message with the value passed to the <code>name</code> field. See that the field names was wrapped inside <code>{}</code>.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">{ 
 name: &#34;John&#34;,
}</pre>



<pre data-enlighter-language="generic" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation Error: You must tells us your age, John</pre>



<p>You can find more about template syntax in <a href="https://joi.dev/api/?v=17.6.0#template-syntax">Joi’s documentation</a>.</p>



<h2>Referencing fields in deeply nested objects</h2>



<p>Let’s modify the schema above by nesting <code>age</code> inside a <code>data</code> field.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Joi.object({
  name: Joi.string().required(),
  data: {
    age: Joi.number()
      .required()
      .messages({ &#34;any.required&#34;: &#34;You must tells us your age, {name}&#34; }),
  },
});</pre>



<p>Now, let’s pass the following object to validate:</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">{
  name: &#34;John&#34;,
  data: {},
}</pre>



<p>We’ll receive a custom error message, but Joi didn’t catch the  <code>name</code> this time.</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Validation Error: You must tells us your age, </pre>



<p>By default, the key will recognize only siblings of the validated field. In our case, those are all the properties of the <code>data</code> field. To be more specific we have to use <a href="https://joi.dev/api/?v=17.6.0#refkey-options">Joi references</a>.</p>



<p>A simple solution in our case is to reference the parent of <code>name</code> with <a href="https://joi.dev/api/?v=17.6.0#relative-references">relative references:</a></p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">Joi.object({
  name: Joi.string().required(),
  data: {
    age: Joi.number()
      .required()
      .messages({ &#34;any.required&#34;: &#34;You must tells us your age, {...name}&#34; }),
  },
});</pre>



<p>See that we’re prepending the field name with three dots: <code>...name</code>.</p>



<p>This is s similar to the rules of path resolution in the command line. <code>..</code> references the parent field (default behavior), and <code>.</code> references the current field. We can go higher up the hierarchy by prepending additional dots.</p>
					</div></div>
  </body>
</html>
