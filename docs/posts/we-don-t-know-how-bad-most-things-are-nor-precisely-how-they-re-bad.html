<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.lesswrong.com/posts/PJu2HhKsyTEJMxS9a/you-don-t-know-how-bad-most-things-are-nor-precisely-how">Original</a>
    <h1>We don&#39;t know how bad most things are nor precisely how they&#39;re bad</h1>
    
    <div id="readability-page-1" class="page"><div>
          <div>
            <div>
              <p>I’ve been using the flashcard program Anki religiously to study programming concepts. It’s been even less exciting than it sounds because I haven’t had syntax highlighting; all my code has looked like this:</p>
<p><img src="https://lippingoff.netlify.app/post/anki-syntax-highlighting/leetcode_hard.png" alt="leetcode hard png"/></p>
<p>After a few fits and starts, I figured out a way to highlight code blocks that doesn’t rely on Anki’s add-on system, which isn’t supported by its mobile apps. This post is more synthesis than genesis - I found a lot of useful information online, but nothing that put everything together. Here’s my attempt to do so.</p>
<h2 id="the-easiest-way-to-get-started">The easiest way to get started</h2>
<p>If you are just looking to get <code>highlight.js</code> working with an Anki collection; I have a treat for you. <a href="https://lippingoff.netlify.app/post/anki-syntax-highlighting/highlight-js-bundle.colpkg">Here’s</a> a massive 151KB Anki export (half the size of one of the images in this post) containing a single card…and all the files you need to highlight your code. To change your theme, open the card template editor (for example, from studying a card -&gt; <code>Edit</code> -&gt; <code>Cards...</code>, click <code>Back Template</code>, and modify <code>&lt;link rel=&#34;stylesheet&#34; href=&#34;_nord.css&#34;&gt;</code> to refer to the name of another highlight.js stylesheet (see <a href="https://highlightjs.org/demo">the demo</a> for inspiration).</p>
<p>If you want to learn more about how this works, read on.</p>
<h2 id="configuring-anki-to-use-highlightjs-the-hard-way">Configuring Anki to use <code>highlight.js</code>: The hard way</h2>
<ul>
<li>Download <a href="https://highlightjs.org/">highlight.js</a>. You’ll likely only need <code>highlight.min.js</code> and the themes you want to use (as a tall, pale dude from the Midwest, I’m all-in on <code>nord.css</code>). See the documentation to verify your target language is supported.</li>
<li>You’ll need to add <code>highlight.min.js</code> and your css file to your Anki installation’s <code>collection.media</code> directory. On Mac, this is located at <code>~/Library/Application Support/Anki2/User 1/collection.media</code>. <code>User 1</code> here is my Anki username and the default username in Anki; this will change if you have updated your username in Anki. By default, Anki will consider these files unused media if a user uses <code>Tools &gt; Check Media</code>, and it will therefore suggest we remove them. We can prevent this by prefixing the files with an underscore. I suggest renaming them to <code>_highlight.min.js</code> and <code>_nord.css</code> (or the like).</li>
<li>Create a new file in the <code>collection.media</code> named something like <code>_my_highlight.js</code>. This file should include the following:</li>
</ul>
<div><pre tabindex="0"><code data-lang="js"><span><span><span>document</span><span>.</span>querySelectorAll<span>(</span><span>&#39;pre code&#39;</span><span>).</span>forEach<span>((</span>block<span>)</span> <span>=&gt;</span> <span>{</span>
</span></span><span><span>    <span>// Replace HTML &lt;br&gt; with newline characters
</span></span></span><span><span><span></span>    <span>// https://stackoverflow.com/a/37815205/4738478
</span></span></span><span><span><span></span>    block<span>.</span>innerHTML <span>=</span> block<span>.</span>innerHTML<span>.</span>replace<span>(</span><span>/&lt;br\s*\/?&gt;/gi</span><span>,</span><span>&#39;\n&#39;</span><span>);</span>
</span></span><span><span>    <span>// Use highlight.js
</span></span></span><span><span><span></span>    hljs<span>.</span>highlightElement<span>(</span>block<span>);</span>
</span></span><span><span><span>});</span>
</span></span></code></pre></div><ul>
<li>Open the Anki card template where you want to enable syntax highlighting (I get there with <code>Browse -&gt; Cards</code>. Edit the card to include the following:</li>
</ul>
<pre tabindex="0"><code>&lt;link rel=&#34;stylesheet&#34; href=&#34;_nord.css&#34;&gt;
&lt;script&gt;
    if (typeof hljs === &#34;undefined&#34;) {
        var script = document.createElement(&#39;script&#39;);
        script.src = &#34;_highlight.min.js&#34;;
        script.async = false;
        document.head.appendChild(script);
    }

    var script = document.createElement(&#39;script&#39;);
    script.src = &#39;_my_highlight.js&#39;;
    script.async = false;
    document.head.appendChild(script);
    document.head.removeChild(script);
&lt;/script&gt;

&lt;pre&gt;
&lt;code&gt;
{{MyCodeField}}
&lt;/code&gt;
&lt;/pre&gt;
</code></pre><p>Where <code>{{MyCodeField}}</code> is the name of the code field on your card. (Mine is <code>{{Solution}}</code>). Why does this work? I’m still figuring that out.</p>
<p>You should now see your rendered code in your card preview.</p>
<p><img src="https://lippingoff.netlify.app/post/anki-syntax-highlighting/leetcode_medium.png" alt="leetcode_medium dot png"/></p>
<ul>
<li>Close your Anki app to sync your changes.</li>
</ul>
<p>Congrats, that’s it! This gives you:</p>
<ul>
<li>Syntax highlighting in whatever theme you want</li>
<li>Automatic language discovery through <code>highlight.js</code>. (Languages can be set manually with <code>class=&#34;code-python&#34;&gt;</code> if you prefer)</li>
<li>Mac, web, and iOS support, at least (if any Android Anki-ers (Ankis? Ank-ers?) read this, I’d love to see if it works for you, too)</li>
<li>Offline availability. You have to love some local JavaScript and CSS.</li>
<li>Your data preserved. You don’t have to modify your card data to use this highlighting (unlike some add-ons). Remove this code, and your card is just as it was before.</li>
</ul>
<h2 id="useful-links">Useful links</h2>
<ul>
<li><a href="https://www.reddit.com/r/Anki/comments/bk82ov/comment/emf8q6c/">Loading highlight JS with Anki</a> Note: This comment is almost everything I needed, but I had to replace the <code>&lt;br&gt;</code> tags in my code with newlines and you may have to, too.</li>
<li><a href="https://forums.ankiweb.net/t/how-to-include-external-files-in-your-template-js-css-etc-guide">Loading external JS with Anki</a></li>
<li><a href="https://ankiweb.net/shared/info/1415523481">Anki add-ons not supported on mobile</a></li>
<li><a href="https://addon-docs.ankiweb.net/console-output.html#console-output">Running the Anki QT app with logs</a></li>
<li><a href="https://forums.ankiweb.net/t/this-piece-of-javascript-does-not-seem-to-work-hint-button/9627/4">Anki + the DOM</a></li>
</ul>

            </div>
        </div>
      </div></div>
  </body>
</html>
