<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.microsoft.com/en-us/research/blog/phi-2-the-surprising-power-of-small-language-models/">Original</a>
    <h1>Phi-2: The surprising power of small language models</h1>
    
    <div id="readability-page-1" class="page"><div>
					
<!--/#single-header-->

					<div itemprop="articleBody" data-bi-an="post-body">

						
<h3 id="contributors">Contributors</h3>



<p><a href="https://www.microsoft.com/en-us/research/people/maabdin/">Marah Abdin</a>, <a href="https://www.microsoft.com/en-us/research/people/jyotianeja/">Jyoti Aneja</a>, <a href="https://www.microsoft.com/en-us/research/people/sebubeck/">Sebastien Bubeck</a>, Caio César Teodoro Mendes, <a href="https://www.microsoft.com/en-us/research/people/wzchen/">Weizhu Chen</a>, Allie Del Giorno, <a href="https://www.microsoft.com/en-us/research/people/roneneldan/">Ronen Eldan</a>, <a href="https://www.microsoft.com/en-us/research/people/sigopi/">Sivakanth Gopi</a>, <a href="https://www.microsoft.com/en-us/research/people/suriyag/">Suriya Gunasekar</a>, <a href="https://www.microsoft.com/en-us/research/people/mojavaheripi/">Mojan Javaheripi</a>, <a href="https://www.microsoft.com/en-us/research/people/pkauffmann/">Piero Kauffmann</a>, <a href="https://www.microsoft.com/en-us/research/people/yintatlee/">Yin Tat Lee</a>, Yuanzhi Li, <a href="https://www.microsoft.com/en-us/research/people/anhnguyen/">Anh Nguyen</a>, <a href="https://www.microsoft.com/en-us/research/people/gderosa/">Gustavo de Rosa</a>, <a href="https://www.microsoft.com/en-us/research/people/olsaarik/">Olli Saarikivi</a>, <a href="https://www.microsoft.com/en-us/research/people/adilsalim/">Adil Salim</a>, <a href="https://www.microsoft.com/en-us/research/people/shitals/">Shital Shah</a>, Michael Santacroce, Harkirat Singh Behl, <a href="https://www.microsoft.com/en-us/research/blog/tag/adam-kalai/">Adam Taumann Kalai</a>, <a href="https://www.microsoft.com/en-us/research/people/wanxin/">Xin Wang</a>, <a href="https://www.microsoft.com/en-us/research/people/rachelward/">Rachel Ward</a>, <a href="https://www.microsoft.com/en-us/research/people/pwitte/">Philipp Witte</a>, <a href="https://www.microsoft.com/en-us/research/people/cyrilzhang/">Cyril Zhang</a>, Yi Zhang</p>



<figure><img fetchpriority="high" decoding="async" width="1400" height="788" src="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1.jpg" alt="Satya Nadella on stage at Microsoft Ignite 2023 announcing Phi-2." srcset="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1.jpg 1400w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-300x169.jpg 300w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-1024x576.jpg 1024w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-768x432.jpg 768w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-1066x600.jpg 1066w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-655x368.jpg 655w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-343x193.jpg 343w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-240x135.jpg 240w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-640x360.jpg 640w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-960x540.jpg 960w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Phi2-BlogHeroFeature-1400x788-1-1280x720.jpg 1280w" sizes="(max-width: 1400px) 100vw, 1400px"/><figcaption><strong>Figure 1. </strong>Satya Nadella announcing Phi-2 at Microsoft Ignite 2023.</figcaption></figure>



<p>Over the past few months, our Machine Learning Foundations team at Microsoft Research has released a suite of small language models (SLMs) called “Phi” that achieve remarkable performance on a variety of benchmarks. Our first model, the 1.3 billion parameter <a href="https://huggingface.co/microsoft/phi-1" target="_blank" rel="noreferrer noopener"><strong>Phi-1</strong><span> (opens in new tab)</span></a>, achieved state-of-the-art performance on Python coding among existing SLMs (specifically on the HumanEval and MBPP benchmarks). We then extended our focus to common sense reasoning and language understanding and created a new 1.3 billion parameter model named <a href="https://huggingface.co/microsoft/phi-1_5" target="_blank" rel="noreferrer noopener"><strong>Phi-1.5</strong><span> (opens in new tab)</span></a>, with performance comparable to models 5x larger.</p>



<p>We are now releasing <a href="https://ml.azure.com/registries/azureml-msr/models/microsoft-phi-2/version/3?tid=72f988bf-86f1-41af-91ab-2d7cd011db47#overview" target="_blank" rel="noreferrer noopener"><strong>Phi-2</strong><span> (opens in new tab)</span></a>, a 2.7 billion-parameter language model that demonstrates outstanding reasoning and language understanding capabilities, showcasing state-of-the-art performance among base language models with less than 13 billion parameters. On complex benchmarks Phi-2 matches or outperforms models up to 25x larger, thanks to new innovations in model scaling and training data curation.</p>



<p>With its compact size, Phi-2 is an ideal playground for researchers, including for exploration around mechanistic interpretability, safety improvements, or fine-tuning experimentation on a variety of tasks. We have made <a href="https://ml.azure.com/registries/azureml-msr/models/microsoft-phi-2/version/3?tid=72f988bf-86f1-41af-91ab-2d7cd011db47#overview" target="_blank" rel="noreferrer noopener"><strong>Phi-2</strong><span> (opens in new tab)</span></a><strong> </strong>available in the Azure AI Studio model catalog to foster research and development on language models.</p>



	<div data-bi-an="promo" data-bi-id="956157">
		

		<p>
		<span>Microsoft Research Podcast</span>
	</p>
	
	<div>
						<p><a href="https://www.microsoft.com/en-us/research/podcast/ai-frontiers-the-future-of-causal-reasoning-with-emre-kiciman-and-amit-sharma/" aria-label="AI Frontiers: The future of causal reasoning with Emre Kiciman and Amit Sharma" data-bi-cn="AI Frontiers: The future of causal reasoning with Emre Kiciman and Amit Sharma" target="_blank">
					<img decoding="async" src="https://www.microsoft.com/en-us/research/uploads/prod/2023/06/Amit_Emre_podcast_hero_feature_1400x788.jpg"/>
				</a>
			</p>
			
			<div>

									<h2>AI Frontiers: The future of causal reasoning with Emre Kiciman and Amit Sharma</h2>
				
								<p>Emre Kiciman and Amit Sharma discuss their paper “Causal Reasoning and Large Language Models: Opening a New Frontier for Causality” and how it examines the causal capabilities of large language models (LLMs) and their implications.</p>
				
								
							</div><!--/.msr-promo__content-->
	</div><!--/.msr-promo__inner-wrap-->
<p><span id="label-external-link" aria-hidden="true">Opens in a new tab</span>	</p></div><!--/.msr-promo-->
	


<h2 id="key-insights-behind-phi-2">Key Insights Behind Phi-2</h2>



<p>The massive increase in the size of language models to hundreds of billions of parameters has unlocked a host of emerging capabilities that have redefined the landscape of natural language processing. A question remains whether such emergent abilities can be achieved at a smaller scale using strategic choices for training, e.g., data selection.</p>



<p>Our line of work with the Phi models aims to answer this question by training SLMs that achieve performance on par with models of much higher scale (yet still far from the frontier models). Our key insights for breaking the conventional language model scaling laws with Phi-2 are twofold:</p>



<p>Firstly, training data quality plays a critical role in model performance. This has been known for decades, but we take this insight to its extreme by focusing on “textbook-quality” data, following upon our prior work “<a href="https://www.microsoft.com/en-us/research/publication/textbooks-are-all-you-need/">Textbooks Are All You Need</a>.” Our training data mixture contains synthetic datasets specifically created to teach the model common sense reasoning and general knowledge, including science, daily activities, and theory of mind, among others. We further augment our training corpus with carefully selected web data that is filtered based on educational value and content quality. Secondly, we use innovative techniques to scale up, starting from our 1.3 billion parameter model, Phi-1.5, and embedding its knowledge within the 2.7 billion parameter Phi-2. This scaled knowledge transfer not only accelerates training convergence but shows clear boost in Phi-2 benchmark scores.</p>



<figure><img decoding="async" width="25377" height="5876" src="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp.png" alt="A bar plot comparing the performance of Phi-2 (with 2.7B parameters) and Phi-1.5 (with 1.3B parameters) on common sense reasoning, language understanding, math, coding, and the Bigbench-hard benchmark. Phi-2 outperforms Phi1.5 in all categories. The commonsense reasoning tasks are PIQA, WinoGrande, ARC easy and challenge, and SIQA. The language understanding tasks are HellaSwag, OpenBookQA, MMLU, SQuADv2, and BoolQ. The math task is GSM8k, and coding includes the HumanEval and MBPP benchmarks. " srcset="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp.png 25377w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp-300x69.png 300w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp-1024x237.png 1024w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp-768x178.png 768w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp-1536x356.png 1536w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp-2048x474.png 2048w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure2_phi_comp-240x56.png 240w" sizes="(max-width: 25377px) 100vw, 25377px"/><figcaption><strong>Figure 2. </strong>Comparison between Phi-2 (2.7B) and Phi-1.5 (1.3B) models. All tasks are evaluated in 0-shot except for BBH and MMLU which use 3-shot CoT and 5-shot, respectively.</figcaption></figure>



<h2 id="training-details">Training Details</h2>



<p>Phi-2 is a Transformer-based model with a next-word prediction objective, trained on 1.4T tokens from multiple passes on a mixture of Synthetic and Web datasets for NLP and coding. The training for Phi-2 took 14 days on 96 A100 GPUs. Phi-2 is a base model that has not undergone alignment through reinforcement learning from human feedback (RLHF), nor has it been instruct fine-tuned. Despite this, we observed better behavior with respect to toxicity and bias compared to existing open-source models that went through alignment (see Figure 3). This is in line with what we saw in Phi-1.5 due to our tailored data curation technique, see our <a href="https://www.microsoft.com/en-us/research/publication/textbooks-are-all-you-need-ii-phi-1-5-technical-report/">previous tech report<span> (opens in new tab)</span></a> for more details on this. For more information about the Phi-2 model, please visit <a href="https://ml.azure.com/registries/azureml-msr/models/microsoft-phi-2/version/3?tid=72f988bf-86f1-41af-91ab-2d7cd011db47#overview" target="_blank" rel="noreferrer noopener">Azure AI | Machine Learning Studio<span> (opens in new tab)</span></a>.</p>



<figure><img decoding="async" width="16803" height="8165" src="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores.png" alt="A barplot comparing the safety score of Phi-1.5, Phi-2, and Llama-7B models on 13 categories of the ToxiGen benchmark. Phi-1.5 achieves the highest score on all categories, Phi-2 achieves the second-highest scores and Llama-7B achieves the lowest scores across all categories. " srcset="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores.png 16803w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores-300x146.png 300w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores-1024x498.png 1024w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores-768x373.png 768w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores-1536x746.png 1536w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores-2048x995.png 2048w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/figure3_safety_scores-240x117.png 240w" sizes="(max-width: 16803px) 100vw, 16803px"/><figcaption><strong>Figure 3. </strong>Safety scores computed on 13 demographics from ToxiGen. A subset of 6541 sentences are selected and scored between 0 to 1 based on scaled perplexity and sentence toxicity. A higher score indicates the model is less likely to produce toxic sentences compared to benign ones.</figcaption></figure>



<h2 id="phi-2-evaluation">Phi-2 Evaluation</h2>



<p>Below, we summarize Phi-2 performance on academic benchmarks compared to popular language models. Our benchmarks span several categories, namely, Big Bench Hard (BBH) (3 shot with CoT), commonsense reasoning (PIQA, WinoGrande, ARC easy and challenge, SIQA), language understanding (HellaSwag, OpenBookQA, MMLU (5-shot), SQuADv2 (2-shot), BoolQ), math (GSM8k (8 shot)), and coding (HumanEval, MBPP (3-shot)).</p>



<p>With only 2.7 billion parameters, Phi-2 surpasses the performance of Mistral and Llama-2 models at 7B and 13B parameters on various aggregated benchmarks. Notably, it achieves better performance compared to 25x larger Llama-2-70B model on muti-step reasoning tasks, i.e., coding and math. Furthermore, Phi-2 matches or outperforms the recently-announced Google Gemini Nano 2, despite being smaller in size.</p>



<p>Of course, we acknowledge the current challenges with model evaluation, and that many public benchmarks might leak into the training data. For our first model, Phi-1, we did an extensive decontamination study to discard this possibility, which can be found in our first report “<a href="https://www.microsoft.com/en-us/research/publication/textbooks-are-all-you-need/">Textbooks Are All You Need</a>.” Ultimately, we believe that the best way to judge a language model is to test it on concrete use cases. Following that spirit, we also evaluated Phi-2 using several Microsoft internal proprietary datasets and tasks, comparing it again to Mistral and Llama-2. We observed similar trends, i.e. on average, Phi-2 outperforms Mistral-7B, and the latter outperforms the Llama-2 models (7B, 13B, and 70B).</p>



<figure><table><thead><tr><th>Model</th><th>Size</th><th>BBH</th><th>Commonsense</th><th>Language</th><th>Math</th><th>Coding</th></tr></thead><tbody><tr><td rowspan="3">Llama-2</td><td>7B</td><td>40.0</td><td>62.2</td><td>56.7</td><td>16.5</td><td>21.0</td></tr><tr><td>13B</td><td>47.8</td><td>65.0</td><td>61.9</td><td>34.2</td><td>25.4</td></tr><tr><td>70B</td><td>66.5</td><td>69.2</td><td>67.6</td><td>64.1</td><td>38.3</td></tr><tr><td>Mistral</td><td>7B</td><td>57.2</td><td>66.4</td><td>63.7</td><td>46.4</td><td>39.4</td></tr><tr><td>Phi-2</td><td>2.7B</td><td>59.2</td><td>68.8</td><td>62.0</td><td>61.1</td><td>53.7</td></tr></tbody></table><figcaption><center><strong>Table 1.</strong> Averaged performance on grouped benchmarks compared to popular open-source SLMs.</center></figcaption></figure>



<figure><table><thead><tr><th>Model</th><th>Size</th><th>BBH</th><th>BoolQ</th><th>MBPP</th><th>MMLU</th></tr></thead><tbody><tr><td>Gemini Nano 2</td><td>3.2B</td><td>42.4</td><td>79.3</td><td>27.2</td><td>55.8</td></tr><tr><td>Phi-2</td><td>2.7B</td><td>59.3</td><td>83.3</td><td>59.1</td><td>56.7</td></tr></tbody></table><figcaption><center><strong>Table 2.</strong> Comparison between Phi-2 and Gemini Nano 2 Model on Gemini’s reported benchmarks.</center></figcaption></figure>



<p>In addition to these benchmarks, we also performed extensive testing on commonly used prompts from the research community. We observed a behavior in accordance with the expectation we had given the benchmark results. For example, we tested a prompt used to probe a model’s ability to solve physics problems, most recently used to evaluate the capabilities of the Gemini Ultra model, and achieved the following result:</p>



<figure><img decoding="async" width="1347" height="758" src="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4.png" alt="An example prompt is given to Phi-2 which says “A skier slides down a frictionless slope of height 40m and length 80m. What&#39;s the skier’s speed at the bottom?”. Phi-2 then answers the prompt by explaining the conversion of potential energy to kinetic energy and providing the formulas to compute each one. It then proceeds to compute the correct speed using the energy formulas. " srcset="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4.png 1347w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-300x169.png 300w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-1024x576.png 1024w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-768x432.png 768w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-1066x600.png 1066w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-655x368.png 655w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-343x193.png 343w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-240x135.png 240w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-640x360.png 640w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-960x540.png 960w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig4-1280x720.png 1280w" sizes="(max-width: 1347px) 100vw, 1347px"/><figcaption><strong>Figure 4. </strong>Phi-2’s output on a simple physics problem, which includes an approximately correct square root calculation.</figcaption></figure>



<figure><img decoding="async" width="1600" height="710" src="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig5.png" alt="The model is then provided with a student’s wrong answer to the skier physics problem and asked if it can correct the student’s mistake. Phi-2 replies with the student’s mistake, i.e., using the wrong formula for potential energy, and provides the correct formula. " srcset="https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig5.png 1600w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig5-300x133.png 300w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig5-1024x454.png 1024w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig5-768x341.png 768w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig5-1536x682.png 1536w, https://www.microsoft.com/en-us/research/uploads/prod/2023/12/Seb_Fig5-240x107.png 240w" sizes="(max-width: 1600px) 100vw, 1600px"/><figcaption><strong>Figure 5. </strong>Similarly to Gemini’s test we also further queried Phi-2 with a student’s wrong answer to see if Phi-2 could identify where the mistake is (it did, despite Phi-2 being not fine-tuned for chat or instruction-following). We note however that it is not fully an apple-to-apple comparison with the Gemini Ultra’s output described in the Gemini report, in particular in the latter case the student’s answer was given as an image with handwritten text rather than raw text in our case.</figcaption></figure>
<p><span id="label-external-link" aria-hidden="true">Opens in a new tab</span>					</p></div>
				</div></div>
  </body>
</html>
