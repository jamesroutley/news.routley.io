<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.virtualizationhowto.com/2023/04/proxmox-docker-containers-monster-13000-containers-on-a-single-host/">Original</a>
    <h1>Proxmox Docker Containers Monster – 13000 containers on a single host</h1>
    
    <div id="readability-page-1" class="page"><article id="the-post">

<div>
<p>One of the cool little experiments in the home lab recently was seeing just how many Docker containers could run on a single physical Proxmox host, hosting a number of Docker container hosts. I could easily scale containers up to 1000 in each virtual machine using virtual machines and Docker Swarm. Let’s look at Proxmox Docker container host monster :). First though, let’s go through some basics of running Docker containers on Proxmox. You can skip directly to the section where I run 13000 containers in the table of contents.</p>

<h2 id="h-running-docker-in-vms-vs-lxc-containers-a-quick-comparison">Running Docker in VMs vs LXC Containers: A Quick Comparison</h2>
<p>Now that you have learned how to set up Docker containers in both VMs and LXC containers within Proxmox, it’s worth comparing the two approaches.</p>
<ul>
<li><p><strong>Resource Efficiency</strong>: LXC containers are generally more resource-efficient than VMs, as they share the host system’s kernel and use fewer resources. This makes LXC containers a more lightweight option for running Docker containers, especially in environments where resources are limited.</p></li>
<li><p><strong>Isolation</strong>: VMs provide a higher isolation level between the host and guest operating systems, as each VM runs its own kernel. This can be beneficial from a security perspective. However, LXC containers also provide a decent level of isolation, making them suitable for most use cases.</p></li>
<li><p><strong>Compatibility</strong>: Docker containers should run consistently across different environments, whether in VMs or LXC containers. However, certain advanced features may be more challenging to implement in LXC containers compared to VMs. It is essential to test your specific use case to determine the best approach for your environment.</p></li>
</ul>
<p>Ultimately, the choice between VMs and LXC containers for running your Proxmox Docker Container Monste</p>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/24d70626-75f4-45df-b67d-1449fe7083fc.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/24d70626-75f4-45df-b67d-1449fe7083fc.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<p>r setup depends on your needs and resource availability.</p><p><a href="https://www.altaro.com/vm-backup/?LP=vht-sc-Banner-V9-Banner-300x250&amp;Cat=SC&amp;utm_source=vht&amp;utm_medium=sc&amp;utm_campaign=V9-Banner-300x250&amp;utm_content=banner">
<img alt="Altaro VM Backup" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/03/hornet_security_300x250_new.jpg" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/>
</a></p>
<h2 id="h-how-to-set-up-docker-containers-in-proxmox-using-an-lxc-container">How to Set Up Docker Containers in Proxmox Using an LXC Container</h2>
<p>Setting up Docker containers in Proxmox using an LXC container involves a few key steps. In this tutorial, we will walk you through the process of creating an LXC container, installing Docker Engine, and setting up Docker Compose.</p>
<p><strong>Use the Turnkey Core template</strong></p>
<p>Another option for a base operating system is a Docker container host running on Turnkey Core Linux as a template you can download from your Proxmox host. Download the Turnkey Core container template from the Proxmox template repository. This will be used to create an LXC container for running Docker containers. </p>
<h3 id="h-downloading-templates">Downloading templates</h3>
<p>Navigate to the storage location where you want to store the template, then click “Templates” and search for “Turnkey Core.” Download the template and wait for the process to complete. You can create a new LXC unprivileged container to run Docker as a Docker host on Proxmox VE.</p>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/888e0ecf-2403-4b32-baeb-fbedfb3d3d0a.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/888e0ecf-2403-4b32-baeb-fbedfb3d3d0a.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<h2 id="h-create-a-ubuntu-server-22-04-vm">Create a Ubuntu Server 22.04 VM</h2>
<p>First, you must create a new VM running Ubuntu Server 22.04 as the base operating system. In the Proxmox web interface, click on “Create VM” and configure the necessary settings such as hostname, disk size, and storage location. Once the VM is created, proceed with installing Ubuntu Server 22.04.</p>
<p>Below, I have created an Ubuntu Server 22.04 virtual machine template for cloning additional VMs for container hosts.</p>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/467853a8-16e1-462e-a97d-091bf4177c53.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/467853a8-16e1-462e-a97d-091bf4177c53.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<p><strong>Clone from your template virtual machine</strong></p>
<p>Now that you have created the Ubuntu virtual machine template, we want to install Docker so we can use this installation to create a virtual machine template, which will save time. Once you have the VM template, you can clone from this virtual machine for your Docker container hosts. We can configure the container with the necessary resources, such as CPU, memory, and storage.</p>
<h3 id="h-installing-docker">Installing Docker</h3>
<p>Once the VM is created and running, access it via the Proxmox host console and run the following commands. Since I am using the Ubuntu Server platform, I am following the official guidance from Docker here on installing Docker in Ubuntu: <a target="_blank" rel="noopener noreferrer" href="https://docs.docker.com/engine/install/ubuntu/">Install Docker Engine on Ubuntu | Docker Documentation</a>.</p>
<p>Proceed with the installation of a few prerequisites needed.</p>
<pre><code>sudo apt-get update
sudo apt-get install 
    ca-certificates 
    curl 
    gnupg</code></pre>
<p>Install the official GPG key:</p>
<pre><code>sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg</code></pre>
<p>Use the following commands to setup the repository:</p>
<pre><code>echo 
  &#34;deb [arch=&#34;$(dpkg --print-architecture)&#34; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu 
  &#34;$(. /etc/os-release &amp;&amp; echo &#34;$VERSION_CODENAME&#34;)&#34; stable&#34; | 
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</code></pre>
<p>Run an apt update to update the package index:</p>
<pre><code>sudo apt-get update</code></pre>
<p>Finally, install Docker Engine on the Linux container.</p>
<pre><code>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></pre>
<h2 id="h-use-portainer-to-manage-your-containers">Use Portainer to manage your containers</h2>
<p>To manage your Docker containers more easily, it’s recommended to install Portainer, a web-based interface for managing Docker environments. To install Portainer, run the following command:</p>
<pre><code>docker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce</code></pre>
<p>Once Portainer is installed, access its web interface by navigating to http://&lt;your_proxmox_host_ip&gt;:9000. Log in with your chosen username and password be able to manage your Docker containers.</p>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/64b4726d-d1b6-4d6e-b123-70c013865654.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/64b4726d-d1b6-4d6e-b123-70c013865654.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<h2 id="h-create-docker-containers-in-portainer">Create Docker Containers in Portainer</h2>
<p>Now that you have Portainer installed and configured, you can create Docker containers directly from the web interface. Click “Containers” in the left-hand menu, then click “Add container.” Provide the necessary details, such as the container name, image, and any required environment variables.</p>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/4d999956-fafc-4010-8598-2482c3f86e5a.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/4d999956-fafc-4010-8598-2482c3f86e5a.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<h3 id="h-docker-compose-and-application-stacks">Docker compose and application stacks</h3>
<p>To create containers using Docker Compose, you can either upload a Docker Compose YAML file or create one directly within the Portainer interface. Click “Stacks” in the left-hand menu, then click “Add stack.” Provide the necessary details, and Portainer will create the Docker containers based on the Docker Compose configuration.</p>
<p>You’ve successfully created a Proxmox Docker Container Monster environment using an LXC container with this setup. This allows you to run multiple Docker containers on your Proxmox host with minimal overhead and manage them easily using Portainer.</p>
<p><strong>Install Docker Engine on the Linux Container host system</strong></p>
<p>Before diving into the Docker installation process, ensure your LXC container is up to date by running the following commands:</p>
<pre><code>sudo apt update sudo apt upgrade</code></pre>
<p>After updating the container, proceed with the installation of Docker by executing these commands:</p>
<pre><code>curl -fsSL https://get.docker.com -o get-docker.sh sudo sh get-docker.sh sudo usermod -aG docker $USER</code></pre>
<p>These commands download and install Docker Engine on your Linux container, allowing you to run Docker containers seamlessly.</p>
<h2 id="h-scaling-up-to-13000-containers">Scaling up to 13000 Containers!</h2>
<p>I wanted to see what my Supermicro E300-9D would do from a container perspective. It has 16 cores and 128 GB of memory. So I cloned the virtual machine template for VM Docker container hosts and was able to scale the containers in each one to 1000 containers each using 12 GB of memory configured.</p>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/f4b5efeb-461a-4765-950e-10274eec86a8.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/f4b5efeb-461a-4765-950e-10274eec86a8.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<p>I used Docker Swarm as an easy way to spin up (scaling) the containers to the desired number on each host.</p>
<pre><code>docker swarm init</code></pre>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/e547cb22-4445-4e09-b4e4-d8e63b177621.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/e547cb22-4445-4e09-b4e4-d8e63b177621.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<p>Below is an example of me testing a couple of containers on a single VM. As you can see below, I have spun up 800 nginx containers and 200 redis containers. However, I settled on just a single application container in the final test. So, I spun up 1000 containers on one host (nginx) and 1000 on another (redis), until I reached 13 VMs running 13000 containers.</p>
<p>To create a service, use this command:</p>
<pre><code>docker service create --name nginx nginx:latest</code></pre>
<p>Then, to scale the service, you can use the command:</p>
<pre><code>docker service scale nginx=1000</code></pre>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/2023-04-12_8-15-48.png"><img decoding="async" width="583" height="96" alt="2023 04 12 8 15 48" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/2023-04-12_8-15-48.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<p>At 13,000 containers, the host’s resources were basically exhausted. I was running right at 100% CPU and memory was sitting at 95% memory. But it was up and running! </p>
<p>To recap:</p>
<ul>
<li>I cloned 13 virtual machines in Proxmox (Ubuntu 22.04)</li>
<li>I initialized the virtual machine as a single Docker Swarm host</li>
<li>I then create a service (alternated between nginx and redis with each VM)</li>
<li>Then, I scaled the service in each virtual machine to 1000 containers</li>
</ul>
<div>
<figure><a href="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/3de3da26-759c-4ad2-bf69-ce928ada1d79.png"><img decoding="async" alt="" data-src="https://www.virtualizationhowto.com/wp-content/uploads/2023/04/3de3da26-759c-4ad2-bf69-ce928ada1d79.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></a></figure></div>
<p>It was great to see that running so many containers was possible on a single server. It is a testament to just how efficient containers are, and when it comes to running applications at scale, they are superior to VMs. It is just a matter of pointing your DNS server to the applications configured in containers for end users to access.</p>
<p>Take a look at a video of the process here:</p>
<figure><p>
<iframe title="Proxmox Docker Monster! Running 13000 containers on a single host!" width="780" height="439" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" data-src="https://www.youtube.com/embed/c8UAN1xbnBw?feature=oembed" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></iframe>
</p></figure>


<h2 id="h-wrapping-up">Wrapping up</h2>
<p>Proxmox offers an excellent platform for running Docker containers, whether you use LXC containers or VMs as container hosts. Following the steps outlined in this tutorial, you can set up a Proxmox Docker Container Monster environment and easily manage your Docker containers using the Portainer web interface.</p>
<p>With the versatility of Proxmox and the power of Docker at your fingertips, you can easily create, deploy, and manage containerized applications. This powerful combination enables you to harness the full potential of containerization in your environment, whether it’s a home lab or a production environment.</p>
<p>Remember to keep your system updated and monitor resource usage, ensuring your Proxmox Docker Container Monster setup runs smoothly and securely. Embrace the world of containerization and enjoy its benefits to your infrastructure management experience.</p>

</div>



</article></div>
  </body>
</html>
