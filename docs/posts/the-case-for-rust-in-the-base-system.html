<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mail-archive.freebsd.org/cgi/getmsg.cgi?fetch=414797&#43;0&#43;current/freebsd-hackers">Original</a>
    <h1>The Case for Rust in the base system</h1>
    
    <div id="readability-page-1" class="page"><div id="content">

<pre><strong>Date: </strong>     Sat, 20 Jan 2024 09:51:25 -0700
<strong>From: </strong>     Alan Somers &lt;asomers@freebsd.org&gt;
<strong>To: </strong>       FreeBSD Hackers &lt;freebsd-hackers@freebsd.org&gt;
<strong>Cc: </strong>       Warner Losh &lt;imp@bsdimp.com&gt;, Scott Long &lt;scottl@freebsd.org&gt;, meka@tilda.center
<strong>Subject: </strong>  The Case for Rust (in the base system)
<strong>Message-ID: </strong> &lt;<a href="https://mail-archive.freebsd.org/cgi/mid.cgi?db=irt&amp;id=CAOtMX2hAUiWdGPtpaCJLPZB%2Bj2yzNw5DSjUmkwTi%2B%2BmyemehCA@mail.gmail.com">CAOtMX2hAUiWdGPtpaCJLPZB%2Bj2yzNw5DSjUmkwTi%2B%2BmyemehCA@mail.gmail.com</a>&gt;
</pre>
<hr noshade="noshade"/>
<p><a href="https://mail-archive.freebsd.org/cgi/mid.cgi?db=irt&amp;id=CAOtMX2hAUiWdGPtpaCJLPZB%2Bj2yzNw5DSjUmkwTi%2B%2BmyemehCA@mail.gmail.com">next in thread</a>
| <a href="https://mail-archive.freebsd.org/cgi/getmsg.cgi?fetch=414797+0+current/freebsd-hackers+raw">raw e-mail</a>
| <a href="https://mail-archive.freebsd.org/mail/current/freebsd-hackers.html">index</a>
| <a href="https://mail-archive.freebsd.org/cgi/getmsg.cgi?fetch=0+0+current/freebsd-hackers+archive">archive</a>
| <a href="https://mail-archive.freebsd.org/search/search-mid/">help</a></p><hr noshade="noshade"/>
<pre>In a recent thread on src-committers, we discussed the costs and
benefits of including Rust code in the FreeBSD base system.  To
summarize, the cost is that it would double our build times.  imp
suggested adding an additional step after buildworld for stuff that
requires an external toolchain.  That would ease the build time pain.
The benefit is that some tools would become easier to write, or even
become possible.  Here is a list of actual and potential Rust projects
that could benefit from being in-tree.  If anybody else has items to
add, I suggest moving this into the project wiki:

Stuff that could only be written in Rust if it were in base
===========================================================

* ctl-exporter (I started this, but discovered that the CTL stats API is
  unstable, so it can&#39;t live in ports.  Instead, I had to do it in C).
  <a href="https://github.com/freebsd/freebsd-src/commit/1a7f22d9c211f504f6c48a86401469181a67ec34">https://github.com/freebsd/freebsd-src/commit/1a7f22d9c211f504f6c48a86401469181a67ec34</a>

* fusefs tests.  Absolutely impossible to do in C.  I considered Rust, but went
  with C++ so they could live in base.  They are too closely coupled to
  fusefs(5) to live out-of-tree.
  <a href="https://github.com/freebsd/freebsd-src/tree/main/tests/sys/fs/fusefs">https://github.com/freebsd/freebsd-src/tree/main/tests/sys/fs/fusefs</a>

* devd.  Currently C++, but imp suggested a rewrite.
  <a href="https://github.com/freebsd/freebsd-src/tree/main/sbin/devd">https://github.com/freebsd/freebsd-src/tree/main/sbin/devd</a>

* zfsd.  Currently C++, but I&#39;ve long pondered a rewrite.  Using Rust would
  make it more testable.
  <a href="https://github.com/freebsd/freebsd-src/tree/main/cddl/usr.sbin/zfsd">https://github.com/freebsd/freebsd-src/tree/main/cddl/usr.sbin/zfsd</a>

* nscd.  Currently C, but confusing and with no test coverage.  I&#39;ve
  contemplated a rewrite myself, but I don&#39;t want to do it in C.
  <a href="https://github.com/freebsd/freebsd-src/tree/main/usr.sbin/nscd">https://github.com/freebsd/freebsd-src/tree/main/usr.sbin/nscd</a>

* The userland portion of the 802.11ac and Lightning stacks.  scottl suggested
  that these were good candidates for Rust.

* freebsd-kpi-r14-0 .  <a href="https://crates.io/crates/freebsd-kpi-r14-0">https://crates.io/crates/freebsd-kpi-r14-0</a>

Stuff that can live in ports, but would be nicer in base
========================================================

* gstat-rs <a href="https://crates.io/crates/gstat">https://crates.io/crates/gstat</a>

* geom-exporter (I&#39;ve started this, but haven&#39;t published it)

* nfs-exporter <a href="https://crates.io/crates/freebsd-nfs-exporter">https://crates.io/crates/freebsd-nfs-exporter</a>

* virtiofsd-rs .  Nobody has yet tried to port it to FreeBSD.  But if the
  connection to bhyve(8) is too intimate, it might be hard to do in ports.
  <a href="https://gitlab.com/virtio-fs/virtiofsd">https://gitlab.com/virtio-fs/virtiofsd</a>

* jail-exporter <a href="https://crates.io/crates/jail_exporter">https://crates.io/crates/jail_exporter</a>

* Various jail managers have been attempted in Rust.  I think these are fine in
  ports, but others like Goran Mekic have opined that they should be moved to
  base instead.

* musikid&#39;s pjdfstest rewrite.  I think it would be great to start using this
  to test the base system&#39;s file systems.  If the tests themselves lived in
  base, they would be easier to sync with file system development.
  <a href="https://github.com/musikid/pjdfstest">https://github.com/musikid/pjdfstest</a>

* pf-rs.  I suspect that the API isn&#39;t very stable.
  <a href="https://crates.io/crates/pf-rs">https://crates.io/crates/pf-rs</a>

* benchpmc.  The pmc counter names changes between releases.
  <a href="https://crates.io/crates/benchpmc">https://crates.io/crates/benchpmc</a>

FreeBSD-related applications that are just fine in ports
=========================================================

* fsx-rs.  Unlike pjdfstest, this only tests datapath APIs.  Those are usually
  more stable than control path APIs, so I think there&#39;s little to be gained by
  moving this into base. <a href="https://crates.io/crates/fsx">https://crates.io/crates/fsx</a>

* ztop.  It uses ZFS&#39;s kstats sysctl interface, which is pretty stable.
  <a href="https://crates.io/crates/ztop">https://crates.io/crates/ztop</a>

* iocage-provision  <a href="https://crates.io/crates/iocage-provision">https://crates.io/crates/iocage-provision</a>

* rsblk <a href="https://crates.io/crates/rsblk">https://crates.io/crates/rsblk</a>

* xfuse  <a href="https://github.com/KhaledEmaraDev/xfuse">https://github.com/KhaledEmaraDev/xfuse</a>

Other FreeBSD-related libraries in Rust
=======================================
Just see the list at <a href="https://crates.io/keywords/freebsd">https://crates.io/keywords/freebsd</a>


</pre>
<hr/>
<p>Want to link to this message? Use this URL: &lt;<a href="https://mail-archive.FreeBSD.org/cgi/mid.cgi?CAOtMX2hAUiWdGPtpaCJLPZB%2Bj2yzNw5DSjUmkwTi%2B%2BmyemehCA">https://mail-archive.FreeBSD.org/cgi/mid.cgi?CAOtMX2hAUiWdGPtpaCJLPZB%2Bj2yzNw5DSjUmkwTi%2B%2BmyemehCA</a>&gt;</p>
	</div></div>
  </body>
</html>
