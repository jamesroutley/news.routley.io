<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/goncalomb/sane-wasm">Original</a>
    <h1>WebAssembly&#43;WebUSB port of the SANE scanner library</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">A project to bring the <a href="http://www.sane-project.org/intro.html" rel="nofollow">SANE API</a> to the web.</p>
<p dir="auto">Currently, it only supports USB scanners and is only tested on a browser environment (WebUSB).</p>
<p dir="auto">This works by compiling all SANE backends (and required dependencies) to WebAssembly using Emscripten. The other key piece is @RReverser&#39;s <a href="https://github.com/libusb/libusb/pull/1057" data-hovercard-type="pull_request" data-hovercard-url="/libusb/libusb/pull/1057/hovercard">bridge from libusb to WebUSB</a> (<a href="https://web.dev/porting-libusb-to-webusb/" rel="nofollow">1</a>/<a href="https://web.dev/porting-gphoto2-to-the-web/" rel="nofollow">2</a>) with <a href="https://www.vrk.dev/goncalomb/sane-wasm/blob/master/deps/libusb.patch">some patching</a> to support multi-threading.</p>
<p dir="auto">Right now, it includes <a href="http://www.sane-project.org/lists/sane-backends-cvs.html" rel="nofollow">all backends</a> that have support for at least one USB device (genesys is not included due to issues). No <a href="http://www.sane-project.org/lists/sane-backends-external.html" rel="nofollow">external backends</a> are included at the moment.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-webscan" aria-label="Heading link" href="#webscan"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>WebScan</h2>
<p dir="auto"><strong>Check <a href="https://webscan.goncalomb.com/" rel="nofollow">webscan.goncalomb.com</a> for a demo of sane-wasm.</strong> This is a React application that uses sane-wasm for document/image scanning directly in the browser. Exposes all scanning options to the user for full control.</p>
<p dir="auto">If you are interested in seeing the compiled output of sane-wasm, check:</p>
<ul dir="auto">
<li><a href="https://webscan.goncalomb.com/sane-wasm/" rel="nofollow">webscan.goncalomb.com/sane-wasm/</a>: all files</li>
<li><a href="https://webscan.goncalomb.com/sane-wasm/" rel="nofollow">webscan.goncalomb.com/sane-wasm/libsane.html</a>: test page</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-building" aria-label="Heading link" href="#building"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Building</h2>
<p dir="auto">Building requires <a href="https://github.com/emscripten-core/emscripten">emscripten</a> and all the required tools to build the dependencies.</p>
<p dir="auto">The preferred way is just to use the pre-configured Docker image:</p>
<div data-snippet-clipboard-copy-content="git clone --recurse-submodules https://github.com/goncalomb/sane-wasm.git
cd sane-wasm
./build.sh --with-docker --clean"><pre><code>git clone --recurse-submodules https://github.com/goncalomb/sane-wasm.git
cd sane-wasm
./build.sh --with-docker --clean
</code></pre></div>
<p dir="auto">Start the test server with:</p>
<div data-snippet-clipboard-copy-content="./build.sh --with-docker --no-build --emrun"><pre><code>./build.sh --with-docker --no-build --emrun
</code></pre></div>
<p dir="auto">Check the test page at: <a href="http://localhost:6931/libsane.html" rel="nofollow">http://localhost:6931/libsane.html</a>.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-buildsh" aria-label="Heading link" href="#buildsh"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>build.sh</h3>
<p dir="auto">The <code>./build.sh</code> script has other options for debugging:</p>
<div data-snippet-clipboard-copy-content="usage: build.sh [options]
  --with-docker  run with docker (preferred)
  --clean        clean &#39;deps&#39; and &#39;build&#39; directories
  --no-build     don&#39;t actually build
  --debug        enable debug flags
  --emrun        run emrun development server
  --shell        run debug shell (depends on --with-docker)"><pre><code>usage: build.sh [options]
  --with-docker  run with docker (preferred)
  --clean        clean &#39;deps&#39; and &#39;build&#39; directories
  --no-build     don&#39;t actually build
  --debug        enable debug flags
  --emrun        run emrun development server
  --shell        run debug shell (depends on --with-docker)
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-using" aria-label="Heading link" href="#using"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Using</h2>
<p dir="auto">For now, this project has only been used on a browser environment, usage with Node.js or other environments is untested/unsupported. The API may still suffer changes and no <code>npm</code> package is provided at the moment.</p>
<p dir="auto">The recommended way to use this project is to add it as a <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules" rel="nofollow">submodule</a> to your application. Integrate <code>./build.sh</code> with your build process. And include the main .js file:</p>
<div data-snippet-clipboard-copy-content="&lt;script src=&#34;build/libsane.js&#34;&gt;&lt;/script&gt;
&lt;script&gt;
    window.LibSANE().then(LibSANE =&gt; {
        window.LibSANE = LibSANE;
        // your code
        console.log(LibSANE.sane_init());
    });
&lt;/script&gt;"><pre><code>&lt;script src=&#34;build/libsane.js&#34;&gt;&lt;/script&gt;
&lt;script&gt;
    window.LibSANE().then(LibSANE =&gt; {
        window.LibSANE = LibSANE;
        // your code
        console.log(LibSANE.sane_init());
    });
&lt;/script&gt;
</code></pre></div>
<p dir="auto">I don&#39;t recommend minifying <code>libsane.js</code> with your application code. It may break some things.</p>
<p dir="auto">This will be improved in the future.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-exposed-api-may-not-be-final" aria-label="Heading link" href="#exposed-api-may-not-be-final"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Exposed API (may not be final)</h2>
<p dir="auto">Most of the SANE API is exposed as-is. Check the <a href="https://sane-project.gitlab.io/standard/index.html" rel="nofollow">SANE Standard</a>.</p>
<p dir="auto">Some safeguards are in place to avoid API misuse and prevent memory leaks. It&#39;s important to understand the SANE API and follow the <a href="https://sane-project.gitlab.io/standard/api.html#code-flow" rel="nofollow">Code Flow</a> to avoid issues.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-differences-with-the-sane-api" aria-label="Heading link" href="#differences-with-the-sane-api"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Differences with the SANE API</h3>
<p dir="auto">The most important difference with the underlying SANE API is that <strong>device handles are not exposed</strong>. This means that <code>sane_open()</code> does not return a device handle. A single handle is managed by the internal code. This effectively means that <strong>only one device can be accessed at a time</strong>. This was a design decision made to simplify the API and prevent other issues.</p>
<blockquote>
<p dir="auto">Personally, I believe that this is an acceptable change, especially for WebAssembly where it may be easier to lose track of opened resources and crash the application. The SANE API is also somewhat unforgiving and building more safeguards around it (especially with multiple handles) is not worth the effort. Ultimately I don&#39;t see a use that requires more than one device open at a time. @goncalomb</p>
</blockquote>
<h3 tabindex="-1" dir="auto"><a id="user-content-constants" aria-label="Heading link" href="#constants"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Constants</h3>
<p dir="auto"><em>documentation in progress, the API may still suffer changes</em></p>
<p dir="auto"><code>LibSANE.SANE_WASM_COMMIT</code></p>
<p dir="auto"><code>LibSANE.SANE_WASM_VERSION</code></p>
<p dir="auto"><code>LibSANE.SANE_WASM_BACKENDS</code></p>
<p dir="auto"><code>LibSANE.SANE_CURRENT_MAJOR</code> (number) = SANE C macro <code>SANE_CURRENT_MAJOR</code></p>
<p dir="auto"><code>LibSANE.SANE_CURRENT_MINOR</code> (number) = SANE C macro <code>SANE_CURRENT_MINOR</code></p>
<p dir="auto"><code>LibSANE.SANE_STATUS</code> (object) = SANE C enum <code>SANE_Status</code></p>
<p dir="auto"><code>LibSANE.SANE_TYPE</code> (object) = SANE C enum <code>SANE_Value_Type</code></p>
<p dir="auto"><code>LibSANE.SANE_UNIT</code> (object) = SANE C enum <code>SANE_Unit</code></p>
<p dir="auto"><code>LibSANE.SANE_CONSTRAINT</code> (object) = SANE C enum <code>SANE_Constraint_Type</code></p>
<p dir="auto"><code>LibSANE.SANE_FRAME</code> (object) = SANE C enum <code>SANE_Frame</code></p>
<h3 tabindex="-1" dir="auto"><a id="user-content-functions" aria-label="Heading link" href="#functions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Functions</h3>
<p dir="auto"><em>documentation in progress, the API may still suffer changes</em></p>
<p dir="auto"><code>LibSANE.sane_get_state</code> (extra function, not part of the SANE API)</p>
<p dir="auto"><code>LibSANE.sane_init</code></p>
<p dir="auto"><code>LibSANE.sane_exit</code></p>
<p dir="auto"><code>LibSANE.sane_get_devices</code></p>
<p dir="auto"><code>LibSANE.sane_open</code></p>
<p dir="auto"><code>LibSANE.sane_close</code></p>
<p dir="auto"><code>LibSANE.sane_get_option_descriptor</code></p>
<p dir="auto"><code>LibSANE.sane_control_option_get_value</code></p>
<p dir="auto"><code>LibSANE.sane_control_option_set_value</code></p>
<p dir="auto"><code>LibSANE.sane_control_option_set_auto</code></p>
<p dir="auto"><code>LibSANE.sane_get_parameters</code></p>
<p dir="auto"><code>LibSANE.sane_start</code></p>
<p dir="auto"><code>LibSANE.sane_read</code></p>
<p dir="auto"><code>LibSANE.sane_cancel</code></p>
<p dir="auto"><code>LibSANE.sane_strstatus</code></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-license" aria-label="Heading link" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>License</h2>
<p dir="auto">Because of the weird state of SANE&#39;s licensing (GPL + linking exception, on some backends), see <a href="https://gitlab.com/sane-project/backends/-/blob/master/LICENSE" rel="nofollow">backends/LICENSE</a>. I releasing this project with dual licensing <a href="https://www.vrk.dev/goncalomb/sane-wasm/blob/master/LICENSE.txt">GNU GPLv2</a> + <a href="https://www.vrk.dev/goncalomb/sane-wasm/blob/master/LICENSE-LGPL.txt">GNU LGPLv2.1</a>. IANAL, you choose.</p>
</article>
          </div></div>
  </body>
</html>
