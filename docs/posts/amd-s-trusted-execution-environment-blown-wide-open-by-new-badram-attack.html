<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arstechnica.com/information-technology/2024/12/new-badram-attack-neuters-security-assurances-in-amd-epyc-processors/">Original</a>
    <h1>AMD&#39;s trusted execution environment blown wide open by new BadRAM attack</h1>
    
    <div id="readability-page-1" class="page"><article data-id="2065895">
  
  <header>
  <div>
  <div>
    <div>
      

      

      <p>
        Attack bypasses AMD protection promising security, even when a server is compromised.
      </p>

      
    </div>

    
  </div>
</div>
</header>


  

  
      
    
    <div>
      <div>

        
        <div>
                      
                      
          
<p>One of the oldest maxims in hacking is that once an attacker has physical access to a device, it’s game over for its security. The basis is sound. It doesn’t matter how locked down a phone, computer, or other machine is; if someone intent on hacking it gains the ability to physically manipulate it, the chances of success are all but guaranteed.</p>
<p>In the age of cloud computing, this widely accepted principle is no longer universally true. Some of the world’s most sensitive information—health records, financial account information, sealed legal documents, and the like—now often resides on servers that receive day-to-day maintenance from unknown administrators working in cloud centers thousands of miles from the companies responsible for safeguarding it.</p>
<h2>Bad (RAM) to the bone</h2>
<p>In response, chipmakers have begun baking protections into their silicon to provide assurances that even if a server has been physically tampered with or infected with malware, sensitive data funneled through virtual machines can’t be accessed without an encryption key that’s known only to the VM administrator. Under this scenario, admins inside the cloud provider, law enforcement agencies with a court warrant, and hackers who manage to compromise the server are out of luck.</p>
<p>On Tuesday, an international team of researchers unveiled BadRAM, a proof-of-concept attack that completely undermines security assurances that chipmaker AMD makes to users of one of its most expensive and well-fortified microprocessor product lines. Starting with the AMD Epyc 7003 processor, a feature known as SEV-SNP—short for <a href="https://www.amd.com/content/dam/amd/en/documents/epyc-business-docs/white-papers/SEV-SNP-strengthening-vm-isolation-with-integrity-protection-and-more.pdf">Secure Encrypted Virtualization and Secure Nested Paging</a>—has provided the cryptographic means for certifying that a VM hasn’t been compromised by any sort of backdoor installed by someone with access to the physical machine running it.</p>

          
                      
                  </div>

              </div>

      
      
    </div>
                    
        
          
    
    <div>
      <div>

        
        <div>
          
          
<p>If a VM has been backdoored, the cryptographic <a href="https://www.redhat.com/en/blog/attestation-confidential-computing">attestation</a> will fail and immediately alert the VM admin of the compromise. Or at least that’s how SEV-SNP is designed to work. BadRAM is an attack that a server admin can carry out in minutes, using either about $10 of hardware, or in some cases, software only, to cause DDR4 or DDR5 memory modules to misreport during bootup the amount of memory capacity they have. From then on, SEV-SNP will be permanently made to suppress the cryptographic hash attesting its integrity even when the VM has been badly compromised.</p>
<p>“BadRAM completely undermines trust in AMD&#39;s latest Secure Encrypted Virtualization (SEV-SNP) technology, which is widely deployed by major cloud providers, including Amazon AWS, Google Cloud, and Microsoft Azure,” members of the research team wrote in an email. “BadRAM for the first time studies the security risks of bad RAM—rogue memory modules that deliberately provide false information to the processor during startup. We show how BadRAM attackers can fake critical remote attestation reports and insert undetectable backdoors into _any_ SEV-protected VM.”</p>
<h2>Compromising the AMD SEV ecosystem</h2>
<p>On a <a href="https://badram.eu/">website</a> providing more information about the attack, the researchers wrote:</p>
<blockquote><p>Modern computers increasingly use encryption to protect sensitive data in DRAM, especially in shared cloud environments with pervasive data breaches and insider threats. AMD&#39;s Secure Encrypted Virtualization (SEV) is a cutting-edge technology that protects privacy and trust in cloud computing by encrypting a virtual machine&#39;s (VM&#39;s) memory and isolating it from advanced attackers, even those compromising critical infrastructure like the virtual machine manager or firmware.</p>
<p>We found that tampering with the embedded SPD chip on commercial DRAM modules allows attackers to bypass SEV protections—including AMD’s latest SEV-SNP version. For less than $10 in off-the-shelf equipment, we can trick the processor into allowing access to encrypted memory. We build on this BadRAM attack primitive to completely compromise the AMD SEV ecosystem, faking remote attestation reports and inserting backdoors into any SEV-protected VM.</p>
<p>In response to a vulnerability report filed by the researchers, AMD has already shipped patches to affected customers, a company spokesperson said. The researchers say there are no performance penalties, other than the possibility of additional time required during boot up. The BadRAM vulnerability is tracked in the industry as CVE-2024-21944 and AMD-SB-3015 by the chipmaker.</p></blockquote>

<h2>A stroll down memory lane</h2>
<p>Modern dynamic random access memory for servers typically comes in the form of DIMMs, short for <a href="https://en.wikipedia.org/wiki/DIMM">Dual In-Line Memory Modules</a>. The basic building block of these rectangular sticks are capacitors, which, when charged, represent a binary 1 and, when discharged, represent a 0. The capacitors are organized into cells, which are organized into arrays of rows and columns, which are further arranged into ranks and banks. The more capacitors that are stuffed into a DIMM, the more capacity it has to store data. Servers usually have multiple DIMMs that are organized into channels that can be processed in parallel.</p>

          
                  </div>

              </div>

      
      
    </div>
                    
        
          
    
    <div>
      <div>

        
        <div>
          
          
<p>For a server to store or access a particular piece of data, it first must locate where the bits representing it are stored in this vast configuration of transistors. Locations are tracked through addresses that map the channel, rank, bank row, and column. For performance reasons, the task of translating these physical addresses to DRAM address bits—a job assigned to the memory controller—isn’t a one-to-one mapping. Rather, consecutive addresses are spread across different channels, ranks, and banks.</p>
<p>Before the server can map these locations, it must first know how many DIMMs are connected and the total capacity of memory they provide. This information is provided each time the server boots, when the BIOS queries the SPD—short for <a href="https://en.wikipedia.org/wiki/Serial_presence_detect">Serial Presence Detect</a>—chip found on the surface of the DIMM. This chip is responsible for providing the BIOS basic information about available memory. BadRAM causes the SPD chip to report that its capacity is twice what it actually is. It does this by adding an extra addressing bit.</p>
<p>To do this, a server admin need only briefly connect a specially programmed <a href="https://www.raspberrypi.com/">Raspberry Pi</a> to the SPD chip just once.</p>
<figure>
    <p><img width="1993" height="1219" src="https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper.jpg" alt="" decoding="async" loading="lazy" srcset="https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper.jpg 1993w, https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper-640x391.jpg 640w, https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper-1024x626.jpg 1024w, https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper-768x470.jpg 768w, https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper-1536x939.jpg 1536w, https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper-980x599.jpg 980w, https://cdn.arstechnica.net/wp-content/uploads/2024/12/badram-hardware-spd-tamper-1440x881.jpg 1440w" sizes="auto, (max-width: 1993px) 100vw, 1993px"/>
                  </p>
          <figcaption>
        <div>
    
    <p>
      The researchers&#39; Raspberry Pi connected to the SPD chip of a DIMM.

              <span>
          Credit:

          
          De Meulemeester et al.

                  </span>
          </p>
  </div>
      </figcaption>
      </figure>

<h2>Hacking by numbers, 1, 2, 3</h2>
<p>In some cases, with certain DIMM models that don&#39;t adequately lock down the chip, the modification can likely be done through software. In either case, the modification need only occur once. From then on, the SPD chip will falsify the memory capacity available.</p>
<p>Next, the server admin configures the operating system to ignore the newly created &#34;ghost memory,&#34; meaning the top half of the capacity reported by the compromised SPD chip, but continue to map to the lower half of the real memory. On Linux, this configuration can be done with the `memmap` kernel command-line parameter. The researchers&#39; paper, titled <a href="https://badram.eu/badram.pdf">BadRAM: Practical Memory Aliasing Attacks on Trusted Execution Environments</a>, provides many more details about the attack.</p>

          
                  </div>

              </div>

      
      
    </div>
                    
        
          
    
    <div>
      <div>

        
        <div>
          
          
<p>Next, a script developed as part of BadRAM allows the attacker to quickly find the memory locations of ghost memory bits. These aliases give the attacker access to memory regions that SEV-SNP is supposed to make inaccessible. This allows the attacker to read and write to these protected memory regions.</p>
<p>Access to this normally fortified region of memory allows the attacker to copy the cryptographic hash SEV-SNP creates to attest to the integrity of the VM. The access also permits the attacker to boot an SEV-compliant VM that has been backdoored. Normally, this malicious VM would trigger a warning in the form of a cryptographic hash. BadRAM allows the attacker to replace this attestation failure hash with the attestation success hash collected earlier.</p>
<p>The primary steps involved in BadRAM attacks are:</p>
<ol>
<li>Compromise the memory module to lie about its size and thus trick the CPU into accessing the nonexistent ghost addresses that have been silently mapped to existing memory regions.</li>
<li>Find aliases. These addresses map to the same DRAM location.</li>
<li>Bypass CPU Access Control. The aliases allow the attacker to bypass memory protections that are supposed to prevent the reading of and writing to regions storing sensitive data.</li>
</ol>

<h2>Beware of the ghost bit</h2>
<p>For those looking for more technical details, Jesse De Meulemeester, who along with Luca Wilke was lead co-author of the paper, provided the following, which more casual readers can skip:</p>
<blockquote><p>In our attack, there are two addresses that go to the same DRAM location; one is the original address, the other one is what we call the alias.</p>
<p>When we modify the SPD, we double its size. At a low level, this means all memory addresses now appear to have one extra bit. This extra bit is what we call the &#34;ghost&#34; bit, it is the address bit that is used by the CPU, but is not used (thus ignored) by the DIMM. The addresses for which this &#34;ghost&#34; bit is 0 are the original addresses, and the addresses for which this bit is 1 is the &#34;ghost&#34; memory.</p>
<p>This explains how we can access protected data like the launch digest. The launch digest is stored at an address with the ghost bit set to 0, and this address is protected; any attempt to access it is blocked by the CPU. However, if we try to access the same address with the ghost bit set to 1, the CPU treats it as a completely new address and allows access. On the DIMM side, the ghost bit is ignored, so both addresses (with ghost bit 0 or 1) point to the same physical memory location.</p>
<p>A small example to illustrate this:</p>
<p>Original SPD: 4 bit addresses:</p>
<p>Modified SPD: Reports 5 bits even though it only has 4:</p>
<p>In this case 01101 is the protected address, 11101 is the alias. Even though to the CPU they seem like two different addresses, they go to the same DRAM location.</p></blockquote>
<p>As noted earlier, some DIMM models don&#39;t lock down the SPD chip, a failure that likely makes software-only modifications possible. Specifically, the researchers found that two DDR4 models made by Corsair contained this flaw.</p>

          
                  </div>

              </div>

      
      
    </div>
                    
        
          
    
    <div>
      <div>

        
        <div>
          
          
<p>In a statement, AMD officials wrote:</p>
<blockquote><p>AMD believes exploiting the disclosed vulnerability requires an attacker either having physical access to the system, operating system kernel access on a system with unlocked memory modules, or installing a customized, malicious BIOS. AMD recommends utilizing memory modules that lock Serial Presence Detect (SPD), as well as following physical system security best practices. AMD has also released firmware updates to customers to mitigate the vulnerability.</p></blockquote>
<p>Members of the research team are from KU Leuven, the University of Lübeck, and the University of Birmingham. Specifically, they are:</p>
<ul>
<li><a href="https://www.esat.kuleuven.be/cosic/people/person/?u=u0156850">Jesse De Meulemeester</a> (<a href="https://www.esat.kuleuven.be/cosic/">COSIC</a>, <a href="https://www.esat.kuleuven.be/english">Department of Electrical Engineering</a>, <a href="https://www.kuleuven.be/english/kuleuven/index.html">KU Leuven</a>)</li>
<li><a href="https://luca-wilke.com/">Luca Wilke</a> (<a href="https://www.its.uni-luebeck.de/en/institute">University of Lübeck</a>)</li>
<li><a href="https://www.birmingham.ac.uk/staff/profiles/computer-science/academic-staff/oswald-david">David Oswald</a> (<a href="https://www.birmingham.ac.uk/">University of Birmingham</a>)</li>
<li><a href="https://www.its.uni-luebeck.de/en/staff/thomas-eisenbarth">Thomas Eisenbarth</a> (<a href="https://www.its.uni-luebeck.de/en/institute">University of Lübeck</a>)</li>
<li><a href="https://www.esat.kuleuven.be/cosic/people/person/?u=u0018159">Ingrid Verbauwhede</a> (<a href="https://www.esat.kuleuven.be/cosic/">COSIC</a>, <a href="https://www.esat.kuleuven.be/english">Department of Electrical Engineering</a>, <a href="https://www.kuleuven.be/english/kuleuven/index.html">KU Leuven</a>)</li>
<li><a href="https://vanbulck.net/">Jo Van Bulck</a> (<a href="https://distrinet.cs.kuleuven.be/">DistriNet</a>, <a href="https://wms.cs.kuleuven.be/cs/english">Department of Computer Science</a>, <a href="https://www.kuleuven.be/english/kuleuven/index.html">KU Leuven</a>)</li>
</ul>
<p>The researchers tested BadRAM against the Intel SGX, a competing microprocessor sold by AMD&#39;s much bigger rival promising integrity assurances comparable to SEV-SNP. The classic, now-discontinued version of the SGX did allow reading of protected regions, but not writing to them. The current Intel Scalable SGX and Intel TDX processors, however, allowed no reading or writing. Since a comparable Arm processor wasn&#39;t available for testing, it&#39;s unknown if it&#39;s vulnerable.</p>
<p>Despite the lack of universality, the researchers warned that the design flaws underpinning the BadRAM vulnerability may creep into other systems and should always use the mitigations AMD has now put in place.</p>
<p>&#34;Since our BadRAM primitive is generic, we argue that such countermeasures should be considered when designing a system against untrusted DRAM,&#34; the researchers wrote in their paper. &#34;While advanced hardware-level attacks could potentially circumvent the currently used countermeasures, further research is required to judge whether they can be carried out in an impactful attacker model.&#34;</p>


          
                  </div>

                  
          






  <div>
    <div>
  <div>
          <p><a href="https://arstechnica.com/author/dan-goodin/"><img src="https://arstechnica.com/wp-content/uploads/2018/10/Dang.jpg" alt="Photo of Dan Goodin"/></a></p>
  </div>

  <div>
    

    <p>
      Dan Goodin is Senior Security Editor at Ars Technica, where he oversees coverage of malware, computer espionage, botnets, hardware hacking, encryption, and passwords. In his spare time, he enjoys gardening, cooking, and following the independent music scene. Dan is based in San Francisco. Follow him at <a href="https://infosec.exchange/@dangoodin" rel="me">here</a> on Mastodon and <a href="https://bsky.app/profile/dangoodin.bsky.social">here</a> on Bluesky. Contact him on Signal at DanArs.82.
    </p>
  </div>
</div>
  </div>


  
              </div>

      
      
    </div>
  </article></div>
  </body>
</html>
