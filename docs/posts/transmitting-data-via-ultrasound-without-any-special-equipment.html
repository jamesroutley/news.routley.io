<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://halcy.de/blog/2025/06/27/transmitting-data-via-ultrasound-without-any-special-equipment/">Original</a>
    <h1>Transmitting data via ultrasound without any special equipment</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>There are secret messages flying all around you all the time, being transmitted via, most of the time, <a href="https://en.wikipedia.org/wiki/Electromagnetic_spectrum">electromagnetic waves</a> going from antenna to antenna. </p>
<p><a href="https://halcy.de/blog/images/2025_06_27_elo.jpg" target="_blank"><img alt="Frame taken from the music video for Secret Messages, showing a man with big hair and aviators in front of a big sattelite dish, arms crossed" src="https://halcy.de/blog/images/2025_06_27_elo.jpg" title="Frame taken from the music video for Secret Messages, showing a man with big hair and aviators in front of a big sattelite dish, arms crossed" width="50%"/></a></p>
<p><em><a href="https://www.youtube.com/watch?v=eDAcbxz0fuQ">ELOs “Secret Messages”</a> is a song about posting conspiracy theories via WiFi.</em></p>
<p>But what if you need to get a few bytes from device A to device B (one of the hard problems in computer science!) and you don’t feel like making sure they’re both connected to the same network? Well, fortunately, another channel is available to us - sound, or for a more fun and less-audible experience, <em>ultrasound</em>.</p>

<h3 id="what-even-is-ultrasound">What even is ultrasound</h3>
<p>Sound that you can hear is, physically, the air vibrating, or <a href="https://en.wikipedia.org/wiki/Longitudinal_wave">being compressed and relaxed again and again, rapidly</a>. Our ears (or our computers ears - microphones) can pick up this pressure variation. While a computer microphone picks this pressure variation up pretty much directly (and that is, in fact, what you see when you look at an audio <em>waveform</em> - it’s a measure of the pressure relative to ambient), the ear, and our perception, and most useful audio processing algorithms, work in the <em>frequency</em> domain. While you can take entire classes on this, the short version is: Every audio signal can be <a href="https://en.wikipedia.org/wiki/Fourier_transform">decomposed into <em>frequency components</em></a> - sine waves with a certain number of vibrations per second (the <em>frequency</em>, in Hz), which then lets you see how much energy the signal has at each frequency. If you’ve ever seen a bunch of bars go up and down on some kind of audio player - that’s exactly the frequency domain, usually with lower pitch / lower <em>frequencies</em> on the left and higher on the right, showing how much of the sound you are hearing is low-pitched, bassy rumbling, versus mid tones, versus highs.</p>
<table>
<thead>
<tr>
<th><a href="https://halcy.de/blog/images/2025_06_27_pioneer.jpg" target="_blank"><img alt="Pioneer car stereo showing the spectrum analyzer" height="10em" src="https://halcy.de/blog/images/2025_06_27_pioneer.jpg" title="Pioneer car stereo showing the spectrum analyzer"/></a><em></em></th>
<th><a href="https://halcy.de/blog/images/2025_06_27_winamp.png" target="_blank"><img alt="Winamp main window showing the spectrum analyzer" height="10em" src="https://halcy.de/blog/images/2025_06_27_winamp.png" title="Winamp main window showing the spectrum analyzer"/></a><em></em></th>
<th><a href="https://halcy.de/blog/images/2025_06_27_tiktok.png" target="_blank"><img alt="A tiktok video showing a spectrum analyzer" height="10em" src="https://halcy.de/blog/images/2025_06_27_tiktok.png" title="Pioneer car stereo showing the spectrum analyzer"/></a><em></em></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>That wording already implies something, which is that there is some reasonable low-mid-high range for these frequencies. For us humans, that is from about 10 to 20 Hz (sub-bass, more of a thing you feel in your stomach than you really hear) to about 20000 Hz, though as people grow older, that upper limit decreases quite a bit, and you become unable to hear the highest tones<sup id="fnref:1"><a href="#fn:1">1</a></sup>. Sound past that 20000 Hz barrier is what we call <em>ultrasound</em> - sound that is beyond (most) human ears ability to hear.</p>
<h3 id="ultrasound-and-your-computer">Ultrasound and you(r computer)</h3>
<p>If you think of a thing that comes to mind when you hear “ultrasound”, it might be <a href="https://en.wikipedia.org/wiki/Medical_ultrasound">the thing that a doctor uses to look at what’s going on inside of you</a> (most prominently, to check how a baby that is growing inside of you is doing). So you might be forgiven if you think of it as something that requires special devices with fun names like <em>transducer</em> or whatever. Not so! While our technical devices are, of course, designed to operate broadly in the same range as our ears, they generally can go a little bit beyond that. Yes, even your shitty laptop speakers and microphone are, technically, ultrasound-capable devices! And while they do usually pretty heavily start to cut frequencies once you get to about 18000 Hz or thereabouts for <a href="https://en.wikipedia.org/wiki/Anti-aliasing_filter#Audio_applications">technical reasons</a>, you can probably still get a signal through, and it’ll be almost or completely inaudible to most people<sup id="fnref:2"><a href="#fn:2">2</a></sup>.</p>
<h3 id="so-lets-transmit-some-data">So lets transmit some data</h3>
<p>To recap:</p>
<ul>
<li>We can play audio from a normal computer speaker that is not audible to most people</li>
<li>We can record that audio with a normal computer microphone</li>
</ul>
<p>So if we can encode some data into that audio signal somewhere in that high frequency range, we can transmit data! How do we do that? This is usually the point where we’d have to write some python or C code, which if you wanted to play along, you’d have to run. Fortunately (?)<sup id="fnref:3"><a href="#fn:3">3</a></sup>, there is now WebAudio, which is audio for the web, so instead, <a href="https://kal-tsit.halcy.de/ultrasound/">I can link you to a website</a>! I’ve implemented two variants:</p>
<ul>
<li>The thing that comes to mind immediately when you think of “how to transmit letters over audio” - Morse code dots and dashes. I’m going to skip over this, since it didn’t work super well so I pivoted to:</li>
<li>Since that works poorly and is actually a real pain to decode with a computer, a sort of return-to-zero frequency shift keying, where the data is encoded as shifts in the pitch of a beep.</li>
</ul>
<p><a href="https://kal-tsit.halcy.de/ultrasound/"><img alt="Screenshot of the linked website, with textboxes for sending data and receiving data." src="https://halcy.de/blog/images/2025_06_27_screenshot.png" title="Screenshot of the linked website, with textboxes for sending data and receiving data." width="80%"/></a></p>
<p><em><a href="https://kal-tsit.halcy.de/ultrasound/">Open the website on both your phone and your laptop and try shooting some messages back and forth!</a></em></p>
<p>Here’s the relevant excerpt from the encoder:</p>
<div><table><tbody><tr><td><div><pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span></pre></div></td><td><div><pre><span></span><code><span>// Turn a sequence of 0s and 1s (as a string) into a RTZ FSK audio signal</span>
<span>function</span><span> </span><span>playSequence</span><span>(</span><span>bits</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>const</span><span> </span><span>now</span><span> </span><span>=</span><span> </span><span>audioCtx</span><span>.</span><span>currentTime</span><span>;</span>

<span>    </span><span>// The oscillator generates a sine wave at a specified frequency</span>
<span>    </span><span>const</span><span> </span><span>osc</span><span> </span><span>=</span><span> </span><span>audioCtx</span><span>.</span><span>createOscillator</span><span>();</span>
<span>    </span><span>const</span><span> </span><span>gainNode</span><span> </span><span>=</span><span> </span><span>audioCtx</span><span>.</span><span>createGain</span><span>();</span>

<span>    </span><span>// Fade in the oscillator to avoid turn-on click</span>
<span>    </span><span>osc</span><span>.</span><span>connect</span><span>(</span><span>gainNode</span><span>).</span><span>connect</span><span>(</span><span>audioCtx</span><span>.</span><span>destination</span><span>);</span>
<span>    </span><span>osc</span><span>.</span><span>frequency</span><span>.</span><span>setValueAtTime</span><span>(</span><span>fp</span><span>,</span><span> </span><span>now</span><span>);</span>
<span>    </span><span>gainNode</span><span>.</span><span>gain</span><span>.</span><span>setValueAtTime</span><span>(</span><span>0</span><span>,</span><span> </span><span>now</span><span>);</span>
<span>    </span><span>gainNode</span><span>.</span><span>gain</span><span>.</span><span>linearRampToValueAtTime</span><span>(</span><span>1</span><span>,</span><span> </span><span>now</span><span> </span><span>+</span><span> </span><span>fadeTime</span><span>);</span>

<span>    </span><span>// Send all the bits</span>
<span>    </span><span>const</span><span> </span><span>startTime</span><span> </span><span>=</span><span> </span><span>now</span><span> </span><span>+</span><span> </span><span>fadeTime</span><span>;</span>
<span>    </span><span>const</span><span> </span><span>rampTime</span><span> </span><span>=</span><span> </span><span>ramp</span><span>;</span>
<span>    </span><span>for</span><span> </span><span>(</span><span>let</span><span> </span><span>i</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span><span> </span><span>i</span><span> </span><span>&lt;</span><span> </span><span>bits</span><span>.</span><span>length</span><span>;</span><span> </span><span>i</span><span>++</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>// Decide to which frequency we are going to change</span>
<span>        </span><span>const</span><span> </span><span>bit</span><span> </span><span>=</span><span> </span><span>bits</span><span>[</span><span>i</span><span>];</span>
<span>        </span><span>const</span><span> </span><span>dataFreq</span><span> </span><span>=</span><span> </span><span>bit</span><span> </span><span>===</span><span> </span><span>&#39;1&#39;</span><span> </span><span>?</span><span> </span><span>f1</span><span> </span><span>:</span><span> </span><span>f0</span><span>;</span>

<span>        </span><span>// Compute start and end times</span>
<span>        </span><span>const</span><span> </span><span>t0</span><span> </span><span>=</span><span> </span><span>startTime</span><span> </span><span>+</span><span> </span><span>i</span><span> </span><span>*</span><span> </span><span>bitDuration</span><span>;</span>
<span>        </span><span>const</span><span> </span><span>t1</span><span> </span><span>=</span><span> </span><span>t0</span><span> </span><span>+</span><span> </span><span>pilotDur</span><span>;</span>
<span>        </span><span>const</span><span> </span><span>t2</span><span> </span><span>=</span><span> </span><span>t1</span><span> </span><span>+</span><span> </span><span>dataDur</span><span>;</span>

<span>        </span><span>// Transition from pilot tone to one of two data tones</span>
<span>        </span><span>osc</span><span>.</span><span>frequency</span><span>.</span><span>setValueAtTime</span><span>(</span><span>fp</span><span>,</span><span> </span><span>t1</span><span> </span><span>-</span><span> </span><span>rampTime</span><span>);</span>
<span>        </span><span>osc</span><span>.</span><span>frequency</span><span>.</span><span>linearRampToValueAtTime</span><span>(</span><span>dataFreq</span><span>,</span><span> </span><span>t1</span><span>);</span>

<span>        </span><span>// Transition from data tone back to pilot tone</span>
<span>        </span><span>osc</span><span>.</span><span>frequency</span><span>.</span><span>setValueAtTime</span><span>(</span><span>dataFreq</span><span>,</span><span> </span><span>t2</span><span> </span><span>-</span><span> </span><span>rampTime</span><span>);</span>
<span>        </span><span>osc</span><span>.</span><span>frequency</span><span>.</span><span>linearRampToValueAtTime</span><span>(</span><span>fp</span><span>,</span><span> </span><span>t2</span><span>);</span>
<span>    </span><span>}</span>

<span>    </span><span>// Fade out the oscillator to avoid turn-off click</span>
<span>    </span><span>const</span><span> </span><span>endTime</span><span> </span><span>=</span><span> </span><span>startTime</span><span> </span><span>+</span><span> </span><span>bits</span><span>.</span><span>length</span><span> </span><span>*</span><span> </span><span>bitDuration</span><span>;</span>
<span>    </span><span>gainNode</span><span>.</span><span>gain</span><span>.</span><span>setValueAtTime</span><span>(</span><span>1</span><span>,</span><span> </span><span>endTime</span><span>);</span>
<span>    </span><span>gainNode</span><span>.</span><span>gain</span><span>.</span><span>linearRampToValueAtTime</span><span>(</span><span>0</span><span>,</span><span> </span><span>endTime</span><span> </span><span>+</span><span> </span><span>fadeTime</span><span>);</span>

<span>    </span><span>// Activate</span>
<span>    </span><span>osc</span><span>.</span><span>start</span><span>(</span><span>now</span><span>);</span>
<span>    </span><span>osc</span><span>.</span><span>stop</span><span>(</span><span>endTime</span><span> </span><span>+</span><span> </span><span>fadeTime</span><span> </span><span>+</span><span> </span><span>0.001</span><span>);</span>
<span>}</span>
</code></pre></div></td></tr></tbody></table></div>
<p>The characters are encoded as 8-bit ascii, with a <em>preamble</em> of 10 0s before the actual signal, and each character framed by two 1s, which makes it reasonably easy to find the state of the message.</p>
<p>The resulting audio looks like this, with the waveform below, and a <em>spectrogram</em> - essentially, a lot of those spectrum analyzers laid on the side and taped to each other, with the colour getting more intense the higher the bar - on top:</p>
<p><a href="https://halcy.de/blog/images/2025_06_27_fsk.png" target="_blank"><img alt="A screenshot of audacity, in which you can see a waveform (that seems loud, but that&#39;s about it) and a spectrogram (in which the encoded characters are clearly visible)" src="https://halcy.de/blog/images/2025_06_27_fsk.png" title="A screenshot of audacity, in which you can see a waveform (that seems loud, but that&#39;s about it) and a spectrogram (in which the encoded characters are clearly visible)"/></a></p>
<p>On the receiving end, the shifts in frequency are detected (by computing the spectrum and looking at which frequency has the most energy in it), turned back into bits, and finally, characters.</p>
<div><table><tbody><tr><td><div><pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span></pre></div></td><td><div><pre><span></span><code><span>function</span><span> </span><span>process</span><span>()</span><span> </span><span>{</span>
<span>    </span><span>// Get band energy from analyzers</span>
<span>    </span><span>const</span><span> </span><span>dP</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Float32Array</span><span>(</span><span>analyserP</span><span>.</span><span>frequencyBinCount</span><span>);</span>
<span>    </span><span>const</span><span> </span><span>d0</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Float32Array</span><span>(</span><span>analyser0</span><span>.</span><span>frequencyBinCount</span><span>);</span>
<span>    </span><span>const</span><span> </span><span>d1</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>Float32Array</span><span>(</span><span>analyser1</span><span>.</span><span>frequencyBinCount</span><span>);</span>
<span>    </span><span>analyserP</span><span>.</span><span>getFloatFrequencyData</span><span>(</span><span>dP</span><span>);</span>
<span>    </span><span>analyser0</span><span>.</span><span>getFloatFrequencyData</span><span>(</span><span>d0</span><span>);</span>
<span>    </span><span>analyser1</span><span>.</span><span>getFloatFrequencyData</span><span>(</span><span>d1</span><span>);</span>

<span>    </span><span>// Pick the bin with the correct frequency</span>
<span>    </span><span>const</span><span> </span><span>binP</span><span> </span><span>=</span><span> </span><span>Math</span><span>.</span><span>round</span><span>(</span><span>fp</span><span> </span><span>/</span><span> </span><span>(</span><span>audioCtx</span><span>.</span><span>sampleRate</span><span> </span><span>/</span><span> </span><span>analyserP</span><span>.</span><span>fftSize</span><span>));</span>
<span>    </span><span>const</span><span> </span><span>bin0</span><span> </span><span>=</span><span> </span><span>Math</span><span>.</span><span>round</span><span>(</span><span>f0</span><span> </span><span>/</span><span> </span><span>(</span><span>audioCtx</span><span>.</span><span>sampleRate</span><span> </span><span>/</span><span> </span><span>analyser0</span><span>.</span><span>fftSize</span><span>));</span>
<span>    </span><span>const</span><span> </span><span>bin1</span><span> </span><span>=</span><span> </span><span>Math</span><span>.</span><span>round</span><span>(</span><span>f1</span><span> </span><span>/</span><span> </span><span>(</span><span>audioCtx</span><span>.</span><span>sampleRate</span><span> </span><span>/</span><span> </span><span>analyser1</span><span>.</span><span>fftSize</span><span>));</span>
<span>    </span><span>const</span><span> </span><span>maxP</span><span> </span><span>=</span><span> </span><span>dP</span><span>[</span><span>binP</span><span>];</span>
<span>    </span><span>const</span><span> </span><span>max0</span><span> </span><span>=</span><span> </span><span>d0</span><span>[</span><span>bin0</span><span>];</span>
<span>    </span><span>const</span><span> </span><span>max1</span><span> </span><span>=</span><span> </span><span>d1</span><span>[</span><span>bin1</span><span>];</span>

<span>    </span><span>// Edge detect</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>rxState</span><span> </span><span>===</span><span> </span><span>&#39;pilot&#39;</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>if</span><span> </span><span>(</span><span>max0</span><span> </span><span>&gt;</span><span> </span><span>maxP</span><span> </span><span>+</span><span> </span><span>margin</span><span> </span><span>&amp;&amp;</span><span> </span><span>max0</span><span> </span><span>&gt;</span><span> </span><span>threshold</span><span>)</span><span> </span><span>{</span>
<span>            </span><span>bufferBits</span><span> </span><span>+=</span><span> </span><span>&#39;0&#39;</span><span>;</span>
<span>            </span><span>rxState</span><span> </span><span>=</span><span> </span><span>&#39;data&#39;</span><span>;</span>
<span>        </span><span>}</span><span> </span><span>else</span><span> </span><span>if</span><span> </span><span>(</span><span>max1</span><span> </span><span>&gt;</span><span> </span><span>maxP</span><span> </span><span>+</span><span> </span><span>margin</span><span> </span><span>&amp;&amp;</span><span> </span><span>max1</span><span> </span><span>&gt;</span><span> </span><span>threshold</span><span>)</span><span> </span><span>{</span>
<span>            </span><span>bufferBits</span><span> </span><span>+=</span><span> </span><span>&#39;1&#39;</span><span>;</span>
<span>            </span><span>rxState</span><span> </span><span>=</span><span> </span><span>&#39;data&#39;</span><span>;</span>
<span>        </span><span>}</span>
<span>    </span><span>}</span><span> </span><span>else</span><span> </span><span>if</span><span> </span><span>(</span><span>rxState</span><span> </span><span>===</span><span> </span><span>&#39;data&#39;</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>if</span><span> </span><span>(</span><span>maxP</span><span> </span><span>&gt;</span><span> </span><span>max0</span><span> </span><span>+</span><span> </span><span>margin</span><span> </span><span>&amp;&amp;</span><span> </span><span>maxP</span><span> </span><span>&gt;</span><span> </span><span>max1</span><span> </span><span>+</span><span> </span><span>margin</span><span> </span><span>&amp;&amp;</span><span> </span><span>maxP</span><span> </span><span>&gt;</span><span> </span><span>threshold</span><span>)</span><span> </span><span>{</span>
<span>            </span><span>rxState</span><span> </span><span>=</span><span> </span><span>&#39;pilot&#39;</span><span>;</span>
<span>        </span><span>}</span>
<span>    </span><span>}</span>
<span>    </span><span>decodeBuffer</span><span>();</span>
<span>}</span>

<span>// Detect preamble and decode frames</span>
<span>function</span><span> </span><span>decodeBuffer</span><span>()</span><span> </span><span>{</span>
<span>    </span><span>// Find preamble: ten zeros (pilot pulses)</span>
<span>    </span><span>const</span><span> </span><span>preamble</span><span> </span><span>=</span><span> </span><span>&#39;0000000000&#39;</span><span>;</span>
<span>    </span><span>const</span><span> </span><span>preambleIdx</span><span> </span><span>=</span><span> </span><span>bufferBits</span><span>.</span><span>indexOf</span><span>(</span><span>preamble</span><span>,</span><span> </span><span>0</span><span>);</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>preambleIdx</span><span> </span><span>&gt;=</span><span> </span><span>0</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>// Found preamble, cut everything before it from buffer</span>
<span>        </span><span>bufferBits</span><span> </span><span>=</span><span> </span><span>bufferBits</span><span>.</span><span>slice</span><span>(</span><span>preambleIdx</span><span> </span><span>+</span><span> </span><span>preamble</span><span>.</span><span>length</span><span>);</span>
<span>        </span><span>log</span><span>(</span><span>&#39;Syncing to preamble at index &#39;</span><span> </span><span>+</span><span> </span><span>preambleIdx</span><span> </span><span>+</span><span> </span><span>&#39;, remaining bits: &#39;</span><span> </span><span>+</span><span> </span><span>bufferBits</span><span>.</span><span>length</span><span>);</span>
<span>        </span><span>return</span><span>;</span>
<span>    </span><span>}</span>

<span>    </span><span>if</span><span> </span><span>(</span><span>bufferBits</span><span>.</span><span>length</span><span> </span><span>&lt;</span><span> </span><span>10</span><span>)</span><span> </span><span>return</span><span>;</span><span> </span><span>// Need at least 10 bits for a frame</span>
<span>    </span><span>log</span><span>(</span><span>&#39;Buffer bits: &#39;</span><span> </span><span>+</span><span> </span><span>bufferBits</span><span>);</span>

<span>    </span><span>// Parse frame: start(1), data LSB, stop(1)</span>
<span>    </span><span>const</span><span> </span><span>frame</span><span> </span><span>=</span><span> </span><span>bufferBits</span><span>.</span><span>slice</span><span>(</span><span>0</span><span>,</span><span> </span><span>10</span><span>);</span>
<span>    </span><span>if</span><span> </span><span>(</span><span>frame</span><span>[</span><span>0</span><span>]</span><span> </span><span>!==</span><span> </span><span>&#39;1&#39;</span><span> </span><span>||</span><span> </span><span>frame</span><span>[</span><span>9</span><span>]</span><span> </span><span>!==</span><span> </span><span>&#39;1&#39;</span><span>)</span><span> </span><span>{</span>
<span>        </span><span>// Frame invalid, drop one bit and retry</span>
<span>        </span><span>log</span><span>(</span><span>&#39;Invalid frame start or end: &#39;</span><span> </span><span>+</span><span> </span><span>frame</span><span>);</span>
<span>        </span><span>bufferBits</span><span> </span><span>=</span><span> </span><span>bufferBits</span><span>.</span><span>slice</span><span>(</span><span>1</span><span>);</span>
<span>    </span><span>}</span><span> </span><span>else</span><span> </span><span>{</span>
<span>        </span><span>// Valid frame, decode data</span>
<span>        </span><span>let</span><span> </span><span>c</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span>
<span>        </span><span>for</span><span> </span><span>(</span><span>let</span><span> </span><span>i</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span><span> </span><span>i</span><span> </span><span>&lt;</span><span> </span><span>8</span><span>;</span><span> </span><span>i</span><span>++</span><span>)</span>
<span>            </span><span>if</span><span> </span><span>(</span><span>frame</span><span>[</span><span>1</span><span> </span><span>+</span><span> </span><span>i</span><span>]</span><span> </span><span>===</span><span> </span><span>&#39;1&#39;</span><span>)</span><span> </span><span>c</span><span> </span><span>|=</span><span> </span><span>(</span><span>1</span><span> </span><span>&lt;&lt;</span><span> </span><span>i</span><span>);</span>
<span>        </span><span>const</span><span> </span><span>char</span><span> </span><span>=</span><span> </span><span>String</span><span>.</span><span>fromCharCode</span><span>(</span><span>c</span><span>);</span>
<span>        </span><span>recvOutput</span><span>.</span><span>value</span><span> </span><span>+=</span><span> </span><span>char</span><span>;</span>
<span>        </span><span>log</span><span>(</span><span>&#39;Decoded char: &#39;</span><span> </span><span>+</span><span> </span><span>char</span><span>);</span>
<span>        </span><span>bufferBits</span><span> </span><span>=</span><span> </span><span>bufferBits</span><span>.</span><span>slice</span><span>(</span><span>10</span><span>);</span>
<span>    </span><span>}</span>
<span>}</span>
</code></pre></div></td></tr></tbody></table></div>
<h3 id="does-it-work">Does it work?</h3>
<p>Sure does:</p>
<table>
<thead>
<tr>
<th><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/-78mqVC5Y1Y?si=bqHwz_WoBqFSmEn6" title="YouTube video player" width="100%"></iframe><em></em></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
<p>You can even kind of find the audio of the encoded message in the audio track of that video (not audible, of course, at least not to my ears).</p>
<p>There are many issues - it’s not robust against interference at all (and once decoding breaks down, it probably won’t recover), there’s almost no error detection and certainly no correction, it’s slow (if I go past 10 or so bits per second, things break), the frequencies I use are relatively low because that makes things easier (so with headphones and if you are younger than me, you can probably hear it beep), etc. It could be vastly improved by someone who is better at <span>DSP</span> or better at <span>JS</span> than me. </p>
<p>If that is you, feel free to grab the code and add, I don’t know, <a href="https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction">Reed-Solomon</a> error correction for the bitstream (which I tried to do but all the libraries I found are confusing to use for someone who isn’t that good at <span>JS</span>, and I don’t want to implement it myself), or a <a href="https://en.wikipedia.org/wiki/Matched_filter">decoder that isn’t quite so ad-hoc</a>, or whatever else comes to mind. The source code is available via view source, or here: <a href="https://gist.github.com/halcy/d20b0bc2de82ceae2f6ba8a83901b265">https://gist.github.com/halcy/d20b0bc2de82ceae2f6ba8a83901b265</a>. Build the secret ultrasound proximity chat application of all our dreams, exfiltrate some data clandestinely, I’m sure you can come up with something.</p>
<h3 id="the-twist">The twist</h3>
<p>So, it’s a neat, but pretty useless hack, right? Not entirely: This type of signal is actually used by calling sofware to help figure whether there are other devices close to you that are already in a given meeting, in addition to other stuff like bluetooth beacons. Though, there (I presume) the encoding is a bit more robust. Get yourself a spectrum analyzer app for your phone and go hunting for the signal the next time you join a call!</p>
<p>Anyways, I hope you have a good day today, and remember:</p>
<p><audio controls="" preload="none">
<source src="/blog/images/2025_06_27_secret.wav" type="audio/wav"/>
  Your browser doesn’t support <span>HTML5</span> audio.
</audio></p>
<hr/>

	
	
    </div></div>
  </body>
</html>
