<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vermaden.wordpress.com/2026/01/18/200-mb-ram-freebsd-desktop/">Original</a>
    <h1>200 MB RAM FreeBSD Desktop</h1>
    
    <div id="readability-page-1" class="page"><div>
			<p>Recently I came across <a href="https://x.com/LundukeJournal/status/2011916057678614926">Lunduke</a> post about some mysterious <a href="https://vendefoul-wolf-linux.sourceforge.io/index_en.html">Vendefoul Wolf</a> Linux distribution that uses <b>217 MB RAM</b> with <b>Devuan</b> as base (no <tt><b>systemd(1)</b></tt> here) and <b>XLibre</b> X11 server along with <b>IceWM</b> window manager.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/lunduke-tweet.jpg"/></p>
<p>For the record ‚Äì the <a href="https://x.com/LundukeJournal/status/2011916057678614926">Lunduke</a> post states <b>200 MB RAM</b> but <a href="https://x.com/XLibreDev/status/2011919058321510537">XLibreDev</a> quotes a post where exactly <b>217 MB RAM</b> is reported.</p>
<p>Later <a href="https://youtu.be/WGf5OeL4YHE">Lunduke</a> even posted a video about it.</p>

<p>As I use similarly low resource setup with <b>Openbox</b>/<b>Tint2</b>/<b>Dzen2</b> setup (documented <a href="https://vermaden.wordpress.com/freebsd-desktop/">FreeBSD Desktop</a> here) I was wondering ‚Ä¶ how low can I go with FreeBSD RAM usage.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2019/04/freebsd-desktop-2019-04.jpg"/></p>
<p>Lets try ‚Ä¶</p>
<p>The <i>Table of Contents</i> is as follows.</p>
<ul>
<li><strong>Install</strong></li>
<li><strong>Configuration</strong>
<ul>
<li><strong><tt>/boot/loader.conf</tt></strong></li>
<li><strong><tt>/etc/rc.conf</tt></strong></li>
<li><strong><tt>/etc/sysctl.conf</tt></strong></li>
<li><strong><tt>/etc/devfs.rules</tt></strong></li>
<li><strong>Installed Packages</strong></li>
<li><strong>Login Manager</strong></li>
<li><strong><tt>~/.xinitrc</tt></strong></li>
</ul>
</li>
<li><strong>Startup</strong></li>
<li><strong>RAM Usage</strong></li>
<li><strong>End Session</strong></li>
<li><strong>Comparison</strong></li>
<li><strong>Summary</strong></li>
</ul>

<p>I wanted to use most recent FreeBSD so I used <b>15.0-RELEASE</b> version ‚Äì including the <i>Tech Preview</i> <b>PKGBASE</b> setup for FreeBSD <i>Base System</i>.</p>
<p>As <b>Xorg</b> X11 implementation is currently intentionally crippled by some <i>Red Hat</i> employees and some people from <i>FreeDesktop.org</i> I decided to use actively developed and maintained <b>XLibre</b> X11 server instead.</p>
<p>Example of such behavior below.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/x11-kill-social-media.png"/></p>
<p>More on that tragic <b>Xorg</b> story where open source spirit died long time ago is available here:</p>
<ul>
<li><a href="https://youtu.be/iwaaSatk0pI">https://youtu.be/iwaaSatk0pI</a></li>
<li><a href="https://youtu.be/ONdcalK5JLQ">https://youtu.be/ONdcalK5JLQ</a></li>
<li><a href="https://youtu.be/ujJCyXfWpOo">https://youtu.be/ujJCyXfWpOo</a></li>
<li><a href="https://youtu.be/WdlhHOLaRgQ">https://youtu.be/WdlhHOLaRgQ</a></li>
</ul>
<p>A lot has also been explained in this message:</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/xlibre-message.png"/></p>
<p>As the <a href="https://vendefoul-wolf-linux.sourceforge.io/index_en.html">Vendefoul Wolf</a> Linux did not used ZFS I also decided to fight fair and used UFS with <i>Soft Updates Journaling</i> mode that minimizes <tt><b>fsck(8)</b></tt> time to minimum. For the record <i>Netflix</i> also uses FreeBSD with UFS filesystem.</p>
<p>Using UFS would mean loosing great FreeBSD feature called <i>ZFS Boot Environments</i> ‚Ä¶ but fortunately you can use <a href="https://vermaden.wordpress.com/2021/04/02/ufs-boot-environments/">UFS Boot Environments</a> as replacement on UFS filesystems.</p>

<p>After install I created my <tt><b>vermaden</b></tt> user with membership in these groups.</p>
<pre><strong>FreeBSD $ <span>id | tr &#39;, &#39; &#39;\n&#39;¬†</span></strong>
uid=1000(vermaden)
gid=1000(vermaden)
groups=0(wheel)
5(operator)
44(video)
48(idletime)
69(network)
1000(vermaden)
</pre>
<p>Later I disabled additional virtual terminals that I would not use anyway in the <tt><b>/etc/ttys</b></tt> file.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-ttys.png"/></p>
<h2><tt>/boot/loader.conf</tt></h2>
<p>Next used <tt><b>/boot/loader.conf</b><tt> file.</tt></tt></p>
<pre><span># CONSOLE COMMON</span>
  loader_logo=none
  loader_menu_frame=none
  screen.font=&#34;6x12&#34;

<span># CONSOLE RESOLUTION</span>
  kern.vt.fb.default.mode=&#34;1920x1080&#34;
  efi_max_resolution=&#34;1920x1080&#34;
  vbe_max_resolution=&#34;1920x1080&#34;

<span># ENABLE SYNAPTICS</span>
  hw.psm.synaptics_support=1

<span># DISABLE /dev/diskid/* AND /dev/gptid/* ENTRIES FOR DISKS</span>
  kern.geom.label.disk_ident.enable=0
  kern.geom.label.gptid.enable=0

<span># POWER MANAGEMENT POWER OFF DEVICES WITHOUT ATTACHED DRIVER</span>
  hw.pci.do_power_nodriver=3

<span># POWER MANAGEMENT FOR EVERY USED AHCI CHANNEL (ahcich 0-3)</span>
  hint.ahcich.0.pm_level=5
  hint.ahcich.1.pm_level=5
  hint.ahcich.2.pm_level=5
  hint.ahcich.3.pm_level=5

<span># MAX SEND QUEUE SIZE</span>
  net.link.ifqmaxlen=2048

<span># DISABLE USB PACKET FILTERING</span>
  hw.usb.no_pf=1
<span>
# NO USB DEVICE ENUMERATE WAITING AT BOOT AND SHUTDOWN</span>
  hw.usb.no_boot_wait=1
  hw.usb.no_shutdown_wait=1 

<span># DISABLE hwpstate_intel(4) DRIVER</span>
  hint.hwpstate_intel.0.disabled=1

</pre>
<h2><tt>/etc/rc.conf</tt></h2>
<p>Now the main FreeBSD <tt><b>/etc/rc.conf</b></tt> configuration file.</p>
<pre><span># SILENCE</span>
  rc_startmsgs=NO
  rc_info=NO

<span># NETWORK</span>
  hostname=minimal
  defaultroute_delay=3
  defaultroute_carrier_delay=3
  ifconfig_vtnet0=&#34;inet 10.1.1.71/24 up&#34;
  defaultrouter=&#34;10.1.1.1&#34;
  gateway_enable=YES
  harvest_mask=351
  rtsol_flags=&#34;-i&#34;
  rtsold_flags=&#34;-a -i&#34;

<span># POWER</span>
  performance_cx_lowest=C1
  economy_cx_lowest=Cmax

<span># DAEMONS</span>
  update_motd=NO
  local_unbound_enable=&#34;NO&#34;
  dbus_enable=YES
  syslogd_flags=&#39;-s -s&#39;
  sendmail_enable=NO
  sendmail_submit_enable=YES
  sendmail_outbound_enable=NO
  sendmail_msp_queue_enable=NO

<span># FS</span>
  fsck_y_enable=YES
  clear_tmp_enable=NO
  clear_tmp_X=YES

<span># OTHER</span>
  keyrate=fast
  virecover_enable=NO
  devfs_system_ruleset=desktop
  entropy_file=NO
  savecore_enable=NO
  dumpdev=AUTO
</pre>
<h2><tt>/etc/sysctl.conf</tt></h2>
<p>Now FreeBSD system settings in the <tt><b>/etc/sysctl.conf</b></tt> file.</p>
<pre><span># HARVEST MASK FOR random(4)</span>
  kern.random.harvest.mask=33119

<span># SECURITY</span>
  security.bsd.see_jail_proc=0
  security.bsd.unprivileged_proc_debug=0

<span># SECURITY/RANDOM PID</span>
  kern.randompid=1

<span># DISABLE ANNOYING THINGS</span>
  vfs.usermount=1
  kern.coredump=0
  hw.syscons.bell=0
  kern.vt.enable_bell=0

<span># DO NOT WAIT FOR USB DEVICES ON SUSPEND/SHUTDOWN</span>
  hw.usb.no_suspend_wait=1
  hw.usb.no_shutdown_wait=1

<span># DESKTOP/INTERACTIVITY</span>
  kern.sched.preempt_thresh=224

<span># DESKTOP QUANTUM FOR TIMESHARE THREADS IN stathz TICKS</span>
  kern.sched.slice=3

<span># DESKTOP/IRIDIUM/CHROMIUM</span>
  kern.ipc.shm_allow_removed=1

<span># ALLOW idprio(8) USE BY REGULAR USER</span>
  security.bsd.unprivileged_idprio=1
<span>
# PREVENT SHARED MEMORY FROM BEING SWAPPED TO DISK</span>
  kern.ipc.shm_use_phys=1

<span># DO NOT SWITCH VIRTUAL CONSOLES BACK AND FORTH ON SUSPEND</span>
  kern.vt.suspendswitch=0

<span># MAKE FUSEFS DO NOT USE WIRED MEMORY</span>
  vfs.fusefs.data_cache_mode=0
</pre>
<h2><tt>/etc/devfs.rules</tt></h2>
<p>The <tt><b>devfs_system_ruleset</b></tt> specified <tt><b>desktop</b></tt> in the <tt><b>/etc/devfs.rules</b></tt> file.</p>
<pre><span>[desktop=10]</span>
add path &#39;acd*&#39;      mode 0660 group operator
add path &#39;cd*&#39;       mode 0660 group operator
add path &#39;da*&#39;       mode 0660 group operator
add path &#39;pass*&#39;     mode 0660 group operator
add path &#39;xpt*&#39;      mode 0660 group operator
add path &#39;fd*&#39;       mode 0660 group operator
add path &#39;md*&#39;       mode 0660 group operator
add path &#39;uscanner*&#39; mode 0660 group operator
add path &#39;ugen*&#39;     mode 0660 group operator
add path &#39;usb/*&#39;     mode 0660 group operator
add path &#39;video*&#39;    mode 0660 group operator
add path &#39;cuse*&#39;     mode 0660 group operator
</pre>
<h2>Installed Packages</h2>
<p>Only a few ‚Ä¶ with few hundred dependencies üôÇ</p>
<pre><strong>FreeBSD # <span>pkg install xlibre openbox tint2 dzen2 xterm htop ifstat doas \
                      gnome-icons-faenza adwaita-icon-theme mate-icon-theme
</span></strong></pre>
<p>What I really loved is that <b>XLibre</b> X11 packages <u>DOES NOT CONFLICT</u> with <b>Xorg</b> packages. You just install <tt><b>xlibre</b></tt> instead of <tt><b>xorg</b></tt> and everything works ‚Ä¶ even better then with <b>Xorg</b> üôÇ</p>
<h2>Login Manager</h2>
<p>I did not used login manager such as <tt><b>xdm(1)</b></tt> as its not needed in the setup.</p>
<p>I just start X11 directly with <tt><b>xinit(1)</b></tt> command like that.</p>
<pre><strong>FreeBSD % <span>xinit -- -dpi 75 -nolisten tcp
</span></strong></pre>
<p>If you would like to add <tt><b>xdm(1)</b></tt> to the mix then it would add additional 12 MB to RAM usage.</p>
<pre><strong>FreeBSD # <span>ps aux -o user,rss,command | grep -e xdm -e RSS | cut -c 59-</span></strong>
USER           RSS COMMAND
root          8824 xdm: :0 (xdm)
root          4596 /usr/local/bin/xdm -server :0 local /usr/local/bin/X :0  vt05
</pre>
<h2><tt>~/.xinitrc</tt></h2>
<p>Now the details what is being set and started for this minimalistic yet powerful desktop.</p>
<pre><span># PATH</span>
  export PATH=${PATH}:~/scripts

<span># SET PROPER locale(1)</span>
  export LC_ALL=en_US.UTF-8
  export   LANG=en_US.UTF-8

<span># fontconfig</span>
  export FREETYPE_PROPERTIES=&#34;cff:no-stem-darkening=0 autofitter:no-stem-darkening=0&#34;

<span># MODIFY QT FONT DPI</span>
  export QT_FONT_DPI=75

<span># DISABLE OVERLAY SCROLLBARS</span>
  export GTK_OVERLAY_SCROLLING=0

<span># XDG</span>
  export DESKTOP_SESSION=openbox
  export XDG_SESSION_DESKTOP=openbox
  export XDG_CURRENT_DESKTOP=openbox
  export XDG_SESSION_CLASS=user
  export XDG_SESSION_TYPE=x11

<span># DISABLE GVFS FUSE ~/.gvfs MOUNT</span>
  export GVFS_DISABLE_FUSE=1

<span># QT MUST KNOW WHERE IS GTK2 CONFIG</span>
  export GTK2_RC_FILES=&#34;${HOME}/.gtkrc-2.0&#34;

<span># QT5 qt5ct</span>
  export QT_QPA_PLATFORMTHEME=qt5ct

<span># GTK/QT ANTIALIASING</span>
  export QT_XFT=1
  export GDK_USE_XFT=1

<span># FORCE LIBREOFFICE TO USE GTK2 THEME</span>
  export OOO_FORCE_DESKTOP=gnome

<span># WM</span>
  exec dbus-launch --exit-with-session openbox-session 1&gt; /dev/null 2&gt; /dev/null &amp; WM=${!}

<span># DAEMONS/TOOLS/TASKBARS/BACKGROUND</span>
  ( sleep 1 &amp;&amp; ~/scripts/__openbox_restart_dzen2.sh 1&gt; /dev/null 2&gt; /dev/null ) &amp;
  ( sleep 1 &amp;&amp; ~/scripts/__openbox_restart_tint2.sh 1&gt; /dev/null 2&gt; /dev/null ) &amp;
  xbindkeys                                         1&gt; /dev/null 2&gt; /dev/null   &amp;
  setxkbmap -option terminate:ctrl_alt_bksp,caps:none pl                        &amp;
  ( sleep 5 &amp;&amp; xmodmap ~/.xmodmaprc )                                           &amp; 

<span># WAIT FOR openbox(1) WM PID</span>
  wait ${WM}

<span># LOGOUT WHEN X11 STARTED FROM PLAIN login(1) CONSOLE</span>
  XINIT=$( ps -o pid,comm | awk &#39;/xinit/ {print $1}&#39; )
  SHELL=$( ps -o ppid -p ${XINIT} | grep -v PPID )
  LOGIN=$( ps -o ppid -p ${SHELL} | grep -v PPID )
  kill -9 ${XINIT} ${SHELL} ${LOGIN} 2&gt; /dev/null

<span># EXIT</span>
  exit 0


</pre>
<p>For the record ‚Ä¶ this section at the end makes sure that after X11 will end its process my user will be securely and automatically logged out.</p>
<pre><span># LOGOUT WHEN X11 STARTED FROM PLAIN login(1) CONSOLE</span>
  XINIT=$( ps -o pid,comm | awk &#39;/xinit/ {print $1}&#39; )
  SHELL=$( ps -o ppid -p ${XINIT} | grep -v PPID )
  LOGIN=$( ps -o ppid -p ${SHELL} | grep -v PPID )
  kill -9 ${XINIT} ${SHELL} ${LOGIN} 2&gt; /dev/null
</pre>

<p>This is how the system looks after its booted.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-boot.png"/></p>
<p>After executing the <tt><b>xinit -- -dpi 75 -nolisten tcp</b></tt> command <b>Openbox</b> window manager awaits our commands with <b>Tint2</b> and <b>Dzen2</b> bars on the top.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-desktop.png"/></p>
<p>The <tt><b>kld.sh</b></tt> script converts FreeBSD kernel (and its modules) RAM usage display into MB units and its talked in depth in the <a href="https://vermaden.wordpress.com/2021/09/13/ghost-in-the-shell-part-6-learn-shell-scripting/">Part 6 ‚Äì Learn Shell Scripting</a> of the <i>Ghost in the Shell</i> series.</p>

<p>After starting <tt><b>xterm(1)</b></tt> terminal and then <tt><b>htop(1)</b></tt> inside to measure RAM usage the number stops at <b>230 MB</b> ‚Ä¶ but as we started these only to measure the usage the real RAM usage of such FreeBSD desktop without any applications is <b>206 MB RAM</b>.</p>
<p>I subtracted:</p>
<p>‚Äì 19 MB for <tt><b>xterm(1)</b></tt> terminal.</p>
<p>‚Äì 5 MB for <tt><b>htop(1)</b></tt> process viewer.</p>
<p>Math.</p>
<pre>230 - 19 - 5 = <strong>206</strong></pre>
<p>As calculated in the terminal.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-math.png"/></p>

<p>After stopping X11 server this is how console looks like (and safely logged out).</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-login.png"/></p>
<p>I was also positively surprised how cleanly and without any errors <b>Xlibre</b> servers ends its work.</p>

<p>You can compare these <b>200 MB RAM</b> to other desktop environments and window managers in one of my older articles ‚Äì <a href="https://vermaden.wordpress.com/2022/07/12/desktop-environments-resource-usage-comparison/">Desktop Environments Resource Usage Comparison</a> ‚Äì here.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-compare.png"/></p>

<p>As I used <tt><b>GENERIC</b></tt> FreeBSD kernel its possible to use even smaller amount of RAM with kernel recompilation.</p>
<h2>UPDATE 1 ‚Äì Hard 220 MB Limit</h2>
<p>The tests I have done above were done on a FreeBSD Bhyve virtual machine with 6 GB RAM. That means plenty of space for buffers and cache ‚Äì and the FreeBSD motto is that ‚Äì <i>‚ÄúFree memory is wasted memory.‚Äù</i> ‚Äì I decided to try with smallest VM I can start in UEFI mode.</p>
<p>That means 220 MB of RAM.</p>
<p>The results I got surprised me more then I expected.</p>
<h3>Plain FreeBSD</h3>
<p>When VM had 6 GB RAM plain FreeBSD used about <strong>115 MB RAM</strong> ‚Äì but when I limited the physical memory to 220 MB RAM for that virtual machine only <strong>82 MB RAM</strong> were used.</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-220-plain-freebsd.png"/></p>
<h3>Openbox</h3>
<p>Here the results are also better.</p>
<p>My complete <b>Openbox</b>/<b>Tint2</b>/<b>Dzen2</b> desktop uses only <b>134 MB RAM</b>!</p>
<p>The calculations are: <b>142</b> (ram) + <b>14</b> (swap) ‚Äì <b>18</b> (xterm) ‚Äì <b>4</b> (htop)</p>
<p><img src="https://vermaden.wordpress.com/wp-content/uploads/2026/01/minimal-ram-220-openbox.png"/></p>
<p>Hope that helps.</p>
<p>EOF</p>
					</div></div>
  </body>
</html>
