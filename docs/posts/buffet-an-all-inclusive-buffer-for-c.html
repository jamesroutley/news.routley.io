<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/alcover/buffet">Original</a>
    <h1>Buffet â€“ An All-inclusive Buffer for C</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/alcover/buffet/blob/main/assets/buffet.png"><img src="https://github.com/alcover/buffet/raw/main/assets/buffet.png" alt="schema"/></a></p>

<p dir="auto">All-inclusive Buffer for C</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/alcover/buffet/actions/workflows/ci.yml/badge.svg"><img src="https://github.com/alcover/buffet/actions/workflows/ci.yml/badge.svg" alt="CI"/></a></p>
<p dir="auto"><g-emoji alias="orange_book" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4d9.png">ðŸ“™</g-emoji> <a href="#API">API</a></p>
<p dir="auto"><em>Buffet</em> is a versatile string buffer type featuring</p>
<ul dir="auto">
<li>automated storage and reallocation</li>
<li><strong>SSO</strong> (Small String Optimization) : short data is stored inline</li>
<li><strong>views</strong> : no-cost references to slices of data</li>
<li><strong>ref count</strong> : accounting of reference-owner relation</li>
</ul>
<p dir="auto">In only <strong>16 bytes</strong>, fitting a 128-bit register.</p>
<h2 dir="auto"><a id="user-content-how" aria-hidden="true" href="#how"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How</h2>
<p dir="auto">Through a tagged union:</p>
<div data-snippet-clipboard-copy-content="typedef union Buffet {
      
    // SSO
    struct {
        char        sso[15]  // in-situ data
        uint8_t     ssolen:4 // in-situ length
    }

    // OWN | REF | VUE
    struct { 
        uint32_t len // data length
        union {
              uint32_t off // REF: data offset; VUE: address remainder
              struct {
                    uint16_t refcnt // OWN: number of references
                    uint8_t  cap    // OWN: log2(allocated mem)
              }
        }
        intptr_t data : 62 // OWN|VUE: data ptr; REF: ptr to owner
        uint8_t  type : 2  // tag = {SSO|OWN|REF|VUE}
    }
}"><pre><span>typedef</span> <span>union</span> Buffet {
      
    <span><span>//</span> SSO</span>
    <span>struct</span> {
        <span>char</span>        sso[<span>15</span>]  <span><span>//</span> in-situ data</span>
        <span>uint8_t</span>     ssolen:<span>4</span> <span><span>//</span> in-situ length</span>
    }

    <span><span>//</span> OWN | REF | VUE</span>
    <span>struct</span> { 
        <span>uint32_t</span> len <span><span>//</span> data length</span>
        <span>union</span> {
              <span>uint32_t</span> off <span><span>//</span> REF: data offset; VUE: address remainder</span>
              <span>struct</span> {
                    <span>uint16_t</span> refcnt <span><span>//</span> OWN: number of references</span>
                    <span>uint8_t</span>  cap    <span><span>//</span> OWN: log2(allocated mem)</span>
              }
        }
        <span>intptr_t</span> data : <span>62</span> <span><span>//</span> OWN|VUE: data ptr; REF: ptr to owner</span>
        <span>uint8_t</span>  type : <span>2</span>  <span><span>//</span> tag = {SSO|OWN|REF|VUE}</span>
    }
}</pre></div>
<p dir="auto">Depending on its tag, a <em>Buffet</em> is interpreted as either</p>
<ul dir="auto">
<li><code>SSO</code> : a char array as value</li>
<li><code>OWN</code> : owning heap-allocated data</li>
<li><code>REF</code> : referencing a slice of a data-owning <em>Buffet</em></li>
<li><code>VUE</code> : viewing data directly</li>
</ul>
<p dir="auto">Any <em>owned</em> data (SSO/OWN) is NUL-terminated.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/alcover/buffet/blob/main/assets/schema.png"><img src="https://github.com/alcover/buffet/raw/main/assets/schema.png" alt="schema"/></a></p>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<h3 dir="auto"><a id="user-content-build--unit-test" aria-hidden="true" href="#build--unit-test"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build &amp; unit-test</h3>
<p dir="auto"><code>make &amp;&amp; make check</code></p>
<h3 dir="auto"><a id="user-content-example" aria-hidden="true" href="#example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>example</h3>
<div data-snippet-clipboard-copy-content="#include &lt;stdio.h&gt;
#include &#34;buffet.h&#34;

int main()
{
    char text[] = &#34;The train is fast&#34;;

    Buffet vue;
    bft_strview (&amp;vue, text+4, 5);
    bft_print(&amp;vue);

    text[4] = &#39;b&#39;;
    bft_print(&amp;vue);

    Buffet ref = bft_view (&amp;vue, 1, 4);
    bft_print(&amp;ref);

    char wet[] = &#34; is wet&#34;;
    bft_append (&amp;ref, wet, sizeof(wet));
    bft_print(&amp;ref);

    return 0;
}"><pre>#<span>include</span> <span><span>&lt;</span>stdio.h<span>&gt;</span></span>
#<span>include</span> <span><span>&#34;</span>buffet.h<span>&#34;</span></span>

<span>int</span> <span>main</span>()
{
    <span>char</span> text[] = <span><span>&#34;</span>The train is fast<span>&#34;</span></span>;

    Buffet vue;
    <span>bft_strview</span> (&amp;vue, text+<span>4</span>, <span>5</span>);
    <span>bft_print</span>(&amp;vue);

    text[<span>4</span>] = <span><span>&#39;</span>b<span>&#39;</span></span>;
    <span>bft_print</span>(&amp;vue);

    Buffet ref = <span>bft_view</span> (&amp;vue, <span>1</span>, <span>4</span>);
    <span>bft_print</span>(&amp;ref);

    <span>char</span> wet[] = <span><span>&#34;</span> is wet<span>&#34;</span></span>;
    <span>bft_append</span> (&amp;ref, wet, <span>sizeof</span>(wet));
    <span>bft_print</span>(&amp;ref);

    <span>return</span> <span>0</span>;
}</pre></div>
<div data-snippet-clipboard-copy-content="$ gcc example.c buffet -o example &amp;&amp; ./example
train
brain
rain
rain is wet"><pre><code>$ gcc example.c buffet -o example &amp;&amp; ./example
train
brain
rain
rain is wet
</code></pre></div>

<p dir="auto"><a href="#bft_new">bft_new</a></p>
<p dir="auto"><a href="#bft_append">bft_append</a></p>
<p dir="auto"><a href="#bft_cap">bft_cap</a></p>
<p dir="auto"><a href="#bft_cstr">bft_cstr</a></p>
<p dir="auto"><a href="#bft_print">bft_print</a></p>
<h3 dir="auto"><a id="user-content-bft_new" aria-hidden="true" href="#bft_new"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_new</h3>
<div data-snippet-clipboard-copy-content="void bft_new (Buffet *dst, size_t cap)"><pre><span>void</span> <span>bft_new</span> (Buffet *dst, <span>size_t</span> cap)</pre></div>
<p dir="auto">Create a <em>Buffet</em> of capacity at least <code>cap</code>.</p>
<div data-snippet-clipboard-copy-content="Buffet buf;
bft_new(&amp;buf, 20);
bft_dbg(&amp;buf); 
// type:OWN cap:32 len:0 data:&#39;&#39;"><pre>Buffet buf;
<span>bft_new</span>(&amp;buf, <span>20</span>);
<span>bft_dbg</span>(&amp;buf); 
<span><span>//</span> type:OWN cap:32 len:0 data:&#39;&#39;</span></pre></div>
<h3 dir="auto"><a id="user-content-bft_strcopy" aria-hidden="true" href="#bft_strcopy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_strcopy</h3>
<div data-snippet-clipboard-copy-content="void bft_strcopy (Buffet *dst, const char *src, size_t len)"><pre><span>void</span> <span>bft_strcopy</span> (Buffet *dst, <span>const</span> <span>char</span> *src, <span>size_t</span> len)</pre></div>
<p dir="auto">Copy <code>len</code> bytes from <code>src</code> into new <code>dst</code>.</p>
<div data-snippet-clipboard-copy-content="Buffet copy;
bft_strcopy(&amp;copy, &#34;Bonjour&#34;, 3);
bft_dbg(&amp;copy); 
// type:SSO cap:14 len:3 data:&#39;Bon&#39;
"><pre>Buffet copy;
<span>bft_strcopy</span>(&amp;copy, <span><span>&#34;</span>Bonjour<span>&#34;</span></span>, <span>3</span>);
<span>bft_dbg</span>(&amp;copy); 
<span><span>//</span> type:SSO cap:14 len:3 data:&#39;Bon&#39;</span>
</pre></div>
<h3 dir="auto"><a id="user-content-bft_strview" aria-hidden="true" href="#bft_strview"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_strview</h3>
<div data-snippet-clipboard-copy-content="void bft_strview (Buffet *dst, const char *src, size_t len)"><pre><span>void</span> <span>bft_strview</span> (Buffet *dst, <span>const</span> <span>char</span> *src, <span>size_t</span> len)</pre></div>
<p dir="auto">View <code>len</code> bytes from <code>src</code> into new <code>dst</code>.</p>
<div data-snippet-clipboard-copy-content="char src[] = &#34;Eat Buffet!&#34;;
Buffet view;
bft_strview(&amp;view, src+4, 3);
bft_dbg(&amp;view);
// type:VUE cap:0 len:6 data:&#39;Buffet!&#39;
bft_print(&amp;view);
// Buf"><pre><span>char</span> src[] = <span><span>&#34;</span>Eat Buffet!<span>&#34;</span></span>;
Buffet view;
<span>bft_strview</span>(&amp;view, src+<span>4</span>, <span>3</span>);
<span>bft_dbg</span>(&amp;view);
<span><span>//</span> type:VUE cap:0 len:6 data:&#39;Buffet!&#39;</span>
<span>bft_print</span>(&amp;view);
<span><span>//</span> Buf</span></pre></div>
<h3 dir="auto"><a id="user-content-bft_copy" aria-hidden="true" href="#bft_copy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_copy</h3>
<div data-snippet-clipboard-copy-content="Buffet bft_copy (const Buffet *src, ptrdiff_t off, size_t len)"><pre>Buffet <span>bft_copy</span> (<span>const</span> Buffet *src, <span>ptrdiff_t</span> off, <span>size_t</span> len)</pre></div>
<p dir="auto">Create new <em>Buffet</em> by copying <code>len</code> bytes from [data(<code>src</code>) + <code>off</code>].</p>
<h3 dir="auto"><a id="user-content-bft_view" aria-hidden="true" href="#bft_view"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_view</h3>
<div data-snippet-clipboard-copy-content="Buffet bft_view (Buffet *src, ptrdiff_t off, size_t len)"><pre>Buffet <span>bft_view</span> (Buffet *src, <span>ptrdiff_t</span> off, <span>size_t</span> len)</pre></div>
<p dir="auto">Create new <em>Buffet</em> by viewing <code>len</code> bytes from [data(<code>src</code>) + <code>off</code>].</p>
<ul dir="auto">
<li>a reference to <code>src</code> if <code>src</code> is owning</li>
<li>a reference to <code>src</code>&#39;s origin if <code>src</code> is itself a REF</li>
<li>a view on <code>src</code> data if <code>src</code> is SSO or VUE</li>
</ul>
<p dir="auto"><code>src</code> now cannot be released before either</p>
<ul dir="auto">
<li>the return is released</li>
<li>the return is detached as owner (e.g. when you <code>append()</code> to it).</li>
</ul>
<div data-snippet-clipboard-copy-content="Buffet src;
bft_strcopy(&amp;src, &#34;Bonjour&#34;, 7);
Buffet ref = bft_view(&amp;src, 0, 3);
bft_dbg(&amp;ref);   // type:VUE cap:0 len:6 data:&#39;Buffet!&#39;
bft_print(&amp;ref); // Bon"><pre>Buffet src;
<span>bft_strcopy</span>(&amp;src, <span><span>&#34;</span>Bonjour<span>&#34;</span></span>, <span>7</span>);
Buffet ref = bft_view(&amp;src, <span>0</span>, <span>3</span>);
<span>bft_dbg</span>(&amp;ref);   <span><span>//</span> type:VUE cap:0 len:6 data:&#39;Buffet!&#39;</span>
<span>bft_print</span>(&amp;ref); <span><span>//</span> Bon</span></pre></div>
<h3 dir="auto"><a id="user-content-bft_free" aria-hidden="true" href="#bft_free"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_free</h3>
<p dir="auto">If <em>buf</em> is owning data and there are no references to it (<em>refcnt</em>==0),</p>
<div data-snippet-clipboard-copy-content="void bft_free (Buffet *buf)"><pre><span>void</span> <span>bft_free</span> (Buffet *buf)</pre></div>
<div data-snippet-clipboard-copy-content="Buffet buf;
bft_strcopy(&amp;buf, &#34;Too long for SSO..........&#34;, 16);
bft_dbg(&amp;buf);
// type:OWN cap:32 len:16 data:&#39;Too long for SSO&#39;
bft_free(&amp;buf);
bft_dbg(&amp;buf);
// type:SSO cap:14 len:0 data:&#39;&#39;"><pre>Buffet buf;
<span>bft_strcopy</span>(&amp;buf, <span><span>&#34;</span>Too long for SSO..........<span>&#34;</span></span>, <span>16</span>);
<span>bft_dbg</span>(&amp;buf);
<span><span>//</span> type:OWN cap:32 len:16 data:&#39;Too long for SSO&#39;</span>
<span>bft_free</span>(&amp;buf);
<span>bft_dbg</span>(&amp;buf);
<span><span>//</span> type:SSO cap:14 len:0 data:&#39;&#39;</span></pre></div>
<h3 dir="auto"><a id="user-content-bft_append" aria-hidden="true" href="#bft_append"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_append</h3>
<div data-snippet-clipboard-copy-content="size_t bft_append (Buffet *dst, const char *src, size_t len)"><pre><span>size_t</span> <span>bft_append</span> (Buffet *dst, <span>const</span> <span>char</span> *src, <span>size_t</span> len)</pre></div>
<p dir="auto">Appends <code>len</code> bytes from <code>src</code> to <code>dst</code>.</p>
<p dir="auto">If over capacity, <code>dst</code> gets reallocated.</p>
<div data-snippet-clipboard-copy-content="Buffet buf;
bft_strcopy(&amp;buf, &#34;abc&#34;, 3); 
size_t newlen = bft_append(&amp;buf, &#34;def&#34;, 3); // newlen == 6 
bft_dbg(&amp;buf);
// type:SSO cap:14 len:6 data:&#39;abcdef&#39;"><pre>Buffet buf;
<span>bft_strcopy</span>(&amp;buf, <span><span>&#34;</span>abc<span>&#34;</span></span>, <span>3</span>); 
<span>size_t</span> newlen = bft_append(&amp;buf, <span><span>&#34;</span>def<span>&#34;</span></span>, <span>3</span>); <span><span>//</span> newlen == 6 </span>
<span>bft_dbg</span>(&amp;buf);
<span><span>//</span> type:SSO cap:14 len:6 data:&#39;abcdef&#39;</span></pre></div>
<h3 dir="auto"><a id="user-content-bft_cap" aria-hidden="true" href="#bft_cap"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_cap</h3>
<p dir="auto">Get current capacity.</p>
<div data-snippet-clipboard-copy-content="size_t bft_cap (Buffet *buf)"><pre><span>size_t</span> <span>bft_cap</span> (Buffet *buf)</pre></div>
<h3 dir="auto"><a id="user-content-bft_len" aria-hidden="true" href="#bft_len"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_len</h3>
<p dir="auto">Get current length.</p>
<div data-snippet-clipboard-copy-content="size_t bft_len (Buffet *buf)`"><pre><span>size_t</span> <span>bft_len</span> (Buffet *buf)`</pre></div>
<h3 dir="auto"><a id="user-content-bft_data" aria-hidden="true" href="#bft_data"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_data</h3>
<p dir="auto">Get current data pointer.</p>
<div data-snippet-clipboard-copy-content="const char* bft_data (const Buffet *buf)`"><pre><span>const</span> <span>char</span>* <span>bft_data</span> (<span>const</span> Buffet *buf)`</pre></div>
<p dir="auto">If <em>buf</em> is a ref/view, <code>strlen(bft_data)</code> may be longer than <code>buf.len</code>.</p>
<h3 dir="auto"><a id="user-content-bft_cstr" aria-hidden="true" href="#bft_cstr"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_cstr</h3>
<p dir="auto">Get current data as a NUL-terminated <strong>C string</strong>.</p>
<div data-snippet-clipboard-copy-content="const char* bft_cstr (const Buffet *buf, bool *mustfree)"><pre><span>const</span> <span>char</span>* <span>bft_cstr</span> (<span>const</span> Buffet *buf, <span>bool</span> *mustfree)</pre></div>
<p dir="auto">If REF/VUE, the slice is copied into a fresh C string that must be freed.</p>
<h3 dir="auto"><a id="user-content-bft_export" aria-hidden="true" href="#bft_export"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_export</h3>
<p dir="auto">Copies data up to <code>buf.len</code> into a fresh C string that must be freed.</p>
<div data-snippet-clipboard-copy-content="char* bft_export (const Buffet *buf)"><pre><span>char</span>* <span>bft_export</span> (<span>const</span> Buffet *buf)</pre></div>
<h3 dir="auto"><a id="user-content-bft_print" aria-hidden="true" href="#bft_print"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_print</h3>
<p dir="auto">Prints data up to <code>buf.len</code>.</p>
<div data-snippet-clipboard-copy-content="void bft_print (const Buffet *buf)`"><pre><span>void</span> <span>bft_print</span> (<span>const</span> Buffet *buf)`</pre></div>
<h3 dir="auto"><a id="user-content-bft_dbg" aria-hidden="true" href="#bft_dbg"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>bft_dbg</h3>
<p dir="auto">Prints <em>buf</em> state.</p>
<div data-snippet-clipboard-copy-content="void bft_dbg (Buffet *buf)"><pre><span>void</span> <span>bft_dbg</span> (Buffet *buf)</pre></div>
<div data-snippet-clipboard-copy-content="Buffet buf;
bft_strcopy(&amp;buf, &#34;foo&#34;, 3);
bft_dbg(&amp;buf);
// type:SSO cap:14 len:3 data:&#39;foo&#39;"><pre>Buffet buf;
<span>bft_strcopy</span>(&amp;buf, <span><span>&#34;</span>foo<span>&#34;</span></span>, <span>3</span>);
<span>bft_dbg</span>(&amp;buf);
<span><span>//</span> type:SSO cap:14 len:3 data:&#39;foo&#39;</span></pre></div>
</article>
        </div></div>
  </body>
</html>
