<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jamesturk.github.io/scrapeghost/">Original</a>
    <h1>Experimental library for scraping websites using OpenAI&#39;s GPT API</h1>
    
    <div id="readability-page-1" class="page"><div data-md-component="container">
      
      
        
          
        
      
      <main data-md-component="main">
        <div>
          
            
              
              
            
            
              
              
            
          
          
            <div data-md-component="content">
              <article>
                
                  

  
  



<p><img alt="scrapeghost logo" src="https://jamesturk.github.io/scrapeghost/assets/scrapeghost.png"/></p>
<p><code>scrapeghost</code> is an experimental library for scraping websites using OpenAI&#39;s GPT.</p>
<p>The library provides a means to scrape structured data from HTML without writing page-specific code.</p>
<div>
<p>Important</p>
<p>Before you proceed, here are at least three reasons why you should not use this library:</p>
<ul>
<li>
<p>It is <strong>very experimental</strong>, no guarantees are made about the stability of the API or the accuracy of the results.</p>
</li>
<li>
<p>It relies on the OpenAI API, which is quite slow and can be expensive.  (See <a href="https://jamesturk.github.io/scrapeghost/openai/#costs">costs</a> before using this library.)</p>
</li>
<li>
<p>Currently licensed under <a href="https://jamesturk.github.io/scrapeghost/LICENSE/">Hippocratic License 3.0</a>.   (See <a href="https://jamesturk.github.io/scrapeghost/faq/#whats-with-the-license">FAQ</a>.)</p>
</li>
</ul>
<p><strong>Use at your own risk.</strong></p>
</div>
<h2 id="quickstart">Quickstart<a href="#quickstart" title="Permanent link">¶</a></h2>
<p><strong>Step 1)</strong> Obtain an OpenAI API key (<a href="https://platform.openai.com">https://platform.openai.com</a>) and set an environment variable:</p>
<div><pre><span></span><code><span>export</span><span> </span><span>OPENAI_API_KEY</span><span>=</span>sk-...
</code></pre></div>
<p><strong>Step 2)</strong> Install the library however you like:</p>

or

<p><strong>Step 3)</strong> Instantiate a <code>SchemaScraper</code> by defining the shape of the data you wish to extract:</p>
<div><pre><span></span><code><span>from</span> <span>scrapeghost</span> <span>import</span> <span>SchemaScraper</span>
<span>scrape_legislators</span> <span>=</span> <span>SchemaScraper</span><span>(</span>
  <span>schema</span><span>=</span><span>{</span>
      <span>&#34;name&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>,</span>
      <span>&#34;url&#34;</span><span>:</span> <span>&#34;url&#34;</span><span>,</span>
      <span>&#34;district&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>,</span>
      <span>&#34;party&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>,</span>
      <span>&#34;photo_url&#34;</span><span>:</span> <span>&#34;url&#34;</span><span>,</span>
      <span>&#34;offices&#34;</span><span>:</span> <span>[{</span><span>&#34;name&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>,</span> <span>&#34;address&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>,</span> <span>&#34;phone&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>}],</span>
  <span>}</span>
<span>)</span>
</code></pre></div>
<div>
<p>Note</p>
<p>There&#39;s no pre-defined format for the schema, the GPT models do a good job of figuring out what you want and you can use whatever values you want to provide hints.</p>
</div>
<p><strong>Step 4)</strong> Passing the scraper a URL (or HTML) to the resulting scraper will return the scraped data:</p>
<div><pre><span></span><code><span>resp</span> <span>=</span> <span>scrape_legislators</span><span>(</span><span>&#34;https://www.ilga.gov/house/rep.asp?MemberID=3071&#34;</span><span>)</span>
<span>resp</span><span>.</span><span>data</span>
</code></pre></div>
<div><pre><span></span><code><span>{</span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;Emanuel &#39;Chris&#39; Welch&#34;</span><span>,</span>
<span> </span><span>&#34;url&#34;</span><span>:</span><span> </span><span>&#34;https://www.ilga.gov/house/Rep.asp?MemberID=3071&#34;</span><span>,</span>
<span> </span><span>&#34;district&#34;</span><span>:</span><span> </span><span>&#34;7th&#34;</span><span>,</span><span> </span><span>&#34;party&#34;</span><span>:</span><span> </span><span>&#34;D&#34;</span><span>,</span><span> </span>
<span> </span><span>&#34;photo_url&#34;</span><span>:</span><span> </span><span>&#34;https://www.ilga.gov/images/members/{5D419B94-66B4-4F3B-86F1-BFF37B3FA55C}.jpg&#34;</span><span>,</span>
<span>   </span><span>&#34;offices&#34;</span><span>:</span><span> </span><span>[</span>
<span>     </span><span>{</span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;Springfield Office&#34;</span><span>,</span>
<span>      </span><span>&#34;address&#34;</span><span>:</span><span> </span><span>&#34;300 Capitol Building, Springfield, IL 62706&#34;</span><span>,</span>
<span>       </span><span>&#34;phone&#34;</span><span>:</span><span> </span><span>&#34;(217) 782-5350&#34;</span><span>},</span>
<span>     </span><span>{</span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;District Office&#34;</span><span>,</span>
<span>      </span><span>&#34;address&#34;</span><span>:</span><span> </span><span>&#34;10055 W. Roosevelt Rd., Suite E, Westchester, IL 60154&#34;</span><span>,</span>
<span>       </span><span>&#34;phone&#34;</span><span>:</span><span> </span><span>&#34;(708) 450-1000&#34;</span><span>}</span>
<span>   </span><span>]}</span>
</code></pre></div>
<p><strong>That&#39;s it!</strong></p>
<p>Read the <a href="https://jamesturk.github.io/scrapeghost/tutorial/">tutorial</a> for a step-by-step guide to building a scraper.</p>
<h3 id="command-line-usage-example">Command Line Usage Example<a href="#command-line-usage-example" title="Permanent link">¶</a></h3>
<p>If you&#39;ve installed the package (e.g. with <code>pipx</code>), you can use the <code>scrapeghost</code> command line tool to experiment.</p>
<div><pre><span></span><code><span>#!/bin/sh </span>
scrapeghost<span> </span>https://www.ncleg.gov/Members/Biography/S/436<span>  </span><span>\</span>
<span>        </span>--schema<span> </span><span>&#34;{&#39;first_name&#39;: &#39;str&#39;, &#39;last_name&#39;: &#39;str&#39;,</span>
<span>        &#39;photo_url&#39;: &#39;url&#39;, &#39;offices&#39;: [] }&#39;&#34;</span><span> </span><span>\</span>
<span>        </span>--css<span> </span>div.card<span> </span><span>|</span><span> </span>python<span> </span>-m<span> </span>json.tool
</code></pre></div>
<div><pre><span></span><code><span>{</span>
<span>    </span><span>&#34;first_name&#34;</span><span>:</span><span> </span><span>&#34;Gale&#34;</span><span>,</span>
<span>    </span><span>&#34;last_name&#34;</span><span>:</span><span> </span><span>&#34;Adcock&#34;</span><span>,</span>
<span>    </span><span>&#34;photo_url&#34;</span><span>:</span><span> </span><span>&#34;https://www.ncleg.gov/Members/MemberImage/S/436/Low&#34;</span><span>,</span>
<span>    </span><span>&#34;offices&#34;</span><span>:</span><span> </span><span>[</span>
<span>        </span><span>{</span>
<span>            </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;Mailing&#34;</span><span>,</span>
<span>            </span><span>&#34;address&#34;</span><span>:</span><span> </span><span>&#34;16 West Jones Street, Rm. 1104, Raleigh, NC 27601&#34;</span>
<span>        </span><span>},</span>
<span>        </span><span>{</span>
<span>            </span><span>&#34;type&#34;</span><span>:</span><span> </span><span>&#34;Office Phone&#34;</span><span>,</span>
<span>            </span><span>&#34;phone&#34;</span><span>:</span><span> </span><span>&#34;(919) 715-3036&#34;</span>
<span>        </span><span>}</span>
<span>    </span><span>]</span>
<span>}</span>
</code></pre></div>
<p>See <a href="https://jamesturk.github.io/scrapeghost/cli/">the CLI docs</a> for more details.</p>
<h2 id="features">Features<a href="#features" title="Permanent link">¶</a></h2>
<p>The purpose of this library is to provide a convenient interface for exploring web scraping with GPT.</p>
<p>While the bulk of the work is done by the GPT model, <code>scrapeghost</code> provides a number of features to make it easier to use.</p>
<p><strong>Python-based schema definition</strong> - Define the shape of the data you want to extract as any Python object, with as much or little detail as you want.</p>
<p><strong>Preprocessing</strong></p>
<ul>
<li><strong>HTML cleaning</strong> - Remove unnecessary HTML to reduce the size and cost of API requests.</li>
<li><strong>CSS and XPath selectors</strong> - Pre-filter HTML by writing a single CSS or XPath selector.</li>
<li><strong>Auto-splitting</strong> - Optionally split the HTML into multiple calls to the model, allowing for larger pages to be scraped.</li>
</ul>
<p><strong>Postprocessing</strong></p>
<ul>
<li><strong>JSON validation</strong> - Ensure that the response is valid JSON.  (With the option to kick it back to GPT for fixes if it&#39;s not.)</li>
<li><strong>Schema validation</strong> - Go a step further, use a <a href="https://pydantic-docs.helpmanual.io/"><code>pydantic</code></a> schema to validate the response.</li>
<li><strong>Hallucination check</strong> - Does the data in the response truly exist on the page?</li>
</ul>
<p><strong>Cost Controls</strong></p>
<ul>
<li>Scrapers keep running totals of how many tokens have been sent and received, so costs can be tracked.</li>
<li>Support for automatic fallbacks (e.g. use cost-saving GPT-3.5-Turbo by default, fall back to GPT-4 if needed.)</li>
<li>Allows setting a budget and stops the scraper if the budget is exceeded.</li>
</ul>





                
              </article>
            </div>
          
          
  

        </div>
        
          
        
      </main>
      
        
      
    </div></div>
  </body>
</html>
