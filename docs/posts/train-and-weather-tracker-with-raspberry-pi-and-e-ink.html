<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sambroner.com/posts/raspberry-pi-train">Original</a>
    <h1>Train and Weather Tracker with Raspberry Pi and E-Ink</h1>
    
    <div id="readability-page-1" class="page"><div><p>I finally built a Raspberry Pi project my wife loves: an e-ink train and weather tracker! If you want to build one yourself, <a href="https://github.com/SamBroner/subway-e-ink-tracker">the Github &amp; instructions are here.</a></p>
<div><div><p><img alt="E-ink display showing subway schedule information" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" sizes="(max-width: 767px) 100vw, 800px" srcset="/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=640&amp;q=90 640w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=750&amp;q=90 750w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=828&amp;q=90 828w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=1080&amp;q=90 1080w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=1200&amp;q=90 1200w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=1920&amp;q=90 1920w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=2048&amp;q=90 2048w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=3840&amp;q=90 3840w" src="https://sambroner.com/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fkira-leaving.jpeg&amp;w=3840&amp;q=90"/></p></div><p>Kira will be jogging to the night shift!</p></div>
<p>Over the past few years, I&#39;ve been on something of an e-ink journey.  I started with a <a href="https://sambroner.com/posts/raspberry-pi-weather">weather and news display</a> (still the only post on my website that regularly gets organic traffic.) While I loved it and it looked great, a phone is a better way to check the news, and the weather only gets checked once a day. Then in 2022 while at MIT I built <a href="https://x.com/SamBroner/status/1602137871523143680/video/1">Jarvis, the e-ink voice-to-image display</a>. Jarvis was a great party trick — say, &#34;Hey Jarvis, paint me an elephant on a bowling ball in Times Square&#34; and watch as the image gradually appeared. Notably, this was before ChatGPT, when people were still impressed by AI!</p>
<div><div><p><img alt="E-ink weather display showing forecast" loading="lazy" width="500" height="400" decoding="async" data-nimg="1" sizes="(max-width: 767px) 100vw, 800px" srcset="/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=640&amp;q=90 640w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=750&amp;q=90 750w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=828&amp;q=90 828w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=1080&amp;q=90 1080w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=1200&amp;q=90 1200w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=1920&amp;q=90 1920w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=2048&amp;q=90 2048w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=3840&amp;q=90 3840w" src="https://sambroner.com/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fweather.jpeg&amp;w=3840&amp;q=90"/></p><p><img alt="Jarvis e-ink voice-to-image display" loading="lazy" width="500" height="400" decoding="async" data-nimg="1" sizes="(max-width: 767px) 100vw, 800px" srcset="/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=640&amp;q=90 640w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=750&amp;q=90 750w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=828&amp;q=90 828w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=1080&amp;q=90 1080w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=1200&amp;q=90 1200w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=1920&amp;q=90 1920w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=2048&amp;q=90 2048w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=3840&amp;q=90 3840w" src="https://sambroner.com/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fjarvis.jpeg&amp;w=3840&amp;q=90"/></p></div><p>Jarvis live demo is better!</p></div>
<p>Then over Thanksgiving, I had some free time, a basket of spare parts, and the itch to code and build something physical. So here we are with the e-ink train and weather tracker.</p>
<p>The idea is simple: Every morning, my wife and I take the inbound F or G subway lines to work from a stop that&#39;s a 2-minute jog or a 6-minute walk from our house. I love the NYC subway and it works incredibly well, but the trains come <em>often</em> and <em>predictably</em>, not <em>on-a-schedule</em>. So every morning we&#39;re calling out, when&#39;s the next G, when&#39;s the next F — and one of us pulls out a phone for the MTA app or Google Maps and yells back the upcoming train times. Then we time our morning routines to either stretch for a train in three minutes or slow down for a train in ten.</p>
<p>The subway and weather tracker makes checking train times much faster and calmer than pulling out a phone. Since it&#39;s centrally located in our home, someone is always close enough to glance at it.</p>
<p>The subway times reported by the <a href="https://www.mta.info/developers">MTA API</a> are reliable once the train is within a few stops or 15 minutes away, with precision increasing as the trains get closer. Having the train times on the wall lets you check how your morning routine is developing against the train schedule as the departure time gets closer.</p>
<p>Best of all, Kira loves it! This goes on my DIY pantheon along with adding legs to her dresser to make it a better height and fixing a towel rack right before she hosted her colleagues for a book club.</p>
<p>If you want to build one yourself or better understand the project, I&#39;ll dive into some editorial and gotchas below. The practical instructions, parts, and code live in this <a href="https://github.com/SamBroner/subway-e-ink-tracker">GitHub Repo</a>.</p>
<h2>Description &amp; Features</h2>
<p>The train &amp; weather tracker is built on a <a href="https://www.waveshare.com/product/displays/e-paper/9.7inch-e-paper-hat.htm">9.7&#34; 1200x825 E-Ink display</a> attached to a <a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry Pi 4b</a>. The display is split into four parts: a header, with date, time, and a live second hand to indicate liveness; a train tracker; the commute weather; and a &#34;weather bar&#34; displaying the next 12 hours of weather. The main focus of the layout is the train tracker, which shows the upcoming 30 minutes of inbound F &amp; G trains.</p>
<div><div><p><img alt="Raw e-ink display showing the train tracking interface" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" sizes="(max-width: 767px) 100vw, 800px" srcset="/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=640&amp;q=90 640w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=750&amp;q=90 750w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=828&amp;q=90 828w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=1080&amp;q=90 1080w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=1200&amp;q=90 1200w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=1920&amp;q=90 1920w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=2048&amp;q=90 2048w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=3840&amp;q=90 3840w" src="https://sambroner.com/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fraw-display.jpeg&amp;w=3840&amp;q=90"/></p></div></div>
<p>The display sits in a laser cut mat board with black ridges sized to hide the black border of the e-ink display. The mat board sits in a 8.5&#34; x 11&#34; cherry frame that is 1.5&#34; deep to allow the raspberry pi to be backmounted while the frame is still flush to the wall. We hang the display next to the door above a key holder, which is generally the right place for it, but also helps hide the power cord.</p>
<div><div><p><img alt="Back of the frame showing Raspberry Pi and wiring" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" sizes="(max-width: 767px) 100vw, 800px" srcset="/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=640&amp;q=90 640w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=750&amp;q=90 750w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=828&amp;q=90 828w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=1080&amp;q=90 1080w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=1200&amp;q=90 1200w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=1920&amp;q=90 1920w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=2048&amp;q=90 2048w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=3840&amp;q=90 3840w" src="https://sambroner.com/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fback-of-frame.jpeg&amp;w=3840&amp;q=90"/></p></div><p>Not pretty, but it works</p></div>
<h2>Project Details</h2>
<p>The software portion of the project is manageable although there are some gotchas when programming against the Waveshare e-ink hat in particular. We have a modular architecture with a clear separation of concerns:</p>
<ol>
<li>
<p>Display Engine: Renders the layout to the display, supporting communication with the physical e-ink display or rendering a png for non-raspberry pi development</p>
</li>
<li>
<p>Layout System: A pretty hacky visual arrangement of the elements. It&#39;d be fun to do something more sophisticated here (e.g. a html renderer), but 🤷‍♂️. This will likely require the most work if you want to modify the project</p>
</li>
<li>
<p>Data Services: Fetch &amp; process (this is important!) train arrival from NYC Transit GTFS feeds + get the weather forecasts</p>
</li>
<li>
<p>Application Controller: Orchestrate the event loop and subscription model to drive updates to the display</p>
</li>
</ol>
<p>The biggest technical constraint is the update rate to the e-ink display. The display supports multiple update modes with different tradeoffs and <em>can</em> manage sub 500 ms updates, especially for partial updates, but a faster refresh results in fuzzy characters and substantial ghosting that looks pretty bad. The bigger issue is that overloading the display causes it to crash, which requires a full reset.</p>
<p>After some testing, I chose a hybrid display update strategy.</p>
<p>Every second, the pixels around the seconds &amp; minutes digits of the time are rerendered with the display&#39;s fastest partial update mode to make it clear that the display is functioning as expected.</p>
<p>When there is an update to one of the next two train times (these matter more than trains 30 minutes away), there is a fast-full display render — all data is updated at this point, but only new arrival times for one of the next two trains will drive the update.</p>
<p>On the hour, the display does a deep full-screen render to sharpen the characters and remove ghosting.</p>
<div><div><p><img alt="Different e-ink refresh modes and their visual effects" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" sizes="(max-width: 767px) 100vw, 800px" srcset="/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=640&amp;q=90 640w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=750&amp;q=90 750w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=828&amp;q=90 828w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=1080&amp;q=90 1080w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=1200&amp;q=90 1200w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=1920&amp;q=90 1920w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=2048&amp;q=90 2048w, /_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=3840&amp;q=90 3840w" src="https://sambroner.com/_next/image?url=%2Fposts%2Fraspberry-pi-train%2Fmode-summaries.jpeg&amp;w=3840&amp;q=90"/></p></div><p>Honestly, you gotta experiment to understand how these will look</p></div>
<p>Doing deep full screen renders can be jarring — it results in a black and white flash that attracts too much attention to the screen — but once an hour is a fine cadence. For the train times, a fast-full display render works better than a partial refresh because of the layout. The fast partial render cuts across elements, drawing more attention to the refresh than a full refresh. This could maybe be improved through more purposeful partial refresh rectangle selection, but the current solution works well.</p>
<p>The framing was tricky because I wanted something nice, but without breaking the bank. I&#39;m not great at woodworking and I also didn&#39;t want to spend $300-$500, which was the range of quotes (FWIW, I have been trying to find a low cost framing solution for these broken glass pieces for years — let me know if you have any ideas). The e-ink display is awkwardly sized due to the connection cables and drivers. The display surface also has a fine looking, but inelegant border that should be covered. After talking to a few framers, one of them suggested I buy <em>just</em> a custom mat. The mat hides the display, Raspberry Pi, and cabling, but more importantly the outside of the mat is right sized to fit into a standard-sized frame.</p>
<p>The finished product sits neatly beside our door, providing the exact information we need at just the right time each morning. I&#39;ve written before about the &#34;agency gap&#34; — the gap between what people do and what would be easy, but useful to do. This project is a bit more involved than that, but at ~20 hours of work, it was worth it to me. I built something that solves a daily need, we actually use it, guests talk about it, and it looks great.</p></div></div>
  </body>
</html>
