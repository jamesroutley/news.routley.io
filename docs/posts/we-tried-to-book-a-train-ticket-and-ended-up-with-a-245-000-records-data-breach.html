<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zerforschung.org/posts/freundschaftspass-en/">Original</a>
    <h1>We tried to book a train ticket and ended up with a 245,000 records data breach</h1>
    
    <div id="readability-page-1" class="page"><div>
            <figure><a href="https://zerforschung.org/p/freundschaftspass/fr-de-freundschaftspass-titel.jpg"><img src="https://zerforschung.org/p/freundschaftspass/fr-de-freundschaftspass-titel-small.jpg" alt="A model of a steam locomotive with French and German flags,a Trans-Europ-Express wagon attached. The train is losing tickets"/></a>
</figure>


<p>To celebrate Franco-German friendship, German Transport Minister Wissing and his French counterpart Beaune came up with something special:
<a href="https://bmdv.bund.de/SharedDocs/EN/PressRelease/2023/052-wissing-franco-german-friendship-pass-available.html">30,000 free Interrail tickets</a> per country for travel in Germany and France for young adults between 18 and 27.
Codename: “Passe France Allemagne”</p>
<p>However, many things went wrong when the Interrail passes were distributed.
In the following, we want to take you on a journey through the stages of the not-so-well-implemented ticket and show you how you could still get a pass after registration ended.</p>
<p>And while we’re on the tracks, we’ll also have a look at a security breach in a similar project at the EU level.
Implemented by the same agency - which left the data of about 245,000 registrations almost unprotected on the web.</p>
<p>Please stand clear of the doors – we’re departing! 🚄🚃🚃🚃🚃</p>

<p>On June 12 at 10am, the registration for the “Passe France Allemagne” opened - and the servers were immediately overloaded.</p>
<p>The rush could have been expected, as the tickets were distributed on a “first come, first served” basis.
Anyone who wanted a chance to get one of the coveted tickets had to be quick.
As a result, tens of thousands of users in Germany and France tried to get their hands on the pass at 10 a.m. on the dot.</p>
<p>Of course, setting up a system that can handle such a rush is not trivial.
But it is possible!
Organizers of concerts by popular bands and artists, for example, are familiar with similar situations - and can usually cope with them.</p>
<p>Something like this has to be well thought out, prepared and tested.
If they had done that properly, they would have realized: Damn, we can’t handle so many people - and (hopefully) would have thought of another solution.</p>
<p>After all, there are alternatives to the “first come, first served” principle:
Instead of putting everything on a moment’s notice, you can spread the sale over several points in time.
This not only spreads out the rush - it also allows people to attend who don’t have time on a Monday at 10 a.m., for example because they’re at school, in training or at university.</p>
<p>In such a system, you can also give interested people a few days to register and then distribute the passes at random amongst all who registered.</p>
<p>Because one thing is for certain: Overloaded servers are not a sign of the success of a campaign, but a sign of failure in planning.</p>
<h2 id="station-2-password-reset-city">Station 2: Password-Reset-City</h2>
<p>While we were still angry about this failure, we got a hint by mail:
This wasn’t the only part of the platform that wasn’t properly thought out and tested.</p>
<p>How did this show?
The lucky few who were able to secure a pass had to provide an email address and come up with a password.
With that combination, they could then log into the site to check for the status of their “Passe France Allemagne”.</p>
<p>It’s easy to forget or mistype a password - especially when things need to happen quickly.
Fortunately, the “Forgot Password?” function was invented for such situations.
And as usual, you receive an e-mail from the “Passe France Allemagne” with a link to reset your password.
What is unusual, however, is that this link leads to an error page:</p>
<figure><a href="https://zerforschung.org/p/freundschaftspass/vercel-404.png"><img src="https://zerforschung.org/p/freundschaftspass/vercel-404.png" alt="Screenshot of a 404 error page: &#39;deutschebahn-sncf-form.vercel.app might be available. Click here to learn how to assign it to a project&#39;"/></a>
</figure>

<p>If we take a closer look at the error page, we see that it links to a Vercel project that is not registered.
Vercel is a cloud provider where you can host your own web applications.
These applications are then available under <code>&lt;project name&gt;.vercel.app</code>.
However, if no project is registered with the corresponding name, as is the case here, basically anyone can hijack the address.</p>
<p>Such an hijacked application address could then for example be used for targeted phishing.
Fortunately, it was an honest person who found the mistake, registered the application themself and told the responsible organisations and us.
Thus, the link to the “Forgot Password?” function only leads to a harmless test page.
This page still does not belong to the organizers of the “Passe France Allemagne”, but at least to a friendly person and not to criminals.</p>
<h2 id="station-3-free-tickets-for-all-avenue">Station 3: Free-tickets-for-all-avenue</h2>
<p>This brings us to the next stop on our journey:
The ordering process.</p>
<p>Since only 30,000 passes were supposed to be given out, the ordering system has to pay close attention to that.
As soon as the 30,001st person tries to register, the system would have to show an error and no longer allow registration.
But that was not the case here:
Instead, once the first 30,000 people started filling out the booking form, the form was simply removed from the page.
The website now displays a notice stating that all passes have been allocated.</p>
<p>But just because you <em>started</em> the form, doesn’t mean you already finished it.
So a backdoor was built in:
Anyone who had already started an order process but not completed it received an e-mail with a special link.
This link could then be used to complete the order process.</p>
<p>There was just only one tiny problem:
You could generate these codes yourself with a simple command - even if you didn’t start the order process in time.</p>
<video controls="" preload="none" poster="/p/freundschaftspass/bypass-poster.jpg">
    <source src="/p/freundschaftspass/bypass.webm" type="video/webm"/>
    <source src="/p/freundschaftspass/bypass.mp4" type="video/mp4"/>
</video>
<p>The video shows a new code being generated on the left side of the screen.
This code is then copied into the browser on the right, where the order form for the “Passe France Allemagne” then opens.
The form is filled out and at the end you see a confirmation that the registration was successful.</p>
<p>A few hours later, our new Interrail pass arrived by e-mail.</p>
<p>So the whole thing is kind of like having a treasure in your house - and hanging a sign on the front door saying “All the gold has already been distributed”. But everyone can find the key to the back door.</p>
<div><p>
	If you want to know exactly when everything happened, you can find <a href="#timeline">a timeline at the end of the article</a>.
</p></div>
<h2 id="detour-via-reporting">Detour via Reporting</h2>
<figure><a href="https://zerforschung.org/p/freundschaftspass/zug-baustelle-umleitung.jpg"><img src="https://zerforschung.org/p/freundschaftspass/zug-baustelle-umleitung-small.jpg" alt="The model train with the French and German flags detours, as there is a construction site with excavators in front of it."/></a>
</figure>

<p>Of course, we wanted to quickly report the problems to the appropriate parties so they could be fixed.
Unfortunately, this turned out to be more difficult than expected: a security contact was nowhere to be found.<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup></p>
<p>In the end we contacted all places that seemed like they could change something: The advertising agency that’s named in the imprint of the “Passe France Allemagne”. The IT security team of the german railway (Deutsche Bahn). The contact address from the imprint of the german page of the “Passe France Allemagne”. The contact address of the german Ministry of Transportation. And finally, the german federal computer emergency response team (CERT-Bund). We sent a description of the issue to all these and asked for confirmation of receipt and next steps.</p>
<p>Unfortunately, we did not receive an answer at first.
Howevery one day later, the extra access was no longer available.
Instead, the backdoor page also showed a notice that all passes were already taken.</p>
<p>Figuratively speaking, the back door was also provided with a notice: “Unfortunately, all gold bars have already been distributed.”</p>
<h2 id="station-4-where-the-wild-apis-live">Station 4: Where the wild APIs live.</h2>
<p>But noone checked if the door were actually locked.
As it turns out: By sending api request directly to the order backend, we could keep generating passes.</p>
<p>Only a few minutes later, the pass arrived by email:</p>
<figure><a href="https://zerforschung.org/p/freundschaftspass/pass-email.png"><img src="https://zerforschung.org/p/freundschaftspass/pass-email.png" alt="Screenshot of interrail pass confirmation with code to redeem the pass in app"/></a>
</figure>

<h2 id="station-5-unfortunately-we-came-to-an-unscheduled-stop">Station 5: “Unfortunately, we came to an unscheduled stop…”</h2>
<p>At this point we didn’t know what to do anymore.</p>
<p>So we put our heads together and tried to find a solution.
We knew that all people in charge were just pointing at the press office of Eurail (i.e. the company behind all Interrail passes, which was probably charged with issuing these passes as well) - and Eurail claimed there was no loophole.
So we sent our description to the press office again.</p>
<p>Thereupon - and after insistent requests through other channels - we finally got an answer.
Eurail thanked us for pointing out the issue, told us that they had fixed the issue and were now looking for the falsely issued passports.</p>
<details>
    <summary>How Eurail fixed the issue</summary> 
<p>The backend for the order page was build with Supabase.
The API part for this is implemented using <a href="https://github.com/PostgREST/postgrest">PostgREST</a>.</p>
<p>Conveniently, PostgREST provides <a href="https://fixmgvbxfmvoowptgiti.supabase.co/rest/v1/?apikey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpeG1ndmJ4Zm12b293cHRnaXRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODUxMDM4NDgsImV4cCI6MjAwMDY3OTg0OH0.A4clN0pRnK6gMoAbnPIOzLe2Ij5_q6nTIvg0D0S5CA4">automatic API documentation</a>.
So we can easily track what they really changed.</p>
<p>And this change was actually relatively small:</p>
<p>All api endpoints of the order process now have a new parameter <code>secret_key</code>.
If you don’t specify this parameter, you can’t call the functions at all.</p>
<div><pre tabindex="0"><code data-lang="json"><span><span>{
</span></span><span><span>  <span>&#34;code&#34;</span>: <span>&#34;PGRST202&#34;</span>,
</span></span><span><span>  <span>&#34;details&#34;</span>: <span>&#34;Searched for the function public.step_eligibility with parameters accepted_conditions, accepted_privacy, birth_date, last_step_completed, residence_country, user_session_code or with a single unnamed json/jsonb parameter, but no matches were found in the schema cache.&#34;</span>,
</span></span><span><span>  <span>&#34;hint&#34;</span>: <span>&#34;Perhaps you meant to call the function public.step_eligibility(accepted_conditions, accepted_privacy, birth_date, last_step_completed, residence_country, secret_key, user_session_code)&#34;</span>,
</span></span><span><span>  <span>&#34;message&#34;</span>: <span>&#34;Could not find the function public.step_eligibility(accepted_conditions, accepted_privacy, birth_date, last_step_completed, residence_country, user_session_code) in the schema cache&#34;</span>
</span></span><span><span>}
</span></span></code></pre></div><p>If you specify an incorrect <code>secret_key</code>, you will get an error message:</p>
<div><pre tabindex="0"><code data-lang="json"><span><span>{
</span></span><span><span>  <span>&#34;code&#34;</span>: <span>&#34;P0001&#34;</span>,
</span></span><span><span>  <span>&#34;details&#34;</span>: <span>null</span>,
</span></span><span><span>  <span>&#34;hint&#34;</span>: <span>null</span>,
</span></span><span><span>  <span>&#34;message&#34;</span>: <span>&#34;Not allowed&#34;</span>
</span></span><span><span>}
</span></span></code></pre></div><p>We could not try what happens if you sent a request with the correct <code>secret_key</code> - because we (fortunately) do not know it.</p>
</details>
<p>So now both the front door and the back door were finally locked.</p>
<div>
	<p>Just to emphasize that again:
Publishing an API doc is not a security breach!
On the contrary, it should actually be good practice to do so.
Because a software does not become more secure by the fact that nobody knows exactly how it works.</p>
<p>Your front door doesn’t become more secure by painting it in exactly the same color as your house wall, so it’s not so easy to spot.
It may look funny and confuse you at first - but the door will be more secure if you lock it.</p>
<p>So <em>lock</em> it, don’t hide it! 🤝</p>
</div>
<h2 id="station-6-data-leak-of-245000-records-today-from-track-2---directly-opposite">Station 6: “Data leak of 245,000 records today from track 2 - directly opposite.”</h2>
<figure><a href="https://zerforschung.org/p/freundschaftspass/databreach-aus-zug.jpg"><img src="https://zerforschung.org/p/freundschaftspass/databreach-aus-zug-small.jpg" alt="Two model trains are parked on the platform, shredded paper falling out of the open doors from the train on the opposite side."/></a>
</figure>

<p>But these doors to more passes weren’t the only ones we found unlocked.
We also took a look at the neighboring projects and found another offer similar to the “Passe France Allemange”: <a href="https://youth.europa.eu/discovereu_en">DiscoverEU</a>.</p>
<p>This program emerged back in 2018 as a result of the <a href="https://en.wikipedia.org/wiki/Interrail#DiscoverEU">#FreeInterrail campaign</a>.
18-year-olds can sign up to win a free Interrail pass and travel Europe.</p>
<p>While the “Passe France Allemagne” was dreamed up by the German and French governments, DiscoverEU was the created by the European Commission.
However, both offers have one crucial thing in common:
This project was implemented by the same agencies - MCI together with <a href="https://www.caracal.agency/en/projects/discover-eu">Caracal</a>.</p>
<p>Information about DiscoverEU is available at <code>start-discover.eu</code>.
But we didn’t spend much time looking around.
Because through the <a href="https://crt.sh/?q=start-discover.eu">Certificate Transparency Logs</a> we quickly discovered the domain <code>dashboard.start-discover.eu</code>.
The domain sounds exciting - but we are only greeted with a login screen.</p>
<p>On a technical level, the site is built similarly to the “Passe France Allemagne” - and thus we already knew the API to create an account.
On the off chance we created an account – and to our surprise we were able to successfully log in with it.
With great concern for the work that now followed, we noticed:</p>
<p>245,971 registrations for DiscoverEU were retrievable on the dashboard.
The following data was displayed:</p>
<ul>
<li>Name of the person</li>
<li>E-mail address</li>
<li>Country of origin</li>
<li>State of their registration</li>
<li>Type of ticket</li>
<li>Interrail order number</li>
</ul>
<figure><a href="https://zerforschung.org/p/freundschaftspass/dashboard.png"><img src="https://zerforschung.org/p/freundschaftspass/dashboard.png" alt="Screenshot of the dashboard: you can see a table with the columns &#39;A. Code&#39;, &#39;G.Code&#39;, &#39;E-mail&#39;, &#39;First name&#39;, &#39;Last name&#39;, &#39;Status&#39;, &#39;Special type&#39;, &#39;Type&#39;, &#39;County&#39;"/></a>
</figure>

<p>All of this personal data was virtually open on the Internet and could be retrieved with little effort or prior knowledge.</p>
<details>
    <summary>Technical details</summary>
<p>The steps necessary to exploit the vulnerability were:</p>
<ol>
<li>
<p>Create an account using the following <code>curl</code> command. <code>[EMAIL]</code> and <code>[PASSWORD]</code> would need to be replaced with an email address and password:</p>
<div><pre tabindex="0"><code data-lang="shell"><span><span>curl --request POST <span>\
</span></span></span><span><span><span></span>  --url https://zaymuaqytesywmkspxqk.supabase.co/auth/v1/signup <span>\
</span></span></span><span><span><span></span>  --header <span>&#39;Content-Type: application/json&#39;</span> <span>\
</span></span></span><span><span><span></span>  --header <span>&#39;apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpheW11YXF5dGVzeXdta3NweHFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE2Njk5OTM3NTgsImV4cCI6MTk4NTU2OTc1OH0.JraN96zZgiM5iOkWFqNmQYWZG2jS7kTeEaYS6eW8xj4&#39;</span> <span>\
</span></span></span><span><span><span></span>  --data <span>&#39;{
</span></span></span><span><span><span>    &#34;email&#34;: &#34;[EMAIL]&#34;,
</span></span></span><span><span><span>    &#34;password&#34;: &#34;[PASSWORD]&#34;
</span></span></span><span><span><span>}&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>After a few moments, a confirmation email will arrive. Click on the link contained in it:</p>
<figure><a href="https://zerforschung.org/p/freundschaftspass/confirmation.png"><img src="https://zerforschung.org/p/freundschaftspass/confirmation.png" alt="Screenshot of the Confirmation Email: &#39;Follow this link to confirm your user.&#39;"/></a>
   </figure>

</li>
<li>
<p>Log in with the newly created account on <code>https://dashboard.start-discover.eu</code>.</p>
</li>
<li>
<p>You can see all registrations.</p>
</li>
</ol>
</details>
<h2 id="another-stop-in-reporting">Another stop in reporting</h2>
<figure><a href="https://zerforschung.org/p/freundschaftspass/report-per-postwaggon.jpg"><img src="https://zerforschung.org/p/freundschaftspass/report-per-postwaggon-small.jpg" alt="The model train&#39;s mail car, in the open door an oversized paper with the inscription ZER-Report"/></a>
</figure>

<p>Completely shocked by this databreach, we again unpacked our digital stationery and reported very quickly:
To the agency, the contact address of Start-Discover.eu, the CERT-EU and the office of the European Commission responsible for DiscoverEU.
Fortunately, we already knew the right contact person in the press office of Eurail, who then quickly passed the whole thing on to the responsible people.</p>
<p>They reacted quickly and after less than an hour the vulnerabilty was closed - they simply deactivated the registration of new account.
They also informed us that that an external security test would now be carried out and the necessary steps defined in the GDPR would be taken.</p>
<h2 id="last-stop-conclusion">Last Stop: Conclusion</h2>
<p>The “Passe France Allemagne” and DiscoverEU are actually great ideas: Free train tickets for young people to get to know their neighboring countries.
But instead of simply enabling as many people as possible to enjoy a nice summer vacation and make new acquaintances, this unfortunately once again resulted in a digital disaster.</p>
<p>The “Passe France Allemagne” is also a good example of the power imbalances created by bad digital solutions:
Those who have enough technical knowledge still get a passport even if all of them are actually already taken.
Everyone else goes away empty-handed or even loses their accounts.</p>
<p>Such half-baked solutions would already be insufficient to sell a few concert tickets.
But if a federal ministry gives away train tickets, special attention has to be paid that everything is well tested.</p>
<p>It gets even worse when we can not only create new passports, but even retrieve more than 245,000 records from the DiscoverEU program.
We say times and times again: <strong>If a website is mature enough to process data, it must also be mature enough to keep it to itself.</strong></p>
<p>We can only hope that we really were the first to discover this vulnerability - and that the data has not already been taken away by less benevolent actors.</p>
<h2 id="timeline">Timeline</h2>
<p>All times are CEST.</p>
<ul>
<li>2023-06-12 10:00 – Start of sale.</li>
<li>2023-06-12 – Unregistered Vercel application is found and reported.</li>
<li>2023-06-13 23:00 – We find the backdoor.</li>
<li>2023-06-14 01:15 – Report to DB-CSIRT, MCI, contact named in the imprint, BMDV, CERT-Bund</li>
<li>2023-06-14 22:00 – Our test addresses receive interrail passes</li>
<li>2023-06-15 00:00 – We send the report to Eurail as well</li>
<li>2023-06-15 10:00 – We notice that the backdoor is also replaced by the “sold out”-notice</li>
<li>2023-06-15 13:00-14:00 – We can verify that passes are still registerable via API</li>
<li>2023-06-15 17:30 – Reply from Eurail that the loopholes have been closed</li>
<li>2023-06-16 13:00 – We discover the databreach at Start-Discover.eu</li>
<li>2023-06-16 15:30 – We report the databreach</li>
<li>2023-06-16 18:50 – MCI replies to us, thanks for the report, at 16:20 the vulnerability had been closed</li>
</ul>
<h2 id="heading">🤝</h2>
<p>We shared our findings with Eva Wolfangel for ZEIT Online. You can find her article <a href="https://www.zeit.de/digital/datenschutz/2023-06/freundschaftspass-frankreich-website-hacker">here</a> (in German).</p>
<p>Originally we wanted to publish our findings on Friday, 16th of june 2023.
But because we discovered the databreach at DiscoverEU, reported them and waited until everything was secured, we postponed the publication.</p>
<div>
	<p>Documenting, reporting and publishing such issues takes nerves and time - which we would also much rather spend looking out the train window. We do all this on a voluntary basis and in our spare time.</p>
<p>If you want to support us, you can find possibilities here: <a href="https://zerforschung.org/unterstuetzen/">https://zerforschung.org/unterstuetzen/</a></p>
</div>

        </div></div>
  </body>
</html>
