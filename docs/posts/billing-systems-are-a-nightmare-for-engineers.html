<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.getlago.com/blog/why-billing-systems-are-a-nightmare-for-engineers">Original</a>
    <h1>Billing systems are a nightmare for engineers</h1>
    
    <div id="readability-page-1" class="page"><div id="w-node-a2511b8d-977b-8d65-1ffe-a912f63f53b6-8d5ad993"><div><blockquote><em>&#34;On my first day, I was told: &#34;Payment will come later, shouldn&#39;t be hard right?&#34; </em><strong><em>billing is hard. Harder than you think</em></strong><em>. It&#39;s time to solve that once and for all.&#34;</em></blockquote><p>This is a typical conversation we have with engineers on a daily basis. In that case, these are <a href="https://www.linkedin.com/in/kevindeldycke/">Kevin</a>‚Äôs words, who was the VP Engineering at <a href="https://www.scaleway.com/en/">Scaleway</a>, one of the European leaders in cloud infrastructure.</p><p>Some of you asked me why billing was that complex, after my <a href="https://www.getlago.com/blog/pricing-my-only-growth-hack-at-qonto">latest post about my ‚ÄòPricing Hack‚Äô</a>. My co-founder <a href="https://www.linkedin.com/in/sarkissianraffi/">Raffi</a> took on the challenge of explaining why it‚Äôs still an unsolved problem for engineers.¬†</p><p>We also gathered insights from other friends who went through the same painful journey, including <a href="https://www.algolia.com/">Algolia</a>, <a href="http://www.segment.com">Segment</a>, <a href="https://www.pleo.io/">Pleo</a>, don‚Äôt miss them! Passing the mike to Raffi.¬†</p><p>When you‚Äôre thinking about automating billing, this means your company is getting traction. That‚Äôs good news!¬†</p><p>You might then wonder: should we build it in-house? It does not look complex, and the logic seems specific to your business.</p><p>Also, you might want to preserve your precious margins and therefore avoid existing billing solutions like Stripe Billing or Chargebee that take a cut of your revenue. Honestly, who likes this rent-seeker approach?¬†</p><p>Our team at Lago still has some painful memories of the internal billing system at Qonto, that we had to build, maintain, and deal with.. Why was it that painful?¬† In this article, I will provide a high-level view of¬† the technical challenges we faced while implementing hybrid pricing (based on both &#39;subscription&#39; and &#39;usage&#39;), and what we learned the hard way in this journey. </p><figure><p><img src="https://uploads-ssl.webflow.com/6244531a40ad7ef5475ad9b3/62827b2f6fa52239b0db0fa4_Blog%20Post%20Image%20Standalone.png" loading="lazy" alt=""/></p><figcaption>Engineers be like...</figcaption></figure><h3>TL;DR: Billing is just 100x harder than you will ever think</h3><p><em>Let‚Äôs bill yearly as well, should be pretty straightforward&#39;</em> claims the Revenue team. Great! Everyone is excited to start working on it. Everyone, except the tech team. When you start building your internal billing system, it&#39;s hard to think of all the complexity that will pop up down the road, unless you‚Äôve experienced it before.</p><p>It‚Äôs common to start a business with a simple pricing. You define one or two price plans, and limit this pricing to a defined number of features. However, when the company is growing, the pricing gets more and more complex, just like your entire codebase.</p><p>At Qonto, our first users could only onboard on a ‚Ç¨9 plan. We quickly decided to add plans, and &#39;pay-as-you-go&#39; features (such as ATM withdrawals, foreign currency payments, one shot capital deposit, etc...) to grow revenue.</p><p>Also, as Qonto is a &#39;neobank&#39;, we wanted to charge our customers directly in their wallet, through a ledger connected to our internal billing system. The team¬† started from a duo of full-time engineers building a billing system (which is already a considerable investment), to currently a dedicated cross-functional team called &#39;<em>pricing&#39;</em>.</p><p>This is not specific to Qonto of course. Pleo, another Fintech unicorn from Denmark faced similar hurdles: </p><blockquote><em>&#34;I‚Äôve learned to appreciate that billing systems are hard to build, hard to design, and hard to get working for you if you deviate from &#39;the standard&#39; even by a tiny bit.&#34; </em></blockquote><p>admits <a href="https://www.linkedin.com/in/arnon-shimoni/?originalSubdomain=dk">Arnon Shimoni</a>, leading Product Billing Infrastructure at Danish Fintech unicorn <a href="http://www.pleo.io">Pleo</a>.</p><p>This is not even specific to Fintechs. The <a href="http://www.algolia.com">Algolia</a> team ended up creating a whole pricing department, now led by <a href="https://www.linkedin.com/in/djayramasubban/">Djay</a>, a Pricing and monetization veteran, from Twilio, VMWare, Service Now. They pivoted their pricing to a &#39;<a href="https://openviewpartners.com/blog/going-usage-based-how-algolia-built-their-most-customer-friendly-pricing-model-ever/">pay-as-you-go&#39; model based </a>pricing based on the number of monthly API searches¬†</p><blockquote><em>&#34;It looks easy on paper ‚Äî however, it‚Äôs a challenge to bring automation and transparency to a customer, so they can easily understand. There is a lot of behind-the-scenes work that goes into this, and it takes a lot of engineering and investment to do it the right way.&#34;</em></blockquote><p>says their CEO, <a href="https://www.linkedin.com/in/bernadettenixon/">Bernardette Nixon</a> in <a href="https://venturebeat.com/2022/04/01/how-enterprise-search-giant-algolia-embraced-usage-based-saas-pricing/">Venture Beat</a> and we could not agree more.</p><h3>#1 - Dates</h3><p>When implementing a billing system, dealing with dates is often the number 1 complexity. Somehow, all your subscriptions and charges deal with a number of days. Whether you make your customers pay weekly, monthly or yearly, you need to roll things over a period of time called the <strong>billing period</strong>.</p><p>Here is a non-exhaustive list of difficulties for engineers:</p><ol role="list"><li>How to deal with leap years?</li><li>Do your subscriptions start at the beginning of the month or at the creation date of the customer?</li><li>How many days/months of trial do you offer?</li><li>Who decided February only holds 28 days? ü§î</li><li>Wait, bullet 1 is also important for February... ü§Ø</li><li>How to calculate a usage-based charge (price per seconds, hours, days...)?</li><li>Do I resume the consumption or do I stack it month over month? Year over year?</li><li>Do I apply a pro-rata based on the number of days consumed by my customer?</li></ol><p>Although every decision is reversible, billing cycle questions are often the most important source of customer support tickets, and iterating on them is a highly complex and sensitive engineering project.¬†</p><p>For instance, Qonto migrated the billing cycle start date from the &#39;anniversary&#39; date, to the &#39;beginning of the month&#39; date, and the approach was described <a href="https://medium.com/qonto-way/biller-migration-how-we-changed-our-billing-cycle-cf3c4cdd7cf4">here</a>. It was not a trivial change.</p><h3>#2 - Upgrades &amp; downgrades</h3><p>Then, you need to enable your customers to upgrade or downgrade their subscriptions. Moving from a plan A to a plan B seems pretty easy to implement, but it&#39;s not. Let&#39;s zoom on potential edge cases you could face.</p><p><strong>Downgrades</strong></p><ol role="list"><li>The user downgrades in the middle of a period. Do we block features right now or at the end of the current billing period?</li><li>The user has paid the plan in advance (for the next billing period)</li><li>The user has paid the plan in arrears (for what he has really consumed)</li><li>The user downgrades from a yearly plan to a monthly plan</li><li>The user downgrades from a plan paid in advance to a plan paid in arrears (and vice-versa)</li><li>The user has a discount applied when downgrading</li></ol><p><strong>Upgrades</strong></p><ol role="list"><li>The user upgrades in the middle of a period. We probably need to give her access to the new features right now. Do we apply a pro-rata? Do we make her pay the pro-rata right now? At the end of the billing period?</li><li>The user upgrades from a plan paid in advance to a plan paid in arrears</li><li>The user upgrades from a monthly plan to a yearly plan. Do we apply a pro-rata? Do we make her pay the pro-rata right now? At the end of the billing period?</li><li>The user upgrades from a plan paid in advance to a plan paid in arrears (and vice-versa)</li></ol><p>We did not have a ‚Äòfree trial‚Äô period at the time at Qonto, but Arnon from Pleo describes the additional scenarii this creates <a href="https://arnon.dk/5-things-i-learned-developing-billing-system/#comment-7604">here</a>.</p><h3>#3 - Usage-based computations</h3><p>Subscription based billing is the first step when implementing a billing system. Each customer needs to be affiliated to a plan in order to start charging the right amount at the right moment.</p><p>But, for a growing number of companies, like we did at Qonto, other charges come alongside this subscription. </p><p>These consumption-based charges are tough to track at scale, because they often come with math calculation rules, performed on a high volume of events that need to be tracked.</p><p>Some examples:</p><p><a href="https://segment.com/pricing/"><strong>Segment.com</strong></a><strong> tracks the number of Monthly Tracked Users</strong></p><p>This means that they need to COUNT the DISTINCT number of users, each month, and resume this value at the end of the billing period. In order to get the number of unique visitors, they need to apply a DISTINCT to deduplicate them.</p><figure><p><img src="https://uploads-ssl.webflow.com/6244531a40ad7ef5475ad9b3/626bf9dbb1b8b2d73e264145_carbon%20(1).png" loading="lazy" alt=""/></p></figure><figure><p><img src="https://uploads-ssl.webflow.com/6244531a40ad7ef5475ad9b3/626bff731bfe1145236ce221_carbon%20(1).png" loading="lazy" alt=""/></p></figure><p>‚Äç</p><p><a href="https://www.algolia.com/pricing/"><strong>Algolia</strong></a><strong> tracks the number of api_search per month</strong></p><p>This means they need to SUM the number of monthly searches for a client and resume it at the beginning of each billable period.</p><figure><p><img src="https://uploads-ssl.webflow.com/6244531a40ad7ef5475ad9b3/626bffa42e754fdff653ef4c_carbon%20(1).png" loading="lazy" alt=""/></p></figure><figure><p><img src="https://uploads-ssl.webflow.com/6244531a40ad7ef5475ad9b3/626bff48b94c1a432e3bd871_carbon%20(1).png" loading="lazy" alt=""/></p></figure><p>It becomes even more complex when you start calculating a charge based on a timeframe. For instance, <a href="http://www.snowflake.com"><strong>Snowflake</strong></a> charges the compute usage of a data warehouse per second.¬†</p><p>This means that they sum the number of Gigabytes or Terabytes consumed, multiplied by the number of seconds of compute time.</p><p>Maybe an example we can all relate to would be the one of an <strong>energy company</strong> who needs to charge $10 per kilowatt of electricity used per hour, for instance. In the example below, you can get an overview of what needs to be modeled and automated by the billing system.</p><figure><p><img src="https://uploads-ssl.webflow.com/6244531a40ad7ef5475ad9b3/626aaf92c47134eb367f24e1_usage-based-billing.png" loading="lazy" alt=""/></p></figure><ul role="list"><li>Hour 1: 10 KW used for 0.5 hour = <strong>5 KW</strong> (10 x 0.5)</li><li>Hour 2: 20 KW used for 1 hour = <strong>20 KW</strong> (20 x 1)</li><li>Hour 3: 0 KW used for 1 hour = <strong>0 KW</strong> (0 x 1)</li><li>Hour 4: 30 KW used for 0.5 hour = <strong>15 KW</strong> (30 x 0.5)</li></ul><p><strong>TOTAL = 40 KW used x $10 ‚áí $40</strong></p><h3>#4 - Idempotency done right</h3><p>Working with companies‚Äô revenue can be tough.</p><p>Billing mismatches sometimes happen. Charging a user twice for the same product is obviously bad for customer experience, but failing to charge when it‚Äôs needed hurts revenue. That‚Äôs partly why Finance and BI teams spend so much time on revenue recognition.¬† </p><p><strong>It‚Äôs a simple design principle, however, maintaining it at all times is hard. </strong></p><h3>#5 - The case for a CCC - Cash Collection Officer</h3><p>Cash collection is the process of collecting the money customers owe you. And the black beast of cash collection is &#39;dunnings&#39;: when payments fail to arrive, the merchant needs to persist and make repeated payment requests to their customers without damaging the relationship. These reminders are called &#39;dunnings&#39;.¬†</p><p>At <a href="http://www.qonto.co">Qonto</a>, we called these &#39;waiting funds&#39;. A client‚Äôs status is &#39;waiting funds&#39; when they successfully went through the sign-up, the KYC and KYB process, yet their account balance is still 0.¬†</p><p>For a neobank, the impact is twofold: you can‚Äôt charge for your service fees (a monthly subscription), and your customer does not generate interchange revenues (A simplistic explanation of interchange revenues: when you make a ‚Ç¨100 payment with Qonto - or any card provider-, Qonto earns ‚Ç¨0.5-‚Ç¨1 of interchange revenue, through the merchant‚Äôs fees.)</p><p>Every company has &#39;dunning&#39; challenges. For engineers, on top of all the billing architecture, this means they need to design and build:</p><ul role="list"><li>A <em>&#39;retry logic&#39;</em> to ask for a new payment intent</li><li>An invoice reconciliation (if several months of charges are being recovered)</li><li>An app logic to block the access in case of payment failure</li><li>An emailing workflow to urge a user to proceed to the payment</li></ul><p>Some SaaS are even on a mission to fight dunnings and have built full-fledge companies around cash collection features, such as <a href="https://hubs.ly/Q01bsNtZ0">Upflow</a> for instance, that is used by successful B2B scale-ups, including <a href="https://front.com/">Front</a> and <a href="https://lattice.com/">Lattice</a>, the leading HRtech.</p><blockquote>‚ÄòSending quality and personalized reminders took us a lot of time and, as Lattice was growing fast, it was essential for us to scale our cash collection processes. We use Upflow to personalize how we ask our customers for money, repeatedly, while keeping a good relationship. We now collect 99% of our invoices, effortlessly‚Äô,¬†</blockquote><p>says <a href="https://www.linkedin.com/in/jason-lopez-26422b24/">Jason Lopez</a>, controller at Lattice.¬†</p><h3>#6 - The labyrinth of taxes and VAT</h3><p>Taxes are challenging and depend on multiple dimensions.</p><p><strong>What are the dimensions?</strong></p><p>Applying tax to your customers depends on what you are selling, your home country and your customers‚Äô home country. In the simplest cases, your tax decision tree should look like this:</p><figure><p><img src="https://uploads-ssl.webflow.com/6244531a40ad7ef5475ad9b3/626ab0262943e6674ba69f98_taxes.png" loading="lazy" alt=""/></p></figure><p>Now, imagine that you sell different types of goods/services to different taxonomies of clients in +100 countries. If you think the logic on paper looks complex, the engineering needs to automate this at least tenfold.</p><p><strong>What do engineers need to do?</strong></p><p>Engineers will need to think of an entire tax logic within the application. This logic is pyramidal based both on customers and products sold by your company.</p><ol role="list"><li><strong>Taxes on the general settings level.</strong> Somehow, your company will have a general tax rate that is applied by default in the app.</li><li><strong>Taxes per customer.</strong> This general setting tax rate can be overridden by a specific tax applied for a customer. This per-customer tax rate depends on all the dimensions explained in the image above.</li><li><strong>Taxes per feature.</strong> In some cases, tax rates can also be applied by feature. This is mostly the case for the banking industry. For instance, at Qonto, banking fees are not subject to taxes and non-banking fees have a 20% VAT rate for all customers. Engineers created a whole tax logic based on the feature being used by a customer.</li></ol><p>With billing, the devil is in the details. That‚Äôs why I always cringe when I see engineering teams build a home-made system, because they think it‚Äôs not &#39;that complex&#39;.¬†</p><p>If you‚Äôve already tackled the topics listed above and think it‚Äôs a good investment of your engineering time, go ahead and build it in-house. Make sure to budget for the maintenance work that is always needed.¬†</p><p>Another option is to rely on existing billing platforms, built by specialized teams. If you‚Äôre considering choosing one or switching, and you think I can help, please reach out!¬†</p><p>To solve this problem at scale, we adopted a radical sharing approach. We‚Äôve started building an Open-Source Alternative to Stripe Billing (and Chargebee, and all the equivalents).¬†</p><p>Our API and architecture are open, so that you can embed, fork, customize them as much as your pricing and internal process need. As you‚Äôve read, we experienced these painpoints first hand.¬†</p><p><a href="https://www.getlago.com/">Request access or sign up for a live demo here</a>, if you‚Äôre interested!</p></div></div></div>
  </body>
</html>
