<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.zombiezen.com/blog/2024/09/zb-early-stage-build-system/">Original</a>
    <h1>Zb: An Early-Stage Build System</h1>
    
    <div id="readability-page-1" class="page"><div>
      
      
  <article>
      
    <p>
      By
      Roxy Light
    </p>
    <div><p>I have decided to develop <a href="https://github.com/256lights/zb">zb</a>,
my experiment in user-friendly reproducible builds,
into a full-fledged build tool.
Although <a href="https://www.zombiezen.com/blog/2024/06/zb-build-system-prototype/">my previous blog post</a>
stated that I would not be developing this tool to production-readiness,
a few things changed my mind:</p>
<ul>
<li>My personal projects need a dependency management solution,
and I am loath to continue investing in Nix.</li>
<li>I believe that many projects can benefit from a better dependency management/build tool,
especially with the increasing industry-wide focus on supply chain security.
I believe zb could serve that need.</li>
<li>zb is fun to work on!
It’s an interesting challenge to provide a simple interface to a sophisticated build model.</li>
</ul>
<p>As a build system, zb provides:</p>
<ul>
<li><strong>A familiar language for configuration.</strong>
zb uses <a href="https://lua.org/">Lua</a> to avoid introducing a significant programming language barrier.
Lua has been <a href="https://en.wikipedia.org/wiki/Lua_(programming_language)#Applications">used in a variety of applications</a>
to provide scripting facilities.
Lua’s small codebase made it straightforward to extend for zb
to include dependency information in every string.</li>
<li><strong>Powerful build features.</strong>
In the language of <a href="https://doi.org/10.1145/3236774">Build systems à la carte</a>,
zb is a suspending scheduler with constructive traces.
This puts zb in the category of the hypothetical “Cloud Shake” detailed in that paper.
As such, zb supports the early cutoff optimization (to speed up builds)
and dynamic dependencies (i.e. Lua configurations can read files from build targets).</li>
<li><strong>Support for non-determinism.</strong>
zb is built to handle non-determinism in builds by rerunning nondeterministic build steps
and then reusing work if possible.
A build will not become incorrect if a build step is not perfectly deterministic,
even when sharing build cache among peers.
This reduces friction in migrating a codebase to use zb from other build systems.</li>
<li><strong>File formats compatible with Nix.</strong>
Internally, zb uses the same <a href="https://nix.dev/manual/nix/2.24/protocols/derivation-aterm"><code>.drv</code> file format</a> and <a href="https://nix.dev/manual/nix/2.24/protocols/nix-archive">archive format</a> as Nix,
enabling tools built for the Nix store to be reused.
(At the moment, there’s not a clear way to <a href="https://github.com/256lights/zb/issues/2">interoperate with Nix derivations</a>,
but this is hypothetically possible.)</li>
<li><strong>Windows support.</strong>
I want a build system that works on Windows
in addition to Linux and macOS
so that tooling need not be split across platforms.</li>
</ul>
<p>Although zb is not ready for production use yet,
I’ve reached a major milestone: zb no longer depends on Nix!
I have written a build backend from the ground up that supports content-addressed derivations
(a long-standing <a href="https://nix.dev/manual/nix/2.24/development/experimental-features.html#xp-feature-ca-derivations">experimental feature in Nix</a>),
and more broadly, uses the “Intensional Model” described in <a href="https://edolstra.github.io/pubs/phd-thesis.pdf">The Purely Functional Software Deployment Model</a>.
This gives zb a strong foundation to leverage going forward.</p>
<p>If you’re interested in trying out zb for yourself,
follow the instructions in <a href="https://github.com/256lights/zb/blob/main/README.md">the project README</a>.
Try writing your own builds (although keep in mind the <a href="https://github.com/256lights/zb/issues">known issues</a>)
and discuss any feedback <a href="https://github.com/256lights/zb/discussions">over on GitHub</a>.
My next development target is to <a href="https://github.com/256lights/zb/issues/30">finish the Linux userspace</a>, which will make bootstrapping other development tools much easier.
Stay tuned!</p>
<p>
  (If your business would benefit from a build expert or some extra backend
  engineering bandwidth, I&#39;m available for consulting and contract work! See my
  freelance website —
  <a href="https://www.256lights.llc/" target="_blank" rel="noopener">256 Lights</a>
  — for details.)
</p>

<p><em>(Discussion on <a href="https://news.ycombinator.com/item?id=41595310">Hacker News</a>
and <a href="https://inuh.net/@light/113165827922004245">Mastodon</a>.)</em></p></div>
    

  </article>

      
    </div><div>
      <div>
        <div data-controller="quote">
            <template data-quote-target="quote">
              <p>Liked Zack Snyder before 300.</p>
            </template>
            <template data-quote-target="quote">
              <p>Vampires are so 2009.</p>
            </template>
            <template data-quote-target="quote">
              <p>Because maintaining a motorcycle was too hard.</p>
            </template>
            <template data-quote-target="quote">
              <p>Secure your doors and windows; you&#39;re about to read a blog.</p>
            </template>
            <template data-quote-target="quote">
              <p>Shopped too smart.</p>
            </template>
            <template data-quote-target="quote">
              <p>A Farewell to Arms.</p>
            </template>
            <template data-quote-target="quote">
              <p>Gave Bruce Campbell his hand back.</p>
            </template>
            <template data-quote-target="quote">
              <p>Hello?</p>
            </template>
            <template data-quote-target="quote">
              <p>They&#39;re coming to get you, Barbara.</p>
            </template>
            <template data-quote-target="quote">
              <p>Don&#39;t get bitten.</p>
            </template>
            <template data-quote-target="quote">
              <p>I hate headcrabs.</p>
            </template>
            <template data-quote-target="quote">
              <p>Listen up! This … is my website!</p>
            </template>
            <template data-quote-target="quote">
              <p>Stoppin&#39; zombies since 2009!</p>
            </template>
            <template data-quote-target="quote">
              <p>What is the sound of one zombie limping?</p>
            </template>
            <template data-quote-target="quote">
              <p>Groovy.</p>
            </template>
        </div>
        <p>
          I&#39;m available for
          <a href="https://www.256lights.llc/" target="_blank" rel="noopener">contract work</a>.
        </p>
        <p>
          Zombie Zen is Copyright © 2009-2024 Roxy Light</p>
      </div>
      <p><img alt="" src="https://www.zombiezen.com/static/img/stain.png" width="146" height="146"/>
      </p>
    </div></div>
  </body>
</html>
