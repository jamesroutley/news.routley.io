<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://pnpm.io/blog/releases/10.16">Original</a>
    <h1>Pnpm has a new setting to stave off supply chain attacks</h1>
    
    <div id="readability-page-1" class="page"><div id="__blog-post-container"><h2 id="minor-changes">Minor Changes<a href="#minor-changes" aria-label="Direct link to Minor Changes" title="Direct link to Minor Changes">​</a></h2>
<h3 id="new-setting-for-delayed-dependency-updates">New setting for delayed dependency updates<a href="#new-setting-for-delayed-dependency-updates" aria-label="Direct link to New setting for delayed dependency updates" title="Direct link to New setting for delayed dependency updates">​</a></h3>
<p>There have been several incidents recently where popular packages were successfully attacked. To reduce the risk of installing a compromised version, we are introducing a new setting that delays the installation of newly released dependencies. In most cases, such attacks are discovered quickly and the malicious versions are removed from the registry within an hour.</p>
<p>The new setting is called <a href="https://pnpm.io/settings#minimumreleaseage"><code>minimumReleaseAge</code></a>. It specifies the number of minutes that must pass after a version is published before pnpm will install it. For example, setting <code>minimumReleaseAge: 1440</code> ensures that only packages released at least one day ago can be installed.</p>
<p>If you set <code>minimumReleaseAge</code> but need to disable this restriction for certain dependencies, you can list them under the <a href="https://pnpm.io/settings#minimumreleaseageexclude"><code>minimumReleaseAgeExclude</code></a> setting. For instance, with the following configuration pnpm will always install the latest version of webpack, regardless of its release time:</p>
<div><div><pre tabindex="0"><code><span><span>minimumReleaseAgeExclude</span><span>:</span><span></span><br/></span><span><span></span><span>-</span><span> webpack</span><br/></span></code></pre></div></div>
<p>Related issue: <a href="https://github.com/pnpm/pnpm/issues/9921" target="_blank" rel="noopener noreferrer">#9921</a>.</p>
<h3 id="advanced-dependency-filtering-with-finder-functions">Advanced dependency filtering with finder functions<a href="#advanced-dependency-filtering-with-finder-functions" aria-label="Direct link to Advanced dependency filtering with finder functions" title="Direct link to Advanced dependency filtering with finder functions">​</a></h3>
<p>Added support for <a href="https://pnpm.io/finders"><code>finders</code></a>.</p>
<p>In the past, <code>pnpm list</code> and <code>pnpm why</code> could only search for dependencies by <strong>name</strong> (and optionally version). For example:</p>

<p>prints the chain of dependencies to any installed instance of <code>minimist</code>:</p>
<div><div><pre tabindex="0"><code><span><span>verdaccio 5.20.1</span><br/></span><span><span>├─┬ handlebars 4.7.7</span><br/></span><span><span>│ └── minimist 1.2.8</span><br/></span><span><span>└─┬ mv 2.1.1</span><br/></span><span><span>└─┬ mkdirp 0.5.6</span><br/></span><span><span>  └── minimist 1.2.8</span><br/></span></code></pre></div></div>
<p>What if we want to search by <strong>other properties</strong> of a dependency, not just its name? For instance, find all packages that have <code>react@17</code> in their peer dependencies?</p>
<p>This is now possible with &#34;finder functions&#34;. Finder functions can be declared in <code>.pnpmfile.cjs</code> and invoked with the <code>--find-by=&lt;function name&gt;</code> flag when running <code>pnpm list</code> or <code>pnpm why</code>.</p>
<p>Let&#39;s say we want to find any dependencies that have React 17 in peer dependencies. We can add this finder to our <code>.pnpmfile.cjs</code>:</p>
<div><div><pre tabindex="0"><code><span><span>module</span><span>.</span><span>exports</span><span> </span><span>=</span><span> </span><span>{</span><span></span><br/></span><span><span></span><span>finders</span><span>:</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>react17</span><span>:</span><span> </span><span>(</span><span>ctx</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>    </span><span>return</span><span> ctx</span><span>.</span><span>readManifest</span><span>(</span><span>)</span><span>.</span><span>peerDependencies</span><span>?.</span><span>react </span><span>===</span><span> </span><span>&#34;^17.0.0&#34;</span><span>;</span><span></span><br/></span><span><span>  </span><span>}</span><span>,</span><span></span><br/></span><span><span></span><span>}</span><span>,</span><span></span><br/></span><span><span></span><span>}</span><span>;</span><br/></span></code></pre></div></div>
<p>Now we can use this finder function by running:</p>
<div><div><pre tabindex="0"><code><span><span>pnpm why --find-by=react17</span><br/></span></code></pre></div></div>
<p>pnpm will find all dependencies that have this React in peer dependencies and print their exact locations in the dependency graph.</p>
<div><div><pre tabindex="0"><code><span><span>@apollo/client 4.0.4</span><br/></span><span><span>├── @graphql-typed-document-node/core 3.2.0</span><br/></span><span><span>└── graphql-tag 2.12.6</span><br/></span></code></pre></div></div>
<p>It is also possible to print out some additional information in the output by returning a string from the finder. For example, with the following finder:</p>
<div><div><pre tabindex="0"><code><span><span>module</span><span>.</span><span>exports</span><span> </span><span>=</span><span> </span><span>{</span><span></span><br/></span><span><span></span><span>finders</span><span>:</span><span> </span><span>{</span><span></span><br/></span><span><span>  </span><span>react17</span><span>:</span><span> </span><span>(</span><span>ctx</span><span>)</span><span> </span><span>=&gt;</span><span> </span><span>{</span><span></span><br/></span><span><span>    </span><span>const</span><span> manifest </span><span>=</span><span> ctx</span><span>.</span><span>readManifest</span><span>(</span><span>)</span><span>;</span><span></span><br/></span><span><span>    </span><span>if</span><span> </span><span>(</span><span>manifest</span><span>.</span><span>peerDependencies</span><span>?.</span><span>react </span><span>===</span><span> </span><span>&#34;^17.0.0&#34;</span><span>)</span><span> </span><span>{</span><span></span><br/></span><span><span>      </span><span>return</span><span> </span><span>`</span><span>license: </span><span>${</span><span>manifest</span><span>.</span><span>license</span><span>}</span><span>`</span><span>;</span><span></span><br/></span><span><span>    </span><span>}</span><span></span><br/></span><span><span>    </span><span>return</span><span> </span><span>false</span><span>;</span><span></span><br/></span><span><span>  </span><span>}</span><span>,</span><span></span><br/></span><span><span></span><span>}</span><span>,</span><span></span><br/></span><span><span></span><span>}</span><span>;</span><br/></span></code></pre></div></div>
<p>Every matched package will also print out the license from its <code>package.json</code>:</p>
<div><div><pre tabindex="0"><code><span><span>@apollo/client 4.0.4</span><br/></span><span><span>├── @graphql-typed-document-node/core 3.2.0</span><br/></span><span><span>│   license: MIT</span><br/></span><span><span>└── graphql-tag 2.12.6</span><br/></span><span><span>  license: MIT</span><br/></span></code></pre></div></div>
<p>Related PR: <a href="https://github.com/pnpm/pnpm/pull/9946" target="_blank" rel="noopener noreferrer">#9946</a>.</p>
<h2 id="patch-changes">Patch Changes<a href="#patch-changes" aria-label="Direct link to Patch Changes" title="Direct link to Patch Changes">​</a></h2>
<ul>
<li>Fix deprecation warning printed when executing pnpm with Node.js 24 <a href="https://github.com/pnpm/pnpm/issues/9529" target="_blank" rel="noopener noreferrer">#9529</a>.</li>
<li>Throw an error if <code>nodeVersion</code> is not set to an exact semver version <a href="https://github.com/pnpm/pnpm/issues/9934" target="_blank" rel="noopener noreferrer">#9934</a>.</li>
<li><code>pnpm publish</code> should be able to publish a <code>.tar.gz</code> file <a href="https://github.com/pnpm/pnpm/pull/9927" target="_blank" rel="noopener noreferrer">#9927</a>.</li>
<li>Canceling a running process with Ctrl-C should make <code>pnpm run</code> return a non-zero exit code <a href="https://github.com/pnpm/pnpm/issues/9626" target="_blank" rel="noopener noreferrer">#9626</a>.</li>
</ul></div></div>
  </body>
</html>
