<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/fsmunoz/datastar-cl">Original</a>
    <h1>Common Lisp SDK for the Datastar Hypermedia Framework</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://github.com/fsmunoz/datastar-cl/actions/workflows/sdk-test.yml"><img src="https://github.com/fsmunoz/datastar-cl/actions/workflows/sdk-test.yml/badge.svg" alt="https://github.com/fsmunoz/datastar-cl/actions/workflows/sdk-test.yml/badge.svg"/></a></p>
<pre lang="text">================================================================

       |             
      / \            DATASTAR HYPERMEDIA FRAMEWORK
     /___\          
    |  D  |          
    | C*L |                &#39;(DATASTAR-CL)    
    |     |                 
   /|  |  |\
  | |_ |__| |              COMMON LISP SDK
  |/  /.\  \|            

================================================================
</pre>

<p dir="auto">This is a Common Lisp implementation of the Datastar SDK, following the Datastar Architecture
  Decision Record (ADR) as closely as possible, making the necessary adjustments for Common Lisp.</p>
<p dir="auto">Focus has been on implementing the core SDK functionality, with additional utilities planned.</p>

<p dir="auto">Clone the repository somewhere ASDF2 can find it (~~/src/lisp~ is commonly already configured), and
  use Quicklisp to load it:</p>
<pre lang="text">(ql:quickload &#34;datastar-cl&#34;)
</pre>

<p dir="auto">The SDK uses CLOS and is based on a <code>sse-generator</code> class, that currently has two subclasses:</p>
<ol dir="auto">
  <li><code>hunchentoot-sse-generator</code>: used with the Hunchentoot web server.</li>
  <li><code>clack-sse-generator</code>: used with the Clack web application environment.</li>
</ol>
<p dir="auto">Both approaches use a stream, although in different ways and initialized differently. For Clack, the
  work done is at the Lack level, and has been tested with both Hunchentoot and Woo.</p>
<p dir="auto">We are currently using JZON as the JSON parser in two places: <code>read-signals</code> and <code>patch-signals</code>.
  This is not a hard requirement to remove, but for now it allows immediate use and testing of the
  library.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">SSE and Common Lisp webservers</h2><a id="user-content-sse-and-common-lisp-webservers" aria-label="Permalink: SSE and Common Lisp webservers" href="#sse-and-common-lisp-webservers"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">When using Clack with Woo, SSE connections are limited by Woo’s worker thread count. Each SSE
  connection blocks one worker for its entire duration. This is a fundamental architectural
  constraint - see <code>SSE-WOO-LIMITATIONS.org</code> for details and practical solutions.</p>
<p dir="auto">For applications with many SSE connections, Hunchentoot is recommended (no connection limit), or
  using a polling approach. By default, Hunchentoot (and Clack+Hunchentoot) uses a push approach,
  while Clack+Woo defaults to poll.</p>

<p dir="auto">The <code>test/</code> directory has some basic examples. Additionally, the following projects use it</p>
<ul dir="auto">
  <li><b><a href="https://codeberg.org/fsm/data-spice" rel="nofollow">Data SPICE</a></b>: uses Datastar-CL for a 2D simulation of the solar system and Cassini-Huygens probe; written in parallel with the SDK to showcase it and also make sure it worked.</li>
  <li><b><a href="https://codeberg.org/fsm/horizons" rel="nofollow">Horizons JPL API explorer</a></b>: in the same theme, but a vastly simplified app that queries the Horizons API for solar system data.</li>
</ul>
<p dir="auto">The Horizons JPL app is very simple – one single file – and should show the essentials. The Data SPICE application shows SSE streaming.</p>

<p dir="auto">Support for compression was recently added, currently covering all backends but limited to <code>zstd</code>:
  read <code>COMPRESSION.org</code> for details.</p>

<p dir="auto">The <code>test/</code> directory contains the code to setup and start the supported servers, Hunchentoot and
  Clack (with Woo and Hunchentoot backends, others can be added). It’s also a good place to use as an
  example of how the SDK can be used, especially since there are some differences depending on the
  backend (Hunchentoot or Clack). SSE has a specific test file that can also serve as an example, and
  some important edge cases (like what happens when connections are interrupted) are tested as well.</p>

<p dir="auto">The code follows Datastar’s licence choice, the MIT license.</p>
</article></div></div>
  </body>
</html>
