<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://diziet.dreamwidth.org/20436.html">Original</a>
    <h1>Debian&#39;s Git Transition</h1>
    
    <div id="readability-page-1" class="page"><div><p>tl;dr:
</p><p>There is a Debian git transition plan. It’s going OK so far but we need help, especially with outreach and updating Debian’s documentation.
</p><ul><li><a href="#goals-of-the-debian-git-transition-project">Goals of the Debian git transition project</a><ul><li><a href="#achievements-so-far-and-current-status">Achievements so far, and current status</a>
</li></ul>

</li><li><a href="#core-engineering-principle">Core engineering principle</a><ul><li><a href="#correspondence-between-dsc-and-git">Correspondence between dsc and git</a>
</li><li><a href="#patches-applied-vs-patches-unapplied">Patches-applied vs patches-unapplied</a>
</li><li><a href="#consequences-some-of-which-are-annoying">Consequences, some of which are annoying</a>
</li></ul>

</li><li><a href="#distributing-the-source-code-as-git">Distributing the source code as git</a><ul><li><a href="#tracking-the-relevant-git-data-when-changes-are-made-in-the-legacy-archive">Tracking the relevant git data, when changes are made in the legacy Archive</a>
</li><li><a href="#why-.dgit.debian.org-is-not-salsa">Why *.dgit.debian.org is not Salsa</a>
</li></ul>

</li><li><a href="#roadmap">Roadmap</a><ul><li><a href="#in-progress">In progress</a>
</li><li><a href="#future-technology">Future Technology</a>
</li></ul>

</li><li><a href="#mindshare-and-adoption---please-help">Mindshare and adoption - please help!</a><ul><li><a href="#a-rant-about-publishing-the-source-code">A rant about publishing the source code</a>
</li><li><a href="#documentation">Documentation</a>
</li></ul>

</li><li><a href="#personnel">Personnel</a><ul><li><a href="#thanks">Thanks</a>
</li></ul>

</li></ul>

<ol start="0" type="1"><li><strong>Everyone who interacts with Debian source code should be able to do so entirely in git.</strong>
</li></ol>
<p>That means, more specifically:
</p><ol type="1"><li><p>All examination and edits to the source should be performed via normal git operations.

</p></li><li><p>Source code should be transferred and exchanged as git data, not tarballs. git should be the canonical form everywhere.

</p></li><li><p>Upstream git histories should be re-published, traceably, as part of formal git releases published by Debian.

</p></li><li><p>No-one should have to learn about Debian Source Packages, which are bizarre, and have been obsoleted by modern version control.

</p></li></ol>
<p>This is very ambitious, but we have come a long way!
</p><h2><a name="achievements-so-far-and-current-status">Achievements so far, and current status</a></h2>
<p>We have come a very long way. But, there is still much to do - especially, the git transition team <strong>needs your help with adoption, developer outreach, and developer documentation overhaul.</strong>
</p><p>We’ve made big strides towards goals 1 and 4. Goal 2 is partially achieved: we currently have dual running. Goal 3 is within our reach but depends on widespread adoption of tag2upload (and/or dgit push).
</p><p>Downstreams and users can <a href="https://diziet.dreamwidth.org/17579.html">obtain the source code of any Debian package</a> in git form. (<a href="https://manpages.debian.org/trixie/dgit/dgit.1.en.html#dgit">dgit clone</a>, 2013). They can then work with this source code completely in git, including building binaries, merging new versions, even automatically (eg <a href="https://github.com/plugwash/autoforwardportergit?tab=readme-ov-file#pooltogit">Raspbian</a>, 2016), and all without having to deal with source packages at all (eg <a href="https://debconf25.debconf.org/talks/119-automating-downstream-debian-package-builds-and-updates-in-ci/">Wikimedia</a> 2025).
</p><p>A Debian maintainer can maintain their own package entirely in git. They can obtain upstream source code from git, and do their packaging work in git (<code>git-buildpackage</code>, 2006).
</p><p>Every Debian maintainer can (and should!) release their package <em>from git</em> reliably and in a standard form (<a href="https://manpages.debian.org/trixie/dgit/dgit.1.en.html#dgit~15">dgit push</a>, 2013; <a href="https://wiki.debian.org/tag2upload">tag2upload</a>, 2025). This is not only more principled, but also more convenient, and with better UX, than pre-dgit tooling like <code>dput</code>.
</p><p>Indeed a Debian maintainer can now often release their changes to Debian, from git, using <em>only</em> git branches (so no tarballs). Releasing to Debian can be simply pushing a signed tag (<a href="https://wiki.debian.org/tag2upload">tag2upload</a>, 2025).
</p><p>A Debian maintainer can maintain a stack of changes to upstream source code in git (<a href="https://manpages.debian.org/trixie/git-buildpackage/gbp-pq.1.en.html">gbp pq</a> 2009). They can even maintain such a delta series as a rebasing git branch, directly buildable, and use normal <code>git rebase</code> style operations to edit their changes, (<a href="https://manpages.debian.org/trixie/git-dpm/git-dpm.1.en.html">git-dpm</a>, 2010; <a href="https://manpages.debian.org/trixie/git-debrebase/git-debrebase.1.en.html">git-debrebase</a>, 2018)
</p><p>An authorised Debian developer can do a modest update to <em>any</em> package in Debian, even one maintained by someone else, working entirely in git in a <a href="https://manpages.debian.org/testing/dgit/dgit-nmu-simple.7.en.html">standard and convenient way</a> (dgit, 2013).
</p><p>Debian contributors can share their work-in-progress on git forges and collaborate using merge requests, git based code review, and so on. (Alioth, 2003; Salsa, 2018.)
</p>
<p>The Debian git transition project is based on one core engineering principle:
</p><p><strong>Every Debian Source Package can be losslessly converted to and from git.</strong>
</p><p>In order to <em>transition</em> away from Debian Source Packages, we need to <em>gateway</em> between the old <code>dsc</code> approach, and the new git approach.
</p><p>This gateway obviously needs to be bidirectional: source packages uploaded with legacy tooling like <code>dput</code> need to be imported into a canonical git representation; and of course git branches prepared by developers need to be converted to source packages for the benefit of legacy downstream systems (such as the Debian Archive and <code>apt source</code>).
</p><p>This bidirectional gateway is implemented in <a href="https://salsa.debian.org/dgit-team/dgit"><code>src:dgit</code></a>, and is allowing us to gradually replace dsc-based parts of the Debian system with git-based ones.
</p><h2><a name="correspondence-between-dsc-and-git">Correspondence between dsc and git</a></h2>
<p>A faithful bidirectional gateway must define an invariant:
</p><p><strong>The canonical git tree, corresponding to a .dsc, is the tree resulting from <code>dpkg-source -x</code></strong>.
</p><p>This canonical form is sometimes called the “dgit view”. It’s sometimes not the same as the maintainer’s git branch, because many maintainers are still working with “patches-unapplied” git branches. More on this below.
</p><p>(For <code>3.0 (quilt)</code> .dscs, the canonical git tree doesn’t include the quilt <code>.pc</code> directory.)
</p><h2><a name="patches-applied-vs-patches-unapplied">Patches-applied vs patches-unapplied</a></h2>
<p>The canonical git format is “patches applied”. That is:
</p><p><strong>If Debian has modified the upstream source code, a normal git clone of the canonical branch gives the modified source tree, ready for reading and building.</strong>
</p><p>Many Debian maintainers keep their packages in a different git branch format, where the changes made by Debian, to the upstream source code, are in actual <code>patch</code> files in a <code>debian/patches/</code> subdirectory.
</p><p>Patches-applied has a number of important advantages over patches-unapplied:
</p><ul><li><p><strong>It is familiar to, and doesn’t trick, outsiders to Debian</strong>. Debian insiders radically underestimate how weird “patches-unapplied” is. Even expert software developers can get very confused or even <a href="https://diziet.dreamwidth.org/9556.html">accidentally build binaries without security patches</a>!

</p></li><li><p>Making changes can be done with just normal git commands, eg <code>git commit</code>. Many Debian insiders working with patches-unapplied are still using <a href="https://manpages.debian.org/trixie/quilt/quilt.1.en.html"><code>quilt(1)</code></a>, a footgun-rich contraption for working with patch files!

</p></li><li><p>When developing, one can make changes to upstream code, and to Debian packaging, together, without ceremony. There is no need to switch back and forth between patch queue and packaging branches (as with <code>gbp pq</code>), no need to “commit” patch files, etc. One can always edit every file and commit it with <code>git commit</code>.

</p></li></ul>
<p>The downside is that, with the (bizarre) <code>3.0 (quilt)</code> source format, the patch files files in <code>debian/patches/</code> must somehow be kept up to date. Nowadays though, tools like <code>git-debrebase</code> and <code>git-dpm</code> (and dgit for NMUs) make it very easy to work with patches-applied git branches. <code>git-debrebase</code> can deal very ergonomically even with <a href="https://salsa.debian.org/xen-team/debian-xen">big patch stacks</a>.
</p><p>(For smaller packages which usually have no patches, <a href="https://manpages.debian.org/trixie/dgit/dgit-maint-merge.7.en.html">plain <code>git merge</code> with an upstream git branch</a>, and a <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1007717#384">much simpler dsc format</a>, sidesteps the problem entirely.)
</p><h3><a name="prioritising-debians-users-and-other-outsiders">Prioritising Debian’s users (and other outsiders)</a></h3>
<p>We want everyone to be able to share and modify the software that they interact with. That means we should make source code truly accessible, on the user’s terms.
</p><p>Many of Debian’s processes assume everyone is an insider. It’s okay that there are Debian insiders and that people feel part of something that they worked hard to become involved with. But lack of perspective can lead to software which fails to uphold our values.
</p><p>Our source code practices — in particular, our determination to share properly (and systematically) — are a key part of what makes Debian worthwhile at all. Like Debian’s installer, we want our source code to be useable by Debian outsiders.
</p><p>This is why we have chosen to privilege a git branch format which is more familiar to the world at large, even if it’s less popular in Debian.
</p><h2><a name="consequences-some-of-which-are-annoying">Consequences, some of which are annoying</a></h2>
<p>The requirement that the conversion be <em>bidirectional</em>, <em>lossless</em>, and <em>context-free</em> can be inconvenient.
</p><p>For example, <a href="https://manpages.debian.org/trixie/dgit/dgit.7.en.html#GITATTRIBUTES">we cannot support <code>.gitattributes</code></a> which modify files during git checkin and checkout. <code>.gitattributes</code> cause the meaning of a git tree to depend on the context, in possibly arbitrary ways, so the conversion from git to source package wouldn’t be stable. And, worse, some source packages might not to be representable in git at all.
</p><p>Another example: Maintainers often have existing git branches for their packages, generated with pre-dgit tooling which is less careful and less principled than ours. That can result in discrepancies between git and dsc, which need to be resolved before a proper git-based upload can succeed.
</p><p>That some maintainers use patches-unapplied, and some patches-unapplied, means that there <em>has</em> to be some kind of conversion to a standard git representation. Choosing the less-popular patches-applied format as the canonical form, means that <em>many</em> packages need their git representation converted. It also means that user- and outsider-facing branches from <code>{browse,git}.dgit.d.o</code> and <code>dgit clone</code> are not always compatible with maintainer branches on Salsa. User-contributed changes need cherry-picking rather than merging, or conversion back to the maintainer format. The good news is that dgit can automate much of this, and the manual parts are usually easy git operations.
</p>
<p>Our source code management should be normal, modern, and based on git. That means the Debian Archive is obsolete and needs to be replaced with a set of git repositories.
</p><p>The replacement repository for source code formally released to Debian is <a href="https://browse.dgit.debian.org/"><code>*.dgit.debian.org</code></a>. This contains all the git objects for every git-based upload since 2013, including the signed tag for each released package version.
</p><p>The plan is that it will contain a git view of <em>every</em> uploaded Debian package, by centrally importing all legacy uploads into git.
</p><h2><a name="tracking-the-relevant-git-data-when-changes-are-made-in-the-legacy-archive">Tracking the relevant git data, when changes are made in the legacy Archive</a></h2>
<p>Currently, many critical source code management tasks are done by changes to the legacy Debian Archive, which works entirely with dsc files (and the associated tarballs etc). The contents of the Archive are therefore still an important source of truth. But, the Archive’s architecture means it cannot sensibly directly contain git data.
</p><p>To track changes made in the Archive, we added the <a href="https://www.debian.org/doc/debian-policy/ch-controlfields.html#s-f-dgit"><code>Dgit:</code></a> field to the <code>.dsc</code> of a git-based upload (2013). This declares which git commit this package was converted from. and where those git objects can be obtained.
</p><p>Thus, given a Debian Source Package from a git-based upload, it is possible for the new git tooling to obtain the equivalent git objects. If the user is going to work in git, there is no need for any tarballs to be downloaded: the git data could be obtained from the depository using the git protocol.
</p><p>The <a href="https://browse.dgit.debian.org/libsdl2-ttf.git/tag/?h=archive/debian/2.24.0%2bdfsg-3">signed</a> <a href="https://browse.dgit.debian.org/libsdl2-ttf.git/tag/?h=debian/2.24.0%2bdfsg-3">tags</a>, available from the git depository, have <a href="https://manpages.debian.org/trixie/git-debpush/tag2upload.5.en.html">standardised metdata</a> which gives traceability back to the uploading Debian contributor.
</p><h2><a name="why-.dgit.debian.org-is-not-salsa">Why *.dgit.debian.org is not Salsa</a></h2>
<p>We need a git <em>depository</em> - a formal, reliable and permanent git repository of source code actually released to Debian.
</p><p>Git forges like Gitlab can be very convenient. But Gitlab is not sufficiently secure, <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/429516">and</a> <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/472646">too</a> <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/581752">full</a> <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/581897">of</a> <a href="https://gitlab.com/gitlab-org/gitlab/-/issues/217231">bugs</a>, to be the principal and only archive of all our source code. (The “open core” business model of the Gitlab corporation, and the constant-churn development approach, are <a href="https://mako.cc/writing/hill-free_tools.html">critical</a> underlying problems.)
</p><p>Our git depository lacks forge features like Merge Requests. But:
</p><ul><li>It is dependable, both in terms of reliability and security.
</li><li>It is append-only: once something is pushed, it is permanently recorded.
</li><li>Its access control is precisely that of the Debian Archive.
</li><li>Its ref namespace is standardised and corresponds to Debian releases.
</li><li>Pushes are authorised by PGP signatures, not ssh keys, so traceable.
</li></ul>
<p>The dgit git depository outlasted Alioth and it may well outlast Salsa.
</p><p>We need <em>both</em> a good forge, and the <code>*.dgit.debian.org</code> formal git depository.
</p>
<h2><a name="in-progress">In progress</a></h2>
<p>Right now we are quite focused on <a href="https://wiki.debian.org/tag2upload"><strong>tag2upload</strong></a>.
</p><p>We are working hard on eliminating the remaining issues that we feel need to be addressed before declaring the service out of beta.
</p><h2><a name="future-technology">Future Technology</a></h2>
<h3><a name="whole-archive-dsc-importer">Whole-archive dsc importer</a></h3>
<p>Currently, the git depository only has git data for git-based package updates (tag2upload and dgit push). Legacy dput-based uploads are not currently present there. This means that the git-based and legacy uploads must be resolved client-side, by <code>dgit clone</code>.
</p><p>We will want to start importing legacy uploads to git.
</p><p>Then downstreams and users will be able to get the source code for any package simply with <code>git clone</code>, even if the maintainer is using legacy upload tools like dput.
</p><h3><a name="support-for-git-based-uploads-to-security.debian.org">Support for git-based uploads to security.debian.org</a></h3>
<p>Security patching is a task which would particularly benefit from better and more formal use of git. git-based approaches to applying and backporting security patches are much more convenient than messing about with actual patch files.
</p><p>Currently, one can use git to help prepare a security upload, but it often involves starting with a dsc import (which lacks the proper git history) or figuring out a package maintainer’s unstandardised git usage conventions on Salsa.
</p><p>And it is not possible to properly perform the security release <em>as git</em>.
</p><h3><a name="internal-debian-consumers-switch-to-getting-source-from-git">Internal Debian consumers switch to getting source from git</a></h3>
<p>Buildds, QA work such as lintian checks, and so on, could be simpler if they don’t need to deal with source packages.
</p><p>And since git is actually the canonical form, we want them to use it directly.
</p><h3><a name="problems-for-the-distant-future">Problems for the distant future</a></h3>
<p>For decades, Debian has been built around source packages. Replacing them is a long and complex process. Certainly source packages are going to continue to be supported for the foreseeable future.
</p><p>There are no doubt going to be unanticipated problems. There are also foreseeable issues: for example, perhaps there are packages that work very badly when represented in git. We think we can rise to these challenges as they come up.
</p>
<p>We and our users are very pleased with our technology. It is convenient and highly dependable.
</p><p><code>dgit</code> in particular is superb, even if we say so ourselves. As technologists, we have been very focused on building good software, but it seems we have fallen short in the marketing department.
</p><h2><a name="a-rant-about-publishing-the-source-code">A rant about publishing the source code</a></h2>
<p><strong>git is the preferred form for modification</strong>.
</p><p>Our upstreams are overwhelmingly using git. We are overwhelmingly using git. It is a scandal that for many packages, Debian does not properly, formally and officially publish the git history.
</p><p><em>Properly</em> publishing the source code as git means publishing it in a way that means that anyone can <em>automatically</em> and <em>reliably</em> obtain <em>and build</em> the <em>exact</em> source code corresponding to the binaries. The test is: could you use that to build a derivative?
</p><p>Putting a package <a href="https://dep-team.pages.debian.net/deps/dep18/">in git on Salsa</a> is often a good idea, but it is not sufficient. No standard branch structure git on Salsa is enforced, nor should it be (so it can’t be automatically and reliably obtained), the tree is not in a standard form (so it can’t be automatically built), and is not <em>necessarily identical</em> to the source package. So <code>Vcs-Git</code> fields, and git from Salsa, will never be sufficient to make a derivative.
</p><p><strong>Debian is not publishing the source code!</strong>
</p><p>The time has come for proper publication of source code by Debian to no longer be a minority sport. Every maintainer of a package whose upstream is using git (which is nearly all packages nowadays) should be basing their work on upstream git, and properly publishing that via tag2upload or dgit.
</p><p>And it’s not even difficult! The modern git-based tooling provides a far superior upload experience.
</p><h3><a name="a-common-misunderstanding">A common misunderstanding</a></h3>
<p><strong>dgit push is not an alternative to gbp pq or quilt. Nor is tag2upload.</strong> These upload tools <em>complement your existing git workflow</em>. They replace and improve source package building/signing and the subsequent dput. If you are using one of the usual git layouts on salsa, and your package is in good shape, you can adopt tag2upload and/or dgit push right away.
</p><p><code>git-debrebase</code> is distinct and <em>does</em> provides an alternative way to manage your git packaging, do your upstream rebases, etc.
</p><h2><a name="documentation">Documentation</a></h2>
<p>Debian’s documentation all needs to be updated, including particularly instructions for packaging, to recommend use of git-first workflows. Debian should not be importing git-using upstreams’ “release tarballs” into git. (Debian outsiders who discover this practice are typically horrified.) We should use <em>only</em> upstream git, work only in git, and properly release (and publish) in git form.
</p><p>We, the git transition team, are experts in the technology, and can provide good suggestions. But we do not have the bandwidth to also engage in the massive campaigns of education and documentation updates that are necessary — especially given that (as with any programme for change) many people will be sceptical or even hostile.
</p><p>So we would greatly appreciate help with writing and outreach.
</p>
<p>We consider ourselves the Debian git transition team.
</p><p>Currently we are:
</p><ul><li><p>Ian Jackson. Author and maintainer of dgit and git-debrebase. Co-creator of tag2upload. Original author of dpkg-source, and inventor in 1996 of Debian Source Packages. Alumnus of the Debian Technical Committee.

</p></li><li><p>Sean Whitton. Co-creator of the tag2upload system; author and maintainer of git-debpush. Co-maintainer of dgit. Debian Policy co-Editor. Former Chair of the Debian Technical Committee.

</p></li></ul>
<p>We wear the following hats related to the git transition:
</p><ul><li>Maintainers of src:dgit
</li><li><a href="https://lists.debian.org/debian-devel-announce/2025/01/msg00002.html">tag2upload Delegates</a>; operators of the <a href="https://tag2upload.debian.org/">tag2upload service</a>.
</li><li>service operators of the git depository <a href="https://browse.dgit.debian.org/">*.dgit.debian.org</a>.
</li></ul>
<p>You can contact us:
</p><ul><li><p>By email: Ian Jackson <a href="mailto:ijackson@chiark.greenend.org.uk">ijackson@chiark.greenend.org.uk</a>; Sean Whitton <a href="mailto:spwhitton@spwhitton.name">spwhitton@spwhitton.name</a>; git-debpush@packages.d.o.

</p></li><li><p>By filing bugs in the Debian Bug System against <a href="https://bugs.debian.org/src:dgit">src:dgit</a>.

</p></li><li><p>On OFTC IRC, as <code>Diziet</code> and <code>spwhitton</code>.

</p></li></ul>
<p>We do most of our heavy-duty development <a href="https://salsa.debian.org/dgit-team">on Salsa</a>.
</p><h2><a name="thanks">Thanks</a></h2>
<p>Particular thanks are due to Joey Hess, who, in the now-famous design session in Vaumarcus in 2013, helped invent dgit. Since then we have had a lot of support: most recently political support to help get tag2upload deployed, but also, over the years, helpful bug reports and kind words from our users, as well as translations and code contributions.
</p><p>Many other people have contributed more generally to support for working with Debian source code in git. We particularly want to mention Guido Günther (git-buildpackage); and of course Alexander Wirt, Joerg Jaspert, Thomas Goirand and Antonio Terceiro (Salsa administrators); and before them the Alioth administrators.</p></div></div>
  </body>
</html>
