<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ntietz.com/blog/bayes-theorem-medical-tests/?utm_source=atom&amp;utm_medium=feed">Original</a>
    <h1>Bayes theorem and how we talk about medical tests</h1>
    
    <div id="readability-page-1" class="page"><div><p>We want medical tests to give us a yes or no answer: you have the disease, you&#39;re cured.
We treat them this way, often.
My labs came back saying I&#39;m healthy.
I have immunity.
I&#39;m sick.
Absolutely concrete results.</p>
<p>The reality is more complicated, and tests do not give you a yes or no.
They give you a likelihood.
And most of the time, what the results mean for <em>me</em>, the test taker, is not immediately obvious or intuitive.
They can mean something quite the opposite of what they seem.</p>
<p>I ran into this recently on a page about celiac disease.</p>
<p>* * *</p>
<p>The Celiac Disease Foundation has a <a href="https://celiac.org/about-celiac-disease/screening-and-diagnosis/screening/">page about testing for celiac disease</a>.
On this page, they give a lot of useful information about what different tests are available, and they point to some other good resources as well.
In the section about one of the tests, it says (emphasis original):</p>
<blockquote>
<p>The tTG-IgA test will be positive in about 93% of patients with celiac disease who are on a gluten-containing diet. This refers to the test&#39;s <em>sensitivity</em>, which measures how correctly it identifies those <em>with</em> the disease. The same test will come back negative in about 96% of healthy people <em>without</em> celiac disease. This is the test&#39;s <em>specificity</em>.</p>
</blockquote>
<p>This is great information, and it tells you what you need to start figuring out what <em>your</em> chance of celiac disease is.
The next paragraph says this, however:</p>
<blockquote>
<p>There is also a slight risk of a false positive test result, especially for people with associated autoimmune disorders like type 1 diabetes, autoimmune liver disease, Hashimoto&#39;s thyroiditis, psoriatic or rheumatoid arthritis, and heart failure, who do not have celiac disease.</p>
</blockquote>
<p>And this is where things are a little misleading.
It says that there is a &#34;slight risk&#34; of a false positive test result.
What do you think of as a slight risk?
For me, it&#39;s maybe somewhere around 5%, maybe 10%.
The truth is, the risk of a false positive is much higher (under many circumstances).</p>
<p>* * *</p>
<p>When I take a test, I want to know a couple of things.
If I get a positive test result, how likely is it that I have the disease?
If I get a negative test result, how likely is it that I do <em>not</em> have the disease?
The rates of positive and negative results listed above, the sensitivity and specificity, do not tell us these directly.
However, they let us to calculate this with a little more information.</p>
<p>Bayes&#39; theorem says that <code>P(A|B) = P(B|A) * P(A) / P(B)</code>.
You can read <code>P(A|B)</code> as &#34;the probability of A <em>conditioned on</em> B&#34;, or the chance that A happens if we know that B happens.
What this formula lets us do is figure out one conditional probability we don&#39;t yet know in terms of other ones that we <em>do</em> know.</p>
<p>In our case, we would say that <code>A</code> is having celiac disease, and <code>B</code> is getting a positive test result.
This leaves <code>P(A|B)</code> as the chance that if you get a positive test result, that you do have celiac disease, which is exactly what we want to know.
To compute this, we need a few more pieces of information.</p>
<ul>
<li><code>P(A)</code>, the probability in general that the person taking the test has celiac disease. This is also called the <em>prior probability</em>, as it&#39;s what we would say the probability is if we did not know anything from this computation and test.</li>
<li><code>P(B)</code>, the probability that for any given test taken, it comes back positive.</li>
<li><code>P(B|A)</code>, the probability that if one has celiac disease, the test will come back positive.</li>
</ul>
<p>We already know that <code>P(B|A)</code> is 0.93, as we were told this above.
And we can find <code>P(A)</code> prety easily.
Let&#39;s say <code>P(A)</code> is 0.01, since about 1 in 100 people in the US have celiac disease.
Estimates vary from 1 in 200 to 1 in 50, but this will do fine.</p>
<p>That leaves us with <code>P(B)</code>.
We have to compute it from both possibilities.
If someone who has celiac disease takes the test, they have a 93% chance of it coming back positive, but they&#39;re only 1% of the population.
On the other hand, someone without celiac disease has a 4% chance of it coming back positive (96% of the time it gives a true negative), and they&#39;re 99% of the population.
We use these together to find that <code>P(B) = 0.93*0.01 + 0.04*0.99 = 0.0489</code>.</p>
<p>Now we plug it all in!
<code>P(A|B) = P(B|A) * P(A) / P(B) =  0.93 * 0.01 / 0.0489 = 0.19</code>.
Neat, 19%!</p>
<p>* * *</p>
<p>Wait.</p>
<p>So this says that, if you get a positive test result, you have a <em>19%</em> chance of having celiac disease?
Yes, exactly!
It&#39;s less than 1 in 5!</p>
<p>So if you get a positive test result, you have an 80% chance of it being a false positive.
This is quite a bit higher than the aforementioned &#34;slight risk.&#34;
In fact, it means that the test doesn&#39;t so much diagnose you with celiac disease as say &#34;huh, something&#39;s going on here&#34; and strongly suggest further testing.</p>
<p>Now let&#39;s look at the test the other way around, too.
How likely is it you <em>don&#39;t</em> have celiac disease if you get a negative test result?</p>
<p>Here we&#39;d say that A is &#34;we don&#39;t have it&#34; and B is &#34;we have a negative test&#34;.
Doing some other calculations, pulled out of the oven fully baked in cooking show style, we can see that <code>P(A | B) = 0.96 * 0.99 / 0.951 = 0.999</code>.
So if you get a negative test result, you have a 99.9% chance of <em>not</em> having the disease.
This can effectively rule it out!</p>
<p>* * *</p>
<p>But...
We know that 7% of people who take this test and <em>do</em> have celiac disease will get a negative result.
How does this makes sense?</p>
<p>The truth is, things are a little bit deeper.
People don&#39;t actually present with exactly a 1% chance of having celiac&#39;s disease.
That would be true if you plucked a random person from the population and subjected them to a blood test.
But it&#39;s not true if you go to your doctor with GI symptoms which are consistent with celiac disease!
If you&#39;re being tested for celiac disease, you probably are symptomatic.</p>
<p>So that prior probability, <code>P(A)</code>?
It&#39;s better as something else, but how we set it is a good question.</p>
<p>Let&#39;s say you present with symptoms highly consistent with celiac disease, and that this gives you a 10% chance of having celiac disease and a 90% chance of it being something else, <em>given these symptoms</em>.
This changes the probability a lot.
If you get a positive test in this case, then <code>P(A|B) = 0.93 * 0.1 / (0.93 * 0.1 + 0.04 * 0.9) = 0.72</code>.
So now a positive test is a 72% chance of having celiac disease, instead of just 20%.
And a negative test here gives you a 10% chance of a false negative, better than the 0.1% chance before.</p>
<p>The real question is how we go from symptoms to that prior probability accurately.</p>
<p>* * *</p>
<p>I spent a lot of 2024 being poked with needles and tested for various diseases while we tried to figure out what was wrong with me.
Ultimately it was Lyme disease, and the diagnosis took a while because of a false negative.
That false negative happened because the test was calibrated for broad population sampling, not for testing individuals presenting with symptoms already.</p>
<p>The whole story is a lot longer, and it&#39;s for another post.
But maybe, just maybe, it would&#39;ve been a shorter story if we&#39;d learned reason about probabilities and medical tests better.
Things are not intuitive, but Bayes is your friend, and Bayes&#39; theorem can show us the information we really need to know.</p>
<p>Or, we can keep going with things how they are.
I mean, I did enjoy getting to know Barbara, my phlebotomist, from all my appointments.</p>
</div><p>
  If you&#39;re looking to grow more effective as a software engineer, please consider my <a href="https://dmvaldman.github.io/coaching/">coaching services</a>.
  </p></div>
  </body>
</html>
