<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.adept.ai/blog/fuyu-8b">Original</a>
    <h1>Fuyu-8B: A multimodal architecture for AI agents</h1>
    
    <div id="readability-page-1" class="page"><div><p>We’re releasing Fuyu-8B, a small version of the multimodal<sup><a href="#user-content-fn-mmdefinition" id="user-content-fnref-mmdefinition" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup> model that powers our product.
The model is <a href="https://huggingface.co/adept/fuyu-8b">available on HuggingFace</a>.
We think Fuyu-8B is exciting because:</p>
<ol>
<li>It has a much simpler architecture and training procedure than other multi-modal models, which makes it easier to understand, scale, and deploy.</li>
<li>It’s designed from the ground up for digital agents, so it can support arbitrary image resolutions, answer questions about graphs and diagrams, answer UI-based questions, and do fine-grained localization on screen images.</li>
<li>It’s fast - we can get responses for large images in less than 100 milliseconds.</li>
<li>Despite being optimized for our use-case, it performs well at standard image understanding benchmarks such as visual question-answering and natural-image-captioning.</li>
</ol>
<div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/baby_cake.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/baby_cake.png"/></p></div></figure></div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/chart.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/chart.png"/></p></div></figure></div><div><div><p>Fuyu’s caption:</p><p>“A cake with writing on it that says congratulations kate and luke on your upcoming arrival.”</p></div></div><div><div><p>Question:</p><p>“What is the highest life expectancy at birth of males?”</p></div><div><p>Fuyu’s answer:</p><p>“The life expectancy at birth of males in 2018 is 80.7”</p></div></div></div>
<p>Today, we’re releasing Fuyu-8B with an open license (<a href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">CC-BY-NC</a>)—we’re excited to see what the community builds on top of it!
We also discuss results for Fuyu-Medium (a larger model we’re not releasing) and provide a sneak peek of some capabilities that are exclusive to our internal models.</p>
<p><strong>Because this is a raw model release, we have not added further instruction-tuning, postprocessing or sampling strategies to control for undesirable outputs. You should expect to have to fine-tune the model for your use-case.<sup><a href="#user-content-fn-teaser" id="user-content-fnref-teaser" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup></strong></p>

<p>Adept is building a generally intelligent copilot for knowledge workers.
In order to do this, it’s important for us to be able to understand user context and to take actions on behalf of users.
Both of those goals rely heavily on image understanding.
Users expect what’s visible on their screen to be accessible to the copilot, and important data is often presented most naturally as an image – think charts, slides, PDFs, etc.
In order to take actions, we often need to literally click on buttons or scroll through menus.
It would be nice if all these actions were doable via API, but many business-relevant software has no API or an incomplete API, and controlling software via UIs allows us to keep the user in the loop.</p>
<div><figure><figure><p><img src="https://www.adept.ai/images/blog/fuyu-8b/architecture.png"/></p></figure><figcaption><div><p>Diagram of the Fuyu model architecture.
Fuyu is a vanilla decoder-only transformer with no specialized image encoder.
Image patches are linearly projected directly into the first layer of the transformer, bypassing the embedding lookup.
This simplified architecture supports arbitrary image resolutions, and dramatically simplifies both training and inference.</p></div></figcaption></figure></div>
<p>Therefore, we need a model that can understand both images and text.
Although a lot of progress is being made on this front, nothing is available that suits our precise needs.
Existing multimodal models are complicated, both from an architectural perspective and a training perspective.
These complications are a liability when it comes to understanding model behavior, scaling models up, and deploying to users.</p>
<p>On the architecture side, other multimodal models involve a separate image encoder, the output of which tends to be connected to an existing LLM via either cross-attention or through some kind of adapter that feeds directly into the LLM’s embedding-space.
<a href="https://arxiv.org/pdf/2303.03378.pdf">PALM-e</a>, <a href="https://arxiv.org/pdf/2305.18565.pdf">PALI-X</a>, <a href="https://arxiv.org/pdf/2308.12966.pdf">QWEN-VL</a>, <a href="https://arxiv.org/abs/2310.03744">LLaVA 1.5</a>, and <a href="https://www.deepmind.com/blog/tackling-multiple-tasks-with-a-single-visual-language-model">Flamingo</a> all look more-or-less like this.
These models also tend to work on a fixed image resolution.
At inference time, all images at greater resolution than this must be downsampled, and all images whose aspect ratio doesn’t match must be padded or distorted.</p>
<p>On the training side, other multimodal models tend to have a large number of separate training stages.
The image encoder will be trained separately from the LLM on its own tasks, often using a contrastive training objective, which is complicated to implement and reason about.
Then, as in e.g. <a href="https://arxiv.org/pdf/2305.18565.pdf">PALI-X</a>, the image encoder and the text decoder (frequently with a bespoke connector network) will be trained together on images at a low resolution for some period of time.
At this point, a choice must be made about whether to freeze the weights of each of the components while training.
Finally, some models are trained with an extra high-resolution image phase (without which they won’t perform well on high-res images).</p>
<p>When scaling up models, it’s difficult to reason about how to independently scale each of the above components.
Should marginal parameters be allocated to the encoder or the decoder?
To which of the training steps should we give the next chunk of compute?
We’ve instead designed a model without these complications.</p>
<p>Architecturally, Fuyu is a vanilla decoder-only transformer with the same details as <a href="https://www.adept.ai/blog/persimmon-8b">Persimmon-8B</a> - there is no image encoder.
Image patches are instead linearly projected into the first layer of the transformer, bypassing the embedding lookup.
We simply treat the normal transformer decoder like an image transformer (albeit with no pooling and causal attention).
See the diagram above for more details.</p>
<p>This simplification allows us to support arbitrary image resolutions.
To accomplish this, we just treat the sequence of image tokens like the sequence of text tokens.
We remove image-specific position embeddings and feed in as many image tokens as necessary in raster-scan order.
To tell the model when a line has broken, we simply use a special image-newline character.
The model can use its existing position embeddings to reason about different image sizes, and we can use images of arbitrary size at training time, removing the need for separate high and low-resolution training stages.</p>
<p>Together, these changes have dramatically simplified our training and inference experience.</p>

<p>To sanity-check the architectural changes underlying Fuyu-8B, we chose four of the most commonly-used image-understanding datasets: <a href="https://visualqa.org/">VQAv2</a>, <a href="https://okvqa.allenai.org/">OKVQA</a>, <a href="https://github.com/tylin/coco-caption">COCO</a> Captions, and <a href="https://allenai.org/data/diagrams">AI2D</a>.
VQAv2 and OKVQA are natural image question-answering datasets, COCO is a captioning dataset, and AI2D is a multiple-choice dataset involving scientific diagrams.
We compare our models to <a href="https://arxiv.org/pdf/2303.03378.pdf">PALM-e</a>, <a href="https://arxiv.org/pdf/2305.18565.pdf">PALI-X</a>, <a href="https://arxiv.org/pdf/2308.12966.pdf">QWEN-VL</a>, and <a href="https://arxiv.org/abs/2310.03744">LLaVA 1.5</a>.</p>
<h2 id="the-numbers">The Numbers</h2>
<p>The Fuyu models perform well according to these metrics, even though they are heavily focused on natural images.
Fuyu-8B improves over QWEN-VL and PALM-e-12B on 2 out of 3 metrics despite having 2B and 4B fewer parameters, respectively.
Fuyu-Medium performs comparably to PALM-E-562B despite having fewer than a tenth as many parameters!
PALI-X still performs best on these benchmarks, but it’s larger and fine-tuned on a per-task basis.
Note that, since these benchmarks are not our main focus, we didn’t perform any of the typical optimizations (e.g. non-greedy sampling, fine-tuning for a long time on each dataset specifically, etc).</p>
<div>






















































<table><thead><tr><th>Eval Task</th><th>Fuyu-8B</th><th>Fuyu-Medium</th><th>LLaVA 1.5 (13.5B)</th><th>QWEN-VL (10B)</th><th>PALI-X (55B)</th><th>PALM-e-12B</th><th>PALM-e-562B</th></tr></thead><tbody><tr><td>VQAv2</td><td>74.2</td><td>77.4</td><td>80</td><td>79.5</td><td>86.1</td><td>76.2</td><td>80.0</td></tr><tr><td>OKVQA</td><td>60.6</td><td>63.1</td><td>n/a</td><td>58.6</td><td>66.1</td><td>55.5</td><td>66.1</td></tr><tr><td>COCO Captions</td><td>141</td><td>138</td><td>n/a</td><td>n/a</td><td>149</td><td>135</td><td>138</td></tr><tr><td>AI2D</td><td>64.5</td><td>73.7</td><td>n/a</td><td>62.3</td><td>81.2</td><td>n/a</td><td>n/a</td></tr></tbody></table></div>
<h2 id="what-are-these-image-understanding-benchmarks">What are these Image-Understanding Benchmarks?</h2>
<p>While interacting with these benchmarks we also noticed serious issues.
We’ve developed an in-house eval suite that corresponds more closely to the capabilities we care about, but we thought it was worth elaborating on some of those issues here, given the ubiquity of these benchmarks.</p>
<p><strong>Question Answering Benchmarks</strong></p>
<p>The question-answering datasets are quite flawed - they use a complicated scoring mechanism, require you to respond in a specific format, and are often annotated incorrectly.</p>
<p>Consider the following two images:</p>
<div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/snare_bear.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/snare_bear.png"/></p></div></figure></div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/fish_and_carrots.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/fish_and_carrots.png"/></p></div></figure></div><div><p>OKVQA</p><div><p>Question:</p><p>“What instrument is the toy bear playing?”</p></div><div><p>Fuyu’s answer:</p><p>“snare”</p></div><div><p>OKVQA Score:</p><p>0 <span>(all reference answers are simply “drum”)</span></p></div></div><div><p>VQAv2</p><div><p>Question:</p><p>“What type of foods are in the image?”</p></div><div><p>Fuyu’s answer:</p><p>“fish, carrots”</p></div><div><p>VQAv2 Score:</p><p>0 <span>(reference answers were “hot dogs”, “sausages”, and “healthy”)</span></p></div></div></div>
<p>For the image on the left from the OKVQA dataset, when asked the question “What instrument is the toy bear playing?”, the model responds “snare”—which is clearly true!
However, it gets a score of 0, because all of the reference answers are simply “drum”.
Similarly, for the VQAv2 image on the right, when asked “What type of foods are in the image?”, the model corectly responds “fish, carrots”, but it also gets a score of 0 because the reference solution list doesn’t contain those words.</p>
<p><strong>Captioning Benchmarks</strong></p>
<p>It’s also common to evaluate image models using the COCO Captions benchmark.
The score used for this benchmark (CIDEr) is based on n-gram similarity to a group of reference captions, which are often poor.
We haven’t found performance on this benchmark corresponds particularly well to our internal evaluations.
In fact Fuyu-Medium is slightly worse by this metric than Fuyu-8B!</p>
<p>For the image below, our model gives the caption “A nighttime view of Big Ben and the Houses of Parliament.”
This is correct, but it gets a score of 0.4 because it doesn’t match any of the reference captions (a good score is over 100).</p>
<div><figure><figure><p><img src="https://www.adept.ai/images/blog/fuyu-8b/big_ben.png"/></p></figure><figcaption><div><div><p>Fuyu’s caption:</p><p>“A nighttime view of Big Ben and the Houses of Parliament.”</p></div><div><p>Reference captions:</p><p>“A fast moving image of cars on a busy street with a tower clock in the background.”</p></div><div><p>“Lit up night traffic is zooming by a clock tower.”</p></div><div><p>“A city building is brightly lit and a lot of vehicles are driving by.”</p></div><div><p>“A large clock tower and traffic moving near.”</p></div><div><p>“there is a large tower with a clock on it.”</p></div><div><p>CIDEr Score:</p><p>0.4 <span>(No reference caption mentions Big Ben or Parliament)</span></p></div></div></figcaption></figure></div>

<p>The Fuyu models have several cool capabilities that we preview here, including chart, diagram, and document understanding.</p>
<h2 id="chart-understanding">Chart Understanding</h2>
<p>Since our product is geared towards assisting knowledge workers, it’s important for our model to be able to understand charts and diagrams.
Here are some examples.</p>
<p>Fuyu can understand complex visual relationships, such as in the below chart, where it has to trace connections between actors and shows and count them to answer the question.</p>
<div><figure><figure><p><img src="https://www.adept.ai/images/blog/fuyu-8b/actors.png"/></p></figure><figcaption><div><p>Question:</p><p>“Aidan Gillen acted in how many series?”</p></div><div><p>Fuyu’s answer:</p><p>“2”</p></div></figcaption></figure></div>
<p>It can also answer nontrivial, multi-hop questions given traditional charts.</p>
<div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/twitter_graph.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/twitter_graph.png"/></p></div></figure></div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/vacation_days.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/vacation_days.png"/></p></div></figure></div><div><div><p>Question:</p><p>“Find missing data of the sequence 24, _ ,32, 33, 42?”</p></div></div><div><div><p>Question:</p><p>“What was the fair amount of paid vacation days in the UK?”</p></div></div></div>
<h2 id="document-understanding">Document Understanding</h2>
<p>Fuyu can also understand documents — both complex infographics and old PDFs:</p>
<div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/jobs.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/jobs.png"/></p></div></figure></div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/pack_spinner.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/pack_spinner.png"/></p></div></figure></div><div><div><p>Question:</p><p>“Which is the metro in California that has a good job Outlook?”</p></div><div><p>Fuyu’s answer:</p><p>“Los Angeles”</p></div></div><div><div><p>Question:</p><p>“What was the pack spinner capacity?”</p></div><div><p>Fuyu’s answer:</p><p>“118 packs.”</p></div></div></div>
<h2 id="diagram-understanding">Diagram Understanding</h2>
<p>Finally, the model can understand complex relational queries about scientific diagrams:</p>
<div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/leaf_shapes.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/leaf_shapes.png"/></p></div></figure></div><div><figure><div><p><img src="https://www.adept.ai/images/blog/fuyu-8b/red_tree_vole.png"/></p><p><img src="https://www.adept.ai/images/blog/fuyu-8b/red_tree_vole.png"/></p></div></figure></div><div><div><p>Question:</p><p>“What letter does a keel-shaped cross-section look like?”</p></div><div><p>Fuyu’s answer:</p><p>“The letter V”</p></div></div><div><div><p>Question:</p><p>“If in the food web shown in the diagram, Douglas fir tree needles are absent, which organism would starve?”</p></div><div><p>Fuyu’s answer:</p><p>“Red tree vole”</p></div></div></div>

<p>Our internal models (based on Fuyu) have extra capabilities related to our product. In particular,</p>
<ol>
<li>They can reliably perform OCR on high-resolution images</li>
<li>They can do fine-grained localization of text and UI elements within those images</li>
<li>They can answer questions about images of UIs</li>
</ol>
<p>Since these capabilities are built off of the Fuyu model class (and underly our upcoming product release), we thought it would be interesting to preview some of them.</p>
<h2 id="ocr-capabilities">OCR Capabilities</h2>
<p>We’ve trained our internal models to do the following two tasks given an image of a UI:</p>
<ol>
<li>Given a bounding box, tell us what text lies inside that bounding box (<code>bbox_to_text</code>)</li>
<li>Given some text, return to us the bounding box that contains that text (<code>text_to_bbox</code>)</li>
</ol>
<p>Consider the following 1920x1080 image from one of our validation sets:</p>
<figure><p><img src="https://www.adept.ai/images/blog/fuyu-8b/ocr_example.png"/></p></figure>
<p>The blue boxes represent bounding box coordinates that have been passed to the model for the <code>bbox_to_text</code> task.
For this example, the model correctly predicted the text contents of every blue bounding box.</p>
<p>The red boxes represent predicted bounding boxes and green boxes represent target bounding boxes for the <code>text_to_bbox</code> task.
The model is good enough at bounding box prediction that the red and green boxes overlap almost completely.</p>
<h2 id="localization-and-qa-capabilities">Localization and QA Capabilities</h2>
<p>The model can also locate things on the screen based on informal text commands, as well as answer detailed factual questions about the contents of UIs:</p>
<div><figure><figure><p><img src="https://www.adept.ai/images/blog/fuyu-8b/gmail_qa.png"/></p></figure><figcaption><div><p>Question:</p><p>“is the 2nd email starred? [‘yes’, ‘no’]”</p></div><div><p>Fuyu’s answer:</p><p>“no”</p></div></figcaption></figure></div>
<p>Or consider the below example, where the model can interact with Google Maps to correctly answer questions<sup><a href="#user-content-fn-domnote" id="user-content-fnref-domnote" data-footnote-ref="" aria-describedby="footnote-label">3</a></sup>.</p>
<div><figure><figure><p><img src="https://www.adept.ai/images/blog/fuyu-8b/maps_qa.png"/></p></figure><figcaption><div><p>Question:</p><p>“is La Taqueria north of the 24th St Mission Bart station?”</p></div><div><p>Fuyu’s answer:</p><p>“no”</p></div></figcaption></figure></div>
<p>—</p>
<p>Both the model weights and some example code are <a href="https://huggingface.co/adept/fuyu-8b">on HuggingFace</a>.
We look forward to seeing what you build with it, and please reach out if you have any questions.
Stay tuned for more on our product alpha, which will incorporate these and other changes and is coming soon!</p>
<p>—</p>
<h2 id="citation">Citation</h2>
<p>If you use this model in your work, please use the following BibTeX citation:</p>
<pre is:raw="" tabindex="0"><code><span><span>@misc</span><span>{</span><span>fuyu-8b</span><span>,</span></span>
<span><span>  </span><span>author</span><span> = </span><span>{</span><span>Bavishi, Rohan and Elsen, Erich and Hawthorne, Curtis and Nye, Maxwell and Odena, Augustus and Somani, Arushi and  Ta\c{s}\i{}rlar, Sa\u{g}nak</span><span>}</span><span>,</span></span>
<span><span>  </span><span>title</span><span> = </span><span>{</span><span>Introducing our Multimodal Models</span><span>}</span><span>,</span></span>
<span><span>  </span><span>url</span><span> = </span><span>{</span><span>https://www.adept.ai/blog/fuyu-8b</span><span>}</span><span>,</span></span>
<span><span>  </span><span>year</span><span> = </span><span>{</span><span>2023</span><span>}</span></span>
<span><span>}</span></span></code></pre>
<p>—</p>
</div></div>
  </body>
</html>
