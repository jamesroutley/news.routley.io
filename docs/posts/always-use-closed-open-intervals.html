<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://fhur.me/posts/always-use-closed-open-intervals">Original</a>
    <h1>Always use [closed, open) intervals</h1>
    
    <div id="readability-page-1" class="page"><div id="__next" data-reactroot=""><article>
<p>Intervals or ranges pop-up everywhere in the programming world. The classic example is picking a start and end date, like you would when booking an AirBnB or a flight. But that&#39;s just one example: from <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/slice">slicing a JS Array</a>, to Java&#39;s <a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html">List#sublist</a> and even SQL&#39;s <code>LIMIT</code> operator, ranges are everywhere.</p>
<p>Have you ever wondered why they are always implemented as <code>[closed, open)</code> as opposed to <code>[closed, closed]</code>?</p>
<h2>Wait, what&#39;s a [closed, open) interval?</h2>
<p>A closed-open interval, usually denoted as <code>[a, b)</code> is just a short form for expressing <code>a &lt;= x &lt; b</code> or the set of all values starting from and including <code>a</code> up to, but excluding <code>b</code>. For example if we&#39;re using integers then <code>[0,5) == 0, 1, 2, 3, 4</code>.</p>
<p>A closed-closed interval, usually denoted as <code>[a, b]</code> is one that <em>includes</em> the last value e.g. <code>[0,5] == 0, 1, 2, 3, 4, 5</code></p>
<h2>Never, ever, ever use [closed, closed] intervals</h2>
<p>A couple of years ago I had the (mis)fortune of working on a system that used [closed, closed] ranges extensively. The system worked well for the most part, but had tons of clunky code to handle a few cases. Here&#39;s a few of the cases we had to battle with:</p>
<h3>The empty interval</h3>
<p>Imagine you want to describe a zero length time interval (i.e. an empty interval) that start&#39;s at time <code>T=1</code>. With closed-open intervals this is a trivial task, simply <code>[T,T)</code>, with closed-closed... not so much. You could try <code>[T, T-1]</code>, but that&#39;s a bit clunky and it won&#39;t work if <code>T</code> is a decimal number.</p>
<h3>Splitting by time</h3>
<p>Imagine that you want to group users by the hour in the day when they registered to your site. This is essentially the problem of &#34;splitting&#34; the 24 hours of the day in 1-hour intervals.</p>
<p>With <code>[closed, open)</code> you get a very nice looking sequence <code>[0,1), [1,2), [2,3), [3,4), ..., [23,24)</code>.</p>
<p>With <code>[closed, closed]</code>, you get this monstruosity <code>[0,0:59:59], [1, 1:59:59], ... [23,23:59,59]</code>. Note that this essentially forces a precicion into your entire system. What happened to users that registered between <code>0:59:59</code> and <code>1</code>? They will be lost.</p>
<h3>Calculating the length of an interval</h3>
<p>Another common task, whenever intervals are involved, is to calculate their length.</p>
<p>With <code>[a, b)</code> it&#39;s trivial, simply <code>b-a</code>.</p>
<p>With <code>[a, b]</code> you get a few edge cases, for one the length of <code>[a, a-1]</code> could be 0 as we saw earlier, or it could be negative if <code>a &lt; 1</code>.</p>
<p>Another property that you would expect from a properly implemented range is that splitting a range by half should yield two ranges whose length add up to the original range&#39;s length.</p>
<p>For example, splitting the hours in a day into two ranges, should result in 2 ranges with length 12, so that 12+12 = 24. This property is lost when using <code>[a, b]</code> ranges.</p>
<h2>Final thoughts</h2>
<p>When I was writing this article I found a short <a href="https://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html">1982 note</a> by good ol&#39; Edsger W. Dijkstra on why he preferred <code>[closed, open)</code> intervals. I won&#39;t bore you with the details, but let&#39;s just say that the brilliant people at Xerox PARC tried them, and found that <code>[a, b]</code> ranges lead to buggier and more complex code.</p>
<p>I hope this short read has convinced you of the perils and pitfals of using <code>[closed, closed]</code> intervals. My guess is that the reason people sometimes fall for them is because they look nice and symmetric, and in fact work <em>most of the time</em>.</p>
<p>It&#39;s only in the edge cases that they start to break down. But that is exactly how you should evaluate how good a design is: by testing it against the edge cases.</p>
<p>If you liked this article,<!-- --> <a href="https://twitter.com/fernandohur">follow me on twitter</a>. I post about once a month on software engineering practices, startup engineering and programming in general.</p><small><time>2022</time> Â© Fernando Hurtado Cardenas.<a href="https://fhur.me/feed.xml">RSS</a></small></article></div></div>
  </body>
</html>
