<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://laurent.le-brun.eu/blog/an-overview-of-starlark">Original</a>
    <h1>An Overview of the Starlark Language</h1>
    
    <div id="readability-page-1" class="page"><div id="page">
                            <div id="content">
            <div id="primary">
                <main id="main" role="main">
                          		
			 <article>



    

    <div>
                    <p><a href="https://github.com/bazelbuild/starlark/tree/master">Starlark</a> is a small programming language, designed as a simple dialect of Python and intended primarily for embedded use in applications. Some people might say it’s a bit like Lua with Python syntax, but I think there are many interesting bits to discuss. The language is now open-source and used in many other applications and companies. As I led the design and implementation of Starlark, I’d like to write a bit more about it.</p>
<h2>What it looks like</h2>
<p>Here’s a code example:</p>
<pre><code>def fizz_buzz(n):
  &#34;&#34;&#34;Print Fizz Buzz numbers from 1 to n.&#34;&#34;&#34;
  for i in range(1, n + 1):
    s = &#34;&#34;
    if i % 3 == 0:
      s += &#34;Fizz&#34;
    if i % 5 == 0:
      s += &#34;Buzz&#34;
    print(s if s else i)

fizz_buzz(20)</code></pre>
<p>I told you it looks like Python. Actually this is valid Python 3 code as well as Starlark code.</p>
<p>Like Python, it is a dynamically typed language with high-level data types, first-class functions with lexical scope, and garbage collection. But it’s much simpler than Python and most Python features are not supported.</p>
<p>In my experience on a large codebase with tens of thousands of developers, most people are comfortable using the language, without having to learn it first.</p>
<h2>Principles</h2>
<p>The language was designed with the following principles in mind.</p>
<ul>
<li><strong>Deterministic evaluation</strong>. If you execute the same code twice, you will get the same results. In Python, the code won’t be deterministic if it relies on the output of functions like “id”, “hash”, if it iterates over a hashtable, if it has race conditions, or if it measures the execution time.</li>
<li><strong>Hermetic execution</strong>. During the execution, the code cannot access the file system, network, or even look at the current date. You may be able to execute untrusted code.</li>
<li><strong>Parallel evaluation</strong>. In Python, import order as each import is evaluated successively and they may have side effects. In Starlark, modules can safely be loaded in parallel. The data shared across multiple modules becomes immutable, to ensure the code is always thread safe.</li>
<li><strong>Simplicity</strong>. The language is small, <a href="https://github.com/bazelbuild/starlark/blob/master/spec.md">the language specification</a> is short. The number of concepts is relatively limited, so that new users should be able to quickly read and write code. We removed multiple pitfalls that are present in Python.</li>
<li><strong>Focus on tooling</strong>. As the code base grows, it becomes important to be able to analyze and edit the Starlark code automatically. When a language is too dynamic, it can be hard to refactor and migrate the existing code. In Starlark, it’s easier to do static analysis and have stronger guarantees than in Python</li>
<li><strong>Python-like</strong>. Python is a very popular language and its syntax is well known among developers. Starlark was designed to feel familiar to reduce the learning curve and make the semantics more obvious to users.</li>
</ul>
<p>We get lots of guarantees with Starlark, and that’s the main differentiating factor with other popular languages. Some people may believe it’s easy to avoid non-determinism or other issues, but I assure you they frequently happen in large codebases.</p>
<h2>Differences with Python</h2>
<p>Starlark is much simpler than Python. The library is minimalist: there are about 30 functions, a few types, and methods on lists, strings and dicts. Of course, when embedding Starlark, the host application can provide additional functions.</p>
<p>Some differences with Python: There are no exceptions, no “while”, no “yield”, no “is”, no reflection. Global variables cannot be reassigned. Iteration order is always specified. Implicit string concatenation is not allowed. This list is not exhaustive. For more information on the topic, see the <a href="https://github.com/bazelbuild/starlark/blob/master/design.md">Language Design</a> page.</p>
<h2>Applications</h2>
<p>People often use Starlark as an extension language (similar to Lua), or as a configuration language. Starlark is available as a library, to be used from other applications. There are currently three implementations of Starlark, in different languages:</p>
<ul>
<li>In Java (part of the Bazel codebase). This was the original implementation. It is used for Bazel and a couple of Google projects, but it doesn’t have a stable interface.</li>
<li>In Rust: <a href="https://github.com/facebookexperimental/starlark-rust">https://github.com/facebookexperimental/starlark-rust</a>. It is maintained by Facebook. See the [Starlark-Rust announcement](the Starlark-Rust announcement). It is used at Facebook for their build system, Buck, as well as multiple other internal tools.</li>
<li>In Go: <a href="https://github.com/google/starlark-go/">https://github.com/google/starlark-go/</a>. It is used by many open-source projects and companies, such as <a href="https://developer.ibm.com/blogs/yaml-templating-tool-to-simplify-complex-configuration-management/">IBM</a>, Stripe (<a href="https://github.com/stripe/skycfg">skycfg</a>), Chromium (<a href="https://chromium.googlesource.com/infra/luci/luci-go/+/refs/heads/master/lucicfg/doc/README.md">lucicfg</a>), Cruise Automation (<a href="https://github.com/cruise-automation/isopod">isopod</a>), the Go debugger <a href="https://github.com/go-delve/delve">Delve</a>, and many more.</li>
</ul>
<h2>Why did you create Starlark?</h2>
<p>Historically, all the code in the Google codebase was built using Makefiles. As the codebase grew, people wrote Python scripts to generate the Makefiles, using a relatively declarative syntax. Around 2007, Bazel was created and it relied on the Python interpreter to understand the build scripts. After we faced scalability, performance and maintenance issues, we needed a language that provide much stronger guarantees. I started the language design and implementation in 2015. In 2017, we migrated all the Python build scripts inside Google to Starlark (hundreds of thousands of files). To help the migration, we decided to keep the language as similar as possible to Python.</p>
<p>If you plan to use Starlark in your application, I’d love to hear it. If you face adoption blockers, I’d love to hear it as well. I’ve just created <a href="https://www.reddit.com/r/starlark/">a Starlark subreddit for news and discussions</a> although I don’t know yet how useful it will be, but I’ll monitor it.</p>
                        </div>

                
    
</article>

        



<nav role="navigation">
    <h2>Post navigation</h2>
    
</nav>
	                </main>
            </div>
        </div>
        

</div></div>
  </body>
</html>
