<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bun.sh/blog/bun-v0.7.0">Original</a>
    <h1>Bun v0.7.0</h1>
    
    <div id="readability-page-1" class="page"><article><p>We&#39;re pleased to announce Bun v0.7.0, a big leap forward in terms of Node.js compatibility.</p><p>We&#39;re hiring C/C++ and Zig engineers to build the future of JavaScript! <a href="https://bun.sh/careers">Join our team →</a></p><p>Bun is an incredibly fast JavaScript runtime, bundler, transpiler, and package manager — all in one. Over the past couple months, we&#39;ve been releasing a lot of changes to Bun recently, here&#39;s a recap in case you missed it:</p><ul><li><a href="https://bun.sh/blog/bun-v0.6.10"><code>v0.6.10</code></a> - <code>fs.watch()</code>, <code>bun install</code> bug fixes, <code>bun test</code> features, and improved CommonJS support</li><li><a href="https://bun.sh/blog/bun-v0.6.10"><code>v0.6.11</code></a> - Addressed a release build issue from <code>v0.6.10</code>.</li><li><a href="https://bun.sh/blog/bun-v0.6.12"><code>v0.6.12</code></a> - Sourcemap support in <code>Error.stack</code>, <code>Bun.file().exists()</code>, and Node.js bug fixes.</li><li><a href="https://bun.sh/blog/bun-v0.6.13"><code>v0.6.13</code></a> - Implemented mock <code>Date</code>, faster base64 encoding, and fixes for <code>WebSocket</code> and <code>node:tls</code>.</li><li><a href="https://bun.sh/blog/bun-v0.6.14"><code>v0.6.14</code></a> - <code>process.memoryUsage()</code>, <code>process.cpuUsage()</code>, <code>process.on(&#39;beforeExit&#39;, cb)</code>, <code>process.on(&#39;exit&#39;, cb)</code> and crash fixes</li></ul><p>To install Bun:</p><div id="RWUelGtIHM"><div><div><p>curl</p><div><div><pre><code><span><span>curl -fsSL https://bun.sh/install </span><span>|</span><span> bash</span></span></code></pre></div></div></div></div><div><div><p>docker</p><div><div><pre><code><span><span>docker run --rm --init --ulimit memlock=-1:-1 oven/bun</span></span></code></pre></div></div></div></div></div><p>To upgrade Bun:</p><h2 level="2" anchor-id="vite-support"><a name="vite-support"></a><a href="#vite-support">Vite support</a></h2><p><em>Support is still experimental and non-optimized.</em> Vite does not use Bun&#39;s bundler, module resolver, or transpiler, even when run with Bun.</p><p>With the recent strides towards Node.js API compatibilty, Bun can now run <a href="https://vitejs.dev/"><code>vite dev</code></a>, thanks to <a href="https://github.com/paperdave">@paperdave</a>! This is one of Bun&#39;s <a href="https://github.com/oven-sh/bun/issues/250">most upvoted issues</a>.</p><p>To try this with one of Vite&#39;s starter projects, use <code>bunx</code>:</p><p>Then start the dev server.</p><p><strong>Why <code>--bun</code>?</strong> The <code>--bun</code> flag tells Bun to override the <code>#! /usr/bin/env node</code> shebang in the <code>vite</code> CLI and execute the file with Bun instead of Node.js. In a future release this will be the default behavior.</p><figure><a href="https://user-images.githubusercontent.com/709451/254804727-725bf67c-c60f-4eec-b472-07d52b650a93.gif"><img src="https://user-images.githubusercontent.com/709451/254804727-725bf67c-c60f-4eec-b472-07d52b650a93.gif" caption="Hot module reloading with Vite"/></a><figcaption>Hot module reloading with Vite</figcaption></figure><p>This is a great way to develop frontend code with Bun&#39;s APIs on the server when building frontend apps.</p><p>Note: if you run <code>bun vite dev</code> without <code>-b</code> or <code>--bun</code>, it will still run in Node.js as <code>vite</code>&#39;s CLI specifies <code>#!/usr/bin/env node</code> at the top which tells Bun (and other software on your computer) to run it in Node.js.</p><h2 level="2" anchor-id="concurrency-with-worker"><a name="concurrency-with-worker"></a><a href="#concurrency-with-worker">Concurrency with <code>Worker</code></a></h2><p>Bun now supports <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker"><code>Worker</code></a> which allows you to run another JavaScript instance in a separate thread. In Bun, workers support ES Modules, CommonJS, TypeScript, JSX, and the rest of Bun&#39;s features with no extra configuration.</p><p>As in browsers, <code>Worker</code> is a global class. To create a worker from the main thread:</p><div><p>main.ts</p><div><div><pre><code><span><span>const</span><span> worker </span><span>=</span><span> </span><span>new</span><span> </span><span>Worker</span><span>(</span><span>&#34;</span><span>./worker.ts</span><span>&#34;</span><span>);</span></span>
<span><span>worker.</span><span>addEventListener</span><span>(</span><span>&#34;</span><span>message</span><span>&#34;</span><span>, (</span><span>event</span><span>:</span><span> </span><span>MessageEvent</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>&#34;</span><span>Message from worker:</span><span>&#34;</span><span>, event.data);</span></span>
<span><span>});</span></span>
<span><span>worker.</span><span>postMessage</span><span>(</span><span>&#34;</span><span>Hello from main thread!</span><span>&#34;</span><span>);</span></span>
<span></span></code></pre></div></div></div><p>On the worker thread:</p><div><p>worker.ts</p><div><div><pre><code><span><span>addEventListener</span><span>(</span><span>&#34;</span><span>message</span><span>&#34;</span><span>, (</span><span>event</span><span>:</span><span> </span><span>MessageEvent</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>&#34;</span><span>Message from main thread:</span><span>&#34;</span><span>, event.data);</span></span>
<span><span>  </span><span>postMessage</span><span>(</span><span>&#34;</span><span>Hello from worker thread!</span><span>&#34;</span><span>);</span></span>
<span><span>});</span></span>
<span></span>
<span></span></code></pre></div></div></div><p>This release <em>does not</em> include support for the <code>node:worker_threads</code> module, but this unblocks the work necessary for us to implement it in Bun.</p><p>The following globals have been added to Bun:</p><ul><li><code>postMessage</code></li><li><code>addEventListener</code></li><li><code>removeEventListener</code></li><li><code>onmessage</code> (getter/setter)</li></ul><p>Refer to <a href="https://bun.sh/docs/api/workers">Docs &gt; API &gt; Workers</a> to learn more about using <code>Worker</code> in Bun.</p><h3 level="3" anchor-id="using-comlink-with-bun"><a name="using-comlink-with-bun"></a><a href="#using-comlink-with-bun">Using <code>comlink</code> with Bun</a></h3><p>The popular <a href="https://github.com/GoogleChromeLabs/comlink"><code>comlink</code></a> package works in Bun without changes. This library makes it easier to share functions and state between main and worker threads.</p><h3 level="3" anchor-id="structuredclone-support"><a name="structuredclone-support"></a><a href="#structuredclone-support"><code>structuredClone()</code> support</a></h3><p>As in browsers, <code>postMessage</code> serializes messages using the <em>structured clone algorithm</em>. Bun now exposes this via the Web-standard<a href="https://developer.mozilla.org/en-US/docs/Web/API/structuredClone"><code>structuredClone()</code></a> function, which provides a mechanism for deep-cloning objects. It is similar to <code>JSON.parse(JSON.stringify(obj))</code>, but it supports more types.</p><div><div><div><pre><code><span><span>const</span><span> obj </span><span>=</span><span> { a</span><span>:</span><span> </span><span>1</span><span>, b</span><span>:</span><span> </span><span>2</span><span> };</span></span>
<span><span>const</span><span> clone </span><span>=</span><span> </span><span>structuredClone</span><span>(obj);</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="asynclocalstorage-support"><a name="asynclocalstorage-support"></a><a href="#asynclocalstorage-support"><code>AsyncLocalStorage</code> support</a></h2><p>Bun now implements <code>AsyncLocalStorage</code> from the <code>node:async_hooks</code> module. This provides a mechanism for passing contextual data through a chain of asynchronous code. This is a big step towards supporting Next.js and other frameworks that rely on this module.</p><div><div><div><pre><code><span><span>import</span><span> { AsyncLocalStorage } </span><span>from</span><span> </span><span>&#34;</span><span>node:async_hooks</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> requestId </span><span>=</span><span> </span><span>new</span><span> </span><span>AsyncLocalStorage</span><span>();</span></span>
<span><span>let</span><span> lastId </span><span>=</span><span> </span><span>0</span><span>;</span></span>
<span></span>
<span><span>Bun.</span><span>serve</span><span>({</span></span>
<span><span>  </span><span>fetch</span><span>(</span><span>request</span><span>) {</span></span>
<span><span>    lastId</span><span>++</span><span>;</span></span>
<span><span>    </span><span>// Run the callback with &#39;requestId&#39; set. async_hooks will preserve</span></span>
<span><span>    </span><span>// this value through any chain of asynchronous code.</span></span>
<span><span>    </span><span>return</span><span> requestId.</span><span>run</span><span>(lastId, </span><span>async</span><span> () </span><span>=&gt;</span><span> {</span></span>
<span><span>      console.</span><span>log</span><span>(</span><span>&#34;</span><span>Request ID: ${requestId getStore ()}</span><span>&#34;</span><span>);</span></span>
<span><span>      </span><span>await</span><span> Bun.</span><span>sleep</span><span>(</span><span>500</span><span>);</span></span>
<span><span>      </span><span>// Even if new requests mutate &#39;lastId&#39;, &#39;requestId&#39; is still preserved.</span></span>
<span><span>      </span><span>return</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>&#34;</span><span>Request ID: ${requestId. getStore ()}</span><span>&#34;</span><span>);</span></span>
<span><span>    });</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="reduce-memory-usage-with-bun-smol"><a name="reduce-memory-usage-with-bun-smol"></a><a href="#reduce-memory-usage-with-bun-smol">Reduce memory usage with <code>bun --smol</code></a></h2><p><code>bun --smol</code> is a new CLI flag which configures the JavaScriptCore heap size to be smaller and grow slower, at a cost to runtime performance. This is useful for running Bun in memory-constrained environments.</p><p>To avoid setting the flag manually, you can set this as a default in <code>bunfig.toml</code>.</p><div><p>bunfig.toml</p><div><div><pre><code><span><span>smol</span><span> </span><span>=</span><span> </span><span>true</span></span>
<span></span>
<span><span>[</span><span>test</span><span>]</span></span>
<span><span># set it only for tests, if you want</span></span>
<span><span>smol</span><span> </span><span>=</span><span> </span><span>true</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="bail-in-bun-test"><a name="bail-in-bun-test"></a><a href="#bail-in-bun-test"><code>--bail</code> in <code>bun test</code></a></h2><p>Running <code>bun test</code> with <code>--bail=1</code> will exit after the first test failure.</p><div><div><div><pre><code><span><span>bun test v0.7.0</span></span>
<span><span></span></span>
<span><span>✓ test1 [0.02ms]</span></span>
<span><span>test2.test.js:</span></span>
<span><span>1 | import {test, expect} from &#39;bun:test&#39;;</span></span>
<span><span>2 |</span></span>
<span><span>3 | test(&#39;test2&#39;, () =&gt; {</span></span>
<span><span>4 |   expect(2).toEqual(3);</span></span>
<span><span>      ^</span></span>
<span><span>error: expect(received).toEqual(expected)</span></span>
<span><span>Expected: 3</span></span>
<span><span>Received: 2</span></span>
<span><span>      at /Users/colinmcd94/Documents/bun/fun/test/test2.test.js:13:8</span></span>
<span><span>✗ test2 [0.18ms]</span></span>
<span><span>Ran 2 tests across 2 files. [8.00ms]</span></span>
<span><span>Bailed out after 1 failures</span></span></code></pre></div></div></div><p>This is useful for CI environments or when you want to stop running tests after the first failure. Thanks to <a href="https://github.com/TiranexDev">@TiranexDev</a> for landing this improvement!</p><h2 level="2" anchor-id="bun-readablestreamtoformdata"><a name="bun-readablestreamtoformdata"></a><a href="#bun-readablestreamtoformdata"><code>Bun.readableStreamToFormData()</code></a></h2><p>Bun now exposes a helper for converting a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream">ReadableStream</a> into <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData">FormData</a>.</p><p>It supports multipart form data.</p><div><div><div><pre><code><span><span>import</span><span> { readableStreamToFormData } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>// without dashes</span></span>
<span><span>const</span><span> boundary </span><span>=</span><span> </span><span>&#34;</span><span>WebKitFormBoundary</span><span>&#34;</span><span> </span><span>+</span><span> </span><span>Math</span><span>.</span><span>random</span><span>().</span><span>toString</span><span>(</span><span>16</span><span>).</span><span>slice</span><span>(</span><span>2</span><span>);</span></span>
<span></span>
<span><span>const</span><span> myStream </span><span>=</span><span> </span><span>getStreamFromSomewhere</span><span>(); </span><span>// ...</span></span>
<span><span>const</span><span> formData </span><span>=</span><span> </span><span>await</span><span> Bun.</span><span>readableStreamToFormData</span><span>(stream, boundary);</span></span>
<span><span>formData.</span><span>get</span><span>(</span><span>&#34;</span><span>foo</span><span>&#34;</span><span>); </span><span>// &#34;bar&#34;</span></span>
<span></span></code></pre></div></div></div><p>It also supports URL-encoded form data:</p><div><div><div><pre><code><span><span>import</span><span> { readableStreamToFormData } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> stream </span><span>=</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>&#34;</span><span>hello=123</span><span>&#34;</span><span>).body;</span></span>
<span><span>const</span><span> formData </span><span>=</span><span> </span><span>await</span><span> </span><span>readableStreamToFormData</span><span>(stream);</span></span>
<span><span>formData.</span><span>get</span><span>(</span><span>&#34;</span><span>hello</span><span>&#34;</span><span>); </span><span>// &#34;123&#34;</span></span>
<span></span></code></pre></div></div></div><p>We added this to help fix a bug causing <code>request.formData()</code> and <code>response.formData()</code> to hang when the body was a <code>ReadableStream</code> from JavaScript.</p><h2 level="2" anchor-id="serialize-and-deserialize-in-bun-jsc"><a name="serialize-and-deserialize-in-bun-jsc"></a><a href="#serialize-and-deserialize-in-bun-jsc"><code>serialize</code> and <code>deserialize</code> in <code>bun:jsc</code></a></h2><p>The <code>bun:jsc</code> module now exports <code>serialize()</code> and <code>deserialize()</code>, which convert JavaScript objects to <code>ArrayBuffer</code> and back.</p><div><div><div><pre><code><span><span>import</span><span> { serialize, deserialize } </span><span>from</span><span> </span><span>&#34;</span><span>bun:jsc</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> { deepEquals } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> obj </span><span>=</span><span> { a</span><span>:</span><span> </span><span>1</span><span>, b</span><span>:</span><span> </span><span>2</span><span> };</span></span>
<span><span>const</span><span> buffer </span><span>=</span><span> </span><span>serialize</span><span>(obj);</span></span>
<span><span>const</span><span> clone </span><span>=</span><span> </span><span>deserialize</span><span>(buffer);</span></span>
<span></span>
<span><span>if</span><span> (</span><span>deepEquals</span><span>(obj, clone)) {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>&#34;</span><span>They are equal!</span><span>&#34;</span><span>);</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>The <code>node:v8</code> module exports these same functions, for compatibility with existing libraries that serialize/deserialize data between processes.</p><h2 level="2" anchor-id="websocket-improvements"><a name="websocket-improvements"></a><a href="#websocket-improvements"><code>WebSocket</code> improvements</a></h2><p>You can now manually send &amp; receive WebSocket <code>ping</code> and <code>pong</code> frames.</p><div><div><div><pre><code><span><span>const</span><span> ws </span><span>=</span><span> </span><span>new</span><span> </span><span>WebSocket</span><span>(</span><span>&#34;</span><span>wss://echo.websocket.org</span><span>&#34;</span><span>);</span></span>
<span><span>ws.</span><span>addEventListener</span><span>(</span><span>&#34;</span><span>pong</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>&#34;</span><span>Received pong</span><span>&#34;</span><span>);</span></span>
<span><span>});</span></span>
<span><span>ws.</span><span>ping</span><span>();</span></span>
<span></span></code></pre></div></div></div><p>This applies to both <code>ServerWebSocket</code> and <code>WebSocket</code>.</p><h3 level="3" anchor-id="nodebuffer-is-now-the-default-binarytype"><a name="nodebuffer-is-now-the-default-binarytype"></a><a href="#nodebuffer-is-now-the-default-binarytype"><code>nodebuffer</code> is now the default <code>binaryType</code></a></h3><p>By default, the <code>binaryType</code> for <code>WebSocket</code> and <code>ServerWebSocket</code> in Bun is now <code>nodebuffer</code> This means that binary data frames in <code>WebSocket</code> will be <code>Buffer</code> instances, instead of <code>ArrayBuffer</code> (as before). This is to match the bahavior of the <code>ws</code> package.</p><div><div><div><pre><code><span><span>const</span><span> ws </span><span>=</span><span> </span><span>new</span><span> </span><span>WebSocket</span><span>(</span><span>&#34;</span><span>wss://echo.websocket.org</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>ws.</span><span>addEventListener</span><span>(</span><span>&#34;</span><span>message</span><span>&#34;</span><span>, (</span><span>event</span><span>:</span><span> </span><span>MessageEvent</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  console.</span><span>log</span><span>(event.data </span><span>instanceof</span><span> </span><span>Buffer</span><span>); </span><span>// true</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>To change it back to <code>ArrayBuffer</code>, set <code>ws.binaryType = &#34;arraybuffer&#34;</code>.</p><div><div><div><pre><code><span><span>const</span><span> ws </span><span>=</span><span> </span><span>new</span><span> </span><span>WebSocket</span><span>(</span><span>&#34;</span><span>wss://echo.websocket.org</span><span>&#34;</span><span>);</span></span>
<span><span>ws.binaryType </span><span>=</span><span> </span><span>&#34;</span><span>arraybuffer</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>ws.</span><span>addEventListener</span><span>(</span><span>&#34;</span><span>message</span><span>&#34;</span><span>, (</span><span>event</span><span>:</span><span> </span><span>MessageEvent</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  event.data; </span><span>// ArrayBuffer</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>(Note that in browsers it is <code>Blob</code> by default.)</p><h3 level="3" anchor-id="close-reasons-propagate-correctly-now"><a name="close-reasons-propagate-correctly-now"></a><a href="#close-reasons-propagate-correctly-now">Close reasons propagate correctly now</a></h3><p>A bug was fixed where <code>WebSocket</code> would not propagate close reasons from third-party servers correctly. Thanks to <a href="https://github.com/electroid">@Electroid</a> for landing these improvements!</p><h2 level="2" anchor-id="node-js-compatibility-improvements"><a name="node-js-compatibility-improvements"></a><a href="#node-js-compatibility-improvements">Node.js compatibility improvements</a></h2><p>This release adds several additional improvements to Node.js compatibility.</p><h3 level="3" anchor-id="improvements-to-tlssocket-from-node-tls"><a name="improvements-to-tlssocket-from-node-tls"></a><a href="#improvements-to-tlssocket-from-node-tls">Improvements to <code>TLSSocket</code> from <code>node:tls</code></a></h3><p>The following methods were implemented on the <code>TLSSocket</code> class. Thanks to <a href="https://github.com/cirospaciari">@cirospaciari</a> for landing these improvements in <a href="https://github.com/oven-sh/bun/pull/3596"><code>#3596</code></a>.</p><ul><li><code>.getPeerFinished()</code></li><li><code>.getFinished()</code></li><li><code>.getProtocol()</code></li><li><code>.getSharedSigalgs()</code></li><li><code>.isSessionReused()</code></li><li><code>.exportKeyingMaterial()</code></li><li><code>.setMaxSendFragment()</code></li><li><code>.getPeerCertificate()</code></li><li><code>.getCertificate()</code></li><li><code>.enableTrace()</code></li><li><code>.disableRenegotiation()</code></li><li><code>.getCipher()</code></li><li><code>.getEphemeralKeyInfo()</code></li><li><code>.getTLSTicket()</code></li><li><code>.getSession()</code></li><li><code>.setSession()</code></li></ul><h3 level="3" anchor-id="base64url-hashes-are-no-longer-data-urls"><a name="base64url-hashes-are-no-longer-data-urls"></a><a href="#base64url-hashes-are-no-longer-data-urls"><code>base64url</code> hashes are no longer <code>data:</code> urls</a></h3><p>Previously, Bun would prepend <code>data:base64,</code> to the output of <code>crypto.createHash(&#34;sha256&#34;).digest(&#34;base64url&#34;)</code>. This is not what Node.js does, and it was causing issues with libraries that expected the output to be the same string as Node.js.</p><div><div><div><pre><code><span><span>crypto.</span><span>createHash</span><span>(</span><span>&#34;</span><span>sha256</span><span>&#34;</span><span>).</span><span>update</span><span>(</span><span>&#34;</span><span>abc</span><span>&#34;</span><span>).</span><span>digest</span><span>(</span><span>&#34;</span><span>base64url</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>//        Node.js:  &#34;ungWv48Bz-pBQUDeXa4iI7ADYaOWF3qctBD_YfIAFa0&#34;</span></span>
<span><span>//     Bun v0.7.0:  &#34;ungWv48Bz-pBQUDeXa4iI7ADYaOWF3qctBD_YfIAFa0&#34;</span></span>
<span><span>// &lt;= Bun v0.6.14:  &#34;data:base64,ungWv48Bz-pBQUDeXa4iI7ADYaOWF3qctBD_YfIAFa0=&#34;</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="terminal-dimensions-with-process-stdout-columns-and-process-stdout-rows"><a name="terminal-dimensions-with-process-stdout-columns-and-process-stdout-rows"></a><a href="#terminal-dimensions-with-process-stdout-columns-and-process-stdout-rows">Terminal dimensions with <code>process.stdout.columns</code> and <code>process.stdout.rows</code></a></h3><p><code>process.stdout</code> and <code>process.stderr</code> now support reading the terminal window&#39;s dimensions.</p><div><div><div><pre><code><span><span>const</span><span> { columns, rows } </span><span>=</span><span> process.stdout;</span></span>
<span><span>const</span><span> [columns, rows] </span><span>=</span><span> process.stdout.</span><span>getWindowSize</span><span>();</span></span>
<span><span>const</span><span> { columns, rows } </span><span>=</span><span> process.stderr;</span></span>
<span><span>const</span><span> [columns, rows] </span><span>=</span><span> process.stderr.</span><span>getWindowSize</span><span>();</span></span>
<span></span></code></pre></div></div></div><p>You can also use <code>process.stdout.getWindowSize()</code> if you want both dimensions at once.</p><h2 level="2" anchor-id="bugfixes"><a name="bugfixes"></a><a href="#bugfixes">Bugfixes</a></h2><p><a href="https://github.com/oven-sh/bun/pull/3656"><code>#3656</code></a> <strong>A memory leak</strong> in await <code>new Response(latin1String).arrayBuffer()</code> and <code>await Response.json(obj).json()</code> has been fixed.</p><p>After:</p><div><div><div><pre><code><span><span>cpu: Apple M1 Max</span></span>
<span><span>runtime: bun </span><span>0.7</span><span>.</span><span>0</span><span> (arm64</span><span>-</span><span>darwin)</span></span>
<span></span>
<span><span>benchmark                                                        </span><span>time</span><span> (avg)             (min … max)       p75       p99      p995</span></span>
<span><span>---------------------------------------------------------------------------------------------------</span><span> </span><span>-----------------------------</span></span>
<span><span>new</span><span> </span><span>Response</span><span>().</span><span>arrayBuffer</span><span>() (</span><span>new</span><span> string each call, latin1)    </span><span>12.9</span><span> µs</span><span>/</span><span>iter</span><span>      (</span><span>625</span><span> ns … </span><span>4.18</span><span> ms)      </span><span>1</span><span> µs </span><span>567.17</span><span> µs </span><span>711.79</span><span> µs</span></span>
<span><span>new</span><span> </span><span>Response</span><span>().</span><span>arrayBuffer</span><span>() (</span><span>new</span><span> string each call, utf16)    </span><span>12.85</span><span> µs</span><span>/</span><span>iter</span><span>     (</span><span>1.67</span><span> µs … </span><span>1.56</span><span> ms)   </span><span>2.17</span><span> µs </span><span>462.75</span><span> µs </span><span>621.13</span><span> µs</span></span>
<span><span>new</span><span> </span><span>Response</span><span>().</span><span>arrayBuffer</span><span>() (existing string, latin1)         </span><span>6.53</span><span> µs</span><span>/</span><span>iter</span><span>     (</span><span>6.21</span><span> µs … </span><span>7.07</span><span> µs)   </span><span>6.64</span><span> µs   </span><span>7.07</span><span> µs   </span><span>7.07</span><span> µs</span></span>
<span></span>
<span><span>Peak memory usage: </span><span>49</span><span> MB</span></span>
<span></span></code></pre></div></div></div><p>Before:</p><div><div><div><pre><code><span><span>cpu: Apple M1 Max</span></span>
<span><span>runtime: bun </span><span>0.7</span><span>.</span><span>0</span><span> (arm64</span><span>-</span><span>darwin)</span></span>
<span></span>
<span><span>benchmark                                                        </span><span>time</span><span> (avg)             (min … max)       p75       p99      p995</span></span>
<span><span>---------------------------------------------------------------------------------------------------</span><span> </span><span>-----------------------------</span></span>
<span><span>new</span><span> </span><span>Response</span><span>().</span><span>arrayBuffer</span><span>() (</span><span>new</span><span> string each call, latin1)   </span><span>13.51</span><span> µs</span><span>/</span><span>iter</span><span>       (</span><span>541</span><span> ns … </span><span>3.2</span><span> ms)   </span><span>1.92</span><span> µs </span><span>553.42</span><span> µs </span><span>709.92</span><span> µs</span></span>
<span><span>new</span><span> </span><span>Response</span><span>().</span><span>arrayBuffer</span><span>() (</span><span>new</span><span> string each call, utf16)    </span><span>13.07</span><span> µs</span><span>/</span><span>iter</span><span>     (</span><span>1.71</span><span> µs … </span><span>3.43</span><span> ms)   </span><span>2.13</span><span> µs </span><span>451.21</span><span> µs </span><span>651.67</span><span> µs</span></span>
<span><span>new</span><span> </span><span>Response</span><span>().</span><span>arrayBuffer</span><span>() (existing string, latin1)         </span><span>6.25</span><span> µs</span><span>/</span><span>iter</span><span>     (</span><span>5.79</span><span> µs … </span><span>6.81</span><span> µs)    </span><span>6.4</span><span> µs   </span><span>6.81</span><span> µs   </span><span>6.81</span><span> µs</span></span>
<span></span>
<span><span>Peak memory usage: </span><span>292</span><span> MB</span></span>
<span></span></code></pre></div></div></div><p><a href="https://github.com/oven-sh/bun/issues/3659"><code>#3659</code></a> A <strong>module resolution bug</strong> causing the <code>graphql</code> package to import both CommonJS and ESM versions of the same modules has been fixed. This was fixed by aligning the package.json main field order closer to what Node.js does.</p><div><div><div><pre><code><span><span>error: Cannot use GraphQLScalarType &#34;String&#34; from another module or realm.</span></span>
<span><span></span></span>
<span><span>Ensure that there is only one instance of &#34;graphql&#34; in the node_modules</span></span>
<span><span>directory. If different versions of &#34;graphql&#34; are the dependencies of other</span></span>
<span><span>relied on modules, use &#34;resolutions&#34; to ensure only one version is installed.</span></span>
<span><span></span></span>
<span><span>https://yarnpkg.com/en/docs/selective-version-resolutions</span></span>
<span><span></span></span>
<span><span>Duplicate &#34;graphql&#34; modules cannot be used at the same time since different</span></span>
<span><span>versions may have different capabilities and behavior. The data from one</span></span>
<span><span>version used in the function from another could produce confusing and</span></span>
<span><span>spurious results.</span></span>
<span><span></span></span></code></pre></div></div></div><p><a href="https://github.com/oven-sh/bun/pull/3663"><code>#3663</code></a> A <strong>bug in bun:test lifecycle hooks</strong> caused <code>beforeAll</code> and <code>afterAll</code> to not run when no tests were defined in a scope. This has been fixed.</p><p><a href="https://github.com/oven-sh/bun/issues/3670"><code>#3670</code></a> A <strong>bug when .env pointed to a directory</strong> caused Bun to crash. This has been fixed.</p><p><a href="https://github.com/oven-sh/bun/issues/3682"><code>#3682</code></a> A <strong>TypeScript parser bug related to ternaries with spread operators</strong> has been fixed</p><h3 level="3" anchor-id="changelog"><a name="changelog"></a><a href="#changelog">Changelog</a></h3><div><table><thead></thead><tbody><tr><td><a href="https://github.com/oven-sh/bun/pull/3253">#3253</a></td><td>feat(bun/test): Implement &#34;bail&#34; option for &#34;bun test&#34; by @TiranexDev</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3608">#3608</a></td><td>Improve our internal typedefs by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3257">#3257</a></td><td>Improvements to <code>WebSocket</code> and <code>ServerWebSocket</code> by @Electroid</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3630">#3630</a></td><td>$npm_lifecycle_event should have the value of the last call by @TiranexDev</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3631">#3631</a></td><td>Update docs/types for process by @colinhacks</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3637">#3637</a></td><td>structured clone by @dylan-conway</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3650">#3650</a></td><td>docs: add one missing line in typescript.md by @capaj</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3643">#3643</a></td><td>Fixes #3641 by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3614">#3614</a></td><td>Support <code>napi_wrap</code> in constructors by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3645">#3645</a></td><td>Implement Workers by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3654">#3654</a></td><td>Fixes base64url encoding for crypto by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3655">#3655</a></td><td>20% faster <code>deserialize</code> for structuredClone / postMessage with objects by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3626">#3626</a></td><td>workaround <code>readable-stream</code> compatibility by @alexlamsl</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3662">#3662</a></td><td>[install] handle duplicated workspace declarations gracefully by @alexlamsl</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3664">#3664</a></td><td>package json <code>main</code> field extension order by @dylan-conway</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3596">#3596</a></td><td>[tls] General compatibility improvements by @cirospaciari</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3667">#3667</a></td><td>zig upgrade by @dylan-conway</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3671">#3671</a></td><td>fix(tls) patch checkServerIdentity by @cirospaciari</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3672">#3672</a></td><td>feature(constants) add constants/node:constants module and tests(prisma) use prima 5.0.0 + use same connection for postgres, add prisma mssql (disabled for now) by @cirospaciari</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3678">#3678</a></td><td>Better error for workspace dependency not found by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3683">#3683</a></td><td>move constants module to cpp by @cirospaciari</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3687">#3687</a></td><td>fix #3682 by @dylan-conway</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3680">#3680</a></td><td>fix createDecipheriv by @cirospaciari</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3688">#3688</a></td><td>update root certificates and add tls.rootCertificates by @cirospaciari</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3089">#3089</a></td><td>Implement <code>AsyncLocalStorage</code> by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3693">#3693</a></td><td>Fix browser bundled string_decoder by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3694">#3694</a></td><td>Fix vite by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3698">#3698</a></td><td>Fixes #3670 by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3697">#3697</a></td><td>Support streams in response.formData() &amp; request.formData, introduce Bun.readableStreamToFormData() by @Jarred-Sumner</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3706">#3706</a></td><td>Improve types for FFI number types by @colinhacks</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3707">#3707</a></td><td>fix start delay on Worker by @cirospaciari</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3709">#3709</a></td><td>set <code>_preload_modules</code> to empty array by @dylan-conway</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3708">#3708</a></td><td>fix 3702 by @dylan-conway</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3692">#3692</a></td><td>Pass constructor arguments to TextDecoder by @Parzival-3141</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3711">#3711</a></td><td>Fix builtins generator <code>$lazy</code> by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3710">#3710</a></td><td>fix directory caching with workaround by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3713">#3713</a></td><td>Fix builtins again by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3714">#3714</a></td><td>fix process.exit status code handling by @paperdave</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3715">#3715</a></td><td>fix <code>isFIFO</code> by @dylan-conway</td></tr><tr><td><a href="https://github.com/oven-sh/bun/pull/3717">#3717</a></td><td>string escape edgecase by @dylan-conway</td></tr></tbody></table></div></article></div>
  </body>
</html>
