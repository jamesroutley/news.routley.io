<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.prateekcodes.dev/ruby-34-frozen-string-literals-rails-upgrade-guide/">Original</a>
    <h1>Ruby 3.4 frozen string literals: What Rails developers need to know</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div id="article-container">

        <!-- Post Share -->
        

        <!-- Post -->
        

        <div>
                        

            <!-- Post Featured Image -->
            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div>
                <p>Ruby 3.4 takes the first step in a multi-version transition to frozen string literals by default. Your Rails app will continue working exactly as before, but Ruby now provides opt-in warnings to help you prepare. Here’s what you need to know.</p>

<h2 id="the-three-phase-transition-plan">The Three-Phase Transition Plan</h2>

<p>Ruby is implementing frozen string literals gradually over three releases:</p>

<ol>
  <li><strong>Ruby 3.4 (Now)</strong>: Opt-in warnings when you enable deprecation warnings</li>
  <li><strong>Ruby 3.7 (Future)</strong>: Warnings enabled by default</li>
  <li><strong>Ruby 4.0 (Future)</strong>: Frozen string literals become the default</li>
</ol>

<h2 id="what-actually-changes-in-ruby-34">What Actually Changes in Ruby 3.4</h2>

<p>By default, nothing changes. Your code runs exactly as before. But when you enable deprecation warnings:</p>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
</pre></td><td><pre><span># Enable warnings to see what will break in the future</span>
<span>Warning</span><span>[</span><span>:deprecated</span><span>]</span> <span>=</span> <span>true</span>

<span># Now string mutations emit warnings</span>
<span>csv_row</span> <span>=</span> <span>&#34;id,name,email&#34;</span>
<span>csv_row</span> <span>&lt;&lt;</span> <span>&#34;,created_at&#34;</span>  <span># warning: literal string will be frozen in the future</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>Important</strong>: These warnings are opt-in. You won’t see them unless you explicitly enable them.</p>

<h2 id="why-should-you-care">Why Should You Care?</h2>

<h3 id="1-performance-gains-are-real">1. Performance Gains Are Real</h3>

<p>Frozen strings enable Ruby to deduplicate identical string literals:</p>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td><pre><span># Ruby 3.3 - Each method call creates a new String object</span>
<span>def</span> <span>log_action</span><span>(</span><span>action</span><span>)</span>
  <span>prefix</span> <span>=</span> <span>&#34;[ACTION]&#34;</span>  <span># New String object every time</span>
  <span>puts</span> <span>&#34;</span><span>#{</span><span>prefix</span><span>}</span><span> </span><span>#{</span><span>action</span><span>}</span><span>&#34;</span>
<span>end</span>

<span># Ruby 3.4 with frozen strings - Same object reused</span>
<span># frozen_string_literal: true</span>
<span>def</span> <span>log_action</span><span>(</span><span>action</span><span>)</span>
  <span>prefix</span> <span>=</span> <span>&#34;[ACTION]&#34;</span>  <span># Same frozen String object ID every time</span>
  <span>puts</span> <span>&#34;</span><span>#{</span><span>prefix</span><span>}</span><span> </span><span>#{</span><span>action</span><span>}</span><span>&#34;</span>
<span>end</span>

<span># You can verify this:</span>
<span>3</span><span>.</span><span>times</span><span>.</span><span>map</span> <span>{</span> <span>&#34;[ACTION]&#34;</span><span>.</span><span>object_id</span> <span>}.</span><span>uniq</span><span>.</span><span>size</span>  <span># =&gt; 3 (different objects)</span>
<span># With frozen_string_literal: true</span>
<span>3</span><span>.</span><span>times</span><span>.</span><span>map</span> <span>{</span> <span>&#34;[ACTION]&#34;</span><span>.</span><span>object_id</span> <span>}.</span><span>uniq</span><span>.</span><span>size</span>  <span># =&gt; 1 (same object)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Performance improvements vary by application, but benchmarks have shown:</p>
<ul>
  <li>Up to 20% reduction in garbage collection for string-heavy code</li>
  <li>Memory savings from string deduplication</li>
  <li>Faster execution in hot paths that create many identical strings</li>
</ul>

<p>For more Rails performance optimization strategies, check out our guide on <a href="https://www.prateekcodes.dev/rails-performance-80-20-rule" target="_blank">finding the 20% of code causing 80% of performance problems</a>.</p>

<h3 id="2-your-gems-might-break-first">2. Your Gems Might Break First</h3>

<p>The biggest impact won’t be your code - it’ll be your dependencies:</p>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
</pre></td><td><pre><span># Some gem&#39;s code that will start warning</span>
<span>def</span> <span>format_error</span><span>(</span><span>code</span><span>,</span> <span>message</span><span>)</span>
  <span>error</span> <span>=</span> <span>&#34;ERROR </span><span>#{</span><span>code</span><span>}</span><span>: &#34;</span>
  <span>error</span><span>.</span><span>concat</span><span>(</span><span>message</span><span>)</span>  <span># warning in Ruby 3.4</span>
  <span>error</span>
<span>end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="how-chilled-strings-work">How “Chilled Strings” Work</h2>

<p>Ruby 3.4 introduces a clever mechanism called “chilled strings” for files without a <code>frozen_string_literal</code> pragma:</p>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
</pre></td><td><pre><span># Without any frozen_string_literal comment</span>
<span>str</span> <span>=</span> <span>&#34;hello&#34;</span>
<span>str</span><span>.</span><span>frozen?</span>  <span># =&gt; false (but it&#39;s actually &#34;chilled&#34;)</span>
<span>str</span> <span>&lt;&lt;</span> <span>&#34; world&#34;</span>  <span># warning: literal string will be frozen in the future</span>
                 <span># (string becomes permanently mutable after warning)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This allows Ruby to:</p>
<ul>
  <li>Warn you about future incompatibilities</li>
  <li>Keep your code working today</li>
  <li>Give you time to fix issues gradually</li>
</ul>

<h2 id="finding-issues-in-your-rails-app">Finding Issues in Your Rails App</h2>

<h3 id="step-1-enable-warnings-theyre-off-by-default">Step 1: Enable Warnings (They’re Off by Default!)</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
</pre></td><td><pre><span># config/environments/development.rb</span>
<span>Warning</span><span>[</span><span>:deprecated</span><span>]</span> <span>=</span> <span>true</span>

<span># Or run your app with:</span>
<span># RUBYOPT=&#34;-W:deprecated&#34; rails server</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-2-check-your-test-suite">Step 2: Check Your Test Suite</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
</pre></td><td><pre><span># spec/spec_helper.rb or test/test_helper.rb</span>
<span>Warning</span><span>[</span><span>:deprecated</span><span>]</span> <span>=</span> <span>true</span>

<span># Run tests to find string mutations</span>
<span># bundle exec rspec</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="step-3-use-debug-mode-for-detailed-info">Step 3: Use Debug Mode for Detailed Info</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
</pre></td><td><pre><span># Shows exactly where strings are created and mutated</span>
ruby <span>--debug</span><span>=</span>frozen-string-literal your_script.rb
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="common-patterns-to-fix">Common Patterns to Fix</h2>

<h3 id="1-string-building">1. String Building</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td><pre><span># Before - will warn</span>
<span>def</span> <span>build_url</span><span>(</span><span>domain</span><span>,</span> <span>path</span><span>,</span> <span>params</span><span>)</span>
  <span>url</span> <span>=</span> <span>&#34;https://&#34;</span>
  <span>url</span> <span>&lt;&lt;</span> <span>domain</span>
  <span>url</span> <span>&lt;&lt;</span> <span>path</span>
  <span>url</span> <span>&lt;&lt;</span> <span>&#34;?&#34;</span> <span>&lt;&lt;</span> <span>params</span>
  <span>url</span>
<span>end</span>

<span># After - no warning</span>
<span>def</span> <span>build_url</span><span>(</span><span>domain</span><span>,</span> <span>path</span><span>,</span> <span>params</span><span>)</span>
  <span>url</span> <span>=</span> <span>+</span><span>&#34;https://&#34;</span>  <span># + prefix returns mutable string</span>
  <span>url</span> <span>&lt;&lt;</span> <span>domain</span>
  <span>url</span> <span>&lt;&lt;</span> <span>path</span>
  <span>url</span> <span>&lt;&lt;</span> <span>&#34;?&#34;</span> <span>&lt;&lt;</span> <span>params</span>
  <span>url</span>
<span>end</span>

<span># The +str syntax returns a mutable copy if frozen, or self if already mutable</span>
<span># See: https://docs.ruby-lang.org/en/3.4/String.html#+@-method</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="2-in-place-modifications">2. In-Place Modifications</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td><pre><span># Before - will warn</span>
<span>def</span> <span>sanitize_filename</span><span>(</span><span>filename</span><span>)</span>
  <span>filename</span><span>.</span><span>gsub!</span><span>(</span><span>/[^0-9A-Za-z.\-]/</span><span>,</span> <span>&#39;_&#39;</span><span>)</span>
  <span>filename</span><span>.</span><span>squeeze!</span><span>(</span><span>&#39;_&#39;</span><span>)</span>
  <span>filename</span>
<span>end</span>

<span># After - no warning</span>
<span>def</span> <span>sanitize_filename</span><span>(</span><span>filename</span><span>)</span>
  <span>filename</span><span>.</span><span>gsub</span><span>(</span><span>/[^0-9A-Za-z.\-]/</span><span>,</span> <span>&#39;_&#39;</span><span>).</span><span>squeeze</span><span>(</span><span>&#39;_&#39;</span><span>)</span>
<span>end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="3-string-interpolation-is-safe">3. String Interpolation Is Safe</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
</pre></td><td><pre><span># This is fine - interpolation creates new strings</span>
<span>controller</span> <span>=</span> <span>&#34;users&#34;</span>
<span>action</span> <span>=</span> <span>&#34;index&#34;</span>
<span>route</span> <span>=</span> <span>&#34;/</span><span>#{</span><span>controller</span><span>}</span><span>/</span><span>#{</span><span>action</span><span>}</span><span>&#34;</span>  <span># No warning</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="migration-strategy">Migration Strategy</h2>

<h3 id="for-new-code">For New Code</h3>

<p>The Ruby team is moving away from magic comments. For new code, write code that naturally works with frozen strings by treating all strings as immutable. See the <a href="#common-patterns-to-fix">Common Patterns to Fix</a> section for techniques that work well with frozen strings.</p>

<h3 id="for-existing-rails-apps">For Existing Rails Apps</h3>

<ol>
  <li><strong>Don’t rush to remove magic comments</strong> - Files with the comment keep their current behavior</li>
  <li><strong>Fix warnings gradually</strong> - Use CI to track new warnings</li>
  <li><strong>Update gems first</strong> - Check for updates that fix string mutation warnings</li>
</ol>

<h3 id="for-cicd">For CI/CD</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
</pre></td><td><pre><span># .github/workflows/ruby.yml</span>
<span>-</span> <span>name</span><span>:</span> <span>Run tests with deprecation warnings</span>
  <span>run</span><span>:</span> <span>|</span>
    <span>RUBYOPT=&#34;-W:deprecated&#34; bundle exec rspec</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="can-you-safely-upgrade-to-ruby-34">Can You Safely Upgrade to Ruby 3.4?</h2>

<p>Yes. Here’s why the transition is developer-friendly:</p>

<ol>
  <li><strong>Nothing breaks by default</strong> - Your app runs exactly as before</li>
  <li><strong>Warnings are opt-in</strong> - You control when to see them</li>
  <li><strong>Gradual transition</strong> - Years to prepare before Ruby 4.0</li>
  <li><strong>Clear escape hatches</strong> - Multiple ways to maintain current behavior</li>
</ol>

<h3 id="timeline-for-action">Timeline for Action</h3>

<ul>
  <li><strong>Now (Ruby 3.4)</strong>: Upgrade and run normally, enable warnings in development</li>
  <li><strong>Before Ruby 3.7</strong>: Fix warnings at your own pace</li>
  <li><strong>Ruby 3.7</strong>: Warnings become default, most issues should be fixed</li>
  <li><strong>Ruby 4.0</strong>: Frozen strings become default</li>
</ul>

<h3 id="if-you-need-more-time">If You Need More Time</h3>

<div><div><pre><code><table><tbody><tr><td><pre>1
2
3
4
5
</pre></td><td><pre><span># Disable warnings for entire app</span>
<span>RUBYOPT</span><span>=</span><span>&#34;--disable-frozen-string-literal&#34;</span> rails server

<span># Or add to specific files that need work</span>
<span># frozen_string_literal: false</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>Ruby 3.4’s opt-in warnings are the first step in a thoughtful, multi-version transition. Enable them when you’re ready, fix issues at your own pace, and prepare for better performance in Ruby 4.0.</p>

<p><strong>References:</strong></p>
<ul>
  <li><a href="https://www.ruby-lang.org/en/news/2024/12/25/ruby-3-4-0-released/" target="_blank" rel="noopener noreferrer">Ruby 3.4.0 Release Notes</a></li>
  <li><a href="https://bugs.ruby-lang.org/issues/20205" target="_blank" rel="noopener noreferrer">Feature #20205: Enable frozen_string_literal by default</a></li>
  <li><a href="https://gist.github.com/fxn/bf4eed2505c76f4fca03ab48c43adc72" target="_blank" rel="noopener noreferrer">The Future of Frozen String Literals</a></li>
</ul>

            </div>

            <!-- Mobile Share Section -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span><time datetime="2025-07-05">05 Jul 2025</time></span>
                
                </small>
            </p>

            <!-- Post Categories -->
            
            <!-- End Categories -->

            <!-- Author Box -->
            
            <div>
                <p><img src="https://www.prateekcodes.dev/assets/images/prateek-avatar.avif" alt="Prateek Choudhary"/>
                    
                </p>
                
            </div>
            
            <!-- End Author Box -->

            <!-- Post Tags -->
            
            <!-- End Tags -->

            <!-- Related Posts -->
            







  
    
    
    
    
      
      
    
  

  
    
    
    
    
      
      
    
  

  
    
    
    
    
      
      
    
  

  
    
    
    
    
      
      
        








            <!-- End Related Posts -->

            <!-- Newsletter Signup -->
            
            <!-- Minimal Newsletter CTA -->
<div id="newsletter-section">
    <div>
        <div>
            <div>
                <h2>Stay up to date with our blogs.</h2>
                <p>Subscribe to receive updates on Ruby, Rails, and building scalable backend systems.</p>

                
                <!-- Substack Signup Form -->
                
                
            </div>
        </div>
    </div>
</div>
            
            <!-- End Newsletter -->

        </div>
        <!-- End Post -->

    </div>
</div></div>
  </body>
</html>
