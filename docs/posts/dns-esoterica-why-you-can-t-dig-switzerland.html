<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://shkspr.mobi/blog/2022/07/dns-esoterica-why-you-cant-dig-switzerland/">Original</a>
    <h1>DNS Esoterica – Why you can&#39;t dig Switzerland</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="https://schema.org/articleBody">
<p>As part of my new job, I&#39;m learning a lot more about the mysteries of the Domain Name System than <del>any mortal should know</del> I thought possible.</p><p>The humble unix <code>dig</code> command allows you to query all sort of DNS information. For example, to see name server records for the BBC website, you can run:</p><p><code>dig bbc.co.uk NS</code></p><p>Which will get you:</p><pre><code>;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35614
;; flags: qr rd ra; QUERY: 1, ANSWER: 8, AUTHORITY: 0, ADDITIONAL: 17

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 097db2ee4c92b84982083ecf62b5b5f2007906e616035113 (good)
;; QUESTION SECTION:
;bbc.co.uk.         IN  NS

;; ANSWER SECTION:
bbc.co.uk.      900 IN  NS  ddns1.bbc.com.
bbc.co.uk.      900 IN  NS  dns0.bbc.co.uk.
bbc.co.uk.      900 IN  NS  ddns1.bbc.co.uk.
...
</code></pre><p>And a whole lot more.  But you can go further down the DNS tree. What are the nameservers for <code>.co.uk</code>?</p><p><code>dig co.uk NS</code></p><p>And you&#39;ll get your answer.  You can go one further and see the nameservers for the Top Level Domain:</p><p><code>dig uk NS</code></p><p>Which replies with:</p><pre><code>;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 54061
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 8, AUTHORITY: 0, ADDITIONAL: 17

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 880427eda8ff71de2ab4f43862b5b65f95e317d29cc10a8e (good)
;; QUESTION SECTION:
;uk.                IN  NS

;; ANSWER SECTION:
uk.         159692  IN  NS  nsc.nic.uk.
uk.         159692  IN  NS  dns1.nic.uk.
uk.         159692  IN  NS  nsd.nic.uk.
...
</code></pre><p>And that works with <em>every</em> TLD. Countries like <code>de</code>, generic names like <code>museum</code>, and internationalised domains like <code>在线</code>. All of them work!</p><p>Except Switzerland.</p><p>Switzerland&#39;s country code is <code>ch</code> - after the name <i lang="la">Confoederatio Helvetica</i>. Let&#39;s run the <code>dig</code> on it: <code>dig ch NS</code></p><pre><code>;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: REFUSED, id: 31910
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1
;; WARNING: recursion requested but not available
</code></pre><p>We have been <strong>refused</strong> and <strong>warned</strong>.  But why does this only happen with Switzerland?</p><p>The blame - as with most modern ills - lies in the mid-1970s. The Bee Gees were storming the charts with &#34;Jive Talkin&#39;&#34;, the Rocky Horror Picture Show was gathering a cult following, and MIT scientists were causing chaos.  Literally.</p><p><a href="https://en.wikipedia.org/wiki/Chaosnet">Chaosnet</a> was an early network protocol designed for local networks.  It was technically very clever but, sadly, never really took off.</p><p>However, it found its way into DNS records. Let&#39;s go back to the answer to <code>dig bbc.co.uk NS</code>:</p><pre><code>;; ANSWER SECTION:
bbc.co.uk.      900 IN  NS  ddns1.bbc.com.
</code></pre><p>OK, the first part is the domain name. The number is the TTL. The <code>IN</code> is the class. The NS says this is a nameserver record. And, finally, we get the domain of the nameserver.</p><p>But, in the class, what does <code>IN</code> stand for?</p><p>&#34;<strong>Internet</strong>&#34;, obviously. Wait... Isn&#39;t the DNS on the Internet? Why do we need to specify that these DNS records are for Internet?</p><p>Well, isn&#39;t it obvious? Because you might want records of a <em>different</em> network. Like, for example, Chaosnet.</p><p>And if Internet is abbreviated to <code>IN</code>, what is Chaosnet shortened to? That&#39;s right! <code>CH</code>.</p><p>So, <code>dig</code> sees you enter <code>ch</code> for Switzerland, but thinks you&#39;re asking about <code>CH</code> for Chaosnet. And so it fails.</p><p>In order to query the records for <code>ch</code> we need to provide an absolutely fully-qualified domain name. It&#39;s as simple as sticking a dot at the end of the domain name:</p><p><code>dig ch. NS</code></p><pre><code>;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 64932
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 11

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: e19b9c23cdfa0f7bcf82750462b5c16b47744386c7974ffb (good)
;; QUESTION SECTION:
;ch.                IN  NS

;; ANSWER SECTION:
ch.         164894  IN  NS  e.nic.ch.
ch.         164894  IN  NS  a.nic.ch.
ch.         164894  IN  NS  f.nic.ch.
</code></pre><p>And there we go. A failed 1970s experiment like bell-bottoms and Betamax videos - but with much longer lasting consequences.</p><p>You can see some <code>CH</code> records by running like:</p><p><code>dig ch txt @f.root-servers.net version.bind</code></p><p>That will get you something like:</p><pre><code>;; ANSWER SECTION:
version.bind.       86400   CH  TXT &#34;cloudflare-f-root-20190930&#34;
</code></pre><p>Of course, DNS doesn&#39;t <em>only</em> have <code>IN</code> and <code>CH</code> class records.</p><p>There&#39;s also <a href="https://en.wikipedia.org/wiki/Hesiod_(name_service)">Hesiod</a> - <code>HS</code>. But you already knew that, right...?</p></div></div>
  </body>
</html>
