<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kevin.burke.dev/kevin/reddits-database-has-two-tables/">Original</a>
    <h1>Reddit’s database has two tables (2012)</h1>
    
    <div id="readability-page-1" class="page"><div>
			<p>Steve Huffman talks about <a href="http://highscalability.com/blog/2010/5/17/7-lessons-learned-while-building-reddit-to-270-million-page.html" title="Reddit&#39;s architecture - High Scalability">Reddit’s approach to data storage</a> in a High Scalability post from 2010. I was surprised to learn that they only have two tables in their database.</p>
<blockquote><p><strong>Lesson: Don’t worry about the schema.</strong></p>
<p>[Reddit] used to spend a lot of time worrying about the database, keeping everthing nice and normalized. You shouldn’t have to worry about the database. Schema updates are very slow when you get bigger. Adding a column to 10 million rows takes locks and doesn’t work. They used replication for backup and for scaling. Schema updates and maintaining replication is a pain. They would have to restart replication and could go a day without backups. Deployments are a pain because you have to orchestrate how new software and new database upgrades happen together.</p>
<p>Instead, they keep a Thing Table and a Data Table. Everything in Reddit is a Thing: users, links, comments, subreddits, awards, etc. Things keep common attribute like up/down votes, a type, and creation date. The Data table has three columns: thing id, key, value. There’s a row for every attribute. There’s a row for title, url, author, spam votes, etc. When they add new features they didn’t have to worry about the database anymore. They didn’t have to add new tables for new things or worry about upgrades. Easier for development, deployment, maintenance.  </p>
<p>The price is you can’t use cool relational features. There are no joins in the database and you must manually enforce consistency. No joins means it’s really easy to distribute data to different machines. You don’t have to worry about foreign keys are doing joins or how to split the data up. Worked out really well. Worries of using a relational database are a thing of the past.</p></blockquote>
<p>This fits with a piece I read the other day about how MongoDB has high adoption for small projects because it lets you just start storing things, without worrying about what the schema or indexes need to be. Reddit’s approach lets them easily add more data to existing objects, without the pain of schema updates or database pivots. Of course, your mileage is going to vary, and you should think closely about your data model and what relationships you need.</p>
<p><b>Update, 10:05AM PDT:</b> It’s worth reading <a href="http://www.reddit.com/user/kemitche">the comments from a current Reddit engineer</a> on this post. Particularly <a title="Reddit engineer comment on using RDBMS as a key/value store" href="http://www.reddit.com/r/programming/comments/z9sm8/reddits_database_has_only_two_tables/c62uq3a?context=3">this one</a>: </p>
<blockquote><p>
I’m personally not a fan of using an RDBMS as a key-value store – but take a look at, say, line 60 of the accounts code. Each item in that _defaults dictionary corresponds to an attribute on an account. For pretty much all of those (1) we don’t need to join on it and (2) we don’t want to do database maintenance just to add a new preference toggle. Those points are particularly more important when you’ve got a staff of 2-3 engineers. Sure, reddit has more now – but we’ve also now got a lot of data to migrate if we wanted to change, a lot of code to rewrite, and a lot of more important problems.
</p></blockquote>
<p>The data architecture made sense for Reddit as a small company that had to optimize for engineering man hours. Now they are much bigger and can afford a saner structure. He/she mentions that they are <a href="http://www.reddit.com/r/programming/comments/z9sm8/reddits_database_has_only_two_tables/c62u7gw?context=3">in the process of migrating their Postgres data over to Cassandra</a>, but slowly.</p>
<p><b>Update, 11:31PM PDT:</b> A former engineer at reddit adds this comment.</p>
<blockquote><p>There isn’t a “table” for a subreddit. There is a thing/data pair that stores metadata about a subreddit, and there is a thing/data pair for storing links. One of the properties of a link is the subreddit that it is in. Same with the comments. There is one thing/data pair for comments and the subreddit it is in is a property.</p>
<p>Still today I tell people that even if you want to do key/value, postgres is faster than any NoSQL product currently available for doing key/value.</p></blockquote>
<p><b>Update, 7:11PM PDT:</b> From <a href="http://news.ycombinator.com/item?id=4468265">Hacker News</a>, it looks like they use two tables for each “thing”, so a thing/data pair for accounts, a thing/data pair for links, etc. </p>
						<p><b>Liked what you read?</b> I am <a href="https://burke.services">available for hire.</a></p>
		</div></div>
  </body>
</html>
