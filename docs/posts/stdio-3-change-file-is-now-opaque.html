<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://undeadly.org/cgi?action=article;sid=20250717103345">Original</a>
    <h1>Stdio(3) change: FILE is now opaque</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Contributed by
<a href="https://www.openbsdfoundation.org/donations.html">rueda</a>
on <time datetime="2025-07-17T05:56:12Z">2025-07-17</time>
from the more-opacity,-igor dept.</p>
<p>In <code>-current</code>,
the <code>struct</code> underlying
<a href="https://man.openbsd.org/stdio.3"><code>stdio(3)</code></a>&#39;s
<code>FILE</code> type
has been
<a href="https://marc.info/?l=openbsd-cvs&amp;m=175267994001677&amp;w=2">made opaque</a>, with library versions bumps across the board:</p>

<blockquote>
<pre>CVSROOT:	/cvs
Module name:	src
Changes by:	yasuoka@cvs.openbsd.org	2025/07/16 09:33:05

Modified files:
	lib/libc       : Symbols.list shlib_version 
	lib/libc/hidden: stdio.h wchar.h 
	lib/libc/stdio : Makefile.inc fclose.3 fclose.c findfp.c 
	lib/libcrypto  : shlib_version 
	lib/libcurses  : shlib_version 
	lib/libedit    : shlib_version 
	lib/libexpat   : shlib_version 
	lib/libfido2   : shlib_version 
	lib/libfuse    : shlib_version 
</pre>
</blockquote>

<blockquote>
<pre>	lib/libkvm     : shlib_version 
	lib/libpcap    : shlib_version 
	lib/librthread : shlib_version 
	lib/libskey    : shlib_version 
	lib/libsndio   : shlib_version 
	lib/libutil    : shlib_version 
	include        : stdio.h wchar.h 
	gnu/lib/libcxx : shlib_version 
	gnu/lib/libcxxabi: shlib_version 
	gnu/lib/libexecinfo: shlib_version 
	gnu/lib/libiberty: shlib_version 
	gnu/lib/libreadline: shlib_version 
	gnu/lib/libstdc++: shlib_version 
	gnu/lib/libstdc++-v3: shlib_version 
	gnu/usr.bin/perl: shlib_version 
Added files:
	lib/libc/hidden: _stdio.h 
	lib/libc/stdio : fdclose.c 

Log message:
Make the FILE object opaque.  Move the __sFILE definition into
libc/hidden/_stdio.h.  All programs that refer to the internal
structure of the FILE object can&#39;t be compiled from now on.
std{in,out,err} doesn&#39;t refer __sF[] now, but the hidden __sF along
with __srget and __swbuf symbols are kept temporarily to make our
transition easier.  But those symbols will be deleted soon.  The shared
library versions are bumped for libc and all the other libraries that
refer to std{in,out,err}.

diff from guenther, tweak by me, tested by many
ok sthen tb
</pre>
</blockquote>

<p>Make no mistake, this is a <strong>major</strong> change, which touches a lot of components across the base system. The fallout can be seen in a lot of places, including <em>libcrypto</em> (which is itself subject to a major, sepearate cleanup), <em>libtls</em>, <em>libssl</em>, and includes touches to the <em>profiling subsystem</em> we <a href="https://undeadly.org/cgi?action=article;sid=20250525104147">mentioned earlier</a>.</p>

<p>Those who normally build from source are
<a href="https://www.openbsd.org/faq/current.html#r20250716"><strong>strongly</strong> encouraged</a>
to use a snapshot upgrade
to cross the bumps.</p>

</div></div>
  </body>
</html>
