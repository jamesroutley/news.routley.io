<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.lorenstew.art/blog/bookmarkable-by-design-url-state-htmx/">Original</a>
    <h1>Htmx and URL State Management</h1>
    
    <div id="readability-page-1" class="page"><div data-astro-cid-dmqsi53g=""> <div data-astro-cid-dmqsi53g="">  <div data-astro-cid-dmqsi53g="">  <article data-astro-cid-7jjqptxk="">  <div data-astro-cid-7jjqptxk=""> 
<p>When you move from React to HTMX, you trade complex state management for server-side simplicity. But you still need to handle filters, sorting, pagination, and search. Where does that state live now?</p>
<p>The answer is surprisingly elegant: in the URL itself. By treating URL parameters as your single source of truth, you get bookmarkable, shareable application state without needing to install another dependency.</p>
<h2 id="the-pattern-in-action">The Pattern in Action</h2>
<p>A URL like <code>/?status=active&amp;sortField=price&amp;sortDir=desc&amp;page=2</code> tells you everything about the current view. It’s not just an address: it’s a complete state representation that users can bookmark, share, or refresh without losing context.</p>
<h2 id="quick-start-three-essential-steps">Quick Start: Three Essential Steps</h2>
<p>The entire pattern revolves around three synchronized steps:</p>
<ol>
<li><strong>Server reads URL parameters</strong> and renders the appropriate view</li>
<li><strong>Forms and hx-include preserve all state</strong> when making HTMX requests</li>
<li><strong>Browser URL updates automatically</strong> with hx-push-url</li>
</ol>
<p>Let’s build this step by step.</p>
<h2 id="step-1-server-reads-url-state">Step 1: Server Reads URL State</h2>
<p>Your server endpoint reads query parameters and uses them to render the initial view:</p>
<pre tabindex="0" data-language="typescript"><code><span><span>@</span><span>Get</span><span>(</span><span>&#34;/&#34;</span><span>)</span></span>
<span><span>@</span><span>Render</span><span>(</span><span>&#34;data-table.eta&#34;</span><span>)</span></span>
<span><span>async </span><span>homepage</span><span>(</span></span>
<span><span>  @</span><span>Query</span><span>(</span><span>&#34;sortField&#34;</span><span>) sortField: string,</span></span>
<span><span>  @</span><span>Query</span><span>(</span><span>&#34;sortDir&#34;</span><span>) sortDir: </span><span>&#34;asc&#34;</span><span> |</span><span> &#34;desc&#34;</span><span>,</span></span>
<span><span>  @</span><span>Query</span><span>(</span><span>&#34;status&#34;</span><span>) status: string,</span></span>
<span><span>  @</span><span>Query</span><span>(</span><span>&#34;page&#34;</span><span>) page: string,</span></span>
<span><span>) {</span></span>
<span><span>  // Parse with defaults</span></span>
<span><span>  const</span><span> pageNum</span><span> =</span><span> parseInt</span><span>(page) </span><span>||</span><span> 1</span><span>;</span></span>
<span><span>  </span></span>
<span><span>  // Apply state to data query</span></span>
<span><span>  const</span><span> result</span><span> =</span><span> await</span><span> this</span><span>.dataService.</span><span>getItems</span><span>({</span></span>
<span><span>    sortField: sortField </span><span>||</span><span> &#34;name&#34;</span><span>,</span></span>
<span><span>    sortDir: sortDir </span><span>||</span><span> &#34;asc&#34;</span><span>,</span></span>
<span><span>    status: status </span><span>||</span><span> &#34;&#34;</span><span>,</span></span>
<span><span>    page: pageNum,</span></span>
<span><span>  });</span></span>
<span></span>
<span><span>  // Return both data and state for template</span></span>
<span><span>  return</span><span> {</span></span>
<span><span>    items: result.items,</span></span>
<span><span>    totalItems: result.total,</span></span>
<span><span>    sortField: sortField </span><span>||</span><span> &#34;name&#34;</span><span>,</span></span>
<span><span>    sortDir: sortDir </span><span>||</span><span> &#34;asc&#34;</span><span>,</span></span>
<span><span>    status: status </span><span>||</span><span> &#34;&#34;</span><span>,</span></span>
<span><span>    page: pageNum,</span></span>
<span><span>  };</span></span>
<span><span>}</span></span></code></pre>
<p>The template embeds this state directly in the DOM (using <a href="https://eta.js.org/">ETA templates</a> in this case):</p>
<pre tabindex="0" data-language="html"><code><span><span>&lt;</span><span>div</span><span> id</span><span>=</span><span>&#34;data-table&#34;</span><span>&gt;</span></span>
<span><span>  &lt;!-- Filter form with all state --&gt;</span></span>
<span><span>  &lt;</span><span>form</span><span> hx-get</span><span>=</span><span>&#34;/api/data&#34;</span></span>
<span><span>        hx-target</span><span>=</span><span>&#34;#data-table&#34;</span></span>
<span><span>        hx-push-url</span><span>=</span><span>&#34;true&#34;</span></span>
<span><span>        hx-params</span><span>=</span><span>&#34;*&#34;</span></span>
<span><span>        hx-trigger</span><span>=</span><span>&#34;change&#34;</span><span>&gt;</span></span>
<span><span>    </span></span>
<span><span>    &lt;!-- Status filter --&gt;</span></span>
<span><span>    &lt;</span><span>select</span><span> name</span><span>=</span><span>&#34;status&#34;</span><span>&gt;</span></span>
<span><span>      &lt;</span><span>option</span><span> value</span><span>=</span><span>&#34;&#34;</span><span> &lt;%=</span><span> it.status</span><span> =</span><span>==</span><span> &#39;&#39;</span><span> ?</span><span> &#39;selected&#39;</span><span> :</span><span> &#39;&#39;</span><span> %</span><span>&gt;&gt;All&lt;/</span><span>option</span><span>&gt;</span></span>
<span><span>      &lt;</span><span>option</span><span> value</span><span>=</span><span>&#34;active&#34;</span><span> &lt;%=</span><span> it.status</span><span> =</span><span>==</span><span> &#39;active&#39;</span><span> ?</span><span> &#39;selected&#39;</span><span> :</span><span> &#39;&#39;</span><span> %</span><span>&gt;&gt;Active&lt;/</span><span>option</span><span>&gt;</span></span>
<span><span>    &lt;/</span><span>select</span><span>&gt;</span></span>
<span><span>    </span></span>
<span><span>    &lt;!-- Hidden state fields --&gt;</span></span>
<span><span>    &lt;</span><span>input</span><span> type</span><span>=</span><span>&#34;hidden&#34;</span><span> name</span><span>=</span><span>&#34;sortField&#34;</span><span> value</span><span>=</span><span>&#34;</span><span>&lt;</span><span>%= it.sortField %&gt;&#34;</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>input</span><span> type</span><span>=</span><span>&#34;hidden&#34;</span><span> name</span><span>=</span><span>&#34;sortDir&#34;</span><span> value</span><span>=</span><span>&#34;</span><span>&lt;</span><span>%= it.sortDir %&gt;&#34;</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>input</span><span> type</span><span>=</span><span>&#34;hidden&#34;</span><span> name</span><span>=</span><span>&#34;page&#34;</span><span> value</span><span>=</span><span>&#34;</span><span>&lt;</span><span>%= it.page %&gt;&#34;</span><span>&gt;</span></span>
<span><span>  &lt;/</span><span>form</span><span>&gt;</span></span>
<span></span>
<span><span>  &lt;!-- Sortable columns --&gt;</span></span>
<span><span>  &lt;</span><span>th</span><span> class</span><span>=</span><span>&#34;sortable </span><span>&lt;</span><span>%= it.sortField === &#39;name&#39; ? &#39;sorted&#39; : &#39;&#39; %&gt;&#34;</span></span>
<span><span>      hx-get</span><span>=</span><span>&#34;/api/data&#34;</span></span>
<span><span>      hx-target</span><span>=</span><span>&#34;#data-table&#34;</span></span>
<span><span>      hx-push-url</span><span>=</span><span>&#34;true&#34;</span></span>
<span><span>      hx-params</span><span>=</span><span>&#34;*&#34;</span></span>
<span><span>      hx-include</span><span>=</span><span>&#34;[name=&#39;status&#39;]&#34;</span></span>
<span><span>      hx-vals</span><span>=</span><span>&#34;{sortField: &#39;name&#39;, sortDir: &#39;</span><span>&lt;</span><span>%= it.sortField === &#39;name&#39; &amp;&amp; it.sortDir === &#39;asc&#39; ? &#39;desc&#39; : &#39;asc&#39; %&gt;&#39;, page: 1}&#34;</span><span>&gt;</span></span>
<span><span>    Name</span></span>
<span><span>    &lt;</span><span>% if (it.sortField === &#39;name&#39;) { %&gt;</span></span>
<span><span>      &lt;</span><span>%= it.sortDir === &#39;asc&#39; ? &#39;↑&#39; : &#39;↓&#39; %&gt;</span></span>
<span><span>    &lt;</span><span>% } %&gt;</span></span>
<span><span>  &lt;/</span><span>th</span><span>&gt;</span></span>
<span><span>  </span></span>
<span><span>  &lt;</span><span>th</span><span> class</span><span>=</span><span>&#34;sortable </span><span>&lt;</span><span>%= it.sortField === &#39;price&#39; ? &#39;sorted&#39; : &#39;&#39; %&gt;&#34;</span></span>
<span><span>      hx-get</span><span>=</span><span>&#34;/api/data&#34;</span></span>
<span><span>      hx-target</span><span>=</span><span>&#34;#data-table&#34;</span></span>
<span><span>      hx-push-url</span><span>=</span><span>&#34;true&#34;</span></span>
<span><span>      hx-params</span><span>=</span><span>&#34;*&#34;</span></span>
<span><span>      hx-include</span><span>=</span><span>&#34;[name=&#39;status&#39;]&#34;</span></span>
<span><span>      hx-vals</span><span>=</span><span>&#34;{sortField: &#39;price&#39;, sortDir: &#39;</span><span>&lt;</span><span>%= it.sortField === &#39;price&#39; &amp;&amp; it.sortDir === &#39;asc&#39; ? &#39;desc&#39; : &#39;asc&#39; %&gt;&#39;, page: 1}&#34;</span><span>&gt;</span></span>
<span><span>    Price</span></span>
<span><span>    &lt;</span><span>% if (it.sortField === &#39;price&#39;) { %&gt;</span></span>
<span><span>      &lt;</span><span>%= it.sortDir === &#39;asc&#39; ? &#39;↑&#39; : &#39;↓&#39; %&gt;</span></span>
<span><span>    &lt;</span><span>% } %&gt;</span></span>
<span><span>  &lt;/</span><span>th</span><span>&gt;</span></span>
<span><span>&lt;/</span><span>div</span><span>&gt;</span></span></code></pre>
<p>Key insights:</p>
<ul>
<li>State flows from URL → Server → DOM</li>
<li>Hidden form fields preserve state across different interactions</li>
<li>CSS classes reflect current state (e.g., <code>sorted</code> class on the active sort column)</li>
<li>Server-side rendering means the page works before any JavaScript loads</li>
</ul>

<p>Instead of complex JavaScript, we use HTML forms to coordinate state:</p>
<pre tabindex="0" data-language="html"><code><span><span>&lt;!-- Form captures all filter state --&gt;</span></span>
<span><span>&lt;</span><span>form</span><span> hx-get</span><span>=</span><span>&#34;/api/data&#34;</span></span>
<span><span>      hx-target</span><span>=</span><span>&#34;#data-table&#34;</span></span>
<span><span>      hx-push-url</span><span>=</span><span>&#34;true&#34;</span></span>
<span><span>      hx-params</span><span>=</span><span>&#34;*&#34;</span></span>
<span><span>      hx-trigger</span><span>=</span><span>&#34;change&#34;</span><span>&gt;</span></span>
<span><span>  </span></span>
<span><span>  &lt;</span><span>select</span><span> name</span><span>=</span><span>&#34;status&#34;</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>option</span><span> value</span><span>=</span><span>&#34;&#34;</span><span>&gt;All&lt;/</span><span>option</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>option</span><span> value</span><span>=</span><span>&#34;active&#34;</span><span>&gt;Active&lt;/</span><span>option</span><span>&gt;</span></span>
<span><span>  &lt;/</span><span>select</span><span>&gt;</span></span>
<span><span>  </span></span>
<span><span>  &lt;!-- Preserve other state as hidden fields --&gt;</span></span>
<span><span>  &lt;</span><span>input</span><span> type</span><span>=</span><span>&#34;hidden&#34;</span><span> name</span><span>=</span><span>&#34;sortField&#34;</span><span> value</span><span>=</span><span>&#34;</span><span>&lt;</span><span>%= it.sortField %&gt;&#34;</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>input</span><span> type</span><span>=</span><span>&#34;hidden&#34;</span><span> name</span><span>=</span><span>&#34;sortDir&#34;</span><span> value</span><span>=</span><span>&#34;</span><span>&lt;</span><span>%= it.sortDir %&gt;&#34;</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>input</span><span> type</span><span>=</span><span>&#34;hidden&#34;</span><span> name</span><span>=</span><span>&#34;page&#34;</span><span> value</span><span>=</span><span>&#34;</span><span>&lt;</span><span>%= it.page %&gt;&#34;</span><span>&gt;</span></span>
<span><span>&lt;/</span><span>form</span><span>&gt;</span></span>
<span></span>
<span><span>&lt;!-- Each sortable column uses templating for dynamic values --&gt;</span></span>
<span><span>&lt;</span><span>th</span><span> class</span><span>=</span><span>&#34;sortable </span><span>&lt;</span><span>%= it.sortField === &#39;date&#39; ? &#39;sorted&#39; : &#39;&#39; %&gt;&#34;</span></span>
<span><span>    hx-get</span><span>=</span><span>&#34;/api/data&#34;</span></span>
<span><span>    hx-target</span><span>=</span><span>&#34;#data-table&#34;</span></span>
<span><span>    hx-push-url</span><span>=</span><span>&#34;true&#34;</span></span>
<span><span>    hx-params</span><span>=</span><span>&#34;*&#34;</span></span>
<span><span>    hx-include</span><span>=</span><span>&#34;[name=&#39;status&#39;]&#34;</span></span>
<span><span>    hx-vals</span><span>=</span><span>&#34;{sortField: &#39;date&#39;, sortDir: &#39;</span><span>&lt;</span><span>%= it.sortField === &#39;date&#39; &amp;&amp; it.sortDir === &#39;asc&#39; ? &#39;desc&#39; : &#39;asc&#39; %&gt;&#39;, page: 1}&#34;</span><span>&gt;</span></span>
<span><span>  Date</span></span>
<span><span>  &lt;</span><span>% if (it.sortField === &#39;date&#39;) { %&gt;</span></span>
<span><span>    &lt;</span><span>%= it.sortDir === &#39;asc&#39; ? &#39;↑&#39; : &#39;↓&#39; %&gt;</span></span>
<span><span>  &lt;</span><span>% } %&gt;</span></span>
<span><span>&lt;/</span><span>th</span><span>&gt;</span></span></code></pre>
<p>Key benefits of this approach:</p>
<ul>
<li>HTMX automatically preserves all form state in the URL</li>
<li>No JavaScript needed for state coordination</li>
<li>Sort direction toggling handled in the template logic using conditional expressions</li>
<li>Filters are preserved when sorting, sorting resets pagination</li>
<li>Each sortable column uses templating to dynamically set sortField and toggle sortDir</li>
</ul>
<h2 id="step-3-automatic-url-syncing-with-hx-push-url">Step 3: Automatic URL Syncing with hx-push-url</h2>
<p>With <code>hx-push-url=&#34;true&#34;</code> and <code>hx-params=&#34;*&#34;</code>, HTMX automatically handles URL updates:</p>
<pre tabindex="0" data-language="html"><code><span><span>&lt;!-- All form data becomes URL parameters --&gt;</span></span>
<span><span>&lt;</span><span>form</span><span> hx-get</span><span>=</span><span>&#34;/api/data&#34;</span></span>
<span><span>      hx-target</span><span>=</span><span>&#34;#data-table&#34;</span></span>
<span><span>      hx-push-url</span><span>=</span><span>&#34;true&#34;</span></span>
<span><span>      hx-params</span><span>=</span><span>&#34;*&#34;</span><span>&gt;</span></span></code></pre>
<p>HTMX automatically:</p>
<ol>
<li>Sends all form data as query parameters to the server</li>
<li>Updates the browser URL with those same parameters</li>
<li>Creates proper history entries for back/forward navigation</li>
</ol>
<p>No JavaScript required for URL management because HTMX handles everything declaratively.</p>
<h2 id="production-considerations">Production Considerations</h2>
<p><strong>URL Length Limits</strong>: Browsers support URLs up to ~2000 characters. For complex filters, consider using abbreviated parameter names or moving some state server-side.</p>
<p><strong>Parameter Validation</strong>: Always validate and sanitize URL parameters on the server. Treat them as untrusted user input.</p>
<p><strong>Testing</strong>: The pattern is highly testable since state is explicit in the URL and form values; no complex JavaScript functions to mock.</p>
<h2 id="the-architecture-payoff">The Architecture Payoff</h2>
<p>This URL-first approach delivers multiple benefits without the complexity of client-side state management libraries. Every view is inherently shareable, so you can send a colleague a link and they see will exactly what you see. The browser’s back button works as expected by returning to previous filter states. SEO is built in since search engines can crawl every state combination. And the debugging experience is transparent because the current state is always visible in the address bar.</p>
<p>By embracing the URL as your state store, you’re not working around the web platform; you’re working with it. This pattern scales from simple sorting to complex multi-filter interfaces while maintaining the simplicity that drew you to HTMX in the first place.</p>
<p>The next time you reach for a state management library, consider whether the humble URL might be all you need. In many cases, it’s not just sufficient; it’s superior.</p> </div>  </article>  </div> </div> </div></div>
  </body>
</html>
