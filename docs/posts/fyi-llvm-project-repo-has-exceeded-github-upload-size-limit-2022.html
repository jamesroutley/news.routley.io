<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://discourse.llvm.org/t/fyi-llvm-project-repo-has-exceeded-github-upload-size-limit/63293">Original</a>
    <h1>FYI: LLVM-project repo has exceeded GitHub upload size limit (2022)</h1>
    
    <div id="readability-page-1" class="page"><div id="post_1" itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>(The issue described here probably doesn’t affect most of the members but I think it’s still a good idea to give a heads-up for people who have a similar workflow)</p>
<p>If you happened to push the entire llvm-project to another new (personal) GitHub repo recently, you might encounter the following error message before the whole process bails out:</p>
<pre><code>...
remote: fatal: pack exceeds maximum allowed size (2.00 GiB)
error: remote unpack failed: index-pack abnormal exit
To github.com:&lt;your GitHub repo&gt;
 ! [remote rejected]           main -&gt; main (failed)
error: failed to push some refs to &#39;git@github.com:&lt;your GitHub repo&gt;&#39;
</code></pre>
<p>The crux here is that we tried to push the entire repo, which has exceeded GitHub’s upload limit (2GB) at once. This is <strong>not</strong> a problem for majority of the developers who already had a copy of llvm-project in their separated GitHub repos (or simply lack such kind of copy) since incremental commit pushes are unlikely to exceed the upload limit.</p>
<p>If you don’t really care about the full git history and/or some other branches, the easiest fix will be using <a href="https://github.blog/2020-12-21-get-up-to-speed-with-partial-clone-and-shallow-clone/" rel="noopener nofollow ugc">Git shallow clone</a> to clone the upstream llvm-project tree before pushing it to another GitHub repo.</p>
<p>Otherwise, you might want to push the repo in parts:</p>
<pre><code>git checkout &lt;a previous commit when the project size was still under 2GB&gt;
# Push first half of the commits
git push &lt;remote name&gt; HEAD:refs/heads/&lt;remote branch name&gt;
# Push rest of the commits
git checkout &lt;local branch name&gt;
git push &lt;remote name&gt; HEAD:&lt;remote branch name&gt;
</code></pre>
<p>For the ‘commit when the project size was still under 2GB’ , I randomly picked one from 2021. As I remember the issue only happened recently.</p>
        </div>

        <meta itemprop="headline" content="FYI: llvm-project repo has exceeded GitHub upload size limit"/>
          <meta itemprop="keywords" content=""/>

        

         

      </div><div id="post_2" itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>The repo needs repacking, I emailed GitHub support for this. They did it a couple of year ago and the repo size got divided by two.</p>
<p>For reference: <a href="https://support.github.com/ticket/personal/0/1673689">https://support.github.com/ticket/personal/0/1673689</a> (I’m not sure if it is accessible to everyone in the LLVM org)</p>
        </div>

        <meta itemprop="headline" content="FYI: llvm-project repo has exceeded GitHub upload size limit"/>

        

         

      </div><div id="post_3" itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>They only got it down to 2GB (20% reduction, better than nothing) because:</p>
<blockquote>
<p>As it turns out, we only run repacks on a repository network level, which means that repacks need to consider objects from all forks of a given repository.</p>
<p>Repacking entire repository networks will always lead to less optimal pack sizes compared to repacking just objects from a single fork. For GitHub, disk space is not the only thing we optimize for, but also performance across forks and client performance.</p>
</blockquote>
        </div>

        <meta itemprop="headline" content="FYI: llvm-project repo has exceeded GitHub upload size limit"/>

        

         

      </div></div>
  </body>
</html>
