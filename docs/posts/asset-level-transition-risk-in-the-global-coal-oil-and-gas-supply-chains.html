<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain">Original</a>
    <h1>Asset-Level Transition Risk in the Global Coal, Oil, and Gas Supply Chains</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><strong>Kruitwagen, L., Klaas, J., Baghaei Lakeh, A., &amp; Fan, J.</strong></p>
<p dir="auto">A repo for building a network model of the global fossil fuel supply chain using asset-level data. A project in support of the <a href="https://www.oxfordmartin.ox.ac.uk/post-carbon/" rel="nofollow">Oxford Martin Programme on the Post-Carbon Transition</a> generously supported by <a href="https://www.microsoft.com/en-us/ai/ai-for-earth" rel="nofollow">Microsoft AI for Earth</a>.</p>
<h2 dir="auto"><a id="user-content-abstract" aria-hidden="true" href="#abstract"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Abstract</h2>
<p dir="auto">Climate change risks manifest in the real economy, with grave consequences for welfare of human populations and the biosphere; the economic returns of industrial sectors; and geopolitical stability. Understanding the diffusion of risks in real infrastructure networks is an urgent priority for delivering climate change mitigation, adaptation, and resiliency. The oil, gas, and coal supply chains are the most salient progenitors and inheritors of these environmental risks.
We prepare a geospatial arrangement of the global oil, gas, and coal supply chains using open-source asset-level data. The resulting complex network has 6.09mn nodes and 15.70mn edges and is implemented in a graph database. With estimates of annual coal, gas, and oil demand in 13,229 global population centres and 8,165 global power stations, we use a minimum-cost flow method to estimate global asset-level energy flows. We develop a method for cross-validating and tuning our network flow simulation using aggregate country-level import and export statistics. We demonstrate two analyses of asset-level transition risk: a counter-factual demand shock scenario consistent with the IEA Sustainable Development Scenario; and supply shock scenarios developed by interdicting regionally-aggregated coal, oil, and gas supplies. Our contribution lies in the global scope of our asset-level supply chain and the novelty of our minimum-cost flow method. We conclude with a discussion of further research directions and make the graph database and supporting code publicly available.</p>
<p dir="auto">The full paper is available <a href="https://papers.ssrn.com/abstract=3783412" rel="nofollow">here</a>.</p>
<p dir="auto"><strong>Figure 1: Global coal, oil, and gas asset-level data</strong>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/all_assets.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/all_assets.png" alt="Global fossil fuel infrastructure"/></a></p>
<h2 dir="auto"><a id="user-content-data" aria-hidden="true" href="#data"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Data</h2>
<p dir="auto">Our work uses only open-source data in order to maximise accessibility and reporduceability. We build on the substantial efforts of public sector organisations to develop and publish open datasets of energy system infrastrucutre and activity, particularly the work of the Global Energy Monitor, the World Resources Institute ResourceWatch, the Global Oil and Gas Features Database, the European Commision Joint Research Council, OpenStreetMap.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>N_installations</th>
<th>N_sources</th>
<th>Quality</th>
<th>Icon</th>
</tr>
</thead>
<tbody>
<tr>
<td>Well Pads</td>
<td>9,845</td>
<td>24</td>
<td>Good</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/OILWELL.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/OILWELL.png" alt=""/></a></td>
</tr>
<tr>
<td>Oil Fields</td>
<td>25,236</td>
<td>63</td>
<td>Good</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/OILFIELD.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/OILFIELD.png" alt=""/></a></td>
</tr>
<tr>
<td>Coal Mines</td>
<td>3,099</td>
<td>32</td>
<td>Adequate</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/COALMINE.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/COALMINE.png" alt=""/></a></td>
</tr>
<tr>
<td>Processing &amp; Refining Facilities</td>
<td>2,501</td>
<td>55</td>
<td>Good</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/REFINERY.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/REFINERY.png" alt=""/></a></td>
</tr>
<tr>
<td>LNG Liqufication &amp; Regasification</td>
<td>329</td>
<td>15</td>
<td>Excellent</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/LNGTERMINAL.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/LNGTERMINAL.png" alt=""/></a></td>
</tr>
<tr>
<td>Pipelines</td>
<td>94,448</td>
<td>82</td>
<td>Good</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/PIPELINE.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/PIPELINE.png" alt=""/></a></td>
</tr>
<tr>
<td>Ports</td>
<td>3,702</td>
<td>10</td>
<td>Excellent</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/PORT.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/PORT.png" alt=""/></a></td>
</tr>
<tr>
<td>Shipping Routes</td>
<td>8,273</td>
<td>1</td>
<td>Excellent</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/SHIPPINGROUTE.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/SHIPPINGROUTE.png" alt=""/></a></td>
</tr>
<tr>
<td>Railways</td>
<td>496,808</td>
<td>52</td>
<td>Excellent</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/RAILWAY.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/RAILWAY.png" alt=""/></a></td>
</tr>
<tr>
<td>Power Stations</td>
<td>28,664</td>
<td>1</td>
<td>Good</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/POWERSTATION.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/POWERSTATION.png" alt=""/></a></td>
</tr>
<tr>
<td>Population Centres</td>
<td>13,229</td>
<td>2</td>
<td>Excellent</td>
<td><a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/CITY.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/CITY.png" alt=""/></a></td>
</tr>
</tbody>
</table>
<p dir="auto">Data must be <a href="https://drive.google.com/file/d/1LWXT3WyNpMS8xmdFzStbUyQlzdPLGhv_/view?usp=sharing" rel="nofollow">downloaded</a> and unzipped in a folder <code>data/</code> in the main directory.</p>
<h2 dir="auto"><a id="user-content-setup" aria-hidden="true" href="#setup"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Setup</h2>
<h4 dir="auto"><a id="user-content-environment" aria-hidden="true" href="#environment"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Environment</h4>
<p dir="auto">On a fresh linux install you will require the following:</p>
<div data-snippet-clipboard-copy-content="sudo apt-get install python3-dev build-essential libspatialindex-dev openjdk-8-jre"><pre><code>sudo apt-get install python3-dev build-essential libspatialindex-dev openjdk-8-jre
</code></pre></div>
<p dir="auto">We use <a href="https://docs.conda.io/en/latest/miniconda.html" rel="nofollow">conda</a> for environment management. Create a new environment:</p>
<div data-snippet-clipboard-copy-content="conda create -n ffsc python=3.7"><pre><code>conda create -n ffsc python=3.7
</code></pre></div>
<p dir="auto">Activate your conda environment:</p>

<p dir="auto">Clone and change directory into this repo:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain.git
cd global-fossil-fuel-supply-chain"><pre><code>git clone https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain.git
cd global-fossil-fuel-supply-chain
</code></pre></div>
<p dir="auto">Install pip package manager to the environment if it isn&#39;t already:</p>

<p dir="auto">Install the project packages. Conda is used to install geospatial packages with c binary dependancies:</p>
<div data-snippet-clipboard-copy-content="pip install -r requirements.txt
conda install -c conda-forge --file conda_reqs.txt"><pre><code>pip install -r requirements.txt
conda install -c conda-forge --file conda_reqs.txt
</code></pre></div>
<h4 dir="auto"><a id="user-content-environment-variables" aria-hidden="true" href="#environment-variables"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Environment Variables</h4>
<p dir="auto">Save the environment variables we need in activation and deactivation scripts in the conda environment. Follow the <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#setting-environment-variables" rel="nofollow">conda instructions</a> for your os, and adapt the following:</p>
<div data-snippet-clipboard-copy-content="cd CONDA_PREFIX
mkdir -p ./etc/conda/activate.d
mkdir -p ./etc/conda/deactivate.d
touch ./etc/conda/activate.d/env_vars.sh
touch ./etc/conda/deactivate.d/env_vars.sh"><pre><code>cd CONDA_PREFIX
mkdir -p ./etc/conda/activate.d
mkdir -p ./etc/conda/deactivate.d
touch ./etc/conda/activate.d/env_vars.sh
touch ./etc/conda/deactivate.d/env_vars.sh
</code></pre></div>
<p dir="auto">edit <code>./etc/conda/activate.d/env_vars.sh</code> as follows:</p>
<div data-snippet-clipboard-copy-content="#!/bin/sh
export USE_PYGEOS=1
export PYTHONPATH=$PWD
export NUMEXPR_MAX_THREADS=24 # or something suiting your resources"><pre><code>#!/bin/sh
export USE_PYGEOS=1
export PYTHONPATH=$PWD
export NUMEXPR_MAX_THREADS=24 # or something suiting your resources
</code></pre></div>
<p dir="auto">edit <code>./etc/conda/deactivate.d/env_vars.sh</code> as follows:</p>
<div data-snippet-clipboard-copy-content="#!/bin/sh

unset PYTHONPATH
unset USE_PYGEOS
unset NUMEXPR_MAX_THREADS"><pre><code>#!/bin/sh

unset PYTHONPATH
unset USE_PYGEOS
unset NUMEXPR_MAX_THREADS
</code></pre></div>
<p dir="auto">Save and close both files.</p>
<h4 dir="auto"><a id="user-content-community-detection" aria-hidden="true" href="#community-detection"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Community Detection</h4>
<p dir="auto">Clone <a href="https://github.com/nicolasdugue/DirectedLouvain">the DirectedLouvain repository</a></p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/nicolasdugue/DirectedLouvain.git"><pre><code>git clone https://github.com/nicolasdugue/DirectedLouvain.git
</code></pre></div>
<p dir="auto">Enter the repository and run the MakeFile</p>

<h4 dir="auto"><a id="user-content-pypy" aria-hidden="true" href="#pypy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PyPy</h4>
<p dir="auto">We use <a href="https://www.pypy.org/index.html" rel="nofollow">PyPy</a> to significantly speed-up dijkstra minimum-cost path search. PyPy uses a just-in-time compiler to significantly speed-up Python code execution. <a href="https://www.pypy.org/download.html" rel="nofollow">Download</a> the correct version of PyPy to <code>bin/</code>.</p>
<h4 dir="auto"><a id="user-content-optional-neo4j-database" aria-hidden="true" href="#optional-neo4j-database"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>(Optional) Neo4J Database</h4>
<ol dir="auto">
<li>Note if ssh tunnelling you will need to redirect port 8678 and 8888</li>
<li><a href="https://neo4j.com/docs/operations-manual/current/installation/linux/" rel="nofollow">Install neo4j server</a>. We use Neo4j 3.5 in our experiments,
but everything described here should also work with Neo4j 4.0</li>
</ol>
<h2 dir="auto"><a id="user-content-useage" aria-hidden="true" href="#useage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Useage</h2>
<h3 dir="auto"><a id="user-content-running-the-computational-pipeline" aria-hidden="true" href="#running-the-computational-pipeline"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Running the computational pipeline</h3>
<p dir="auto">The main pipeline entrypoint is <code>cli.py</code>. The commands available to <code>cli.py</code> can be found with:</p>

<p dir="auto">The following top-level commands are available: <code>network-assembly</code>,<code>solve-flow</code>,<code>shock-analysis</code>, and <code>visualisation</code>.</p>
<p dir="auto">The pipeline makes extensive use of <a href="https://kedro.readthedocs.io/en/stable/" rel="nofollow">Kedro</a>, which is a computational graph manager. Kedro uses of a data catalog, which is here: <a href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/conf/base/catalog.yml">conf/base/catalog.yml</a>. The catalog can also be used in other scripts and environments:</p>
<div data-snippet-clipboard-copy-content="from kedro.io import DataCatalog
import yaml

catalog = DataCatalog(yaml.load(open(&#39;/path/to/conf/base/catalog.yaml&#39;,&#39;r&#39;),Loader=yaml.SafeLoader))
dataframe = catalog.load(&#39;&lt;dataframe-key&gt;&#39;)"><pre><code>from kedro.io import DataCatalog
import yaml

catalog = DataCatalog(yaml.load(open(&#39;/path/to/conf/base/catalog.yaml&#39;,&#39;r&#39;),Loader=yaml.SafeLoader))
dataframe = catalog.load(&#39;&lt;dataframe-key&gt;&#39;)
</code></pre></div>
<p dir="auto">Each pipeline is a computational graph with computation nodes and dataset edges, creating a version-controlled reproduceable workflow from raw data through to analysis. Computation nodes are labelled with <em>tags</em> so the pipeline can be run one-node-at-a-time, if desired. The computational graph for the <code>network-assembly</code> pipeline is shown in the figure below. Each pipeline can be run using:</p>
<div data-snippet-clipboard-copy-content="python cli.py &lt;pipeline-command&gt; --tags=&lt;list,of,comma-separated,tags&gt;"><pre><code>python cli.py &lt;pipeline-command&gt; --tags=&lt;list,of,comma-separated,tags&gt;
</code></pre></div>
<p dir="auto">Tags are nested such that top-level tags will execute a while pipeline step, and nested tags will execute substeps for certain asset types or energy carriers.</p>
<p dir="auto"><strong>Figure A-1: Network assembly computational graph</strong>
<a target="_blank" rel="noopener noreferrer" href="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/blob/master/image_assets/dag.png"><img src="https://github.com/Lkruitwagen/global-fossil-fuel-supply-chain/raw/master/image_assets/dag.png" alt="Computational graph"/></a></p>
<h3 dir="auto"><a id="user-content-assembling-the-infrastructure-network" aria-hidden="true" href="#assembling-the-infrastructure-network"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Assembling the infrastructure network</h3>
<p dir="auto">This pipeline assembles the asset-level infrastructure network. It can be run with <code>python cli.py network-assembly</code>. A comma-separated list of <code>--tags</code> can also be passed. Passing <code>--help</code> produces the following documentation:</p>
<div data-snippet-clipboard-copy-content="Usage: cli.py network-assembly [OPTIONS]

Assemble the basic network from asset-level data. See
ffsc.pipeline.pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--preprocess : Preprocessing and homogenisation of all raw asset data.
--prep       : Geospatial preparation operations on all data.
--sjoin      : Spatial join operations matching linear and point assets.
--flmile     : First- and last-mile matching operations to gapfill missing data.
--explode    : Geospatial post-processing of joining and matching.
--simplify   : Simplification operations to reduce the number of nodes.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run in
           a comma-separated list.

--help       Show this message and exit."><pre><code>Usage: cli.py network-assembly [OPTIONS]

Assemble the basic network from asset-level data. See
ffsc.pipeline.pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--preprocess : Preprocessing and homogenisation of all raw asset data.
--prep       : Geospatial preparation operations on all data.
--sjoin      : Spatial join operations matching linear and point assets.
--flmile     : First- and last-mile matching operations to gapfill missing data.
--explode    : Geospatial post-processing of joining and matching.
--simplify   : Simplification operations to reduce the number of nodes.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run in
           a comma-separated list.

--help       Show this message and exit.
</code></pre></div>
<h3 dir="auto"><a id="user-content-solving-energy-flow-on-the-network" aria-hidden="true" href="#solving-energy-flow-on-the-network"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Solving energy flow on the network</h3>
<p dir="auto">This pipeline calculates asset-level energy flow through the network, from energy sources (i.e. coalmines, and oil and gas fields and wells) through to energy sinks (population centres and powerstations). It can be run with <code>python cli.py solve-flow</code>. A comma-separated list of <code>--tags</code> can also be passed. Passing <code>--help</code> produces the following documentation:</p>
<div data-snippet-clipboard-copy-content="Usage: cli.py solve-flow [OPTIONS]

Assemble the basic network from asset-level data. See
ffsc.flow.flow_pipeline.py, ffsc.communities.community_pipeline.py, and
ffsc.interdiction.interdiction_pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--flow_edges           : Prepare network edges dataframe.
--flow_nodes           : Prepare network nodes dataframe.
--flow_nx              : Test network connectivity and prepared for flow calculations.
--community-prep       : Prepare to add communities to network.
--community-run        : Run community detection algorithm.
--community-post-nodes : Post-process community detection onto node dataframe.
--community-post-edges : Post-process community detection onto edge dataframe.
--dijkstra-pickle      : Pickle edges in preparation for dijkstra mincost path.
--dijkstra-paths       : Run async dijkstra mincost path.
--dijkstra-adj         : Post-process dijkstra to mincost adjacency matrix.
--dijkstra-flow        : Solve flow using iterative cost-scaling.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run
--help       Show this message and exit."><pre><code>Usage: cli.py solve-flow [OPTIONS]

Assemble the basic network from asset-level data. See
ffsc.flow.flow_pipeline.py, ffsc.communities.community_pipeline.py, and
ffsc.interdiction.interdiction_pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--flow_edges           : Prepare network edges dataframe.
--flow_nodes           : Prepare network nodes dataframe.
--flow_nx              : Test network connectivity and prepared for flow calculations.
--community-prep       : Prepare to add communities to network.
--community-run        : Run community detection algorithm.
--community-post-nodes : Post-process community detection onto node dataframe.
--community-post-edges : Post-process community detection onto edge dataframe.
--dijkstra-pickle      : Pickle edges in preparation for dijkstra mincost path.
--dijkstra-paths       : Run async dijkstra mincost path.
--dijkstra-adj         : Post-process dijkstra to mincost adjacency matrix.
--dijkstra-flow        : Solve flow using iterative cost-scaling.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run
--help       Show this message and exit.
</code></pre></div>
<h3 dir="auto"><a id="user-content-analysing-demand-and-supply-shocks" aria-hidden="true" href="#analysing-demand-and-supply-shocks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Analysing demand and supply shocks</h3>
<p dir="auto">The energy infrastructure network can be treated with demand and supply shocks. Flow can be recalculated to see the effect of the shocks on asset-level energy flow and costs. The pipeline can be run with <code>python cli.py shock-analysis</code>. A comma-separated list of <code>--tags</code> can also be passed. Passing <code>--help</code> produces the following documentation:</p>
<div data-snippet-clipboard-copy-content="Usage: cli.py shock-analysis [OPTIONS]

Prepare demand and supply shock analysis. See
ffsc.interdiction.interdiction_pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--sds_counterfactual       : Prepare Sustainable Development Scenario demand shock analysis.
--supply-interdiction      : Prepare supply interdiction shock analysis.
--post-supply-interdiction : Post-process supply interdiction shock analysis.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run
--help       Show this message and exit."><pre><code>Usage: cli.py shock-analysis [OPTIONS]

Prepare demand and supply shock analysis. See
ffsc.interdiction.interdiction_pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--sds_counterfactual       : Prepare Sustainable Development Scenario demand shock analysis.
--supply-interdiction      : Prepare supply interdiction shock analysis.
--post-supply-interdiction : Post-process supply interdiction shock analysis.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run
--help       Show this message and exit.
</code></pre></div>
<h3 dir="auto"><a id="user-content-visualising-the-data-flow-and-analysis" aria-hidden="true" href="#visualising-the-data-flow-and-analysis"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Visualising the data, flow, and analysis</h3>
<p dir="auto">The asset-level data can be visualised on a world map, and scaled and colored by the amount of energy flow passing through each asset. The pipeline can be run with <code>python cli.py visualisation</code>. A comma-separated list of <code>--tags</code> can also be passed. Passing <code>--help</code> produces the following documentation:</p>
<div data-snippet-clipboard-copy-content="Usage: cli.py visualisation [OPTIONS]

Prepare visualisation of assets, flow, and demand shock counterfactual.
See ffsc.visualisation.visualise_pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--visualise-assets      : Visualise all assets.
--visualise-iso2        : Add iso2 country codes to dataframes.
--visualise-trade-prep  : Prepare trade dataframes for comparison.
--visualise-trade       : Visualise actual trade and production vs simulated.
--visualise-flow        : Visualise energy flow.
--compare-flow          : Compare energy flow to SDS demand shock energy flow.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run
--help       Show this message and exit."><pre><code>Usage: cli.py visualisation [OPTIONS]

Prepare visualisation of assets, flow, and demand shock counterfactual.
See ffsc.visualisation.visualise_pipeline.py for detailed tags.

AVAILABLE TOP-LEVEL TAGS:
-------------------------
--visualise-assets      : Visualise all assets.
--visualise-iso2        : Add iso2 country codes to dataframes.
--visualise-trade-prep  : Prepare trade dataframes for comparison.
--visualise-trade       : Visualise actual trade and production vs simulated.
--visualise-flow        : Visualise energy flow.
--compare-flow          : Compare energy flow to SDS demand shock energy flow.

Options:
--tags TEXT  Optionally specify any individual node tags you want to run
--help       Show this message and exit.
</code></pre></div>
<h3 dir="auto"><a id="user-content-importing-files-into-neo4j" aria-hidden="true" href="#importing-files-into-neo4j"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Importing files into Neo4j</h3>
<ol dir="auto">
<li>Make sure Neo4j is shut down. The installer might start up neo4j under a different user (e.g. Neo4j).
In this case, you might want to find the process under which Neo4j runs using <code>sudo ps -a | grep neo4j</code>. Find the PID of the process and kill it using <code>sudo kill</code>.</li>
<li>As Neo4j&#39;s files may be restricted, you want to do the next steps as root.</li>
<li>Delete Neo4j&#39;s data folder from the old database. On Linux, this is stored under <code>/var/lib/neo4j/data</code>.</li>
<li>Import the data by executing the <code>bin/import.sh</code> script, which you can find under <code>src/neo4j_commands</code> in this repository.</li>
<li>After the import is complete, restart Neo4j using <code>neo4j start</code></li>
</ol>
</article>
          </div></div>
  </body>
</html>
