<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mikeenglish.net/blog/2023/09/19/contributions-and-reflections/">Original</a>
    <h1>RC Reflections, Media over QUIC Contributions</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>Last week was the last official week of my <a href="https://www.recurse.com/scout/click?t=24c53dc56ddd7af575ff67d7fa1194c4">Recurse Center</a> batch.</p>

<p>While at RC, I worked on a lot of different projects, paired with a lot of people, wrote a few blog posts, and presented on both technical and non-technical topics many times.</p>

<p>My main goal was to become a better programmer by writing a lot of Rust and working in a domain I find particularly interesting.</p>

<p>Not only did I succeed at this, but I surpassed my own expectations!</p>

<h3 id="moq-rs">moq-rs</h3>

<p>The main project I worked on was a <a href="https://mailarchive.ietf.org/arch/msg/moq/lMt2qnN0oC0lufK8lxB3aeD41XM/">recently announced</a> <a href="https://datatracker.ietf.org/group/moq/about/">Media over QUIC</a> <a href="https://github.com/kixelated/moq-rs">library implementation written in Rust</a>. This library, originally started by Luke Curley as a rewrite of his Go proof of concept “WARP” implementation, now represents a leading edge open source implementation that’s being used to inform the design of the Media over QUIC specifications themselves. I worked with Luke to help design several major revisions of the library API and also contributed code which included fleshing out proofs of concept around contribution workflows.</p>

<p>I also deployed Media over QUIC relays running this code to both fly.io and Google Cloud (GKE) to use for testing.</p>

<h3 id="moq-pub">moq-pub</h3>

<p>The bulk of the code I wrote this summer was for a video ingest / contribution tool called <code>moq-pub</code>. Much of that code has since been rolled into the underlying library.</p>

<p><code>moq-pub</code> takes fragmented MP4 media and sends it to a MoQ relay server using the MoQ Transport protocol (MoQT). Essentially:</p>

<div><div><pre><code>ffmpeg -i tears_of_steel.mp4 -f mp4 ... - | moq-pub --host moq-relay.example.com
</code></pre></div></div>

<p>Working on <code>moq-pub</code> was a great excuse to take a deep dive into topics like:</p>

<ul>
  <li>The ISO BMFF / MP4 container format</li>
  <li>The QUIC transport protocol and the various Rust libraries that implement QUIC today</li>
  <li>WebTransport</li>
  <li>async Rust and tokio</li>
  <li>Designing async / await Rust code using channels to simplify ownership of shared resources</li>
</ul>

<p>We also learned a lot about how the library’s ergonomics could be improved by encapsulating more of the protocol’s messaging and protocol-related state rather than forcing client applications to maintain that state and handle control messages on their own. (This is why the current version of <code>moq-pub</code> is so much smaller than the <a href="https://github.com/kixelated/moq-rs/tree/35c21276839462b9004dc65f86e1f9ffc8729547/moq-pub">first version I wrote</a>.)</p>

<h3 id="libmoq">libmoq</h3>

<p>Having a CLI tool to handle MoQ contribution workflows is great, but I thought it would be even better if we could make MoQ connections directly from software like ffmpeg, OBS, and gstreamer.</p>

<p>So, following up on <code>moq-pub</code>, I’ve also built a small Rust library to wrap <code>moq-rs</code> and expose a C FFI so that non-Rust native code can also contribute streaming media using Media over QUIC.</p>

<p>I call this library <a href="https://github.com/englishm/libmoq"><code>libmoq</code></a>, and I already have a <a href="https://github.com/FFmpeg/FFmpeg/compare/master...englishm:FFmpeg:me/moq"><em>very</em> lightly patched version of <code>ffmpeg</code></a> that can make use of <code>libmoq</code> to connect to a MoQ relay server and send video. The current implementation still has a few bugs, but I’m actively working on fixing them so others can take advantage of this code, too. Expect to see a bit more polish and documentation in the coming weeks.</p>

<h3 id="et-cetera">et cetera</h3>

<p>Besides all of the Media over QUIC work above, I also worked on various other smaller learning projects, some of which I’ll also be open sourcing. I also paired with a lot of other folks on both some of this code, and on their own projects.</p>

<p>I would love to stay at RC forever. I’m pretty sure this has been the most fun I’ve <em>ever</em> had programming, and I <em>really</em> like programming!</p>

<p>Maybe someday I’ll have saved up enough to retire for good, and then I can just hang around RC and the Virtual RC space and work on fun open source stuff forever…</p>

<p>But today is not yet that day. I’ll have to go back to a paying job sooner or later. 
Maybe I can at least find a fun and collaborative team to join and carry some of this great energy forward…</p>

<p>If any of this sounds interesting, you know where to find me.</p>

<p>(<a href="https://hachyderm.io/@englishm">Hachyderm</a>, <a href="https://bsky.app/profile/englishm.bsky.social">Bluesky</a>, <a href="https://discordapp.com/users/123510893194510337">Discord</a>, <a href="https://twitter.com/englishm_"><del>Twitter</del></a>, etc.)</p>

<p>P.S. I’ll be at Strange Loop later this week if anyone wants to meet up there!</p>

<hr/>




  </div>

</article>

      </div>
    </div></div>
  </body>
</html>
