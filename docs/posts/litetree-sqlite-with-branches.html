<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/aergoio/litetree">Original</a>
    <h1>Litetree – SQLite with Branches</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a href="https://aergo.io" rel="nofollow"><img src="https://camo.githubusercontent.com/660771f55a864b86cf43b1ec75e97ea0d2616a0ba2820f11c27358c8d237a2e9/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f616572676f2d70726573656e74732d626c61636b2d726f756e642e737667" width="20%" data-canonical-src="http://litesync.io/litetree/aergo-presents-black-round.svg"/></a> <a href="https://travis-ci.org/aergoio/litetree" rel="nofollow"><img src="https://camo.githubusercontent.com/257c30eddac5214cfe6f023be78e359162c918cbd8053608c81853552caf4b5d/68747470733a2f2f7472617669732d63692e6f72672f616572676f696f2f6c697465747265652e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/aergoio/litetree.svg?branch=master"/></a> <a href="https://ci.appveyor.com/project/kroggen/litetree" rel="nofollow"><img src="https://camo.githubusercontent.com/6b1f9002a48a3ff0c54c60789a04c3cd2e12839b1aff2845a8e3abd9d152dc3c/68747470733a2f2f63692e6170707665796f722e636f6d2f6170692f70726f6a656374732f7374617475732f6769746875622f616572676f696f2f6c697465747265653f6272616e63683d6d6173746572267376673d74727565" alt="Build Status" data-canonical-src="https://ci.appveyor.com/api/projects/status/github/aergoio/litetree?branch=master&amp;svg=true"/></a></p>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/21aa76d805f5ae55027bf3cf8ef14e94d38d0334f964724ec8760ec3300096d8/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d6c697465747265652e706e67"><img src="https://camo.githubusercontent.com/21aa76d805f5ae55027bf3cf8ef14e94d38d0334f964724ec8760ec3300096d8/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d6c697465747265652e706e67" alt="" data-canonical-src="http://litesync.io/litetree/graph-litetree.png"/></a></p>
<p dir="auto">Imagine being able to have many connections to the same database, each one reading a separate branch or commit at the same time. Or even writing to separate branches.</p>
<p dir="auto">This is possible with <strong>LiteTree</strong>. It is a modification of the SQLite engine to support branching, like git!</p>
<p dir="auto">Database branching is a very useful tool for blockchain implementations and LiteTree will be at the core of <a href="https://github.com/aergoio/aergo">Aergo</a>.</p>
<p dir="auto">This is how it works:</p>
<p dir="auto">Each database transaction is saved as a commit, and each commit has an incremental number. Let&#39;s consider an empty db in which we run this first SQL command:</p>

<p dir="auto">Now it will have the first commit (number 1) in the automatically created <code>master</code> branch:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/b30f7777b5066f18ca37e83c93bf0ad3e565794c68217629a7e7700e9a16c96b/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d312d636f6d6d69742e706e67"><img src="https://camo.githubusercontent.com/b30f7777b5066f18ca37e83c93bf0ad3e565794c68217629a7e7700e9a16c96b/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d312d636f6d6d69742e706e67" alt="" data-canonical-src="http://litesync.io/litetree/graph-1-commit.png"/></a></p>
<p dir="auto">When we execute new transactions it will add new commits to the current branch:</p>
<div data-snippet-clipboard-copy-content="INSERT INTO t1 VALUES (&#39;first&#39;)
INSERT INTO t1 VALUES (&#39;second&#39;)"><pre><code>INSERT INTO t1 VALUES (&#39;first&#39;)
INSERT INTO t1 VALUES (&#39;second&#39;)
</code></pre></div>
<p dir="auto">Now we have 3 commits:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/81a4a82dbad144f38216ce7800cfa9faefe99859b3bb29b14be7944356b255af/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d332d636f6d6d6974732e706e67"><img src="https://camo.githubusercontent.com/81a4a82dbad144f38216ce7800cfa9faefe99859b3bb29b14be7944356b255af/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d332d636f6d6d6974732e706e67" alt="" data-canonical-src="http://litesync.io/litetree/graph-3-commits.png"/></a></p>
<p dir="auto">To include many SQL commands in a single commit we must enclose them in <code>BEGIN</code> and <code>COMMIT</code>  commands.</p>
<p dir="auto">We create new branches informing the source branch and commit number:</p>
<div data-snippet-clipboard-copy-content="PRAGMA new_branch=test at master.2"><pre><code>PRAGMA new_branch=test at master.2
</code></pre></div>
<p dir="auto">After this command is executed the new branch is created but without any new data added to it. The database connection also moves to this new branch, having it as the current branch.</p>
<p dir="auto">We can check the current branch with the command:</p>

<p dir="auto">In this case it will return: <code>test</code></p>
<p dir="auto">If we execute a SQL command on this db connection the commit will be saved in the connection&#39;s current branch:</p>
<div data-snippet-clipboard-copy-content="INSERT INTO t1 VALUES (&#39;from test branch&#39;)"><pre><code>INSERT INTO t1 VALUES (&#39;from test branch&#39;)
</code></pre></div>
<p dir="auto">Now the graph state will be:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/6ac757e4f9f3fe805afac270873939cde79600b85dd855dfeea50d8666f34453/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d322d6272616e636865732e706e67"><img src="https://camo.githubusercontent.com/6ac757e4f9f3fe805afac270873939cde79600b85dd855dfeea50d8666f34453/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d322d6272616e636865732e706e67" alt="" data-canonical-src="http://litesync.io/litetree/graph-2-branches.png"/></a></p>
<p dir="auto">We can also read the database at this new branch:</p>

<p dir="auto">It will return these values:</p>
<blockquote>
<p dir="auto">first</p>
<p dir="auto">from test branch</p>
</blockquote>
<p dir="auto">We can move to the master branch:</p>

<p dir="auto">And executing the same SELECT command (but now in the master branch) it will return:</p>
<blockquote>
<p dir="auto">first</p>
<p dir="auto">second</p>
</blockquote>
<p dir="auto">Different content for the same table on separate branches.</p>
<p dir="auto">Commits in separate branches have the same numbering based on the distance from the first commit:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/42ea78f79f6603916a69cf671ea074a11d63323a2839bce9c6e4685cb25174c1/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d636f6d6d69742d6e756d626572732e706e67"><img src="https://camo.githubusercontent.com/42ea78f79f6603916a69cf671ea074a11d63323a2839bce9c6e4685cb25174c1/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f67726170682d636f6d6d69742d6e756d626572732e706e67" alt="" data-canonical-src="http://litesync.io/litetree/graph-commit-numbers.png"/></a></p>
<p dir="auto">We can read the database in a previous point-in-time by moving to that commit, like this:</p>

<p dir="auto">At this point the table <code>t1</code> has a single row and if we do a SELECT it will return just <code>first</code>.</p>
<p dir="auto">We cannot write to the database when we are in a defined commit, writing is only possible at the head of each branch. If you want to make modifications to some previous commit you must create a new branch that starts at that commit.</p>
<p dir="auto">It is also possible to truncate a branch at a specific commit, rename a branch, delete it and retrieve branch info.</p>
<h2 dir="auto"><a id="user-content-supported-commands" aria-hidden="true" href="#supported-commands"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Supported commands</h2>
<ul dir="auto">
<li>Selecting the active branch:

</li>
<li>Selecting a specific commit in a branch:
<div data-snippet-clipboard-copy-content=" PRAGMA branch=&lt;name&gt;.&lt;commit&gt;"><pre><code> PRAGMA branch=&lt;name&gt;.&lt;commit&gt;
</code></pre></div>
</li>
<li>Retrieving the current/active branch:

</li>
<li>Listing the existing branches:

</li>
<li>Creating a new branch:
<div data-snippet-clipboard-copy-content=" PRAGMA new_branch=&lt;name&gt; at &lt;source&gt;.&lt;commit&gt;"><pre><code> PRAGMA new_branch=&lt;name&gt; at &lt;source&gt;.&lt;commit&gt;
</code></pre></div>
</li>
<li>Deleting a branch:
<div data-snippet-clipboard-copy-content=" PRAGMA del_branch(&lt;name&gt;)"><pre><code> PRAGMA del_branch(&lt;name&gt;)
</code></pre></div>
</li>
<li>Renaming a branch:
<div data-snippet-clipboard-copy-content=" PRAGMA rename_branch &lt;old_name&gt; &lt;new_name&gt;"><pre><code> PRAGMA rename_branch &lt;old_name&gt; &lt;new_name&gt;
</code></pre></div>
</li>
<li>Truncating a branch at a specific commit:
<div data-snippet-clipboard-copy-content=" PRAGMA branch_truncate(&lt;name&gt;.&lt;commit&gt;)"><pre><code> PRAGMA branch_truncate(&lt;name&gt;.&lt;commit&gt;)
</code></pre></div>
</li>
<li>Displaying the tree structure:

</li>
<li>Retrieving the branch info:
<div data-snippet-clipboard-copy-content=" PRAGMA branch_info(&lt;name&gt;)"><pre><code> PRAGMA branch_info(&lt;name&gt;)
</code></pre></div>
</li>
<li>Showing the commit and SQL log/history for a branch:
<div data-snippet-clipboard-copy-content=" PRAGMA branch_log(&lt;name&gt;)"><pre><code> PRAGMA branch_log(&lt;name&gt;)
</code></pre></div>
</li>
</ul>
<h4 dir="auto"><a id="user-content-not-yet-available" aria-hidden="true" href="#not-yet-available"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Not yet available</h4>
<p dir="auto">Some of these commands are being developed:</p>
<ul dir="auto">
<li>Modifying a commit:
<div data-snippet-clipboard-copy-content=" PRAGMA branch_log [--set|--add|--del] &lt;name&gt; &lt;sql commands&gt;"><pre><code> PRAGMA branch_log [--set|--add|--del] &lt;name&gt; &lt;sql commands&gt;
</code></pre></div>
</li>
<li>Showing the diff between 2 branches or commits:
<div data-snippet-clipboard-copy-content=" PRAGMA branch_diff &lt;from_branch&gt;[.&lt;commit&gt;] &lt;to_branch&gt;[.&lt;commit&gt;]"><pre><code> PRAGMA branch_diff &lt;from_branch&gt;[.&lt;commit&gt;] &lt;to_branch&gt;[.&lt;commit&gt;]
</code></pre></div>
</li>
<li><a href="https://github.com/aergoio/litetree/wiki/Storing-metadata">Save metadata to each branch and/or commit</a></li>
<li><a href="https://github.com/aergoio/litetree/wiki/Merging-branches">Merging 2 branches</a></li>
</ul>
<p dir="auto">And maybe these extended features could be supported:</p>
<ul dir="auto">
<li>Access control by branch</li>
</ul>
<p dir="auto">Check the roadmap on our <a href="https://github.com/aergoio/litetree/wiki">wiki</a>. Feature requests and suggestions are welcome.</p>
<h2 dir="auto"><a id="user-content-technologies" aria-hidden="true" href="#technologies"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Technologies</h2>
<p dir="auto">We can use LiteTree with big databases (many gigabytes). There is no data copying when a new branch is created. When a new transaction is commited only the modified database pages are copied.</p>
<p dir="auto">LiteTree is implemented storing the SQLite db pages on LMDB.</p>
<p dir="auto">The data is not compressed, and each db page is stored on just one disk sector (4096 bytes by default). This is achieved by reserving some bytes at each SQLite db page so it can fit into one LMDB overflow page, that can hold 4080 (4096 - 16) bytes.</p>
<h2 dir="auto"><a id="user-content-performance" aria-hidden="true" href="#performance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Performance</h2>
<p dir="auto">LiteTree is way faster than normal SQLite (journal mode) with comparable performance to WAL mode.</p>
<p dir="auto">Here are the some results:</p>
<h5 dir="auto"><a id="user-content-linux" aria-hidden="true" href="#linux"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Linux</h5>
<div data-snippet-clipboard-copy-content="writing:
--------
normal   = 22.8921730518 seconds
wal      = 10.7780168056 seconds
mmap     = 10.4009709358 seconds
litetree = 10.8633410931 seconds

reading:
--------
normal   = 0.817955970764 seconds
wal      = 0.660045146942 seconds
mmap     = 0.592491865158 seconds
litetree = 0.619393110275 seconds"><pre><code>writing:
--------
normal   = 22.8921730518 seconds
wal      = 10.7780168056 seconds
mmap     = 10.4009709358 seconds
litetree = 10.8633410931 seconds

reading:
--------
normal   = 0.817955970764 seconds
wal      = 0.660045146942 seconds
mmap     = 0.592491865158 seconds
litetree = 0.619393110275 seconds
</code></pre></div>
<h5 dir="auto"><a id="user-content-macosx" aria-hidden="true" href="#macosx"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MacOSX</h5>
<div data-snippet-clipboard-copy-content="writing:
--------
normal   = 1.9102909565 seconds
wal      = 1.30300784111 seconds
mmap     = 1.21677088737 seconds
litetree = 0.988132953644 seconds

reading:
--------
normal   = 0.999235868454 seconds
wal      = 0.776713132858 seconds
mmap     = 0.653935909271 seconds
litetree = 0.714652061462 seconds"><pre><code>writing:
--------
normal   = 1.9102909565 seconds
wal      = 1.30300784111 seconds
mmap     = 1.21677088737 seconds
litetree = 0.988132953644 seconds

reading:
--------
normal   = 0.999235868454 seconds
wal      = 0.776713132858 seconds
mmap     = 0.653935909271 seconds
litetree = 0.714652061462 seconds
</code></pre></div>
<h5 dir="auto"><a id="user-content-windows" aria-hidden="true" href="#windows"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Windows</h5>
<div data-snippet-clipboard-copy-content="writing:
--------
normal   = 68.0931215734 seconds
litetree = 39.239919979 seconds

reading:
--------
normal   = 0.012673914421 seconds
litetree = 0.00631055510799 seconds"><pre><code>writing:
--------
normal   = 68.0931215734 seconds
litetree = 39.239919979 seconds

reading:
--------
normal   = 0.012673914421 seconds
litetree = 0.00631055510799 seconds
</code></pre></div>
<p dir="auto">You can make your own benchmark (after installing LiteTree) with this command:</p>

<h2 dir="auto"><a id="user-content-current-limits" aria-hidden="true" href="#current-limits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Current Limits</h2>
<p dir="auto">Number of branches: 1024 branches  (can be increased)</p>
<p dir="auto">Number of commits per branch: 2^64 = 18,446,744,073,709,551,615 commits</p>
<p dir="auto">Concurrent db connections to the same db: XXX readers</p>
<h2 dir="auto"><a id="user-content-some-limitations" aria-hidden="true" href="#some-limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Some Limitations</h2>
<p dir="auto">A database file created in one architecture cannot be used in another. This is a limitation of LMDB. We need to dump the database using <code>mdb_dump</code> and load it using <code>mdb_load</code>.</p>
<p dir="auto">The db file cannot be opened by unmodified SQLite libraries.</p>
<p dir="auto">Savepoints are not yet supported.</p>
<h2 dir="auto"><a id="user-content-how-to-use" aria-hidden="true" href="#how-to-use"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How to use</h2>
<p dir="auto">LiteTree can be used in many programming languages via existing SQLite wrappers.</p>
<ol dir="auto">
<li>
<p dir="auto">Update your app to open the database file using an URI containing the <code>branches</code> parameter, like this:</p>
<div data-snippet-clipboard-copy-content="“file:data.db?branches=on”"><pre><code>“file:data.db?branches=on”
</code></pre></div>
</li>
<li>
<p dir="auto">Make your app use this new library instead of the pre-installed SQLite library:</p>
</li>
</ol>
<h3 dir="auto"><a id="user-content-on-linux" aria-hidden="true" href="#on-linux"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>On Linux</h3>
<p dir="auto">This can be achieved in 4 ways:</p>
<ul dir="auto">
<li>
<p dir="auto">Using the <code>LD_LIBRARY_PATH</code> environment variable:</p>
<div data-snippet-clipboard-copy-content=" LD_LIBRARY_PATH=/usr/local/lib/litetree ./myapp"><pre><code> LD_LIBRARY_PATH=/usr/local/lib/litetree ./myapp
</code></pre></div>
<p dir="auto">This can be used with all programming languages and wrappers.</p>
</li>
<li>
<p dir="auto">Patching your wrapper or app to search for the library in the new path:</p>
<div data-snippet-clipboard-copy-content=" patchelf --set-rpath /usr/local/lib/litetree lib_or_app"><pre><code> patchelf --set-rpath /usr/local/lib/litetree lib_or_app
</code></pre></div>
</li>
<li>
<p dir="auto">Setting the <code>rpath</code> at the link time:</p>
<div data-snippet-clipboard-copy-content=" LIBPATH = /usr/local/lib/litetree
 gcc myapp.c -Wl,-rpath,$(LIBPATH) -L$(LIBPATH) -lsqlite3"><pre><code> LIBPATH = /usr/local/lib/litetree
 gcc myapp.c -Wl,-rpath,$(LIBPATH) -L$(LIBPATH) -lsqlite3
</code></pre></div>
<p dir="auto">You can use this if your app is linking directly to the LiteTree library.</p>
</li>
<li>
<p dir="auto">Replacing the pre-installed SQLite library on your system</p>
<p dir="auto">This can also be used with many programming languages. But use it with care because the native library may have been compiled with different directives.</p>
</li>
</ul>
<h3 dir="auto"><a id="user-content-on-mac-osx" aria-hidden="true" href="#on-mac-osx"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>On Mac OSX</h3>
<p dir="auto">This can be achieved in these ways:</p>
<ul dir="auto">
<li>
<p dir="auto">Patching your wrapper or app to search for the library in the new path:</p>
<div data-snippet-clipboard-copy-content=" install_name_tool -change /old/path/to/libsqlite3.dylib /usr/local/lib/litetree/libsqlite3.dylib lib_or_app"><pre><code> install_name_tool -change /old/path/to/libsqlite3.dylib /usr/local/lib/litetree/libsqlite3.dylib lib_or_app
</code></pre></div>
<p dir="auto">You can check the old path with this command:</p>

<p dir="auto">This method can be used with all programming languages and wrappers as long as they are not protected by the OS.</p>
<p dir="auto">It it is protected then you will need to install a new copy of the wrapper, modify it and use it instead of the protected one.</p>
</li>
<li>
<p dir="auto">Using the <code>DYLD_LIBRARY_PATH</code> environment variable:</p>
<div data-snippet-clipboard-copy-content=" DYLD_LIBRARY_PATH=/usr/local/lib/litetree ./myapp"><pre><code> DYLD_LIBRARY_PATH=/usr/local/lib/litetree ./myapp
</code></pre></div>
<p dir="auto">This can be used if the wrapper was linked to just the library name and does not contain any path.</p>
<p dir="auto">If it does not work we can patch the wrapper to not contain any path:</p>
<div data-snippet-clipboard-copy-content=" install_name_tool -change /old/path/to/libsqlite3.dylib libsqlite3.dylib lib_or_app"><pre><code> install_name_tool -change /old/path/to/libsqlite3.dylib libsqlite3.dylib lib_or_app
</code></pre></div>
<p dir="auto">But if you are able to modify the wrapper with <code>install_name_tool</code> then the first method above may be better.</p>
</li>
<li>
<p dir="auto">Linking to the LiteTree library:</p>
<div data-snippet-clipboard-copy-content=" gcc myapp.c -L/usr/local/lib/litetree -lsqlite3"><pre><code> gcc myapp.c -L/usr/local/lib/litetree -lsqlite3
</code></pre></div>
</li>
</ul>
<h3 dir="auto"><a id="user-content-on-windows" aria-hidden="true" href="#on-windows"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>On Windows</h3>
<p dir="auto">Copy the modified SQLite library to the system folder.</p>
<ul dir="auto">
<li>
<p dir="auto">On 64 bit Windows:</p>
<p dir="auto">C:\Windows\System32 (if 64 bit DLL)</p>
<p dir="auto">C:\Windows\SysWOW64 (if 32 bit DLL)</p>
</li>
<li>
<p dir="auto">On 32 bit Windows:</p>
<p dir="auto">C:\Windows\System32</p>
</li>
</ul>
<h2 dir="auto"><a id="user-content-compiling-and-installing" aria-hidden="true" href="#compiling-and-installing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Compiling and installing</h2>
<h3 dir="auto"><a id="user-content-on-linux-and-mac-osx" aria-hidden="true" href="#on-linux-and-mac-osx"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>On Linux and Mac OSX</h3>
<p dir="auto">Install <a href="https://github.com/lmdb/lmdb">LMDB</a> if not already installed:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/lmdb/lmdb
cd lmdb/libraries/liblmdb
make
sudo make install"><pre><code>git clone https://github.com/lmdb/lmdb
cd lmdb/libraries/liblmdb
make
sudo make install
</code></pre></div>
<p dir="auto">Then install LiteTree:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/aergoio/litetree
cd litetree
make
sudo make install"><pre><code>git clone https://github.com/aergoio/litetree
cd litetree
make
sudo make install
</code></pre></div>
<h3 dir="auto"><a id="user-content-on-windows-1" aria-hidden="true" href="#on-windows-1"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>On Windows</h3>
<p dir="auto">You can use these pre-compiled binaries: (can be outdated)</p>
<ul dir="auto">
<li><a href="http://litesync.io/litetree/litetree-binaries-win-x86.zip" rel="nofollow">32 bit DLLs</a></li>
<li><a href="http://litesync.io/litetree/litetree-binaries-win-x64.zip" rel="nofollow">64 bit DLLs</a></li>
</ul>
<p dir="auto">Or follow these steps:</p>
<ol dir="auto">
<li>
<p dir="auto">Compile LMDB using <a href="https://github.com/kroggen/lmdb">MinGW</a> or Visual Studio (<a href="https://github.com/Ri0n/lmdb">1</a> or <a href="https://github.com/htaox/lightningdb-win">2</a>)</p>
</li>
<li>
<p dir="auto">Compile LiteTree using MinGW or Visual Studio</p>
</li>
<li>
<p dir="auto">Copy the libraries to the Windows System folder</p>
</li>
</ol>
<h2 dir="auto"><a id="user-content-running-the-tests" aria-hidden="true" href="#running-the-tests"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Running the Tests</h2>
<p dir="auto">The tests are written in Python using the <a href="https://github.com/ghaering/pysqlite">pysqlite</a> wrapper.</p>
<p dir="auto">On <strong>MacOSX</strong> we cannot use a modified SQLite library with the pre-installed system python due to the System Integrity Protection so we need to install another copy of pysqlite and link it to the LiteTree library:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/ghaering/pysqlite
cd pysqlite
echo &#34;include_dirs=/usr/local/include&#34; &gt;&gt; setup.cfg
echo &#34;library_dirs=/usr/local/lib/litetree&#34; &gt;&gt; setup.cfg
python setup.py build
sudo python setup.py install"><pre><code>git clone https://github.com/ghaering/pysqlite
cd pysqlite
echo &#34;include_dirs=/usr/local/include&#34; &gt;&gt; setup.cfg
echo &#34;library_dirs=/usr/local/lib/litetree&#34; &gt;&gt; setup.cfg
python setup.py build
sudo python setup.py install
</code></pre></div>
<p dir="auto">To run the tests:</p>

<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto">MIT</p>
<h2 dir="auto"><a id="user-content-creator" aria-hidden="true" href="#creator"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Creator</h2>
<p dir="auto">Developed by Bernardo Ramos at</p>
<p dir="auto"><a href="https://aergo.io" rel="nofollow"><img src="https://camo.githubusercontent.com/5bb7abbe65e62f5f4bb70632f8cc2ffc7cd678816e3c2b374ccd4530a5a69924/687474703a2f2f6c69746573796e632e696f2f6c697465747265652f616572676f2d6c6f676f2d626c61636b2d736c696d2e737667" width="30%" data-canonical-src="http://litesync.io/litetree/aergo-logo-black-slim.svg"/></a></p>
</article>
          </div></div>
  </body>
</html>
