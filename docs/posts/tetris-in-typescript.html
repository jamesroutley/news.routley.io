<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://marinhero.com/posts/typescript-tetris/">Original</a>
    <h1>Tetris, in TypeScript</h1>
    
    <div id="readability-page-1" class="page"><div><div>
<p>With the intention of getting more familiarized with TypeScript, I decided to start a new project.
Itâ€™s been many years since the last time I made a game from scrath so it seemed fitting to give that a go.
I chose Tetris because itâ€™s a well known game, with a defined set of problems and functionality. All I had to worry about was to code their solutions.</p>

<p>I did get more familiar with TypeScript, some of its strengths, caveats and tooling. Still, it would be hard (or overengineered) to cover all of the language features in a project. One important feature I left out is <a href="https://www.typescriptlang.org/docs/handbook/2/generics.html">generics</a>, perhaps I need to start working on <a href="https://en.wikipedia.org/wiki/Space_Invaders">Space Invaders</a> now so I can give it a try?</p>

<p>I tried to keep it as lean as possible, therefore this is the tech I used:</p>
<ul>
<li>TypeScript ðŸª›</li>
<li>HTML Canvas and CSS for drawing and coloring ðŸŽ¨</li>
<li>Webpack for bundling everything ðŸ“¦</li>
</ul>

<p>The most fun part of the project was to write the function to create the possible rotations for each piece. I could have used a hard-coded two dimensional array with all of them in there but whereâ€™s the fun in that?i Another downside of that approach is that I would have to limit the shapes of Tetris pieces I could use. Thanks to this function, I can create my custom shaped Tetris pieces! Anyway, <a href="https://github.com/marinhero/tsetris/blob/master/src/index.ts#L138">hereâ€™s</a> the function:</p>
<div><pre tabindex="0"><code data-lang="typescript"> <span>generateRotations</span>()<span>:</span> <span>Cell</span>[][][] {
    <span>let</span> <span>rots</span>: <span>Cell</span>[][][] <span>=</span> []
    <span>let</span> <span>nextBase</span>: <span>Cell</span>[][]

    <span>for</span> (<span>let</span> <span>rotationCounter</span> <span>=</span> <span>0</span>; <span>rotationCounter</span> <span>&lt;</span> <span>4</span>; <span>rotationCounter</span><span>++</span>) {
      <span>rots</span>[<span>rotationCounter</span>] <span>=</span> <span>new</span> <span>BlankPiece</span>(<span>this</span>.<span>rows</span>, <span>this</span>.<span>columns</span>).<span>shape</span>
      <span>let</span> <span>destY</span> <span>=</span> <span>this</span>.<span>columns</span> <span>-</span> <span>1</span>
      <span>for</span> (<span>let</span> <span>i</span> <span>=</span> <span>0</span>; <span>i</span> <span>&lt;</span> <span>this</span>.<span>columns</span>; <span>i</span><span>++</span>) {
        <span>let</span> <span>destX</span> <span>=</span> <span>0</span>
        <span>for</span> (<span>let</span> <span>j</span> <span>=</span> <span>0</span>; <span>j</span> <span>&lt;</span> <span>this</span>.<span>rows</span>; <span>j</span><span>++</span>) {
          <span>if</span> (<span>!</span><span>nextBase</span>) {
            <span>rots</span>[<span>rotationCounter</span>][<span>destY</span>][<span>destX</span>] <span>=</span> <span>this</span>.<span>shape</span>[<span>j</span>][<span>i</span>]
          } <span>else</span> {
            <span>rots</span>[<span>rotationCounter</span>][<span>destY</span>][<span>destX</span>] <span>=</span> <span>nextBase</span>[<span>j</span>][<span>i</span>]
          }
          <span>destX</span><span>++</span>
        }
        <span>destY</span><span>--</span>
      }
      <span>nextBase</span> <span>=</span> <span>rots</span>[<span>rotationCounter</span>]
    }
    <span>return</span> <span>rots</span>
  }
</code></pre></div><p>I enjoyed working on this function because I had to keep track of how the Tetris piece was moving on every iteration at the cell level. It also forced me to initialize the <code>rots</code> array with a <code>BlankPiece</code>. This is an object that <code>extends Piece</code>. Initializations of the same type arenâ€™t required in JavaScript but they are in TypeScript. It was a nice reminder that I had to think about the type system once again.</p>

<p>Game available <a href="https://marinhero.com/tsetris/">here</a> (limited mobile support because that was out of the scope ðŸ˜†)</p>
<p><img src="https://github.com/marinhero/tsetris/raw/master/dist/demo.gif" alt="Tetris"/></p>
</div></div></div>
  </body>
</html>
