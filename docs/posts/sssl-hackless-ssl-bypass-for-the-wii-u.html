<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/PretendoNetwork/SSSL">Original</a>
    <h1>SSSL â€“ Hackless SSL bypass for the Wii U</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<div dir="auto">
	<p><a target="_blank" rel="noopener noreferrer" href="https://github.com/PretendoNetwork/SSSL/blob/master/shutter.png"><img src="https://github.com/PretendoNetwork/SSSL/raw/master/shutter.png"/></a></p></div>
<p dir="auto">On March 1, 2021 Nintendo released Wii U firmware version <a href="https://wiiubrew.org/wiki/5.5.5" rel="nofollow">5.5.5</a>. This update updated the Wii U&#39;s SSL verification and recompiled all RPLs (though no code changes were made). The exact purpose for this update is unknown, as nothing of significance was changed, and no other changes were made in this update. With the changes to SSL verification, Nintendo introduced a bug which allows for the forging of SSL certificates. These forged certificates will be seen as &#34;Nintendo Signed&#34; and, due to an existing bug with how the Wii U handles CA common names, will be accepted by all domains.</p>

<p dir="auto">There are 2 bugs at play:</p>
<ol dir="auto">
<li>Normally a CA common name does not accept a single wildcard (*) value. They must contain a hostname, and optionally one or many wildcards for subdomains. The Wii U will accept a single * wildcard in place of a hostname, which allows the CA to be accepted as any domain. This bug has existed since before 5.5.5, but was not useful until now.</li>
<li>As of 5.5.5, CA&#39;s crafted in a specific way may take a newly introduced alternate path for verification. This allows for a CA&#39;s signature to not be verified correctly. Instead, the Wii U simply checks if the CA matches one already known by the system, but not the signature or contents of the CA. We have no idea why this change was made, as it does not benefit Nintendo at all. It almost feels intentional.</li>
</ol>

<p dir="auto">Not any CA will work. There are 3 conditions for a CA which still need to be met even for a forged CA to be accepted:</p>
<ol dir="auto">
<li>The CA needs to be one which the Wii U would already accept. The signature is not validated in this case, so modifying an existing CA works.</li>
<li>The Wii U does not allow a Root CA in the cert chain. It will ignore any certs that have a matching subject and authority key.</li>
<li>The title must not roll it&#39;s own SSL. WebKit titles such as the eShop, Miiverse, TVii, etc, as well as any game which uses it&#39;s own SSL library, will not work with these certificates.</li>
</ol>
<p dir="auto">The easiest way to exploit this bug is to use the Nintendo CA - G3 CA, and is what this script opts to do. This can be dumped from a Wii U&#39;s SSL certificates title at <code>/storage_mlc/sys/title/0005001b/10054000/content/scerts/CACERT_NINTENDO_CA_G3.der</code>. Changing the public key to a user-controlled key and changing the authority key identifier to anything else is all that is required. The resulting user-controlled private key and patched CA can be used to bypass SSL verification without any homebrew or CFW at all.</p>

<p dir="auto">This script takes in a PEM encoded copy of Nintendo CA - G3 and does the above patches and exports the patched CA and private key.</p>
<ul dir="auto">
<li>Install <a href="https://nodejs.org/" rel="nofollow">NodeJS</a></li>
<li><code>git clone https://github.com/PretendoNetwork/SSSL</code></li>
<li><code>cd SSSL</code></li>
<li><code>npm i</code> to install the dependencies</li>
<li><code>node patch</code> to run the patching wizard</li>
</ul>

<ul dir="auto">
<li>Shutterbug for actually finding the new verification bug</li>
<li>Jemma and Quarky for decompiling the updated SSL functions</li>
</ul>
</article></div></div>
  </body>
</html>
