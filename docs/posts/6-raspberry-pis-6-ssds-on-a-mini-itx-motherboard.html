<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jeffgeerling.com/blog/2022/6-raspberry-pis-6-ssds-on-mini-itx-motherboard">Original</a>
    <h1>6 Raspberry Pis, 6 SSDs on a Mini ITX Motherboard</h1>
    
    <div id="readability-page-1" class="page"><div><p>A few months ago someone told me about a new Raspberry Pi Compute Module 4 cluster board, the <a href="https://deskpi.com/collections/deskpi-super6c/products/deskpi-super6c-raspberry-pi-cm4-cluster-mini-itx-board-6-rpi-cm4-supported">DeskPi Super6c</a>.</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/deskpi-super6c-running.jpg" width="700" height="479" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-c8d15efa-242d-4995-ab63-68bd4629a3c9" data-insert-attach="{&#34;id&#34;:&#34;c8d15efa-242d-4995-ab63-68bd4629a3c9&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="DeskPi Super6c Running on Desk"/></p>

<p>You may have heard of another Pi CM4 cluster board, the <a href="https://www.jeffgeerling.com/blog/2021/turing-pi-2-4-raspberry-pi-nodes-on-mini-itx-board">Turing Pi 2</a>, but that board is not yet shipping. It had <a href="https://www.kickstarter.com/projects/turingpi/turing-pi-cluster-board">a <em>very</em> successful Kickstarter campaign</a>, but production has been delayed due to parts shortages.</p>

<p>The Turing Pi 2 offers some unique features, like Jetson Nano compatibility, remote management, a fully managed Ethernet switch (capable of VLAN support and link aggregation). But if you just want to slap a bunch of Raspberry Pis inside a tiny form factor, the Super6c is about as trim as you can get—and it&#39;s available today!</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/deskpi-super6c-top.jpeg" width="700" height="524" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-4b77119c-ba85-4115-bc01-8dedc7cd95e8" data-insert-attach="{&#34;id&#34;:&#34;4b77119c-ba85-4115-bc01-8dedc7cd95e8&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="DeskPi Super6c Top"/></p>

<p>On the top, there are slots for up to <em>six</em> Compute Module 4s, and each slot exposes IO pins (though not the full Pi GPIO), a Micro USB port for flashing eMMC CM4 modules, and some status LEDs.</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/deskpi-super6c-bottom.jpeg" width="700" height="453" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-5a26f0c3-5e67-4e1a-9260-0a81379a41b7" data-insert-attach="{&#34;id&#34;:&#34;5a26f0c3-5e67-4e1a-9260-0a81379a41b7&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="DeskPi Super6c bottom"/></p>

<p>On the bottom, there are <em>six</em> NVMe SSD slots (M.2 2280 M-key), and six microSD card slots, so you can boot Lite CM4 modules (those without built-in eMMC).</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/deskpi-super6c-io.jpeg" width="700" height="467" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-2b8006c7-e2f2-46ad-8893-256339cbf165" data-insert-attach="{&#34;id&#34;:&#34;2b8006c7-e2f2-46ad-8893-256339cbf165&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="DeskPi Super6c IO ports"/></p>

<p>On the IO side, there are a bunch of ports tied to CM4 slot 1—dual HDMI, two USB 2.0 (plus an internal USB 2.0 header), and micro USB, so you can manage the entire cluster self-contained. You can plug a keyboard, monitor, and mouse into the first node, and use it to set up everything else if you want. (That was one complaint I had with the Turing Pi 2—there was no option of managing the cluster without using another computer.)</p>

<p>There&#39;s also two power inputs: a barrel jack accepting 19-24V DC (the board comes with a 100W power adapter), and a 4-pin ATX 12V power header if you want to use an internal PSU.</p>

<p>Finally, there are six little activity LEDs sticking out the back, one for each Pi. Watching the cluster as Ceph was running made me think of <a href="https://www.youtube.com/watch?v=_aUHQKneAdw">WOPR, from the movie War Games</a>—just on a much smaller scale!</p>

<h2>Ceph storage cluster</h2>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/deskpi-super6c-storage-nvme-kioxia-xg6.jpg" width="700" height="394" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-ca1b8cbe-8c00-420c-9ea9-7ea9b413f49a" data-insert-attach="{&#34;id&#34;:&#34;ca1b8cbe-8c00-420c-9ea9-7ea9b413f49a&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="DeskPi Super6c bottom showing 6 NVMe SSDs - KIOXIA XG6"/></p>

<p>Since this board exposes so much storage directly on the underside, I decided to install <a href="https://ceph.com/en/">Ceph</a> on it using cephadm <a href="https://ceph.com/en/news/blog/2022/install-ceph-in-a-raspberrypi-4-cluster/">following this guide</a>.</p>

<p>Ceph is an open-source storage cluster solution that manages object/block/file-level storage across multiple computers and drives, similar to RAID on one computer—except you can aggregate multiple storage devices across multiple computers.</p>

<p>I had to do a couple extra steps during the install since I decided to run Raspberry Pi OS (a Debian derivative) instead of running Fedora like the guide suggested:</p>

<ol>
<li>I had to enable the backports repo by adding the line <code>deb http://deb.debian.org/debian unstable main contrib non-free</code> to my <code>/etc/apt/sources.list</code> file and then running <code>sudo apt update</code>.</li>
<li><p>I added a file at <code>/etc/apt/preferences.d/99pin-unstable</code> with the lines:</p>

<pre><code> Package: *
 Pin: release a=stable
 Pin-Priority: 900

 Package: *
 Pin: release a=unstable
 Pin-Priority: 10
</code></pre></li>
<li><p>After that, I could install cephadm with <code>sudo apt install -y cephadm</code></p></li>
</ol>

<p>Once <code>cephadm</code> was installed, I could set up the Ceph cluster using the following command (inserting the first node&#39;s IP address):</p>

<pre><code># cephadm bootstrap --mon-ip 10.0.100.149
</code></pre>

<p>This bootstraps a Ceph cluster, but you still need to add individual hosts to the cluster, and I elected to do that via Ceph&#39;s web UI. The <code>bootstrap</code> command outputs an admin login and the dashboard URL, so I went there, logged in, updated my password, and started adding hosts:</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/ceph-storage-hosts-super6c.jpg" width="700" height="394" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-3d8be3a7-f555-4a71-88b1-83a10ec86c33" data-insert-attach="{&#34;id&#34;:&#34;3d8be3a7-f555-4a71-88b1-83a10ec86c33&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="Super6c Ceph Storage Hosts dashboard 3.3 TiB"/></p>

<p>I built <a href="https://github.com/geerlingguy/deskpi-super6c-cluster">this Ansible playbook</a> to help with the setup, since there are a couple other steps that have to be run on <em>all</em> the nodes, like copying the Ceph pubkey to each node&#39;s root user <code>authorized_keys</code> file, and installing Podman and LVM2 on each node.</p>

<p>But once that was done, and all my hosts were added, I was able to set up a storage pool on the cluster, using the 3.3 TiB of built-in NVMe storage (distributed across five nodes). I used Ceph&#39;s built-in benchmarking tool <code>rados</code> to run some sequential write and read tests:</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/ceph-benchmarks-super6c-rados.jpg" width="700" height="394" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-63ed864b-1eb7-4e00-8f50-88e051a9a2b6" data-insert-attach="{&#34;id&#34;:&#34;63ed864b-1eb7-4e00-8f50-88e051a9a2b6&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="Ceph Super6c rados benchmarks for Pi storage cluster"/></p>

<p>I was able to get 70-80 MB/sec write speeds on the cluster, and 110 MB/sec read speeds. Not too bad, considering the entire thing&#39;s running over a 1 Gbps network. You can&#39;t really increase throughput due to the Pi&#39;s IO limitations—maybe in the next generation of Pi, we can get faster networking!</p>

<p>Throw in other features like encryption, though, and the speeds are sure to fall off a bit more. I also wanted to test an NFS mount across the Pis from my Mac, but I <a href="https://github.com/geerlingguy/deskpi-super6c-cluster/issues/1">kept getting errors when I tried adding the NFS service</a> to the cluster.</p>

<p>If you want to stick with an ARM build, a dedicated Ceph storage appliance like the <a href="https://store.avantek.co.uk/mars-400-ceph-storage-appliance.html">Mars 400</a> is still going to obliterate a hobbyist board like this, in terms of network bandwidth and IOPS—despite its slower CPUs. Of course, that performance comes at a cost; the Mars 400 is a $12,000 server!</p>

<h2>Video</h2>

<p>I produced a full video of the cluster build, with more information about the hardware and how I set it up, and that&#39;s embedded below:</p>

<div>
<p><iframe src="https://www.youtube.com/embed/ecdm3oA-QdQ" frameborder="0" allowfullscreen=""></iframe></p>
</div>

<p>For this project, I published the Ansible automation playbooks I set up in the <a href="https://github.com/geerlingguy/deskpi-super6c-cluster">DeskPi Super6c Cluster</a> repo on GitHub, and I&#39;ve also uploaded the <a href="https://www.thingiverse.com/thing:5465766">custom IO shield</a> I designed to Thingiverse.</p>

<h2>Conclusion</h2>

<p>This board seems ideal for experimentation—assuming <a href="https://rpilocator.com">you can find a bunch of CM4s for list price</a>. Especially if you&#39;re dipping your toes into the waters of K3s, Kubernetes, or Ceph, this board lets you throw together up to six physical nodes, without having to manage six power adapters, six network cables, and a separate network switch.</p>

<p>Many people will say &#34;just buy one PC and run VMs on it!&#34;, but to that, I say &#34;phooey.&#34; Dealing with physical nodes is a great way to learn more about networking, distributed storage, and multi-node application performance—much more so than running VMs inside a faster single node!</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/kill-a-watt-super6c-idle-6-pis.jpg" width="700" height="394" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-04913965-e29c-4791-9141-d5e8744ceb6a" data-insert-attach="{&#34;id&#34;:&#34;04913965-e29c-4791-9141-d5e8744ceb6a&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="Kill-A-Watt showing 17.9W idle power consumption for Super6c Pi cluster board"/></p>

<p>In terms of <em>production</em> usage, the Super6c could be useful in some edge computing scenarios, especially considering it uses just 17W of power for 6 nodes at idle, or about 24W maximum, but honestly, using other more powerful mini/SFF PCs would be more cost effective right now.</p></div></div>
  </body>
</html>
