<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/elesiuta/a17d93feb3d29971c3b5abbde69d53f3">Original</a>
    <h1>Show HN: Conway&#39;s Game of Chess</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Python" data-tagsearch-path="conway_chess.py">
        <tbody><tr>
          <td id="file-conway_chess-py-L1" data-line-number="1"></td>
          <td id="file-conway_chess-py-LC1"><span>#!/usr/bin/env python3</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L2" data-line-number="2"></td>
          <td id="file-conway_chess-py-LC2"><span># Conway&#39;s Game of Chess</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L3" data-line-number="3"></td>
          <td id="file-conway_chess-py-LC3"><span># Copyright (C) 2023 Eric Lesiuta</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L4" data-line-number="4"></td>
          <td id="file-conway_chess-py-LC4">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L5" data-line-number="5"></td>
          <td id="file-conway_chess-py-LC5"><span>import</span> <span>argparse</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L6" data-line-number="6"></td>
          <td id="file-conway_chess-py-LC6"><span>import</span> <span>atexit</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L7" data-line-number="7"></td>
          <td id="file-conway_chess-py-LC7"><span>import</span> <span>curses</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L8" data-line-number="8"></td>
          <td id="file-conway_chess-py-LC8"><span>import</span> <span>hashlib</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L9" data-line-number="9"></td>
          <td id="file-conway_chess-py-LC9"><span>import</span> <span>os</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L10" data-line-number="10"></td>
          <td id="file-conway_chess-py-LC10"><span>import</span> <span>pickle</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L11" data-line-number="11"></td>
          <td id="file-conway_chess-py-LC11"><span>import</span> <span>textwrap</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L12" data-line-number="12"></td>
          <td id="file-conway_chess-py-LC12"><span>import</span> <span>time</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L13" data-line-number="13"></td>
          <td id="file-conway_chess-py-LC13"><span>import</span> <span>socket</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L14" data-line-number="14"></td>
          <td id="file-conway_chess-py-LC14"><span>import</span> <span>sys</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L15" data-line-number="15"></td>
          <td id="file-conway_chess-py-LC15">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L16" data-line-number="16"></td>
          <td id="file-conway_chess-py-LC16">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L17" data-line-number="17"></td>
          <td id="file-conway_chess-py-LC17"><span>def</span> <span>exit_handler</span>(<span>engine</span>, <span>engine_state</span>, <span>conn</span>, <span>*</span><span>args</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L18" data-line-number="18"></td>
          <td id="file-conway_chess-py-LC18">    <span>&#34;&#34;&#34;clean up in the event of an exception and atexit functions aren&#39;t called&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L19" data-line-number="19"></td>
          <td id="file-conway_chess-py-LC19">    <span>type_</span>, <span>value</span>, <span>traceback</span> <span>=</span> <span>args</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L20" data-line-number="20"></td>
          <td id="file-conway_chess-py-LC20">    <span>print</span>(<span>type_</span>, <span>value</span>, <span>traceback</span>, <span>file</span><span>=</span><span>sys</span>.<span>stderr</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L21" data-line-number="21"></td>
          <td id="file-conway_chess-py-LC21">    <span>print</span>(<span>&#34; &#34;</span>.<span>join</span>(<span>engine</span>.<span>recent_moves_str</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L22" data-line-number="22"></td>
          <td id="file-conway_chess-py-LC22">    <span>with</span> <span>open</span>(<span>engine</span>.<span>args</span>.<span>save</span>, <span>&#34;wb&#34;</span>) <span>as</span> <span>f</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L23" data-line-number="23"></td>
          <td id="file-conway_chess-py-LC23">        <span>pickle</span>.<span>dump</span>(<span>engine_state</span>, <span>f</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L24" data-line-number="24"></td>
          <td id="file-conway_chess-py-LC24">    <span>if</span> <span>conn</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L25" data-line-number="25"></td>
          <td id="file-conway_chess-py-LC25">        <span>conn</span>.<span>close</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L26" data-line-number="26"></td>
          <td id="file-conway_chess-py-LC26">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L27" data-line-number="27"></td>
          <td id="file-conway_chess-py-LC27"><span>def</span> <span>start_cli</span>() <span>-&gt;</span> <span>int</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L28" data-line-number="28"></td>
          <td id="file-conway_chess-py-LC28">    <span># cli</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L29" data-line-number="29"></td>
          <td id="file-conway_chess-py-LC29">    <span>parser</span> <span>=</span> <span>argparse</span>.<span>ArgumentParser</span>(<span>description</span><span>=</span><span>&#34;Conway&#39;s game of chess&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L30" data-line-number="30"></td>
          <td id="file-conway_chess-py-LC30">    <span>parser</span>.<span>epilog</span> <span>=</span> <span>textwrap</span>.<span>dedent</span>(<span>&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L31" data-line-number="31"></td>
          <td id="file-conway_chess-py-LC31"><span>    Conway&#39;s game of chess is a chess variant where the pieces can reproduce and die.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L32" data-line-number="32"></td>
          <td id="file-conway_chess-py-LC32"><span>    Legend:             White birth queue ┐</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L33" data-line-number="33"></td>
          <td id="file-conway_chess-py-LC33"><span>    White: P R P N P B P Q P B P N P R  &lt;─┘</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L34" data-line-number="34"></td>
          <td id="file-conway_chess-py-LC34"><span>    ┌──────────────────────────────────────┐</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L35" data-line-number="35"></td>
          <td id="file-conway_chess-py-LC35"><span>    │ # &lt;─ White birth COUNTER on empty  w │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L36" data-line-number="36"></td>
          <td id="file-conway_chess-py-LC36"><span>    │      squares, born from queue on   ^ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L37" data-line-number="37"></td>
          <td id="file-conway_chess-py-LC37"><span>    │      next turn after reaching 2    │ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L38" data-line-number="38"></td>
          <td id="file-conway_chess-py-LC38"><span>    │                                    │ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L39" data-line-number="39"></td>
          <td id="file-conway_chess-py-LC39"><span>    │   INDICATOR that white has exactly ┘ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L40" data-line-number="40"></td>
          <td id="file-conway_chess-py-LC40"><span>    │   3 nearby pieces, birth counter     │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L41" data-line-number="41"></td>
          <td id="file-conway_chess-py-LC41"><span>    │   will increment at the start of the │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L42" data-line-number="42"></td>
          <td id="file-conway_chess-py-LC42"><span>    │   next turn, black birth counter and │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L43" data-line-number="43"></td>
          <td id="file-conway_chess-py-LC43"><span>    │   indicator are below and separate   │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L44" data-line-number="44"></td>
          <td id="file-conway_chess-py-LC44"><span>    │                                      │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L45" data-line-number="45"></td>
          <td id="file-conway_chess-py-LC45"><span>    │ #               ♔ &lt;─ Piece symbol  o │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L46" data-line-number="46"></td>
          <td id="file-conway_chess-py-LC46"><span>    │ ^                                  ^ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L47" data-line-number="47"></td>
          <td id="file-conway_chess-py-LC47"><span>    │ └ Death COUNTER on occupied        │ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L48" data-line-number="48"></td>
          <td id="file-conway_chess-py-LC48"><span>    │   squares, dies after reaching 3   │ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L49" data-line-number="49"></td>
          <td id="file-conway_chess-py-LC49"><span>    │                                    │ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L50" data-line-number="50"></td>
          <td id="file-conway_chess-py-LC50"><span>    │   INDICATOR that the piece has &gt; 3 ┘ │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L51" data-line-number="51"></td>
          <td id="file-conway_chess-py-LC51"><span>    │   nearby pieces (overpopulation),    │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L52" data-line-number="52"></td>
          <td id="file-conway_chess-py-LC52"><span>    │   or &lt; 2 nearby pieces               │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L53" data-line-number="53"></td>
          <td id="file-conway_chess-py-LC53"><span>    │   (underpopulation) and will die     │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L54" data-line-number="54"></td>
          <td id="file-conway_chess-py-LC54"><span>    │                                      │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L55" data-line-number="55"></td>
          <td id="file-conway_chess-py-LC55"><span>    │ # &lt;─ Black COUNTER &amp; INDICATOR ──&gt; l │</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L56" data-line-number="56"></td>
          <td id="file-conway_chess-py-LC56"><span>    └──────────────────────────────────────┘</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L57" data-line-number="57"></td>
          <td id="file-conway_chess-py-LC57"><span>    The INDICATORs are updated immediately when the conditions are met.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L58" data-line-number="58"></td>
          <td id="file-conway_chess-py-LC58"><span>    The COUNTERs are incremented only at the start of the respective player&#39;s turn.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L59" data-line-number="59"></td>
          <td id="file-conway_chess-py-LC59"><span>    Births and deaths also only occur at the start of the respective player&#39;s turn.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L60" data-line-number="60"></td>
          <td id="file-conway_chess-py-LC60"><span>    If the conditions for a birth or death counter are no longer met, (as shown by the indicators), the counter resets.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L61" data-line-number="61"></td>
          <td id="file-conway_chess-py-LC61"><span>    Opponent pieces are not counted as nearby pieces for the birth/death population criteria.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L62" data-line-number="62"></td>
          <td id="file-conway_chess-py-LC62"><span>    On birth, pieces are taken from the birth queue (circular) and placed on the board in order of rank then file.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L63" data-line-number="63"></td>
          <td id="file-conway_chess-py-LC63"><span>    Placement starts from rank 1 for white and rank 8 for black, with both filling the board from left to right.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L64" data-line-number="64"></td>
          <td id="file-conway_chess-py-LC64"><span>    The game ends when the king is captured or perishes due to over/underpopulation.</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L65" data-line-number="65"></td>
          <td id="file-conway_chess-py-LC65"><span>    &#34;&#34;&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L66" data-line-number="66"></td>
          <td id="file-conway_chess-py-LC66">    <span>parser</span>.<span>formatter_class</span> <span>=</span> <span>argparse</span>.<span>RawDescriptionHelpFormatter</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L67" data-line-number="67"></td>
          <td id="file-conway_chess-py-LC67">    <span>parser</span>.<span>add_argument</span>(<span>&#34;--flip&#34;</span>, <span>action</span><span>=</span><span>&#34;store_true&#34;</span>, <span>help</span><span>=</span><span>&#34;flip the board&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L68" data-line-number="68"></td>
          <td id="file-conway_chess-py-LC68">    <span>parser</span>.<span>add_argument</span>(<span>&#34;--save&#34;</span>, <span>action</span><span>=</span><span>&#34;store&#34;</span>, <span>metavar</span><span>=</span><span>&#34;FILE&#34;</span>, <span>default</span><span>=</span><span>&#34;conway_chess.pickle&#34;</span>, <span>help</span><span>=</span><span>&#34;save file location&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L69" data-line-number="69"></td>
          <td id="file-conway_chess-py-LC69">    <span>parser</span>.<span>add_argument</span>(<span>&#34;--load&#34;</span>, <span>action</span><span>=</span><span>&#34;store&#34;</span>, <span>metavar</span><span>=</span><span>&#34;FILE&#34;</span>, <span>help</span><span>=</span><span>&#34;load a save file&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L70" data-line-number="70"></td>
          <td id="file-conway_chess-py-LC70">    <span>parser</span>.<span>add_argument</span>(<span>&#34;--host&#34;</span>, <span>nargs</span><span>=</span><span>3</span>, <span>metavar</span><span>=</span>(<span>&#34;HOST&#34;</span>, <span>&#34;PORT&#34;</span>, <span>&#34;COLOR&#34;</span>), <span>help</span><span>=</span><span>&#34;host a game&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L71" data-line-number="71"></td>
          <td id="file-conway_chess-py-LC71">    <span>parser</span>.<span>add_argument</span>(<span>&#34;--join&#34;</span>, <span>nargs</span><span>=</span><span>2</span>, <span>metavar</span><span>=</span>(<span>&#34;HOST&#34;</span>, <span>&#34;PORT&#34;</span>), <span>help</span><span>=</span><span>&#34;join a game&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L72" data-line-number="72"></td>
          <td id="file-conway_chess-py-LC72">    <span>parser</span>.<span>add_argument</span>(<span>&#34;--ascii&#34;</span>, <span>action</span><span>=</span><span>&#34;store_true&#34;</span>, <span>help</span><span>=</span><span>&#34;use ascii characters for pieces&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L73" data-line-number="73"></td>
          <td id="file-conway_chess-py-LC73">    <span>parser</span>.<span>add_argument</span>(<span>&#34;--light&#34;</span>, <span>action</span><span>=</span><span>&#34;store_true&#34;</span>, <span>help</span><span>=</span><span>&#34;flip unicode piece colors for light terminals&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L74" data-line-number="74"></td>
          <td id="file-conway_chess-py-LC74">    <span>args</span> <span>=</span> <span>parser</span>.<span>parse_args</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L75" data-line-number="75"></td>
          <td id="file-conway_chess-py-LC75">    <span># print instructions before playing</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L76" data-line-number="76"></td>
          <td id="file-conway_chess-py-LC76">    <span>print</span>(<span>parser</span>.<span>epilog</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L77" data-line-number="77"></td>
          <td id="file-conway_chess-py-LC77">    <span>_</span> <span>=</span> <span>input</span>(<span>&#34;Press enter to play&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L78" data-line-number="78"></td>
          <td id="file-conway_chess-py-LC78">    <span># networking</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L79" data-line-number="79"></td>
          <td id="file-conway_chess-py-LC79">    <span>conn</span>, <span>my_colour</span> <span>=</span> <span>None</span>, <span>None</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L80" data-line-number="80"></td>
          <td id="file-conway_chess-py-LC80">    <span>if</span> <span>args</span>.<span>host</span> <span>and</span> <span>args</span>.<span>join</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L81" data-line-number="81"></td>
          <td id="file-conway_chess-py-LC81">        <span>print</span>(<span>&#34;You can only host or join a game, not both&#34;</span>, <span>file</span><span>=</span><span>sys</span>.<span>stderr</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L82" data-line-number="82"></td>
          <td id="file-conway_chess-py-LC82">        <span>return</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L83" data-line-number="83"></td>
          <td id="file-conway_chess-py-LC83">    <span>if</span> <span>args</span>.<span>host</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L84" data-line-number="84"></td>
          <td id="file-conway_chess-py-LC84">        <span>if</span> <span>args</span>.<span>host</span>[<span>2</span>] <span>not</span> <span>in</span> (<span>&#34;white&#34;</span>, <span>&#34;black&#34;</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L85" data-line-number="85"></td>
          <td id="file-conway_chess-py-LC85">            <span>print</span>(<span>&#34;You can only host as white or black&#34;</span>, <span>file</span><span>=</span><span>sys</span>.<span>stderr</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L86" data-line-number="86"></td>
          <td id="file-conway_chess-py-LC86">            <span>return</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L87" data-line-number="87"></td>
          <td id="file-conway_chess-py-LC87">        <span>s</span> <span>=</span> <span>socket</span>.<span>socket</span>(<span>socket</span>.<span>AF_INET</span>, <span>socket</span>.<span>SOCK_STREAM</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L88" data-line-number="88"></td>
          <td id="file-conway_chess-py-LC88">        <span># s = ssl._create_unverified_context().wrap_socket(s, server_side=True)</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L89" data-line-number="89"></td>
          <td id="file-conway_chess-py-LC89">        <span>s</span>.<span>bind</span>((<span>args</span>.<span>host</span>[<span>0</span>], <span>int</span>(<span>args</span>.<span>host</span>[<span>1</span>])))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L90" data-line-number="90"></td>
          <td id="file-conway_chess-py-LC90">        <span>s</span>.<span>listen</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L91" data-line-number="91"></td>
          <td id="file-conway_chess-py-LC91">        <span>conn</span>, <span>addr</span> <span>=</span> <span>s</span>.<span>accept</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L92" data-line-number="92"></td>
          <td id="file-conway_chess-py-LC92">        <span>conn</span>.<span>sendall</span>(<span>args</span>.<span>host</span>[<span>2</span>].<span>encode</span>())</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L93" data-line-number="93"></td>
          <td id="file-conway_chess-py-LC93">        <span>my_colour</span> <span>=</span> <span>args</span>.<span>host</span>[<span>2</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L94" data-line-number="94"></td>
          <td id="file-conway_chess-py-LC94">        <span>atexit</span>.<span>register</span>(<span>conn</span>.<span>close</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L95" data-line-number="95"></td>
          <td id="file-conway_chess-py-LC95">    <span>elif</span> <span>args</span>.<span>join</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L96" data-line-number="96"></td>
          <td id="file-conway_chess-py-LC96">        <span>conn</span> <span>=</span> <span>socket</span>.<span>socket</span>(<span>socket</span>.<span>AF_INET</span>, <span>socket</span>.<span>SOCK_STREAM</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L97" data-line-number="97"></td>
          <td id="file-conway_chess-py-LC97">        <span># conn = ssl._create_unverified_context().wrap_socket(conn, server_side=False)</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L98" data-line-number="98"></td>
          <td id="file-conway_chess-py-LC98">        <span>conn</span>.<span>connect</span>((<span>args</span>.<span>join</span>[<span>0</span>], <span>int</span>(<span>args</span>.<span>join</span>[<span>1</span>])))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L99" data-line-number="99"></td>
          <td id="file-conway_chess-py-LC99">        <span>host_colour</span> <span>=</span> <span>conn</span>.<span>recv</span>(<span>5</span>).<span>decode</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L100" data-line-number="100"></td>
          <td id="file-conway_chess-py-LC100">        <span>if</span> <span>host_colour</span> <span>==</span> <span>&#34;white&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L101" data-line-number="101"></td>
          <td id="file-conway_chess-py-LC101">            <span>my_colour</span> <span>=</span> <span>&#34;black&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L102" data-line-number="102"></td>
          <td id="file-conway_chess-py-LC102">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L103" data-line-number="103"></td>
          <td id="file-conway_chess-py-LC103">            <span>my_colour</span> <span>=</span> <span>&#34;white&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L104" data-line-number="104"></td>
          <td id="file-conway_chess-py-LC104">        <span>atexit</span>.<span>register</span>(<span>conn</span>.<span>close</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L105" data-line-number="105"></td>
          <td id="file-conway_chess-py-LC105">    <span># engine initialization</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L106" data-line-number="106"></td>
          <td id="file-conway_chess-py-LC106">    <span>engine</span> <span>=</span> <span>Engine</span>(<span>args</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L107" data-line-number="107"></td>
          <td id="file-conway_chess-py-LC107">    <span>engine_state</span> <span>=</span> [<span>pickle</span>.<span>dumps</span>(<span>engine</span>)]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L108" data-line-number="108"></td>
          <td id="file-conway_chess-py-LC108">    <span>engine_state_redo</span> <span>=</span> []</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L109" data-line-number="109"></td>
          <td id="file-conway_chess-py-LC109">    <span>if</span> <span>args</span>.<span>load</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L110" data-line-number="110"></td>
          <td id="file-conway_chess-py-LC110">        <span>engine_state</span> <span>=</span> <span>pickle</span>.<span>load</span>(<span>open</span>(<span>args</span>.<span>load</span>, <span>&#34;rb&#34;</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L111" data-line-number="111"></td>
          <td id="file-conway_chess-py-LC111">        <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>len</span>(<span>engine_state</span>)):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L112" data-line-number="112"></td>
          <td id="file-conway_chess-py-LC112">            <span>engine_state</span>[<span>i</span>] <span>=</span> <span>pickle</span>.<span>loads</span>(<span>engine_state</span>[<span>i</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L113" data-line-number="113"></td>
          <td id="file-conway_chess-py-LC113">            <span>engine_state</span>[<span>i</span>].<span>args</span> <span>=</span> <span>args</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L114" data-line-number="114"></td>
          <td id="file-conway_chess-py-LC114">            <span>engine_state</span>[<span>i</span>] <span>=</span> <span>pickle</span>.<span>dumps</span>(<span>engine_state</span>[<span>i</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L115" data-line-number="115"></td>
          <td id="file-conway_chess-py-LC115">        <span>engine</span> <span>=</span> <span>pickle</span>.<span>loads</span>(<span>engine_state</span>[<span>-</span><span>1</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L116" data-line-number="116"></td>
          <td id="file-conway_chess-py-LC116">    <span>atexit</span>.<span>register</span>(<span>lambda</span>: <span>print</span>(<span>&#34; &#34;</span>.<span>join</span>(<span>engine</span>.<span>recent_moves_str</span>)))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L117" data-line-number="117"></td>
          <td id="file-conway_chess-py-LC117">    <span>atexit</span>.<span>register</span>(<span>lambda</span>: <span>pickle</span>.<span>dump</span>(<span>engine_state</span>, <span>open</span>(<span>args</span>.<span>save</span>, <span>&#34;wb&#34;</span>)))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L118" data-line-number="118"></td>
          <td id="file-conway_chess-py-LC118">    <span>sys</span>.<span>excepthook</span> <span>=</span> <span>lambda</span> <span>*</span><span>args</span>: <span>exit_handler</span>(<span>engine</span>, <span>engine_state</span>, <span>conn</span>, <span>*</span><span>args</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L119" data-line-number="119"></td>
          <td id="file-conway_chess-py-LC119">    <span>try</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L120" data-line-number="120"></td>
          <td id="file-conway_chess-py-LC120">        <span>from</span> <span>stockfish</span> <span>import</span> <span>Stockfish</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L121" data-line-number="121"></td>
          <td id="file-conway_chess-py-LC121">        <span>stockfish</span> <span>=</span> <span>Stockfish</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L122" data-line-number="122"></td>
          <td id="file-conway_chess-py-LC122">    <span>except</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L123" data-line-number="123"></td>
          <td id="file-conway_chess-py-LC123">        <span>stockfish</span> <span>=</span> <span>None</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L124" data-line-number="124"></td>
          <td id="file-conway_chess-py-LC124">    <span># check terminal size</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L125" data-line-number="125"></td>
          <td id="file-conway_chess-py-LC125">    <span>columns</span>, <span>lines</span> <span>=</span> <span>os</span>.<span>get_terminal_size</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L126" data-line-number="126"></td>
          <td id="file-conway_chess-py-LC126">    <span>assert</span> <span>engine</span>.<span>height</span> <span>&lt;=</span> <span>lines</span>, <span>f&#34;Terminal height (<span><span>{</span><span>lines</span><span>}</span></span>) is too short by <span><span>{</span><span>engine</span>.<span>height</span> <span>-</span> <span>lines</span><span>}</span></span> lines&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L127" data-line-number="127"></td>
          <td id="file-conway_chess-py-LC127">    <span>assert</span> <span>engine</span>.<span>width</span> <span>&lt;=</span> <span>columns</span>, <span>f&#34;Terminal width (<span><span>{</span><span>columns</span><span>}</span></span>) is too narrow by <span><span>{</span><span>engine</span>.<span>width</span> <span>-</span> <span>columns</span><span>}</span></span> columns&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L128" data-line-number="128"></td>
          <td id="file-conway_chess-py-LC128">    <span># main curses loop</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L129" data-line-number="129"></td>
          <td id="file-conway_chess-py-LC129">    <span>for</span> <span>err_count</span> <span>in</span> <span>reversed</span>(<span>range</span>(<span>30</span>)):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L130" data-line-number="130"></td>
          <td id="file-conway_chess-py-LC130">        <span>try</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L131" data-line-number="131"></td>
          <td id="file-conway_chess-py-LC131">            <span>return</span> <span>curses</span>.<span>wrapper</span>(<span>main_loop</span>, <span>engine</span>, <span>engine_state</span>, <span>engine_state_redo</span>, <span>stockfish</span>, <span>conn</span>, <span>my_colour</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L132" data-line-number="132"></td>
          <td id="file-conway_chess-py-LC132">        <span>except</span> <span>curses</span>.<span>error</span> <span>as</span> <span>e</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L133" data-line-number="133"></td>
          <td id="file-conway_chess-py-LC133">            <span>print</span>(<span>&#34;CURSES ERROR: %s&#34;</span> <span>%</span> <span>e</span>, <span>file</span><span>=</span><span>sys</span>.<span>stderr</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L134" data-line-number="134"></td>
          <td id="file-conway_chess-py-LC134">            <span>print</span>(<span>&#34;try resizing your terminal, game will quit in %s seconds&#34;</span> <span>%</span> (<span>err_count</span> <span>+</span> <span>1</span>), <span>file</span><span>=</span><span>sys</span>.<span>stderr</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L135" data-line-number="135"></td>
          <td id="file-conway_chess-py-LC135">            <span>time</span>.<span>sleep</span>(<span>1</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L136" data-line-number="136"></td>
          <td id="file-conway_chess-py-LC136">        <span>except</span> <span>Exception</span> <span>as</span> <span>e</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L137" data-line-number="137"></td>
          <td id="file-conway_chess-py-LC137">            <span>print</span>(<span>&#34;ERROR: %s&#34;</span> <span>%</span> <span>e</span>, <span>file</span><span>=</span><span>sys</span>.<span>stderr</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L138" data-line-number="138"></td>
          <td id="file-conway_chess-py-LC138">            <span>return</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L139" data-line-number="139"></td>
          <td id="file-conway_chess-py-LC139">    <span>return</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L140" data-line-number="140"></td>
          <td id="file-conway_chess-py-LC140">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L141" data-line-number="141"></td>
          <td id="file-conway_chess-py-LC141"><span>def</span> <span>main_loop</span>(<span>stdscr</span>, <span>engine</span>: <span>&#34;Engine&#34;</span>, <span>engine_state</span>: <span>list</span>[<span>bytes</span>], <span>engine_state_redo</span>: <span>list</span>[<span>bytes</span>], <span>stockfish</span>, <span>conn</span>, <span>my_colour</span>) <span>-&gt;</span> <span>int</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L142" data-line-number="142"></td>
          <td id="file-conway_chess-py-LC142">    <span>&#34;&#34;&#34;main loop for the curses implementation of the game&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L143" data-line-number="143"></td>
          <td id="file-conway_chess-py-LC143">    <span>curses</span>.<span>cbreak</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L144" data-line-number="144"></td>
          <td id="file-conway_chess-py-LC144">    <span>curses</span>.<span>noecho</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L145" data-line-number="145"></td>
          <td id="file-conway_chess-py-LC145">    <span>while</span> <span>True</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L146" data-line-number="146"></td>
          <td id="file-conway_chess-py-LC146">        <span># refresh screen</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L147" data-line-number="147"></td>
          <td id="file-conway_chess-py-LC147">        <span>current_display</span> <span>=</span> <span>engine</span>.<span>display</span>(<span>my_colour</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L148" data-line-number="148"></td>
          <td id="file-conway_chess-py-LC148">        <span>stdscr</span>.<span>clear</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L149" data-line-number="149"></td>
          <td id="file-conway_chess-py-LC149">        <span>curses</span>.<span>init_pair</span>(<span>1</span>, <span>curses</span>.<span>COLOR_WHITE</span>, <span>curses</span>.<span>COLOR_BLUE</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L150" data-line-number="150"></td>
          <td id="file-conway_chess-py-LC150">        <span>curses</span>.<span>init_pair</span>(<span>2</span>, <span>curses</span>.<span>COLOR_BLUE</span>, <span>curses</span>.<span>COLOR_WHITE</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L151" data-line-number="151"></td>
          <td id="file-conway_chess-py-LC151">        <span>curses</span>.<span>init_pair</span>(<span>3</span>, <span>curses</span>.<span>COLOR_WHITE</span>, <span>curses</span>.<span>COLOR_BLUE</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L152" data-line-number="152"></td>
          <td id="file-conway_chess-py-LC152">        <span>curses</span>.<span>init_pair</span>(<span>4</span>, <span>curses</span>.<span>COLOR_YELLOW</span>, <span>curses</span>.<span>COLOR_WHITE</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L153" data-line-number="153"></td>
          <td id="file-conway_chess-py-LC153">        <span>curses</span>.<span>init_pair</span>(<span>5</span>, <span>curses</span>.<span>COLOR_YELLOW</span>, <span>curses</span>.<span>COLOR_BLUE</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L154" data-line-number="154"></td>
          <td id="file-conway_chess-py-LC154">        <span>curses</span>.<span>init_pair</span>(<span>6</span>, <span>curses</span>.<span>COLOR_GREEN</span>, <span>curses</span>.<span>COLOR_BLACK</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L155" data-line-number="155"></td>
          <td id="file-conway_chess-py-LC155">        <span>curses</span>.<span>init_pair</span>(<span>7</span>, <span>curses</span>.<span>COLOR_YELLOW</span>, <span>curses</span>.<span>COLOR_BLACK</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L156" data-line-number="156"></td>
          <td id="file-conway_chess-py-LC156">        <span>curses</span>.<span>init_pair</span>(<span>8</span>, <span>curses</span>.<span>COLOR_RED</span>, <span>curses</span>.<span>COLOR_BLACK</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L157" data-line-number="157"></td>
          <td id="file-conway_chess-py-LC157">        <span>curses</span>.<span>init_pair</span>(<span>9</span>, <span>curses</span>.<span>COLOR_CYAN</span>, <span>curses</span>.<span>COLOR_BLACK</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L158" data-line-number="158"></td>
          <td id="file-conway_chess-py-LC158">        <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>0</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L159" data-line-number="159"></td>
          <td id="file-conway_chess-py-LC159">        <span>y</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L160" data-line-number="160"></td>
          <td id="file-conway_chess-py-LC160">        <span>for</span> <span>line</span> <span>in</span> <span>current_display</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L161" data-line-number="161"></td>
          <td id="file-conway_chess-py-LC161">            <span>for</span> <span>x</span>, <span>char</span> <span>in</span> <span>enumerate</span>(<span>line</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L162" data-line-number="162"></td>
          <td id="file-conway_chess-py-LC162">                <span># pieces</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L163" data-line-number="163"></td>
          <td id="file-conway_chess-py-LC163">                <span>if</span> <span>char</span> <span>in</span> <span>&#34;RNBQKP&#34;</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L164" data-line-number="164"></td>
          <td id="file-conway_chess-py-LC164">                    <span>if</span> <span>engine</span>.<span>use_unicode</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L165" data-line-number="165"></td>
          <td id="file-conway_chess-py-LC165">                        <span>char</span> <span>=</span> <span>engine</span>.<span>unicode_replacements</span>[<span>char</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L166" data-line-number="166"></td>
          <td id="file-conway_chess-py-LC166">                    <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L167" data-line-number="167"></td>
          <td id="file-conway_chess-py-LC167">                        <span>if</span> <span>char</span> <span>==</span> <span>&#34;K&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L168" data-line-number="168"></td>
          <td id="file-conway_chess-py-LC168">                            <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>4</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L169" data-line-number="169"></td>
          <td id="file-conway_chess-py-LC169">                        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L170" data-line-number="170"></td>
          <td id="file-conway_chess-py-LC170">                            <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>2</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L171" data-line-number="171"></td>
          <td id="file-conway_chess-py-LC171">                <span>elif</span> <span>char</span> <span>in</span> <span>&#34;rnbqkp&#34;</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L172" data-line-number="172"></td>
          <td id="file-conway_chess-py-LC172">                    <span>if</span> <span>engine</span>.<span>use_unicode</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L173" data-line-number="173"></td>
          <td id="file-conway_chess-py-LC173">                        <span>char</span> <span>=</span> <span>engine</span>.<span>unicode_replacements</span>[<span>char</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L174" data-line-number="174"></td>
          <td id="file-conway_chess-py-LC174">                    <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L175" data-line-number="175"></td>
          <td id="file-conway_chess-py-LC175">                        <span>if</span> <span>char</span> <span>==</span> <span>&#34;k&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L176" data-line-number="176"></td>
          <td id="file-conway_chess-py-LC176">                            <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>5</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L177" data-line-number="177"></td>
          <td id="file-conway_chess-py-LC177">                        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L178" data-line-number="178"></td>
          <td id="file-conway_chess-py-LC178">                            <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>3</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L179" data-line-number="179"></td>
          <td id="file-conway_chess-py-LC179">                <span># indicators</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L180" data-line-number="180"></td>
          <td id="file-conway_chess-py-LC180">                <span>elif</span> <span>char</span> <span>in</span> <span>&#34;wl&#34;</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L181" data-line-number="181"></td>
          <td id="file-conway_chess-py-LC181">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>9</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L182" data-line-number="182"></td>
          <td id="file-conway_chess-py-LC182">                <span>elif</span> <span>char</span> <span>in</span> <span>&#34;ou&#34;</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L183" data-line-number="183"></td>
          <td id="file-conway_chess-py-LC183">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>7</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L184" data-line-number="184"></td>
          <td id="file-conway_chess-py-LC184">                <span># death counters</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L185" data-line-number="185"></td>
          <td id="file-conway_chess-py-LC185">                <span>elif</span> <span>char</span> <span>==</span> <span>&#34;0&#34;</span> <span>and</span> <span>x</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>x</span> <span>&lt;</span> <span>engine</span>.<span>width</span> <span>-</span> <span>1</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span> <span>and</span> (<span>y</span> <span>-</span> <span>5</span>) <span>%</span> <span>4</span> <span>==</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L186" data-line-number="186"></td>
          <td id="file-conway_chess-py-LC186">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>7</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L187" data-line-number="187"></td>
          <td id="file-conway_chess-py-LC187">                <span>elif</span> <span>char</span> <span>==</span> <span>&#34;1&#34;</span> <span>and</span> <span>x</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>x</span> <span>&lt;</span> <span>engine</span>.<span>width</span> <span>-</span> <span>1</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span> <span>and</span> (<span>y</span> <span>-</span> <span>5</span>) <span>%</span> <span>4</span> <span>==</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L188" data-line-number="188"></td>
          <td id="file-conway_chess-py-LC188">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>7</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L189" data-line-number="189"></td>
          <td id="file-conway_chess-py-LC189">                <span>elif</span> <span>char</span> <span>==</span> <span>&#34;2&#34;</span> <span>and</span> <span>x</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>x</span> <span>&lt;</span> <span>engine</span>.<span>width</span> <span>-</span> <span>1</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span> <span>and</span> (<span>y</span> <span>-</span> <span>5</span>) <span>%</span> <span>4</span> <span>==</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L190" data-line-number="190"></td>
          <td id="file-conway_chess-py-LC190">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>7</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L191" data-line-number="191"></td>
          <td id="file-conway_chess-py-LC191">                <span>elif</span> <span>char</span> <span>==</span> <span>&#34;3&#34;</span> <span>and</span> <span>x</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>x</span> <span>&lt;</span> <span>engine</span>.<span>width</span> <span>-</span> <span>1</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span> <span>and</span> (<span>y</span> <span>-</span> <span>5</span>) <span>%</span> <span>4</span> <span>==</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L192" data-line-number="192"></td>
          <td id="file-conway_chess-py-LC192">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>8</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L193" data-line-number="193"></td>
          <td id="file-conway_chess-py-LC193">                <span># birth counters</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L194" data-line-number="194"></td>
          <td id="file-conway_chess-py-LC194">                <span>elif</span> <span>char</span> <span>==</span> <span>&#34;0&#34;</span> <span>and</span> <span>x</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>x</span> <span>&lt;</span> <span>engine</span>.<span>width</span> <span>-</span> <span>1</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span> <span>and</span> (<span>y</span> <span>-</span> <span>5</span>) <span>%</span> <span>4</span> <span>!=</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L195" data-line-number="195"></td>
          <td id="file-conway_chess-py-LC195">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>9</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L196" data-line-number="196"></td>
          <td id="file-conway_chess-py-LC196">                <span>elif</span> <span>char</span> <span>==</span> <span>&#34;1&#34;</span> <span>and</span> <span>x</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>x</span> <span>&lt;</span> <span>engine</span>.<span>width</span> <span>-</span> <span>1</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span> <span>and</span> (<span>y</span> <span>-</span> <span>5</span>) <span>%</span> <span>4</span> <span>!=</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L197" data-line-number="197"></td>
          <td id="file-conway_chess-py-LC197">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>9</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L198" data-line-number="198"></td>
          <td id="file-conway_chess-py-LC198">                <span>elif</span> <span>char</span> <span>==</span> <span>&#34;2&#34;</span> <span>and</span> <span>x</span> <span>&gt;</span> <span>1</span> <span>and</span> <span>x</span> <span>&lt;</span> <span>engine</span>.<span>width</span> <span>-</span> <span>1</span> <span>and</span> <span>y</span> <span>&gt;</span> <span>4</span> <span>and</span> <span>y</span> <span>&lt;</span> <span>engine</span>.<span>height</span> <span>-</span> <span>2</span> <span>and</span> (<span>y</span> <span>-</span> <span>5</span>) <span>%</span> <span>4</span> <span>!=</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L199" data-line-number="199"></td>
          <td id="file-conway_chess-py-LC199">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>6</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L200" data-line-number="200"></td>
          <td id="file-conway_chess-py-LC200">                <span># board</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L201" data-line-number="201"></td>
          <td id="file-conway_chess-py-LC201">                <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L202" data-line-number="202"></td>
          <td id="file-conway_chess-py-LC202">                    <span>stdscr</span>.<span>attrset</span>(<span>curses</span>.<span>color_pair</span>(<span>0</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L203" data-line-number="203"></td>
          <td id="file-conway_chess-py-LC203">                <span>stdscr</span>.<span>addstr</span>(<span>y</span>, <span>x</span>, <span>char</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L204" data-line-number="204"></td>
          <td id="file-conway_chess-py-LC204">            <span>y</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L205" data-line-number="205"></td>
          <td id="file-conway_chess-py-LC205">        <span>stdscr</span>.<span>move</span>(<span>*</span><span>engine</span>.<span>get_cursor</span>())</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L206" data-line-number="206"></td>
          <td id="file-conway_chess-py-LC206">        <span>stdscr</span>.<span>refresh</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L207" data-line-number="207"></td>
          <td id="file-conway_chess-py-LC207">        <span># check for key press, sync with network player if connected, and update engine state</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L208" data-line-number="208"></td>
          <td id="file-conway_chess-py-LC208">        <span>key</span> <span>=</span> <span>None</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L209" data-line-number="209"></td>
          <td id="file-conway_chess-py-LC209">        <span>if</span> <span>conn</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L210" data-line-number="210"></td>
          <td id="file-conway_chess-py-LC210">            <span>if</span> <span>my_colour</span> <span>==</span> <span>engine</span>.<span>current_turn</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L211" data-line-number="211"></td>
          <td id="file-conway_chess-py-LC211">                <span>ch</span>: <span>int</span> <span>=</span> <span>stdscr</span>.<span>getch</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L212" data-line-number="212"></td>
          <td id="file-conway_chess-py-LC212">                <span>ch</span> <span>=</span> <span>engine</span>.<span>flip_cursor_y</span>(<span>ch</span>, <span>curses</span>.<span>KEY_UP</span>, <span>curses</span>.<span>KEY_DOWN</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L213" data-line-number="213"></td>
          <td id="file-conway_chess-py-LC213">                <span>conn</span>.<span>sendall</span>(<span>ch</span>.<span>to_bytes</span>(<span>2</span>, <span>&#34;big&#34;</span>) <span>+</span> <span>hashlib</span>.<span>sha256</span>(<span>pickle</span>.<span>dumps</span>(<span>engine</span>.<span>recent_moves_str</span>)).<span>digest</span>()[<span>-</span><span>2</span>:])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L214" data-line-number="214"></td>
          <td id="file-conway_chess-py-LC214">            <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L215" data-line-number="215"></td>
          <td id="file-conway_chess-py-LC215">                <span>msg</span> <span>=</span> <span>conn</span>.<span>recv</span>(<span>4</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L216" data-line-number="216"></td>
          <td id="file-conway_chess-py-LC216">                <span>ch</span> <span>=</span> <span>int</span>.<span>from_bytes</span>(<span>msg</span>[:<span>2</span>], <span>&#34;big&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L217" data-line-number="217"></td>
          <td id="file-conway_chess-py-LC217">                <span>hash_lsb</span> <span>=</span> <span>msg</span>[<span>2</span>:]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L218" data-line-number="218"></td>
          <td id="file-conway_chess-py-LC218">                <span>assert</span> <span>hash_lsb</span> <span>==</span> <span>hashlib</span>.<span>sha256</span>(<span>pickle</span>.<span>dumps</span>(<span>engine</span>.<span>recent_moves_str</span>)).<span>digest</span>()[<span>-</span><span>2</span>:], <span>f&#34;client and server are out of sync&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L219" data-line-number="219"></td>
          <td id="file-conway_chess-py-LC219">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L220" data-line-number="220"></td>
          <td id="file-conway_chess-py-LC220">            <span>ch</span>: <span>int</span> <span>=</span> <span>stdscr</span>.<span>getch</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L221" data-line-number="221"></td>
          <td id="file-conway_chess-py-LC221">            <span>ch</span> <span>=</span> <span>engine</span>.<span>flip_cursor_y</span>(<span>ch</span>, <span>curses</span>.<span>KEY_UP</span>, <span>curses</span>.<span>KEY_DOWN</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L222" data-line-number="222"></td>
          <td id="file-conway_chess-py-LC222">        <span>if</span> <span>ch</span> <span>==</span> <span>ord</span>(<span>&#34;<span>\n</span>&#34;</span>) <span>or</span> <span>ch</span> <span>==</span> <span>ord</span>(<span>&#34; &#34;</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L223" data-line-number="223"></td>
          <td id="file-conway_chess-py-LC223">            <span>key</span> <span>=</span> <span>&#34;enter&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L224" data-line-number="224"></td>
          <td id="file-conway_chess-py-LC224">        <span>elif</span> <span>ch</span> <span>==</span> <span>ord</span>(<span>&#34;s&#34;</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L225" data-line-number="225"></td>
          <td id="file-conway_chess-py-LC225">            <span>key</span> <span>=</span> <span>&#34;stockfish&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L226" data-line-number="226"></td>
          <td id="file-conway_chess-py-LC226">        <span>elif</span> <span>ch</span> <span>==</span> <span>curses</span>.<span>KEY_UP</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L227" data-line-number="227"></td>
          <td id="file-conway_chess-py-LC227">            <span>key</span> <span>=</span> <span>&#34;up&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L228" data-line-number="228"></td>
          <td id="file-conway_chess-py-LC228">        <span>elif</span> <span>ch</span> <span>==</span> <span>curses</span>.<span>KEY_DOWN</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L229" data-line-number="229"></td>
          <td id="file-conway_chess-py-LC229">            <span>key</span> <span>=</span> <span>&#34;down&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L230" data-line-number="230"></td>
          <td id="file-conway_chess-py-LC230">        <span>elif</span> <span>ch</span> <span>==</span> <span>curses</span>.<span>KEY_LEFT</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L231" data-line-number="231"></td>
          <td id="file-conway_chess-py-LC231">            <span>key</span> <span>=</span> <span>&#34;left&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L232" data-line-number="232"></td>
          <td id="file-conway_chess-py-LC232">        <span>elif</span> <span>ch</span> <span>==</span> <span>curses</span>.<span>KEY_RIGHT</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L233" data-line-number="233"></td>
          <td id="file-conway_chess-py-LC233">            <span>key</span> <span>=</span> <span>&#34;right&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L234" data-line-number="234"></td>
          <td id="file-conway_chess-py-LC234">        <span>elif</span> <span>ch</span> <span>==</span> <span>curses</span>.<span>KEY_BACKSPACE</span> <span>or</span> <span>ch</span> <span>==</span> <span>ord</span>(<span>&#34;u&#34;</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L235" data-line-number="235"></td>
          <td id="file-conway_chess-py-LC235">            <span>if</span> <span>len</span>(<span>engine_state</span>) <span>&gt;=</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L236" data-line-number="236"></td>
          <td id="file-conway_chess-py-LC236">                <span>engine_state_redo</span>.<span>append</span>(<span>engine_state</span>.<span>pop</span>())</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L237" data-line-number="237"></td>
          <td id="file-conway_chess-py-LC237">                <span>engine</span> <span>=</span> <span>pickle</span>.<span>loads</span>(<span>engine_state</span>[<span>-</span><span>1</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L238" data-line-number="238"></td>
          <td id="file-conway_chess-py-LC238">            <span>continue</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L239" data-line-number="239"></td>
          <td id="file-conway_chess-py-LC239">        <span>elif</span> <span>ch</span> <span>==</span> <span>ord</span>(<span>&#34;r&#34;</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L240" data-line-number="240"></td>
          <td id="file-conway_chess-py-LC240">            <span>if</span> <span>engine_state_redo</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L241" data-line-number="241"></td>
          <td id="file-conway_chess-py-LC241">                <span>engine_state</span>.<span>append</span>(<span>engine_state_redo</span>.<span>pop</span>())</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L242" data-line-number="242"></td>
          <td id="file-conway_chess-py-LC242">                <span>engine</span> <span>=</span> <span>pickle</span>.<span>loads</span>(<span>engine_state</span>[<span>-</span><span>1</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L243" data-line-number="243"></td>
          <td id="file-conway_chess-py-LC243">            <span>continue</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L244" data-line-number="244"></td>
          <td id="file-conway_chess-py-LC244">        <span>elif</span> <span>ch</span> <span>==</span> <span>27</span> <span>or</span> <span>ch</span> <span>==</span> <span>ord</span>(<span>&#34;q&#34;</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L245" data-line-number="245"></td>
          <td id="file-conway_chess-py-LC245">            <span>key</span> <span>=</span> <span>&#34;esc&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L246" data-line-number="246"></td>
          <td id="file-conway_chess-py-LC246">            <span>return</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L247" data-line-number="247"></td>
          <td id="file-conway_chess-py-LC247">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L248" data-line-number="248"></td>
          <td id="file-conway_chess-py-LC248">            <span>key</span> <span>=</span> <span>&#34;other&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L249" data-line-number="249"></td>
          <td id="file-conway_chess-py-LC249">        <span>if</span> <span>engine</span>.<span>update_state</span>(<span>key</span>, <span>stockfish</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L250" data-line-number="250"></td>
          <td id="file-conway_chess-py-LC250">            <span>engine_state</span>.<span>append</span>(<span>pickle</span>.<span>dumps</span>(<span>engine</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L251" data-line-number="251"></td>
          <td id="file-conway_chess-py-LC251">            <span>engine_state_redo</span> <span>=</span> []</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L252" data-line-number="252"></td>
          <td id="file-conway_chess-py-LC252">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L253" data-line-number="253"></td>
          <td id="file-conway_chess-py-LC253">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L254" data-line-number="254"></td>
          <td id="file-conway_chess-py-LC254"><span>class</span> <span>Engine</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L255" data-line-number="255"></td>
          <td id="file-conway_chess-py-LC255">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>args</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L256" data-line-number="256"></td>
          <td id="file-conway_chess-py-LC256">        <span>self</span>.<span>args</span> <span>=</span> <span>args</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L257" data-line-number="257"></td>
          <td id="file-conway_chess-py-LC257">        <span>self</span>.<span>board</span> <span>=</span> <span>Board</span>(<span>self</span>.<span>args</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L258" data-line-number="258"></td>
          <td id="file-conway_chess-py-LC258">        <span># tick all the pieces for the first turn</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L259" data-line-number="259"></td>
          <td id="file-conway_chess-py-LC259">        <span>for</span> <span>piece</span> <span>in</span> <span>self</span>.<span>board</span>.<span>get_pieces</span>():</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L260" data-line-number="260"></td>
          <td id="file-conway_chess-py-LC260">            <span>piece</span>.<span>tick</span>(<span>self</span>.<span>board</span>.<span>get_surrounding_pieces</span>(<span>piece</span>), <span>&#34;white&#34;</span>, <span>True</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L261" data-line-number="261"></td>
          <td id="file-conway_chess-py-LC261">        <span>self</span>.<span>cursor_row</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L262" data-line-number="262"></td>
          <td id="file-conway_chess-py-LC262">        <span>self</span>.<span>cursor_col</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L263" data-line-number="263"></td>
          <td id="file-conway_chess-py-LC263">        <span>self</span>.<span>height</span> <span>=</span> <span>len</span>(<span>self</span>.<span>board</span>.<span>display</span>()) <span>+</span> <span>5</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L264" data-line-number="264"></td>
          <td id="file-conway_chess-py-LC264">        <span>self</span>.<span>width</span> <span>=</span> <span>len</span>(<span>self</span>.<span>board</span>.<span>display</span>()[<span>0</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L265" data-line-number="265"></td>
          <td id="file-conway_chess-py-LC265">        <span>self</span>.<span>white_birth_queue</span> <span>=</span> [<span>&#34;P&#34;</span>, <span>&#34;R&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;N&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;B&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;Q&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;B&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;N&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;R&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L266" data-line-number="266"></td>
          <td id="file-conway_chess-py-LC266">        <span>self</span>.<span>black_birth_queue</span> <span>=</span> [<span>&#34;P&#34;</span>, <span>&#34;R&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;N&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;B&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;Q&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;B&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;N&#34;</span>, <span>&#34;P&#34;</span>, <span>&#34;R&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L267" data-line-number="267"></td>
          <td id="file-conway_chess-py-LC267">        <span>self</span>.<span>selected_piece</span> <span>=</span> <span>None</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L268" data-line-number="268"></td>
          <td id="file-conway_chess-py-LC268">        <span>self</span>.<span>current_turn</span> <span>=</span> <span>&#34;white&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L269" data-line-number="269"></td>
          <td id="file-conway_chess-py-LC269">        <span>self</span>.<span>col_labels</span> <span>=</span> [<span>&#34;a&#34;</span>, <span>&#34;b&#34;</span>, <span>&#34;c&#34;</span>, <span>&#34;d&#34;</span>, <span>&#34;e&#34;</span>, <span>&#34;f&#34;</span>, <span>&#34;g&#34;</span>, <span>&#34;h&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L270" data-line-number="270"></td>
          <td id="file-conway_chess-py-LC270">        <span>self</span>.<span>recent_moves</span> <span>=</span> []</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L271" data-line-number="271"></td>
          <td id="file-conway_chess-py-LC271">        <span>self</span>.<span>recent_moves_str</span> <span>=</span> []</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L272" data-line-number="272"></td>
          <td id="file-conway_chess-py-LC272">        <span>self</span>.<span>game_over_message</span> <span>=</span> <span>None</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L273" data-line-number="273"></td>
          <td id="file-conway_chess-py-LC273">        <span>self</span>.<span>use_unicode</span> <span>=</span> <span>not</span> <span>self</span>.<span>args</span>.<span>ascii</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L274" data-line-number="274"></td>
          <td id="file-conway_chess-py-LC274">        <span>self</span>.<span>unicode_pieces</span> <span>=</span> <span>&#34;♟♜♞♝♛♚♙♖♘♗♕♔&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L275" data-line-number="275"></td>
          <td id="file-conway_chess-py-LC275">        <span>self</span>.<span>ascii_pieces</span> <span>=</span> <span>&#34;PRNBQKprnbqk&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L276" data-line-number="276"></td>
          <td id="file-conway_chess-py-LC276">        <span>if</span> <span>self</span>.<span>args</span>.<span>light</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L277" data-line-number="277"></td>
          <td id="file-conway_chess-py-LC277">            <span>self</span>.<span>ascii_pieces</span> <span>=</span> <span>&#34;prnbqkPRNBQK&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L278" data-line-number="278"></td>
          <td id="file-conway_chess-py-LC278">        <span>self</span>.<span>unicode_replacements</span> <span>=</span> <span>dict</span>(<span>zip</span>(<span>self</span>.<span>ascii_pieces</span>, <span>self</span>.<span>unicode_pieces</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L279" data-line-number="279"></td>
          <td id="file-conway_chess-py-LC279">        <span>assert</span> <span>self</span>.<span>height</span> <span>==</span> <span>len</span>(<span>self</span>.<span>display</span>(<span>None</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L280" data-line-number="280"></td>
          <td id="file-conway_chess-py-LC280">        <span>assert</span> <span>self</span>.<span>width</span> <span>==</span> <span>len</span>(<span>self</span>.<span>display</span>(<span>None</span>)[<span>0</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L281" data-line-number="281"></td>
          <td id="file-conway_chess-py-LC281">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L282" data-line-number="282"></td>
          <td id="file-conway_chess-py-LC282">    <span>def</span> <span>get_cursor</span>(<span>self</span>) <span>-&gt;</span> <span>tuple</span>[<span>int</span>, <span>int</span>]:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L283" data-line-number="283"></td>
          <td id="file-conway_chess-py-LC283">        <span>&#34;&#34;&#34;get the position of the cursor in terms of display row and column&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L284" data-line-number="284"></td>
          <td id="file-conway_chess-py-LC284">        <span>if</span> <span>self</span>.<span>args</span>.<span>flip</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L285" data-line-number="285"></td>
          <td id="file-conway_chess-py-LC285">            <span>real_row</span> <span>=</span> (<span>7</span> <span>-</span> <span>self</span>.<span>cursor_row</span>) <span>*</span> <span>4</span> <span>+</span> <span>7</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L286" data-line-number="286"></td>
          <td id="file-conway_chess-py-LC286">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L287" data-line-number="287"></td>
          <td id="file-conway_chess-py-LC287">            <span>real_row</span> <span>=</span> <span>self</span>.<span>cursor_row</span> <span>*</span> <span>4</span> <span>+</span> <span>7</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L288" data-line-number="288"></td>
          <td id="file-conway_chess-py-LC288">        <span>real_col</span> <span>=</span> <span>self</span>.<span>cursor_col</span> <span>*</span> <span>6</span> <span>+</span> <span>4</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L289" data-line-number="289"></td>
          <td id="file-conway_chess-py-LC289">        <span>return</span> <span>real_row</span>, <span>real_col</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L290" data-line-number="290"></td>
          <td id="file-conway_chess-py-LC290">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L291" data-line-number="291"></td>
          <td id="file-conway_chess-py-LC291">    <span>def</span> <span>flip_cursor_y</span>(<span>self</span>, <span>ch</span>: <span>int</span>, <span>key_up</span>: <span>int</span>, <span>key_down</span>: <span>int</span>) <span>-&gt;</span> <span>int</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L292" data-line-number="292"></td>
          <td id="file-conway_chess-py-LC292">        <span>&#34;&#34;&#34;flip the key press for up and down&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L293" data-line-number="293"></td>
          <td id="file-conway_chess-py-LC293">        <span>if</span> <span>self</span>.<span>args</span>.<span>flip</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L294" data-line-number="294"></td>
          <td id="file-conway_chess-py-LC294">            <span>if</span> <span>ch</span> <span>==</span> <span>key_up</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L295" data-line-number="295"></td>
          <td id="file-conway_chess-py-LC295">                <span>return</span> <span>key_down</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L296" data-line-number="296"></td>
          <td id="file-conway_chess-py-LC296">            <span>elif</span> <span>ch</span> <span>==</span> <span>key_down</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L297" data-line-number="297"></td>
          <td id="file-conway_chess-py-LC297">                <span>return</span> <span>key_up</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L298" data-line-number="298"></td>
          <td id="file-conway_chess-py-LC298">        <span>return</span> <span>ch</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L299" data-line-number="299"></td>
          <td id="file-conway_chess-py-LC299">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L300" data-line-number="300"></td>
          <td id="file-conway_chess-py-LC300">    <span>def</span> <span>display</span>(<span>self</span>, <span>my_colour</span>) <span>-&gt;</span> <span>list</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L301" data-line-number="301"></td>
          <td id="file-conway_chess-py-LC301">        <span>board</span> <span>=</span> <span>self</span>.<span>board</span>.<span>display</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L302" data-line-number="302"></td>
          <td id="file-conway_chess-py-LC302">        <span>if</span> <span>self</span>.<span>game_over_message</span> <span>is</span> <span>not</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L303" data-line-number="303"></td>
          <td id="file-conway_chess-py-LC303">            <span>header</span> <span>=</span> <span>f&#34;Game over: <span><span>{</span><span>self</span>.<span>game_over_message</span><span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L304" data-line-number="304"></td>
          <td id="file-conway_chess-py-LC304">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L305" data-line-number="305"></td>
          <td id="file-conway_chess-py-LC305">            <span>header</span> <span>=</span> <span>f&#34;Current turn: <span><span>{</span><span>self</span>.<span>current_turn</span><span>}</span></span><span><span>{</span><span>&#39; (your turn)&#39;</span> <span>if</span> <span>my_colour</span> <span>==</span> <span>self</span>.<span>current_turn</span> <span>else</span> <span>&#39;&#39;</span><span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L306" data-line-number="306"></td>
          <td id="file-conway_chess-py-LC306">        <span>board</span>.<span>insert</span>(<span>0</span>, <span>list</span>(<span>header</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L307" data-line-number="307"></td>
          <td id="file-conway_chess-py-LC307">        <span>if</span> <span>self</span>.<span>selected_piece</span> <span>is</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L308" data-line-number="308"></td>
          <td id="file-conway_chess-py-LC308">            <span>header_2</span> <span>=</span> <span>&#34;Selected: None&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L309" data-line-number="309"></td>
          <td id="file-conway_chess-py-LC309">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L310" data-line-number="310"></td>
          <td id="file-conway_chess-py-LC310">            <span>header_2</span> <span>=</span> <span>f&#34;Selected: <span><span>{</span><span>self</span>.<span>selected_piece</span><span>}</span></span><span><span>{</span><span>self</span>.<span>col_labels</span>[<span>self</span>.<span>selected_piece</span>.<span>col</span>]<span>}</span></span><span><span>{</span><span>self</span>.<span>selected_piece</span>.<span>row</span> <span>+</span> <span>1</span><span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L311" data-line-number="311"></td>
          <td id="file-conway_chess-py-LC311">        <span>board</span>.<span>insert</span>(<span>1</span>, <span>list</span>(<span>header_2</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L312" data-line-number="312"></td>
          <td id="file-conway_chess-py-LC312">        <span>header_3</span> <span>=</span> <span>f&#34;Recent moves: <span><span>{</span><span>&#39; | &#39;</span>.<span>join</span>(<span>self</span>.<span>recent_moves_str</span>[<span>-</span><span>3</span>:])<span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L313" data-line-number="313"></td>
          <td id="file-conway_chess-py-LC313">        <span>board</span>.<span>insert</span>(<span>2</span>, <span>list</span>(<span>header_3</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L314" data-line-number="314"></td>
          <td id="file-conway_chess-py-LC314">        <span>if</span> <span>self</span>.<span>use_unicode</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L315" data-line-number="315"></td>
          <td id="file-conway_chess-py-LC315">            <span>white_queue</span> <span>=</span> <span>f&#34;White: <span><span>{</span><span>&#39; &#39;</span>.<span>join</span>([<span>self</span>.<span>unicode_replacements</span>[<span>piece</span>] <span>for</span> <span>piece</span> <span>in</span> <span>self</span>.<span>white_birth_queue</span>])<span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L316" data-line-number="316"></td>
          <td id="file-conway_chess-py-LC316">            <span>black_queue</span> <span>=</span> <span>f&#34;Black: <span><span>{</span><span>&#39; &#39;</span>.<span>join</span>([<span>self</span>.<span>unicode_replacements</span>[<span>piece</span>.<span>lower</span>()] <span>for</span> <span>piece</span> <span>in</span> <span>self</span>.<span>black_birth_queue</span>])<span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L317" data-line-number="317"></td>
          <td id="file-conway_chess-py-LC317">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L318" data-line-number="318"></td>
          <td id="file-conway_chess-py-LC318">            <span>white_queue</span> <span>=</span> <span>f&#34;White: <span><span>{</span><span>&#39; &#39;</span>.<span>join</span>(<span>self</span>.<span>white_birth_queue</span>)<span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L319" data-line-number="319"></td>
          <td id="file-conway_chess-py-LC319">            <span>black_queue</span> <span>=</span> <span>f&#34;Black: <span><span>{</span><span>&#39; &#39;</span>.<span>join</span>(<span>self</span>.<span>black_birth_queue</span>)<span>}</span></span>&#34;</span>.<span>center</span>(<span>self</span>.<span>width</span>, <span>&#34; &#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L320" data-line-number="320"></td>
          <td id="file-conway_chess-py-LC320">        <span>if</span> <span>self</span>.<span>args</span>.<span>flip</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L321" data-line-number="321"></td>
          <td id="file-conway_chess-py-LC321">            <span>board</span>.<span>insert</span>(<span>3</span>, <span>list</span>(<span>black_queue</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L322" data-line-number="322"></td>
          <td id="file-conway_chess-py-LC322">            <span>board</span>.<span>append</span>(<span>list</span>(<span>white_queue</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L323" data-line-number="323"></td>
          <td id="file-conway_chess-py-LC323">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L324" data-line-number="324"></td>
          <td id="file-conway_chess-py-LC324">            <span>board</span>.<span>insert</span>(<span>3</span>, <span>list</span>(<span>white_queue</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L325" data-line-number="325"></td>
          <td id="file-conway_chess-py-LC325">            <span>board</span>.<span>append</span>(<span>list</span>(<span>black_queue</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L326" data-line-number="326"></td>
          <td id="file-conway_chess-py-LC326">        <span>return</span> <span>board</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L327" data-line-number="327"></td>
          <td id="file-conway_chess-py-LC327">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L328" data-line-number="328"></td>
          <td id="file-conway_chess-py-LC328">    <span>def</span> <span>move_is_valid</span>(<span>self</span>, <span>source</span>, <span>dest</span>, <span>stockfish</span>) <span>-&gt;</span> <span>bool</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L329" data-line-number="329"></td>
          <td id="file-conway_chess-py-LC329">        <span>source_row</span> <span>=</span> <span>source</span>.<span>row</span> <span>+</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L330" data-line-number="330"></td>
          <td id="file-conway_chess-py-LC330">        <span>source_col</span> <span>=</span> <span>self</span>.<span>col_labels</span>[<span>source</span>.<span>col</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L331" data-line-number="331"></td>
          <td id="file-conway_chess-py-LC331">        <span>dest_row</span> <span>=</span> <span>dest</span>.<span>row</span> <span>+</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L332" data-line-number="332"></td>
          <td id="file-conway_chess-py-LC332">        <span>dest_col</span> <span>=</span> <span>self</span>.<span>col_labels</span>[<span>dest</span>.<span>col</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L333" data-line-number="333"></td>
          <td id="file-conway_chess-py-LC333">        <span>move_str</span> <span>=</span> <span>f&#34;<span><span>{</span><span>source</span><span>}</span></span><span><span>{</span><span>source_col</span><span>}</span></span><span><span>{</span><span>source_row</span><span>}</span></span>-&gt;<span><span>{</span><span>dest</span><span>}</span></span><span><span>{</span><span>dest_col</span><span>}</span></span><span><span>{</span><span>dest_row</span><span>}</span></span>&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L334" data-line-number="334"></td>
          <td id="file-conway_chess-py-LC334">        <span>if</span> <span>source</span>.<span>move_is_valid</span>(<span>dest</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L335" data-line-number="335"></td>
          <td id="file-conway_chess-py-LC335">            <span>if</span> <span>stockfish</span> <span>is</span> <span>not</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L336" data-line-number="336"></td>
          <td id="file-conway_chess-py-LC336">                <span>try</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L337" data-line-number="337"></td>
          <td id="file-conway_chess-py-LC337">                    <span>stockfish</span>.<span>set_fen_position</span>(<span>self</span>.<span>board</span>.<span>get_fen_position</span>(<span>self</span>.<span>current_turn</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L338" data-line-number="338"></td>
          <td id="file-conway_chess-py-LC338">                    <span>if</span> <span>stockfish</span>.<span>is_move_correct</span>(<span>f&#34;<span><span>{</span><span>source_col</span><span>}</span></span><span><span>{</span><span>source_row</span><span>}</span></span><span><span>{</span><span>dest_col</span><span>}</span></span><span><span>{</span><span>dest_row</span><span>}</span></span>&#34;</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L339" data-line-number="339"></td>
          <td id="file-conway_chess-py-LC339">                        <span>self</span>.<span>recent_moves</span>.<span>append</span>((<span>source</span>, <span>dest</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L340" data-line-number="340"></td>
          <td id="file-conway_chess-py-LC340">                        <span>self</span>.<span>recent_moves_str</span>.<span>append</span>(<span>move_str</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L341" data-line-number="341"></td>
          <td id="file-conway_chess-py-LC341">                        <span>return</span> <span>True</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L342" data-line-number="342"></td>
          <td id="file-conway_chess-py-LC342">                    <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L343" data-line-number="343"></td>
          <td id="file-conway_chess-py-LC343">                        <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L344" data-line-number="344"></td>
          <td id="file-conway_chess-py-LC344">                <span>except</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L345" data-line-number="345"></td>
          <td id="file-conway_chess-py-LC345">                    <span>self</span>.<span>recent_moves</span>.<span>append</span>((<span>source</span>, <span>dest</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L346" data-line-number="346"></td>
          <td id="file-conway_chess-py-LC346">                    <span>self</span>.<span>recent_moves_str</span>.<span>append</span>(<span>move_str</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L347" data-line-number="347"></td>
          <td id="file-conway_chess-py-LC347">                    <span>return</span> <span>True</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L348" data-line-number="348"></td>
          <td id="file-conway_chess-py-LC348">            <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L349" data-line-number="349"></td>
          <td id="file-conway_chess-py-LC349">                <span>self</span>.<span>recent_moves</span>.<span>append</span>((<span>source</span>, <span>dest</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L350" data-line-number="350"></td>
          <td id="file-conway_chess-py-LC350">                <span>self</span>.<span>recent_moves_str</span>.<span>append</span>(<span>move_str</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L351" data-line-number="351"></td>
          <td id="file-conway_chess-py-LC351">                <span>return</span> <span>True</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L352" data-line-number="352"></td>
          <td id="file-conway_chess-py-LC352">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L353" data-line-number="353"></td>
          <td id="file-conway_chess-py-LC353">            <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L354" data-line-number="354"></td>
          <td id="file-conway_chess-py-LC354">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L355" data-line-number="355"></td>
          <td id="file-conway_chess-py-LC355">    <span>def</span> <span>update_state</span>(<span>self</span>, <span>key</span>, <span>stockfish</span>) <span>-&gt;</span> <span>bool</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L356" data-line-number="356"></td>
          <td id="file-conway_chess-py-LC356">        <span>&#34;&#34;&#34;returns whether there was a state change&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L357" data-line-number="357"></td>
          <td id="file-conway_chess-py-LC357">        <span># cursor</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L358" data-line-number="358"></td>
          <td id="file-conway_chess-py-LC358">        <span>if</span> <span>key</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L359" data-line-number="359"></td>
          <td id="file-conway_chess-py-LC359">            <span>if</span> <span>key</span> <span>==</span> <span>&#34;up&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L360" data-line-number="360"></td>
          <td id="file-conway_chess-py-LC360">                <span>self</span>.<span>cursor_row</span> <span>=</span> (<span>self</span>.<span>cursor_row</span> <span>-</span> <span>1</span>) <span>%</span> <span>8</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L361" data-line-number="361"></td>
          <td id="file-conway_chess-py-LC361">            <span>elif</span> <span>key</span> <span>==</span> <span>&#34;down&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L362" data-line-number="362"></td>
          <td id="file-conway_chess-py-LC362">                <span>self</span>.<span>cursor_row</span> <span>=</span> (<span>self</span>.<span>cursor_row</span> <span>+</span> <span>1</span>) <span>%</span> <span>8</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L363" data-line-number="363"></td>
          <td id="file-conway_chess-py-LC363">            <span>elif</span> <span>key</span> <span>==</span> <span>&#34;left&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L364" data-line-number="364"></td>
          <td id="file-conway_chess-py-LC364">                <span>self</span>.<span>cursor_col</span> <span>=</span> (<span>self</span>.<span>cursor_col</span> <span>-</span> <span>1</span>) <span>%</span> <span>8</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L365" data-line-number="365"></td>
          <td id="file-conway_chess-py-LC365">            <span>elif</span> <span>key</span> <span>==</span> <span>&#34;right&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L366" data-line-number="366"></td>
          <td id="file-conway_chess-py-LC366">                <span>self</span>.<span>cursor_col</span> <span>=</span> (<span>self</span>.<span>cursor_col</span> <span>+</span> <span>1</span>) <span>%</span> <span>8</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L367" data-line-number="367"></td>
          <td id="file-conway_chess-py-LC367">            <span>elif</span> <span>key</span> <span>==</span> <span>&#34;stockfish&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L368" data-line-number="368"></td>
          <td id="file-conway_chess-py-LC368">                <span>try</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L369" data-line-number="369"></td>
          <td id="file-conway_chess-py-LC369">                    <span>if</span> <span>stockfish</span> <span>is</span> <span>not</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L370" data-line-number="370"></td>
          <td id="file-conway_chess-py-LC370">                        <span>stockfish</span>.<span>set_fen_position</span>(<span>self</span>.<span>board</span>.<span>get_fen_position</span>(<span>self</span>.<span>current_turn</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L371" data-line-number="371"></td>
          <td id="file-conway_chess-py-LC371">                        <span>move</span> <span>=</span> <span>stockfish</span>.<span>get_best_move</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L372" data-line-number="372"></td>
          <td id="file-conway_chess-py-LC372">                        <span>if</span> <span>move</span> <span>is</span> <span>not</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L373" data-line-number="373"></td>
          <td id="file-conway_chess-py-LC373">                            <span>self</span>.<span>selected_piece</span> <span>=</span> <span>self</span>.<span>board</span>.<span>get_piece</span>(<span>int</span>(<span>move</span>[<span>1</span>]) <span>-</span> <span>1</span>, <span>ord</span>(<span>move</span>[<span>0</span>]) <span>-</span> <span>ord</span>(<span>&#34;a&#34;</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L374" data-line-number="374"></td>
          <td id="file-conway_chess-py-LC374">                            <span>self</span>.<span>cursor_row</span> <span>=</span> <span>int</span>(<span>move</span>[<span>3</span>]) <span>-</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L375" data-line-number="375"></td>
          <td id="file-conway_chess-py-LC375">                            <span>self</span>.<span>cursor_col</span> <span>=</span> <span>ord</span>(<span>move</span>[<span>2</span>]) <span>-</span> <span>ord</span>(<span>&#34;a&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L376" data-line-number="376"></td>
          <td id="file-conway_chess-py-LC376">                            <span>key</span> <span>=</span> <span>&#34;enter&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L377" data-line-number="377"></td>
          <td id="file-conway_chess-py-LC377">                <span>except</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L378" data-line-number="378"></td>
          <td id="file-conway_chess-py-LC378">                    <span>pass</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L379" data-line-number="379"></td>
          <td id="file-conway_chess-py-LC379">            <span>if</span> <span>key</span> <span>==</span> <span>&#34;enter&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L380" data-line-number="380"></td>
          <td id="file-conway_chess-py-LC380">                <span>if</span> <span>self</span>.<span>selected_piece</span> <span>is</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L381" data-line-number="381"></td>
          <td id="file-conway_chess-py-LC381">                    <span># select a piece</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L382" data-line-number="382"></td>
          <td id="file-conway_chess-py-LC382">                    <span>if</span> <span>self</span>.<span>board</span>.<span>get_piece</span>(<span>self</span>.<span>cursor_row</span>, <span>self</span>.<span>cursor_col</span>).<span>side</span> <span>==</span> <span>self</span>.<span>current_turn</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L383" data-line-number="383"></td>
          <td id="file-conway_chess-py-LC383">                        <span>self</span>.<span>selected_piece</span> <span>=</span> <span>self</span>.<span>board</span>.<span>get_piece</span>(<span>self</span>.<span>cursor_row</span>, <span>self</span>.<span>cursor_col</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L384" data-line-number="384"></td>
          <td id="file-conway_chess-py-LC384">                <span>elif</span> <span>self</span>.<span>move_is_valid</span>(<span>self</span>.<span>selected_piece</span>, <span>self</span>.<span>board</span>.<span>get_piece</span>(<span>self</span>.<span>cursor_row</span>, <span>self</span>.<span>cursor_col</span>), <span>stockfish</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L385" data-line-number="385"></td>
          <td id="file-conway_chess-py-LC385">                    <span># move the selected piece to the cursor</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L386" data-line-number="386"></td>
          <td id="file-conway_chess-py-LC386">                    <span>try</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L387" data-line-number="387"></td>
          <td id="file-conway_chess-py-LC387">                        <span>self</span>.<span>board</span>.<span>move_piece</span>(<span>self</span>.<span>selected_piece</span>, <span>self</span>.<span>board</span>.<span>get_piece</span>(<span>self</span>.<span>cursor_row</span>, <span>self</span>.<span>cursor_col</span>))</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L388" data-line-number="388"></td>
          <td id="file-conway_chess-py-LC388">                    <span>except</span> <span>Exception</span> <span>as</span> <span>e</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L389" data-line-number="389"></td>
          <td id="file-conway_chess-py-LC389">                        <span>self</span>.<span>game_over_message</span> <span>=</span> <span>str</span>(<span>e</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L390" data-line-number="390"></td>
          <td id="file-conway_chess-py-LC390">                        <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L391" data-line-number="391"></td>
          <td id="file-conway_chess-py-LC391">                    <span>self</span>.<span>selected_piece</span> <span>=</span> <span>None</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L392" data-line-number="392"></td>
          <td id="file-conway_chess-py-LC392">                    <span>self</span>.<span>current_turn</span> <span>=</span> <span>&#34;black&#34;</span> <span>if</span> <span>self</span>.<span>current_turn</span> <span>==</span> <span>&#34;white&#34;</span> <span>else</span> <span>&#34;white&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L393" data-line-number="393"></td>
          <td id="file-conway_chess-py-LC393">                    <span># tick all the pieces at the start of the next turn</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L394" data-line-number="394"></td>
          <td id="file-conway_chess-py-LC394">                    <span>for</span> <span>piece</span> <span>in</span> <span>self</span>.<span>board</span>.<span>get_pieces</span>():</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L395" data-line-number="395"></td>
          <td id="file-conway_chess-py-LC395">                        <span>piece</span>.<span>tick</span>(<span>self</span>.<span>board</span>.<span>get_surrounding_pieces</span>(<span>piece</span>), <span>self</span>.<span>current_turn</span>, <span>True</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L396" data-line-number="396"></td>
          <td id="file-conway_chess-py-LC396">                    <span># check if any pieces need to be born</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L397" data-line-number="397"></td>
          <td id="file-conway_chess-py-LC397">                    <span>if</span> <span>self</span>.<span>current_turn</span> <span>==</span> <span>&#34;white&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L398" data-line-number="398"></td>
          <td id="file-conway_chess-py-LC398">                        <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>8</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L399" data-line-number="399"></td>
          <td id="file-conway_chess-py-LC399">                            <span>for</span> <span>j</span> <span>in</span> <span>range</span>(<span>8</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L400" data-line-number="400"></td>
          <td id="file-conway_chess-py-LC400">                                <span>piece</span> <span>=</span> <span>self</span>.<span>board</span>.<span>get_piece</span>(<span>i</span>, <span>j</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L401" data-line-number="401"></td>
          <td id="file-conway_chess-py-LC401">                                <span>if</span> <span>piece</span>.<span>side</span> <span>==</span> <span>&#34;empty&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L402" data-line-number="402"></td>
          <td id="file-conway_chess-py-LC402">                                    <span>if</span> <span>piece</span>.<span>birth_counter_white</span> <span>==</span> <span>3</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L403" data-line-number="403"></td>
          <td id="file-conway_chess-py-LC403">                                        <span>next_piece</span> <span>=</span> <span>self</span>.<span>white_birth_queue</span>.<span>pop</span>(<span>0</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L404" data-line-number="404"></td>
          <td id="file-conway_chess-py-LC404">                                        <span>self</span>.<span>board</span>.<span>set_new_piece</span>(<span>i</span>, <span>j</span>, <span>next_piece</span>, <span>&#34;white&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L405" data-line-number="405"></td>
          <td id="file-conway_chess-py-LC405">                                        <span>self</span>.<span>white_birth_queue</span>.<span>append</span>(<span>next_piece</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L406" data-line-number="406"></td>
          <td id="file-conway_chess-py-LC406">                    <span>elif</span> <span>self</span>.<span>current_turn</span> <span>==</span> <span>&#34;black&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L407" data-line-number="407"></td>
          <td id="file-conway_chess-py-LC407">                        <span>for</span> <span>i</span> <span>in</span> <span>reversed</span>(<span>range</span>(<span>8</span>)):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L408" data-line-number="408"></td>
          <td id="file-conway_chess-py-LC408">                            <span>for</span> <span>j</span> <span>in</span> <span>range</span>(<span>8</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L409" data-line-number="409"></td>
          <td id="file-conway_chess-py-LC409">                                <span>piece</span> <span>=</span> <span>self</span>.<span>board</span>.<span>get_piece</span>(<span>i</span>, <span>j</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L410" data-line-number="410"></td>
          <td id="file-conway_chess-py-LC410">                                <span>if</span> <span>piece</span>.<span>side</span> <span>==</span> <span>&#34;empty&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L411" data-line-number="411"></td>
          <td id="file-conway_chess-py-LC411">                                    <span>if</span> <span>piece</span>.<span>birth_counter_black</span> <span>==</span> <span>3</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L412" data-line-number="412"></td>
          <td id="file-conway_chess-py-LC412">                                        <span>next_piece</span> <span>=</span> <span>self</span>.<span>black_birth_queue</span>.<span>pop</span>(<span>0</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L413" data-line-number="413"></td>
          <td id="file-conway_chess-py-LC413">                                        <span>self</span>.<span>board</span>.<span>set_new_piece</span>(<span>i</span>, <span>j</span>, <span>next_piece</span>, <span>&#34;black&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L414" data-line-number="414"></td>
          <td id="file-conway_chess-py-LC414">                                        <span>self</span>.<span>black_birth_queue</span>.<span>append</span>(<span>next_piece</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L415" data-line-number="415"></td>
          <td id="file-conway_chess-py-LC415">                    <span># check if any pieces need to die</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L416" data-line-number="416"></td>
          <td id="file-conway_chess-py-LC416">                    <span>for</span> <span>piece</span> <span>in</span> <span>self</span>.<span>board</span>.<span>get_pieces</span>():</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L417" data-line-number="417"></td>
          <td id="file-conway_chess-py-LC417">                        <span>if</span> <span>piece</span>.<span>death_counter</span> <span>==</span> <span>4</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L418" data-line-number="418"></td>
          <td id="file-conway_chess-py-LC418">                            <span>try</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L419" data-line-number="419"></td>
          <td id="file-conway_chess-py-LC419">                                <span>self</span>.<span>board</span>.<span>kill_piece</span>(<span>piece</span>, <span>self</span>.<span>current_turn</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L420" data-line-number="420"></td>
          <td id="file-conway_chess-py-LC420">                            <span>except</span> <span>Exception</span> <span>as</span> <span>e</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L421" data-line-number="421"></td>
          <td id="file-conway_chess-py-LC421">                                <span>self</span>.<span>game_over_message</span> <span>=</span> <span>str</span>(<span>e</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L422" data-line-number="422"></td>
          <td id="file-conway_chess-py-LC422">                                <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L423" data-line-number="423"></td>
          <td id="file-conway_chess-py-LC423">                    <span># recalculate nearby pieces for indicators</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L424" data-line-number="424"></td>
          <td id="file-conway_chess-py-LC424">                    <span>for</span> <span>piece</span> <span>in</span> <span>self</span>.<span>board</span>.<span>get_pieces</span>():</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L425" data-line-number="425"></td>
          <td id="file-conway_chess-py-LC425">                        <span>piece</span>.<span>tick</span>(<span>self</span>.<span>board</span>.<span>get_surrounding_pieces</span>(<span>piece</span>), <span>self</span>.<span>current_turn</span>, <span>False</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L426" data-line-number="426"></td>
          <td id="file-conway_chess-py-LC426">                    <span>return</span> <span>True</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L427" data-line-number="427"></td>
          <td id="file-conway_chess-py-LC427">            <span>if</span> <span>key</span> <span>==</span> <span>&#34;other&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L428" data-line-number="428"></td>
          <td id="file-conway_chess-py-LC428">                <span>self</span>.<span>selected_piece</span> <span>=</span> <span>None</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L429" data-line-number="429"></td>
          <td id="file-conway_chess-py-LC429">        <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L430" data-line-number="430"></td>
          <td id="file-conway_chess-py-LC430">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L431" data-line-number="431"></td>
          <td id="file-conway_chess-py-LC431">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L432" data-line-number="432"></td>
          <td id="file-conway_chess-py-LC432"><span>class</span> <span>Board</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L433" data-line-number="433"></td>
          <td id="file-conway_chess-py-LC433">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>args</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L434" data-line-number="434"></td>
          <td id="file-conway_chess-py-LC434">        <span>self</span>.<span>args</span> <span>=</span> <span>args</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L435" data-line-number="435"></td>
          <td id="file-conway_chess-py-LC435">        <span>self</span>.<span>board</span>: <span>list</span>[<span>list</span>[<span>Piece</span>]] <span>=</span> [[<span>Empty</span>() <span>for</span> <span>x</span> <span>in</span> <span>range</span>(<span>8</span>)] <span>for</span> <span>y</span> <span>in</span> <span>range</span>(<span>8</span>)]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L436" data-line-number="436"></td>
          <td id="file-conway_chess-py-LC436">        <span>self</span>.<span>board</span>[<span>0</span>] <span>=</span> [</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L437" data-line-number="437"></td>
          <td id="file-conway_chess-py-LC437">            <span>Rook</span>(<span>&#34;white&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L438" data-line-number="438"></td>
          <td id="file-conway_chess-py-LC438">            <span>Knight</span>(<span>&#34;white&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L439" data-line-number="439"></td>
          <td id="file-conway_chess-py-LC439">            <span>Bishop</span>(<span>&#34;white&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L440" data-line-number="440"></td>
          <td id="file-conway_chess-py-LC440">            <span>Queen</span>(<span>&#34;white&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L441" data-line-number="441"></td>
          <td id="file-conway_chess-py-LC441">            <span>King</span>(<span>&#34;white&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L442" data-line-number="442"></td>
          <td id="file-conway_chess-py-LC442">            <span>Bishop</span>(<span>&#34;white&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L443" data-line-number="443"></td>
          <td id="file-conway_chess-py-LC443">            <span>Knight</span>(<span>&#34;white&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L444" data-line-number="444"></td>
          <td id="file-conway_chess-py-LC444">            <span>Rook</span>(<span>&#34;white&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L445" data-line-number="445"></td>
          <td id="file-conway_chess-py-LC445">        ]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L446" data-line-number="446"></td>
          <td id="file-conway_chess-py-LC446">        <span>self</span>.<span>board</span>[<span>1</span>] <span>=</span> [<span>Pawn</span>(<span>&#34;white&#34;</span>) <span>for</span> <span>x</span> <span>in</span> <span>range</span>(<span>8</span>)]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L447" data-line-number="447"></td>
          <td id="file-conway_chess-py-LC447">        <span>self</span>.<span>board</span>[<span>6</span>] <span>=</span> [<span>Pawn</span>(<span>&#34;black&#34;</span>) <span>for</span> <span>x</span> <span>in</span> <span>range</span>(<span>8</span>)]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L448" data-line-number="448"></td>
          <td id="file-conway_chess-py-LC448">        <span>self</span>.<span>board</span>[<span>7</span>] <span>=</span> [</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L449" data-line-number="449"></td>
          <td id="file-conway_chess-py-LC449">            <span>Rook</span>(<span>&#34;black&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L450" data-line-number="450"></td>
          <td id="file-conway_chess-py-LC450">            <span>Knight</span>(<span>&#34;black&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L451" data-line-number="451"></td>
          <td id="file-conway_chess-py-LC451">            <span>Bishop</span>(<span>&#34;black&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L452" data-line-number="452"></td>
          <td id="file-conway_chess-py-LC452">            <span>Queen</span>(<span>&#34;black&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L453" data-line-number="453"></td>
          <td id="file-conway_chess-py-LC453">            <span>King</span>(<span>&#34;black&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L454" data-line-number="454"></td>
          <td id="file-conway_chess-py-LC454">            <span>Bishop</span>(<span>&#34;black&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L455" data-line-number="455"></td>
          <td id="file-conway_chess-py-LC455">            <span>Knight</span>(<span>&#34;black&#34;</span>),</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L456" data-line-number="456"></td>
          <td id="file-conway_chess-py-LC456">            <span>Rook</span>(<span>&#34;black&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L457" data-line-number="457"></td>
          <td id="file-conway_chess-py-LC457">        ]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L458" data-line-number="458"></td>
          <td id="file-conway_chess-py-LC458">        <span>self</span>.<span>piece_width</span> <span>=</span> <span>5</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L459" data-line-number="459"></td>
          <td id="file-conway_chess-py-LC459">        <span>self</span>.<span>piece_height</span> <span>=</span> <span>3</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L460" data-line-number="460"></td>
          <td id="file-conway_chess-py-LC460">        <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>8</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L461" data-line-number="461"></td>
          <td id="file-conway_chess-py-LC461">            <span>for</span> <span>j</span> <span>in</span> <span>range</span>(<span>8</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L462" data-line-number="462"></td>
          <td id="file-conway_chess-py-LC462">                <span>self</span>.<span>board</span>[<span>i</span>][<span>j</span>].<span>set_position</span>(<span>i</span>, <span>j</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L463" data-line-number="463"></td>
          <td id="file-conway_chess-py-LC463">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L464" data-line-number="464"></td>
          <td id="file-conway_chess-py-LC464">    <span>def</span> <span>get_fen_position</span>(<span>self</span>, <span>current_turn</span>: <span>str</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L465" data-line-number="465"></td>
          <td id="file-conway_chess-py-LC465">        <span># return a string in Forsyth-Edwards Notation (FEN)</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L466" data-line-number="466"></td>
          <td id="file-conway_chess-py-LC466">        <span>fen</span> <span>=</span> <span>&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L467" data-line-number="467"></td>
          <td id="file-conway_chess-py-LC467">        <span>for</span> <span>row</span> <span>in</span> <span>reversed</span>(<span>self</span>.<span>board</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L468" data-line-number="468"></td>
          <td id="file-conway_chess-py-LC468">            <span>empty_spaces</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L469" data-line-number="469"></td>
          <td id="file-conway_chess-py-LC469">            <span>for</span> <span>piece</span> <span>in</span> <span>row</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L470" data-line-number="470"></td>
          <td id="file-conway_chess-py-LC470">                <span>if</span> <span>piece</span>.<span>side</span> <span>==</span> <span>&#34;empty&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L471" data-line-number="471"></td>
          <td id="file-conway_chess-py-LC471">                    <span>empty_spaces</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L472" data-line-number="472"></td>
          <td id="file-conway_chess-py-LC472">                <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L473" data-line-number="473"></td>
          <td id="file-conway_chess-py-LC473">                    <span>if</span> <span>empty_spaces</span> <span>&gt;</span> <span>0</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L474" data-line-number="474"></td>
          <td id="file-conway_chess-py-LC474">                        <span>fen</span> <span>+=</span> <span>str</span>(<span>empty_spaces</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L475" data-line-number="475"></td>
          <td id="file-conway_chess-py-LC475">                        <span>empty_spaces</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L476" data-line-number="476"></td>
          <td id="file-conway_chess-py-LC476">                    <span>fen</span> <span>+=</span> <span>str</span>(<span>piece</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L477" data-line-number="477"></td>
          <td id="file-conway_chess-py-LC477">            <span>if</span> <span>empty_spaces</span> <span>&gt;</span> <span>0</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L478" data-line-number="478"></td>
          <td id="file-conway_chess-py-LC478">                <span>fen</span> <span>+=</span> <span>str</span>(<span>empty_spaces</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L479" data-line-number="479"></td>
          <td id="file-conway_chess-py-LC479">            <span>fen</span> <span>+=</span> <span>&#34;/&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L480" data-line-number="480"></td>
          <td id="file-conway_chess-py-LC480">        <span>fen</span> <span>=</span> <span>fen</span>[:<span>-</span><span>1</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L481" data-line-number="481"></td>
          <td id="file-conway_chess-py-LC481">        <span>fen</span> <span>+=</span> <span>&#34; &#34;</span> <span>+</span> <span>current_turn</span>[<span>0</span>] <span>+</span> <span>&#34; - - 0 1&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L482" data-line-number="482"></td>
          <td id="file-conway_chess-py-LC482">        <span>return</span> <span>fen</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L483" data-line-number="483"></td>
          <td id="file-conway_chess-py-LC483">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L484" data-line-number="484"></td>
          <td id="file-conway_chess-py-LC484">    <span>def</span> <span>get_piece</span>(<span>self</span>, <span>row</span>: <span>int</span>, <span>col</span>: <span>int</span>) <span>-&gt;</span> <span>&#34;Piece&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L485" data-line-number="485"></td>
          <td id="file-conway_chess-py-LC485">        <span>return</span> <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L486" data-line-number="486"></td>
          <td id="file-conway_chess-py-LC486">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L487" data-line-number="487"></td>
          <td id="file-conway_chess-py-LC487">    <span>def</span> <span>get_pieces</span>(<span>self</span>) <span>-&gt;</span> <span>list</span>[<span>&#34;Piece&#34;</span>]:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L488" data-line-number="488"></td>
          <td id="file-conway_chess-py-LC488">        <span>pieces</span> <span>=</span> []</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L489" data-line-number="489"></td>
          <td id="file-conway_chess-py-LC489">        <span>for</span> <span>row</span> <span>in</span> <span>self</span>.<span>board</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L490" data-line-number="490"></td>
          <td id="file-conway_chess-py-LC490">            <span>for</span> <span>piece</span> <span>in</span> <span>row</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L491" data-line-number="491"></td>
          <td id="file-conway_chess-py-LC491">                <span>pieces</span>.<span>append</span>(<span>piece</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L492" data-line-number="492"></td>
          <td id="file-conway_chess-py-LC492">        <span>return</span> <span>pieces</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L493" data-line-number="493"></td>
          <td id="file-conway_chess-py-LC493">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L494" data-line-number="494"></td>
          <td id="file-conway_chess-py-LC494">    <span>def</span> <span>get_surrounding_pieces</span>(<span>self</span>, <span>piece</span>: <span>&#34;Piece&#34;</span>) <span>-&gt;</span> <span>list</span>[<span>&#34;Piece&#34;</span>]:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L495" data-line-number="495"></td>
          <td id="file-conway_chess-py-LC495">        <span>surrounding_pieces</span> <span>=</span> []</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L496" data-line-number="496"></td>
          <td id="file-conway_chess-py-LC496">        <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>-</span><span>1</span>, <span>2</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L497" data-line-number="497"></td>
          <td id="file-conway_chess-py-LC497">            <span>for</span> <span>j</span> <span>in</span> <span>range</span>(<span>-</span><span>1</span>, <span>2</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L498" data-line-number="498"></td>
          <td id="file-conway_chess-py-LC498">                <span>if</span> <span>i</span> <span>==</span> <span>0</span> <span>and</span> <span>j</span> <span>==</span> <span>0</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L499" data-line-number="499"></td>
          <td id="file-conway_chess-py-LC499">                    <span>continue</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L500" data-line-number="500"></td>
          <td id="file-conway_chess-py-LC500">                <span>elif</span> <span>0</span> <span>&lt;=</span> <span>piece</span>.<span>row</span> <span>+</span> <span>i</span> <span>&lt;</span> <span>8</span> <span>and</span> <span>0</span> <span>&lt;=</span> <span>piece</span>.<span>col</span> <span>+</span> <span>j</span> <span>&lt;</span> <span>8</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L501" data-line-number="501"></td>
          <td id="file-conway_chess-py-LC501">                    <span>surrounding_pieces</span>.<span>append</span>(<span>self</span>.<span>board</span>[<span>piece</span>.<span>row</span> <span>+</span> <span>i</span>][<span>piece</span>.<span>col</span> <span>+</span> <span>j</span>])</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L502" data-line-number="502"></td>
          <td id="file-conway_chess-py-LC502">        <span>return</span> <span>surrounding_pieces</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L503" data-line-number="503"></td>
          <td id="file-conway_chess-py-LC503">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L504" data-line-number="504"></td>
          <td id="file-conway_chess-py-LC504">    <span>def</span> <span>set_new_piece</span>(<span>self</span>, <span>row</span>: <span>int</span>, <span>col</span>: <span>int</span>, <span>piece</span>: <span>str</span>, <span>side</span>: <span>str</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L505" data-line-number="505"></td>
          <td id="file-conway_chess-py-LC505">        <span>if</span> <span>piece</span> <span>==</span> <span>&#34;P&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L506" data-line-number="506"></td>
          <td id="file-conway_chess-py-LC506">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>] <span>=</span> <span>Pawn</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L507" data-line-number="507"></td>
          <td id="file-conway_chess-py-LC507">        <span>elif</span> <span>piece</span> <span>==</span> <span>&#34;R&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L508" data-line-number="508"></td>
          <td id="file-conway_chess-py-LC508">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>] <span>=</span> <span>Rook</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L509" data-line-number="509"></td>
          <td id="file-conway_chess-py-LC509">        <span>elif</span> <span>piece</span> <span>==</span> <span>&#34;N&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L510" data-line-number="510"></td>
          <td id="file-conway_chess-py-LC510">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>] <span>=</span> <span>Knight</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L511" data-line-number="511"></td>
          <td id="file-conway_chess-py-LC511">        <span>elif</span> <span>piece</span> <span>==</span> <span>&#34;B&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L512" data-line-number="512"></td>
          <td id="file-conway_chess-py-LC512">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>] <span>=</span> <span>Bishop</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L513" data-line-number="513"></td>
          <td id="file-conway_chess-py-LC513">        <span>elif</span> <span>piece</span> <span>==</span> <span>&#34;Q&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L514" data-line-number="514"></td>
          <td id="file-conway_chess-py-LC514">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>] <span>=</span> <span>Queen</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L515" data-line-number="515"></td>
          <td id="file-conway_chess-py-LC515">        <span>elif</span> <span>piece</span> <span>==</span> <span>&#34;K&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L516" data-line-number="516"></td>
          <td id="file-conway_chess-py-LC516">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>] <span>=</span> <span>King</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L517" data-line-number="517"></td>
          <td id="file-conway_chess-py-LC517">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L518" data-line-number="518"></td>
          <td id="file-conway_chess-py-LC518">            <span>raise</span> <span>ValueError</span>(<span>&#34;invalid piece&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L519" data-line-number="519"></td>
          <td id="file-conway_chess-py-LC519">        <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>].<span>set_position</span>(<span>row</span>, <span>col</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L520" data-line-number="520"></td>
          <td id="file-conway_chess-py-LC520">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L521" data-line-number="521"></td>
          <td id="file-conway_chess-py-LC521">    <span>def</span> <span>kill_piece</span>(<span>self</span>, <span>piece</span>: <span>&#34;Piece&#34;</span>, <span>turn</span>: <span>str</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L522" data-line-number="522"></td>
          <td id="file-conway_chess-py-LC522">        <span>&#34;&#34;&#34;piece died due to over/under population&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L523" data-line-number="523"></td>
          <td id="file-conway_chess-py-LC523">        <span>if</span> <span>piece</span>.<span>side</span> <span>==</span> <span>turn</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L524" data-line-number="524"></td>
          <td id="file-conway_chess-py-LC524">            <span>row</span> <span>=</span> <span>piece</span>.<span>row</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L525" data-line-number="525"></td>
          <td id="file-conway_chess-py-LC525">            <span>col</span> <span>=</span> <span>piece</span>.<span>col</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L526" data-line-number="526"></td>
          <td id="file-conway_chess-py-LC526">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>].<span>perish</span>(<span>conway</span><span>=</span><span>True</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L527" data-line-number="527"></td>
          <td id="file-conway_chess-py-LC527">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>] <span>=</span> <span>Empty</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L528" data-line-number="528"></td>
          <td id="file-conway_chess-py-LC528">            <span>self</span>.<span>board</span>[<span>row</span>][<span>col</span>].<span>set_position</span>(<span>row</span>, <span>col</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L529" data-line-number="529"></td>
          <td id="file-conway_chess-py-LC529">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L530" data-line-number="530"></td>
          <td id="file-conway_chess-py-LC530">    <span>def</span> <span>display</span>(<span>self</span>) <span>-&gt;</span> <span>list</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L531" data-line-number="531"></td>
          <td id="file-conway_chess-py-LC531">        <span>&#34;&#34;&#34;get a version of the board suitable for printing to the ui&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L532" data-line-number="532"></td>
          <td id="file-conway_chess-py-LC532">        <span># use ascii art to create a grid between the pieces</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L533" data-line-number="533"></td>
          <td id="file-conway_chess-py-LC533">        <span>WIDTH</span> <span>=</span> <span>self</span>.<span>piece_width</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L534" data-line-number="534"></td>
          <td id="file-conway_chess-py-LC534">        <span>HEIGHT</span> <span>=</span> <span>self</span>.<span>piece_height</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L535" data-line-number="535"></td>
          <td id="file-conway_chess-py-LC535">        <span>middle</span> <span>=</span> [<span>&#34;─&#34;</span>] <span>*</span> <span>WIDTH</span> <span>+</span> [<span>&#34;┬&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L536" data-line-number="536"></td>
          <td id="file-conway_chess-py-LC536">        <span>board</span> <span>=</span> [[<span>&#34;┌&#34;</span>] <span>+</span> <span>middle</span> <span>*</span> <span>7</span> <span>+</span> [<span>&#34;─&#34;</span>] <span>*</span> <span>WIDTH</span> <span>+</span> [<span>&#34;┐&#34;</span>]]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L537" data-line-number="537"></td>
          <td id="file-conway_chess-py-LC537">        <span>for</span> <span>row</span> <span>in</span> <span>reversed</span>(<span>self</span>.<span>board</span>) <span>if</span> <span>self</span>.<span>args</span>.<span>flip</span> <span>else</span> <span>self</span>.<span>board</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L538" data-line-number="538"></td>
          <td id="file-conway_chess-py-LC538">            <span>board</span> <span>+=</span> [[<span>&#34;│&#34;</span>], [<span>&#34;│&#34;</span>], [<span>&#34;│&#34;</span>]]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L539" data-line-number="539"></td>
          <td id="file-conway_chess-py-LC539">            <span>for</span> <span>piece</span> <span>in</span> <span>row</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L540" data-line-number="540"></td>
          <td id="file-conway_chess-py-LC540">                <span>board</span>[<span>-</span><span>3</span>] <span>+=</span> <span>piece</span>.<span>display</span>()[<span>0</span>] <span>+</span> [<span>&#34;│&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L541" data-line-number="541"></td>
          <td id="file-conway_chess-py-LC541">                <span>board</span>[<span>-</span><span>2</span>] <span>+=</span> <span>piece</span>.<span>display</span>()[<span>1</span>] <span>+</span> [<span>&#34;│&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L542" data-line-number="542"></td>
          <td id="file-conway_chess-py-LC542">                <span>board</span>[<span>-</span><span>1</span>] <span>+=</span> <span>piece</span>.<span>display</span>()[<span>2</span>] <span>+</span> [<span>&#34;│&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L543" data-line-number="543"></td>
          <td id="file-conway_chess-py-LC543">            <span>middle</span> <span>=</span> [<span>&#34;─&#34;</span>] <span>*</span> <span>WIDTH</span> <span>+</span> [<span>&#34;┼&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L544" data-line-number="544"></td>
          <td id="file-conway_chess-py-LC544">            <span>board</span> <span>+=</span> [[<span>&#34;├&#34;</span>] <span>+</span> <span>middle</span> <span>*</span> <span>7</span> <span>+</span> [<span>&#34;─&#34;</span>] <span>*</span> <span>WIDTH</span> <span>+</span> [<span>&#34;┤&#34;</span>]]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L545" data-line-number="545"></td>
          <td id="file-conway_chess-py-LC545">        <span>_</span> <span>=</span> <span>board</span>.<span>pop</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L546" data-line-number="546"></td>
          <td id="file-conway_chess-py-LC546">        <span>middle</span> <span>=</span> [<span>&#34;─&#34;</span>] <span>*</span> <span>WIDTH</span> <span>+</span> [<span>&#34;┴&#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L547" data-line-number="547"></td>
          <td id="file-conway_chess-py-LC547">        <span>board</span> <span>+=</span> [[<span>&#34;└&#34;</span>] <span>+</span> <span>middle</span> <span>*</span> <span>7</span> <span>+</span> [<span>&#34;─&#34;</span>] <span>*</span> <span>WIDTH</span> <span>+</span> [<span>&#34;┘&#34;</span>]]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L548" data-line-number="548"></td>
          <td id="file-conway_chess-py-LC548">        <span># add the row and column numbers, NOTE: need to readjust if changing piece size</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L549" data-line-number="549"></td>
          <td id="file-conway_chess-py-LC549">        <span>for</span> <span>i</span> <span>in</span> <span>range</span>(<span>len</span>(<span>board</span>)):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L550" data-line-number="550"></td>
          <td id="file-conway_chess-py-LC550">            <span>if</span> <span>self</span>.<span>args</span>.<span>flip</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L551" data-line-number="551"></td>
          <td id="file-conway_chess-py-LC551">                <span>board</span>[<span>i</span>] <span>=</span> [<span>str</span>(<span>9</span> <span>-</span> ((<span>i</span> <span>+</span> <span>2</span>) <span>//</span> <span>4</span>)) <span>if</span> (<span>i</span> <span>+</span> <span>2</span>) <span>%</span> <span>4</span> <span>==</span> <span>0</span> <span>else</span> <span>&#34; &#34;</span>] <span>+</span> <span>board</span>[<span>i</span>] <span>+</span> [<span>str</span>(<span>9</span> <span>-</span> ((<span>i</span> <span>+</span> <span>2</span>) <span>//</span> <span>4</span>)) <span>if</span> (<span>i</span> <span>+</span> <span>2</span>) <span>%</span> <span>4</span> <span>==</span> <span>0</span> <span>else</span> <span>&#34; &#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L552" data-line-number="552"></td>
          <td id="file-conway_chess-py-LC552">            <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L553" data-line-number="553"></td>
          <td id="file-conway_chess-py-LC553">                <span>board</span>[<span>i</span>] <span>=</span> [<span>str</span>((<span>i</span> <span>+</span> <span>2</span>) <span>//</span> <span>4</span>) <span>if</span> (<span>i</span> <span>+</span> <span>2</span>) <span>%</span> <span>4</span> <span>==</span> <span>0</span> <span>else</span> <span>&#34; &#34;</span>] <span>+</span> <span>board</span>[<span>i</span>] <span>+</span> [<span>str</span>((<span>i</span> <span>+</span> <span>2</span>) <span>//</span> <span>4</span>) <span>if</span> (<span>i</span> <span>+</span> <span>2</span>) <span>%</span> <span>4</span> <span>==</span> <span>0</span> <span>else</span> <span>&#34; &#34;</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L554" data-line-number="554"></td>
          <td id="file-conway_chess-py-LC554">        <span>board</span> <span>=</span> [[<span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>&#34; &#34;</span>] <span>+</span> <span>list</span>(<span>&#34;     &#34;</span>.<span>join</span>(<span>list</span>(<span>&#34;abcdefgh&#34;</span>))) <span>+</span> [<span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>&#34; &#34;</span>]] <span>+</span> <span>board</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L555" data-line-number="555"></td>
          <td id="file-conway_chess-py-LC555">        <span>board</span> <span>+=</span> [[<span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>&#34; &#34;</span>] <span>+</span> <span>list</span>(<span>&#34;     &#34;</span>.<span>join</span>(<span>list</span>(<span>&#34;abcdefgh&#34;</span>))) <span>+</span> [<span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>&#34; &#34;</span>]]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L556" data-line-number="556"></td>
          <td id="file-conway_chess-py-LC556">        <span>return</span> <span>board</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L557" data-line-number="557"></td>
          <td id="file-conway_chess-py-LC557">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L558" data-line-number="558"></td>
          <td id="file-conway_chess-py-LC558">    <span>def</span> <span>move_piece</span>(<span>self</span>, <span>source</span>: <span>&#34;Piece&#34;</span>, <span>dest</span>: <span>&#34;Piece&#34;</span>) <span>-&gt;</span> <span>bool</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L559" data-line-number="559"></td>
          <td id="file-conway_chess-py-LC559">        <span>&#34;&#34;&#34;moves piece and returns whether move is successful&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L560" data-line-number="560"></td>
          <td id="file-conway_chess-py-LC560">        <span>if</span> <span>not</span> <span>source</span>.<span>move_is_valid</span>(<span>dest</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L561" data-line-number="561"></td>
          <td id="file-conway_chess-py-LC561">            <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L562" data-line-number="562"></td>
          <td id="file-conway_chess-py-LC562">        <span># check if the move is a capture and move the piece</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L563" data-line-number="563"></td>
          <td id="file-conway_chess-py-LC563">        <span>self</span>.<span>board</span>[<span>dest</span>.<span>row</span>][<span>dest</span>.<span>col</span>].<span>perish</span>(<span>conway</span><span>=</span><span>False</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L564" data-line-number="564"></td>
          <td id="file-conway_chess-py-LC564">        <span>self</span>.<span>board</span>[<span>dest</span>.<span>row</span>][<span>dest</span>.<span>col</span>] <span>=</span> <span>source</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L565" data-line-number="565"></td>
          <td id="file-conway_chess-py-LC565">        <span># replace the old position with an empty piece</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L566" data-line-number="566"></td>
          <td id="file-conway_chess-py-LC566">        <span>self</span>.<span>board</span>[<span>source</span>.<span>row</span>][<span>source</span>.<span>col</span>] <span>=</span> <span>Empty</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L567" data-line-number="567"></td>
          <td id="file-conway_chess-py-LC567">        <span>self</span>.<span>board</span>[<span>source</span>.<span>row</span>][<span>source</span>.<span>col</span>].<span>set_position</span>(<span>source</span>.<span>row</span>, <span>source</span>.<span>col</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L568" data-line-number="568"></td>
          <td id="file-conway_chess-py-LC568">        <span># update the position of the moved piece</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L569" data-line-number="569"></td>
          <td id="file-conway_chess-py-LC569">        <span>source</span>.<span>set_position</span>(<span>dest</span>.<span>row</span>, <span>dest</span>.<span>col</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L570" data-line-number="570"></td>
          <td id="file-conway_chess-py-LC570">        <span>return</span> <span>True</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L571" data-line-number="571"></td>
          <td id="file-conway_chess-py-LC571">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L572" data-line-number="572"></td>
          <td id="file-conway_chess-py-LC572">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L573" data-line-number="573"></td>
          <td id="file-conway_chess-py-LC573"><span>class</span> <span>Piece</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L574" data-line-number="574"></td>
          <td id="file-conway_chess-py-LC574">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>side</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L575" data-line-number="575"></td>
          <td id="file-conway_chess-py-LC575">        <span>&#34;&#34;&#34;common attributes (required by every chess piece)&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L576" data-line-number="576"></td>
          <td id="file-conway_chess-py-LC576">        <span>self</span>.<span>side</span> <span>=</span> <span>side</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L577" data-line-number="577"></td>
          <td id="file-conway_chess-py-LC577">        <span>self</span>.<span>row</span> <span>=</span> <span>-</span><span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L578" data-line-number="578"></td>
          <td id="file-conway_chess-py-LC578">        <span>self</span>.<span>col</span> <span>=</span> <span>-</span><span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L579" data-line-number="579"></td>
          <td id="file-conway_chess-py-LC579">        <span>self</span>.<span>death_counter</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L580" data-line-number="580"></td>
          <td id="file-conway_chess-py-LC580">        <span>self</span>.<span>birth_counter_white</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L581" data-line-number="581"></td>
          <td id="file-conway_chess-py-LC581">        <span>self</span>.<span>birth_counter_black</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L582" data-line-number="582"></td>
          <td id="file-conway_chess-py-LC582">        <span>self</span>.<span>surrounding_white</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L583" data-line-number="583"></td>
          <td id="file-conway_chess-py-LC583">        <span>self</span>.<span>surrounding_black</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L584" data-line-number="584"></td>
          <td id="file-conway_chess-py-LC584">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L585" data-line-number="585"></td>
          <td id="file-conway_chess-py-LC585">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L586" data-line-number="586"></td>
          <td id="file-conway_chess-py-LC586">        <span>&#34;&#34;&#34;for displaying entities on the map ui&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L587" data-line-number="587"></td>
          <td id="file-conway_chess-py-LC587">        <span>raise</span> <span>NotImplementedError</span>()</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L588" data-line-number="588"></td>
          <td id="file-conway_chess-py-LC588">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L589" data-line-number="589"></td>
          <td id="file-conway_chess-py-LC589">    <span>def</span> <span>set_position</span>(<span>self</span>, <span>row</span>: <span>int</span>, <span>col</span>: <span>int</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L590" data-line-number="590"></td>
          <td id="file-conway_chess-py-LC590">        <span>&#34;&#34;&#34;set the position of the piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L591" data-line-number="591"></td>
          <td id="file-conway_chess-py-LC591">        <span>self</span>.<span>row</span> <span>=</span> <span>row</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L592" data-line-number="592"></td>
          <td id="file-conway_chess-py-LC592">        <span>self</span>.<span>col</span> <span>=</span> <span>col</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L593" data-line-number="593"></td>
          <td id="file-conway_chess-py-LC593">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L594" data-line-number="594"></td>
          <td id="file-conway_chess-py-LC594">    <span>def</span> <span>get_position</span>(<span>self</span>) <span>-&gt;</span> <span>tuple</span>[<span>int</span>, <span>int</span>]:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L595" data-line-number="595"></td>
          <td id="file-conway_chess-py-LC595">        <span>&#34;&#34;&#34;get the position of the piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L596" data-line-number="596"></td>
          <td id="file-conway_chess-py-LC596">        <span>return</span> <span>self</span>.<span>row</span>, <span>self</span>.<span>col</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L597" data-line-number="597"></td>
          <td id="file-conway_chess-py-LC597">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L598" data-line-number="598"></td>
          <td id="file-conway_chess-py-LC598">    <span>def</span> <span>display</span>(<span>self</span>) <span>-&gt;</span> <span>list</span>[<span>list</span>[<span>str</span>]]:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L599" data-line-number="599"></td>
          <td id="file-conway_chess-py-LC599">        <span>&#34;&#34;&#34;get a 3x3 list of chars of the piece suitable for printing to the ui&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L600" data-line-number="600"></td>
          <td id="file-conway_chess-py-LC600">        <span>white_reproduction</span> <span>=</span> <span>&#34;w&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;empty&#34;</span> <span>and</span> <span>self</span>.<span>surrounding_white</span> <span>==</span> <span>3</span> <span>else</span> <span>&#34; &#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L601" data-line-number="601"></td>
          <td id="file-conway_chess-py-LC601">        <span>black_reproduction</span> <span>=</span> <span>&#34;l&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;empty&#34;</span> <span>and</span> <span>self</span>.<span>surrounding_black</span> <span>==</span> <span>3</span> <span>else</span> <span>&#34; &#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L602" data-line-number="602"></td>
          <td id="file-conway_chess-py-LC602">        <span>over_under_population</span> <span>=</span> <span>&#34; &#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L603" data-line-number="603"></td>
          <td id="file-conway_chess-py-LC603">        <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L604" data-line-number="604"></td>
          <td id="file-conway_chess-py-LC604">            <span>if</span> <span>self</span>.<span>surrounding_white</span> <span>&lt;</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L605" data-line-number="605"></td>
          <td id="file-conway_chess-py-LC605">                <span>over_under_population</span> <span>=</span> <span>&#34;u&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L606" data-line-number="606"></td>
          <td id="file-conway_chess-py-LC606">            <span>elif</span> <span>self</span>.<span>surrounding_white</span> <span>&gt;</span> <span>3</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L607" data-line-number="607"></td>
          <td id="file-conway_chess-py-LC607">                <span>over_under_population</span> <span>=</span> <span>&#34;o&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L608" data-line-number="608"></td>
          <td id="file-conway_chess-py-LC608">        <span>elif</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;black&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L609" data-line-number="609"></td>
          <td id="file-conway_chess-py-LC609">            <span>if</span> <span>self</span>.<span>surrounding_black</span> <span>&lt;</span> <span>2</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L610" data-line-number="610"></td>
          <td id="file-conway_chess-py-LC610">                <span>over_under_population</span> <span>=</span> <span>&#34;u&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L611" data-line-number="611"></td>
          <td id="file-conway_chess-py-LC611">            <span>elif</span> <span>self</span>.<span>surrounding_black</span> <span>&gt;</span> <span>3</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L612" data-line-number="612"></td>
          <td id="file-conway_chess-py-LC612">                <span>over_under_population</span> <span>=</span> <span>&#34;o&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L613" data-line-number="613"></td>
          <td id="file-conway_chess-py-LC613">        <span>chars_to_print</span> <span>=</span> [</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L614" data-line-number="614"></td>
          <td id="file-conway_chess-py-LC614">            [<span>&#34; &#34;</span> <span>if</span> <span>white_reproduction</span> <span>==</span> <span>&#34; &#34;</span> <span>else</span> <span>str</span>(<span>self</span>.<span>birth_counter_white</span>), <span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>white_reproduction</span>],</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L615" data-line-number="615"></td>
          <td id="file-conway_chess-py-LC615">            [<span>&#34; &#34;</span> <span>if</span> <span>over_under_population</span> <span>==</span> <span>&#34; &#34;</span> <span>else</span> <span>str</span>(<span>self</span>.<span>death_counter</span>), <span>&#34; &#34;</span>, <span>str</span>(<span>self</span>), <span>&#34; &#34;</span>, <span>over_under_population</span>],</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L616" data-line-number="616"></td>
          <td id="file-conway_chess-py-LC616">            [<span>&#34; &#34;</span> <span>if</span> <span>black_reproduction</span> <span>==</span> <span>&#34; &#34;</span> <span>else</span> <span>str</span>(<span>self</span>.<span>birth_counter_black</span>), <span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>&#34; &#34;</span>, <span>black_reproduction</span>]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L617" data-line-number="617"></td>
          <td id="file-conway_chess-py-LC617">        ]</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L618" data-line-number="618"></td>
          <td id="file-conway_chess-py-LC618">        <span>return</span> <span>chars_to_print</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L619" data-line-number="619"></td>
          <td id="file-conway_chess-py-LC619">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L620" data-line-number="620"></td>
          <td id="file-conway_chess-py-LC620">    <span>def</span> <span>move_is_valid</span>(<span>self</span>, <span>dest_piece</span>: <span>&#34;Piece&#34;</span>) <span>-&gt;</span> <span>bool</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L621" data-line-number="621"></td>
          <td id="file-conway_chess-py-LC621">        <span>&#34;&#34;&#34;check if the move is valid, TODO: check with chess logic, and add special moves&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L622" data-line-number="622"></td>
          <td id="file-conway_chess-py-LC622">        <span>if</span> <span>dest_piece</span>.<span>side</span> <span>==</span> <span>self</span>.<span>side</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L623" data-line-number="623"></td>
          <td id="file-conway_chess-py-LC623">            <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L624" data-line-number="624"></td>
          <td id="file-conway_chess-py-LC624">        <span>elif</span> <span>dest_piece</span>.<span>side</span> <span>==</span> <span>&#34;empty&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L625" data-line-number="625"></td>
          <td id="file-conway_chess-py-LC625">            <span>return</span> <span>True</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L626" data-line-number="626"></td>
          <td id="file-conway_chess-py-LC626">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L627" data-line-number="627"></td>
          <td id="file-conway_chess-py-LC627">            <span>return</span> <span>True</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L628" data-line-number="628"></td>
          <td id="file-conway_chess-py-LC628">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L629" data-line-number="629"></td>
          <td id="file-conway_chess-py-LC629">    <span>def</span> <span>tick</span>(<span>self</span>, <span>surrounding_pieces</span>: <span>list</span>[<span>&#34;Piece&#34;</span>], <span>current_turn</span>: <span>str</span>, <span>update_counters</span>: <span>bool</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L630" data-line-number="630"></td>
          <td id="file-conway_chess-py-LC630">        <span>&#34;&#34;&#34;perform next step in life cycle, only ticks for players pieces before their turn&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L631" data-line-number="631"></td>
          <td id="file-conway_chess-py-LC631">        <span>self</span>.<span>surrounding_white</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L632" data-line-number="632"></td>
          <td id="file-conway_chess-py-LC632">        <span>self</span>.<span>surrounding_black</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L633" data-line-number="633"></td>
          <td id="file-conway_chess-py-LC633">        <span>for</span> <span>piece</span> <span>in</span> <span>surrounding_pieces</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L634" data-line-number="634"></td>
          <td id="file-conway_chess-py-LC634">            <span>if</span> <span>piece</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L635" data-line-number="635"></td>
          <td id="file-conway_chess-py-LC635">                <span>self</span>.<span>surrounding_white</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L636" data-line-number="636"></td>
          <td id="file-conway_chess-py-LC636">            <span>elif</span> <span>piece</span>.<span>side</span> <span>==</span> <span>&#34;black&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L637" data-line-number="637"></td>
          <td id="file-conway_chess-py-LC637">                <span>self</span>.<span>surrounding_black</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L638" data-line-number="638"></td>
          <td id="file-conway_chess-py-LC638">        <span>if</span> <span>not</span> <span>update_counters</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L639" data-line-number="639"></td>
          <td id="file-conway_chess-py-LC639">            <span>return</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L640" data-line-number="640"></td>
          <td id="file-conway_chess-py-LC640">        <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;empty&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L641" data-line-number="641"></td>
          <td id="file-conway_chess-py-LC641">            <span>if</span> <span>current_turn</span> <span>==</span> <span>&#34;white&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L642" data-line-number="642"></td>
          <td id="file-conway_chess-py-LC642">                <span>if</span> <span>self</span>.<span>surrounding_white</span> <span>==</span> <span>3</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L643" data-line-number="643"></td>
          <td id="file-conway_chess-py-LC643">                    <span>self</span>.<span>birth_counter_white</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L644" data-line-number="644"></td>
          <td id="file-conway_chess-py-LC644">                <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L645" data-line-number="645"></td>
          <td id="file-conway_chess-py-LC645">                    <span>self</span>.<span>birth_counter_white</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L646" data-line-number="646"></td>
          <td id="file-conway_chess-py-LC646">            <span>if</span> <span>current_turn</span> <span>==</span> <span>&#34;black&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L647" data-line-number="647"></td>
          <td id="file-conway_chess-py-LC647">                <span>if</span> <span>self</span>.<span>surrounding_black</span> <span>==</span> <span>3</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L648" data-line-number="648"></td>
          <td id="file-conway_chess-py-LC648">                    <span>self</span>.<span>birth_counter_black</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L649" data-line-number="649"></td>
          <td id="file-conway_chess-py-LC649">                <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L650" data-line-number="650"></td>
          <td id="file-conway_chess-py-LC650">                    <span>self</span>.<span>birth_counter_black</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L651" data-line-number="651"></td>
          <td id="file-conway_chess-py-LC651">        <span>elif</span> <span>current_turn</span> <span>==</span> <span>self</span>.<span>side</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L652" data-line-number="652"></td>
          <td id="file-conway_chess-py-LC652">            <span>same_pieces</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L653" data-line-number="653"></td>
          <td id="file-conway_chess-py-LC653">            <span>for</span> <span>piece</span> <span>in</span> <span>surrounding_pieces</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L654" data-line-number="654"></td>
          <td id="file-conway_chess-py-LC654">                <span>if</span> <span>piece</span>.<span>side</span> <span>==</span> <span>self</span>.<span>side</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L655" data-line-number="655"></td>
          <td id="file-conway_chess-py-LC655">                    <span>same_pieces</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L656" data-line-number="656"></td>
          <td id="file-conway_chess-py-LC656">            <span>if</span> <span>same_pieces</span> <span>&lt;</span> <span>2</span> <span>or</span> <span>same_pieces</span> <span>&gt;</span> <span>3</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L657" data-line-number="657"></td>
          <td id="file-conway_chess-py-LC657">                <span>self</span>.<span>death_counter</span> <span>+=</span> <span>1</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L658" data-line-number="658"></td>
          <td id="file-conway_chess-py-LC658">            <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L659" data-line-number="659"></td>
          <td id="file-conway_chess-py-LC659">                <span>self</span>.<span>death_counter</span> <span>=</span> <span>0</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L660" data-line-number="660"></td>
          <td id="file-conway_chess-py-LC660">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L661" data-line-number="661"></td>
          <td id="file-conway_chess-py-LC661">    <span>def</span> <span>perish</span>(<span>self</span>, <span>conway</span>: <span>bool</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L662" data-line-number="662"></td>
          <td id="file-conway_chess-py-LC662">        <span>&#34;&#34;&#34;piece perished due to over/under population (conway=True) or capture (conway=False)&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L663" data-line-number="663"></td>
          <td id="file-conway_chess-py-LC663">        <span>pass</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L664" data-line-number="664"></td>
          <td id="file-conway_chess-py-LC664">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L665" data-line-number="665"></td>
          <td id="file-conway_chess-py-LC665"><span>class</span> <span>Empty</span>(<span>Piece</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L666" data-line-number="666"></td>
          <td id="file-conway_chess-py-LC666">    <span>def</span> <span>__init__</span>(<span>self</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L667" data-line-number="667"></td>
          <td id="file-conway_chess-py-LC667">        <span>&#34;&#34;&#34;empty space on the map&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L668" data-line-number="668"></td>
          <td id="file-conway_chess-py-LC668">        <span>super</span>().<span>__init__</span>(<span>&#34;empty&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L669" data-line-number="669"></td>
          <td id="file-conway_chess-py-LC669">    </td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L670" data-line-number="670"></td>
          <td id="file-conway_chess-py-LC670">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L671" data-line-number="671"></td>
          <td id="file-conway_chess-py-LC671">        <span>return</span> <span>&#34; &#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L672" data-line-number="672"></td>
          <td id="file-conway_chess-py-LC672">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L673" data-line-number="673"></td>
          <td id="file-conway_chess-py-LC673">    <span>def</span> <span>move_is_valid</span>(<span>self</span>, <span>dest_piece</span>: <span>Piece</span>) <span>-&gt;</span> <span>bool</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L674" data-line-number="674"></td>
          <td id="file-conway_chess-py-LC674">        <span>return</span> <span>False</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L675" data-line-number="675"></td>
          <td id="file-conway_chess-py-LC675">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L676" data-line-number="676"></td>
          <td id="file-conway_chess-py-LC676"><span>class</span> <span>Pawn</span>(<span>Piece</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L677" data-line-number="677"></td>
          <td id="file-conway_chess-py-LC677">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>side</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L678" data-line-number="678"></td>
          <td id="file-conway_chess-py-LC678">        <span>&#34;&#34;&#34;pawn chess piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L679" data-line-number="679"></td>
          <td id="file-conway_chess-py-LC679">        <span>super</span>().<span>__init__</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L680" data-line-number="680"></td>
          <td id="file-conway_chess-py-LC680">    </td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L681" data-line-number="681"></td>
          <td id="file-conway_chess-py-LC681">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L682" data-line-number="682"></td>
          <td id="file-conway_chess-py-LC682">        <span>return</span> <span>&#34;P&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span> <span>else</span> <span>&#34;p&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L683" data-line-number="683"></td>
          <td id="file-conway_chess-py-LC683">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L684" data-line-number="684"></td>
          <td id="file-conway_chess-py-LC684"><span>class</span> <span>Knight</span>(<span>Piece</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L685" data-line-number="685"></td>
          <td id="file-conway_chess-py-LC685">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>side</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L686" data-line-number="686"></td>
          <td id="file-conway_chess-py-LC686">        <span>&#34;&#34;&#34;knight chess piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L687" data-line-number="687"></td>
          <td id="file-conway_chess-py-LC687">        <span>super</span>().<span>__init__</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L688" data-line-number="688"></td>
          <td id="file-conway_chess-py-LC688">    </td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L689" data-line-number="689"></td>
          <td id="file-conway_chess-py-LC689">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L690" data-line-number="690"></td>
          <td id="file-conway_chess-py-LC690">        <span>return</span> <span>&#34;N&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span> <span>else</span> <span>&#34;n&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L691" data-line-number="691"></td>
          <td id="file-conway_chess-py-LC691">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L692" data-line-number="692"></td>
          <td id="file-conway_chess-py-LC692"><span>class</span> <span>Bishop</span>(<span>Piece</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L693" data-line-number="693"></td>
          <td id="file-conway_chess-py-LC693">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>side</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L694" data-line-number="694"></td>
          <td id="file-conway_chess-py-LC694">        <span>&#34;&#34;&#34;bishop chess piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L695" data-line-number="695"></td>
          <td id="file-conway_chess-py-LC695">        <span>super</span>().<span>__init__</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L696" data-line-number="696"></td>
          <td id="file-conway_chess-py-LC696">    </td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L697" data-line-number="697"></td>
          <td id="file-conway_chess-py-LC697">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L698" data-line-number="698"></td>
          <td id="file-conway_chess-py-LC698">        <span>return</span> <span>&#34;B&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span> <span>else</span> <span>&#34;b&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L699" data-line-number="699"></td>
          <td id="file-conway_chess-py-LC699">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L700" data-line-number="700"></td>
          <td id="file-conway_chess-py-LC700"><span>class</span> <span>Rook</span>(<span>Piece</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L701" data-line-number="701"></td>
          <td id="file-conway_chess-py-LC701">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>side</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L702" data-line-number="702"></td>
          <td id="file-conway_chess-py-LC702">        <span>&#34;&#34;&#34;rook chess piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L703" data-line-number="703"></td>
          <td id="file-conway_chess-py-LC703">        <span>super</span>().<span>__init__</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L704" data-line-number="704"></td>
          <td id="file-conway_chess-py-LC704">    </td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L705" data-line-number="705"></td>
          <td id="file-conway_chess-py-LC705">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L706" data-line-number="706"></td>
          <td id="file-conway_chess-py-LC706">        <span>return</span> <span>&#34;R&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span> <span>else</span> <span>&#34;r&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L707" data-line-number="707"></td>
          <td id="file-conway_chess-py-LC707">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L708" data-line-number="708"></td>
          <td id="file-conway_chess-py-LC708"><span>class</span> <span>Queen</span>(<span>Piece</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L709" data-line-number="709"></td>
          <td id="file-conway_chess-py-LC709">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>side</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L710" data-line-number="710"></td>
          <td id="file-conway_chess-py-LC710">        <span>&#34;&#34;&#34;queen chess piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L711" data-line-number="711"></td>
          <td id="file-conway_chess-py-LC711">        <span>super</span>().<span>__init__</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L712" data-line-number="712"></td>
          <td id="file-conway_chess-py-LC712">    </td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L713" data-line-number="713"></td>
          <td id="file-conway_chess-py-LC713">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L714" data-line-number="714"></td>
          <td id="file-conway_chess-py-LC714">        <span>return</span> <span>&#34;Q&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span> <span>else</span> <span>&#34;q&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L715" data-line-number="715"></td>
          <td id="file-conway_chess-py-LC715">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L716" data-line-number="716"></td>
          <td id="file-conway_chess-py-LC716"><span>class</span> <span>King</span>(<span>Piece</span>):</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L717" data-line-number="717"></td>
          <td id="file-conway_chess-py-LC717">    <span>def</span> <span>__init__</span>(<span>self</span>, <span>side</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L718" data-line-number="718"></td>
          <td id="file-conway_chess-py-LC718">        <span>&#34;&#34;&#34;king chess piece&#34;&#34;&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L719" data-line-number="719"></td>
          <td id="file-conway_chess-py-LC719">        <span>super</span>().<span>__init__</span>(<span>side</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L720" data-line-number="720"></td>
          <td id="file-conway_chess-py-LC720">    </td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L721" data-line-number="721"></td>
          <td id="file-conway_chess-py-LC721">    <span>def</span> <span>__str__</span>(<span>self</span>) <span>-&gt;</span> <span>str</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L722" data-line-number="722"></td>
          <td id="file-conway_chess-py-LC722">        <span>return</span> <span>&#34;K&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;white&#34;</span> <span>else</span> <span>&#34;k&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L723" data-line-number="723"></td>
          <td id="file-conway_chess-py-LC723">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L724" data-line-number="724"></td>
          <td id="file-conway_chess-py-LC724">    <span>def</span> <span>perish</span>(<span>self</span>, <span>conway</span>) <span>-&gt;</span> <span>None</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L725" data-line-number="725"></td>
          <td id="file-conway_chess-py-LC725">        <span>winning_side</span> <span>=</span> <span>&#34;white&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;black&#34;</span> <span>else</span> <span>&#34;black&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L726" data-line-number="726"></td>
          <td id="file-conway_chess-py-LC726">        <span>losing_side</span> <span>=</span> <span>&#34;Black&#34;</span> <span>if</span> <span>self</span>.<span>side</span> <span>==</span> <span>&#34;black&#34;</span> <span>else</span> <span>&#34;White&#34;</span></td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L727" data-line-number="727"></td>
          <td id="file-conway_chess-py-LC727">        <span>if</span> <span>conway</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L728" data-line-number="728"></td>
          <td id="file-conway_chess-py-LC728">            <span>raise</span> <span>Exception</span>(<span>f&#34;<span><span>{</span><span>losing_side</span><span>}</span></span> king perished, <span><span>{</span><span>winning_side</span><span>}</span></span> wins!&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L729" data-line-number="729"></td>
          <td id="file-conway_chess-py-LC729">        <span>else</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L730" data-line-number="730"></td>
          <td id="file-conway_chess-py-LC730">            <span>raise</span> <span>Exception</span>(<span>f&#34;<span><span>{</span><span>losing_side</span><span>}</span></span> king was captured, <span><span>{</span><span>winning_side</span><span>}</span></span> wins!&#34;</span>)</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L731" data-line-number="731"></td>
          <td id="file-conway_chess-py-LC731">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L732" data-line-number="732"></td>
          <td id="file-conway_chess-py-LC732">
</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L733" data-line-number="733"></td>
          <td id="file-conway_chess-py-LC733"><span>if</span> <span>__name__</span> <span>==</span> <span>&#34;__main__&#34;</span>:</td>
        </tr>
        <tr>
          <td id="file-conway_chess-py-L734" data-line-number="734"></td>
          <td id="file-conway_chess-py-LC734">    <span>sys</span>.<span>exit</span>(<span>start_cli</span>())</td>
        </tr>
  </tbody></div></div>
  </body>
</html>
