<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://supabase.com/blog/pgrouting-postgres-graph-database">Original</a>
    <h1>Postgres as a Graph Database: (Ab)Using PgRouting</h1>
    
    <div id="readability-page-1" class="page"><article><div><p><img alt="Postgres as a Graph Database: (Ab)using pgRouting" loading="lazy" decoding="async" data-nimg="fill" sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw" srcset="/_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=256&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 256w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=384&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 384w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=640&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 640w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=750&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 750w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=828&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 828w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=1080&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 1080w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=1200&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 1200w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=1920&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 1920w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=2048&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 2048w, /_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=3840&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW 3840w" src="https://supabase.com/_next/image?url=%2Fimages%2Fblog%2Fpgrouting-graph%2Fpgrouting-thumb.png&amp;w=3840&amp;q=100&amp;dpl=dpl_J28tCMV8sSQQM2H3CWD4vkGFYvYW"/></p>
<p><a href="https://github.com/pgRouting/pgrouting">pgRouting</a> is a Postgres extension. It&#39;s often used for finding the “shortest path” between two locations, however it&#39;s a hidden gem in Postgres and can be used for basic graph functionality.</p>

<p>pgRouting is typically combined with PostGIS for working with geospatial data, but it can also be <a href="https://news.ycombinator.com/item?id=26350454">useful beyond that</a> as a lightweight alternative to Graph extensions like <a href="https://age.apache.org/">Apache AGE</a>, or specialized graph databases like <a href="https://neo4j.com/">Neo4j</a>.</p>
<p>Let&#39;s explore some useful applications of pgRouting and graphs.</p>

<p>pgRouting is an extension of PostGIS that provides geospatial routing functionality. You can use it to calculate the shortest path, perform network analysis, and solve complex routing problems on a graph-based structure. Most commonly, this is used in Geographic Information Systems (GIS) for tasks like determining the fastest route between two locations.</p>


<p>The power of pgRouting lies in its ability to work with any data structured as a graph. A graph is essentially a network of interconnected points, where:</p>
<ul>
<li><strong>Nodes</strong> represent entities.</li>
<li><strong>Edges</strong> represent relationships or paths between those nodes.</li>
</ul>
<p>In maps / <a href="https://en.wikipedia.org/wiki/Geographic_information_system">GIS</a>, nodes and edges represent intersections and roads respectively. However, this structure can also be applied to abstract systems like a social networks, where users are nodes and friendships are edges.</p>
<!-- -->

<p>Let&#39;s explore how pgRouting can be applied to a few non-<a href="https://en.wikipedia.org/wiki/Geographic_information_system">GIS</a> problems.</p>
<h3 id="task-scheduling">Task scheduling<a href="#task-scheduling" aria-hidden="true"><span aria-hidden="true">#</span></a></h3>
<p>In any project, tasks have dependencies. For example, task B can only start after task A is completed. This creates a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">directed acyclic graph</a> (DAG), where:</p>
<ul>
<li>nodes represent tasks</li>
<li>edges represent dependencies</li>
</ul>
<p>One of the most challenging aspects of managing projects is determining the “critical path” — the project&#39;s overall duration, determined by the longest sequence of dependencies.</p>
<!-- -->
<p>Using pgRouting, you can model your task&#39;s dependencies, using graph algorithms to find the critical path. Suppose we have a table tasks with task dependencies modeled as a graph:</p>

<p>You can then use the <a href="https://docs.pgrouting.org/latest/en/pgr_dijkstra.html"><code>pgr_dijkstra()</code></a> function to find the shortest (or longest) path through the tasks, allowing you to map out the project schedule effectively:</p>

<p>Which returns a table showing that this project will take 20 days from start to finish:</p>
<table><thead><tr><th><strong>seq</strong></th><th><strong>path_seq</strong></th><th><strong>node</strong></th><th><strong>edge</strong></th><th><strong>cost</strong></th><th><strong>agg_cost</strong></th></tr></thead><tbody><tr><td>1</td><td>1</td><td>1</td><td>1</td><td>3</td><td>0</td></tr><tr><td>2</td><td>2</td><td>2</td><td>2</td><td>4</td><td>3</td></tr><tr><td>3</td><td>3</td><td>3</td><td>3</td><td>5</td><td>7</td></tr><tr><td>4</td><td>4</td><td>4</td><td>4</td><td>2</td><td>12</td></tr><tr><td>5</td><td>5</td><td>5</td><td>5</td><td>6</td><td>14</td></tr><tr><td>6</td><td>6</td><td>6</td><td>-1</td><td>0</td><td>20</td></tr></tbody></table>
<details><summary>Tangent: the Dijkstra algorithm</summary><p>The <code>pgr_dijkstra()</code> function implements <a href="https://en.wikipedia.org/wiki/Dijkstra&#39;s_algorithm">Dijkstra&#39;s
algorithm</a>, which is used to find the
shortest path between nodes in a graph. This algorithm guarantees the shortest path from a
source node to a target node (or all other nodes), based on the cost of edges connecting the
nodes.</p><p>Fun fact: Dijkstra&#39;s algorithm was published in 1959 by Dutch computer scientist Edsger
Dijkstra. It&#39;s a “greedy” algorithm, meaning it always picks the closest, cheapest node to
explore next.</p></details>
<h3 id="reverse-proxy-routing-based-on-resource-allocation">Reverse proxy routing based on resource allocation<a href="#reverse-proxy-routing-based-on-resource-allocation" aria-hidden="true"><span aria-hidden="true">#</span></a></h3>
<p>Distributed systems usually involve allocating resources efficiently across a network of nodes. Each node might represent a physical location or a computing process, and the edges represent the available pathways to move resources between them. For example, in a cloud infrastructure, pgRouting could help determine how to allocate compute tasks across a set of distributed servers by finding the shortest or least-congested path to route data.</p>
<p>Suppose you have a network of servers represented by nodes and their data connections as edges in a table servers.</p>

<p>You can then use <a href="https://docs.pgrouting.org/latest/en/pgr_aStar.html"><code>pgr_astar</code></a>() to find the most efficient path for data or compute tasks to travel through this network, optimizing for speed or load:</p>

<details><summary>Tangent: the A* algorithm</summary><p>The <code>pgr_astar()</code> function is an implementation of the <a href="https://en.wikipedia.org/wiki/A*_search_algorithm">A* (A-star)
algorithm</a>. It&#39;s used to find the most
efficient (shortest) path between two points in a graph. A* is commonly used in navigation and
routing because it is more efficient than Dijkstra&#39;s algorithm in many scenarios, especially
when you have spatial data with coordinates (e.g., X, Y positions).</p><p>Fun fact: A* was originally designed in the 1960s for artificial intelligence applications and
pathfinding in games. Today, it&#39;s one of the most widely used algorithms in video game
development to help characters navigate complex environments efficiently.</p></details>
<h3 id="recommendation-engines-like-youtube">Recommendation engines like YouTube<a href="#recommendation-engines-like-youtube" aria-hidden="true"><span aria-hidden="true">#</span></a></h3>
<p>In recommendation engines or search algorithms that use knowledge graphs, pgRouting can be used to build relationships between entities and events. Take YouTube&#39;s recommendation algorithm, we can structure this data as a graph where:</p>
<ul>
<li><strong>Nodes</strong> represent entities like users, videos, or categories.</li>
<li><strong>Edges</strong> represent relationships or interactions between those entities, such as a user liking a video or videos being part of the same category.</li>
</ul>
<p>Let&#39;s create a list of “nodes”:</p>

<p>And some “edges”:</p>

<p>Now we can use the <code>pgr_dijkstra()</code> function to find the shortest or most relevant path between a user and new videos. For example, let&#39;s find videos that are most relevant to <code>user_01</code> considering their past interactions:</p>
<details><summary>Tangent: ranking recommendations</summary><p>Since it&#39;s “just postgres” it&#39;s simple enough to rank the results using an <code>order by</code> clause. For example, if we stored the <code>pgr_dijkstra()</code> results above in a table called “recommendations”, we use this a query like this to sort the paths by the highest ranking:</p></details>

<p>pgRouting is a powerful extension for Postgres that can be used to solve a wide range of graph-based problems. Check out the <a href="https://docs.pgrouting.org/latest/en/index.html">pgRouting docs</a> for more information on how to use it. You can also use it on Supabase:</p>
<ul>
<li>Docs: <a href="https://supabase.com/docs/guides/database/extensions/pgrouting">pgrouting: Geospatial Routing</a></li>
<li>Launch a new Postgres database: <a href="https://database.new">database.new</a></li>
</ul></div></article></div>
  </body>
</html>
