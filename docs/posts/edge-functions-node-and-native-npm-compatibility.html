<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://supabase.com/blog/edge-functions-node-npm">Original</a>
    <h1>Edge functions: Node and native NPM compatibility</h1>
    
    <div id="readability-page-1" class="page"><article><div><p><img alt="Edge Functions: Node and native npm compatibility" loading="lazy" decoding="async" data-nimg="fill" sizes="100vw" srcset="/_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=640&amp;q=75 640w, /_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=750&amp;q=75 750w, /_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=828&amp;q=75 828w, /_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=3840&amp;q=75 3840w" src="https://supabase.com/_next/image?url=%2Fimages%2Fblog%2Flaunch-week-x%2Fday-2%2Fedge-runtime-thumb.png&amp;w=3840&amp;q=75"/></p>
<p>We are excited to announce that <a href="https://supabase.com/docs/guides/functions">Edge Functions</a> now natively supports npm modules and Node built-in APIs. You can directly import millions of popular, commonly used npm modules into your Edge Functions.</p>

<h2 id="migrate-existing-node-apps-to-edge-functions">Migrate existing Node apps to Edge Functions</h2>
<p>You can migrate your existing Node apps to Supabase Edge Functions with minimal changes.</p>
<p>We created a demo to show how to migrate a Node app that uses Express, Node Postgres, and Drizzle. For more information on using npm modules and Node built-ins within your Edge Functions, see the <a href="https://supabase.com/docs/guides/functions/import-maps">Managing dependencies guide</a>.</p>
<p><iframe src="https://www.youtube-nocookie.com/embed/eCbiywoDORw" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"></iframe></p>
<h2 id="how-npm-modules-work-under-the-hood">How npm modules work under the hood</h2>
<p>We run an open source Deno server for hosting Edge Functions called <a href="https://supabase.com/blog/edge-runtime-self-hosted-deno-functions">Supabase Edge Runtime</a>. This custom version helps us keep Edge Functions working the same way no matter where it is deployed - on our hosted platform, in local development, or in your self-hosted environment.</p>
<p>The biggest challenge when adding npm support was finding an approach that would work across all environments. We wanted to keep the workflow close to the Deno CLI experience. It should be possible to import npm modules directly in your source code without an extra build step.</p>
<p>When deploying a Function, we serialize its module graph into a single file format (an <a href="https://github.com/denoland/eszip">eszip</a>). In the hosted environment, all module references are then loaded from the eszip. This prevents any extra latency in fetching modules and potential conflicts between module dependencies.</p>
<p>We used the eszip module loader in the local and self-hosted environments too, so we only need to implement one module-loading strategy for all environments. As an additional benefit for local development, this approach avoids potential conflicts with npm modules installed in the user&#39;s system since the Edge Function&#39;s npm modules are self-contained within the eszip.</p>
<p><a href="https://github.com/supabase/edge-runtime/pull/223">Refactoring the module loader</a> fixes a few other bugs, such <a href="https://github.com/supabase/cli/issues/1584#issuecomment-1848799355">edge functions erroring out</a> when an <code>deno.lock</code> file is already present in the project.</p>
<h2 id="a-few-other-things-youve-asked-for">A few other things you&#39;ve asked forâ€¦</h2>
<h3 id="regional-invocations">Regional Invocations</h3>
<p>You now have the option to specify a region when running an Edge Function (perhaps we should change the name in the future). Usually, Edge Functions run in the region closest to the user invoking the Function. However, sometimes you want to run it closer to your Postgres database or another 3rd party API for optimal performance.</p>
<p>Functions are still deployed to all regions. However, during invocation, you can provide the <code>x-region</code> header to restrict the execution to a specific region.</p>


<h3 id="better-metrics">Better Metrics</h3>
<p>We&#39;ve added more metrics in the Edge Functions section of the <a href="https://supabase.com/dashboard/project/_/functions">Supabase Dashboard</a>: it now shows CPU time and memory used. We&#39;ve also broken down invocations by HTTP status codes.</p>
<p>These changes help you spot any issues with your Edge Functions and act on them.</p>

<figure><div aria-owns="rmiz-modal-" data-rmiz=""></div></figure>
<h3 id="track-errors-with-sentry">Track errors with Sentry</h3>
<p>Our friends at Sentry recently shipped an official <a href="https://deno.land/x/sentry@7.76.0">Sentry SDK for Deno</a>. With this, it&#39;s now easy to track errors and exceptions in your edge functions in Sentry.</p>
<p>Here is a simple example of how to handle exceptions within your function and send them to Sentry.</p>

<h2 id="whats-next">What&#39;s next</h2>
<p>NPM support was one of the most requested features for Edge Functions. If you couldn&#39;t use Edge Functions previously because of the lack of support, we hope this update will entice you to <a href="https://supabase.com/dashboard/project/_/functions">try it again</a>. If you run into any issues, we are just <a href="https://supabase.help">one support request away</a>.</p>
<p>For existing Edge Functions users, regional invocations, better metrics, and error handling are just a glimpse of what will come next. We continue to iterate on platform stability and setting custom limits on resources Edge Functions can use. Watch out for another blog post in the new year.</p>
<h2 id="more-launch-week-x">More Launch Week X</h2>
<ul>
<li><a href="https://supabase.com/blog/studio-introducing-assistant">Day 1 - Supabase Studio update: AI Assistant and User Impersonation</a></li>
<li><a href="https://supabase.com/blog/pg-graphql-postgres-functions">pg_graphql: Postgres functions now supported</a></li>
<li><a href="https://supabase.com/blog/postgres-language-server-implementing-parser">Postgres Language Server: implementing the Parser</a></li>
<li><a href="https://www.youtube.com/watch?v=r1POD-IdG-I">The Supabase Album</a></li>
<li><a href="https://supabase.com/blog/supabase-hackathon-lwx">Supabase Launch Week X Hackathon</a></li>
<li><a href="https://supabase.com/blog/community-meetups-lwx">Launch Week X Community Meetups</a></li>
</ul></div></article></div>
  </body>
</html>
