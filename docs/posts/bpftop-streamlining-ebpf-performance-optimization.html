<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://netflixtechblog.com/announcing-bpftop-streamlining-ebpf-performance-optimization-6a727c1ae2e5?gi=223d75ac1771">Original</a>
    <h1>Bpftop: Streamlining eBPF performance optimization</h1>
    
    <div id="readability-page-1" class="page"><section><div><div><div><div><div><div><div><div><div><div><div><a href="https://netflixtechblog.medium.com" rel="noopener follow"><div><div aria-hidden="false"><div><div><p><img alt="Netflix Technology Blog" src="https://miro.medium.com/v2/resize:fill:88:88/1*BJWRqfSMf9Da9vsXG9EBRQ.jpeg" width="44" height="44" loading="lazy" data-testid="authorPhoto"/></p></div></div></div></div></a><a href="https://netflixtechblog.com" rel="noopener  ugc nofollow"><div><div><div aria-hidden="false"><div><div><p><img alt="Netflix TechBlog" src="https://miro.medium.com/v2/resize:fill:48:48/1*ty4NvNrGg4ReETxqU2N3Og.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto"/></p></div></div></div></div></div></a></div></div></div></div></div></div></div><p id="976a"><em>By </em><a href="https://www.linkedin.com/in/josefernandezmn/" rel="noopener ugc nofollow" target="_blank"><em>Jose Fernandez</em></a></p><p id="5c31">Today, we are thrilled to announce the release of <a href="https://github.com/Netflix/bpftop" rel="noopener ugc nofollow" target="_blank">bpftop</a>, a command-line tool designed to streamline the performance optimization and monitoring of eBPF programs. As Netflix increasingly adopts eBPF [<a rel="noopener ugc nofollow" target="_blank" href="https://netflixtechblog.com/extending-vector-with-ebpf-to-inspect-host-and-container-performance-5da3af4c584b">1</a>, <a rel="noopener ugc nofollow" target="_blank" href="https://netflixtechblog.com/how-netflix-uses-ebpf-flow-logs-at-scale-for-network-insight-e3ea997dca96">2</a>], applying the same rigor to these applications as we do to other managed services is imperative. Striking a balance between eBPF’s benefits and system load is crucial, ensuring it enhances rather than hinders our operational efficiency. This tool enables Netflix to embrace eBPF’s potential.</p><figure><div><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*pum8HfOu5XkB9XEwsKl_hw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*pum8HfOu5XkB9XEwsKl_hw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*pum8HfOu5XkB9XEwsKl_hw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*pum8HfOu5XkB9XEwsKl_hw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*pum8HfOu5XkB9XEwsKl_hw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*pum8HfOu5XkB9XEwsKl_hw.png 1100w, https://miro.medium.com/v2/resize:fit:270/format:webp/1*pum8HfOu5XkB9XEwsKl_hw.png 270w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 135px" type="image/webp"/><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*pum8HfOu5XkB9XEwsKl_hw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*pum8HfOu5XkB9XEwsKl_hw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*pum8HfOu5XkB9XEwsKl_hw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*pum8HfOu5XkB9XEwsKl_hw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*pum8HfOu5XkB9XEwsKl_hw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*pum8HfOu5XkB9XEwsKl_hw.png 1100w, https://miro.medium.com/v2/resize:fit:270/1*pum8HfOu5XkB9XEwsKl_hw.png 270w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 135px"/><img alt="" width="135" height="135" loading="eager" role="presentation"/></picture></div></figure><p id="a934">bpftop provides a dynamic real-time view of running eBPF programs. It displays the average execution runtime, events per second, and estimated total CPU % for each program. This tool minimizes overhead by enabling performance statistics only while it is active.</p><figure><div role="button" tabindex="0"><div><picture><source srcset="https://miro.medium.com/v2/resize:fit:640/format:webp/1*hLvLcNDb6RljixhN8la-lg.gif 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*hLvLcNDb6RljixhN8la-lg.gif 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*hLvLcNDb6RljixhN8la-lg.gif 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*hLvLcNDb6RljixhN8la-lg.gif 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*hLvLcNDb6RljixhN8la-lg.gif 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*hLvLcNDb6RljixhN8la-lg.gif 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hLvLcNDb6RljixhN8la-lg.gif 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcset="https://miro.medium.com/v2/resize:fit:640/1*hLvLcNDb6RljixhN8la-lg.gif 640w, https://miro.medium.com/v2/resize:fit:720/1*hLvLcNDb6RljixhN8la-lg.gif 720w, https://miro.medium.com/v2/resize:fit:750/1*hLvLcNDb6RljixhN8la-lg.gif 750w, https://miro.medium.com/v2/resize:fit:786/1*hLvLcNDb6RljixhN8la-lg.gif 786w, https://miro.medium.com/v2/resize:fit:828/1*hLvLcNDb6RljixhN8la-lg.gif 828w, https://miro.medium.com/v2/resize:fit:1100/1*hLvLcNDb6RljixhN8la-lg.gif 1100w, https://miro.medium.com/v2/resize:fit:1400/1*hLvLcNDb6RljixhN8la-lg.gif 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" width="700" height="413" loading="lazy" role="presentation"/></picture></div></div></figure><p id="0afb">bpftop simplifies the performance optimization process for eBPF programs by enabling an efficient cycle of benchmarking, code refinement, and immediate feedback. Without bpftop, optimization efforts would require manual calculations, adding unnecessary complexity to the process. With bpftop, users can quickly establish a baseline, implement improvements, and verify enhancements, streamlining the process.</p><p id="f37b">A standout feature of this tool is its ability to display the statistics in time series graphs. This approach can uncover patterns and trends that could be missed otherwise.</p><p id="c629">bpftop uses the <a href="https://elixir.bootlin.com/linux/v6.6.16/source/include/uapi/linux/bpf.h#L792" rel="noopener ugc nofollow" target="_blank">BPF_ENABLE_STATS</a> syscall command to enable global eBPF runtime statistics gathering, which is disabled by default to reduce performance overhead. It collects these statistics every second, calculating the average runtime, events per second, and estimated CPU utilization for each eBPF program within that sample period. This information is displayed in a top-like tabular format or a time series graph over a 10s moving window. Once bpftop terminates, it turns off the statistics-gathering function. The tool is written in Rust, leveraging the <a href="https://github.com/libbpf/libbpf-rs" rel="noopener ugc nofollow" target="_blank">libbpf-rs</a> and <a href="https://github.com/ratatui-org/ratatui" rel="noopener ugc nofollow" target="_blank">ratatui</a> crates.</p><p id="33df">Visit the project’s <a href="https://github.com/Netflix/bpftop" rel="noopener ugc nofollow" target="_blank">GitHub page</a> to learn more about using the tool. We’ve open-sourced bpftop under the Apache 2 license and look forward to contributions from the community.</p></div></div></div></div></section></div>
  </body>
</html>
