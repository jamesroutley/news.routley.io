<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.nih.gov/news-events/news-releases/prenatal-cannabis-exposure-associated-mental-disorders-children-persist-into-early-adolescence">Original</a>
    <h1>Prenatal cannabis exposure associated with mental disorders in children</h1>
    
    <div id="readability-page-1" class="page"><div>
    <article>
        <span>
            <time datetime="2022-09-12">12 Sep 2022</time>
        </span>
        
        
        <section>
            <p>As you might know, <a href="https://twitter.com/FiloSottile/status/1522671407636877315">I left Google in spring</a> to try and make the concept of a <a href="https://words.filippo.io/professional-maintainers/">professional Open Source maintainer</a> a thing. I&#39;m staying on as a maintainer of the Go cryptography standard library, and I am going to seek funding from companies that rely on it, want to ensure its security and reliability, and would like to get a direct line to the maintainers of their critical business infrastructure. (If this sounds like you, reply to this email!)</p><p>In the meantime, though, the <a href="https://github.com/golang/go/wiki/Go-Release-Cycle">Go development cycle</a> progresses inexorably, with the Go 1.20 feature freeze coming at the beginning of November. Once the main Go tree freezes, I plan to work on <code>x/crypto/ssh</code> and <code>age</code>, but in the meantime I have a few things I am excited about for Go 1.20.</p><!--kg-card-begin: markdown--><h2 id="cryptoecdh">crypto/ecdh</h2>
<p>The most visible change will be the landing the new <a href="https://pkg.go.dev/crypto/ecdh@master"><code>crypto/ecdh</code> package</a> I <a href="https://github.com/golang/go/issues/52221">proposed</a> and <a href="https://go.dev/cl/398914">implemented</a> earlier this year. The package provides a safe, <code>[]byte</code>-based, easy to use API for Elliptic Curve Diffie-Hellman over Curve25519 and NIST curves (P-256 and company, but no P-224 if we can get away with it).</p>
<p><code>crypto/ecdh</code> was made possible by a long-running refactor of the elliptic curve implementations in the standard library. Between Go 1.17 and Go 1.19, most critical code was moved to safer low-level APIs under <code>crypto/internal/nistec</code> and <code>crypto/internal/edwards25519</code>, large pieces were replaced with code generated from <a href="https://github.com/mit-plv/fiat-crypto">fiat-crypto</a>&#39;s formally verified models, making every curve constant time, most group logic was replaced with modern complete formulas, and even <a href="https://go-review.googlesource.com/c/go/+/396255">the assembly was massaged to implement the same functions on all architectures</a> and fit the nistec API. <a href="https://go-review.googlesource.com/c/crypto/+/315269">Some assembly is gone</a>, actually!</p>
<p>(<a href="https://go-review.googlesource.com/q/hashtag:crypto-elliptic-refactor">Here are all the changes.</a> <a href="https://cs.opensource.google/go/go/+/master:src/crypto/ecdh/nist.go;l=16-29;drc=d88d91e32e1440307369d50ba17ce622399a8bc1">A couple nifty uses of generics in there if you&#39;re curious.</a>)</p>
<p>The goal of the package is to replace the major use case for the <strong>now-deprecated</strong> <code>crypto/elliptic</code> API, which has a hardcoded dependency on the variable-time, large, and complex <code>math/big</code> package. <code>crypto/elliptic</code> is now no more than a compatibility wrapper. Any more advanced uses of <code>crypto/elliptic</code> can switch to <a href="https://filippo.io/nistec">filippo.io/nistec</a> which is an exported version of <code>crypto/internal/nistec</code>, or <a href="https://filippo.io/edwards25519">filippo.io/edwards25519</a> which is an exported version of <code>crypto/internal/edwards25519</code>.</p>
<p>What&#39;s left to do in Go 1.20 then?</p>
<p>First, actually landing the new package, <a href="https://go.dev/cl/398914">which is already submitted</a>! Then, adding and reviewing new tests (including <a href="https://go-review.googlesource.com/c/crypto/+/424274">Wycheproof integration</a> by Roland), which actually revealed there are <a href="https://go-review.googlesource.com/c/go/+/425463">fewer (!!) edge cases than I had originally documented</a>. Finally, reviewing <a href="https://go-review.googlesource.com/c/go/+/423363">the BoringCrypto integration by Russ</a>.</p>
<h2 id="mathbig-out-of-the-security-perimeter">math/big out of the security perimeter</h2>
<p>There is an even broader goal behind this work: moving <code>math/big</code> out of the security perimeter entirely, meaning making it unreachable from attacker-exposed cryptographic APIs and protocols.</p>
<p><code>math/big</code> is a general-purpose big integer library, it&#39;s not constant time, and it&#39;s full of complex code that while unnecessary for cryptography has <strong>repeatedly led to security vulnerabilities in crypto packages</strong>. While it was a convenient way to bootstrap the Go crypto standard library, <code>math/big</code> does not belong in crypto code in 2022.</p>
<p><code>crypto/ecdh</code> lets us deprecate <code>crypto/elliptic</code>, and lets us bypass <code>math/big</code> in <code>crypto/tls</code>&#39;s ECDHE implementation.</p>
<p>The next step is modifying <code>crypto/ecdsa</code> to use <code>crypto/internal/nistec</code> for the group operations on known curves, deprecate the use of custom curves, and replace the scalar field operations with... something. That something might be fiat-crypto field implementations for each scalar field (P-256&#39;s, P-384&#39;s, and P-521&#39;s) with the <a href="https://words.filippo.io/dispatches/wide-reduction/">wide reduction trick we talked about in Cryptography Dispatches</a>, or using a minimal bigint implementation shared with <code>crypto/rsa</code>.</p>
<p>Speaking of, <code>crypto/rsa</code> unavoidably needs a lightweight bigint implementation to replace its dependency on <code>math/big</code>. The good news is that we can make that one constant-time, simple, and tightly scoped for its purposes, which should make it much easier to maintain and keep secure. <a href="https://go-review.googlesource.com/c/go/+/326012">Lucas contributed one</a> that needs review, and Thomas Pornin offered a Go port of <a href="https://www.bearssl.org/bigint.html">BearSSL&#39;s one</a>. This will be a significant amount of assessment, review, and testing work, but it&#39;s the last real hurdle.</p>
<p>Finally, we need to worry about the places where <code>big.Int</code> is exposed in public APIs, mainly <code>crypto/rsa</code> and <code>crypto/ecdsa</code> key types. An idea is making the <code>(*Int).SetBytes</code>/<code>(*Int).FillBytes</code> round-trip constant-time so it can be used as just an annoying way to carry around the <code>[]byte</code> encoding of the key values. The problems with that are how to handle (or check in constant time) any manual modification to the <code>big.Int</code>, and how to store zero-padded values (which we can&#39;t unpad in constant time) without breaking the normalization invariant of <code>big.nat</code>. I welcome suggestions!</p>
<p>If we do go the route of keeping a select subset of <code>math/big</code> exposed, we&#39;ll want to lock it in to ensure we can keep it constant time and well reviewed. For that I have a <a href="https://go-review.googlesource.com/c/go/+/402554">WIP test that does static analysis to ensure only expected functions are reachable from crypto packages</a>.</p>
<h2 id="more-elliptic-curves">More elliptic curves</h2>
<p>Aside from the <code>math/big</code>-related efforts, there are a couple other Go 1.20 tasks that have to do with elliptic curves.</p>
<p>First, <a href="https://go-review.googlesource.com/c/go/+/420454">landing a rewrite of the edwards25519 scalar field</a> that replaces the last bits of unreadable ref10 code with fiat-crypto generated code. You can read more on <a href="https://words.filippo.io/dispatches/wide-reduction/">a previous Cryptography Dispatches issue</a>, and there&#39;s an overview of the overall edwards25519 rewrite in <a href="https://go-review.googlesource.com/c/go/+/276272">the CL that landed it after years out-of-tree</a>.</p>
<p>Second, finally <a href="https://go-review.googlesource.com/c/go/+/373076">landing support for Ed25519ph (the pre-hashed variant of Ed25519)</a> in <code>crypto/ed25519</code>.</p>
<h2 id="cryptotls">crypto/tls</h2>
<p>Finally, as a stretch goal in case elliptic curve work leaves some space for other things, I collected a couple batches of <code>crypto/tls</code> work. (I find it more efficient to work in topic-scoped batches, so I can load context on a protocol and codebase once and use it to land multiple changes.)</p>
<p>One batch revolves around session resumption: exposing a way to provide external PSKs in TLS 1.3 (which are the underlying mechanism of session tickets in TLS 1.3), maybe implementing PSK modes, implementing Session IDs, making sessions serializable/exportable.</p>
<p>Here&#39;s a list of related issues. (The one about forward secrecy by default was already mostly addressed by <a href="https://go-review.googlesource.com/q/%252325256">work we landed somewhat quietly with Katie in Go 1.15</a>, which I&#39;m hoping to write about for the Go blog, as it sets Go significantly apart from any other TLS stack I know about.)</p>
<ul>
<li><a href="https://github.com/golang/go/issues/31641">crypto/tls: TLS session resumption re-verifies the client&#39;s certificate chain</a></li>
<li><a href="https://github.com/golang/go/issues/25351">crypto/tls: make ClientSessionState serializable</a></li>
<li><a href="https://github.com/golang/go/issues/25228">proposal: crypto/tls: implement Session IDs resumption</a></li>
<li><a href="https://github.com/golang/go/issues/19199">proposal: crypto/tls: SessionTicketWrapper and Forward Secrecy by default</a></li>
<li><a href="https://github.com/golang/go/issues/6379">crypto/tls: add PSK support</a></li>
<li><a href="https://github.com/golang/go/issues/46718">proposal: crypto/tls: expose a session identifier</a></li>
</ul>
<p>The second batch is a miscellaneous list of crypto/tls work. If you have anything else TLS-related you care about, now is a good time to ping me on it.</p>
<ul>
<li><a href="https://github.com/golang/go/issues/20420">crypto/tls: customisable max TLS record size</a></li>
<li><a href="https://github.com/golang/go/issues/35504">crypto/tls: improve default performance of SupportsCertificate</a></li>
<li><a href="https://github.com/golang/go/issues/46308">crypto/tls: add VersionName function to return a string version of the TLS Version</a></li>
<li><a href="https://github.com/golang/go/issues/48152">crypto/tls: expose all presented certs in error type on handshake failure</a></li>
<li><a href="https://github.com/golang/go/issues/49126">crypto/tls: support ECDHE key exchanges when ec_point_formats is missing in ClientHello extension</a></li>
<li><a href="https://github.com/golang/go/issues/50773">crypto/tls: make maxHandshake larger or configurable</a></li>
<li><a href="https://github.com/golang/go/issues/51434">crypto/tls: run BoringSSL test suite (BoGo)</a></li>
<li><a href="https://github.com/golang/go/issues/43922">proposal: crypto/tls: implement RFC7627</a></li>
</ul>
<!--kg-card-end: markdown--><h2 id="the-picture">The picture</h2><p>DEF CON was a blast (we won a Black Badge with the Scavenger Hunt!) and systematically eating outdoors and wearing a P100 respirator spared me from COVID. Las Vegas is hell but pretty.</p><figure><img src="https://words.filippo.io/content/images/2022/09/Newsletter---1--1--1.jpeg" alt="A night-time picture of the Las Vegas skyline taken from a high floor. In the foreground a large road, mostly empty, and two blocks of low buildings and empty space with a couple billboards with bright lights. Mid-frame, a string of high-rise casinos covered in sparkly lights. In the background, pitch black sky." loading="lazy" width="2000" height="1096" srcset="https://words.filippo.io/content/images/size/w600/2022/09/Newsletter---1--1--1.jpeg 600w, https://words.filippo.io/content/images/size/w1000/2022/09/Newsletter---1--1--1.jpeg 1000w, https://words.filippo.io/content/images/size/w1600/2022/09/Newsletter---1--1--1.jpeg 1600w, https://words.filippo.io/content/images/size/w2400/2022/09/Newsletter---1--1--1.jpeg 2400w" sizes="(min-width: 720px) 720px"/></figure><p>If you want to stay up to date with my Open Source work, consider <a href="https://twitter.com/FiloSottile">following me on Twitter</a> or <a href="https://filippo.io/newsletter">subscribing to this newsletter</a> if you haven&#39;t already! <strong>If your company depends on Go and its cryptography libraries</strong>, or any other of my Open Source projects, consider sponsoring my maintenance work. Reply to this email, introduce me to the right people, and I&#39;ll work with your accounting department to make it happen!</p>
        </section>
    </article>
</div></div>
  </body>
</html>
