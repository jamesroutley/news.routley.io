<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/flipt-io/reverst">Original</a>
    <h1>Reverst: Reverse Tunnels in Go over HTTP/3 and QUIC</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><div dir="auto"><h2 tabindex="-1" dir="auto">reverst: HTTP reverse tunnels over QUIC</h2><a id="user-content-reverst-http-reverse-tunnels-over-quic" aria-label="Permalink: reverst: HTTP reverse tunnels over QUIC" href="#reverst-http-reverse-tunnels-over-quic"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<blockquote>
<p dir="auto">Ti esrever dna ti pilf nwod gnaht ym tup i</p>
</blockquote>
<p dir="auto">Reverst is a (load-balanced) reverse-tunnel server and Go server-client library built on QUIC and HTTP/3.</p>
<ul dir="auto">
<li>Go Powered: Written in Go using <a href="https://github.com/quic-go/quic-go">quic-go</a></li>
<li>Compatible: The Go <code>client</code> package is built on <code>net/http</code> standard-library abstractions</li>
<li>Load-balanced: Run multiple instances of your services behind the same tunnel</li>
<li>Performant: Built on top of QUIC and HTTP/3</li>
</ul>

<p dir="auto">Reverst is for exposing services on the public internet from within restrictive networks (e.g. behind NAT gateways).
The tunnel binary is intended to be deployed on the public internet.
Client servers then dial out to the tunnels and register themselves on target tunnel groups.
A tunnel group is a load-balanced set of client-servers, which is exposed through the reverst tunnel HTTP interface.</p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://github.com/flipt-io/reverst/blob/main/diagram.png"><img width="800" height="1199" src="https://github.com/flipt-io/reverst/raw/main/diagram.png" alt="Tunnel Lifecycle"/></a>
</p>


<div dir="auto" data-snippet-clipboard-copy-content="➜  reverst -h
COMMAND
  reverst

USAGE
  reverst [FLAGS]

FLAGS
  -l, --log LEVEL                    debug, info, warn or error (default: INFO)
  -a, --tunnel-address STRING        address for accepting tunnelling quic connections (default: 127.0.0.1:7171)
  -s, --http-address STRING          address for serving HTTP requests (default: 127.0.0.1:8181)
  -g, --tunnel-groups STRING         path to tunnel groups configuration file (default: groups.yml)
  -n, --server-name STRING           server name used to identify tunnel via TLS (required)
  -k, --private-key-path STRING      path to TLS private key PEM file (required)
  -c, --certificate-path STRING      path to TLS certificate PEM file (required)
      --max-idle-timeout DURATION    maximum time a connection can be idle (default: 1m0s)
      --keep-alive-period DURATION   period between keep-alive events (default: 30s)"><pre>➜  <span>reverst -h</span>
<span>COMMAND</span>
<span>  reverst</span>

<span>USAGE</span>
<span>  reverst [FLAGS]</span>

<span>FLAGS</span>
<span>  -l, --log LEVEL                    debug, info, warn or error (default: INFO)</span>
<span>  -a, --tunnel-address STRING        address for accepting tunnelling quic connections (default: 127.0.0.1:7171)</span>
<span>  -s, --http-address STRING          address for serving HTTP requests (default: 127.0.0.1:8181)</span>
<span>  -g, --tunnel-groups STRING         path to tunnel groups configuration file (default: groups.yml)</span>
<span>  -n, --server-name STRING           server name used to identify tunnel via TLS (required)</span>
<span>  -k, --private-key-path STRING      path to TLS private key PEM file (required)</span>
<span>  -c, --certificate-path STRING      path to TLS certificate PEM file (required)</span>
<span>      --max-idle-timeout DURATION    maximum time a connection can be idle (default: 1m0s)</span>
<span>      --keep-alive-period DURATION   period between keep-alive events (default: 30s)</span></pre></div>




<p dir="auto">See <a href="https://github.com/flipt-io/reverst/blob/main/client">./client</a> directory for more details.</p>




<p dir="auto">Reverst uses Dagger to setup and run an integration test suite.</p>
<div dir="auto" data-snippet-clipboard-copy-content="dagger call test --source=."><pre><span>dagger call test --source=.</span></pre></div>
<p dir="auto">The test suite sets up a tunnel, registers a server-client to the tunnel and then requests the service through the tunnels HTTP interface.</p>

<p dir="auto">The following walks through experimenting with the <a href="https://github.com/flipt-io/reverst/blob/main/examples/simple">./examples/simple</a> server example.
This directory contains a number of things needed to stand up reverst and a registering client server:</p>
<ul dir="auto">
<li>The example service in <a href="https://github.com/flipt-io/reverst/blob/main/examples/simple/main.go">./examples/simple/main.go</a>.</li>
<li>Simple self-signed TLS private key and certificate.</li>
<li>A tunnel-groups file for routing decisions.</li>
</ul>

<p dir="auto">The following runs the tunnel server with:</p>
<ul dir="auto">
<li>The QUIC tunnel listener on <code>127.0.0.1:7171</code></li>
<li>The HTTP serving listener on <code>127.0.0.1:8181</code></li>
<li>Logging with <code>debug</code> level</li>
<li>A TLS server-name of <code>flipt.dev.local</code></li>
<li>Some tunnel group definitions with a single tunnel group
<ul dir="auto">
<li>The group has the name <code>flipt.dev.local</code></li>
<li>The group is reachable under the same host name</li>
<li>The group requires basic username and password authentication</li>
</ul>
</li>
<li>The dummy TLS certificates</li>
</ul>
<div dir="auto" data-snippet-clipboard-copy-content="go run ./cmd/reverst/... -l debug \
    -n flipt.dev.local \
    -g examples/simple/group.yml \
    -k examples/simple/server.key \
    -c examples/simple/server.crt"><pre><span>go run ./cmd/reverst/... -l debug \</span>
<span>    -n flipt.dev.local \</span>
<span>    -g examples/simple/group.yml \</span>
<span>    -k examples/simple/server.key \</span>
<span>    -c examples/simple/server.crt</span></pre></div>

<p dir="auto">Now you can run the example server.
This is a simple HTTP server that responds to all requests with <code>PONG</code>.
It is setup to use the server client to register as a listener on the tunnel.</p>
<div dir="auto" data-snippet-clipboard-copy-content="go run ./examples/simple/main.go --username user --password pass"><pre><span>go run ./examples/simple/main.go --username user --password pass</span></pre></div>

<p dir="auto">You can now curl the tunnel and requests will be forward all the way through to the example server.
Be sure to include the <code>Host</code> header, as this is used to route requests to the respective tunnel-group.</p>
<div data-snippet-clipboard-copy-content="curl -H &#39;Host: flipt.dev.local&#39; 127.0.0.1:8181/fo"><pre lang="curl"><code>curl -H &#39;Host: flipt.dev.local&#39; 127.0.0.1:8181/fo
</code></pre></div>
</article></div></div>
  </body>
</html>
