<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/toots/shine">Original</a>
    <h1>Shine: A super fast fixed-point MP3 encoder</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a href="https://github.com/savonet/shine">shine</a> is a blazing fast mp3 encoding library implemented in
fixed-point arithmetic. The library can thus be used to performe super fast mp3 encoding on architectures
without a FPU, such as <code>armel</code>, etc.. It is also, however, also super fast on architectures with a FPU!</p>
<h2 dir="auto"><a id="user-content-how-to-use" aria-hidden="true" href="#how-to-use"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How to use?</h2>
<p dir="auto">The encoding API should be quite straight forward:</p>
<div data-snippet-clipboard-copy-content="#include &lt;shine/layer3.h&gt;
  
(...)

/* See if samplerate and bitrate are valid */
if (shine_check_config(config.wave.samplerate, config.mpeg.bitr) &lt; 0)
  error(&#34;Unsupported samplerate/bitrate configuration.&#34;);

/* Initiate encoder */
s = shine_initialise(&amp;config);

/* Number of samples (per channel) to feed the encoder with. */
int samples_per_pass = shine_samples_per_pass(s);

/* All the magic happens here */
while (read(buffer, infile, samples_per_pass)) {
  data = shine_encode_buffer(s,buffer,&amp;written);
  write(data, written);
}

/* Flush and write remaining data. */
data = shine_flush(s,&amp;written);
write(written, data);

/* Close encoder. */
shine_close(s);"><pre>#<span>include</span> <span><span>&lt;</span>shine/layer3.h<span>&gt;</span></span>
  
(...)

<span><span>/*</span> See if samplerate and bitrate are valid <span>*/</span></span>
<span>if</span> (shine_check_config(config.wave.samplerate, config.mpeg.bitr) &lt; <span>0</span>)
  <span>error</span>(<span><span>&#34;</span>Unsupported samplerate/bitrate configuration.<span>&#34;</span></span>);

<span><span>/*</span> Initiate encoder <span>*/</span></span>
s = shine_initialise(&amp;config);

<span><span>/*</span> Number of samples (per channel) to feed the encoder with. <span>*/</span></span>
<span>int</span> samples_per_pass = shine_samples_per_pass(s);

<span><span>/*</span> All the magic happens here <span>*/</span></span>
<span>while</span> (read(buffer, infile, samples_per_pass)) {
  data = <span>shine_encode_buffer</span>(s,buffer,&amp;written);
  <span>write</span>(data, written);
}

<span><span>/*</span> Flush and write remaining data. <span>*/</span></span>
data = shine_flush(s,&amp;written);
<span>write</span>(written, data);

<span><span>/*</span> Close encoder. <span>*/</span></span>
<span>shine_close</span>(s);</pre></div>
<h2 dir="auto"><a id="user-content-how-fast-is-it" aria-hidden="true" href="#how-fast-is-it"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How fast is it?</h2>
<p dir="auto">On a <a href="http://www.raspberrypi.org/" rel="nofollow">Raspberry Pi</a> (<code>ARM</code>, <code>FPU</code>):</p>
<p dir="auto">Lame, <code>3m06s</code>, <code>1.8x</code> realtime:</p>
<div data-snippet-clipboard-copy-content="pi@raspberrypi ~ $ lame bla.wav bla.mp3
LAME 3.99.5 32bits (http://lame.sf.net)
Using polyphase lowpass filter, transition band: 16538 Hz - 17071 Hz
Encoding bla.wav to bla.mp3
Encoding as 44.1 kHz j-stereo MPEG-1 Layer III (11x) 128 kbps qval=3
    Frame          |  CPU time/estim | REAL time/estim | play/CPU |    ETA
 12987/12987 (100%)|    3:06/    3:06|    3:06/    3:06|   1.8216x|    0:00
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   kbps        LR    MS  %     long switch short %
  128.0        0.1  99.9        89.1   6.1   4.9
Writing LAME Tag...done
ReplayGain: -10.5dB"><pre>pi@raspberrypi <span>~</span> $ lame bla.wav bla.mp3
LAME 3.99.5 32bits (http://lame.sf.net)
Using polyphase lowpass filter, transition band: 16538 Hz - 17071 Hz
Encoding bla.wav to bla.mp3
Encoding as 44.1 kHz j-stereo MPEG-1 Layer III (11x) 128 kbps qval=3
    Frame          <span>|</span>  CPU time/estim <span>|</span> REAL time/estim <span>|</span> play/CPU <span>|</span>    ETA
 12987/12987 (100%)<span>|</span>    3:06/    3:06<span>|</span>    3:06/    3:06<span>|</span>   1.8216x<span>|</span>    0:00
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   kbps        LR    MS  %     long switch short %
  128.0        0.1  99.9        89.1   6.1   4.9
Writing LAME Tag...done
ReplayGain: -10.5dB</pre></div>
<p dir="auto">Shine, <code>1m35s</code>, <code>3.6x</code> realtime:</p>
<div data-snippet-clipboard-copy-content="pi@raspberrypi ~ $ shineenc bla.wav bla.mp3
shineenc (Liquidsoap version)
WAVE PCM Data, stereo 44100Hz 16bit, duration: 00:05:39
MPEG-I layer III, stereo  Psychoacoustic Model: Shine
Bitrate: 128 kbps  De-emphasis: none   Original
Encoding &#34;bla.wav&#34; to &#34;bla.mp3&#34;
Finished in 00:01:35 (3.6x realtime)"><pre>pi@raspberrypi <span>~</span> $ shineenc bla.wav bla.mp3
shineenc (Liquidsoap version)
WAVE PCM Data, stereo 44100Hz 16bit, duration: 00:05:39
MPEG-I layer III, stereo  Psychoacoustic Model: Shine
Bitrate: 128 kbps  De-emphasis: none   Original
Encoding <span><span>&#34;</span>bla.wav<span>&#34;</span></span> to <span><span>&#34;</span>bla.mp3<span>&#34;</span></span>
Finished <span>in</span> 00:01:35 (3.6x realtime)</pre></div>
<p dir="auto">Now, on a mac airbook (<code>x86_64</code>, <code>FPU</code>):</p>
<p dir="auto">Lame, <code>15s</code>, <code>22x</code> realtime:</p>
<div data-snippet-clipboard-copy-content="toots@zulu tmp  % lame bla.wav bla.mp3
LAME 3.99.5 64bits (http://lame.sf.net)
Using polyphase lowpass filter, transition band: 16538 Hz - 17071 Hz
Encoding bla.wav to bla.mp3
Encoding as 44.1 kHz j-stereo MPEG-1 Layer III (11x) 128 kbps qval=3
    Frame          |  CPU time/estim | REAL time/estim | play/CPU |    ETA
 12987/12987 (100%)|    0:15/    0:15|    0:17/    0:17|   22.087x|    0:00
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   kbps        LR    MS  %     long switch short %
  128.0        0.1  99.9        89.1   6.1   4.9
Writing LAME Tag...done
ReplayGain: -10.5dB"><pre>toots@zulu tmp  % lame bla.wav bla.mp3
LAME 3.99.5 64bits (http://lame.sf.net)
Using polyphase lowpass filter, transition band: 16538 Hz - 17071 Hz
Encoding bla.wav to bla.mp3
Encoding as 44.1 kHz j-stereo MPEG-1 Layer III (11x) 128 kbps qval=3
    Frame          <span>|</span>  CPU time/estim <span>|</span> REAL time/estim <span>|</span> play/CPU <span>|</span>    ETA
 12987/12987 (100%)<span>|</span>    0:15/    0:15<span>|</span>    0:17/    0:17<span>|</span>   22.087x<span>|</span>    0:00
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   kbps        LR    MS  %     long switch short %
  128.0        0.1  99.9        89.1   6.1   4.9
Writing LAME Tag...done
ReplayGain: -10.5dB</pre></div>
<p dir="auto">Shine, <code>9s</code>, <code>37.7x</code> realtime:</p>
<div data-snippet-clipboard-copy-content="shineenc (Liquidsoap version)
WAVE PCM Data, stereo 44100Hz 16bit, duration: 00:05:39
MPEG-I layer III, stereo  Psychoacoustic Model: Shine
Bitrate: 128 kbps  De-emphasis: none   Original
Encoding &#34;/tmp/bla.wav&#34; to &#34;/tmp/bla.mp3&#34;
Finished in 00:00:09 (37.7x realtime)"><pre><code>shineenc (Liquidsoap version)
WAVE PCM Data, stereo 44100Hz 16bit, duration: 00:05:39
MPEG-I layer III, stereo  Psychoacoustic Model: Shine
Bitrate: 128 kbps  De-emphasis: none   Original
Encoding &#34;/tmp/bla.wav&#34; to &#34;/tmp/bla.mp3&#34;
Finished in 00:00:09 (37.7x realtime)
</code></pre></div>
<p dir="auto">On a Google Nexus 5 (<code>ARM</code>, <code>FPU</code>):</p>
<p dir="auto">Shine, <code>14s</code>, <code>24.2x</code> realtime:</p>
<div data-snippet-clipboard-copy-content="u0_a65@hammerhead:/mnt/sdcard $ shineenc bla.wav bla.mp3
shineenc (Liquidsoap version)
WAVE PCM Data, stereo 44100Hz 16bit, duration: 00:05:39
MPEG-I layer III, stereo  Psychoacoustic Model: Shine
Bitrate: 128 kbps  De-emphasis: none   Original
Encoding &#34;bla.wav&#34; to &#34;bla.mp3&#34;
Finished in 00:00:14 (24.2x realtime)"><pre>u0_a65@hammerhead:/mnt/sdcard $ shineenc bla.wav bla.mp3
shineenc (Liquidsoap version)
WAVE PCM Data, stereo 44100Hz 16bit, duration: 00:05:39
MPEG-I layer III, stereo  Psychoacoustic Model: Shine
Bitrate: 128 kbps  De-emphasis: none   Original
Encoding <span><span>&#34;</span>bla.wav<span>&#34;</span></span> to <span><span>&#34;</span>bla.mp3<span>&#34;</span></span>
Finished <span>in</span> 00:00:14 (24.2x realtime)</pre></div>
<h2 dir="auto"><a id="user-content-limitations" aria-hidden="true" href="#limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Limitations</h2>
<p dir="auto">The code for the encoder has been written a long time ago (see below) and
the only work done on this fork consists of reorganizing the code and making a
proper shared API out of it. Thus, the encoder may not be exempt of bugs.</p>
<p dir="auto">Also, the encoding algorithm is rather simple. In particular, it does not
have any Psychoacoustic Model.</p>
<h2 dir="auto"><a id="user-content-a-bit-of-history" aria-hidden="true" href="#a-bit-of-history"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>A bit of history</h2>
<p dir="auto">This code was dug out from the dusty crates of those times before internet
and github. It apparently was created by Gabriel Bouvigne sometime around
the end of the 20th century. The encoder was converted circa 2001 by Pete
Everett to fixed-point arithmetic for the RISC OS. Latest we know, Patrick
Roberts had worked on the code to make it multi-platform and more library
oriented. That was around 2006.</p>
<p dir="auto">You can consult <code>README.old</code> and the various source files for more
informations on this code.</p>
</article>
          </div></div>
  </body>
</html>
