<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/trholding/llama2.c">Original</a>
    <h1>Llama 2 Everywhere (L2E): Standalone, Binary Portable, Bootable Llama 2</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><h2 tabindex="-1" id="user-content-llama-2-everywhere-l2e" dir="auto"><a href="#llama-2-everywhere-l2e">Llama 2 Everywhere (L2E)<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://erikarow.land/trholding/llama2.c/blob/master/assets/llamas_everywhere.jpg"><img src="https://erikarow.land/trholding/llama2.c/raw/master/assets/llamas_everywhere.jpg" width="600" height="454" alt="LLamas Everywhere!"/></a>
</p>
<p dir="auto">Standalone, Binary Portable, Bootable Llama 2</p>
<p dir="auto">The primary objective of Llama 2 Everywhere (L2E) is to ensure its compatibility across a wide range of devices, from booting on repurposed chromebooks discarded by school districts to high-density unikernel deployments in enterprises.</p>
<p dir="auto">We believe that in future by harnessing a legion of small specialized LLMs with modest hardware requirements which are networked, distributed, and self-coordinated, L2E has the potential to democratize access to AI and unlock collective intelligence that surpasses that of a single large LLM.</p>
<p dir="auto">The current compelling use case of L2E involves training small models on diverse textual sources, including textbooks, open books, and comprehensive corpora like the SlimPajama corpus. These trained models can be deployed using L2E, enabling them to run as bootable instances on outdated school computers. This deployment scenario proves particularly valuable in school libraries or classrooms where internet connectivity is limited or unavailable, serving as an information gateway* for students without constant reliance on the internet.</p>
<p dir="auto">By pursuing the vision of Llama 2 Everywhere, we aim to create an inclusive AI ecosystem that can adapt to diverse environments and empower individuals and communities on a global scale.</p>
<p dir="auto">My research goal is to train models using various hardware telemetry data with the hope that the models learn to interpret sensor inputs and control actuators based on the insights they glean from the sensor inputs. This research direction may open up exciting possibilities in fields such as automation, space, robotics and IoT, where L2E can play a pivotal role in bridging the gap between AI and physical systems.</p>
<p dir="auto">A friendly fork of the excellent <a href="https://github.com/karpathy/llama2.c">@karpathy&#39;s llama2.c</a></p>
<p dir="auto">I will be mirrorring the progress of <a href="https://github.com/karpathy/llama2.c">https://github.com/karpathy/llama2.c</a> every week, add portability, performance improvements and convenience features such as a web interface which certainly would not fit in the upstream do to the minimalistic elegance requirements there.</p>
<h3 tabindex="-1" id="user-content--how-do-we-make-sure-that-the-output-is-factual-and-not-hallucinated" dir="auto"><a href="#-how-do-we-make-sure-that-the-output-is-factual-and-not-hallucinated">* How do we make sure that the output is factual and not hallucinated?<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">It&#39;s a chicken and egg problem. This has to be explored and figured out on the way. Some ideas on mind are:</p>
<ol dir="auto">
<li>Topic specialized models which are frequently updated maybe every month or two.</li>
<li>Fact Checking &amp; Moderation specialized models which moderate or do fact checking on other model&#39;s output.</li>
<li>Reduce / mitigate hallucinations through output validation (both neural and rule based).</li>
<li>Prompt rewriting both neural and with rules.</li>
<li>Educators / Students / Users can flag answers. Administrators could update rules.</li>
</ol>

<h4 tabindex="-1" id="user-content-new---l2e-os-linux-kernel" dir="auto"><a href="#new---l2e-os-linux-kernel">NEW - L2E OS (Linux Kernel)<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h4>
<p dir="auto">Have you ever wanted to really boot and inference a baby Llama 2 model on a computer? No? Well, now you can!</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/93451215/272002490-5142b54e-b46f-4224-99a6-44b8896d2358.png"><img src="https://user-images.githubusercontent.com/93451215/272002490-5142b54e-b46f-4224-99a6-44b8896d2358.png" alt="temple dos"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/93451215/272002864-ce139c79-407d-4946-8244-0f38a3c07211.png"><img src="https://user-images.githubusercontent.com/93451215/272002864-ce139c79-407d-4946-8244-0f38a3c07211.png" alt="GUI"/></a></p>
<p dir="auto">Have you ever wanted to do <code>cat /dev/llama</code> and <code>echo &#34;Sudo make me a sandwich!&#34; &gt; /dev/llama</code> or pass a kernel parameter such as <code>l2e.quest=&#34;What is the meaning of life?&#34;</code> ? No? Well, as luck would have, it now you can!</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/93451215/272002648-93b7e87b-170e-4a25-8b61-2a9cef461714.png"><img src="https://user-images.githubusercontent.com/93451215/272002648-93b7e87b-170e-4a25-8b61-2a9cef461714.png" alt="dmesg"/></a></p>
<p dir="auto">Download and run the ISO from the latest release!</p>
<h3 tabindex="-1" id="user-content-new---unikernel-build" dir="auto"><a href="#new---unikernel-build">NEW - Unikernel Build<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Have you ever wanted to boot and inference a herd of 1000&#39;s of Virtual baby Llama 2 models on big ass enterprise servers? No? Well, now you can!</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/93451215/263436853-415f00b4-25ed-4c30-b619-1c3404ababee.png"><img src="https://user-images.githubusercontent.com/93451215/263436853-415f00b4-25ed-4c30-b619-1c3404ababee.png" alt="l2e_unik"/></a></p>
<p dir="auto">Just do the following to build:</p>
<div dir="auto" data-snippet-clipboard-copy-content="make run_unik_qemu_x86_64"><pre>make run_unik_qemu_x86_64</pre></div>
<p dir="auto">Please note that the requirements - unikraft and musl sources - will automatically get cloned before building.</p>
<p dir="auto">Once the build completes, (takes a while), run L2E like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-x86_64 -m 256m -accel kvm -kernel build/L2E_qemu-x86_64"><pre>qemu-system-x86_64 -m 256m -accel kvm -kernel build/L2E_qemu-x86_64</pre></div>
<p dir="auto">You can also run with -nographic option to directly interact in terminal.</p>
<div dir="auto" data-snippet-clipboard-copy-content="qemu-system-x86_64 -m 256m -accel kvm -kernel build/L2E_qemu-x86_64 -nographic"><pre>qemu-system-x86_64 -m 256m -accel kvm -kernel build/L2E_qemu-x86_64 -nographic</pre></div>
<p dir="auto">Download and try this and the cosmocc build in the latest release.</p>
<h2 tabindex="-1" id="user-content-portability-features" dir="auto"><a href="#portability-features">Portability Features<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>Single Executable that runs on any x86_64 OS (cosmocc builds)</li>
</ul>
<ul>
<li> GNU Linux</li>
<li> GNU/Systemd</li>
<li> *BSD (NetBSD, OpenBSD, FreeBSD)</li>
<li> XNU&#39;s Not UNIX (Mac)</li>
<li> Bare Metal Boot (BIOS &amp; EFI) (Not fully functional yet but almost...)</li>
<li> Windows</li>
<li> Runs on ARM64 via inbuilt BLINK emulation</li>
</ul>
<ul dir="auto">
<li>Standalone</li>
</ul>
<ul>
<li> Embedded model and tokenizer via ZipOS (cosmocc), INCBIN, strliteral</li>
</ul>
<ul dir="auto">
<li>Usability</li>
</ul>
<ul>
<li> Hacky CLI Chat - use any _incbin, _strlit or _zipos build.</li>
</ul>
<p dir="auto">Some combined features depend on a specific cosmocc toolchain: <a href="https://github.com/jart/cosmopolitan">https://github.com/jart/cosmopolitan</a></p>
<p dir="auto">Building this with gcc or clang would result in normal binaries similar to upstream.</p>
<p dir="auto">Read more:
<a href="https://github.com/trholding/llama2.c#portable-binary-build">How to build</a></p>
<h3 tabindex="-1" id="user-content-performance-features" dir="auto"><a href="#performance-features">Performance Features<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto"><strong>CPU</strong></p>
<ul>
<li> OpenBLAS</li>
<li> CBLAS</li>
<li> BLIS</li>
<li> Intel MKL (WIP)</li>
<li> ArmPL (WIP)</li>
<li> Apple Accelerate Framework (CBLAS) (WIP/Testing)</li>
</ul>
<p dir="auto"><strong>CPU/GPU</strong></p>
<ul>
<li> OpenMP</li>
<li> OpenACC</li>
</ul>
<p dir="auto">Both OpenMP and OpenACC builds currently use host CPU and do not offload to GPU.</p>
<p dir="auto"><strong>GPU</strong></p>
<ul>
<li> OpenCL (via CLBlast) (Direct - planned)</li>
<li> OpenGL</li>
<li> Vulkan</li>
<li> CUDA</li>
</ul>
<p dir="auto">Download the prebuilt run.com binary from releases</p>
<h2 tabindex="-1" id="user-content-llama2c" dir="auto"><a href="#llama2c">llama2.c<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://erikarow.land/trholding/llama2.c/blob/master/assets/llama_cute.jpg"><img src="https://erikarow.land/trholding/llama2.c/raw/master/assets/llama_cute.jpg" width="150" height="150" alt="Cute Llama"/></a>
</p>
<p dir="auto">A friendly fork of the excellent <a href="https://github.com/karpathy/llama2.c">llama2.c</a></p>
<p dir="auto">The original repository offers a full-stack solution for training and inferring the Llama 2 LLM architecture using PyTorch and a simple 500-line C file. The focus is on minimalism and simplicity, and the repo is a young project that is still being actively developed. The author recommends looking at the TinyStories paper for inspiration, as small LLMs can have strong performance in narrow domains. The C inference engine in run.c was the main focus of the project, and the Llama 2 architecture is hard-coded with no dependencies.</p>
<h2 tabindex="-1" id="user-content-feel-the-magic" dir="auto"><a href="#feel-the-magic">Feel the Magic<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/trholding/llama2.c.git
cd llama2.c
make runfast
wget https://huggingface.co/karpathy/tinyllamas/resolve/main/stories15M.bin
./run stories15M.bin"><pre>git clone https://github.com/trholding/llama2.c.git
<span>cd</span> llama2.c
make runfast
wget https://huggingface.co/karpathy/tinyllamas/resolve/main/stories15M.bin
./run stories15M.bin</pre></div>
<p dir="auto">You can also prompt the model with a prefix:</p>
<div dir="auto" data-snippet-clipboard-copy-content="./run stories42M.bin -t 0.8 -n 256 -i &#34;A big dog&#34;"><pre>./run stories42M.bin -t 0.8 -n 256 -i <span><span>&#34;</span>A big dog<span>&#34;</span></span></pre></div>
<p dir="auto">When prompting, the temperature and steps parameters are needed since we use simple positional arguments.</p>
<p dir="auto"><strong>Output</strong></p>
<blockquote>
<p dir="auto">A big dog named Zip. He loved to run and play in the sun. He was a happy dog. One day, Zip saw a little bird on the ground. The bird looked helpless. Zip wanted to help the bird. He ran to the bird and lay down next to it. Zip and the bird became friends. They played together every day. Zip would carry the bird to play in the trees. The bird would fly around, and Zip would bark. They were very happy together.</p>
</blockquote>
<h2 tabindex="-1" id="user-content-models" dir="auto"><a href="#models">Models<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The original author trained a series of small models on TinyStories, which took a few hours to train on their setup. The 110M model took around 24 hours. The models are hosted on huggingface hub:</p>
<table>
<thead>
<tr>
<th>model</th>
<th>dim</th>
<th>n_layers</th>
<th>n_heads</th>
<th>max context length</th>
<th>parameters</th>
<th>val loss</th>
<th>download</th>
</tr>
</thead>
<tbody>
<tr>
<td>OG</td>
<td>288</td>
<td>6</td>
<td>6</td>
<td>256</td>
<td>15M</td>
<td>1.072</td>
<td><a href="https://huggingface.co/karpathy/tinyllamas/resolve/main/stories15M.bin" rel="nofollow">stories15M.bin</a></td>
</tr>
<tr>
<td>42M</td>
<td>512</td>
<td>8</td>
<td>8</td>
<td>1024</td>
<td>42M</td>
<td>0.847</td>
<td><a href="https://huggingface.co/karpathy/tinyllamas/resolve/main/stories42M.bin" rel="nofollow">stories42M.bin</a></td>
</tr>
<tr>
<td>110M</td>
<td>768</td>
<td>12</td>
<td>12</td>
<td>1024</td>
<td>110M</td>
<td>0.760</td>
<td><a href="https://huggingface.co/karpathy/tinyllamas/resolve/main/stories110M.bin" rel="nofollow">stories110M.bin</a></td>
</tr>
</tbody>
</table>
<p dir="auto">The upstream project owner trained the llama2.c storyteller models on a 4X A100 40GB box provided by <a href="https://lambdalabs.com/service/gpu-cloud" rel="nofollow">Lambda labs</a>.</p>
<p dir="auto">Quick note on sampling, the recommendation for good results is to use <code>-t 1.0 -p 0.9</code>, i.e. top-p sampling at 0.9 with temperature 1.0 (this is the default). To control the diversity of samples use either the temperature (i.e. vary <code>-t</code> between 0 and 1 and keep top-p off with <code>-p 0</code>) or the top-p value (i.e. vary <code>-p</code> between 0 and 1 and keep <code>-t 1</code>), but not both. Nice explainers on LLM sampling strategies include <a href="https://peterchng.com/blog/2023/05/02/token-selection-strategies-top-k-top-p-and-temperature/" rel="nofollow">this</a>, <a href="https://docs.cohere.com/docs/controlling-generation-with-top-k-top-p" rel="nofollow">this</a> or <a href="https://huggingface.co/blog/how-to-generate" rel="nofollow">this</a>.</p>

<p dir="auto">A converted <strong>Meta&#39;s Llama 2 7b</strong> model can be inferenced at a slow speed.</p>
<h2 tabindex="-1" id="user-content-usage" dir="auto"><a href="#usage">Usage<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto"><strong>Full Usage</strong></p>
<div data-snippet-clipboard-copy-content="Usage:   run &lt;checkpoint&gt; [options]
Example: ./run model.bin -n 256 -i &#34;Once upon a time&#34;
Options:
  -t &lt;float&gt;  temperature in [0,inf], default 1.0
  -p &lt;float&gt;  p value in top-p (nucleus) sampling in [0,1] default 0.9
  -s &lt;int&gt;    random seed, default time(NULL)
  -n &lt;int&gt;    number of steps to run for, default 256. 0 = max_seq_len
  -b &lt;int&gt;    number of tokens to buffer, default 1. 0 = max_seq_len
  -x &lt;int&gt;    extended info / stats, default 1 = on. 0 = off
  -i &lt;string&gt; input prompt
  -z &lt;string&gt; optional path to custom tokenizer"><pre><code>Usage:   run &lt;checkpoint&gt; [options]
Example: ./run model.bin -n 256 -i &#34;Once upon a time&#34;
Options:
  -t &lt;float&gt;  temperature in [0,inf], default 1.0
  -p &lt;float&gt;  p value in top-p (nucleus) sampling in [0,1] default 0.9
  -s &lt;int&gt;    random seed, default time(NULL)
  -n &lt;int&gt;    number of steps to run for, default 256. 0 = max_seq_len
  -b &lt;int&gt;    number of tokens to buffer, default 1. 0 = max_seq_len
  -x &lt;int&gt;    extended info / stats, default 1 = on. 0 = off
  -i &lt;string&gt; input prompt
  -z &lt;string&gt; optional path to custom tokenizer
</code></pre></div>
<p dir="auto"><code>&lt;checkpoint&gt;</code> is the <strong>mandatory</strong> checkpoint / model file.</p>
<p dir="auto"><strong>Minimal Usage</strong></p>

<h2 tabindex="-1" id="user-content-platforms" dir="auto"><a href="#platforms">Platforms<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto"><strong>Multi OS build</strong></p>
<p dir="auto"><code>make run_cosmocc</code></p>
<p dir="auto">The binary will boot on baremetal and also run on any 64 Bit OS such as Linux, *BSD, Windows and slower on Aarch64 Mac &amp; Linux.</p>
<p dir="auto">Currently when used to boot, it won&#39;t be able to find the models. It&#39;s a toolchain feature with an anticipated PR merge.</p>
<p dir="auto">The performance of this build is more than twice of the basic build.</p>
<p dir="auto">The cosmopolitan toolchain is a requirement for this build to work. Read here: <a href="https://github.com/trholding/llama2.c#portable-binary-build">How to build</a></p>
<p dir="auto"><strong>Please note that the Multi OS binaries builds built with cosmocc cause a false positive with AV/Microsoft Defender and Virus Total</strong></p>
<p dir="auto">The issue is that AV&#39;s consider unsigned binaries or binaries that contain multiple OS binary signatures in one binary as suspicious.
Get more insight here: <a data-error-text="Failed to load title" data-id="1867950355" data-permission-text="Title is private" data-url="https://github.com/trholding/llama2.c/issues/8" data-hovercard-type="issue" data-hovercard-url="/trholding/llama2.c/issues/8/hovercard" href="https://github.com/trholding/llama2.c/issues/8">#8</a> and <a data-error-text="Failed to load title" data-id="1090678232" data-permission-text="Title is private" data-url="https://github.com/jart/cosmopolitan/issues/342" data-hovercard-type="issue" data-hovercard-url="/jart/cosmopolitan/issues/342/hovercard" href="https://github.com/jart/cosmopolitan/issues/342">jart/cosmopolitan#342</a></p>
<p dir="auto"><strong>Linux</strong></p>
<p dir="auto">Centos 7 / Amazon Linux 2018</p>
<p dir="auto"><code>make rungnu</code> or <code>make runompgnu</code> to use openmp.</p>
<p dir="auto"><strong>Other Linux Distros / Mac</strong></p>
<p dir="auto"><code>make runfast</code> or <code>make runomp</code> to use openmp.</p>
<p dir="auto"><strong>Windows</strong></p>
<p dir="auto">Build on windows:</p>
<p dir="auto"><code>build_msvc.bat</code> in a Visual Studio Command Prompt</p>
<p dir="auto">The MSVC build will use openmp and max threads suitable for your CPU unless you set <code>OMP_NUM_THREADS</code> env.</p>
<p dir="auto">Build on Linux and Windows:</p>
<p dir="auto"><code>make win64</code> to use the mingw compiler toolchain.</p>
<p dir="auto"><strong>Android</strong></p>
<p dir="auto">See this @lordunix&#39;s post on how to build this on Android within <a href="https://termux.dev/en/" rel="nofollow">termux</a>:</p>
<p dir="auto"><a data-error-text="Failed to load title" data-id="1867639275" data-permission-text="Title is private" data-url="https://github.com/trholding/llama2.c/issues/7" data-hovercard-type="issue" data-hovercard-url="/trholding/llama2.c/issues/7/hovercard" href="https://github.com/trholding/llama2.c/issues/7#issue-1867639275">#7 (comment)</a></p>
<p dir="auto">TODO.</p>
<h2 tabindex="-1" id="user-content-performance" dir="auto"><a href="#performance">Performance<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto"><strong>Basic</strong></p>
<p dir="auto">This build does not enable any optimizations.</p>

<p dir="auto">This can be used as baseline build against which performance of other builds can be compared.</p>
<p dir="auto"><strong>Fast</strong></p>
<p dir="auto">This build enables basic performance boost with compiler provided optimizations.</p>

<h3 tabindex="-1" id="user-content-build-wth-acceleration" dir="auto"><a href="#build-wth-acceleration">Build wth Acceleration<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto"><strong>OpenMP</strong></p>
<p dir="auto">This build enables acceleration via OpenMP</p>

<p dir="auto">Requires <a href="https://www.openmp.org/" rel="nofollow">OpenMP</a> libraries and compiler with OpenMP support to be available on system.
E.g. <code>apt install clang libomp-dev</code> on ubuntu</p>
<p dir="auto">When you run inference make sure to use OpenMP flags to set the number of threads, e.g.:</p>
<div dir="auto" data-snippet-clipboard-copy-content="OMP_NUM_THREADS=4 ./run out/model.bin"><pre>OMP_NUM_THREADS=4 ./run out/model.bin</pre></div>
<p dir="auto">More threads is not always better.</p>
<p dir="auto"><strong>OpenACC</strong></p>
<p dir="auto">This build enables acceleration via OpenACC</p>

<p dir="auto">Requires <a href="https://www.openacc.org/" rel="nofollow">OpenACC</a> libraries and compiler with OpenACC support to be available on system.</p>
<p dir="auto"><strong>OpenBLAS</strong></p>
<p dir="auto">This build enables acceleration via OpenBLAS</p>

<p dir="auto">Requires <a href="https://github.com/xianyi/OpenBLAS">OpenBLAS</a> to be installed on system.</p>
<p dir="auto"><strong>BLIS</strong></p>
<p dir="auto">This build enables acceleration via BLIS</p>

<p dir="auto">Requires <a href="https://github.com/flame/blis">BLIS</a> compiled with <code>./configure --enable-cblas -t openmp,pthreads auto</code> to be installed on system.</p>
<p dir="auto"><strong>Intel oneAPI MKL</strong></p>
<p dir="auto">This build enables acceleration via Intel® oneAPI Math Kernel Library on x86_64 systems and Intel Mac OS - WIP</p>

<p dir="auto">Requires <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/onemkl.html" rel="nofollow">Intel oneAPI MKL</a> to be installed on system.</p>
<p dir="auto"><strong>Arm Performance Library (ArmPL)</strong></p>
<p dir="auto">This build enables acceleration via Arm Performance Library on ARM64 systems such as Linux or Mac OS - WIP</p>

<p dir="auto">Requires <a href="https://developer.arm.com/Tools%20and%20Software/Arm%20Performance%20Libraries" rel="nofollow">ArmPL</a> to be installed on system.</p>
<p dir="auto"><strong>Apple Accelerate</strong></p>
<p dir="auto">This build enables BLAS acceleration via Apple Accelerate on Mac OS - Testing</p>

<p dir="auto">Requires <a href="https://developer.apple.com/accelerate/" rel="nofollow">Apple Accelerate</a> to be available on system.</p>
<p dir="auto">Note: Needs testing.</p>
<p dir="auto"><strong>Generic CBLAS</strong></p>
<p dir="auto">This build enables acceleration with any Netlib CBLAS interface compatible libraries</p>

<p dir="auto">Requires any BLAS library with Netlib CBLAS interface such as <a href="https://www.netlib.org/lapack" rel="nofollow">LAPACK</a> to be installed on system.</p>
<p dir="auto"><strong>CLBlast (GPU/OpenCL)</strong></p>
<p dir="auto">This build enables tuned GPU acceleration via OpenCL with CLBlast</p>

<p dir="auto">Requires <a href="https://github.com/CNugteren/CLBlast">CLBlast</a> compiled with <code>cmake -DNETLIB=ON</code> to be installed on system.</p>
<p dir="auto">Note: Currently runs much slower than CPU! Requires investigation or memory I/O is a bottle neck on the test system.</p>
<h2 tabindex="-1" id="user-content-portable-binary-build" dir="auto"><a href="#portable-binary-build">Portable Binary Build<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Have you ever wanted to inference a baby Llama 2 model with a single executable on any OS or *as OS? No? Well, now you can!</p>
<p dir="auto">By making use of the Cosmopolitan libc toolchain to build llama2.c we get the we can get those features.</p>
<p dir="auto">Instructions</p>
<p dir="auto">Get and build the comopolitan libc toolchain:</p>
<p dir="auto">Follow instructions at <a href="https://github.com/jart/cosmopolitan">https://github.com/jart/cosmopolitan</a></p>
<p dir="auto">Or do:</p>
<div data-snippet-clipboard-copy-content="sudo mkdir -p /opt
sudo chmod 1777 /opt
git clone https://github.com/jart/cosmopolitan /opt/cosmo
export PATH=&#34;/opt/cosmo/bin:/opt/cosmos/bin:$PATH&#34;
echo &#39;PATH=&#34;/opt/cosmo/bin:/opt/cosmos/bin:$PATH&#34;&#39; &gt;&gt;~/.profile
cosmocc --update   # pull cosmo and build/rebuild toolchain"><pre><code>sudo mkdir -p /opt
sudo chmod 1777 /opt
git clone https://github.com/jart/cosmopolitan /opt/cosmo
export PATH=&#34;/opt/cosmo/bin:/opt/cosmos/bin:$PATH&#34;
echo &#39;PATH=&#34;/opt/cosmo/bin:/opt/cosmos/bin:$PATH&#34;&#39; &gt;&gt;~/.profile
cosmocc --update   # pull cosmo and build/rebuild toolchain
</code></pre></div>
<p dir="auto">Example build to generate a Actually Portable Executable (APE) with embedded model:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir out
wget https://huggingface.co/karpathy/tinyllamas/resolve/main/stories15M.bin -O out/model.bin
make run_cosmocc_incbin"><pre>mkdir out
wget https://huggingface.co/karpathy/tinyllamas/resolve/main/stories15M.bin -O out/model.bin
make run_cosmocc_incbin</pre></div>
<p dir="auto">Example build to generate a APE:</p>

<p dir="auto">Run or copy to any supported system and run:</p>
<p dir="auto">If model is embedded:</p>

<p dir="auto">Else</p>

<h2 tabindex="-1" id="user-content-all-make-targets" dir="auto"><a href="#all-make-targets">All &#39;make&#39; targets<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Do make  to build for a particular target.</p>
<p dir="auto">Example:</p>

<p dir="auto">Usage &amp; Targets:</p>
<div data-snippet-clipboard-copy-content="Usage:
  make &lt;target&gt;

Simple Builds
  run_cc                        - Standard build with basic optimizations
  run_cc_fast                   - More Optimized build. Disregards strict standards compliance
  run_cc_gnu                    - Optimized Generic linux distro build

Accelerated Builds
  run_cc_openmp                 - OpenMP accelerated build
  run_cc_openacc                - OpenACC accelerated build
  run_cc_omp_gnu                - Generic linux distro + OpenMP build
  run_cc_clblast                - CLBlast OpenCL CBLAS GPU accelerated build
  run_cc_openblas               - Openblas CBLAS accelerated build
  run_cc_cblas                  - Generic CBLAS accelerated build
  run_cc_blis                   - BLIS accelerated build

Special Builds 

---&gt; x86_64
  run_cc_mkl                    - OpenMP + Intel MKL CBLAS build (x86_64 / intel Mac) (WIP)

---&gt; ARM64 / aarch64
  run_cc_armpl                  - ARM PL BLAS accelerated build (ARM64 &amp; Mac)  (WIP)

---&gt; Macintosh
  run_cc_mac_accel              - Mac OS OPENMP + CBLAS via Accelerate Framework build (WIP/TEST)

---&gt; Windows
  run_win                       - Optimized Windows build with MinGW-w64 toolchain
  run_win_msvc                  - OpenMP accelerated Windows build with MSVC toolchain (Untested)

---&gt; MultiOS Builds (using cosmopolitan libc + toolchain)
  run_cosmocc                   - Optimized Portable + cosmocc (runs on all OSes)

---&gt; MultiOS Builds ---&gt; with Embedded Models
  run_cosmocc_zipos             - Optimized Portable + cosmocc + embedded zip model build (runs on all OSes)
  run_cosmocc_incbin            - Optimized Portable + cosmocc + embedded model fast build (runs on all OSes)
  run_cosmocc_strlit            - Optimized Portable + cosmocc + embedded model build (runs on all OSes)

---&gt; GCC/Clang Embedded Model Builds
  run_gcc_openmp_incbin         - Gcc + OpenMP + embedded model fast build
  run_gcc_openmp_strlit         - Gcc + OpenMP + embedded model build
  run_clang_openmp_incbin       - Clang + OpenMP + embedded model fast build
  run_clang_openmp_strlit       - Clang + OpenMP + embedded model build

---&gt; GCC/Clang Embedded Model Builds ---&gt; Statically Linked
  run_gcc_static_incbin         - Optimized Static gcc + embedded model fast build
  run_gcc_static_strlit         - Optimized Static gcc + embedded model build
  run_clang_static_incbin       - Optimized Static clang + embedded model fast build
  run_clang_static_strlit       - Optimized Static clang + embedded model build

---&gt; Android
  run_incbin_tmux               - Optimized build + Embedded Model for Termux on Android

---&gt; L2E Unikernel (Asteroid)
  l2e_unik_qemu                 - L2E Unikernel (Asteroid) for kvm / qemu x86_64

---&gt; L2E Unikernel (Asteroid) ---&gt; Boot in qemu
  boot_l2e_unik                 - Boot L2E Unikernel (Asteroid) in qemu

---&gt; L2E OS (Humanoid)
  l2e_os                        - L2E OS, kernel module and userspace build

---&gt; L2E OS (Humanoid) ---&gt; Make Bootable ISO
  l2e_os_iso                    - Make Bootable L2E OS Hybrid UEFI/BIOS ISO Image

---&gt; L2E OS (Humanoid) ---&gt; Boot in qemu
  boot_l2e_os                   - Boot L2E OS (Humanoid) in qemu

---&gt; L2E OS (Humanoid) ---&gt; Boot ISO in qemu
  boot_l2e_iso                  - Boot L2E OS ISO Image in qemu

---&gt; L2E OS (Humanoid) ---&gt; Boot ISO with UEFI in qemu
  boot_l2e_iso_uefi             - Boot L2E OS ISO Image with UEFI in qemu

Debug Build
  run_debug                     - Debug build which can be analyzed with tools like valgrind.

Testing
  test                          - run all tests (inclusive python code, needs python)
  testc                         - run only tests for run.c C implementation (needs python)
  testcc                        - run the C tests, without touching pytest / python

Clean/ Purge
  tempclean                     - Find and delete all temporary files left by editors  
  clean                         - Simple cleaning 
  distclean                     - Deep cleaning (distclean sub projects)
  mintclean                     - Revert to mint condition (remove sub projects)

Misc
  get_model                     - Get stories15M model
  list                          - Display sorted list of all targets

Help
  help                          - Display this help. Make without target also displays this help.
"><pre><code>Usage:
  make &lt;target&gt;

Simple Builds
  run_cc                        - Standard build with basic optimizations
  run_cc_fast                   - More Optimized build. Disregards strict standards compliance
  run_cc_gnu                    - Optimized Generic linux distro build

Accelerated Builds
  run_cc_openmp                 - OpenMP accelerated build
  run_cc_openacc                - OpenACC accelerated build
  run_cc_omp_gnu                - Generic linux distro + OpenMP build
  run_cc_clblast                - CLBlast OpenCL CBLAS GPU accelerated build
  run_cc_openblas               - Openblas CBLAS accelerated build
  run_cc_cblas                  - Generic CBLAS accelerated build
  run_cc_blis                   - BLIS accelerated build

Special Builds 

---&gt; x86_64
  run_cc_mkl                    - OpenMP + Intel MKL CBLAS build (x86_64 / intel Mac) (WIP)

---&gt; ARM64 / aarch64
  run_cc_armpl                  - ARM PL BLAS accelerated build (ARM64 &amp; Mac)  (WIP)

---&gt; Macintosh
  run_cc_mac_accel              - Mac OS OPENMP + CBLAS via Accelerate Framework build (WIP/TEST)

---&gt; Windows
  run_win                       - Optimized Windows build with MinGW-w64 toolchain
  run_win_msvc                  - OpenMP accelerated Windows build with MSVC toolchain (Untested)

---&gt; MultiOS Builds (using cosmopolitan libc + toolchain)
  run_cosmocc                   - Optimized Portable + cosmocc (runs on all OSes)

---&gt; MultiOS Builds ---&gt; with Embedded Models
  run_cosmocc_zipos             - Optimized Portable + cosmocc + embedded zip model build (runs on all OSes)
  run_cosmocc_incbin            - Optimized Portable + cosmocc + embedded model fast build (runs on all OSes)
  run_cosmocc_strlit            - Optimized Portable + cosmocc + embedded model build (runs on all OSes)

---&gt; GCC/Clang Embedded Model Builds
  run_gcc_openmp_incbin         - Gcc + OpenMP + embedded model fast build
  run_gcc_openmp_strlit         - Gcc + OpenMP + embedded model build
  run_clang_openmp_incbin       - Clang + OpenMP + embedded model fast build
  run_clang_openmp_strlit       - Clang + OpenMP + embedded model build

---&gt; GCC/Clang Embedded Model Builds ---&gt; Statically Linked
  run_gcc_static_incbin         - Optimized Static gcc + embedded model fast build
  run_gcc_static_strlit         - Optimized Static gcc + embedded model build
  run_clang_static_incbin       - Optimized Static clang + embedded model fast build
  run_clang_static_strlit       - Optimized Static clang + embedded model build

---&gt; Android
  run_incbin_tmux               - Optimized build + Embedded Model for Termux on Android

---&gt; L2E Unikernel (Asteroid)
  l2e_unik_qemu                 - L2E Unikernel (Asteroid) for kvm / qemu x86_64

---&gt; L2E Unikernel (Asteroid) ---&gt; Boot in qemu
  boot_l2e_unik                 - Boot L2E Unikernel (Asteroid) in qemu

---&gt; L2E OS (Humanoid)
  l2e_os                        - L2E OS, kernel module and userspace build

---&gt; L2E OS (Humanoid) ---&gt; Make Bootable ISO
  l2e_os_iso                    - Make Bootable L2E OS Hybrid UEFI/BIOS ISO Image

---&gt; L2E OS (Humanoid) ---&gt; Boot in qemu
  boot_l2e_os                   - Boot L2E OS (Humanoid) in qemu

---&gt; L2E OS (Humanoid) ---&gt; Boot ISO in qemu
  boot_l2e_iso                  - Boot L2E OS ISO Image in qemu

---&gt; L2E OS (Humanoid) ---&gt; Boot ISO with UEFI in qemu
  boot_l2e_iso_uefi             - Boot L2E OS ISO Image with UEFI in qemu

Debug Build
  run_debug                     - Debug build which can be analyzed with tools like valgrind.

Testing
  test                          - run all tests (inclusive python code, needs python)
  testc                         - run only tests for run.c C implementation (needs python)
  testcc                        - run the C tests, without touching pytest / python

Clean/ Purge
  tempclean                     - Find and delete all temporary files left by editors  
  clean                         - Simple cleaning 
  distclean                     - Deep cleaning (distclean sub projects)
  mintclean                     - Revert to mint condition (remove sub projects)

Misc
  get_model                     - Get stories15M model
  list                          - Display sorted list of all targets

Help
  help                          - Display this help. Make without target also displays this help.

</code></pre></div>
<p dir="auto">All builds with embedded models need the model to be in <code>out/</code> directory and the model name has to be <code>model.bin</code></p>
<p dir="auto">Example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir out
wget https://huggingface.co/karpathy/tinyllamas/resolve/main/stories15M.bin -O out/model.bin"><pre>mkdir out
wget https://huggingface.co/karpathy/tinyllamas/resolve/main/stories15M.bin -O out/model.bin</pre></div>
<h2 tabindex="-1" id="user-content-todo" dir="auto"><a href="#todo">TODO<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul>
<li> Python Binding + Streamlit Demo (priority)</li>
<li> Web UI + Minimal OpenAI API compat (priority)</li>
<li> GNU/Linux kernel + efistub + cpio + l2e as init boot image (priority)</li>
<li> Users need better docs / howto / example, especially VM related.</li>
<li> Train a small test model on open books. (I need to figure out sourcing the compute)</li>
<li> Unikraft unikernel Boot (WIP/Testing) (Task: Multi Arch + Firecracker VM support)</li>
<li> Intel MKL BLAS Acceleration (WIP)</li>
<li> Arm Performance Libraries (WIP)</li>
<li> Apple Accelerate BLAS (WIP/Testing)</li>
<li> NetBSD Rump Kernel Boot (R&amp;D, attempt failed, needs deep study)</li>
<li> sgemm OpenGL acceleration (next)</li>
<li> sgemm SSE, AVX acceleration</li>
<li> Fix baremetal cosmo boot model loading (pending)</li>
<li> OpenMP SIMD (pending)</li>
<li> OpenCL pure</li>
<li> Vulkan</li>
<li> CUDA</li>
<li> MPI / PVM / PBLAS</li>
<li> cFS App</li>
<li> Android support (both ndk builds and minimal APK)</li>
<li> Various uC demos (ESP32, ESP8266, Pico) - load models via network, Raspi Zero Demo</li>
<li> Quantization (16, 4 , 2)</li>
<li> <del>CLara</del> (tried / broken) / SunCL Distributed OpenCL support</li>
<li> Fix broken MSVC build (!) yikes</li>
<li> Split, re-order, rebase repo.</li>
</ul>
<h2 tabindex="-1" id="user-content-changelog" dir="auto"><a href="#changelog">Changelog<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">See commits.</p>
<h2 tabindex="-1" id="user-content-contributing" dir="auto"><a href="#contributing">Contributing<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li>All pull requests that are merged to upstream will be automatically applied here as we closely mirror upstream.</li>
<li>I merge pull requests that improves performance even if they are rejected upstream.</li>
<li>Performance and usability improvement contriubutions are welcome.</li>
</ul>
<h2 tabindex="-1" id="user-content-developer-status" dir="auto"><a href="#developer-status">Developer Status<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">See &#34;Developer Status&#34; issue.</p>
<p dir="auto">Current status: Busy since Aug ~6 2023, away on bigger IRL projects. Just merging stuff. Addressing all issues every ~7 days.</p>

<p dir="auto">Thank you to to the creators of the following libraries and tools and their contributors:</p>
<ul dir="auto">
<li><a href="https://github.com/karpathy/llama2.c">llama2.c</a> - @karpathy</li>
<li><a href="https://github.com/jart/cosmopolitan">cosmopolitan</a> - @jart</li>
<li><a href="https://github.com/xianyi/OpenBLAS">OpenBlas</a> - @xianyi</li>
<li><a href="https://github.com/flame/blis">blis</a> - @flame</li>
<li><a href="https://github.com/CNugteren/CLBlast">CLBlast</a> - @CNugteren</li>
<li><a href="https://github.com/graphitemaster/incbin">incbin</a> - @graphitemaster</li>
<li><a href="https://github.com/mortie/strliteral">strliteral</a> - @mortie</li>
<li><a href="https://github.com/unikraft">unikraft</a> - @unikraft</li>
</ul>
<h2 tabindex="-1" id="user-content-notable-projects" dir="auto"><a href="#notable-projects">Notable projects<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<ul dir="auto">
<li><a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a></li>
<li><a href="https://github.com/karpathy/llama2.c">llama2.c</a></li>
</ul>
<h2 tabindex="-1" id="user-content-license" dir="auto"><a href="#license">License<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">MIT</p>
</article>
          </div></div>
  </body>
</html>
