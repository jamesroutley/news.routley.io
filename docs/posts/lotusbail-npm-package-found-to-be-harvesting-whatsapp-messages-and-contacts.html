<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.koi.ai/blog/npm-package-with-56k-downloads-malware-stealing-whatsapp-messages">Original</a>
    <h1>Lotusbail npm package found to be harvesting WhatsApp messages and contacts</h1>
    
    <div id="readability-page-1" class="page"><div><div><div id="blog-rich-text"><p>The <code>lotusbail</code> npm package presents itself as a WhatsApp Web API library - a fork of the legitimate <code>@whiskeysockets/baileys</code> package. With over 56,000 downloads and functional code that actually works as advertised, it&#39;s the kind of dependency developers install without a second thought. The package has been available on npm for 6 months and is still live at the time of writing.</p><p>Behind that working functionality: sophisticated malware that steals your WhatsApp credentials, intercepts every message, harvests your contacts, installs a persistent backdoor, and encrypts everything before sending it to the threat actor&#39;s server.</p><figure><p><img src="https://cdn.prod.website-files.com/689ad8c5d13f40cf59df0e0c/694807a93d3c8c57926db6ed_image%20(18)%20(1).png" loading="lazy" alt=""/></p><figcaption>Koidex report for lotusbail package</figcaption></figure><p>What gets captured:</p><ul role="list"><li>Authentication tokens and session keys</li><li>Complete message history (past and present)</li><li>Full contact lists with phone numbers</li><li>Media files and documents</li><li>Persistent backdoor access to your WhatsApp account</li></ul><h2>How It Works</h2><h3><strong>The Cover Is Real</strong></h3><p>Most malicious npm packages reveal themselves quickly - they&#39;re typosquats, they don&#39;t work, or they&#39;re obviously sketchy. This one actually functions as a WhatsApp API. It&#39;s based on the legitimate Baileys library and provides real, working functionality for sending and receiving WhatsApp messages.</p><p>Obvious malware is easy to spot. Functional malware? That gets installed, tested, approved, and deployed to production.</p><p>The social engineering here is brilliant: developers don&#39;t look for malware in code that works. They look for code that breaks.</p><h3><strong>The Theft and Exfiltration</strong></h3><p>The package wraps the legitimate WebSocket client that communicates with WhatsApp. Every message that flows through your application passes through the malware&#39;s socket wrapper first.</p><p>When you authenticate, the wrapper captures your credentials. When messages arrive, it intercepts them. When you send messages, it records them. The legitimate functionality continues working normally - the malware just adds a second recipient for everything.</p><figure><p><img src="https://cdn.prod.website-files.com/689ad8c5d13f40cf59df0e0c/6948073a4954450257af43cd_a29cc381.png" loading="lazy" alt=""/></p></figure><p>All your WhatsApp authentication tokens, every message sent or received, complete contact lists, media files - everything that passes through the API gets duplicated and prepared for exfiltration.</p><p>But the stolen data doesn&#39;t get sent in plain text. The malware includes a complete, custom RSA implementation for encrypting the data before transmission:</p><figure><p><img src="https://cdn.prod.website-files.com/689ad8c5d13f40cf59df0e0c/6948073a4954450257af43d0_d6657ad0.png" loading="lazy" alt=""/></p></figure><p>Why implement custom RSA? Because legitimate WhatsApp libraries don&#39;t need custom encryption - WhatsApp already handles end-to-end encryption. The custom crypto exists for one reason: to encrypt stolen data before exfiltration so network monitoring won&#39;t catch it.</p><p>The exfiltration server URL is buried in encrypted configuration strings, hidden inside compressed payloads. The malware uses four layers of obfuscation: Unicode variable manipulation, LZString compression, Base-91 encoding, and AES encryption. The server location isn&#39;t hardcoded anywhere visible.</p><h3><strong>The Backdoor</strong></h3><p>Here&#39;s where it gets particularly nasty. WhatsApp uses pairing codes to link new devices to accounts. You request a code, WhatsApp generates a random 8-character string, you enter it on your new device, and the devices link together.</p><p>The malware hijacks this process with a hardcoded pairing code. The code is encrypted with AES and hidden in the package:</p><figure><p><img src="https://cdn.prod.website-files.com/689ad8c5d13f40cf59df0e0c/6948073a4954450257af43d6_7375538c.png" loading="lazy" alt=""/></p></figure><p>This means the threat actor has a key to your WhatsApp account. When you use this library to authenticate, you&#39;re not just linking your application - you&#39;re also linking the threat actor&#39;s device. They have complete, persistent access to your WhatsApp account, and you have no idea they&#39;re there.</p><p>The threat actor can read all your messages, send messages as you, download your media, access your contacts - full account control. And here&#39;s the critical part, uninstalling the npm package removes the malicious code, but the threat actor&#39;s device stays linked to your WhatsApp account. The pairing persists in WhatsApp&#39;s systems until you manually unlink all devices from your WhatsApp settings. Even after the package is gone, they still have access.</p><h2>They Really Didn&#39;t Want You Looking</h2><p>The package includes 27 infinite loop traps that freeze execution if debugging tools are detected:</p><figure><p><img src="https://cdn.prod.website-files.com/689ad8c5d13f40cf59df0e0c/6948073a4954450257af43d3_354957b5.png" loading="lazy" alt=""/></p></figure><p>These traps check for debuggers, inspect process arguments, detect sandbox environments, and generally make dynamic analysis painful. They also left helpful comments in their code marking the malicious sections - professional development practices applied to supply chain attacks. Someone probably has a Jira board for this.</p><h2>Final Thoughts</h2><p>Supply chain attacks aren&#39;t slowing down - they&#39;re getting better. We&#39;re seeing working code with sophisticated anti-debugging, custom encryption, and multi-layer obfuscation that survives marketplace reviews. The <code>lotusbail</code> case isn&#39;t an outlier. It&#39;s a preview.</p><p>Traditional security doesn&#39;t catch this. Static analysis sees working WhatsApp code and approves it. Reputation systems see 56,000 downloads and trust it. The malware hides in the gap between &#34;this code works&#34; and &#34;this code only does what it claims.&#34;</p><p>Catching sophisticated supply chain attacks requires behavioral analysis - watching what packages actually do at runtime. When a WhatsApp library implements custom RSA encryption and includes 27 anti-debugging traps, those are signals. But you need systems watching for them.</p><p>This writeup was authored by the research team at Koi Security. We built Koi to detect threats that pass traditional checks but exhibit malicious behavior at runtime.</p><p><a href="https://www.koi.ai/get-a-demo"><strong>Book a demo</strong></a> to see how behavioral analysis catches what static review misses.</p><p>Stay safe out there.</p></div></div></div></div>
  </body>
</html>
