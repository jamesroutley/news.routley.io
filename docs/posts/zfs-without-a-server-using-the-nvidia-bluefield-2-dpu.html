<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.servethehome.com/zfs-without-a-server-using-the-nvidia-bluefield-2-dpu-nvme-arm-aic-iscsi/">Original</a>
    <h1>ZFS Without a Server Using the Nvidia BlueField-2 DPU</h1>
    
    <div id="readability-page-1" class="page"><div>
            <!-- image --><div><figure><a href="https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2.jpg" data-caption="AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 2"><img width="696" height="465" src="https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2-696x465.jpg" srcset="https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2-696x465.jpg 696w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2-400x267.jpg 400w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2-629x420.jpg 629w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2.jpg 800w" sizes="(max-width: 696px) 100vw, 696px" alt="AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 2" title="AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 2"/></a><figcaption>AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 2</figcaption></figure></div>
            <!-- content --><p>Today we are going to take a look at something a long time coming, specifically, we are going to run a ZFS sever entirely from a PCIe card, the NVIDIA BlueField-2 DPU. This piece has actually been split into two based on our recent <a href="https://www.servethehome.com/ethernet-ssds-hands-on-with-the-kioxia-em6-nvmeof-ssd/">Ethernet SSDs Hands-on with the Kioxia EM6 NVMeoF SSD</a> piece. In that piece, we looked at SSDs that did not require an x86 server. With this, we are going to show you another option for that that will hopefully start some discussion on the topic as we go through some of the basics of how this works. What we realized after the last piece is that it is a new enough concept where we could do a bit better of a job explaining how things are happening, and why. So we are splitting this into two. In this piece, we are going to use NVMe SSDs and ZFS to help folks understand exactly what is going on here and keep it as close to a NAS model as we possibly can before moving to a higher-level demo.<span id="more-60656"></span></p>
<h2>Video Version and Background</h2>
<p>Here is the video version where you can see the setup running, and likely some more screen capture here, and there is a voiceover.</p>
<p><iframe title="ZFS on this without a Server!?!" width="696" height="392" src="https://www.youtube.com/embed/NPQE0Rzh52c?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p>
<p>As always, we suggest opening this in a separate tab, browser, or app for a better viewing experience.</p>
<p>For some background:</p>
<ul>
<li><a href="https://www.servethehome.com/what-is-a-dpu-a-data-processing-unit-quick-primer/">What is a DPU?</a></li>
<li><a href="https://www.servethehome.com/dpu-vs-smartnic-sth-nic-continuum-framework-for-discussing-nic-types/">STH NIC Continuum</a></li>
<li><a href="https://www.servethehome.com/aws-nitro-the-big-cloud-dpu-deployment-detailed/">AWS Nitro</a></li>
<li><a href="https://www.servethehome.com/amd-acquires-pensando-for-its-dpu-future-intel-ipu-nvidia-bluefield-marvell-octeon-fungible/">AMD-Pensando DPU Deal</a></li>
</ul>
<p>These mostly have videos as well but they explain what a DPU is, and why it is different from traditional NICs. The AWS Nitro was really the first to implement this and we recently discussed the market in the AMD-Pensando video.</p>
<p>The short version, however, is that a DPU is a processor that combines a few key characteristics. Among them are:</p>
<ul>
<li>High-speed networking connectivity (usually multiple 100Gbps-200Gbps interfaces in this generation)</li>
<li>High-speed packet processing with specific acceleration and often programmable logic (P4/ P4-like is common)</li>
<li>A CPU core complex (often Arm or MIPS based in this generation)</li>
<li>Memory controllers (commonly DDR4 but we also see HBM and DDR5 support)</li>
<li>Accelerators (often for crypto or storage offload)</li>
<li>PCIe Gen4 lanes (run as either root or endpoints)</li>
<li>Security and management features (offering a hardware root of trust as an example)</li>
<li>Runs its own OS separate from a host system (commonly Linux, but the subject of <a href="https://www.servethehome.com/vmware-project-monterey-esxi-on-arm-on-dpu/">VMware Project Monterey ESXi on Arm</a> as another example)</li>
</ul>
<figure id="attachment_53420" aria-describedby="caption-attachment-53420"><a href="https://www.servethehome.com/dpu-vs-smartnic-sth-nic-continuum-framework-for-discussing-nic-types/sth-elements-of-a-dpu-q2-2021/" rel="attachment wp-att-53420"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021-800x448.jpg" alt="STH Elements Of A DPU Q2 2021" width="696" height="390" srcset="https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021-800x448.jpg 800w, https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021-400x224.jpg 400w, https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021-1536x861.jpg 1536w, https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021-696x390.jpg 696w, https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021-1068x598.jpg 1068w, https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021-750x420.jpg 750w, https://www.servethehome.com/wp-content/uploads/2021/05/STH-Elements-of-a-DPU-Q2-2021.jpg 1783w" sizes="(max-width: 696px) 100vw, 696px"/></a><figcaption id="caption-attachment-53420">STH Elements Of A DPU Q2 2021</figcaption></figure>
<p>Most of the coverage with DPUs has been DPUs in traditional x86 systems. The vision for DPUs goes well beyond that, and we will touch on that later. Still, it is correct to think of a DPU as a standalone processor that can connect to a host server or devices via PCIe and network fabric.</p>
<p>In this piece, we are going to show what happens when you do not use a host server, and run the DPU as a standalone mini-server by creating a ZFS-based solution with the card.</p>
<h2>NVIDIA BlueField-2 DPU and Hardware Needed</h2>
<p>For these are are using the NVIDIA BlueField-2 DPU. Here is the overview slide.</p>
<figure id="attachment_47442" aria-describedby="caption-attachment-47442"><a href="https://www.servethehome.com/nvidia-bluefield-2-and-bluefield-2x-dpu-offerings-launched/nvidia-bluefield-2-dpu-overview/" rel="attachment wp-att-47442"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2020/10/NVIDIA-BlueField-2-DPU-Overview-800x458.jpg" alt="NVIDIA BlueField 2 DPU Overview" width="696" height="398" srcset="https://www.servethehome.com/wp-content/uploads/2020/10/NVIDIA-BlueField-2-DPU-Overview-800x458.jpg 800w, https://www.servethehome.com/wp-content/uploads/2020/10/NVIDIA-BlueField-2-DPU-Overview-400x229.jpg 400w, https://www.servethehome.com/wp-content/uploads/2020/10/NVIDIA-BlueField-2-DPU-Overview-696x399.jpg 696w, https://www.servethehome.com/wp-content/uploads/2020/10/NVIDIA-BlueField-2-DPU-Overview-1068x612.jpg 1068w, https://www.servethehome.com/wp-content/uploads/2020/10/NVIDIA-BlueField-2-DPU-Overview-733x420.jpg 733w, https://www.servethehome.com/wp-content/uploads/2020/10/NVIDIA-BlueField-2-DPU-Overview.jpg 1301w" sizes="(max-width: 696px) 100vw, 696px"/></a><figcaption id="caption-attachment-47442">NVIDIA BlueField 2 DPU Overview</figcaption></figure>
<p>These are interesting because they are basically a ConnectX-6 NIC, a PCIe switch, and an Arm processor complex on the card.</p>
<figure id="attachment_60657" aria-describedby="caption-attachment-60657"><a href="https://www.servethehome.com/?attachment_id=60657" rel="attachment wp-att-60657"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-800x553.jpg" alt="NVIDIA BlueField 2 DPU Block Diagram" width="696" height="481" srcset="https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-800x553.jpg 800w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-400x276.jpg 400w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-218x150.jpg 218w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-696x481.jpg 696w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-1068x738.jpg 1068w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-608x420.jpg 608w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram-100x70.jpg 100w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-Block-Diagram.jpg 1290w" sizes="(max-width: 696px) 100vw, 696px"/></a><figcaption id="caption-attachment-60657">NVIDIA BlueField 2 DPU Block Diagram</figcaption></figure>
<p>The Arm CPU complex has 16GB of single-channel DDR4 memory. NVIDIA has 32GB versions, but we have not been able to get one. We can see the ConnnectX-6 NICs on the PCIe bus here. There is also eMMC storage that is running our Ubuntu 20.04 LTS OS.</p>
<figure id="attachment_60687" aria-describedby="caption-attachment-60687"><a href="https://www.servethehome.com/?attachment_id=60687" rel="attachment wp-att-60687"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lstopo-800x369.jpg" alt="NVIDIA BlueField 2 DPU Lstopo" width="696" height="321" srcset="https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lstopo-800x369.jpg 800w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lstopo-400x185.jpg 400w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lstopo-696x321.jpg 696w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lstopo.jpg 864w" sizes="(max-width: 696px) 100vw, 696px"/></a><figcaption id="caption-attachment-60687">NVIDIA BlueField 2 DPU Lstopo</figcaption></figure>
<p>There are eight Arm Cortex-A72 cores with 1MB of L2 cache shared between two cores and a 6MB L3 cache.</p>
<figure id="attachment_60688" aria-describedby="caption-attachment-60688"><a href="https://www.servethehome.com/?attachment_id=60688" rel="attachment wp-att-60688"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lscpu-output.jpg" alt="NVIDIA BlueField 2 DPU Lscpu Output" width="669" height="450" srcset="https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lscpu-output.jpg 669w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lscpu-output-400x269.jpg 400w, https://www.servethehome.com/wp-content/uploads/2022/04/NVIDIA-BlueField-2-DPU-lscpu-output-624x420.jpg 624w" sizes="(max-width: 669px) 100vw, 669px"/></a><figcaption id="caption-attachment-60688">NVIDIA BlueField 2 DPU Lscpu Output</figcaption></figure>
<p>Here is one of the BF2M516A cards that we have with dual 100GbE ports. We will note that these are the E-cores not the P or performance parts.</p>
<figure id="attachment_53364" aria-describedby="caption-attachment-53364"><a href="https://www.servethehome.com/a-quick-look-at-logging-into-a-mellanox-nvidia-bluefield-2-dpu/bf2-100gbe/" rel="attachment wp-att-53364"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-800x567.jpg" alt="NVIDIA BlueField-2 DPU 2x 100GbE" width="696" height="493" srcset="https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-800x567.jpg 800w, https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-400x284.jpg 400w, https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-1536x1089.jpg 1536w, https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-696x493.jpg 696w, https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-1068x757.jpg 1068w, https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-593x420.jpg 593w, https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE-100x70.jpg 100w, https://www.servethehome.com/wp-content/uploads/2021/05/BF2-100GbE.jpg 2043w" sizes="(max-width: 696px) 100vw, 696px"/></a><figcaption id="caption-attachment-53364">NVIDIA BlueField-2 DPU 2x 100GbE</figcaption></figure>
<p>In the <a href="https://www.servethehome.com/building-the-ultimate-x86-and-arm-cluster-in-a-box/">Building the Ultimate x86 and Arm Cluster-in-a-Box</a> piece, we showed that each of these DPUs are individual nodes running their own OS leading to a really interesting little cluster.</p>
<p><iframe loading="lazy" title="Ultimate Cluster in a Box w/ x86 and Arm" width="696" height="392" src="https://www.youtube.com/embed/3ZBEgNB1-mk?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p>
<p>We are exploiting that property by utilizing the cards in the <a href="https://www.servethehome.com/aic-jbox-review-j5010-02-limitless-potential-pcie-gen4-box/">AIC JBOX that we recently reviewed</a>.</p>
<figure id="attachment_60091" aria-describedby="caption-attachment-60091"><a href="https://www.servethehome.com/aic-jbox-review-j5010-02-limitless-potential-pcie-gen4-box/aic-jbox-j5010-02-nvidia-bluefield-2-dpu-with-three-ssds-2/" rel="attachment wp-att-60091"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2.jpg" alt="AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 2" width="800" height="534" srcset="https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2.jpg 800w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2-400x267.jpg 400w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2-696x465.jpg 696w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-2-629x420.jpg 629w" sizes="(max-width: 800px) 100vw, 800px"/></a><figcaption id="caption-attachment-60091">AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 2</figcaption></figure>
<p>The AIC JBOX is a PCIe Gen4 chassis that has two Broadcom PCIe switches and is solely meant to connect PCIe devices, power them, and cool them. There is no x86 processor in the system, so we can use the BlueField-2 DPU as a PCIe root and then use NVMe SSDs in the chassis to connect to the BlueField-2 DPU.</p>
<figure id="attachment_60090" aria-describedby="caption-attachment-60090"><a href="https://www.servethehome.com/aic-jbox-review-j5010-02-limitless-potential-pcie-gen4-box/aic-jbox-j5010-02-nvidia-bluefield-2-dpu-with-three-ssds-1/" rel="attachment wp-att-60090"><img loading="lazy" src="https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-1.jpg" alt="AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 1" width="800" height="491" srcset="https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-1.jpg 800w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-1-400x246.jpg 400w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-1-696x427.jpg 696w, https://www.servethehome.com/wp-content/uploads/2022/03/AIC-JBOX-J5010-02-NVIDIA-BlueField-2-DPU-with-three-SSDs-1-684x420.jpg 684w" sizes="(max-width: 800px) 100vw, 800px"/></a><figcaption id="caption-attachment-60090">AIC JBOX J5010 02 NVIDIA BlueField 2 DPU With Three SSDs 1</figcaption></figure>
<p>With the hardware platform set, we are able to start setting up the system with ZFS.</p>
        </div></div>
  </body>
</html>
