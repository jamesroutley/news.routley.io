<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/CARootStoreTrustProblem">Original</a>
    <h1>Linux Certificate Authority root stores have a too simple view of &#39;trust&#39;</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Linux Certificate Authority root stores have a too simple view of &#39;trust&#39;</h2>

	<p><small>December  1, 2022</small></p>
</div><div><p>Let&#39;s start with the background. Pretty much every Linux system
(really, every Unix system) has a &#39;system CA root store&#39;, by which
we mean &#39;the list of all CA root certificates that are trusted by
default by most TLS-using software&#39;. For various sensible reasons,
many Linux distributions reuse Mozilla&#39;s CA root store for their
system root store, possibly with some tweaks.</p>

<p>The recent TLS news is that Mozilla (and Microsoft) are distrusting
the TrustCor CA certificates (<a href="https://utcc.utoronto.ca/~cks/space/blog/web/QuestionableCAsAndCertTrans">see this entry for more on TrustCor</a>). Over on the Fediverse,
<a href="https://mastodon.social/@filippo/109435714124958498">Filippo Valsorda reported the news and said</a>:</p>

<blockquote><p>Mozilla is distrusting TrustCor.</p>

<p>Certificates issued from December 1st onward won&#39;t be trusted, roots
will be removed once current certificates expire.</p>

<p>Note that this probably means systems like Linux distros that just
consider the Mozilla root store a bag of certificates will fully trust
TrustCor for at least another year, likely longer due to release lag.</p>

<p><a href="https://groups.google.com/a/mozilla.org/d/msgid/dev-security-policy/62669320-d923-4339-b557-9e2bfe0f9f52n%40mozilla.org">&lt;mozilla mailing list link&gt;</a></p>
</blockquote>

<p>You might reasonably be confused about why Linux systems would trust
TrustCor certificates for so long. The lesser reason is delays in
updating their packaged copies of the Mozilla root store (and then
getting you to apply the updates). But the major reason is that on
Unix, the traditional &#39;CA root store&#39; model is too limited.</p>

<p>Mozilla is not removing TrustCor&#39;s root certificates from their root
store, not yet. Instead, in their root store there will be &#39;Distrust
for &lt;X&gt; After Date&#39; markers for these certificates, dated December
1st. Certificates signed by TrustCor that were issued before December
1st will still be trusted (for now); certificates issued on December 1st
or later will not be. This is fine and reasonable for Mozilla and for
browser vendors (Microsoft has already done something similar, although
their trust cutoff date was November 1st).</p>

<p>The problem for Linux distros is that most code that uses a &#39;CA root
store&#39; doesn&#39;t support this sort of nuanced trust decision. Instead,
it expects a &#39;root store&#39; that contains a bunch of fully trusted CA
certificates. If a certificate chains up to a TLS certificate in the
root store, it&#39;s trusted; if a certificate doesn&#39;t, it&#39;s not trusted.
To use Valsorda&#39;s words, this is the &#39;bag of certificates&#39; model. As
long as the TrustCor root certificates are in the root store bag, all of
TrustCor&#39;s TLS certificates are trusted, regardless of when they were
issued; if TrustCor&#39;s root certificates aren&#39;t in the bag, none of those
certificates will be trusted. There&#39;s no support for trusting only some
of those certificates, or indicating this to programs.</p>

<p>(Some Linux distributions may choose to drop TrustCor entirely from
their CA bundle, which is a reasonable decision. But they&#39;d have
to know about this issue and make a decision; if they just extract
all of the CA root certificates in Mozilla&#39;s store that are &#39;trusted&#39;
to at least some degree, they will get the TrustCor certificates
too.)</p>

<p>In theory, Linux distributions could collect this sort of additional
trust information from the Mozilla root store and include it in
their packages of root certificates (in both Ubuntu and Fedora,
this package is called &#39;ca-certificates&#39; and already contains a
variety of things other than just the certificates). In practice,
there&#39;s no standard for the format of this additional information
and no code that would consume it and do the right thing. Perhaps
as a result, I don&#39;t think anyone actually tries to capture this
additional information anywhere in their CA certificates package.</p>

<p>(Arguably this is a real flaw in modern TLS packages and libraries.
Browsers have been selectively distrusting CAs for years now, but
I think most TLS packages still have no support for this sort of
thing, not even loading distrust information into them by hand.)</p>

<p>(This elaborates on <a href="https://mastodon.social/@cks/109436039243339332">something I said on the Fediverse</a>.)</p>

<p>PS: As mentioned, Mozilla will remove the TrustCor roots once
they can&#39;t verify anything, ie once all TrustCor certificates
issued before December 1st have expired. That will probably take
about a year, assuming TrustCor doesn&#39;t do something before then.
Once the TrustCor certificates aren&#39;t in the Mozilla root store
at all, this will propagate to Linux distros.</p>
</div></div>
  </body>
</html>
