<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zck.org/define-keymap">Original</a>
    <h1>Don&#39;t make Emacs keymaps -- define them.</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>You know how I&#39;ve encouraged <a href="https://zck.org/reduce-your-emacs-config">contributing code upstream</a>? Let it not be said I don&#39;t take my own advice.</p>

    <p>This all started when I was looking at some <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Keymap-Basics.html">Emacs keymaps</a>. I realized that making keymaps is verbose, with a lot of boilerplate. The code looks something like:</p>

    <p><code>
        <pre>(let ((map (make-sparse-keymap)))
  (define-key map (kbd &#34;a&#34;) #&#39;function-a-here)
  (define-key map (kbd &#34;M-a&#34;) #&#39;function-a-here)
  (define-key map (kbd &#34;b&#34;) #&#39;my-function-b)
  (define-key map (kbd &#34;C-c C&#34;) #&#39;function-c-here)
  (define-key map (kbd &#34;d&#34;) #&#39;function-d-here)
  map)</pre></code></p><p>I thought I could make something better â€“ where you could not have this boilerplate. A function that created and returned a keymap that&#39;s filled with your values and doesn&#39;t need to be locally bound. A keymap-creation function that knows what you want, where you don&#39;t have to wrap all the keys in <code>kbd</code> calls.</p>

    <p>So I programmed and tested, and the new code was ready. While writing a proposal to the emacs mailing list, I looked up examples of <code>make-keymap</code> already in Emacs.</p>

    <p>Then I found <code>define-keymap</code>.</p>

    <p>It does everything I wanted. Everything I made, this function does. Even better, it&#39;s a single function instead of two. I had made one function for sparse keymaps and a second function for normal keymaps.</p>

    <p>Why didn&#39;t I find this earlier? Well, <code>define-keymap</code> is not documented in the <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Creating-Keymaps.html">creating keymaps</a> documentation. For that matter, it&#39;s nowhere in <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Index.html#Index_fn_letter-D">the documentation</a>.</p>

    <p>It&#39;s not even in Emacs!</p>

    <p>Well, it is. It&#39;s just not in a <em>released</em> Emacs. It will come out as part of Emacs 29, but earlier Emacs versions can get <code>define-keymap</code> from the <a href="https://github.com/emacs-compat/compat">compat</a> package. Right now, the best place to look at its documentation is <a href="https://git.savannah.gnu.org/cgit/emacs.git/tree/lisp/keymap.el#n478">in the git repository</a>.</p>

    <p>It&#39;s a very nice function. The sparse keymap above can instead be:</p>

    <p><code>
        <pre>(define-keymap
  &#34;a&#34; #&#39;function-a-here
  &#34;M-a&#34; #&#39;function-a-here
  &#34;b&#34; #&#39;my-function-b
  &#34;C-c C&#34; #&#39;function-c-here
  &#34;d&#34; #&#39;function-d-here)</pre></code></p><p>This is far simpler and more readable. There are many options it can take, which I won&#39;t go over here.</p>

    <p>So I don&#39;t think there&#39;s a reason to use <code>make-keymap</code> anymore. <code>define-keymap</code> is better.</p>
</div></div>
  </body>
</html>
