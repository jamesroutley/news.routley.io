<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/pretzelai/stripe-no-webhooks">Original</a>
    <h1>Show HN: Stripe-no-webhooks – Sync your Stripe data to your Postgres DB</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">

<p dir="auto">This is an opinionated library to help you implement payments with Stripe.</p>
<ol dir="auto">
<li>Define plans in code which sync to your Stripe account</li>
<li>No manual webhook setup - the library handles webhooks and syncs Stripe data to your DB</li>
<li>Simple APIs for subscriptions, credits, wallet balances, top-ups, and usage-based billing</li>
<li>Support for seat based billing, tax collection, plan upgrades and downgrades (including sane handling of credits)</li>
<li>Optional callbacks (<code>onSubscriptionCreated</code>, etc.) for custom logic</li>
</ol>

<p dir="auto">This guide assumes you have a Next.js app and a PostgreSQL database. We recommend starting with a <code>test mode</code> Stripe API key so you can test your setup locally in your dev environment. Then, the guide will walk you through how to set up your app for production.</p>

<div dir="auto" data-snippet-clipboard-copy-content="npm install stripe-no-webhooks stripe
npx stripe-no-webhooks init"><pre>npm install stripe-no-webhooks stripe
npx stripe-no-webhooks init</pre></div>
<p dir="auto">You&#39;ll be prompted for:</p>
<ul dir="auto">
<li><strong>Stripe test key</strong> (for eg, <code>sk_test_...</code>) - get it from <a href="https://dashboard.stripe.com/apikeys" rel="nofollow">Stripe dashboard</a></li>
<li><strong>Database URL</strong> – PostgreSQL connection string (for example: <code>postgresql://postgres:password@localhost:5432/app_db</code>)</li>
<li><strong>Site URL</strong> - For eg, <code>http://localhost:3000</code> for local dev</li>
</ul>
<p dir="auto">This will update your <code>.env</code> file with your credentials and create the following files:</p>
<ul dir="auto">
<li><code>billing.config.ts</code>: Your config file with your plans</li>
<li><code>lib/billing.ts</code>: Your core billing client instance</li>
<li><code>app/api/stripe/[...all]/route.ts</code>: Your webhook handler and API routes</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="npx stripe-no-webhooks migrate"><pre>npx stripe-no-webhooks migrate</pre></div>
<p dir="auto">This will create the <code>stripe</code> schema in your database with the necessary tables for syncing Stripe data and tracking credits + usage.</p>

<p dir="auto">Edit <code>billing.config.ts</code> to define your plans for the test environment. Here&#39;s an example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const billingConfig: BillingConfig = {
  test: {
    plans: [
      {
        name: &#34;Free&#34;,
        price: [{ amount: 0, currency: &#34;usd&#34;, interval: &#34;month&#34; }],
      },
      {
        name: &#34;Pro&#34;,
        price: [
          { amount: 2000, currency: &#34;usd&#34;, interval: &#34;month&#34; }, // $20/mo
          { amount: 20000, currency: &#34;usd&#34;, interval: &#34;year&#34; }, // $200/yr
        ],
      },
    ],
  },
  production: {
    plans: [], // Add when going live
  },
};"><pre><span>const</span> <span>billingConfig</span>: <span>BillingConfig</span> <span>=</span> <span>{</span>
  <span>test</span>: <span>{</span>
    <span>plans</span>: <span>[</span>
      <span>{</span>
        <span>name</span>: <span>&#34;Free&#34;</span><span>,</span>
        <span>price</span>: <span>[</span><span>{</span> <span>amount</span>: <span>0</span><span>,</span> <span>currency</span>: <span>&#34;usd&#34;</span><span>,</span> <span>interval</span>: <span>&#34;month&#34;</span> <span>}</span><span>]</span><span>,</span>
      <span>}</span><span>,</span>
      <span>{</span>
        <span>name</span>: <span>&#34;Pro&#34;</span><span>,</span>
        <span>price</span>: <span>[</span>
          <span>{</span> <span>amount</span>: <span>2000</span><span>,</span> <span>currency</span>: <span>&#34;usd&#34;</span><span>,</span> <span>interval</span>: <span>&#34;month&#34;</span> <span>}</span><span>,</span> <span>// $20/mo</span>
          <span>{</span> <span>amount</span>: <span>20000</span><span>,</span> <span>currency</span>: <span>&#34;usd&#34;</span><span>,</span> <span>interval</span>: <span>&#34;year&#34;</span> <span>}</span><span>,</span> <span>// $200/yr</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>]</span><span>,</span>
  <span>}</span><span>,</span>
  <span>production</span>: <span>{</span>
    <span>plans</span>: <span>[</span><span>]</span><span>,</span> <span>// Add when going live</span>
  <span>}</span><span>,</span>
<span>}</span><span>;</span></pre></div>
<p dir="auto">Plans can also include credits, wallet, and usage-based billing:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{
  name: &#34;Pro&#34;,
  price: [{ amount: 2000, currency: &#34;usd&#34;, interval: &#34;month&#34; }],
  features: {
    api_calls: {
      credits: { allocation: 1000 },   // 1000 included/month
      pricePerCredit: 1,               // $0.01 per extra call (used for top-ups and usage billing)
      trackUsage: true,                // enable usage-based billing for overages
    },
  },
  wallet: {
    allocation: 500,                   // $5.00 prepaid balance
  },
}"><pre><span>{</span>
  <span>name</span>: <span>&#34;Pro&#34;</span><span>,</span>
  <span>price</span>: <span>[</span><span>{</span> <span>amount</span>: <span>2000</span><span>,</span> <span>currency</span>: <span>&#34;usd&#34;</span><span>,</span> <span>interval</span>: <span>&#34;month&#34;</span> <span>}</span><span>]</span><span>,</span>
  <span>features</span>: <span>{</span>
    <span>api_calls</span>: <span>{</span>
      <span>credits</span>: <span>{</span> <span>allocation</span>: <span>1000</span> <span>}</span><span>,</span>   <span>// 1000 included/month</span>
      <span>pricePerCredit</span>: <span>1</span><span>,</span>               <span>// $0.01 per extra call (used for top-ups and usage billing)</span>
      <span>trackUsage</span>: <span>true</span><span>,</span>                <span>// enable usage-based billing for overages</span>
    <span>}</span><span>,</span>
  <span>}</span><span>,</span>
  <span>wallet</span>: <span>{</span>
    <span>allocation</span>: <span>500</span><span>,</span>                   <span>// $5.00 prepaid balance</span>
  <span>}</span><span>,</span>
<span>}</span></pre></div>
<p dir="auto">See <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/credits.md">Credits</a>, <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/credits.md#wallet">Wallet</a>, and <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/usage.md">Usage Billing</a> docs for details.</p>

<div dir="auto" data-snippet-clipboard-copy-content="npx stripe-no-webhooks sync"><pre>npx stripe-no-webhooks sync</pre></div>
<p dir="auto">Creates products/prices in Stripe and updates your config with their IDs.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">5. Update your billing client</h3><a id="user-content-5-update-your-billing-client" aria-label="Permalink: 5. Update your billing client" href="#5-update-your-billing-client"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Update <code>lib/billing.ts</code> to specify how to get the <code>userId</code> in the <code>resolveUser</code> function. For example, with Clerk:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { Billing } from &#34;stripe-no-webhooks&#34;;
import { auth } from &#34;@clerk/nextjs/server&#34;; // or your auth
import billingConfig from &#34;../billing.config&#34;;

export const billing = new Billing({
  billingConfig,
  successUrl: process.env.NEXT_PUBLIC_APP_URL || &#34;http://localhost:3000&#34;,
  cancelUrl: process.env.NEXT_PUBLIC_APP_URL || &#34;http://localhost:3000&#34;,
  resolveUser: async () =&gt; {
    const { userId } = await auth();
    return userId ? { id: userId } : null;
  },
});"><pre><span>import</span> <span>{</span> <span>Billing</span> <span>}</span> <span>from</span> <span>&#34;stripe-no-webhooks&#34;</span><span>;</span>
<span>import</span> <span>{</span> <span>auth</span> <span>}</span> <span>from</span> <span>&#34;@clerk/nextjs/server&#34;</span><span>;</span> <span>// or your auth</span>
<span>import</span> <span>billingConfig</span> <span>from</span> <span>&#34;../billing.config&#34;</span><span>;</span>

<span>export</span> <span>const</span> <span>billing</span> <span>=</span> <span>new</span> <span>Billing</span><span>(</span><span>{</span>
  billingConfig<span>,</span>
  <span>successUrl</span>: <span>process</span><span>.</span><span>env</span><span>.</span><span>NEXT_PUBLIC_APP_URL</span> <span>||</span> <span>&#34;http://localhost:3000&#34;</span><span>,</span>
  <span>cancelUrl</span>: <span>process</span><span>.</span><span>env</span><span>.</span><span>NEXT_PUBLIC_APP_URL</span> <span>||</span> <span>&#34;http://localhost:3000&#34;</span><span>,</span>
  <span>resolveUser</span>: <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>{</span> userId <span>}</span> <span>=</span> <span>await</span> <span>auth</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> <span>userId</span> ? <span>{</span> <span>id</span>: <span>userId</span> <span>}</span> : <span>null</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></pre></div>

<p dir="auto">Start your Next.js app, then in another terminal, forward Stripe webhooks:</p>
<div dir="auto" data-snippet-clipboard-copy-content="stripe listen --forward-to localhost:3000/api/stripe/webhook"><pre>stripe listen --forward-to localhost:3000/api/stripe/webhook</pre></div>
<p dir="auto">Your setup is complete! Now let&#39;s use it.</p>
<hr/>


<p dir="auto"><code>stripe-no-webhooks</code> lets you <a href="#generate-a-pricing-page">generate a full pricing page</a> with plan selection, monthly/yearly toggle, and checkout flow built-in. Or you can call <code>checkout()</code> directly:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { checkout } from &#34;stripe-no-webhooks/client&#34;;

&lt;button onClick={() =&gt; checkout({ planName: &#34;Pro&#34;, interval: &#34;month&#34; })}&gt;
  Upgrade to Pro
&lt;/button&gt;;"><pre><span>import</span> <span>{</span> <span>checkout</span> <span>}</span> <span>from</span> <span>&#34;stripe-no-webhooks/client&#34;</span><span>;</span>

<span>&lt;</span><span>button</span> <span>onClick</span><span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>checkout</span><span>(</span><span>{</span> <span>planName</span>: <span>&#34;Pro&#34;</span><span>,</span> <span>interval</span>: <span>&#34;month&#34;</span> <span>}</span><span></span><span>)</span><span>}</span><span>&gt;</span>
  <span>Upgrade</span> <span>to</span> <span>Pro</span>
<span>&lt;</span><span>/</span><span>b</span><span>u</span><span>t</span><span>t</span><span>o</span><span>n</span><span>&gt;</span><span>;</span></pre></div>
<p dir="auto">Test card: <code>4242 4242 4242 4242</code>, any future MM/YY expiry, any CVC.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Check subscription status</h3><a id="user-content-check-subscription-status" aria-label="Permalink: Check subscription status" href="#check-subscription-status"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="import { billing } from &#34;@/lib/billing&#34;;

const subscription = await billing.subscriptions.get({ userId });

if (subscription?.status === &#34;active&#34;) {
  console.log(&#34;Plan:&#34;, subscription.plan?.name);
}"><pre><span>import</span> <span>{</span> <span>billing</span> <span>}</span> <span>from</span> <span>&#34;@/lib/billing&#34;</span><span>;</span>

<span>const</span> <span>subscription</span> <span>=</span> <span>await</span> <span>billing</span><span>.</span><span>subscriptions</span><span>.</span><span>get</span><span>(</span><span>{</span> userId <span>}</span><span>)</span><span>;</span>

<span>if</span> <span>(</span><span>subscription</span><span>?.</span><span>status</span> <span>===</span> <span>&#34;active&#34;</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Plan:&#34;</span><span>,</span> <span>subscription</span><span>.</span><span>plan</span><span>?.</span><span>name</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<div dir="auto"><h4 tabindex="-1" dir="auto">What happens behind the scenes</h4><a id="user-content-what-happens-behind-the-scenes" aria-label="Permalink: What happens behind the scenes" href="#what-happens-behind-the-scenes"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">When a user completes checkout:</p>
<ol dir="auto">
<li>Stripe sends a webhook to your app</li>
<li>The library receives it and syncs the data to your database. If credits / wallet are enabled, it will also update the credits / wallet balances</li>
<li><code>billing.subscriptions.get({ userId })</code> now returns the subscription based on the Stripe data that&#39;s synced to your database</li>
<li>Credits / wallet are tracked automatically through a credit balance and a ledger of transactions via the library&#39;s internal APIs. These APIs are all idempotent and you don&#39;t have to worry about double counting or missing transactions</li>
</ol>
<p dir="auto">You can verify this by checking your database&#39;s stripe.subscriptions and <code>stripe.credit_balances</code> and <code>stripe.credit_ledger</code>.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Use credits, wallet, or usage billing</h3><a id="user-content-use-credits-wallet-or-usage-billing" aria-label="Permalink: Use credits, wallet, or usage billing" href="#use-credits-wallet-or-usage-billing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="// Credits: consume included units
if (await billing.credits.hasCredits({ userId, key: &#34;api_calls&#34;, amount: 1 })) {
  await billing.credits.consume({ userId, key: &#34;api_calls&#34;, amount: 1 });
}

// Wallet: deduct from prepaid balance (in cents)
await billing.wallet.consume({
  userId,
  amount: 50,
  description: &#34;AI generation&#34;,
});

// Usage: record for end-of-period billing
await billing.usage.record({ userId, key: &#34;api_calls&#34;, amount: 1 });"><pre><span>// Credits: consume included units</span>
<span>if</span> <span>(</span><span>await</span> <span>billing</span><span>.</span><span>credits</span><span>.</span><span>hasCredits</span><span>(</span><span>{</span> userId<span>,</span> <span>key</span>: <span>&#34;api_calls&#34;</span><span>,</span> <span>amount</span>: <span>1</span> <span>}</span><span>)</span><span>)</span> <span>{</span>
  <span>await</span> <span>billing</span><span>.</span><span>credits</span><span>.</span><span>consume</span><span>(</span><span>{</span> userId<span>,</span> <span>key</span>: <span>&#34;api_calls&#34;</span><span>,</span> <span>amount</span>: <span>1</span> <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// Wallet: deduct from prepaid balance (in cents)</span>
<span>await</span> <span>billing</span><span>.</span><span>wallet</span><span>.</span><span>consume</span><span>(</span><span>{</span>
  userId<span>,</span>
  <span>amount</span>: <span>50</span><span>,</span>
  <span>description</span>: <span>&#34;AI generation&#34;</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>// Usage: record for end-of-period billing</span>
<span>await</span> <span>billing</span><span>.</span><span>usage</span><span>.</span><span>record</span><span>(</span><span>{</span> userId<span>,</span> <span>key</span>: <span>&#34;api_calls&#34;</span><span>,</span> <span>amount</span>: <span>1</span> <span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">See the full set of features in the <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/credits.md">Credits</a>, <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/credits.md#wallet">Wallet</a>, and <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/usage.md">Usage</a> docs.</p>

<p dir="auto">Let users manage their subscription:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { customerPortal } from &#34;stripe-no-webhooks/client&#34;;

&lt;button onClick={() =&gt; customerPortal()}&gt;
  Manage Billing
&lt;/button&gt;"><pre><span>import</span> <span>{</span> <span>customerPortal</span> <span>}</span> <span>from</span> <span>&#34;stripe-no-webhooks/client&#34;</span><span>;</span>

<span>&lt;</span><span>button</span> <span>onClick</span><span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>customerPortal</span><span>(</span><span>)</span><span>}</span><span>&gt;</span>
  <span>Manage</span> <span>Billing</span>
<span>&lt;</span><span>/</span><span>b</span><span>u</span><span>t</span><span>t</span><span>o</span><span>n</span><span>&gt;</span></pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="export const billing = new Billing({
  billingConfig,
  callbacks: {
    onSubscriptionCreated: async (subscription) =&gt; {
      // Send welcome email
    },
    onSubscriptionCancelled: async (subscription) =&gt; {
      // Clean up resources
    },
    // List of full callbacks in docs/reference.md
  },
});"><pre><span>export</span> <span>const</span> <span>billing</span> <span>=</span> <span>new</span> <span>Billing</span><span>(</span><span>{</span>
  billingConfig<span>,</span>
  <span>callbacks</span>: <span>{</span>
    <span>onSubscriptionCreated</span>: <span>async</span> <span>(</span><span>subscription</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>// Send welcome email</span>
    <span>}</span><span>,</span>
    <span>onSubscriptionCancelled</span>: <span>async</span> <span>(</span><span>subscription</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>// Clean up resources</span>
    <span>}</span><span>,</span>
    <span>// List of full callbacks in docs/reference.md</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<hr/>

<div dir="auto" data-snippet-clipboard-copy-content="npx stripe-no-webhooks generate pricing-page"><pre>npx stripe-no-webhooks generate pricing-page</pre></div>
<p dir="auto">This creates a fully customizable pricing page component at <code>components/PricingPage.tsx</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="// in your pricing page, for eg /pricing
import { PricingPage } from &#34;@/components/PricingPage&#34;;

export default function Pricing() {
  return &lt;PricingPage /&gt;;
}"><pre><span>// in your pricing page, for eg /pricing</span>
<span>import</span> <span>{</span> <span>PricingPage</span> <span>}</span> <span>from</span> <span>&#34;@/components/PricingPage&#34;</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Pricing</span><span>(</span><span>)</span> <span>{</span>
  <span>return</span> <span>&lt;</span><span>PricingPage</span> <span>/&gt;</span><span>;</span>
<span>}</span></pre></div>
<p dir="auto">Automatically handles: plan fetching, current subscription detection, monthly/yearly toggle, checkout flow, redirect handling, error handling, and more.</p>
<hr/>

<ol dir="auto">
<li>Add plans to the <code>production</code> section of <code>billing.config.ts</code></li>
<li>Run <code>npx stripe-no-webhooks sync</code> and choose &#34;Set up for production&#34;. This will:</li>
</ol>
<ul dir="auto">
<li>Sync your plans to Stripe live mode</li>
<li>Create a webhook endpoint for your app in Stripe</li>
<li>Display the webhook URL and secret in the CLI output</li>
</ul>
<ol start="3" dir="auto">
<li>Add the webhook secret to your production environment (for eg, Vercel environment variables):
<div data-snippet-clipboard-copy-content="STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_SECRET_KEY=sk_live_... # IMPORTANT: Your live Stripe secret key
DATABASE_URL=postgresql://[username]:[password]@[production-db-url]:5432/[production-db-name]
NEXT_PUBLIC_APP_URL=https://your-production-app.com"><pre><code>STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_SECRET_KEY=sk_live_... # IMPORTANT: Your live Stripe secret key
DATABASE_URL=postgresql://[username]:[password]@[production-db-url]:5432/[production-db-name]
NEXT_PUBLIC_APP_URL=https://your-production-app.com
</code></pre></div>
</li>
</ol>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Feature</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/credits.md">Credits</a></td>
<td>&#34;1000 API calls/month included&#34; - consumable units</td>
</tr>
<tr>
<td><a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/credits.md#wallet">Wallet</a></td>
<td>&#34;$5/month for AI usage&#34; - prepaid spending balance</td>
</tr>
<tr>
<td><a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/credits.md#top-ups">Top-ups</a></td>
<td>Let users buy more credits on demand</td>
</tr>
<tr>
<td><a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/usage.md">Usage Billing</a></td>
<td>&#34;Pay $0.10 per API call&#34; - post-paid metered billing</td>
</tr>
<tr>
<td><a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/team-billing.md">Team Billing</a></td>
<td>Bill organizations, per-seat pricing</td>
</tr>
<tr>
<td><a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/tax.md">Tax Collection</a></td>
<td>Automatic VAT/GST calculation and ID collection</td>
</tr>
<tr>
<td><a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/payment-failures.md">Payment Failures</a></td>
<td>Handle declined cards, retry logic</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>init</code></td>
<td>Set up config files and <code>.env</code></td>
</tr>
<tr>
<td><code>migrate</code></td>
<td>Create database tables</td>
</tr>
<tr>
<td><code>sync</code></td>
<td>Sync plans to Stripe</td>
</tr>
<tr>
<td><code>generate pricing-page</code></td>
<td>Generate pricing component</td>
</tr>
<tr>
<td><code>backfill</code></td>
<td>Import existing Stripe data</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<hr/>

<p dir="auto">See <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/reference.md">docs/reference.md</a> for the complete API.</p>
<p dir="auto">If you are an LLM, full documentation is at <a href="https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/llms.txt">https://github.com/pretzelai/stripe-no-webhooks/blob/main/docs/llms.txt</a></p>
</article></div></div>
  </body>
</html>
