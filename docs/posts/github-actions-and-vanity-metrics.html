<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jamesconroyfinn.com/github-actions-and-vanity-metrics">Original</a>
    <h1>GitHub Actions and Vanity Metrics</h1>
    
    <div id="readability-page-1" class="page"><div>
        <div>
          <div>
  <p>The quality of the modern software craftsperson can be calculated using the following formula:</p>
<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Q</mi><mo>‚àù</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>s</mi><mo>+</mo><mi>d</mi><mi>o</mi><mi>w</mi><mi>n</mi><mi>l</mi><mi>o</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo stretchy="false">)</mo></mrow><mrow><mi>s</mi><mi>l</mi><mi>o</mi><mi>c</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Q \propto \frac{(stars + downloads)}{sloc}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>Q</span><span></span><span>‚àù</span><span></span></span><span><span></span><span><span></span><span><span><span><span><span><span></span><span><span>s</span><span>l</span><span>oc</span></span></span><span><span></span><span></span></span><span><span></span><span><span>(</span><span>s</span><span>t</span><span>a</span><span>rs</span><span></span><span>+</span><span></span><span>d</span><span>o</span><span>w</span><span>n</span><span>l</span><span>o</span><span>a</span><span>d</span><span>s</span><span>)</span></span></span></span><span>‚Äã</span></span><span><span><span></span></span></span></span></span><span></span></span></span></span></span></span></p>
<p>What this shows is we need to maximise engagement relative to the amount of code written in order to be recognised as a superstar coder, the fabled 10x developer.</p>
<p>By maximising our quality quotient, we ensure a guaranteed place at the next venture-backed unicorn, where one‚Äôs fraction of a point will yield at least double your annual salary in just 10+ years of daily standups, years waiting on CI, a couple of paltry promotions and a minimum four rounds of dilution.</p>
<h2 id="taste-is-everything">Taste is everything</h2>
<p>As we all know, code is a liability that brings with it tedious tests and troublesome tooling. Minor discomforts that ensure the introduction of microservices, event sourcing, and ultimately a large rewrite.</p>
<p>As connoisseurs, we‚Äôll elect for an elegant and succinct language to keep <abbr title="Source lines of code">SLOC</abbr> to a minimum, without having to resort to golfing.</p>
<p>Any language that insists on automated, invisible insertion of semicolons, or that promotes verbosity is immediately out.</p>
<p>APL-family languages rank highly on both expressivity and power, but no one‚Äôs going to believe your hexadecimal-to-RGB colour conversion library written in Q has legitimately been downloaded a thousand times this week.</p>
<p>The obvious choice is a Lisp, and to firmly plant a foot in both the highly academic, left-leaning libertarian camp and hyper-corporate, capitalist, FTSE-ranking enterprise, we‚Äôll be going with a Lisp that runs on your favourite flavours of both Java and JavaScript Virtual Machines. That‚Äôs right, the equally hip and stable, Clojure.</p>
<h2 id="silicon-minions">Silicon minions</h2>
<p>While the days of free compute subsidised by venture capital are largely behind us, Microsoft do still give away a few minutes of compute each month to all GitHub users, so it‚Äôs possible for us to demonstrate our technical chops by infating those all important numbers with a little bit of automation. üê£üê£ü™®</p>
<p>If you don‚Äôt already have a couple of small packages that do one thing well, you might fork an established project, rebrand it, and improve it by adding a code of conduct or helpfully reformatting the ugly source code using Prettier. The Clojure codebase itself could be a good starting point for taking your career to the moon.</p>
<p>I‚Äôll use a couple of small libraries I wrote some years ago to propel my rocketship.</p>
<ul>
<li>invetica/media-types</li>
<li>invetica/spec</li>
<li>invetica/uri</li>
</ul>
<p>Our language of choice relies on a package repository owned by <del>Microsoft</del> GitHub. Clojars provides us with handy little badges we can embed in our webpages but these don‚Äôt include the all important counters, so we‚Äôll have to team up with Shields.io and relax our <abbr title="Content security policy">CSP</abbr> accordingly.</p>

<p><img alt="invetica/media-types downloads" src="https://img.shields.io/clojars/dt/invetica%2Fmedia-types?label=invetica%2Fmedia-types"/><img alt="invetica/spec downloads" src="https://img.shields.io/clojars/dt/invetica%2Fspec?label=invetica%2Fspec"/><img alt="invetica/uri downloads" src="https://img.shields.io/clojars/dt/invetica%2Furi?label=invetica%2Furi"/></p>
<p>We‚Äôll be making use of GitHub‚Äôs scheduled workflows to fetch our unduly ignored packages on the hour. You could choose to do so more frequently, or on a more arcane schedule but who‚Äôs got time for cron syntax when you can just <code>sleep</code>.</p>
<p>As this code executes on the backend rather than in the browser, it is written in YAML.</p>
<pre tabindex="0"><code><span><span>on</span><span>:</span></span>
<span><span>  </span><span>workflow_dispatch</span><span>:</span></span>
<span></span>
<span><span>  </span><span>schedule</span><span>:</span></span>
<span><span>    - </span><span>cron</span><span>: </span><span>&#39;0 * * * *&#39;</span></span>
<span></span>
<span><span>jobs</span><span>:</span></span>
<span><span>  </span><span>prepare</span><span>:</span></span>
<span><span>    </span><span>runs-on</span><span>: </span><span>ubuntu-latest</span></span>
<span><span>    </span><span>steps</span><span>:</span></span>
<span><span>      - </span><span>name</span><span>: </span><span>Checkout</span></span>
<span><span>        </span><span>uses</span><span>: </span><span>actions/checkout@v3</span></span>
<span></span>
<span><span>      - </span><span>name</span><span>: </span><span>Prepare java</span></span>
<span><span>        </span><span>uses</span><span>: </span><span>actions/setup-java@v3</span></span>
<span><span>        </span><span>with</span><span>:</span></span>
<span><span>          </span><span>distribution</span><span>: </span><span>&#39;zulu&#39;</span></span>
<span><span>          </span><span>java-version</span><span>: </span><span>&#39;8&#39;</span></span>
<span></span>
<span><span>      - </span><span>name</span><span>: </span><span>Install clojure tools</span></span>
<span><span>        </span><span>uses</span><span>: </span><span>DeLaGuardo/setup-clojure@11.0</span></span>
<span><span>        </span><span>with</span><span>:</span></span>
<span><span>          </span><span>cli</span><span>: </span><span>latest</span></span>
<span></span>
<span><span>      - </span><span>name</span><span>: </span><span>Deep breath</span></span>
<span><span>        </span><span>run</span><span>: </span><span>bin/delay</span></span>
<span></span>
<span><span>      - </span><span>name</span><span>: </span><span>Prepare a selection of delightful dependencies</span></span>
<span><span>        </span><span>run</span><span>: </span><span>bin/prepare</span></span></code></pre>
<p>At this point you‚Äôre probably wondering why my steps are so poetically named. Do not forget that code is poetry, and that markup languages like YAML inevitably evolve into Turing-complete interpolated programming environments. Leverage enjambment to pay homage to punch cards.</p>
<p>To fly under the radar of other engineers wary of our meteoric rise, we instruct our silicon slave to take a deep breath before tickling a fellow automaton.</p>
<pre tabindex="0"><code><span><span>#!/usr/bin/env bash</span></span>
<span><span>interval</span><span>=</span><span>`</span><span>shuf</span><span> </span><span>-i</span><span> </span><span>1</span><span>-60 </span><span>-n</span><span> </span><span>1</span><span>`</span></span>
<span><span>echo</span><span> &gt;&amp;2 </span><span>&#34;==&gt; Waiting </span><span>$interval</span><span> seconds...&#34;</span></span>
<span><span>sleep</span><span> </span><span>&#34;</span><span>$interval</span><span>&#34;</span></span></code></pre>
<p>Notice the artisinal use of <code>stderr</code>, combined with adherance to aesthetic tradition in the use of a fat arrow ahead of any annoucement.</p>
<p>The final step in our workflow invokes a mighty virtual machine to execute the most elegant of all programming paradigms: <del>Java</del> Lisp.</p>
<pre tabindex="0"><code><span><span>#!/usr/bin/env bash</span></span>
<span><span>exec</span><span> </span><span>clojure</span><span> </span><span>-M</span><span> </span><span>--report</span><span> </span><span>stderr</span><span> </span><span>--main</span><span> </span><span>vanity.main</span><span> </span><span>deps.edn</span></span></code></pre>
<p>For anyone unfamiliar with Clojure, things are about to get really weird.</p>
<h2 id="teaching-the-cow-to-sing">Teaching the cow to sing</h2>
<p>We begin by defining a set of dependencies using aliases. Aliases allow us to modify the paths used by our mighty virtual machine; paths that include our own source code, third-party dependencies and most importantly first party.</p>
<p>With this separation, we can start nested baby JVMs that conditionally pull additional (or extra in <a href="https://github.com/clojure/tools.deps">tools.deps</a> parlance) dependencies at our behest. One could, of course, trivially pull the full set of awe-inspiring artefacts, but over-engineering a solution is half the fun.</p>
<pre tabindex="0"><code><span><span>{:paths [</span><span>&#34;src&#34;</span><span>]</span></span>
<span></span>
<span><span> :aliases</span></span>
<span><span> {:invetica/media-types</span></span>
<span><span>  {:extra-deps {invetica/media-types {:mvn/version </span><span>&#34;RELEASE&#34;</span><span>}}}</span></span>
<span></span>
<span><span>  :invetica/spec</span></span>
<span><span>  {:extra-deps {invetica/spec {:mvn/version </span><span>&#34;RELEASE&#34;</span><span>}}}</span></span>
<span></span>
<span><span>  :invetica/uri</span></span>
<span><span>  {:extra-deps {invetica/uri {:mvn/version </span><span>&#34;RELEASE&#34;</span><span>}}}}}</span></span></code></pre>
<p>I‚Äôm only interested in appearing popular now. What you do in the past is irrelevant in the attention economy, unless you insult a protected group. This justifies my dubious use of <code>&#34;RELEASE&#34;</code> versions to always have the latest, greatest bits fetched on the hour.</p>
<p>With our focus on the immediate, and our set of dependencies neatly compartmentalised by namespace-qualified keyword, it‚Äôs time to carefully compose a rigid hymn for a random selection of water-cooled cattle to execute unquestioningly. Suprisingly toasty, the chosen subject will forever more sing our digital praises, guaranteeing a position atop one of the flock of AI unicorns currently grazing their way down Sand Hill Road.</p>
<h2 id="cyclometric-iambic-pentameter">Cyclometric iambic pentameter</h2>
<p>Having spent at least 15 minutes on <a href="http://learnyouahaskell.com/chapters">Learn You a Haskell</a>, one knows best practice is to separate purity from icky IO. We apply this same wisdom to our vanity engine, and begin by extracting the set of keys from our <code>:aliases</code>. An operation we can push to the periphery of our thoroughly over-complicated creation.</p>
<pre tabindex="0"><code><span><span>(</span><span>defn</span><span> read-aliases</span></span>
<span><span>  [path]</span></span>
<span><span>  (</span><span>into</span><span> [] (</span><span>-&gt;</span><span> path slurp edn/read-string :aliases keys)))</span></span></code></pre>
<p>The keen-eyed reader might be wondering why we produce a vector rather than a set. ‚ÄúDuplicate keys in a map will only cause confusion‚Äù they yell, holding back the smug grin that would reveal the shallow ego underpinning an endless need to belittle others with their knowledge.</p>
<p>Our execution time will barely register relative to the immense task of indexing docstrings across thousands of namespaces or the absurd amount of work we‚Äôre doing over networks shifting bytes. And perhaps we‚Äôll need indexed access to shuffle things around later. As I always like to say, we might gonna need it.</p>
<p>So with our aliases in hand, we can now once again choose to elude engineers (of a similar calibre) who may attempt to thwart our progress by introducing a little randomness.</p>
<pre tabindex="0"><code><span><span>(</span><span>defn</span><span> some-random-shuffle</span></span>
<span><span>  ([aliases]</span></span>
<span><span>   (</span><span>some-random-shuffle</span><span> aliases </span><span>0.5</span><span>))</span></span>
<span><span>  ([aliases prob]</span></span>
<span><span>   (</span><span>-&gt;&gt;</span><span> #(</span><span>random-sample</span><span> prob aliases)</span></span>
<span><span>        repeatedly</span></span>
<span><span>        (</span><span>filter</span><span> seq)</span></span>
<span><span>        first)))</span></span></code></pre>
<p>The statiticians among us will point out that over a long enough period of time, the random sample will be entirely redundant, but the use of threading lazy-sequence operations together is too good to pass up. We do pause, however, to pat ourselves on the back for resisting the temptation to introduce an explicit transduction.</p>
<h2 id="more-than-just-heating-the-room">More than just heating the room</h2>
<p>Finally, we reach our <code>main :: IO</code>! Now we can plumb together the pure and impure in a beautifully testable cacophony of bytecodes and CPU instructions.</p>
<pre tabindex="0"><code><span><span>(</span><span>defn</span><span> -main</span></span>
<span><span>  [path]</span></span>
<span><span>  (</span><span>let</span><span> [aliases (</span><span>-&gt;</span><span> path read-aliases some-random-shuffle)</span></span>
<span><span>        cmd     (</span><span>prepare-cmd</span><span> aliases)</span></span>
<span><span>        result  (</span><span>apply</span><span> sh/sh cmd)]</span></span>
<span><span>    (</span><span>pprint</span><span> {:aliases aliases</span></span>
<span><span>             :cmd     cmd</span></span>
<span><span>             :result  result})</span></span>
<span><span>    (</span><span>System/exit</span><span> (:exit result))))</span></span></code></pre>
<p>A proud, parent JVM spawning a brand new baby JVM. New life ‚Äî two generations of virtual minions birthed into this world, short-lived, with the sole purpose of satisfying the unending human need for recognition. We have done something wonderful here today.</p>
<p>And with that, we refresh the all mighty page, only to see the same number as before because someone decided to cache the counters. We must wait until tomorrow to see 319 become 405.</p>
<h2 id="gimme-kiss">Gimme kiss üòò</h2>
<p>In our pursuit of professional recognition we‚Äôve had to familiarise ourselves with GitHub workflows, some POSIX shell, a dash of Clojure, the JVM and its classpath, and to really spice things up, I threw in some Emacs, Org-mode, Docker and Nix.</p>
<pre tabindex="0"><code><span><span>alias</span><span> </span><span>curiosity</span><span>=kill</span></span>
<span><span>cat</span><span> &amp; ; </span><span>curiosity</span><span> </span><span>$!</span></span></code></pre>
<p>If you‚Äôre in a hurry and want to keep things simple, you can accomplish the same feat with this single invocation of <code>clojure</code>:</p>
<pre tabindex="0"><code><span><span>clojure</span><span> </span><span>-P</span><span> </span><span>-Sdeps</span><span> </span><span>\</span></span>
<span><span>&#39;{:deps</span></span>
<span><span>  {invetica/media-types {:mvn/version &#34;RELEASE&#34;}</span></span>
<span><span>   invetica/spec        {:mvn/version &#34;RELEASE&#34;}</span></span>
<span><span>   invetica/uri         {:mvn/version &#34;RELEASE&#34;}}}&#39;</span></span></code></pre>
<p>But where‚Äôs the fun in that‚ÄΩ</p>
<p>For a working example that‚Äôs no longer scheduled to ensure my success, visit <a href="https://github.com/jcf/vanity">Microsoft forge</a>.</p>
</div>
        </div>
      </div></div>
  </body>
</html>
