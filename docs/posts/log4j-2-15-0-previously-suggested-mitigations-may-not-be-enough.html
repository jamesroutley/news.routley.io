<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://isc.sans.edu/diary/Log4j&#43;2.15.0&#43;and&#43;previously&#43;suggested&#43;mitigations&#43;may&#43;not&#43;be&#43;enough/28134">Original</a>
    <h1>Log4j 2.15.0 – Previously suggested mitigations may not be enough</h1>
    
    <div id="readability-page-1" class="page"><div>


<p>According to a <a href="https://logging.apache.org/log4j/2.x/security.html">new Apache Log4j security bulletin</a>, version 2.15.0 and the initially suggested mitigation measures do not completely address the  Log4Shell in certain custom configurations. </p>

<p>It was discovered that version 2.15.0 would still be vulnerable when the configuration has a pattern layout containing a Context Lookup (for example, $${ctx:loginId}), or a Thread Context Map pattern %X, %mdc, or %MDC. In these cases, when the attacker manages to control the Thread Context values, JNDI lookup injections may be possible, resulting in JNDI connections. Version 2.15.0 limited JNDI connections to &#39;localhost’&#39; but this possibility could result in a denial of service (DoS) or worse.</p>

<p>Therefore, a new version (2.16.0) has been made available to completely fix the issue (so far at least) associated with CVE-2021–45046 along with more effective mitigation measures for versions to 2.x versions:</p>

<ul>
	<li>Java 8 (or later) users should upgrade to release 2.16.0.</li>
	<li>Users requiring Java 7 should upgrade to release 2.12.2 when it becomes available (work in progress, expected to be available soon).</li>
	<li>Otherwise, remove the JndiLookup class from the classpath: zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class</li>
</ul>

<p>The mitigation measures previously reported, such as setting the log4j2.formatMsgNoLookups variable to ‘true’, is not considered fully effective. The advisory says:</p>

<p> &#34;<em>The reason these measures are insufficient is that, in addition to the Thread Context attack vector mentioned above, there are still code paths in Log4j where message lookups could occur: known examples are applications that use Logger.printf(&#34;%s&#34;, userInput), or applications that use a custom message factory, where the resulting messages do not implement StringBuilderFormattable. There may be other attack vectors.</em>&#34;.</p>

<p>So, if you could not upgrade to versions 2.15.0 or 2.16.0 and followed previous mitigations, <strong>you are advised to remove JndiLookup class from the log4j-core jar</strong> to mitigate the vulnerability. </p>

<p>The advisory is available at: <a href="https://logging.apache.org/log4j/2.x/security.html">https://logging.apache.org/log4j/2.x/security.html</a></p>

<p>--</p>

</div></div>
  </body>
</html>
