<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://wiki.php.net/rfc/deprecate_dollar_brace_string_interpolation">Original</a>
    <h1>PHP RFC: Deprecate ${} string interpolation</h1>
    
    <div id="readability-page-1" class="page"><div class="page">
                                                            <!-- wikipage start -->
                                        

<div>
<ul>
<li><p> Date: 2021-03-13</p>
</li>
<li><p> Author: Ilija Tovilo, tovilo.ilija@gmail.com</p>
</li>
<li><p> Status: Implemented</p>
</li>
<li><p> Target Version: PHP 8.2</p>
</li>
<li><div><p> Implementation: <a href="https://github.com/php/php-src/pull/8212" title="https://github.com/php/php-src/pull/8212" rel="ugc nofollow">https://github.com/php/php-src/pull/8212</a></p></div>
</li>
</ul>

</div>

<h2 id="proposal">Proposal</h2>
<div>

<p>
PHP allows embedding variables in strings with double-quotes (<code>&#34;</code>) and heredoc in various ways.
</p>
<ol>
<li><p> Directly embedding variables (<code>“$foo”</code>)</p>
</li>
<li><p> Braces outside the variable (<code>“{$foo}”</code>)</p>
</li>
<li><p> Braces after the dollar sign (<code>“${foo}”</code>)</p>
</li>
<li><p> Variable variables (<code>“${expr}”</code>, equivalent to <code>(string) ${expr}</code>)</p>
</li>
</ol>

<p>
Options 1 and 2 have their pros and cons. Options 3 and 4 are easily confused due to overlapping syntax, 3 is strictly less capable than 1 and 2, and 4 has completely different semantics (<a href="https://www.php.net/manual/en/language.variables.variable.php" title="https://www.php.net/manual/en/language.variables.variable.php" rel="ugc nofollow">variable variables</a>) that are rarely useful in string interpolation.
</p>

<p>
This <abbr title="Request for Comments">RFC</abbr> proposes to deprecate options 3 and 4 in PHP 8.2 and remove them in PHP 9.0.
</p>
<pre><a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>${foo}</span>&#34;</span><span>)</span><span>;</span>
<span>// Deprecated: Using ${} in strings is deprecated</span>
 
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;${(foo)}&#34;</span><span>)</span><span>;</span>
<span>// Deprecated: Using ${} (variable variables) in strings is deprecated</span></pre>

<p>
That leaves only two string interpolation options: direct (simple variable only) and powerful (the one that does the most now).
</p>

</div>

<h2 id="status_quo">Status quo</h2>
<p>
Options 1, 2 and 3 roughly try to achieve the same thing, embedding simple variables or chains in a string.  They all support a different subset of features.
</p>

<h3 id="simple_variable_interpolation">Simple variable interpolation</h3>
<div>

<p>
Options 1, 2, and 3 support embedding basic variables.
</p>
<pre><span>$foo</span> <span>=</span> <span>&#39;foo&#39;</span><span>;</span>
 
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>$foo</span>&#34;</span><span>)</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>{$foo}</span>&#34;</span><span>)</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>${foo}</span>&#34;</span><span>)</span><span>;</span></pre>

</div>

<h3 id="array-offset_interpolation">Array-offset interpolation</h3>
<div>

<p>
Options 1, 2, and 3 allow accessing an array offset. Unfortunately, the syntax is not consistent.
</p>
<pre><span>$foo</span> <span>=</span> <span>[</span><span>&#39;bar&#39;</span> <span>=&gt;</span> <span>&#39;bar&#39;</span><span>]</span><span>;</span>
 
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>$foo[bar]</span>&#34;</span><span>)</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>{$foo[&#39;bar&#39;]}</span>&#34;</span><span>)</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>${foo[&#39;bar&#39;]}</span>&#34;</span><span>)</span><span>;</span></pre>

<p>
It&#39;s worth noting that options 2 and 3 support arbitrary expressions between <code>[</code> and <code>]</code>, whereas option 1 only supports simple strings with no spaces or other special characters.
</p>

</div>

<h3 id="object_property_interpolation">Object property interpolation</h3>
<div>

<p>
Only syntax 1 and 2 allow accessing properties.
</p>
<pre><span>$foo</span> <span>=</span> <span>(</span>object<span>)</span> <span>[</span><span>&#39;bar&#39;</span> <span>=&gt;</span> <span>&#39;bar&#39;</span><span>]</span><span>;</span>
 
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>$foo-&gt;bar</span>&#34;</span><span>)</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>{$foo-&gt;bar}</span>&#34;</span><span>)</span><span>;</span></pre>

</div>

<h3 id="method_call_interpolation">Method call interpolation</h3>
<div>

<p>
Only syntax 2 allows calling methods.
</p>
<pre><span>class</span> Foo <span>{</span>
    <span>public</span> <span>function</span> bar<span>(</span><span>)</span> <span>{</span>
        <span>return</span> <span>&#39;bar&#39;</span><span>;</span>
    <span>}</span>
<span>}</span>
 
<span>$foo</span> <span>=</span> <span>new</span> Foo<span>(</span><span>)</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;{<span>$foo-&gt;bar</span>()}&#34;</span><span>)</span><span>;</span></pre>

</div>

<h3 id="compound_interpolation">Compound interpolation</h3>
<div>

<p>
Only syntax 2 allows chaining all of the above.
</p>
<pre><span>class</span> Bar <span>{</span>
    <span>public</span> <span>function</span> baz<span>(</span><span>)</span> <span>{</span>
        <span>return</span> <span>&#39;baz&#39;</span><span>;</span>
    <span>}</span>
<span>}</span>
 
<span>$foo</span> <span>=</span> <span>[</span><span>&#39;bar&#39;</span> <span>=&gt;</span> <span>new</span> Bar<span>(</span><span>)</span><span>]</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;{<span>$foo</span>[&#39;bar&#39;]-&gt;baz()}&#34;</span><span>)</span><span>;</span></pre>

</div>

<h3 id="option_4">Option 4</h3>
<div>

<p>
PHP has a feature called <a href="https://www.php.net/manual/en/language.variables.variable.php" title="https://www.php.net/manual/en/language.variables.variable.php" rel="ugc nofollow">Variable variables</a>. It allows you to get a variable by name. The name can be a string stored in another variable.
</p>
<pre><span>$foo</span> <span>=</span> <span>&#39;Hello world!&#39;</span><span>;</span>
<span>$bar</span> <span>=</span> <span>&#39;foo&#39;</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span>$<span>{</span><span>$bar</span><span>}</span><span>)</span><span>;</span></pre>

<p>
The same works within strings. This is the option 4 described above.
</p>
<pre><span>$foo</span> <span>=</span> <span>&#39;world!&#39;</span><span>;</span>
<span>$bar</span> <span>=</span> <span>&#39;foo&#39;</span><span>;</span>
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;Hello $<span>{$bar}</span>&#34;</span><span>)</span><span>;</span></pre>

<p>
As you might notice, this syntax clashes with option 3. If the term between the two braces is not compatible with option 3 PHP will interpret it as option 4 which has completely different semantics.
</p>
<pre><span>const</span> foo <span>=</span> <span>&#39;bar&#39;</span><span>;</span>
<span>$foo</span> <span>=</span> <span>&#39;foo&#39;</span><span>;</span>
<span>$bar</span> <span>=</span> <span>&#39;bar&#39;</span><span>;</span>
 
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;<span>${foo}</span>&#34;</span><span>)</span><span>;</span>
<span>//&gt; foo</span>
 
<a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;${(foo)}&#34;</span><span>)</span><span>;</span>
<span>//&gt; bar</span></pre>

<p>
The braces switch from option 3 to 4 because parentheses are not allowed in option 3. This means <code>foo</code> is no longer interpreted as a variable but as a constant, and option 4 will then try to find a local variable by the name of that constant. This is incredibly unintuitive. Even though I cannot imagine a scenario where variable variables in strings are useful it&#39;s worth noting that they can still be expressed with option 2 as <code>“{${expr}}”</code> with a more consistent syntax.
</p>

</div>

<h2 id="conclusion">Conclusion</h2>
<div>

<p>
Option 1 offers a simple “base case” for the most common situation and is widely used.
</p>

<p>
Option 2 offers the most robust syntax currently supported, and is widely used.
</p>

<p>
Option 3 offers a subset of the functionality of option 1 and 2, and is less widely used.
</p>

<p>
Option 4 offers functionality that is rarely if ever useful, and easily confused with option 3.
</p>

<p>
For all of the reasons above this <abbr title="Request for Comments">RFC</abbr> proposes to deprecate option 3 and 4 in PHP 8.2 and remove them in PHP 9.
</p>

</div>

<h2 id="impact">Impact</h2>
<div>

<p>
An analysis of the top 1000 packagist repositories yielded 267 usages of option 3, 0 of option 4.
</p>

<p>
<a href="https://gist.github.com/iluuu1994/05427dd74100af8e41ebff3d4201742c" title="https://gist.github.com/iluuu1994/05427dd74100af8e41ebff3d4201742c" rel="ugc nofollow">https://gist.github.com/iluuu1994/05427dd74100af8e41ebff3d4201742c</a>
</p>

</div>

<h3 id="migration_path">Migration path</h3>
<div>

<p>
The migration of option 3 to 2 is straight forward. Simply move the dollar sign.
</p>
<pre><span>&#34;<span>${foo}</span>&#34;</span> <span>=&gt;</span> <span>&#34;<span>{$foo}</span>&#34;</span>
<span>&#34;<span>${foo[expr]}</span>&#34;</span> <span>=&gt;</span> <span>&#34;<span>{$foo[expr]}</span>&#34;</span></pre>

<p>
The migration of option 4 to 2 is also straight forward. All it needs is adding braces around the interpolation.
</p>
<pre><span>&#34;<span>${foo-&gt;bar}</span>&#34;</span> <span>=&gt;</span> <span>&#34;{<span>${foo-&gt;bar}</span>}&#34;</span></pre>

<p>
The main challenge is differentiating between option 3 and 4 (which is a motivation of this <abbr title="Request for Comments">RFC</abbr>). In practice, 4 should be almost non-existent. Nonetheless, the deprecation message will contain the hint <code>(variable variables)</code> if option 4 is encountered.
</p>

<p>
I have created <a href="https://gist.github.com/iluuu1994/72e2154fc4150f2258316b0255b698f2" title="https://gist.github.com/iluuu1994/72e2154fc4150f2258316b0255b698f2" rel="ugc nofollow">a simple script</a> to automate this process.
</p>

</div>

<h2 id="unchanged_behavior">Unchanged behavior</h2>
<div>

<p>
These things caused confusion in the discussion, but will continue working as they are.
</p>
<ul>
<li><p> Variable variables outside of strings (<code>$foo = ${&#39;bar&#39;};</code>)</p>
</li>
<li><p> Variable variables as option 1 (<code>echo “$$foo”;</code>)</p>
</li>
</ul>

</div>

<h2 id="comparison_to_other_languages">Comparison to other languages</h2>
<p>
A number of other languages use <code>${foo}</code> style string interpolation, most notably bash and JavaScript (in template literals).  However, its behavior is different from that in PHP.  In PHP, that syntax means variable variables.  In JavaScript, it supports arbitrary expressions 2).  In its current form, options 3 and 4 are of limited use, and confusing for users from other nearby languages as they behave quite differently.
</p>


<div>

<p>
Options 1 and 2 are not perfect either. They only allow simple expressions on variables. A different <abbr title="Request for Comments">RFC</abbr> might propose to allow embedding arbitrary expressions into strings.
</p>
<pre><a href="http://www.php.net/var_dump"><span>var_dump</span></a><span>(</span><span>&#34;{$:func()}&#34;</span><span>)</span></pre>

<p>
If we decide to do that it would make sense to remove the less useful options first to not further add to the confusion, that&#39;s what this <abbr title="Request for Comments">RFC</abbr> is trying to achieve.
</p>

</div>

<h2 id="vote">Vote</h2>
<div>

<p>
Voting starts 2022-04-08 and ends 2022-04-22. 
</p>

<p>
As this is a language change, a 2/3 majority is required.
</p>

<!-- Doodle Plugin -->
<form action="/start" method="post" name="doodle__form" id="doodle__form__deprecate_string_interpolation_in_php_8.2_and_remove_them_in_php_9.0" accept-charset="utf-8">








<table>
  <tbody>
    <tr>
      <th colspan="3">
        Deprecate ${} string interpolation in PHP 8.2 and remove them in PHP 9.0?      </th>
    </tr>
    <tr>
        <th>Real name</th>
        <td>Yes</td>
        <td>No</td>
    </tr>

    <tr>
        <td>
                    <a href="https://people.php.net/alec">alec</a> (alec)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 15:57"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/asgrim">asgrim</a> (asgrim)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/18 11:00"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/ashnazg">ashnazg</a> (ashnazg)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/13 16:30"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/bmajdak">bmajdak</a> (bmajdak)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 15:53"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/brzuchal">brzuchal</a> (brzuchal)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 15:58"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/bwoebi">bwoebi</a> (bwoebi)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/13 15:38"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/crell">crell</a> (crell)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 17:29"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/derick">derick</a> (derick)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/13 15:19"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/dmitry">dmitry</a> (dmitry)        </td>
        <td> </td><td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/11 06:29"/></td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/galvao">galvao</a> (galvao)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/12 03:21"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/girgias">girgias</a> (girgias)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 16:21"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/ilutov">ilutov</a> (ilutov)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 14:42"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/imsop">imsop</a> (imsop)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/13 15:13"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/kalle">kalle</a> (kalle)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 17:55"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/kguest">kguest</a> (kguest)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/09 11:40"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/kocsismate">kocsismate</a> (kocsismate)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/09 04:19"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/marandall">marandall</a> (marandall)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 21:39"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/mbeccati">mbeccati</a> (mbeccati)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 18:17"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/mcmic">mcmic</a> (mcmic)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/14 16:11"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/nicolasgrekas">nicolasgrekas</a> (nicolasgrekas)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/20 17:15"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/ocramius">ocramius</a> (ocramius)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 14:46"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/petk">petk</a> (petk)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/10 16:00"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/reywob">reywob</a> (reywob)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 15:25"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/santiagolizardo">santiagolizardo</a> (santiagolizardo)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/13 21:41"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/sebastian">sebastian</a> (sebastian)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/09 12:17"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/sergey">sergey</a> (sergey)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 16:50"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/svpernova09">svpernova09</a> (svpernova09)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 15:38"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/thekid">thekid</a> (thekid)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/12 18:48"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/theodorejb">theodorejb</a> (theodorejb)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 15:05"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/timwolla">timwolla</a> (timwolla)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 17:07"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/trowski">trowski</a> (trowski)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/08 14:47"/></td><td> </td>        
    </tr>
    <tr>
        <td>
                    <a href="https://people.php.net/twosee">twosee</a> (twosee)        </td>
        <td><img src="https://blog.plover.com/lib/images/success.png" title="2022/04/10 09:55"/></td><td> </td>        
    </tr>
 
    <!-- Results / sum per column -->
    <tr>
        <th><b>Final result:</b></th>
        <th><b>31</b></th>
        <th><b>1</b></th>
    </tr>


    
    <tr>
      <td colspan="3">
        This poll has been closed.      </td>
    </tr>

  </tbody>
</table>

</form>





</div>

                    <!-- wikipage stop -->
                                    </div></div>
  </body>
</html>
