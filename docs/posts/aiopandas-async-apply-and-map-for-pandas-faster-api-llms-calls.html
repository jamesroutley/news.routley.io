<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/telekinesis-inc/aiopandas">Original</a>
    <h1>Show HN: Aiopandas ‚Äì Async .apply() and .map() for Pandas, Faster API/LLMs Calls</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">üöÄ <strong>Async-Powered Pandas</strong>: Lightweight Pandas monkey-patch that adds async support to <code>map</code>, <code>apply</code>, <code>applymap</code>, <code>aggregate</code>, and <code>transform</code>, enabling seamless handling of async functions with <strong>controlled parallel execution</strong> (<code>max_parallel</code>).</p>

<ul dir="auto">
<li><strong>Drop-in replacement</strong> for Pandas functions, now supporting <strong>async functions</strong>.</li>
<li><strong>Automatic async execution</strong> with <strong>controlled concurrency</strong> via <code>max_parallel</code>.</li>
<li><strong>Built-in error handling</strong> ‚Äì choose between raising, ignoring, or logging errors.</li>
<li><strong>Supports tqdm</strong> for real-time progress tracking.</li>
</ul>
<hr/>

<div dir="auto" data-snippet-clipboard-copy-content="import aiopandas as pd  # Monkey-patches Pandas with async methods
import asyncio

# Create a sample DataFrame
df = pd.DataFrame({&#39;x&#39;: range(10)})

# Define an async function (simulating API calls, I/O, etc.)
async def f(x):
    await asyncio.sleep(0.1 * x)  # Simulate async processing
    return x * 2  # Example transformation

# Apply the async function to the DataFrame column
df[&#39;y&#39;] = await df.x.amap(f, max_parallel=5)  # Default max_parallel=16
print(df)"><pre><span>import</span> <span>aiopandas</span> <span>as</span> <span>pd</span>  <span># Monkey-patches Pandas with async methods</span>
<span>import</span> <span>asyncio</span>

<span># Create a sample DataFrame</span>
<span>df</span> <span>=</span> <span>pd</span>.<span>DataFrame</span>({<span>&#39;x&#39;</span>: <span>range</span>(<span>10</span>)})

<span># Define an async function (simulating API calls, I/O, etc.)</span>
<span>async</span> <span>def</span> <span>f</span>(<span>x</span>):
    <span>await</span> <span>asyncio</span>.<span>sleep</span>(<span>0.1</span> <span>*</span> <span>x</span>)  <span># Simulate async processing</span>
    <span>return</span> <span>x</span> <span>*</span> <span>2</span>  <span># Example transformation</span>

<span># Apply the async function to the DataFrame column</span>
<span>df</span>[<span>&#39;y&#39;</span>] <span>=</span> <span>await</span> <span>df</span>.<span>x</span>.<span>amap</span>(<span>f</span>, <span>max_parallel</span><span>=</span><span>5</span>)  <span># Default max_parallel=16</span>
<span>print</span>(<span>df</span>)</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto"><g-emoji alias="warning">‚ö†Ô∏è</g-emoji> Handling Errors Gracefully</h2><a id="user-content-Ô∏è-handling-errors-gracefully" aria-label="Permalink: ‚ö†Ô∏è Handling Errors Gracefully" href="#Ô∏è-handling-errors-gracefully"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">aiopandas includes built-in error handling, allowing you to manage failures without breaking the entire operation.</p>
<ol dir="auto">
<li>Default behavior (raise) ‚Äì stops on the first error</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="async def f(x):
    if x &gt; 50 and x % 3:
        raise Exception(&#39;exception example&#39;)
    await asyncio.sleep(0.01 * x)
    return x

df = pd.DataFrame({&#39;x&#39;: range(100)})

df[&#39;y&#39;] = await df.x.amap(f, max_parallel=50)  # Raises an exception"><pre><span>async</span> <span>def</span> <span>f</span>(<span>x</span>):
    <span>if</span> <span>x</span> <span>&gt;</span> <span>50</span> <span>and</span> <span>x</span> <span>%</span> <span>3</span>:
        <span>raise</span> <span>Exception</span>(<span>&#39;exception example&#39;</span>)
    <span>await</span> <span>asyncio</span>.<span>sleep</span>(<span>0.01</span> <span>*</span> <span>x</span>)
    <span>return</span> <span>x</span>

<span>df</span> <span>=</span> <span>pd</span>.<span>DataFrame</span>({<span>&#39;x&#39;</span>: <span>range</span>(<span>100</span>)})

<span>df</span>[<span>&#39;y&#39;</span>] <span>=</span> <span>await</span> <span>df</span>.<span>x</span>.<span>amap</span>(<span>f</span>, <span>max_parallel</span><span>=</span><span>50</span>)  <span># Raises an exception</span></pre></div>
<p dir="auto">Output (Error traceback):</p>
<div data-snippet-clipboard-copy-content="Exception: exception example"><pre><code>Exception: exception example
</code></pre></div>
<ol start="2" dir="auto">
<li>Ignore errors (on_error=&#39;ignore&#39;)</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="df[&#39;y&#39;] = await df.x.amap(f, max_parallel=50, on_error=&#39;ignore&#39;)  # Easy to ignore exceptions"><pre><span>df</span>[<span>&#39;y&#39;</span>] <span>=</span> <span>await</span> <span>df</span>.<span>x</span>.<span>amap</span>(<span>f</span>, <span>max_parallel</span><span>=</span><span>50</span>, <span>on_error</span><span>=</span><span>&#39;ignore&#39;</span>)  <span># Easy to ignore exceptions</span></pre></div>
<p dir="auto">Now, instead of crashing, rows that trigger exceptions return NaN:</p>

<div data-snippet-clipboard-copy-content="0      0.0
1      1.0
2      2.0
...
95     NaN
96    96.0
97     NaN
98     NaN
99    99.0
Name: y, Length: 100, dtype: float64"><pre><code>0      0.0
1      1.0
2      2.0
...
95     NaN
96    96.0
97     NaN
98     NaN
99    99.0
Name: y, Length: 100, dtype: float64
</code></pre></div>
<ol start="3" dir="auto">
<li>Custom error handling (on_error=print)</li>
</ol>
<p dir="auto">You can log or process errors with a custom function (or coroutines):</p>
<div dir="auto" data-snippet-clipboard-copy-content="df[&#39;y&#39;] = await df.x.amap(f, max_parallel=50, on_error=print)  # Print errors instead of failing"><pre><span>df</span>[<span>&#39;y&#39;</span>] <span>=</span> <span>await</span> <span>df</span>.<span>x</span>.<span>amap</span>(<span>f</span>, <span>max_parallel</span><span>=</span><span>50</span>, <span>on_error</span><span>=</span><span>print</span>)  <span># Print errors instead of failing</span></pre></div>
<p dir="auto">Output:</p>
<div data-snippet-clipboard-copy-content="exception example
exception example
exception example
..."><pre><code>exception example
exception example
exception example
...
</code></pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">üìä Progress Tracking with tqdm</h2><a id="user-content--progress-tracking-with-tqdm" aria-label="Permalink: üìä Progress Tracking with tqdm" href="#-progress-tracking-with-tqdm"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To visualize progress, pass tqdm as an argument:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from tqdm import tqdm

df[&#39;y&#39;] = await df.x.amap(f, max_parallel=5, tqdm=tqdm)"><pre><span>from</span> <span>tqdm</span> <span>import</span> <span>tqdm</span>

<span>df</span>[<span>&#39;y&#39;</span>] <span>=</span> <span>await</span> <span>df</span>.<span>x</span>.<span>amap</span>(<span>f</span>, <span>max_parallel</span><span>=</span><span>5</span>, <span>tqdm</span><span>=</span><span>tqdm</span>)</pre></div>
<p dir="auto">Example output:</p>
<div data-snippet-clipboard-copy-content=" 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà                | 69/100 [00:06&lt;00:03, 9.99it/s]"><pre><code> 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà                | 69/100 [00:06&lt;00:03, 9.99it/s]
</code></pre></div>

<ul dir="auto">
<li>Ideal for async API calls (e.g., LLMs, web scraping, database queries).</li>
<li>Massively speeds up Pandas workflows when dealing with async I/O operations.</li>
<li>Minimal code changes ‚Äì just swap .map() for .amap() (or .apply() for aapply(), etc.) and you‚Äôre good to go!</li>
</ul>


<p dir="auto">Or, install it manually:</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/telekinesis-inc/aiopandas.git
cd aiopandas
pip install ."><pre>git clone https://github.com/telekinesis-inc/aiopandas.git
<span>cd</span> aiopandas
pip install <span>.</span></pre></div>

<p dir="auto">Pull requests are welcome! If you find issues or have suggestions, feel free to open an issue. üöÄ</p>

<p dir="auto">The monkey patching in aiopandas was heavily inspired by (basically copy-pasted) and adapted from the tqdm.pandas() method. Special thanks to the tqdm maintainers for their excellent work on integrating progress bars with Pandas.</p>
</article></div></div>
  </body>
</html>
