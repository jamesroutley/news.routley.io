<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://chollinger.com/blog/2023/01/qgis-is-the-mapping-software-you-didnt-know-you-needed/">Original</a>
    <h1>QGIS is the mapping software you didn&#39;t know you needed</h1>
    
    <div id="readability-page-1" class="page"><div>
<h2 id="introduction">Introduction</h2>
<p>Sometimes, I come across software that makes me wonder: “How didn’t I know about this before‽”. <code>QGIS</code> is such software.</p>
<blockquote>
<p>A Free and Open Source Geographic Information System</p>
<p><a href="https://www.qgis.org/en/site/">https://www.qgis.org/en/site/</a></p>
</blockquote>
<p>As a bit of background - I’ve always been a fan of playing with geospatial data, as evidenced most recently in my <a href="https://avi.im/blog/2022/08/tiny-telematics-tracking-my-trucks-location-offline-with-a-raspberry-pi-redis-kafka-and-flink-part-1/">Tiny Telematics</a> project series or how I built a Data Lake with <a href="https://avi.im/blog/2021/12/building-a-data-lake-with-spark-and-iceberg-at-home-to-over-complicate-shopping-for-a-house/">geospatial data</a> when we bought our house. <em>[1]</em></p>
<p>It’s an <em>awesome</em> field, because it not only maps (heh) the real world around you onto something quantifiable, it <em>also</em> enables you to tap into the absolute wealth of <em>public</em> data that is available at your fingertips. Census data, demographics, structure polygons of your neighbors houses, barns, and sheds, NASAs elevation data project, flood plains, soil data, light pollution, zoning codes - you name it. It’s out there. And it is genuinely useful.</p>
<p>Also - you’re paying for the data already! <em>[2]</em> Go use it!</p>
<p>But you have to put all of it together. And that’s where <code>QGIS</code> comes in.</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124173948548.png" alt="image-20230124173948548"/>
</p>
<p>A note for my European friends - some of these links might not work from outside the US, as some <code>.gov</code> links tend not to.</p>
<p><em>[1]: Good fun, recommend the read.</em></p>
<p><em>[2]: If you’re a US tax payer.</em></p>
<h2 id="why-a-real-world-use-case">Why? A real-world use case</h2>
<p>I don’t generally work with geospatial data in my day job (and I’m too dense for any of the advanced trigonometry that these jobs tend to entail), which makes the field even more appealing for playing around with on my own. My use case was not purely academic, though. I’ve recently purchased a “recreational property”, which is a loaded term, but allow me to quote:</p>
<blockquote>
<p>Recreational land can be defined as any piece of property with land used for purposes of recreation. This specific use can be anything from hunting, fishing, ATV-ing, camping, or any combination of the like. <strong>The main difference between this type of property and any other rural property can be profit</strong>, as many other rural properties like this are purchased for reasons such as farming, ranching, or timber harvesting.</p>
<p><a href="https://www.landleader.com/what-is-recreational-land">https://www.landleader.com/what-is-recreational-land</a></p>
</blockquote>
<p>This is a pretty common thing in the US South, since we have a big lack of public land and the availability of the public land that is leased by the state and made available for use (mostly Wildlife Management Areas, which are crucial for the wildlife ecosystem of the state!) is under constant <a href="https://www.bizjournals.com/atlanta/news/2022/05/10/19000-acres-northwest-ga.html">threat</a> - and the land that <em>is</em> available usually comes with restrictions. Truly unrestricted land is mostly managed by the <a href="https://www.blm.gov/">Bureau of Land Management</a> and generally unrestricted, but we (the fine state of Georgia) only have a <a href="https://www.backcountrychronicles.com/public-hunting-land/">tiny</a> amount of that.</p>
<p>So, a lot of people - often “hunting clubs”, whether they actually hunt or just like the outdoors - buy their own land and maintain it as best they can.</p>
<p>When it comes to privately owned recreational property for the common person (read; no land barons), almost all of this land is very rural and, unless you are very wealthy, usually <em>relatively</em> small (5 - 50 acres). <em>Because</em> these properties are small, the surrounding land is extremely important - if you buy 5 acres and your neighbor plans to raze 30 to build a 80 house subdivision, your deer might be unhappy (or, like most of these predatory developments, simply cause the deer to disappear, alongside any other form of biodiversity, but I digress).</p>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124193218858.png" alt="A little remaining biodiversity from my back yard, since my neighbors are fortunately still human beings and not property developers, and hence, don&#39;t hate nature."/>
<figcaption>
<p>
A little remaining biodiversity from my back yard, since my neighbors are fortunately still human beings and not property developers, and hence, don&#39;t hate nature.
Credit: Author
</p>
</figcaption>
</figure>
<p>Some of these properties are well documented when they are listed, especially when talking about subdividing large plots and farms into small lots (usually in the 1-4 acre range) for the express purpose of building cabins, farms, or other forms of home sites. These properties are expensive, but pretty easy to handle: You generally get a land survey, connection to the power grid, a septic system (or, at the very least, a percolation test), and a pre-drilled well or even public water. Some of these are really suburban-like subdivisions with extra steps and worse internet (the latest in developer newspeak appears to be “Estate Lots” for this type of development).</p>
<p>This means: Looking at Google Maps usually tells you most of what you know.</p>
<p>The other extreme are properties that have none of that, the buyer pays for a survey, descriptions are done via drone pictures and GPS locations, and existing satellite footage tends to be <em>very</em> low resolution. This means: Looking at Google Maps usually tells you that trees, generally, show up as a green shape on Google Maps.</p>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124181721877.png" alt="At 10m/33ft you get... green blobs."/>
<figcaption>
<p>
At 10m/33ft you get... green blobs.
Credit: Author
</p>
</figcaption>
</figure>
<p>Now, if Google Maps tells you a lot or a little: Before closing on a property, it’s generally a good idea to know <em>as much as possible</em> about it. Meet <code>QGIS</code> and public data.</p>
<h2 id="public-data">Public Data</h2>
<p>A lot of people don’t know this, but basically everything the government does in the United States is public record. This includes small, rural counties in the Southeast. This transparency (if you look for it) is <em>excellent</em> for many reasons, but especially in this case, where we can siphon all this data.</p>
<p>What we’ll build in this article will use a plot of land owned by the US Forest Service in Gordon County, GA, (rather than a private individual) which is actually part of the Chattooga River District, which is some of the actual public land we have. I’d just rather use that than zoom in onto some poor schmuck’s barn to tell you about <code>shp</code> files.</p>
<h3 id="county-gis-maps">County GIS Maps</h3>
<p>Basically every county in the US will give you a result for “<code>$County</code> + GIS” on Google. GIS meaning “Geographic Information System”, of course. These systems, in my localized experience, are usually run by <code>qPublic.net</code> or <code>ArcGIS</code>. They generally work the same - they give you data on what parcels exist, who owns them, how they are zoned, how they are taxed, what their “Fair Market Value” is (which, these days, tends to be far below what they are actually worth), recent sales, permits, and with rural land, often data about soil productivity.</p>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122103825029.png" alt="Inaccessible 35ac of woodland for $68k? Nope, forget it. Not real."/>
<figcaption>
<p>
Inaccessible 35ac of woodland for $68k? Nope, forget it. Not real.
Credit: Gordon County, GA GIS
</p>
</figcaption>
</figure>
<p>Here’s an <a href="https://qpublic.schneidercorp.com/Application.aspx?AppID=629&amp;LayerID=11198&amp;PageTypeID=4&amp;PageID=4598&amp;KeyValue=005%20%20%20%20%20%20%20004">example</a>.</p>
<p>Please note that the friendly warning you get when opening these sites is to be taken seriously - the lines you see are never legal boundaries. You need an actual land survey for that, and we’ll see a bit why that might be in a second.</p>
<p>In addition to that, these systems also give you overlays for school zones, waterways, lakes, rail routes, tax district, urban planning, historical aerial photography and much more. These maps are very handy for homeowners.</p>
<p>Even better, they usually allow selective downloads:</p>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122104523088.png" alt="Spatial selection"/>
<figcaption>
<p>
Spatial selection
Credit: Gordon County, GA GIS
</p>
</figcaption>
</figure>
<p>This data allows rough (again, not legal!) boundaries to understand where a plot of land starts and ends, even though that is often semi-useful without real world reference points. It’s a starting point - and it only works if the land’s planned subdivisions (since few people can buy hundreds of acres, at least here) has already been recorded with the county and reflected in the GIS, which is often a slow process.</p>
<p>In the case of Gordon County, the data came as a <code>kml</code> file, which is basically geospatial XML. Looks a little something like this:</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span><span>13
</span><span>14
</span><span>15
</span><span>16
</span><span>17
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="xml"><span>&lt;kml</span> <span>xmlns=</span><span>&#34;http://www.opengis.net/kml/2.2&#34;</span><span>&gt;</span>
  <span>&lt;Document&gt;</span>
    <span>&lt;name&gt;</span>Gordon County, GA<span>&lt;/name&gt;</span>
    <span>&lt;open&gt;</span>1<span>&lt;/open&gt;</span>
    <span>&lt;Placemark</span> <span>xmlns=</span><span>&#34;&#34;</span><span>&gt;</span>
      <span>&lt;name&gt;</span>001       001<span>&lt;/name&gt;</span>
      <span>&lt;styleUrl&gt;</span>#m_ylw-pushpin<span>&lt;/styleUrl&gt;</span>
      <span>&lt;MultiGeometry&gt;</span>
        <span>&lt;Polygon&gt;</span>
          <span>&lt;outerBoundaryIs&gt;</span>
            <span>&lt;LinearRing&gt;</span>
              <span>&lt;coordinates&gt;</span>-85.0515678459741,34.6157654210014,0.002583347260952 -85.0512951573579,34.6152839041382,0.0025832513347268<span>&lt;/coordinates&gt;</span>
            <span>&lt;/LinearRing&gt;</span>
          <span>&lt;/outerBoundaryIs&gt;</span>
        <span>&lt;/Polygon&gt;</span>
      <span>&lt;/MultiGeometry&gt;</span>
    <span>&lt;/Placemark&gt;</span>
</code></pre></td></tr></tbody></table>
</div>
</div><h3 id="elevation-data">Elevation Data</h3>
<p>If you ever looked for elevation data (say, to gauge if you could build something somewhere), the resolution for these is usually in the hundreds of meters, not in the meter range.</p>
<p>Fortunately, NASA has this wonderful project called “<a href="https://www2.jpl.nasa.gov/srtm/">Shuttle Radar Topography Mission</a>”, a mission that captured world wide, high resolution elevation data, which recently got a data <a href="https://www.earthdata.nasa.gov/esds/competitive-programs/measures/nasadem">overhaul</a> (since the mission flew over 20 years ago!) with higher resolution (1 measurement per meter/3ft) as DEM files (“digital elevation model”).</p>
<p>You can find this data <a href="https://apps.nationalmap.gov/downloader/#/">here</a>. We’ll see in a second how <code>QGIS</code> can help process this into more conventional elevation maps.</p>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122105850719.png" alt="Data availability"/>
<figcaption>
<p>
Data availability
Credit: nationalmap.gov
</p>
</figcaption>
</figure>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122110122645.png" alt="Data selection"/>
<figcaption>
<p>
Data selection
Credit: nationalmap.gov
</p>
</figcaption>
</figure>
<h3 id="base-maps">Base Maps</h3>
<p>Base maps turn a blank coordinate system into what we consider a “map”. They are generally Tile Map Services (TMS), i.e. web APIs. Google Maps Hybrid lives at <code>https://mt1.google.com/vt/lyrs=y&amp;x={x}&amp;y={y}&amp;z={z}</code> and is a good starting point, but many other options are available (e.g., Here, Bing Maps, or Mapbox). Google Maps and others are still amazing resources to take advantage of.</p>
<h3 id="historical-base-maps">Historical Base Maps</h3>
<p>Google Maps is useful, but how about some historical data? Say, you want to know how an area changed over the years and where the journey might go before making a long-term investment? <em>[1]</em></p>
<p>No problem, the Georgia University system has you <a href="https://dlg.usg.edu/records?collection_record_id=gyca_gaphind&amp;f%5Bcounties_facet%5D%5B%5D=Gordon&amp;only_path=true">covered</a>! This data here is a <code>jpeg</code>, but often times those are <code>tiff</code> or even <code>pdfs</code>, usually without geospatial information. No worries, <code>QGIS</code> can help with that. Just search for “historical maps + <code>$county</code>” and chances are something shows up.</p>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122112332217.png" alt="Historical archives online!"/>
<figcaption>
<p>
Historical archives online!
Credit: usg.edu
</p>
</figcaption>
</figure>
<p><em>[1]: That is a use case I’ve had, but we’ll also be using this as a proxy for a survey, or any other non-geotagged image that might exist out there.</em></p>
<h3 id="soil-data">Soil Data</h3>
<p>An honorable mention: The US Soil Survey is very interesting if you’re curious about what “dirt” really means in Country songs. Data can be found <a href="https://websoilsurvey.sc.egov.usda.gov/App/WebSoilSurvey.aspx">here</a>. They explain what the data means <a href="https://www.nrcs.usda.gov/sites/default/files/2022-06/Soil%20Taxonomy.pdf">here</a>.</p>
<p>Most soil on my property is “Morley silt loam”.</p>
<blockquote>
<p>The Morley series consists of very deep, moderately well drained soils that are moderately deep to dense till</p>
<p><a href="https://soilseries.sc.egov.usda.gov/OSD_Docs/M/MORLEY.html">https://soilseries.sc.egov.usda.gov/OSD_Docs/M/MORLEY.html</a></p>
</blockquote>
<p>I will admit that <em>even I</em> don’t find this as deeply fascinating as other topics - and I’m the one writing this article, at the end of the day. But for forestry, sustainable agriculture or even homesteads or gardens, <strong>this data is out there</strong>, accessible, and very well documented. I think that’s the truly fascinating part.</p>
<h2 id="building-a-map-with-qgis">Building a map with QGIS</h2>
<p>Let’s use all that and map out this forest service land.</p>
<h3 id="data-recap">Data Recap</h3>
<p>Thus far, we have -</p>
<ul>
<li><code>kml</code> data for modern lot boundaries</li>
<li><code>dem</code> data for elevation</li>
<li>A <code>TMS</code> API for a base map</li>
<li>A <code>jpeg</code> with a 1993 aerial photography index base map, with no geospatial information</li>
<li>Soil data as <code>shp</code> file</li>
</ul>
<h3 id="creating-a-project-and-selection-a-projection">Creating a project and selection a projection</h3>
<p>The world’s not round (it’s an ellipsoid!), and a flat map doesn’t model the magical sky orb too well, so we’ll chose <code>EPSG:3857: WGS 84 / Pseudo-Mercator</code>. I’ll let the GIS geeks hash out the pros and cons, but <code>EPSG:3857</code> is what basically <em>every</em> online mapping service uses (a coordinate system projected <em>from</em> an ellipsoid <em>onto</em> a flat map), and using this eliminates a need to translate between systems when importing existing data (e.g., <code>GeoPDF</code>s). Here’s a good <a href="https://source.opennews.org/articles/choosing-right-map-projection/">summary</a>.</p>
<h3 id="adding-a-base-map">Adding a base map</h3>
<p><code>QGIS</code> starts with a white void, but we can easily add the base map as tile service:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122110645339.png" alt="image-20230122110645339"/>
</p>
<h3 id="importing-the-county-data">Importing the County data</h3>
<p>We can simply import the <code>kml</code> file we got from the county earlier.</p>
<p>Once this data is added as a layer, we can find basically a copy of the boundary lines from the QPublic interface within <code>QGIS</code>:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122111648725.png" alt="image-20230122111648725"/>
</p>
<p>Layers can also be styled, but we’ll leave it as bright yellow for now. Please note that these tend to not live up to surveys, but we’ll get to that.</p>
<h3 id="switching-out-the-base-layer-georefencing-jpegs-and-pdfs">Switching out the base layer: Georefencing JPEGs and PDFs</h3>
<p>County lines on top of Google Maps is useful, but how about some historical data? No problem, the old aerial photography we’ve downloaded earlier shall serve as a proxy for a scan of a land survey you will need to get as a prospective buyer (or owner), and these tend to not have any geospatial information attached to them. Being able to map a property survey onto the map is extremely helpful, but really, adding coordinates to any form of non-geotagged image-file is useful. This process is known as “<em>georefencing</em>”.</p>
<p>This process works by picking some known coordinates, such as landmarks, county lines, or old roads, and attaching coordinates to them, which then can be used to interpolate the rest of the coordinates on the image. Just make sure that the old thing you pick still exists on a modern map - even county lines can change! The story of <a href="https://en.wikipedia.org/wiki/Milton,_Georgia">this</a> wealthy Atlanta exurb’s county can tell you a <a href="https://en.wikipedia.org/wiki/Milton_County,_Georgia">tale</a> about that.</p>
<p>Since the maps here are low resolution, we can pick some recognizable points (e.g., county lines crossing highways) and grab the coordinates from Google Maps. This works <strong>much</strong> better on smaller images, where you often can pick out bends in roads or other local landmarks to grab relatively accurate coordinates from (or even do this in the field). Remember that the input and target CRS are not the same when doing this from Google Maps.</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122114929306.png" alt="image-20230122114929306"/>
</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122120510070.png" alt="image-20230122120510070"/>
</p>
<p>And we get a neat overlay, albeit as exact as I promised (due to the inaccurate source of coordinates - I used county lines, but the line on the image is probably 100ft wide in real life):</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122120725329.png" alt="image-20230122120725329"/>
</p>
<p>Do, however, keep in mind that the county GIS data is almost always inaccurate to a degree. Here’s a real screenshot from my property survey (which I georefenced very, very carefully) overlayed with the county’s online GIS records:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124194922533.png" alt="image-20230124194922533"/>
</p>
<p>We’ll re-visit “Why online data doesn’t replace a survey” in a bit.</p>
<h3 id="adding-elevation-data">Adding Elevation Data</h3>
<p>Back to building maps, adding the raw DEM files we grabbed earlier provides a heat map of the elevation, which comes in charming grayscale:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124100424881.png" alt="image-20230124100424881"/>
</p>
<p>This doesn’t look like it, but this data is very high reslution.</p>
<p>Fortunately, basically everything in <code>QGIS</code> can bes styled to your heart’s content:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124100827293.png" alt="image-20230124100827293"/>
</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124100840235.png" alt="image-20230124100840235"/>
</p>
<p>This is a nice for an overview of thousands of acres, but since the data here is available with a resolution of <strong>1m</strong>, that’s high enough of a resolution to figure out <strong>individual camp or home sites</strong>.</p>
<p><code>QGIS</code> can use <code>gdal</code> under the hood to turn all these elevation points into human-readable contour lines:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124101448670.png" alt="image-20230124101448670"/>
</p>
<p>Which really runs:</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="bash">gdal_contour -b <span>1</span> -a ELEV -i 10.0 -f <span>&#34;GPKG&#34;</span> USGS_1M_16_x68y382_GA_Statewide_2018_B18_DRRA.tif USGS_1M_16_x67y382_GA_Statewide_2018_B18_DRRA.gpkg
</code></pre></td></tr></tbody></table>
</div>
</div><p>And results in turning the various color shades into distinct elevations:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124102503714.png" alt="image-20230124102503714"/>
</p>
<p>The result can be styled further - we can add <a href="https://opensourceoptions.com/blog/how-to-create-contour-lines-and-labels-with-qgis/">labels</a>, for instance:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124102913862.png" alt="image-20230124102913862"/>
</p>
<p>Or even build hillshade maps:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124103104687.png" alt="image-20230124103104687"/>
</p>
<p>Especially on a zoomed out map, this trumps everything you’ll find on Google Maps:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124103224325.png" alt="image-20230124103224325"/>
</p>
<p>And if you don’t zoom out, you can easily analyze slopes for even smaller lots and gauge e.g. the ability to build, like on this ~10ac lot:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124190232844.png" alt="image-20230124190232844"/>
</p>
<p>I’ve used high-resolution DEM data to find local plateaus that map to former logging sites and roads, which I then proceeded to find in the real world.</p>
<h3 id="soil-data-1">Soil Data</h3>
<p>Soil data is presented to us common peons as <code>shape files</code> - polygons with metadata in this case - but an extensive data model exists <a href="https://www.nrcs.usda.gov/resources/data-and-reports/ssurgo/stats2go-metadata">here</a>. The both good and bad thing is - the data model is very complex, since <code>shp</code> files are a very powerful, but very “low level” tool and format. We’ll focus on one field for simplicity - <code>MUSYM</code> - “the symbol used to identify the soil map unit comp on the soil map” (<a href="https://www.fsl.orst.edu/pnwerc/wrb/metadata/soils/ssurgo.pdf">source</a>).</p>
<p>This data does come with a variety of shape files, including tables we <em>could</em> join the <code>MUKEY</code> (the foregin key) on to get more details, but even if we do that, we still do not have an inherent color scheme based on text based data. We could maybe grab some aggregated data and map it against quantifiers such as “Farmland class”, but I can’t say I’m in the mood to untangle a massive database model if all I care about is “What soil to I stand on”.</p>
<p>Fortunately, <code>QGIS</code> can help us classify data based on standard color scale - in this case, simply lexicographically sorted - and make the map legible:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124175425868.png" alt="image-20230124175425868"/>
</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124175539666.png" alt="image-20230124175539666"/>
</p>
<p>So even if you don’t want to join the different shape files and change the labels to build a super-duper useful, standalone map, <em>features like these make the data useable</em>.</p>
<p>You can still look up stuff such as farmland <a href="https://casoilresource.lawr.ucdavis.edu/soil_web/ssurgo.php?action=explain_mapunit&amp;mukey=562864">class</a> manually online. In this example, the “TaF” in the example above maps to <a href="https://casoilresource.lawr.ucdavis.edu/soil_web/ssurgo.php?action=explain_mapunit&amp;mukey=2023790">this</a> composition. Not every piece of information does necessarily need to be <em>on</em> the map for it to be useful for us!</p>
<h2 id="bring-the-map-to-life-custom-data">Bring the map to life: Custom Data</h2>
<p>This is all very neat (and, needless to say, only the very tip of the Iceberg). But where <code>QGIS</code> really shines is when you combine public data with your <em>own</em>.</p>
<h3 id="add-geospatial-features">Add geospatial features</h3>
<p>Since <code>QGIS</code> simply imports and adds metadata to a bunch of existing geospatial files, it’s very easy to add custom features. Things that I’ve used most are twofold:</p>
<ul>
<li>Points to flag certain geographical features (e.g., where a gate would be or is)</li>
<li>Polygons to mark areas (potential homesites or easements where I’m restricted in what I can do)</li>
</ul>
<p>For instance, we can simply use <code>QGIS</code> to <em>create</em> a shapefile (similar to the soil data - which, of course, can also be read in <code>Python</code> + <code>folium</code>, for instance) with custom metadata:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124104151390.png" alt="image-20230124104151390"/>
</p>
<p>We can then use this to draw custom shapes, like this fictional campsite:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124104328263.png" alt="image-20230124104328263"/>
</p>
<p>Even better, we can auto-generate metadata with a very handy function editor:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124104538988.png" alt="image-20230124104538988"/>
</p>
<p>And create custom annotations via styling:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124105516873.png" alt="image-20230124105516873"/>
</p>
<p>And outline a potential ~3,900sqft camp site on the property.</p>
<h3 id="add-photos">Add Photos</h3>
<p>Most (if not all) modern phones tag GPS information to the pictures they take. While the quality of that GPS information isn’t amazing - more on that in a second - it’s more than good enough to put your pictures on a map.</p>
<p>Take this photo, which I’ve taken in a public WMA and edited the GPS location on, since I don’t happen to have photos from the property we’ve been using here handy:</p>
<figure>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124110821591.png" alt="Beautiful spot in a WMA in North GA."/>
<figcaption>
<p>
Beautiful spot in a WMA in North GA.
Credit: Author
</p>
</figcaption>
</figure>
<p>The metadata looks like this:</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span><span>13
</span><span>14
</span><span>15
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="bash">❯ exiftool IMG_4617.JPEG | grep GPS
GPS Latitude Ref                : North
GPS Longitude Ref               : West
GPS Altitude Ref                : Above Sea Level
GPS Speed Ref                   : km/h
GPS Speed                       : <span>0</span>
GPS Img Direction Ref           : True North
GPS Img Direction               : 237.6976776
GPS Dest Bearing Ref            : True North
GPS Dest Bearing                : 237.6976776
GPS Horizontal Positioning Error: 4.698147517 m
GPS Altitude                    : 898.2 m Above Sea Level
GPS Latitude                    : <span>34</span> deg 32<span>&#39; 6.03&#34; N
</span><span>GPS Longitude                   : 85 deg 5&#39;</span> 16.33<span>&#34; W
</span><span>GPS Position                    : 34 deg 32&#39; 6.03&#34;</span> N, <span>85</span> deg 5<span>&#39;</span> 16.33<span>&#34; W
</span></code></pre></td></tr></tbody></table>
</div>
</div><p>Importing these photos into <code>QGIS</code> is not very spectacular:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124122154153.png" alt="image-20230124122154153"/>
</p>
<p>And simply appends a geo database to the project and adds a point on the map:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124121244143.png" alt="image-20230124121244143"/>
</p>
<h3 id="customize-photos--gps-error">Customize Photos &amp; GPS Error</h3>
<p>But, as we’ve seen before, we can tap into the combination of endless metadata + a capable scripting editor to add -</p>
<ul>
<li>Direction (bearing)</li>
<li>A preview</li>
<li>GPS accuracy</li>
</ul>
<p>Before we can do this, let’s re-format some metadata in the database.</p>
<p>To keep this portable, I’ve come to add something like this as a virtual field, since I’ve had trouble opening files on different computers: <em>[1]</em></p>
<pre><code>&#39;file://&#39; ||   file_path( @project_path)  || &#39;/photos/&#39; || &#34;filename&#34; || &#39;.JPEG&#39;
</code></pre><p>To add a semi-portable path, as the other attributes always refer to an absolute path and we need the <code>file://</code> prefix in a second:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124121804996.png" alt="image-20230124121804996"/>
</p>
<p>Next, we can extract raw EXIF metadata, namely the positioning error:</p>
<pre><code> exif(  replace(&#34;relpath&#34;, &#39;file://&#39;, &#39;&#39;), &#39;Exif.GPSInfo.GPSHPositioningError&#39;)
</code></pre><p>We can then use this data to apply <em>conditional styling</em> and change the format of the dot to something like this:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124191124326.png" alt="image-20230124191124326"/>
</p>
<p>By making the color a function of <code>gps_error</code> (in meters):</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span><span>4
</span><span>5
</span><span>6
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="basic"><span>CASE</span>
<span>  </span><span>WHEN</span><span> </span><span>&#34;gps_error&#34;</span><span> </span><span>&lt;=</span><span> </span><span>3</span><span> </span><span>THEN</span><span> </span><span>color_rgb</span>(<span>0</span>,<span> </span><span>255</span>,<span> </span><span>0</span>)
<span>  </span><span>WHEN</span><span> </span><span>&#34;gps_error&#34;</span><span> </span><span>&gt;</span><span> </span><span>3</span><span> </span><span>AND</span><span> </span><span>&#34;gps_error&#34;</span><span> </span><span>&lt;</span><span> </span><span>8</span><span> </span><span>THEN</span><span> </span><span>color_rgb</span>(<span>255</span>,<span> </span><span>255</span>,<span> </span><span>51</span>)
<span>  </span><span>WHEN</span><span> </span><span>&#34;gps_error&#34;</span><span> </span><span>&gt;=</span><span> </span><span>8</span><span> </span><span>AND</span><span> </span><span>&#34;gps_error&#34;</span><span> </span><span>&lt;</span><span> </span><span>20</span><span> </span><span>THEN</span><span> </span><span>color_rgb</span>(<span>255</span>,<span> </span><span>180</span>,<span> </span><span>51</span>)
<span>  </span><span>ELSE</span><span> </span><span>color_rgb</span>(<span>255</span>,<span> </span><span>0</span>,<span> </span><span>0</span>)
<span>END</span>
</code></pre></td></tr></tbody></table>
</div>
</div><p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230122094857255.png" alt="image-20230122094857255"/>
</p>
<p>And adding an arrow as a function of bearing (so we know which direction the image was taken at, which is incredibly important in dense forest):</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124122847193.png" alt="image-20230124122847193"/>
</p>
<p>While a marker itself is now arguably much more information dense, we still don’t see the picture itself. For that, we can actually - terrifyingly so - use <code>HTML</code> that has access to all our layer metadata:</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="html">&lt;<span>a</span> <span>href</span><span>=</span><span>[%</span> <span>&#34;</span><span>relpath</span><span>&#34;</span> <span>%]</span>&gt;
	&lt;<span>img</span> <span>src</span><span>=</span><span>[%</span> <span>&#34;</span><span>relpath</span><span>&#34;</span> <span>%]</span> <span>style</span><span>=</span><span>&#34;width:400px;height:400px;object-fit:cover;&#34;</span> /&gt;
&lt;/<span>a</span>&gt;
</code></pre></td></tr></tbody></table>
</div>
</div><p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124125721480.png" alt="image-20230124125721480"/>
</p>
<p>This enable a neat tool tip that links to the actual file and the result looks like this on hover:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124125806118.png" alt="image-20230124125806118"/>
</p>
<p>Worth noting, you can also use actual <code>Python</code> scripts at this point to do even more magic, but I haven’t dabbled in that just yet.</p>
<p><em>[1]: Just for completeness&#39; sake - I have the project file on <code>Nextcloud</code> and it usually works like a charm on a synced drive. Paths, however, can be finicky.</em></p>
<h3 id="gps-accuracy-metadata-is-very-helpful">GPS Accuracy Metadata is very helpful</h3>
<p>And finally, here’s a real life example and something that ties this back to the survey comments from earlier - a picture I took marking the boundary of my real property suffering under a bad GPS connection, now being marked as 200+ feet into the neighbor’s lot:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124130020524.png" alt="image-20230124130020524"/>
</p>
<p>But it’s bright red (and I print out the accuracy), so I know to ignore it.</p>
<p>This is a real, re-occurring problem - while GPS is already not accurate by design (something about ICBMs and the Cold War :) ), being in remote areas often takes a toil on the signal your phone can reasonably get. The best accuracy I am able to report is 4 meters, which is simply a circle around the roughly ~2m/6&#39;6&#34; accuracy GPS has with a perfect view on 3+ satellites.</p>
<p>I found a mobile deer stand on my land, which (based on the property boundary markers I’ve seen) should be about ~25ft or so on my property. Accounting for zoom on the camera, I’d expect the GPS marker for the picture to show up ~45ft from the property line.</p>
<p>However, the picture I later saw on mapped <code>QGIS</code> was reported as almost <em>60ft</em> from my property line. This can be the difference between an innocent mistake and a boundary dispute (for the record, not in this <em>particular</em> case - but it is a good example why property surveys are a thing and your phone doesn’t replace those).</p>
<p>However, it makes sense when you consider the self-reported error budget of around 4.6m or 15ft. Assuming I took the picture from 20ft away, we now have a much clearer picture - 25ft on the property + 20ft focal distance + 15ft inaccuracy =&gt; 60ft from the line.</p>
<p>Needless to say, the satellite photos did <em>not</em> help in figuring this out - but GPS accuracy did help tell a story:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124150807963.png" alt="image-20230124150807963"/>
</p>
<h3 id="take-the-map-into-the-field">Take the map into the field</h3>
<p>Last but not least, did you know <code>GeoPDFs</code> are a thing? That’s right, that’s a <code>PDF</code> with geospatial information. <code>QGIS</code> can export them and <a href="https://apps.apple.com/us/app/avenza-maps-offline-mapping/id388424049">Avenza Maps</a> can read them, meaning you can walk around on your maps. I’ve used this to map the property survey to real-world locations (as inaccurate as that might be) in the field:</p>
<p>
<img src="https://avi.im/blag/2023/refactoring-python/docs/image-20230124153043888.png" alt="image-20230124153043888"/>
</p>
<p>And I cannot overstate how useful that is - you can <em>physically</em> walk the map you’ve build, which takes it from just a curiosity, to an essential tool in navigating a pre-planned environment (e.g., we could find that perfect camp site from earlier).</p>
<h2 id="conclusion">Conclusion</h2>
<p>Nothing in this article is purely academic in nature - I use <code>QGIS</code> a <em>ton</em>. Even found a <a href="https://github.com/qgis/QGIS/issues/51480">bug</a> the other day! I’ve mapped out both my recreational property, as well as our neighborhood, including property surveys, flood plains, easement data, and much more.</p>
<p>I also frequently refer to this data when I’m on said property. While buying mine, one of the first things I did was to georefence the property survey draft as <code>GeoPDF</code>, so I could walk boundary lines (again, roughly, not legally speaking :) ) before the surveyors put down the actual survey markers.</p>
<p>Even better, I basically find new datasets I find interesting on a weekly basis and play around with <code>QGIS</code> to see if I can integrate them. I will admit, not all of this is useful and maybe I should spend my time learning <code>Rust</code> instead - yes, light pollution tends to be less then in a big city, I guess I could just look out the window - but it’s still absolutely <em>fascinating</em>.</p>
<p>More than that, as a Data Engineer by day, <code>QGIS</code> + geospatial data is just like doing my job and using related tools that end-users might use (think <code>Apache Trino</code>), but different enough to be interesting.</p>
<p>You’re dealing with huge volumes (<code>1.7GiB</code> for the <em>tiny</em> map in this article!), a wide variety of formats (see above), normalized data (geospatial joins across shapefiles), unstructured data (photos), semi-structured data (metadata), data quality issues (see above for that whole spiel about GPS accuracy), and you’re very much linked to the real world. It’s a fun challenge with much more tooling support, but just as much hidden complexity as you’d have, say, screaming at <code>Kafka Connect</code> during the day.</p>
<p><em>All development and benchmarking was done under GNU/Linux [PopOS! 22.04 on Kernel 6.0.12] with 12 Intel i7-9750H vCores @ 4.5Ghz and 32GB RAM on a 2019 System76 Gazelle Laptop, using</em> <em><code>QGIS</code></em> <em><code>3.28</code>.</em></p>
</div><p>
Next time, we&#39;ll talk about <i>&#34;Emoji-Driven Programming: Our Startup tried it (and we succeeded)&#34;</i>
</p></div>
  </body>
</html>
