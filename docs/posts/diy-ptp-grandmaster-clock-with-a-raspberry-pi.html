<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.jeffgeerling.com/blog/2025/diy-ptp-grandmaster-clock-raspberry-pi">Original</a>
    <h1>DIY PTP Grandmaster Clock with a Raspberry Pi</h1>
    
    <div id="readability-page-1" class="page"><div><blockquote>
  <p><strong>tl;dr</strong>: I set up an open source <a href="https://github.com/geerlingguy/time-pi">Time Pi project</a> to build a stratum 1 PTP and NTP timeserver using a Raspberry Pi.</p>
</blockquote>

<p>Time is important to modern society, and most of us have a clock on our wrist that&#39;s more accurate than at any time in human history. But <em>highly precise</em> time is important in many industries, especially robotics, finance, and media production. And with tech like VR working its way into homes, precise time may become more important <em>there</em>, too.</p>

<p>The timing industry has many solutions for &#39;grandmaster&#39; clocks, which take in highly accurate time from GPS, GNSS, or other atomic-clock-backed time sources, and distribute it to local networks with <em>extreme</em> precision—down to the nanosecond range—using PTP.</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/time-pi-raspberry-pi-clock-masterclock-mini-rack.jpeg" width="700" height="394" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-3a21eb4e-9957-4419-9c46-9474aa878893" data-insert-attach="{&#34;id&#34;:&#34;3a21eb4e-9957-4419-9c46-9474aa878893&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="Time Pi - Raspberry Pi Time Grandmaster Clock in mini rack with Masterclock NTP clock"/></p>

<p>Historically, setting up a DIY PTP grandmaster clock server was a painful and expensive endeavor, pricing out most hobbyists. So I&#39;m introducing a project that&#39;s been in the works for some time: <a href="https://github.com/geerlingguy/time-pi">Time Pi</a>, a stratum 1 PTP and NTP timeserver based on a Raspberry Pi 5.</p>

<p>In the picture above, it is installed inside a <a href="https://github.com/JaredC01/LabStack">LabStack module</a> inside a 3U RackMate TT (an as-yet-unreleased version of DeskPi&#39;s mini racks—I&#39;m working with them on ironing out the design). I have powered it using a PoE to USB-C power splitter, from my <a href="https://amzn.to/4jbsD9B">GigaPlus 2.5 Gbps PoE+ switch</a>.</p>

<h2>Video</h2>

<p>I&#39;m lucky to live in the same city as <a href="https://www.masterclock.com">Masterclock</a>, a timing solutions company that&#39;s been manufacturing time servers and clocks for most of my life.</p>

<p>I&#39;ve been discussing my project with them for over a year, and they provided me two PoE-powered NTP clocks for the studio, and for my testing with the Time Pi (the analog/digital hybrid clock is pictured above, and a 1U rackmount clock is pictured below):</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/time-pi-1u-masterclock-rackmount-clock.jpeg" width="700" height="394" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-6822805d-4338-4642-bfee-4e1bc1684fbc" data-insert-attach="{&#34;id&#34;:&#34;6822805d-4338-4642-bfee-4e1bc1684fbc&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="Time Pi - 1U Masterclock rackmount clock"/></p>

<p>Dr. Demetrios Matsakis, formerly the Chief Scientist for the US Naval Observatory (which helps coordinate the time in UTC!), is now Masterclock&#39;s Chief Scientist. He and John Clark (the CTO) were gracious enough to visit my studio and chat with me about <em>their</em> new time server, the GMR6000, and about time and DIY solutions.</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/jeff-geerling-masterclock-demetrios-matsakis-studio.jpeg" width="700" height="500" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-87684044-97ff-4c85-9c3e-8c5832102da6" data-insert-attach="{&#34;id&#34;:&#34;87684044-97ff-4c85-9c3e-8c5832102da6&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="Dr. Demetrios Matsakis with Jeff Geerling in studio"/></p>

<p>(Special thanks to <a href="https://www.superdogco.com">Dave Bour</a> for providing the photo above.)</p>

<p>A video I published on my YouTube channel includes my conversations with them (and a lot more detail about the Time Pi). You can watch it below:</p>

<div>
<p><iframe src="https://www.youtube.com/embed/zT71UvUxhjU" frameborder="0" allowfullscreen=""></iframe></p>
</div>

<h2>Time Pi</h2>

<p>Assuming you don&#39;t want to watch the full video, I&#39;ll also describe the hardware itself here—as it is built around the <a href="https://www.tindie.com/products/timeappliances/timehat-i226-nic-with-pps-inout-for-rpi5/">TimeHAT from TimeAppliances</a>.</p>

<p>The TimeHAT is a $200 HAT for the Pi 5 which includes an Intel i226 2.5 Gbps NIC with PTP hardware timestamping support. There are two SMA connectors for PPS in/out (configurable), an extra U.fl connector to another PPS port on the NIC, and an M.2 slot routed for a custom GPS module.</p>

<p><img src="https://www.jeffgeerling.com/sites/default/files/images/time-pi-alone.jpeg" width="700" height="394" data-insert-type="image" data-entity-type="file" data-entity-uuid="insert-image-58a559fe-81f2-4305-afd2-1c4b5ca56833" data-insert-attach="{&#34;id&#34;:&#34;58a559fe-81f2-4305-afd2-1c4b5ca56833&#34;,&#34;attributes&#34;:{&#34;alt&#34;:[&#34;alt&#34;,&#34;description&#34;],&#34;title&#34;:[&#34;title&#34;]}}" alt="Time Pi TimeHAT with GPS Module in Mini Rack LabStack module"/></p>

<p>The slot is a little interesting, it&#39;s described as an &#34;OCP M.2 GNSS 2242 Slot&#34;, and it follows the <a href="https://www.opencompute.org/documents/m-2-sync-module-ocp-base-specification-1-1-pdf">M2 Sync Module Form Factor</a> from the Open Compute Project. Right now I can only find one commercially-available option: <a href="https://www.tindie.com/products/timeappliances/ocp-m2-neo-m9n-gnss/">OCP M.2 Neo-M9N GNSS</a>, a $195 add-on with a timing-focused u-blox GPS module.</p>

<p>The HAT interfaces with the Pi 5 through both PCIe (for the Intel i226 NIC), and GPIO (for GPS communications and configuration).</p>

<p>I <em>have</em> had some hardware issues with the i226 NIC, but it doesn&#39;t seem like those issues are related to either the TimeHAT <em>or</em> the Pi, but rather, Intel&#39;s Linux drivers. It seems like both the i225 and i226 have various strange issues, and the main one I ran into is <a href="https://github.com/geerlingguy/time-pi/issues/3">it <em>won&#39;t work at 2.5 Gbps, but does at 1 Gbps</em></a>.</p>

<p>On the software side, I configure everything (Chrony, NTP, and PTP) with Ansible. Raspberry Pi OS / Debian is the base OS, which makes configuring all the appropriate software easy. Linux has a pretty robust set of timing-related libraries and packages, especially for PTP.</p>

<p>I won&#39;t go through the whole setup process in this post—for that, visit the <a href="https://github.com/geerlingguy/time-pi">time-pi repository</a>.</p>

<h2>Conclusion</h2>

<p>My first post and video is about the Time Pi hardware and comparing it to some commercial offerings. It&#39;s been running stably as an NTP time server in my studio for months now, and I&#39;ve even gotten GPS to work for timing when used with a battery near one of the exterior walls.</p>

<p>But I will be following up with more timing-related adventures (to be documented here and on YouTube):</p>

<ul>
<li>Permanently installing an outdoor GPS antenna with my Dad, and exploring ways to combat GPS jamming</li>
<li>Configuring PTP and testing sync across a variety of target devices (including a consumer Intel motherboard!)</li>
<li>Testing various clock options, including diving deeper into Masterclock&#39;s own (pictured above)</li>
<li>Making another attempt at getting the Pi to interface with the open source Time Card, with it&#39;s chip-scale atomic clock (CSAC) for <em>seriously overkill</em> holdover performance</li>
<li>(Hopefully) building an ensemble clock with Masterclock to see if we can improve overall timing accuracy combining both our clocks together.</li>
</ul></div></div>
  </body>
</html>
