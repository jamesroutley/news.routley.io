<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/m31coding/fuzzy-search">Original</a>
    <h1>Show HN: Frontend Fuzzy Search</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">@m31coding/fuzzy-search is a frontend library for searching objects with ids (entities) by their names and features (terms). It is</p>
<ul dir="auto">
<li>Fast: A query takes usually well below 10 ms.</li>
<li>Accurate: Powered by n-grams with a novel approach of character sorting.</li>
<li>Multilingual: The language-agnostic design of the algorithm enables operation across all languages.</li>
<li>Flexible: Entities and their terms can be inserted, updated and removed.</li>
<li>Reliable: Well tested standalone library with no dependencies.</li>
</ul>
<p dir="auto"><a href="https://github.com/m31coding/fuzzy-search/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/1f0784ee36fd7ec3321a7800da32afc06aa5d18a9af8134252002a53eb61af36/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d627269676874677265656e" alt="license" data-canonical-src="https://img.shields.io/badge/license-MIT-brightgreen"/></a>
<a href="https://www.npmjs.com/package/@m31coding/fuzzy-search" rel="nofollow"><img src="https://camo.githubusercontent.com/143a217bdf980a3cca34404168b92057306c717499596e2d3aab5aacc7cda799/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f2534306d3331636f64696e6725324666757a7a792d736561726368" alt="npm version" data-canonical-src="https://img.shields.io/npm/v/%40m31coding%2Ffuzzy-search"/></a>
<a href="https://github.com/m31coding/fuzzy-search/actions/workflows/ci.yml"><img src="https://github.com/m31coding/fuzzy-search/actions/workflows/ci.yml/badge.svg" alt="CI"/></a>
<a href="https://www.m31coding.com" rel="nofollow"><img src="https://camo.githubusercontent.com/6f9ed0b529ecc7f411960e196b3c580bab8338edeb22e25ad8ec1316c8f21708/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7777772d6d3331636f64696e672e636f6d2d333433343542" alt="m31coding" data-canonical-src="https://img.shields.io/badge/www-m31coding.com-34345B"/></a>
<a href="https://www.youtube.com/channel/UC6CZ_Bcyql1kfHZvx9W85mA" rel="nofollow"><img src="https://camo.githubusercontent.com/f67aeb72982d6ac0d6827f0807f53a9474396af6ad0fb7edd035a944f0591bad/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f796f75747562652d6b6576696e25323073636861616c2d4646303030302e737667" alt="youtube" data-canonical-src="https://img.shields.io/badge/youtube-kevin%20schaal-FF0000.svg"/></a>
<a href="https://X.com/m31coding" rel="nofollow"><img src="https://camo.githubusercontent.com/d63654b58869add2280864365ae6cc287a78e629638bdda9e8d61bdb73a001c2/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f582d406d3331636f64696e672d3066313431392e737667" alt="X" data-canonical-src="https://img.shields.io/badge/X-@m31coding-0f1419.svg"/></a></p>
<ul dir="auto">
<li><a href="https://www.m31coding.com/blog/fuzzy-search.html" rel="nofollow">Related blog post</a></li>
<li><a href="https://www.m31coding.com/fuzzy-search-demo.html" rel="nofollow"><strong>Try the demo</strong></a></li>
</ul>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/m31coding/fuzzy-search/blob/main/media/preview.gif"><img src="https://github.com/m31coding/fuzzy-search/raw/main/media/preview.gif" alt="fuzzy-search-preview" data-animated-image=""/></a></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-installation" aria-hidden="true" tabindex="-1" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">Install the package via npm:</p>
<div dir="auto" data-snippet-clipboard-copy-content="npm install @m31coding/fuzzy-search"><pre>npm install @m31coding/fuzzy-search</pre></div>
<p dir="auto">The following files are available in the dist folder for different use cases:</p>
<ul dir="auto">
<li>fuzzy-search.module.js (ESM)</li>
<li>fuzzy-search.cjs (CommonJS)</li>
<li>fuzzy-search.umd.js (UMD)</li>
<li>fuzzy-search.modern.js (Modern mode)</li>
<li>fuzzy-search.d.ts (TypeScript definitions)</li>
</ul>
<p dir="auto">This library uses <a href="https://github.com/developit/microbundle">microbundle</a>. Please consult their documentation for more information on how to use the different files.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage" aria-hidden="true" tabindex="-1" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">The most important definitions can be found in the folder <a href="https://github.com/m31coding/fuzzy-search/blob/main/src/interfaces">interfaces</a>. For creating a searcher, use the <a href="https://github.com/m31coding/fuzzy-search/blob/main/src/searcher-factory.ts">SearcherFactory</a>.
Here is a basic usage example (esm module syntax):</p>
<div dir="auto" data-snippet-clipboard-copy-content="import * as fuzzySearch from &#39;./path/to/fuzzy-search.module.js&#39;;

const searcher = fuzzySearch.SearcherFactory.createDefaultSearcher();

const persons = [
  { id: 23501, firstName: &#39;Alice&#39;, lastName: &#39;King&#39; },
  { id: 99234, firstName: &#39;Bob&#39;, lastName: &#39;Bishop&#39; },
  { id: 5823, firstName: &#39;Carol&#39;, lastName: &#39;Queen&#39; },
  { id: 11923, firstName: &#39;Charlie&#39;, lastName: &#39;Rook&#39; }
];

const indexingMeta = searcher.indexEntities(
  persons,
  (e) =&gt; e.id,
  (e) =&gt; [e.firstName, e.lastName, `${e.firstName} ${e.lastName}`]
);
console.dir(indexingMeta);
/* {
  &#34;entries&#34;: {
    &#34;numberOfInvalidTerms&#34;: 0,
    &#34;numberOfDistinctTerms&#34;: 12,
    &#34;normalizationDuration&#34;: 0,
    &#34;numberOfSurrogateCharacters&#34;: 0,
    &#34;indexingDuration&#34;: 1
  }
} */

const result = searcher.getMatches(new fuzzySearch.Query(&#39;alice kign&#39;));
console.dir(result);
/* {
  &#34;matches&#34;: [
    {
      &#34;entity&#34;: {
        &#34;id&#34;: 23501,
        &#34;firstName&#34;: &#34;Alice&#34;,
        &#34;lastName&#34;: &#34;King&#34;
      },
      &#34;quality&#34;: 0.8636363636363635,
      &#34;matchedString&#34;: &#34;Alice King&#34;
    }
  ],
  &#34;query&#34;: {
    &#34;string&#34;: &#34;alice kign&#34;,
    &#34;topN&#34;: 10,
    &#34;minQuality&#34;: 0.3
  },
  &#34;meta&#34;: {
    &#34;entries&#34;: {
      &#34;queryDuration&#34;: 0
    }
  }
} */

const removalResult = searcher.removeEntities([99234, 5823]);
console.dir(removalResult);
/* {
  &#34;removedEntities&#34;: [
    99234,
    5823
  ],
  &#34;meta&#34;: {
    &#34;entries&#34;: {
      &#34;removalDuration&#34;: 0
    }
  }
} */

const persons2 = [
  { id: 723, firstName: &#39;David&#39;, lastName: &#39;Knight&#39; }, // new
  { id: 2634, firstName: &#39;Eve&#39;, lastName: &#39;Pawn&#39; }, // new
  { id: 23501, firstName: &#39;Allie&#39;, lastName: &#39;King&#39; }, // updated
  { id: 11923, firstName: &#39;Charles&#39;, lastName: &#39;Rook&#39; } // updated
];

const upsertMeta = searcher.upsertEntities(
  persons2,
  (e) =&gt; e.id,
  (e) =&gt; [e.firstName, e.lastName, `${e.firstName} ${e.lastName}`]
);
console.dir(upsertMeta);
/* {
  &#34;entries&#34;: {
    &#34;numberOfInvalidTerms&#34;: 0,
    &#34;numberOfDistinctTerms&#34;: 12,
    &#34;normalizationDuration&#34;: 0,
    &#34;numberOfSurrogateCharacters&#34;: 0,
    &#34;upsertDuration&#34;: 0
  }
} */

const result2 = searcher.getMatches(new fuzzySearch.Query(&#39;allie&#39;));
console.dir(result2);
/* {
  &#34;matches&#34;: [
    {
      &#34;entity&#34;: {
        &#34;id&#34;: 23501,
        &#34;firstName&#34;: &#34;Allie&#34;,
        &#34;lastName&#34;: &#34;King&#34;
      },
      &#34;quality&#34;: 1,
      &#34;matchedString&#34;: &#34;Allie&#34;
    }
  ],
  &#34;query&#34;: {
    &#34;string&#34;: &#34;allie&#34;,
    &#34;topN&#34;: 10,
    &#34;minQuality&#34;: 0.3
  },
  &#34;meta&#34;: {
    &#34;entries&#34;: {
      &#34;queryDuration&#34;: 0
    }
  }
} */"><pre><span>import</span> <span>*</span> <span>as</span> <span>fuzzySearch</span> <span>from</span> <span>&#39;./path/to/fuzzy-search.module.js&#39;</span><span>;</span>

<span>const</span> <span>searcher</span> <span>=</span> <span>fuzzySearch</span><span>.</span><span>SearcherFactory</span><span>.</span><span>createDefaultSearcher</span><span>(</span><span>)</span><span>;</span>

<span>const</span> <span>persons</span> <span>=</span> <span>[</span>
  <span>{</span> <span>id</span>: <span>23501</span><span>,</span> <span>firstName</span>: <span>&#39;Alice&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;King&#39;</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span>: <span>99234</span><span>,</span> <span>firstName</span>: <span>&#39;Bob&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;Bishop&#39;</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span>: <span>5823</span><span>,</span> <span>firstName</span>: <span>&#39;Carol&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;Queen&#39;</span> <span>}</span><span>,</span>
  <span>{</span> <span>id</span>: <span>11923</span><span>,</span> <span>firstName</span>: <span>&#39;Charlie&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;Rook&#39;</span> <span>}</span>
<span>]</span><span>;</span>

<span>const</span> <span>indexingMeta</span> <span>=</span> <span>searcher</span><span>.</span><span>indexEntities</span><span>(</span>
  <span>persons</span><span>,</span>
  <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>e</span><span>.</span><span>id</span><span>,</span>
  <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>[</span><span>e</span><span>.</span><span>firstName</span><span>,</span> <span>e</span><span>.</span><span>lastName</span><span>,</span> <span>`<span><span>${</span><span>e</span><span>.</span><span>firstName</span><span>}</span></span> <span><span>${</span><span>e</span><span>.</span><span>lastName</span><span>}</span></span>`</span><span>]</span>
<span>)</span><span>;</span>
<span>console</span><span>.</span><span>dir</span><span>(</span><span>indexingMeta</span><span>)</span><span>;</span>
<span>/* {</span>
<span>  &#34;entries&#34;: {</span>
<span>    &#34;numberOfInvalidTerms&#34;: 0,</span>
<span>    &#34;numberOfDistinctTerms&#34;: 12,</span>
<span>    &#34;normalizationDuration&#34;: 0,</span>
<span>    &#34;numberOfSurrogateCharacters&#34;: 0,</span>
<span>    &#34;indexingDuration&#34;: 1</span>
<span>  }</span>
<span>} */</span>

<span>const</span> <span>result</span> <span>=</span> <span>searcher</span><span>.</span><span>getMatches</span><span>(</span><span>new</span> <span>fuzzySearch</span><span>.</span><span>Query</span><span>(</span><span>&#39;alice kign&#39;</span><span>)</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>dir</span><span>(</span><span>result</span><span>)</span><span>;</span>
<span>/* {</span>
<span>  &#34;matches&#34;: [</span>
<span>    {</span>
<span>      &#34;entity&#34;: {</span>
<span>        &#34;id&#34;: 23501,</span>
<span>        &#34;firstName&#34;: &#34;Alice&#34;,</span>
<span>        &#34;lastName&#34;: &#34;King&#34;</span>
<span>      },</span>
<span>      &#34;quality&#34;: 0.8636363636363635,</span>
<span>      &#34;matchedString&#34;: &#34;Alice King&#34;</span>
<span>    }</span>
<span>  ],</span>
<span>  &#34;query&#34;: {</span>
<span>    &#34;string&#34;: &#34;alice kign&#34;,</span>
<span>    &#34;topN&#34;: 10,</span>
<span>    &#34;minQuality&#34;: 0.3</span>
<span>  },</span>
<span>  &#34;meta&#34;: {</span>
<span>    &#34;entries&#34;: {</span>
<span>      &#34;queryDuration&#34;: 0</span>
<span>    }</span>
<span>  }</span>
<span>} */</span>

<span>const</span> <span>removalResult</span> <span>=</span> <span>searcher</span><span>.</span><span>removeEntities</span><span>(</span><span>[</span><span>99234</span><span>,</span> <span>5823</span><span>]</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>dir</span><span>(</span><span>removalResult</span><span>)</span><span>;</span>
<span>/* {</span>
<span>  &#34;removedEntities&#34;: [</span>
<span>    99234,</span>
<span>    5823</span>
<span>  ],</span>
<span>  &#34;meta&#34;: {</span>
<span>    &#34;entries&#34;: {</span>
<span>      &#34;removalDuration&#34;: 0</span>
<span>    }</span>
<span>  }</span>
<span>} */</span>

<span>const</span> <span>persons2</span> <span>=</span> <span>[</span>
  <span>{</span> <span>id</span>: <span>723</span><span>,</span> <span>firstName</span>: <span>&#39;David&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;Knight&#39;</span> <span>}</span><span>,</span> <span>// new</span>
  <span>{</span> <span>id</span>: <span>2634</span><span>,</span> <span>firstName</span>: <span>&#39;Eve&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;Pawn&#39;</span> <span>}</span><span>,</span> <span>// new</span>
  <span>{</span> <span>id</span>: <span>23501</span><span>,</span> <span>firstName</span>: <span>&#39;Allie&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;King&#39;</span> <span>}</span><span>,</span> <span>// updated</span>
  <span>{</span> <span>id</span>: <span>11923</span><span>,</span> <span>firstName</span>: <span>&#39;Charles&#39;</span><span>,</span> <span>lastName</span>: <span>&#39;Rook&#39;</span> <span>}</span> <span>// updated</span>
<span>]</span><span>;</span>

<span>const</span> <span>upsertMeta</span> <span>=</span> <span>searcher</span><span>.</span><span>upsertEntities</span><span>(</span>
  <span>persons2</span><span>,</span>
  <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>e</span><span>.</span><span>id</span><span>,</span>
  <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>[</span><span>e</span><span>.</span><span>firstName</span><span>,</span> <span>e</span><span>.</span><span>lastName</span><span>,</span> <span>`<span><span>${</span><span>e</span><span>.</span><span>firstName</span><span>}</span></span> <span><span>${</span><span>e</span><span>.</span><span>lastName</span><span>}</span></span>`</span><span>]</span>
<span>)</span><span>;</span>
<span>console</span><span>.</span><span>dir</span><span>(</span><span>upsertMeta</span><span>)</span><span>;</span>
<span>/* {</span>
<span>  &#34;entries&#34;: {</span>
<span>    &#34;numberOfInvalidTerms&#34;: 0,</span>
<span>    &#34;numberOfDistinctTerms&#34;: 12,</span>
<span>    &#34;normalizationDuration&#34;: 0,</span>
<span>    &#34;numberOfSurrogateCharacters&#34;: 0,</span>
<span>    &#34;upsertDuration&#34;: 0</span>
<span>  }</span>
<span>} */</span>

<span>const</span> <span>result2</span> <span>=</span> <span>searcher</span><span>.</span><span>getMatches</span><span>(</span><span>new</span> <span>fuzzySearch</span><span>.</span><span>Query</span><span>(</span><span>&#39;allie&#39;</span><span>)</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>dir</span><span>(</span><span>result2</span><span>)</span><span>;</span>
<span>/* {</span>
<span>  &#34;matches&#34;: [</span>
<span>    {</span>
<span>      &#34;entity&#34;: {</span>
<span>        &#34;id&#34;: 23501,</span>
<span>        &#34;firstName&#34;: &#34;Allie&#34;,</span>
<span>        &#34;lastName&#34;: &#34;King&#34;</span>
<span>      },</span>
<span>      &#34;quality&#34;: 1,</span>
<span>      &#34;matchedString&#34;: &#34;Allie&#34;</span>
<span>    }</span>
<span>  ],</span>
<span>  &#34;query&#34;: {</span>
<span>    &#34;string&#34;: &#34;allie&#34;,</span>
<span>    &#34;topN&#34;: 10,</span>
<span>    &#34;minQuality&#34;: 0.3</span>
<span>  },</span>
<span>  &#34;meta&#34;: {</span>
<span>    &#34;entries&#34;: {</span>
<span>      &#34;queryDuration&#34;: 0</span>
<span>    }</span>
<span>  }</span>
<span>} */</span></pre></div>
<p dir="auto">If the data terms contain characters and strings in non-latin scripts (such as Arabic, Cyrillic, Greek, Han, ... see also <a href="https://en.wikipedia.org/wiki/ISO_15924" rel="nofollow">ISO 15924</a>), the default configuration must be adjusted before creating the searcher:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const config = fuzzySearch.Config.createDefaultConfig();
config.normalizerConfig.allowCharacter = (_c) =&gt; true;
const searcher = fuzzySearch.SearcherFactory.createSearcher(config);"><pre><span>const</span> <span>config</span> <span>=</span> <span>fuzzySearch</span><span>.</span><span>Config</span><span>.</span><span>createDefaultConfig</span><span>(</span><span>)</span><span>;</span>
<span>config</span><span>.</span><span>normalizerConfig</span><span>.</span><span>allowCharacter</span> <span>=</span> <span>(</span><span>_c</span><span>)</span> <span>=&gt;</span> <span>true</span><span>;</span>
<span>const</span> <span>searcher</span> <span>=</span> <span>fuzzySearch</span><span>.</span><span>SearcherFactory</span><span>.</span><span>createSearcher</span><span>(</span><span>config</span><span>)</span><span>;</span></pre></div>
<p dir="auto">Moreover, if your dataset is large (&gt; 100.000 terms), you may index the searcher in a web worker to avoid blocking the main thread, as shown in <a href="https://github.com/m31coding/fuzzy-search/blob/main/usage-examples/worker">this</a> usage example.</p>
<p dir="auto">If your objects cannot be identified by a unique id, you can also pass <code>(e) =&gt; e</code> for the <code>getId</code> parameter of both <code>indexEntities</code> and <code>upsertEntities</code>. Just be aware that the <code>getId</code> function is used for equality checks and the creation of Maps, particularly utilized by the <code>upsertEntities</code> and <code>removeEntities</code> methods. For indexing plain strings, you can call:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const indexingMeta = searcher.indexEntities(
  [&#34;Alice&#34;, &#34;Bob&#34;, &#34;Carol&#34;, &#34;Charlie&#34;],
  (e) =&gt; e,
  (e) =&gt; [e]
);"><pre><span>const</span> <span>indexingMeta</span> <span>=</span> <span>searcher</span><span>.</span><span>indexEntities</span><span>(</span>
  <span>[</span><span>&#34;Alice&#34;</span><span>,</span> <span>&#34;Bob&#34;</span><span>,</span> <span>&#34;Carol&#34;</span><span>,</span> <span>&#34;Charlie&#34;</span><span>]</span><span>,</span>
  <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>e</span><span>,</span>
  <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>[</span><span>e</span><span>]</span>
<span>)</span><span>;</span></pre></div>
<p dir="auto">To try the demo and usage examples locally, clone the repository and execute the commands:</p>
<div dir="auto" data-snippet-clipboard-copy-content="npm install
npm run build"><pre>npm install
npm run build</pre></div>
<p dir="auto">To proceed, open the html file of interest (e.g., <code>fuzzy-search-demo.html</code>) with a local webserver. If you use VS Code, you may use the <a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer" rel="nofollow">Live Server extension</a> for this purpose.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-upsert-and-removal" aria-hidden="true" tabindex="-1" href="#upsert-and-removal"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Upsert and removal</h2>
<p dir="auto">This library was optimized for fast querying. At its core, a searcher employs integer indexes that can not be easily updated. The upsert operation is implemented by reindexing a secondary searcher, which is initially empty. Removal is implemented by blacklisting entities.</p>
<p dir="auto">Consequently, repeated upsert operations with a large number of entities may be costly. In such cases, consider reindexing the searcher from scratch by calling the <code>index</code> method eventually.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-normalization" aria-hidden="true" tabindex="-1" href="#normalization"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Normalization</h2>
<p dir="auto">Query strings and data terms are normalized in the following normalization pipeline (order matters):</p>
<ul dir="auto">
<li>Null and undefined strings are replaced by an empty string.</li>
<li>Strings are lowercased and normalized to NFKC.</li>
<li>Replacements are applied to characters such as å -&gt; aa, æ -&gt; ae. See also <a href="https://github.com/m31coding/fuzzy-search/blob/main/src/normalization/latin-replacements.ts">Latin replacements</a>.</li>
<li>Strings are normalized to NFKD.</li>
<li>Space equivalent characters are replaced by a space.</li>
<li>Surrogate characters, padding characters and other non-allowed characters are removed.</li>
<li>Strings are padded to the left, right and in the middle (replacement of spaces).</li>
</ul>
<blockquote>
<p dir="auto">Normalization to NFKC decomposes characters by compatibility, then re-composes them by canonical equivalence. This ensures that the characters in the replacement table always match. Normalization to NFKD decomposes the characters by compatibility but does not re-compose them, allowing undesired characters to be removed thereafter.</p>
</blockquote>
<p dir="auto">The default normalizer config adopts the following values:</p>
<div dir="auto" data-snippet-clipboard-copy-content="let paddingLeft = &#39;$$&#39;;
let paddingRight = &#39;!&#39;;
let paddingMiddle = &#39;!$$&#39;;
let replacements = [fuzzySearch.LatinReplacements.Value];
let spaceEquivalentCharacters = new Set([&#39;_&#39;, &#39;-&#39;, &#39;–&#39;, &#39;/&#39;, &#39;,&#39;, &#39;\t&#39;]);
let treatCharacterAsSpace = (c) =&gt; spaceEquivalentCharacters.has(c);
let allowCharacter = (c) =&gt; {
  return fuzzySearch.StringUtilities.isAlphanumeric(c);
};"><pre><span>let</span> <span>paddingLeft</span> <span>=</span> <span>&#39;$$&#39;</span><span>;</span>
<span>let</span> <span>paddingRight</span> <span>=</span> <span>&#39;!&#39;</span><span>;</span>
<span>let</span> <span>paddingMiddle</span> <span>=</span> <span>&#39;!$$&#39;</span><span>;</span>
<span>let</span> <span>replacements</span> <span>=</span> <span>[</span><span>fuzzySearch</span><span>.</span><span>LatinReplacements</span><span>.</span><span>Value</span><span>]</span><span>;</span>
<span>let</span> <span>spaceEquivalentCharacters</span> <span>=</span> <span>new</span> <span>Set</span><span>(</span><span>[</span><span>&#39;_&#39;</span><span>,</span> <span>&#39;-&#39;</span><span>,</span> <span>&#39;–&#39;</span><span>,</span> <span>&#39;/&#39;</span><span>,</span> <span>&#39;,&#39;</span><span>,</span> <span>&#39;\t&#39;</span><span>]</span><span>)</span><span>;</span>
<span>let</span> <span>treatCharacterAsSpace</span> <span>=</span> <span>(</span><span>c</span><span>)</span> <span>=&gt;</span> <span>spaceEquivalentCharacters</span><span>.</span><span>has</span><span>(</span><span>c</span><span>)</span><span>;</span>
<span>let</span> <span>allowCharacter</span> <span>=</span> <span>(</span><span>c</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>fuzzySearch</span><span>.</span><span>StringUtilities</span><span>.</span><span>isAlphanumeric</span><span>(</span><span>c</span><span>)</span><span>;</span>
<span>}</span><span>;</span></pre></div>
<p dir="auto">With this pipeline and configuration, the string <code>Thanh Việt Đoàn</code> is normalized to <code>thanh viet doan</code> before padding. With padding applied, it becomes <code>$$thanh!$$viet!$$doan!</code>. The choice of the padding is explained in the next section.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-sorted-n-grams" aria-hidden="true" tabindex="-1" href="#sorted-n-grams"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Sorted n-grams</h2>
<p dir="auto">The general idea of n-grams and the sorting trick is outlined in this <a href="https://www.m31coding.com/blog/fuzzy-search.html" rel="nofollow">blog post</a>. In short, the data terms and the query string are broken down into 3-grams, e.g. the string <code>$$sarah!</code> becomes:</p>
<div data-snippet-clipboard-copy-content="$$s, $sa, sar, ara, rah, ah!"><pre lang="text"><code>$$s, $sa, sar, ara, rah, ah!
</code></pre></div>
<p dir="auto">The more common 3-grams between the query and the term, the higher the quality of the match. By padding the front with two characters, and the back with one character, more weight is given to the beginning of the string.</p>
<p dir="auto">In addition, the characters of the 3-grams that don&#39;t contain &#39;$&#39; are sorted:</p>
<div data-snippet-clipboard-copy-content="$$s, $sa, ars, aar, ahr, !ah"><pre lang="text"><code>$$s, $sa, ars, aar, ahr, !ah
</code></pre></div>
<p dir="auto">Sorting the characters increases the number of common n-grams for transposition errors, one of the most common types of errors in human typing. Not sorting the first n-grams assumes that transpositions are less likely to occur at the beginning of a string.</p>
<p dir="auto">The quality is then computed by dividing the number of common n-grams by the number of n-grams of the longer string, query or term. Moreover, a 5% penalty is given if the query string does not match the term exactly. This accounts for the fact that even if two strings have the same 3-grams, they are not necessarily the same, i.e., compare <code>aabaaa</code> and <code>aaabaa</code>. With this approach, the following quality values are obtained:</p>
<table>
<thead>
<tr>
<th>Query</th>
<th>Term</th>
<th>Padded query</th>
<th>Padded term</th>
<th>Common 3-grams</th>
<th>Quality</th>
</tr>
</thead>
<tbody>
<tr>
<td>sarah</td>
<td>sarah</td>
<td>$$sarah!</td>
<td>$$sarah!</td>
<td>6</td>
<td>6 / 6 = 1.0</td>
</tr>
<tr>
<td>sarha</td>
<td>sarah</td>
<td>$$arah!</td>
<td>$$sarah!</td>
<td>5</td>
<td>5 / 6 * 0.95 = 0.79</td>
</tr>
<tr>
<td>sar</td>
<td>sarah</td>
<td>$$sar!</td>
<td>$$sarah!</td>
<td>3</td>
<td>3 / 6 * 0.95 = 0.475</td>
</tr>
<tr>
<td>arah</td>
<td>sarah</td>
<td>$$arah!</td>
<td>$$sarah!</td>
<td>3</td>
<td>3 / 6 * 0.95 = 0.475</td>
</tr>
</tbody>
</table>
<blockquote>
<p dir="auto">Note that I refrain from explicitly computing the Damereau-Levenshtein distance between strings, in order to keep the queries fast.</p>
</blockquote>
<p dir="auto">Padding strings in the middle allows for extending the algorithm across word boundaries. <code>sarah wolff</code> becomes <code>$$sarah!$$wolff!</code> and matches <code>wolff sarah</code> with a quality of 0.95, if 3-grams that end with a &#39;$&#39; are discarded.</p>
<p dir="auto">The overall approach outlined above can be summarized as: remove n-grams that end with &#39;$&#39;, sort n-grams that don&#39;t contain &#39;$&#39;. The default configuration appears in the code as follows:</p>
<div dir="auto" data-snippet-clipboard-copy-content="let ngramN = 3;
let transformNgram = (ngram) =&gt;
  ngram.endsWith(&#39;$&#39;) ? null
  : ngram.indexOf(&#39;$&#39;) === -1 ? ngram.split(&#39;&#39;).sort().join(&#39;&#39;)
  : ngram;

let inequalityPenalty = 0.05;"><pre><span>let</span> <span>ngramN</span> <span>=</span> <span>3</span><span>;</span>
<span>let</span> <span>transformNgram</span> <span>=</span> <span>(</span><span>ngram</span><span>)</span> <span>=&gt;</span>
  <span>ngram</span><span>.</span><span>endsWith</span><span>(</span><span>&#39;$&#39;</span><span>)</span> ? <span>null</span>
  : <span>ngram</span><span>.</span><span>indexOf</span><span>(</span><span>&#39;$&#39;</span><span>)</span> <span>===</span> <span>-</span><span>1</span> ? <span>ngram</span><span>.</span><span>split</span><span>(</span><span>&#39;&#39;</span><span>)</span><span>.</span><span>sort</span><span>(</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#39;&#39;</span><span>)</span>
  : <span>ngram</span><span>;</span>

<span>let</span> <span>inequalityPenalty</span> <span>=</span> <span>0.05</span><span>;</span></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-support-and-contribution" aria-hidden="true" tabindex="-1" href="#support-and-contribution"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Support and Contribution</h2>
<p dir="auto">This library is free. If you find it valuable and wish to express your support, please leave a star. You are kindly invited to contribute. If you see the possibility for enhancement, please create a GitHub issue and you will receive timely feedback.</p>
<p dir="auto">Happy coding!</p>
</article></div></div>
  </body>
</html>
