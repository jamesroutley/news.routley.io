<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://airlied.blogspot.com/2022/12/vulkan-video-decoding-radv-status.html">Original</a>
    <h1>Update on Vulkan video decoding vith open-source AMD driver RADV</h1>
    
    <div id="readability-page-1" class="page"><div>

<main id="main" role="main" tabindex="-1">
<div id="page_body" name="Page body">
<div data-version="2" id="Blog1">
<div>
<article>
<div>
<div>

<h3>
vulkan video decoding: radv status
</h3>


<div id="post-body-3338166503661791976">
<p>I&#39;ve been working the past couple of weeks with an ffmpeg developer (Lynne) doing Vulkan video decode bringup on radv.</p><p>The current status of this work is in a branch[1]. This work is all against the current EXT decode beta extensions in the spec.<br/></p><p>This contains an initial implementation of H264 and H265 decoding for AMD GPUs from TONGA to NAVI2x. It passes the basic conformance tests but fails some of the more complicated ones, but it has decoded the streams we&#39;ve been throwing at it using ffmpeg.</p><h3>Building:</h3><p><span>git clone https://gitlab.freedesktop.org/airlied/mesa</span></p><h3>Running:</h3><blockquote></blockquote><p><span>export VK_ICD_FILENAMES=&lt;prefix&gt;/share/vulkan/icd.d/radeon_icd.x86_64.json</span></p><blockquote></blockquote><blockquote></blockquote><p>This should show support for  VK_KHR_video_queue, VK_KHR_video_decode_queue, VK_EXT_video_decode_h264 and VK_EXT_video_decode_h265.</p><p>[1] <a href="https://gitlab.freedesktop.org/airlied/mesa/-/tree/radv-vulkan-video-prelim-decode">https://gitlab.freedesktop.org/airlied/mesa/-/tree/radv-vulkan-video-prelim-decode</a><br/></p>
</div>

</div>
</div>

</article>
</div>
</div><div data-version="2" id="PopularPosts1">
<h3>
Popular posts from this blog
</h3>
<div>
<div role="feed">
<article role="article">
<h3><a href="https://airlied.blogspot.com/2022/02/optimising-llvmpipe-vertexfragment.html">optimizing llvmpipe vertex/fragment processing.</a></h3>

<div>
<div>
<p>
Around 2 years ago while I was working on tessellation support for llvmpipe, and running the heaven benchmark on my Ryzen, I noticed that heaven despite running slowly wasn&#39;t saturating all the cores. I dug in a bit, and found that llvmpipe despite threading rasterization, fragment shading and blending stages, never did anything else while those were happening. I dug into the code as I clearly remembered seeing a concept of a &#34;scene&#34; where all the primitives were binned into and then dispatched. It turned out the &#34;scene&#34; was always executed synchronously. At the time I wrote support to allow multiple scenes to exist, so while one scene was executing the vertex shading and binning for the next scene could execute, and it would be queued up. For heaven at the time I saw some places where it would build 36 scenes. However heaven was still 1fps with tess, and regressions in other areas were rampant, and I mostly left them in a branch. The reasons so many things were
</p>
</div>

</div>
</article>
<article role="article">
<h3><a href="https://airlied.blogspot.com/2021/11/video-decode-crossing-streams.html">video decode: crossing the streams</a></h3>

<div>
<div>
<p>
I was interested in how much work a vaapi on top of vulkan video proof of concept would be. My main reason for being interested is actually video encoding, there is no good vulkan video encoding demo yet, and I&#39;m not experienced enough in the area to write one, but I can hack stuff. I think it is probably easier to hack a vaapi encode to vulkan video encode than write a demo app myself. With that in mind I decided to see what decode would look like first. I talked to Mike B (most famous zink author) before he left for holidays, then I ignored everything he told me and wrote a super hack. This morning I convinced zink vaapi on top anv with iris GL doing the presents in mpv to show me some useful frames of video. However zink vaapi on anv with zink GL is failing miserably (well green jellyfish). I&#39;m not sure how much more I&#39;ll push on the decode side at this stage, I really wanted it to validate the driver side code, and I&#39;ve found a few bugs in there already. The WIP hac
</p>
</div>

</div>
</article>
<article role="article">
<h3><a href="https://airlied.blogspot.com/2021/11/h264-more-amd-hw-worked-on.html">h264: more AMD hw worked on</a></h3>

<div>
<div>
<p>
Previously I mentioned having AMD VCN h264 support. Today I added initial support for the older UVD engine[1]. This is found on chips from Vega back to SI. I&#39;ve only tested it on my Vega so far. I also worked out the &#34;correct&#34; answer to the how to I send the reset command correctly, however the nvidia player I&#39;m using as a demo doesn&#39;t do things that way yet, so I&#39;ve forked it for now[2]. The answer is to use vkCmdControlVideoCodingKHR to send a reset the first type a session is used. However I can&#39;t see how the app is meant to know this is necessary, but I&#39;ve asked the appropriate people. The initial anv branch I mentioned last week is now here[3]. [1] https://gitlab.freedesktop.org/airlied/mesa/-/commits/radv-vulkan-video-uvd-h264 [2] https://github.com/airlied/vk_video_samples/tree/radv-fixes [3] https://gitlab.freedesktop.org/airlied/mesa/-/tree/anv-vulkan-video-prelim-decode
</p>
</div>

</div>
</article>
</div>
</div>
</div></div>
</main>
</div></div>
  </body>
</html>
