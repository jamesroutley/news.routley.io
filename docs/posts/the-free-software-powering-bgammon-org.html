<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bgammon.org/blog/20240101-hello-world/">Original</a>
    <h1>The free software powering bgammon.org</h1>
    
    <div id="readability-page-1" class="page"><div>
        
        
<p>A technical overview of the software powering bgammon.org</p>


<p><a href="https://liberapay.com/rocket9labs.com" target="_blank" rel="noopener"><img src="https://img.shields.io/liberapay/receives/rocket9labs.com.svg?logo=liberapay" alt="Donate"/></a></p><h2 id="introduction">
  Introduction
  <a href="#introduction">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h2>
<p>In this post I share my experience with creating the bgammon.org server and client using
<a href="https://en.wikipedia.org/wiki/Free_and_open-source_software" target="_blank" rel="noopener">free and open source</a>
tools. This includes <a href="https://www.kernel.org" target="_blank" rel="noopener">Linux</a>, the <a href="https://go.dev" target="_blank" rel="noopener">Go</a>
programming language and the <a href="https://vscodium.com" target="_blank" rel="noopener">VSCodium</a> IDE.</p>
<p>While lots of free and open source backgammon software exists, all of the
servers that were available in late 2023 were <a href="https://en.wikipedia.org/wiki/Proprietary_software" target="_blank" rel="noopener">proprietary</a>.
I have enjoyed playing chess on <a href="https://lichess.org" target="_blank" rel="noopener">Lichess</a> for several
years, and have always admired their model: free and open source, no ads, no
paid benefits and no registration requirement. They say immitation is the
sincerest form of flattery.</p>
<p>I created <a href="https://code.rocket9labs.com/tslocum/boxcars" target="_blank" rel="noopener">Boxcars</a>, a graphical
client for playing backgammon online, originally for the <a href="http://www.fibs.com" target="_blank" rel="noopener">FIBS</a>
backgammon server in late 2021. The project was essentially feature-complete
but never found a user base. Fast-forward two years to late 2023, and an idea
for a project that has been brewing in the back of my head for some time begins
to seem not just possible, but important: to make it possible to play backgammon
online using <a href="https://en.wikipedia.org/wiki/Free_software" target="_blank" rel="noopener">free software</a>.</p>
<p>I created <a href="https://code.rocket9labs.com/tslocum/bgammon" target="_blank" rel="noopener">bgammon</a>, the server
component of bgammon.org, and adapted Boxcars to connect to this new server
instead. Using the insight I gained as a FIBS client author of things that work
well and things that were (in my experience) difficult to understand or
implement, I wrote the specification for a <a href="https://code.rocket9labs.com/tslocum/bgammon/src/branch/main/PROTOCOL.md" target="_blank" rel="noopener">protocol</a>
that is inspired by FIBS while also being distinct in ways such as the use of a
standard data interchange format (<a href="https://en.wikipedia.org/wiki/JSON" target="_blank" rel="noopener">JSON</a>)
for messages sent by the server.</p>
<p>In the rest of this blog post, I will describe the more technical aspects of
the creation of the bgammon.org server and client.</p>
<h3 id="server">
  Server
  <a href="#server">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h3>
<p>The server was created with efficiency in mind from the beginning. There are some
low-hanging optimization fruits yet to be picked, but I have done my best to
choose a data format and scheme which is efficient in its use of processor and
memory resources. This is partly done just as good software design practice, but
it is also important to make games and network traffic efficient because
bgammon.org does not have any advertisements or sponsorships. The infrastructure
for the server needs to be light-weight to keep the cost to the author as little
as possible.</p>
<p>Therefore, the state of the board is stored as an array of integers, where the
value of each cell specifies how many checkers are on a board space. Positive
integers represent player 1 (black) and negative integers represent player 2
(white). This array is referenced and copied and mutated many times as the server
evaluates all of the possible moves a player can make to determine which legal
moves are available. In backgammon, if you can make a move that allows you to
then make a second move, but you could instead make a move where you are only
able to make one move and then end your turn, you are requred to make a move
that allows you to then make a subsequent move.</p>
<p>Unlike chess, where spaces have the same name regardless of whether it is from
white or black’s perspective of the board, backgammon spaces are numbered from
the perspective of each player. This means when black moves 24/22, if white
were to move in the opposite direction from black’s 22 to 24, white would
perceive the move as 3/1. To simplify handling this, the server only stores the
board state from the perspective of player 1, and flips the state sent to
player 2 and moves received from player 2. Thus, the board is represented to
player 2 appropriately without requiring duplication of logic everywhere the
server analyzes the board state.</p>
<p>User commands consist of a single line of plain text, where the command is the
first word of the line, and the command parameters make up the rest of the line.
For instance, to connect, a client might send <code>loginjson boxcars rocket9 s3cr3t</code>
to log in using a client named boxcars.</p>
<p>Server messages are sent to clients in JSON format. This makes it easy for
clients to parse and validate data sent by the server. While it is a format
designed to be used by computers, JSON is still very human-readable and it is
not difficult to read and understand a log of bgammon.org network traffic.</p>
<h3 id="client">
  Client
  <a href="#client">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h3>
<p>The official client utilizes more libraries than any other project I have
created. At the time of writing this blog post, it uses 12 libraries directly,
several of which I authored to help facilitate creating Boxcars, and 41
additional libraries indirectly.</p>
<h4 id="ebitengine---game-engine">
  Ebitengine - Game engine
  <a href="#ebitengine---game-engine">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h4>
<p><a href="https://ebitengine.org" target="_blank" rel="noopener">Ebitengine</a> is an incredible game engine. It is easy
to use and understand, the API design is simple, and it compiles to an amazing
number of <a href="https://github.com/hajimehoshi/ebiten/blob/main/README.md#platforms" target="_blank" rel="noopener">platforms</a>.
This includes <a href="https://en.wikipedia.org/wiki/WebAssembly" target="_blank" rel="noopener">WebAssembly</a> and
Android, which is very appealing to any developer who wishes to target multiple
platforms from a single code base.</p>
<h4 id="messeji---text-display-and-input">
  messeji - Text display and input
  <a href="#messeji---text-display-and-input">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h4>
<p><a href="https://code.rocket9labs.com/tslocum/messeji" target="_blank" rel="noopener">messeji</a> is a library for drawing
text on the screen as well as handling textual user input. It features an
efficient word wrapping implementation that allows very large text buffer sizes
even when running in a single-threaded context.</p>
<h4 id="kibodo---on-screen-keyboard">
  kibodo - On-screen keyboard
  <a href="#kibodo---on-screen-keyboard">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h4>
<p><a href="https://code.rocket9labs.com/tslocum/kibodo" target="_blank" rel="noopener">kibodo</a> is a library that allows
applications running on touch-enabled devices to accept keyboard input. This
library is necessary because toggling the system on-screen keyboard is not
supported by Ebitengine.</p>
<h4 id="etk---gui-tool-kit">
  etk - GUI tool kit
  <a href="#etk---gui-tool-kit">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h4>
<p><a href="https://code.rocket9labs.com/tslocum/etk" target="_blank" rel="noopener">etk</a> is a library that simplifies the
creation of graphical user interfaces. It provides a widget framework that makes
focus and user input propagation far easier to manage compared to implementing
custom logic everywhere it is needed in the application. etk provides several
widgets out of the box, but also makes it possible to create custom widgets
that integrate seamlessly with the official widgets. The Grid widget, for
instance, allows the creation of flexible screen layouts that function across
desktop and mobile platforms.</p>
<h4 id="tabula---backgammon-ai">
  tabula - Backgammon AI
  <a href="#tabula---backgammon-ai">
    <i aria-hidden="true" title="Link to heading"></i>
    <span>Link to heading</span>
  </a>
</h4>
<p><a href="https://code.rocket9labs.com/tslocum/tabula" target="_blank" rel="noopener">tabula</a> is a library that analyzes
backgammon positions and attempts to determine the best move. It accomplishes
this by performing a series of weighted calculations which I describe in detail
on <a href="https://code.rocket9labs.com/tslocum/tabula/src/branch/main/DESIGN.md" target="_blank" rel="noopener">this page</a>.</p>
<p>Sometimes it <a href="https://bgammon.org/stats-tabula" target="_blank" rel="noopener">wins</a>, but it only looks one
step ahead in the game, while more powerful backgammon engines will usually
look many more steps ahead. tabula doesn’t do this because that takes a long
time. While I do my best to make tabula as challenging as possible, it is
within the constraint of taking only a few seconds at most to determine the
best move on a low-powered Android phone.</p>

      </div></div>
  </body>
</html>
