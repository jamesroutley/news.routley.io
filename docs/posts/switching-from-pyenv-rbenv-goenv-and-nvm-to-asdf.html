<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jinyuz.dev/posts/tips-and-tricks/switching-from-pyenv,-rbenv,-goenv-and-nvm-to-asdf/">Original</a>
    <h1>Switching from pyenv, rbenv, goenv and nvm to asdf</h1>
    
    <div id="readability-page-1" class="page"><div><p>So, there was a time when I was only developing applications using <code>Python</code>. And so I found out about virtual environments.
And then after a couple of months, I discovered <code>pyenv</code>.</p>
<p>It also came to a time I had to work on multiple projects that uses different versions of <code>nodejs</code> and searched something similar
so I installed <code>nvm</code>.</p>
<p>Then, I was required to work on a <code>Ruby</code> project so I installed <code>rbenv</code>.</p>
<p>And since <code>golang</code> was one of the new shiny objects that kinda got my interest, I went on and installed <code>goenv</code>.</p>
<p>Everything was fine until I kinda felt my <code>config.fish</code> file got bloated and somehow <code>nvm</code> was kinda slowing down my shell startup.</p>
<p>I did do some optimizations such as lazy loading <code>nvm</code> and used a <code>fish</code> plugin called <a href="https://github.com/FabioAntunes/fish-nvm" target="_blank" rel="nofollow noopener noreferrer">fish-nvm</a>.</p>
<p>And then one day, I found out about <a href="https://google.com" target="_blank" rel="nofollow noopener noreferrer">asdf-vm</a>.</p>
<p>At first, I was quite hesitant to install it since it would kinda disrupt my work flow with python projects since I heavily use <code>pyenv virtualenv &lt;version&gt; &lt;name&gt;</code>.</p>
<p>But I did feel that the benefits of using <code>asdf-vm</code> outweighs the cons so I went ahead and proceeded.</p>

<div data-language="shell"><pre><code>$ <span>git</span> clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.7.8</code></pre></div>
<p><code>asdf</code> has a pretty good documentation to be honest. Despite <code>brew</code> being my go to package manager, I chose <code>git</code> as my installation method.
My reason is that <code>asdf</code> requires me to add this line in my <code>config.fish</code></p>
<div data-language="shell"><pre><code><span>source</span> <span>(</span>brew --prefix asdf<span>)</span>/asdf.fish</code></pre></div>
<p>and the <code>brew --prefix adsf</code> is just too slow compared to just having this</p>
<div data-language="shell"><pre><code><span>source</span> <span>$HOME</span>/.asdf/asdf.fish</code></pre></div>
<p>Next, for the auto completions just run this command in your terminal:</p>
<div data-language="shell"><pre><code>$ <span>mkdir</span> -p ~/.config/fish/completions<span>;</span> and <span>cp</span> ~/.asdf/completions/asdf.fish ~/.config/fish/completions</code></pre></div>
<p>Restart your shell so that PATH changes take effect!</p>
<p>You can checkout a more detailed documentation here: <a href="https://asdf-vm.com/#/core-manage-asdf-vm?id=install" target="_blank" rel="nofollow noopener noreferrer">https://asdf-vm.com/#/core-manage-asdf-vm?id=install</a></p>
<p>Before, my <code>config.fish</code> looked something like this:</p>
<div data-language="shell"><pre><code>
<span>set</span> -gx PYENV_ROOT <span>$HOME</span>/.pyenv
<span>set</span> -gx PYTHON_BUILD_ARIA2_OPTS <span>&#34;-x 10 -k 1M&#34;</span> 
contains <span>$PYENV_ROOT</span>/bin <span>$fish_user_paths</span><span>;</span> or <span>set</span> -Ua fish_user_paths <span>$PYENV_ROOT</span>/bin
status --is-interactive<span>;</span> and pyenv init - <span>|</span> <span>source</span>
status --is-interactive<span>;</span> and pyenv virtualenv-init - <span>|</span> <span>source</span>


<span>set</span> -gx GOENV_GOPATH_PREFIX <span>$HOME</span>/.go
status --is-interactive<span>;</span> and goenv init - <span>|</span> <span>source</span>


status --is-interactive<span>;</span> and rbenv init - <span>|</span> <span>source</span>


<span>set</span> -gx nvm_alias_output <span>$HOME</span>/.node_aliases
contains <span>$nvm_alias_output</span> <span>$fish_user_paths</span><span>;</span> or <span>set</span> -Ua fish_user_paths <span>$nvm_alias_output</span></code></pre></div>
<p>After</p>
<div data-language="shell"><pre><code>
<span>set</span> -gx PYTHON_BUILD_ARIA2_OPTS <span>&#34;-x 10 -k 1M&#34;</span> 


<span>source</span> <span>$HOME</span>/.asdf/asdf.fish</code></pre></div>

<p>Again, most of the things I put here just came from the documentation: <a href="https://asdf-vm.com/#/core-manage-plugins?id=add" target="_blank" rel="nofollow noopener noreferrer">https://asdf-vm.com/#/core-manage-plugins?id=add</a></p>
<h2 id="pyenv-replacement"><a href="#pyenv-replacement" aria-label="pyenv replacement permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pyenv replacement</h2>
<div data-language="shell"><pre><code>$ asdf plugin <span>add</span> python
$ asdf <span>install</span> python latest:3 
$ asdf global python <span>3.8</span>.4 </code></pre></div>
<h2 id="rbenv-replacement"><a href="#rbenv-replacement" aria-label="rbenv replacement permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rbenv replacement</h2>
<div data-language="shell"><pre><code>$ asdf plugin <span>add</span> ruby
$ asdf <span>install</span> ruby latest 
$ asdf global ruby <span>2.7</span>.1</code></pre></div>
<h2 id="goenv-replacement"><a href="#goenv-replacement" aria-label="goenv replacement permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>goenv replacement</h2>
<div data-language="shell"><pre><code>$ asdf plugin <span>add</span> golang
$ asdf <span>install</span> golang latest 
$ asdf global golang <span>1.14</span>.6</code></pre></div>
<h2 id="nvm-replacement"><a href="#nvm-replacement" aria-label="nvm replacement permalink"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>nvm replacement</h2>
<div data-language="shell"><pre><code>$ asdf plugin <span>add</span> nodejs
$ asdf <span>install</span> nodejs <span>12.18</span>.2
$ asdf global nodejs <span>12.18</span>.2</code></pre></div>
<p>Using <code>asdf global</code> creates a file under your HOME directory called <code>.tool-versions</code></p>
<div data-language="shell"><pre><code>$ <span>cat</span> ~/.tool-versions
python <span>3.8</span>.4
ruby <span>2.7</span>.1
golang <span>1.14</span>.6
nodejs <span>12.18</span>.2</code></pre></div>
<p>This lets <code>asdf</code> know which versions to use. And of course, in contrast to <code>global</code>,
there is also the <code>local</code> keyword that creates another <code>.tool-versions</code>.
This is useful when projects require different version.</p>
<div data-language="shell"><pre><code>$ <span>cd</span> ~/project1
$ asdf <span>local</span> python <span>3.7</span>.5
$ python --version 
<span>3.7</span>.5
$ <span>cd</span> ~/project2
$ python --version 
<span>3.8</span>.4</code></pre></div>
<p><code>asdf</code> has a lot of plugins available. You can check them out here: <a href="https://github.com/asdf-vm/asdf-plugins" target="_blank" rel="nofollow noopener noreferrer">https://github.com/asdf-vm/asdf-plugins</a></p>

<p>In order to accommodate my work flow when I was still using <code>pyenv virtualenv</code>,
I created a function that behaves quite similar to <code>pyenv virtualenv</code>.</p>
<div data-language="shell"><pre><code>$ <span>touch</span> ~/.config/fish/functions/venv.fish</code></pre></div>
<p>And paste the following:</p>
<div data-language="shell"><pre><code><span>function</span> venv --argument-names <span>&#39;python_version&#39;</span> --description <span>&#39;Create virtualenv named the same as current directory&#39;</span>
  <span>set</span> -l python_bin

  <span>if</span> not <span>test</span> -n <span>&#34;<span>$python_version</span>&#34;</span>
    
    <span>set</span> python_bin <span>(</span><span>$HOME</span>/.asdf/bin/asdf <span>which</span> python<span>)</span>
  <span>else</span>
    <span>set</span> python_bin <span>$ASDF_DIR</span>/installs/python/<span>$python_version</span>/bin/python
  end

  <span>set</span> -l venv_name <span>(</span>basename <span>$PWD</span> <span>|</span> <span>tr</span> <span>.</span> -<span>)</span>

  <span>echo</span>
  <span>if</span> not <span>test</span> -e <span>$python_bin</span>
    <span>echo</span> <span>&#34;Python version <span><span>`</span>$python_version<span>`</span></span> is not installed.&#34;</span>
    <span>return</span> <span>1</span>
  end

  <span>echo</span> Creating virtualenv <span><span>`</span>$venv_name<span>`</span></span>
  <span>$python_bin</span> -m venv <span>$HOME</span>/.virtualenvs/<span>$venv_name</span>
  <span>source</span> <span>$HOME</span>/.virtualenvs/<span>$venv_name</span>/bin/activate.fish
end</code></pre></div>
<p>Whenever I’m inside a python project, I just need to type <code>venv</code> or <code>venv &lt;python_version&gt;</code>
and it will automatically create a virtualenv under <code>~/.virtualenvs</code> using the current directory name.</p>
<p>In order to automatically activate the virtualenv when <code>cd</code>ing to a project, do the following:</p>
<div data-language="shell"><pre><code>$ <span>touch</span> ~/.config/fish/conf.d/__auto_venv.fish</code></pre></div>
<p>And paste the following:</p>
<div data-language="shell"><pre><code><span>function</span> __auto_venv --on-variable <span>PWD</span> --description <span>&#34;Automatically activate python venv&#34;</span>
  <span>set</span> -l venv_name <span>(</span>basename <span>$PWD</span> <span>|</span> <span>tr</span> <span>.</span> -<span>)</span>

  <span>if</span> <span>test</span> -d <span>$HOME</span>/.virtualenvs/<span>$venv_name</span>
    <span>source</span> <span>$HOME</span>/.virtualenvs/<span>$venv_name</span>/bin/activate.fish
  end
end</code></pre></div>
<p>Cool! Not only did I reduce the lines in my <code>config.fish</code>, I could also notice a decreased startup time which is a good thing!</p>
<p>You can also check out my dotfiles in my GitHub repository: <a href="https://github.com/yujinyuz/dotfiles" target="_blank" rel="nofollow noopener noreferrer">https://github.com/yujinyuz/dotfiles</a></p>
<p>I hope this article helped you! You can leave a comment below and I’ll try to answer them as fast as I can.</p>
<p>Thanks for reading! 🎉</p></div></div>
  </body>
</html>
