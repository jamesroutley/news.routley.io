<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://wssite.vercel.app/blog/moving-back-to-a-tiling-wm-xmonad">Original</a>
    <h1>Moving Back to a Tiling WM – XMonad</h1>
    
    <div id="readability-page-1" class="page"><div><div><!----><!--[--><p>Here are my <a href="https://github.com/weirdsmiley/xmonad/tree/release" rel="noopener noreferrer" target="_blank">dotfiles</a>.</p> <p>When I was still using Manjaro Linux back in 2019, I got a nudge to try <a href="https://i3wm.org/" rel="noopener noreferrer" target="_blank">i3wm</a>. It was my first experience with any window manager. And I spent
nearly 5 years with it, enjoying the absolute control over my workflow. Nearing
the end of 2023, when I finally decided to leave Manjaro (for good), I had a
bunch of options on my hand. Fedora looked really promising at that time. But
even then, I wasn’t sure I was going to be using any tiling window manager. I
happily switched to Gnome in Fedora 40. I ran it along with XOrg so that I could
make my <code>capslock</code> key act as a <code>ctrl</code> when held and as an <code>escape</code> when pressed
once, using <code>setxkbmap</code> and <code>xcape</code>. But only after spending a few months there,
I realized I missed that finer control at my fingertips. So, I resumed searching
for a newer tiling window manager. I was also learning Haskell at that time, so
picking up <a href="https://xmonad.org/" rel="noopener noreferrer" target="_blank">XMonad</a> was natural.</p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-fastfetch.png" alt="XMonad Fastfetch"/></p> <p>There are a lot of things that I like about XMonad apart from its standard
tiling manager features. I enjoy writing the configuration in Haskell. Where
ever possible, I try to leverage the benefits of Haskell’s strong type system.
Defining keybindings with a strong type system ensures that I cannot go very
wrong with it. Using stack for building my configuration allows me to port the
entire configuration easily to other systems, which are my various virtual
machines. I have split configuration in various modules.</p> <pre><!----><code>src
├── Keybindings.hs
├── Layout.hs
├── Plugins
│   ├── Bluetooth.hs
│   ├── Pomodoro.hs
│   └── Soundtrack.hs
├── Preferences.hs
├── Theme
│   ├── Dmenu.hs
│   ├── Font.hs
│   ├── Theme.hs
│   └── Xresources.hs
├── Workspaces.hs
├── xmobar.hs
└── xmonad.hs

3 directories, 13 files</code><!----></pre> <p>If you want to poke around the config according to your needs, go through <a href="https://github.com/weirdsmiley/xmonad/blob/release/src/Preferences.hs" rel="noopener noreferrer" target="_blank">Preferences.hs</a>. It contains lots of variables which can be customized like
terminal emulator, browser, scratchpads, window gap size etc. It also contains a
list of applications which you would like to start automatically at boot.</p> <p>Overall, the modularization has turned out to be pretty in terms of categorizing
things. I tried writing a few <a href="https://codeberg.org/xmobar/xmobar" rel="noopener noreferrer" target="_blank">xmobar</a> plugins for my own needs. The <a href="https://codeberg.org/xmobar/xmobar/src/branch/master/doc/using-haskell.org#writing-a-plugin" rel="noopener noreferrer" target="_blank">guide</a> for writing them was straightforward to begin with. I also wrote my
entire xmobar configuration in Haskell itself, keeping this executable in the
same project. In the end, the project itself became a one-shot way for an entire
desktop environment which I can easily clone, compile and install on any system.</p>  <p>I will go briefly over the stack-based setup. The only thing needed is to have a <code>build</code> script at the root of your xmonad project. Everything else is simply a
normal stack project with modules and a few executables. I have 2 executables in
my project: xmonad and xmobar.</p> <p>A detailed description and example build files can be found <a href="https://github.com/xmonad/xmonad-testing?tab=readme-ov-file#xmonad-and-custom-build-scripts" rel="noopener noreferrer" target="_blank">here</a>. My build
script is simple enough.</p> <pre><!----><code><span>#!/bin/sh</span>

<span>SRC_DIR</span><span>=</span><span>$HOME</span>/.config/xmonad
<span>WM</span><span>=</span>xmonad

<span>unset</span> STACK_YAML
<span>FAIL</span><span>=</span><span>0</span>

<span>cd</span> <span>$SRC_DIR</span>
stack <span>install</span> <span><span>2</span>&gt;</span>.log <span>||</span> <span>FAIL</span><span>=</span><span>1</span>

<span>ln</span> <span>-f</span> <span>-T</span> <span><span>$(</span>stack <span>exec</span> -- <span>which</span> $WM<span>)</span></span> <span>$1</span> <span><span>2</span>&gt;</span>.log <span>||</span> <span>FAIL</span><span>=</span><span>2</span></code><!----></pre>  <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-workflow.png" alt="XMonad Workflow"/></p> <p><a href="https://docs.haskellstack.org/en/stable/" rel="noopener noreferrer" target="_blank">Stack</a> is a package manager for Haskell projects and it will be used to
compile the package. Install stack either via <a href="https://www.haskell.org/ghcup/" rel="noopener noreferrer" target="_blank">GHCup</a> or your distribution’s
package manager.</p> <pre><!----><code><span>mkdir</span> <span>-p</span> <span>$HOME</span>/.config/xmonad
<span>git</span> clone <span>--branch</span> release https://github.com/weirdsmiley/xmonad <span>$HOME</span>/.config/xmonad/
<span>cd</span> <span>$HOME</span>/.config/xmonad
./install.sh</code><!----></pre> <p>The installation script will install a few fonts and other tools which are
default for this setup. It will also write <code>.xinitrc</code> and <code>.Xresources</code> files.</p> <p>After the installation is complete, and you are logged into xmonad, pressing <code>alt+shift+/</code> or <code>alt+?</code> will open up a dialog box containing all available
keybindings.</p>  <h2>3.1. Layouts and per-workspace layouts</h2> <p>XMonad provides a very easy way to describe various layouts that workspaces can
follow. I found it useful to constrain only a few layouts on each workspace.  I
used <a href="https://hackage.haskell.org/package/xmonad-contrib-0.18.1/docs/XMonad-Layout-PerWorkspace.html" rel="noopener noreferrer" target="_blank">PerWorkspace</a> for this. This allows me to only switch between
specified set of layouts. So for example, my workspace 2 is my writing
workspace, in which I have 3 applications.  A browser, a pdf reader and a
terminal with a tmux session attached to it. This can simply be arranged as a
three column layout. But sometimes certain pdfs may have smaller font size which
can be tough to read in a column. If I zoom in the pdf it spills sideways, and I
have to use arrow keys or h,l to move left and right.</p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-three-col.png" alt="Three column layout"/></p> <p>To tackle this, I have another layout with added magnification on top of the
three column layout.  It magnifies the focused window by a certain limit. And
having only these two layouts in my layout set helps me in easily cycling
between layouts. I don’t have to skip through 4 different layouts which I would
never use in this workspace.</p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-three-col-magnified.png" alt="Three column layout with magnification"/></p> <h2>3.2. Topbar modification</h2> <p>By default, XMonad adds a border to the tiled window which is in focus. I took
this idea from <a href="https://github.com/altercation/dotfiles-tilingwm/blob/31e23a75eebdedbc4336e7826800586617d7d27d/.xmonad/xmonad.hs#L519" rel="noopener noreferrer" target="_blank">here</a>. This adds a title bar with formatted colors. This
looks nicer that having a border surrounding the window. The focused window is
colored blue while unfocused is colored black. Also, having the title names in
topbar looks nice, and in a way removes the need of using XMonadLog’s
application names in xmobar itself.</p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-topbar.png" alt="Window topbar"/></p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-topbar-unfocused.png" alt="Window topbar unfocused"/></p> <h2>3.3. Type safety in keybindings</h2> <p>This is something which I truly adore about XMonad and writing its
configuration in Haskell. I can write my keybindings in a functional manner
and leverage Haskell’s type system to ensure safety. Arranging keybindings in
this way, seems more fruitful than having them represented via strings.</p> <pre><!----><code><span>myKeys</span> <span>::</span> <span>XConfig</span> <span>Layout</span> <span>-&gt;</span> <span>M<span>.</span>Map</span> <span>(</span><span>KeyMask</span><span>,</span> <span>KeySym</span><span>)</span> <span>(</span><span>X</span> <span>(</span><span>)</span><span>)</span>
<span>myKeys</span> <span>conf</span><span>@</span><span>XConfig</span> <span>{</span><span>XMonad<span>.</span>modMask</span> <span>=</span> <span>modm</span><span>}</span> <span>=</span>
  <span>M<span>.</span>fromList</span> 
    <span>$</span> <span>[</span>
      
      <span>(</span> <span>(</span><span>modm</span><span>,</span> <span>xK_q</span><span>)</span><span>,</span> <span>safeSpawn</span> <span>&#34;xmonad&#34;</span> <span>[</span><span>&#34;--restart&#34;</span><span>]</span><span>)</span>
      
      <span>,</span> <span>(</span><span>(</span><span>modm</span><span>,</span> <span>xK_f</span><span>)</span><span>,</span> <span>sendMessage</span> <span>$</span> <span>Toggle</span> <span>NBFULL</span><span>)</span>
      
      <span>,</span> <span>(</span><span>(</span><span>modm</span><span>,</span> <span>xK_l</span><span>)</span><span>,</span> <span>unGrab</span> <span>*&gt;</span> <span>safeSpawn</span> <span>&#34;env&#34;</span> <span>myLockscreen</span><span>)</span>
      <span>]</span></code><!----></pre> <p>Each keybinding is comprised of two values of types: <code>KeyMask</code> and <code>KeySym</code>,
followed by an <code>X ()</code> action. If you don’t want to set a keymask simply pass a <code>0</code> or <code>noModMask</code>.</p> <h2>3.4. Submap keybindings and makeChords</h2> <p>Using <a href="https://hackage.haskell.org/package/xmonad-contrib-0.18.1/docs/XMonad-Actions-Submap.html" rel="noopener noreferrer" target="_blank">submaps</a> in xmonad-contrib, I can write a utility function to easily generate a set of keybindings with an added description.</p> <pre><!----><code><span><span>import</span> XMonad<span>.</span>Actions<span>.</span>Submap</span>
<span><span>import</span> <span>qualified</span> Data<span>.</span>Map <span>as</span> M</span>

<span>makeChords</span> <span>::</span> <span>a</span> <span>-&gt;</span> <span>[</span><span>(</span><span>(</span><span>KeyMask</span><span>,</span> <span>KeySym</span><span>)</span><span>,</span> <span>String</span><span>,</span> <span>X</span> <span>(</span><span>)</span><span>)</span><span>]</span> <span>-&gt;</span> <span>[</span><span>(</span><span>a</span><span>,</span> <span>X</span> <span>(</span><span>)</span><span>)</span><span>]</span>
<span>makeChords</span> <span>majorKey</span> <span>subKeys</span> <span>=</span>
  <span>(</span><span>majorKey</span><span>,</span> <span>submap</span> <span>.</span> <span>M<span>.</span>fromList</span> <span>$</span> <span>map</span> <span>(</span><span></span><span>(</span><span>k</span><span>,</span> <span>_</span><span>,</span> <span>a</span><span>)</span> <span>-&gt;</span> <span>(</span><span>k</span><span>,</span> <span>a</span><span>)</span><span>)</span> <span>subKeys</span><span>)</span>
    <span>:</span> <span>[</span> <span>(</span> <span>majorKey</span>
        <span>,</span> <span>visualSubmap</span> <span>myVisualSubmapDef</span>
            <span>$</span> <span>M<span>.</span>fromList</span>
            <span>$</span> <span>map</span> <span>(</span><span></span><span>(</span><span>k</span><span>,</span> <span>d</span><span>,</span> <span>a</span><span>)</span> <span>-&gt;</span> <span>(</span><span>k</span><span>,</span> <span>(</span><span>d</span><span>,</span> <span>a</span><span>)</span><span>)</span><span>)</span> <span>subKeys</span><span>)</span>
      <span>]</span>

<span>soundChords</span> <span>modm</span> <span>=</span>
  <span>makeChords</span>
    <span>(</span><span>modm</span><span>,</span> <span>xK_a</span><span>)</span>
    <span>[</span> <span>(</span> <span>(</span><span>0</span><span>,</span> <span>xK_a</span><span>)</span><span>,</span> <span>&#34;open alsamixer&#34;</span>
      <span>,</span> <span>spawn</span> <span>$</span> <span>myNamedTerminal</span> <span>&#34;alsamixer&#34;</span> <span>++</span> <span>&#34; -e alsamixer&#34;</span><span>)</span>
    <span>,</span> <span>(</span> <span>(</span><span>0</span><span>,</span> <span>xK_m</span><span>)</span><span>,</span> <span>&#34;toggle music playing&#34;</span>
      <span>,</span> <span>getRunningPlayer&#39;</span> <span>&gt;&gt;=</span> <span></span><span>player</span> <span>-&gt;</span>
          <span>spawn</span> <span>$</span> <span>myMusicCtrl</span> <span>++</span> <span>&#34; -p &#34;&#34;</span> <span>++</span> <span>player</span> <span>++</span> <span>&#34;&#34; play-pause&#34;</span><span>)</span>
    <span>]</span>

<span>myKeys</span> <span>conf</span><span>@</span><span>XConfig</span> <span>{</span><span>XMonad<span>.</span>modMask</span> <span>=</span> <span>modm</span><span>}</span> <span>=</span>
  <span>M<span>.</span>fromList</span> <span>$</span> <span>[</span><span>]</span> <span>++</span> <span>soundChords</span> <span>modm</span></code><!----></pre> <p>The <code>makeChords</code> adds two distinct sets of keybindings, one normal set and
another a visual set, which creates a dialog box when you press the main submap
key. In the example above, the <code>soundChords</code> submap is enabled with <code>alt+a</code>,
then you can see a dialog box containing two keybindings with their
descriptions. Pressing either <code>a</code> or <code>m</code> will launch the first or the second
action. The <a href="https://github.com/weirdsmiley/xmonad/blob/bfb874f0708c4ca7f8f2e7e813de7d1d9408a9a4/src/Keybindings.hs#L47" rel="noopener noreferrer" target="_blank">documentation</a> also contains an example which you can read to see the actual code that will be
appended to your myKeys.</p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-makeChords.png" alt="My visual submap for soundChords"/></p> <h2>3.5. Xmobar configuration in Haskell</h2> <p>Writing the Xmobar configuration inside the same project really allows me
to keep everything in one place. I create another executable alongside the
xmonad executable, in my <code>package.yaml</code>. And then xmonad launches xmobar in the
startup apps section.</p> <pre><!----><code><span>executables</span><span>:</span>
  <span>xmonad</span><span>:</span>
    <span>main</span><span>:</span> xmonad.hs
    <span>dependencies</span><span>:</span>
      <span>-</span> xmonad
      <span>-</span> xmonad<span>-</span>contrib
      <span>-</span> containers
  <span>xmobar</span><span>:</span>
    <span>main</span><span>:</span> xmobar.hs
    <span>dependencies</span><span>:</span>
      <span>-</span> xmobar
    <span>ghc-options</span><span>:</span> <span>-</span>rtsopts <span>-</span>threaded <span>-</span>with<span>-</span>rtsopts=<span>-</span>N</code><!----></pre> <p>You may have noticed a small icon beside my layout icons on the left side of
xmobar. The represent the current layout in a visual form. Try switching layouts
with <code>alt+space</code> and see the icons change.</p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-xmobar.png" alt="xmobar"/></p> <pre><!----><code><span>myXmobarPP</span> <span>=</span>
  <span>def</span>
    <span>{</span> <span>ppLayout</span> <span>=</span>
        <span></span><span>case</span>
          <span>&#34;Columns&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=Columns.xpm/&gt;&#34;</span>
          <span>&#34;MagnifiedColumns&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=MagnifiedColumns.xpm/&gt;&#34;</span>
          <span>&#34;Full&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=Full.xpm/&gt;&#34;</span>
          <span>&#34;Tall&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=Tall.xpm/&gt;&#34;</span>
          <span>&#34;ThreeCol&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=MagnifiedColumns.xpm/&gt;&#34;</span>
          <span>&#34;2-by-3 (left)&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=TwoByThreeLeft.xpm/&gt;&#34;</span>
          <span>&#34;2-by-3 (right)&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=TwoByThreeRight.xpm/&gt;&#34;</span>
          <span>&#34;2x3 LT&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=TwoByThreeLeftWithTabs.xpm/&gt;&#34;</span>
          <span>&#34;2x3 RT&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=TwoByThreeRightWithTabs.xpm/&gt;&#34;</span>
          <span>&#34;Tiled&#34;</span> <span>-&gt;</span> <span>&#34;&lt;icon=Tiled.xpm/&gt;&#34;</span>
          <span>_</span> <span>-&gt;</span> <span>&#34;&lt;icon=Unknown.xpm/&gt;&#34;</span>
    <span>}</span>

<span>main</span> <span>=</span>
  <span>xmonad</span>
    <span>.</span> <span>withEasySB</span> <span>(</span><span>statusBarProp</span> <span>&#34;xmobar&#34;</span> <span>(</span><span>pure</span> <span>myXmobarPP</span><span>)</span><span>)</span> <span>defToggleStrutsKey</span>
    <span>$</span> <span>myConfig</span></code><!----></pre> <h2>3.6. Scratchpads in action</h2> <p>I am using 4 scratchpads in total. Each scratchpad is mapped to a keybinding.</p> <pre><!----><code>  <span>[</span>
  
  <span>(</span><span>(</span><span>modm</span><span>,</span> <span>xK_Return</span><span>)</span><span>,</span> <span>namedScratchpadAction</span> <span>myScratchpads</span> <span>&#34;terminal&#34;</span><span>)</span>
  
  <span>,</span> <span>(</span><span>(</span><span>modm</span><span>,</span> <span>xK_x</span><span>)</span><span>,</span> <span>namedScratchpadAction</span> <span>myScratchpads</span> <span>&#34;Kanboard&#34;</span><span>)</span>
  
  <span>,</span> <span>(</span><span>(</span><span>modm</span><span>,</span> <span>xK_z</span><span>)</span><span>,</span> <span>namedScratchpadAction</span> <span>myScratchpads</span> <span>&#34;CalibreWeb&#34;</span><span>)</span>
  
  <span>,</span> <span>(</span><span>(</span><span>modm</span><span>,</span> <span>xK_m</span><span>)</span><span>,</span> <span>namedScratchpadAction</span> <span>myScratchpads</span> <span>&#34;Anki&#34;</span><span>)</span>
  <span>]</span>

<span>myScratchpads</span>
 <span>=</span>
  <span>[</span> <span>NS</span> <span>&#34;terminal&#34;</span> <span>spawnTerm</span> <span>findTerm</span> <span>manageTerm</span>
  <span>,</span> <span>NS</span> <span>&#34;Kanboard&#34;</span> <span>spawnKanboard</span> <span>(</span><span>className</span> <span>=?</span> <span>&#34;Kanboard&#34;</span><span>)</span> <span>doFullFloat</span>
  <span>,</span> <span>NS</span> <span>&#34;Anki&#34;</span> <span>spawnAnki</span> <span>(</span><span>className</span> <span>=?</span> <span>&#34;Anki&#34;</span><span>)</span> <span>doFullFloat</span>
  <span>,</span> <span>NS</span> <span>&#34;CalibreWeb&#34;</span> <span>spawnCalibreWeb</span> <span>(</span><span>className</span> <span>=?</span> <span>&#34;CalibreWeb&#34;</span><span>)</span> <span>doFullFloat</span>
  <span>]</span>
  <span>...</span></code><!----></pre> <p>I realized that I don’t really open new terminals that often because I use tmux
(with <a href="https://github.com/tmux-plugins/tmux-resurrect" rel="noopener noreferrer" target="_blank">tmux-resurrect</a> and <a href="https://github.com/tmux-plugins/tmux-continuum" rel="noopener noreferrer" target="_blank">tmux-continuum</a>). So I remapped <code>alt+enter</code> with showing the terminal scratchpad, instead of the usual, open a new terminal.</p> <p>I can open up the calibre-web instance with <code>alt+z</code>, and immediately resume
whatever I was reading.</p> <p><img src="https://wssite.vercel.app/posts/moving-back-to-a-tiling-wm-xmonad-calibreweb.gif" alt="Calibre-Web gif"/></p> <p><em>If you have any questions for me, head over to this <a href="https://github.com/weirdsmiley/wssite-content/discussions/3" title="Post discussion" rel="noopener noreferrer" target="_blank">discussion page</a>.</em></p><!--]--><!----></div></div></div>
  </body>
</html>
