<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/mendableai/open-lovable">Original</a>
    <h1>Open Lovable</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>This post is part of the <a href="https://rgoswami.me/series/reproducible-research/">Reproducible Research</a> series.</p></div><blockquote><p>Usage notes for data storage within university constraints.</p></blockquote><h2 id="background">Background</h2><p>The University of Iceland has an “unlimited” OneDrive setup for staff / graduate
students. This is generally not very helpful, but in conjunction with <code>rclone</code>
<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> and
<code>dvc</code> can be made to be of more use.</p><h2 id="baseline">Baseline</h2><p>Like most of my newer projects, <code>pixi</code> is used to manage the tooling required,
along with <code>git-subrepo</code> for handling local changes to projects.</p><p>As before, we will assume <code>gnome-keyring</code> is present, and then since <code>rclone</code>
<a href="https://rclone.org/docs/#configuration-encryption">supports secrets</a> stored in password managers we have<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup>:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span>secret-tool store --label<span>=</span><span>&#34;dvc&#34;</span> service <span>&#34;rclone&#34;</span> project <span>&#34;gprd_dimer&#34;</span>
</span></span></code></pre></div><p>Which can then simply be set to <code>RCLONE_PASSWORD_COMMAND</code> and used directly:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span><span>export</span> <span>RCLONE_PASSWORD_COMMAND</span><span>=</span><span>&#39;secret-tool lookup service &#34;rclone&#34; project &#34;gprd_dimer&#34;&#39;</span>
</span></span><span><span>2</span><span>rclone config --ask-password<span>=</span><span>false</span>
</span></span></code></pre></div><p>We don’t want duplication. So there has to be a question of if we want to use
the artifact uploaded directly to an S3 instance or if we want to use local and
let DVC handle putting it on a bucket if need be.</p><p>Rather than use the local NAS approach of letting DVC take an absolute path to
an <code>rclone mount</code> point, it is a bit nicer to use an <code>rclone server</code> WebDAV
instance instead.</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span>pixi add dvc-webdav
</span></span><span><span>2</span><span><span># In one terminal</span>
</span></span><span><span>3</span><span>rclone serve webdav HIOneDrive:/.dvcstore --vfs-cache-mode full --addr unix:///tmp/dvc.hi.socket
</span></span><span><span>4</span><span><span># In another</span>
</span></span><span><span>5</span><span>dvc remote add -d HIOneDrive webdavs:///tmp/dvc.hi.socket
</span></span></code></pre></div><p>Where we assume that <code>rclone</code> is configured as per the <a href="https://rclone.org/onedrive/">OneDrive instructions</a>.
Since there are no sensitive details in any of the above commands, it is alright
to have DVC store this configuration and track it with <code>git</code>.</p><h2 id="handling-ssl-errors">Handling SSL errors</h2><p>Annoyingly, it turns out that even with <code>ssl_verify false</code>, an SSL record layer
error will be thrown if the WebDAV instance doesn’t offer SSL.</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span>dvc remote modify hionedrive ssl_verify <span>false</span>
</span></span><span><span>2</span><span>dvc push
</span></span><span><span>3</span><span>Collecting                                                                                                                                                            <span>|</span>0.00 <span>[</span>00:00,    ?entry/s<span>]</span>
</span></span><span><span>4</span><span>Pushing
</span></span><span><span>5</span><span>ERROR: unexpected error - <span>[</span>SSL<span>]</span> record layer failure <span>(</span>_ssl.c:1000<span>)</span>: <span>[</span>SSL<span>]</span> record layer failure <span>(</span>_ssl.c:1000<span>)</span>
</span></span></code></pre></div><p>Which means that we need to setup a key pair, with the defaults, which is OK
since it will only be used locally:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span><span># Keep hitting enter to accept the defaults</span>
</span></span><span><span>2</span><span>openssl ecparam -out ec_key.pem -name prime256v1 -genkey
</span></span><span><span>3</span><span>openssl req -new -key ec_key.pem -x509 -nodes -days <span>365</span> -out cert.pem
</span></span></code></pre></div><p>This can now be used to serve the WebDAV instance:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span>rclone serve webdav HIOneDrive:/.dvcstore --vfs-cache-mode full --addr localhost:9677 --cert cert.pem --key ec_key.pem
</span></span></code></pre></div><p>It is important to note that DVC doesn’t care about the exact key-pair, and with
the current setup browsers will (correctly) raise
<code>net::ERR_CERT_AUTHORITY_INVALID</code> warnings <sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup> but will now merrily accept the connection (since <code>ssl_verify</code> is still off):</p><div><pre tabindex="0"><code data-lang="bash"><span><span>1</span><span>dvc push
</span></span><span><span>2</span><span>Collecting                                                          <span>|</span>0.00 <span>[</span>00:00,    ?entry/s<span>]</span>
</span></span><span><span>3</span><span>Pushing
</span></span><span><span>4</span><span><span>196</span> files pushed
</span></span></code></pre></div><h2 id="other-dvc-idiosyncracies">Other <code>dvc</code> idiosyncracies</h2><ul><li>Ignore folders in the <code>.gitignore</code>, else <code>dvc</code> may complain that the relevant <code>.dvc</code> is ignored by <code>git</code><ul><li>i.e. to ignore <code>best_trial_8/</code> don’t ignore <code>best_trial*</code> but use <code>best_trial*/</code></li></ul></li></ul><h2 id="conclusions">Conclusions</h2><p>This isn’t necessarily the most robust setup as written, given that the
University reclaims access pretty aggressively, however when coupled with the
<a href="https://archive.materialscloud.org/record/2025.91">Materials Archive</a> and a <a href="https://rgoswami.me/snippets/cold-storage-compression/">strong compression technique</a> for personal storage via
<code>borg</code> it is fairly resilient.</p><hr/><div><h2>Series info</h2><h3>Reproducible Research series</h3><ol><li><b>Storing data with DVC and OneDrive</b> &lt;-- You are here!</li></ol></div></div></div>
  </body>
</html>
