<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hugocisneros.com/blog/my-org-roam-notes-workflow/">Original</a>
    <h1>My Org Roam Notes Workflow (2021)</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
          <p>Some people expressed interest in my <a href="https://www.orgroam.com/">org roam</a> <a href="https://hugocisneros.com/notes/">notes</a> workflow. Setting this up has been an interesting project, teaching me about <a href="https://hugocisneros.com/notes/emacs">Emacs</a>, <a href="https://hugocisneros.com/notes/org_mode">org-mode</a> and a little about web frontend. This post will describe my current workflow in as much details as possible.</p>
          <p>Hopefully, you’ll learn to create an automated build script to publish your notes on the web and convert your org-roam note network into a graph like the one below.</p>
          <figure itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject">
            <img itemprop="url" src="https://hugocisneros.com/img/note-graph.svg" alt="Note graph screenshot"/>
            <figcaption>
              <h4 itemprop="name">Note graph screenshot</h4>
            </figcaption>
          </figure><p>For the interactive version, see <a href="https://hugocisneros.com/notes/">my notes</a>.
          </p><h2 id="the-notes">The notes</h2>
          <p>For the past years I have been trying to get into the habit of writing down new pieces of knowledge into notes. I am committed to this idea of keeping track of what I read and learn about. It can also be nice to come back to some of these notes to remind myself about a subject or make connections with something I learned.</p>
          <h3 id="why-org-roam">Why org-roam?</h3>
          <p>When searching for the right way to organize and keep track of these notes, I ended up hearing about org-roam. I went through <a href="https://blog.jethro.dev/posts/how%5Fto%5Ftake%5Fsmart%5Fnotes%5Forg">this great blog post</a> by Jethro Kuan which details why he started org-roam.</p>
          <p>The “roam” in org-roam refers to <a href="https://roamresearch.com/">Roam Research</a>, a standalone note-taking tool that people seem to praise. The tool is closed source for now and not cheap, making some people seek free alternatives. Org-roam seems like a great alternative, but not for everybody. Being an org-mode based tool makes it ideal for Emacs users, but may involve a steep learning curve for other users. If you’ve never heard about org-mode, you may want to read <a href="https://orgmode.org/worg/">this introduction</a>. The tool is incredibly useful, but it takes time to get used to it.</p>
          <p>I haven’t thoroughly researched other alternatives, but <a href="https://github.com/athensresearch/athens">Athens</a> seems to fill the gap: it’s open-source, it looks user-friendly and not tied to an editor.</p>
          <p>Personally, I prefer to stick with org-roam for three main reasons:</p>
          <ul>
            <li>I am already a heavy user of Emacs and org-mode and a lot of features and Emacs tools integrate well with org-roam</li>
            <li>I can export the files to my site (I detail how in <a href="#publishing">Publishing</a>)
            </li>
            <li>The source files are plain text (with org-mode markup). This means that even if Emacs and org-mode and all related software were to disappear, or more probably, if I decide to manage my notes with something else, I can still export all the content and translate it into whichever format I want</li>
          </ul>
          <p>If you are interested in Emacs and would like to see my setup, <a href="https://github.com/hugcis/dotfiles">I publish my dotfiles</a>. You can also read the detailed and commented version of <a href="https://hugocisneros.com/org-config/">my org-mode configuration</a>, or jump directly to the <a href="https://hugocisneros.com/org-config/#org-roam">org-roam configuration</a>.</p>
          <h3 id="organizing-knowledge-in-org-roam">Organizing knowledge in org-roam</h3>
          <p>The goal of org-roam is to create a web of notes linked between each other. By linking notes in a non-hierarchical way, one can make connections between topics and remember them without going through the hassle of creating a hierarchical tag system where it’s never clear if a note should belong to tag “A” or its parent “B”, etc.</p>
          <p>There are plenty of different techniques for taking notes with a tool like this, but I don’t follow any particular one.</p>
          <p>This is what an org-roam note looks like as raw source (Emacs makes this much prettier in practice):</p>
          <div>
            <pre tabindex="0"><code data-lang="org"><span>:PROPERTIES:
</span><span>:ID:       9fd080fa-a9a1-4d85-a6bf-682b41a67b72
</span><span>:ROAM_ALIASES: &#34;ML&#34;
</span><span>:END:</span>
<span>#+TITLE</span><span>: Machine learning</span>

<span>- tags ::</span> [[id:1b23dc1d-c276-4f95-866a-ad8e37dd544f][<span>Artificial Intelligence</span>]]

Machine learning is about constructing algorithms that can approximate complex
functions from observations of input/output pairs. Machine learning is related to
[[id:ce8b2ebe-f42e-4e4b-b0af-2a4563ef9fc0][<span>Statistics</span>]] since its goal is to make 
predictions based on data.

Examples of such functions include:
<span>- </span>[[id:33ebc467-8c6c-43bc-b8b4-ba1971c75a37][<span>Image classification</span>]]
<span>- </span>Time-series prediction
<span>- </span>[[id:e72f23c2-d3a7-47df-87a6-5de09f820ecf][<span>Language modeling</span>]]
</code></pre>
          </div>
          <p>The first 5 lines are a header containing the title of the note, an alias (an alternative name I can use to search for the note within org-roam) and an ID (automatically generated with <code>org-id</code>).</p>
          <p>The rest is org-mode markup with some links to other notes (they also have unique IDs).</p>
          <h2 id="publishing">Publishing</h2>
          <p>Sharing knowledge as much as possible is essential. I also think that it’s even better to share the learning process and the steps to acquiring that knowledge because this is what will help your brain make the right connections and remember what you wrote.</p>
          <p>My notes are a constant work in progress. I will change them, enrich them or delete them as I learn. Let this be a disclaimer too: I might write notes that are not true or the sole result of my uninformed opinion.</p>
          <p>Other people might have something to say about these thoughts and some have contacted me to discuss it. Interesting discussions have started from these notes.</p>
          <h3 id="exporting-the-notes">Exporting the notes</h3>
          <p>The first step to publishing is to export the org-roam notes to the language of the web: HTML.</p>
          <h4 id="simple-html">Simple HTML</h4>
          <p>The simplest way is to use org’s embedded HTML export function (for example you can call <code>M-x org-html-export-to-html</code> when the note is open). For the note above, this will give you this simple HTML result:</p>
          <figure itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject">
            <img itemprop="url" src="https://hugocisneros.com/img/note-html.png" alt="Note exported to plain HTML"/>
            <figcaption>
              <h4 itemprop="name">Note exported to plain HTML</h4>
            </figcaption>
          </figure>
          <p>Plain HTML + styling is more than enough to get a decent site with all your notes.</p>
          <h4 id="hugo">Hugo</h4>
          <p>I use a static site generator called <a href="https://gohugo.io/">Hugo</a> for my website, so I chose to go down the slightly more complicated path of exporting the notes to Hugo’s Markdown format and using Hugo to generate the final HTML. This allows for more flexibility and the possibility to automatically and generate complex pages like <a href="https://hugocisneros.com/notes/">this one</a>.</p>
          <p>If you have <a href="https://ox-hugo.scripter.co/">ox-hugo</a> installed, exporting a note is as simple as calling <code>M-x org-hugo-export-wim-to-md</code> on your note. You should read the ox-hugo documentation to configure your site source path and other useful parameters.</p>
          <p>I automated the process with <a href="https://gist.github.com/hugcis/1f2d2ad4b98b07ee543f10232ba1b025">a few Elisp functions that I put in a Gist</a>. The last function loops through a file containing a note path on each line. For each line, it exports the note and deletes the line from the file.</p>
          <h2 id="the-graph">The graph</h2>
          <p>A great advantage of org-roam is that it stores all its useful information in a SQLite database. Don’t worry if you deleted it! Org-roam can rebuild it from the notes and all the links inside them. The database caches a lot of useful data but everything is still in the notes.</p>
          <p>The database has a table for the nodes and a table for the links, so there isn’t much work to do to get a graph!</p>
          <h3 id="read-the-org-roam-db">Read the org-roam DB</h3>
          <p>My org-roam database is at <code>~/.emacs.d/org-roam.db</code>. Here is the code that extracts all the information to build my note graph from the DB with 2 SQL queries and constructs a Python graph with the networkx library.</p>
          <p>SQL experts might scream at this.. these queries were the first that came to mind but there might be a better way of doing this! I’m dealing with small databases so performance isn’t a problem.</p>
          <div>
            <pre tabindex="0"><code data-lang="python"><span>import</span> networkx <span>as</span> nx
<span>import</span> pathlib
<span>import</span> sqlite3


<span>def</span> <span>to_rellink</span>(inp: <span>str</span>) <span>-&gt;</span> <span>str</span>:
    <span>return</span> pathlib<span>.</span>Path(inp)<span>.</span>stem


<span>def</span> <span>build_graph</span>() <span>-&gt;</span> nx<span>.</span>Digraph:
    <span>&#34;&#34;&#34;Build a graph from the org-roam database.&#34;&#34;&#34;</span>
    graph <span>=</span> nx<span>.</span>DiGraph()
    home <span>=</span> pathlib<span>.</span>Path<span>.</span>home()
    conn <span>=</span> sqlite3<span>.</span>connect(home <span>/</span> <span>&#34;.emacs.d&#34;</span> <span>/</span> <span>&#34;org-roam.db&#34;</span>)

    <span># Query all nodes first</span>
    nodes <span>=</span> conn<span>.</span>execute(<span>&#34;SELECT file, id, title FROM nodes WHERE level = 0;&#34;</span>)
    <span># A double JOIN to get all nodes that are connected by a link</span>
    links <span>=</span> conn<span>.</span>execute(<span>&#34;SELECT n1.id, nodes.id FROM ((nodes AS n1) &#34;</span>
                         <span>&#34;JOIN links ON n1.id = links.source) &#34;</span>
                         <span>&#34;JOIN (nodes AS n2) ON links.dest = nodes.id &#34;</span>
                         <span>&#34;WHERE links.type = &#39;</span><span>\&#34;</span><span>id</span><span>\&#34;</span><span>&#39;;&#34;</span>)
    <span># Populate the graph</span>
    graph<span>.</span>add_nodes_from((n[<span>1</span>], {
        <span>&#34;label&#34;</span>: n[<span>2</span>]<span>.</span>strip(<span>&#34;</span><span>\&#34;</span><span>&#34;</span>),
        <span>&#34;tooltip&#34;</span>: n[<span>2</span>]<span>.</span>strip(<span>&#34;</span><span>\&#34;</span><span>&#34;</span>),
        <span>&#34;lnk&#34;</span>: to_rellink(n[<span>0</span>])<span>.</span>lower(),
        <span>&#34;id&#34;</span>: n[<span>1</span>]<span>.</span>strip(<span>&#34;</span><span>\&#34;</span><span>&#34;</span>)
    }) <span>for</span> n <span>in</span>  nodes)
    graph<span>.</span>add_edges_from(n <span>for</span> n <span>in</span> links <span>if</span> n[<span>0</span>] <span>in</span> graph<span>.</span>nodes <span>and</span> n[<span>1</span>] <span>in</span> graph<span>.</span>nodes)
    conn<span>.</span>close()
    <span>return</span> graph
</code></pre>
          </div>
          <h3 id="some-graph-analysis">Some graph analysis</h3>
          <p>This second script starts by constructing the graph with the function above. Then, it applies 3 graph algorithms:</p>
          <ul>
            <li>Compute the PageRank score for each vertex and store it as the <code>centrality</code> attribute. This will be used to size the nodes</li>
            <li>Do a clustering of the nodes into <code>N_COM</code> clusters and store the community in the vertex attribute <code>communityLabel</code></li>
            <li>Add <code>N_MISSING</code> “predicted” links to enable discovery of new hidden connections between nodes. This uses <a href="https://networkx.org/documentation/stable/reference/algorithms/generated/networkx.algorithms.link_prediction.ra_index_soundarajan_hopcroft.html#networkx.algorithms.link_prediction.ra_index_soundarajan_hopcroft"><code>networkx</code>’s implementation</a> of Soundarajan and Hopcroft’s method for link prediction
            </li>
          </ul>
          <div>
            <pre tabindex="0"><code data-lang="python"><span>import</span> itertools
<span>import</span> json
<span>import</span> sys

<span>import</span> networkx <span>as</span> nx
<span>import</span> networkx.algorithms.link_analysis.pagerank_alg <span>as</span> pag
<span>import</span> networkx.algorithms.community <span>as</span> com
<span>from</span> networkx.drawing.nx_pydot <span>import</span> read_dot
<span>from</span> networkx.readwrite <span>import</span> json_graph

<span>from</span> build_graph_from_org_roam_db <span>import</span> build_graph

N_COM <span>=</span> <span>7</span>  <span># Desired number of communities</span>
N_MISSING <span>=</span> <span>20</span>  <span># Number of predicted missing links</span>
MAX_NODES <span>=</span> <span>200</span>  <span># Number of nodes in the final graph </span>

<span>def</span> <span>compute_centrality</span>(dot_graph: nx<span>.</span>DiGraph) <span>-&gt;</span> <span>None</span>:
    <span>&#34;&#34;&#34;Add a `centrality` attribute to each node with its PageRank score.
</span><span>    &#34;&#34;&#34;</span>
    simp_graph <span>=</span> nx<span>.</span>Graph(dot_graph)
    central <span>=</span> pag<span>.</span>pagerank(simp_graph)
    min_cent <span>=</span> <span>min</span>(central<span>.</span>values())
    central <span>=</span> {i: central[i] <span>-</span> min_cent <span>for</span> i <span>in</span> central}
    max_cent <span>=</span> <span>max</span>(central<span>.</span>values())
    central <span>=</span> {i: central[i] <span>/</span> max_cent <span>for</span> i <span>in</span> central}
    nx<span>.</span>set_node_attributes(dot_graph, central, <span>&#34;centrality&#34;</span>)
    sorted_cent <span>=</span> <span>sorted</span>(dot_graph, key<span>=</span><span>lambda</span> x: dot_graph<span>.</span>nodes[x][<span>&#34;centrality&#34;</span>])
    <span>for</span> n <span>in</span> sorted_cent[:<span>-</span>MAX_NODES]:
        dot_graph<span>.</span>remove_node(n)


<span>def</span> <span>compute_communities</span>(dot_graph: nx<span>.</span>DiGraph, n_com: <span>int</span>) <span>-&gt;</span> <span>None</span>:
    <span>&#34;&#34;&#34;Add a `communityLabel` attribute to each node according to their
</span><span>    computed community.
</span><span>    &#34;&#34;&#34;</span>
    simp_graph <span>=</span> nx<span>.</span>Graph(dot_graph)
    communities <span>=</span> com<span>.</span>girvan_newman(simp_graph)
    labels <span>=</span> [<span>tuple</span>(<span>sorted</span>(c) <span>for</span> c <span>in</span> unities) <span>for</span> unities <span>in</span>
              itertools<span>.</span>islice(communities, n_com <span>-</span> <span>1</span>, n_com)][<span>0</span>]
    label_dict <span>=</span> {l_key: i <span>for</span> i <span>in</span> <span>range</span>(<span>len</span>(labels)) <span>for</span> l_key <span>in</span> labels[i]}
    nx<span>.</span>set_node_attributes(dot_graph, label_dict, <span>&#34;communityLabel&#34;</span>)


<span>def</span> <span>add_missing_links</span>(dot_graph: nx<span>.</span>DiGraph, n_missing: <span>int</span>) <span>-&gt;</span> <span>None</span>:
    <span>&#34;&#34;&#34;Add some missing links to the graph by using top ranking inexisting
</span><span>    links by ressource allocation index.
</span><span>    &#34;&#34;&#34;</span>
    simp_graph <span>=</span> nx<span>.</span>Graph(dot_graph)
    preds <span>=</span> nx<span>.</span>ra_index_soundarajan_hopcroft(simp_graph, community<span>=</span><span>&#34;communityLabel&#34;</span>)
    new <span>=</span> <span>sorted</span>(preds, key<span>=</span><span>lambda</span> x: <span>-</span>x[<span>2</span>])[:n_missing]
    <span>for</span> link <span>in</span> new:
        sys<span>.</span>stderr<span>.</span>write(<span>f</span><span>&#34;Predicted edge </span><span>{</span>link[<span>0</span>]<span>}</span><span> </span><span>{</span>link[<span>1</span>]<span>}</span><span>\n</span><span>&#34;</span>)
        dot_graph<span>.</span>add_edge(link[<span>0</span>], link[<span>1</span>], predicted<span>=</span>link[<span>2</span>])


<span>if</span> __name__ <span>==</span> <span>&#34;__main__&#34;</span>:
    sys<span>.</span>stderr<span>.</span>write(<span>&#34;Reading graph...&#34;</span>)
    DOT_GRAPH <span>=</span> build_graph()
    compute_centrality(DOT_GRAPH)
    compute_communities(DOT_GRAPH, N_COM)
    add_missing_links(DOT_GRAPH, N_MISSING)
    sys<span>.</span>stderr<span>.</span>write(<span>&#34;Done</span><span>\n</span><span>&#34;</span>)
    JS_GRAPH <span>=</span> json_graph<span>.</span>node_link_data(DOT_GRAPH)
    sys<span>.</span>stdout<span>.</span>write(json<span>.</span>dumps(JS_GRAPH))
</code></pre>
          </div>
          <p>The script writes the graph in JSON format to <code>stdout</code> with <code>networkx</code>’s JSON export function. It looks something like this (you can find the actual graph represented on my notes page <a href="https://hugocisneros.com/js/graph.json">here</a>):</p>
          <div>
            <pre tabindex="0"><code data-lang="json">{
   <span>&#34;directed&#34;</span> : <span>true</span>,
   <span>&#34;graph&#34;</span> : {},
   <span>&#34;links&#34;</span> : [
      {
         <span>&#34;source&#34;</span> : <span>&#34;012f1087-bae9-4bbf-b468-114169782b5b&#34;</span>,
         <span>&#34;target&#34;</span> : <span>&#34;2fc873e6-d61d-43e3-9dd1-635f54b4114f&#34;</span>,
         <span>&#34;predicted&#34;</span> : <span>0.676190476190476</span>,
      },
      {
         <span>&#34;source&#34;</span> : <span>&#34;012f1087-bae9-4bbf-b468-114169782b5b&#34;</span>,
         <span>&#34;target&#34;</span> : <span>&#34;89569187-fcdc-4ebf-8608-75bfb129e8c2&#34;</span>
      },
      ...
   ],
   <span>&#34;nodes&#34;</span>: [
      {
         <span>&#34;centrality&#34;</span> : <span>0.0848734602948687</span>,
         <span>&#34;communityLabel&#34;</span> : <span>0</span>,
         <span>&#34;id&#34;</span> : <span>&#34;012f1087-bae9-4bbf-b468-114169782b5b&#34;</span>,
         <span>&#34;label&#34;</span> : <span>&#34;CPPN&#34;</span>,
         <span>&#34;lnk&#34;</span> : <span>&#34;cppn&#34;</span>,
         <span>&#34;tooltip&#34;</span> : <span>&#34;CPPN&#34;</span>
      },
      {
         <span>&#34;centrality&#34;</span> : <span>0.0593788434729073</span>,
         <span>&#34;communityLabel&#34;</span> : <span>0</span>,
         <span>&#34;id&#34;</span> : <span>&#34;b495ae71-9ed6-4ef1-8917-45b490bca56f&#34;</span>,
         <span>&#34;label&#34;</span> : <span>&#34;Neural tangent kernel&#34;</span>,
         <span>&#34;lnk&#34;</span> : <span>&#34;neural_tangent_kernel&#34;</span>,
         <span>&#34;tooltip&#34;</span> : <span>&#34;Neural tangent kernel&#34;</span>
      },
      ...
   ]
}
</code></pre>
          </div>
          <h3 id="some-frontend-with-d3-dot-js">Some frontend with D3.js</h3>
          <p>You will find the JavaScript code for handling the D3 graph construction <a href="https://github.com/hugcis/hugcis.github.io/blob/master/js/graph.js">here</a>. To create the graph I started from this <a href="https://observablehq.com/@d3/force-directed-graph">D3 Observable tutorial on making force-directed graph</a>. Getting something decent-looking is straightforward with D3.</p>
          <p>The main SVG source where the graph is drawn is defined in the <code>&lt;div&gt;</code> with id <code>main-graph</code> <a href="https://github.com/hugcis/hugcis.github.io/blob/master/notes/index.html#L56-L65">here</a>. There are two components in there: a filter definition and the main rectangle where the graph is drawn.</p>
          <p>The filter is shown below. I use it for the tooltips when you point a vertex with your mouse. The tooltips are composed of two elements: the text and a background, that is a rectangle bounding box around the text with the text cut out (it’s what the filter does).</p>
          <div>
            <pre tabindex="0"><code data-lang="svg"><span>&lt;defs&gt;</span>
    <span>&lt;filter</span> x=<span>&#34;0&#34;</span> y=<span>&#34;0&#34;</span> width=<span>&#34;1&#34;</span> height=<span>&#34;1&#34;</span> id=<span>&#34;solid&#34;</span><span>&gt;</span>
        <span>&lt;feFlood</span> flood-color=<span>&#34;#f7f7f7&#34;</span> flood-opacity=<span>&#34;0.9&#34;</span><span>/&gt;</span>
        <span>&lt;feComposite</span> in=<span>&#34;SourceGraphic&#34;</span> operator=<span>&#34;xor&#34;</span> <span>/&gt;</span>
    <span>&lt;/filter&gt;</span>
<span>&lt;/defs&gt;</span>
</code></pre>
          </div>
          <h2 id="conclusion">Conclusion</h2>
          <p>That’s all I have for you. I realize this might look like a complicated bunch of scripts, but this setup works well for me now. <a href="https://github.com/jethrokuan/dots">Jethro Kuans’s dotfiles</a> and <a href="https://github.com/jethrokuan/braindump">Braindump source</a> were a great source of inspiration. It notably helped for the Elisp part for which I have less experience.</p>
          <p>Getting into the habit of taking notes has been a great experience for me. I no longer fear forgetting ideas or useful thoughts as long as I write them in my “second brain”.</p>
          <p>I hope this post was informative, and it will help you get a nice note website up and running! Enjoy!</p>
        </div></div>
  </body>
</html>
