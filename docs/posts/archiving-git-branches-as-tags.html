<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://etc.octavore.com/2025/12/archiving-git-branches-as-tags/">Original</a>
    <h1>Archiving Git branches as tags</h1>
    
    <div id="readability-page-1" class="page"><div>
      

      <main>
        
  <div>
    <article>
      
      <section>
        <div>
          <p>I have a spicy git alias that allows me to &#34;archive&#34; old git branches by converting them to tags, making them less visible across git tooling.</p>
<pre><code># ~/.gitconfig
[alias]
archive-branch = &#34;!f() { \
    : git switch; \
    local git_branch=${1:-$(git branch --show-current)}; \
    git co main &amp;&amp; \
      git tag archive/$git_branch $git_branch &amp;&amp; \
      git branch -D $git_branch; \
  }; f&#34;
</code></pre>
<p>The magic of this alias is that aside from tagging and deleting the branch as desired, it also adds support for shell completion so I can tab complete the branch I want to archive (if not the current branch I&#39;m on).</p>
<p>This is accomplished by the strange magic of wrapping the alias in an immediately executed bash function (<code>!f() { ... }; f</code>) and having the first line be <code>: git switch</code>. <code>git switch</code> isn&#39;t actually run; it&#39;s a hint to git to use the same completion for this alias as <code>git switch</code> (<a href="https://stackoverflow.com/questions/57417378/how-can-i-make-tab-completion-for-my-git-alias-behave-like-an-existing-command?ref=etc.octavore.com">via</a> and <a href="https://github.com/git/git/blob/45547b60aca32b45d2f1ef93462cf9df28637c13/contrib/completion/git-completion.bash?ref=etc.octavore.com#L26-L32">source</a>).</p>
<p><strong>Important note</strong>: the strange magic requires the official git completion script. <code>zsh</code> comes with its own <a href="https://github.com/zsh-users/zsh/blob/master/Completion/Unix/Command/_git?ref=etc.octavore.com">git completion</a> which does not support specifying the completion style, so you&#39;ll also have to make sure <code>zsh</code> loads the official completion. On macOS, if using the Xcode Developer Tools version of git, you can link it into <code>/usr/local/share/zsh/site-functions</code> like so:</p>
<pre><code>sudo mkdir -p /usr/local/share/zsh/site-functions
sudo ln -s /Applications/Xcode.app/Contents/Developer/usr/share/git-core/git-completion.zsh \
  /usr/local/share/zsh/site-functions/_git
</code></pre>
<p>And then adding the following to <code>.zshrc</code>, because <code>git-completion.zsh</code> relies on <code>git-completion.bash</code>.</p>
<pre><code># ~/.zshrc
# you may already have this line
autoload -Uz compinit &amp;&amp; compinit

zstyle &#39;:completion:*:*:git:*&#39; script /Applications/Xcode.app/Contents/Developer/usr/share/git-core/git-completion.bash
</code></pre>
<p>Credit for original idea goes to this <a href="https://www.reddit.com/r/git/comments/1gi6idg/whats_good_practice_for_archiving_old_branches/?ref=etc.octavore.com">reddit thread</a>.</p>

        </div>
      </section>
    </article>
  </div>

      </main>

          </div></div>
  </body>
</html>
