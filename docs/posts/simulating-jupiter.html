<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://emildziewanowski.com/flowfields/">Original</a>
    <h1>Simulating Jupiter</h1>
    
    <div id="readability-page-1" class="page"><div data-simplebar="">
            <div>
                                    <article>
                        <div>
                            
                            
<p>Realistic is not necessarily the most convincing. Audio designers know that well and use frozen leeks and watermelons to create sounds of breaking bones and tearing flesh. Chalk shot from slingshot was safer alternative for actual firearms in old westerns. Fake doesn’t have to mean worse, especially when it is hard to tell the difference. With that in mind I will try to create complex flow without using computational fluid dynamics.</p>







<h2>New, Better Jupiter</h2>



<p>Jupiter’s is undeniably beautiful, but it’s safest to admire it from a distance. Characteristic patterns observed on the surface are, in fact, massive storms and Earth-sized cyclones. Jovian winds can reach speeds of hundreds of kilometers per hour, although they may appear quaint from orbit.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/JupiterJuno.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-746&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img fetchpriority="high" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterJuno-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterJuno-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterJuno-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterJuno-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterJuno-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterJuno-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>I plan to feature a Jupiter-like planet as part of the skybox. While not a unique concept and often seen in the sci-fi genre, I want to take it a step further by animating it. In reality, the motion of the atmosphere is too slow to be noticed. However, I will speed it up substantially to make the movement obvious. This should capture players’ attention and remind them that the action is taking place on a distant, alien world.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/JupiterConcept.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-372&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/JupiterConcept-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/JupiterConcept-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/JupiterConcept-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/JupiterConcept-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/JupiterConcept-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/JupiterConcept-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h2>Flow</h2>



<p>While I don’t want to create a carbon copy of Jupiter, there is a set of features that immediately come to mind when thinking about gas planet. Hopefully, by recreating these, I will get the visuals reminiscent of Jupiter.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/JupiterFlow.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large is-resized&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-625&#34;,&#34;imgStyles&#34;:&#34;width:840px;height:auto&#34;,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterFlow-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterFlow-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterFlow-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterFlow-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterFlow-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterFlow-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>There are three distinct flow patterns I want to replicate :</p>



<ul>
<li>Cyclones: A couple of large, easily identifiable vortices, much like Jupiter’s ‘Great Red Spot.’ Typically elongated, they are often accompanied by a ‘wake’ – a trail of secondary vortices.</li>



<li>Jets: These are linear currents that run parallel to the equator, with easily visible turbulent transition layers.</li>



<li>Storms: Smaller, more volatile, and less defined flow structures that contribute to the texture of the atmosphere.</li>
</ul>



<h2>Animating Fluids</h2>



<p>Recreating water or any other sort of fluid in games is challenging. Computational fluid dynamics is demanding in terms of memory and processing power, but that hasn’t prevented game developers from including water in their games. With a set of clever hacks and workarounds, there is no need for expensive simulation.</p>



<h3>Color Cycling</h3>



<p>Color cycling is a technique with a long history, dating back to systems like the NES. It’s akin to painting by numbers, where colors representing different numbers change each frame. Despite its simplicity, when applied to well-prepared input sprites, it can produce eye-catching effects.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/ContraPaletteCycling.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-322&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/ContraPaletteCycling-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/ContraPaletteCycling-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/ContraPaletteCycling-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/ContraPaletteCycling-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/ContraPaletteCycling-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/ContraPaletteCycling-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>







<h3>Frame-by-Frame Animation</h3>



<p>For a while, the frame-by-frame approach was the standard solution. Each frame was stored as a separate sprite, which demanded a lot of memory. As a result, this method was typically reserved for short animation loops consisting of only a few frames.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/FrameByFrame.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-324&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/FrameByFrame-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/FrameByFrame-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/FrameByFrame-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/FrameByFrame-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/FrameByFrame-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/FrameByFrame-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Limited number of animation frames leads to a ‘choppy’ motion, typical of 90s shooters.</p>







<h3>Texture Scrolling</h3>



<p>As soon as games moved into fully textured 3D environments, texture scrolling became a viable option for creating rivers. This method involves incrementing one of the UV components over time to create the illusion of moving texture. When combined with appropriate geometry and shaders, texture scrolling can yield impressive results and remains a popular choice.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/TexturePanning.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-317&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/TexturePanning-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/TexturePanning-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/TexturePanning-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/TexturePanning-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/TexturePanning-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/TexturePanning-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>While versatile this technique is limited to laminar flow – it is non-trivial to add vortices or any other complex flow patterns.</p>







<h3>Quake UV Distortion</h3>



<p>Id Software, the developer behind Quake, is renowned for its innovations. The water distortion they created is rarely listed among them, but is still worth looking into. This simple formula lends Quake’s lava, water, and portals their distinctive appearance.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/QuakeLava-2.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-352&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/QuakeLava-2-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/QuakeLava-2-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/QuakeLava-2-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/QuakeLava-2-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/QuakeLava-2-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/QuakeLava-2-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Although it’s straightforward to replicate using shaders, the original effect was made without them, relying instead on software rendering.</p>







<h3>Unreal WaterPaint</h3>



<p>WaterPaint is one of the most intriguing methods for simulating fluids in games, yet it’s also one of the most challenging to understand. It appears to generate the surface of the liquid and subsequently uses this information to distort a texture. The system’s complexity borders on overengineering, particularly given that the resulting effect is often overlooked in a fast-paced shooter.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/Waterpaint-2.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-311&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/Waterpaint-2-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/Waterpaint-2-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/Waterpaint-2-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/Waterpaint-2-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/Waterpaint-2-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/Waterpaint-2-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Similarly to Quake this technique also predates shaders. Texture pixels are manipulated by CPU and then sampled just like in the case of normal texture. </p>







<p>The methods mentioned are decades old and, on their own, may not hold up well today. However, they still have value as components within larger, more complex systems.</p>



<h2>Velocity Texture</h2>



<p>Let’s create a “universal” flow shader capable of representing any motion of the fluid. Intuitively, we’ll need two textures: one representing the color of the flowing substance, and another one storing the velocity field. This velocity field texture will be a 2-component 2D texture, with the red component representing the x component of the normalized velocity and the green component representing the y component.</p>



<figure><img loading="lazy" decoding="async" width="1024" height="576" src="https://emildziewanowski.com/wp-content/uploads/2024/03/VelocityFieldPacking-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/VelocityFieldPacking-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/VelocityFieldPacking-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/VelocityFieldPacking-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/VelocityFieldPacking-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/VelocityFieldPacking-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The velocity field is then used to incrementally modify the texture coordinates of the color texture, in the same manner like in the ‘Texture Scrolling’ described previously. However, in this case, the velocity values vary for each pixel.</p>







<p>The result, while interesting, is rather disappointing as it doesn’t accurately simulate fluid motion. Instead, it is an animated distortion that gradually bends the color texture over time. </p>



<p>The formula worked for simple scrolling because in that case the motion was linear and constant. At each point, the velocity was the same. However, here the velocity is more complex – it is defined per pixel. The correct approach would be to use integration.</p>



<h2>Euler Method</h2>



<p>Let’s simplify the problem. Imagine we have a tiny speck of dust sitting on the surface of water that’s moving. We describe the water’s movement using a texture that shows its velocity. Now, we want to figure out the path this speck of dust would take.</p>



<p>The first solution that comes to mind is to take a small step forward, check and update the velocity, then take another step using the updated velocity, and repeat this process. This is called Explicit Euler Method:</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/ExplicitEulerMethod.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-362&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/ExplicitEulerMethod-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/ExplicitEulerMethod-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/ExplicitEulerMethod-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/ExplicitEulerMethod-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/ExplicitEulerMethod-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/ExplicitEulerMethod-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The Explicit or Forward Euler method is often seen as the most basic and least accurate numerical integration method. The larger the integration step, denoted as “h,” the greater the error, and these errors accumulate over time. Even in the example shown, the integrated path represented by the orange arrows deviates significantly from the particle’s true path, depicted by the gray line. Fortunately this inaccuracy won’t be noticeable in the animation.</p>



<p>The problem is, it’s not easy to transform Euler Method directly into a shader. We need to keep track of the particle’s position after each step, and this is something shader alone cannot do. Position, in form of a deformed color texture, has to be stored in a texture.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/EulerTextureAndShader-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-367&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/EulerTextureAndShader-1-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/EulerTextureAndShader-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/EulerTextureAndShader-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/EulerTextureAndShader-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/EulerTextureAndShader-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/EulerTextureAndShader-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The shader reads the texture storing the color of the fluid and deforms it slightly based on the velocity texture. The resulting deformation is then written back into the color texture. This operation is performed every frame of the animation.</p>



<p>To complicate the problem further, it’s generally not possible to read from and write to the same texture in a fragment shader. Unreal Engine solves this problem with Canvas.</p>



<h2>Canvas Node Setup</h2>



<p>Canvas enables the use of a flow shader (Material) to be drawn into a Render Target texture. What sets Canvas apart is its capability to use the same Render Target in both the input and output of the flow shader, forming a feedback loop. To make this process work, several components are necessary:</p>



<ul>
<li>Render Target Texture: This image stores the state of the flow, or the color of the fluid in our case. It must be created before the animation begins and initial color has to be set.</li>



<li>Rendering Event: The process of updating the animation has to be performed every frame, or at least every frame the animated object is visible.</li>



<li>Flow Material Instance: An instance of the Flow Material is necessary, and it has to be supplied with its own Render Target Texture.</li>
</ul>



<p>Once all these elements are in place, the Rendering Event, which corresponds to one step of fluid simulation, can be achieved using just 3 nodes:</p>



<ul>
<li>Begin Draw Canvas to Render Target</li>



<li>Draw Material</li>



<li>End Draw </li>
</ul>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/CanvasNodeSetup.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-394&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/CanvasNodeSetup-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/CanvasNodeSetup-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/CanvasNodeSetup-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/CanvasNodeSetup-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/CanvasNodeSetup-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/CanvasNodeSetup-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>With everything set up, the resulting animation should look like this:</p>







<p>The initial image is shifted in a more fluid manner, with each pixel moving more continuously. However, it still falls short of resembling the motion of a liquid.</p>



<h2>Improving Velocity Field</h2>



<p>Up until now, we’ve relied on basic smoothed 2D vector noise. While sufficient for testing basic functionality, it not enough to realistically representing fluid flow. Liquids tend to swirl around, forming vortices and other complex patterns, which simple noise cannot approximate effectively.</p>



<p>Fortunately, a mathematical operator, the curl, can be particularly useful here. By applying it to scalar noise, we transform it into a velocity field full of vortices. </p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/GrayscaleToCurl.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-431&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/GrayscaleToCurl-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/GrayscaleToCurl-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/GrayscaleToCurl-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/GrayscaleToCurl-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/GrayscaleToCurl-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/GrayscaleToCurl-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>To describe curl in the simplest way possible – in 2D case curl will create a clockwise flow around areas brighter than the surrounding, and counterclockwise flow around darker areas. I describe curl in more detail in <a href="https://emildziewanowski.com/curl-noise/" data-type="post" data-id="19">Dissecting Curl Noise</a> article.</p>



<p>There are multiple ways to calculate curl. DDX and DDY operators are useful in Shadertoy, where the input is not a static texture but a procedural noise. For more traditional applications like Unreal and Unity, it’s probably better to generate it using image generation software like Substance Designer or Photoshop. Any software capable of generating a normal map from a grayscale image will be helpful here, as converting a normal map to curl is simply a matter of swizzling and inverting channels.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/FlowfieldAuthoring.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-426&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/FlowfieldAuthoring-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/FlowfieldAuthoring-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlowfieldAuthoring-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlowfieldAuthoring-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlowfieldAuthoring-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlowfieldAuthoring-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The addition of swirly motion adds a fluid-like quality to the animation, although it still appears somewhat static.</p>







<p>The stationary vortices are the reason behind the artificial appearance. This can be addressed by distorting velocity field using the same function that manipulated lava in Quake.</p>







<p>The flow still lacks the complexity needed to resemble natural motion, but this can be remedied with a more detailed velocity field.</p>



<h2>Mixing</h2>



<p>When the algorithm runs for too long, another problem becomes apparent: mixing. While it’s a desired feature, after a while, it turns the flow colors into a solid mass, devoid of any visual interest. </p>







<p>To remedy that, color can be reintroduced by sampling the initial color texture and blending it with the Render Target texture. This process involves using a point grid mask to mimic pigment dissolving in the fluid.</p>







<p>That solves the issue of mixing, but the pattern of points remains too noticeable. By using a noise texture and applying Quake distortion to it, the effect becomes less conspicuous and more natural.</p>







<p>Jupiter’s appearance is attributed to its water-ammonia clouds, which have a range of compositions and colors. These clouds undergo atmospheric circulation, occasionally pushing layers from below to the surface. This phenomenon results in changes in surface colors and structure over time.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/JupiterComposition.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-599&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterComposition-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterComposition-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterComposition-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterComposition-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterComposition-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/JupiterComposition-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>I’ll artificially limit cloud compositions to 3 and assign a texture channel to each. Then, to simulate shifts in composition, I’ll utilize color cycling. In shader terms, the initial color, before being sampled and mixed with the render target, will undergo slight modifications over time. The result may look psychedelic, but ultimately, it will replaced by more natural set of colors. Right now those rainbow patterns serve as an useful placeholder.</p>







<p>The left side displays the initial color, while the right side shows the flow.</p>



<h2>Sharpening</h2>



<p>Another side effect of mixing is the blurring of the texture. As the image becomes progressively smoother, the details are lost, causing the texture to appear low-resolution, which is certainly an undesirable outcome.</p>



<p>The obvious solution is to use sharpening – an operation opposite to blurring. In its simplest form, it samples five pixels – the original one and its four neighbors – and returns their weighted sum. The layout of the pixels with their respective weights is called a kernel.</p>



<p>I will use a slightly different formula, one that isolates the ‘delta’ or change in color. This delta is then multiplied by the strength of sharpening. This approach gives me more control over the effect.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/BasicSharpen.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-397&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpen-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpen-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpen-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpen-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpen-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpen-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The material graph representation might seem daunting at first glance, but it’s essentially the result of repeating the same sampling operation multiple times with different parameters.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/BasicSharpenUnrealNodes-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-402&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpenUnrealNodes-1-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpenUnrealNodes-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpenUnrealNodes-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpenUnrealNodes-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpenUnrealNodes-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/BasicSharpenUnrealNodes-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Sharpen is a separate Canvas rendering operation that follows the animation step.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/SharpenStage.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-615&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/SharpenStage-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/SharpenStage-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/SharpenStage-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/SharpenStage-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/SharpenStage-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/SharpenStage-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Sharpening enhances the details but also introduces stripe artifacts.</p>







<p>This occurs because it is part of the feedback loop. It amplifies the difference between pixels, and the next sharpening step further magnifies the difference. This continues until the color values reach their maximum or minimum value.</p>



<p>The solution to that problem is far from elegant but very effective – clamping the calculated difference. This way, the difference doesn’t increase exponentially and the artifacts have no chance to form.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/ClampedSharpenUnrealNodes.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-406&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/ClampedSharpenUnrealNodes-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/ClampedSharpenUnrealNodes-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/ClampedSharpenUnrealNodes-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/ClampedSharpenUnrealNodes-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/ClampedSharpenUnrealNodes-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/ClampedSharpenUnrealNodes-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Sharpening with clamping:</p>







<p>With that in place, we can consider the whole system complete – we have a set of tools that allow for recreating a wide array of flow types in real-time. Now, to make further improvements, we need to enhance the input data – specifically, the velocity field.</p>



<h2>Flow Patterns</h2>



<p>There are 3 flow patterns that can be easily identified on Jupiter:</p>



<ul>
<li>Cyclones</li>



<li>Jets</li>



<li>Storms</li>
</ul>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/MainCurrentsAndVortices.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large is-resized&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-626&#34;,&#34;imgStyles&#34;:&#34;width:840px;height:auto&#34;,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/MainCurrentsAndVortices-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/MainCurrentsAndVortices-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/MainCurrentsAndVortices-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/MainCurrentsAndVortices-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/MainCurrentsAndVortices-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/MainCurrentsAndVortices-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>This list is by no means exhaustive. While there are numerous smaller and less noticeable flow details, many of them can be replicated using the same techniques employed for the main three patterns. </p>



<p>I will attempt to translate these patterns into corresponding velocity fields. This way, the complex flow on Jupiter can be broken down into individual flow components. These components could then be rearranged later to create a new, unique gas giant.</p>



<h2>Creating Flowfields</h2>



<p>As mentioned earlier, in a real-game scenario like Unreal or Unity, it’s not practical to generate the velocity field from scratch. It’s more efficient to generate most of the components in Substance Designer or Photoshop and then combine them in the shader to achieve the desired result. This approach allows us to create complex patterns with no additional costs.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/SubstanceVectorfield.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-621&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/SubstanceVectorfield-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/SubstanceVectorfield-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/SubstanceVectorfield-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/SubstanceVectorfield-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/SubstanceVectorfield-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/SubstanceVectorfield-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>I chose to create velocity textures in Substance Designer due to its flexibility and non-destructive workflow.</p>



<h3>Cyclones</h3>



<p>A cyclone is essentially a large vortex. Creating one involves generating a large blurred black or white dot and passing it through the curl operator. To add more complexity, the result can be combined with another operator – the gradient. This allows the cyclone to either suck in or expel matter, making it more dynamic.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/AnticycloneComponents.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-429&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/AnticycloneComponents-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/AnticycloneComponents-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/AnticycloneComponents-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/AnticycloneComponents-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/AnticycloneComponents-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/AnticycloneComponents-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Relation between <a href="https://emildziewanowski.com/curl-noise/#GradientAndCurlOverlayed" data-type="post" data-id="19">curl and gradient is explained here</a> in more detail.</p>



<p>The velocity field is generated by blending a mixture of curl and gradient operators over the previously created flow pattern.</p>







<p>Substance Designer enables the creation of more complex and detailed velocity fields. In this case, the cyclone flowfield was slightly deformed and elongated, featuring a non-linear speed distribution. Unlike a flowfield generated in a shader from scratch, all these details incur no additional cost – everything is baked into the texture.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/04\/AntycycloneSubstanceGraph.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-794&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/04/AntycycloneSubstanceGraph-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/04/AntycycloneSubstanceGraph-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/04/AntycycloneSubstanceGraph-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/04/AntycycloneSubstanceGraph-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/04/AntycycloneSubstanceGraph-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/04/AntycycloneSubstanceGraph-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h3>Jets</h3>



<p>The bands around Jupiter are known as belts and zones. Belts consist of darker, warmer clouds, while zones are characterized by brighter clouds made of ice. Strong currents form at the transitions between these bands. These currents, known as jets, run parallel to the equator and alternate in direction. Where two jets meet, the flow becomes turbulent, creating chains of vortices.</p>



<p>Replicating that is relatively simple: blurred stripes represent the laminar flow of the jets, while a curl applied to a series of dots creates vortices. It’s worth noticing the color of the dots; the spin of resulting vortices has to match the direction of the surrounding jets.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/BeltComponents.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-434&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/BeltComponents-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/BeltComponents-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/BeltComponents-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/BeltComponents-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/BeltComponents-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/BeltComponents-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>







<p>Once again, the flowfield generated in Designer exhibits more detail. Transition vortices are more scattered and vary in size. Additionally, jets are slightly disturbed to create a more wavy flow.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/04\/JetsSubstanceGraph.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-796&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/04/JetsSubstanceGraph-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/04/JetsSubstanceGraph-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/04/JetsSubstanceGraph-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/04/JetsSubstanceGraph-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/04/JetsSubstanceGraph-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/04/JetsSubstanceGraph-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h3>Storms</h3>



<p>“Storms” is the term I used to encompass all the smaller vortices and turbulent streams that accompany the main currents. They are essentially noise, and I will approach creating them in the same way I would create noise.</p>



<p>Noise is typically comprised of multiple layers called octaves. Each subsequent octave contains smaller details and has a diminishing influence. In the case of a velocity field, each layer also has to be animated separately.</p>



<p>Those layers are then blended together to form complex, turbulent motion.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/StormComponents.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-436&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/StormComponents-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/StormComponents-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/StormComponents-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/StormComponents-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/StormComponents-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/StormComponents-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>











<p>Substance Designer features storms gathered into clusters. Two versions of that texture are packed into a single texture and blended using moving masks to simulate quickly shifting currents.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/04\/StormsSubstanceGraph-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-798&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/04/StormsSubstanceGraph-1-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/04/StormsSubstanceGraph-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/04/StormsSubstanceGraph-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/04/StormsSubstanceGraph-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/04/StormsSubstanceGraph-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/04/StormsSubstanceGraph-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>It’s a different approach that results in patches of turbulent flow, as opposed to the uniformly distributed storms generated in Shadertoy. These patches resemble what can be observed on Jupiter more closely.</p>



<h3>Combined</h3>



<p>The division into cyclones, jets, and storms was artificial but proved quite useful for illustrating some of the techniques that can be used to mimic real flowfields. Each flow pattern can be achieved in many different ways, with no single approach that can be described as the “right” one.</p>



<p>To merge all these components together, a simple addition would suffice, but using alpha blending allows for accentuating some features like cyclones and toning down turbulence in certain areas.</p>



<p>At this stage, when all the components are ready, blending them together is more a matter of artistic choice than mathematics. After all, none of the presented techniques have solid grounding in physics – they are just approximations of natural phenomena.</p>







<h2>2010: The Year We Make Contact</h2>



<p>When I started working on the animation of the gas giant, I was really excited about the idea because I naively thought that this was going to be something novel, never tried before. Obviously, I was wrong. Films like ‘Outland’, ‘2010: The Year We Make Contact’, and ‘Contact’ all featured animated Jupiter.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/04\/JupiterInMovies.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-836&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterInMovies-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterInMovies-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterInMovies-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterInMovies-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterInMovies-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterInMovies-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The most interesting portrayal here is the rendition created by Digital Productions for ‘2010: The Year We Make Contact’. The technology behind it is a marvel of CGI, even though it looks like a perfectly executed practical effect.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/04\/JupiterBreakdown.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large is-style-default&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-837&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image&#34;,&#34;alt&#34;:&#34;&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterBreakdown-1024x576.jpg" alt="" srcset="https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterBreakdown-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterBreakdown-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterBreakdown-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterBreakdown-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/04/JupiterBreakdown-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The basic idea remains largely the same: utilizing a flowfield to deform the initial image. However, the execution differs significantly. While I used Substance Designer to generate flow textures, the team at Digital Productions utilized actual fluid mechanics to simulate the flow. My solution to the problem of mixing was to artificially reintroduce the color, whereas they sidestepped the problem entirely by converting the image into particles.</p>



<p>Remarkably, all of this was accomplished without the aid of modern CGI software or computing power. Instead, it relied on the ingenuity of a team of brilliant engineers and artists, supported by the CRAY X-MP.</p>



<p>The work of Larry Yaeger and Craig Upson is described in greater detail in <a href="https://dl.acm.org/doi/pdf/10.1145/15922.15895" data-type="link" data-id="https://dl.acm.org/doi/pdf/10.1145/15922.15895">Siggraph</a> and <a href="https://archive.org/details/CineFex_1985" data-type="link" data-id="https://archive.org/details/CineFex_1985">Cinefex</a> articles. Additionally, there is a <a href="https://youtu.be/5wuClV-i9r4?si=9uxfC098nNyDezOI" data-type="link" data-id="https://youtu.be/5wuClV-i9r4?si=9uxfC098nNyDezOI">documentary available on YouTube</a>.</p>



<h2>Further Developement</h2>



<p>The presented methods should be sufficient to create convincing-looking flow, but not necessarily a visually appealing planet. Achieving that requires several additional steps:</p>



<ul>
<li>Colors: Currently, the R, G, and B channels represent different substances. Ultimately they will be replaced with a color texture.</li>



<li>UV Mapping: Currently, the texture is just a square; it needs to be wrapped around a sphere. However, I plan to use the method described in <a href="https://emildziewanowski.com/flat-planets/" data-type="post" data-id="108">Flat Planets</a> and apply it to a flat disc.</li>



<li>Shading: Atmosphere is lit differently than a solid, opaque object. A specialized shading model has to be created to complete the effect.</li>
</ul>







<h2 id="Conclusions">Conclusions</h2>



<p>The initial setup required some effort, both in Unreal and in Substance Designer, but once in place, it allowed for easy tweaking and modifications. Since it does not rely on computational fluid dynamics, the motion can be handcrafted, which is both a strength and a challenge. It offers total freedom to create any flow imaginable, but requires the artist to have a basic understanding of fluid dynamics.</p>



<figure><p>
<iframe loading="lazy" title="Flowfields Showcase" width="500" height="281" src="https://www.youtube.com/embed/vEw4XCQkaro?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>
</p></figure>



<p>Most importantly, it can compete with actual fluid simulations while using only a fraction of resources. A full planet with a 1024×1024 texture takes less than 0.5ms to render, which is a modest price for such VFX. </p>




                        </div>
                    </article>
                        </div>
    </div></div>
  </body>
</html>
