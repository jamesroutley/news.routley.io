<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://joshua.hu/ai-slop-okta-nextjs-0auth-security-vulnerability">Original</a>
    <h1>Okta&#39;s NextJS-0auth troubles</h1>
    
    <div id="readability-page-1" class="page"><article>
  <p>In October, I reported two security issues to Okta’s auth0/nextjs-auth0 project, <a href="https://github.com/auth0/nextjs-auth0/issues/2382">here</a> and <a href="https://github.com/auth0/nextjs-auth0/pull/2381">here</a>. The latter bug, an oauth parameter injection, <a href="https://techdocs.akamai.com/identity-cloud/docs/secure-audience-injection-and-the-resource-parameter-1">allows</a> for a range of types of abuse, like scoping tokens for unintended services, setting <code>redirect_uri</code> and <code>scope</code> to arbitrary values to leak tokens, and so on.</p>

<p>The patch was simple enough, so I opened a PR:</p>

<div><div><pre><code><span>diff --git a/src/server/helpers/with-page-auth-required.ts b/src/server/helpers/with-page-auth-required.ts
index 41af2dfe..f07046b8 100644
</span><span>--- a/src/server/helpers/with-page-auth-required.ts
</span><span>+++ b/src/server/helpers/with-page-auth-required.ts
</span><span>@@ -196,7 +196,7 @@</span> export const appRouteHandlerFactory =
           : opts.returnTo;
       const { redirect } = await import(&#34;next/navigation.js&#34;);
       redirect(
<span>-        `${config.loginUrl}${opts.returnTo ? `?returnTo=${returnTo}` : &#34;&#34;}`
</span><span>+        `${config.loginUrl}${opts.returnTo ? `?returnTo=${encodeURIComponent(returnTo)}` : &#34;&#34;}`
</span>       );
     }
     return handler(params);
</code></pre></div></div>

<p>All’s well that ends well, right? Obviously, no.</p><hr/>

<p>The PR, 3 weeks later, was closed by the maintainer, an auth0 (an Okta company) employee, with the following comment:</p>

<blockquote>
  <p>This change is superseded by #2413. This was done to ensure that commits are signed. Orignal contribution history has been preserved. Hence closing this PR now.</p>
</blockquote>

<p>Hmm, let’s take a look at <em>that</em> PR:</p>

<table>
  <thead>
    <tr>
      <th><img src="https://joshua.hu/files/slop.png" alt=""/></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>auth0/nextjs-auth0 #2413</em></td>
    </tr>
  </tbody>
</table>

<p>Hmm. That patch looks familiar. And who is Simen Olsen?</p>

<p>Pushing back on the attribution error, I replied:</p>

<blockquote>
  <blockquote>
    <p>history has been preserved</p>
  </blockquote>

  <p>no it hasn’t. I don’t know who “Simen A. W. Olsen my@simen.io” is but it isn’t me and my commit here doesn’t reference that name or email address at all. Was it ai generated or something?</p>
</blockquote>

<p>Of course, the answer was: yes. It was AI slop. Just like <a href="https://joshua.hu/gixy-ng-new-version-gixy-updated-checks">my previous post about gixy-ng</a> (a fun read for anybody dealing with nginx), the developer had used CoPilot to somebow generate their patches:</p>

<blockquote>
  <p>Hi @MegaManSec I sincerely apologize for this attribution error.</p>

  <p>Can confirm that an AI workflow was used to created the rebased commit, which got confused with OP details.
I’ve added a correction to #2413, and will ensure the changelog is updated.</p>

  <p>Thank you for calling this out, we’ll make sure this doesn’t happen again.</p>
</blockquote>

<p>Not only did the maintainer state the above, they also used AI to generate the response! In a now-deleted comment, they clearly used some AI to respond to my complaint:</p>

<table>
  <thead>
    <tr>
      <th><img src="https://joshua.hu/files/slop2.png" alt=""/></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><em>auth0/nextjs-auth0 #2413’s now-deleted comment</em></td>
    </tr>
  </tbody>
</table>

<p>With the classic ChatGPT “<em>you are absolutely correct</em>”, it’s pretty frustrating that this developer used AI to:</p>

<ol>
  <li>Take my report/PR and commit it themselves.</li>
  <li>Used AI to commit it, removing my attribution.</li>
  <li>Used AI to “apologise” for using AI, then stated that “it won’t happen again” – (yeah right; please provide a detailed explanation how you’re going to ensure that, when clearly a 1-line code change is too much for your AI to handle without breaking).</li>
  <li>Refused to fix the commit to remove the invalid / AI-generated-slop details, and add back mine.</li>
</ol>

<p>Indeed, asking:</p>

<blockquote>
  <p>I would appreciate force-pushing a fix for the commit to properly include my information in the commit.</p>
</blockquote>

<p>I was told that they cannot change it. That seems like a copyright infringement to me: taking somebody else’s code, then changing the author’s name?</p>

<p>What I really find the most <em>interesting</em> is really <em>how</em> this AI slop even came to be. I cannot find any reference to the email address “my@simen.io” anywhere online. On GitHub, the only reference to this email address is from the nextjs-auth0 PR. Simen Olsen has never contributed to any of the nextjs-auth0 repositories as far as I can tell (searching <code>org:auth0 author:simenandre</code> on GitHub), and that doesn’t even seem to be their real email address. so was this some type of ai hallucination? And why? The code change was tiny. I just totally don’t get it: I have literally <em>never</em> had any AI tooling fail like this and come up with some other person’s (fake) contact details. It’s simply absurd; are auth0’s engineers using some extremely (<strong>extremely</strong>) low quality local model or something? If ChatGPT failed like this for me even once every thousand times, I would simply never use it again.</p>

<p>In the end, at the time of writing this, the auth0/nextjs-auth0 maintainer, Tushar Pandey, who made all of these mistakes, has not fixed attribution mistake in the commit history. In addition to this, that <a href="https://github.com/auth0/nextjs-auth0/issues/2382">first bug</a>, which allows for arbitrary account hijacking in this software, has been fixed after 3 weeks, with new versions of the nextjs-auth0 software released, but Okta’s security people stating that “unless you create a video abusing this vulnerability, we aren’t going to accept this as a security issue” – LMAO; “yeah, it’s a vulnerability, we fixed in the code, it can be used to takeover accounts, but you need to <em>create a video</em>”. Hilarious. That’s just another case to add to my list of hilarious problems related to reporting security issue, that my next post will document.</p>

</article></div>
  </body>
</html>
