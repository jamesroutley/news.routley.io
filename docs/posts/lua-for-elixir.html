<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://davelucia.com/blog/lua-elixir">Original</a>
    <h1>Lua for Elixir</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>
The first stable release of the Elixir library, <a href="https://hexdocs.pm/lua/Lua.html">Lua v0.1.0</a>, has been released to <a href="https://hex.pm/packages/lua">hex.pm</a>!</p>
<p>
Lua is a library that allows you to execute arbitrary, sandboxed <a href="https://www.lua.org/">Lua</a> programs directly on the BEAM VM. This is <strong>not</strong> embedding the C Lua runtime and compiler, but rather a complete implementation of Lua 5.3. This feat is made possible by the underlying <a href="https://github.com/rvirding/luerl">Luerl library</a>, which implements a Lua parser, compiler, and runtime, all in Erlang.</p>
<p>
The Lua Elixir library extends the capabilities of the Luerl library, improving error messages and providing robust documentation. </p>
<p>
Feature highlights include:</p>
<h3>
Extending Lua with Elixir APIs</h3>
<p>
The Lua Elixir library has a <code>deflua</code> macro for easily expressing APIs in Elixir that can be exposed to Lua with <code>Lua.load_api/2</code></p>
<pre id="la1VY7bl1zroY96EWGY8ww==" phx-hook="prism"><code>defmodule MyAPI do
  use Lua.API
      
  deflua double(v), do: 2 * v
end

import Lua, only: [sigil_LUA: 2]
    
lua = Lua.new() |&gt; Lua.load_api(MyAPI)

{[10], _} = Lua.eval!(lua, ~LUA[return double(5)])</code></pre>
<h3>
Compile-time syntax evaluation</h3>
<p>
A <code>~LUA</code> sigil is exposed, allowing the validation of Lua syntax at Elixir compile time.</p>
<pre id="Xw7fQG6Dsh99FA1NGKqzuw==" phx-hook="prism"><code>iex&gt; import Lua, only: [sigil_LUA: 2]

#iex&gt; {[4], _} = Lua.eval!(~LUA[return 2 +])
** (Lua.CompilerException) Failed to compile Lua!</code></pre>
<h3>
Robust documentation</h3>
<p>
See the <a href="https://hexdocs.pm/lua/Lua.html">Lua Hex docs</a> for detailed documentation and examples for working with Lua and Luerl.</p>
<p>
A <a href="https://hexdocs.pm/lua/working-with-lua.html">Livebook</a> is also available to get you started.</p>
<h2>
Born at TV Labs</h2>
<p>
The Lua Elixir library started as a proof of concept at <a href="https://tvlabs.ai/">TV Labs</a>, where I am co-founder and CTO. At TV Labs, we needed to execute arbitrary code to allow our customers to write high-level integration tests against physical televisions and other streaming media devices. What started as a prototype led to diving deep into the particulars of Luerl, improving its usability and error messages, while making it easy to use from Elixir. TV Labs uses Lua as a compilation target for its <a href="https://docs.tvlabs.ai/automation/what-is-automation">drag and drop Automation builder</a>, where users can specify the high-level workflow of their tests, and we handle the scheduling and underlying execution.</p>
<p>
The Elixir Lua library and Luerl have allowed us to build a working solution for vision-based integration tests on physical devices, without needing to orchestrate additional Javascript or Python virtual machines, and executing the code on compute right next to the physical device.</p>
<h2>
How Luerl came to be</h2>
<p>
Robert Virding is a living legend. Beyond being a <a href="https://youtu.be/xrIjfIjssLE?si=V8rbI0QZM5p6CpvB">famous movie star</a>, Robert is best known for collaborating with <a href="https://en.wikipedia.org/wiki/Joe_Armstrong_(programmer)">Joe Armstrong</a> and Mike Williams at Ericsson in the mid-80s to create the <a href="https://www.erlang.org/">Erlang Programming Language</a>. Erlang is originally known for its use in telecommunications and its properties of fault-tolerance, concurrency, and immutable data, but is now regarded as a general purpose language, with its virtual machine, the BEAM VM, powering many languages including Elixir and Gleam. Since it wasn’t fun to just create <em>one</em> programming language, Robert also created <a href="https://github.com/lfe/lfe">Lisp flavored Erlang (LFE)</a>, a Prolog interpreter in Erlang called <a href="https://github.com/rvirding/erlog">Erlog</a>, and of course, an implementation of Lua called <a href="https://www.luerl.org/">Luerl</a>.</p>
<p>
During <a href="https://codebeameurope.com/">Code BEAM EU 2024</a>, I had the honor of <a href="https://codebeameurope.com/talks/lua-on-the-beam/">giving a talk</a> with Robert. Since Luerl seemed to be a side project for him, I asked him why he bothered creating it in the first place. Robert smirked and said:</p>
<blockquote>
  <p>
I wrote a Prolog on Erlang, that was fun. Then I wrote a functional Lisp in Erlang, that was fun too. But then I realized that it would be neat to implement an imperative or object-oriented language on the BEAM, so I picked Lua and had at it. That’s how Luerl was born.  </p>
</blockquote>
<p>
If I’ve learned anything from this experience and collaborating with Robert, it’s that he still gets immense joy from creating and experimenting, and Luerl is one of those many examples.</p>
<h2>
The future of Lua and Luerl</h2>
<p>
Lua has been a great foundation for building our automation platform at TV Labs; however, there are many improvements needed in Luerl to make it more useful:</p>
<ol>
  <li>
The quality of error messages needs to be dramatically improved  </li>
  <li>
Stacktraces often lack useful context and information  </li>
  <li>
Documentation and examples need significant work  </li>
  <li>
Sandboxing features related to memory need more examination and exploration  </li>
  <li>
Deeper integration with the larger Lua ecosystem  </li>
</ol>
<p>
To that end, Robert and I have discussed merging the Elixir Lua library into Luerl. We hope to do this and release a 2.0.0 version of Luerl, continuing to improve documentation, remove deprecated interfaces, and dramatically improve error messages and stack traces.</p>
<p>
If you’re interested in getting involved, join the <a href="https://erlef.org/slack-invite/luerl">Slack</a> or <a href="https://discord.gg/TW78MycH">Discord</a>, or <a href="https://github.com/rvirding/luerl/issues/new">open an issue on Github</a>.</p>
<p>
Thanks!</p>


    <p>See a mistake/bug? Edit this article on <a href="https://github.com/davydog187/website/blob/main/priv/blogs/2025/05-12-lua-elixir.md">Github</a>
</p>
  </div></div>
  </body>
</html>
