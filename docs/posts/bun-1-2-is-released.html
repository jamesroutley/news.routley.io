<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bun.sh/blog/bun-v1.2">Original</a>
    <h1>Bun 1.2 Is Released</h1>
    
    <div id="readability-page-1" class="page"><article><p>Bun is complete toolkit for building and testing full-stack JavaScript and TypeScript applications. If you&#39;re new to Bun, you can learn more from the <a href="https://bun.sh/blog/bun-v1.0#bun-is-an-all-in-one-toolkit">Bun 1.0</a> blog post.</p><p><iframe src="https://www.youtube.com/embed/uSzffuqfJQk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></p><h2 level="2" anchor-id="bun-1-2" id="bun-1-2"><a name="bun-1-2"></a><a href="#bun-1-2">Bun 1.2</a></h2><p>Bun 1.2 is a huge update, and we&#39;re excited to share it with you.</p><p>Here&#39;s the tl;dr of what changed in Bun 1.2:</p><ul><li>There&#39;s a major update on Bun&#39;s progress towards <a href="#node-js-compatibility">Node.js compatibility</a></li><li>Bun now has a built-in S3 object storage API: <a href="#s3-support-with-bun-s3"><code>Bun.s3</code></a></li><li>Bun now has a built-in Postgres client: <a href="#postgres-support-with-bun-sql"><code>Bun.sql</code></a> (with MySQL coming soon)</li><li><code>bun install</code> now uses a text-based lockfile: <a href="#bun-is-a-package-manager"><code>bun.lock</code></a></li></ul><p>We also made Express <a href="#express-is-3x-faster">3x faster</a> in Bun.</p><h2 level="2" anchor-id="node-js-compatibility" id="node-js-compatibility"><a name="node-js-compatibility"></a><a href="#node-js-compatibility">Node.js compatibility</a></h2><p>Bun is designed as a drop-in replacement for Node.js.</p><p>In Bun 1.2, we started to run the Node.js test suite for every change we make to Bun. Since then, we&#39;ve fixed thousands of bugs and the following Node.js modules now pass over 90% of their tests with Bun.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/83919108-1bfa-41e3-9001-fa9624f3c554"><img src="https://github.com/user-attachments/assets/83919108-1bfa-41e3-9001-fa9624f3c554" width="75%" caption="For each of these Node modules, Bun passes over 90% of the Node.js test suite."/></a><figcaption>For each of these Node modules, Bun passes over 90% of the Node.js test suite.</figcaption></figure><p>Here&#39;s how we did it.</p><h3 level="3" anchor-id="how-do-you-measure-compatibility" id="how-do-you-measure-compatibility"><a name="how-do-you-measure-compatibility"></a><a href="#how-do-you-measure-compatibility">How do you measure compatibility?</a></h3><p>In Bun 1.2, we changed how we test and improve Bun&#39;s compatibility with Node.js. Previously, we prioritized and fixed Node.js bugs as they were reported, usually from GitHub issues where someone tried to use an npm package that didn&#39;t work in Bun.</p><p>While this fixed actual bugs real users ran into, it was too much of a &#34;wack-a-mole&#34; approach. It discouraged doing the large refactors necessary for us to have a shot at 100% Node.js compatibility.</p><p>That&#39;s when we thought: what if we just run the Node.js test suite?</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/ee1c977f-8d85-4038-9cab-8f38a1bc81d6"><img src="https://github.com/user-attachments/assets/ee1c977f-8d85-4038-9cab-8f38a1bc81d6" alt="A screenshot of the Node.js test suite" caption="There are so many tests in the Node.js repository, that the files can&#39;t all be listed on GitHub."/></a><figcaption>There are so many tests in the Node.js repository, that the files can&#39;t all be listed on GitHub.</figcaption></figure><h3 level="3" anchor-id="running-node-js-tests-in-bun" id="running-node-js-tests-in-bun"><a name="running-node-js-tests-in-bun"></a><a href="#running-node-js-tests-in-bun">Running Node.js tests in Bun</a></h3><p>Node.js has thousands of test files in its repository, with most of them in the <a href="https://github.com/nodejs/node/tree/main/test/parallel"><code>test/parallel</code></a> directory. While it might seem simple enough to &#34;just run&#34; their tests, it&#39;s more involved than you might think.</p><h4 level="4" id="internal-apis">Internal APIs</h4><p>For example, many tests rely on the internal implementation details of Node.js. In the following test, <code>getnameinfo</code> is stubbed to always error, to test the error handling of <code>dns.lookupService()</code>.</p><div><p>test/parallel/test-dns-lookupService.js</p><div><div><pre><code><span><span>const</span><span> { internalBinding } </span><span>=</span><span> </span><span>require</span><span>(</span><span>&#34;</span><span>internal/test/binding</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> cares </span><span>=</span><span> </span><span>internalBinding</span><span>(</span><span>&#34;</span><span>cares_wrap</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> { UV_ENOENT } </span><span>=</span><span> </span><span>internalBinding</span><span>(</span><span>&#34;</span><span>uv</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>cares.</span><span>getnameinfo</span><span> </span><span>=</span><span> () </span><span>=&gt;</span><span> UV_ENOENT;</span></span>
<span></span></code></pre></div></div></div><p>To run this test in Bun, we had to replace the internal bindings with our own stubs.</p><div><p>test/parallel/test-dns-lookupService.js</p><div><div><pre><code><span><span>Bun.dns.</span><span>lookupService</span><span> </span><span>=</span><span> (</span><span>addr</span><span>, </span><span>port</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>const</span><span> error </span><span>=</span><span> </span><span>new</span><span> </span><span>Error</span><span>(</span><span>`getnameinfo ENOENT </span><span>${</span><span>addr</span><span>}</span><span>`</span><span>);</span></span>
<span><span>  error.code </span><span>=</span><span> </span><span>&#34;</span><span>ENOENT</span><span>&#34;</span><span>;</span></span>
<span><span>  error.syscall </span><span>=</span><span> </span><span>&#34;</span><span>getnameinfo</span><span>&#34;</span><span>;</span></span>
<span><span>  </span><span>throw</span><span> error;</span></span>
<span><span>};</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="error-messages">Error messages</h4><p>There are also Node.js tests that check the <em>exact</em> string of error messages. And while Node.js usually doesn&#39;t change error messages, they don&#39;t guarantee it won&#39;t change between releases.</p><div><div><div><pre><code><span><span>const</span><span> common </span><span>=</span><span> </span><span>require</span><span>(</span><span>&#34;</span><span>../common</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> assert </span><span>=</span><span> </span><span>require</span><span>(</span><span>&#34;</span><span>assert</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> cp </span><span>=</span><span> </span><span>require</span><span>(</span><span>&#34;</span><span>child_process</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>assert.</span><span>throws</span><span>(</span></span>
<span><span>  () </span><span>=&gt;</span><span> {</span></span>
<span><span>    cp.</span><span>spawnSync</span><span>(process.execPath, [__filename, </span><span>&#34;</span><span>child</span><span>&#34;</span><span>], { argv0</span><span>:</span><span> [] });</span></span>
<span><span>  },</span></span>
<span><span>  {</span></span>
<span><span>    code</span><span>:</span><span> </span><span>&#34;</span><span>ERR_INVALID_ARG_TYPE</span><span>&#34;</span><span>,</span></span>
<span><span>    name</span><span>:</span><span> </span><span>&#34;</span><span>TypeError</span><span>&#34;</span><span>,</span></span>
<span><span>    message</span><span>:</span></span>
<span><span>      </span><span>&#39;</span><span>The &#34;options.argv0&#34; property must be of type string.</span><span>&#39;</span><span> </span><span>+</span></span>
<span><span>      common.</span><span>invalidArgTypeHelper</span><span>([]),</span></span>
<span><span>  },</span></span>
<span><span>);</span></span>
<span></span></code></pre></div></div></div><p>To work around this, we had to change the assertion logic in some tests to check the <code>name</code> and <code>code</code>, instead of the <code>message</code>. This is also the standard practice for checking error types in Node.js.</p><div><div><div><pre><code><span><span>{</span></span>
<span><span>  code: </span><span>&#34;</span><span>ERR_INVALID_ARG_TYPE</span><span>&#34;</span><span>,</span></span>
<span><span>  name: </span><span>&#34;</span><span>TypeError</span><span>&#34;</span><span>,</span></span>
<span><span>   message:</span></span>
<span><span>     </span><span>&#39;</span><span>The &#34;options.argv0&#34; property must be of type string.</span><span>&#39;</span><span> </span><span>+</span></span>
<span><span>     common.</span><span>invalidArgTypeHelper</span><span>([]),</span></span>
<span><span>},</span></span></code></pre></div></div></div><p>While we do try to match the error messages of Node.js as much as possible, there are times where we want to provide a more helpful error message, as long as the <code>name</code> and <code>code</code> are the same.</p><h4 level="4" id="progress-so-far">Progress so far</h4><p>We&#39;ve ported thousands of files from the Node.js test suite to Bun. That means for every commit we make to Bun, we run the Node.js test suite to ensure compatibility.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/c04ef5b9-a8d6-4be7-90a8-6f632aefbe17"><img src="https://github.com/user-attachments/assets/c04ef5b9-a8d6-4be7-90a8-6f632aefbe17" alt="A screenshot of Bun&#39;s CI where we run the Node.js test suite for every commit." caption="A screenshot of Bun&#39;s CI where we run the Node.js test suite for every commit."/></a><figcaption>A screenshot of Bun&#39;s CI where we run the Node.js test suite for every commit.</figcaption></figure><p>Every day, we are adding more and more passing Node.js tests to Bun, and we&#39;re excited to share more progress on Node.js compatibility very soon.</p><p>In addition to fixing existing Node.js APIs, we&#39;ve also added support for the following Node.js modules.</p><h3 level="3" anchor-id="node-http2-server" id="node-http2-server"><a name="node-http2-server"></a><a href="#node-http2-server"><code>node:http2</code> server</a></h3><p>You can now use <a href="https://nodejs.org/api/http2.html#core-api"><code>node:http2</code></a> to create HTTP/2 servers. HTTP/2 is also necessary for gRPC servers, which are also now supported in Bun. Previously, there was only support for the HTTP/2 client.</p><div><div><div><pre><code><span><span>import</span><span> { createSecureServer } </span><span>from</span><span> </span><span>&#34;</span><span>node:http2</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> { readFileSync } </span><span>from</span><span> </span><span>&#34;</span><span>node:fs</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> server </span><span>=</span><span> </span><span>createSecureServer</span><span>({</span></span>
<span><span>  key</span><span>:</span><span> </span><span>readFileSync</span><span>(</span><span>&#34;</span><span>key.pem</span><span>&#34;</span><span>),</span></span>
<span><span>  cert</span><span>:</span><span> </span><span>readFileSync</span><span>(</span><span>&#34;</span><span>cert.pem</span><span>&#34;</span><span>),</span></span>
<span><span>});</span></span>
<span></span>
<span><span>server.</span><span>on</span><span>(</span><span>&#34;</span><span>stream</span><span>&#34;</span><span>, (</span><span>stream</span><span>, </span><span>headers</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  stream.</span><span>respond</span><span>({</span></span>
<span><span>    </span><span>&#34;</span><span>:status</span><span>&#34;</span><span>:</span><span> </span><span>200</span><span>,</span></span>
<span><span>    </span><span>&#34;</span><span>content-type</span><span>&#34;</span><span>:</span><span> </span><span>&#34;</span><span>text/html; charset=utf-8</span><span>&#34;</span><span>,</span></span>
<span><span>  });</span></span>
<span><span>  stream.</span><span>end</span><span>(</span><span>&#34;</span><span>&lt;h1&gt;Hello from Bun!&lt;/h1&gt;</span><span>&#34;</span><span>);</span></span>
<span><span>});</span></span>
<span></span>
<span><span>server.</span><span>listen</span><span>(</span><span>3000</span><span>);</span></span>
<span></span></code></pre></div></div></div><p>In Bun 1.2, the HTTP/2 server is <a href="https://twitter.com/bunjavascript/status/1847014951661326396">2x faster</a> than in Node.js. When we support new APIs to Bun, we spend a lot of time tuning performance to ensure that it not only works, but it&#39;s also faster.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/30ebbbc3-13e1-4fb5-a3a8-a0e7374ca094"><img src="https://github.com/user-attachments/assets/30ebbbc3-13e1-4fb5-a3a8-a0e7374ca094" caption="Benchmark of a &#34;hello world&#34; node:http2 server running in Bun 1.2 and Node.js 22.13."/></a><figcaption>Benchmark of a &#34;hello world&#34; node:http2 server running in Bun 1.2 and Node.js 22.13.</figcaption></figure><h3 level="3" anchor-id="node-dgram" id="node-dgram"><a name="node-dgram"></a><a href="#node-dgram"><code>node:dgram</code></a></h3><p>You can now bind and connect to UDP sockets using <a href="https://nodejs.org/api/dgram.html#udpdatagram-sockets"><code>node:dgram</code></a>. UDP is a low-level unreliable messaging protocol, often used by telemetry providers and game engines.</p><div><div><div><pre><code><span><span>import</span><span> { createSocket } </span><span>from</span><span> </span><span>&#34;</span><span>node:dgram</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> server </span><span>=</span><span> </span><span>createSocket</span><span>(</span><span>&#34;</span><span>udp4</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> client </span><span>=</span><span> </span><span>createSocket</span><span>(</span><span>&#34;</span><span>udp4</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>server.</span><span>on</span><span>(</span><span>&#34;</span><span>listening</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>const</span><span> { port, address } </span><span>=</span><span> server.</span><span>address</span><span>();</span></span>
<span><span>  </span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>; i </span><span>&lt;</span><span> </span><span>10</span><span>; i</span><span>++</span><span>) {</span></span>
<span><span>    client.</span><span>send</span><span>(</span><span>`data </span><span>${</span><span>i</span><span>}</span><span>`</span><span>, port, address);</span></span>
<span><span>  }</span></span>
<span><span>  server.</span><span>unref</span><span>();</span></span>
<span><span>});</span></span>
<span></span>
<span><span>server.</span><span>on</span><span>(</span><span>&#34;</span><span>message</span><span>&#34;</span><span>, (</span><span>data</span><span>, { </span><span>address</span><span>, </span><span>port</span><span> }) </span><span>=&gt;</span><span> {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>`Received: data=</span><span>${</span><span>data</span><span>}</span><span> source=</span><span>${</span><span>address</span><span>}</span><span>:</span><span>${</span><span>port</span><span>}</span><span>`</span><span>);</span></span>
<span><span>  client.</span><span>unref</span><span>();</span></span>
<span><span>});</span></span>
<span></span>
<span><span>server.</span><span>bind</span><span>();</span></span>
<span></span></code></pre></div></div></div><p>This allows packages like DataDog&#39;s <a href="https://github.com/DataDog/dd-trace-js"><code>dd-trace</code></a> and <a href="https://github.com/ClickHouse/clickhouse-js"><code>@clickhouse/client</code></a> to work in Bun 1.2.</p><h3 level="3" anchor-id="node-cluster" id="node-cluster"><a name="node-cluster"></a><a href="#node-cluster"><code>node:cluster</code></a></h3><p>You can use <a href="https://nodejs.org/api/cluster.html#cluster"><code>node:cluster</code></a> to spawn multiple instances of Bun. This is often used to enable higher throughput by running tasks across multiple CPU cores.</p><p>Here&#39;s an example of how you can create a multi-threaded HTTP server using <code>cluster</code>:</p><ul><li>The primary worker spawns <code>n</code> child workers (usually equal to the number of CPU cores)</li><li>Each child worker listens on the same port (using <a href="https://lwn.net/Articles/542629/"><code>reusePort</code></a>)</li><li>Incoming HTTP requests are load balanced across the child workers</li></ul><div><div><div><pre><code><span><span>import</span><span> cluster </span><span>from</span><span> </span><span>&#34;</span><span>node:cluster</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> { createServer } </span><span>from</span><span> </span><span>&#34;</span><span>node:http</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> { cpus } </span><span>from</span><span> </span><span>&#34;</span><span>node:os</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>if</span><span> (cluster.isPrimary) {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>`Primary </span><span>${</span><span>process.pid</span><span>}</span><span> is running`</span><span>);</span></span>
<span></span>
<span><span>  </span><span>// Start N workers for the number of CPUs</span></span>
<span><span>  </span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>; i </span><span>&lt;</span><span> </span><span>cpus</span><span>().length; i</span><span>++</span><span>) {</span></span>
<span><span>    cluster.</span><span>fork</span><span>();</span></span>
<span><span>  }</span></span>
<span></span>
<span><span>  cluster.</span><span>on</span><span>(</span><span>&#34;</span><span>exit</span><span>&#34;</span><span>, (</span><span>worker</span><span>, </span><span>code</span><span>, </span><span>signal</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>    console.</span><span>log</span><span>(</span><span>`Worker </span><span>${</span><span>worker.process.pid</span><span>}</span><span> exited`</span><span>);</span></span>
<span><span>  });</span></span>
<span><span>} </span><span>else</span><span> {</span></span>
<span><span>  </span><span>// Incoming requests are handled by the pool of workers</span></span>
<span><span>  </span><span>// instead of the primary worker.</span></span>
<span><span>  </span><span>createServer</span><span>((</span><span>req</span><span>, </span><span>res</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>    res.</span><span>writeHead</span><span>(</span><span>200</span><span>);</span></span>
<span><span>    res.</span><span>end</span><span>(</span><span>`Hello from worker </span><span>${</span><span>process.pid</span><span>}</span><span>`</span><span>);</span></span>
<span><span>  }).</span><span>listen</span><span>(</span><span>3000</span><span>);</span></span>
<span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>`Worker </span><span>${</span><span>process.pid</span><span>}</span><span> started`</span><span>);</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>Note that <code>reusePort</code> is only effective on Linux. On Windows and macOS, the operating system does not load balance HTTP connections as one would expect.</p><h3 level="3" anchor-id="node-zlib" id="node-zlib"><a name="node-zlib"></a><a href="#node-zlib"><code>node:zlib</code></a></h3><p>In Bun 1.2, we rewrote the entire <a href="https://nodejs.org/api/zlib.html#zlib"><code>node:zlib</code></a> module from JavaScript to native code. This not only fixed a bunch of bugs, but it made it <a href="https://x.com/bunjavascript/status/1832370723895247277">2x faster</a> than Bun 1.1.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/cc3760d5-352c-4f7a-a75b-2f48fec52dfa"><img src="https://github.com/user-attachments/assets/cc3760d5-352c-4f7a-a75b-2f48fec52dfa" caption="Benchmark of inflateSync using node:zlib in Bun and Node.js."/></a><figcaption>Benchmark of inflateSync using node:zlib in Bun and Node.js.</figcaption></figure><p>We also added support for <a href="https://github.com/google/brotli">Brotli</a> in <code>node:zlib</code>, which was missing in Bun 1.1.</p><div><div><div><pre><code><span><span>import</span><span> { brotliCompressSync, brotliDecompressSync } </span><span>from</span><span> </span><span>&#34;</span><span>node:zlib</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> compressed </span><span>=</span><span> </span><span>brotliCompressSync</span><span>(</span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>);</span></span>
<span><span>compressed.</span><span>toString</span><span>(</span><span>&#34;</span><span>hex</span><span>&#34;</span><span>); </span><span>// &#34;0b068048656c6c6f2c20776f726c642103&#34;</span></span>
<span></span>
<span><span>const</span><span> decompressed </span><span>=</span><span> </span><span>brotliDecompressSync</span><span>(compressed);</span></span>
<span><span>decompressed.</span><span>toString</span><span>(</span><span>&#34;</span><span>utf8</span><span>&#34;</span><span>); </span><span>// &#34;Hello, world!&#34;</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="c-addons-using-v8-apis" id="c-addons-using-v8-apis"><a name="c-addons-using-v8-apis"></a><a href="#c-addons-using-v8-apis">C++ addons using V8 APIs</a></h3><p>If you want to use <a href="https://nodejs.org/api/addons.html#c-addons">C++ addons</a> alongside your JavaScript code, the easiest way is to use <a href="https://bun.sh/docs/api/node-api">N-API</a>.</p><p>However, before N-API existed, some packages used the internal V8 C++ APIs in Node.js. What makes this complicated is that Node.js and Bun use different JavaScript engines: Node.js uses <a href="https://v8.dev/">V8</a> (used by Chrome), and Bun uses <a href="https://docs.webkit.org/Deep%20Dive/JSC/JavaScriptCore.html">JavaScriptCore</a> (used by Safari).</p><p>Previously, npm packages like <a href="https://www.npmjs.com/package/cpu-features"><code>cpu-features</code></a>, which rely on these V8 APIs, would not work in Bun.</p><div><div><div><pre><code><span><span>require</span><span>(</span><span>&#34;</span><span>cpu-features</span><span>&#34;</span><span>)();</span></span>
<span></span></code></pre></div></div></div><div><div><div><pre><code><span><span>dyld[94465]: missing symbol called</span></span>
<span><span>fish: Job 1, </span><span>&#39;</span><span>bun index.ts</span><span>&#39;</span><span> terminated by signal SIGABRT (Abort)</span></span>
<span></span></code></pre></div></div></div><p>To fix this, we undertook the unprecedented engineering effort of implementing V8&#39;s public C++ API in JavaScriptCore, so these packages can &#34;just work&#34; in Bun. It&#39;s so complicated and nerdy to explain, we wrote a <a href="https://bun.sh/blog/how-bun-supports-v8-apis-without-using-v8-part-1">3-part blog</a> series on how we supported the V8 APIs... without using V8.</p><p>In Bun 1.2, packages like <code>cpu-features</code> can be imported and just work.</p><div><div><div><pre><code><span><span>$ bun index.ts</span></span>
<span><span>{</span></span>
<span><span>  arch: </span><span>&#34;</span><span>aarch64</span><span>&#34;</span><span>,</span></span>
<span><span>  flags: {</span></span>
<span><span>    fp: </span><span>true</span><span>,</span></span>
<span><span>    asimd: </span><span>true</span><span>,</span></span>
<span><span>    </span><span>// ...</span></span>
<span><span>  },</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>The V8 C++ APIs are <em>very</em> complicated to support, so most packages will still have missing features. We&#39;re continuing to improve support, so packages like <code>node-canvas@v2</code> and <code>node-sqlite3</code> can work in the future.</p><h3 level="3" anchor-id="node-v8" id="node-v8"><a name="node-v8"></a><a href="#node-v8"><code>node:v8</code></a></h3><p>In addition to the V8 C++ APIs, we&#39;ve also added support for heap snapshots using <a href="https://nodejs.org/api/v8.html"><code>node:v8</code></a>.</p><div><div><div><pre><code><span><span>import</span><span> { writeHeapSnapshot } </span><span>from</span><span> </span><span>&#34;</span><span>node:v8</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>// Writes a heap snapshot to the current working directory in the form:</span></span>
<span><span>// `Heap-{date}-{pid}.heapsnapshot`</span></span>
<span><span>writeHeapSnapshot</span><span>();</span></span>
<span></span></code></pre></div></div></div><p>In Bun 1.2, you can use <a href="https://nodejs.org/api/v8.html#v8getheapsnapshot"><code>getHeapSnapshot</code></a> and <a href="https://nodejs.org/api/v8.html#v8writeheapsnapshot"><code>writeHeapSnapshot</code></a> to read and write V8 heap snapshots. This allows you to use Chrome DevTools to inspect the heap of Bun.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/d953c24c-b124-4baf-95e1-60482cb2d8e0"><img src="https://github.com/user-attachments/assets/d953c24c-b124-4baf-95e1-60482cb2d8e0" caption="You can view a heap snapshot of Bun using Chrome DevTools."/></a><figcaption>You can view a heap snapshot of Bun using Chrome DevTools.</figcaption></figure><h3 level="3" anchor-id="express-is-3x-faster" id="express-is-3x-faster"><a name="express-is-3x-faster"></a><a href="#express-is-3x-faster">Express is 3x faster</a></h3><p>While compatibility is important for fixing bugs, it also helps us fix performance issues in Bun.</p><p>In Bun 1.2, the popular <code>express</code> framework can serve HTTP requests up to <a href="https://x.com/bunjavascript/status/1820610675296940227">3x faster</a> than in Node.js. This was made possible by improving compatibility with <code>node:http</code>, and optimizing Bun&#39;s HTTP server.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/2c47977c-f099-4c5f-ae24-e4a259e0b240"><img src="https://github.com/user-attachments/assets/2c47977c-f099-4c5f-ae24-e4a259e0b240"/></a></figure><h2 level="2" anchor-id="s3-support-with-bun-s3" id="s3-support-with-bun-s3"><a name="s3-support-with-bun-s3"></a><a href="#s3-support-with-bun-s3">S3 support with <code>Bun.s3</code></a></h2><p>Bun aims to be a cloud-first JavaScript runtime. That means supporting all the tools and services you need to run a production application in the cloud.</p><p>Modern applications store files in object storage, instead of the local POSIX file system. When end-users upload a file attachment to a website, it&#39;s not being stored on the server&#39;s local disk, it&#39;s being stored in a S3 bucket. Decoupling storage from compute prevents an entire class of reliability issues: low disk space, high p95 response times from busy I/O, and security issues with shared file storage.</p><p>S3 is the <a href="https://en.wikipedia.org/wiki/De_facto_standard">defacto-standard</a> for object storage in the cloud. The <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_Operations_Amazon_Simple_Storage_Service.html">S3 APIs</a> are implemented by a variety of cloud services, including Amazon S3, Google Cloud Storage, Cloudflare R2, and dozens more.</p><p>That&#39;s why Bun 1.2 adds built-in support for S3. You can read, write, and delete files from an S3 bucket using APIs that are compatible with Web standards like <code>Blob</code>.</p><h3 level="3" anchor-id="reading-files-from-s3" id="reading-files-from-s3"><a name="reading-files-from-s3"></a><a href="#reading-files-from-s3">Reading files from S3</a></h3><p>You can use the new <a href="https://bun.sh/docs/api/s3#bun-s3client-bun-s3"><code>Bun.s3</code></a> API to access the default <a href="https://bun.sh/docs/api/s3#bun-s3client-bun-s3"><code>S3Client</code></a>. The client provides a <code>file()</code> method that returns a lazy-reference to an S3 file, which is the same API as Bun&#39;s <a href="https://bun.sh/docs/api/file-io#reading-files-bun-file"><code>File</code></a>.</p><div><div><div><pre><code><span><span>import</span><span> { s3 } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> file </span><span>=</span><span> s3.</span><span>file</span><span>(</span><span>&#34;</span><span>folder/my-file.txt</span><span>&#34;</span><span>);</span></span>
<span><span>// file instanceof Blob</span></span>
<span></span>
<span><span>const</span><span> content </span><span>=</span><span> </span><span>await</span><span> file.</span><span>text</span><span>();</span></span>
<span><span>// or:</span></span>
<span><span>//   file.json()</span></span>
<span><span>//   file.arrayBuffer()</span></span>
<span><span>//   file.stream()</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="5x-faster-than-node-js" id="5x-faster-than-node-js"><a name="5x-faster-than-node-js"></a><a href="#5x-faster-than-node-js">5x faster than Node.js</a></h3><p>Bun&#39;s S3 client is written in native code, instead of JavaScript. When you compare it to using packages like <code>@aws-sdk/client-s3</code> with Node.js, it&#39;s 5x faster at downloading files from a S3 bucket.</p><figure><a target="_blank" href="https://bun.sh/bun-s3-node.gif"><img src="https://bun.sh/bun-s3-node.gif" caption="Left: Bun 1.2 with Bun.s3. Right: Node.js with @aws-sdk/client-s3."/></a><figcaption>Left: Bun 1.2 with Bun.s3. Right: Node.js with @aws-sdk/client-s3.</figcaption></figure><h3 level="3" anchor-id="writing-files-to-s3" id="writing-files-to-s3"><a name="writing-files-to-s3"></a><a href="#writing-files-to-s3">Writing files to S3</a></h3><p>You can use the <a href="https://bun.sh/docs/api/s3#writing-uploading-files-to-s3"><code>write()</code></a> method to upload a file to S3. It&#39;s that simple:</p><div><div><div><pre><code><span><span>import</span><span> { s3 } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> file </span><span>=</span><span> s3.</span><span>file</span><span>(</span><span>&#34;</span><span>folder/my-file.txt</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>await</span><span> file.</span><span>write</span><span>(</span><span>&#34;</span><span>hello s3!</span><span>&#34;</span><span>);</span></span>
<span><span>// or:</span></span>
<span><span>//   file.write(new Uint8Array([1, 2, 3]));</span></span>
<span><span>//   file.write(new Blob([&#34;hello s3!&#34;]));</span></span>
<span><span>//   file.write(new Response(&#34;hello s3!&#34;));</span></span>
<span></span></code></pre></div></div></div><p>For larger files, you can use the <a href="https://bun.sh/docs/api/s3#writing-uploading-files-to-s3"><code>writer()</code></a> method to obtain a file writer that does a <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpuoverview.html">multi-part upload</a>, so you don&#39;t have to worry about the details.</p><div><div><div><pre><code><span><span>import</span><span> { s3 } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> file </span><span>=</span><span> s3.</span><span>file</span><span>(</span><span>&#34;</span><span>folder/my-file.txt</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> writer </span><span>=</span><span> file.</span><span>writer</span><span>();</span></span>
<span></span>
<span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>; i </span><span>&lt;</span><span> </span><span>1000</span><span>; i</span><span>++</span><span>) {</span></span>
<span><span>  writer.</span><span>write</span><span>(</span><span>String</span><span>(i).</span><span>repeat</span><span>(</span><span>1024</span><span>));</span></span>
<span><span>}</span></span>
<span></span>
<span><span>await</span><span> writer.</span><span>end</span><span>();</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="presigned-urls" id="presigned-urls"><a name="presigned-urls"></a><a href="#presigned-urls">Presigned URLs</a></h3><p>When your production service needs to let users upload files to your server, it&#39;s often more reliable for the user to upload directly to S3 instead of your server acting as an intermediary.</p><p>To make this work, you use the <a href="https://bun.sh/docs/api/s3#presigning-urls"><code>presign()</code></a> method to generate a <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/using-presigned-url.html">presigned URL</a> for a file. This generates a URL with a signature that allows a user to securely upload that specific file to S3, without exposing your credentials or granting them unnecessary access to your bucket.</p><div><div><div><pre><code><span><span>import</span><span> { s3 } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> url </span><span>=</span><span> s3.</span><span>presign</span><span>(</span><span>&#34;</span><span>folder/my-file.txt</span><span>&#34;</span><span>, {</span></span>
<span><span>  expiresIn</span><span>:</span><span> </span><span>3600</span><span>, </span><span>// 1 hour</span></span>
<span><span>  acl</span><span>:</span><span> </span><span>&#34;</span><span>public-read</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="using-bun-serve" id="using-bun-serve"><a name="using-bun-serve"></a><a href="#using-bun-serve">Using <code>Bun.serve()</code></a></h3><p>Since Bun&#39;s S3 APIs extend the <code>File</code> API, you can use <a href="https://bun.sh/docs/api/bun#bun-serve"><code>Bun.serve()</code></a> to serve S3 files over HTTP.</p><div><div><div><pre><code><span><span>import</span><span> { serve, s3 } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>serve</span><span>({</span></span>
<span><span>  port</span><span>:</span><span> </span><span>3000</span><span>,</span></span>
<span><span>  </span><span>async</span><span> </span><span>fetch</span><span>(</span><span>request</span><span>) {</span></span>
<span><span>    </span><span>const</span><span> { url } </span><span>=</span><span> request;</span></span>
<span><span>    </span><span>const</span><span> { pathname } </span><span>=</span><span> </span><span>new</span><span> </span><span>URL</span><span>(url);</span></span>
<span><span>    </span><span>// ...</span></span>
<span><span>    </span><span>if</span><span> (pathname </span><span>===</span><span> </span><span>&#34;</span><span>/favicon.ico</span><span>&#34;</span><span>) {</span></span>
<span><span>      </span><span>const</span><span> file </span><span>=</span><span> s3.</span><span>file</span><span>(</span><span>&#34;</span><span>assets/favicon.ico</span><span>&#34;</span><span>);</span></span>
<span><span>      </span><span>return</span><span> </span><span>new</span><span> </span><span>Response</span><span>(file);</span></span>
<span><span>    }</span></span>
<span><span>    </span><span>// ...</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>When you use <code>new Response(s3.file(...))</code>, instead of downloading the S3 file to your server and sending it back to the user, Bun redirects the user to the presigned URL for the S3 file.</p><div><div><div><pre><code><span><span>Response</span><span> (</span><span>0</span><span> KB) {</span></span>
<span><span>  status: </span><span>302</span><span>,</span></span>
<span><span>  headers: Headers {</span></span>
<span><span>    </span><span>&#34;</span><span>location</span><span>&#34;</span><span>: </span><span>&#34;</span><span>https://s3.amazonaws.com/my-bucket/assets/favicon.ico?...</span><span>&#34;</span><span>,</span></span>
<span><span>  },</span></span>
<span><span>  redirected: </span><span>true</span><span>,</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>This saves you memory, time, and the bandwidth cost of downloading the file to your server.</p><h3 level="3" anchor-id="using-bun-file" id="using-bun-file"><a name="using-bun-file"></a><a href="#using-bun-file">Using <code>Bun.file()</code></a></h3><p>If you want to access S3 files using the same code as the local file-system, you can reference them using the <code>s3://</code> URL protocol. It&#39;s the same concept as using <code>file://</code> to reference local files.</p><div><div><div><pre><code><span><span>import</span><span> { file } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>async</span><span> </span><span>function</span><span> </span><span>createFile</span><span>(</span><span>url</span><span>, </span><span>content</span><span>) {</span></span>
<span><span>  </span><span>const</span><span> fileObject </span><span>=</span><span> </span><span>file</span><span>(url);</span></span>
<span><span>  </span><span>if</span><span> (</span><span>await</span><span> fileObject.</span><span>exists</span><span>()) {</span></span>
<span><span>    </span><span>return</span><span>;</span></span>
<span><span>  }</span></span>
<span><span>  </span><span>await</span><span> fileObject.</span><span>write</span><span>(content);</span></span>
<span><span>}</span></span>
<span></span>
<span><span>await</span><span> </span><span>createFile</span><span>(</span><span>&#34;</span><span>s3://folder/my-file.txt</span><span>&#34;</span><span>, </span><span>&#34;</span><span>hello s3!</span><span>&#34;</span><span>);</span></span>
<span><span>await</span><span> </span><span>createFile</span><span>(</span><span>&#34;</span><span>file://folder/my-file.txt</span><span>&#34;</span><span>, </span><span>&#34;</span><span>hello posix!</span><span>&#34;</span><span>);</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="using-fetch" id="using-fetch"><a name="using-fetch"></a><a href="#using-fetch">Using <code>fetch()</code></a></h3><p>You can even use <code>fetch()</code> to read, write, and delete files from S3.</p><div><div><div><pre><code><span><span>// Upload to S3</span></span>
<span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>s3://folder/my-file.txt</span><span>&#34;</span><span>, {</span></span>
<span><span>  method</span><span>:</span><span> </span><span>&#34;</span><span>PUT</span><span>&#34;</span><span>,</span></span>
<span><span>  body</span><span>:</span><span> </span><span>&#34;</span><span>hello s3!</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span>
<span><span>// Download from S3</span></span>
<span><span>const</span><span> response </span><span>=</span><span> </span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>s3://folder/my-file.txt</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> content </span><span>=</span><span> </span><span>await</span><span> response.</span><span>text</span><span>(); </span><span>// &#34;hello s3!&#34;</span></span>
<span></span>
<span><span>// Delete from S3</span></span>
<span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>s3://folder/my-file.txt</span><span>&#34;</span><span>, {</span></span>
<span><span>  method</span><span>:</span><span> </span><span>&#34;</span><span>DELETE</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="using-s3client" id="using-s3client"><a name="using-s3client"></a><a href="#using-s3client">Using <code>S3Client</code></a></h3><p>When you import <code>Bun.s3</code>, it returns a default client that is configured using <a href="https://bun.sh/docs/api/s3#credentials">well-known</a> environment variables, such as <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>.</p><div><div><div><pre><code><span><span>import</span><span> { s3, S3Client } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span><span>// s3 instanceof S3Client</span></span>
<span></span></code></pre></div></div></div><p>You can also create your own <a href="https://bun.sh/docs/api/s3#s3client-objects"><code>S3Client</code></a>, then set it as the default.</p><div><div><div><pre><code><span><span>import</span><span> { S3Client } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> client </span><span>=</span><span> </span><span>new</span><span> </span><span>S3Client</span><span>({</span></span>
<span><span>  accessKeyId</span><span>:</span><span> </span><span>&#34;</span><span>my-access-key-id</span><span>&#34;</span><span>,</span></span>
<span><span>  secretAccessKey</span><span>:</span><span> </span><span>&#34;</span><span>my-secret-access-key</span><span>&#34;</span><span>,</span></span>
<span><span>  region</span><span>:</span><span> </span><span>&#34;</span><span>auto</span><span>&#34;</span><span>,</span></span>
<span><span>  endpoint</span><span>:</span><span> </span><span>&#34;</span><span>https://&lt;account-id&gt;.r2.cloudflarestorage.com</span><span>&#34;</span><span>,</span></span>
<span><span>  bucket</span><span>:</span><span> </span><span>&#34;</span><span>my-bucket</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span>
<span><span>// Sets the default client to be your custom client</span></span>
<span><span>Bun.s3 </span><span>=</span><span> client;</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="postgres-support-with-bun-sql" id="postgres-support-with-bun-sql"><a name="postgres-support-with-bun-sql"></a><a href="#postgres-support-with-bun-sql">Postgres support with <code>Bun.sql</code></a></h2><p>Just like object storage, another datastore that production applications often need is a SQL database.</p><p>Since the beginning, Bun has had a built-in <a href="https://bun.sh/docs/api/sqlite">SQ<em>Lite</em></a> client. SQLite is great for smaller applications and quick scripts, where you don&#39;t want to worry about the hastle of setting up a production database.</p><p>In Bun 1.2, we&#39;re expanding Bun&#39;s support for SQL databases by introducing <a href="https://bun.sh/docs/api/sql"><code>Bun.sql</code></a>, a built-in SQL client with Postgres support. We also have a <a href="https://github.com/oven-sh/bun/pull/15274">pull request</a> to add MySQL support very soon.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/ecb31227-e5e7-43a6-aff8-47452cf81578"><img src="https://github.com/user-attachments/assets/ecb31227-e5e7-43a6-aff8-47452cf81578" alt="" width="75%"/></a></figure><h3 level="3" anchor-id="using-bun-sql" id="using-bun-sql"><a name="using-bun-sql"></a><a href="#using-bun-sql">Using <code>Bun.sql</code></a></h3><p>You can use <a href="https://bun.sh/docs/api/sql"><code>Bun.sql</code></a> to run SQL queries using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">tagged-template literals</a>. This allows you to pass JavaScript values as parameters to your SQL queries.</p><p>Most importantly, it escapes strings and uses prepared statements for you to prevent SQL injection.</p><div><div><div><pre><code><span><span>import</span><span> { sql } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> users </span><span>=</span><span> [</span></span>
<span><span>  { name</span><span>:</span><span> </span><span>&#34;</span><span>Alice</span><span>&#34;</span><span>, age</span><span>:</span><span> </span><span>25</span><span> },</span></span>
<span><span>  { name</span><span>:</span><span> </span><span>&#34;</span><span>Bob</span><span>&#34;</span><span>, age</span><span>:</span><span> </span><span>65</span><span> },</span></span>
<span><span>];</span></span>
<span></span>
<span><span>await</span><span> </span><span>sql</span><span>`</span></span>
<span><span>  INSERT INTO users (name, age)</span></span>
<span><span>  VALUES </span><span>${</span><span>sql</span><span>(users)</span><span>}</span></span>
<span><span>`</span><span>;</span></span>
<span></span></code></pre></div></div></div><p>Reading rows is just as easy. Results are returned as an array of objects, with the column name as the key.</p><div><div><div><pre><code><span><span>import</span><span> { sql } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> seniorAge </span><span>=</span><span> </span><span>65</span><span>;</span></span>
<span><span>const</span><span> seniorUsers </span><span>=</span><span> </span><span>await</span><span> </span><span>sql</span><span>`</span></span>
<span><span>  SELECT name, age FROM users</span></span>
<span><span>  WHERE age &gt;= </span><span>${</span><span>seniorAge</span><span>}</span></span>
<span><span>`</span><span>;</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(seniorUsers); </span><span>// [{ name: &#34;Bob&#34;, age: 65 }]</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="50-faster-than-other-clients" id="50-faster-than-other-clients"><a name="50-faster-than-other-clients"></a><a href="#50-faster-than-other-clients">50% faster than other clients</a></h3><p><code>Bun.sql</code> is written in native code with optimizations like:</p><ul><li>Automatic prepared statements</li><li>Query pipelining</li><li>Binary wire protocol support</li><li>Connection pooling</li><li>Structure caching</li></ul><p>Optimizations stack like buffs in World of Warcraft.</p><p>The result is that <code>Bun.sql</code> is up to 50% faster at reading rows than using the most popular Postgres clients with Node.js.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/09066ce9-aacd-439c-ab28-f2640c0ce814"><img src="https://github.com/user-attachments/assets/09066ce9-aacd-439c-ab28-f2640c0ce814" alt="" width="75%"/></a></figure><h3 level="3" anchor-id="migrate-from-postgres-js-to-bun-sql" id="migrate-from-postgres-js-to-bun-sql"><a name="migrate-from-postgres-js-to-bun-sql"></a><a href="#migrate-from-postgres-js-to-bun-sql">Migrate from <code>postgres.js</code> to <code>Bun.sql</code></a></h3><p>The <code>Bun.sql</code> APIs are inspired by the popular <a href="https://github.com/porsager/postgres"><code>postgres.js</code></a> package. This makes it easy to migrate your existing code to using Bun&#39;s built-in SQL client.</p><div><div><div><pre><code><span><span>  </span><span>import</span><span> { postgres } </span><span>from</span><span> </span><span>&#34;</span><span>postgres</span><span>&#34;</span><span>;</span></span>
<span><span>  </span><span>import</span><span> { postgres } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> sql </span><span>=</span><span> </span><span>postgres</span><span>({</span></span>
<span><span>  host</span><span>:</span><span> </span><span>&#34;</span><span>localhost</span><span>&#34;</span><span>,</span></span>
<span><span>  port</span><span>:</span><span> </span><span>5432</span><span>,</span></span>
<span><span>  database</span><span>:</span><span> </span><span>&#34;</span><span>mydb</span><span>&#34;</span><span>,</span></span>
<span><span>  user</span><span>:</span><span> </span><span>&#34;</span><span>...</span><span>&#34;</span><span>,</span></span>
<span><span>  password</span><span>:</span><span> </span><span>&#34;</span><span>...</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span>
<span><span>const</span><span> users </span><span>=</span><span> </span><span>await</span><span> </span><span>sql</span><span>`SELECT name, age FROM users LIMIT 1`</span><span>;</span></span>
<span><span>console.</span><span>log</span><span>(users); </span><span>// [{ name: &#34;Alice&#34;, age: 25 }]</span></span></code></pre></div></div></div><h2 level="2" anchor-id="bun-is-a-package-manager" id="bun-is-a-package-manager"><a name="bun-is-a-package-manager"></a><a href="#bun-is-a-package-manager">Bun is a package manager</a></h2><p>Bun is a npm-compatible package manager that makes it easy to install and update your node modules. You can use <a href="https://bun.sh/docs/cli/install"><code>bun install</code></a> to install dependencies, even if you&#39;re using Node.js as a runtime.</p><h3 level="3" anchor-id="replace-npm-install-with-bun-install" id="replace-npm-install-with-bun-install"><a name="replace-npm-install-with-bun-install"></a><a href="#replace-npm-install-with-bun-install">Replace <code>npm install</code> with <code>bun install</code></a></h3><div><div><div><pre><code><span><span>$ npm install</span></span>
<span><span>$ bun install</span></span></code></pre></div></div></div><p>In Bun 1.2, we&#39;ve made the biggest change yet to the package manager.</p><h3 level="3" anchor-id="problems-with-bun-lockb" id="problems-with-bun-lockb"><a name="problems-with-bun-lockb"></a><a href="#problems-with-bun-lockb">Problems with <code>bun.lockb</code></a></h3><p>Since the beginning, Bun has used a binary lockfile: <code>bun.lockb</code>.</p><p>Unlike other package managers that use text-based lockfiles, like JSON or YAML, a binary lockfile allowed us to make <code>bun install</code> almost 30x faster than <code>npm</code>.</p><p>However, we found that there were a lot of paper cuts when using a binary lockfile. First, you couldn&#39;t view the contents of the lockfile on GitHub and other platforms. This sucked.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/c6c937c1-9074-427e-a1d2-82c7c871538e"><img src="https://github.com/user-attachments/assets/c6c937c1-9074-427e-a1d2-82c7c871538e" alt=""/></a></figure><p>What happens if you receive a pull request from an external contributor that changes the <code>bun.lockb</code> file? Do you trust it? Probably not.</p><p>That&#39;s also assuming there isn&#39;t a merge conflict! Which for a binary lockfile, is almost impossible to resolve, aside from manually deleting the lockfiles and running <code>bun install</code> again.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/e97db642-1499-40c5-b17f-3a932157d0f2"><img src="https://github.com/user-attachments/assets/e97db642-1499-40c5-b17f-3a932157d0f2" alt=""/></a></figure><p>This also made it hard for tools to read the lockfile. For example, dependency management tools like <a href="https://github.com/dependabot/dependabot-core">Dependabot</a> would need an API to parse the lockfile, and we didn&#39;t offer one.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/65ed123a-8e56-4550-ae0b-9967520e805e"><img src="https://github.com/user-attachments/assets/65ed123a-8e56-4550-ae0b-9967520e805e" alt=""/></a></figure><p>Bun will continue to support <code>bun.lockb</code> for a <em>long</em> time. However, for all these reasons, we&#39;ve decided to switch to a text-based lockfile as the default in Bun 1.2.</p><h3 level="3" anchor-id="introducing-bun-lock" id="introducing-bun-lock"><a name="introducing-bun-lock"></a><a href="#introducing-bun-lock">Introducing <code>bun.lock</code></a></h3><p>In Bun 1.2, we&#39;re introducing a new, text-based lockfile: <a href="https://bun.sh/docs/install/lockfile"><code>bun.lock</code></a>.</p><p>You can migrate to the new lockfile by using the <code>--save-text-lockfile</code> flag.</p><div><div><div><pre><code><span><span>bun install --save-text-lockfile</span></span></code></pre></div></div></div><p><code>bun.lock</code> is a JSONC file, which is JSON with added support for comments and trailing commas.</p><div><p>bun.lock</p><div><div><pre><code><span><span>// bun.lock</span></span>
<span><span>{</span></span>
<span><span>  </span><span>&#34;</span><span>lockfileVersion</span><span>&#34;</span><span>:</span><span> </span><span>0</span><span>,</span></span>
<span><span>  </span><span>&#34;</span><span>packages</span><span>&#34;</span><span>:</span><span> [</span></span>
<span><span>    [</span><span>&#34;</span><span>express@4.21.2</span><span>&#34;</span><span>, </span><span>/* ... */</span><span>, </span><span>&#34;</span><span>sha512-...</span><span>&#34;</span><span>],</span></span>
<span><span>    [</span><span>&#34;</span><span>body-parser@1.20.3</span><span>&#34;</span><span>, </span><span>/* ... */</span><span>],</span></span>
<span><span>    </span><span>/* ... and more */</span></span>
<span><span>  ],</span></span>
<span><span>  </span><span>&#34;</span><span>workspaces</span><span>&#34;</span><span>:</span><span> { </span><span>/* ... */</span><span> },</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>This makes it much easier to view diffs in pull requests, and trailing commas make it much less likely to cause merge conflicts.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/c873d6fe-3b44-47ca-81fd-913d9ace7b8e"><img src="https://github.com/user-attachments/assets/c873d6fe-3b44-47ca-81fd-913d9ace7b8e" alt=""/></a></figure><p>For new projects without a lockfile, Bun will generate a new <code>bun.lock</code> file.</p><p>For existing projects with a <code>bun.lockb</code> file, Bun will continue to support the binary lockfile, <em>without migration to the new lockfile</em>. We will continue to support the binary lockfile for a <em>long</em> time, so you can continue to use commands, like <code>bun add</code> and <code>bun update</code>, and it will update your <code>bun.lockb</code> file.</p><h3 level="3" anchor-id="bun-install-gets-30-faster" id="bun-install-gets-30-faster"><a name="bun-install-gets-30-faster"></a><a href="#bun-install-gets-30-faster"><code>bun install</code> gets 30% faster</a></h3><p>You might think that after we migrated to a text-based lockfile, <code>bun install</code> would be slower. Wrong!</p><p>Most software projects get slower as more features are added, Bun is not one of those projects. We spent a lot of time tuning and optimizing Bun, so we could make <code>bun install</code> <em>even</em> faster.</p><p>That&#39;s why in Bun 1.2, <code>bun install</code> is 30% faster than Bun 1.1</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/679db20c-dfc1-4a36-b656-8abc16733c55"><img src="https://github.com/user-attachments/assets/679db20c-dfc1-4a36-b656-8abc16733c55" alt=""/></a></figure><h3 level="3" anchor-id="jsonc-support-in-package-json" id="jsonc-support-in-package-json"><a name="jsonc-support-in-package-json"></a><a href="#jsonc-support-in-package-json">JSONC support in <code>package.json</code></a></h3><p>Have you ever added something to your <code>package.json</code> and forgot why months later? Or wanted to explain to your teammates why a dependency needs a specific version? Or have you ever had a merge conflict in a package.json file due to a comma?</p><p>Often these problems are due to the fact that <code>package.json</code> is a JSON file, and that means you can&#39;t use comments or trailing commas in it.</p><div><p>package.json</p><div><div><pre><code><span><span>{</span></span>
<span><span>  </span><span>&#34;</span><span>dependencies</span><span>&#34;</span><span>:</span><span> {</span></span>
<span><span>    </span><span>// this would cause a syntax error</span></span>
<span><span>    </span><span>&#34;</span><span>express</span><span>&#34;</span><span>:</span><span> </span><span>&#34;</span><span>4.21.2</span><span>&#34;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span></code></pre></div></div></div><p>This is a bad experience. Modern tools like TypeScript allow for comments and trailing commas in their configuration files, <code>tsconfig.json</code> for example, and it&#39;s great. We also asked the community on your thoughts, and it seemed that the status-quo needed to change.</p><div><blockquote><p lang="en" dir="ltr">What JS ecosystem upgrade path would you prefer to permit comments in package.json?</p>— Rob Palmer (@robpalmer2) <a href="https://twitter.com/robpalmer2/status/1780495081637548305?ref_src=twsrc%5Etfw">April 17, 2024</a></blockquote> </div><p>In Bun 1.2, you can use comments and trailing commas in your <code>package.json</code>. It just works.</p><div><p>package.json</p><div><div><pre><code><span><span>{</span></span>
<span><span>  </span><span>&#34;</span><span>name</span><span>&#34;</span><span>: </span><span>&#34;</span><span>app</span><span>&#34;</span><span>,</span></span>
<span><span>  </span><span>&#34;</span><span>dependencies</span><span>&#34;</span><span>: {</span></span>
<span><span>    </span><span>// We need 0.30.8 because of a bug in 0.30.9</span></span>
<span><span>    </span><span>&#34;</span><span>drizzle-orm</span><span>&#34;</span><span>:</span><span> </span><span>&#34;</span><span>0.30.8</span><span>&#34;</span><span>, </span><span>/* &lt;- trailing comma */</span></span>
<span><span>  },</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>Since there are many tools that read <code>package.json</code> files, we&#39;ve added support to <code>require()</code> or <code>import()</code> these files with comments and trailing commas. You don&#39;t need to change your code.</p><div><div><div><pre><code><span><span>const</span><span> pkg </span><span>=</span><span> </span><span>require</span><span>(</span><span>&#34;</span><span>./package.json</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> {</span></span>
<span><span>  </span><span>default</span><span>:</span><span> { name },</span></span>
<span><span>} </span><span>=</span><span> </span><span>await</span><span> </span><span>import</span><span>(</span><span>&#34;</span><span>./package.json</span><span>&#34;</span><span>);</span></span>
<span></span></code></pre></div></div></div><p>Since this isn&#39;t widely supported in the JavaScript ecosystem, we&#39;d advice you to use this feature &#34;at your own risk.&#34; However, we think this is the right direction to go: to make things easier for you.</p><h3 level="3" anchor-id="npmrc-support" id="npmrc-support"><a name="npmrc-support"></a><a href="#npmrc-support"><code>.npmrc</code> support</a></h3><p>In Bun 1.2, we added support for reading npm&#39;s config file: <a href="https://bun.sh/docs/install/npmrc"><code>.npmrc</code></a>.</p><p>You can use <code>.npmrc</code> to configure your npm registry and configure scoped packages. This is often necessary for corporate environments, where you might need to authenticate to a private registry.</p><div><p>.npmrc</p><div><div><pre><code><span><span>@my-company:</span><span>registry=</span><span>https://packages.my-company.com</span></span>
<span><span>@my-org:</span><span>registry=</span><span>https://packages.my-company.com/my-org</span></span>
<span></span></code></pre></div></div></div><p>Bun will look for an <code>.npmrc</code> file in your project&#39;s root directory, and in your home directory.</p><h3 level="3" anchor-id="bun-run-filter" id="bun-run-filter"><a name="bun-run-filter"></a><a href="#bun-run-filter"><code>bun run --filter</code></a></h3><p>You can now use <code>bun run --filter</code> to run a script in multiple workspaces at the same time.</p><p>This will run the <code>dev</code> script, concurrently, in all workspaces that match the glob pattern. It will also interleave the output of each script, so you can see the output of each workspace as it runs.</p><figure><a target="_blank" href="https://github.com/oven-sh/bun/assets/48869301/2a103e42-9921-4c33-948f-a1ad6e6bac71"><img src="https://github.com/oven-sh/bun/assets/48869301/2a103e42-9921-4c33-948f-a1ad6e6bac71" width="100%"/></a></figure><p>You can also pass multiple filters to <code>--filter</code>, and you can just use <code>bun</code> instead of <code>bun run</code>.</p><div><div><div><pre><code><span><span>bun --filter </span><span>&#39;</span><span>api/*</span><span>&#39;</span><span> --filter </span><span>&#39;</span><span>frontend/*</span><span>&#39;</span><span> dev</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="bun-outdated" id="bun-outdated"><a name="bun-outdated"></a><a href="#bun-outdated"><code>bun outdated</code></a></h3><p>You can now view which dependencies are out-of-date using <a href="https://bun.sh/docs/cli/outdated"><code>bun outdated</code></a>.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/cb41e234-d0f6-4830-9864-fb87bd568cfe"><img src="https://github.com/user-attachments/assets/cb41e234-d0f6-4830-9864-fb87bd568cfe" alt=""/></a></figure><p>It will show a list of your <code>package.json</code> dependencies, and which versions are out-of-date. The &#34;update&#34; column shows the next semver-matching version, and the &#34;latest&#34; column shows the latest version.</p><p>If you notice there&#39;s a specific dependency you want to update, you can use <code>bun update</code>.</p><div><div><div><pre><code><span><span>bun update @typescript-eslint/parser </span><span># Updates to &#34;7.18.0&#34;</span></span></code></pre></div></div><div><div><pre><code><span><span>bun update @typescript-eslint/parser --latest </span><span># Updates to &#34;8.2.0&#34;</span></span></code></pre></div></div></div><p>You can also filter which dependencies you want to check for updates. Just make sure to quote patterns, so your shell doesn&#39;t expand them as glob patterns!</p><div><div><div><pre><code><span><span>bun outdated </span><span>&#34;</span><span>is-*</span><span>&#34;</span><span> </span><span># check is-even, is-odd, etc.</span></span></code></pre></div></div><div><div><pre><code><span><span>bun outdated </span><span>&#34;</span><span>@discordjs/*</span><span>&#34;</span><span> </span><span># check @discordjs/voice, @discordjs/rest, etc.</span></span></code></pre></div></div><div><div><pre><code><span><span>bun outdated jquery --filter=</span><span>&#34;</span><span>foo</span><span>&#34;</span><span> </span><span># check jquery in the `foo` workspace</span></span></code></pre></div></div></div><h3 level="3" anchor-id="bun-publish" id="bun-publish"><a name="bun-publish"></a><a href="#bun-publish"><code>bun publish</code></a></h3><p>You can now publish npm packages using <a href="https://bun.sh/docs/cli/publish"><code>bun publish</code></a>.</p><figure><a target="_blank" href="https://github.com/user-attachments/assets/3ab14008-f874-4f70-aa12-0be550f6fda5"><img src="https://github.com/user-attachments/assets/3ab14008-f874-4f70-aa12-0be550f6fda5" alt=""/></a></figure><p>It&#39;s a drop-in replacement for <code>npm publish</code>, and supports many of the same features like:</p><ul><li>Reading <a href="https://bun.sh/docs/install/npmrc"><code>.npmrc</code></a> files for authentication.</li><li>Packing tarballs, accounting for <code>.gitignore</code> and <code>.npmignore</code> files in multiple directories.</li><li>OTP / Two-factor authentication.</li><li>Handling edgecases with package.json fields like <code>bin</code>, <code>files</code>, etc.</li><li>Handling missing <code>README</code> files carefully.</li></ul><p>We&#39;ve also added support for commands that are useful for publishing, like:</p><ul><li><a href="https://bun.sh/docs/cli/pm#whoami"><code>bun pm whoami</code></a>, which prints your npm username.</li><li><a href="https://bun.sh/docs/cli/pm#pack"><code>bun pm pack</code></a>, which creates an npm package tarball for publishing or installing locally.</li></ul><h3 level="3" anchor-id="bun-patch" id="bun-patch"><a name="bun-patch"></a><a href="#bun-patch"><code>bun patch</code></a></h3><p>Sometimes, your dependencies have bugs or missing features. While you could fork the package, make your changes, and publish it — that&#39;s a lot of work. What if you don&#39;t want to maintain a fork?</p><p>In Bun 1.2, we&#39;ve added support for patching dependencies. Here&#39;s how it works:</p><ol><li>Run <code>bun patch &lt;package&gt;</code> to patch a package.</li><li>Edit the files in the <code>node_modules/&lt;package&gt;</code> directory.</li><li>Run <code>bun patch --commit &lt;package&gt;</code> to save your changes. That&#39;s it!</li></ol><p>Bun generates a <code>.patch</code> file with your changes in the <code>patches/</code> directory, which is automatically applied on <code>bun install</code>. You can then commit the patch file to your repository, and share it with your team.</p><p>For example, you could create a patch to replace a dependency with your own code.</p><div><p>./patches/is-even@1.0.0.patch</p><div><div><pre><code><span><span>diff --git a/index.js b/index.js</span></span>
<span><span>index 832d92223a9ec491364ee10dcbe3ad495446ab80..2a61f0dd2f476a4a30631c570e6c8d2d148d419a 100644</span></span>
<span><span>--- a/index.js</span></span>
<span><span>+++ b/index.js</span></span>
<span><span>@@ -1,14 +1 @@</span></span>
<span><span>- &#39;use strict&#39;;</span></span>
<span><span>-</span></span>
<span><span>- var isOdd = require(&#39;is-odd&#39;);</span></span>
<span><span>-</span></span>
<span><span>- module.exports = function isEven(i) {</span></span>
<span><span>-   return !isOdd(i);</span></span>
<span><span>- };</span></span>
<span><span>+ module.exports = (i) =&gt; (i % 2 === 0)</span></span>
<span></span></code></pre></div></div></div><p>Bun clones the package from the <code>node_modules</code> directory with a fresh copy of itself. This allows you to safely make edits to files in the package&#39;s directory without impacting shared file caches.</p><h3 level="3" anchor-id="easier-to-use" id="easier-to-use"><a name="easier-to-use"></a><a href="#easier-to-use">Easier to use</a></h3><p>We&#39;ve also made a bunch of small improvements to make <code>bun install</code> easier to use.</p><h4 level="4" id="ca-certificates">CA certificates</h4><p>You can now configure CA certificates for <code>bun install</code>. This is useful when you need to install packages from your company&#39;s private registry, or if you want to use self-signed certificate.</p><div><p>bunfig.toml</p><div><div><pre><code><span><span>[</span><span>install</span><span>]</span></span>
<span><span># The CA certificate as a string</span></span>
<span><span>ca</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>-----BEGIN CERTIFICATE-----</span><span>\n</span><span>...</span><span>\n</span><span>-----END CERTIFICATE-----</span><span>&#34;</span></span>
<span></span>
<span><span># A path to a CA certificate file. The file can contain multiple certificates.</span></span>
<span><span>cafile</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>path/to/cafile</span><span>&#34;</span></span>
<span></span></code></pre></div></div></div><p>If you don&#39;t want to change your <a href="https://bun.sh/docs/runtime/bunfig#install-ca-and-install-cafile"><code>bunfig.toml</code></a> file, you can also use the <code>--ca</code> and <code>--cafile</code> flags.</p><div><div><div><pre><code><span><span>bun install --cafile=/path/to/cafile</span></span></code></pre></div></div></div><p>If you are using an existing <a href="https://bun.sh/docs/install/npmrc"><code>.npmrc</code></a> file, you can also configure CA certificates there.</p><div><p>.npmrc</p><div><div><pre><code><span><span>cafile=</span><span>/path/to/cafile</span></span>
<span><span>ca=</span><span>&#34;</span><span>...</span><span>&#34;</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="bundledependencies-support"><code>bundleDependencies</code> support</h4><p>You can now use <a href="https://docs.npmjs.com/cli/v11/configuring-npm/package-json#bundledependencies"><code>bundleDependencies</code></a> in your <code>package.json</code>.</p><div><p>package.json</p><div><div><pre><code><span><span>{</span></span>
<span><span>  </span><span>&#34;</span><span>bundleDependencies</span><span>&#34;</span><span>:</span><span> [</span><span>&#34;</span><span>is-even</span><span>&#34;</span><span>]</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>These are dependencies that you expect to already exist in your <code>node_modules</code> folder, and are not installed like other dependencies.</p><h4 level="4" id="bun-add-respects-package-json-indentation"><code>bun add</code> respects <code>package.json</code> indentation</h4><p>We fixed a bug where <code>bun add</code> would not respect the spacing and indentation in your <code>package.json</code>. Bun will now preserve the indentation of your <code>package.json</code>, no matter how wacky it is.</p><div><p>package.json</p><div><div><pre><code><span><span>// an intentionally wacky package.json</span></span>
<span><span>{</span></span>
<span><span>  </span><span>&#34;</span><span>dependencies</span><span>&#34;</span><span>:</span><span> {</span></span>
<span><span>              </span><span>&#34;</span><span>is-even</span><span>&#34;</span><span>:</span><span> </span><span>&#34;</span><span>1.0.0</span><span>&#34;</span><span>,</span></span>
<span><span>              </span><span>&#34;</span><span>is-odd</span><span>&#34;</span><span>:</span><span> </span><span>&#34;</span><span>1.0.0</span><span>&#34;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span></code></pre></div></div></div><h4 level="4" id="omit-dev-optional-peer-support"><code>--omit=dev|optional|peer</code> support</h4><p>Bun now supports the <code>--omit</code> flag with <code>bun install</code>, which allows you to omit dev, optional, or peer dependencies.</p><div><div><div><pre><code><span><span>bun install --omit=dev </span><span># omit dev dependencies</span></span></code></pre></div></div><div><div><pre><code><span><span>bun install --omit=optional </span><span># omit optional dependencies</span></span></code></pre></div></div><div><div><pre><code><span><span>bun install --omit=peer </span><span># omit peer dependencies</span></span></code></pre></div></div><div><div><pre><code><span><span>bun install --omit=dev --omit=optional </span><span># omit dev and optional dependencies</span></span></code></pre></div></div></div><h2 level="2" anchor-id="bun-is-a-test-runner" id="bun-is-a-test-runner"><a name="bun-is-a-test-runner"></a><a href="#bun-is-a-test-runner">Bun is a test runner</a></h2><p>Bun has a built-in test runner that makes it easy to write and run tests in JavaScript, TypeScript, and JSX. It supports many of the same APIs as Jest and Vitest, which includes the <a href="https://jestjs.io/docs/expect#expect"><code>expect()</code></a>-style APIs.</p><p>In Bun 1.2, we&#39;ve made a lot of improvements to <code>bun test</code>.</p><h3 level="3" anchor-id="junit-support" id="junit-support"><a name="junit-support"></a><a href="#junit-support">JUnit support</a></h3><p>To use <code>bun test</code> with CI/CD tools like Jenkins, CircleCI, and GitLab CI, you can use the <code>--reporter</code> option to output test results to a JUnit XML file.</p><div><div><div><pre><code><span><span>bun </span><span>test</span><span> --reporter=junit --reporter-outfile=junit.xml</span></span></code></pre></div></div></div><div><p>junit.xml</p><div><div><pre><code><span><span>&lt;?</span><span>xml</span><span> version</span><span>=</span><span>&#34;</span><span>1.0</span><span>&#34;</span><span> encoding</span><span>=</span><span>&#34;</span><span>UTF-8</span><span>&#34;</span><span>?&gt;</span></span>
<span><span>&lt;</span><span>testsuites</span><span> </span><span>name</span><span>=</span><span>&#34;</span><span>bun test</span><span>&#34;</span><span> </span><span>tests</span><span>=</span><span>&#34;</span><span>1</span><span>&#34;</span><span> </span><span>assertions</span><span>=</span><span>&#34;</span><span>1</span><span>&#34;</span><span> </span><span>failures</span><span>=</span><span>&#34;</span><span>1</span><span>&#34;</span><span> </span><span>time</span><span>=</span><span>&#34;</span><span>0.001</span><span>&#34;</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>testsuite</span><span> </span><span>name</span><span>=</span><span>&#34;</span><span>index.test.ts</span><span>&#34;</span><span> </span><span>tests</span><span>=</span><span>&#34;</span><span>1</span><span>&#34;</span><span> </span><span>assertions</span><span>=</span><span>&#34;</span><span>1</span><span>&#34;</span><span> </span><span>failures</span><span>=</span><span>&#34;</span><span>1</span><span>&#34;</span><span> </span><span>time</span><span>=</span><span>&#34;</span><span>0.001</span><span>&#34;</span><span>&gt;</span></span>
<span><span>    </span><span>&lt;!-- ... --&gt;</span></span>
<span><span>  &lt;/</span><span>testsuite</span><span>&gt;</span></span>
<span><span>&lt;/</span><span>testsuites</span><span>&gt;</span></span>
<span></span></code></pre></div></div></div><p>You can also enable JUnit reporting by adding the following to your <a href="https://bun.sh/docs/runtime/bunfig"><code>bunfig.toml</code></a> file.</p><div><p>bunfig.toml</p><div><div><pre><code><span><span>[</span><span>test</span><span>.</span><span>reporter</span><span>]</span></span>
<span><span>junit</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>junit.xml</span><span>&#34;</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="lcov-support" id="lcov-support"><a name="lcov-support"></a><a href="#lcov-support">LCOV support</a></h3><p>You can use <code>bun test --coverage</code> to generate a text-based coverage report of your tests.</p><p>In Bun 1.2, we added support for LCOV coverage reporting. <a href="https://github.com/linux-test-project/lcov">LCOV</a> is a standard format for code coverage reports, and is used by many tools like Codecov.</p><div><div><div><pre><code><span><span>bun </span><span>test</span><span> --coverage --coverage-reporter=lcov</span></span></code></pre></div></div></div><p>By default, this outputs a <code>lcov.info</code> coverage report file in the <code>coverage</code> directory. You can change the coverage directory with <code>--coverage-dir</code>.</p><p>If you want to always enable coverage reporting, you can add the following to your <a href="https://bun.sh/docs/runtime/bunfig"><code>bunfig.toml</code></a> file.</p><div><p>bunfig.toml</p><div><div><pre><code><span><span>[</span><span>test</span><span>]</span></span>
<span><span>coverage</span><span> </span><span>=</span><span> </span><span>true</span></span>
<span><span>coverageReporter</span><span> </span><span>=</span><span> [</span><span>&#34;</span><span>lcov</span><span>&#34;</span><span>]  </span><span># default [&#34;text&#34;]</span></span>
<span><span>coverageDir</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>./path/to/folder</span><span>&#34;</span><span>  </span><span># default &#34;./coverage&#34;</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="inline-snapshots" id="inline-snapshots"><a name="inline-snapshots"></a><a href="#inline-snapshots">Inline snapshots</a></h3><p>You can now use <a href="https://jestjs.io/docs/snapshot-testing#inline-snapshots">inline snapshots</a> using <code>expect().toMatchInlineSnapshot()</code>.</p><p>Unlike <a href="https://jestjs.io/docs/expect#tomatchsnapshotpropertymatchers-hint"><code>toMatchSnapshot()</code></a>, which stores the snapshot in a separate file, <a href="https://jestjs.io/docs/expect#tomatchinlinesnapshotpropertymatchers-inlinesnapshot"><code>toMatchInlineSnapshot()</code></a> stores snapshots directly in the test file. This makes it easier see, and even change your snapshots.</p><p>First, write a test that uses <code>toMatchInlineSnapshot()</code>.</p><div><p>snapshot.test.ts</p><div><div><pre><code><span><span>import</span><span> { expect, test } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>toMatchInlineSnapshot()</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>expect</span><span>(</span><span>new</span><span> </span><span>Date</span><span>()).</span><span>toMatchInlineSnapshot</span><span>();</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>Next, update the snapshot with <code>bun test -u</code>, which is short for <code>--update-snapshots</code>.</p><p>Then, voilà! Bun has updated the test file with your snapshot.</p><div><p>snapshot.test.ts</p><div><div><pre><code><span><span>import</span><span> { expect, test } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>toMatchInlineSnapshot()</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>   </span><span>expect</span><span>(</span><span>new</span><span> </span><span>Date</span><span>()).</span><span>toMatchInlineSnapshot</span><span>();</span></span>
<span><span>   </span><span>expect</span><span>(</span><span>new</span><span> </span><span>Date</span><span>()).</span><span>toMatchInlineSnapshot</span><span>(</span><span>`2025-01-18T02:35:53.332Z`</span><span>);</span></span>
<span><span>});</span></span></code></pre></div></div></div><p>You can also use these matchers, which do a similar thing:</p><ul><li><a href="https://jestjs.io/docs/expect#tothrowerrormatchingsnapshothint"><code>toThrowErrorMatchingSnapshot()</code></a></li><li><a href="https://jestjs.io/docs/expect#tothrowerrormatchinginlinesnapshotinlinesnapshot"><code>toThrowErrorMatchingInlineSnapshot()</code></a></li></ul><h3 level="3" anchor-id="test-only" id="test-only"><a name="test-only"></a><a href="#test-only"><code>test.only()</code></a></h3><p>You can use <a href="https://jestjs.io/docs/api#testonlyname-fn-timeout"><code>test.only()</code></a> to run a single test, excluding all other tests. This is useful when you&#39;re debugging a specific test, and don&#39;t want to run the entire test suite.</p><div><div><div><pre><code><span><span>import</span><span> { test } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>test.</span><span>only</span><span>(</span><span>&#34;</span><span>test a</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>/* Only run this test  */</span></span>
<span><span>});</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>test b</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>/* Don&#39;t run this test */</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>Previously, for this to work in Bun, you had to use the <code>--only</code> flag.</p><p>This was annoying, you&#39;d usually forget to do it, and test runners like Jest don&#39;t need it! In Bun 1.2, we&#39;ve made this &#34;just work&#34;, without the need for flags.</p><h3 level="3" anchor-id="new-expect-matchers" id="new-expect-matchers"><a name="new-expect-matchers"></a><a href="#new-expect-matchers">New <code>expect()</code> matchers</a></h3><p>In Bun 1.2, we added a bunch of matchers to the <a href="https://jestjs.io/docs/expect"><code>expect()</code></a> API. These are the same matchers that are implemented by Jest, Vitest, or the <a href="https://jest-extended.jestcommunity.dev/"><code>jest-extended</code></a> library.</p><p>You can use <a href="https://jest-extended.jestcommunity.dev/docs/matchers/object/#tocontainvaluevalue"><code>toContainValue()</code></a> and derivatives to check if an object contains a value.</p><div><div><div><pre><code><span><span>const</span><span> object </span><span>=</span><span> </span><span>new</span><span> </span><span>Set</span><span>([</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>, </span><span>&#34;</span><span>node</span><span>&#34;</span><span>, </span><span>&#34;</span><span>npm</span><span>&#34;</span><span>]);</span></span>
<span></span>
<span><span>expect</span><span>(object).</span><span>toContainValue</span><span>(</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>);</span></span>
<span><span>expect</span><span>(object).</span><span>toContainValues</span><span>([</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>, </span><span>&#34;</span><span>node</span><span>&#34;</span><span>]);</span></span>
<span><span>expect</span><span>(object).</span><span>toContainAllValues</span><span>([</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>, </span><span>&#34;</span><span>node</span><span>&#34;</span><span>, </span><span>&#34;</span><span>npm</span><span>&#34;</span><span>]);</span></span>
<span><span>expect</span><span>(object).not.</span><span>toContainAnyValues</span><span>([</span><span>&#34;</span><span>done</span><span>&#34;</span><span>]);</span></span>
<span></span></code></pre></div></div></div><p>Or, use <a href="https://jest-extended.jestcommunity.dev/docs/matchers/object/#tocontainkeykey"><code>toContainKey()</code></a> and derivatives to check if an object contains a key.</p><div><div><div><pre><code><span><span>const</span><span> object </span><span>=</span><span> </span><span>new</span><span> </span><span>Map</span><span>([</span></span>
<span><span>  [</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>, </span><span>&#34;</span><span>1.2.0</span><span>&#34;</span><span>],</span></span>
<span><span>  [</span><span>&#34;</span><span>node</span><span>&#34;</span><span>, </span><span>&#34;</span><span>22.13.0</span><span>&#34;</span><span>],</span></span>
<span><span>  [</span><span>&#34;</span><span>npm</span><span>&#34;</span><span>, </span><span>&#34;</span><span>9.1.2</span><span>&#34;</span><span>],</span></span>
<span><span>]);</span></span>
<span></span>
<span><span>expect</span><span>(object).</span><span>toContainKey</span><span>(</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>);</span></span>
<span><span>expect</span><span>(object).</span><span>toContainKeys</span><span>([</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>, </span><span>&#34;</span><span>node</span><span>&#34;</span><span>]);</span></span>
<span><span>expect</span><span>(object).</span><span>toContainAllKeys</span><span>([</span><span>&#34;</span><span>bun</span><span>&#34;</span><span>, </span><span>&#34;</span><span>node</span><span>&#34;</span><span>, </span><span>&#34;</span><span>npm</span><span>&#34;</span><span>]);</span></span>
<span><span>expect</span><span>(object).not.</span><span>toContainAnyKeys</span><span>([</span><span>&#34;</span><span>done</span><span>&#34;</span><span>]);</span></span>
<span></span></code></pre></div></div></div><p>You can also use <a href="https://jestjs.io/docs/expect#tohavereturned"><code>toHaveReturned()</code></a> and derivatives to check if a mocked function has returned a value.</p><div><div><div><pre><code><span><span>import</span><span> { jest, test, expect } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>toHaveReturned()</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>const</span><span> mock </span><span>=</span><span> jest.</span><span>fn</span><span>(() </span><span>=&gt;</span><span> </span><span>&#34;</span><span>foo</span><span>&#34;</span><span>);</span></span>
<span><span>  </span><span>mock</span><span>();</span></span>
<span><span>  </span><span>expect</span><span>(mock).</span><span>toHaveReturned</span><span>();</span></span>
<span><span>  </span><span>mock</span><span>();</span></span>
<span><span>  </span><span>expect</span><span>(mock).</span><span>toHaveReturnedTimes</span><span>(</span><span>2</span><span>);</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="custom-error-messages" id="custom-error-messages"><a name="custom-error-messages"></a><a href="#custom-error-messages">Custom error messages</a></h3><p>We&#39;ve also added support for custom error messages using <code>expect()</code>.</p><p>You can now pass a string as the second argument to <code>expect()</code>, which will be used as the error message. This is useful when you want to document what the assertion is checking.</p><div><p>example.test.ts</p><div><div><pre><code><span><span>import</span><span> { test, expect } </span><span>from</span><span> </span><span>&#39;</span><span>bun:test</span><span>&#39;</span><span>;</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>custom error message</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>expect</span><span>(</span><span>0.1</span><span> </span><span>+</span><span> </span><span>0.2</span><span>).</span><span>toBe</span><span>(</span><span>0.3</span><span>);</span></span>
<span><span>  </span><span>expect</span><span>(</span><span>0.1</span><span> </span><span>+</span><span> </span><span>0.2</span><span>, </span><span>&#34;</span><span>Floating point has precision error</span><span>&#34;</span><span>).</span><span>toBe</span><span>(</span><span>0.3</span><span>);</span></span>
<span><span>});</span></span></code></pre></div></div></div><div><div><div><pre><code><span><span>1 </span><span>|</span><span> import { test, expect } from </span><span>&#39;</span><span>bun:test</span><span>&#39;</span><span>;</span></span>
<span><span>2 </span><span>|</span></span>
<span><span>3 </span><span>|</span><span> test(</span><span>&#34;</span><span>custom error message</span><span>&#34;</span><span>, () =</span><span>&gt;</span><span> {</span></span>
<span><span>4 </span><span>|</span><span>   expect(0.1 + 0.2, </span><span>&#34;</span><span>Floating point has precision error</span><span>&#34;</span><span>).toBe(0.3)</span><span>;</span></span>
<span><span>                                                              ^</span></span>
<span><span>error: expect(received).toBe(expected)</span></span>
<span><span>error: Floating point has precision error</span></span>
<span></span>
<span><span>Expected: 0.3</span></span>
<span><span>Received: 0.30000000000000004</span></span></code></pre></div></div></div><h3 level="3" anchor-id="jest-settimeout" id="jest-settimeout"><a name="jest-settimeout"></a><a href="#jest-settimeout"><code>jest.setTimeout()</code></a></h3><p>You can now use Jest&#39;s <a href="https://jestjs.io/docs/jest-object#jestsettimeouttimeout"><code>setTimeout()</code></a> API to change the default timeout for tests in the current scope or module, instead of setting the timeout for each test.</p><div><div><div><pre><code><span><span>jest.</span><span>setTimeout</span><span>(</span><span>60</span><span> </span><span>*</span><span> </span><span>1000</span><span>); </span><span>// 1 minute</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>do something that takes a long time</span><span>&#34;</span><span>, </span><span>async</span><span> () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>await</span><span> Bun.</span><span>sleep</span><span>(</span><span>Infinity</span><span>);</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>You can also import <code>setDefaultTimeout()</code> from Bun&#39;s test APIs, which does the same thing. We chose a different name to avoid confusion with the global <code>setTimeout()</code> function.</p><div><div><div><pre><code><span><span>import</span><span> { setDefaultTimeout } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>setDefaultTimeout</span><span>(</span><span>60</span><span> </span><span>*</span><span> </span><span>1000</span><span>); </span><span>// 1 minute</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="bun-is-a-javascript-bundler" id="bun-is-a-javascript-bundler"><a name="bun-is-a-javascript-bundler"></a><a href="#bun-is-a-javascript-bundler">Bun is a JavaScript bundler</a></h2><p>Bun is a JavaScript and TypeScript bundler, transpiler, and minifier that can be used to bundle code for the browser, Node.js, and other platforms.</p><h3 level="3" anchor-id="html-imports" id="html-imports"><a name="html-imports"></a><a href="#html-imports">HTML imports</a></h3><p>In Bun 1.2, we&#39;ve added support for HTML imports. This allows you to replace your entire frontend toolchain with a single import statement.</p><p>To get started, pass an HTML import to the <code>static</code> option in <code>Bun.serve</code>:</p><div><div><div><pre><code><span><span>import</span><span> homepage </span><span>from</span><span> </span><span>&#34;</span><span>./index.html</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>Bun.</span><span>serve</span><span>({</span></span>
<span><span>  static</span><span>:</span><span> {</span></span>
<span><span>    </span><span>&#34;</span><span>/</span><span>&#34;</span><span>:</span><span> homepage,</span></span>
<span><span>  },</span></span>
<span></span>
<span><span>  </span><span>async</span><span> </span><span>fetch</span><span>(</span><span>req</span><span>) {</span></span>
<span><span>    </span><span>// ... api requests</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>When you make a request to <code>/</code>, Bun automatically bundles the <code>&lt;script&gt;</code> and <code>&lt;link&gt;</code> tags in the HTML files, exposes them as static routes, and serves the result.</p><p>An index.html file like this:</p><div><p>index.html</p><div><div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span><span> </span><span>html</span><span>&gt;</span></span>
<span><span>&lt;</span><span>html</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>head</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>title</span><span>&gt;Home&lt;/</span><span>title</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>link</span><span> </span><span>rel</span><span>=</span><span>&#34;</span><span>stylesheet</span><span>&#34;</span><span> </span><span>href</span><span>=</span><span>&#34;</span><span>./reset.css</span><span>&#34;</span><span> /&gt;</span></span>
<span><span>    &lt;</span><span>link</span><span> </span><span>rel</span><span>=</span><span>&#34;</span><span>stylesheet</span><span>&#34;</span><span> </span><span>href</span><span>=</span><span>&#34;</span><span>./styles.css</span><span>&#34;</span><span> /&gt;</span></span>
<span><span>  &lt;/</span><span>head</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>body</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>div</span><span> </span><span>id</span><span>=</span><span>&#34;</span><span>root</span><span>&#34;</span><span>&gt;&lt;/</span><span>div</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>script</span><span> </span><span>type</span><span>=</span><span>&#34;</span><span>module</span><span>&#34;</span><span> </span><span>src</span><span>=</span><span>&#34;</span><span>./sentry-and-preloads.ts</span><span>&#34;</span><span>&gt;&lt;/</span><span>script</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>script</span><span> </span><span>type</span><span>=</span><span>&#34;</span><span>module</span><span>&#34;</span><span> </span><span>src</span><span>=</span><span>&#34;</span><span>./my-app.tsx</span><span>&#34;</span><span>&gt;&lt;/</span><span>script</span><span>&gt;</span></span>
<span><span>  &lt;/</span><span>body</span><span>&gt;</span></span>
<span><span>&lt;/</span><span>html</span><span>&gt;</span></span>
<span></span></code></pre></div></div></div><p>Becomes something like this:</p><div><p>index.html</p><div><div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span><span> </span><span>html</span><span>&gt;</span></span>
<span><span>&lt;</span><span>html</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>head</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>title</span><span>&gt;Home&lt;/</span><span>title</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>link</span><span> </span><span>rel</span><span>=</span><span>&#34;</span><span>stylesheet</span><span>&#34;</span><span> </span><span>href</span><span>=</span><span>&#34;</span><span>/index-[hash].css</span><span>&#34;</span><span> /&gt;</span></span>
<span><span>  &lt;/</span><span>head</span><span>&gt;</span></span>
<span><span>  &lt;</span><span>body</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>div</span><span> </span><span>id</span><span>=</span><span>&#34;</span><span>root</span><span>&#34;</span><span>&gt;&lt;/</span><span>div</span><span>&gt;</span></span>
<span><span>    &lt;</span><span>script</span><span> </span><span>type</span><span>=</span><span>&#34;</span><span>module</span><span>&#34;</span><span> </span><span>src</span><span>=</span><span>&#34;</span><span>/index-[hash].js</span><span>&#34;</span><span>&gt;&lt;/</span><span>script</span><span>&gt;</span></span>
<span><span>  &lt;/</span><span>body</span><span>&gt;</span></span>
<span><span>&lt;/</span><span>html</span><span>&gt;</span></span>
<span></span></code></pre></div></div></div><p>To read more about HTML imports and how they&#39;re implemented, check out the <a href="https://bun.sh/docs/bundler/fullstack">HTML imports</a> documentation.</p><h3 level="3" anchor-id="standalone-executables" id="standalone-executables"><a name="standalone-executables"></a><a href="#standalone-executables">Standalone executables</a></h3><p>You can use <a href="https://bun.sh/docs/bundler/executables"><code>bun build --compile</code></a> to compile your application, and Bun, into a standalone executable.</p><p>In Bun 1.2, we&#39;ve added support for cross-compilation. This allows you to build a Windows or macOS binary on a Linux machine, and vice versa.</p><p>You can run the following command on a macOS or Linux machine, and it will compile a Windows binary.</p><div><div><div><pre><code><span><span>bun build --compile --target=bun-windows-x64 app.ts</span></span></code></pre></div></div><div><div><pre><code><span><span>   [8ms]  bundle  1 modules</span></span>
<span><span>[1485ms] compile  app.exe bun-windows-x64-v1.2.0</span></span></code></pre></div></div></div><p>For Windows specific builds, you can customize the icon and hide the console window.</p><div><div><div><pre><code><span><span>bun build --compile --windows-icon=./icon.ico --windows-hide-console app.ts</span></span></code></pre></div></div></div><h3 level="3" anchor-id="bytecode-caching" id="bytecode-caching"><a name="bytecode-caching"></a><a href="#bytecode-caching">Bytecode caching</a></h3><p>You can also use <a href="https://bun.sh/docs/bundler/build#bytecode"><code>bun build --bytecode</code></a> flag to generate a bytecode cache. This improves the startup time of applications like <code>eslint</code> to be <a href="https://x.com/jarredsumner/status/1840729983528137043">2x faster</a>.</p><div><div><div><pre><code><span><span>bun build --bytecode --compile app.ts</span></span></code></pre></div></div></div><p>You can also use the bytecode cache without <code>--compile</code>.</p><div><div><div><pre><code><span><span>bun build --bytecode --outdir=dist app.ts</span></span></code></pre></div></div></div><p>When Bun generates output files, it will also generate <code>.jsc</code> files, which contain the bytecode cache of its respective <code>.js</code> file. Both files are necessary to run, as the bytecode compilation doesn&#39;t currently compile async functions, generators, or eval.</p><p>The bytecode cache can be 8x larger than the source code, so this makes startup faster at a cost of increased disk space.</p><h3 level="3" anchor-id="commonjs-output-format" id="commonjs-output-format"><a name="commonjs-output-format"></a><a href="#commonjs-output-format">CommonJS output format</a></h3><p>You can now set the output format to CommonJS with <code>bun build</code>. Previously, only ESM was supported.</p><div><div><div><pre><code><span><span>bun build --format=cjs app.ts</span></span></code></pre></div></div></div><p>This makes it easier to create libraries and applications meant for older versions of Node.js.</p><div id="DkFZlprlTQ"><div><div><p>app.ts</p><div><div><pre><code><span><span>// app.ts</span></span>
<span><span>export</span><span> </span><span>default</span><span> </span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>;</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>app.js</p><div><div><pre><code><span><span>var</span><span> __defProp </span><span>=</span><span> </span><span>Object</span><span>.defineProperty;</span></span>
<span><span>var</span><span> __getOwnPropNames </span><span>=</span><span> </span><span>Object</span><span>.getOwnPropertyNames;</span></span>
<span><span>var</span><span> __getOwnPropDesc </span><span>=</span><span> </span><span>Object</span><span>.getOwnPropertyDescriptor;</span></span>
<span><span>var</span><span> __hasOwnProp </span><span>=</span><span> </span><span>Object</span><span>.prototype.hasOwnProperty;</span></span>
<span><span>var</span><span> __moduleCache </span><span>=</span><span> </span><span>/* @__PURE__ */</span><span> </span><span>new</span><span> </span><span>WeakMap</span><span>;</span></span>
<span><span>var</span><span> </span><span>__toCommonJS</span><span> </span><span>=</span><span> (</span><span>from</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>var</span><span> entry </span><span>=</span><span> __moduleCache.</span><span>get</span><span>(from), desc;</span></span>
<span><span>  </span><span>if</span><span> (entry)</span></span>
<span><span>    </span><span>return</span><span> entry;</span></span>
<span><span>  entry </span><span>=</span><span> </span><span>__defProp</span><span>({}, </span><span>&#34;</span><span>__esModule</span><span>&#34;</span><span>, { value</span><span>:</span><span> </span><span>true</span><span> });</span></span>
<span><span>  </span><span>if</span><span> (from </span><span>&amp;&amp;</span><span> </span><span>typeof</span><span> from </span><span>===</span><span> </span><span>&#34;</span><span>object</span><span>&#34;</span><span> </span><span>||</span><span> </span><span>typeof</span><span> from </span><span>===</span><span> </span><span>&#34;</span><span>function</span><span>&#34;</span><span>)</span></span>
<span><span>    </span><span>__getOwnPropNames</span><span>(from).</span><span>map</span><span>((</span><span>key</span><span>) </span><span>=&gt;</span><span> </span><span>!</span><span>__hasOwnProp.</span><span>call</span><span>(entry, key) </span><span>&amp;&amp;</span><span> </span><span>__defProp</span><span>(entry, key, {</span></span>
<span><span>      </span><span>get</span><span>:</span><span> () </span><span>=&gt;</span><span> from[key],</span></span>
<span><span>      enumerable</span><span>:</span><span> </span><span>!</span><span>(desc </span><span>=</span><span> </span><span>__getOwnPropDesc</span><span>(from, key)) </span><span>||</span><span> desc.enumerable</span></span>
<span><span>    }));</span></span>
<span><span>  __moduleCache.</span><span>set</span><span>(from, entry);</span></span>
<span><span>  </span><span>return</span><span> entry;</span></span>
<span><span>};</span></span>
<span><span>var</span><span> </span><span>__export</span><span> </span><span>=</span><span> (</span><span>target</span><span>, </span><span>all</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>for</span><span> (</span><span>var</span><span> name </span><span>in</span><span> all)</span></span>
<span><span>    </span><span>__defProp</span><span>(target, name, {</span></span>
<span><span>      get</span><span>:</span><span> all[name],</span></span>
<span><span>      enumerable</span><span>:</span><span> </span><span>true</span><span>,</span></span>
<span><span>      configurable</span><span>:</span><span> </span><span>true</span><span>,</span></span>
<span><span>      </span><span>set</span><span>:</span><span> (</span><span>newValue</span><span>) </span><span>=&gt;</span><span> all[name] </span><span>=</span><span> () </span><span>=&gt;</span><span> newValue</span></span>
<span><span>    });</span></span>
<span><span>};</span></span>
<span></span>
<span><span>// app.js</span></span>
<span><span>var</span><span> exports_site </span><span>=</span><span> {};</span></span>
<span><span>__export</span><span>(exports_site, {</span></span>
<span><span>  </span><span>default</span><span>:</span><span> () </span><span>=&gt;</span><span> site_default</span></span>
<span><span>});</span></span>
<span><span>module</span><span>.</span><span>exports</span><span> </span><span>=</span><span> </span><span>__toCommonJS</span><span>(exports_site);</span></span>
<span><span>var</span><span> site_default </span><span>=</span><span> </span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>;</span></span>
<span></span></code></pre></div></div></div></div></div><h3 level="3" anchor-id="better-commonjs-detection" id="better-commonjs-detection"><a name="better-commonjs-detection"></a><a href="#better-commonjs-detection">Better CommonJS detection</a></h3><p>Some packages <em>really</em> want to trick bundlers and get the current module&#39;s file path, do a runtime require, or check if the current module is the main module. They try all kinds of things to make it work, such as:</p><div><div><div><pre><code><span><span>&#34;</span><span>use strict</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>if</span><span> (</span><span>eval</span><span>(</span><span>&#34;</span><span>require.main</span><span>&#34;</span><span>) </span><span>===</span><span> </span><span>eval</span><span>(</span><span>&#34;</span><span>module.main</span><span>&#34;</span><span>)) {</span></span>
<span><span>  </span><span>// ...</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>Bun supports both CommonJS and ESM; in fact, you can use <code>require()</code> and <code>import</code> in the same file. However, one of the challenges of supporting both is that there&#39;s a lot of ambiguity.</p><p>Consider the following code, is it CommonJS or ESM?</p><p>There&#39;s no way to tell. Then, how about this?</p><div><div><div><pre><code><span><span>console.</span><span>log</span><span>(</span><span>module</span><span>.</span><span>require</span><span>(</span><span>&#34;</span><span>path</span><span>&#34;</span><span>));</span></span>
<span></span></code></pre></div></div></div><p>CommonJS, because it&#39;s using <code>module.require()</code> to get the <code>path</code> module. And this?</p><div><div><div><pre><code><span><span>import</span><span> path </span><span>from</span><span> </span><span>&#34;</span><span>path</span><span>&#34;</span><span>;</span></span>
<span><span>console.</span><span>log</span><span>(path);</span></span>
<span></span></code></pre></div></div></div><p>ESM, because it&#39;s using <code>import</code>. But, what about this?</p><div><div><div><pre><code><span><span>import</span><span> path </span><span>from</span><span> </span><span>&#34;</span><span>path</span><span>&#34;</span><span>;</span></span>
<span><span>const</span><span> fs </span><span>=</span><span> </span><span>require</span><span>(</span><span>&#34;</span><span>fs</span><span>&#34;</span><span>);</span></span>
<span><span>console.</span><span>log</span><span>(fs.</span><span>readFileSync</span><span>(path.</span><span>resolve</span><span>(</span><span>&#34;</span><span>package.json</span><span>&#34;</span><span>), </span><span>&#34;</span><span>utf8</span><span>&#34;</span><span>));</span></span>
<span></span></code></pre></div></div></div><p>ESM, because it&#39;s using <code>import</code>. If we said it was CommonJS due to the require, then the <code>import</code> would break the code. We want to simplify building stuff in JavaScript, so let&#39;s just say it&#39;s ESM and not be fussy.</p><p>Finally, what about this?</p><div><div><div><pre><code><span><span>&#34;</span><span>use strict</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(</span><span>eval</span><span>(</span><span>&#34;</span><span>module.require(&#39;path&#39;)</span><span>&#34;</span><span>));</span></span>
<span></span></code></pre></div></div></div><p>Previously, Bun would have said ESM, because it&#39;s the default when there&#39;s no way to tell (including when the file extension is ambiguous, there&#39;s no &#34;type&#34; field in package.json, no export, no import, etc).</p><p>In Bun 1.2, Bun will say CommonJS, because of the &#34;use strict&#34; directive at the top of the file. ESM is always in strict mode, so an explicit &#34;use strict&#34; would be redundant.</p><p>Also, most build tools that output CommonJS include &#34;use strict&#34; at the top of the file. So we can now use this as a last-chance heuristic when it&#39;s completely ambiguous whether the file is CommonJS or ESM.</p><h3 level="3" anchor-id="plugin-api" id="plugin-api"><a name="plugin-api"></a><a href="#plugin-api">Plugin API</a></h3><p>Bun has a universal <a href="https://bun.sh/docs/bundler/plugins">plugin API</a> for extending the bundler <em>and</em> the runtime.</p><p>You can use plugins to intercept <code>import()</code> statements, add custom loaders for extensions like <code>.yaml</code>, and implement frameworks for Bun.</p><h3 level="3" anchor-id="onbeforeparse" id="onbeforeparse"><a name="onbeforeparse"></a><a href="#onbeforeparse"><code>onBeforeParse()</code></a></h3><p>In Bun 1.2, we&#39;re introducing a new lifecycle hook for plugins, <a href="https://bun.sh/docs/bundler/plugins#onbeforeparse"><code>onBeforeParse()</code></a>.</p><p>Unlike the existing lifecycle hooks that run JavaScript code, this hook must be a <a href="https://bun.sh/docs/api/node-api">N-API addon</a>, which can be implemented in a compiled language like Rust, C/C++, or Zig.</p><p>The hook is called immediately before parsing, without cloning the source code, without undergoing string conversion, and with practically zero overhead.</p><p>For example, you can create a Rust plugin that replaces all occurrences of <code>foo</code> with <code>bar</code>.</p><div><div><div><pre><code><span><span>cargo add bun-native-plugin</span></span></code></pre></div></div></div><p>From there, you can implement the <code>onBeforeParse()</code> hook. These are advanced APIs, primarily designed for plugin and framework authors who want to use native code to make their plugins really fast.</p><div id="WPLUPcOMOc"><div><div><p>lib.rs</p><div><div><pre><code><span><span>use</span><span> bun_native_plugin</span><span>::</span><span>{define_bun_plugin, </span><span>OnBeforeParse</span><span>, bun, </span><span>Result</span><span>, anyhow, </span><span>BunLoader</span><span>};</span></span>
<span><span>use</span><span> napi_derive</span><span>::</span><span>napi;</span></span>
<span></span>
<span><span>define_bun_plugin!</span><span>(</span><span>&#34;foo-bar-plugin&#34;</span><span>);</span></span>
<span></span>
<span><span>#[bun]</span></span>
<span><span>pub</span><span> </span><span>fn</span><span> </span><span>replace_foo_with_bar</span><span>(handle</span><span>:</span><span> </span><span>&amp;mut</span><span> </span><span>OnBeforeParse</span><span>) </span><span>-&gt;</span><span> </span><span>Result</span><span>&lt;()&gt; {</span></span>
<span><span>  </span><span>let</span><span> input_source_code </span><span>=</span><span> handle</span><span>.</span><span>input_source_code</span><span>()</span><span>?</span><span>;</span></span>
<span><span>  </span><span>let</span><span> output_source_code </span><span>=</span><span> input_source_code</span><span>.</span><span>replace</span><span>(</span><span>&#34;foo&#34;</span><span>, </span><span>&#34;bar&#34;</span><span>);</span></span>
<span></span>
<span><span>  handle</span><span>.</span><span>set_output_source_code</span><span>(output_source_code, </span><span>BunLoader</span><span>::</span><span>BUN_LOADER_JSX</span><span>);</span></span>
<span><span>  </span><span>Ok</span><span>(())</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>build.ts</p><div><div><pre><code><span><span>import</span><span> { build } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> fooBarPlugin </span><span>from</span><span> </span><span>&#34;</span><span>./foo-bar-plugin</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>await</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./app.tsx</span><span>&#34;</span><span>],</span></span>
<span><span>  plugins</span><span>:</span><span> [</span></span>
<span><span>    {</span></span>
<span><span>      name</span><span>:</span><span> </span><span>&#34;</span><span>foo-bar-plugin</span><span>&#34;</span><span>,</span></span>
<span><span>      </span><span>setup</span><span>(</span><span>build</span><span>) {</span></span>
<span><span>        build.</span><span>onBeforeParse</span><span>(</span></span>
<span><span>          {</span></span>
<span><span>            namespace</span><span>:</span><span> </span><span>&#34;</span><span>file</span><span>&#34;</span><span>,</span></span>
<span><span>            filter</span><span>:</span><span> </span><span>&#34;</span><span>**/*.tsx</span><span>&#34;</span><span>,</span></span>
<span><span>          },</span></span>
<span><span>          {</span></span>
<span><span>            napiModule</span><span>:</span><span> fooBarPlugin,</span></span>
<span><span>            symbol</span><span>:</span><span> </span><span>&#34;</span><span>replace_foo_with_bar</span><span>&#34;</span><span>,</span></span>
<span><span>          },</span></span>
<span><span>        );</span></span>
<span><span>      },</span></span>
<span><span>    },</span></span>
<span><span>  ],</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div></div></div><h3 level="3" anchor-id="other-changes" id="other-changes"><a name="other-changes"></a><a href="#other-changes">Other changes</a></h3><p>We also made a lot of other improvements to <code>bun build</code> and the <code>Bun.build()</code> APIs.</p><h4 level="4" id="inject-environment-variables">Inject environment variables</h4><p>You can now inject environment variables from your system environment into your bundle.</p><div id="qundCAWRKi"><div><div><p>CLI</p><div><div><pre><code><span><span>bun build --env=</span><span>&#34;</span><span>PUBLIC_*</span><span>&#34;</span><span> app.tsx</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>JavaScript</p><div><div><pre><code><span><span>import</span><span> { build } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>await</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./app.tsx</span><span>&#34;</span><span>],</span></span>
<span><span>  outdir</span><span>:</span><span> </span><span>&#34;</span><span>./out</span><span>&#34;</span><span>,</span></span>
<span><span>  </span><span>// Environment variables starting with &#34;PUBLIC_&#34;</span></span>
<span><span>  </span><span>// will be injected in the build as process.env.PUBLIC_*</span></span>
<span><span>  env</span><span>:</span><span> </span><span>&#34;</span><span>PUBLIC_*</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div></div></div><h4 level="4" id="bun-build-drop"><code>bun build --drop</code></h4><p>You can use <code>--drop</code> to remove function calls from your JavaScript bundle. For example, if you pass <code>--drop=console</code>, all calls to <code>console.log()</code> will be removed from your code.</p><div id="zkrZCMYZKk"><div><div><p>JavaScript</p><div><div><pre><code><span><span>import</span><span> { build } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>await</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./index.tsx</span><span>&#34;</span><span>],</span></span>
<span><span>  outdir</span><span>:</span><span> </span><span>&#34;</span><span>./out</span><span>&#34;</span><span>,</span></span>
<span><span>  drop</span><span>:</span><span> [</span><span>&#34;</span><span>console</span><span>&#34;</span><span>, </span><span>&#34;</span><span>anyIdentifier.or.propertyAccess</span><span>&#34;</span><span>],</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>CLI</p><div><div><pre><code><span><span>bun build ./index.tsx --outdir ./out --drop=console --drop=anyIdentifier.or.propertyAccess</span></span></code></pre></div></div></div></div></div><h4 level="4" id="banner-and-footer">Banner and footer</h4><p>You can now use the banner and footer options in <code>bun build</code> to add content above or below the bundle.</p><div id="DWDdTGktQn"><div><div><p>CLI</p><div><div><pre><code><span><span>bun build --banner </span><span>&#34;</span><span>/* Banner! */</span><span>&#34;</span><span> --footer </span><span>&#34;</span><span>/* Footer! */</span><span>&#34;</span><span> app.ts</span></span></code></pre></div></div></div></div><div><div><p>JavaScript</p><div><div><pre><code><span><span>import</span><span> { build } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>await</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./app.ts</span><span>&#34;</span><span>],</span></span>
<span><span>  outdir</span><span>:</span><span> </span><span>&#34;</span><span>./dist</span><span>&#34;</span><span>,</span></span>
<span><span>  banner</span><span>:</span><span> </span><span>&#34;</span><span>/* Banner! */</span><span>&#34;</span><span>,</span></span>
<span><span>  footer</span><span>:</span><span> </span><span>&#34;</span><span>/* Footer! */</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div></div></div><p>This is useful for appending content above or below the bundle, such as a license or copyright notice.</p><div><div><div><pre><code><span><span>/**</span></span>
<span><span> * Banner!</span></span>
<span><span> */</span></span>
<span><span>export</span><span> </span><span>default</span><span> </span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>;</span></span>
<span><span>/**</span></span>
<span><span> * Footer!</span></span>
<span><span> */</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="bun-embeddedfiles"><code>Bun.embeddedFiles()</code></h4><p>You can use the new <code>Bun.embeddedFiles()</code> API to see a list of all embedded files in a standalone executable, compiled with <code>bun build --compile</code>.</p><div><div><div><pre><code><span><span>import</span><span> { embeddedFiles } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>for</span><span> (</span><span>const</span><span> file </span><span>of</span><span> embeddedFiles) {</span></span>
<span><span>  console.</span><span>log</span><span>(file.name); </span><span>// &#34;logo.png&#34;</span></span>
<span><span>  console.</span><span>log</span><span>(file.size); </span><span>// 1234</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>await</span><span> file.</span><span>bytes</span><span>()); </span><span>// Uint8Array(1234) [...]</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="require-main-module"><code>require.main === module</code></h4><p>Previously, using <code>require.main === module</code> would mark the module as CommonJS. Now, Bun rewrites this into <code>import.meta.main</code>, meaning you can use this pattern alongside import statements.</p><div><div><div><pre><code><span><span>import</span><span> </span><span>*</span><span> </span><span>as</span><span> fs </span><span>from</span><span> </span><span>&#34;</span><span>fs</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>if</span><span> (</span><span>typeof</span><span> require </span><span>!==</span><span> </span><span>&#34;</span><span>undefined</span><span>&#34;</span><span> </span><span>&amp;&amp;</span><span> require.main </span><span>===</span><span> </span><span>module</span><span>) {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>&#34;</span><span>main!</span><span>&#34;</span><span>, fs);</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="ignore-dce-annotations"><code>--ignore-dce-annotations</code></h4><p>Some JavaScript tools support special annotations that can influence behavior during dead-code elimination. For example, the <code>@__PURE__</code> annotation tells bundlers that a function call is pure (regardless of whether it actually is), and that the call can be removed if it is not used.</p><div><div><div><pre><code><span><span>let</span><span> button </span><span>=</span><span> </span><span>/* @__PURE__ */</span><span> React.</span><span>createElement</span><span>(Button, </span><span>null</span><span>);</span></span>
<span></span></code></pre></div></div></div><p>Sometimes, a library may include incorrect annotations, which can cause Bun to remove side effects which were needed.</p><p>To workaround these issue, you can use the <code>--ignore-dce-annotations</code> flag when running <code>bun build</code> to ignore all annotations. This should only be used if dead-code elimination breaks bundles, and fixing the annotations should be preferred to leaving this flag on.</p><h4 level="4" id="packages-external"><code>--packages=external</code></h4><p>You can now control if package dependencies are included in your bundle or not. If the import does not start with <code>.</code>, <code>..</code> or <code>/</code>, then it is considered a package.</p><div id="EMJFzGWNqn"><div><div><p>CLI</p><div><div><pre><code><span><span>bun build ./index.ts --packages external</span></span></code></pre></div></div></div></div><div><div><p>JavaScript</p><div><div><pre><code><span><span>await</span><span> Bun.</span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./index.ts</span><span>&#34;</span><span>],</span></span>
<span><span>  packages</span><span>:</span><span> </span><span>&#34;</span><span>external</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div></div></div><p>This is useful when bundling libraries. It lets you reduce the number of files your users have to download, while continuing to support peer or external dependencies.</p><h2 level="2" anchor-id="built-in-css-parser" id="built-in-css-parser"><a name="built-in-css-parser"></a><a href="#built-in-css-parser">Built-in CSS parser</a></h2><p>In Bun 1.2, we implemented a new CSS parser and bundler in Bun.</p><p>It&#39;s derived from the great work of <a href="https://github.com/parcel-bundler/lightningcss">LightningCSS</a>, and re-written from Rust to Zig so it can be integrated with Bun&#39;s custom JavaScript and TypeScript parser, bundler, and runtime.</p><p>Bun is an complete toolkit for running and building JavaScript and TypeScript. One of the missing pieces of Bun&#39;s built-in JavaScript bundler, <code>bun build</code>, is support for bundling and minifying CSS.</p><h3 level="3" anchor-id="how-it-works" id="how-it-works"><a name="how-it-works"></a><a href="#how-it-works">How it works</a></h3><p>CSS bundlers combine multiple CSS files and assets referenced using directives like <code>url</code>, <code>@import</code>, <code>@font-face</code>, into a single CSS file you can send to browsers, avoiding a waterfall of network requests.</p><div id="TtOJlMjHqz"><div><div><p>index.css</p><div><div><pre><code><span><span>@import</span><span> </span><span>&#34;</span><span>foo.css</span><span>&#34;</span><span>;</span></span>
<span><span>@import</span><span> </span><span>&#34;</span><span>bar.css</span><span>&#34;</span><span>;</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>foo.css</p><div><div><pre><code><span><span>.foo</span><span> {</span></span>
<span><span>  </span><span>background</span><span>:</span><span> </span><span>red</span><span>;</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>bar.css</p><div><div><pre><code><span><span>.bar</span><span> {</span></span>
<span><span>  </span><span>background</span><span>:</span><span> </span><span>blue</span><span>;</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div></div></div><p>To see how it works, you can try it using <code>bun build</code>.</p><p>You&#39;ll see how the CSS files are combined into a single CSS file.</p><div><p>dist.css</p><div><div><pre><code><span><span>/** foo.css */</span></span>
<span><span>.foo</span><span> {</span></span>
<span><span>  </span><span>background</span><span>:</span><span> </span><span>red</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>/** bar.css */</span></span>
<span><span>.bar</span><span> {</span></span>
<span><span>  </span><span>background</span><span>:</span><span> </span><span>blue</span><span>;</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="import-css-files-from-javascript" id="import-css-files-from-javascript"><a name="import-css-files-from-javascript"></a><a href="#import-css-files-from-javascript">Import <code>.css</code> files from JavaScript</a></h3><p>We&#39;ve also made it possible to import <code>.css</code> files in your JavaScript and TypeScript code. This will create an additional CSS entrypoint that combines all the CSS files imported from a JavaScript module graph, along with <code>@import</code> rules.</p><div><p>index.ts</p><div><div><pre><code><span><span>import</span><span> </span><span>&#34;</span><span>./style.css</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> MyComponent </span><span>from</span><span> </span><span>&#34;</span><span>./MyComponent.tsx</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>// ... rest of your app</span></span>
<span></span></code></pre></div></div></div><p>In this example, if <code>MyComponent.tsx</code> imports another CSS file, instead of adding extra <code>.css</code> files to the bundle, all the CSS imported per entrypoint is flattened into a single CSS file.</p><div><p>shell</p><div><div><pre><code><span><span>bun build ./index.ts --outdir=dist</span></span></code></pre></div></div><div><div><pre><code><span><span>  index.js     0.10 KB</span></span>
<span><span>  index.css    0.10 KB</span></span>
<span><span>[5ms] bundle 4 modules</span></span></code></pre></div></div></div><h3 level="3" anchor-id="using-bun-build" id="using-bun-build"><a name="using-bun-build"></a><a href="#using-bun-build">Using <code>Bun.build()</code></a></h3><p>You can also bundle CSS using the programmatic <code>Bun.build()</code> API. This allows you to bundle both CSS and JavaScript in the same build, with the same API.</p><div><p>api.ts</p><div><div><pre><code><span><span>import</span><span> { build } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> results </span><span>=</span><span> </span><span>await</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./index.css</span><span>&#34;</span><span>],</span></span>
<span><span>  outdir</span><span>:</span><span> </span><span>&#34;</span><span>./dist</span><span>&#34;</span><span>,</span></span>
<span><span>});</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(results);</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="bun-apis" id="bun-apis"><a name="bun-apis"></a><a href="#bun-apis">Bun APIs</a></h2><p>In addition to supporting Node.js and Web APIs, Bun also has a growing standard library that makes it easy to do common tasks, without adding more external dependencies.</p><h3 level="3" anchor-id="static-routes-in-bun-serve" id="static-routes-in-bun-serve"><a name="static-routes-in-bun-serve"></a><a href="#static-routes-in-bun-serve">Static routes in <code>Bun.serve()</code></a></h3><p>Bun has a built-in HTTP server that makes it easy to respond to HTTP requests using standard APIs like <code>Request</code> and <code>Response</code>. In Bun 1.2, we added support for static routes using the new <code>static</code> property.</p><p>To define a static route, pass the request path as the key and a <code>Response</code> object as the value.</p><div><div><div><pre><code><span><span>import</span><span> { serve } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>serve</span><span>({</span></span>
<span><span>  static</span><span>:</span><span> {</span></span>
<span><span>    </span><span>&#34;</span><span>/health-check</span><span>&#34;</span><span>:</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>&#34;</span><span>Ok!</span><span>&#34;</span><span>),</span></span>
<span><span>    </span><span>&#34;</span><span>/old-link</span><span>&#34;</span><span>:</span><span> Response.</span><span>redirect</span><span>(</span><span>&#34;</span><span>/new-link</span><span>&#34;</span><span>, </span><span>301</span><span>),</span></span>
<span><span>    </span><span>&#34;</span><span>/api/version</span><span>&#34;</span><span>:</span><span> Response.</span><span>json</span><span>(</span></span>
<span><span>      {</span></span>
<span><span>        app</span><span>:</span><span> </span><span>require</span><span>(</span><span>&#34;</span><span>./package.json</span><span>&#34;</span><span>).version,</span></span>
<span><span>        bun</span><span>:</span><span> Bun.version,</span></span>
<span><span>      },</span></span>
<span><span>      {</span></span>
<span><span>        headers</span><span>:</span><span> { </span><span>&#34;</span><span>X-Powered-By</span><span>&#34;</span><span>:</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span> },</span></span>
<span><span>      },</span></span>
<span><span>    ),</span></span>
<span><span>  },</span></span>
<span><span>  </span><span>async</span><span> </span><span>fetch</span><span>(</span><span>request</span><span>) {</span></span>
<span><span>    </span><span>return</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>&#34;</span><span>Dynamic!</span><span>&#34;</span><span>);</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>Static routes are up to <a href="https://x.com/jarredsumner/status/1828042864531833035">40% faster</a> than doing it yourself in the <code>fetch()</code> handler. The response body, headers, and status code are cached in memory, so there&#39;s no JavaScript allocation or garbage collection.</p><p>If you want to reload the static routes, you can use the <code>reload()</code> method. This is useful if you want to update the static routes on a schedule, or when a file changes.</p><div><div><div><pre><code><span><span>import</span><span> { serve } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> server </span><span>=</span><span> </span><span>serve</span><span>({</span></span>
<span><span>  static</span><span>:</span><span> {</span></span>
<span><span>    </span><span>&#34;</span><span>/</span><span>&#34;</span><span>:</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>&#34;</span><span>Static!</span><span>&#34;</span><span>),</span></span>
<span><span>  },</span></span>
<span><span>  </span><span>async</span><span> </span><span>fetch</span><span>(</span><span>request</span><span>) {</span></span>
<span><span>    </span><span>return</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>&#34;</span><span>Dynamic!</span><span>&#34;</span><span>);</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span>
<span><span>setInterval</span><span>(() </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>const</span><span> date </span><span>=</span><span> </span><span>new</span><span> </span><span>Date</span><span>().</span><span>toISOString</span><span>();</span></span>
<span><span>  server.</span><span>reload</span><span>({</span></span>
<span><span>    static</span><span>:</span><span> {</span></span>
<span><span>      </span><span>&#34;</span><span>/</span><span>&#34;</span><span>:</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>`Static! Updated at </span><span>${</span><span>date</span><span>}</span><span>`</span><span>),</span></span>
<span><span>    },</span></span>
<span><span>  });</span></span>
<span><span>}, </span><span>1000</span><span>);</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="bun-udpsocket" id="bun-udpsocket"><a name="bun-udpsocket"></a><a href="#bun-udpsocket"><code>Bun.udpSocket()</code></a></h3><p>While we added support for <code>node:dgram</code> in Bun 1.2, we also introduced UDP socket support in Bun&#39;s APIs. <a href="https://bun.sh/docs/api/udp"><code>Bun.udpSocket()</code></a> is a faster, modern alternative and is similar to the existing <a href="https://bun.sh/docs/api/tcp"><code>Bun.listen()</code></a> API.</p><div><div><div><pre><code><span><span>import</span><span> { udpSocket } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> server </span><span>=</span><span> </span><span>await</span><span> </span><span>udpSocket</span><span>({</span></span>
<span><span>  socket</span><span>:</span><span> {</span></span>
<span><span>    </span><span>data</span><span>(</span><span>socket</span><span>, </span><span>data</span><span>, </span><span>port</span><span>, </span><span>addr</span><span>) {</span></span>
<span><span>      console.</span><span>log</span><span>(</span><span>`Received data from </span><span>${</span><span>addr</span><span>}</span><span>:</span><span>${</span><span>port</span><span>}</span><span>:`</span><span>, data.</span><span>toString</span><span>());</span></span>
<span><span>    },</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span>
<span><span>const</span><span> client </span><span>=</span><span> </span><span>await</span><span> </span><span>udpSocket</span><span>({ port</span><span>:</span><span> </span><span>0</span><span> });</span></span>
<span><span>client.</span><span>send</span><span>(</span><span>&#34;</span><span>Hello!</span><span>&#34;</span><span>, server.port, </span><span>&#34;</span><span>127.0.0.1</span><span>&#34;</span><span>);</span></span>
<span></span></code></pre></div></div></div><p>Bun&#39;s UDP socket API is built for performance. Unlike Node.js, it can send multiple UDP datagrams with a single syscall, and supports responding to backpressure from the operating system.</p><div><div><div><pre><code><span><span>const</span><span> socket </span><span>=</span><span> </span><span>await</span><span> Bun.</span><span>udpSocket</span><span>({</span></span>
<span><span>  port</span><span>:</span><span> </span><span>0</span><span>,</span></span>
<span><span>  socket</span><span>:</span><span> {</span></span>
<span><span>    </span><span>drain</span><span>(</span><span>socket</span><span>) {</span></span>
<span><span>      </span><span>// Socket is no longer under backpressure</span></span>
<span><span>    },</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span>
<span><span>// Send multiple UDP datagrams with a single syscall:</span></span>
<span><span>// [ &lt;data&gt;, &lt;port&gt;, &lt;address&gt; ][]</span></span>
<span><span>socket.</span><span>sendMany</span><span>([</span></span>
<span><span>  [</span><span>&#34;</span><span>Hello</span><span>&#34;</span><span>, </span><span>12345</span><span>, </span><span>&#34;</span><span>127.0.0.1</span><span>&#34;</span><span>],</span></span>
<span><span>  [</span><span>&#34;</span><span>from</span><span>&#34;</span><span>, </span><span>12346</span><span>, </span><span>&#34;</span><span>127.0.0.1</span><span>&#34;</span><span>],</span></span>
<span><span>  [</span><span>&#34;</span><span>Bun 1.2</span><span>&#34;</span><span>, </span><span>12347</span><span>, </span><span>&#34;</span><span>127.0.0.1</span><span>&#34;</span><span>],</span></span>
<span><span>]);</span></span>
<span></span></code></pre></div></div></div><p>This is great for building game servers that need to broadcast game state updates to every peer.</p><h3 level="3" anchor-id="bun-file" id="bun-file"><a name="bun-file"></a><a href="#bun-file"><code>Bun.file()</code></a></h3><p>Bun has a built-in <a href="https://bun.sh/docs/api/file-io#reading-files-bun-file"><code>Bun.file()</code></a> API that makes it easy to read and write files. It extends the Web-standard <code>Blob</code> API, and makes it easier to work with files in a server environment.</p><p>In Bun 1.2, we&#39;ve added support for even more <code>Bun.file()</code> APIs.</p><h4 level="4" id="delete"><code>delete()</code></h4><p>You can now delete files using the <code>delete()</code> method. An alias of <code>unlink()</code> is also supported.</p><div><div><div><pre><code><span><span>import</span><span> { file } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>await</span><span> </span><span>file</span><span>(</span><span>&#34;</span><span>./package.json</span><span>&#34;</span><span>).</span><span>delete</span><span>();</span></span>
<span><span>await</span><span> </span><span>file</span><span>(</span><span>&#34;</span><span>./node_modules</span><span>&#34;</span><span>).</span><span>unlink</span><span>();</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="stat"><code>stat()</code></h4><p>You can now use the <code>stat()</code> method to get a file&#39;s metadata. This returns the same <a href="https://nodejs.org/api/fs.html#class-fsstats"><code>Stats</code></a> object as <code>fs.stat()</code> in Node.js.</p><div><div><div><pre><code><span><span>import</span><span> { file } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> stat </span><span>=</span><span> </span><span>await</span><span> </span><span>file</span><span>(</span><span>&#34;</span><span>./package.json</span><span>&#34;</span><span>).</span><span>stat</span><span>();</span></span>
<span><span>console.</span><span>log</span><span>(stat.size); </span><span>// =&gt; 1024</span></span>
<span><span>console.</span><span>log</span><span>(stat.mode); </span><span>// =&gt; 33206</span></span>
<span><span>console.</span><span>log</span><span>(stat.</span><span>isFile</span><span>()); </span><span>// =&gt; true</span></span>
<span><span>console.</span><span>log</span><span>(stat.</span><span>isDirectory</span><span>()); </span><span>// =&gt; false</span></span>
<span><span>console.</span><span>log</span><span>(stat.ctime); </span><span>// =&gt; 2025-01-21T16:00:00+00:00</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="support-for-s3-files">Support for S3 files</h4><p>With newly added built-in support for S3, you can use the same <code>Bun.file()</code> APIs with a S3 file.</p><div><div><div><pre><code><span><span>import</span><span> { s3 } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> stat </span><span>=</span><span> </span><span>await</span><span> </span><span>s3</span><span>(</span><span>&#34;</span><span>s3://folder/my-file.txt</span><span>&#34;</span><span>).</span><span>stat</span><span>();</span></span>
<span><span>console.</span><span>log</span><span>(stat.size); </span><span>// =&gt; 1024</span></span>
<span><span>console.</span><span>log</span><span>(stat.type); </span><span>// =&gt; &#34;text/plain;charset=utf-8&#34;</span></span>
<span></span>
<span><span>await</span><span> </span><span>s3</span><span>(</span><span>&#34;</span><span>s3://folder/</span><span>&#34;</span><span>).</span><span>unlink</span><span>();</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="bun-color" id="bun-color"><a name="bun-color"></a><a href="#bun-color"><code>Bun.color()</code></a></h3><p>To support CSS with <code>bun build</code>, we implemented our own CSS parser in Bun 1.2. In doing this work, we decided to expose some useful APIs for working with colors.</p><p>You can use <a href="https://bun.sh/docs/api/color"><code>Bun.color()</code></a> to parse, normalize, and convert colors into a variety of formats. It supports CSS, ANSI color codes, RGB, HSL, and more.</p><div><div><div><pre><code><span><span>import</span><span> { color } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>color</span><span>(</span><span>&#34;</span><span>#ff0000</span><span>&#34;</span><span>, </span><span>&#34;</span><span>css</span><span>&#34;</span><span>); </span><span>// =&gt; &#34;red&#34;</span></span>
<span><span>color</span><span>(</span><span>&#34;</span><span>rgb(255, 0, 0)</span><span>&#34;</span><span>, </span><span>&#34;</span><span>css</span><span>&#34;</span><span>); </span><span>// =&gt; &#34;red&#34;</span></span>
<span><span>color</span><span>(</span><span>&#34;</span><span>red</span><span>&#34;</span><span>, </span><span>&#34;</span><span>ansi</span><span>&#34;</span><span>); </span><span>// =&gt; &#34;\x1b[31m&#34;</span></span>
<span><span>color</span><span>(</span><span>&#34;</span><span>#f00</span><span>&#34;</span><span>, </span><span>&#34;</span><span>ansi-16m</span><span>&#34;</span><span>); </span><span>// =&gt; &#34;\x1b[38;2;255;0;0m&#34;</span></span>
<span><span>color</span><span>(</span><span>0xff0000</span><span>, </span><span>&#34;</span><span>ansi-256</span><span>&#34;</span><span>); </span><span>// =&gt; &#34;\u001b[38;5;196m&#34;</span></span>
<span><span>color</span><span>({ r</span><span>:</span><span> </span><span>255</span><span>, g</span><span>:</span><span> </span><span>0</span><span>, b</span><span>:</span><span> </span><span>0</span><span> }, </span><span>&#34;</span><span>number</span><span>&#34;</span><span>); </span><span>// =&gt; 16711680</span></span>
<span><span>color</span><span>(</span><span>&#34;</span><span>hsl(0, 0%, 50%)</span><span>&#34;</span><span>, </span><span>&#34;</span><span>{rgba}</span><span>&#34;</span><span>); </span><span>// =&gt; { r: 128, g: 128, b: 128, a: 1 }</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="dns-prefetch" id="dns-prefetch"><a name="dns-prefetch"></a><a href="#dns-prefetch"><code>dns.prefetch()</code></a></h3><p>You can use the new <a href="https://bun.sh/docs/api/dns#dns-prefetch"><code>dns.prefetch()</code></a> API to prefetch DNS records before they are needed. This is useful if you want to pre-warm the DNS cache on startup.</p><div><div><div><pre><code><span><span>import</span><span> { dns } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>// ...on startup</span></span>
<span><span>dns.</span><span>prefetch</span><span>(</span><span>&#34;</span><span>example.com</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>// ...later on</span></span>
<span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com/</span><span>&#34;</span><span>);</span></span>
<span></span></code></pre></div></div></div><p>This will prefetch the DNS record for example.com and make it available for use in <code>fetch()</code> requests. You can also use the <a href="https://bun.sh/docs/api/dns#dns-getcachestats"><code>dns.getCacheStats()</code></a> API to observe the DNS cache.</p><div><div><div><pre><code><span><span>import</span><span> { dns } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com/</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(dns.</span><span>getCacheStats</span><span>());</span></span>
<span><span>// {</span></span>
<span><span>//   cacheHitsCompleted: 0,</span></span>
<span><span>//   cacheHitsInflight: 0,</span></span>
<span><span>//   cacheMisses: 1,</span></span>
<span><span>//   size: 1,</span></span>
<span><span>//   errors: 0,</span></span>
<span><span>//   totalCount: 1,</span></span>
<span><span>// }</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="helpful-utilities" id="helpful-utilities"><a name="helpful-utilities"></a><a href="#helpful-utilities">Helpful utilities</a></h3><p>We also added a few random utilities to Bun&#39;s APIs.</p><h4 level="4" id="bun-inspect-table"><code>Bun.inspect.table()</code></h4><p>You can now use <code>Bun.inspect.table()</code> to format tabular data into a string. It&#39;s similar to <a href="https://developer.mozilla.org/en-US/docs/Web/API/console/table_static"><code>console.table</code></a>, except it returns a string rather than printing to the console.</p><div><div><div><pre><code><span><span>console.</span><span>log</span><span>(</span></span>
<span><span>  Bun.inspect.</span><span>table</span><span>([</span></span>
<span><span>    { a</span><span>:</span><span> </span><span>1</span><span>, b</span><span>:</span><span> </span><span>2</span><span>, c</span><span>:</span><span> </span><span>3</span><span> },</span></span>
<span><span>    { a</span><span>:</span><span> </span><span>4</span><span>, b</span><span>:</span><span> </span><span>5</span><span>, c</span><span>:</span><span> </span><span>6</span><span> },</span></span>
<span><span>    { a</span><span>:</span><span> </span><span>7</span><span>, b</span><span>:</span><span> </span><span>8</span><span>, c</span><span>:</span><span> </span><span>9</span><span> },</span></span>
<span><span>  ]),</span></span>
<span><span>);</span></span>
<span></span>
<span><span>// ┌───┬───┬───┬───┐</span></span>
<span><span>// │   │ a │ b │ c │</span></span>
<span><span>// ├───┼───┼───┼───┤</span></span>
<span><span>// │ 0 │ 1 │ 2 │ 3 │</span></span>
<span><span>// │ 1 │ 4 │ 5 │ 6 │</span></span>
<span><span>// │ 2 │ 7 │ 8 │ 9 │</span></span>
<span><span>// └───┴───┴───┴───┘</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="bun-randomuuidv7"><code>Bun.randomUUIDv7()</code></h4><p>You can use <code>Bun.randomUUIDv7()</code> to generate a <a href="https://www.ietf.org/archive/id/draft-peabody-dispatch-new-uuid-format-01.html#name-uuidv7-layout-and-bit-order">UUID v7</a>, a monotonic UUID suitable for sorting and databases.</p><div><p>index.ts</p><div><div><pre><code><span><span>import</span><span> { randomUUIDv7 } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> uuid </span><span>=</span><span> </span><span>randomUUIDv7</span><span>();</span></span>
<span><span>// =&gt; &#34;0192ce11-26d5-7dc3-9305-1426de888c5a&#34;</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="new-in-bun-s-built-in-sqlite-client" id="new-in-bun-s-built-in-sqlite-client"><a name="new-in-bun-s-built-in-sqlite-client"></a><a href="#new-in-bun-s-built-in-sqlite-client">New in Bun&#39;s built-in SQLite client</a></h2><p>Bun has a built-in <a href="https://bun.sh/docs/api/sqlite">SQLite client</a> that makes it easy to query SQLite databases. In Bun 1.2, we&#39;ve added a few new features to make it even easier to use.</p><h3 level="3" anchor-id="orm-less-object-mapping" id="orm-less-object-mapping"><a name="orm-less-object-mapping"></a><a href="#orm-less-object-mapping">ORM-less object mapping</a></h3><p>When you query a SQL database, you often want to map your query results to a JavaScript object. That&#39;s why there&#39;s so many popular <a href="https://www.prisma.io/dataguide/types/relational/what-is-an-orm#do-i-need-an-orm">ORM</a> (Object-Relational Mapping) packages like Prisma and TypeORM.</p><p>You can now use <a href="https://bun.sh/docs/api/sqlite#as-class-map-query-results-to-a-class"><code>query.as(Class)</code></a> to map query results to instances of a class. This lets you attach methods, getters, and setters without using an ORM.</p><div><div><div><pre><code><span><span>import</span><span> { Database } </span><span>from</span><span> </span><span>&#34;</span><span>bun:sqlite</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>class</span><span> </span><span>Tweet</span><span> {</span></span>
<span><span>  id</span><span>:</span><span> </span><span>number</span><span>;</span></span>
<span><span>  text</span><span>:</span><span> </span><span>string</span><span>;</span></span>
<span><span>  username</span><span>:</span><span> </span><span>string</span><span>;</span></span>
<span></span>
<span><span>  </span><span>get</span><span> </span><span>isMe</span><span>() {</span></span>
<span><span>    </span><span>return</span><span> </span><span>this</span><span>.username </span><span>===</span><span> </span><span>&#34;</span><span>jarredsumner</span><span>&#34;</span><span>;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> db </span><span>=</span><span> </span><span>new</span><span> </span><span>Database</span><span>(</span><span>&#34;</span><span>tweets.db</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> tweets </span><span>=</span><span> db.</span><span>query</span><span>(</span><span>&#34;</span><span>SELECT * FROM tweets</span><span>&#34;</span><span>).</span><span>as</span><span>(Tweet);</span></span>
<span></span>
<span><span>for</span><span> (</span><span>const</span><span> tweet </span><span>of</span><span> tweets.</span><span>all</span><span>()) {</span></span>
<span><span>  </span><span>if</span><span> (</span><span>!</span><span>tweet.isMe) {</span></span>
<span><span>    console.</span><span>log</span><span>(</span><span>`</span><span>${</span><span>tweet.username</span><span>}</span><span>: </span><span>${</span><span>tweet.text</span><span>}</span><span>`</span><span>);</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>For performance reasons, class constructors, default initializers, and private fields are not supported. Instead, it uses the equivalent of <code>Object.create()</code> to create a new object with the class&#39;s prototype and assigns the values of the row to it.</p><p>It&#39;s also important to note that this is <em>not</em> an ORM. It doesn&#39;t manage relationships, generate SQL queries, or anything like that. However, it does remove a lot of boilerplate to get JavaScript objects from SQLite!</p><h3 level="3" anchor-id="iterable-queries" id="iterable-queries"><a name="iterable-queries"></a><a href="#iterable-queries">Iterable queries</a></h3><p>You can now use <a href="https://bun.sh/docs/api/sqlite#iterate-iterator"><code>query.iterate()</code></a> to get an iterator that yields rows as they are returned from the database. This is useful when you want to process rows at a time, without loading them all into memory.</p><div><div><div><pre><code><span><span>import</span><span> { Database } </span><span>from</span><span> </span><span>&#34;</span><span>bun:sqlite</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>class</span><span> </span><span>User</span><span> {</span></span>
<span><span>  id</span><span>:</span><span> </span><span>number</span><span>;</span></span>
<span><span>  email</span><span>:</span><span> </span><span>string</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> db </span><span>=</span><span> </span><span>new</span><span> </span><span>Database</span><span>(</span><span>&#34;</span><span>users.db</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> rows </span><span>=</span><span> db.</span><span>query</span><span>(</span><span>&#34;</span><span>SELECT * FROM users</span><span>&#34;</span><span>).</span><span>as</span><span>(User).</span><span>iterate</span><span>();</span></span>
<span></span>
<span><span>for</span><span> (</span><span>const</span><span> row </span><span>of</span><span> rows) {</span></span>
<span><span>  console.</span><span>log</span><span>(row);</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>You can also iterate over the query using a <code>for</code> loop, without calling <code>iterate()</code>.</p><div><div><div><pre><code><span><span>for</span><span> (</span><span>const</span><span> row </span><span>of</span><span> db.</span><span>query</span><span>(</span><span>&#34;</span><span>SELECT * FROM users</span><span>&#34;</span><span>)) {</span></span>
<span><span>  console.</span><span>log</span><span>(row); </span><span>// { id: 1, email: &#34;hello@bun.sh&#34; }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="strict-query-parameters" id="strict-query-parameters"><a name="strict-query-parameters"></a><a href="#strict-query-parameters">Strict query parameters</a></h3><p>You can now omit the <code>$</code>, <code>@</code>, or <code>:</code> prefix when passing JavaScript values as query parameters.</p><div><div><div><pre><code><span><span>import</span><span> { Database } </span><span>from</span><span> </span><span>&#34;</span><span>bun:sqlite</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> db </span><span>=</span><span> </span><span>new</span><span> </span><span>Database</span><span>(</span><span>&#34;</span><span>:memory:</span><span>&#34;</span><span>, {</span></span>
<span><span>  strict</span><span>:</span><span> </span><span>false</span><span>,</span></span>
<span><span>  strict</span><span>:</span><span> </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span></span>
<span><span>const</span><span> query </span><span>=</span><span> db.</span><span>query</span><span>(</span><span>`select $message;`</span><span>);</span></span>
<span></span>
<span><span>query.</span><span>all</span><span>({</span></span>
<span><span>  $message</span><span>:</span><span> </span><span>&#34;</span><span>Hello world</span><span>&#34;</span></span>
<span><span>  message: </span><span>&#34;</span><span>Hello world</span><span>&#34;</span></span>
<span><span>});</span></span></code></pre></div></div></div><p>To use this behavior, enable the <a href="https://bun.sh/docs/api/sqlite#strict-mode"><code>strict</code></a> option. This will allow you to omit the <code>$</code>, <code>@</code>, or <code>:</code> prefixes, and will throw an error if a parameter is missing.</p><h3 level="3" anchor-id="tracking-changed-rows" id="tracking-changed-rows"><a name="tracking-changed-rows"></a><a href="#tracking-changed-rows">Tracking changed rows</a></h3><p>You can now access the number of rows changed and the last inserted row ID when running queries.</p><div><div><div><pre><code><span><span>import</span><span> { Database } </span><span>from</span><span> </span><span>&#34;</span><span>bun:sqlite</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> db </span><span>=</span><span> </span><span>new</span><span> </span><span>Database</span><span>(</span><span>&#34;</span><span>:memory:</span><span>&#34;</span><span>);</span></span>
<span><span>db.</span><span>run</span><span>(</span><span>`CREATE TABLE users (id INTEGER, username TEXT)`</span><span>);</span></span>
<span></span>
<span><span>const</span><span> { changes, lastInsertRowid } </span><span>=</span><span> db.</span><span>run</span><span>(</span></span>
<span><span>  </span><span>`INSERT INTO users VALUES (1, &#39;jarredsumner&#39;)`</span><span>,</span></span>
<span><span>);</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>({</span></span>
<span><span>  changes, </span><span>// =&gt; 1</span></span>
<span><span>  lastInsertRowid, </span><span>// =&gt; 1</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="bigint-support" id="bigint-support"><a name="bigint-support"></a><a href="#bigint-support">BigInt support</a></h3><p>If you want to use 64-bit integers, you can enable the <a href="https://bun.sh/docs/api/sqlite#safeintegers-true"><code>safeIntegers</code></a> option. This will return integers as as a <code>BigInt</code>, instead of a truncated <code>number</code>.</p><div><div><div><pre><code><span><span>import</span><span> { Database } </span><span>from</span><span> </span><span>&#34;</span><span>bun:sqlite</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> db </span><span>=</span><span> </span><span>new</span><span> </span><span>Database</span><span>(</span><span>&#34;</span><span>:memory:</span><span>&#34;</span><span>, { safeIntegers</span><span>:</span><span> </span><span>true</span><span> });</span></span>
<span><span>const</span><span> query </span><span>=</span><span> db.</span><span>query</span><span>(</span></span>
<span><span>  </span><span>`SELECT </span><span>${</span><span>BigInt</span><span>(</span><span>Number</span><span>.</span><span>MAX_SAFE_INTEGER</span><span>)</span><span> </span><span>+</span><span> </span><span>1</span><span>n</span><span>}</span><span> as maxInteger`</span><span>,</span></span>
<span><span>);</span></span>
<span></span>
<span><span>const</span><span> { maxInteger } </span><span>=</span><span> query.</span><span>get</span><span>();</span></span>
<span><span>console.</span><span>log</span><span>(maxInteger); </span><span>// =&gt; 9007199254740992n</span></span>
<span></span></code></pre></div></div></div><p>You can also enable this on a per-query basis using the <a href="https://bun.sh/docs/api/sqlite#safeintegers-true"><code>safeIntegers()</code></a> method.</p><div><div><div><pre><code><span><span>import</span><span> { Database } </span><span>from</span><span> </span><span>&#34;</span><span>bun:sqlite</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> db </span><span>=</span><span> </span><span>new</span><span> </span><span>Database</span><span>(</span><span>&#34;</span><span>:memory:</span><span>&#34;</span><span>, { strict</span><span>:</span><span> </span><span>true</span><span> });</span></span>
<span><span>const</span><span> query </span><span>=</span><span> db.</span><span>query</span><span>(</span><span>&#34;</span><span>SELECT $value as value</span><span>&#34;</span><span>).</span><span>safeIntegers</span><span>(</span><span>true</span><span>);</span></span>
<span></span>
<span><span>const</span><span> { value } </span><span>=</span><span> query.</span><span>get</span><span>({</span></span>
<span><span>  value</span><span>:</span><span> </span><span>BigInt</span><span>(</span><span>Number</span><span>.MAX_SAFE_INTEGER) </span><span>+</span><span> </span><span>1</span><span>n</span><span>,</span></span>
<span><span>});</span></span>
<span><span>console.</span><span>log</span><span>(value); </span><span>// =&gt; 9007199254740992n</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="reliable-cleanup-with-using" id="reliable-cleanup-with-using"><a name="reliable-cleanup-with-using"></a><a href="#reliable-cleanup-with-using">Reliable cleanup with <code>using</code></a></h3><p>With JavaScript&#39;s <a href="https://github.com/tc39/proposal-explicit-resource-management?tab=readme-ov-file#ecmascript-explicit-resource-management"><code>using</code></a> syntax, you can automatically close statements and databases when their variables go out of scope. This allows you to clean up database resources, even if there&#39;s a thrown error. <a href="#resource-management-with-using">Read on</a> for more details on Bun&#39;s support for this new JavaScript feature.</p><div><div><div><pre><code><span><span>import</span><span> { Database } </span><span>from</span><span> </span><span>&#34;</span><span>bun:sqlite</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>{</span></span>
<span><span>  using db </span><span>=</span><span> </span><span>new</span><span> </span><span>Database</span><span>(</span><span>&#34;</span><span>file.db</span><span>&#34;</span><span>);</span></span>
<span><span>  using query </span><span>=</span><span> db.</span><span>query</span><span>(</span><span>&#34;</span><span>SELECT * FROM users</span><span>&#34;</span><span>);</span></span>
<span><span>  </span><span>for</span><span> (</span><span>const</span><span> row </span><span>of</span><span> query.</span><span>all</span><span>()) {</span></span>
<span><span>    </span><span>throw</span><span> </span><span>new</span><span> </span><span>Error</span><span>(</span><span>&#34;</span><span>Oops!</span><span>&#34;</span><span>); </span><span>// no try/catch block needed!</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>// scope ends here, so `db` and `query` are automatically closed</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="compile-and-run-c-from-javascript" id="compile-and-run-c-from-javascript"><a name="compile-and-run-c-from-javascript"></a><a href="#compile-and-run-c-from-javascript">Compile and run C from JavaScript</a></h2><p>We&#39;ve added experimental support for compiling and running C from JavaScript. This is a simple way to use C system libraries from JavaScript <em>without a build step</em>.</p><div id="llLuIhiAxG"><div><div><p>random.c</p><div><div><pre><code><span><span>#include</span><span> </span><span>&lt;</span><span>stdio.h</span><span>&gt;</span></span>
<span><span>#include</span><span> </span><span>&lt;</span><span>stdlib.h</span><span>&gt;</span></span>
<span></span>
<span><span>int</span><span> </span><span>random</span><span>() {</span></span>
<span><span>  </span><span>return</span><span> </span><span>rand</span><span>() </span><span>+</span><span> </span><span>42</span><span>;</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>random.ts</p><div><div><pre><code><span><span>import</span><span> { cc } </span><span>from</span><span> </span><span>&#34;</span><span>bun:ffi</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> { </span><span>symbols</span><span>:</span><span> { random } } </span><span>=</span><span> </span><span>cc</span><span>({</span></span>
<span><span>  source</span><span>:</span><span> </span><span>&#34;</span><span>./random.c</span><span>&#34;</span><span>,</span></span>
<span><span>  symbols</span><span>:</span><span> {</span></span>
<span><span>    random</span><span>:</span><span> {</span></span>
<span><span>      returns</span><span>:</span><span> </span><span>&#34;</span><span>int</span><span>&#34;</span><span>,</span></span>
<span><span>      args</span><span>:</span><span> [],</span></span>
<span><span>    },</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(</span><span>random</span><span>()); </span><span>// 42</span></span>
<span></span></code></pre></div></div></div></div></div><h3 level="3" anchor-id="why-is-this-useful" id="why-is-this-useful"><a name="why-is-this-useful"></a><a href="#why-is-this-useful">Why is this useful?</a></h3><p>For advanced use-cases or where performance is really important, you sometimes need to use system libraries from JavaScript. Today, the most common way to do this is by compiling a <a href="https://nodejs.org/api/n-api.html">N-API addon</a> using <a href="https://github.com/nodejs/node-gyp"><code>node-gyp</code></a>. You might notice if a package uses this, because it runs a postinstall script when you install it.</p><p>However, this isn&#39;t a great experience. Your system needs a modern version of Python and a C compiler, which is usually installed using a command like <code>apt install build-essential</code>.</p><p>And hopefully you don&#39;t run into a compiler or node-gyp error, which can be quite frustrating.</p><div><div><div><pre><code><span><span>gyp ERR</span><span>!</span><span> </span><span>command</span><span> </span><span>&#34;</span><span>/usr/bin/node</span><span>&#34;</span><span> </span><span>&#34;</span><span>/tmp/node-gyp@latest--bunx/node_modules/.bin/node-gyp</span><span>&#34;</span><span> </span><span>&#34;</span><span>configure</span><span>&#34;</span><span> </span><span>&#34;</span><span>build</span><span>&#34;</span></span>
<span><span>gyp ERR</span><span>!</span><span> cwd /bun/test/node_modules/bktree-fast</span></span>
<span><span>gyp ERR</span><span>!</span><span> node -v v12.22.9</span></span>
<span><span>gyp ERR</span><span>!</span><span> node-gyp -v v9.4.0</span></span>
<span><span>gyp ERR</span><span>!</span><span> Node-gyp failed to build your package.</span></span>
<span><span>gyp ERR</span><span>!</span><span> Try to update npm and/or node-gyp and </span><span>if</span><span> it does not </span><span>help</span><span> file an issue with the package author.</span></span>
<span><span>error: </span><span>&#34;</span><span>node-gyp</span><span>&#34;</span><span> exited with code 7 (SIGBUS)</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="how-does-it-work" id="how-does-it-work"><a name="how-does-it-work"></a><a href="#how-does-it-work">How does it work?</a></h3><p>In case you didn&#39;t know, Bun embeds a built-in C compiler called <a href="https://github.com/TinyCC/tinycc"><code>tinycc</code></a>. Surprise!</p><p>Unlike traditional C compilers, like <code>gcc</code> or <code>clang</code>, that can take seconds to compile a simple program, <code>tinycc</code> compiles simple C code in milliseconds. This makes it possible for Bun to compile your C code on-demand, without a build step.</p><p>Using the <a href="https://bun.sh/docs/api/cc"><code>bun:ffi</code></a> APIs, you can compile and run C code from JavaScript. Here&#39;s an example project that uses the <a href="https://bun.sh/docs/api/node-api">N-API</a> to return a JavaScript string from C code.</p><div id="hiWPLqPndC"><div><div><p>hello-napi.c</p><div><div><pre><code><span><span>#include</span><span> </span><span>&lt;</span><span>node/node_api.h</span><span>&gt;</span></span>
<span></span>
<span><span>napi_value </span><span>hello_napi</span><span>(napi_env </span><span>env</span><span>) {</span></span>
<span><span>  napi_value result;</span></span>
<span><span>  </span><span>napi_create_string_utf8</span><span>(env, </span><span>&#34;</span><span>Hello, N-API!</span><span>&#34;</span><span>, NAPI_AUTO_LENGTH, </span><span>&amp;</span><span>result);</span></span>
<span><span>  </span><span>return</span><span> result;</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>hello-napi.js</p><div><div><pre><code><span><span>import</span><span> { cc } </span><span>from</span><span> </span><span>&#34;</span><span>bun:ffi</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> source </span><span>from</span><span> </span><span>&#34;</span><span>./hello-napi.c</span><span>&#34;</span><span> with { type: &#34;file&#34; };</span></span>
<span></span>
<span><span>const</span><span> hello </span><span>=</span><span> </span><span>cc</span><span>({</span></span>
<span><span>  source,</span></span>
<span><span>  symbols</span><span>:</span><span> {</span></span>
<span><span>    hello_napi</span><span>:</span><span> {</span></span>
<span><span>      args</span><span>:</span><span> [</span><span>&#34;</span><span>napi_env</span><span>&#34;</span><span>],</span></span>
<span><span>      returns</span><span>:</span><span> </span><span>&#34;</span><span>napi_value</span><span>&#34;</span><span>,</span></span>
<span><span>    },</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(</span><span>hello</span><span>());</span></span>
<span><span>// =&gt; &#34;Hello, N-API!&#34;</span></span>
<span></span></code></pre></div></div></div></div></div><p>Instead of requiring a build step with <code>node-gyp</code>, as long as you have Bun, this just works.</p><h2 level="2" anchor-id="musl-support" id="musl-support"><a name="musl-support"></a><a href="#musl-support">musl support</a></h2><p>In Bun 1.2, we&#39;ve introduced a new build of Bun that works on Linux distros that use the <a href="https://www.musl-libc.org/">musl libc</a> instead of glibc, like <a href="https://www.alpinelinux.org/">Alpine Linux</a>. This is supported on both Linux x64 and aarch64.</p><p>You can also use the <a href="https://hub.docker.com/r/oven/bun">alpine version</a> of Bun in Docker.</p><div><div><div><pre><code><span><span>docker run --rm -it oven/bun:alpine bun --print </span><span>&#39;</span><span>Bun.file(&#34;/etc/alpine-release&#34;).text()</span><span>&#39;</span></span></code></pre></div></div></div><p>While musl enables smaller container images, it tends to perform slightly slower than the glibc version of Bun. We recommend using glibc unless you have a specific reason to use musl.</p><h2 level="2" anchor-id="javascript-features" id="javascript-features"><a name="javascript-features"></a><a href="#javascript-features">JavaScript features</a></h2><p>JavaScript is a language that is constantly evolving. In Bun 1.2, even more JavaScript features are available thanks to the collaboration of the <a href="https://tc39.es">TC39</a> committees, and the hard work of the <a href="https://webkit.org">WebKit</a> team.</p><h3 level="3" anchor-id="import-attributes" id="import-attributes"><a name="import-attributes"></a><a href="#import-attributes">Import attributes</a></h3><p>You can now specify an <a href="https://github.com/tc39/proposal-import-attributes">import attribute</a> when importing a file. This is useful when you want to import a file that isn&#39;t JavaScript code, like a JSON object or a text file.</p><div><div><div><pre><code><span><span>import</span><span> json </span><span>from</span><span> </span><span>&#34;</span><span>./package.json</span><span>&#34;</span><span> with { type: &#34;json&#34; };</span></span>
<span><span>typeof</span><span> json; </span><span>// &#34;object&#34;</span></span>
<span></span>
<span><span>import</span><span> html </span><span>from</span><span> </span><span>&#34;</span><span>./index.html</span><span>&#34;</span><span> with { type: &#34;text&#34; };</span></span>
<span><span>typeof</span><span> html; </span><span>// &#34;string&#34;</span></span>
<span></span>
<span><span>import</span><span> toml </span><span>from</span><span> </span><span>&#34;</span><span>./bunfig.toml</span><span>&#34;</span><span> with { type: &#34;toml&#34; };</span></span>
<span><span>typeof</span><span> toml; </span><span>// &#34;object&#34;</span></span>
<span></span></code></pre></div></div></div><p>You can also specify import attributes using <code>import()</code>.</p><div><div><div><pre><code><span><span>const</span><span> { </span><span>default</span><span>:</span><span> json } </span><span>=</span><span> </span><span>await</span><span> </span><span>import</span><span>(</span><span>&#34;</span><span>./package.json</span><span>&#34;</span><span>, {</span></span>
<span><span>  with</span><span>:</span><span> { type</span><span>:</span><span> </span><span>&#34;</span><span>json</span><span>&#34;</span><span> },</span></span>
<span><span>});</span></span>
<span><span>typeof</span><span> json; </span><span>// &#34;object&#34;</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="resource-management-with-using" id="resource-management-with-using"><a name="resource-management-with-using"></a><a href="#resource-management-with-using">Resource management with <code>using</code></a></h3><p>With the newly introduced <a href="https://github.com/tc39/proposal-explicit-resource-management?tab=readme-ov-file#ecmascript-explicit-resource-management"><code>using</code></a> syntax in JavaScript, you can automatically close resources when a variable goes out of scope.</p><p>Instead of defining a variable with <code>let</code> or <code>const</code>, you can now define a variable with <code>using</code>.</p><div><div><div><pre><code><span><span>import</span><span> { serve } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>{</span></span>
<span><span>  using server </span><span>=</span><span> </span><span>serve</span><span>({</span></span>
<span><span>    port</span><span>:</span><span> </span><span>0</span><span>,</span></span>
<span><span>    </span><span>fetch</span><span>(</span><span>request</span><span>) {</span></span>
<span><span>      </span><span>return</span><span> </span><span>new</span><span> </span><span>Response</span><span>(</span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>);</span></span>
<span><span>    },</span></span>
<span><span>  });</span></span>
<span></span>
<span><span>  </span><span>doStuff</span><span>(server);</span></span>
<span><span>}</span></span>
<span></span>
<span><span>function</span><span> </span><span>doStuff</span><span>(</span><span>server</span><span>) {</span></span>
<span><span>  </span><span>// ...</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>In this example, the server is automatically closed when the <code>server</code> variable goes out of scope, even if an exception is thrown. This is useful for ensuring that resources are properly cleaned up, especially in tests.</p><p>To support this, an object&#39;s prototype must define a <code>[Symbol.dispose]</code> method, or <code>[Symbol.asyncDispose]</code> method if it&#39;s an async resource.</p><div><div><div><pre><code><span><span>class</span><span> </span><span>Resource</span><span> {</span></span>
<span><span>  [</span><span>Symbol</span><span>.dispose]() { </span><span>/* ... */</span><span> }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>using resource </span><span>=</span><span> </span><span>new</span><span> </span><span>Resource</span><span>();</span></span>
<span></span>
<span><span>class</span><span> </span><span>AsyncResource</span><span> {</span></span>
<span><span>  </span><span>async</span><span> [</span><span>Symbol</span><span>.asyncDispose]() { </span><span>/* ... */</span><span> }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>await</span><span> using asyncResource </span><span>=</span><span> </span><span>new</span><span> </span><span>AsyncResource</span><span>();</span></span>
<span></span></code></pre></div></div></div><p>We&#39;ve also added support for <code>using</code> in dozens of Bun APIs, including <code>Bun.spawn()</code>, <code>Bun.serve()</code>, <code>Bun.connect()</code>, <code>Bun.listen()</code>, and <code>bun:sqlite</code>.</p><div><div><div><pre><code><span><span>import</span><span> { spawn } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span><span>import</span><span> { test, expect } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>able to spawn a process</span><span>&#34;</span><span>, </span><span>async</span><span> () </span><span>=&gt;</span><span> {</span></span>
<span><span>  using subprocess </span><span>=</span><span> </span><span>spawn</span><span>({</span></span>
<span><span>    cmd</span><span>:</span><span> [process.execPath, </span><span>&#34;</span><span>-e</span><span>&#34;</span><span>, </span><span>&#34;</span><span>console.log(&#39;Hello, world!&#39;)</span><span>&#34;</span><span>],</span></span>
<span><span>    stdout</span><span>:</span><span> </span><span>&#34;</span><span>pipe</span><span>&#34;</span><span>,</span></span>
<span><span>  });</span></span>
<span></span>
<span><span>  </span><span>// Even if this expectation fails, the subprocess will still be closed.</span></span>
<span><span>  </span><span>const</span><span> stdout </span><span>=</span><span> </span><span>new</span><span> </span><span>Response</span><span>(subprocess.stdout).</span><span>text</span><span>();</span></span>
<span><span>  </span><span>await</span><span> </span><span>expect</span><span>(stdout).resolves.</span><span>toBe</span><span>(</span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>);</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="promise-withresolvers" id="promise-withresolvers"><a name="promise-withresolvers"></a><a href="#promise-withresolvers"><code>Promise.withResolvers()</code></a></h3><p>You can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/withResolvers"><code>Promise.withResolvers()</code></a> to create a promise that resolves or rejects when you call the <code>resolve</code> or <code>reject</code> functions.</p><div><div><div><pre><code><span><span>const</span><span> { promise, resolve, reject } </span><span>=</span><span> </span><span>Promise</span><span>.</span><span>withResolvers</span><span>();</span></span>
<span><span>setTimeout</span><span>(() </span><span>=&gt;</span><span> </span><span>resolve</span><span>(), </span><span>1000</span><span>);</span></span>
<span><span>await</span><span> promise;</span></span>
<span></span></code></pre></div></div></div><p>This is a useful alternative to <code>new Promise()</code>, since you don&#39;t need to create a new scope.</p><div><div><div><pre><code><span><span>const</span><span> promise </span><span>=</span><span> </span><span>new</span><span> </span><span>Promise</span><span>((</span><span>resolve</span><span>, </span><span>reject</span><span>) </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>setTimeout</span><span>(() </span><span>=&gt;</span><span> </span><span>resolve</span><span>(), </span><span>1000</span><span>);</span></span>
<span><span>});</span></span>
<span><span>await</span><span> promise;</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="promise-try" id="promise-try"><a name="promise-try"></a><a href="#promise-try"><code>Promise.try()</code></a></h3><p>You can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/try"><code>Promise.try()</code></a> to create a promise that wraps a synchronous or asynchronous function.</p><div><div><div><pre><code><span><span>const</span><span> </span><span>syncFn</span><span> </span><span>=</span><span> () </span><span>=&gt;</span><span> </span><span>1</span><span> </span><span>+</span><span> </span><span>1</span><span>;</span></span>
<span><span>const</span><span> </span><span>asyncFn</span><span> </span><span>=</span><span> </span><span>async</span><span> (</span><span>a</span><span>, </span><span>b</span><span>) </span><span>=&gt;</span><span> </span><span>1</span><span> </span><span>+</span><span> a </span><span>+</span><span> b;</span></span>
<span></span>
<span><span>await</span><span> </span><span>Promise</span><span>.</span><span>try</span><span>(syncFn); </span><span>// =&gt; 2</span></span>
<span><span>await</span><span> </span><span>Promise</span><span>.</span><span>try</span><span>(asyncFn, </span><span>2</span><span>, </span><span>3</span><span>); </span><span>// =&gt; 6</span></span>
<span></span></code></pre></div></div></div><p>This is useful if you don&#39;t know if a function is synchronous or asynchronous. Previously, you would have to do something like this:</p><div><div><div><pre><code><span><span>await</span><span> </span><span>new</span><span> </span><span>Promise</span><span>((</span><span>resolve</span><span>) </span><span>=&gt;</span><span> </span><span>resolve</span><span>(</span><span>syncFn</span><span>()));</span></span>
<span><span>await</span><span> </span><span>new</span><span> </span><span>Promise</span><span>((</span><span>resolve</span><span>) </span><span>=&gt;</span><span> </span><span>resolve</span><span>(</span><span>asyncFn</span><span>(</span><span>2</span><span>, </span><span>3</span><span>)));</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="error-iserror" id="error-iserror"><a name="error-iserror"></a><a href="#error-iserror"><code>Error.isError()</code></a></h3><p>You can now check if an object is an <code>Error</code> instance using <a href="https://github.com/tc39/proposal-is-error/tree/main?tab=readme-ov-file#erroriserror"><code>Error.isError()</code></a>.</p><div><div><div><pre><code><span><span>Error</span><span>.</span><span>isError</span><span>(</span><span>new</span><span> </span><span>Error</span><span>()); </span><span>// =&gt; true</span></span>
<span><span>Error</span><span>.</span><span>isError</span><span>({}); </span><span>// =&gt; false</span></span>
<span><span>Error</span><span>.</span><span>isError</span><span>(</span><span>new</span><span> (</span><span>class</span><span> </span><span>Error</span><span> {})()); </span><span>// =&gt; false</span></span>
<span><span>Error</span><span>.</span><span>isError</span><span>({ [</span><span>Symbol</span><span>.toStringTag]</span><span>:</span><span> </span><span>&#34;</span><span>Error</span><span>&#34;</span><span> }); </span><span>// =&gt; false</span></span>
<span></span></code></pre></div></div></div><p>This is more correct than using <code>instanceof</code> because the prototype chain can be tampered with, and <code>instanceof</code> can return false-negatives when using <code>node:vm</code>.</p><div><div><div><pre><code><span><span>import</span><span> { runInNewContext } </span><span>from</span><span> </span><span>&#34;</span><span>node:vm</span><span>&#34;</span><span>;</span></span>
<span><span>const</span><span> crossRealmError </span><span>=</span><span> </span><span>runInNewContext</span><span>(</span><span>&#34;</span><span>new Error()</span><span>&#34;</span><span>);</span></span>
<span></span>
<span><span>crossRealmError </span><span>instanceof</span><span> </span><span>Error</span><span>; </span><span>// =&gt; false</span></span>
<span><span>Error</span><span>.</span><span>isError</span><span>(crossRealmError); </span><span>// =&gt; true</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="uint8array-tobase64" id="uint8array-tobase64"><a name="uint8array-tobase64"></a><a href="#uint8array-tobase64"><code>Uint8Array.toBase64()</code></a></h3><p>You can now encode and decode base64 strings using <code>Uint8Array</code>.</p><ul><li><code>toBase64()</code> converts a <code>Uint8Array</code> to a base64 string</li><li><code>fromBase64()</code> converts a base64 string to a <code>Uint8Array</code></li></ul><div><div><div><pre><code><span><span>new</span><span> </span><span>Uint8Array</span><span>([</span><span>1</span><span>, </span><span>2</span><span>, </span><span>3</span><span>, </span><span>4</span><span>, </span><span>5</span><span>]).</span><span>toBase64</span><span>(); </span><span>// &#34;AQIDBA==&#34;</span></span>
<span><span>Unit8Array.</span><span>fromBase64</span><span>(</span><span>&#34;</span><span>AQIDBA==</span><span>&#34;</span><span>); </span><span>// [1, 2, 3, 4, 5]</span></span>
<span></span></code></pre></div></div></div><p>These APIs are standard alternatives to the usage of <code>Buffer.toString(&#34;base64&#34;)</code> in Node.js.</p><h3 level="3" anchor-id="uint8array-tohex" id="uint8array-tohex"><a name="uint8array-tohex"></a><a href="#uint8array-tohex"><code>Uint8Array.toHex()</code></a></h3><p>You can also convert <code>Uint8Array</code> to and from hex strings.</p><ul><li><code>toHex()</code> converts a <code>Uint8Array</code> to a hex string</li><li><code>fromHex()</code> converts a hex string to a <code>Uint8Array</code></li></ul><div><div><div><pre><code><span><span>new</span><span> </span><span>Uint8Array</span><span>([</span><span>1</span><span>, </span><span>2</span><span>, </span><span>3</span><span>, </span><span>4</span><span>, </span><span>5</span><span>]).</span><span>toHex</span><span>(); </span><span>// &#34;0102030405&#34;</span></span>
<span><span>Unit8Array.</span><span>fromHex</span><span>(</span><span>&#34;</span><span>0102030405</span><span>&#34;</span><span>); </span><span>// [1, 2, 3, 4, 5]</span></span>
<span></span></code></pre></div></div></div><p>These APIs are standard alternatives to the usage of <code>Buffer.toString(&#34;hex&#34;)</code> in Node.js.</p><h3 level="3" anchor-id="iterator-helpers" id="iterator-helpers"><a name="iterator-helpers"></a><a href="#iterator-helpers">Iterator helpers</a></h3><p>There are new APIs that make it easier to work with JavaScript iterators and generators.</p><h4 level="4" id="iterator-map-fn"><code>iterator.map(fn)</code></h4><p>Returns an iterator that yields the results of the <code>fn</code> function applied to each value of the original iterator, similar to <code>Array.prototype.map</code>.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>range</span><span>(</span><span>start</span><span>:</span><span> </span><span>number</span><span>, </span><span>end</span><span>:</span><span> </span><span>number</span><span>)</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>number</span><span>&gt; {</span></span>
<span><span>  </span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> start; i </span><span>&lt;</span><span> end; i</span><span>++</span><span>) {</span></span>
<span><span>    </span><span>yield</span><span> i;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>range</span><span>(</span><span>3</span><span>, </span><span>5</span><span>).</span><span>map</span><span>((</span><span>x</span><span>) </span><span>=&gt;</span><span> x </span><span>*</span><span> </span><span>2</span><span>);</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: 6, done: false }</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-flatmap-fn"><code>iterator.flatMap(fn)</code></h4><p>Returns an iterator that yields the values of the original iterator, but flattens the results of the <code>fn</code> function, similar to <code>Array.prototype.flatMap</code>.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>randomThoughts</span><span>()</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>string</span><span>&gt; {</span></span>
<span><span>  </span><span>yield</span><span> </span><span>&#34;</span><span>Bun is written in Zig</span><span>&#34;</span><span>;</span></span>
<span><span>  </span><span>yield</span><span> </span><span>&#34;</span><span>Bun runs JavaScript and TypeScript</span><span>&#34;</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>randomThoughts</span><span>().</span><span>flatMap</span><span>((</span><span>x</span><span>) </span><span>=&gt;</span><span> x.</span><span>split</span><span>(</span><span>&#34;</span><span> </span><span>&#34;</span><span>));</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: &#34;Bun&#34;, done: false }</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: &#34;is&#34;, done: false }</span></span>
<span><span>// ...</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: &#34;TypeScript&#34;, done: false }</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-filter-fn"><code>iterator.filter(fn)</code></h4><p>Returns an iterator that only yields values that pass the <code>fn</code> predicate, similar to <code>Array.prototype.filter</code>.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>range</span><span>(</span><span>start</span><span>:</span><span> </span><span>number</span><span>, </span><span>end</span><span>:</span><span> </span><span>number</span><span>)</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>number</span><span>&gt; {</span></span>
<span><span>  </span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> start; i </span><span>&lt;</span><span> end; i</span><span>++</span><span>) {</span></span>
<span><span>    </span><span>yield</span><span> i;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>range</span><span>(</span><span>3</span><span>, </span><span>5</span><span>).</span><span>filter</span><span>((</span><span>x</span><span>) </span><span>=&gt;</span><span> x </span><span>%</span><span> </span><span>2</span><span> </span><span>===</span><span> </span><span>0</span><span>);</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: 4, done: false }</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-take-n"><code>iterator.take(n)</code></h4><p>Returns an iterator that yields the first <code>n</code> values of the original iterator.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>odds</span><span>()</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>number</span><span>&gt; {</span></span>
<span><span>  </span><span>let</span><span> i </span><span>=</span><span> </span><span>1</span><span>;</span></span>
<span><span>  </span><span>while</span><span> (</span><span>true</span><span>) {</span></span>
<span><span>    </span><span>yield</span><span> i;</span></span>
<span><span>    i </span><span>+=</span><span> </span><span>2</span><span>;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>odds</span><span>().</span><span>take</span><span>(</span><span>1</span><span>);</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: 1, done: false }</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { done: true }</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-drop-n"><code>iterator.drop(n)</code></h4><p>Returns an iterator that yields all values of the original iterator, except the first <code>n</code> values.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>evens</span><span>()</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>number</span><span>&gt; {</span></span>
<span><span>  </span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>;</span></span>
<span><span>  </span><span>while</span><span> (</span><span>true</span><span>) {</span></span>
<span><span>    </span><span>yield</span><span> i;</span></span>
<span><span>    i </span><span>+=</span><span> </span><span>2</span><span>;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>evens</span><span>().</span><span>drop</span><span>(</span><span>2</span><span>);</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: 4, done: false }</span></span>
<span><span>result.</span><span>next</span><span>(); </span><span>// { value: 6, done: false }</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-reduce-fn-initialvalue"><code>iterator.reduce(fn, initialValue)</code></h4><p>Reduces the values of an iterator with a function, similar to <code>Array.prototype.reduce</code>.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>powersOfTwo</span><span>()</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>number</span><span>&gt; {</span></span>
<span><span>  </span><span>let</span><span> i </span><span>=</span><span> </span><span>1</span><span>;</span></span>
<span><span>  </span><span>while</span><span> (</span><span>true</span><span>) {</span></span>
<span><span>    </span><span>yield</span><span> i;</span></span>
<span><span>    i </span><span>*=</span><span> </span><span>2</span><span>;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>powersOfTwo</span><span>()</span></span>
<span><span>  .</span><span>take</span><span>(</span><span>5</span><span>)</span></span>
<span><span>  .</span><span>reduce</span><span>((</span><span>acc</span><span>, </span><span>x</span><span>) </span><span>=&gt;</span><span> acc </span><span>+</span><span> x, </span><span>0</span><span>);</span></span>
<span><span>console.</span><span>log</span><span>(result); </span><span>// 15</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-toarray"><code>iterator.toArray()</code></h4><p>Returns an array that contains all the values of the original iterator. Make sure that the iterator is finite, otherwise this will cause an infinite loop.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>range</span><span>(</span><span>start</span><span>:</span><span> </span><span>number</span><span>, </span><span>end</span><span>:</span><span> </span><span>number</span><span>)</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>number</span><span>&gt; {</span></span>
<span><span>  </span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> start; i </span><span>&lt;</span><span> end; i</span><span>++</span><span>) {</span></span>
<span><span>    </span><span>yield</span><span> i;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>range</span><span>(</span><span>1</span><span>, </span><span>5</span><span>).</span><span>toArray</span><span>();</span></span>
<span><span>console.</span><span>log</span><span>(result); </span><span>// [1, 2, 3, 4]</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-foreach-fn"><code>iterator.forEach(fn)</code></h4><p>Calls the <code>fn</code> function on each value of the original iterator, similar to <code>Array.prototype.forEach</code>.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>randomThoughts</span><span>()</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>string</span><span>&gt; {</span></span>
<span><span>  </span><span>yield</span><span> </span><span>&#34;</span><span>Bun is written in Zig</span><span>&#34;</span><span>;</span></span>
<span><span>  </span><span>yield</span><span> </span><span>&#34;</span><span>Bun runs JavaScript and TypeScript</span><span>&#34;</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>randomThoughts</span><span>().</span><span>forEach</span><span>((</span><span>x</span><span>) </span><span>=&gt;</span><span> console.</span><span>log</span><span>(x));</span></span>
<span><span>// Bun is written in Zig</span></span>
<span><span>// Bun runs JavaScript and TypeScript</span></span>
<span></span></code></pre></div></div></div><h4 level="4" id="iterator-find-fn"><code>iterator.find(fn)</code></h4><p>Returns the first value of the original iterator that passes the <code>fn</code> predicate, similar to <code>Array.prototype.find</code>. If no such value exists, it returns <code>undefined</code>.</p><div><div><div><pre><code><span><span>function*</span><span> </span><span>range</span><span>(</span><span>start</span><span>:</span><span> </span><span>number</span><span>, </span><span>end</span><span>:</span><span> </span><span>number</span><span>)</span><span>:</span><span> </span><span>Generator</span><span>&lt;</span><span>number</span><span>&gt; {</span></span>
<span><span>  </span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> start; i </span><span>&lt;</span><span> end; i</span><span>++</span><span>) {</span></span>
<span><span>    </span><span>yield</span><span> i;</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>range</span><span>(</span><span>0</span><span>, </span><span>99</span><span>).</span><span>find</span><span>((</span><span>x</span><span>) </span><span>=&gt;</span><span> x </span><span>%</span><span> </span><span>100</span><span> </span><span>===</span><span> </span><span>0</span><span>);</span></span>
<span><span>console.</span><span>log</span><span>(result); </span><span>// undefined</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="float16array" id="float16array"><a name="float16array"></a><a href="#float16array"><code>Float16Array</code></a></h3><p>There&#39;s now support for 16-bit floating point arrays using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Float16Array"><code>Float16Array</code></a>. While 16-bit floating point numbers are less precise than 32-bit floating point numbers, they are much more memory efficient.</p><div><div><div><pre><code><span><span>const</span><span> float16 </span><span>=</span><span> </span><span>new</span><span> </span><span>Float16Array</span><span>(</span><span>3</span><span>);</span></span>
<span><span>const</span><span> float32 </span><span>=</span><span> </span><span>new</span><span> </span><span>Float32Array</span><span>(</span><span>3</span><span>);</span></span>
<span></span>
<span><span>for</span><span> (</span><span>let</span><span> i </span><span>=</span><span> </span><span>0</span><span>; i </span><span>&lt;</span><span> </span><span>3</span><span>; i</span><span>++</span><span>) {</span></span>
<span><span>  float16[i] </span><span>=</span><span> i </span><span>+</span><span> </span><span>0.123</span><span>;</span></span>
<span><span>  float32[i] </span><span>=</span><span> i </span><span>+</span><span> </span><span>0.123</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(float16); </span><span>// Float16Array(3) [ 0, 1.123046875, 2.123046875 ]</span></span>
<span><span>console.</span><span>log</span><span>(float32); </span><span>// Float32Array(3) [ 0, 1.1230000257492065, 2.122999906539917 ]</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="web-apis" id="web-apis"><a name="web-apis"></a><a href="#web-apis">Web APIs</a></h2><p>In addition to new JavaScript features, there are also new Web-standard APIs that you can use in Bun.</p><h3 level="3" anchor-id="textdecoderstream" id="textdecoderstream"><a name="textdecoderstream"></a><a href="#textdecoderstream"><code>TextDecoderStream</code></a></h3><p>You can now use <a href="https://developer.mozilla.org/en-US/docs/Web/API/TextDecoderStream"><code>TextDecoderStream</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/TextEncoderStream"><code>TextEncoderStream</code></a> to encode and decode streams of data. These APIs are the streaming equivalents of <a href="https://developer.mozilla.org/en-US/docs/Web/API/TextDecoder"><code>TextDecoder</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/TextEncoder"><code>TextEncoder</code></a>.</p><p>You can use <code>TextDecoderStream</code> to decode a stream of bytes into a stream of UTF-8 strings.</p><div><div><div><pre><code><span><span>const</span><span> response </span><span>=</span><span> </span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> body </span><span>=</span><span> response.body.</span><span>pipeThrough</span><span>(</span><span>new</span><span> </span><span>TextDecoderStream</span><span>());</span></span>
<span></span>
<span><span>for</span><span> </span><span>await</span><span> (</span><span>const</span><span> chunk </span><span>of</span><span> body) {</span></span>
<span><span>  console.</span><span>log</span><span>(chunk); </span><span>// typeof chunk === &#34;string&#34;</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><p>Or you can use <code>TextEncoderStream</code> to encode a stream of UTF-8 strings into a stream of bytes. In Bun, this is up to <a href="https://twitter.com/jarredsumner/status/1822221334056935771">30x faster</a> than in Node.js.</p><div><div><div><pre><code><span><span>const</span><span> stream </span><span>=</span><span> </span><span>new</span><span> </span><span>ReadableStream</span><span>({</span></span>
<span><span>  </span><span>start</span><span>(</span><span>controller</span><span>) {</span></span>
<span><span>    controller.</span><span>enqueue</span><span>(</span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>);</span></span>
<span><span>    controller.</span><span>close</span><span>();</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span><span>const</span><span> body </span><span>=</span><span> stream.</span><span>pipeThrough</span><span>(</span><span>new</span><span> </span><span>TextEncoderStream</span><span>());</span></span>
<span></span>
<span><span>for</span><span> </span><span>await</span><span> (</span><span>const</span><span> chunk </span><span>of</span><span> body) {</span></span>
<span><span>  console.</span><span>log</span><span>(chunk); </span><span>// chunk instanceof Uint8Array</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="textdecoder-with-stream-option" id="textdecoder-with-stream-option"><a name="textdecoder-with-stream-option"></a><a href="#textdecoder-with-stream-option"><code>TextDecoder</code> with <code>stream</code> option</a></h3><p>There is also support for the <code>stream</code> option in <code>TextDecoder</code>. This tells the decoder that chunks are part of a larger stream, and it should not throw an error if chunk is not a complete UTF-8 code point.</p><div><div><div><pre><code><span><span>const</span><span> decoder </span><span>=</span><span> </span><span>new</span><span> </span><span>TextDecoder</span><span>(</span><span>&#34;</span><span>utf-8</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> first </span><span>=</span><span> decoder.</span><span>decode</span><span>(</span><span>new</span><span> </span><span>Uint8Array</span><span>([</span><span>226</span><span>, </span><span>153</span><span>]), { stream</span><span>:</span><span> </span><span>true</span><span> });</span></span>
<span><span>const</span><span> second </span><span>=</span><span> decoder.</span><span>decode</span><span>(</span><span>new</span><span> </span><span>Uint8Array</span><span>([</span><span>165</span><span>]), { stream</span><span>:</span><span> </span><span>true</span><span> });</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(first); </span><span>// &#34;&#34;</span></span>
<span><span>console.</span><span>log</span><span>(second); </span><span>// &#34;♥&#34;</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="bytes-api" id="bytes-api"><a name="bytes-api"></a><a href="#bytes-api"><code>bytes()</code> API</a></h3><p>You can now use the <code>bytes()</code> method on streams, which returns a <code>Uint8Array</code> of the stream&#39;s data.</p><div><div><div><pre><code><span><span>const</span><span> response </span><span>=</span><span> </span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com/</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> bytes </span><span>=</span><span> </span><span>await</span><span> response.</span><span>bytes</span><span>();</span></span>
<span><span>console.</span><span>log</span><span>(bytes); </span><span>// Uint8Array(1256) [ 60, 33, ... ]</span></span>
<span></span></code></pre></div></div></div><p>Previously, you&#39;d have to use <code>arrayBuffer()</code>, then create a new <code>Uint8Array</code>:</p><div><div><div><pre><code><span><span>const</span><span> blob </span><span>=</span><span> </span><span>new</span><span> </span><span>Blob</span><span>([</span><span>&#34;</span><span>Hello, world!</span><span>&#34;</span><span>]);</span></span>
<span><span>const</span><span> buffer </span><span>=</span><span> </span><span>await</span><span> blob.</span><span>arrayBuffer</span><span>();</span></span>
<span><span>const</span><span> bytes </span><span>=</span><span> </span><span>new</span><span> </span><span>Uint8Array</span><span>(buffer);</span></span>
<span></span></code></pre></div></div></div><p>The <code>bytes()</code> method is supported by several APIs, including <code>Response</code>, <code>Blob</code>, and <code>Bun.file()</code>.</p><div><div><div><pre><code><span><span>import</span><span> { file } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> content </span><span>=</span><span> </span><span>await</span><span> </span><span>file</span><span>(</span><span>&#34;</span><span>./hello.txt</span><span>&#34;</span><span>).</span><span>bytes</span><span>();</span></span>
<span><span>console.</span><span>log</span><span>(content); </span><span>// Uint8Array(1256) [ 60, 33, ... ]</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="streaming-fetch-uploads" id="streaming-fetch-uploads"><a name="streaming-fetch-uploads"></a><a href="#streaming-fetch-uploads">Streaming <code>fetch()</code> uploads</a></h3><p>You can now send a <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch"><code>fetch()</code></a> request with a streaming body. This is useful for uploading large files, or streams of data where the content length is not known ahead of time.</p><div><div><div><pre><code><span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com/upload</span><span>&#34;</span><span>, {</span></span>
<span><span>  method</span><span>:</span><span> </span><span>&#34;</span><span>POST</span><span>&#34;</span><span>,</span></span>
<span><span>  </span><span>body</span><span>:</span><span> </span><span>async</span><span> </span><span>function*</span><span> () {</span></span>
<span><span>    </span><span>yield</span><span> </span><span>&#34;</span><span>Hello</span><span>&#34;</span><span>;</span></span>
<span><span>    </span><span>yield</span><span> </span><span>&#34;</span><span> </span><span>&#34;</span><span>;</span></span>
<span><span>    </span><span>yield</span><span> </span><span>&#34;</span><span>world!</span><span>&#34;</span><span>;</span></span>
<span><span>  },</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="console-group" id="console-group"><a name="console-group"></a><a href="#console-group"><code>console.group()</code></a></h3><p>You can now use <a href="https://developer.mozilla.org/en-US/docs/Web/API/console/group_static"><code>console.group()</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/console/groupEnd_static"><code>console.groupEnd()</code></a> to create a nested log messages. Previously, these were not implemented in Bun, and it would do nothing.</p><div><p>index.js</p><div><div><pre><code><span><span>console.</span><span>group</span><span>(</span><span>&#34;</span><span>begin</span><span>&#34;</span><span>);</span></span>
<span><span>console.</span><span>log</span><span>(</span><span>&#34;</span><span>indent!</span><span>&#34;</span><span>);</span></span>
<span><span>console.</span><span>groupEnd</span><span>();</span></span>
<span><span>// begin</span></span>
<span><span>//   indent!</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="url-createobjecturl" id="url-createobjecturl"><a name="url-createobjecturl"></a><a href="#url-createobjecturl"><code>URL.createObjectURL()</code></a></h3><p>There is now support for <a href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL"><code>URL.createObjectURL()</code></a>, which creates a URL from a Blob object. These urls can then be used in APIs like <code>fetch()</code>, <code>Worker</code>, and <code>import()</code>.</p><p>When combined with <code>Worker</code>, it allows for an easy way to spawn additional threads without creating a new separate URL for the worker&#39;s script. Since worker scripts also run through Bun&#39;s transpiler, TypeScript syntax is supported.</p><div><p>worker.ts</p><div><div><pre><code><span><span>const</span><span> code </span><span>=</span><span> </span><span>`</span></span>
<span><span>  const foo: number = 123;</span></span>
<span><span>  postMessage({ foo } satisfies Data);</span></span>
<span><span>`</span><span>;</span></span>
<span><span>const</span><span> blob </span><span>=</span><span> </span><span>new</span><span> </span><span>File</span><span>([code], </span><span>&#34;</span><span>worker.ts</span><span>&#34;</span><span>);</span></span>
<span><span>const</span><span> url </span><span>=</span><span> </span><span>URL</span><span>.</span><span>createObjectURL</span><span>(blob);</span></span>
<span></span>
<span><span>const</span><span> worker </span><span>=</span><span> </span><span>new</span><span> </span><span>Worker</span><span>(url);</span></span>
<span><span>worker.</span><span>onmessage</span><span> </span><span>=</span><span> ({ </span><span>data</span><span> }) </span><span>=&gt;</span><span> {</span></span>
<span><span>  console.</span><span>log</span><span>(</span><span>&#34;</span><span>Received data:</span><span>&#34;</span><span>, data);</span></span>
<span><span>};</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="abortsignal-any" id="abortsignal-any"><a name="abortsignal-any"></a><a href="#abortsignal-any"><code>AbortSignal.any()</code></a></h3><p>You can use <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal/any_static"><code>AbortSignal.any()</code></a> to combine multiple instances of <code>AbortSignal</code>. If one of the child signals is aborted, the parent signal is also aborted.</p><div><div><div><pre><code><span><span>const</span><span> { </span><span>signal</span><span>:</span><span> firstSignal } </span><span>=</span><span> </span><span>new</span><span> </span><span>AbortController</span><span>();</span></span>
<span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com/</span><span>&#34;</span><span>, { signal</span><span>:</span><span> firstSignal });</span></span>
<span></span>
<span><span>const</span><span> { </span><span>signal</span><span>:</span><span> secondSignal } </span><span>=</span><span> </span><span>new</span><span> </span><span>AbortController</span><span>();</span></span>
<span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com/</span><span>&#34;</span><span>, { signal</span><span>:</span><span> secondSignal });</span></span>
<span></span>
<span><span>// Cancels if either `firstSignal` or `secondSignal` is aborted</span></span>
<span><span>const</span><span> signal </span><span>=</span><span> AbortSignal.</span><span>any</span><span>([firstSignal, secondSignal]);</span></span>
<span><span>await</span><span> </span><span>fetch</span><span>(</span><span>&#34;</span><span>https://example.com/slow</span><span>&#34;</span><span>, { signal });</span></span>
<span></span></code></pre></div></div></div><h2 level="2" anchor-id="behaviour-changes" id="behaviour-changes"><a name="behaviour-changes"></a><a href="#behaviour-changes">Behaviour changes</a></h2><p>Bun 1.2 contains a few behaviour tweaks to that you should be aware of, but we think is unlikely to break your code. We avoid making these changes unless we think the status-quo is <em>so broken</em> that it&#39;s worth it.</p><h3 level="3" anchor-id="bun-run-uses-the-correct-directory" id="bun-run-uses-the-correct-directory"><a name="bun-run-uses-the-correct-directory"></a><a href="#bun-run-uses-the-correct-directory"><code>bun run</code> uses the correct directory</a></h3><p>Previously, when you ran a <code>package.json</code> script using <code>bun run</code>, the working directory of the script was the same as the current working directory of your shell.</p><p>In most cases, you don&#39;t notice a difference, because your shell&#39;s working directory is <em>usually</em> the same as the parent directory of your <code>package.json</code> file.</p><p>However, if you <code>cd</code> into a different directory, you&#39;ll notice the difference.</p><p>This does not match what other package managers do, like <code>npm</code> or <code>yarn</code>, and more-often-than-not causes unexpected behaviour.</p><p>In Bun 1.2, the working directory of the script is now the parent directory of the <code>package.json</code> file, instead of the current working directory of your shell.</p><div><div><div><pre><code><span><span>/path/to/project/dist</span></span>
<span><span>/path/to/project</span></span></code></pre></div></div></div><h3 level="3" anchor-id="uncaught-errors-in-bun-test" id="uncaught-errors-in-bun-test"><a name="uncaught-errors-in-bun-test"></a><a href="#uncaught-errors-in-bun-test">Uncaught errors in <code>bun test</code></a></h3><p>Previously, <code>bun test</code> would not fail when there was an uncaught error or rejection between test cases.</p><div><div><div><pre><code><span><span>import</span><span> { test, expect } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>test</span><span>(</span><span>&#34;</span><span>should have failed, but didn&#39;t</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>  </span><span>setTimeout</span><span>(() </span><span>=&gt;</span><span> {</span></span>
<span><span>    </span><span>throw</span><span> </span><span>new</span><span> </span><span>Error</span><span>(</span><span>&#34;</span><span>Oops!</span><span>&#34;</span><span>);</span></span>
<span><span>  }, </span><span>1</span><span>);</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><p>In Bun 1.2, this has now been fixed, and <code>bun test</code> will report the failure.</p><div><div><div><pre><code><span><span># Unhandled error between tests</span></span>
<span><span>-------------------------------</span></span>
<span><span>1</span><span> </span><span>|</span><span> </span><span>import</span><span> { test, expect } </span><span>from</span><span> </span><span>&#34;</span><span>bun:test</span><span>&#34;</span><span>;</span></span>
<span><span>2</span><span> </span><span>|</span></span>
<span><span>3</span><span> </span><span>|</span><span> </span><span>test</span><span>(</span><span>&#34;</span><span>should have failed, but didn&#39;t</span><span>&#34;</span><span>, () </span><span>=&gt;</span><span> {</span></span>
<span><span>4</span><span> </span><span>|</span><span>   </span><span>setTimeout</span><span>(() </span><span>=&gt;</span><span> {</span></span>
<span><span>5</span><span> </span><span>|</span><span>     </span><span>throw</span><span> </span><span>new</span><span> </span><span>Error</span><span>(</span><span>&#34;</span><span>Oops!</span><span>&#34;</span><span>);</span></span>
<span><span>              </span><span>^</span></span>
<span><span>error: Oops</span><span>!</span></span>
<span><span>      at foo.test.ts:</span><span>5</span><span>:</span><span>11</span></span>
<span><span>-------------------------------</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="server-stop-returns-a-promise" id="server-stop-returns-a-promise"><a name="server-stop-returns-a-promise"></a><a href="#server-stop-returns-a-promise"><code>server.stop()</code> returns a Promise</a></h3><p>Previously, there was no way to gracefully wait for connections to close from Bun&#39;s HTTP server.</p><p>To make this possible, we made <code>stop()</code> return a promise, which resolves when in-flight HTTP connections are closed.</p><div><div><div><pre><code><span><span>interface</span><span> </span><span>Server</span><span> {</span></span>
<span><span>   </span><span>stop</span><span>()</span><span>:</span><span> </span><span>void</span><span>;</span></span>
<span><span>   </span><span>stop</span><span>()</span><span>:</span><span> </span><span>Promise</span><span>&lt;</span><span>void</span><span>&gt;;</span></span>
<span><span>}</span></span></code></pre></div></div></div><h3 level="3" anchor-id="bun-build-rejects-when-it-fails" id="bun-build-rejects-when-it-fails"><a name="bun-build-rejects-when-it-fails"></a><a href="#bun-build-rejects-when-it-fails"><code>Bun.build()</code> rejects when it fails</a></h3><p>Previously, when <code>Bun.build()</code> would fail, it would report the error in the <code>logs</code> array. This was often confusing, because the promise would resolve successfully.</p><div><div><div><pre><code><span><span>import</span><span> { build } </span><span>from</span><span> </span><span>&#34;</span><span>bun</span><span>&#34;</span><span>;</span></span>
<span></span>
<span><span>const</span><span> result </span><span>=</span><span> </span><span>await</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./bad.ts</span><span>&#34;</span><span>],</span></span>
<span><span>});</span></span>
<span></span>
<span><span>console.</span><span>log</span><span>(result.logs[</span><span>0</span><span>]); </span><span>// error: ModuleNotFound resolving &#34;./bad.ts&#34; (entry point)</span></span>
<span></span></code></pre></div></div></div><p>In Bun 1.2, <code>Bun.build()</code> will now reject when it fails, instead of returning errors in the <code>logs</code> array.</p><div><div><div><pre><code><span><span>const</span><span> result </span><span>=</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./bad.ts</span><span>&#34;</span><span>],</span></span>
<span><span>});</span></span>
<span></span>
<span><span>await</span><span> result; </span><span>// error: ModuleNotFound resolving &#34;./bad.ts&#34; (entry point)</span></span>
<span></span></code></pre></div></div></div><p>If you want to restore to the old behaviour, you can set the <code>throw: false</code> option.</p><div><div><div><pre><code><span><span>const</span><span> result </span><span>=</span><span> </span><span>await</span><span> </span><span>build</span><span>({</span></span>
<span><span>  entrypoints</span><span>:</span><span> [</span><span>&#34;</span><span>./bad.ts</span><span>&#34;</span><span>],</span></span>
<span><span>  throw</span><span>:</span><span> </span><span>false</span><span>,</span></span>
<span><span>});</span></span>
<span></span></code></pre></div></div></div><h3 level="3" anchor-id="bun-p-is-an-alias-for-bun-print" id="bun-p-is-an-alias-for-bun-print"><a name="bun-p-is-an-alias-for-bun-print"></a><a href="#bun-p-is-an-alias-for-bun-print"><code>bun -p</code> is an alias for <code>bun --print</code></a></h3><p>Previously, <code>bun -p</code> was an alias for <code>bun --port</code>, which was used to change the port of <code>Bun.serve()</code>. The alias was added before Bun supported <code>bun --print</code>.</p><p>To match Node.js, we&#39;ve changed <code>bun -p</code> to be an alias for <code>bun --print</code>.</p><h3 level="3" anchor-id="bun-build-sourcemap" id="bun-build-sourcemap"><a name="bun-build-sourcemap"></a><a href="#bun-build-sourcemap"><code>bun build --sourcemap</code></a></h3><p>Previously, using <code>bun build --sourcemap</code> would default to inlined source maps.</p><div><div><div><pre><code><span><span>bun build --sourcemap ./index.ts --outfile ./index.js</span></span></code></pre></div></div></div><div><p>index.js</p><div><div><pre><code><span><span>console.</span><span>log</span><span>(</span><span>&#34;</span><span>Hello Bun!</span><span>&#34;</span><span>);</span></span>
<span><span>//# sourceMappingURL=data:application/json;base64,...</span></span>
<span></span></code></pre></div></div></div><p>This was confusing, because it is the opposite of what other tools do, like <code>esbuild</code>.</p><p>In Bun 1.2, <code>bun build --sourcemap</code> now defaults to <code>linked</code> source maps.</p><div id="yDJYdzBhMs"><div><div><p>index.js</p><div><div><pre><code><span><span>console.</span><span>log</span><span>(</span><span>&#34;</span><span>Hello Bun!</span><span>&#34;</span><span>);</span></span>
<span></span></code></pre></div></div></div></div><div><div><p>index.js.map</p><div><div><pre><code><span><span>{</span></span>
<span><span>  </span><span>&#34;</span><span>version</span><span>&#34;</span><span>:</span><span> </span><span>3</span><span>,</span></span>
<span><span>  </span><span>&#34;</span><span>sources</span><span>&#34;</span><span>:</span><span> [</span><span>&#34;</span><span>index.ts</span><span>&#34;</span><span>],</span></span>
<span><span>  </span><span>// ...</span></span>
<span><span>}</span></span>
<span></span></code></pre></div></div></div></div></div><p>If you want to restore to the old behaviour, you can use <code>--sourcemap=inline</code>.</p><h2 level="2" anchor-id="bun-is-even-faster" id="bun-is-even-faster"><a name="bun-is-even-faster"></a><a href="#bun-is-even-faster">Bun is even faster</a></h2><p>We spend a lot of time improving performance in Bun. We post almost daily updates of &#34;<a href="https://x.com/search?q=from%3Abunjavascript%20%22In%20the%20next%20version%20of%20Bun%22&amp;src=typed_query&amp;f=live">In the next version of Bun</a>&#34; which you can follow on <a href="https://x.com/bunjavascript">@bunjavascript</a>.</p><p>Here&#39;s a preview of some of the performance improvements we made in Bun 1.2.</p><div><details> <summary><code>node:http2</code> is 2x faster</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Bun (@bunjavascript) <a href="https://twitter.com/bunjavascript/status/1847014951661326396?ref_src=twsrc%5Etfw">October 17, 2024</a></blockquote>  </details><details> <summary><code>node:http</code> is 5x faster at uploading to S3</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Ciro Spaciari (@cirospaciari) <a href="https://twitter.com/cirospaciari/status/1826086715393716457?ref_src=twsrc%5Etfw">August 21, 2024</a></blockquote>  <p>Not to be confused with Bun&#39;s built-in S3 client, which is even 5x faster.</p> </details><details> <summary><code>path.resolve()</code> is 30x faster</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1834353346318401915?ref_src=twsrc%5Etfw">September 12, 2024</a></blockquote>  </details><details> <summary><code>fetch()</code> is 2x faster at DNS resolution</summary> <blockquote><p lang="en" dir="ltr">yOu cAnT mAkE fEtCh fAsTeR <a href="https://t.co/Ie8a6YM8Js">pic.twitter.com/Ie8a6YM8Js</a></p>— Bun (@bunjavascript) <a href="https://twitter.com/bunjavascript/status/1791678083449393219?ref_src=twsrc%5Etfw">May 18, 2024</a></blockquote>  </details><details> <summary><code>bun --hot</code> uses 2x less memory</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1818918642022858847?ref_src=twsrc%5Etfw">August 1, 2024</a></blockquote>  </details><details> <summary><code>fs.readdirSync()</code> is 5% faster on macOS</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1805067761103814828?ref_src=twsrc%5Etfw">June 24, 2024</a></blockquote>  </details><details> <summary><code>String.at()</code> is 44% faster</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun &amp; Safari</p>— Bun (@bunjavascript) <a href="https://twitter.com/bunjavascript/status/1867203604777676961?ref_src=twsrc%5Etfw">December 12, 2024</a></blockquote>  </details><details> <summary><code>atob()</code> is 8x faster</summary> <p>For large string inputs, <code>atob()</code> is up to 8x faster.</p> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Bun (@bunjavascript) <a href="https://twitter.com/bunjavascript/status/1790658507479646469?ref_src=twsrc%5Etfw">May 15, 2024</a></blockquote>  </details><details> <summary><code>fetch()</code> decompresses 30% faster</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1817067294591451208?ref_src=twsrc%5Etfw">July 27, 2024</a></blockquote>  </details><details> <summary><code>Buffer.from(String, &#34;base64&#34;)</code> is 30x faster</summary> <p>For large string inputs, <code>Buffer.from(string, &#34;base64&#34;)</code> is up to 30x faster.</p> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1803570321309704258?ref_src=twsrc%5Etfw">June 19, 2024</a></blockquote>  </details><details> <summary><code>JSON.parse()</code> is up to 4x faster</summary> <p>For large string inputs, <code>JSON.parse()</code> is between 2x and 4x faster.</p> <blockquote><p lang="en" dir="ltr">In the next version of Bun &amp; Safari</p>— Bun (@bunjavascript) <a href="https://twitter.com/bunjavascript/status/1788826914570019245?ref_src=twsrc%5Etfw">May 10, 2024</a></blockquote>  </details><details> <summary><code>Bun.serve()</code> has 2x more throughput</summary> <p>The fast path for <code>request.json()</code> and similar methods now works after accessing the request <code>body</code>. This makes throughput for some <code>Bun.serve()</code> applications up to 2x faster.</p> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1830900845778743450?ref_src=twsrc%5Etfw">September 3, 2024</a></blockquote>  </details><details> <summary><code>Error.captureStackTrace()</code> is 9x faster</summary> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1845736532298383391?ref_src=twsrc%5Etfw">October 14, 2024</a></blockquote>  </details><details> <summary><code>fs.readFile()</code> is 10% faster</summary> <p>For small files, <code>fs.readFile()</code> is up to 10% faster.</p> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1855427363133333870?ref_src=twsrc%5Etfw">November 10, 2024</a></blockquote>  </details><details> <summary><code>console.log(String)</code> is 50% faster</summary> <p>When you use <code>console.log()</code> with a string as an argument, it&#39;s now 50% faster.</p> <blockquote><p lang="en" dir="ltr">In the next version of Bun</p>— Bun (@bunjavascript) <a href="https://twitter.com/bunjavascript/status/1823263542067536197?ref_src=twsrc%5Etfw">August 13, 2024</a></blockquote>  </details><details> <summary>JavaScript is faster on Windows</summary> <p>In Bun 1.2, we enabled the <a href="https://www.webkit.org/blog/5852/introducing-the-b3-jit-compiler/">JIT</a> on Windows. Previously, the JIT was only available on macOS and Linux.</p> <blockquote><p lang="en" dir="ltr">9 years ago, JavaScriptCore&#39;s FTL JIT was disabled on Windows</p>— Jarred Sumner (@jarredsumner) <a href="https://twitter.com/jarredsumner/status/1810497635624890391?ref_src=twsrc%5Etfw">July 9, 2024</a></blockquote>  <p>JIT, or just-in-time compilation, is a technique that compiles code at runtime, instead of ahead-of-time compilation. This makes JavaScript faster, but it&#39;s also a lot more complex to implement.</p> <p>JavaScript, across the board, now runs faster on Windows. For example:</p> <ul> <li><code>Object.entries()</code> is 20% faster</li> <li><code>Array.map()</code> is 50% faster</li> </ul> <p>The JIT does a lot, it&#39;s over 25,000 lines of C++ code!</p> </details></div><h2 level="2" anchor-id="getting-started" id="getting-started"><a name="getting-started"></a><a href="#getting-started">Getting started</a></h2><p>That&#39;s it — that&#39;s Bun 1.2, and it&#39;s still just the beginning for Bun.</p><p>We&#39;ve added a ton of new features and APIs that make it easier than ever to build full-stack JavaScript and TypeScript applications.</p><h3 level="3" anchor-id="install-bun" id="install-bun"><a name="install-bun"></a><a href="#install-bun">Install Bun</a></h3><p>To get started, run any of the following commands in your terminal.</p><div id="QuHjTRnfih"><div><div><p>curl</p><div><div><pre><code><span><span>curl -fsSL https://bun.sh/install </span><span>|</span><span> bash</span></span></code></pre></div></div></div></div><div><div><p>powershell</p><div><div><pre><code><span><span>powershell </span><span>-c</span><span> </span><span>&#34;</span><span>irm bun.sh/install.ps1 | iex</span><span>&#34;</span></span></code></pre></div></div></div></div><div><div><p>docker</p><div><div><pre><code><span><span>docker run --rm --init --ulimit memlock=-1:-1 oven/bun</span></span></code></pre></div></div></div></div></div><h3 level="3" anchor-id="upgrade-bun" id="upgrade-bun"><a name="upgrade-bun"></a><a href="#upgrade-bun">Upgrade Bun</a></h3><p>If you already installed Bun, you can upgrade with the following command.</p><h2 level="2" anchor-id="we-re-hiring" id="we-re-hiring"><a name="we-re-hiring"></a><a href="#we-re-hiring">We&#39;re hiring</a></h2><p>We&#39;re hiring engineers, designers, and contributors to JavaScript engines like V8, WebKit, Hermes, and SpiderMonkey to join our team in-person in San Francisco to build the future of JavaScript.</p><p>You can check out our <a href="https://bun.sh/careers">careers</a> page or send us an <a href="mailto:jobs@bun.sh">email</a>.</p><h2 level="2" anchor-id="thank-you" id="thank-you"><a name="thank-you"></a><a href="#thank-you">Thank you!</a></h2><p>Bun is free, open source, and MIT-licensed.</p><p>We receive a lot of open source contributions from the community. So, we&#39;d like to thank everyone who has fixed a bug or contributed a feature. We appreciate your help!</p><ul><li><a href="https://github.com/nektro">@nektro</a></li><li><a href="https://github.com/dylan-conway">@dylan-conway</a></li><li><a href="https://github.com/pfgithub">@pfgithub</a></li><li><a href="https://github.com/heimskr">@heimskr</a></li><li><a href="https://github.com/cirospaciari">@cirospaciari</a></li><li><a href="https://github.com/Devanand-Sharma">@Devanand-Sharma</a></li><li><a href="https://github.com/lgarron">@lgarron</a></li><li><a href="https://github.com/zackradisic">@zackradisic</a></li><li><a href="https://github.com/DonIsaac">@DonIsaac</a></li><li><a href="https://github.com/RiskyMH">@RiskyMH</a></li><li><a href="https://github.com/paperclover">@paperclover</a></li><li><a href="https://github.com/rgarcia">@rgarcia</a></li><li><a href="https://github.com/fel1x-developer">@fel1x-developer</a></li><li><a href="https://github.com/190n">@190n</a></li><li><a href="https://github.com/lcrespom">@lcrespom</a></li><li><a href="https://github.com/versecafe">@versecafe</a></li><li><a href="https://github.com/dtinth">@dtinth</a></li><li><a href="https://github.com/yooneskh">@yooneskh</a></li><li><a href="https://github.com/sroussey">@sroussey</a></li><li><a href="https://github.com/ArnaudBarre">@ArnaudBarre</a></li><li><a href="https://github.com/kjjd84">@kjjd84</a></li><li><a href="https://github.com/cainba">@cainba</a></li><li><a href="https://github.com/robertshuford">@robertshuford</a></li><li><a href="https://github.com/Gobd">@Gobd</a></li><li><a href="https://github.com/citkane">@citkane</a></li><li><a href="https://github.com/marcosrjjunior">@marcosrjjunior</a></li><li><a href="https://github.com/thecrypticace">@thecrypticace</a></li><li><a href="https://github.com/metonym">@metonym</a></li><li><a href="https://github.com/ianzone">@ianzone</a></li><li><a href="https://github.com/chawyehsu">@chawyehsu</a></li><li><a href="https://github.com/komiya-atsushi">@komiya-atsushi</a></li><li><a href="https://github.com/jbergstroem">@jbergstroem</a></li><li><a href="https://github.com/sirmews">@sirmews</a></li><li><a href="https://github.com/laesse">@laesse</a></li><li><a href="https://github.com/WingLim">@WingLim</a></li><li><a href="https://github.com/martinamps">@martinamps</a></li><li><a href="https://github.com/brainkim">@brainkim</a></li><li><a href="https://github.com/Electroid">@Electroid</a></li><li><a href="https://github.com/01101sam">@01101sam</a></li><li><a href="https://github.com/eventualbuddha">@eventualbuddha</a></li><li><a href="https://github.com/snoglobe">@snoglobe</a></li><li><a href="https://github.com/nattui">@nattui</a></li><li><a href="https://github.com/swen128">@swen128</a></li><li><a href="https://github.com/hex2f">@hex2f</a></li><li><a href="https://github.com/imide">@imide</a></li><li><a href="https://github.com/cdfzo">@cdfzo</a></li><li><a href="https://github.com/alii">@alii</a></li><li><a href="https://github.com/Kapsonfire-DE">@Kapsonfire-DE</a></li><li><a href="https://github.com/NReilingh">@NReilingh</a></li><li><a href="https://github.com/SunsetTechuila">@SunsetTechuila</a></li><li><a href="https://github.com/luavixen">@luavixen</a></li><li><a href="https://github.com/rtzll">@rtzll</a></li><li><a href="https://github.com/advaith1">@advaith1</a></li><li><a href="https://github.com/gvilums">@gvilums</a></li><li><a href="https://github.com/Nanome203">@Nanome203</a></li><li><a href="https://github.com/ippsav">@ippsav</a></li><li><a href="https://github.com/guest271314">@guest271314</a></li><li><a href="https://github.com/yamalight">@yamalight</a></li><li><a href="https://github.com/ceymard">@ceymard</a></li><li><a href="https://github.com/adhamu">@adhamu</a></li><li><a href="https://github.com/gjungb">@gjungb</a></li><li><a href="https://github.com/kaioduarte">@kaioduarte</a></li><li><a href="https://github.com/BjornTheProgrammer">@BjornTheProgrammer</a></li><li><a href="https://github.com/arthurvanl">@arthurvanl</a></li><li><a href="https://github.com/lirantal">@lirantal</a></li><li><a href="https://github.com/Eckhardt-D">@Eckhardt-D</a></li><li><a href="https://github.com/CanadaHonk">@CanadaHonk</a></li><li><a href="https://github.com/sourcegr">@sourcegr</a></li><li><a href="https://github.com/alexlamsl">@alexlamsl</a></li><li><a href="https://github.com/refi64">@refi64</a></li><li><a href="https://github.com/huseeiin">@huseeiin</a></li><li><a href="https://github.com/FaSe22">@FaSe22</a></li><li><a href="https://github.com/deiga">@deiga</a></li><li><a href="https://github.com/Skywalker13">@Skywalker13</a></li><li><a href="https://github.com/KiwiZ0">@KiwiZ0</a></li><li><a href="https://github.com/lewismiddleton">@lewismiddleton</a></li><li><a href="https://github.com/matubu">@matubu</a></li><li><a href="https://github.com/mjomble">@mjomble</a></li><li><a href="https://github.com/wpaulino">@wpaulino</a></li><li><a href="https://github.com/Xmarmalade">@Xmarmalade</a></li><li><a href="https://github.com/bakkot">@bakkot</a></li><li><a href="https://github.com/stilt0n">@stilt0n</a></li><li><a href="https://github.com/levabala">@levabala</a></li><li><a href="https://github.com/DannyJJK">@DannyJJK</a></li><li><a href="https://github.com/Marukome0743">@Marukome0743</a></li><li><a href="https://github.com/sacsbrainz">@sacsbrainz</a></li><li><a href="https://github.com/mohit-s96">@mohit-s96</a></li><li><a href="https://github.com/fmorency">@fmorency</a></li><li><a href="https://github.com/jakeboone02">@jakeboone02</a></li><li><a href="https://github.com/17hz">@17hz</a></li><li><a href="https://github.com/jakebailey">@jakebailey</a></li><li><a href="https://github.com/oddyamill">@oddyamill</a></li><li><a href="https://github.com/MARCROCK22">@MARCROCK22</a></li><li><a href="https://github.com/vktrl">@vktrl</a></li><li><a href="https://github.com/mroyme">@mroyme</a></li><li><a href="https://github.com/inad9300">@inad9300</a></li><li><a href="https://github.com/billywhizz">@billywhizz</a></li><li><a href="https://github.com/pythonmcpi">@pythonmcpi</a></li><li><a href="https://github.com/m1212e">@m1212e</a></li><li><a href="https://github.com/dariushalipour">@dariushalipour</a></li><li><a href="https://github.com/eval">@eval</a></li><li><a href="https://github.com/davidstevens37">@davidstevens37</a></li><li><a href="https://github.com/zpix1">@zpix1</a></li><li><a href="https://github.com/HibanaSama">@HibanaSama</a></li><li><a href="https://github.com/mangs">@mangs</a></li><li><a href="https://github.com/victor-homyakov">@victor-homyakov</a></li><li><a href="https://github.com/silverwind">@silverwind</a></li><li><a href="https://github.com/ghoshArnab">@ghoshArnab</a></li><li><a href="https://github.com/Ptitet">@Ptitet</a></li><li><a href="https://github.com/ThatOneBro">@ThatOneBro</a></li><li><a href="https://github.com/Imgodmaoyouknow">@Imgodmaoyouknow</a></li><li><a href="https://github.com/lmmfranco">@lmmfranco</a></li><li><a href="https://github.com/farcaller">@farcaller</a></li><li><a href="https://github.com/ryuujo1573">@ryuujo1573</a></li><li><a href="https://github.com/otecd">@otecd</a></li><li><a href="https://github.com/bjon">@bjon</a></li><li><a href="https://github.com/rista404">@rista404</a></li><li><a href="https://github.com/trcio">@trcio</a></li><li><a href="https://github.com/kdrag0n">@kdrag0n</a></li><li><a href="https://github.com/speelbarrow">@speelbarrow</a></li><li><a href="https://github.com/0livare">@0livare</a></li><li><a href="https://github.com/exoego">@exoego</a></li><li><a href="https://github.com/vadzim">@vadzim</a></li><li><a href="https://github.com/umarfchy">@umarfchy</a></li><li><a href="https://github.com/jmho">@jmho</a></li><li><a href="https://github.com/panva">@panva</a></li><li><a href="https://github.com/vitch">@vitch</a></li><li><a href="https://github.com/perkrlsn">@perkrlsn</a></li><li><a href="https://github.com/ibanks42">@ibanks42</a></li><li><a href="https://github.com/erik-dunteman">@erik-dunteman</a></li><li><a href="https://github.com/nmarks413">@nmarks413</a></li><li><a href="https://github.com/forcefieldsovereign">@forcefieldsovereign</a></li><li><a href="https://github.com/bomberstudios">@bomberstudios</a></li><li><a href="https://github.com/mohiwalla">@mohiwalla</a></li><li><a href="https://github.com/surprisedpika">@surprisedpika</a></li><li><a href="https://github.com/ShrootBuck">@ShrootBuck</a></li><li><a href="https://github.com/oscarfsbs">@oscarfsbs</a></li><li><a href="https://github.com/diogomdp">@diogomdp</a></li><li><a href="https://github.com/LudvigHz">@LudvigHz</a></li><li><a href="https://github.com/nacmartin">@nacmartin</a></li><li><a href="https://github.com/nithinkjoy-tech">@nithinkjoy-tech</a></li><li><a href="https://github.com/Sushants-Git">@Sushants-Git</a></li><li><a href="https://github.com/tobycm">@tobycm</a></li><li><a href="https://github.com/creator318">@creator318</a></li><li><a href="https://github.com/janos-r">@janos-r</a></li><li><a href="https://github.com/AbhiPrasad">@AbhiPrasad</a></li><li><a href="https://github.com/JonnyBurger">@JonnyBurger</a></li><li><a href="https://github.com/HUMORCE">@HUMORCE</a></li><li><a href="https://github.com/zawodskoj">@zawodskoj</a></li><li><a href="https://github.com/eigilsagafos">@eigilsagafos</a></li><li><a href="https://github.com/jess-render">@jess-render</a></li><li><a href="https://github.com/gaurishhs">@gaurishhs</a></li><li><a href="https://github.com/ridiculousfish">@ridiculousfish</a></li><li><a href="https://github.com/jakeg">@jakeg</a></li><li><a href="https://github.com/ananis25">@ananis25</a></li><li><a href="https://github.com/DaleSeo">@DaleSeo</a></li><li><a href="https://github.com/ahaoboy">@ahaoboy</a></li><li><a href="https://github.com/lafkpages">@lafkpages</a></li><li><a href="https://github.com/henrikstorck">@henrikstorck</a></li><li><a href="https://github.com/rcaselles">@rcaselles</a></li><li><a href="https://github.com/yhdgms1">@yhdgms1</a></li><li><a href="https://github.com/e3dio">@e3dio</a></li><li><a href="https://github.com/jrmccannon">@jrmccannon</a></li><li><a href="https://github.com/anchan828">@anchan828</a></li><li><a href="https://github.com/ghost">@ghost</a></li><li><a href="https://github.com/fzn0x">@fzn0x</a></li><li><a href="https://github.com/windwiny">@windwiny</a></li><li><a href="https://github.com/RanolP">@RanolP</a></li><li><a href="https://github.com/dsernst">@dsernst</a></li><li><a href="https://github.com/yus-ham">@yus-ham</a></li><li><a href="https://github.com/jlucaso1">@jlucaso1</a></li><li><a href="https://github.com/KilianB">@KilianB</a></li><li><a href="https://github.com/josephjclark">@josephjclark</a></li><li><a href="https://github.com/Uziniii">@Uziniii</a></li><li><a href="https://github.com/erikbrinkman">@erikbrinkman</a></li><li><a href="https://github.com/boyer-victor">@boyer-victor</a></li><li><a href="https://github.com/welfuture">@welfuture</a></li><li><a href="https://github.com/jwigert">@jwigert</a></li><li><a href="https://github.com/Deckluhm">@Deckluhm</a></li><li><a href="https://github.com/liudonghua123">@liudonghua123</a></li><li><a href="https://github.com/tuttarealstep">@tuttarealstep</a></li><li><a href="https://github.com/LukasKastern">@LukasKastern</a></li><li><a href="https://github.com/jdfwarrior">@jdfwarrior</a></li><li><a href="https://github.com/evanshortiss">@evanshortiss</a></li><li><a href="https://github.com/jdalton">@jdalton</a></li><li><a href="https://github.com/jprinaldi">@jprinaldi</a></li><li><a href="https://github.com/yoavbls">@yoavbls</a></li><li><a href="https://github.com/tomerh2001">@tomerh2001</a></li><li><a href="https://github.com/Bellisario">@Bellisario</a></li><li><a href="https://github.com/sitiom">@sitiom</a></li></ul></article></div>
  </body>
</html>
