<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cleanlab.ai/blog/prompt-selection/">Original</a>
    <h1>Beware of Unreliable Data in Model Evaluation: A LLM Prompt Selection Case Study</h1>
    
    <div id="readability-page-1" class="page"><div id="__next" data-reactroot=""><main><main><div><div><div><div><div><div><picture><source srcset="/_next/static/images/thumbnail-66f02269bbaaf143ed1a8d01eb6cf432.png.webp" type="image/webp"/><source srcset="/_next/static/images/thumbnail-46d4defae2d9ca18441f88953f21f2d4.png"/><img alt="thumbnail.png" src="https://cleanlab.ai/_next/static/images/thumbnail-46d4defae2d9ca18441f88953f21f2d4.png"/></picture></div></div></div></div></div></div><p>Reliable <strong>model evaluation</strong> lies at the heart of MLops and LLMops, guiding crucial decisions like which model or prompt to deploy (and whether to deploy at all).  In this article, we prompt the FLAN-T5 LLM from <a rel="noopener" href="https://ai.googleblog.com/2021/10/introducing-flan-more-generalizable.html">Google Research</a> with various prompts in an effort to classify text as polite or impolite. Amongst the prompt candidates, we find the prompts that appear to perform best based on observed test accuracy are often <em>actually</em> <em>worse</em> than other prompt candidates. A closer review of the test data reveals this is due to unreliable annotations. <strong>In real-world applications, you may choose suboptimal prompts for your LLM (or make other suboptimal choices guided by model evaluation) unless you clean your test data to ensure it is reliable.</strong></p><p>While the harms of noisy annotations are well-characterized in training data, this article demonstrates their often-overlooked consequences in test data.</p><p>This article studies a binary classification variant of the <a rel="noopener" href="https://convokit.cornell.edu/documentation/wiki_politeness.html">Stanford Politeness Dataset</a>, which has text phrases labeled as <em>polite</em> or <em>impolite</em>. We evaluate models using a fixed test dataset containing 700 phrases. Here we consider two possible test sets constructed out of the same set of text examples which only differ in some (~30%) of the labels.  Representing typical data you’d use to evaluate accuracy, one version has labels sourced from a single annotation (human rater) per example, and we report the accuracy of model predictions computed on this version as <em>Observed Test Accuracy</em>.  A second <em>cleaner</em> version of this same test set has high-quality labels established via consensus amongst many agreeing annotations per example (derived from multiple human raters).  We report accuracy measured on the cleaner version as <em>Clean Test Accuracy</em>. Thus, <em>Clean Test Accuracy</em> more closely reflects what you care about (actual model deployment performance), but the <em>Observed Test Accuracy</em> is all you get to observe in most applications — unless you first clean your test data!</p><p>You can download the data <a rel="noopener" href="https://s.cleanlab.ai/stanford-politeness-prompt-selection.csv">here</a>.</p><p>Below are two test examples where the single human annotator mislabeled the example, but the group of many human annotators agreed on the correct label.</p><p>In real-world projects, you often don’t have access to such “clean” labels, so you can only measure Observed Test Accuracy. If you are making critical decisions such as which LLM or prompt to use based on this metric, be sure to first verify the labels are high-quality (via software like <a href="https://cleanlab.ai/">cleanlab</a>). Otherwise, we find you may make the wrong decisions, as observed below when selecting prompts for politeness classification.</p><p>As a predictive model to classify the politeness of text, it is natural to employ a pretrained Large Language Model (LLM). Here, we specifically use data scientists’ favorite LLM — the open-source FLAN-T5 model. To get this LLM to accurately predict the politeness of text, we must feed it just the right prompts. Prompt engineering can be very sensitive with small changes greatly affecting accuracy!</p><p>Prompts A and B shown below (highlighted text) are two different examples of <em>chain-of-thought</em> prompts, that can be appended in front of any <strong>text sample</strong> in order to get the LLM to classify its politeness. These prompts combine <em>few-shot</em> and <em>instruction</em> prompts (details later) that provide examples, the correct response, and a justification that encourages the LLM to explain its reasoning. The only difference between these two prompts is the highlighted text that is actually eliciting a response from the LLM. The few-shot examples and reasoning remain the same.</p><p>The natural way to decide which prompt is better is based on their <em>Observed Test Accuracy.</em> When used to prompt the FLAN-T5 LLM, we see below that the classifications produced by Prompt A have higher <em>Observed Test Accuracy</em> on the original test set than those from Prompt B. So obviously we should deploy our LLM with Prompt A, <em>right</em>? Not so fast!</p><p>When we assess the <em>Clean Test Accuracy</em> of each prompt, we find that Prompt B is actually <strong>much better</strong> than Prompt A (by 4.5 percentage points). Since <em>Clean Test Accuracy</em> more closely reflects the true performance we actually care about, we would’ve made the wrong decision if just relying on the original test data without examining its label quality!</p><p><a rel="noopener" href="https://en.wikipedia.org/wiki/McNemar%27s_test">McNemar’s test</a> is a recommended way to assess the statistical significance of reported differences in ML accuracy. When we apply this test to assess the 4.5% difference in <em>Clean Test Accuracy</em> between Prompt A vs. B over our 700 text examples, the difference is highly statistically significant (p-value = 0.007, <em>X²</em> = 7.086).  Thus all evidence suggests Prompt B is a meaningfully better choice, we should not have failed to select it by carefully auditing our original test data!</p><hr/><p>Let’s look at other types of prompts as well to see if the results were just coincidental for our pair of chain-of-thought prompts.</p><h2 id="instruction-prompts">Instruction Prompts</h2><p>This type of prompt simply provides an <em>instruction</em> to the LLM on what it needs to do with the text example given. Consider the following pair of such prompts we might want to choose between.</p><h2 id="few-shot-prompts">Few-Shot Prompts</h2><p>This type of prompt uses two instructions<em>,</em> a <em>prefix,</em> and a <em>suffix,</em> and also includes two (pre-selected) examples from the text corpus to provide clear demonstrations to the LLM of the desired input-output mapping. Consider the following pair of such prompts we might want to choose between.</p><h2 id="templatized-prompts">Templatized Prompts</h2><p>This type of prompt uses two instructions<em>,</em> an optional <em>prefix,</em> and a <em>suffix</em> in addition to multiple-choice formatting so that the model performs classification as a multiple-choice answer rather than responding directly with a predicted class. Consider the following pair of such prompts we might want to choose between.</p><h2 id="results-for-various-types-of-prompts">Results for various types of prompts</h2><p>Beyond chain-of-thought, we also evaluated the classification performance of the same FLAN-T5 LLM with these three additional types of prompts. Plotting the <em>Observed Test Accuracy</em> vs. <em>Clean Test Accuracy</em> achieved with all of these prompts below, we see many pairs of prompts that suffer from the same aforementioned problem, where relying on <em>Observed Test Accuracy</em> leads to selecting the prompt that is actually worse.  </p><p>Based on solely the <em>Observed Test Accuracy</em>, you would be inclined to select each of the “A” prompts over the “B” prompts amongst each type of prompt. However, the better prompt for each of the prompt types is actually prompt B (which has higher <em>Clean Test Accuracy</em>). </p><p><strong>Each of these prompt pairs highlights the need to verify test data quality, otherwise, you can make suboptimal decisions due to data issues like noisy annotations.</strong></p><p>Hopefully the importance of high-quality evaluation data is clear.  Let’s look at one way to algorithmically assess your available (possibly noisy) test set, in order to diagnose issues that can be fixed to obtain a more reliable version of the same dataset (without having to collect many additional human annotations). Here we use <a href="https://cleanlab.ai/studio/?utm_source=internal&amp;utm_medium=blog&amp;utm_campaign=clostostudio">Cleanlab Studio</a>, a no-code AI solution to assess data quality, to check our test data and automatically estimate which examples appear to be mislabeled. We then inspect only these auto-detected label issues and fix their labels via Cleanlab Studio’s interface as needed to produce a higher-quality version of our test dataset. We call model accuracy measurements made over this version of the test dataset, the <em>Cleanlab Test Accuracy.</em></p><p>Using this new Cleanlab-corrected test set for model evaluation, we see that all of the B prompts from before now properly display higher accuracy than their A counterparts. This means we can trust our decisions made based on the Cleanlab-corrected test set to be more reliable than those made based on the noisy original test data.</p><p><strong>You don’t always need to spend the time/resources to curate a “perfect” evaluation set — using solutions like <a href="https://cleanlab.ai/?utm_source=internal&amp;utm_medium=blog&amp;utm_campaign=clostostudio">Cleanlab Studio</a> to diagnose and correct possible issues in your available test set can provide high quality data to ensure optimal prompt and model selections.</strong></p><ul><li>Easily ensure reliable test (and training) data with <a rel="noopener" href="https://cleanlab.ai/signup">Cleanlab Studio</a>!</li><li>Join our <a rel="noopener" href="https://cleanlab.ai/slack/">Community Slack</a> to discuss using AI to assess the quality of your data.</li><li>Follow us on <a rel="noopener" href="https://www.linkedin.com/company/cleanlab/">LinkedIn</a> or <a rel="noopener" href="https://twitter.com/CleanlabAI">Twitter</a> for updates on new data quality algorithms.</li></ul></main></main></div></div>
  </body>
</html>
