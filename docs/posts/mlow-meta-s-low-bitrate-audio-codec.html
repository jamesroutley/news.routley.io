<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://engineering.fb.com/2024/06/13/web/mlow-metas-low-bitrate-audio-codec/">Original</a>
    <h1>MLow: Meta&#39;s low bitrate audio codec</h1>
    
    <div id="readability-page-1" class="page"><div>

		<ul>
<li aria-level="1"><span>At Meta, we support real-time communication (RTC) for billions of people through our apps, including WhatsApp, Instagram, and Messenger. </span></li>
<li aria-level="1"><span>We are working to make RTC accessible by providing a high-quality experience for everyone – even those who might not have the fastest connections or the latest phones.</span></li>
<li aria-level="1"><span>As more and more people have relied on our products to make calls over the years, we’ve been working on new ways to ensure all calls have a solid audio quality.</span></li>
<li aria-level="1"><span>We’ve built the Meta Low Bitrate (MLow) codec: a new tool that improves audio quality especially for those on slow-speed connections.</span></li>
</ul>
<figure id="attachment_21370" aria-describedby="caption-attachment-21370"><img decoding="async" src="https://engineering.fb.com/wp-content/uploads/2024/06/Copy-of-Complexity-Properties-Triangle-1.png?w=663" alt="" width="350" height="295" srcset="https://engineering.fb.com/wp-content/uploads/2024/06/Copy-of-Complexity-Properties-Triangle-1.png 663w, https://engineering.fb.com/wp-content/uploads/2024/06/Copy-of-Complexity-Properties-Triangle-1.png?resize=96,81 96w, https://engineering.fb.com/wp-content/uploads/2024/06/Copy-of-Complexity-Properties-Triangle-1.png?resize=192,162 192w" sizes="(max-width: 992px) 100vw, 62vw"/><figcaption id="caption-attachment-21370">Figure 1: Increasing complexity or bitrate usually improves quality, but good codecs achieve higher quality while balancing the other two.</figcaption></figure>
<p><span>RTC products use many building blocks to deliver the full experience, and one of the critical components is audio/video codecs. These codecs help compress the captured audio/video data so it can be sent across the internet efficiently to the recipient, keeping the experience real time. For example, the size of raw audio captured for a typical call is 768 kbps (mono, sampling at 48kHz, bit depth 16), which modern codecs are able to compress down to 25-30 kbps. Often this compression comes at the cost of some quality (loss of information), but good codecs can strike a balance among the trio of quality, bitrate, and complexity by exploiting deep knowledge about the nature of the audio signal as well as by using psychoacoustics. </span></p>
<p><span>Building a good codec is quite challenging, and that is why we don’t see new codecs emerging very often. The last widely known, good open-source codec was Opus, released in 2012, which has become the codec of choice for the wide variety of applications on the internet. Meta has used Opus for all its RTC needs, and so far it has served us well – helping to deliver quality calls to billions of users across the globe. </span></p>
<p><iframe title="YouTube video player" src="https://www.youtube.com/embed/3ypsZUNRjI4?si=Jo_8nGuviRGzo-4f" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<h2><span>Our motivation for building a new codec</span></h2>
<p><span>Given the massive scale of RTC usage in Meta products, we get to see how a codec performs in a range of network scenarios and how it impacts the end user’s experience. In particular, we’ve observed that a significant chunk of calls have poor network connections throughout or for part of a call. Typically a bandwidth estimation module (BWE) detects the quality of the network, and as the network quality degrades, we need to lower the codec operating bitrate to avoid congesting the network and keep the audio flowing – impacting the trio balance referenced above. Complicating matters, conducting a video call despite poor network quality leaves little room for audio and pushes the audio bitrate further down. The lowest operating point for Opus is 6 kbps, at which it runs in NarrowBand mode (0 – 4kHz) and does not adequately capture all the sound frequencies produced by human voices—and so doesn’t sound as clear or natural. Here is an example of how Opus sounds at 6kbps and the corresponding reference file for comparison.</span></p>
<p><span>Raw reference signal: </span></p>

<p><span>Opus @ 6 kbps NarrowBand (NB): </span></p>

<p><span>Over the last two years, we have seen development of some new machine learning (ML)-based audio codecs that provide good quality audio at very low bitrates. In October of 2022, Meta released </span><a href="https://ai.meta.com/blog/ai-powered-audio-compression-technique/" target="_blank" rel="noopener"><span>Encodec</span></a><span>, which achieves amazingly crisp audio quality at very low bitrates. While these AI/ML-based codecs are able to achieve great quality at low bitrates, it often comes at the expense of heavy computational cost. Consequently, only the very high-end (expensive) mobile handsets are able to run these codecs reliably, while users running on lower-end devices continue to experience audio quality issues in low-bitrate conditions. So the net impact of these newer computationally expensive codecs is actually limited to a small portion of users.</span></p>
<p><span>A significant number of our users still use low-end devices. For example, more than 20 percent of our calls are made on ARMv7 devices, and 10’s of millions of daily calls on WhatsApp are on 10-year-old-plus devices. Given the readily available codec choices and our commitment to ensure that all users – regardless of what device they’re on – have a quality calling experience, we clearly need a codec with very low-compute requirements that still delivers high-quality audio at these lowest bitrates.</span></p>
<h2><span>The MLow codec</span></h2>
<p><span>We broke ground with our development of a new codec in late 2021. After nearly two years of active development and testing, we are proud to announce </span><b>M</b><span>eta </span><b>Low</b><span> Bitrate audio codec, aka MLow, which achieves two-times-better quality than Opus (POLQA MOS 1.89 vs 3.9 @ 6kbps WB). Even more importantly, we are able to achieve this great quality while keeping MLow’s computational complexity </span><b>10 percent lower</b><span> than that of Opus. </span></p>
<p><span>Figure 2 below shows a MOS (Mean Opinion Score) plot on a 1-5 scale and compares the POLQA scores between Opus and MLow at various bitrates. As the chart makes evident, MLow has a huge advantage over Opus at the lowest bitrates, where it saturates quality faster than Opus.</span></p>
<figure id="attachment_21287" aria-describedby="caption-attachment-21287"><img loading="lazy" decoding="async" src="https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png?w=916" alt="" width="500" height="464" srcset="https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png 1738w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png?resize=916,851 916w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png?resize=768,713 768w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png?resize=1024,951 1024w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png?resize=1536,1426 1536w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png?resize=96,89 96w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-2.png?resize=192,178 192w" sizes="(max-width: 992px) 100vw, 62vw"/><figcaption id="caption-attachment-21287">Figure 2: POLQA score comparing Opus (WB) versus MLow at various bitrates across a large dataset of files.</figcaption></figure>
<p><span>We have already fully launched MLow to all Instagram and Messenger calls and are actively rolling it out on WhatsApp—and we’ve already seen incredible improvement in user engagement driven by better audio quality.</span></p>
<p><span>Here are some audio samples for you to listen to. We suggest that you use your favorite pair of headphones to appreciate the striking audio-quality differences.</span></p>
<table>
<tbody>
<tr>
<td><span>Opus 6 kbps NB</span></td>
<td><span>MLow 6 kbps WB</span></td>
<td><span>Reference</span></td>
</tr>
<tr>
<td><audio src="https://engineering.fb.com/wp-content/uploads/2024/06/opus_6000_kbps_48k_m_sample2_trimmed.wav" controls="controls"></audio></td>
<td><audio src="https://engineering.fb.com/wp-content/uploads/2024/06/mlow_6000_kbps_48k_m_sample2_trimmed.wav" controls="controls"></audio></td>
<td><audio src="https://engineering.fb.com/wp-content/uploads/2024/06/48k_m_sample2_trimmed.wav" controls="controls"><span data-mce-type="bookmark">﻿</span></audio></td>
</tr>
<tr>
<td><audio src="https://engineering.fb.com/wp-content/uploads/2024/05/opus_6000_kbps_48k_f_sample3.wav" controls="controls"></audio></td>
<td><audio src="https://engineering.fb.com/wp-content/uploads/2024/06/mlow_6000_kbps_48k_f_sample3.wav" controls="controls"><span data-mce-type="bookmark">﻿</span></audio></td>
<td><audio src="https://engineering.fb.com/wp-content/uploads/2024/05/48k_f_sample3.wav" controls="controls"><span data-mce-type="bookmark">﻿</span></audio></td>
</tr>
</tbody>
</table>
<p><span>Being able to encode high-quality audio at lower bitrates also unlocks more effective Forward Error Correction (FEC) strategies. Compared with Opus, with MLow we can afford to pack FEC at much lower bitrates, which significantly helps to improve the audio quality in packet loss scenarios. </span></p>
<p><span>Here are two audio samples at 14 kbps with heavy 30 percent receiver-side packet loss.</span></p>
<p>Opus:</p>

<p><audio src="https://engineering.fb.com/wp-content/uploads/2024/05/mlow_eloss_10_dloss_30_14000_bps_48k_f_sample2.wav" controls="controls"><span data-mce-type="bookmark">﻿</span></audio></p>
<p><span>Note that at these bitrates, Opus is not able to encode any inband FEC. It needs a minimum of 19 kbps to encode any inband FEC at 10 percent packet loss, which hurts the audio recovery.</span></p>
<h2><span>MLow internals</span></h2>
<p><span>MLow builds on the concepts of a classic CELP (Code Excited Linear Prediction) codec with advancements around excitation generation, parameter quantization, and coding schemes. Figure 3 is a high-level visual of how the codec works internally. On the left we have an input signal (raw PCM audio) feeding into the encoder, which then splits the signal into two low and high-frequency bands. Then, each band is encoded separately while making use of shared information to achieve better compression. All the output is passed through a range encoder to further compress and generate an encoded payload. The decoder does the exact opposite when given the payload to generate output audio signals.</span></p>
<figure id="attachment_21288" aria-describedby="caption-attachment-21288"><img loading="lazy" decoding="async" src="https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-3.png?w=1024" alt="" width="1024" height="242" srcset="https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-3.png 1484w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-3.png?resize=916,217 916w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-3.png?resize=768,182 768w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-3.png?resize=1024,242 1024w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-3.png?resize=96,23 96w, https://engineering.fb.com/wp-content/uploads/2024/05/MLow-image-3.png?resize=192,45 192w" sizes="(max-width: 992px) 100vw, 62vw"/><figcaption id="caption-attachment-21288">Figure 3: High level MLow encoder and decoder architecture.</figcaption></figure>
<p><span>With these split-band optimizations, we are able to encode the high band using very few bits, which lets MLow deliver SuperWideBand (32kHz sampling) using a much lower bitrate.</span></p>
<h2><span>What’s next?</span></h2>
<p><span>MLow has greatly enhanced audio quality on low-end devices while still ensuring calls are end-to-end encrypted. We are really excited about what we have accomplished in just the last two years—from developing a new codec to successfully shipping it to billions of users around the globe. We’re continuing to work on improving the audio recovery in heavy packet loss networks by pumping out more redundant audio, which MLow allows us to do efficiently. We’re excited to share more as we continue working to make it easier for all our users to make quality audio calls. </span></p>

		
	</div></div>
  </body>
</html>
