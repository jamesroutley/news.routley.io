<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/lukemerrick/InvestorsExchange.jl">Original</a>
    <h1>Show HN: Investorsexchange.jl â€“ parse trade-level stock market data in Julia</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Downloads <a href="https://iextrading.com/trading/market-data/#hist" rel="nofollow">tick-by-tick historical trade data from the Investors Exchange (IEX)</a>. Specifically, this tool downloads the archived data feed files which IEX uploads daily on a T+1 basis, and supports parsing these files into tabular format.</p>
<p dir="auto">Inspired by <a href="https://github.com/vfrazao-ns1/IEXTools/">this Python implementation</a>.</p>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Features</h2>
<h3 dir="auto"><a id="user-content-general-features" aria-hidden="true" href="#general-features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>General Features</h3>
<ul dir="auto">
<li>Extract trade data to DataFrames files using <a href="https://github.com/JuliaData/DataFrames.jl">DataFrames.jl</a></li>
<li>Download progress bar using <a href="https://github.com/timholy/ProgressMeter.jl/">ProgressMeter.jl</a></li>
</ul>
<h3 dir="auto"><a id="user-content-tops-feed" aria-hidden="true" href="#tops-feed"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>TOPS Feed</h3>
<ul dir="auto">
<li>TradeReportMessage message type only</li>
<li>Tested only on version 1.6</li>
</ul>
<h3 dir="auto"><a id="user-content-deep-feed" aria-hidden="true" href="#deep-feed"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>DEEP Feed</h3>
<ul dir="auto">
<li>TradeReportMessage message type only</li>
<li>Untested</li>
</ul>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<p dir="auto">The package is still in early shape, but I&#39;ve included the trade download script this package is built to power to show a usage example. You can run this script like this:</p>
<div data-snippet-clipboard-copy-content="julia --threads &lt;number of CPU cores on your machine&gt; trade_download_script.jl /path/to/save_dir"><pre>julia --threads <span>&lt;</span>number of CPU cores on your machine<span>&gt;</span> trade_download_script.jl /path/to/save_dir</pre></div>
<p dir="auto">If you don&#39;t care about taking advantage of multi-threading or specifying a custom save directory (the default is <code>./trade_data</code>), you can just run <code>julia trade_download_script.jl</code>.</p>
<h3 dir="auto"><a id="user-content-download-script-details" aria-hidden="true" href="#download-script-details"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Download script details</h3>
<p dir="auto">In the download script, I avoid downloading more than a handful of raw PCAP data files to disk by running downloads <a href="https://docs.julialang.org/en/v1/manual/asynchronous-programming/" rel="nofollow">asynchronously</a> with downloaded filenames piped into a limited-sized <a href="https://docs.julialang.org/en/v1/base/parallel/#Base.Channel" rel="nofollow">Channel</a>. As downloads complete, the file paths are consumed by <a href="https://docs.julialang.org/en/v1/manual/multi-threading/" rel="nofollow">multi-threaded</a> parsing code that reads the <code>TradeReportMessage</code> messages, organizes them into a Julia <code>DataTable</code>, and writes them to disk in parquet format. To take advantage of this parallelization and speed up the parsing of literally every TOPS feed message that IEX has issued since mid 2017, it is recommended you include the <code>--threads</code> flag.</p>
<h3 dir="auto"><a id="user-content-a-note-on-tops-vs-deep" aria-hidden="true" href="#a-note-on-tops-vs-deep"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>A note on TOPS vs. DEEP</h3>
<p dir="auto">As of v0.1.1, this package only parses the trade report messages in any feed it reads. If you want to read from the DEEP feed or the TOPS v1.5 feed, you&#39;ll need to overwrite the default value of the <code>protocol_magic_bytes</code> argument in the <code>read_trade_report_messages</code> function.</p>
<p dir="auto"><strong>Example</strong></p>
<div data-snippet-clipboard-copy-content="import InvestorsExchange as IEX

IEX.read_trade_report_messages(&#34;/tmp/20210420_IEXTP1_DEEP1.0.pcap.gz&#34;; protocol_magic_bytes=IEX.DEEP_PROTOCOL_ID_1_0)"><pre><span>import</span> InvestorsExchange <span>as</span> IEX

IEX<span>.</span><span>read_trade_report_messages</span>(<span><span>&#34;</span>/tmp/20210420_IEXTP1_DEEP1.0.pcap.gz<span>&#34;</span></span>; protocol_magic_bytes<span>=</span>IEX<span>.</span>DEEP_PROTOCOL_ID_1_0)</pre></div>
<p dir="auto">However, since TOPS and DEEP both contain the trade report messages, there is little reason to use DEEP (which tends to be bigger) to parse the trade report messages. You should expect faster download and parse speeds with TOPS, and thus it&#39;s recommended to stick with TOPS.</p>
</article>
          </div></div>
  </body>
</html>
