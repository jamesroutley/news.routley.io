<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://smalldatum.blogspot.com/2023/04/gc-for-mvcc-myrocks-innodb-and-postgres.html">Original</a>
    <h1>Garbage Collection for MVCC â€“ MyRocks, InnoDB and Postgres</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-5004187351283964029" itemprop="description articleBody">
<p>MVCC GC is hard -- see the amount of content devoted to Postgres vacuum. Perhaps Oracle does it best. A long-open snapshot can bring about the worst-case behavior for MVCC GC as Postgres vacuum and InnoDB purge cannot touch rows that are reclaimable when said rows have a commit time more recent than the oldest open snapshot. And by reclaimable here I mean to make the space used by that row or index entry available for reuse.</p><ul><li>versions for a row were created at timestamp 1, 2, 3, ..., 9, 10</li><li>current timestamp is 11</li><li>long-open snapshot created at timestamp 5<br/></li><li>In theory, only the versions at timestamps 5 and 10 are needed. At timestamp 5 for the long-open snapshot and at timestamp 10 for current reads.</li><li>Purge/vacuum can reclaim versions for timestamps 1 to 4 but not for timestamps 6 to 9 because they are blocked by the long-open snapshot<br/></li><li>MyRocks compaction can reclaim versions for timestamps 1 to 4 and 6 to 9</li></ul><p><b>The catch</b></p></div></div>
  </body>
</html>
