<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.blockloop.io/smoking-a-turkey-with-prometheus-home-assistant-and-grafana/">Original</a>
    
    <div id="readability-page-1" class="page"><div ?="">
    <p>For the past several years I have smoked a turkey for Thanksgiving and every year my wife incessantly asks me the same question: “when will the turkey be ready?” Despite her importunate requests, my answer is always the same: “I don’t know.” This year I have been working to get myself closer to an estimate.</p>

<p>A few years ago I purchased a <a href="https://bbqguru.com/">BBQ Guru</a>. Even though I could rely on my methods to take my cooks through the night I couldn’t shake the uneasy feeling that things could go wrong in the middle of the night so my nights were still restless. BBQ Guru measures internal temperature of the grill and blows air onto the fire when necessary to <a href="https://bbqguru.com/ProductInfo/HowTheyWork">maintain the ambient temperature</a>. Unfortunately, I did not opt for the WiFi enabled Guru so I kept my <a href="https://www.amazon.com/ThermoPro-Wireless-Digital-Cooking-Thermometer/dp/B01GE77QT0/">TP20</a>. This gave me alarms and a remote with the TP20, and ambient temperature control with the Guru. However, I still couldn’t answer my wife’s question.</p>

<p>I run an elaborate, private IoT system at home using <a href="https://www.home-assistant.io/">Home Assistant</a> (I have over 50 devices, 30 automations). I decided to look up the frequencies used by the TP20 and I discovered that it was using the 433.92 MHz <a href="https://en.wikipedia.org/wiki/ISM_radio_band">ISM band</a>. After some digging I found this <a href="https://www.rtl-sdr.com/buy-rtl-sdr-dvb-t-dongles/">USB dongle</a> and this <a href="https://github.com/merbanan/rtl_433">GitHub repository</a>. As it turns out, you can capture and decode the RF signals broadcast by the TP20 pretty easily (thanks to <a href="https://github.com/merbanan">merbanan</a>).</p>

<p>I hooked up the dongle to a Raspberry Pi that I had laying around and within a few minutes I had captured and printed temperatures to the command line. That repository also contains <a href="https://github.com/merbanan/rtl_433/blob/20aa54843c8f528f9b06627456976b31c9a05084/examples/rtl_433_mqtt_hass.py">python scripts</a> to relay the data to an MQTT server, to be picked up by Home Assistant. One systemd unit file later, the data showed up in Home Assistant. Home Assistant has <a href="https://www.home-assistant.io/integrations/prometheus/">Prometheus integration</a> built in, so to export the sensors I only needed a simple change to my configuration.yaml.</p>

<p><img src="https://blockloop.keybase.pub/blog_images/prometheus_bbq/hass.png" alt="devices"/></p>

<p>For now my dashboard is pretty simple (screenshots below). It has the current temperatures (grill and meat) and a linear predicted temperature (that is, it predicts what the temperature will be 1h from now, given the past 30 minutes of data). Now, when my wife asks me when the turkey will be done I can give a more accurate estimate using the same software I use to alert me when <a href="https://www.robustperception.io/reduce-noise-from-disk-space-alerts">disks are running low on space</a>.</p>

<p><img src="https://blockloop.keybase.pub/blog_images/prometheus_bbq/grafana.png" alt="grafana"/></p>

<p>All in all this cost me about $25 for the USB Dongle and roughly 30 minutes of time (not including shipping). MQTT, Home Assistant, Prometheus, and Grafana are already part of my Home Lab. I have owned the TP20 and BBQ Guru for some years now. Eventually I may replace everything with a <a href="https://store.heatermeter.com/">HeaterMeter</a>, but for now everything works with minimal effort.</p>

<p>Happy Thanksgiving!</p>

<p><img src="https://blockloop.keybase.pub/blog_images/prometheus_bbq/devices.jpg" alt="devices"/></p>

<p><img src="https://blockloop.keybase.pub/blog_images/prometheus_bbq/grill.jpg" alt="devices"/></p>

  </div></div>
  </body>
</html>
