<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://devblogs.microsoft.com/oldnewthing/20220608-00/?p=106727">Original</a>
    <h1>Is there a maximum size for Windows clipboard data?</h1>
    
    <div id="readability-page-1" class="page"><div id="featured">

	<div>
                         <p>
            June 8th, 2022</p><!-- .entry-meta -->
        
<p>A customer had a program that opened a very large spreadsheet in Excel. Very large, like over 300,000 rows. They then selected all of the rows in the very large spreadsheet, copied those rows to the clipboard, and then ran a program that tried to extract the data. The program used the <code>Get­Clipboard­Data</code> function to retrieve the data in Rich Text Format. What they found was that the call to <code>Get­Clipboard­Data</code> was returning <code>NULL</code>. Is there a maximum size for clipboard data?</p>
<p>No, there is no pre-set maximum size for clipboard data. You are limited only by available memory and address space.</p>
<p>However, that’s not the reason why the call to <code>Get­Clipboard­Data</code> is failing.</p>
<p>There are two ways to make clipboard data available. One is to put the data directly on the clipboard at the time you <a title="How ownership of the Windows clipboard is tracked in Win32" href="https://devblogs.microsoft.com/oldnewthing/20210526-00/?p=105252"> take ownership of it</a>. Another option is to declare that you have data of a particular type, but instead of putting the data on the clipboard, you say, “If anybody asks, let me know, and I’ll produce the data.” This is known as clipboard delay-rendering, and it is a common optimization for data formats that are rarely used or expensive to produce. If somebody asks for the format, the clipboard owner gets a <code>WM_<wbr/>RENDER­FORMAT</code> message to say, “Somebody wants that data, can you produce it now?”</p>
<p>Excel does not operate natively in Rich Text Format. The Rich Text Format data that it places on the clipboard is delay-rendered. And then when another program asks for the Rich Text Format data, Excel says, “Oh yeah, just hang on a second, let me go get that for you.” Mind you, Rich Text Format is not the best format for a data table. As its name suggests, Rich Text Format is designed for text. It can represent basic tables, but that’s not its bread and butter.</p>
<p>When the system asks a clipboard owner to render clipboard data, it sends the <code>WM_<wbr/>RENDER­FORMAT</code> message and waits up to 30 seconds for it to return. If the clipboard owner fails to produce the data within 30 seconds, then system abandons the request, and <code>Get­Clipboard­Data</code> returns <code>NULL</code>.</p>
<p>What’s happening is that this table is so large that it’s taking Excel longer than 30 seconds to produce the Rich Text Format table. The <code>Get­Clipboard­Data</code> function times out and returns <code>NULL</code>.</p>
<p>Next time, we’ll see what we can do to extend this timeout.</p>

        

		
        
	</div><!-- .entry-content -->

</div></div>
  </body>
</html>
