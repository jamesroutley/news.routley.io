<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/si14/stuffed-naan-js">Original</a>
    <h1>Stuffed-Na(a)N: stuff your NaNs</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6581c31c16c1b13ddc2efb92e2ad69a93ddc4a92fd871ff15d401c4c6c9155a4/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d626c75652e737667"><img src="https://camo.githubusercontent.com/6581c31c16c1b13ddc2efb92e2ad69a93ddc4a92fd871ff15d401c4c6c9155a4/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6c6963656e73652d4d49542d626c75652e737667" alt="license: MIT/" data-canonical-src="https://img.shields.io/badge/license-MIT-blue.svg"/></a> <a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/a20de918fe20b9c3bb4353762de57f4d93b90bf0b092c7b8c32eae48d10e3b9a/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f737475666665642d6e61616e"><img src="https://camo.githubusercontent.com/a20de918fe20b9c3bb4353762de57f4d93b90bf0b092c7b8c32eae48d10e3b9a/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f737475666665642d6e61616e" alt="NPM Version" data-canonical-src="https://img.shields.io/npm/v/stuffed-naan"/></a></p>

<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/si14/stuffed-naan-js/blob/main/naan.jpg"><img src="https://github.com/si14/stuffed-naan-js/raw/main/naan.jpg" alt="A photo of a garlic naan"/></a></p>
<p dir="auto"><em><a href="https://commons.wikimedia.org/wiki/File:Garlic_naan_1.jpg" rel="nofollow">Joy via Wikimedia</a></em></p>
<p dir="auto">Have you ever done this by mistake?</p>
<div dir="auto" data-snippet-clipboard-copy-content="console.log(0 / 0)
// Output: NaN"><pre><span>console</span><span>.</span><span>log</span><span>(</span><span>0</span> <span>/</span> <span>0</span><span>)</span>
<span>// Output: NaN</span></pre></div>
<p dir="auto">Or maybe this?</p>
<div dir="auto" data-snippet-clipboard-copy-content="console.log(Math.asin(2))
// Output: NaN"><pre><span>console</span><span>.</span><span>log</span><span>(</span><span>Math</span><span>.</span><span>asin</span><span>(</span><span>2</span><span>)</span><span>)</span>
<span>// Output: NaN</span></pre></div>
<p dir="auto">Have you been annoyed by <code>NaN</code> propagation?</p>
<div dir="auto" data-snippet-clipboard-copy-content="const a = NaN
console.log((a * 2) - 5)
// Output: NaN"><pre><span>const</span> <span>a</span> <span>=</span> <span>NaN</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>(</span><span>a</span> <span>*</span> <span>2</span><span>)</span> <span>-</span> <span>5</span><span>)</span>
<span>// Output: NaN</span></pre></div>
<p dir="auto">With <code>stuffed-naan</code>, you can finally make use of <code>NaN</code>s. Just stuff <del><code>NaN</code></del> <code>Na(a)N</code>s with your data!</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { encode, decode } from &#39;stuffed-naan&#39;;

const encoded = encode(&#34;Hello world&#34;);
console.log(encoded);
// Output: [NaN, NaN, NaN]

console.log(decode(encoded));
// Output: Hello world"><pre><span>import</span> <span>{</span> <span>encode</span><span>,</span> <span>decode</span> <span>}</span> <span>from</span> <span>&#39;stuffed-naan&#39;</span><span>;</span>

<span>const</span> <span>encoded</span> <span>=</span> <span>encode</span><span>(</span><span>&#34;Hello world&#34;</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>encoded</span><span>)</span><span>;</span>
<span>// Output: [NaN, NaN, NaN]</span>

<span>console</span><span>.</span><span>log</span><span>(</span><span>decode</span><span>(</span><span>encoded</span><span>)</span><span>)</span><span>;</span>
<span>// Output: Hello world</span></pre></div>
<p dir="auto">To quote Sun Tzu, &#34;If you can&#39;t beat the enemy, use the enemy&#39;s advantage to your advantage&#34;.
<code>Na(a)N</code>s preserve data even when used in mathematical operations:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { encode, decode } from &#39;stuffed-naan&#39;;

const encoded = encode(&#34;Hello world&#34;);
console.log(decode(encoded.map(x =&gt; x * 2)));
// Output: Hello world"><pre><span>import</span> <span>{</span> <span>encode</span><span>,</span> <span>decode</span> <span>}</span> <span>from</span> <span>&#39;stuffed-naan&#39;</span><span>;</span>

<span>const</span> <span>encoded</span> <span>=</span> <span>encode</span><span>(</span><span>&#34;Hello world&#34;</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>decode</span><span>(</span><span>encoded</span><span>.</span><span>map</span><span>(</span><span>x</span> <span>=&gt;</span> <span>x</span> <span>*</span> <span>2</span><span>)</span><span>)</span><span>)</span><span>;</span>
<span>// Output: Hello world</span></pre></div>


<p dir="auto"><code>stuffed-naan</code> is compact. Community Edition achieves a compression ratio of -25%.
That means, for every 1024 bytes of data, you get 1368 bytes of float64 <code>Na(a)N</code>s back!
This is an industry-beating level of <code>Na(a)N</code> compression. For even better compression, consider the
<a href="https://github.com/si14/stuffed-naan-js?tab=readme-ov-file#enterprise-edition-">Enterprise Edition</a>.</p>

<p dir="auto"><code>stuffed-naan</code> is blazing fast. Thanks to advanced byte-manipulation capabilities available in ECMAScript® 2026,
the overhead of stuffing is minimal. <code>Na(a)N</code>ification of a thousand small objects takes 1–3ms.</p>

<p dir="auto"><code>stuffed-naan</code> is privacy-first. It&#39;s a first-of-its-kind privacy-preserving encoding, since an array of <code>Na(a)N</code>s
can&#39;t be copypasted without losing the information. This makes <code>stuffed-naan</code> indispensable to protect your
customers&#39; PII. Contact <a href="mailto:stuffed-naan-dpo@dgroshev.com"><code>stuffed-naan</code> DPO</a> to learn more.</p>


<p dir="auto">Or you can do this in your browser console:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const stuffedNaan = await import(&#39;https://unpkg.com/stuffed-naan&#39;);
stuffedNaan.encode(&#34;hello world&#34;);"><pre><span>const</span> <span>stuffedNaan</span> <span>=</span> <span>await</span> <span>import</span><span>(</span><span>&#39;https://unpkg.com/stuffed-naan&#39;</span><span>)</span><span>;</span>
<span>stuffedNaan</span><span>.</span><span>encode</span><span>(</span><span>&#34;hello world&#34;</span><span>)</span><span>;</span></pre></div>

<p dir="auto">Enterprise Edition includes:</p>
<ul dir="auto">
<li>✅ 6% more efficient encoding</li>
<li>✅ Support for big-endian processors, such as IBM zSeries</li>
<li>✅ A dedicated Customer Success Manager</li>
</ul>
<p dir="auto"><a href="mailto:stuffed-naan-sales@dgroshev.com">Contact sales</a> for pricing.</p>

<ul dir="auto">
<li><g-emoji alias="warning">⚠️</g-emoji> Public benchmark history</li>
<li><g-emoji alias="warning">⚠️</g-emoji> Fuzzing</li>
<li><g-emoji alias="warning">⚠️</g-emoji> Rewrite in Rust</li>
<li><g-emoji alias="warning">⚠️</g-emoji> Formal verification with Kani</li>
</ul>

<blockquote>
<p dir="auto">Seems really weird to me. I would have dismissed it as someone&#39;s hobby project, but...
that doesn&#39;t seem like what it&#39;s trying to be.</p>
</blockquote>
<blockquote>
<p dir="auto">The applications might be real :D</p>
</blockquote>
<blockquote>
<p dir="auto">I made a garlic nan: <a href="https://www.godbolt.org/z/enjv1c7Tf" rel="nofollow">https://www.godbolt.org/z/enjv1c7Tf</a> (<a href="https://news.ycombinator.com/item?id=43804628" rel="nofollow">author</a>)</p>
</blockquote>

<p dir="auto">JS numbers are IEEE 754 floating point numbers, 64-bit long. They consist of a sign bit, an exponent, and a mantissa.</p>
<p dir="auto">Here&#39;s how it all looks like in memory:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/d606a4984bc48fe9743e2aef5ca87c62978c601a379e23e89217e492961e5d1c/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f7468756d622f612f61392f494545455f3735345f446f75626c655f466c6f6174696e675f506f696e745f466f726d61742e7376672f3130323470782d494545455f3735345f446f75626c655f466c6f6174696e675f506f696e745f466f726d61742e7376672e706e67"><img src="https://camo.githubusercontent.com/d606a4984bc48fe9743e2aef5ca87c62978c601a379e23e89217e492961e5d1c/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f7468756d622f612f61392f494545455f3735345f446f75626c655f466c6f6174696e675f506f696e745f466f726d61742e7376672f3130323470782d494545455f3735345f446f75626c655f466c6f6174696e675f506f696e745f466f726d61742e7376672e706e67" alt="Memory layout of a float64 from Wikipedia" data-canonical-src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/IEEE_754_Double_Floating_Point_Format.svg/1024px-IEEE_754_Double_Floating_Point_Format.svg.png"/></a></p>
<p dir="auto">When mathematical operations on floats are applied incorrectly (for example, <code>0/0</code>), the result is a special value
called Not a Number, or NaN for short. NaNs are represented as floating point numbers with the exponent set to all 1s
and at least one non-zero bit in the fraction part.</p>
<p dir="auto">Which means I can commit crimes and smuggle data in the fraction part. IEEE is <em>not</em> going to stop me!</p>
<p dir="auto">This trick is silly, but it works. Naturally, I couldn&#39;t resist overdoing the naan pun.</p>
<p dir="auto">Support your local curry house! (Or, better yet, <a href="https://savelife.in.ua/en/" rel="nofollow">Come Back Alive</a>)</p>
<p dir="auto"><a href="https://bsky.app/profile/dangroshev.com" rel="nofollow">Bluesky</a> / <a href="https://x.com/dangroshev" rel="nofollow">Twitter</a> / <a href="https://dgroshev.com" rel="nofollow">Web</a></p>
</article></div></div>
  </body>
</html>
