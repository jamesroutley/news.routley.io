<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/gokrazy/gokrazy">Original</a>
    <h1>A native Go userland for your Raspberry Pi 3 or 4 appliances</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text"><p dir="auto"><a href="https://travis-ci.org/gokrazy/gokrazy" rel="nofollow"><img src="https://camo.githubusercontent.com/efd33d10f19aca102a2058d86584d592903b569ec7794624cfc1c53a9ff9d309/68747470733a2f2f7472617669732d63692e6f72672f676f6b72617a792f676f6b72617a792e7376673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/gokrazy/gokrazy.svg?branch=master"/></a>
<a href="https://goreportcard.com/report/github.com/gokrazy/gokrazy" rel="nofollow"><img src="https://camo.githubusercontent.com/c3c483230ba6c33428f3e94d9de4b355bf9a5d991e3516fdedf5011a00e236a5/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f676f6b72617a792f676f6b72617a79" alt="Go Report Card" data-canonical-src="https://goreportcard.com/badge/github.com/gokrazy/gokrazy"/></a></p>

<p dir="auto">gokrazy packs your Go application(s) into an SD card image for the Raspberry Pi
3 or 4 which — aside from the Linux kernel and proprietary Raspberry Pi
bootloader — only contains Go software.</p>
<p dir="auto">The motivation is that <a href="https://github.com/stapelberg">@stapelberg</a>
spends way more time on C software and their various issues than he
would like. Hence, he is going Go-only where feasible.</p>

<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<p dir="auto"><a href="https://golang.org/dl/" rel="nofollow">Install the latest Go version</a> if you haven’t already.</p>
<p dir="auto">Create a directory for this gokrazy instance and initialize a Go module:</p>
<div data-snippet-clipboard-copy-content="INSTANCE=gokrazy/hello
mkdir -p ~/${INSTANCE?}
cd ~/${INSTANCE?}
go mod init hello"><pre><code>INSTANCE=gokrazy/hello
mkdir -p ~/${INSTANCE?}
cd ~/${INSTANCE?}
go mod init hello
</code></pre></div>
<p dir="auto">Then, install <code>gokr-packer</code>:</p>
<div data-snippet-clipboard-copy-content="go get github.com/gokrazy/tools/cmd/gokr-packer@latest"><pre><code>go get github.com/gokrazy/tools/cmd/gokr-packer@latest
</code></pre></div>
<h2 dir="auto"><a id="user-content-overwriting-an-sd-card-for-the-raspberry-pi-3-or-4" aria-hidden="true" href="#overwriting-an-sd-card-for-the-raspberry-pi-3-or-4"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Overwriting an SD card for the Raspberry Pi 3 or 4</h2>
<p dir="auto">To re-partition and overwrite the SD card <code>/dev/sdx</code>, use:</p>
<div data-snippet-clipboard-copy-content="gokr-packer -overwrite=/dev/sdx github.com/gokrazy/hello"><pre><code>gokr-packer -overwrite=/dev/sdx github.com/gokrazy/hello
</code></pre></div>
<p dir="auto">Then, put the SD card into your Raspberry Pi 3 or 4 and power it up! Once the
Raspberry Pi 3 or 4 has booted (takes about 10 seconds), you should be able to
reach the gokrazy web interface at the URL which <code>gokr-packer</code> printed.</p>
<p dir="auto">Under the hood, <code>gokr-packer</code>…</p>
<ol dir="auto">
<li>
<p dir="auto">…packed the latest <a href="https://github.com/gokrazy/firmware">firmware</a>
and <a href="https://github.com/gokrazy/kernel">kernel</a> binaries into the
boot file system.</p>
</li>
<li>
<p dir="auto">…built the specified Go packages using <code>go install</code> and packed all
their binaries into the <code>/user</code> directory of the root file system.</p>
</li>
<li>
<p dir="auto">…created a minimal gokrazy init program which supervises all
binaries (i.e. restarts them when they exit).</p>
</li>
</ol>
<h2 dir="auto"><a id="user-content-updating-your-installation" aria-hidden="true" href="#updating-your-installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Updating your installation</h2>
<p dir="auto">To update gokrazy, including the firmware and kernel binaries, use:</p>
<div data-snippet-clipboard-copy-content="go get -u github.com/gokrazy/tools/cmd/gokr-packer
go get -u github.com/gokrazy/gokrazy
go get -u github.com/gokrazy/kernel
go get -u github.com/gokrazy/firmware
go get -u github.com/gokrazy/rpi-eeprom"><pre><code>go get -u github.com/gokrazy/tools/cmd/gokr-packer
go get -u github.com/gokrazy/gokrazy
go get -u github.com/gokrazy/kernel
go get -u github.com/gokrazy/firmware
go get -u github.com/gokrazy/rpi-eeprom
</code></pre></div>
<p dir="auto">To update your gokrazy installation (running on a Raspberry Pi 3 or 4),
use:</p>
<div data-snippet-clipboard-copy-content="GOKRAZY_UPDATE=http://gokrazy:mysecretpassword@gokrazy/ gokr-packer github.com/gokrazy/hello"><pre><code>GOKRAZY_UPDATE=http://gokrazy:mysecretpassword@gokrazy/ gokr-packer github.com/gokrazy/hello
</code></pre></div>

<p dir="auto">gokrazy uses the following partition table:</p>
<table>
<thead>
<tr>
<th>num</th>
<th>size</th>
<th>purpose</th>
<th>file system</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>100 MB</td>
<td>boot (kernel+firmware)</td>
<td>FAT16B</td>
</tr>
<tr>
<td>2</td>
<td>500 MB</td>
<td>root2 (gokrazy+apps)</td>
<td>SquashFS</td>
</tr>
<tr>
<td>3</td>
<td>500 MB</td>
<td>root3 (gokrazy+apps)</td>
<td>SquashFS</td>
</tr>
<tr>
<td>4</td>
<td>rest</td>
<td>permanent data</td>
<td>ext4</td>
</tr>
</tbody>
</table>
<p dir="auto">The two root partitions are used alternatingly (to avoid modifying the
currently active file system) when updating.</p>
<p dir="auto">If you’d like to store permanent data (i.e. data which will not be
overwritten on the next update), you’ll need to create an ext4 file
system on the last partition. If your SD card is <code>/dev/sdx</code>, use
<code>mkfs.ext4 /dev/sdx4</code>. After you successfully created the new filesystem
on the forth partition, gokrazy will automatically mount the filesystem
under <code>/perm</code> during startup. Use this mount directory to store your permanent data.</p>

<h2 dir="auto"><a id="user-content-changing-program-behavior-for-gokrazy" aria-hidden="true" href="#changing-program-behavior-for-gokrazy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Changing program behavior for gokrazy</h2>
<p dir="auto"><code>gokr-packer</code> sets the “gokrazy” <a href="https://golang.org/pkg/go/build/#hdr-Build_Constraints" rel="nofollow">build
tag</a> for
conditional compilation.</p>
<p dir="auto">You can find an example commit which implements a gokrazy-specific
controller that triggers the main program logic every weekday at 10:00
at <a href="https://github.com/stapelberg/zkj-nas-tools/commit/6f90ace35981f78dcd66d611269f17f37ce4b4ef">https://github.com/stapelberg/zkj-nas-tools/commit/6f90ace35981f78dcd66d611269f17f37ce4b4ef</a></p>
<h2 dir="auto"><a id="user-content-changing-init-behavior" aria-hidden="true" href="#changing-init-behavior"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Changing init behavior</h2>
<p dir="auto">Assuming the application you’d like to create on gokrazy lives in the repository
<code>github.com/stapelberg/mediaserver</code>, this is how you can make gokrazy dump the
generated init package’s source:</p>
<div data-snippet-clipboard-copy-content="mkdir -p $(go env GOPATH)/src/github.com/stapelberg/mediaserver/cmd/init
gokr-packer \
  -overwrite_init=$(go env GOPATH)/src/github.com/stapelberg/mediaserver/cmd/init/init.go \
  github.com/gokrazy/hello"><pre><code>mkdir -p $(go env GOPATH)/src/github.com/stapelberg/mediaserver/cmd/init
gokr-packer \
  -overwrite_init=$(go env GOPATH)/src/github.com/stapelberg/mediaserver/cmd/init/init.go \
  github.com/gokrazy/hello
</code></pre></div>
<p dir="auto">(Note that the package must result in a binary called “init”.)</p>
<p dir="auto">Then, edit the <code>github.com/stapelberg/mediaserver</code> package to your
liking. When done, pack an image with your own init package:</p>
<div data-snippet-clipboard-copy-content="gokr-packer \
  -init_pkg=github.com/stapelberg/mediaserver/cmd/init \
  -overwrite=/dev/sdx \
  github.com/gokrazy/hello"><pre><code>gokr-packer \
  -init_pkg=github.com/stapelberg/mediaserver/cmd/init \
  -overwrite=/dev/sdx \
  github.com/gokrazy/hello
</code></pre></div>

<ul dir="auto">
<li><a href="https://github.com/gokrazy/gokrazy">github.com/gokrazy/gokrazy</a>: system code, main issue tracker, documentation</li>
<li><a href="https://github.com/gokrazy/tools">github.com/gokrazy/tools</a>: SD card image creation code, pulling in:
<ul dir="auto">
<li><a href="https://github.com/gokrazy/firmware">github.com/gokrazy/firmware</a>: Raspberry Pi 3 or 4 firmware files</li>
<li><a href="https://github.com/gokrazy/rpi-eeprom">github.com/gokrazy/rpi-eeprom</a>: Raspberry Pi 4 EEPROM files</li>
<li><a href="https://github.com/gokrazy/kernel">github.com/gokrazy/kernel</a>: pre-built kernel image and bootloader config</li>
</ul>
</li>
</ul>

<p dir="auto"><a href="https://gokrazy.org" rel="nofollow">gokrazy.org</a> uses <a href="https://gohugo.io/" rel="nofollow">hugo</a> for creating and generating the website.
You can find the hugo install instructions here: <a href="https://gohugo.io/getting-started/installing/" rel="nofollow">Install Hugo</a>.
With hugo you can write documentation in Markdown and generate a static website from it.</p>
<p dir="auto">The <code>website</code> subdirectory is hugo’s root directory. In order to preview the
documentation or to re-generate the website, switch the directory to <code>website</code>.</p>
<p dir="auto">To preview the website, run the hugo webserver:</p>

<p dir="auto">Generate the website:</p>

<p dir="auto">The updated website content will be stored in the <code>./docs</code> directory.
Do not update anything here manually.</p>
</article>
        </div></div>
  </body>
</html>
