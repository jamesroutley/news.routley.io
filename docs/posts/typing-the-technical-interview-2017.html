<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aphyr.com/posts/342-typing-the-technical-interview">Original</a>
    <h1>Typing the technical interview (2017)</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p><em>Previously: <a href="https://aphyr.com/posts/341-hexing-the-technical-interview">Hexing the technical interview</a>.</em></p>
<p>In the formless days, long before the rise of the Church, all spells were woven
of pure causality, all actions were permitted, and death was common. Many
witches were disfigured by their magicks, found crumpled at the center of a
circle of twisted, glass-eaten trees, and stones which burned unceasing in the
pooling water; some disappeared entirely, or wandered along the ridgetops: feet
never touching earth, breath never warming air.</p>
<p>As a child, you learned the story of Gullveig-then-Heiðr, reborn three times
from the fires of her trial, who traveled the world performing <em>seidr</em>: the reading and re-weaving of the future. Her foretellings (and there were many) were famed—spoken of even by the völva-beyond-the-world—but it was her <em>survival</em> that changed history. Through the ecstatic trance of <em>seidr</em>, she foresaw her fate, and
conquered death. Her spells would never crash, and she became a friend to
outcast women: the predecessors of your kind. It is said that Odin himself learned immortality
from her.</p>
<p>To this day, all witches owe Heiðr a debt. Few delve into the ancient,
unstructured magic nowadays. The very languages in which your spells are
written are stabilized with <em>seidr</em> in their syntax, channeling the energies
you summon through safe paths—more or less. There are still occasional
explosions, of course. They’re just… more of the eyebrow-singeing variety, than
the type that result in new and interestingly-shaped fjørds.</p>
<p>“Is everything all right?”</p>
<p>The interviewer—Criss, his badge says—is young, as is customary in the
Valley. Wearing a hoodie which, judging from the lack of branding, cost at
least three hundred dollars.  He resembles no animal in particular, which gives
you pause.  Usually you’re better at that sort of thing.</p>
<p>“Do you mean in general? I don’t think so.” You look around at the conference
room as if to confirm. The walls smell of Slack DMs and conflict avoidance.</p>
<p>“Ah, well, um. Yes, you’re probably right.” He sounds bashful. “But I’d like to
do a little exercise with you nonetheless. Just a simple programming puzzle, so
I can understand how you solve problems.”</p>
<p>Once, you solved a problem with a knife of shattered sky-glass. You wonder
whether Criss would have the strength to do what you have done.</p>
<p>“Sooo… this problem is called N-Queens, and it’s fairly simple. Given an NxN
chessboard, you need to find a way to place N queens on that board safely.”</p>
<p>You draw an eight-by-eight grid on the whiteboard, and neatly arrange eight
queens together in the center. They face each other in a tight circle, to
converse as equals.</p>
<p>“Er, no—that’s not right. See? This queen could kill any of these four, in
one move.”</p>
<p>“Are you really unable,” you ask, voice as calm as stone, “to imagine eight
powerful women in the same room without them trying to kill each other?”</p>
<p>“It’s… it’s just how the problem works.”</p>
<p>Perhaps they are the matriarchs of warring clans, then. Together to discuss a
truce—but none trusting the other within a dagger’s reach. This too has
happened, in the history of your kind.</p>
<p>“Can I use any language?”</p>
<p>“Sure.”</p>
<p>Move quickly, before he realizes his mistake.</p>
<pre><code><span></span><span>{-# OPTIONS_GHC -fno-warn-missing-methods #-}</span>
<span>{-# LANGUAGE MultiParamTypeClasses #-}</span>
<span>{-# LANGUAGE FunctionalDependencies #-}</span>
<span>{-# LANGUAGE FlexibleInstances #-}</span>
<span>{-# LANGUAGE UndecidableInstances #-}</span>
</code></pre>
<p>“Oh, this is Haskell! I studied this in college!” He pauses, and frowns.
“Undecidable instances?”</p>
<p>“We must use this,” you inform him cheerfully, “because Hask is not a
category.”</p>
<p>“Oh, right.” He blusters a non-termination argument at nobody in particular.
“That’s why we usually think in subsets of Haskell where types don’t have
bottom values.”</p>
<p>“You could do that,” you concur, but, so quietly he cannot hear you, continue
to believe the exact opposite.</p>
<pre><code><span></span><span>nil</span> <span>=</span> <span>undefined</span>
</code></pre>
<p>An uncomfortable question is coming. Head it off by blurting out the first
thing that comes to mind. “To store our queen positions, we’ll need some kind
of a linked list, right?”</p>
<p>“Sure, or a vector.”</p>
<p>“Lists are simpler.”</p>
<p>“OK, sure. Whatever floats your boat.”</p>
<p>Summon a linked list from the void. It floats to the surface of the screen: a
timeless structure, expressed a thousand ways, but always beautiful. You sigh
contentedly.</p>
<pre><code><span></span><span>data</span> <span>Nil</span>
<span>data</span> <span>Cons</span> <span>x</span> <span>xs</span>
</code></pre>
<p>“Couldn’t you use the built-in lists?” Criss asks, his brow furrowing.</p>
<p>“What?” You have no idea what he’s talking about. “Oh, no—not without pulling
in a library. It’s easier to just define it inline.”</p>
<pre><code><span></span><span>class</span> <span>First</span> <span>list</span> <span>x</span> <span>|</span> <span>list</span> <span>-&gt;</span> <span>x</span>
<span>instance</span> <span>First</span> <span>Nil</span> <span>Nil</span>
<span>instance</span> <span>First</span> <span>(</span><span>Cons</span> <span>x</span> <span>more</span><span>)</span> <span>x</span>
</code></pre>
<p>“The ‘class’ keyword defines a function signature,” you remind Criss, who seems
to have forgotten something. “First takes a list and returns a value x from
it. There are two instances of our function—Haskell uses pattern matching to
choose which to call. First on a Nil list returns Nil, and First on a Cons cell
returns that cell’s value, x.”</p>
<p>You let that sink in, and move to concatenating two lists together.</p>
<pre><code><span></span><span>class</span> <span>ListConcat</span> <span>a</span> <span>b</span> <span>c</span> <span>|</span> <span>a</span> <span>b</span> <span>-&gt;</span> <span>c</span>
<span>instance</span> <span>ListConcat</span> <span>Nil</span> <span>x</span> <span>x</span>
<span>instance</span> <span>(</span><span>ListConcat</span> <span>as</span> <span>bs</span> <span>cs</span><span>)</span>
  <span>=&gt;</span> <span>ListConcat</span> <span>(</span><span>Cons</span> <span>a</span> <span>as</span><span>)</span> <span>bs</span> <span>(</span><span>Cons</span> <span>a</span> <span>cs</span><span>)</span>
</code></pre>
<p>“What’s the arrow?” Criss asks. Tell him it means implication. “To obtain the
ListConcat after the arrow, we <em>need</em> the ListConcat before the arrow.”</p>
<p>Realization dawns. “Oh, right! This is recursion, because ListConcat appears in both positions. And the definition for Nil is the base case.”</p>
<p>“Exactly.” You’re so proud of Criss. He’s coming right along. “And here’s the
generalized case, when we want to concatenate a list of lists.”</p>
<pre><code><span></span><span>-- Concatenate all lists in a list</span>
<span>class</span> <span>ListConcatAll</span> <span>ls</span> <span>l</span> <span>|</span> <span>ls</span> <span>-&gt;</span> <span>l</span>
<span>instance</span> <span>ListConcatAll</span> <span>Nil</span> <span>Nil</span>
<span>instance</span> <span>(</span><span>ListConcat</span> <span>chunk</span> <span>acc</span> <span>result</span><span>,</span>
          <span>ListConcatAll</span> <span>rest</span> <span>acc</span><span>)</span>
  <span>=&gt;</span> <span>ListConcatAll</span> <span>(</span><span>Cons</span> <span>chunk</span> <span>rest</span><span>)</span> <span>result</span>

<span>-- Is any element of this list True?</span>
<span>class</span> <span>AnyTrue</span> <span>list</span> <span>t</span> <span>|</span> <span>list</span> <span>-&gt;</span> <span>t</span>
<span>instance</span> <span>AnyTrue</span> <span>Nil</span>              <span>False</span>
<span>instance</span> <span>AnyTrue</span> <span>(</span><span>Cons</span> <span>True</span> <span>more</span><span>)</span> <span>True</span>
<span>instance</span> <span>(</span><span>AnyTrue</span> <span>list</span> <span>t</span><span>)</span>
  <span>=&gt;</span> <span>AnyTrue</span> <span>(</span><span>Cons</span> <span>False</span> <span>list</span><span>)</span> <span>t</span>
</code></pre>
<p>This has required more concentration than you would have liked, so you back off
to something easier. “Let’s do booleans,” you suggest, as if inviting him to
lunch.</p>
<p>“Why?”</p>
<p>“Because we need them, of course.”</p>
<p>Seize two meaningless constants from the void, and imbue them with meaning.</p>
<pre><code><span></span><span>data</span> <span>True</span>
<span>data</span> <span>False</span>

<span>class</span> <span>Not</span> <span>b1</span> <span>b</span> <span>|</span> <span>b1</span> <span>-&gt;</span> <span>b</span>
<span>instance</span> <span>Not</span> <span>False</span> <span>True</span>
<span>instance</span> <span>Not</span> <span>True</span>  <span>False</span>

<span>class</span> <span>Or</span> <span>b1</span> <span>b2</span> <span>b</span> <span>|</span> <span>b1</span> <span>b2</span> <span>-&gt;</span> <span>b</span>
<span>instance</span> <span>Or</span> <span>True</span>  <span>True</span>  <span>True</span>
<span>instance</span> <span>Or</span> <span>True</span>  <span>False</span> <span>True</span>
<span>instance</span> <span>Or</span> <span>False</span> <span>True</span>  <span>True</span>
<span>instance</span> <span>Or</span> <span>False</span> <span>False</span> <span>False</span>
</code></pre>
<p>Freyja would be pleased. To birth an algebra into the world is a beautiful
thing.</p>
<p>“And I suppose we’ll need integral numbers to store the positions of our queens
as well,” you mutter. “We’ll work in positive coordinates only, so the usual
Peano construction should suffice.” Draw a thread of hair from your head, and
tie a knot in it for zero.</p>
<pre><code><span></span><span>data</span> <span>Z</span>
<span>data</span> <span>S</span> <span>n</span>

<span>type</span> <span>N0</span> <span>=</span> <span>Z</span>
<span>type</span> <span>N1</span> <span>=</span> <span>S</span> <span>N0</span>
<span>type</span> <span>N2</span> <span>=</span> <span>S</span> <span>N1</span>
<span>type</span> <span>N3</span> <span>=</span> <span>S</span> <span>N2</span>
<span>type</span> <span>N4</span> <span>=</span> <span>S</span> <span>N3</span>
<span>type</span> <span>N5</span> <span>=</span> <span>S</span> <span>N4</span>
<span>type</span> <span>N6</span> <span>=</span> <span>S</span> <span>N5</span>
<span>type</span> <span>N7</span> <span>=</span> <span>S</span> <span>N6</span>
<span>type</span> <span>N8</span> <span>=</span> <span>S</span> <span>N7</span>
</code></pre>
<p>“You’re… defining the natural numbers by hand? Why?”</p>
<p>“Haskell is for mathematicians,” you explain. “We always define our terms.”</p>
<pre><code><span></span><span>-- Equality</span>
<span>class</span> <span>PeanoEqual</span> <span>a</span> <span>b</span> <span>t</span> <span>|</span> <span>a</span> <span>b</span> <span>-&gt;</span> <span>t</span>
<span>instance</span> <span>PeanoEqual</span> <span>Z</span>     <span>Z</span>     <span>True</span>
<span>instance</span> <span>PeanoEqual</span> <span>(</span><span>S</span> <span>a</span><span>)</span> <span>Z</span>     <span>False</span>
<span>instance</span> <span>PeanoEqual</span> <span>Z</span>     <span>(</span><span>S</span> <span>b</span><span>)</span> <span>False</span>
<span>instance</span> <span>(</span><span>PeanoEqual</span> <span>a</span> <span>b</span> <span>t</span><span>)</span>
  <span>=&gt;</span> <span>PeanoEqual</span> <span>(</span><span>S</span> <span>a</span><span>)</span> <span>(</span><span>S</span> <span>b</span><span>)</span> <span>t</span>

<span>-- Comparison (&lt;)</span>
<span>class</span> <span>PeanoLT</span> <span>a</span> <span>b</span> <span>t</span> <span>|</span> <span>a</span> <span>b</span> <span>-&gt;</span> <span>t</span>
<span>instance</span> <span>PeanoLT</span> <span>Z</span>      <span>Z</span>     <span>False</span>
<span>instance</span> <span>PeanoLT</span> <span>(</span><span>S</span> <span>x</span><span>)</span>  <span>Z</span>     <span>False</span>
<span>instance</span> <span>PeanoLT</span> <span>Z</span>      <span>(</span><span>S</span> <span>x</span><span>)</span> <span>True</span>
<span>instance</span> <span>(</span><span>PeanoLT</span> <span>a</span> <span>b</span> <span>t</span><span>)</span>
  <span>=&gt;</span> <span>PeanoLT</span> <span>(</span><span>S</span> <span>a</span><span>)</span> <span>(</span><span>S</span> <span>b</span><span>)</span> <span>t</span>

<span>-- Absolute difference</span>
<span>class</span> <span>PeanoAbsDiff</span> <span>a</span> <span>b</span> <span>c</span> <span>|</span> <span>a</span> <span>b</span> <span>-&gt;</span> <span>c</span>
<span>instance</span> <span>PeanoAbsDiff</span> <span>Z</span> <span>Z</span> <span>Z</span>
<span>instance</span> <span>PeanoAbsDiff</span> <span>Z</span> <span>(</span><span>S</span> <span>b</span><span>)</span> <span>(</span><span>S</span> <span>b</span><span>)</span>
<span>instance</span> <span>PeanoAbsDiff</span> <span>(</span><span>S</span> <span>a</span><span>)</span> <span>Z</span> <span>(</span><span>S</span> <span>a</span><span>)</span>
<span>instance</span> <span>(</span><span>PeanoAbsDiff</span> <span>a</span> <span>b</span> <span>c</span><span>)</span>
  <span>=&gt;</span> <span>PeanoAbsDiff</span> <span>(</span><span>S</span> <span>a</span><span>)</span> <span>(</span><span>S</span> <span>b</span><span>)</span> <span>c</span>

<span>-- Integers from n to 0</span>
<span>class</span> <span>Range</span> <span>n</span> <span>xs</span> <span>|</span> <span>n</span> <span>-&gt;</span> <span>xs</span>
<span>instance</span> <span>Range</span> <span>Z</span> <span>Nil</span>
<span>instance</span> <span>(</span><span>Range</span> <span>n</span> <span>xs</span><span>)</span>
  <span>=&gt;</span> <span>Range</span> <span>(</span><span>S</span> <span>n</span><span>)</span> <span>(</span><span>Cons</span> <span>n</span> <span>xs</span><span>)</span>
</code></pre>
<p>“Wait, hang on,” Criss interrupts. “Shouldn’t you… shouldn’t there be type
declarations here? At least on our functions?”</p>
<p>You smile kindly. “Haskell is a dynamically-typed, interpreted language.”</p>
<p>Criss appears to have swallowed a frog.</p>
<p>“Here, I’ll show you. Let’s check if one equals one.”</p>
<pre><code><span></span><span>class</span> <span>LegalCompare</span> <span>t</span> <span>|</span> <span>-&gt;</span> <span>t</span>
  <span>where</span> <span>legalCompare</span> <span>::</span> <span>t</span>
<span>instance</span> <span>(</span><span>PeanoEqual</span> <span>(</span><span>S</span> <span>Z</span><span>)</span> <span>(</span><span>S</span> <span>Z</span><span>)</span> <span>t</span><span>)</span>
  <span>=&gt;</span> <span>LegalCompare</span> <span>t</span>

<span>*</span><span>Main</span><span>&gt;</span> <span>:</span><span>type</span> <span>legalCompare</span>
<span>legalCompare</span> <span>::</span> <span>True</span>
</code></pre>
<p>“See? <code>legalCompare</code> is equal to <code>True</code>. Now let’s try writing an expression
that performs an invalid comparison. Say, comparing True to a List?”</p>
<pre><code><span></span><span>class</span> <span>IllegalCompare</span> <span>t</span> <span>|</span> <span>-&gt;</span> <span>t</span>
  <span>where</span> <span>illegalCompare</span> <span>::</span> <span>t</span>
<span>instance</span> <span>(</span><span>PeanoEqual</span> <span>True</span> <span>(</span><span>Cons</span> <span>Z</span> <span>False</span><span>)</span> <span>t</span><span>)</span>
  <span>=&gt;</span> <span>IllegalCompare</span> <span>t</span>
</code></pre>
<p>“See? It loads just fine. It only breaks when you try to <em>evaluate</em>
it—remember, Haskell is lazy.”</p>
<pre><code><span></span><span>*</span><span>Main</span><span>&gt;</span> <span>:</span><span>type</span> <span>illegalCompare</span>
<span>illegalCompare</span> <span>::</span> <span>PeanoEqual</span> <span>True</span> <span>(</span><span>Cons</span> <span>Z</span> <span>False</span><span>)</span> <span>t</span> <span>=&gt;</span> <span>t</span>
</code></pre>
<p>“There you have it! A runtime type error.”</p>
<p>“It doesn’t <em>say</em> error…”</p>
<p>“Well, you know. Haskell’s error messages are notoriously difficult to
understand.”</p>
<p>Criss appears quite ill. Take the opportunity to move on to higher order
functions.</p>
<p>“Unfortunately, Haskell has no currying, so we’re forced to build our own tools
for partial functions. Here’s a signature for generalized single-arity function application.”</p>
<pre><code><span></span><span>class</span> <span>Apply</span> <span>f</span> <span>a</span> <span>r</span> <span>|</span> <span>f</span> <span>a</span> <span>-&gt;</span> <span>r</span>
</code></pre>
<p>“Just a function f which takes input a and returns r.” The variables have a
lovely songlike melody. “For partial application, we could define datatypes like Partial1, Partial2, etc, but since we only need a few of these, it’s easier to define explicitly curried versions of the functions we need. Like so!”</p>
<pre><code><span></span><span>data</span> <span>Conj1</span> <span>list</span>
<span>instance</span> <span>Apply</span> <span>(</span><span>Conj1</span> <span>list</span><span>)</span> <span>x</span> <span>(</span><span>Cons</span> <span>x</span> <span>list</span><span>)</span>
</code></pre>
<p>Breathe deep, and allow your spirit to come unmoored from these concrete forms,
ascending to the plane of higher order functions.</p>
<pre><code><span></span><span>-- Map f over a list</span>
<span>class</span> <span>Map</span> <span>f</span> <span>xs</span> <span>ys</span> <span>|</span> <span>f</span> <span>xs</span> <span>-&gt;</span> <span>ys</span>
<span>instance</span> <span>Map</span> <span>f</span> <span>Nil</span> <span>Nil</span>
<span>instance</span> <span>(</span><span>Apply</span> <span>f</span> <span>x</span> <span>y</span><span>,</span> <span>Map</span> <span>f</span> <span>xs</span> <span>ys</span><span>)</span>
  <span>=&gt;</span> <span>Map</span> <span>f</span> <span>(</span><span>Cons</span> <span>x</span> <span>xs</span><span>)</span> <span>(</span><span>Cons</span> <span>y</span> <span>ys</span><span>)</span>

<span>-- Map f over list and concatenate results together</span>
<span>class</span> <span>MapCat</span> <span>f</span> <span>xs</span> <span>zs</span> <span>|</span> <span>f</span> <span>xs</span> <span>-&gt;</span> <span>zs</span>
<span>instance</span> <span>MapCat</span> <span>f</span> <span>Nil</span> <span>Nil</span>
<span>instance</span> <span>(</span><span>Map</span> <span>f</span> <span>xs</span> <span>chunks</span><span>,</span> <span>ListConcatAll</span> <span>chunks</span> <span>ys</span><span>)</span>
  <span>=&gt;</span> <span>MapCat</span> <span>f</span> <span>xs</span> <span>ys</span>

<span>-- Filter a list with an Apply-able predicate function</span>
<span>class</span> <span>AppendIf</span> <span>pred</span> <span>x</span> <span>ys</span> <span>zs</span> <span>|</span> <span>pred</span> <span>x</span> <span>ys</span> <span>-&gt;</span> <span>zs</span>
<span>instance</span> <span>AppendIf</span> <span>True</span> <span>x</span> <span>ys</span> <span>(</span><span>Cons</span> <span>x</span> <span>ys</span><span>)</span>
<span>instance</span> <span>AppendIf</span> <span>False</span> <span>x</span> <span>ys</span> <span>ys</span>

<span>class</span> <span>Filter</span> <span>f</span> <span>xs</span> <span>ys</span> <span>|</span> <span>f</span> <span>xs</span> <span>-&gt;</span> <span>ys</span>
<span>instance</span> <span>Filter</span> <span>f</span> <span>Nil</span> <span>Nil</span>
<span>instance</span> <span>(</span><span>Apply</span> <span>f</span> <span>x</span> <span>t</span><span>,</span>
          <span>Filter</span> <span>f</span> <span>xs</span> <span>ys</span><span>,</span>
          <span>AppendIf</span> <span>t</span> <span>x</span> <span>ys</span> <span>zs</span><span>)</span>
  <span>=&gt;</span> <span>Filter</span> <span>f</span> <span>(</span><span>Cons</span> <span>x</span> <span>xs</span><span>)</span> <span>zs</span>
</code></pre>
<p>Check back in with the world of concrete values for a moment. Criss is still
here, at least physically. Your laptop screen has turned a gorgeous mix of
purples, owing to the extreme cold, but the code is still dimly visible within.
It reminds you of a frozen lake at dusk. A liquid crystal.</p>
<p>“Criss. Criss.” He blinks rapidly, as if coming out of darkness. Such beautiful
eyes. You remember when your own still held color. “We’re ready.”</p>
<p>“Yes. Right.”</p>
<p>“A queen is defined by her two coordinates on the board: x and y. We’ll also
build a partially applied constructor for making queens with a given x
coordinate.”</p>
<pre><code><span></span><span>data</span> <span>Queen</span> <span>x</span> <span>y</span>
<span>data</span> <span>Queen1</span> <span>x</span>
<span>instance</span> <span>Apply</span> <span>(</span><span>Queen1</span> <span>x</span><span>)</span> <span>y</span> <span>(</span><span>Queen</span> <span>x</span> <span>y</span><span>)</span>

<span>-- A list of queens in row x with y from 0 to n.</span>
<span>class</span> <span>QueensInRow</span> <span>n</span> <span>x</span> <span>queens</span> <span>|</span> <span>n</span> <span>x</span> <span>-&gt;</span> <span>queens</span>
<span>instance</span> <span>(</span><span>Range</span> <span>n</span> <span>ys</span><span>,</span> <span>Map</span> <span>(</span><span>Queen1</span> <span>x</span><span>)</span> <span>ys</span> <span>queens</span><span>)</span>
  <span>=&gt;</span> <span>QueensInRow</span> <span>n</span> <span>x</span> <span>queens</span>
</code></pre>
<p>“Yes queens!” You murmur. This is, sadly, not that kind of interview.</p>
<p>These queens can stab in eight directions. You always assumed that was a
metaphor.</p>
<pre><code><span></span><span>-- Does queen a threaten queen b?</span>
<span>class</span> <span>Threatens</span> <span>a</span> <span>b</span> <span>t</span> <span>|</span> <span>a</span> <span>b</span> <span>-&gt;</span> <span>t</span>
<span>instance</span> <span>(</span><span>PeanoEqual</span> <span>ax</span> <span>bx</span> <span>xeq</span><span>,</span>
          <span>PeanoEqual</span> <span>ay</span> <span>by</span> <span>yeq</span><span>,</span>
          <span>Or</span> <span>xeq</span> <span>yeq</span> <span>xyeq</span><span>,</span>
          <span>PeanoAbsDiff</span> <span>ax</span> <span>bx</span> <span>dx</span><span>,</span>
          <span>PeanoAbsDiff</span> <span>ay</span> <span>by</span> <span>dy</span><span>,</span>
          <span>PeanoEqual</span> <span>dx</span> <span>dy</span> <span>deq</span><span>,</span>
          <span>Or</span> <span>xyeq</span> <span>deq</span> <span>res</span><span>)</span>
  <span>=&gt;</span> <span>Threatens</span> <span>(</span><span>Queen</span> <span>ax</span> <span>ay</span><span>)</span> <span>(</span><span>Queen</span> <span>bx</span> <span>by</span><span>)</span> <span>res</span>

<span>-- Partial application of Threatens</span>
<span>data</span> <span>Threatens1</span> <span>a</span>
<span>instance</span> <span>(</span><span>Threatens</span> <span>a</span> <span>b</span> <span>t</span><span>)</span>
  <span>=&gt;</span> <span>Apply</span> <span>(</span><span>Threatens1</span> <span>a</span><span>)</span> <span>b</span> <span>t</span>
</code></pre>
<p>A new queen enters the room, striding into position. She watches her
adversaries warily, remaining just out of reach. Where can she stand? You
envision a stack of universes—alternate worlds, each containing queens in
various positions.</p>
<pre><code><span></span><span>-- Is queen b compatible with all queen as?</span>
<span>class</span> <span>Safe</span> <span>config</span> <span>queen</span> <span>t</span> <span>|</span> <span>config</span> <span>queen</span> <span>-&gt;</span> <span>t</span>
<span>instance</span> <span>(</span><span>Map</span> <span>(</span><span>Threatens1</span> <span>queen</span><span>)</span> <span>config</span> <span>m1</span><span>,</span>
          <span>AnyTrue</span> <span>m1</span> <span>t1</span><span>,</span>
          <span>Not</span>     <span>t1</span> <span>t2</span><span>)</span>
  <span>=&gt;</span> <span>Safe</span> <span>config</span> <span>queen</span> <span>t2</span>

<span>data</span> <span>Safe1</span> <span>config</span>
<span>instance</span> <span>(</span><span>Safe</span> <span>config</span> <span>queen</span> <span>t</span><span>)</span>
  <span>=&gt;</span> <span>Apply</span> <span>(</span><span>Safe1</span> <span>config</span><span>)</span> <span>queen</span> <span>t</span>

<span>-- Add a queen with the given x coordinate to a legal configuration, returning</span>
<span>-- a set of legal configurations.</span>
<span>class</span> <span>AddQueen</span> <span>n</span> <span>x</span> <span>c</span> <span>cs</span> <span>|</span> <span>n</span> <span>x</span> <span>c</span> <span>-&gt;</span> <span>cs</span>
<span>instance</span> <span>(</span><span>QueensInRow</span> <span>n</span> <span>x</span> <span>candidates</span><span>,</span>
          <span>Filter</span> <span>(</span><span>Safe1</span> <span>c</span><span>)</span> <span>candidates</span> <span>filtered</span><span>,</span>
          <span>Map</span> <span>(</span><span>Conj1</span> <span>c</span><span>)</span> <span>filtered</span> <span>cs</span><span>)</span>
  <span>=&gt;</span> <span>AddQueen</span> <span>n</span> <span>x</span> <span>c</span> <span>cs</span>

<span>data</span> <span>AddQueen2</span> <span>n</span> <span>x</span>
<span>instance</span> <span>(</span><span>AddQueen</span> <span>n</span> <span>x</span> <span>c</span> <span>cs</span><span>)</span>
  <span>=&gt;</span> <span>Apply</span> <span>(</span><span>AddQueen2</span> <span>n</span> <span>x</span><span>)</span> <span>c</span> <span>cs</span>

<span>-- Add a queen at x to every configuration, returning a set of legal</span>
<span>-- configurations.</span>
<span>class</span> <span>AddQueenToAll</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs&#39;</span> <span>|</span> <span>n</span> <span>x</span> <span>cs</span> <span>-&gt;</span> <span>cs&#39;</span>
<span>instance</span> <span>(</span><span>MapCat</span> <span>(</span><span>AddQueen2</span> <span>n</span> <span>x</span><span>)</span> <span>cs</span> <span>cs&#39;</span><span>)</span>
  <span>=&gt;</span> <span>AddQueenToAll</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs&#39;</span>
</code></pre>
<p>“And now, we recur,” you whisper, and loop the spell back on itself, sewn
together with the thread of control. One queen per row, in every legal
position, for every configuration. You imagine what their startup’s about-us page
would look like.</p>
<pre><code><span></span><span>-- Add queens recursively</span>
<span>class</span> <span>AddQueensIf</span> <span>pred</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs&#39;</span> <span>|</span> <span>pred</span> <span>n</span> <span>x</span> <span>cs</span> <span>-&gt;</span> <span>cs&#39;</span>
<span>instance</span> <span>AddQueensIf</span> <span>False</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs</span>
<span>instance</span> <span>(</span><span>AddQueenToAll</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs2</span><span>,</span>
          <span>AddQueens</span> <span>n</span> <span>(</span><span>S</span> <span>x</span><span>)</span> <span>cs2</span> <span>cs&#39;</span><span>)</span>
  <span>=&gt;</span> <span>AddQueensIf</span> <span>True</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs&#39;</span>

<span>class</span> <span>AddQueens</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs&#39;</span> <span>|</span> <span>n</span> <span>x</span> <span>cs</span> <span>-&gt;</span> <span>cs&#39;</span>
<span>instance</span> <span>(</span><span>PeanoLT</span> <span>x</span> <span>n</span> <span>pred</span><span>,</span>
          <span>AddQueensIf</span> <span>pred</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs&#39;</span><span>)</span>
  <span>=&gt;</span> <span>AddQueens</span> <span>n</span> <span>x</span> <span>cs</span> <span>cs&#39;</span>

<span>-- Solve</span>
<span>class</span> <span>Solution</span> <span>n</span> <span>c</span> <span>|</span> <span>n</span> <span>-&gt;</span> <span>c</span> <span>where</span>
  <span>solution</span> <span>::</span> <span>n</span> <span>-&gt;</span> <span>c</span>
<span>instance</span> <span>(</span><span>AddQueens</span> <span>n</span> <span>Z</span> <span>(</span><span>Cons</span> <span>Nil</span> <span>Nil</span><span>)</span> <span>cs</span><span>,</span>
          <span>First</span> <span>cs</span> <span>c</span><span>)</span>
  <span>=&gt;</span> <span>Solution</span> <span>n</span> <span>c</span> <span>where</span> <span>solution</span> <span>=</span> <span>nil</span>
</code></pre>
<p>Criss has adopted the far-gaze of a man who has learned of some great loss, or
perhaps been witness to a nearby explosion. Take his shoulder gently.
“Psst!” You whisper. “All is prepared, and a solution is at hand.”</p>
<pre><code><span></span><span>*</span><span>Main</span><span>&gt;</span> <span>:</span><span>type</span> <span>solution</span> <span>(</span><span>nil</span> <span>::</span> <span>N6</span><span>)</span>
<span>solution</span> <span>(</span><span>nil</span> <span>::</span> <span>N6</span><span>)</span>
  <span>::</span> <span>Cons</span> <span>(</span><span>Queen</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>)))))</span> <span>(</span><span>S</span> <span>Z</span><span>))</span>
       <span>(</span><span>Cons</span> <span>(</span><span>Queen</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>))))</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>))))</span>
          <span>(</span><span>Cons</span> <span>(</span><span>Queen</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>)))</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>))))))</span>
             <span>(</span><span>Cons</span> <span>(</span><span>Queen</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>))</span> <span>Z</span><span>)</span>
                <span>(</span><span>Cons</span> <span>(</span><span>Queen</span> <span>(</span><span>S</span> <span>Z</span><span>)</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>)))</span>
                   <span>(</span><span>Cons</span> <span>(</span><span>Queen</span> <span>Z</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>(</span><span>S</span> <span>Z</span><span>)))))</span>
                      <span>Nil</span><span>)))))</span>
</code></pre>
<p>Look: the pretty-printer has aligned things <em>just so</em>, creating a lovely line
of zeroes along the vertical axis. “So that’s a queen at 5,1, at 4,3, at 3,5,
at 2,0, 1,2, and 0,4. Does that work, Criss?”</p>
<p>Criss stares at you for a long, long moment. “You never… you never wrote an actual <em>value</em>.
You… do realize that the type system is meant to constrain <em>values</em>, right?”</p>
<p>“No,” you inform him, matter-of-factly. “No, that doesn’t sound right.”</p>
<p>He leans back in his chair, so far you think he may fall over, and rubs his
forehead with both hands. You, who through <em>seidr</em>, have seen your rejection email
already, know what he is about to say.</p>
<p>“We’ll be in touch.”</p>
<p><em>Next: <a href="https://aphyr.com/posts/353-rewriting-the-technical-interview">Rewriting the Technical Interview</a>.</em></p>
<p><em>With sincerest thanks to <a href="https://twitter.com/importantshock">Patrick Thomson</a>, and Conrad Parker’s <a href="https://wiki.haskell.org/wikiupload/d/dd/TMR-Issue8.pdf">Type Level Instant Insanity</a>.</em></p>

    </div></div>
  </body>
</html>
