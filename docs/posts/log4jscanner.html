<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google/log4jscanner">Original</a>
    <h1>Log4jscanner</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto"><a href="https://pkg.go.dev/github.com/google/log4jscanner/jar" rel="nofollow"><img src="https://camo.githubusercontent.com/3a08ddd1769753ee47d5e0ed7e2fb487b211c2e041a34d5bf00e414590cb1393/68747470733a2f2f706b672e676f2e6465762f62616467652f6769746875622e636f6d2f676f6f676c652f6c6f67346a7363616e6e65722f6a61722e737667" alt="Go Reference" data-canonical-src="https://pkg.go.dev/badge/github.com/google/log4jscanner/jar.svg"/></a></p>
<p dir="auto">A log4j vulnerability filesystem scanner and Go package for analyzing JAR files.</p>
<h2 dir="auto"><a id="user-content-installing" aria-hidden="true" href="#installing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installing</h2>
<p dir="auto">Pre-compiled binaries are available as <a href="https://github.com/google/log4jscanner/releases">releases assets</a>.</p>
<p dir="auto">To install from source with an existing <a href="https://go.dev/" rel="nofollow">Go</a> installation, either use
<a href="https://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies" rel="nofollow">go install</a>:</p>
<div data-snippet-clipboard-copy-content="go install github.com/google/log4jscanner@latest"><pre><code>go install github.com/google/log4jscanner@latest
</code></pre></div>
<p dir="auto">Or build from the repo directly:</p>
<div data-snippet-clipboard-copy-content="git clone https://github.com/google/log4jscanner.git
cd log4jscanner
go build -o log4jscanner"><pre><code>git clone https://github.com/google/log4jscanner.git
cd log4jscanner
go build -o log4jscanner
</code></pre></div>
<h2 dir="auto"><a id="user-content-command-line-tool" aria-hidden="true" href="#command-line-tool"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Command line tool</h2>
<p dir="auto">This project includes a scanner that walks directory, printing any detected JARs
to stdout.</p>
<div data-snippet-clipboard-copy-content="$ log4jscanner ./jar/testdata
./jar/testdata/bad_jar_in_jar.jar
./jar/testdata/log4j-core-2.1.jar
./jar/testdata/log4j-core-2.12.1.jar
./jar/testdata/log4j-core-2.14.0.jar
./jar/testdata/log4j-core-2.15.0.jar
./jar/testdata/vuln-class.jar"><pre><code>$ log4jscanner ./jar/testdata
./jar/testdata/bad_jar_in_jar.jar
./jar/testdata/log4j-core-2.1.jar
./jar/testdata/log4j-core-2.12.1.jar
./jar/testdata/log4j-core-2.14.0.jar
./jar/testdata/log4j-core-2.15.0.jar
./jar/testdata/vuln-class.jar
</code></pre></div>
<p dir="auto">Optionally, the <code>--rewrite</code> flag can actively remove the vulnerable class from
detected JARs in-place.</p>
<div data-snippet-clipboard-copy-content="$ zipinfo /tmp/vuln-class.jar | grep Jndi
-rw-r--r--  3.0 unx     2937 bx defN 20-Nov-06 14:03 lookup/JndiLookup.class
-rw-r--r--  3.0 unx     5029 bx defN 20-Nov-06 14:03 net/JndiManager.class
-rw-r--r--  3.0 unx      249 bx defN 20-Nov-06 14:03 net/JndiManager$1.class
-rw-r--r--  3.0 unx     1939 bx defN 20-Nov-06 14:03 net/JndiManager$JndiManagerFactory.class
$ log4jscanner --rewrite /tmp
/tmp/vuln-class.jar
$ zipinfo /tmp/vuln-class.jar | grep Jndi
-rw-r--r--  3.0 unx     5029 bx defN 20-Nov-06 14:03 net/JndiManager.class
-rw-r--r--  3.0 unx      249 bx defN 20-Nov-06 14:03 net/JndiManager$1.class
-rw-r--r--  3.0 unx     1939 bx defN 20-Nov-06 14:03 net/JndiManager$JndiManagerFactory.class"><pre><code>$ zipinfo /tmp/vuln-class.jar | grep Jndi
-rw-r--r--  3.0 unx     2937 bx defN 20-Nov-06 14:03 lookup/JndiLookup.class
-rw-r--r--  3.0 unx     5029 bx defN 20-Nov-06 14:03 net/JndiManager.class
-rw-r--r--  3.0 unx      249 bx defN 20-Nov-06 14:03 net/JndiManager$1.class
-rw-r--r--  3.0 unx     1939 bx defN 20-Nov-06 14:03 net/JndiManager$JndiManagerFactory.class
$ log4jscanner --rewrite /tmp
/tmp/vuln-class.jar
$ zipinfo /tmp/vuln-class.jar | grep Jndi
-rw-r--r--  3.0 unx     5029 bx defN 20-Nov-06 14:03 net/JndiManager.class
-rw-r--r--  3.0 unx      249 bx defN 20-Nov-06 14:03 net/JndiManager$1.class
-rw-r--r--  3.0 unx     1939 bx defN 20-Nov-06 14:03 net/JndiManager$JndiManagerFactory.class
</code></pre></div>
<p dir="auto">On MacOS, you can scan the entire data directory with:</p>
<div data-snippet-clipboard-copy-content="$ sudo log4jscanner /System/Volumes/Data"><pre><code>$ sudo log4jscanner /System/Volumes/Data
</code></pre></div>
<p dir="auto">The scanner can also skip directories by passing glob patterns. On Linux, you
may choose to scan the entire root filesystem, but skip site-specific paths
(e.g. the <code>/data/*</code> directory). By default log4jscanner will not scan magic
filesystems, such as /proc and /sys.</p>
<div data-snippet-clipboard-copy-content="$ sudo log4jscanner --skip &#39;/data/*&#39; /"><pre><code>$ sudo log4jscanner --skip &#39;/data/*&#39; /
</code></pre></div>
<p dir="auto">For heavy customization, such as reporting to external endpoints, much of the
tool&#39;s logic is exposed throught the <a href="https://pkg.go.dev/github.com/google/log4jscanner/jar#Walker" rel="nofollow"><code>jar.Walker</code></a> API.</p>
<h2 dir="auto"><a id="user-content-package" aria-hidden="true" href="#package"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Package</h2>
<p dir="auto">Parsing logic is available through the <code>jar</code> package, and can be used to scan
assets stored in other code repositories. Because JARs use the ZIP format, this
package operates on <a href="https://pkg.go.dev/archive/zip#Reader" rel="nofollow"><code>archive/zip.Reader</code></a>.</p>
<div data-snippet-clipboard-copy-content="import (
	&#34;archive/zip&#34;
	// ...

	&#34;github.com/google/log4jscanner/jar&#34;
)

func main() {
	rc, err := zip.OpenReader(pathToJARFile)
	if err != nil {
		if errors.Is(err, zip.ErrFormat) {
			// File isn&#39;t a ZIP file.
			return
		}
		log.Fatalf(&#34;opening class: %v&#34;, err)
	}
	defer rc.Close()

	if !jar.IsJAR(&amp;rc.Reader) {
		// ZIP file isn&#39;t a JAR file.
		return
	}

	result, err := jar.Parse(&amp;rc.Reader)
	if err != nil {
		log.Fatalf(&#34;parzing zip file: %v&#34;, err)
	}
	if result.Vulnerable {
		fmt.Println(&#34;File is vulnerable&#34;)
	}
}"><pre><span>import</span> (
	<span>&#34;archive/zip&#34;</span>
	<span>// ...</span>

	<span>&#34;github.com/google/log4jscanner/jar&#34;</span>
)

<span>func</span> <span>main</span>() {
	<span>rc</span>, <span>err</span> <span>:=</span> <span>zip</span>.<span>OpenReader</span>(<span>pathToJARFile</span>)
	<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
		<span>if</span> <span>errors</span>.<span>Is</span>(<span>err</span>, <span>zip</span>.<span>ErrFormat</span>) {
			<span>// File isn&#39;t a ZIP file.</span>
			<span>return</span>
		}
		<span>log</span>.<span>Fatalf</span>(<span>&#34;opening class: %v&#34;</span>, <span>err</span>)
	}
	<span>defer</span> <span>rc</span>.<span>Close</span>()

	<span>if</span> <span>!</span><span>jar</span>.<span>IsJAR</span>(<span>&amp;</span><span>rc</span>.<span>Reader</span>) {
		<span>// ZIP file isn&#39;t a JAR file.</span>
		<span>return</span>
	}

	<span>result</span>, <span>err</span> <span>:=</span> <span>jar</span>.<span>Parse</span>(<span>&amp;</span><span>rc</span>.<span>Reader</span>)
	<span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {
		<span>log</span>.<span>Fatalf</span>(<span>&#34;parzing zip file: %v&#34;</span>, <span>err</span>)
	}
	<span>if</span> <span>result</span>.<span>Vulnerable</span> {
		<span>fmt</span>.<span>Println</span>(<span>&#34;File is vulnerable&#34;</span>)
	}
}</pre></div>
<p dir="auto">See the <code>examples/</code> directory for full programs.</p>
<h2 dir="auto"><a id="user-content-false-positives" aria-hidden="true" href="#false-positives"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>False positives</h2>
<p dir="auto">False positives have been observed for the scanner. Use caution when rewriting
JARs automatically or taking other mitigations based on scan results.</p>
<p dir="auto">If you do hit a false positive, please open an issue.</p>
<h2 dir="auto"><a id="user-content-contributors" aria-hidden="true" href="#contributors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contributors</h2>
<p dir="auto">We unfortunately had to squash the history when open sourcing. The following
contributors were instrumental in this project&#39;s development:</p>
<ul dir="auto">
<li>David Dworken (@ddworken)</li>
<li>Eric Chiang (@ericchiang)</li>
<li>Julian Bangert</li>
<li>Mike Gerow (@gerow)</li>
<li>Mit Dalsania</li>
<li>Tom D&#39;Netto</li>
</ul>
</article>
        </div></div>
  </body>
</html>
