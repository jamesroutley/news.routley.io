<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aman.bh/blog/2025/creating-embroidered-charts-with-r-and-imagemagick">Original</a>
    <h1>Creating Embroidered Charts with R and ImageMagick</h1>
    
    <div id="readability-page-1" class="page"><div><!--[!--><!--[--><!----><p>In my <a href="https://aman.bh/blog/2025/two-years-of-word-games">last post</a>, I analysed mine and Rhea&#39;s NYT word games for the last two years. Since the analysis is pretty simple (just summaries and aggregates), the time saved by not having to do more in-depth work can be used to think of more interesting ways to show the data.</p> <p>To make my digital work more fun to create and enjoy, I love mimicking real-life objects, textures, and analogies. My latest gimmick this time was trying to make the charts look like they were embroidered into cloth. Since I was already feeling very Christmasy and cozy, an embroidery style felt like the good side-quest to set off on. I’m certainly not the first to try this and if I could actually embroider, I might have just done that! I love <a href="https://reuters.com/graphics/TENNIS-WIMBLEDON/GRAPHIC/lbvggkzjmvq/" rel="nofollow">this memorable Reuters piece</a>, which features graphics styled as cloth patches. Inspired by that, I wanted to push myself to replicate the look as accurately as possible strictly using code.</p> <p><a href="https://aman.bh/_app/immutable/assets/IMG-20251230000459174.iRv39J5U.jpeg" data-img="/_app/immutable/assets/IMG-20251230000459174.iRv39J5U.jpeg" data-width="3150" data-height="3937" data-alt="IMG-20251230000459174"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/IMG-20251230000459174.B-QVr5Uq.avif 1575w, /_app/immutable/assets/IMG-20251230000459174.Djubf08X.avif 3150w" type="image/avif"/><source srcset="/_app/immutable/assets/IMG-20251230000459174.CjVm-cke.webp 1575w, /_app/immutable/assets/IMG-20251230000459174.DZcZFNkK.webp 3150w" type="image/webp"/><source srcset="/_app/immutable/assets/IMG-20251230000459174.DTa3g5Ld.jpeg 1575w, /_app/immutable/assets/IMG-20251230000459174.iRv39J5U.jpeg 3150w" type="image/jpeg"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/IMG-20251230000459174.iRv39J5U.jpeg" alt="IMG-20251230000459174" width="3150" height="3937" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p>After many hours, I managed to achieve the look entirely within <code>R</code> and <code>ggplot</code> and heavy use of the <code>ImageMagick</code> library. In this post, I’ll break down the process. It requires some familiarity with CLI tools and code, but that barrier is lower than ever and if you wish you can easily paste this post into an LLM to tailor the code to your specific needs.</p> <h2 id="why-imagemagick"><a href="#why-imagemagick">Why ImageMagick?</a></h2> <p>Why go through the trouble of coding this when there is Photoshop? There seem to be no shortage of ‘embroidery actions and filters’ available for free. All of these may be good options, and no one method is better than the other, but for me the answer is always reproducibility. If I built this in Photoshop, every time I updated the dataset or caught a typo in my <code>ggplot</code> code, I would have to re-export the image, open it in Photoshop, and manually rerun an action or apply some filter. That is a recipe for frustration and as far as possible, the “art” part of this should be programmatic too. If the data changes, I don’t want to repeat a manual post-processing pipeline <span><label for="sn-1-1">1</label>  <span data-sidenote-number="1">I also refuse to use generative AI for anything to do with image generation. Nano Banana Pro can probably do the same thing with a prompt, but I don’t care for that.</span></span> .</p> <p>You can think of <a href="https://imagemagick.org/" rel="nofollow">ImageMagick</a> as “headless Photoshop.” It is a powerful command-line tool that lets you manipulate images using text commands instead of a mouse. By writing a script (or a recipe), we can manipulate an image with blurs, color changes, transforms, crops and much much more. In this case, our image being manipulated is a chart made in <code>ggplot</code>, when that data changes, we just re-run the script.</p> <p>I won’t go into how to <a href="https://imagemagick.org/script/download.php#gsc.tab=0" rel="nofollow">download ImageMagick for your OS</a>, but it is pretty straightforward and searchable.</p> <p>All commands follow this common structure: <code>magick [input] [actions] [output]</code>. Here are some sample commands:</p> <pre><code><span data-line-number="1"><span># Convert from jpg to png</span></span><span data-line-number="2"><span>magick input.jpg output.png</span></span><span data-line-number="3"></span><span data-line-number="4"><span># Resize image to new dimensions</span></span><span data-line-number="5"><span>magick input.jpg -resize 800x600 output.jpg</span></span><span data-line-number="6"></span><span data-line-number="7"><span># Make an image gray</span></span><span data-line-number="8"><span>magick input.jpg -colorspace gray output.jpg</span></span></code></pre> <p>You get the idea. Take one image, do something to it and then save it as another image. You can even combine operations, like maybe taking an image and blurring it and then applying a ‘posterize’ effect:</p> <pre><code><span data-line-number="1"><span>magick simpson.jpg -blur 0x4 -posterize 8 cant-see-simpson.jpg</span></span></code></pre> <p><a href="https://aman.bh/_app/immutable/assets/IMG-20251230000459206.xX1uTaKf.jpeg" data-img="/_app/immutable/assets/IMG-20251230000459206.xX1uTaKf.jpeg" data-width="1772" data-height="827" data-alt="Side-by-side comparison of original image and result after applying blur and posterize effects"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/IMG-20251230000459206.jtiacRya.avif 886w, /_app/immutable/assets/IMG-20251230000459206.Cz2W5Zud.avif 1772w" type="image/avif"/><source srcset="/_app/immutable/assets/IMG-20251230000459206.D8MMl5tl.webp 886w, /_app/immutable/assets/IMG-20251230000459206.DM4lRvHI.webp 1772w" type="image/webp"/><source srcset="/_app/immutable/assets/IMG-20251230000459206.GgMV8HYy.jpeg 886w, /_app/immutable/assets/IMG-20251230000459206.xX1uTaKf.jpeg 1772w" type="image/jpeg"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/IMG-20251230000459206.xX1uTaKf.jpeg" alt="Side-by-side comparison of original image and result after applying blur and posterize effects" width="1772" height="827" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p>The <code>-blur 0x4</code> applies a Gaussian blur with a radius of 4 pixels, and <code>-posterize 8</code> reduces the image to 8 distinct colour levels, giving it that look. This is the same thing that Photoshop’s Posterize filter does as well. One thing to note is that the order of operations matters here; we blur first, then posterize the blurred result.</p> <p>My pipeline for the stitched look works on the same principle with more steps. I don’t claim, or at the moment <em>want</em>, to know the inner workings of every single <code>magick</code> command there is. I think assistance with long strings of complex arguments and operator sequences is something I will always delegate to LLMs. However, not knowing <em>what</em> to ask will not take you very far. My Photoshop brain helped me a lot here, as we will see.</p> <h3 id="running-imagemagick-from-r"><a href="#running-imagemagick-from-r">Running ImageMagick from R</a></h3> <p>Since we’re building this pipeline in R, we need a way to execute shell commands from within our R scripts. There <em>is</em> the excellent <code>{magick}</code> package for R, which provides an interface over ImageMagick commands but the coverage isn’t full which is why I’ve not used it here. We’ll be relying on the original <code>ImageMagick</code> package but we can use the <code>system()</code> function for running it within R. You pass it a string containing the command you want to run and it executes it as if you typed it in your terminal:</p> <pre><code><span data-line-number="1"><span># Run a simple ImageMagick command from R</span></span><span data-line-number="2"><span>system</span><span>(</span><span>&#34;</span><span>magick input.png -blur 0x4 output.png</span><span>&#34;</span><span>)</span></span></code></pre> <p>This is great because it means we can generate a plot with ggplot, save it, run ImageMagick commands on that saved image, and continue with more R code, all in one script, all automated. When we get to the final function at the end, you’ll see how we build up a full ImageMagick command as a string and execute it with <code>system()</code>.</p> <h2 id="part-1-just-the-plot"><a href="#part-1-just-the-plot">Part 1: Just the Plot</a></h2> <p>Everything starts in ggplot. Before I add any texture, I need a clean base plot that is ready for the change in style. I created three themes for the charts in that post, which allow me to change them whenever I want and have useful “defaults.” We do not want to constantly think about fonts, accent colours, and grid lines.</p> <p>Fonts matter a lot and I’ve used three different fonts to sell the effect. <a href="https://www.dafont.com/jdr-sweatknitted.font" rel="nofollow">JDR SweatKnitted</a> is a knitted typeface for the big titles, <a href="https://fonts.google.com/specimen/Press+Start+2P" rel="nofollow">Press Start 2P</a> handles the axis labels, and <a href="https://fonts.google.com/specimen/VT323" rel="nofollow">VT323</a> acts as a subtitle font. I don’t know why these “retro” fonts go so well with the knitted aesthetic but to my sensibilities they were going together well, you can swap them out for whatever you want. Here is what my theme looked like:</p> <pre><code><span data-line-number="1"><span># Define a palette</span></span><span data-line-number="2"><span>pal</span><span> </span><span>&lt;-</span><span> </span><span>list</span><span>(</span></span><span data-line-number="3"><span>  </span><span>bg</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>#1A1A2E</span><span>&#34;</span><span>,</span></span><span data-line-number="4"><span>  </span><span>text</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>#E8E8E8</span><span>&#34;</span><span>,</span></span><span data-line-number="5"><span>  </span><span>accent</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>#C41E3A</span><span>&#34;</span><span>,</span></span><span data-line-number="6"><span>  </span><span>grid</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>#4A5A6E</span><span>&#34;</span><span>,</span></span><span data-line-number="7"><span>  </span><span>shapes</span><span> </span><span>=</span><span> </span><span>c</span><span>(</span><span>&#34;</span><span>#C41E3A</span><span>&#34;</span><span>, </span><span>&#34;</span><span>#2E8B57</span><span>&#34;</span><span>, </span><span>&#34;</span><span>#FFD700</span><span>&#34;</span><span>, </span><span>&#34;</span><span>#4A90A4</span><span>&#34;</span><span>)</span></span><span data-line-number="8"><span>)</span></span><span data-line-number="9"></span><span data-line-number="10"><span># Create the theme</span></span><span data-line-number="11"><span>theme_midnight</span><span> </span><span>&lt;-</span><span> </span><span>function</span><span>(</span><span>base_size</span><span> </span><span>=</span><span> </span><span>32</span><span>)</span><span> </span><span>{</span></span><span data-line-number="12"><span>  theme_minimal</span><span>(</span><span>base_size</span><span> </span><span>=</span><span> </span><span>base_size</span><span>)</span><span> </span><span>+</span></span><span data-line-number="13"><span>    theme</span><span>(</span></span><span data-line-number="14"><span>      </span><span>plot.background</span><span> </span><span>=</span><span> element_rect</span><span>(</span></span><span data-line-number="15"><span>        </span><span>fill</span><span> </span><span>=</span><span> </span><span>midnight_pal</span><span>$</span><span>bg</span><span>,</span></span><span data-line-number="16"><span>        </span><span>color</span><span> </span><span>=</span><span> </span><span>midnight_pal</span><span>$</span><span>accent</span><span>,</span></span><span data-line-number="17"><span>        </span><span>linewidth</span><span> </span><span>=</span><span> </span><span>8</span></span><span data-line-number="18"><span>      </span><span>),</span></span><span data-line-number="19"><span>      </span><span>plot.title</span><span> </span><span>=</span><span> element_text</span><span>(</span></span><span data-line-number="20"><span>        </span><span>family</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>JDR SweatKnitted</span><span>&#34;</span><span>,</span></span><span data-line-number="21"><span>        </span><span>color</span><span> </span><span>=</span><span> </span><span>midnight_pal</span><span>$</span><span>text</span><span>,</span></span><span data-line-number="22"><span>        </span><span>size</span><span> </span><span>=</span><span> rel</span><span>(</span><span>3.0</span><span>)</span></span><span data-line-number="23"><span>      </span><span>),</span></span><span data-line-number="24"><span>      </span><span>plot.subtitle</span><span> </span><span>=</span><span> element_text</span><span>(</span></span><span data-line-number="25"><span>        </span><span>family</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>VT323</span><span>&#34;</span><span>,</span></span><span data-line-number="26"><span>        </span><span>color</span><span> </span><span>=</span><span> </span><span>midnight_pal</span><span>$</span><span>accent</span></span><span data-line-number="27"><span>      </span><span>),</span></span><span data-line-number="28"><span>      </span><span>axis.text</span><span> </span><span>=</span><span> element_text</span><span>(</span></span><span data-line-number="29"><span>        </span><span>family</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>Press Start 2P</span><span>&#34;</span><span>,</span></span><span data-line-number="30"><span>        </span><span>color</span><span> </span><span>=</span><span> </span><span>midnight_pal</span><span>$</span><span>text</span></span><span data-line-number="31"><span>      </span><span>)</span></span><span data-line-number="32"><span>      </span><span># ... more styling</span></span><span data-line-number="33"><span>    </span><span>)</span></span><span data-line-number="34"><span>}</span></span><span data-line-number="35"></span></code></pre> <p>Another secret to adding more personality into your charts, if the occasion calls for it, are <strong>dingbats</strong>! They sound funny but are an incredibly low-effort high-reward addition that give you an immediate improvement. <a href="https://www.dafont.com/mtheme.php?id=7" rel="nofollow">Dingbats</a> are fonts that consist of symbols, icons, and shapes rather than normal alphanumeric characters. So when you type <code>A</code>, instead of seeing the letter ‘A’, you might see an icon that the designer assigned to the letter A.</p> <p>In my plots, I use this <a href="https://www.dafont.com/dh-snowflakes.font" rel="nofollow">dingbat font</a> to create the snowflake borders <span><label for="sn-2-2">2</label>  <span data-sidenote-number="2">There is also a <a href="https://www.dafont.com/doctor-who-2006.font">Dr. Who</a> dingbat if you need one.</span></span> you see on the top and bottom of plots. This isn’t anything fancy, it’s just a function that samples random letters from that font and pastes them in a row at the top and bottom of the plot. I really like using <code>cowplot</code> for this kind of “drawing on top of charts” work because it lets me place stuff arbitrarily on the plot canvas; shapes, annotations, labels, etc. that are not attached or relative to any data.</p> <pre><code><span data-line-number="1"><span>ggdraw</span><span>(</span><span>plot</span><span>)</span><span> </span><span>+</span></span><span data-line-number="2"><span>  </span><span>lapply</span><span>(</span><span>1</span><span>:</span><span>2</span><span>, </span><span>function</span><span>(</span><span>i</span><span>)</span><span> </span><span>{</span></span><span data-line-number="3"><span>    </span><span>set</span><span> </span><span>&lt;-</span><span> </span><span>list</span><span>(</span><span>LETTERS</span><span>, </span><span>letters</span><span>)[[</span><span>i</span><span>]]</span><span> </span><span># LETTERS is built into R</span></span><span data-line-number="4"><span>    </span><span>y_pos</span><span> </span><span>&lt;-</span><span> </span><span>c</span><span>(</span><span>0.97</span><span>, </span><span>0.03</span><span>)</span><span>[</span><span>i</span><span>]</span></span><span data-line-number="5"></span><span data-line-number="6"><span>    </span><span>txt</span><span> </span><span>&lt;-</span><span> </span><span>paste</span><span>(</span><span>sample</span><span>(</span><span>set</span><span>, </span><span>n_horiz</span><span>, </span><span>T</span><span>), </span><span>collapse</span><span> </span><span>=</span><span> </span><span>&#34;</span><span> </span><span>&#34;</span><span>)</span></span><span data-line-number="7"><span>    draw_label</span><span>(</span><span>txt</span><span>,</span><span> </span><span>0.5</span><span>,</span><span> </span><span>y_pos</span><span>,</span><span> </span><span>vjust</span><span> </span><span>=</span><span> </span><span>(</span><span>i</span><span> </span><span>==</span><span> </span><span>1</span><span>),</span></span><span data-line-number="8"><span>               </span><span>fontfamily</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>dingbat_font</span><span>&#34;</span><span>,</span><span> </span><span>color</span><span> </span><span>=</span><span> </span><span>color</span><span>,</span><span> </span><span>size</span><span> </span><span>=</span><span> </span><span>size</span><span>)</span></span><span data-line-number="9"><span>  </span><span>}</span><span>)</span></span></code></pre> <p>This code loops twice (once for the top border, once for the bottom). On each iteration, it picks either uppercase or lowercase letters, sets the vertical position (<code>0.97</code> for near the top, <code>0.03</code> for near the bottom), then samples random letters and draws them as a label using the dingbat font. Since the font turns letters into snowflakes, each plot gets a slightly different snowflake pattern.</p> <p>Do your analysis, create a basic chart with ggplot with all the niceties you want, titles, subtitles, center this move that, blah blah and when you are ready, plug in your theme. This is the start! My raw plots look like this:</p> <p><a href="https://aman.bh/_app/immutable/assets/IMG-20251230000459240.D6xncndo.png" data-img="/_app/immutable/assets/IMG-20251230000459240.D6xncndo.png" data-width="2000" data-height="2500" data-alt="A ggplot scatterplot  with dark blue background, red accents, pixelated fonts, and snowflake borders"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/IMG-20251230000459240.Dd3VZPKN.avif 1000w, /_app/immutable/assets/IMG-20251230000459240.BP7jbEB_.avif 2000w" type="image/avif"/><source srcset="/_app/immutable/assets/IMG-20251230000459240.C_GKNWVg.webp 1000w, /_app/immutable/assets/IMG-20251230000459240.DBcC0-Qm.webp 2000w" type="image/webp"/><source srcset="/_app/immutable/assets/IMG-20251230000459240.BpAu4ujf.png 1000w, /_app/immutable/assets/IMG-20251230000459240.D6xncndo.png 2000w" type="image/png"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/IMG-20251230000459240.D6xncndo.png" alt="A ggplot scatterplot  with dark blue background, red accents, pixelated fonts, and snowflake borders" width="2000" height="2500" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p>It looks festive enough but it is still clearly just a digital image. The edges are too perfect, the colors too flat. ONWARDS!</p> <h2 id="part-2-embroiderysh"><a href="#part-2-embroiderysh">Part 2: embroidery.sh</a></h2> <p>This is where things get interesting (and where we leave R for a bit) and here, I am standing on the shoulders of giants. The core effect comes from a <a href="http://www.fmwconcepts.com/imagemagick/embroidery/index.php" rel="nofollow">brilliant bash script</a> by Fred Weinhaus called <code>embroidery.sh</code>.  This is essentially a pre-written ImageMagick script that only requires you to provide an input image which it processes and outputs.</p> <p>The script reduces the image to a limited palette of colours and then generates a unique thread pattern for each one. It fills those colours and simulates the angle of the stitching for different color regions, adding bevels and shadows to create a gentle raised thread look. I set the pattern to <code>linear</code> to simulate straight stitches and kept the thread thickness at a medium level.</p> <p>You can download the script from <a href="">his website</a> and look at all the various examples on the page. Once downloaded, you run the script by providing it arguments about the settings you want.</p> <pre><code><span data-line-number="1"><span>./embroidery.sh \</span></span><span data-line-number="2"><span>  -n 8 </span><span>\ </span><span>      </span><span># Number of colors to use</span></span><span data-line-number="3"><span>  -p linear </span><span>\ </span><span> </span><span># Weave pattern (linear vs crosshatch)</span></span><span data-line-number="4"><span>  -t 3 </span><span>\ </span><span>      </span><span># Thread thickness</span></span><span data-line-number="5"><span>  -g 0 </span><span>\ </span><span>      </span><span># Gray limit (0 = no gray clamping)</span></span><span data-line-number="6"><span>  input.png \</span></span><span data-line-number="7"><span>  output.png</span></span></code></pre> <p>That’s all it takes! Right out the door, this already looks fun to me (see below). There is a very distinct feel to this that evokes the stitched feel we wanted <em>but</em> I think this looks a little too clean and flat. Real thread would be a little fuzzier, not as cleanly separated by color, would look a little more “raised” in places. This isn’t quite there yet.</p> <p><a href="https://aman.bh/_app/immutable/assets/IMG-20251230000459254.B1Y9F_mE.jpeg" data-img="/_app/immutable/assets/IMG-20251230000459254.B1Y9F_mE.jpeg" data-width="2000" data-height="2500" data-alt="The scatterplot after applying the embroidery script. Thread stitches are visible but the effect looks flat and too clean"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/IMG-20251230000459254.B_anBLpJ.avif 1000w, /_app/immutable/assets/IMG-20251230000459254.nZ2yhf30.avif 2000w" type="image/avif"/><source srcset="/_app/immutable/assets/IMG-20251230000459254.DfeXgnL_.webp 1000w, /_app/immutable/assets/IMG-20251230000459254.CFKVkRrc.webp 2000w" type="image/webp"/><source srcset="/_app/immutable/assets/IMG-20251230000459254.BxBgmP0z.jpeg 1000w, /_app/immutable/assets/IMG-20251230000459254.B1Y9F_mE.jpeg 2000w" type="image/jpeg"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/IMG-20251230000459254.B1Y9F_mE.jpeg" alt="The scatterplot after applying the embroidery script. Thread stitches are visible but the effect looks flat and too clean" width="2000" height="2500" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p><em>PS: Never accept the defaults. The defaults work in some cases, but I have always found that if you don’t just accept what some software has given you and spend a little while longer tinkering, you’ll be happier with what you make.</em></p> <p>In this particular case, I know that I wanted to break the neatness of the above image. Before code or programming, I have spent a long time working with Blender and Photoshop to try creating realistic textures in my 3D scenes or editing some artwork to give it a vintage handmade look so the process feels a little intuitive to me. In Photoshop I would be:</p> <ol><li>Applying noise or something filter to slightly jitter the pixels and “fray” the edges of individual color sections.</li> <li>Overlaying some existing textures with blend modes to merge separate layers of noise and blurs. Blend modes are awesome! <code>Overlay</code>, <code>Soft Light</code>, <code>Hard Light</code> etc. can be used to modify the image over itself.</li> <li>Using a lighting effect like ‘Bevel and Emboss’ to create highlights and shadows based on a light source, making the threads look raised rather than flat.</li> <li>Tweaking the curves or levels to play with the colors.</li></ol> <p>Listing it out, that doesn’t seem too complicated does it? You could probably learn more about each of these things and follow some tutorials to learn how to do it in Photoshop. Since ImageMagick is “headless” Photoshop, and you already know what to do, you can begin implementing this process using not a GUI but ImageMagick commands. I read docs for this, but also use Claude to help me out with constructing these commands.</p> <h2 id="part-3-post-processing-the-base-image"><a href="#part-3-post-processing-the-base-image">Part 3: Post-processing the base image</a></h2> <p>Here is what each stage of post-processing looks like, zoomed into a section of the plot. You can see the effect come together from the flat embroidery of <code>Step 2</code> to the slightly exaggerated last frame where we make the patchwork stitches look raised.</p> <p><a href="https://aman.bh/_app/immutable/assets/IMG-20251230000459299.BiyqBwSz.png" data-img="/_app/immutable/assets/IMG-20251230000459299.BiyqBwSz.png" data-width="2100" data-height="1920" data-alt="Six-panel comparison showing progression of post-processing: original embroidery, after spread, after noise blend, and final with shading"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/IMG-20251230000459299.RhipslhR.avif 1050w, /_app/immutable/assets/IMG-20251230000459299.DMOnwju9.avif 2100w" type="image/avif"/><source srcset="/_app/immutable/assets/IMG-20251230000459299.C-_rafQ1.webp 1050w, /_app/immutable/assets/IMG-20251230000459299.BLPAKjxg.webp 2100w" type="image/webp"/><source srcset="/_app/immutable/assets/IMG-20251230000459299.ByGm3T7p.png 1050w, /_app/immutable/assets/IMG-20251230000459299.BiyqBwSz.png 2100w" type="image/png"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/IMG-20251230000459299.BiyqBwSz.png" alt="Six-panel comparison showing progression of post-processing: original embroidery, after spread, after noise blend, and final with shading" width="2100" height="1920" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p>We’ll go through them one by one.</p> <p>I start with the <code>-spread</code> command in ImageMagick, which randomly displaces pixels by a small amount—think of it as giving each pixel a tiny random nudge. The <code>2</code> parameter means each pixel can move up to 2 pixels away from its original position.</p> <pre><code><span data-line-number="1"><span>magick step2_embroidery.png -spread 2 step3_spread.png</span></span></code></pre> <p>Looking at the output in <code>Step 3</code>, you can see that the edges aren’t sharp lines anymore. They bleed into the background and a little into one another.</p> <p>Next, I needed to try and create the texture of the fabric itself. Even if there isn’t embroidery in a specific spot (the flat background, for example), the cloth itself has a weave. I simulated this by generating random Gaussian noise and then blurring it in a single vertical direction. This creates faint vertical streaks that run down the entire image. When I blend this back onto the main image using <code>SoftLight</code>, it makes the background feel like it has a vertical grain/ridges.</p> <pre><code><span data-line-number="1"><span>magick step3_spread.png \</span></span><span data-line-number="2"><span>    </span><span>\(</span><span> \</span></span><span data-line-number="3"><span>        +clone \</span></span><span data-line-number="4"><span>        +noise Gaussian \</span></span><span data-line-number="5"><span>        -motion-blur 0x8+90 \</span></span><span data-line-number="6"><span>        -colorspace Gray \</span></span><span data-line-number="7"><span>        -auto-level \</span></span><span data-line-number="8"><span>    </span><span>\)</span><span> \</span></span><span data-line-number="9"><span>    -compose SoftLight \</span></span><span data-line-number="10"><span>    -composite \</span></span><span data-line-number="11"><span>    step4_noise_blend.png</span></span></code></pre> <p>This command is doing several things inside the parentheses:</p> <ul><li><code>+clone</code> copies the current image so we can work on a separate layer</li> <li><code>+noise Gaussian</code> adds random noise to that copy</li> <li><code>-motion-blur 0x8+90</code> blurs that noise vertically (the <code>90</code> is the angle in degrees)</li> <li><code>-colorspace Gray</code> removes colour information</li> <li><code>-auto-level</code> stretches the brightness range to use the full spectrum</li> <li><code>-compose SoftLight -composite</code> blends this texture back onto our original using Photoshop’s Soft Light blend mode</li></ul> <p>You can see each of these steps in the frames below. We add some grain, blur it a lot, remove any colours that would make it harder to blend it back and then overlay the grayscale texture over the original image.</p> <p><a href="https://aman.bh/_app/immutable/assets/IMG-20251230000459378.BDyyeLb0.png" data-img="/_app/immutable/assets/IMG-20251230000459378.BDyyeLb0.png" data-width="2780" data-height="825" data-alt="Five-panel showing the noise texture pipeline: original, with Gaussian noise, after motion blur, and final soft light blend"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/IMG-20251230000459378.DWu-ENUX.avif 1390w, /_app/immutable/assets/IMG-20251230000459378.wQhfW6Az.avif 2780w" type="image/avif"/><source srcset="/_app/immutable/assets/IMG-20251230000459378.C9Mrl7ng.webp 1390w, /_app/immutable/assets/IMG-20251230000459378.CqoqABei.webp 2780w" type="image/webp"/><source srcset="/_app/immutable/assets/IMG-20251230000459378.CzmdhaMC.png 1390w, /_app/immutable/assets/IMG-20251230000459378.BDyyeLb0.png 2780w" type="image/png"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/IMG-20251230000459378.BDyyeLb0.png" alt="Five-panel showing the noise texture pipeline: original, with Gaussian noise, after motion blur, and final soft light blend" width="2780" height="825" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p>I think this already looks much more interesting than the flat embroidery image we started off with. Grain and blend modes make everything better. At the moment it looks a little too dark but we’ll fix it in the end.</p> <p><a href="https://aman.bh/_app/immutable/assets/step4b_noise_blend.CRctqV6o.jpeg" data-img="/_app/immutable/assets/step4b_noise_blend.CRctqV6o.jpeg" data-width="2000" data-height="2500" data-alt="step4b_noise_blend"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/step4b_noise_blend.BKBEyhHm.avif 1000w, /_app/immutable/assets/step4b_noise_blend.Bowyld3K.avif 2000w" type="image/avif"/><source srcset="/_app/immutable/assets/step4b_noise_blend.DaR0HNr2.webp 1000w, /_app/immutable/assets/step4b_noise_blend.DT7tdFlK.webp 2000w" type="image/webp"/><source srcset="/_app/immutable/assets/step4b_noise_blend.BRL1okIT.jpeg 1000w, /_app/immutable/assets/step4b_noise_blend.CRctqV6o.jpeg 2000w" type="image/jpeg"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/step4b_noise_blend.CRctqV6o.jpeg" alt="step4b_noise_blend" width="2000" height="2500" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p>We still have one last thing to do which is giving our fabric and the things ‘embroidered’ onto it a gentle 3D, tactile look. In Photoshop, you’d do this with bevel and emboss filters. In ImageMagick, we have <strong>shade maps</strong>.</p> <p>Once again, we take the input from the previous step, turn it grayscale and blur it a little. The reason for this constant blurring and grayscaling is that we don’t want to accentuate uncessary details like minute shapes or make things look out of whack when we blend images on top of each other; having it grayscale and slightly out of focus makes that blending job simpler. Grayscale is also what we use for depth maps when working in 3D software! Whites means the objects are closer (or <em>higher</em>) and blacks push the objects back (lower).</p> <p>I then used the <code>-shade</code> operator to generate a 3D elevation map of the image, pretending there is a light source coming from the top-left (120 degrees). If you’ve used QGIS to process DEMs or Blender before, these terms may be familiar to you. This creates highlights on the “ridges” of the noise and shadows in the valleys. By overlaying this heavily contrast-stretched grayscale map, the flat image pops with highlights and shadows.</p> <pre><code><span data-line-number="1"><span>magick step4_noise_blend.png \</span></span><span data-line-number="2"><span>    </span><span>\(</span><span> \</span></span><span data-line-number="3"><span>        +clone \</span></span><span data-line-number="4"><span>        -colorspace Gray \</span></span><span data-line-number="5"><span>        -blur 0x2 \</span></span><span data-line-number="6"><span>        -shade 120x55 \</span></span><span data-line-number="7"><span>        -auto-level \</span></span><span data-line-number="8"><span>        -contrast-stretch 5%x5% \</span></span><span data-line-number="9"><span>    </span><span>\)</span><span> \</span></span><span data-line-number="10"><span>    -compose Overlay \</span></span><span data-line-number="11"><span>    -composite \</span></span><span data-line-number="12"><span>    step5_shading.png</span></span></code></pre> <p>Breaking down the new operators:</p> <ul><li><code>-shade 120x55</code> creates 3D shading by simulating a light source. The <code>120</code> is the azimuth angle (direction of light) and <code>55</code> is the elevation angle.</li> <li><code>-contrast-stretch 5%x5%</code> boosts the contrast by clipping the extreme 5% of values at both ends, making highlights brighter and shadows darker.</li> <li>We create the shade map and use <code>Overlay</code> to blend this new 3D scene into our plot.</li></ul> <p>Here is how that lighting map gets constructed, from the grayscale conversion to the final blend.</p> <p><a href="https://aman.bh/_app/immutable/assets/IMG-20251230000459439.ndWkiB8Q.png" data-img="/_app/immutable/assets/IMG-20251230000459439.ndWkiB8Q.png" data-width="2780" data-height="825" data-alt="Five-panel showing shading creation: previous result, grayscale version, after shade operator, and final overlay blend"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/IMG-20251230000459439.MdsrtooO.avif 1390w, /_app/immutable/assets/IMG-20251230000459439.CucWCPn_.avif 2780w" type="image/avif"/><source srcset="/_app/immutable/assets/IMG-20251230000459439.CPnGvii2.webp 1390w, /_app/immutable/assets/IMG-20251230000459439.CQGcYbcb.webp 2780w" type="image/webp"/><source srcset="/_app/immutable/assets/IMG-20251230000459439.B2od-iRW.png 1390w, /_app/immutable/assets/IMG-20251230000459439.ndWkiB8Q.png 2780w" type="image/png"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/IMG-20251230000459439.ndWkiB8Q.png" alt="Five-panel showing shading creation: previous result, grayscale version, after shade operator, and final overlay blend" width="2780" height="825" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <p>Look at that last frame, it looks 3D now!! All this texturing and shading tends to wash out the colors a bit and so the final step is a simple color boost. I bump the brightness up to 115% and the saturation to 105%. It’s a small tweak, but it brings the life back into the image.</p> <pre><code><span data-line-number="1"><span>magick step5_shading.png -modulate 115,105,100 step6_final.png</span></span></code></pre> <p>The three numbers in <code>-modulate</code> control brightness, saturation, and hue respectively, all as percentages of the original. So <code>115,105,100</code> means 115% brightness, 105% saturation, and no hue change.</p> <p>And that’s it! It seems like a mess of commands, but I think the result is worth it. When you put it all together in the next section, you won’t even have to worry about it more than just tweaking a few values. Here’s what our nice chart looks like now.</p> <p><a href="https://aman.bh/_app/immutable/assets/crossword_trend.zlkUTGxv.png" data-img="/_app/immutable/assets/crossword_trend.zlkUTGxv.png" data-width="1200" data-height="1500" data-alt="The final embroidered chart with textured, 3D-looking stitches, vibrant colors, and that handmade sweater aesthetic"><!--[--><!--[!--><picture><!--[--><source srcset="/_app/immutable/assets/crossword_trend.CVzi7x3l.avif 600w, /_app/immutable/assets/crossword_trend.BxvzLNVv.avif 1200w" type="image/avif"/><source srcset="/_app/immutable/assets/crossword_trend.DAu6nVv9.webp 600w, /_app/immutable/assets/crossword_trend.uEpWL0Bp.webp 1200w" type="image/webp"/><source srcset="/_app/immutable/assets/crossword_trend.DuMEAyCK.png 600w, /_app/immutable/assets/crossword_trend.zlkUTGxv.png 1200w" type="image/png"/><!--]--> <img src="https://aman.bh/_app/immutable/assets/crossword_trend.zlkUTGxv.png" alt="The final embroidered chart with textured, 3D-looking stitches, vibrant colors, and that handmade sweater aesthetic" width="1200" height="1500" onload="this.__e=event" onerror="this.__e=event"/></picture><!--]--><!--]--><!----></a></p> <h2 id="final-function"><a href="#final-function">Final Function</a></h2> <p>Here’s a complete R function that wraps up the entire pipeline, including the <code>embroidery.sh</code> script and the post-processing steps.</p> <pre><code><span data-line-number="1"><span>apply_embroidery_effect</span><span> </span><span>&lt;-</span><span> </span><span>function</span><span>(</span><span>input_file</span><span>, </span><span>output_file</span><span>, </span><span>numcolors</span><span> </span><span>=</span><span> </span><span>8</span><span>)</span><span> </span><span>{</span></span><span data-line-number="2"><span>  </span><span># Step 1: Run the embroidery script</span></span><span data-line-number="3"><span>  </span><span>temp_emb</span><span> </span><span>&lt;-</span><span> </span><span>tempfile</span><span>(</span><span>fileext</span><span> </span><span>=</span><span> </span><span>&#34;</span><span>.png</span><span>&#34;</span><span>)</span></span><span data-line-number="4"></span><span data-line-number="5"><span>  </span><span>system2</span><span>(</span></span><span data-line-number="6"><span>    </span><span>&#34;</span><span>bash</span><span>&#34;</span><span>,</span></span><span data-line-number="7"><span>    </span><span>args</span><span> </span><span>=</span><span> </span><span>c</span><span>(</span></span><span data-line-number="8"><span>      </span><span>&#34;</span><span>./embroidery.sh</span><span>&#34;</span><span>,</span></span><span data-line-number="9"><span>      </span><span>&#34;</span><span>-n</span><span>&#34;</span><span>, </span><span>as.character</span><span>(</span><span>numcolors</span><span>),</span></span><span data-line-number="10"><span>      </span><span>&#34;</span><span>-p</span><span>&#34;</span><span>, </span><span>&#34;</span><span>linear</span><span>&#34;</span><span>,</span></span><span data-line-number="11"><span>      </span><span>&#34;</span><span>-t</span><span>&#34;</span><span>, </span><span>&#34;</span><span>3</span><span>&#34;</span><span>,</span></span><span data-line-number="12"><span>      </span><span>&#34;</span><span>-g</span><span>&#34;</span><span>, </span><span>&#34;</span><span>0</span><span>&#34;</span><span>,</span></span><span data-line-number="13"><span>      </span><span>input_file</span><span>,</span></span><span data-line-number="14"><span>      </span><span>temp_emb</span></span><span data-line-number="15"><span>    )</span></span><span data-line-number="16"><span>  )</span></span><span data-line-number="17"></span><span data-line-number="18"><span>  </span><span># Step 2: Apply sweater texture post-processing</span></span><span data-line-number="19"><span>  </span><span>magick_args</span><span> </span><span>&lt;-</span><span> </span><span>c</span><span>(</span></span><span data-line-number="20"><span>    </span><span>temp_emb</span><span>,</span></span><span data-line-number="21"><span>    </span><span>&#34;</span><span>-spread 2</span><span>&#34;</span><span>,</span></span><span data-line-number="22"><span>    </span><span>&#34;</span><span>\\</span><span>( +clone +noise Gaussian -motion-blur 0x8+90 -colorspace Gray -auto-level </span><span>\\</span><span>)</span><span>&#34;</span><span>,</span></span><span data-line-number="23"><span>    </span><span>&#34;</span><span>-compose SoftLight -composite</span><span>&#34;</span><span>,</span></span><span data-line-number="24"><span>    </span><span>&#34;</span><span>\\</span><span>( +clone -colorspace Gray -blur 0x2 -shade 120x55 -auto-level -contrast-stretch 5%x5% </span><span>\\</span><span>)</span><span>&#34;</span><span>,</span></span><span data-line-number="25"><span>    </span><span>&#34;</span><span>-compose Overlay -composite</span><span>&#34;</span><span>,</span></span><span data-line-number="26"><span>    </span><span>&#34;</span><span>-modulate 115,105,100</span><span>&#34;</span><span>,</span></span><span data-line-number="27"><span>    </span><span>output_file</span></span><span data-line-number="28"><span>  )</span></span><span data-line-number="29"></span><span data-line-number="30"><span>  </span><span>system</span><span>(</span><span>paste</span><span>(</span><span>&#34;</span><span>magick</span><span>&#34;</span><span>, </span><span>paste</span><span>(</span><span>magick_args</span><span>, </span><span>collapse</span><span> </span><span>=</span><span> </span><span>&#34;</span><span> </span><span>&#34;</span><span>)))</span></span><span data-line-number="31"></span><span data-line-number="32"><span>  </span><span># Clean up temp file</span></span><span data-line-number="33"><span>  </span><span>unlink</span><span>(</span><span>temp_emb</span><span>)</span></span><span data-line-number="34"><span>}</span></span></code></pre> <p>To use this in your workflow, save your ggplot chart with <code>ggsave()</code> and then pass it through <code>apply_embroidery_effect()</code>. The entire pipeline becomes reproducible! When your data changes, you just re-run the script and everything regenerates.</p> <p>One important thing to note here is that you are working with a strictly limited palette of colours. Since the <code>embroidery.sh</code> script quantizes your color palette into a limited set of colours, don’t use color as a form of encoding your data. Gradients are out of the window. I recommend going through this excellent post by <a href="https://nrennie.rbind.io/blog/monochrome-data-visualisations/" rel="nofollow">Nicola Rennie</a> to see how she discusses monochrome dataviz and alternate encoding methods (shapes, textures, size etc.). You can use the same principles here. Secondly, these plots need to be of large size for a good quality look. I export these in 300 DPI in a 2000x2500 picture size. Adjust your font sizes accordingly.</p> <hr/> <p>The main takeaway for me is that existing knowledge of image editing translates directly to programmatic pipelines. I can’t memorize ImageMagick flags, although I am a lot more familiar with these specific ones now. But to start off with, I knew what I wanted from years of Photoshop work of learning when to blur this, blend that, add shading etc. and used LLMs to help construct the actual commands. Understanding what to ask for is the hard part, I think the syntax is just details.</p> <p>I think this is worth experimenting with more, I’ve never thought about treating <code>ggplot</code> charts as an image-editing exercise and this opens up whole new possibilities for exploration. At some point I would like to be able to render ggplot graphics on PBR textures for authentic displacement and texture effects too.</p> <p>The code (pushed as-is without cleanup) for my original post is available in <a href="https://github.com/thedivtagguy/word-games-analysis/" rel="nofollow">this repository</a>, feel free to adapt it to your needs.</p> <!----><!--]--><!--]--></div></div>
  </body>
</html>
