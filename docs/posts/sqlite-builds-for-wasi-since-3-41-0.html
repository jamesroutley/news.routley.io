<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://wasmlabs.dev/articles/sqlite-wasi-support/">Original</a>
    <h1>SQLite builds for WASI since 3.41.0</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>The <a href="https://wasmlabs.dev">Wasm Labs team</a> worked with the SQLite team to upstream WASI support. Starting with <a href="https://sqlite.org/releaselog/3_41_0.html">SQLite 3.41.0</a> you can build <code>libsqlite3.a</code> for WASI by running:</p>
<pre><code><span>./configure --with-wasi-sdk=$WASI_SDK_PATH --enable-all</span></code></pre>
<p>We are excited about the official support as these changes make it easier to use SQLite in any WASI environment. We recently published precompiled Wasm binaries for <a href="https://github.com/vmware-labs/webassembly-language-runtimes/releases/tag/libs%2Fsqlite%2F3.41.2%2B20230329-43f9aea">libsqlite 3.41.2</a> using these new build options.</p>

<p>A major goal for our work on the <a href="https://wasmlabs.dev/projects/wasm-language-runtimes/">WebAssembly Language Runtimes</a> is to contribute back to the original projects whenever possible.</p>
<p>We wanted to contribute upstream our patches for SQLite, as we were heavily relying on <code>libsqlite</code> for our tests of <a href="https://github.com/vmware-labs/webassembly-language-runtimes/releases/tag/php%2F8.2.0%2B20230217-0ce5fde">PHP.wasm</a> with WordPress and Drupal.</p>
<h2 id="collaborating-with-the-sqlite-team" tabindex="-1">Collaborating with the SQLite team</h2>
<p>A few months ago we got in touch with the SQLite team to see what would be the best way to add WASI support to their official releases. It turned out that the process for contributing to SQLite is somewhat different from what most of us are used to. For legal reasons, we could not contribute directly, but we could discuss the required changes with someone from the SQLite team and then iterate with them by testing or commenting.</p>
<p>This led to a fun and enriching conversation with Stephan Beal from the SQLite team, who over a few iterations, simplified and improved the patches for a WASI build into what we have today.</p>
<h2 id="previous-work" tabindex="-1">Previous work</h2>
<p>The work to port SQLite to WASI has a history of several teams and projects which pioneered those changes.</p>
<ul>
<li>We built on the work done in <a href="https://github.com/rcarmo/wasi-sqlite">rcarmo/wasi-sqlite</a>, which was a joint effort by <a href="https://github.com/rcarmo">Rui Carmo</a> and <a href="https://github.com/holzschu">Nicolas Holzschuch</a> for the sake of <a href="https://github.com/holzschu/a-shell">a-Shell</a>.</li>
<li>Their work was inspired by <a href="https://github.com/wapm-packages/sqlite">wapm-packages/sqlite</a>, a work by <a href="https://github.com/syrusakbary">Syrus Akbary</a> and <a href="https://github.com/MarkMcCaskey">Mark McCaskey</a>. This package gives credit to <a href="https://github.com/ericsink/wasm2cil/tree/master/sqlite3">ericsink/wasm2cil</a>, by <a href="https://github.com/ericsink">Eric Sink</a>.</li>
</ul>
<h2 id="future-work" tabindex="-1">Future work</h2>
<p>We still don&#39;t build SQLite CLI. This was never necessary for our needs, but working towards it will complete the SQLite experience.</p>
<p>There are a bunch of features (like Write-Ahead Logging, loadable extensions, etc) that are disabled in this SQLite build, because they cannot be implemented with WASI preview1 as of today. Given time and WASI preview2, we expect to implement those as well.</p>
<h2 id="try-it-out" tabindex="-1">Try it out</h2>
<p>Try out the <a href="https://github.com/vmware-labs/webassembly-language-runtimes/releases?q=libs%2Fsqlite&amp;expanded=true">latest <code>libsqlite</code> release</a> and let us know what you think!</p>
<p>(10 min) Take a look at the sample app at <a href="https://github.com/vmware-labs/webassembly-language-runtimes/tree/main/libs/examples/sqlite_example">WLR/libs/examples/sqlite_example</a>, which can be built for wasm32-wasi.</p>
</div></div>
  </body>
</html>
