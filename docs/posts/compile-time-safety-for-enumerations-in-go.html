<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://vladimir.varank.in/notes/2023/09/compile-time-safety-for-enumerations-in-go/">Original</a>
    <h1>Compile-time safety for enumerations in Go</h1>
    
    <div id="readability-page-1" class="page"><div><header></header><p>Last month, a colleague of mine asked how to reason about enumerated values (‚Äúenums‚Äù) in Go. They wanted to benefit from Go‚Äôs type-safety and to prevent users from misusing the package.</p><p>For an imaginary example, that enumerates possible colours, the snippet below shows how we typically implement this:</p><pre tabindex="0"><code>type Color string

const (
    Red   Color = &#34;red&#34;
    Green Color = &#34;green&#34;
    Blue  Color = &#34;blue&#34;
)
</code></pre><p>But, just like <a href="https://twitter.com/goinggodotnet/">Bill Kennedy</a> illustrated it in the <a href="https://www.ardanlabs.com/blog/2023/09/implementing-enumerations-in-golang.html">blog post on a similar topic</a>, such implementation allows a user to pass any ‚Äú<a href="https://go.dev/blog/constants#string-constants">untyped constant string</a>‚Äù in places where the <code>Color</code> type is expected. Also, a user can declare their own value of a type <code>Color</code>, going beyond what was defined by the initial enumeration set.</p><pre tabindex="0"><code>package main

func main() {
    PrintColor(color.Red)

    PrintColor(&#34;RAINBOW&#34;)

    var rainbow color.Color = &#34;üåà&#34;
    PrintColor(rainbow)
}

func PrintColor(c color.Color) {
    fmt.Printf(&#34;%v\n&#34;, c)
}

// Outputs:
red
RAINBOW
üåà
</code></pre><p>Note how in the snippet above, the user both called <code>PrintColor(‚ÄúRAINBOW‚Äù)</code> and defined their own variable of type <code>color.Color</code>, which holds a random string.</p><p><em>Update: a number of people pointed at my choice of words in the paragraph below, where I introduce a way to solve the problems. Indeed, ‚Äúelegant‚Äù isn‚Äôt the most accurate one to describe this solution :) Also, refer to <a href="https://go.dev/issues/19412">#19412</a> for the discussion about adding sum types to Go.</em></p><hr/><p>Go‚Äôs type system allows preventing both issues <del>in a rather elegant way</del>. Let‚Äôs declare the <code>Color</code> interface, with an <em>unexported method</em>, while implementing this interface in an unexported type <code>color</code>:</p><pre tabindex="0"><code>package color

type Color interface {
    xxxProtected()
}

type color string

func (c color) xxxProtected() {}

const (
	Red   color = &#34;red&#34;
	Green color = &#34;green&#34;
	Blue  color = &#34;blue&#34;
)
</code></pre><p>Because no types outside of our package <code>color</code> can implement the unexported method <code>color.Color.xxxProtected()</code>, we limit the possible implementations of the <code>Color</code> interface to only values, defined in the package <code>color</code>.</p><pre tabindex="0"><code>package main

func main() {
    PrintColor(color.Red)

    //PrintColor(&#34;RAINBOW&#34;) // cannot use (constant of type string) as color.Color
}

func PrintColor(c color.Color) {
    fmt.Printf(&#34;%v\n&#34;, c)
}
</code></pre><p>If a user tries to pass an untyped constant string or declare their own variant of the colour, the code won‚Äôt compile, resulting with an error:</p><pre tabindex="0"><code>package main

type mycolor string

func (c mycolor) xxxProtected() {}

func main() {
    black := mycolor(&#34;BLACK&#34;)
    PrintColor(black)
}

OUTPUTS:
./prog.go:9:13: cannot use black (variable of type mycolor) as color.Color value in argument to PrintColor:
mycolor does not implement color.Color (missing method xxxProtected)
</code></pre><p><em>Have you stumbled upon a scenario, where such strict compile-time checks for enumerated values was needed? Share your thoughts with me on <a href="https://news.ycombinator.com/item?id=37703175">Hacker News</a>, <a href="https://twitter.com/tvii/status/1707736145524600838">Twitter</a> or <a href="https://bsky.app/profile/vladimir.varank.in/post/3kajuu4lrn52b">Bluesky</a>.</em></p><section><header><h3>All topics</h3></header><a href="https://vladimir.varank.in/notes/apple/">apple</a><a href="https://vladimir.varank.in/notes/arduino/">arduino</a><a href="https://vladimir.varank.in/notes/arm64/">arm64</a><a href="https://vladimir.varank.in/notes/askme/">askme</a><a href="https://vladimir.varank.in/notes/aws/">aws</a><a href="https://vladimir.varank.in/notes/berlin/">berlin</a><a href="https://vladimir.varank.in/notes/bookmarks/">bookmarks</a><a href="https://vladimir.varank.in/notes/buildkit/">buildkit</a><a href="https://vladimir.varank.in/notes/cgo/">cgo</a><a href="https://vladimir.varank.in/notes/coffee/">coffee</a><a href="https://vladimir.varank.in/notes/continuous-profiling/">continuous profiling</a><a href="https://vladimir.varank.in/notes/covid-19/">COVID-19</a><a href="https://vladimir.varank.in/notes/design/">design</a><a href="https://vladimir.varank.in/notes/docker/">docker</a><a href="https://vladimir.varank.in/notes/dynamodb/">dynamodb</a><a href="https://vladimir.varank.in/notes/e-paper/">e-paper</a><a href="https://vladimir.varank.in/notes/english/">english</a><a href="https://vladimir.varank.in/notes/enum/">enum</a><a href="https://vladimir.varank.in/notes/esp8266/">esp8266</a><a href="https://vladimir.varank.in/notes/firefox/">firefox</a><a href="https://vladimir.varank.in/notes/github-actions/">github actions</a><a href="https://vladimir.varank.in/notes/go/">Go</a><a href="https://vladimir.varank.in/notes/google/">google</a><a href="https://vladimir.varank.in/notes/graphql/">graphql</a><a href="https://vladimir.varank.in/notes/homelab/">homelab</a><a href="https://vladimir.varank.in/notes/ipv6/">IPv6</a><a href="https://vladimir.varank.in/notes/k3s/">k3s</a><a href="https://vladimir.varank.in/notes/kubernetes/">kubernetes</a><a href="https://vladimir.varank.in/notes/linux/">linux</a><a href="https://vladimir.varank.in/notes/macos/">macos</a><a href="https://vladimir.varank.in/notes/material-design/">material design</a><a href="https://vladimir.varank.in/notes/mdns/">mDNS</a><a href="https://vladimir.varank.in/notes/music/">music</a><a href="https://vladimir.varank.in/notes/ndppd/">ndppd</a><a href="https://vladimir.varank.in/notes/neondatabase/">neondatabase</a><a href="https://vladimir.varank.in/notes/objective-c/">objective-c</a><a href="https://vladimir.varank.in/notes/passkeys/">passkeys</a><a href="https://vladimir.varank.in/notes/postgresql/">postgresql</a><a href="https://vladimir.varank.in/notes/pprof/">pprof</a><a href="https://vladimir.varank.in/notes/profefe/">profefe</a><a href="https://vladimir.varank.in/notes/random/">random</a><a href="https://vladimir.varank.in/notes/raspberry-pi/">raspberry pi</a><a href="https://vladimir.varank.in/notes/rust/">rust</a><a href="https://vladimir.varank.in/notes/travis-ci/">travis ci</a><a href="https://vladimir.varank.in/notes/vs-code/">vs code</a><a href="https://vladimir.varank.in/notes/waveshare/">waveshare</a><a href="https://vladimir.varank.in/notes/%C2%B5-benchmarks/">¬µ-benchmarks</a></section></div></div>
  </body>
</html>
