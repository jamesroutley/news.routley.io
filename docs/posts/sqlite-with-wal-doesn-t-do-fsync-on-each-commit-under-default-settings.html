<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://avi.im/blag/2025/sqlite-fsync/">Original</a>
    <h1>SQLite (with WAL) doesn&#39;t do `fsync` on each commit under default settings</h1>
    
    <div id="readability-page-1" class="page"><div><article><p>SQLite has a WAL mode (the default is journal mode), but youâ€™re likely using it if you want higher write throughput. SQLite also has a PRAGMA called <code>synchronous</code> which configures how <code>fsync</code> is called. The default is <code>NORMAL</code>. This is what the docs say:</p><blockquote><p>[..] but WAL mode does lose durability. A transaction committed in WAL mode with <code>synchronous=NORMAL</code> might roll back following a power loss or system crash.</p></blockquote><blockquote><p>In WAL mode when synchronous is <code>NORMAL (1)</code>, the WAL file is synchronized before each checkpoint and the database file is synchronized after each completed checkpoint and the WAL file header is synchronized when a WAL file begins to be reused after a checkpoint, but no sync operations occur during most transactions.</p></blockquote><blockquote><p>If durability is not a concern, then synchronous=NORMAL is normally all one needs in WAL mode.</p></blockquote><p>If you want <code>fsync</code> to be called on each commit, use <code>FULL</code>:</p><blockquote><p>With <code>synchronous=FULL</code> in WAL mode, an additional sync operation of the WAL file happens after each transaction commit. The extra WAL sync following each transaction helps ensure that transactions are durable across a power loss. Transactions are consistent with or without the extra syncs provided by <code>synchronous=FULL</code>.</p></blockquote><p><a href="https://www.sqlite.org/pragma.html#pragma_synchronous">https://www.sqlite.org/pragma.html#pragma_synchronous</a></p><hr/><p><small>Someone passed me this post <a href="https://blog.cf8.gg/surrealdbs-ch/">SurrealDB is sacrificing data durability to make benchmarks look better</a> and asked me how SQLite works.</small></p></article></div></div>
  </body>
</html>
