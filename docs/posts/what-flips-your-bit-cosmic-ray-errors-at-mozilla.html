<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.mozilla.org/data/2022/04/13/this-week-in-glean-what-flips-your-bit/">Original</a>
    <h1>What Flips Your Bit: Cosmic Ray Errors at Mozilla</h1>
    
    <div id="readability-page-1" class="page"><article id="post-402">
  

  <div>
    <p><i>(“This Week in Glean” is a series of blog posts that the Glean Team at Mozilla is using to try to communicate better about our work. They could be release notes, documentation, hopes, dreams, or whatever: so long as it is inspired by Glean. You can find an</i><a href="https://mozilla.github.io/glean/book/appendix/twig.html"><i> index of all TWiG posts online</i></a><i>.)</i></p>
<p>The idea of “<a href="https://en.wikipedia.org/wiki/Soft_error">soft-errors</a>”, particularly “<a href="https://en.wikipedia.org/wiki/Single-event_upset">single-event upsets</a>” often comes up when we have strange errors in telemetry. Single-event upsets are defined as: “a change of state caused by one single ionizing particle (ions, electrons, photons…) striking a sensitive node in a micro-electronic device, such as in a microprocessor, semiconductor memory, or power transistors. The state change is a result of the free charge created by<a href="https://en.wikipedia.org/wiki/Ionization"> ionization</a> in or close to an important node of a logic element (e.g. memory “bit”)”. And what exactly causes these single-event upsets? Well, from the same Wikipedia article: “Terrestrial SEU arise due to cosmic particles colliding with atoms in the atmosphere, creating cascades or showers of neutrons and protons, which in turn may interact with electronic circuits”. In other words, energy from space can affect your computer and turn a 1 into a 0 or vice versa.</p>
<p>There are examples in our data collected by Glean from Mozilla projects like Firefox, that appear to be malformed by a single bit from the value we would expect. In almost every case we cannot find any plausible explanation or bug in any of the infrastructure from client to analysis, so we often shrug and say “oh well, it must be cosmic rays”. A totally fantastical explanation for an empirical measurement of some anomaly that we cannot explain.</p>
<p>What if it <i>wasn’t</i> just some fantastical explanation? What if there was some grain of truth in there and somehow we could <i>detect cosmic rays with browser telemetry data?</i> I was personally struck with these questions, recently, as I became aware of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1762568">a recent bug that was filed</a> that described just these sorts of errors in their data. These errors were showing up as strings with a single character different in the data (well, a single <i>bit</i> actually). At about the same time, I read <a href="https://www.space.com/solar-storm-aurora-displays-march-2022">an article about a geomagnetic storm that hit at the end of March</a>. Something clicked and I started to really wonder if we could possibly have detected a cosmic event through these single-event upsets in our telemetry data.</p>
<p>I did a little research to see if there was any data on the frequency of these events and found a handful of articles (<a href="https://www.scientificamerican.com/article/solar-storms-fast-facts/">for instance</a>) that kept referring to a study done by IBM in the 1990’s that referenced 1 cosmic ray bit flip per 256MB of memory per month. After a little digging, I was able to come up with two papers by <a href="http://srim.org/JFZ_BIO.HTM">J.F. Ziegler</a>, an IBM researcher. The first paper, from 1979, on “<a href="https://www.science.org/doi/10.1126/science.206.4420.776">The Effects of Cosmic Rays on Computer Memories</a>”, goes into the mechanisms by which cosmic rays can affect bits in computer memory, and makes some rough estimates on the frequency of such events, as well as the effect of elevation on the frequency. The later article from the 1990’s, “<a href="https://ieeexplore.ieee.org/abstract/document/5389434">Accelerated Testing For Cosmic Soft-Error Rate</a>”, went more in detail in measuring the soft-error rates of different chips by different manufacturers. While I never found the exact source of the “1 bit-flip per 256MB per month” quote in either of these papers, the figure could <i>possibly</i> be generalized from the soft-error rate data in the papers. So, while I’m not entirely sure that that number for the rate is accurate, it’s probably close enough for us to do some simple calculations.</p>
<p>So, now that I had checked out the facts behind cosmic ray induced errors, it was time to see if there was any evidence of this in our data. First of all, where could I find these errors, and where would I <i>most likely</i> find these sorts of errors? I thought about the types of data that we collect and decided that a numeric field would be nearly impossible to detect a bit-flip within, unless it was a field with a very limited expected range. String fields seemed to be a little easier candidate to search for, since single bit flips tend to make strings a little weird due to a single unexpected character. There are also some good places to go looking for bit flips in our error streams too, such as when a column or table name is affected. Secondly, I had to make a few hand-wavy assumptions in order to crunch some numbers. The main assumption is that every bit in our data has the same chance of being flipped as any other bit in any other memory. The secondary assumption is that the bits are getting flipped at the client side of the connection, and not while on our servers.</p>
<p>We have a lot of users, and the little bit of data we collect from each client really adds up. Let’s convert that error rate to some more compatible units. Using the 1/256MB/month figure from the article, that’s 4096 cosmic soft-errors per terabyte per month. <a href="https://youtu.be/Z-6xaTckB20?t=25">According to my colleague, chutten</a>, we receive about 100 terabytes of data per day, or 2800 TB in a 4 week period. If we multiply that out, it looks like we have the potential to find 11,468,800 bit flips in a given 4 week period of our data. WHAT! That seemed like an awful lot of possibilities, even if I suspect a good portion of them to be undetectable just due to not being an “obvious” bit flip.</p>
<p>Looking at the <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1762568">Bugzilla issue</a> that had originally sparked my interest in this, it contained some evidence of labels embedded in the data being affected by bit-flips. This was pretty easy to spot because we knew what labels we were expecting and the handful of anomalies stood out. Not only that, the effect seemed to be somewhat localized to a geographical area. Maybe this wasn’t such a bad place to try and correlate this information with space-weather forecasts. Back to the internet and I find an <a href="https://www.express.co.uk/news/science/1580170/solar-storm-update-earth-hit-hard-ejection-sun-radio-GPS-warning">interesting space-weather article</a> that seems to line up with the dates from the bug. I finally hit a bit of a wall in this fantastical investigation when I found it difficult to get data on solar radiation by day and geographical location. There is a rather nifty site, <a href="https://www.spaceweatherlive.com/">SpaceWeatherLive.com</a> which has quite a bit of interesting data on solar radiation, but I was starting to hit the limits of my current knowledge and the limits on time that I had set out for myself to write this blog post.</p>
<p>So, rather reluctantly, I had to set aside any deeper investigations into this for another day. I do leave the search here feeling that not only is it possible that our data contains signals for cosmic activity, but that it is very likely that it could be used to correlate or even measure the impact of cosmic ray induced single-event upsets. I hope that sometime in the future I can come back to this and dig a little deeper. Perhaps someone reading this will also be inspired to poke around at this possibility and would be interested in collaborating on it, and if you are, you can reach me via the <a href="https://matrix.to/#/#glean:mozilla.org">Glean Channel</a> on Matrix as @travis. For now, I’ve turned something that seemed like a crazy possibility in my mind into something that seems a lot more likely than I ever expected. Not a bad investigation at all.</p>
      </div>

  
</article></div>
  </body>
</html>
