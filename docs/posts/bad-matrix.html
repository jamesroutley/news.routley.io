<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://evalapply.org/posts/bad-matrix/index.html">Original</a>
    <h1>Bad Matrix</h1>
    
    <div id="readability-page-1" class="page"><div id="the-very-top">
        
        <main id="main">
          <article id="blog-post">
  <header>
    <div>
      <p>Bad Matrix</p>
      
      <p>A while ago, someone in the Recurse Center nerdiverse decided we needed a &#34;Bad Print&#34;. They made one. Things escalated. Bad Matrix happened.</p>
      <p>
        <span>Published: 2023-02-14</span>
        <span>Updated: 2023-02-14</span>
        <span>Tags:  / <a href="https://evalapply.org/tags/riff/index.html#main">#riff</a> / <a href="https://evalapply.org/tags/bash/index.html#main">#bash</a>
        </span>
      </p>
      <hr/>
    </div>
  </header>
  <section>
      
<hr/>
  <video controls="">
<source src="bad_matrix_demo.webm"/>
</video>
<p>It would never have seen light of day, but fate intervened. The overlords at <em>NebCorp Heavy Industries and Sundries</em> recently chose to emblogginate and <a href="https://proclamations.nebcorp-hias.com/sundries/shit-code-and-performance-art/#bad-print-a-silly-program">resurrect the long-dead Bad Print thread</a> (pun intended).</p>

<p>Back then, thoughts originally appeared encoded in Haskell, prompting the dear reader this way…</p>
<blockquote>
<p>you probably didn&#39;t know that you needed a bad print function, one that spawns a thread for each character in your string and prints the single character before quitting… well, now that you know that you needed this, i&#39;ve written one for you</p>
<pre><code>$ cat &lt;&lt;EOF &gt;bad-print.hs
&gt; import qualified Control.Concurrent.Async as A
&gt; import qualified System.Environment as E
&gt;
&gt; main = head &lt;$&gt; E.getArgs &gt;&gt;= A.mapConcurrently putChar
&gt; EOF
$ ghc -threaded -rtsopts -with-rtsopts=-N bad-print.hs
[1 of 1] Compiling Main             ( bad-print.hs, bad-print.o )
Linking bad-print ...

$ ./bad-print &#39;hello there, world&#39;
h telloehre, world
$ ./bad-print &#39;oops, i think you meant *hello there, world*&#39;
oops, i tihnk you meant *hello there ,owrld*
$ ./bad-print &#34;that&#39;s more like it&#34;
st at&#39;hmore likei t
</code></pre>
<p>i wonder what bad print looks like in your language of choice?</p>
</blockquote>
<p>… and the original thread begat replies in Rayon, Ruby, Bash, C (repeatedly).</p>
<p>People rapidly converged to <code>Thread Per Character</code> as the one true performance metric for <em>bad print</em>. A Bash version claiming to provide <em>bad print</em> for all Unixen fetched the indignation of a resident <code>ksh</code> user, who filed a defect report that not every Unix comes with Bash installed by default.</p>
<p>They are, of course, all correct in their own ways.</p>
<p>Yours truly contributed their very forgettable version of <em>bad print</em>. Which is why it does not feature here. <em>However</em> for equally forgettable reasons — a large volume of coffee may have been involved — in a fit of wild fancy, that guy flew off on a completely uncalled for tangent and brought forth <em>Bad Matrix</em>. And this guy is not one to shy away from nerdsniping you into code riffing your own bad whatever.</p>
<p>So here it is — <em>Bad Matrix</em> as a function — copied below in its entirety to enjoy safely in your own home, in your own jammies, in your own terminal emulator.</p>

<div id="cb2"><pre><code><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span>bad_matrix()</span> <span>{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    <span>local</span> <span>cols=$(</span><span>tput</span> cols<span>)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>    <span>local</span> <span>rows=$(</span><span>tput</span> lines<span>)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>    <span>__parse_chars()</span> <span>{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>        <span>LANG=</span><span>&#34;en_US.UTF-8&#34;</span> <span>sed</span> -e <span>&#39;s/\(.\)/\1\n/g&#39;</span> <span>&amp;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>    <span>}</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>    <span>__maybe_dim()</span> <span>{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>        <span>if [[</span> <span>$((</span> <span>${RANDOM}</span> % 3 <span>))</span> <span>==</span> 0<span> ]]</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>        <span>then</span> <span>tput</span> dim</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>        <span>else</span> <span>tput</span> sgr0</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>        <span>fi</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>    <span>}</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a>    <span>__colour_me_matrix()</span> <span>{</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>        <span>__maybe_dim</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a>        <span>tput</span> setaf 2</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>    <span>}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>    <span>__maybe_goto_Y()</span> <span>{</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>        <span>local</span> <span>y_pos=$((</span> <span>${RANDOM}</span> % <span>${rows}</span> <span>))</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>        <span>if [[</span> <span>$((</span> <span>${RANDOM}</span> % 2 <span>))</span> <span>==</span> 0<span> ]]</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a>        <span>then</span> <span>tput</span> cup <span>${y_pos}</span> 0</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a>        <span>fi</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a>    <span>}</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>    <span>__print_chars_slowly()</span> <span>{</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a>        <span>while</span> <span>read</span> <span>char</span>;</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a>        <span>do</span> <span>printf</span> <span>&#34;%q&#34;</span> <span>&#34;</span><span>$char</span><span>&#34;</span> <span>|</span> <span>sed</span> -e <span>&#34;s/&#39;&#39;/ /g&#34;</span> <span>&amp;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a>        <span>done</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true"></a>    <span>}</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true"></a>    <span>__inject_matrix()</span> <span>{</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true"></a>        <span>local</span> <span>__hundred_common_kanji_apparently=</span><span>&#34;日 一 大 年 中 会 人 本 月 長 国 出 上 十 生 子 分 東 三 行 同 今 高 金 時 手 見 市 力 米 自 前 円 合 立 内 二 事 社 者 地 京 間 田 体 学 下 目 五 後 新 明 方 部 .女 八 心 四 民 対 主 正 代 言 九 小 思 七 山 実 入 回 場 野 開 万 全 定 家 北 六 問 話 文 動 度 県 水 安 氏 和 政 保 表 道 相 意 発 不 党&#34;</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true"></a>        <span>local</span> <span>__rand_chars=$((</span> 1 + <span>${RANDOM}</span> % <span>${cols}</span> <span>))</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true"></a>        <span>if [[</span> <span>$((</span> <span>${RANDOM}</span> % 3 <span>))</span> <span>==</span> 0<span> ]]</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true"></a>        <span>then</span> <span>tput</span> el</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true"></a>        <span>else</span> <span>__maybe_goto_Y</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true"></a>             <span>__colour_me_matrix</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true"></a>             <span>read</span> -n <span>${__rand_chars}</span> <span>__character_fragment</span> <span>&lt;&lt;&lt;</span><span>${__hundred_common_kanji_apparently}</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true"></a>             <span>for</span> <span>c</span> in <span>${__character_fragment}</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true"></a>             <span>do</span> <span>sleep</span> 0.05</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true"></a>                <span>printf</span> <span>&#34;%s &#34;</span> <span>&#34;</span><span>${c}</span><span>&#34;</span> <span>&gt;</span> /dev/tty <span>&amp;</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true"></a>             <span>done</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true"></a>        <span>fi</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true"></a>    <span>}</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true"></a>    <span>__print_line_fragment()</span> <span>{</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true"></a>        <span>local</span> <span>__rand_chars=$((</span> 1 + <span>${RANDOM}</span> % <span>${cols}</span> <span>))</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true"></a>        <span>while</span> <span>read</span> -n <span>${__rand_chars}</span> <span>line</span> ;</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true"></a>        <span>do</span> <span>sleep</span> 0.5</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true"></a>           <span>__maybe_goto_Y</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true"></a>           <span>__inject_matrix</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true"></a>           <span>tput</span> dim</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true"></a>           <span>printf</span> <span>&#34;%s\n&#34;</span> <span>&#34;</span><span>$(</span> <span>__parse_chars</span> <span>&lt;&lt;&lt;</span><span>&#34;</span><span>${line}</span><span>&#34;</span> <span>|</span> <span>__print_chars_slowly</span> <span>)</span><span>&#34;</span> <span>&amp;</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true"></a>        <span>done</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true"></a>    <span>}</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true"></a>    <span>cat</span> /dev/urandom  <span>|</span> <span>__print_line_fragment</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true"></a><span>}</span></span></code></pre></div>

<p>The resurrected thread caused a fellow Recurser to emit a <code>bad_cat</code> in Rust. I&#39;m not sure of this choice of tool. Being a famously memory safe language, I worry they will be unable to write a truly bad bad cat. But I could be wrong. Interested parties may <a href="https://github.com/MikkelPaulson/badcat/issues">peruse of their issues</a> on Github.</p>
<p><em>Fin.</em></p>
  </section>
  
</article>
        </main>
        
    </div></div>
  </body>
</html>
