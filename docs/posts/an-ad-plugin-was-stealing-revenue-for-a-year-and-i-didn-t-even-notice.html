<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kvirkvelia.com/ads-plugin-steals-30-of-your-money/">Original</a>
    <h1>An ad plugin was stealing revenue for a year and I didn&#39;t even notice</h1>
    
    <div id="readability-page-1" class="page"><section>
				<p>Five years ago, at 17, while working on my app, I found a strange request while debugging the app via Charles Proxy – HTTP debugger.</p><figure><img src="https://kvirkvelia.com/content/images/2022/01/IMAGE-2017-12-04-20-33-04.jpg" alt="" loading="lazy" width="1280" height="615" srcset="https://kvirkvelia.com/content/images/size/w600/2022/01/IMAGE-2017-12-04-20-33-04.jpg 600w, https://kvirkvelia.com/content/images/size/w1000/2022/01/IMAGE-2017-12-04-20-33-04.jpg 1000w, https://kvirkvelia.com/content/images/2022/01/IMAGE-2017-12-04-20-33-04.jpg 1280w" sizes="(min-width: 720px) 720px"/></figure><p>I had no idea why my app made this request, but it was definitely interesting: the id in the response looked like a <strong><em>Google Ads Unit ID</em></strong>. It turned out that some part of my application was sending requests to an unknown server and received identifiers that were used to determine who got the money for showing ads.</p><h2 id="what-made-this-request">What made this request</h2><p>At that time, my app was built on Cordova (Ionic), a framework for building HTML5 mobile apps. Cordova doesn&#39;t have direct access to iOS or Android API via JavaScript; you have to use plugins and call them via the bridge. The same applies to React Native and Flutter.</p><p>After some research, I found where the request came from. It was the <a href="https://github.com/floatinghotpot/cordova-admob-pro">Cordova Admob Pro</a> plugin, which I used to show Google ads.</p><figure><img src="https://kvirkvelia.com/content/images/2022/01/image-5.png" alt="" loading="lazy" width="1858" height="648" srcset="https://kvirkvelia.com/content/images/size/w600/2022/01/image-5.png 600w, https://kvirkvelia.com/content/images/size/w1000/2022/01/image-5.png 1000w, https://kvirkvelia.com/content/images/size/w1600/2022/01/image-5.png 1600w, https://kvirkvelia.com/content/images/2022/01/image-5.png 1858w" sizes="(min-width: 720px) 720px"/></figure><p>To be honest, it was the first time I actually read this section on GitHub. I had no idea that I was giving away the 2%.</p><p>This explained why I was getting requests with <strong>A<em>ds Unit ID</em></strong> in it, so I calmed down for a while. But I was still curious about the &#34;r&#34; property in the JSON response. My working hypothesis was that it was the percentage that I shared with the plugin’s creator. To check it, I changed the app id property in the API request to a random one and got &#34;r&#34; equal to zero.</p><p>I felt like I was robbed, and this was exactly what happened.</p><h2 id="getting-my-money-back">Getting my money back</h2><p>I wrote an email to the owner of the plugin. </p><figure><img src="https://kvirkvelia.com/content/images/2022/01/image-1-2.png" alt="" loading="lazy" width="1844" height="1580" srcset="https://kvirkvelia.com/content/images/size/w600/2022/01/image-1-2.png 600w, https://kvirkvelia.com/content/images/size/w1000/2022/01/image-1-2.png 1000w, https://kvirkvelia.com/content/images/size/w1600/2022/01/image-1-2.png 1600w, https://kvirkvelia.com/content/images/2022/01/image-1-2.png 1844w" sizes="(min-width: 720px) 720px"/></figure><p>His reply was met with some mixed feelings on my side:</p><figure><img src="https://kvirkvelia.com/content/images/2022/01/image-6.png" alt="" loading="lazy" width="500" height="611"/><figcaption>A bit old fashioned meme but seems to fit</figcaption></figure><h3 id="how-much-was-stolen">How much was stolen</h3><p>There was one more red flag. Instead of looking into the logs, Raymond asked me to send him my ads data to find out when my app had been blacklisted.</p><figure><img src="https://kvirkvelia.com/content/images/2022/01/--------------2017-04-14---14.25.59.png" alt="" loading="lazy" width="2000" height="1024" srcset="https://kvirkvelia.com/content/images/size/w600/2022/01/--------------2017-04-14---14.25.59.png 600w, https://kvirkvelia.com/content/images/size/w1000/2022/01/--------------2017-04-14---14.25.59.png 1000w, https://kvirkvelia.com/content/images/size/w1600/2022/01/--------------2017-04-14---14.25.59.png 1600w, https://kvirkvelia.com/content/images/size/w2400/2022/01/--------------2017-04-14---14.25.59.png 2400w" sizes="(min-width: 720px) 720px"/><figcaption>This is my revenue data. Pauses in revenue are explained by the specifics of the application - we receive revenue while the children go to school. Children don&#39;t go to school in the summer.</figcaption></figure><figure><img src="https://kvirkvelia.com/content/images/2022/01/image-2-1.png" alt="" loading="lazy" width="1690" height="1128" srcset="https://kvirkvelia.com/content/images/size/w600/2022/01/image-2-1.png 600w, https://kvirkvelia.com/content/images/size/w1000/2022/01/image-2-1.png 1000w, https://kvirkvelia.com/content/images/size/w1600/2022/01/image-2-1.png 1600w, https://kvirkvelia.com/content/images/2022/01/image-2-1.png 1690w" sizes="(min-width: 720px) 720px"/></figure><p>He offered a very straightforward and seemingly plausible explanation: as the revenue for 2017 was smaller than for 2016, he assumed I had been blacklisted in January 2017. However, I knew that the drop was due to the Russian government blocking us in an attempt to monopolize the mobile electronic diary market. I’ll save this story for later, but such things have almost become routine here in Russia, the most notorious one being perhaps the case of Telegram that was blocked for a few months. Anyway, spoiler alert, our little indie app didn’t give up and was soon to make $200,000/year clawing through blockages, which impressed the Russian ‘Forbes’ enough to put me on the “30 under 30” list. </p><p>To find the actual blacklisting date, one would need to find data unrelated to, but highly correlated with the ad data, and then see when the correlation stopped.</p><p>Here’s the formula:<strong> <em>Ad Impressions</em> </strong>=<strong> <em>Sessions</em> </strong>*<strong> <em>Avg. Session Duration</em> </strong>*<strong> <em>Ad Duration</em></strong>. </p><p>Now for the data:</p><!--kg-card-begin: html--><table>
<thead>
<tr>
<th>Date</th>
<th>Sessions</th>
<th>Ads Impressions</th>
<th>Factor</th>
</tr>
</thead>
<tbody>
<tr>
<td>12 Sep 2016</td>
<td>24 000</td>
<td>55 000</td>
<td>2.2</td>
</tr>
<tr>
<td>20 Sep 2016</td>
<td>37 000</td>
<td>92 000</td>
<td>2.4</td>
</tr>
<tr>
<td>10 Oct 2016</td>
<td>57 000</td>
<td>120 000</td>
<td>2.1</td>
</tr>
<tr>
<td>11 Oct 2016</td>
<td>62 000</td>
<td>131 000</td>
<td>2.1</td>
</tr>
<tr>
<td>20 Oct 2016</td>
<td>70 000</td>
<td>147 000</td>
<td>2.1</td>
</tr>
<tr>
<td>13 Feb 2016</td>
<td>84 000</td>
<td>183 000</td>
<td>2.1</td>
</tr>
</tbody>
</table><!--kg-card-end: html--><p>As you can see, 2.1 is definitely different from 3. What is more interesting, it is exactly <strong>3 minus 30%</strong>. This is solid evidence that I was losing 30% of my revenue for a year and did not even notice it!</p><p>Raymond accepted my proof and sent me $4K. Victory!</p><p>With all of this information on my hands, I felt that I had to warn others. I started a GitHub issue and wrote a post on the Ionic forum as the plugin was on their library list. Neither one worked. The issue was deleted, and hardly anyone read the forum post (so far there’s been 2.4k reads since May 2017). However, I did receive emails from people who were in the same situation (one of them even bought a license key, but was still getting 30% off his ad earnings), so I decided to warn everyone who was using the plugin.</p><h2 id="finding-every-user">Finding every user</h2><p>My plan was:</p><p>I had no idea how to get a list of ids; Google Play isn’t paginated, so you can&#39;t just scrap it. By googling I found an existing database: however outdated and incomplete, it included public emails of developers. So I bought it.</p><h2 id="this-is-not-a-success-story">This is not a success story</h2><p>I found thousands of applications. Hundreds had the devs’ emails, of which only dozens were valid and I got replies from.</p><p>As far as I know, Raymond ignored letters from other users. I think I was the first to figure out what was going on, and he decided to pay me out of caution or, perhaps, fear. He also was kind enough to offer me a job. When I turned him down on the grounds that I don’t work for thieves, I received the following:</p><figure><img src="https://kvirkvelia.com/content/images/2022/01/image-4.png" alt="" loading="lazy" width="2000" height="1333" srcset="https://kvirkvelia.com/content/images/size/w600/2022/01/image-4.png 600w, https://kvirkvelia.com/content/images/size/w1000/2022/01/image-4.png 1000w, https://kvirkvelia.com/content/images/size/w1600/2022/01/image-4.png 1600w, https://kvirkvelia.com/content/images/2022/01/image-4.png 2308w" sizes="(min-width: 1200px) 1200px"/><figcaption>Should I sell it as an NFT?</figcaption></figure><p>The plugin is still on the Ionic website, now prefixed with a disclaimer.</p><figure><img src="https://kvirkvelia.com/content/images/2022/01/image-3.png" alt="" loading="lazy" width="2000" height="1314" srcset="https://kvirkvelia.com/content/images/size/w600/2022/01/image-3.png 600w, https://kvirkvelia.com/content/images/size/w1000/2022/01/image-3.png 1000w, https://kvirkvelia.com/content/images/size/w1600/2022/01/image-3.png 1600w, https://kvirkvelia.com/content/images/size/w2400/2022/01/image-3.png 2400w" sizes="(min-width: 720px) 720px"/></figure><h2 id="an-important-takeaway">An important takeaway</h2><p>This again raises the question of security while using third-party code, which is virtually non-existent. I still remember David Gilbertson&#39;s article &#34;<a href="https://medium.com/hackernoon/im-harvesting-credit-card-numbers-and-passwords-from-your-site-here-s-how-9a8cb347c5b5">I’m harvesting credit card numbers and passwords from your site</a>&#34; and the problem is things haven&#39;t gotten any better. Even if you trust your ads plugin, every single NPM package can silently call/override methods of the plugin to replace the <strong>Ad Unit ID</strong> and steal your ads traffic. </p><p>If you are using plugins to serve ads, use those that do not allow you to change the <strong>Ad Unit ID </strong>at runtime, otherwise you can lose money.</p><p>And finally, no matter how much you dislike receiving spam, please use your real email on the app page, otherwise you won&#39;t be able to receive an important email one day.</p><hr/><p>Kvirkvelia Levan</p>
			</section></div>
  </body>
</html>
