<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://pyatl.dev/2024/09/01/bitten-by-unicode/">Original</a>
    <h1>Bitten by Unicode</h1>
    
    <div id="readability-page-1" class="page"><div>
<h6>by joseph carboni</h6>



<h2>Parsing Dollar Figures</h2>



<p>One product of mine takes reports that come in as a table that’s been exported to PDF, which means text extraction. For dollar figures I find a prefixed dollar symbol and convert the number following it into a <code>float</code>. If there’s a hyphen in addition to the dollar symbol, it’s negative.</p>



<p><strong>Right?</strong></p>



<p>Well, when I was running reports through, negative values were coming out the other end as positive values.</p>



<p>Let’s look at this value as an example. (You can copy this into your interpreter and try it yourself.)</p>



<p><code>value = &#34;‐$2,520.80&#34;</code></p>



<p>Initially, I was using this regex to convert, retaining hyphens, dots, and any number from 0 to 9.</p>


<div><pre title="">import re
converted_value = float(re.sub(r&#34;[^-.0-9]&#34;, &#34;&#34;, value))
</pre></div>


<p>Result: <code><strong>2520.8</strong></code></p>



<p><em>Positive?</em> I found this confusing and thought that perhaps I didn’t understand what the hyphen in my regex was doing, so I tried taking the hyphen out of the regex, putting the negative case behind an if-statement and then hitting it with a multiplication of <code>-1</code>:</p>


<div><pre title="">if value.startswith(&#39;-$&#39;):
    converted_value = float(re.sub(r&#34;[^.0-9]&#34;, &#34;&#34;, value)) * -1
</pre></div>


<p>The result?<strong> The if-statement is never triggered!</strong></p>



<h2>Inspecting the hyphen</h2>



<p>I was beginning to think I had taken the wrong crazy pills that morning. However, not long ago I read a chapter in <em>Fluent Python</em> by Luciano Ramalho (great book, by the way) about normalizing Unicode. So, I had been exposed recently to Unicode trickery.</p>



<p>I pulled in the standard library module <code>unicodedata</code> and starting checking things. I fed the standard hyphen character from my keypress as well as the hyphen from <code>value</code> into <code>unicodedata.name()</code>.</p>


<div><pre title="">&gt;&gt;&gt; unicodedata.name(&#34;-&#34;)
HYPHEN-MINUS

&gt;&gt;&gt; unicodedata.name(value[0])
HYPHEN
</pre></div>


<p>Whoa whoa whoa, what’s this!? These aren’t the same character, and I couldn’t tell by just looking at it. What’s the difference between <code>HYPHEN-MINUS</code> and <code>HYPHEN</code>?</p>



<p><strong>HYPHEN-MINUS (U+002D)</strong></p>



<ul>
<li><strong>Intended Use</strong>: This character is meant to serve as a general-purpose hyphen, minus sign, or dash. It’s a legacy character inherited from ASCII.</li>



<li><strong>Appearance</strong>: It often appears as a small horizontal line, but the exact rendering can vary depending on the font and context.</li>



<li><strong>Usage</strong>: It’s commonly used in programming, file names, and where a quick, generic hyphen or minus sign is needed.</li>
</ul>



<p><strong>HYPHEN (U+2010)</strong></p>



<ul>
<li><strong>Intended Use</strong>: This character is explicitly designated as a hyphen, used to join words or split a word across lines.</li>



<li><strong>Appearance</strong>: It has a consistent appearance across different fonts and contexts, ensuring it looks like a proper hyphen.</li>



<li><strong>Usage</strong>: It is used in text where a typographically correct hyphen is required, such as in professionally typeset documents.</li>
</ul>



<h2>My Solution</h2>



<p>I needed to do something to account for this and make sure to catch not only this variation of a hyphen, but any such variation. For that, I leveraged <a href="https://en.wikipedia.org/wiki/Unicode_character_property" data-type="link" data-id="https://en.wikipedia.org/wiki/Unicode_character_property">Unicode categories</a>.</p>



<p>The category for hyphens is ‘Pd’ (punctuation, dash).</p>


<div><pre title="">def is_hyphen(char: str) -&gt; bool:
    return unicodedata.category(char) == &#39;Pd&#39;
</pre></div>


<p>And now can correctly identify any preceding dash in my if-statement.</p>


<div><pre title="">if is_hyphen(value[0]) and value[1] == &#34;$&#34;:
    converted_value = float(re.sub(r&#34;[^.0-9]&#34;, &#34;&#34;, value)) * -1
</pre></div>


<p>Result: <strong>-2520.8</strong></p>



<h5>ABOUT THE AUTHOR</h5>



<p>Joseph Carboni is a multifaceted programmer with a background in bioinformatics, neuroscience, and sales, now focusing on Python development. He developed a ribosomal loading model and contributed to a neuroscience paper before transitioning to a six-year sales career, enhancing his understanding of business and client relations. Currently, he’s a Python Developer at Shupe, Carboni &amp; Associates, improving business processes, and runs Carboni Technology for independent tech projects. Joseph welcomes collaborations and discussions via LinkedIn (<a href="https://www.linkedin.com/in/joecarboni/">Joseph Carboni</a>), Twitter (<a href="https://twitter.com/JoeCarboni1">@JoeCarboni1</a>), or email (<a href="mailto:joe@carbonitech.com">joe@carbonitech.com</a>).</p>



<hr/>



<h6>PUBLISH YOUR WRITINGS HERE!</h6>



<p>We are always looking to publish your writings on the pyATL website. All content must be related to Python, non-commercial (pitches), and comply with out <a href="https://pyatl.dev/code-of-conduct/">code of conduct</a>.</p>
</div></div>
  </body>
</html>
