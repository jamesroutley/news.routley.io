<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.emilburzo.com/2026/01/running-claude-code-dangerously-safely/">Original</a>
    <h1>Running Claude Code dangerously (safely)</h1>
    
    <div id="readability-page-1" class="page"><div>
      
      
<p>I’ve been using Claude Code more and more recently. At some point I realized that rather than do something else until it finishes, I would constantly check on it to see if it was asking for yet another permission, which felt like it was missing the point of having an agent do stuff. So I wanted to use Claude Code with the <code>--dangerously-skip-permissions</code> flag.</p>
<p>If you haven’t used it, this flag does exactly what it says: it lets Claude Code do whatever it wants without asking permission first. No more “May I install this package?”, “Should I modify this config?”, “Can I delete these files?”</p>
<p>It just… does it.</p>
<p>Which is great for flow since I don’t have to worry that it stopped doing stuff just to ask a permission question.</p>
<p>But also, you know, dangerous.</p>
<p>I like my filesystem intact, so the obvious solution is to not run this thing directly on my OS account.</p>

<h2 id="docker">Docker</h2>
<p>First instinct: throw it in a Docker container. Containers are for isolation, right?</p>
<p>Except I want Claude to be able to build Docker images. And run containers. And maybe orchestrate some stuff.</p>
<p>So now you need Docker-in-Docker, which means <code>--privileged</code> mode, which defeats the entire purpose of sandboxing. That means trading “Claude might mess up my filesystem” for “Claude has root-level access to my container runtime.”</p>
<p>Not great.</p>
<p>There’s also the nested networking weirdness, volume mounting permissions that make you question your life choices, and the general feeling that you’re fighting the tool instead of using it.</p>
<h2 id="other-options">Other options</h2>
<p>I also briefly considered:</p>
<ul>
<li>#yolo run it bare metal: <a href="https://www.reddit.com/r/ClaudeAI/comments/1oceaqz/claude_deleted_my_database/">no</a>, <a href="https://www.reddit.com/r/ClaudeAI/comments/1m21go1/claude_deleted_my_whole_repository/">no</a> and <a href="https://www.reddit.com/r/ClaudeAI/comments/1pgxckk/claude_cli_deleted_my_entire_home_directory_wiped/">no</a></li>
<li><a href="https://github.com/anthropic-experimental/sandbox-runtime">sandbox-runtime</a>: more of an ACL approach, I want Claude to be able to do anything, because it doesn’t have access to anything except the code</li>
<li>firejail or similar: same problem as Docker-in-Docker</li>
<li>manual VM setup: works but tedious, not reproducible</li>
<li>cloud VM: costs money, has latency, need to upload my code somewhere</li>
</ul>

<p>Then I remembered about a project that I’ve used before Docker became all the rage: Vagrant.</p>
<p>If you weren’t around back then, Vagrant gives you proper VM isolation with a reproducible config file. It’s basically infrastructure as code for your local dev environment.</p>
<p>You get:</p>
<ul>
<li>full VM isolation (no shared kernel)</li>
<li>easy to nuke and rebuild</li>
<li>shared folders that make it feel local enough</li>
<li>no Docker-in-Docker nonsense</li>
</ul>
<p>I hadn’t used VirtualBox in years since Docker containers covered all requirements until now, so I grabbed the latest version (7.2.4) and got started.</p>
<p>First <code>vagrant up</code> and… the VM is pegging my CPU at 100%+ while completely idle.</p>
<p>I spent an hour turning off various VM features, tweaking settings, <del>googling</del> asking LLMs random combinations of “virtualbox high cpu idle”, you know, the usual.</p>
<p>Eventually I found <a href="https://github.com/VirtualBox/virtualbox/issues/356">this GitHub issue</a>. VirtualBox 7.2.4 shipped with a regression that causes high CPU usage on idle guests. What are the odds.</p>
<h2 id="vagrantfile">Vagrantfile</h2>
<p>Here’s what my simple Vagrantfile looks like:</p>
<div><pre tabindex="0"><code data-lang="ruby"><span><span>vm_name <span>=</span> <span>File</span><span>.</span>basename(<span>Dir</span><span>.</span>getwd)
</span></span><span><span>
</span></span><span><span><span>Vagrant</span><span>.</span>configure(<span>&#34;2&#34;</span>) <span>do</span> <span>|</span>config<span>|</span>
</span></span><span><span>  config<span>.</span>vm<span>.</span>box <span>=</span> <span>&#34;bento/ubuntu-24.04&#34;</span>
</span></span><span><span>
</span></span><span><span>  <span>#config.vm.network &#34;forwarded_port&#34;, guest: 3000, host: 3000, auto_correct: true</span>
</span></span><span><span>  config<span>.</span>vm<span>.</span>synced_folder <span>&#34;.&#34;</span>, <span>&#34;/agent-workspace&#34;</span>, <span>type</span>: <span>&#34;virtualbox&#34;</span>
</span></span><span><span>
</span></span><span><span>  config<span>.</span>vm<span>.</span>provider <span>&#34;virtualbox&#34;</span> <span>do</span> <span>|</span>vb<span>|</span>
</span></span><span><span>    vb<span>.</span>memory <span>=</span> <span>&#34;4096&#34;</span>
</span></span><span><span>    vb<span>.</span>cpus <span>=</span> <span>2</span>
</span></span><span><span>    vb<span>.</span>gui <span>=</span> <span>false</span>
</span></span><span><span>    vb<span>.</span>name <span>=</span> vm_name
</span></span><span><span>    vb<span>.</span>customize <span>[</span><span>&#34;modifyvm&#34;</span>, <span>:id</span>, <span>&#34;--audio&#34;</span>, <span>&#34;none&#34;</span><span>]</span>
</span></span><span><span>    vb<span>.</span>customize <span>[</span><span>&#34;modifyvm&#34;</span>, <span>:id</span>, <span>&#34;--usb&#34;</span>, <span>&#34;off&#34;</span><span>]</span>
</span></span><span><span>  <span>end</span>
</span></span><span><span>  
</span></span><span><span>  config<span>.</span>vm<span>.</span>provision <span>&#34;shell&#34;</span>, <span>inline</span>: <span>&lt;&lt;-SHELL
</span></span></span><span><span>    export <span>DEBIAN_FRONTEND</span><span>=</span>noninteractive
</span></span><span><span>
</span></span><span><span>    apt<span>-</span>get update
</span></span><span><span>    apt<span>-</span>get install <span>-</span>y docker<span>.</span>io nodejs npm git unzip
</span></span><span><span>    npm install <span>-</span>g @anthropic<span>-</span>ai<span>/</span>claude<span>-</span>code <span>--</span>no<span>-</span>audit
</span></span><span><span>
</span></span><span><span>    usermod <span>-</span>aG docker vagrant
</span></span><span><span>    chown <span>-</span>R <span>vagrant</span>:vagrant <span>/agent-workspace
</span></span></span><span><span><span>
</span></span></span><span><span><span>  SHELL
</span></span></span><span><span><span>end
</span></span></span></code></pre></div>
<p>Now I just run:</p>
<div><pre tabindex="0"><code data-lang="bash"><span><span>cd ~/my-project
</span></span><span><span>vagrant up
</span></span><span><span>vagrant ssh
</span></span><span><span>claude-code --dangerously-skip-permissions
</span></span><span><span><span># tell Claude what you want and let it run wild with no babysitting</span>
</span></span></code></pre></div><p>First boot takes a few minutes to provision everything, and you need to sign in to Claude once for each project, but after that, <code>vagrant up</code> is quite fast.</p>
<p>Then, when you are done for the day:</p>

<p>So, what can Claude do with these newfound powers?</p>
<p>Since it’s running in a VM, I also gave it <code>sudo</code> access and instructed it that it has the power to do anything: install system packages, modify configs, create files, run Docker containers, whatever.</p>
<p>It has:</p>
<ul>
<li>manually started a webapp API and inspected it with curl requests</li>
<li>installed a browser and manually inspected the app, then built end-to-end tests based on that</li>
<li>setup a postgres database, ran test sql, tested that db migrations work, etc</li>
<li>built and ran Docker images</li>
</ul>
<p>All things I’d be nervous about on my host machine, especially with the “just do it” flag enabled.</p>
<p>And now I feel Claude is much more effective since it has the extra context, it’s not relying on me to run the command, return the output or error message, and then iterate. It just does it by itself.</p>

<p>Claude Code isn’t exactly a resource hog, and the VM has plenty of headroom. The shared folder sync works fine, no lag or weirdness when files change. This is under Linux with VirtualBox, YMMV for other platforms.</p>

<p>What you’re protecting against:</p>
<ul>
<li>accidental filesystem damage</li>
<li>aggressive package installations</li>
<li>configuration changes you didn’t catch</li>
<li>general “oops I didn’t mean Claude to do that”</li>
</ul>
<p>What you’re NOT protecting against:</p>
<ul>
<li>deleting the actual project, since the file sync is two-way</li>
<li>a malicious AI trying to escape the VM (VM escape vulnerabilities exist, but they’re rare and require deliberate exploitation)</li>
<li>network-level attacks/oopsies from the VM</li>
<li>data exfiltration: the VM still has internet access, but besides the code there shouldn’t really be any data to exfiltrate</li>
</ul>
<p>Threat model: I don’t trust myself to always catch what the agent is doing when I’m in the zone and just want stuff to work. This setup is about preventing accidents, not sophisticated attacks.</p>
<p>Since all my projects are in git I don’t care if it messes something up in the project. Plus you get the benefit of being able to use your regular git tooling/flows/whatever, without having to add credentials to the VM.</p>
<p>But if you need something stricter, <code>config.vm.synced_folder</code> also supports <code>type: &#34;rsync&#34;</code>, one-time one-way sync from the machine running to the machine being started by Vagrant, but then it’s on you to sync it back or whatever is needed.</p>

<p>This took a bit to get right, mostly because of the VirtualBox CPU bug. But now it’s frictionless. I can let Claude Code do whatever it wants without fear, and if something goes sideways, I just nuke the VM and start fresh.</p>
<p>The Vagrantfile is short and reproducible. Drop it in any project directory, <code>vagrant up</code>, and you’re sandboxed.</p>
<p>If you’re using Claude Code with the dangerous flag, I’d recommend something like this. Even if you’re careful about what you approve, it only takes one moment to mess things up.</p>
    </div></div>
  </body>
</html>
