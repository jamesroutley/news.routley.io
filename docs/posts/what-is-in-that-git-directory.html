<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.meain.io/2023/what-is-in-dot-git/">Original</a>
    <h1>What is in that .git directory?</h1>
    
    <div id="readability-page-1" class="page"><div>
      

<p> Oct 06, 2023 . 8 min </p>



<p>Well, I think most of you reading this blog use <code>git</code> more or less on a daily basis, but have you ever looked into what is in the <code>.git</code> folder that git creates? Let&#39;s explore it together and understand what is going on in there.</p>
<p><em>This is a blog version of a talk that I recently gave. Unfortunately I can&#39;t link to the recording :(.</em></p>
<blockquote>
<p><code>git</code> at a basic level is just a bunch of text files linked to each other by filenames.</p>
</blockquote>

<p>As you all know, we start our git journey with a <code>git init</code>. This gives the message that we all are probably used to by now, especially if you start and abandon a lot of side projects.</p>
<pre><code>Initialized empty Git repository in /home/meain/dev/src/git-talk/.git/
</code></pre>
<p>Let&#39;s look at what is in the <code>.git</code> repo as of now.</p>
<pre><code>$ tree .git

.git
├── config
├── HEAD
├── hooks
│   └── prepare-commit-msg.msample
├── objects
│   ├── info
│   └── pack
└── refs
    ├── heads
    └── tags
</code></pre>
<p>It seems to create a bunch of files and folders. What are all these? Let&#39;s go over them one by one.</p>
<ul>
<li><code>config</code> is a text file that contains your git configuration for the current repo. If you look into it, you would see some basic settings for you repo like the author, filemode etc.</li>
<li><code>HEAD</code> contains the current head of the repo. Depending on what you have set your &#34;default&#34; branch to be, it will be <code>refs/heads/master</code> or <code>refs/heads/main</code> or whatever else you had set to. As you might have guessed, this is pointing to <code>refs/heads</code> folder that you can see below, and into a file called <code>master</code> which does not exist as of now. This file <code>master</code> will only show up after you make your first commit.</li>
<li><code>hooks</code> contain any scripts that can be run before/after git does anything. I have written another blog <a href="https://blog.meain.io/2019/making-sure-you-wont-commit-conflict-markers/">here</a> which goes a bit more into how git hooks work.</li>
<li><code>objects</code> contains the git objects, ie the data about the files, commits etc in your repo. We will go in depth into this in this blog.</li>
<li><code>refs</code> as we previously mentioned, stores references(pointers). <code>refs/heads</code> contains pointers to branches and <code>refs/tags</code> contains pointers to tags. We will go into what these files look like soon.</li>
</ul>

<p>Now that you have an idea of what the initial set of files in <code>.git</code> is, let&#39;s perform the first action that adds something into the <code>.git</code> directory. Let&#39;s create a file and add it(we are not committing it yet).</p>
<pre><code><span>echo</span> <span>&#39;meain.io&#39;</span> <span>&gt;</span> <span>file</span></code></pre>
<p>This does the following:</p>
<pre><code><span>--- init       2024-07-02 15:14:00.584674816 +0530</span></code></pre>
<p>This causes two main changes as you can see. The first thing it modifies is the <code>index</code> file. The <a href="https://git-scm.com/docs/index-format">index</a> is what stores the information about what is currently staged. This is used to signify that the file named <code>file</code> has been added to the index.</p>
<p>The second and more important change is the addition of a new folder <code>objects/4c</code> and a file <code>5b58f323d7b459664b5d3fb9587048bb0296de</code> inside it.</p>
<h2 id="but-what-is-in-that-file%3F" tabindex="-1">But what is in that file? <a href="#but-what-is-in-that-file%3F">#</a></h2>
<p>Here is where we get into the details of how <code>git</code> stores things. Let&#39;s start with looking at what kind of data is present in that.</p>
<pre><code>$ <span>file</span> .git/objects/4c/5b58f323d7b459664b5d3fb9587048bb0296de</code></pre>
<p>Hmm, but what is the zlib compressed data?</p>
<pre><code>$ zlib-flate <span>-uncompress</span> <span>&lt;</span>.git/objects/4c/5b58f323d7b459664b5d3fb9587048bb0296de</code></pre>
<p>Looks like it contains the type, size and data of the file named <code>file</code> that we did a <code>git add</code> on. In this case, the data says that it is a <code>blob</code> of size <code>9</code> and the content is <code>meain.io</code>.</p>
<h2 id="ok%2C-but-what-is-with-that-filename%3F" tabindex="-1">OK, but what is with that filename? <a href="#ok%2C-but-what-is-with-that-filename%3F">#</a></h2>
<p>Well, good question. It comes from the sha1 of the content. If you take the zlib compressed data and pipe it through <code>sha1sum</code>, you get the filename.</p>
<pre><code>$ zlib-flate <span>-uncompress</span> <span>&lt;</span>.git/objects/4c/5b58f323d7b459664b5d3fb9587048bb0296de<span>|</span>sha1sum</code></pre>
<p><code>git</code> takes the sha1 of the content to be written, takes the first two characters, in this case <code>4c</code>, creates a folder and then uses the rest of it as the filename. <code>git</code> creates folders from the first two chars to make sure we don&#39;t have too many files under the single <code>objects</code> folder.</p>
<h2 id="say-hello-to-git-cat-file" tabindex="-1">Say hello to <code>git cat-file</code> <a href="#say-hello-to-git-cat-file">#</a></h2>
<p>In fact, since this is one of the more important parts of git, git also has a plumbing command to view the content of an object. You can use <code>git cat-file</code> with <code>-t</code> for type, <code>-s</code> for size and <code>-p</code> for content.</p>
<pre><code>$ <span>git</span> cat-file <span>-t</span> 4c5b58f323d7b459664b5d3fb9587048bb0296de</code></pre>

<p>Now that we know what changes when we add a file, let&#39;s take this to the next level by committing.</p>
<pre><code>$ <span>git</span> commit <span>-m</span> <span>&#39;Initial commit&#39;</span></code></pre>
<p>Here is what changed:</p>
<pre><code><span>--- init        2024-07-02 15:14:00.584674816 +0530</span></code></pre>
<p>Woah, looks like there are a bunch of changes. Let&#39;s walk through them one by one. The first one is a new file <code>COMMIT_EDITMSG</code>. As the name might suggest, it contains the (last) commit message.</p>
<p><em>If you where to run the <code>git commit</code> command without the <code>-m</code> flag, the way <code>git</code> gets a commit message is to open an editor with the <code>COMMIT_EDITMSG</code> file to let the user edit the commit message and once the user has updated it and exited the editor, <code>git</code> uses the contents of the file as the commit message.</em></p>
<p>It also added a whole new folder <code>logs</code>. This is a way for git to log all the commits changes in a repo. You will be able to see the changes in commits for all refs and <code>HEAD</code> here.</p>
<p>The <code>object</code> dir also got some changes, but I want you to first look into the <code>refs/heads</code> directory where we now have the file <code>master</code>. This as you might have guessed is the reference to the <code>master</code> branch. Let&#39;s see what is in it.</p>
<pre><code>$ <span>cat</span> refs/heads/master</code></pre>
<p>Looks like it is pointing to one of the new objects. We know how to look at objects, let&#39;s do that.</p>
<pre><code>$ <span>git</span> cat-file <span>-t</span> 3c201df6a1c4d4c87177e30e93be1df8bfe2fe19</code></pre>
<blockquote>
<p>You could have also done <code>git cat-file -t refs/heads/master</code></p>
</blockquote>
<p>Well, looks like that is new kind of object. This seems to be a <code>commit</code> object. The contents of the <code>commit</code> object tells us that it contains a <code>tree</code> object with the hash <code>62902ec0eca9faceb8fe0a9870b9b6cde75a9545</code>, which looks like the other object that got added when we did the commit. The <code>commit</code> object also has the information about who the author and committer is, which in this case is both me. Lastly is also shows what the commit message for this commit was.</p>
<p>Now let&#39;s look at what the <code>tree</code> object contains.</p>
<pre><code>$ <span>git</span> cat-file <span>-t</span> 62902ec0eca9faceb8fe0a9870b9b6cde75a9545</code></pre>
<p>A <code>tree</code> object will contain the state of working directory in the form of other tree and blob objects. In this case, since we just have a single file named <code>file</code>, you will just see a single object. If you see, the file is pointing to the original object that got added when we did a <code>git add file</code>.</p>
<p>Here is what a tree for a more mature repo look like. More <code>tree</code> objects are used inside <code>tree</code> object linked from the <code>commit</code> object to denote folders.</p>
<pre><code>$ git cat-file -p 2e5e84c3ee1f7e4cb3f709ff5ca0ddfc259a8d04
100644 blob 3cf56579491f151d82b384c211cf1971c300fbf8    .dockerignore
100644 blob 02c348c202dd41f90e66cfeb36ebbd928677cff6    .gitattributes
040000 tree ab2ba080c4c3e4f2bc643ae29d5040f85aca2551    .github
100644 blob bdda0724b18c16e69b800e5e887ed2a8a210c936    .gitignore
100644 blob 3a592bc0200af2fd5e3e9d2790038845f3a5cf9b    CHANGELOG.md
100644 blob 71a7a8c5aacbcaccf56740ce16a6c5544783d095    CODE_OF_CONDUCT.md
100644 blob f433b1a53f5b830a205fd2df78e2b34974656c7b    LICENSE
100644 blob 413072d502db332006536e1af3fad0dce570e727    README.md
100644 blob 1dd7ed99019efd6d872d5f6764115a86b5121ae9    SECURITY.md
040000 tree 918756f1a4e5d648ae273801359c440c951555f9    build
040000 tree 219a6e58af53f2e53b14b710a2dd8cbe9fea15f5    design
040000 tree 5810c119dd4d9a1c033c38c12fae781aeffeafc1    docker
040000 tree f09c5708676cdca6562f10e1f36c9cfd7ee45e07    src
040000 tree e6e1595f412599d0627a9e634007fcb2e32b62e5    website
</code></pre>

<p>Let&#39;s make a change to the file and see how that works.</p>
<pre><code>$ <span>echo</span> <span>&#39;blog.meain.io&#39;</span> <span>&gt;</span> <span>file</span></code></pre>
<p>Here is what it does:</p>
<pre><code><span>--- commit      2024-07-02 15:33:28.536144046 +0530</span></code></pre>
<p>Well, we added 3 new objects. One of them would be a <code>blob</code> object with the new contents of the file, one would be a <code>tree</code> object and the last one will be a <code>commit</code> object.</p>
<p>Let&#39;s trace them again from the <code>HEAD</code> or <code>refs/heads/master</code>.</p>
<pre><code>$ <span>git</span> cat-file <span>-p</span> refs/heads/master</code></pre>
<p>Those paying attention might have noticed that the <code>commit</code> object now has an additional key called <code>parent</code> which links to the previous commit as this commit is created on top of the previous commit.</p>

<p>About time we created a branch. Let&#39;s do that with <code>git branch fix-url</code>.</p>
<pre><code><span>--- update      2024-07-02 15:47:20.841154907 +0530</span></code></pre>
<p>This adds a new file under the folder <code>refs/heads</code> with a file as the branch name and the content as the id of the latest commit.</p>
<pre><code>$ <span>cat</span> .git/refs/heads/fix-url</code></pre>
<p>This is pretty much all there is to creating a branch. Branches in <code>git</code> are really cheap. Tags also behave the same way, except that they are created under <code>refs/tags</code>.</p>
<p>A file is also added under the <code>logs</code> directory to store the commit history data similar to <code>master</code> branch.</p>

<p>Checking out in <code>git</code> is git getting the <code>tree</code> object of a commit and updating the files in your worktree to match the state recorded in it. In this case, since we are switching from <code>master</code> to <code>fix-url</code>, both of which point to the same <code>commit</code> and underlying <code>tree</code> object, <code>git</code> does not have anything to do in the working tree.</p>
<pre><code><span>git</span> checkout fix-url</code></pre>
<p>The only change that happens when you do a checkout inside <code>.git</code> is that the <code>.git/HEAD</code> file will now point to <code>fix-url</code>.</p>
<pre><code>$ <span>cat</span> .git/HEAD</code></pre>
<p>Wile we are here, let me make a commit. I&#39;m gonna need this to show what merging does later.</p>
<pre><code>$ <span>echo</span> <span>&#39;https://blog.meain.io&#39;</span><span>&gt;</span>file</code></pre>

<p>There are primarily 3 ways of merging.</p>
<ol>
<li>The simplest and the most easiest is a fast forward merge. In this case you just update the commit a branch is pointing to a commit another branch is pointing to. This pretty much involves copying the hash in <code>refs/heads/fix-url</code> to <code>refs/heads/master</code>.</li>
<li>The second one is rebase merge. In this case we first apply our changes on top of what main is currently pointing to one commit at a time and then perform something similar to a fast forward merge.</li>
<li>The last one would be to just merge two branches using a separate merge commit. This is a bit different in that it will have two <code>parent</code> entries in its commit object. We will go a bit more into this towards the end.</li>
</ol>
<p>First let&#39;s see what the graph looks like before a merge.</p>
<pre><code><span>git</span> log <span>--graph</span> <span>--oneline</span> <span>--all</span></code></pre>
<p>Now to perform the merge:</p>
<pre><code>$ <span>git</span> merge fix-url </code></pre>
<pre><code>$ <span>git</span> log <span>--graph</span> <span>--oneline</span> <span>--all</span></code></pre>

<p>Now that we have been playing around with our local <code>git</code> repo for some time, let&#39;s see what happen when we push it. What is being sent to the git repo on the other side?</p>
<p>To show this, first let me create another git repo which can be used as remote for this  repo.</p>
<pre><code>$ <span>mkdir</span> git-talk-2</code></pre>
<p>Btw, this change of adding a new remote is a config change and you can see that change in <code>.git/config</code> file. I&#39;m gonna let you go look what the change was on your own.</p>
<p>Now let&#39;s <a href="https://www.youtube.com/watch?v=OuhFTX6yLXQ">push</a>.</p>
<pre><code>$ <span>git</span> push origin master</code></pre>
<p>Let&#39;s see what changed in our repo.</p>
<pre><code><span>--- branch	2023-07-02 15:55:25.165204941 +0530</span></code></pre>
<p>It added a new <code>refs/remotes</code> to store the information on what all is available in different remotes.</p>
<p>But what gets sent to the other git repo? It is everything that is in <code>objects</code>, and all the branches and tags under <code>refs</code> that you explicitly push. That is all the other git instance needs to get your entire git history.</p>

<ul>
<li><a href="https://git-scm.com/book/en/v3/Git-Internals-Git-Objects">https://git-scm.com/book/en/v3/Git-Internals-Git-Objects</a></li>
<li><a href="https://matthew-brett.github.io/curious-git/reading_git_objects.html">https://matthew-brett.github.io/curious-git/reading_git_objects.html</a></li>
<li><a href="https://blog.meain.io/2020/bunch-of-git-stuff/">https://blog.meain.io/2020/bunch-of-git-stuff/</a></li>
</ul>
<hr/>
<p>Feel free to checkout the discussion at <a href="https://news.ycombinator.com/item?id=37792097">Hacker News</a> and <a href="https://lobste.rs/s/mfo49v/what_is_git_directory">Lobsters</a>.</p>


<p><a href="https://blog.meain.io/">← Home</a></p>

    </div></div>
  </body>
</html>
