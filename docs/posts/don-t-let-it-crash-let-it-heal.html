<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.zachdaniel.dev/p/elixir-misconceptions-1">Original</a>
    <h1>Don&#39;t “let it crash”, let it heal</h1>
    
    <div id="readability-page-1" class="page"><div><div dir="auto"><p>This is the first of a series on misconceptions about Elixir. These are my opinions. I hope they spark discussion and that maybe we all learn things as a result.</p><p>A note to the Elixir programmers who commonly say “let it crash”: This phrase gives outsiders and newcomers the wrong idea, and encourages bad habits for those who misinterpret it. If I had my way, we would stop saying it.</p><p>Let it crash.</p><p>Elixir runs on the BEAM VM. If you’re familiar, skip to the next paragraph. Otherwise, some necessary context is that on the BEAM, all code is executed in a “process”. This can be thought of kind of like a green thread. Each process is a lightweight, share-nothing unit of concurrency. Processes communicate via message passing. When processes encounter an unhandled error, the process exits. We use supervisors (which are themselves supervised typically), to then restart any given crashed process.</p><p>When people say “let it crash”, they are referring to the fact that practically any exited process in your application will be subsequently restarted. Because of this, you can often be much less defensive around unexpected errors. You will see far fewer try/rescue, or matching on error states in Elixir code.</p><div><p><span>The “it” in “let it crash” to an Elixir programmer is </span><strong>a process. </strong><span>Not your application. </span></p><p><span>In practice, an Elixir application almost </span><strong>never</strong><span> crashes, even in conditions that would hard-quit in any other system. </span></p></div><p>For those without the context of building Elixir applications, “let it crash” gives the impression of “jank”, of non-elegant code that does not consider user experience or possible failure states. A panic or crash in most languages is a catastrophic event, to be avoided at all costs.</p><p>Even for Elixir developers with experience, “let it crash” as a practice loses enough nuance so as to be reductive, and I’ve seen it actively impact the quality of code that comes across my desk.</p><p>First, we’ll talk about why you shouldn’t “let it crash”, and then we’ll talk about what you should do instead.</p><p>Open a socket connection, receiving or sending an HTTP request, opening a file, connecting to a database: all of these things are typically backed by a process. 99% of the time, that process is linked to the process that asked for that to happen. The most straightforward example of this is in the context of a web server communicating over a web socket, and if you’re familiar with it, Phoenix LiveView.</p><p>Lets imagine that we embrace the “let it crash” philosophy to the bone, and we write some code like this, handling a web socket message:</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!BrZc!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!BrZc!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 424w, https://substackcdn.com/image/fetch/$s_!BrZc!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 848w, https://substackcdn.com/image/fetch/$s_!BrZc!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 1272w, https://substackcdn.com/image/fetch/$s_!BrZc!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!BrZc!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png" width="1456" height="727" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:727,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:183691,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:&#34;https://www.zachdaniel.dev/i/169461266?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png&#34;,&#34;isProcessing&#34;:false,&#34;align&#34;:null,&#34;offset&#34;:false}" alt="" srcset="https://substackcdn.com/image/fetch/$s_!BrZc!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 424w, https://substackcdn.com/image/fetch/$s_!BrZc!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 848w, https://substackcdn.com/image/fetch/$s_!BrZc!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 1272w, https://substackcdn.com/image/fetch/$s_!BrZc!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F492c06cc-591f-47cf-a7ce-64319703e59a_2868x1432.png 1456w" sizes="100vw" loading="lazy"/></picture><div><div></div></div></div></a></figure></div><p>This code will crash the process in the following scenarios:</p><ul><li><p>the pattern match on the event name fails `”import_data”`</p></li><li><p>the pattern match on the input params fails (there is no “data” key)</p></li><li><p>`data` is not a list (technically, an enumerable of some kind)</p></li><li><p>Any given item in data fails to be created or raises an error</p></li></ul><p><span>In some cases, especially “invalid messages that should not be producible”, crashing is a </span><em>good</em><span> thing. For the first two, and maybe three things in the list above, hitting those cases implies a bug in your front end likely. Someone sending your process messages it was never designed to handle. Crashing may be the desired behavior.</span></p><p><strong>BUT: </strong><span>There is a user on the other end of this. In the case of LiveView, the web socket is driving at least some part of their experience. Establishing a websocket takes time. What will the user experience be? Will they see a flash message about something going wrong? Will some of their UI state reset? None of these things are really acceptable. This pattern is all over, not just tied to LiveView. Do you want to close whatever file/database connection you have every time anything goes wrong? Or release some other expensive resource? What if you encounter thousands errors in quick succession? Will restarting be expensive?</span></p><p><span>Intentionally crashing on any possible error also means that you are not </span><strong>able to represent errored states to your users</strong><span>. For our above example, something like this might make more sense:</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!y0KV!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!y0KV!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 424w, https://substackcdn.com/image/fetch/$s_!y0KV!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 848w, https://substackcdn.com/image/fetch/$s_!y0KV!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 1272w, https://substackcdn.com/image/fetch/$s_!y0KV!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!y0KV!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png" width="1456" height="1670" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1670,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:515485,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:&#34;https://www.zachdaniel.dev/i/169461266?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png&#34;,&#34;isProcessing&#34;:false,&#34;align&#34;:null,&#34;offset&#34;:false}" alt="" srcset="https://substackcdn.com/image/fetch/$s_!y0KV!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 424w, https://substackcdn.com/image/fetch/$s_!y0KV!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 848w, https://substackcdn.com/image/fetch/$s_!y0KV!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 1272w, https://substackcdn.com/image/fetch/$s_!y0KV!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F840c1461-78e4-4308-923f-9675d67b9d8d_3048x3496.png 1456w" sizes="100vw" loading="lazy"/></picture><div><div></div></div></div></a></figure></div><p>In this example, instead of just crashing and seeing some generic error, the user is given actionable information about what went wrong. We have represented the failed state.</p><p><span>With that said, in practice we take a middle-way. Specifically, in fully unexpected scenarios that cannot be remediated, like getting a malformed “import_data” command, it is often </span><strong>preferable</strong><span> to crash. We crash because the process is now in an unrecoverable bad state, and we don’t know how it got there. In this case, we want to remount the component into a good state. You still have to consider the UX of this scenario, and design your pages to gracefully remount.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!4TMF!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!4TMF!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 424w, https://substackcdn.com/image/fetch/$s_!4TMF!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 848w, https://substackcdn.com/image/fetch/$s_!4TMF!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 1272w, https://substackcdn.com/image/fetch/$s_!4TMF!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!4TMF!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png" width="1456" height="1239" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1239,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:394237,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:&#34;image/png&#34;,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:&#34;https://www.zachdaniel.dev/i/169461266?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png&#34;,&#34;isProcessing&#34;:false,&#34;align&#34;:null,&#34;offset&#34;:false}" alt="" srcset="https://substackcdn.com/image/fetch/$s_!4TMF!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 424w, https://substackcdn.com/image/fetch/$s_!4TMF!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 848w, https://substackcdn.com/image/fetch/$s_!4TMF!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 1272w, https://substackcdn.com/image/fetch/$s_!4TMF!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F377a6d3b-8fb0-4ac3-8c67-dc6a54778227_3160x2688.png 1456w" sizes="100vw" loading="lazy"/></picture><div><div></div></div></div></a></figure></div><p>Here we crash on unknown or garbled messages/input, but present validation errors to the user.</p><p>So, we’ve established that there are consequences to crashing, and that we should not default to the overly reductive “let it crash” mentality here. Does that mean that the “let it crash” people entirely wrong? Only kind of.</p><p><span>Remember when we talked about supervisors and restarting etc? The operative part of these things is not that processes are designed to crash, it is that they are designed to </span><strong>start.</strong><span> As in, when your application first boots up, you have to start up your process tree, and supervisors are at that point embedded with the information required to start a process if it crashes. </span></p><p><span>What this means for Elixir programmers is that we </span><strong>can</strong><span> let it crash when things are unrecoverable. What this does </span><strong>not</strong><span> mean for Elixir programmers is that all errors anywhere inside of a process should cause a crash.</span></p><p>The real magic of the BEAM is that for any given piece of code running in Elixir, there is another, higher level piece of code that knows how to handle errors that cannot be locally handled by that code. </p><p>You can’t write code that isn’t aware of the fact that something might go catastrophically wrong, because all of your code implicitly has a “how do I initialize myself” step that must be able to gather any requirements and “set the stage” for itself. </p><p>There is often still work that goes into designing these structures, but we are getting something for free or close-to-free that takes a crack team of experts or specialized frameworks to achieve in other languages.</p><p>While “let it heal” may not be as catchy, I think it better captures the BEAM’s true superpower: not that our processes can die, but that they can always come back to life.</p></div></div></div>
  </body>
</html>
