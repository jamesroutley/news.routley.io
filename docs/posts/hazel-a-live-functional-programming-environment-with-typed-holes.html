<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/hazelgrove/hazel">Original</a>
    <h1>Hazel: A live functional programming environment with typed holes</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Hazel is a live functional-programming environment rooted in the principles of
type theory. You can find the relevant papers and more motivation at <a href="https://hazel.org/" rel="nofollow">the Hazel
website</a>.</p>
<p dir="auto">You can try Hazel online: the
<a href="https://hazel.org/build/dev" rel="nofollow">dev</a> branch is the main branch at the
moment. Every other branch that has been pushed to GitHub and successfully builds
can also be accessed at:</p>
<p dir="auto"><code>https://hazel.org/build/&lt;branch_name&gt;</code></p>

<div dir="auto"><h2 tabindex="-1" dir="auto">Building and Running Hazel</h2><a id="user-content-building-and-running-hazel" aria-label="Permalink: Building and Running Hazel" href="#building-and-running-hazel"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto">If you already have <code>ocaml</code> version 5.2.0, at least version 2.0 of <code>opam</code>, and <code>npm</code>
installed, you can build Hazel by running the following commands.</p>
<ul dir="auto">
<li><code>git clone git@github.com:hazelgrove/hazel.git</code></li>
<li><code>cd hazel</code></li>
<li><code>make deps</code></li>
<li><code>make dev</code></li>
</ul>
<p dir="auto">To view Hazel, you have to serve it, on localhost for development (you can&#39;t
run it from a <code>file:///</code> URL due to browser restrictions on e.g. web workers.)</p>
<p dir="auto">If you have <code>python3</code> on your path, you can use the Python server via
<code>make serve</code>, then navigate to <code>http://0.0.0.0:8000/</code> in your browser.</p>
<p dir="auto">Alternatively, if you would live hot reloading, you can use <code>make hot</code> instead of <code>make serve</code>.</p>
<p dir="auto">Otherwise, run <code>make echo-html-dir</code> which will echo the directory that needs
to be served using some other server of your choice.</p>

<p dir="auto">If you are unfamiliar with <code>ocaml</code> or <code>opam</code>, do not have them installed, or
just get stuck, we recommend you follow the step-by-step installation
instructions contained in <a href="https://github.com/hazelgrove/hazel/blob/dev/INSTALL.md">INSTALL.md</a>.</p>


<p dir="auto">Hazel is written in ReasonML, which is a syntactic sugar atop OCaml.
This link lets you type OCaml and see what the corresponding ReasonML syntax is:
<a href="https://reasonml.github.io/en/try" rel="nofollow">https://reasonml.github.io/en/try</a>.</p>
<p dir="auto">This is useful if you are trying to figure out the ReasonML syntax for something
that you know the OCaml syntax for.</p>
<p dir="auto">You can also convert between OCaml and ReasonML syntax at the terminal using
<code>refmt</code> at the terminal. See <code>refmt --help</code> for the details.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Suggested Extensions for VS Code</h3><a id="user-content-suggested-extensions-for-vs-code" aria-label="Permalink: Suggested Extensions for VS Code" href="#suggested-extensions-for-vs-code"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Most of our team uses Visual Studio Code (VS Code) to write code.
If you use VS Code, here are a few extensions that might be helpful.</p>
<ul dir="auto">
<li>
<p dir="auto">This extension provides full support for editing ReasonML source code and
relevant tools:</p>
<ul dir="auto">
<li><a href="https://github.com/ocamllabs/vscode-ocaml-platform">ocaml-platform</a></li>
</ul>
</li>
<li>
<p dir="auto">Due to Reason&#39;s poor parse errors, unbalanced parentheses can be difficult
to find.  The following extensions help with that.</p>
<ul dir="auto">
<li><a href="https://marketplace.visualstudio.com/items?itemName=coenraads.bracket-pair-colorizer-2" rel="nofollow">Bracket Pair Colorizer 2</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=sirtori.indenticator" rel="nofollow">Indenticator</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow" rel="nofollow">indent-rainbow</a></li>
</ul>
</li>
</ul>
<p dir="auto">In addition to these extensions, enabling the breadcrumbs bar can make
navigating a large code base easier. There are multiple ways to make the
breadcrumbs bar visible:</p>
<ul dir="auto">
<li>Click <strong>View</strong> / <strong>Show Breadcrumbs</strong> from the menu bar.</li>
<li>Press <code>Ctrl+Shift+P</code> (macOS: <code>Cmd+Shift+P</code>), start typing <code>breadcrumbs</code>, and
select <code>View: Toggle Breadcrumbs</code> from the dropdown menu to toggle breadcrumbs
on and off.</li>
<li>Press <code>Ctrl+Shift+.</code> to start breadcrumbs navigation.</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">Suggested Setup for NeoVim</h3><a id="user-content-suggested-setup-for-neovim" aria-label="Permalink: Suggested Setup for NeoVim" href="#suggested-setup-for-neovim"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you enjoy your Vim binding and Vim setup, the following may help you set up your Reason IDE in NeoVim.</p>
<p dir="auto">If you use vim, I recommend you to switch to NeoVim since it has a better support for multi-thread,
and thus less likely to block you when you are programming.</p>
<p dir="auto">To set up the LSP (Language Server Protocol), you need to set up your Language Client for Neovim and Language Server for ocaml.</p>
<ul dir="auto">
<li><a href="https://www.npmjs.com/package/ocaml-language-server" rel="nofollow">ocaml-language-server</a></li>
<li><a href="https://github.com/autozimu/LanguageClient-neovim">LanguageClient-neovim</a></li>
</ul>
<p dir="auto">After installing the previous two, you may want to copy the following to your neovim config file.
(assuming <code>npm</code> have ocaml-language-server installed under <code>/usr/bin</code>)</p>
<div data-snippet-clipboard-copy-content="let g:LanguageClient_serverCommands = {
    \ &#39;ocaml&#39;: [&#39;/usr/bin/ocaml-language-server&#39;, &#39;--stdio&#39;],
    \ &#39;reason&#39;: [&#39;/usr/bin/ocaml-language-server&#39;, &#39;--stdio&#39;]
    \ }
&#34; LanguageClient-neovim
nnoremap &lt;F5&gt; :call LanguageClient_contextMenu()&lt;CR&gt;
&#34; Or map each action separately
nnoremap &lt;silent&gt; K :call LanguageClient#textDocument_hover()&lt;CR&gt;
nnoremap &lt;silent&gt; gd :call LanguageClient#textDocument_definition()&lt;CR&gt;
nnoremap &lt;silent&gt; gr :call LanguageClient#textDocument_references()&lt;CR&gt;
nnoremap &lt;silent&gt; gf :call LanguageClient#textDocument_formatting()&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;F2&gt; :call LanguageClient#textDocument_rename()&lt;CR&gt;"><pre><code>let g:LanguageClient_serverCommands = {
    \ &#39;ocaml&#39;: [&#39;/usr/bin/ocaml-language-server&#39;, &#39;--stdio&#39;],
    \ &#39;reason&#39;: [&#39;/usr/bin/ocaml-language-server&#39;, &#39;--stdio&#39;]
    \ }
&#34; LanguageClient-neovim
nnoremap &lt;F5&gt; :call LanguageClient_contextMenu()&lt;CR&gt;
&#34; Or map each action separately
nnoremap &lt;silent&gt; K :call LanguageClient#textDocument_hover()&lt;CR&gt;
nnoremap &lt;silent&gt; gd :call LanguageClient#textDocument_definition()&lt;CR&gt;
nnoremap &lt;silent&gt; gr :call LanguageClient#textDocument_references()&lt;CR&gt;
nnoremap &lt;silent&gt; gf :call LanguageClient#textDocument_formatting()&lt;cr&gt;
nnoremap &lt;silent&gt; &lt;F2&gt; :call LanguageClient#textDocument_rename()&lt;CR&gt;
</code></pre></div>

<p dir="auto">Hazel is compiled to Javascript for the web browser via the <code>js_of_ocaml</code> compiler.</p>
<p dir="auto">Though <code>make</code> targets are provided as a convenience, they mostly translate to
<code>dune</code> commands.</p>
<p dir="auto">Invoking <code>make</code> by itself is equivalent to invoking <code>make dev</code>. With these
commands we pass additional flags to <code>js_of_ocaml</code> that cause the insertion of
comments that map locations in the generated JS to locations in the source
files. This is useful for debugging purposes.</p>
<p dir="auto"><code>make dev</code> also auto-formats Reason source files using <code>refmt</code> (this is what the
<code>@src/fmt</code> alias is for). This ensures code from all contributors follows the
same style.</p>
<p dir="auto">The <code>make dev</code> and <code>make release</code> commands do three things:</p>
<ol dir="auto">
<li>Generate some internal parsers using <code>menhir</code>.</li>
<li>Compile the Reason code to OCaml bytecode using the OCaml compiler.</li>
<li>Compile the OCaml bytecode to JavaScript
(<code>_build/default/src/hazelweb/www/hazel.js</code>) using <code>js_of_ocaml</code>.</li>
</ol>
<p dir="auto">For a smoother dev experience, use <code>make watch</code> to automatically watch
for file changes. This may require installing <code>fswatch</code> (see INSTALL.md).
You can also run <code>make watch-release</code> to continuously build the release
build (takes longer per build).</p>

<p dir="auto">To obtain an clean build, you may need to:</p>
<ul dir="auto">
<li>
<p dir="auto">Clone the repository (if you have not), and
enter the project root of your cloned Hazel project.</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone git@github.com:hazelgrove/hazel.git
cd hazel"><pre>git clone git@github.com:hazelgrove/hazel.git
<span>cd</span> hazel</pre></div>
</li>
<li>
<p dir="auto">Setup a local OCaml environment specific to the project, and compile.
If you have setup a local OCaml environment (there is a directory
called <code>_opam</code>), you may want to first remove it.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# opam switch remove ./
opam switch create ./ 5.2.0
eval $(opam env)
make deps
make"><pre><span><span>#</span> opam switch remove ./</span>
opam switch create ./ 5.2.0
<span>eval</span> <span><span>$(</span>opam env<span>)</span></span>
make deps
make</pre></div>
</li>
</ul>
<p dir="auto">This sets up a standalone OCaml environment in the cloned project,
independent of the one you sent in your home directory. This allow you to
alternate dependencies, or test dependencies changes, without affect
existing OCaml projects.</p>
<p dir="auto">NOTE: You may see the following warning when building:</p>
<div data-snippet-clipboard-copy-content="Warning 58 [no-cmx-file]: no cmx file was found in path for module Ezjs_idb, and its interface was not compiled with -opaque"><pre><code>Warning 58 [no-cmx-file]: no cmx file was found in path for module Ezjs_idb, and its interface was not compiled with -opaque
</code></pre></div>
<p dir="auto">This is due to an upstream library issue and does not cause problems with Hazel:</p>
<p dir="auto"><a data-error-text="Failed to load title" data-id="1884753539" data-permission-text="Title is private" data-url="https://github.com/OCamlPro/ezjs_idb/issues/1" data-hovercard-type="issue" data-hovercard-url="/OCamlPro/ezjs_idb/issues/1/hovercard" href="https://github.com/OCamlPro/ezjs_idb/issues/1">OCamlPro/ezjs_idb#1</a></p>


<p dir="auto">You can print to the browser console using the standard <code>print_endline</code> function. This is probably the easiest method right now.
Most datatypes in the codebase have something like <code>[@deriving (show({with_path: false}), sexp, yojson)]</code> on them. This generates
helper functions for printing and serializing this data. For a type named <code>t</code>, the <code>show</code> function will be named <code>show</code>. Otherwise,
for a type named something else like <code>q</code>, it will be <code>show_q</code>.</p>

<p dir="auto">Source maps for <code>js_of_ocaml</code> should be configured when making locally with the dev profile (<code>make</code>). This is configured using the env stanzas present in the <code>dune</code> files for each top-level directory.</p>
<p dir="auto">Since source maps are generated browser developer tools should show reason code in the debugger and source tree. Stack traces should also include reason line numbers.</p>

<p dir="auto">If Hazel is hanging on load or when you perform certain actions, you can load into Debug Mode by appending <code>#debug</code> to the URL and reloading. From there, you have some buttons that will change settings or reset local storage. Refresh without the <code>#debug</code> flag and hopefully you can resolve the situation from there.</p>

<p dir="auto">You can run all of the unit tests located in <code>test</code> by running <code>make test</code>.</p>
<p dir="auto">Unit tests are written using the <a href="https://github.com/mirage/alcotest">Alcotest framework</a>.</p>
<p dir="auto">See more documentation in the <a href="https://github.com/hazelgrove/hazel/blob/dev/test/README.md">test README</a></p>

<p dir="auto">Code coverage is provided by <a href="https://github.com/aantron/bisect_ppx">bisect_ppx</a>. To collect coverage statistics from tests run <code>make coverage</code>. After coverage statistics are generated, running <code>make generate-coverage-html</code> will generate a local webpage at <code>_coverage/index.html</code> that can be viewed to see line coverage per module.</p>

<p dir="auto">When you push your branch to the main <code>hazelgrove/hazel</code> repository, we
have a GitHub Action setup (see <code>.github/workflows/deploy_branches.yml</code>)
that will build that branch (in <code>release</code> mode) and deploy it to the URL
<code>https://hazel.org/build/&lt;branch name&gt;</code>, assuming the build succeeds.</p>
<p dir="auto">It usually takes about 2 minutes if the build environment cache hits, or
20+ minutes if not. You can view the status of the build in the <a href="https://github.com/hazelgrove/hazel/actions">Actions
tab on Github</a>.</p>
<p dir="auto">Builds prior to July 2024 are archived at <code>https://hazel.org/build-pre-july2024/&lt;branch name&gt;</code>.</p>
<p dir="auto">Note: If another archive needs to be performed, make sure to redeploy the following
branches manually since we refer to them in various public material (websites and
published papers):</p>
<p dir="auto">dev
livelits</p>
</article></div></div>
  </body>
</html>
