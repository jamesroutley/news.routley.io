<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.theregister.com/2023/04/27/microsoft_windows_rust/">Original</a>
    <h1>Microsoft is busy rewriting core Windows library code in memory-safe Rust</h1>
    
    <div id="readability-page-1" class="page"><div id="body">
<p>Microsoft is rewriting core Windows libraries in the Rust programming language, and the more memory-safe code is already reaching developers.</p>
<p>David &#34;dwizzle&#34; Weston, director of OS security for Windows, announced the arrival of Rust in the operating system&#39;s kernel at BlueHat IL 2023 in Tel Aviv, Israel, last month.</p>
<p>&#34;You will actually have Windows booting with Rust in the kernel in probably the next several weeks or months, which is really cool,&#34; he <a href="https://youtu.be/8T6ClX-y2AE?t=3100">said</a>. &#34;The basic goal here was to convert some of these internal C++ data types into their Rust equivalents.&#34;</p>

    

<p>Microsoft showed interest in Rust <a href="https://www.theregister.com/2019/07/18/microsoft_rust_security/">several years ago</a> as a way to catch and squash memory safety bugs before the code lands in the hands of users; these kinds of bugs were at the heart of about 70 percent of the CVE-listed security vulnerabilities patched by the Windows maker in its own products since 2006.</p>

        


        

<p>The Rust toolchain strives to prevent code from being built and shipped that is exploitable, which in an ideal world reduces opportunities for miscreants to attack weaknesses in software. Simply put, Rust is focused on memory safety and similar protections, which cuts down on the number of bad bugs in the resulting code.</p>
<p>Rivals like Google have already <a target="_blank" rel="nofollow" href="https://security.googleblog.com/2021/04/rust-in-android-platform.html">publicly declared</a> their affinity for Rust.</p>

        

<p>Amid growing industry support <a target="_blank" href="https://www.theregister.com/2023/01/26/memory_safety_mainstream/">for memory safe programming</a>, Microsoft&#39;s exploration of Rust has become more enthusiastic. And last September, it became an informal mandate: Microsoft Azure CTO Mark Russinovich <a href="https://www.theregister.com/2022/09/20/rust_microsoft_c/">declared</a> that new software projects should use Rust rather than C/C++.</p>
<p>The Rust renovation of Windows began in 2020 with DWriteCore, the Windows App SDK implementation of Windows&#39; <a href="https://learn.microsoft.com/en-us/windows/win32/directwrite/direct-write-portal">DWrite</a> engine for text analysis, layout, and rendering. DWriteCore now consists of about 152,000 lines of Rust code and about 96,000 lines of C++ code.</p>
<p>Beyond the presumed safety improvement, performance is said to be 5 to 15 percent faster for Shaping (substituting) glyphs with OTLS (OpenType Library Services). That&#39;s all available to developers now.</p>
<ul>

<li><a href="https://www.theregister.com/2023/04/17/rust_foundation_apologizes_trademark_policy/">Rust Foundation so sorry for scaring the C out of you with trademark crackdown talk</a></li>

<li><a href="https://www.theregister.com/2023/04/24/column/">If you don&#39;t get open source&#39;s trademark culture, expect bad language</a></li>

<li><a href="https://www.theregister.com/2023/04/13/google_api_security/">Worried about the security of your code&#39;s dependencies? Try Google&#39;s Deps.dev</a></li>

<li><a href="https://www.theregister.com/2023/01/13/microsoft_rust_azure_sphere/">Microsoft applies coat of Rust to Azure Sphere IoT platform</a></li>
</ul>
<p>The Microsoft Windows graphics device interface (<a href="https://learn.microsoft.com/en-us/windows/win32/gdi/windows-gdi">Win32 GDI</a>) is being ported to Rust and so far has 36,000 lines of Rust code. The latest version of Windows 11 boots with the Rust version, which passes all GDI tests, but the Rust port is currently disabled behind a feature-flag.</p>
<p>&#34;There&#39;s actually a SysCall in the Windows kernel now that is implemented in Rust,&#34; <a href="https://youtu.be/8T6ClX-y2AE?t=3149">said</a> Weston.</p>

        

<p>Microsoft&#39;s adoration of Rust does have limits. &#34;Rewriting Windows in Rust probably isn&#39;t going to happen anytime soon,&#34; said Weston, &#34;so while we love Rust, we need a strategy that also includes securing more of our native code.&#34;</p>
<p>But even qualified support from Microsoft is making Rust <a href="https://github.com/rust-lang/rust/pull/95051">more capable</a> through code contributions, and that benefits the entire open source community.</p>
<p><a href="https://github.com/mitsuhiko">Armin Ronacher</a>, an open source software developer, the chap behind Flask in Python, and current security engineer for Sentry, told <em>The Register</em> in an email that Microsoft&#39;s commitment to Rust is great for the language.</p>
<p>&#34;In particular, because I expect Microsoft to reuse the existing compiler, I hope that a side effect of this will be better <a rel="nofollow" href="https://github.com/Microsoft/microsoft-pdb">PDB</a> [Program Database] support,&#34; he said. &#34;Today on Windows, the developer tooling support is lagging behind what you get on <a rel="nofollow" href="https://developer.ibm.com/articles/au-dwarf-debug-format/">DWARF</a>-based [debugging with attributed record formats] platforms.&#34;</p>
<p>Samuel Colvin, founder of <a href="https://docs.pydantic.dev/">Pydantic</a> and a developer using Python and Rust, told <em>The Register</em> &#34;I&#39;m impressed by Microsoft being this forward thinking, but not very surprised. I&#39;m sure they&#39;re under pressure from their engineers to adopt Rust. If you&#39;re building an application today that&#39;s either performance critical or low-level, then Rust is a no-brainer at that point.&#34;</p>
<p>Colvin said that while good Rust engineers may not be ubiquitous, he believes it&#39;s easier to find good Rust engineers than good C/C++ engineers.</p>
<p>&#34;Although there are fewer people [with extensive Rust experience], there&#39;s a lot of engineers who are interested in trying to learn it,&#34; he said. &#34;And the sheer difficulty of writing code which is safe, it&#39;s an order of magnitude easier in Rust.&#34;</p>
<p>&#34;It&#39;s really exciting for those of us who rely on Rust that Microsoft is using it and so will hopefully support it,&#34; said Colvin. Â®</p>                                
                    </div></div>
  </body>
</html>
