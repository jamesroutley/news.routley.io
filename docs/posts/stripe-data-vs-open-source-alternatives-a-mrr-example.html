<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/getlago/lago/wiki/Stripe-Data-vs-Open%E2%80%90Source-Alternatives:-a-MRR-example">Original</a>
    <h1>Stripe Data vs. Open‐Source Alternatives: A MRR Example</h1>
    
    <div id="readability-page-1" class="page"><div data-view-component="true">          <div id="wiki-body">
              <div>
                <p>The founder of <a href="https://cal.com/" rel="nofollow">Cal.com</a> had some choice of words for Stripe:</p>
<p><img width="479" alt="Capture d’écran 2023-10-26 à 10 26 58" src="https://private-user-images.githubusercontent.com/85290767/278263692-7d162323-cae7-4080-8727-288272a55175.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjQ2Njc3MjYsIm5iZiI6MTcyNDY2NzQyNiwicGF0aCI6Ii84NTI5MDc2Ny8yNzgyNjM2OTItN2QxNjIzMjMtY2FlNy00MDgwLTg3MjctMjg4MjcyYTU1MTc1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MjYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODI2VDEwMTcwNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc2OTVkNmVjYjU0YTAxNjg0Mjk3YjI1YTRjOWEwMmZmMDBhMGE5NWQzODk3ZDE5MDIzNGQ1ZTlkNGFiNmQ5MDEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.EzBN083t8vkJBPZYVr9X_AYCwZU_sXjOBU0VneB9CMQ" content-type-secured-asset="image/png"/></p><p>Source: <a href="https://twitter.com/peer_rich/status/1701291062927503499" rel="nofollow">X</a></p>
<p>Not very kind words. But unfortunately, he’s right. Calculating MRR using Stripe’s out-of-the-box API is very difficult. This might come as a surprise to many because Stripe does provide a nifty embedded dashboard in its admin portal that includes MRR amongst other core metrics.</p>
<p><img src="https://camo.githubusercontent.com/77b1f2c4894e7d9513573a45d17ff96dbc79e1c181795227faf1d47944a34be7/68747470733a2f2f6173736574732d676c6f62616c2e776562736974652d66696c65732e636f6d2f3633353639663339306633613761643463373664326264362f3635326535313332353236666632393131613234313263345f5374726970654d52525f73637265656e312e706e67" alt="" data-canonical-src="https://assets-global.website-files.com/63569f390f3a7ad4c76d2bd6/652e5132526ff2911a2412c4_StripeMRR_screen1.png"/></p>
<p>To a founder of a seed stage startup, this dashboard is both helpful and likely sufficient. But as companies grow, they want to do more with their data. And Stripe doesn’t have an API route that’s equivalent to <code>/getMRR</code> or something similar. Without serious legwork, getting statistics into your own warehouse or database using Stripe’s main API is tough.</p>
<p><strong>This isn’t a matter of poor engineering. Stripe has one of the best engineering (and design) teams in the world. It’s just profit-maximizing strategy.</strong></p>
<p>Stripe keeps its API pretty barebones, expecting customers to purchase Stripe Sigma (fancy SQL editor) or Stripe Data Pipeline (in-house ETL tool) to better access data. Both of these tools add a cost per transaction, which is a little ridiculous given that Stripe’s base rate is higher <a href="https://directpaynet.com/stripe-fees-breakdown-comparison/" rel="nofollow">than competitors</a>, PayPal and Square.</p>
<div><h2>What options do you have?</h2><a id="user-content-what-options-do-you-have" aria-label="Permalink: What options do you have?" href="#what-options-do-you-have"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>If you are locked into Stripe, you still have options. Some, as aforementioned, are internal Stripe add-ons. Others are third-party tools. And, to spoil the surprise, they all come with a cost.</p>

<p><a href="https://stripe.com/en-fr/data-pipeline" rel="nofollow">Stripe Data Pipeline</a> is a limited ETL product that syncs Stripe data with a Snowflake or Amazon Redshift warehouse (presumably, they are building more integrations, but Stripe only supports those two presently). Advertised customers of Stripe Data Pipeline include Doordash, Slack, Zoom, and Hubspot.</p>
<p>While Stripe will definitely cut a volume deal to larger players, its base cost is $0.03 or €0.025 per transaction. Transaction, in this case, includes whenever a user was charged, an authorization was submitted, or a payment was requested. (While this post is mostly critical of Stripe, it’s worth acknowledging that Stripe includes provisions to not double charge customers for the same transaction, e.g. if an authorization is captured, it counts as one transaction, not two).</p>
<p>These Stripe extra fees can sound small. What’s a few cents, here and there? Well, it’s not a few cents. Sure, Stripe Data Pipeline is a great deal for customers where the median charge is $200-300, as the per-transaction fee reduces to a rounding error. But for companies with lots of smaller transactions (e.g. DoorDash or Lime), these charges are hardly trivial. They won’t overshadow Stripe’s core rake, but they add-up. <a href="https://backlinko.com/doordash-users" rel="nofollow">There were 816 million</a> DoorDash orders in 2020; even if Stripe cut DoorDash a hefty 50% discount, that’s <strong>10,200,000 annually. For 10M/year, I’m willing to bet you could build an entire billing company.</strong></p>

<p>Stripe Sigma isn’t exactly a replacement for exporting data (it supports CSV exports of reports, but that’s hardly data warehouse material). However, it does address some of the needs that a data warehouse might be attempting to solve, so it’s a worthy mention. For instance, you can calculate MRR (within reason) using Stripe Sigma.</p>
<p>Stripe Sigma is advertised as a collaborative, data-querying product that looks like a <a href="https://popsql.com/?utm_source=google&amp;utm_medium=CPC&amp;utm_campaign=all_search_brand&amp;utm_term=brand&amp;utm_term=Popsql&amp;gad_source=1&amp;gclid=Cj0KCQjwpc-oBhCGARIsAH6ote_fJ1-Ifuk7zp8NrJTZKUkUtYqgeFI7SxuMNgtAE3qdYkm7nZbf3IMaAkMnEALw_wcB" rel="nofollow">PopSQL</a> or <a href="https://www.basedash.com/" rel="nofollow">Basedash</a>. Teams can collaborate on SQL queries and filter / group data like they would when accessing a Postgres database. Data can be exported as a CSV or shared via a platform link.</p>
<p>And, for what it’s worth, Stripe Sigma is a helpful solution for a very specific type of company. A company where a data warehouse is overkill, transaction count is manageable, but data is abundant requiring analysis. I can name twenty people heading up mid-sized companies that’ll likely benefit from Stripe Sigma.</p>
<p>But just like Stripe Data Pipeline, Stripe Sigma is expensive when you add up the numbers. Alongside a base fee ($10/mo - $100/mo for &lt;50K transactions), Stripe charges an additional $0.020/transaction/mo - $0.014/transaction/mo based on volume.</p>
<p><em><strong>If a DoorDash employee queried all of their transaction history using Stripe Sigma, DoorDash’s CFO might have a stroke.</strong></em></p>
<div><h3>Both solutions fall flat for usage-based billing</h3><a id="user-content-both-solutions-fall-flat-for-usage-based-billing" aria-label="Permalink: Both solutions fall flat for usage-based billing" href="#both-solutions-fall-flat-for-usage-based-billing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>When you hear “usage-based billing”, you might think of a classic developer tool that charges per API call or server hours. Realistically, many SaaS applications feature usage-based billing because of seats. Technically, seats are a metric of usage. They can go up and down on a month-by-month basis, and seat costs are typically prorated.</p>
<p>The thing is, seats aren’t usually a volatile thing. Most SaaS apps don’t see customers radically changing seats unless there was a fresh round of funding, a massive layoff, or some weird restructuring. They are a quasi-MRR unit. We call it usage-based MRR, even if that sounds like an oxymoron.</p>
<p><strong>Stripe makes usage-based metrics impossible.</strong> We’re not arguing that they should be easy; accounting for various nuances of different billing metrics is difficult. But Stripe is entirely based on a subscription-based model. It’s not designed to be personalizable to businesses with various growth metrics. This creates a mess when analyzing data, even raw data exported from Stripe.</p>
<div><h3>Third-Party Financial Metrics tools</h3><a id="user-content-third-party-financial-metrics-tools" aria-label="Permalink: Third-Party Financial Metrics tools" href="#third-party-financial-metrics-tools"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>This is my favorite part. I’m always humored when massive companies could be built due to some design flaw of another product. Salesforce has a ton of these, and Stripe is no exception. <a href="https://chartmogul.com/" rel="nofollow">ChartMogul</a> (39M / yr <a href="https://chartmogul.com/" rel="nofollow">in revenue</a>) and <a href="https://profitwell.com/" rel="nofollow">ProfitWell</a> (<a href="https://techcrunch.com/2022/05/25/paddle-acquires-profitwell-for-200m-to-bring-analytics-and-retention-tools-to-its-saas-payments-platform/" rel="nofollow">acquired for $200M</a>) strictly exist due to Stripe’s limitations.</p>
<p>With both, you can generate reports or consolidate exports into data warehouses. They won’t account for everything (e.g. usage-based MRR), but they are a level-up from Stripe’s raw API.</p>
<div><h3>Third-Party FP&amp;A Tool, Pigment</h3><a id="user-content-third-party-fpa-tool-pigment" aria-label="Permalink: Third-Party FP&amp;A Tool, Pigment" href="#third-party-fpa-tool-pigment"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>This one is a bit extraneous, but <a href="https://www.gopigment.com/" rel="nofollow">Pigment</a> is a neat tool designed for FP&amp;A teams (Financial Planning and Analysis). Basically the folks that evaluate how to save money and make more money.</p>
<p>Today, Pigment <a href="https://www.gopigment.com/integrations" rel="nofollow">does not integrate</a> with Stripe, but it’s high-up on their roadmap. If I was to make a wild guess, they’ll announce an integration soon given how big of a space this is. With Pigment, teams could answer big-picture growth-based financial questions and build helpful dashboards. But, as you might gather, it’s for very large companies and isn’t priced for your average Series ABC startup.</p>
<div><h3>Use an ELT / ETL to dump the data into a warehouse</h3><a id="user-content-use-an-elt--etl-to-dump-the-data-into-a-warehouse" aria-label="Permalink: Use an ELT / ETL to dump the data into a warehouse" href="#use-an-elt--etl-to-dump-the-data-into-a-warehouse"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>Instead of using Stripe’s native ETL tool, Stripe Data Pipeline, you can use a third-party ETL / ELT tool to pull Stripe’s data into a warehouse. This is a good strategy for teams that already use an ETL / ELT tool for other purposes. Common examples of these are <a href="https://docs.airbyte.com/integrations/sources/stripe/" rel="nofollow">Airbyte</a>, <a href="https://www.fivetran.com/connectors/stripe" rel="nofollow">Fivetran</a>, and <a href="https://www.stitchdata.com/docs/integrations/saas/stripe" rel="nofollow">Stitch</a>. (The difference between ELT and ETL is where and how the data is transformed, but the general I/O is the same).</p>
<p>Of course, pulling data into Redshift or Snowflake doesn’t automatically solve your problem. You still need to calculate MRR. This is non-trivial. If we were to return to our <a href="https://cal.com/" rel="nofollow">Cal.com</a> friend, you can witness the frustration with his Benjamin Franklin offer:</p>
<p><img width="449" alt="Capture d’écran 2023-10-26 à 10 32 43" src="https://private-user-images.githubusercontent.com/85290767/278265308-3d2fcfa9-15c7-412a-a4ba-b821de89cad7.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MjQ2Njc3MjYsIm5iZiI6MTcyNDY2NzQyNiwicGF0aCI6Ii84NTI5MDc2Ny8yNzgyNjUzMDgtM2QyZmNmYTktMTVjNy00MTJhLWE0YmEtYjgyMWRlODljYWQ3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA4MjYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwODI2VDEwMTcwNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTMyYTRjMTgyMWNkMzUxZWRkNTM3YzkwMmQ2MTI0MDk5OGEzYTQxZmYxMmVjMmQwYjQ1ZTIwYTI1ZTcxMDVlNjQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.0TZ0s2q9RgCcV82Lu5y9xs2oNGZH5YgtHrmiejAem5s" content-type-secured-asset="image/png"/></p><p>Source: <a href="https://twitter.com/peer_rich/status/1701303837452083543?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1701303837452083543%7Ctwgr%5Ef27ef9916f11184ec4995cd6dde1389330364ad0%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.getlago.com%2Fblog%2Fcalculating-stripe-mrr-is-difficult" rel="nofollow">X</a></p>
<div><h2>Why open source billing solutions can solve it</h2><a id="user-content-why-open-source-billing-solutions-can-solve-it" aria-label="Permalink: Why open source billing solutions can solve it" href="#why-open-source-billing-solutions-can-solve-it"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>Full disclosure, Lago is an open source billing solution. But the reason we’re so passionate about this subject is the same reason we built the Lago framework.</p>
<p>By leveraging open source billing solutions, you’ll retain full ownership over your billing infrastructure. Of course, you can also build your own billing engine, and if you have the engineering bandwidth to do that, more power to you. But, given that <a href="https://www.getlago.com/blog/why-billing-systems-are-a-nightmare-for-engineers" rel="nofollow">billing is very hard with lots of edge cases</a>, many companies turn to external billing providers; all we’re saying is use an open-source one.</p>
<p>Take Lago, for instance. If you use our Docker distribution, you’ll immediately get a leg-up on Stripe users:</p>
<p>No reliance on ELT / ETL solution to dump data at defined intervals
No dependence on third-party tools to crunch complex queries
Ability to build financial reports directly on top of your financial queries
Of course, as developers of commercial open source software (COSS), we have our biases. But no one can deny, even Stripe engineers, that getting instant access to your financial data in Postgres—sweet, open-source Postgres—is very handy. (We use Postgres, if that wasn’t obvious). The table is broken into simple tables like invoices, events, and fees.</p>
<p>Because you own your data, you can easily ingest it into an analytics tool (like <a href="https://www.metabase.com/" rel="nofollow">open-source Metabase</a>) to build your own dashboards.</p>
<p><img src="https://camo.githubusercontent.com/36edaf7bc69004138ef8c4a8acc770aa3eb6dd06903de78c4374436e31f18e97/68747470733a2f2f6173736574732d676c6f62616c2e776562736974652d66696c65732e636f6d2f3633353639663339306633613761643463373664326264362f3635326535313364356262303965643339386532633238335f5374726970654d52525f53637265656e322e706e67" alt="" data-canonical-src="https://assets-global.website-files.com/63569f390f3a7ad4c76d2bd6/652e513d5bb09ed398e2c283_StripeMRR_Screen2.png"/></p>
<p>Or, if you use one of the many closed-source BI tools, that works too. The point is that the data is yours, and the PSQL queries are your oyster.</p>
<div><h2>Some Lago examples to demonstrate our point</h2><a id="user-content-some-lago-examples-to-demonstrate-our-point" aria-label="Permalink: Some Lago examples to demonstrate our point" href="#some-lago-examples-to-demonstrate-our-point"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>If you are serious about considering an open source library like Lago, it’s worth flipping through some basic revenue queries. To be clear, these are only basic queries for the sake of example—you can go a lot deeper with more advanced retention data.</p>
<div><h3>Calculating Total Revenue</h3><a id="user-content-calculating-total-revenue" aria-label="Permalink: Calculating Total Revenue" href="#calculating-total-revenue"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>If you want to calculate the total revenue with Lago, you will need to use the invoices table. In this table, there’s a simple trinity:</p>
<p><code>payment_status</code> = 0 are for <code>pending invoices</code>
<code>payment_status</code> = 1 are for <code>paid invoices</code>
<code>payment_status</code> = 2 are for <code>failed invoices</code>
Accordingly, a sample query for calculating total revenue looks like:</p>
<p><img src="https://camo.githubusercontent.com/dc26ff88a12c51bbf3683c6ce861a4ac72aaf215b6ab54be7d257d9435638d64/68747470733a2f2f6173736574732d676c6f62616c2e776562736974652d66696c65732e636f6d2f3633353639663339306633613761643463373664326264362f3635326535313665373532616163336135333566643532315f53637265656e73686f74253230323032332d31302d3137253230617425323031312e31302e34362e706e67" alt="" data-canonical-src="https://assets-global.website-files.com/63569f390f3a7ad4c76d2bd6/652e516e752aac3a535fd521_Screenshot%202023-10-17%20at%2011.10.46.png"/></p>
<p>If you want to break that data into month-by-month buckets, you can truncate it using <code>COALESCE</code> and a simple <code>GROUP BY</code> / <code>ORDER BY</code> pair.</p>
<p><img src="https://camo.githubusercontent.com/8c2c5964ea09606dd14f06c34d2a382fa6087c6128e7eb16ae85c7660d8c64bf/68747470733a2f2f6173736574732d676c6f62616c2e776562736974652d66696c65732e636f6d2f3633353639663339306633613761643463373664326264362f3635326535313736336133343761653438316664353464305f53637265656e73686f74253230323032332d31302d3137253230617425323031312e31312e30342e706e67" alt="" data-canonical-src="https://assets-global.website-files.com/63569f390f3a7ad4c76d2bd6/652e51763a347ae481fd54d0_Screenshot%202023-10-17%20at%2011.11.04.png"/></p>
<p>This results in a table that looks like this (please pardon my literal French):
<img src="https://camo.githubusercontent.com/13ff034f71c651e3f0d0e65721a345b9fd1be53fd19a74aa22c34ff6f99c9fa9/68747470733a2f2f6173736574732d676c6f62616c2e776562736974652d66696c65732e636f6d2f3633353639663339306633613761643463373664326264362f3635326535313437643339656535653066386261633765335f5374726970654d52525f53637265656e332e706e67" alt="" data-canonical-src="https://assets-global.website-files.com/63569f390f3a7ad4c76d2bd6/652e5147d39ee5e0f8bac7e3_StripeMRR_Screen3.png"/></p>
<p>Some notes on the table:</p>
<p>This revenue gathers <strong>subscriptions</strong>, <strong>usage based billing</strong> and <strong>add-ons</strong>.
We use the <code>issuing_date</code> of an invoice instead of the <code>created_at</code>. Because Lago can issue draft invoices, this always ensures we take the date of final stage of an invoice.</p>
<div><h3>Calculating Basic MRR &amp; ARR</h3><a id="user-content-calculating-basic-mrr--arr" aria-label="Permalink: Calculating Basic MRR &amp; ARR" href="#calculating-basic-mrr--arr"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p>MRR is tracking and calculating revenue from recurring <code>subscription</code> fees. To effectively calculate MRR, you&#39;ll need to fetch data from the <code>fees</code> table as part of the input data, and remove anything related to usage (called <code>charge</code> in Lago) and <code>add-ons</code> (created by one-time invoices).</p>
<p>The query amounts to:
<img src="https://camo.githubusercontent.com/2b7b86f94dd0746a65a0b62b588e02a2cedfcf58b333b28872550429ca31e331/68747470733a2f2f6173736574732d676c6f62616c2e776562736974652d66696c65732e636f6d2f3633353639663339306633613761643463373664326264362f3635326535313835613966653735633431646662633438665f53637265656e73686f74253230323032332d31302d3137253230617425323031312e31312e32342e706e67" alt="" data-canonical-src="https://assets-global.website-files.com/63569f390f3a7ad4c76d2bd6/652e5185a9fe75c41dfbc48f_Screenshot%202023-10-17%20at%2011.11.24.png"/></p>
<p>A likewise query for calculating ARR looks like:
<img src="https://camo.githubusercontent.com/3a6ff0e3612d41a115c7e646b0221ddaddc557b2bfb6296ab56a65261b4c0035/68747470733a2f2f6173736574732d676c6f62616c2e776562736974652d66696c65732e636f6d2f3633353639663339306633613761643463373664326264362f3635326535313931343631383337626630353938653632355f53637265656e73686f74253230323032332d31302d3137253230617425323031312e31312e33322e706e67" alt="" data-canonical-src="https://assets-global.website-files.com/63569f390f3a7ad4c76d2bd6/652e5191461837bf0598e625_Screenshot%202023-10-17%20at%2011.11.32.png"/></p>
<p>Some notes here:</p>
<p>We might want to remove any discounts from this calculation in the future. In that case, we can just remove <code>coupons</code> or <code>wallets</code> data.
We might want to remove refunds (<code>credit_notes</code> table) from this calculation.
Regardless, even with some additional contingencies, calculating MRR or ARR using an open source solution is really easy.</p>

<p>Since Lago operates first as a <strong>usage-based billing solution</strong>, optimizing the calculation of usage is crucial. You can refer to this as &#34;Usage MRR,&#34; which may not follow a consistent usage pattern (i.e. not necessarily recurring) and can exhibit fluctuations between months.</p>
<p>To calculate Usage MRR, you will need to fetch data from the <code>fees</code> table as part of the input data, and add only fees related to usage (called <code>charge</code> in Lago). Some of the charges can be <code>recurring</code> (more predictable), and others can be <code>metered</code> (less predictable).</p>

<p>Unfortunately, as closed-source companies grow, they tend to forgo basic features in favor of incentivizing upgrades. This is exactly the case with Stripe. Stripe wants customers to purchase Stripe Data Pipeline or Stripe Sigma to increase their per transaction revenue per customer. In certain cases, these tools are great and affordable, but for many, it’s very expensive.</p>
<p>Worse, Stripe’s structure makes calculating recurring revenue very, very difficult whenever organizations leverage a usage-based billing model. And that includes everyday SaaS apps that bill on a per-seat basis. There are tools to solve this (such as ProfitWell and Pigment), but they are either expensive, built for larger companies, or both.</p>
<p>The most surefire approach to conquer your billing woes is to build billing in-house or leverage an open source framework. We’re obviously biased towards the latter (particularly our open source framework), <strong>but the point stands that companies shouldn’t let their financial data be held hostage to the land and expand goals of Stripe’s sales team.</strong></p>
<p>‍</p>

              </div>

          </div>
</div></div>
  </body>
</html>
