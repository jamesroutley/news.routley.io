<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://geekpython.in/gil-become-optional-in-python">Original</a>
    <h1>GIL Become Optional in Python 3.13</h1>
    
    <div id="readability-page-1" class="page"><div id="wrap">

			
			
<!-- #site-header -->


			
			<main id="main" role="main">

				
	
	<div id="content-wrap">

		
		<div id="primary">

			
			<div id="content">

				
				
<article id="post-1758">

	
<p><img width="1600" height="840" src="https://geekpython.in/wp-content/uploads/2024/08/nogil.png" alt="You are currently viewing GIL Become Optional in Python 3.13" itemprop="image" decoding="async" srcset="https://geekpython.in/wp-content/uploads/2024/08/nogil.png 1600w, https://geekpython.in/wp-content/uploads/2024/08/nogil-300x158.png 300w, https://geekpython.in/wp-content/uploads/2024/08/nogil-1024x538.png 1024w, https://geekpython.in/wp-content/uploads/2024/08/nogil-768x403.png 768w, https://geekpython.in/wp-content/uploads/2024/08/nogil-1536x806.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px"/>
</p><!-- .thumbnail -->


<!-- .entry-header -->






<div itemprop="text">
	
<p><strong>GIL</strong> or <strong>Global Interpreter Lock</strong> can be disabled in Python version 3.13. This is currently experimental.</p>



<p>What is GIL? It is a mechanism used by the CPython interpreter to ensure that only one thread executes the Python bytecode at a time.</p>



<h2>An Experimental Feature</h2>



<p>Python 3.13 brings major new features compared to Python 3.12 and one of them is free-threaded mode, which disables the Global Interpreter Lock, allowing threads to run more concurrently.</p>



<p>This is an experimental feature and if you want to try it, you can download the beta version of Python 3.13 from <a target="_blank" rel="noreferrer noopener nofollow" href="https://www.python.org/downloads/release/python-3130b3/">here</a>.</p>



<p>At the time of installation, check the option “free threaded binaries(experimental)” to get the feature in Python.</p>



<h2>Making GIL Optional in Python 3.13</h2>



<p>The GIL will be disabled when you configure the Python with the <code>--disable-gil</code> option which is nothing but a build configuration (free threading build) at the time of installation.</p>



<p>This will allow optionally enabling and disabling GIL using the environment variable <code>PYTHON_GIL</code> which can be set to <code>1</code> and <code>0</code> respectively.</p>



<p>It will also provide a command-line option <code>-X gil</code> which can also be set to <code>0</code> (disable) and <code>1</code> (enable).</p>



<div><!-- Urvanov Syntax Highlighter v2.8.37 -->

		<div id="urvanov-syntax-highlighter-66b889aa29bb8088136160" data-settings=" no-popup minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span># v3.13</span></p><p><span># GIL disabled</span></p><p><span>python3</span><span> </span><span>-</span><span>X</span><span> </span><span>gil</span><span>=</span><span>0</span><span> </span><span>sample</span><span>.</span><span>py</span></p><p><span># GIL enabled</span></p><p><span>python3</span><span> </span><span>-</span><span>X</span><span> </span><span>gil</span><span>=</span><span>1</span><span> </span><span>sample</span><span>.</span><span>py</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0006 seconds] -->
</div>



<p>We can also check if the current interpreter is configured with the free threading build (<code>--disable-gil</code>) by using the following code.</p>



<div><!-- Urvanov Syntax Highlighter v2.8.37 -->

		<div id="urvanov-syntax-highlighter-66b889aa29bbf063813715" data-settings=" no-popup minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>import</span><span> </span><span>sysconfig</span></p><p><span>print</span><span>(</span><span>sysconfig</span><span>.</span><span>get_config_var</span><span>(</span><span>&#34;Py_GIL_DISABLED&#34;</span><span>)</span><span>)</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<p>If we run this, we’ll get either <code>0</code> which means GIL is enabled, or <code>1</code> which means GIL is disabled.</p>



<p>With this, we’ll also get a function that can be used to check if GIL is disabled in the running process.</p>



<div><!-- Urvanov Syntax Highlighter v2.8.37 -->

		<div id="urvanov-syntax-highlighter-66b889aa29bc1251019352" data-settings=" no-popup minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p><span>import</span><span> </span><span>sys</span></p><p><span>sys</span><span>.</span><span>_is_gil_enabled</span><span>(</span><span>)</span><span>  </span><span># returns a boolean value</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0001 seconds] -->
</div>



<h2>GIL Vs No GIL</h2>



<p>Let’s see how the performance of multi-threaded programs will be affected when GIL is enabled and disabled.</p>



<p>We have a simple Python program (<code>gil.py</code>) that computes the factorial of numbers and compares the execution time taken by single-threaded, multi-thread, and multi-process tasks. We’ll run this Python program first <strong>with GIL</strong> and then <strong>without GIL</strong>.</p>



<div><!-- Urvanov Syntax Highlighter v2.8.37 -->

		<div id="urvanov-syntax-highlighter-66b889aa29bc2360749990" data-settings=" no-popup minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					<div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p><p>65</p><p>66</p><p>67</p><p>68</p><p>69</p><p>70</p><p>71</p><p>72</p><p>73</p><p>74</p><p>75</p><p>76</p><p>77</p><p>78</p><p>79</p><p>80</p><p>81</p><p>82</p></div>
				</td>
						<td><div><p><span>import</span><span> </span><span>sys</span></p><p><span>import</span><span> </span><span>sysconfig</span></p><p><span>import</span><span> </span><span>math</span></p><p><span>import</span><span> </span><span>time</span></p><p><span>import</span><span> </span><span>threading</span></p><p><span>import</span><span> </span><span>multiprocessing</span></p><p><span>def</span><span> </span><span>compute_factorial</span><span>(</span><span>n</span><span>)</span><span>:</span></p><p><span>    </span><span>return</span><span> </span><span>math</span><span>.</span><span>factorial</span><span>(</span><span>n</span><span>)</span></p><p><span># Single-threaded</span></p><p><span>def</span><span> </span><span>single_threaded_compute</span><span>(</span><span>n</span><span>)</span><span>:</span></p><p><span>    </span><span>for</span><span> </span><span>num </span><span>in</span><span> </span><span>n</span><span>:</span></p><p><span>        </span><span>compute_factorial</span><span>(</span><span>num</span><span>)</span></p><p><span>    </span><span>print</span><span>(</span><span>&#34;Single-threaded: Factorial Computed.&#34;</span><span>)</span></p><p><span># Multi-threaded</span></p><p><span>def</span><span> </span><span>multi_threaded_compute</span><span>(</span><span>n</span><span>)</span><span>:</span></p><p><span>    </span><span>threads</span><span> </span><span>=</span><span> </span><span>[</span><span>]</span></p><p><span>    </span><span># Create 5 threads</span></p><p><span>    </span><span>for</span><span> </span><span>num </span><span>in</span><span> </span><span>n</span><span>:</span></p><p><span>        </span><span>thread</span><span> </span><span>=</span><span> </span><span>threading</span><span>.</span><span>Thread</span><span>(</span><span>target</span><span>=</span><span>compute_factorial</span><span>,</span><span> </span><span>args</span><span>=</span><span>(</span><span>num</span><span>,</span><span>)</span><span>)</span></p><p><span>        </span><span>threads</span><span>.</span><span>append</span><span>(</span><span>thread</span><span>)</span></p><p><span>        </span><span>thread</span><span>.</span><span>start</span><span>(</span><span>)</span></p><p><span>    </span><span># Wait for all threads to complete</span></p><p><span>    </span><span>for</span><span> </span><span>thread</span><span> </span><span>in</span><span> </span><span>threads</span><span>:</span></p><p><span>        </span><span>thread</span><span>.</span><span>join</span><span>(</span><span>)</span></p><p><span>    </span><span>print</span><span>(</span><span>&#34;Multi-threaded: Factorial Computed.&#34;</span><span>)</span></p><p><span># Multi-process</span></p><p><span>def</span><span> </span><span>multi_processing_compute</span><span>(</span><span>n</span><span>)</span><span>:</span></p><p><span>    </span><span>processes</span><span> </span><span>=</span><span> </span><span>[</span><span>]</span></p><p><span>    </span><span># Create a process for each number in the list</span></p><p><span>    </span><span>for</span><span> </span><span>num </span><span>in</span><span> </span><span>n</span><span>:</span></p><p><span>        </span><span>process</span><span> </span><span>=</span><span> </span><span>multiprocessing</span><span>.</span><span>Process</span><span>(</span><span>target</span><span>=</span><span>compute_factorial</span><span>,</span><span> </span><span>args</span><span>=</span><span>(</span><span>num</span><span>,</span><span>)</span><span>)</span></p><p><span>        </span><span>processes</span><span>.</span><span>append</span><span>(</span><span>process</span><span>)</span></p><p><span>        </span><span>process</span><span>.</span><span>start</span><span>(</span><span>)</span></p><p><span>    </span><span># Wait for all processes to complete</span></p><p><span>    </span><span>for</span><span> </span><span>process </span><span>in</span><span> </span><span>processes</span><span>:</span></p><p><span>        </span><span>process</span><span>.</span><span>join</span><span>(</span><span>)</span></p><p><span>    </span><span>print</span><span>(</span><span>&#34;Multi-process: Factorial Computed.&#34;</span><span>)</span></p><p><span>def</span><span> </span><span>main</span><span>(</span><span>)</span><span>:</span></p><p><span>    </span><span># Checking Version</span></p><p><span>    </span><span>print</span><span>(</span><span>f</span><span>&#34;Python version: {sys.version}&#34;</span><span>)</span></p><p><span>    </span><span># GIL Status</span></p><p><span>    </span><span>status</span><span> </span><span>=</span><span> </span><span>sysconfig</span><span>.</span><span>get_config_var</span><span>(</span><span>&#34;Py_GIL_DISABLED&#34;</span><span>)</span></p><p><span>    </span><span>if</span><span> </span><span>status </span><span>is</span><span> </span><span>None</span><span>:</span></p><p><span>        </span><span>print</span><span>(</span><span>&#34;GIL cannot be disabled&#34;</span><span>)</span></p><p><span>    </span><span>if</span><span> </span><span>status</span><span> </span><span>==</span><span> </span><span>0</span><span>:</span></p><p><span>        </span><span>print</span><span>(</span><span>&#34;GIL is active&#34;</span><span>)</span></p><p><span>    </span><span>if</span><span> </span><span>status</span><span> </span><span>==</span><span> </span><span>1</span><span>:</span></p><p><span>        </span><span>print</span><span>(</span><span>&#34;GIL is disabled&#34;</span><span>)</span></p><p><span>    </span><span>numlist</span><span> </span><span>=</span><span> </span><span>[</span><span>100000</span><span>,</span><span> </span><span>200000</span><span>,</span><span> </span><span>300000</span><span>,</span><span> </span><span>400000</span><span>,</span><span> </span><span>500000</span><span>]</span></p><p><span>    </span><span># Single-threaded Execution</span></p><p><span>    </span><span>start</span><span> </span><span>=</span><span> </span><span>time</span><span>.</span><span>time</span><span>(</span><span>)</span></p><p><span>    </span><span>single_threaded_compute</span><span>(</span><span>numlist</span><span>)</span></p><p><span>    </span><span>end</span><span> </span><span>=</span><span> </span><span>time</span><span>.</span><span>time</span><span>(</span><span>)</span><span> </span><span>-</span><span> </span><span>start</span></p><p><span>    </span><span>print</span><span>(</span><span>f</span><span>&#34;Single-threaded time taken: {end:.2f} seconds&#34;</span><span>)</span></p><p><span>    </span><span># Multi-threaded Execution</span></p><p><span>    </span><span>start</span><span> </span><span>=</span><span> </span><span>time</span><span>.</span><span>time</span><span>(</span><span>)</span></p><p><span>    </span><span>multi_threaded_compute</span><span>(</span><span>numlist</span><span>)</span></p><p><span>    </span><span>end</span><span> </span><span>=</span><span> </span><span>time</span><span>.</span><span>time</span><span>(</span><span>)</span><span> </span><span>-</span><span> </span><span>start</span></p><p><span>    </span><span>print</span><span>(</span><span>f</span><span>&#34;Multi-threaded time taken : {end:.2f} seconds&#34;</span><span>)</span></p><p><span>    </span><span># Multi-process Execution</span></p><p><span>    </span><span>start</span><span> </span><span>=</span><span> </span><span>time</span><span>.</span><span>time</span><span>(</span><span>)</span></p><p><span>    </span><span>multi_processing_compute</span><span>(</span><span>numlist</span><span>)</span></p><p><span>    </span><span>end</span><span> </span><span>=</span><span> </span><span>time</span><span>.</span><span>time</span><span>(</span><span>)</span><span> </span><span>-</span><span> </span><span>start</span></p><p><span>    </span><span>print</span><span>(</span><span>f</span><span>&#34;Multi-process time taken  : {end:.2f} seconds&#34;</span><span>)</span></p><p><span>if</span><span> </span><span>__name__</span><span> </span><span>==</span><span> </span><span>&#34;__main__&#34;</span><span>:</span></p><p><span>    </span><span>main</span><span>(</span><span>)</span></p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0037 seconds] -->
</div>



<h3>Running <code>gil.py</code> with GIL</h3>



<div><!-- Urvanov Syntax Highlighter v2.8.37 -->

		<div id="urvanov-syntax-highlighter-66b889aa29bc5048243661" data-settings=" no-popup minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p>python<span> </span>gil<span>.</span>py</p><p>Python<span> </span>version<span>:</span><span> </span>3<span>.</span>12<span>.</span>2<span> </span><span>(</span>tags/v3<span>.</span>12<span>.</span>2<span>:</span>6abddd9<span>,</span><span> </span>Feb<span>  </span>6<span> </span>2024<span>,</span><span> </span>21<span>:</span>26<span>:</span>36<span>)</span><span> </span><span>[</span>MSC<span> </span>v<span>.</span>1937<span> </span>64<span> </span>bit<span> </span><span>(</span>AMD64<span>)</span><span>]</span></p><p>GIL<span> </span>cannot<span> </span>be<span> </span>disabled</p><p>Single-threaded<span>:</span><span> </span>Factorial<span> </span>Computed<span>.</span></p><p>Single-threaded<span> </span>time<span> </span>taken<span>:</span><span> </span>9<span>.</span>04<span> </span>seconds</p><p>Multi-threaded<span>:</span><span> </span>Factorial<span> </span>Computed<span>.</span></p><p>Multi-threaded<span> </span>time<span> </span>taken<span> </span><span>:</span><span> </span>8<span>.</span>21<span> </span>seconds</p><p>Multi-process<span>:</span><span> </span>Factorial<span> </span>Computed<span>.</span></p><p>Multi-process<span> </span>time<span> </span>taken<span>  </span><span>:</span><span> </span>5<span>.</span>64<span> </span>seconds</p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<p>We have Python v3.12 in which there is no option to check the GIL status, so we got “GIL cannot be disabled”.</p>



<p>The difference is not that much between the single-threaded and multi-threaded but we can see a pretty decent difference in the case of multi-process task.</p>



<h3>Running <code>gil.py</code> without GIL</h3>



<div><!-- Urvanov Syntax Highlighter v2.8.37 -->

		<div id="urvanov-syntax-highlighter-66b889aa29bc6502563928" data-settings=" no-popup minimize scroll-mouseover">
		
			
			
			
			<div>
				<table>
					<tbody><tr>
				<td data-settings="hide">
					
				</td>
						<td><div><p>D<span>:</span>/SACHIN/Python13/python3<span>.</span>13t<span> </span>gil<span>.</span>py</p><p>Python<span> </span>version<span>:</span><span> </span>3<span>.</span>13<span>.</span>0b3<span> </span>experimental<span> </span>free-threading<span> </span>build<span> </span><span>(</span>tags/v3<span>.</span>13<span>.</span>0b3<span>:</span>7b41395<span>,</span><span> </span>Jun<span> </span>27<span> </span>2024<span>,</span><span> </span>16<span>:</span>17<span>:</span>17<span>)</span><span> </span><span>[</span>MSC<span> </span>v<span>.</span>1940<span> </span>64<span> </span>bit<span> </span><span>(</span>AMD64<span>)</span><span>]</span></p><p>GIL<span> </span>is<span> </span>disabled</p><p>Single-threaded<span>:</span><span> </span>Factorial<span> </span>Computed<span>.</span></p><p>Single-threaded<span> </span>time<span> </span>taken<span>:</span><span> </span>9<span>.</span>28<span> </span>seconds</p><p>Multi-threaded<span>:</span><span> </span>Factorial<span> </span>Computed<span>.</span></p><p>Multi-threaded<span> </span>time<span> </span>taken<span> </span><span>:</span><span> </span>4<span>.</span>86<span> </span>seconds</p><p>Multi-process<span>:</span><span> </span>Factorial<span> </span>Computed<span>.</span></p><p>Multi-process<span> </span>time<span> </span>taken<span>  </span><span>:</span><span> </span>6<span>.</span>14<span> </span>seconds</p></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
</div>



<p>This time we have a third beta version of Python 3.13 configured with free threading build and as we can see the GIL is disabled.</p>



<p>But the most important part is we can see a massive difference in the performance of multi-threaded task and on the other side, some degradation can be seen in the performance of multi-process and single-threaded task.</p>



<hr/>



<p>🏆<strong>Other articles you might be interested in if you liked this one</strong></p>



<p>✅<a target="_blank" rel="noreferrer noopener" href="https://geekpython.in/threading-module-to-create-threads-in-python">Create multi-threaded Python programs using a threading module</a>.</p>



<p>✅<a target="_blank" rel="noreferrer noopener" href="https://geekpython.in/template-inheritance-in-flask">Template inheritance in Flask</a>.</p>



<p>✅<a target="_blank" rel="noreferrer noopener" href="https://geekpython.in/exec-and-eval">Difference between exec and eval in Python</a>.</p>



<p>✅<a target="_blank" rel="noreferrer noopener" href="https://geekpython.in/tempfile-in-python">Create temporary files and directories using tempfile module in Python</a>.</p>



<p>✅<a target="_blank" rel="noreferrer noopener" href="https://geekpython.in/render-images-from-flask">Upload and display images on the frontend using Flask</a>.</p>



<p>✅<a target="_blank" rel="noreferrer noopener" href="https://geekpython.in/impact-of-learning-rates-on-ml-and-dl-models">How does the learning rate affect the ML and DL models</a>?</p>



<hr/>



<p><strong>That’s all for now</strong></p>



<p><strong>Keep Coding✌✌</strong></p>

</div><!-- .entry -->




<!-- .entry-share -->
	<!-- .related-posts -->




</article>

				
			</div><!-- #content -->

			
		</div><!-- #primary -->

		

<!-- #right-sidebar -->


	</div><!-- #content-wrap -->

	

	</main><!-- #main -->

	
	
	
		
<!-- #footer -->

	
	
</div></div>
  </body>
</html>
