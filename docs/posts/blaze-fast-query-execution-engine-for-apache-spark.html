<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/blaze-init/blaze">Original</a>
    <h1>Blaze: Fast query execution engine for Apache Spark</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">

<p dir="auto">The Blaze accelerator for Apache Spark leverages native vectorized execution to accelerate query processing. It combines
the power of the <a href="https://arrow.apache.org/datafusion/" rel="nofollow">Apache Arrow-DataFusion</a> library and the scale of the Spark distributed
computing framework.</p>
<p dir="auto">Blaze takes a fully optimized physical plan from Spark, mapping it into DataFusion&#39;s execution plan, and performs native
plan computation in Spark executors.</p>
<p dir="auto">Blaze is composed of the following high-level components:</p>
<ul dir="auto">
<li><strong>Spark Extension</strong>: hooks the whole accelerator into Spark execution lifetime.</li>
<li><strong>Spark Shims</strong>: specialized codes for different versions of spark.</li>
<li><strong>Native Engine</strong>: implements the native engine in rust, including:
<ul dir="auto">
<li>ExecutionPlan protobuf specification</li>
<li>JNI gateway</li>
<li>Customized operators, expressions, functions</li>
</ul>
</li>
</ul>
<p dir="auto">Based on the inherent well-defined extensibility of DataFusion, Blaze can be easily extended to support:</p>
<ul dir="auto">
<li>Various object stores.</li>
<li>Operators.</li>
<li>Simple and Aggregate functions.</li>
<li>File formats.</li>
</ul>
<p dir="auto">We encourage you to <a href="https://github.com/apache/arrow-datafusion">extend DataFusion</a> capability directly and add the
supports in Blaze with simple modifications in plan-serde and extension translation.</p>
<h2 tabindex="-1" id="user-content-build-from-source" dir="auto"><a href="#build-from-source">Build from source<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">To build Blaze, please follow the steps below:</p>
<ol dir="auto">
<li>Install Rust</li>
</ol>
<p dir="auto">The native execution lib is written in Rust. So you&#39;re required to install Rust (nightly) first for
compilation. We recommend you to use <a href="https://rustup.rs/" rel="nofollow">rustup</a>.</p>
<ol start="2" dir="auto">
<li>Install JDK+Maven</li>
</ol>
<p dir="auto">Blaze has been well tested on jdk8 and maven3.5, should work fine with higher versions.</p>
<ol start="3" dir="auto">
<li>Check out the source code.</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="git clone git@github.com:blaze-init/blaze.git
cd blaze"><pre>git clone git@github.com:blaze-init/blaze.git
<span>cd</span> blaze</pre></div>
<ol start="4" dir="auto">
<li>Build the project.</li>
</ol>
<p dir="auto"><em>Specify shims package of which spark version that you would like to run on.</em>
<em>You could either build Blaze in dev mode for debugging or in release mode to unlock the full potential of
Blaze.</em></p>
<div dir="auto" data-snippet-clipboard-copy-content="SHIM=spark333 # or spark303
MODE=release # or dev
mvn package -P&#34;${SHIM}&#34; -P&#34;${MODE}&#34;"><pre>SHIM=spark333 <span><span>#</span> or spark303</span>
MODE=release <span><span>#</span> or dev</span>
mvn package -P<span><span>&#34;</span><span>${SHIM}</span><span>&#34;</span></span> -P<span><span>&#34;</span><span>${MODE}</span><span>&#34;</span></span></pre></div>
<p dir="auto">After the build is finished, a fat Jar package that contains all the dependencies will be generated in the <code>target</code>
directory.</p>
<h2 tabindex="-1" id="user-content-build-with-docker" dir="auto"><a href="#build-with-docker">Build with docker<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto"><em>You can use the following command to build a centos-7 compatible release:</em></p>
<div dir="auto" data-snippet-clipboard-copy-content="SHIM=spark333 MODE=release ./release-docker.sh"><pre>SHIM=spark333 MODE=release ./release-docker.sh</pre></div>
<h2 tabindex="-1" id="user-content-run-spark-job-with-blaze-accelerator" dir="auto"><a href="#run-spark-job-with-blaze-accelerator">Run Spark Job with Blaze Accelerator<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">This section describes how to submit and configure a Spark Job with Blaze support.</p>
<ol dir="auto">
<li>
<p dir="auto">move blaze jar package to spark client classpath (normally <code>spark-xx.xx.xx/jars/</code>).</p>
</li>
<li>
<p dir="auto">add the follow confs to spark configuration in <code>spark-xx.xx.xx/conf/spark-default.conf</code>:</p>
</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="spark.sql.extensions org.apache.spark.sql.blaze.BlazeSparkSessionExtension
spark.shuffle.manager org.apache.spark.sql.execution.blaze.shuffle.BlazeShuffleManager

# other blaze confs defined in spark-extension/src/main/java/org/apache/spark/sql/blaze/BlazeConf.java"><pre>spark.sql.extensions org.apache.spark.sql.blaze.BlazeSparkSessionExtension
spark.shuffle.manager org.apache.spark.sql.execution.blaze.shuffle.BlazeShuffleManager

<span><span>#</span> other blaze confs defined in spark-extension/src/main/java/org/apache/spark/sql/blaze/BlazeConf.java</span></pre></div>
<ol start="3" dir="auto">
<li>submit a query with spark-sql, or other tools like spark-thriftserver:</li>
</ol>
<div dir="auto" data-snippet-clipboard-copy-content="spark-sql -f tpcds/q01.sql"><pre>spark-sql -f tpcds/q01.sql</pre></div>
<h2 tabindex="-1" id="user-content-performance" dir="auto"><a href="#performance">Performance<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Check <a href="https://github.com/blaze-init/blaze/blob/master/benchmark-results/20230925.md">Benchmark Results</a> with the latest date for the performance
comparison with vanilla Spark on TPC-DS 1TB dataset. The benchmark result shows that Blaze saved
~40% query time and ~45% cluster resources in average. ~5x performance achieved for the best case (q06).
Stay tuned and join us for more upcoming thrilling numbers.</p>
<p dir="auto">Query time:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/blaze-init/blaze/blob/master/benchmark-results/blaze-query-time-comparison-20230925.png"><img src="https://github.com/blaze-init/blaze/raw/master/benchmark-results/blaze-query-time-comparison-20230925.png" alt="20230925-query-time"/></a></p>
<p dir="auto">Cluster resources:
<a target="_blank" rel="noopener noreferrer" href="https://github.com/blaze-init/blaze/blob/master/benchmark-results/blaze-executor-time-comparison-20230925.png"><img src="https://github.com/blaze-init/blaze/raw/master/benchmark-results/blaze-executor-time-comparison-20230925.png" alt="20230925-resources"/></a></p>
<p dir="auto">We also encourage you to benchmark Blaze and share the results with us. ðŸ¤—</p>
<h2 tabindex="-1" id="user-content-community" dir="auto"><a href="#community">Community<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">We&#39;re using <a href="https://github.com/blaze-init/blaze/discussions">Discussions</a> to connect with other members
of our community. We hope that you:</p>
<ul dir="auto">
<li>Ask questions you&#39;re wondering about.</li>
<li>Share ideas.</li>
<li>Engage with other community members.</li>
<li>Welcome others and are open-minded. Remember that this is a community we build together ðŸ’ª .</li>
</ul>
<h2 tabindex="-1" id="user-content-license" dir="auto"><a href="#license">License<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Blaze is licensed under the Apache 2.0 License. A copy of the license
<a href="https://github.com/blaze-init/blaze/blob/master/LICENSE.txt">can be found here.</a></p>
</article>
          </div></div>
  </body>
</html>
