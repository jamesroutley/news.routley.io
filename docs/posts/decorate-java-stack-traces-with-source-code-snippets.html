<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/laech/java-stacksrc">Original</a>
    <h1>Show HN: Decorate Java stack traces with source code snippets</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/1f04ce7b05a57f87b8aa83b70b3b52dd2233a47769f3da023fb72c278564cc41/68747470733a2f2f696d672e736869656c64732e696f2f6d6176656e2d63656e7472616c2f762f6e7a2e6c61652e737461636b7372632f737461636b7372632d636f72653f636f6c6f723d626c7565"><img src="https://camo.githubusercontent.com/1f04ce7b05a57f87b8aa83b70b3b52dd2233a47769f3da023fb72c278564cc41/68747470733a2f2f696d672e736869656c64732e696f2f6d6176656e2d63656e7472616c2f762f6e7a2e6c61652e737461636b7372632f737461636b7372632d636f72653f636f6c6f723d626c7565" alt="Maven Central" data-canonical-src="https://img.shields.io/maven-central/v/nz.lae.stacksrc/stacksrc-core?color=blue"/></a></p>
<p dir="auto">The goal of this project is to decorate stack traces of test failures to make
them more useful.</p>
<p dir="auto">So instead of getting this when a test fails:</p>
<div data-snippet-clipboard-copy-content="org.opentest4j.AssertionFailedError: expected: &lt;hello&gt; but was: &lt;hi&gt;
	at org.junit...
	at com.example.MyTest.hello(MyTest.java:24)
	..."><pre><code>org.opentest4j.AssertionFailedError: expected: &lt;hello&gt; but was: &lt;hi&gt;
	at org.junit...
	at com.example.MyTest.hello(MyTest.java:24)
	...
</code></pre></div>
<p dir="auto">You&#39;ll get this:</p>
<div data-snippet-clipboard-copy-content="org.opentest4j.AssertionFailedError: expected: &lt;hello&gt; but was: &lt;hi&gt;
	at org.junit...
	at com.example.MyTest.hello(MyTest.java:24)

	   22    @Test
	   23    void compareStrings() {
	-&gt; 24      assertEquals(&#34;hello&#34;, &#34;hi&#34;);
	   25    }

	..."><pre><code>org.opentest4j.AssertionFailedError: expected: &lt;hello&gt; but was: &lt;hi&gt;
	at org.junit...
	at com.example.MyTest.hello(MyTest.java:24)

	   22    @Test
	   23    void compareStrings() {
	-&gt; 24      assertEquals(&#34;hello&#34;, &#34;hi&#34;);
	   25    }

	...
</code></pre></div>
<p dir="auto">In both your IDE and build server test reports. Also works for other JVM
languages.</p>
<h2 tabindex="-1" id="user-content-usage" dir="auto"><a href="#usage">Usage<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Requires Java 11.</p>
<h3 tabindex="-1" id="user-content-gradle" dir="auto"><a href="#gradle">Gradle<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<div dir="auto" data-snippet-clipboard-copy-content="dependencies {
  // For JUnit 5
  testImplementation(&#34;nz.lae.stacksrc:stacksrc-junit5:${stacksrc.version}&#34;)
  // For JUnit 4
  testImplementation(&#34;nz.lae.stacksrc:stacksrc-junit5:${stacksrc.version}&#34;)
}"><pre>dependencies {
  <span><span>//</span> For JUnit 5</span>
  testImplementation(<span><span>&#34;</span>nz.lae.stacksrc:stacksrc-junit5:<span><span>${</span>stacksrc.version<span>}</span></span><span>&#34;</span></span>)
  <span><span>//</span> For JUnit 4</span>
  testImplementation(<span><span>&#34;</span>nz.lae.stacksrc:stacksrc-junit5:<span><span>${</span>stacksrc.version<span>}</span></span><span>&#34;</span></span>)
}</pre></div>
<h3 tabindex="-1" id="user-content-maven" dir="auto"><a href="#maven">Maven<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<div dir="auto" data-snippet-clipboard-copy-content="
&lt;dependency&gt;
  &lt;groupId&gt;nz.lae.stacksrc&lt;/groupId&gt;
  &lt;artifactId&gt;stacksrc-junit5&lt;/artifactId&gt; &lt;!-- For JUnit 5 --&gt;
  &lt;artifactId&gt;stacksrc-junit4&lt;/artifactId&gt; &lt;!-- For JUnit 4 --&gt;
  &lt;version&gt;${stacksrc.version}&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;"><pre>&lt;<span>dependency</span>&gt;
  &lt;<span>groupId</span>&gt;nz.lae.stacksrc&lt;/<span>groupId</span>&gt;
  &lt;<span>artifactId</span>&gt;stacksrc-junit5&lt;/<span>artifactId</span>&gt; <span><span>&lt;!--</span> For JUnit 5 <span>--&gt;</span></span>
  &lt;<span>artifactId</span>&gt;stacksrc-junit4&lt;/<span>artifactId</span>&gt; <span><span>&lt;!--</span> For JUnit 4 <span>--&gt;</span></span>
  &lt;<span>version</span>&gt;${stacksrc.version}&lt;/<span>version</span>&gt;
  &lt;<span>scope</span>&gt;test&lt;/<span>scope</span>&gt;
&lt;/<span>dependency</span>&gt;</pre></div>
<h3 tabindex="-1" id="user-content-junit-5" dir="auto"><a href="#junit-5">JUnit 5<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">For JUnit 5, you can
<a href="https://junit.org/junit5/docs/current/user-guide/#extensions-registration-automatic-enabling" rel="nofollow">enable automatic extension detection</a>
by setting the system
property <code>junit.jupiter.extensions.autodetection.enabled=true</code> on your build,
then no other change will be needed for this to work.</p>
<p dir="auto">If you don&#39;t want to enable automatic extension detection, you can wire things
up manually using either JUnit&#39;s <code>@ExtendWith</code> or <code>@RegisterExtension</code> like the
following, then all tests inheriting <code>BaseTest</code> will have their stack traces
decorated on failure:</p>
<div dir="auto" data-snippet-clipboard-copy-content="
@ExtendWith(ErrorDecorator.class)
class BaseTest {
}

class MyTest extends BaseTest {
  @Test
  void myTest() {
    // ...
  }
}"><pre><span>@</span><span>ExtendWith</span>(<span>ErrorDecorator</span>.<span>class</span>)
<span>class</span> <span>BaseTest</span> {
}

<span>class</span> <span>MyTest</span> <span>extends</span> <span>BaseTest</span> {
  <span>@</span><span>Test</span>
  <span>void</span> <span>myTest</span>() {
    <span>// ...</span>
  }
}</pre></div>
<h3 tabindex="-1" id="user-content-junit-4" dir="auto"><a href="#junit-4">JUnit 4<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">For JUnit 4, create a base test with a test rule, then all tests
inheriting <code>BaseTest</code> will have their stack traces
decorated on failure:</p>
<div dir="auto" data-snippet-clipboard-copy-content="public class BaseTest {
  @Rule
  public final ErrorDecorator errorDecorator = new ErrorDecorator();
}

public final class MyTest extends BaseTest {
  @Test
  public void myTest() {
    // ...
  }
}"><pre><span>public</span> <span>class</span> <span>BaseTest</span> {
  <span>@</span><span>Rule</span>
  <span>public</span> <span>final</span> <span>ErrorDecorator</span> <span>errorDecorator</span> = <span>new</span> <span>ErrorDecorator</span>();
}

<span>public</span> <span>final</span> <span>class</span> <span>MyTest</span> <span>extends</span> <span>BaseTest</span> {
  <span>@</span><span>Test</span>
  <span>public</span> <span>void</span> <span>myTest</span>() {
    <span>// ...</span>
  }
}</pre></div>
</article>
          </div></div>
  </body>
</html>
