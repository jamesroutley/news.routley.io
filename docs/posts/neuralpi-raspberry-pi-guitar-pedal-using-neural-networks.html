<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/GuitarML/NeuralPi">Original</a>
    <h1>NeuralPi: Raspberry Pi guitar pedal using neural networks</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a href="https://github.com/GuitarML/NeuralPi/actions/workflows/cmake.yml"><img src="https://github.com/GuitarML/NeuralPi/actions/workflows/cmake.yml/badge.svg" alt="CI"/></a> <a href="https://www.gnu.org/licenses/gpl-3.0" rel="nofollow"><img src="https://camo.githubusercontent.com/75b0be3e822c2896f02eb88647aa043ab92f3e55e3b6e12609512fde8d739d47/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d47504c76332d627269676874677265656e2e737667" alt="License: GPL v3" data-canonical-src="https://img.shields.io/badge/License-GPLv3-brightgreen.svg"/></a> <a href="https://somsubhra.github.io/github-release-stats/?username=GuitarML&amp;repository=NeuralPi&amp;page=1&amp;per_page=30" rel="nofollow"><img src="https://camo.githubusercontent.com/0be7ddf6ce3c0f63b131596be199c66bcc7b626ce40212f7473e436cc61b6658/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f646f776e6c6f6164732f4775697461724d4c2f4e657572616c50692f746f74616c" alt="Downloads" data-canonical-src="https://img.shields.io/github/downloads/GuitarML/NeuralPi/total"/></a></p>
<p dir="auto">NeuralPi is a guitar pedal using neural networks to emulate real amps and pedals on a Raspberry Pi 4. The NeuralPi software is a VST3 plugin built with JUCE, which can be run as a normal audio plugin or cross-compiled to run on the Raspberry Pi 4 with <a href="https://elk.audio/" rel="nofollow">Elk Audio OS</a>. The NeuralPi includes model selection, EQ, and gain/volume controls from a remote instance of the plugin over WiFi. The pedal runs high quality amp/pedal models on an economical DIY setup, costing around $120 for hardware to build yourself. </p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GuitarML/NeuralPi/blob/main/resources/rpi_pic.jpg"><img src="https://github.com/GuitarML/NeuralPi/raw/main/resources/rpi_pic.jpg" alt="app"/></a></p>
<p dir="auto">NeuralPi can sound like an amplifier or distortion/overdrive pedal using the power of neural networks. Models trained from recordings of real amps and pedals can be loaded into the plugin for endless possiblities on your guitar. Create your own models or use custom tones from GuitarML.</p>
<p dir="auto">WARNING: The audio output of the HiFiBerry DAC + ADC is at line level. Guitar amplifiers expect a low level electric guitar signal (instrument level). Use NeuralPi only where line level inputs are expected.</p>
<p dir="auto">There are four main components to the guitar pedal:</p>
<ol dir="auto">
<li><a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/" rel="nofollow">Raspberry Pi 4b</a></li>
<li><a href="https://www.hifiberry.com/shop/boards/hifiberry-dac-adc/" rel="nofollow">HiFiBerry DAC + ADC</a></li>
<li><a href="https://elk.audio/" rel="nofollow">Elk Audio OS</a></li>
<li>NeuralPi VST3 plugin</li>
</ol>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GuitarML/NeuralPi/blob/main/resources/neuralpi_pic.jpg"><img src="https://github.com/GuitarML/NeuralPi/raw/main/resources/neuralpi_pic.jpg" alt="app"/></a>
</p>
<p dir="auto">Note: The plugin must be restarted after using the Import Tone button for changes to take effect.</p>
<h2 dir="auto"><a id="user-content-installing-the-plugin" aria-hidden="true" href="#installing-the-plugin"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installing the plugin</h2>
<p dir="auto">See the <a href="https://github.com/GuitarML/NeuralPi/releases">Release page</a> for the cross-compiled Raspberry Pi / Elk Audio OS compatible VST3 plugin and Win/Mac installers.</p>
<p dir="auto">After running the plugin or standalone for the first time, the two default models will be copied to the following locations. Any imported models will be copied here as well. Model files must be manually removed from these locations to perform model clean-up.</p>
<div data-snippet-clipboard-copy-content="Mac/Linux: /home/&lt;username&gt;/Documents/GuitarML/NeuralPi/tones 
Windows: C:/Users/&lt;username&gt;/Documents/GuitarML/NeuralPi/tones
Elk Audio OS: /home/mind/Documents/GuitarML/NeuralPi/tones"><pre><code>Mac/Linux: /home/&lt;username&gt;/Documents/GuitarML/NeuralPi/tones 
Windows: C:/Users/&lt;username&gt;/Documents/GuitarML/NeuralPi/tones
Elk Audio OS: /home/mind/Documents/GuitarML/NeuralPi/tones
</code></pre></div>
<h2 dir="auto"><a id="user-content-conditioned-models" aria-hidden="true" href="#conditioned-models"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Conditioned Models</h2>
<p dir="auto">Starting with version 1.3, NeuralPi can load tones conditioned on the Gain parameter. The three default tones included with NeuralPi are now conditioned models (TS9 pedal, Fender Blues Jr. amp, and Blackstar HT40 amp set to overdrive channel). The conditioned model uses a neural network for the full range of the Gain/Drive parameter, rather than just a snapshot model. When a conditioned model is loaded, the Gain knob will turn red.</p>
<h2 dir="auto"><a id="user-content-adding-new-models" aria-hidden="true" href="#adding-new-models"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Adding New Models</h2>
<p dir="auto">Once your NeuralPi is set up, you can add new models from a remote computer using the following steps:</p>
<ol dir="auto">
<li>From the remote computer, run the plugin and add new models using the &#34;Import Tone&#34; button. Optionally, you can manually add new json files to the <code>Documents/GuitarML/Chameleon/tones</code> directory.
Note: The &#34;tones&#34; directory is created the first time you run NeuralPi.</li>
<li>Turn on your WiFi enabled NeuralPi (see <a href="https://elk-audio.github.io/elk-docs/html/documents/working_with_elk_board.html?highlight=wifi#connecting-to-your-board" rel="nofollow">Elk documentation</a> for connecting the Raspberry Pi to a local WiFi network)</li>
<li>Download the <code>update_models.bat</code>(Windows) or <code>update_models.sh</code>(Mac/Linux) to your remote computer. These scripts are located in the &#34;scripts/&#34; directory of this repository. You must change the <code>rpi_ip_address</code> and <code>host_model_path</code> to the Raspberry Pi&#39;s IP address and path to your json tones (on remote computer). The json files will be first copied from the remote computer to the NeuralPi, and then back from the NeuralPi to the remote computer. This allows updating models from the NeuralPi when you connect a new remote computer.</li>
<li>From the remote computer connected to the same local WiFi network as NeuralPi, run the <code>update_models.bat</code>(Windows) or <code>update_models.sh</code>(Mac/Linux) from a cmd terminal. </li>
<li>Restart both the NeuralPi and the remote instance of the NeuralPi plugin. From the remote NeuralPi GUI, enter the Raspberry Pi&#39;s IP address. As long as both devices are connected to the local WiFi network, you will be able select models from the NeuralPi plugin dropdown list to change models running on the Raspberry Pi.</li>
</ol>
<p dir="auto">IMPORTANT: The plugin uses a sort() function to order the models alphabetically. Due to differences in the behaviour of this function on Linux (Elk OS) vs. Win/Mac, you must start json filenames with a capital letter, otherwise the NeuralPi on Elk will sort models starting with a lowercase letter at the end of the list and the controller will be out of sync with the NeuralPi pedal.</p>
<h2 dir="auto"><a id="user-content-midi-control-of-neuralpi-parameters" aria-hidden="true" href="#midi-control-of-neuralpi-parameters"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>MIDI control of NeuralPi parameters</h2>
<p dir="auto">The “config_neuralpi_MIDI.json” file contains MIDI mapping of NeuralPi parameters.</p>
<p dir="auto">The names of parameters are: &#34;Gain&#34;, &#34;Master&#34;, &#34;Bass&#34;, &#34;Mid&#34;, &#34;Treble&#34;, &#34;Presence&#34;, &#34;Delay&#34;, &#34;Reverb&#34;, &#34;Model&#34;, &#34;Ir&#34;.
In that json file, you can see that those parameters have been asigned to incoming MIDI CC# messages &#34;1&#34;, &#34;2&#34;, &#34;3&#34;, &#34;4, &#34;5&#34;, &#34;6&#34;, &#34;7&#34;, &#34;8&#34;, &#34;9&#34; and &#34;10&#34; respectively. But editing the file allows you to chose whatever CC# to whatever parameter, by just changing values in the “cc_number” and “parameter_name” commmands.</p>
<p dir="auto">Sushi will listen to incoming MIDI CC# messages, will normalize (0, 127)  MIDI values range to (0, 1) Sushi range, and will set that value to correspondent parameter. For instance, if your MIDI controller sends a CC2 message with value &#34;127&#34;, Sushi will receive that message and set &#34;Master&#34; parameter (“Master” is assigned to “CC2”) to be &#34;1&#34; (MIDI “127” value normalized to “1”).</p>
<p dir="auto">You´ll need to copy the config file to the Raspberry, for instance through ssh over Wifi (login as root):</p>
<p dir="auto">scp -r config_neuralpi_MIDI.json root@:/home/mind/config_files/</p>
<p dir="auto">For connecting a MIDI device:</p>
<p dir="auto">1 - Plug your MIDI device into any Raspberry USB port.</p>
<p dir="auto">2 - Login as “mind” user, “elk” password, and run Sushi with the MIDI config:</p>
<p dir="auto">sushi -r --multicore-processing=2 –c ~/config_files/config_neuralpi_MIDI.json &amp;</p>
<p dir="auto">3 – To list MIDI devices connected to the Raspberry, run:</p>
<p dir="auto">aconnect –l</p>
<p dir="auto">4 – You can now connect your MIDI device to Sushi either by their listed ports, or by their names. Run:</p>
<p dir="auto">aconnect &#34;your-listed-device-name&#34; &#34;Sushi&#34;</p>
<p dir="auto">NOTE 1: Currentlly, &#34;Model&#34; and &#34;Ir&#34; parameters are a little tricky to control. NeuralPi asigns a value to each file saved in &#34;tones&#34; or &#34;Ir&#34; directory. It divides the (0, 1) range of values by the number of files available, so for instance, if you had just 2 tone files in the directory, one of them would respond to any value in the (0, 0.49) range, and the other would respond to any value in the (0.5, 1) range.</p>
<h2 dir="auto"><a id="user-content-to-do" aria-hidden="true" href="#to-do"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>To Do</h2>
<p dir="auto">Elk Audio OS also supports physical controls through <a href="https://github.com/elk-audio/sensei">Sensei</a>. Gain/Volume and EQ knobs can be added, as well as a LCD screen for selecting different models. One could build an actual guitar pedal with NeuralPi and any number of other digital effects and controls.</p>
<p dir="auto">While running PyTorch locally on the Raspberry Pi might be a stretch, it is fully capable of recording high quality audio with the HiFiBerry hat. Implement a capture feature by automating the recording of input/output samples, pushing to remote computer for training, then updating the Pi with the newly trained model.</p>
<h2 dir="auto"><a id="user-content-info" aria-hidden="true" href="#info"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Info</h2>
<p dir="auto">The neural network is a re-creation of the LSTM inference model from <a href="https://www.mdpi.com/2076-3417/10/3/766/htm" rel="nofollow">Real-Time Guitar Amplifier Emulation with Deep Learning</a></p>
<p dir="auto">The <a href="https://github.com/Alec-Wright/Automated-GuitarAmpModelling">Automated-GuitarAmpModelling</a> project was used to train the .json models.</p>
<p dir="auto">Note: The GuitarML fork of the Automated-GuitarAmpModelling code now contains helper scripts for training conditioned models, which are compatible with NeuralPi v1.3.</p>
<p dir="auto">The plugin uses <a href="https://github.com/jatinchowdhury18/RTNeural">RTNeural</a>, which is a highly optimized neural net inference engine intended for audio applications.</p>
<p dir="auto">The HiFiBerry DAC+ADC card used for this project provides 192kHz/24bit Analog-to-Digital and Digital to Analog, which is industry standard for high quality audio devices. The plugin processes at 44.1kHz (specified in config file) for the neural net DSP.</p>
<h2 dir="auto"><a id="user-content-build-instructions" aria-hidden="true" href="#build-instructions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build Instructions</h2>
<p dir="auto">To build the plugin for use on the Raspberry Pi with Elk Audio OS, see the official <a href="https://elk-audio.github.io/elk-docs/html/documents/building_plugins_for_elk.html#vst-plugins-using-juce" rel="nofollow">Elk Audio Documentation</a></p>
<h3 dir="auto"><a id="user-content-build-with-cmake" aria-hidden="true" href="#build-with-cmake"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build with Cmake</h3>
<div dir="auto" data-snippet-clipboard-copy-content="# Clone the repository
$ git clone https://github.com/GuitarML/NeuralPi.git
$ cd NeuralPi

# initialize and set up submodules
$ git submodule update --init --recursive

# build with CMake
$ cmake -Bbuild
$ cmake --build build --config Release"><pre><span><span>#</span> Clone the repository</span>
$ git clone https://github.com/GuitarML/NeuralPi.git
$ <span>cd</span> NeuralPi

<span><span>#</span> initialize and set up submodules</span>
$ git submodule update --init --recursive

<span><span>#</span> build with CMake</span>
$ cmake -Bbuild
$ cmake --build build --config Release</pre></div>
<p dir="auto">The binaries will be located in <code>NeuralPi/build/NeuralPi_artefacts/</code></p>
<h3 dir="auto"><a id="user-content-build-with-projucer" aria-hidden="true" href="#build-with-projucer"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build with Projucer</h3>
<ol dir="auto">
<li>
<p dir="auto">Clone or download this repository.</p>
</li>
<li>
<p dir="auto">Download and install <a href="https://juce.com/" rel="nofollow">JUCE</a> This project uses the &#34;Projucer&#34; application from the JUCE website.</p>
</li>
<li>
<p dir="auto">Download the RTNeural submodule (cd into the NeuralPi repo first):</p>
<p dir="auto"><code>git submodule update --remote --recursive</code></p>
</li>
<li>
<p dir="auto">Download and extract: <a href="https://github.com/nlohmann/json">json</a> Json for c++.</p>
</li>
<li>
<p dir="auto">Open the NeuralPi.jucer file and in the appropriate Exporter Header Search Path field, enter the appropriate include paths.
For example:</p>
</li>
</ol>
<div data-snippet-clipboard-copy-content="  &lt;full-path-to&gt;/json-develop/include
  &lt;full-path-to&gt;/NeuralPi/modules/RTNeural
  &lt;full-path-to&gt;/NeuralPi/modules/RTNeural/modules/xsimd/include"><pre><code>  &lt;full-path-to&gt;/json-develop/include
  &lt;full-path-to&gt;/NeuralPi/modules/RTNeural
  &lt;full-path-to&gt;/NeuralPi/modules/RTNeural/modules/xsimd/include
</code></pre></div>
<ol start="6" dir="auto">
<li>Build NeuralPi from the Juce Projucer application for the intended build target.</li>
</ol>
<p dir="auto">Note: Make sure to build in Release mode unless actually debugging. Debug mode will not keep up with real time playing.</p>
</article>
          </div></div>
  </body>
</html>
