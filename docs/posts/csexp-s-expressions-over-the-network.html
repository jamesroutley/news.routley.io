<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://docs.racket-lang.org/csexp/index.html">Original</a>
    <h1>Csexp: S-Expressions over the Network</h1>
    
    <div id="readability-page-1" class="page"><div><div><p><span>8.9</span></p><p>Canonical s-expressions (csexp) are a way to format s-expressions into data packets
suitable for transmission over a network.</p><h3 x-source-module="(lib &#34;csexp/scribblings/csexp.scrbl&#34;)" x-source-pkg="csexp" x-part-tag="&#34;Overview&#34;">1<tt> </tt><a name="(part._.Overview)"></a>Overview</h3><p>Consider the following expression:</p><blockquote><p><span>&#39;</span><span>(</span><span>bag</span><span> </span><span>&#34;Inventory&#34;</span><span> </span><span>(</span><span>content</span><span> </span><span>cookie</span><span> </span><span>caramel</span><span> </span><span>aligator</span><span>)</span><span>)</span></p></blockquote><p>To get a canonical s-exp, it must first be changed into a tree of bytestrings:</p><blockquote><p><span>(</span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.9" data-pltdoc="x">list</a></span><span> </span><span>#&#34;bag&#34;</span><span> </span><span>#&#34;\&#34;Inventory\&#34;&#34;</span><span> </span><span>(</span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.9" data-pltdoc="x">list</a></span><span> </span><span>#&#34;content&#34;</span><span> </span><span>#&#34;cookie&#34;</span><span> </span><span>#&#34;caramel&#34;</span><span> </span><span>#&#34;aligator&#34;</span><span>)</span><span>)</span></p></blockquote><p>Which can then be transmitted as:</p><blockquote><p><span>#&#34;(3:bag11:\&#34;Inventory\&#34;(7:content6:cookie7:caramel8:aligator))&#34;</span></p></blockquote><p>Spaces are removed and all strings are suffixed by their size and a colon <span><span></span><span>:</span><span></span></span> separator.
This makes it easy to read the expression in a stream, and gives a unique (canonical) way
of writing a given s-expression.</p><h3 x-source-module="(lib &#34;csexp/scribblings/csexp.scrbl&#34;)" x-source-pkg="csexp" x-part-tag="&#34;Hinted_csexp&#34;">2<tt> </tt><a name="(part._.Hinted_csexp)"></a>Hinted csexp</h3><p>Canonical s-expressions can have an optional &#34;hint&#34;, which is a bytestring attached to the front of a
csexp atom, inside square brackets:</p><blockquote><p><span>#&#34;(6:animal(4:name[13:charset=utf-8]7:The Cat)(5:noise4:meow))&#34;</span></p></blockquote><p>Here the hint is attached to the atom <span><span></span><span>The Cat</span><span></span></span> and has the value <span><span></span><span>charset=utf-8</span><span></span></span>.</p><p>When parsing a csexp, hints are rendered by default as <span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._hinted%29%29" data-pltdoc="x">hinted</a></span> structures.</p><p>Example:</p><div><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._bytes-~3ecsexp%29%29" data-pltdoc="x">bytes-&gt;csexp</a></span><span> </span><span>#&#34;(6:animal(4:name[13:charset=utf-8]7:The Cat)(5:noise4:meow))&#34;</span><span>)</span></td></tr><tr><td><table><tbody><tr><td><p><span>(list</span></p></td></tr><tr><td><p><span></span><span> </span><span>#&#34;animal&#34;</span></p></td></tr><tr><td><p><span></span><span> </span><span>(list #&#34;name&#34; (hinted #&#34;The Cat&#34; #&#34;charset=utf-8&#34;))</span></p></td></tr><tr><td><p><span></span><span> </span><span>&#39;(#&#34;noise&#34; #&#34;meow&#34;))</span></p></td></tr></tbody></table></td></tr></tbody></table></blockquote></div><h3 x-source-module="(lib &#34;csexp/scribblings/csexp.scrbl&#34;)" x-source-pkg="csexp" x-part-tag="&#34;Reference&#34;">3<tt> </tt><a name="(part._.Reference)"></a>Reference</h3><p>Transform a csexp into a string of bytes.</p><div><blockquote><table><tbody><tr><td><blockquote><p><span>(</span><a name="(def._((lib._csexp/main..rkt)._bytes-~3ecsexp))"></a><span title="Provided from: csexp | Package: csexp"><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._bytes-~3ecsexp%29%29" data-pltdoc="x">bytes-&gt;csexp</a></span></span><span> </span><span>bytes</span><span> </span><span>[</span><span>#:hinting</span><span> </span><span>hinting</span><span>]</span><span>)</span><span> </span>→<span> </span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._csexp~3f%29%29" data-pltdoc="x">csexp?</a></span></p></blockquote></td></tr><tr><td><span>  </span><span>bytes</span><span> </span>:<span> </span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=8.9" data-pltdoc="x">bytes?</a></span></td></tr><tr><td><span>  </span><span>hinting</span><span> </span>:<span> </span><span>(</span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.9" data-pltdoc="x">or/c</a></span><span> </span><span>&#39;</span><span>if-present</span><span> </span><span>&#39;</span><span>never</span><span> </span><span>&#39;</span><span>always</span><span>)</span><span> </span>=<span> </span><span>&#39;</span><span>if-present</span></td></tr></tbody></table></blockquote></div><p>Reads a string of bytes and parse it as a csexp.</p><p>If <span>hinting</span> is <span>&#39;</span><span>if-present</span>, it generates a <span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._hinted%29%29" data-pltdoc="x">hinted</a></span> instance every time a hint
is found. </p><p>Read a csexp from a port, byte by byte.
</p><p>Write a csexp to a port.</p><p>A structure which contains hints. See <a href="#%28part._.Hinted_csexp%29" data-pltdoc="x">Hinted csexp</a>.</p><p>Check if a given value is a canonical s-expression.</p><p>Examples:</p><div><blockquote><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._csexp~3f%29%29" data-pltdoc="x">csexp?</a></span><span> </span><span>&#39;</span><span>(</span><span>#&#34;animal&#34;</span><span> </span><span>(</span><span>#&#34;name&#34;</span><span> </span><span>#&#34;cat&#34;</span><span>)</span><span> </span><span>(</span><span>#&#34;noise&#34;</span><span> </span><span>#&#34;meow&#34;</span><span>)</span><span>)</span><span>)</span></td></tr><tr><td><p><span>#t</span></p></td></tr><tr><td><table><tbody><tr><td><span>&gt; </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._csexp~3f%29%29" data-pltdoc="x">csexp?</a></span><span> </span><span>(</span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.9" data-pltdoc="x">list</a></span><span> </span><span>#&#34;animal&#34;</span></td></tr><tr><td><span>  </span><span>        </span><span>(</span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.9" data-pltdoc="x">list</a></span><span> </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._hinted%29%29" data-pltdoc="x">hinted</a></span><span> </span><span>#&#34;name&#34;</span><span> </span><span>#&#34;foo&#34;</span><span>)</span><span> </span><span>#&#34;cat&#34;</span><span>)</span></td></tr><tr><td><span>  </span><span>        </span><span>&#39;</span><span>(</span><span>#&#34;noise&#34;</span><span> </span><span>#&#34;meow&#34;</span><span>)</span><span>)</span><span>)</span></td></tr></tbody></table></td></tr><tr><td><p><span>#t</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._csexp~3f%29%29" data-pltdoc="x">csexp?</a></span><span> </span><span>&#39;</span><span>(</span><span>)</span><span>)</span></td></tr><tr><td><p><span>#t</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._csexp~3f%29%29" data-pltdoc="x">csexp?</a></span><span> </span><span>#&#34;aligator&#34;</span><span>)</span></td></tr><tr><td><p><span>#f</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._csexp~3f%29%29" data-pltdoc="x">csexp?</a></span><span> </span><span>(</span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.9" data-pltdoc="x">list</a></span><span> </span><span>&#34;aligator&#34;</span><span>)</span><span>)</span></td></tr><tr><td><p><span>#f</span></p></td></tr><tr><td><span>&gt; </span><span>(</span><span><a href="#%28def._%28%28lib._csexp%2Fmain..rkt%29._csexp~3f%29%29" data-pltdoc="x">csexp?</a></span><span> </span><span>(</span><span><a href="https://download.racket-lang.org/releases/8.9/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=8.9" data-pltdoc="x">list</a></span><span> </span><span>&#39;</span><span>aligator</span><span>)</span><span>)</span></td></tr><tr><td><p><span>#f</span></p></td></tr></tbody></table></blockquote></div></div></div></div>
  </body>
</html>
