<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ochagavia.nl/blog/chasing-a-bug-in-a-sat-solver/">Original</a>
    <h1>Chasing a Bug in a SAT Solver</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p>Recently I spent two weeks collaborating with <a href="https://prefix.dev/">Prefix.dev</a> to further develop <a href="https://github.com/mamba-org/resolvo">resolvo</a>, their <a href="https://ochagavia.nl/blog/the-magic-of-dependency-resolution/">SAT-based dependency solver</a>. The main goal was to fix <a href="https://github.com/mamba-org/resolvo/issues/13">a nasty bug</a>, where the solver unexpectedly panicked upon hitting code that was supposed to be unreachable. ‚ÄúThat will make for a good war story!‚Äù, I thought, so I kept notes of my debugging process to serve as a basis for this article.</p>
<p>I was being overly pessimistic, though, thinking it would take days to find the source of the bug‚Ä¶ In reality it took me only a few hours, so there‚Äôs not much to tell about the chase itself. I spent the rest of the day working on a fix, and the next morning <a href="https://github.com/mamba-org/resolvo/pull/15">opened a PR</a> that soon got merged.</p>
<p>‚ÄúSo there‚Äôs nothing to tell?‚Äù, you might be thinking. There <em>is</em> actually something small that made me happy and I find worth sharing: that a random person on the internet set me up for success, as you will discover below.</p>
<h3 id="genesis-of-a-github-issue">Genesis of a GitHub issue</h3>
<p>Last November, the bug in question was <a href="https://github.com/prefix-dev/rip/">filed</a> in a project that uses resolvo under the hood. The issue was easily reproducible, but debugging the resolvo code was difficult. A real-world installation of a package involves lots of work in the dependency solver, generating a huge amount of logs and making it almost impossible to find the source of the problem. After a valiant effort, <a href="https://github.com/baszalmstra">Bas</a> left the following <a href="https://github.com/prefix-dev/rip/issues/75#issuecomment-1820518773">comment</a> on the issue tracker:</p>
<blockquote>
<p>I spent half a day debugging the issue (‚Ä¶) but I cant figure out what causes it. I‚Äôll have to get back to it later.</p>
</blockquote>
<h3 id="an-open-source-hero-appears">An open source hero appears</h3>
<p>The month passed by without progress, until GitHub user <a href="https://github.com/sumanth-manchala">sumanth-manchala</a> unexpectedly <a href="https://github.com/prefix-dev/rip/issues/75#issuecomment-1869560225">came up</a> with a minimum reproducible example. They even <a href="https://github.com/mamba-org/resolvo/pull/10">contributed</a> with a unit test to the resolvo repository, so the person who came later (that‚Äôs me!) would have an easy time debugging and validating a possible fix.</p>
<p>The new test was incredibly minimal, which made the solver logs clear enough for a human to follow. That meant we could finally debug the problem, and I consider it an important reason<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> why I only needed a few hours to figure out the root cause.</p>
<p>What an excellent example of the power of open source! Someone from the community was passing by, partially figured things out, and gifted the project a test that was crucial to develop a fix. Hats off to Sumanth!</p>
<h4 id="bonus-track-dreaming-of-better-tooling">Bonus track: dreaming of better tooling</h4>
<p>Would debugging have been easier with access to better tooling? What if we recorded the solving process and replayed it later? What if we implemented a shrinking algorithm<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup>, to automatically simplify a recording into the smallest possible input that still leads to a crash?</p>
<p>I think those ideas are great‚Ä¶ But even in open source, developer bandwidth is sometimes limited, and things like this get postponed for more urgent work. Fortunately, the inner logic of the solver is pretty much ‚Äúdone‚Äù, so there is little chance things will break again due to a bug there (famous last words, I know üòÖ).</p>
<p>By the way, if you happen to have a SAT solver in your basement that needs some love, <a href="mailto:adolfo@ochagavia.nl">drop me a line</a> :)</p>


</div></div>
  </body>
</html>
