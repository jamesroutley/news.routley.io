<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.benji.dog/articles/git-config/">Original</a>
    <h1>How I configure my Git identities</h1>
    
    <div id="readability-page-1" class="page"><div><blockquote>
<p><strong>Note</strong>: I&#39;ve had this post drafted for 3 YEARS!!! It&#39;s finally time to publish it.</p>
</blockquote>
<p>I like to mess with my <a href="https://github.com/benjifs/dotfiles">dotfiles</a> and every so often, I find out about a new way to do things and I spend more time than I should learning how to use it.</p>
<p>A few years ago I learned about <a href="https://git-scm.com/docs/git-config#_includes">includeIf</a> for including specific files if some condition was met for <code>git</code>. The example that I first saw was doing:</p>
<pre><code>[includeIf &#34;gitdir:~/code/**&#34;]
  path = ~/.config/git/personal
[includeIf &#34;gitdir:~/work/**&#34;]
  path = ~/.config/git/work
</code></pre>
<p>So that <code>~/.config/git/personal</code> is only included for <code>git</code> directories under <code>~/code</code> and <code>~/.config/git/work</code> is only included for directories under <code>~/work</code>. The contents of those included files varies but usually it contains your git identity, signing keys, etc. Here&#39;s an example of what that could look like:</p>
<pre><code>[user]
  name = benji
  email = benji@work.com
  signingkey = ~/.ssh/work.id_ed25519.pub
</code></pre>
<p>That works pretty well but I usually organize all my code in <code>~/workspace</code> regardless of whether its personal, <strong>work-1</strong>, <strong>work-2</strong>, etc. I wanted to be able to configure git depending on where that repo actually lives instead of where the directory is in my machine. Then I found out about <a href="https://git-scm.com/docs/git-config#Documentation/git-config.txt-codehasconfigremoteurlcode">hasconfig:remote.*.url:</a>!</p>
<p>This makes it so that I can configure git conditionally if the given remote URL exists for that directory I&#39;m currently working in.</p>
<p>A few examples of what I do is:</p>
<pre><code>[includeIf &#34;hasconfig:remote.*.url:git@github.com:orgname/**&#34;]
  path = ~/.config/git/config-gh-org

[includeIf &#34;hasconfig:remote.*.url:git@github.com:*/**&#34;]
  path = ~/.config/git/config-gh

[includeIf &#34;hasconfig:remote.*.url:git@gitlab.com:*/**&#34;]
  path = ~/.config/git/config-gl

[includeIf &#34;hasconfig:remote.*.url:git@git.sr.ht:*/**&#34;]
  path = ~/.config/git/config-srht
</code></pre>
<p>Now if I&#39;m in a directory where the remote matches <code>github.com:orgname/**</code> it would use <code>~/.config/git/config-gh-org</code>, otherwise it uses the general config file for any other GitHub repo.</p>
<hr/>
<p>While that handles git identities, I still need to configure SSH keys separately to be able to <code>pull</code> and <code>push</code> to remotes. The simple version of my <code>~/.ssh/config</code> looks like this:</p>
<pre><code>Host gitlab.com
Hostname gitlab.com
User git
IdentityFile ~/.ssh/gitlab.id_ed25519

Host github.com
Hostname github.com
User git
IdentityFile ~/.ssh/github.id_ed25519
</code></pre>
<p>The only problem with this is that in order to use a different <code>IdentityFile</code> for the same <code>Hostname</code> so that I could use a different key for repos under <code>github.com/orgname</code>, I&#39;d have to use a different value for <code>Host</code>. So in my case I would add the following to my <code>~/.ssh/config</code>:</p>
<pre><code>Host gh-work
Hostname github.com
User git
IdentityFile ~/.ssh/work.id_ed25519
</code></pre>
<p>Finally, to use that <code>Host</code> when I&#39;m looking for a repo in <code>github.com/orgname</code>, I would add the following to my git config:</p>
<pre><code>[url &#34;gh-work:orgname&#34;]
  insteadOf = git@github.com:orgname
</code></pre>
<p>So when I <code>clone</code>, <code>pull</code>, or <code>push</code> a repo that&#39;s under my work&#39;s org account I can do:</p>
<pre><code>git clone git@github.com:orgname/project
</code></pre>
<p>and <code>insteadOf</code> would replace <code>github.com:orgname</code> with <code>gh-work:orgname</code> so that it uses the right info from my SSH config. It&#39;s a neat trick which I saw referenced in this <a href="https://www.kenmuse.com/blog/ssh-and-multiple-git-credentials/#git">article</a>.</p>
<hr/>
<p>Are there any issues with this approach? Is there a better way to do this? I&#39;m not sure so please let me know as I&#39;d love to learn and I&#39;ll update this post accordingly.</p>
<h2>References</h2>
<ul>
<li><a href="https://fundor333.com/post/2021/advance-git-config-and-ssh-config/">https://fundor333.com/post/2021/advance-git-config-and-ssh-config/</a></li>
<li><a href="https://www.kenmuse.com/blog/ssh-and-multiple-git-credentials/#git">https://www.kenmuse.com/blog/ssh-and-multiple-git-credentials/#git</a></li>
<li><a href="https://garrit.xyz/posts/2023-10-13-organizing-multiple-git-identities">https://garrit.xyz/posts/2023-10-13-organizing-multiple-git-identities</a></li>
<li><a href="https://stevenharman.net/configure-ssh-keys-for-multiple-github-accounts">https://stevenharman.net/configure-ssh-keys-for-multiple-github-accounts</a></li>
</ul>
</div></div>
  </body>
</html>
