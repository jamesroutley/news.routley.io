<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sethmlarson.dev/regex-$-matches-end-of-string-or-newline">Original</a>
    <h1>Regex character &#34;$&#34; doesn&#39;t mean &#34;end-of-string&#34;</h1>
    
    <div id="readability-page-1" class="page"><div>

<p>This article is about a bit of surprising behavior I recently discovered
using Python&#39;s regex module (<code>re</code>) while <a href="https://github.com/python/release-tools/pull/92#discussion_r1484470272">developing SBOM tooling for CPython</a>.</p>

<p>Folks who&#39;ve worked with regular expressions before might know about <code>^</code> meaning &#34;start-of-string&#34;
and correspondingly see <code>$</code> as &#34;end-of-string&#34;. So the pattern <code>cat$</code> would match the string <code>&#34;lolcat&#34;</code> but not <code>&#34;internet cat video&#34;</code>.</p>

<p>The behavior of <code>^</code> made me think that <code>$</code> was similar, but they aren&#39;t always symmetrical
and the behavior is <em>platform-dependent</em>. Specifically for Python with multiline mode <em>disabled</em>
the <code>$</code> character can match either the end of a string <em>or a trailing newline before the end of a string</em>.</p>

<p>So if you&#39;re trying to match a string without a newline at the end, <strong>you can&#39;t only use <code>$</code> in Python!</strong>
My expectation was having multiline mode disabled wouldn&#39;t have had this newline-matching behavior, but that isn&#39;t the case.</p>

<p>Next logical question is how does one match the end of a string without a newline in Python?</p>

<p>After doing more research on <a href="https://docs.python.org/3/library/re.html#regular-expression-syntax">Python</a>
and <a href="https://www.regular-expressions.info/anchors.html">other regular expression syntaxes</a>
I also found <code>\z</code> and <code>\Z</code> as candidates for &#34;end-of-string&#34; characters.</p>

<p>Multi-line mode is enabled with <a href="https://docs.python.org/3/library/re.html#re.MULTILINE"><code>re.MULTILINE</code></a> in Python, the docs have the following to say:</p>

<blockquote>
  <p>When <code>re.MULTILINE</code> is specified the pattern character &#39;$&#39; matches at the end of the string and at the end of each
  line (immediately preceding each newline). By default, &#39;$&#39; only matches at the end of the string and immediately before the newline (if any) at the end of the string.</p>
</blockquote>

<p>Let&#39;s see how these features work together across multiple platforms:</p>

<table>
<thead>
<tr>
  <th>Pattern matches <code>&#34;cat\n&#34;</code>?</th>
  <th><code>&#34;cat$&#34;</code> multiline</th>
  <th><code>&#34;cat$&#34;</code> no multiline</th>
  <th><code>&#34;cat\z&#34;</code></th>
  <th><code>&#34;cat\Z&#34;</code></th>
</tr>
</thead>
<tbody>
<tr>
  <td>PHP</td>
  <td>✅</td>
  <td>✅</td>
  <td>❌</td>
  <td>✅</td>
</tr>
<tr>
  <td>ECMAScript</td>
  <td>✅</td>
  <td>❌</td>
  <td>⚠️</td>
  <td>⚠️</td>
</tr>
<tr>
  <td>Python</td>
  <td>✅</td>
  <td>✅</td>
  <td>⚠️</td>
  <td>❌</td>
</tr>
<tr>
  <td>Golang</td>
  <td>✅</td>
  <td>❌</td>
  <td>❌</td>
  <td>⚠️</td>
</tr>
<tr>
  <td>Java 8</td>
  <td>✅</td>
  <td>✅</td>
  <td>❌</td>
  <td>✅</td>
</tr>
<tr>
  <td>.NET 7.0</td>
  <td>✅</td>
  <td>✅</td>
  <td>❌</td>
  <td>✅</td>
</tr>
<tr>
  <td>Rust</td>
  <td>✅</td>
  <td>❌</td>
  <td>❌</td>
  <td>⚠️</td>
</tr>
</tbody>
</table>

<ul>
<li>✅: Pattern matches the string <code>&#34;cat\n&#34;</code></li>
<li>❌: Pattern does not match the string <code>&#34;cat\n&#34;</code></li>
<li>⚠️: Pattern is invalid or character not supported.</li>
</ul>

<p>Summarizing the above table, if matching a trailing newline is acceptable then <code>$</code> with multiline mode works consistently across all platforms,
but if we wanted to <em>not match</em> a trailing newline then things get more complicated.</p>

<p>To not match a trailing newline, use <code>\z</code> on all platforms except Python and
ECMAScript where you&#39;ll need to use <code>\Z</code> or <code>$</code> without multiline mode respectively.
Hope you learned something about regular expressions today!</p>

<p>Note: The table of data was gathered from <a href="https://regex101.com">regex101.com</a>, I didn&#39;t test using the actual runtimes.</p>

<blockquote>
    <p>
        <strong>Thanks for reading!</strong> ♡ Did you find this article helpful and want more content like it?
        <nobr>Get notified of new posts</nobr> by subscribing to the <a href="https://sethmlarson.dev/feed">RSS feed</a> or the <a href="https://buttondown.email/sethmlarson">email newsletter</a>.
    </p>
    
</blockquote>



</div></div>
  </body>
</html>
