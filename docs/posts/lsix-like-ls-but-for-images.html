<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/hackerb9/lsix">Original</a>
    <h1>lsix: Like &#34;ls&#34;, but for images</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/hackerb9/lsix/blob/master/README.md.d/thumb.png"><img src="https://www.mattambrogi.com/hackerb9/lsix/raw/master/README.md.d/thumb.png"/></a></p>

<p dir="auto">Like &#34;ls&#34;, but for images. Shows thumbnails in terminal using <a href="https://en.wikipedia.org/wiki/Sixel" rel="nofollow">sixel</a>
graphics.</p>




<p dir="auto">Just typing <code>lsix</code> will show images in the current working directory.
You can also specify filenames and, of course, use shell wild cards
(e.g., <code>lsix *jpg *png</code>).</p>
<p dir="auto">Because lsix uses ImageMagick pretty much any image format will be
supported. However, some may be slow to render (like PDF), so lsix
doesn&#39;t show them unless you ask specifically. If you want to force a
listing of a certain type of image simply specify the filenames or
use a wildcard (<code>*.pdf</code> in the example below),.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/hackerb9/lsix/blob/master/README.md.d/example1.png"><img src="https://www.mattambrogi.com/hackerb9/lsix/raw/master/README.md.d/example1.png" alt="Example 1 of lsix usage" title="Most basic usage"/></a></p>

<p dir="auto">If you specify a GIF (or actually any file that has multiple images in
it) on the command line, all the frames will get expanded and shown in
a montage. For example, <code>lsix nyancat.gif</code> shows all the frames. Note
that GIF stores some frames as only the pixels that differ from the
previous frame.
<a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/hackerb9/lsix/blob/master/README.md.d/example2.png"><img src="https://www.mattambrogi.com/hackerb9/lsix/raw/master/README.md.d/example2.png" alt="Example 2 of lsix usage" title="GIFs get expanded"/></a></p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Terminal background color is detected</h3><a id="user-content-terminal-background-color-is-detected" aria-label="Permalink: Terminal background color is detected" href="#terminal-background-color-is-detected"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You may have noticed that PNGs and SVG files have correct alpha
channel for the terminal background. That is because lsix uses
terminal escape sequences to try to figure out your foreground and
background colors. (Foreground is used for the text fill color.)</p>
<p dir="auto">In the first example below, after running <code>lsix</code> in a white on black
xterm, I sent an escape sequence to swap foreground and background
colors. When I ran it again, <code>lsix</code> detected it and changed the
background color to white. Of course, you can pick whatever default
colors you want (e.g., <code>xterm -bg blue</code>, in the second example below).</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/hackerb9/lsix/blob/master/README.md.d/example3.png"><img src="https://www.mattambrogi.com/hackerb9/lsix/raw/master/README.md.d/example3.png" alt="Example 3 of lsix usage" title="Reverse video works"/></a>
<a target="_blank" rel="noopener noreferrer" href="https://www.mattambrogi.com/hackerb9/lsix/blob/master/README.md.d/example4.png"><img src="https://www.mattambrogi.com/hackerb9/lsix/raw/master/README.md.d/example4.png" alt="Example 4 of lsix usage" title="Even &#39;xterm -bg blue&#39; works"/></a></p>

<ul dir="auto">
<li>
<p dir="auto">Detects if your terminal can display SIXEL graphics inline using <a href="https://invisible-island.net/xterm/ctlseqs/ctlseqs.html#h2-Sixel-Graphics" rel="nofollow">control sequences</a>.</p>
</li>
<li>
<p dir="auto">Works great over ssh. Perfect for manipulating those images on the
web server when you can&#39;t quite remember what each one was.</p>
</li>
<li>
<p dir="auto">Non-bitmap graphics often work fine (.svg, .eps, .pdf, .xcf).</p>
</li>
<li>
<p dir="auto">Automatically detects if your terminal, like xterm, can increase the
number of color registers to improve the image quality and does so.</p>
</li>
<li>
<p dir="auto">Automatically detects terminal&#39;s foreground and background colors.</p>
</li>
<li>
<p dir="auto">In terminals that support dtterm WindowOps, the number of tiles per
row will adjust appropriately to the window width.</p>
</li>
<li>
<p dir="auto">If there are many images in a directory (&gt;21), lsix will display them
one row at a time so you don&#39;t need to wait for the entire montage
to be created.</p>
</li>
<li>
<p dir="auto">If your filenames are too long, lsix will wrap the text before
passing it into ImageMagick&#39;s <code>montage</code>. (Without lsix, <code>montage</code> just
jumbles long filenames on top of one another.)</p>
</li>
<li>
<p dir="auto">You can easily change things like the width of each tile in the
montage, the font family, and point size by editing simple variables
at the top of the file. <em>(Tip: try <code>convert -list font</code> to see what
fonts you have on your machine.)</em></p>
</li>
<li>
<p dir="auto">Unicode filenames work fine, as long as your font has the glyphs.</p>
</li>
</ul>

<p dir="auto">Just put the <a href="https://www.mattambrogi.com/hackerb9/lsix/blob/master/lsix"><code>lsix</code></a> file in your path (e.g., /usr/local/bin) and run
it. It&#39;s just a BASH shell script.</p>
<p dir="auto">The only prerequisite software is ImageMagick. If you don&#39;t have it
yet, your OS&#39;s package manager will make it easy to get. (E.g.,
<code>apt-get install imagemagick</code>).</p>
<p dir="auto">MacOS users may prefer to install lsix using <code>brew install lsix</code> which
installs ImageMagick, if necessary.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Your Terminal must support Sixel graphics</h2><a id="user-content-your-terminal-must-support-sixel-graphics" aria-label="Permalink: Your Terminal must support Sixel graphics" href="#your-terminal-must-support-sixel-graphics"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">I developed this using <a href="https://invisible-island.net/xterm/" rel="nofollow">xterm</a> in
vt340 emulation mode, but I believe this should work on
any Sixel compatible terminal. You may test your terminal by viewing a
single image, like so:</p>
<div data-snippet-clipboard-copy-content="convert  foo.jpg  -geometry 800x480  sixel:- "><pre><code>convert  foo.jpg  -geometry 800x480  sixel:- 
</code></pre></div>

<p dir="auto">Note that xterm does not have Sixel mode enabled by default, so you
need to either run it like so:</p>

<p dir="auto">Or, make vt340 the default terminal type for xterm. Add the following
to your <code>.Xresources</code> file and run <code>xrdb -merge .Xresources</code>.</p>
<div data-snippet-clipboard-copy-content="! Allow sixel graphics. (Try: &#34;convert -colors 16 foo.jpg sixel:-&#34;).
xterm*decTerminalID	:	vt340"><pre><code>! Allow sixel graphics. (Try: &#34;convert -colors 16 foo.jpg sixel:-&#34;).
xterm*decTerminalID	:	vt340
</code></pre></div>
<p dir="auto">Further, some distributions, such as Fedora, appear to not compile <code>xterm</code>
with sixel support. In that case, try an alternate terminal, such as
<code>foot</code> or <code>mlterm</code>.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">SIXEL compatible terminals</h3><a id="user-content-sixel-compatible-terminals" aria-label="Permalink: SIXEL compatible terminals" href="#sixel-compatible-terminals"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>XTerm (tested)</li>
<li>MLterm (tested)</li>
<li>foot (tested)</li>
<li>Wezterm (tested)</li>
<li>Contour (tested)</li>
<li>iTerm2 for Apple MacOS (tested)</li>
<li>Konsole (reported)</li>
<li>yakuake (reported)</li>
<li>WSLtty for Microsoft Windows (reported)</li>
<li>MinTTY for Cygwin (Microsoft Windows) (reported)</li>
<li>Yaft for Linux framebuffer (tested)</li>
<li>VTE (special compilation, reported)</li>
<li>sixel-tmux (fork of tmux, reported)</li>
<li>ttyd (reported)</li>
</ul>
<div dir="auto"><h3 tabindex="-1" dir="auto">SIXEL incompatible terminals</h3><a id="user-content-sixel-incompatible-terminals" aria-label="Permalink: SIXEL incompatible terminals" href="#sixel-incompatible-terminals"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>MacOS Terminal, kitty</li>
<li>All standard libvte based terminals
<ul dir="auto">
<li>gnome-terminal</li>
<li>terminator</li>
<li>lxterm</li>
</ul>
</li>
<li>Alacritty (might work with <a href="https://github.com/alacritty/alacritty/pull/4763" data-hovercard-type="pull_request" data-hovercard-url="/alacritty/alacritty/pull/4763/hovercard">a patch</a>)</li>
</ul>

<p dir="auto">Because <code>lsix</code> is currently designed to be very simple, there are no
command line flags, no configuration files, no knobs to twiddle, or
frobs to frobnosticate. However, since the script is so simple, if you
want to make a change, it&#39;s pretty easy to do just by editing the
file. Everything is nicely commented with the most common default
variables at the top.</p>

<p dir="auto">I welcome feedback. If you use lsix and like it or have suggestions
for how it can be improved, please go ahead and send your thoughts to
me <a href="https://github.com/hackerb9/lsix/issues/new">@hackerb9</a> via
GitHub.</p>

<ul dir="auto">
<li>
<p dir="auto">XTerm&#39;s reverse video mode (<code>xterm -rv</code>) is different from
specifying the foreground and background explicitly. There is a way
to detect the latter, but not the former. That means the background
color will be incorrect for folks who use XTerm&#39;s reverseVideo
resource. (See issue #20).</p>
</li>
<li>
<p dir="auto">XTerm&#39;s screen width is currently limited to 1000px due to a
misfeature which causes it to silently show nothing. This limitation
will be removed once xterm can handle images greater than 1000x1000.
[Last tested with XTerm(344)].</p>
</li>
<li>
<p dir="auto">Filenames that begin with &#34;@&#34; are special to ImageMagick and it&#39;ll
freak out if you don&#39;t prepend a directory. (<code>lsix ./@foo.png</code>)
(This is a bug in ImageMagick, not lsix).</p>
</li>
<li>
<p dir="auto">Specifying the empty string <code>&#34;&#34;</code> as a filename makes ImageMagick hang.
(This appears to be an ImageMagick bug / misfeature).</p>
</li>
<li>
<p dir="auto">Long filenames are wrapped, but not intelligently. Would it
complicate this script too much to make it prefer to wrap on whites
space, dashes, underscores, and periods? Maybe.</p>
</li>
<li>
<p dir="auto">Directories specified on the command line are processed as if the
user had cd&#39;d to that directory. It wouldn&#39;t be hard to implement
recursion, but is there actually a need? I&#39;m reluctant to complicate
such a simple script with command line flags.</p>
</li>
<li>
<p dir="auto">If you run <code>lsix foo.avi</code>, you&#39;re asking for trouble.</p>
</li>
</ul>

<ul dir="auto">
<li>
<p dir="auto">The Sixel standard doesn&#39;t appear to have a way to query the size of
the graphics screen. Reading the VT340 documentation, it appears
your program has to already know the resolution of the device you&#39;re
rendering on.</p>
<p dir="auto">XTerm, as of version 344, has added <a href="https://invisible-island.net/xterm/ctlseqs/ctlseqs.html#h2-Functions-using-CSI-_-ordered-by-the-final-character_s_" rel="nofollow">a control
sequence</a>
that solves the problem — <code>CSI ? Pi ; Pa ; Pv S</code> — but some
terminals, for example <code>mlterm</code>, haven&#39;t yet implemented it.</p>
<p dir="auto">There is an alternate way to read the window size using the dtterm
WindowOps extension but it is not quite the right solution as the
geometry of the Sixel graphics screen is not necessarily the same as
the window size. (For example, xterm limits the graphics geometry to
1000x1000, even though the window can actually be larger.) To help
with terminals such as mlterm, <code>lsix</code> will use the dtterm WindowOps
as a fallback.</p>
<p dir="auto">If neither solution works, <code>lsix</code> will assume you are on a VT340
(800x480) and can fit only 6 tiles per row.</p>
</li>
<li>
<p dir="auto">The Sixel standard also lacks a way to query the number of
color registers available. I used the extensions from <code>xterm</code> to do
so, but I do not know how widely implemented they are. If a terminal
does not respond, <code>lsix</code> presumes you&#39;re on an original vt340 and
uses only 16 color registers. (Sorry, 4-gray vt330 users! Time to
upgrade. ;-) )</p>
</li>
<li>
<p dir="auto">The <a href="https://kermitproject.org/" rel="nofollow">Kermit project</a> created a MS-DOS
terminal emulator that was popular in the late 1980s/early 1990s.
Its sixel implementation is not compatible with lsix because it
shows the graphics on a screen separate from the text. However, I
noticed one feature in its documentation: an escape sequence to
request the current graphics window size and number of colors:</p>
</li>
</ul>
<div data-snippet-clipboard-copy-content=" ESC [ ? 256 n                  Request screen size report

        Report is ESC [ ? 256; Ph; Pw; Pc n     for graphics systems

        where   Ph is screen height in dots
                Pw is screen width in dots
                Pc is number of colors (0, 1 or 16, for none, b/w, ega/vga)

        Report is ESC [ ? 24; 80; 0 n  for pure text mono systems."><pre><code> ESC [ ? 256 n                  Request screen size report

        Report is ESC [ ? 256; Ph; Pw; Pc n     for graphics systems

        where   Ph is screen height in dots
                Pw is screen width in dots
                Pc is number of colors (0, 1 or 16, for none, b/w, ega/vga)

        Report is ESC [ ? 24; 80; 0 n  for pure text mono systems.
</code></pre></div>
<p dir="auto">Did any other terminal emulators ever use the sequence? Would it be
worthwhile to add to <code>lsix</code>?</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://github.com/saitoha/libsixel">libsixel</a> is an excellent
project for writing programs that can output optimized Sixel
graphics commands. Because I have a lot of respect for the project,
I feel I should explain why <code>lsix</code> does not use libsixel.</p>
<ul dir="auto">
<li>
<p dir="auto">(a) I wanted lsix to work everywhere easily. Bash and imagemagick
are ubiquitous, so a shell script is a natural solution.</p>
</li>
<li>
<p dir="auto">(b) I wanted <code>lsix</code> to be simple enough that it could be easily
customized and extended by other people. (Including myself.)</p>
</li>
<li>
<p dir="auto">(c) ImageMagick has better support for reading different formats
than stb_image (the library used by libsixel&#39;s <code>img2sixel</code>). (For
example: xpm, svg, 16-bit png, and even sixel files are not
recognized by img2sixel). Since ImageMagick can read all of those
and write sixel output directly, it made sense to use it for both.</p>
</li>
<li>
<p dir="auto">(d) While libsixel is optimized and would surely be faster than
ImageMagick, it&#39;s overkill. For a simple directory listing, this
is plenty fast enough.</p>
</li>
</ul>
</li>
</ul>

<ul dir="auto">
<li>
<p dir="auto"><a href="https://invisible-island.net/xterm/ctlseqs/ctlseqs.html" rel="nofollow">XTerm Control Sequences</a></p>
</li>
<li>
<p dir="auto"><a href="https://imagemagick.org/" rel="nofollow">ImageMagick</a></p>
</li>
<li>
<p dir="auto"><a href="https://vt100.net/docs/vt3xx-gp/" rel="nofollow">VT340 Programmer&#39;s Reference</a>:</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://vt100.net/docs/vt3xx-gp/chapter14.html" rel="nofollow">Chapter 14</a>. Sixel Graphics.</p>
</li>
<li>
<p dir="auto"><a href="https://vt100.net/docs/vt3xx-gp/chapter16.html#S16.3" rel="nofollow">Chapter 16</a> Difference between Level 1 and Level 2 Sixel implementations.</p>
<p dir="auto"><em>Nota bene: this reference has the sense for DECSDM (sixel
display mode) reversed! The actual behaviour of the VT340 is
that when DECSDM is reset (the default), sixel scrolling is enabled.
This can be done by sending <em><code>Esc[?80l</code></em>, but lsix does not do
so as it would break many current terminal emulators.
See issue #41 for details.</em></p>
</li>
</ul>
</li>
<li>
<p dir="auto"><a href="https://archive.org/details/bitsavers_decstandar0VideoSystemsReferenceManualDec91_74264381" rel="nofollow">DEC STD 070 Video Systems Reference Manual</a>.
A weighty tome which covers nearly everything in exacting detail. I referred mostly to sections 4 (escape sequences) and 9 (sixel programming).</p>
</li>
<li>
<p dir="auto"><a href="https://github.com/hackerb9/vt340test">VT340 Test</a>, a project to document the actual behaviour of the DEC VT340 hardware.</p>
</li>
<li>
<p dir="auto"><a href="http://www.vaxhaven.com/images/f/f7/EK-PPLV2-PM-B01.pdf" rel="nofollow">Digital ANSI-Compliant Printing Protocol: Level 2 Programming Reference Manual</a>, Chapter 5: Sixel Graphics. An excellent and reasonably clear discussion for anyone who wants to generate or parse sixel graphics.</p>
</li>
</ul>
</article></div></div>
  </body>
</html>
