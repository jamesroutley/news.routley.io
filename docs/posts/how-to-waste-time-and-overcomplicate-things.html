<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ryanwarnock.me/blog/260222.html">Original</a>
    <h1>How to waste time and overcomplicate things</h1>
    
    <div id="readability-page-1" class="page"><div>
                
  <div id="how-to-waste-time-and-overcomplicate-things">

<p><strong>26/02/22</strong></p>
<div>
<p>A quick word</p>
<p>This post ended up being fairly popular on Hacker News and sparked conversations about project management and development in the IT industry. You can find the post <a href="https://news.ycombinator.com/item?id=30480083">here</a>.</p>
</div>
<div id="the-problem">
<h2>The problem<a href="#the-problem" title="Permalink to this headline">¶</a></h2>
<p>My homelab is connected to the internet with a 20mb/s down and 5mb/s up connection, just enough for a remote 720p stream at decent quality without completely saturating the link. The problem is that the <a href="https://firecore.com/infuse">Infuse</a> app I use will not request my <a href="https://jellyfin.org/">Jellyfin</a> server to transcode the video. So if I play a 4K video file on Infuse, my 5mb/s upload speed can’t keep up.</p>
</div>
<div id="the-solution">
<h2>The solution<a href="#the-solution" title="Permalink to this headline">¶</a></h2>
<p>I found this application called <a href="https://tdarr.io/">Tdarr</a>. A system for transcoding large libraries of media files. Great!</p>
<p>This is how I made it way more complicated than it should have been and wasted my time.</p>
</div>
<div id="step-1-make-assumptions">
<h2>Step 1 - Make assumptions<a href="#step-1-make-assumptions" title="Permalink to this headline">¶</a></h2>
<p><strong>Create a solution without understanding how it all works</strong></p>
<p>While waiting for Tdarr to download and install I began thinking about how to manage the transcoded files. I <em>assumed</em> that the transcoded media files would be placed into the same directory as the source file.</p>
<p>So, I wrote a bash script to traverse my media directories looking for these new 720p files and then move them into a directory which would contain only 720p files.</p>
<div>
<p>Note</p>
<p>My media directory is structured like <code><span>media/shows/[Series]/[Season]/[Episode]</span></code>
The 720p videos are structured <code><span>media/720pShows/[Series]/[Season]/[Episode]</span></code></p>
</div>
<p>Writing this script included a method of detecting the current path of the 720p media file within my media directory and then replicating that in the 720p media directory. So directories would be created if they didn’t exist and then the 720p file was moved.</p>
<p>So I began setting up Tdarr and then realised that you can select the output of the converted file. This made all of my time and effort planning and then writing the bash script completely pointless.</p>
<p>Reflecting upon this, it seems like it is pretty obvious Tdarr would let you choose the output directory. I can’t tell you why I just assumed it wouldn’t.</p>
</div>
<div id="step-2-continue-to-make-assumptions">
<h2>Step 2 - Continue to make assumptions<a href="#step-2-continue-to-make-assumptions" title="Permalink to this headline">¶</a></h2>
<p><strong>Continue creating a solution without understanding how it all works</strong></p>
<p>Ok, my media files are beginning to be converted and then saved into a temp directory I created to hold them. From there I’ll write a python script which reads the names of the files, parses them to get their series name and the season number. With the series name and the series number the script will create directories in the 720p directory so it would be structured like <code><span>720pShows/[Series]/[Season]/[Episode]</span></code> and then the files will be moved.</p>
<p>I <em>assumed</em> Tdarr would place the converted video file into the temp directory as I had set it to. Makes sense right? I copied some video files into the temp directory to test it - and it worked! I set up a systemd timer to run my script every minute so that as newly converted files are placed into the temp directory they are moved into their new home.</p>
<p>I came back a short while later and checked the status of my systemd timer and all was well. I checked the 720p directory and all was not well there. It now contained directories named ‘Futurama’, ‘Season 2’, ‘Season 3’. Season folders which belong inside of series folders were not where they are supposed to be.</p>
<p>I <em>assumed</em> there must be some kind of error in my script’s parsing of the file title it uses to determine the directory structure. That wasn’t the case. If I copied the video file which was in the wrong folder into the temp directory and then ran my script manually the video file ended up in the correct place!</p>
<p>It was then that I realised that after converting a video file Tdarr will place that video file into the new directory with the same structure it came from. For example, a video which came from <code><span>shows/[Series]/[Season]/[video</span> <span>file]</span></code> will end up in <code><span>temp/[Series]/[Season]/[video</span> <span>file]</span></code>.</p>
<p>My python script was pointless! If it creates the directories then all I need to do is move whatever is in the temp directory into the 720p directory.</p>
</div>
<div id="step-3-just-fix-the-mistakes-don-t-learn-from-them">
<h2>Step 3 - Just fix the mistakes, don’t learn from them<a href="#step-3-just-fix-the-mistakes-don-t-learn-from-them" title="Permalink to this headline">¶</a></h2>
<p><strong>After something has caused you multiple issues don’t stop and reconsider your approach</strong></p>
<p>Now that I know Tdarr already takes care of the directory structure for me all I need to do is move the temp directory contents into the 720p directory. I’ll set up an rsync move command on a systemd timer to do it every minute.</p>
<p>But wait… if Tdarr lets you choose the output directory and then even puts the output into the correct directory structure why do I even need this temp directory and the rsync move command? Why not just point the output of Tdarr to the 720p directory?</p>
<p>It wasn’t until this point that I realised just how badly I had biffed this whole process.</p>
</div>
<div id="conclusion">
<h2>Conclusion<a href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>I had a relatively simple task. Convert a batch of 4K and 1080p videos into 720p. I managed to overcomplicate and waste my time because I made assumptions and then failed to recognise mistakes and then repeated it. In the future I will definitely be trying to avoid making these mistakes again.</p>
<p>On a positive note, I was able to practice my bash and python skills so it wasn’t all for nothing.</p>
</div>
</div>

    
    

              </div></div>
  </body>
</html>
