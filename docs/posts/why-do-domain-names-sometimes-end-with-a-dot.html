<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jvns.ca/blog/2022/09/12/why-do-domain-names-end-with-a-dot-/">Original</a>
    <h1>Why do domain names sometimes end with a dot?</h1>
    
    <div id="readability-page-1" class="page"><div>
     

<p>Hello! When I was writing the zine <a href="https://wizardzines.com/zines/dns/">How DNS Works</a>
earlier this year, someone asked me – why do people sometimes put a dot at the
end of a domain name? For example, if you look up the IP for <code>example.com</code> by
running <code>dig example.com</code>, you’ll see this:</p>

<pre><code>$ dig example.com
example.com.		5678	IN	A	93.184.216.34
</code></pre>

<p><code>dig</code> has put a <code>.</code> to the end of <code>example.com</code> – now it’s <code>example.com.</code>! What’s up with that?</p>

<p>Also, some DNS tools require domains to have a <code>&#34;.&#34;</code> at the end: if you try to pass <code>example.com</code> to <a href="https://github.com/miekg/dns">miekg/dns</a>, like this, it’ll fail:</p>

<pre><code>// trying to send this message will return an error
m := new(dns.Msg)
m.SetQuestion(&#34;example.com&#34;, dns.TypeA)
</code></pre>

<p>Originally I thought I knew the answer to this (“uh, the dot at the end means
the domain is fully qualified?“). And that’s true – a fully qualified domain
name is a domain with a “.” at the end!</p>

<p>But that doesn’t explain <em>why</em> dots at the end are useful or important.</p>

<h3 id="in-a-dns-request-response-domain-names-don-t-have-a-trailing">in a DNS request/response, domain names don’t have a trailing “.”</h3>

<p>I once (incorrectly) thought the answer to “why is there a dot at the end?”
might be “In a DNS request/response, domain names have a “.” at the end, so we
put it in to match what actually gets sent/received by your computer”. But
that’s not true at all!</p>

<p>When a computer sends a DNS request or response, the domain names in it don’t
have a trailing dot. Actually, the domain names don’t have <em>any</em> dots.</p>

<p>Instead, they’re encoded as a series of length/string pairs. For example,
the domain <code>example.com</code> is encoded as these 13 bytes:</p>

<pre><code>7example3com0
</code></pre>

<p>So there are no dots at all. Instead, an ASCII domain name (like “example.com”)
gets translated into the format used in a DNS request / response by various DNS
software.</p>

<p>So let’s talk about one place where domain names are translated into DNS responses: zone files.</p>

<h3 id="the-trailing-in-zone-files">the trailing “.” in zone files</h3>

<p>One way that some people manage DNS records for a domain is to create a text
file called a “zone file” and then configure some DNS server software (like <code>nsd</code>
or <code>bind</code>) to serve the DNS records specified in that zone file.</p>

<p>Here’s an imaginary zone file for <code>example.com</code>:</p>

<pre><code>orange  300   IN    A     1.2.3.4
fruit   300   IN    CNAME orange
grape   3000  IN    CNAME example.com.
</code></pre>

<p>In this zone file, anything that doesn’t end in a <code>&#34;.&#34;</code> (like <code>&#34;orange&#34;</code>) gets
<code>.example.com</code> added to it. So <code>&#34;orange&#34;</code> is shorthand for
<code>&#34;orange.example.com&#34;</code>. The DNS server knows from its configuration that this
is a zone file for <code>example.com</code>, so it knows to automatically append
<code>example.com</code> at the end of any name that doesn’t end with a dot.</p>

<p>I assume the idea here is just to save typing – you could imagine writing
this zone file by fully typing out all of the domain names:</p>

<pre><code>orange.example.com.  300   IN    A     1.2.3.4
fruit.example.com.   300   IN    CNAME orange.example.com.
grape.example.com.   3000  IN    CNAME example.com.
</code></pre>

<p>But that’s a lot of typing.</p>

<h3 id="you-don-t-need-zone-files-to-use-dns">you don’t need zone files to use DNS</h3>

<p>Even though the zone file format is defined in the official DNS RFC (<a href="https://www.rfc-editor.org/rfc/rfc1035#section-4.1.1">RFC 1035</a>), you don’t have to
use zone files at all to use DNS. For example, AWS Route 53 doesn’t use zone
files to store DNS records! Instead you create records through the web
interface or API, and I assume they store records in some kind of database and
not a bunch of text files.</p>

<p>Route 53 (like many other DNS tools) does support importing and exporting zone
files though and it can be a good way to migrate records from one DNS provider
to another.</p>

<h3 id="the-trailing-in-dig">the trailing “.” in dig</h3>

<p>Now, let’s talk about <code>dig</code>’s output:</p>

<pre><code>$ dig example.com
; &lt;&lt;&gt;&gt; DiG 9.18.1-1ubuntu1.1-Ubuntu &lt;&lt;&gt;&gt; +all example.com
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 10712
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;example.com.			IN	A

;; ANSWER SECTION:
example.com.		81239	IN	A	93.184.216.34

</code></pre>

<p>One weird thing about this is that almost every line starts with a <code>;;</code>. What’s
up with that? Well <code>;</code> is the comment character in zone files!</p>

<p>So I think the reason that dig prints out its output in this weird way is so that
if you wanted, you could just paste this into a zone file and have it work
without any changes.</p>

<p>This also explains why there’s a <code>.</code> at the end of <code>example.com.</code> – zone files
require a trailing dot at the end of a domain name (because otherwise they’re
interpreted as being relative to the zone). So <code>dig</code> does too.</p>

<p>I really wish dig had a <code>+human</code> flag that printed out all of this information
in a more human readable way, but for now I’m too lazy to put in the work to
actually contribute code to do that (and I’m a pretty bad C programmer) so I’ll
just complain about it on my blog instead :)</p>

<h3 id="the-trailing-in-curl">the trailing <code>&#34;.&#34;</code> in curl</h3>

<p>Let’s talk about another case where the trailing <code>&#34;.&#34;</code> shows up: curl!</p>

<p>One of the computers in my house is called “grapefruit”, and it’s running a
webserver. Here’s what happens if I run <code>curl grapefruit</code>:</p>

<pre><code>$ curl grapefruit
&lt;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 4.01//EN&#34; &#34;http://www.w3.org/TR/html4/strict.dtd&#34;&gt;

&lt;html&gt;
&lt;head&gt;
</code></pre>

<p>It works! Cool. But what happens if I add a <code>.</code> at the end? Suddenly it doesn’t work:</p>

<pre><code>$ curl grapefruit.
curl: (6) Could not resolve host: grapefruit.
</code></pre>

<p>What’s going on? To understand, we need to learn about search domains:</p>

<h3 id="meet-search-domains">meet search domains</h3>

<p>When I run <code>curl grapefrult</code>, how does that get translated into a DNS request?
You might think that my computer would send a request for the domain
<code>grapefruit</code>, right? But that’s not true.</p>

<p>Let’s use <code>tcpdump</code> to see what domain is actually being looked up:</p>

<pre><code>$ sudo tcpdump -i any port 53
[...] A? grapefruit.lan. (32)
</code></pre>

<p>It’s actually sending a request for <code>grapefruit.lan</code>. What’s up with that?</p>

<p>Well, what’s going on is that:</p>

<ol>
<li>To look up <code>grapefruit</code>, <code>curl</code> calls a function called <code>getaddrinfo</code></li>
<li><code>getaddrinfo</code> looks in a file on my computer called <code>/etc/resolv.conf</code></li>
<li><code>/etc/resolv.conf</code> contains these 2 lines:
<pre>nameserver 127.0.0.53
search lan
</pre></li>
<li>Because it sees <code>search lan</code>, <code>getaddrinfo</code> adds a <code>lan</code> at the end of <code>grapefruit</code> and looks up <code>grapefruit.lan</code> instead</li>
</ol>

<h3 id="when-are-search-domains-used">when are search domains used?</h3>

<p>Now we know something weird: that when we look up a domain, sometimes an extra
thing (like <code>lan</code>) will be added to the end. But when does that happen?</p>

<ol>
<li>If we put a <code>&#34;.&#34;</code> at the <strong>end</strong> of the domain (like <code>curl grapefruit.</code>, then search domains aren’t used</li>
<li>If the domain has an <code>&#34;.&#34;</code> <strong>inside</strong> it (like <code>example.com</code> has a dot in it), then by default search domains aren’t used either. But this can be changed with configuration (see this blog post about <a href="https://pracucci.com/kubernetes-dns-resolution-ndots-options-and-why-it-may-affect-application-performances.html">ndots</a> that talks about this more)</li>
</ol>

<p>So now we know why <code>curl grapefruit.</code> has different results than <code>curl grapefruit</code> – it’s because one looks up the domain <code>grapefruit.</code> and the other one looks up <code>grapefruit.lan.</code></p>

<h3 id="how-does-my-computer-know-what-search-domain-to-use">how does my computer know what search domain to use?</h3>

<p>When I connect to my router, it tells me that its search domain is <code>lan</code> with
DHCP – it’s the same way that my computer gets assigned an IP address.</p>

<h3 id="so-why-do-people-put-a-dot-at-the-end-of-domain-names">so why do people put a dot at the end of domain names?</h3>

<p>Now that we know about zone files and search domains, here’s why I think people
like to put dots at the end of a domain name.</p>

<p>There are two contexts where domain names are modified and get something else added to the end:</p>

<ul>
<li>in a zone file for <code>example.com</code>, <code>grapefruit</code> get translated to <code>grapefruit.example.com</code></li>
<li>on my local network (with my computer configured to use the search domain <code>lan</code>), <code>grapefruit</code> gets translated to <code>grapefruit.lan</code></li>
</ul>

<p>So because domain names can actually be translated to something else in some
cases, people like to put a <code>&#34;.&#34;</code> at the end to communicate “THIS IS THE
DOMAIN NAME, NOTHING GETS ADDED AT THE END, THIS IS THE WHOLE THING”. Because
otherwise it can get confusing.</p>

<p>The technical term for “THIS IS THE WHOLE THING” is <strong>“fully qualified domain
name”</strong> or <strong>“FQDN”</strong>. So <code>google.com.</code> is a fully qualified domain name, and
<code>google.com</code> isn’t.</p>

<p>I always have to remind myself for the reasons for this because I rarely use
zone files or search domains, so I often feel like – “of course I mean
<code>google.com</code> and not <code>google.com.something.else</code>! Why would I mean anything
else?? That’s silly!”</p>

<p>But some people do use zone files and search domains (search domains are used
in Kubernetes, for example!), so the “.” at the end is useful to make it 100%
clear that nothing else should be added.</p>

<h3 id="when-to-put-a-at-the-end">when to put a “.” at the end?</h3>

<p>Here are a couple of quick notes about when to put a “.” at the end of your domain names:</p>

<p><strong>Yes: when configuring DNS</strong></p>

<p>It’s never bad to use fully qualified domain names when configuring DNS. You
don’t always have to: a non-fully-qualified domain name will often work just
fine as well, but I’ve never met a piece of DNS software that wouldn’t accept a
fully qualified domain name.</p>

<p>And some DNS software requires it: right now the DNS server I use for <code>jvns.ca</code>
makes me put a <code>&#34;.&#34;</code> at the end of domains names (for example in CNAME records)
and warns me otherwise it’ll append <code>.jvns.ca</code> to whatever I typed in. I don’t
agree with this design decision but it’s not a big deal, I just put a “.” at
the end.</p>

<p><strong>No: in a browser</strong></p>

<p>Confusingly, it often <em>doesn’t</em> work to put a <code>&#34;.&#34;</code> at the end of a domain name in a
browser! For example, if I type <code>https://twitter.com.</code> into my browser, it
doesn’t work! It gives me a 404.</p>

<p>I think what’s going on here is that it’s setting the HTTP Host header to
<code>Host: twitter.com.</code> and the web server on the other end is expecting <code>Host: twitter.com</code>.</p>

<p>Similarly, <code>https://jvns.ca.</code> gives me an SSL error for some reason.</p>

<h3 id="i-think-relative-domain-names-used-to-be-more-common">I think relative domain names used to be more common</h3>

<p>One last thing: I think that “relative” domain names (like me using
<code>grapefruit</code> to refer to the other computer in my house, <code>grapefruit.lan</code>) used
to be more commonly used, because DNS was developed in the context of
universities or other big institutions which have big internal networks.</p>

<p>On the internet today, it seems like it’s more common to use “absolute” domain
names (like <code>example.com</code>).</p>

</div></div>
  </body>
</html>
