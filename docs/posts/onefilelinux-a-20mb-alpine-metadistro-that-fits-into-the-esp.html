<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://hub.zhovner.com/geek/one-file-linux/">Original</a>
    <h1>OneFileLinux: A 20MB Alpine metadistro that fits into the ESP</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        <div>

  

  <article>
    <p><img src="https://hub.zhovner.com/img/one-file-linux.png" alt="One File Linux logo"/> Live linux distro combined in one ~20MB file. Runs on any UEFI computer (PC or Mac) without installation. Just copy one file to EFI system partition and boot.</p>





<h3 id="main-advantages">Main advantages</h3>

<ul>
  <li><strong>No installation required</strong> — no need to create additional paritions. Just copy one file to EFI system partition and add new boot entry to NVRAM.</li>
  <li><strong>No USB flash needed</strong> — once copied to EFI partition, OneFileLinux can boot any time from system disk.</li>
  <li><strong>No Boot Manager required (GRUB, rEFInd)</strong> — boots directly by UEFI firmware, no additional software needed.</li>
  <li><strong>Doesn’t change the boot sequence</strong> — can boot only once, next reboot will return default settings.</li>
  <li><strong>Compatible with disk encryption</strong> — works with macOS FileVault and dm-crypt. Because EFI system parition is not encrypted.</li>
</ul>

<h3 id="why">Why?</h3>

<p>This can be useful when you need Linux on bare metal and can’t use USB flash. In comparison with Live USB flash, one file Linux setups permanently in EFI partition and can boot any time later.</p>

<h2 id="run-on-macbook">Run on Macbook</h2>

<hr/>

<h4 id="1-download-onefilelinuxefi-from-link-above">1. Download OneFileLinux.efi from link above.</h4>

<h4 id="2-mount-efi-system-partition">2. Mount EFI System Partition</h4>

<p><code>diskutil mount diskN</code></p>

<p>where diskN is your EFI disk number.</p>

<p><img src="https://hub.zhovner.com/img/diskutil-list-efi.png" alt="macOS diskutil list EFI partition"/></p>

<p>For me it will be: <code>diskutil mount disk0s1</code></p>

<h4 id="3-copy-onefilelinuxefi-to-efi-partition">3. Copy OneFileLinux.efi to EFI partition</h4>

<p><code>cp ~/Downloads/OneFileLinux.efi /Volumes/EFI/</code></p>

<h4 id="4-set-boot-option-in-nvram">4. Set boot option in NVRAM</h4>

<p>On macOS since El Capitan enabled by default SIP (System Integrity Protection) prohibits to change boot options.</p>

<p>If SIP is enabled you can run <code>bless</code> only from Recovery console, otherwise it returns error.</p>

<p><code>bless --mount /Volumes/EFI --setBoot --nextonly --file /Volumes/EFI/OneFileLinux.efi</code></p>

<p>This command sets NVRAM option to boot OneFileLinux.efi only once. Next reboot will return default boot order.</p>

<h4 id="5-reboot">5. Reboot</h4>

<p>Reboot to run OneFileLinux. Once you’ve done, type <code>reboot</code> in Linux console and go back to macOS. </p>

<h2 id="run-on-pc">Run on PC</h2>

<hr/>

<p>There are few ways how to run OneFileLinux on PC motherboard. Some motherboards have builtin UEFI Shell that can run any efi binary from console.</p>

<h4 id="1-copy-onefilelinuxefi-to-efi-partition">1. Copy OneFileLinux.efi to EFI partition</h4>

<p>If you use Windows 10 installed in EFI mode, you have EFI system partition 100 MB in size.</p>

<h4 id="2-add-nvram-boot-option">2. Add NVRAM boot option</h4>

<p>I can’t find out how to do this in Windows, so you probably need Linux for this.</p>

<p><code>efibootmgr --disk /dev/sda --part 2 --create --label &#34;One File Linux&#34; --loader /OneFileLinux.efi</code></p>



<p>On my ThinkPad X220 I press F12 while power on to open boot menu. Hotkey depends on your motherboard.</p>

<p><img src="https://hub.zhovner.com/img/thinkpad-x220-boot-menu.png" alt="ThinkPad X220 boot menu"/></p>

<h2 id="run-from-usb-flash">Run from USB flash</h2>

<hr/>

<p>The only benefit from running OneFileLinux from USB flash, is that no additional software is required to create bootable flash drive.</p>

<p><code>\EFI\BOOT\BOOTx64.EFI</code></p>

<h4 id="format-in-gpt-scheme-in-windows">Format in GPT scheme in Windows</h4>

<p>Windows does not allow to format flash drive in GPT scheme from GUI, so you need to use command line tool.</p>

<ol>
  <li>Open <code>cmd.exe</code> as administrtor</li>
  <li>Type<code>diskpart</code></li>
  <li><code>list disk</code> to see all disks</li>
  <li><code>select disk &lt;disknumber&gt;</code></li>
  <li><code>clean</code> do delete parition table</li>
  <li><code>convert gpt</code> to convert disk in GPT scheme</li>
  <li><code>exit</code></li>
</ol>

<p>Then format drive from <code>diskmgmt.msc</code> in FAT32.</p>

<h2 id="build-your-own">Build your own</h2>

<hr/>

<p>You can build your own version of One File Linux.</p>

<ol>
  <li>
    <p>Clone repositry</p>
  </li>
  <li>
    <p>Make changes in root filesystem and kernel</p>
  </li>
  <li>
    <p>Build</p>
  </li>
</ol>

  </article>

</div>




      </div>
    </div></div>
  </body>
</html>
