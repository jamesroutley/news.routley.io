<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://oldvcr.blogspot.com/2022/12/the-strange-case-of-beos-srs-and-silent.html">Original</a>
    <h1>The strange case of BeOS, SRS and the silent Power Mac 6500</h1>
    
    <div id="readability-page-1" class="page"><div id="post-body-3965970667868094850" itemprop="description articleBody"><p>
Tonight&#39;s story time: the Power Macintosh that wouldn&#39;t make any sound in BeOS R5, how I figured out the problem, and how I hacked the sound driver to fix it. (Download link at the end.)
</p><p>
My favourite beige Power Mac is the <a href="https://oldvcr.blogspot.com/2022/11/running-pinball-game-from-disk-image.html">Power Macintosh 7300</a> and its relatives. They&#39;re compact, capable, upgradable and easy to work on. For as much as people raved about the pull-down side door of the Yosemite G3 and the Power Mac G4, they owe their design to their fold-out Outrigger Power Mac ancestors which did it all and did it horizontally â€” and in some ways did it better.
</p><p>
However, when it came time to setting up a second PowerPC BeOS system to go with <a href="https://oldvcr.blogspot.com/2021/03/when-you-have-too-much-memory-for.html">my 133MHz BeBox</a> (the two run the same applications), although the Outriggers are well supported in BeOS 5 I decided to get a tower Mac for space reasons. Since NuBus, G3 and New World Macs were out (not compatible with BeOS) there&#39;s only a few choices, namely the 8500, 8600, 9500, 9600 and the 6400 and 6500. I despise the 8500 case (I only tolerate <a href="https://oldvcr.blogspot.com/2021/02/maclynx-beta-3-really.html">my clock-chipped Quadra 800</a> in the same style because it runs A/UX so well), the 8600 is bulky, and while all beige Power Macs have succumbed to the general price inflation that has afflicted every corner of vintage computing, the 9500 and 9600 6-slot Power Macs have really taken it on the chin (and the 9600 is bulky too).
</p><p>
That left the Insta-Towers, or what I like to call the Stormtrooper Macs:

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjwHBMB16mdbIEk3ztO_P7egsVoTZ8mEBmK7J3NHhGVokIlK6q1C2xhrV_E2XB_wzY2JCXE7eXom6nk-oqEmXbKakh82xQ1jli4gXZ8GX7RjXH_iVemeKNs1C08ujftw55r1kcUz_4SVizTAtMYOVNaBh4uloClrUPPsNjNI5xE2HGoSEWMWHGYTek2/s4080/IMG_20221210_131321.jpg"><img alt="" data-original-height="4080" data-original-width="3072" height="320" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjwHBMB16mdbIEk3ztO_P7egsVoTZ8mEBmK7J3NHhGVokIlK6q1C2xhrV_E2XB_wzY2JCXE7eXom6nk-oqEmXbKakh82xQ1jli4gXZ8GX7RjXH_iVemeKNs1C08ujftw55r1kcUz_4SVizTAtMYOVNaBh4uloClrUPPsNjNI5xE2HGoSEWMWHGYTek2/s320/IMG_20221210_131321.jpg"/></a></p><p>

Meet the Power Macintosh 6500/275. The Insta-Tower Macs started with the 1997 Power Mac 6400 and were intended as home Macs (the 6400 was separately rebadged as the only mini-tower Performa, and along with the 6360 and the All-in-One 5400 was the last Mac model to bear the Performa name). Their non-pro deficiencies include a relatively low RAM ceiling for the time (136MB, counting the 8MB on the board), a non-upgradable 603e CPU (though companies like Sonnet eventually made G3 upgrades for the L2 cache slot) and only two official PCI slots (the Communication Slot II is PCI-like and has PCI lines for Ethernet NICs, but isn&#39;t mechanically compatible and has additional lines for modem cards). On the other hand, it came with built-in good-enough 2D &#34;Valkyrie&#34; video and a 28.8kbps modem in the Comm Slot (though this locks out the serial port until the card is removed, and a plug shipped from the factory covering it up), plus remote control, video input and TV/FM tuner card options, and arguably the best audio on any pre-G3 Power Mac due to onboard SRS surround and its built-in subwoofer (enabled if external speakers are connected).
</p><p>
The 6400, the AIO 5400 and the closely related 6360 are based on Apple&#39;s Alchemy logic board, and they are all listed as <a href="http://testou.free.fr/www.beatjapan.org/mirror/www.be.com/support/guides/beosreadylist_ppc.html">supported in BeOS</a>. For the 6400&#39;s follow-on, however, Apple made several significant changes to what would become the 6500: no RAM on board (so a <em>lower</em> RAM ceiling of 128MB), a built-in 3D accelerator (an off-the-shelf ATI 3D Rage II) and a much faster selection of 603e CPUs up to 300MHz, which Apple alleged as being the first personal computer to do so. The enhanced audio and tuner options, however, were maintained. Early 6500s had defects with their video circuitry that caused jittery or blurry video, and some shipped with incompatible L2 cache DIMMs; conversely, the last-of-the-line 300MHz 6500 is reportedly quite a rare bird. Apple called the new logic board Gazelle, which apparently had at least one subsequent revision (but we&#39;re getting ahead of ourselves), and used it for the functionally identical AIO 5500 and the Twentieth Anniversary Macintosh. The 6500/300 was the final Insta-Tower as all of the four digit Power Macs were subsequently replaced by the beige Power Macintosh G3 except the 9600.
</p><p>
Gazelle is similar enough to Alchemy that Be believed it would work with the BeOS, but didn&#39;t get around to testing it, hence marking it as &#34;Unsupported but Compatible&#34; in their model matrix. I settled on this 6500/275 because it was clean, it was (unnecessarily, but why not) recapped, 275MHz would be an obvious upgrade over 133MHz, it had 128MB of RAM already and came with an iXmicro Twin Turbo 128MA, a better 2D card for BeOS (BeOS for Power Macs has no 3D accelerator support), and a third-party 1MB L2 cache stick (the 275MHz came with 512K). With that in mind the price the seller wanted wasn&#39;t outrageous, so I gritted my teeth and bought it. Plus, even though I already have a Gazelle Mac in the form of my Twentieth Anniversary Macintosh, I didn&#39;t have any Insta-Towers in my collection, and the people I consulted with reported theirs worked fine.
</p><p>
Much to my irritation and contrary to the way it was described, the machine arrived in somewhat less than pristine condition. The subwoofer volume control knob was loose and didn&#39;t actually turn the control (good thing I wasn&#39;t planning to use it), one of the feet was missing, and it needed a good general scrub. I had some spare 6400 feet in my box of junk (one just acquires these things after many years with old Macs) and wiped it down, and then turned to getting it suitable for dual-booting.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhbtOadJbikUr8YK4154O2vf1EmxunpSt2lAw0lEma54_vwDymDN6TJZ-1NjWa_OBuDbm00vF5Y24ciz7JERqIllhNIGwu3qGZlKlJw5Z5aCWzWFahwRPuGpa4qmYQJ6Ljm7LGhdzFSwsEkR5wNwlIVCcNMUMufEAy27hprJHhKJWM4N_8rDOAVubtC/s4080/IMG_20220904_134800.jpg"><img alt="" data-original-height="4080" data-original-width="3072" height="320" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhbtOadJbikUr8YK4154O2vf1EmxunpSt2lAw0lEma54_vwDymDN6TJZ-1NjWa_OBuDbm00vF5Y24ciz7JERqIllhNIGwu3qGZlKlJw5Z5aCWzWFahwRPuGpa4qmYQJ6Ljm7LGhdzFSwsEkR5wNwlIVCcNMUMufEAy27hprJHhKJWM4N_8rDOAVubtC/s320/IMG_20220904_134800.jpg"/></a></p><p>

The front panel comes off to reveal the drives mounted on chassis sleds. The 6500 uses an PATA IDE disk, so I replaced the 4GB drive it had with an old 20GB from a Power Mac G4, giving me comfortably way more space than needed to run Mac OS and BeOS.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh7ibpvt86MrAWW6vI0ptf7InOaDDZhR_ryazRC1kZdL0Hrs30EehXSfKDMDPaKWkmr0GHWW8rPHYJbuMNjIyZ2yyo0EcPpl4FoNNL_ljXWv5dchVSi8mv7qVeG-3zkE0ejKu7RZDi-_dDXSkeYXk07Vy0AaT7OPX1jJ--Qvf1Iib45ru7ioUSWuh7z/s4080/IMG_20220910_150855.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh7ibpvt86MrAWW6vI0ptf7InOaDDZhR_ryazRC1kZdL0Hrs30EehXSfKDMDPaKWkmr0GHWW8rPHYJbuMNjIyZ2yyo0EcPpl4FoNNL_ljXWv5dchVSi8mv7qVeG-3zkE0ejKu7RZDi-_dDXSkeYXk07Vy0AaT7OPX1jJ--Qvf1Iib45ru7ioUSWuh7z/s320/IMG_20220910_150855.jpg" width="320"/></a></p><p>

The other upgrade I did was to replace the modem with a Comm Slot II Ethernet card from my stash (the spare for my TAM, which also has a Comm Slot II). This is an Apple Ethernet CS II Twisted-Pair card (820-0784-A) based on the DEC Tulip 21041. BeOS supports NICs with this chip and will see the Ethernet card as &#34;PCI&#34; (because of the Comm Slot II&#39;s PCI lines).

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjNN7gY_SXGSdtrH2Wnd8jqrR9c2zT8ihy-zqMljtUzQcEEMel6ML0sNKtRp7R0IJwztf6nPgyiB59CSiwpGDoOl-X8VfgFx0_Nbntwxu5ZMH_sIsIWUo3YwMtiNAlhj9j9YxYa02elLAubHJ7Cy-8HSrd2OrS4YNVSfWWJ4r1DKQOe2nM6VSZ4oiQs/s4080/IMG_20221209_094732.jpg"><img alt="" data-original-height="4080" data-original-width="3072" height="320" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjNN7gY_SXGSdtrH2Wnd8jqrR9c2zT8ihy-zqMljtUzQcEEMel6ML0sNKtRp7R0IJwztf6nPgyiB59CSiwpGDoOl-X8VfgFx0_Nbntwxu5ZMH_sIsIWUo3YwMtiNAlhj9j9YxYa02elLAubHJ7Cy-8HSrd2OrS4YNVSfWWJ4r1DKQOe2nM6VSZ4oiQs/s320/IMG_20221209_094732.jpg"/></a></p><p>

Parenthetically, the motherboard for these units is on a pull-out drawer (a single screw prevents irresponsible housemates from yanking on it, but I didn&#39;t bother putting the screw back in since a friction fit holds fine). Assuming you don&#39;t need to get deep into the chassis this makes installing RAM and cards very easy. This unit has the video input option but not the TV tuner option, which would go behind the plate on the top right. The motherboard ATI video is via a separate DA-15 connector above the serial number bar code in this view; the Twin Turbo is in the PCI slot not visible here. We&#39;ll come back to the logic board presently.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhWYsgMd222msTU-1qLumcIfzTnCLlYXzCvqcIJLYPlDjRC39xSqU4UzmnhTmjtBkqftp__Pg2vCS75lWuGwU3quYR-HWtMlFn-kkbYRBgMKPbSq1ktmSSI4KaYx4V5gyRkUGI1Gh8YXvtSz_uxwm7534EQJ6Q26DNEb_FHFWRDZ6kokQVbWmCvVi8X/s4080/IMG_20220904_141503.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhWYsgMd222msTU-1qLumcIfzTnCLlYXzCvqcIJLYPlDjRC39xSqU4UzmnhTmjtBkqftp__Pg2vCS75lWuGwU3quYR-HWtMlFn-kkbYRBgMKPbSq1ktmSSI4KaYx4V5gyRkUGI1Gh8YXvtSz_uxwm7534EQJ6Q26DNEb_FHFWRDZ6kokQVbWmCvVi8X/s320/IMG_20220904_141503.jpg" width="320"/></a></p><p>

BeOS needs a Mac OS partition to start the system (like MkLinux and A/UX). It can either be launched from a boot extension (the typical way) or from a launcher application in the Finder, which is also how you start the BeOS installer from CD. This puts the PowerPC back into supervisor mode, shuts down the Mac OS, and starts the BeOS kernel. The undocumented manner in which it achieves supervisor mode is not compatible with Mac OS 9, requiring 8.6 or lower (a better choice anyway without a G3 CPU). I partitioned it into two 1GB partitions, one to have a clean BeOS install as an emergency boot and one with a plain HFS (not HFS+) filesystem as an interchange volume since BeOS doesn&#39;t understand HFS+, plus a 4GB HFS+ partition for Mac OS and the rest for the main BeOS partition. Then I installed Mac OS 8.6.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiqmrrnhM4BaxlAdYJRErD6y6PWyi7Bjy37OVJtWM1zmZXpW3YRk2NuLQX2i07GclAudxnMeCyqom9I8LINiqkgzc_xCLuBM-caqpea7N3t1Mz3_qpu-H5vI-ftSejk55dSIP7u1BI3mP1kEvaAUyG8L6xUU0w5d_6bB4J5avkEx2kaLAx2FU5Qgrjy/s4080/IMG_20220904_145709.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiqmrrnhM4BaxlAdYJRErD6y6PWyi7Bjy37OVJtWM1zmZXpW3YRk2NuLQX2i07GclAudxnMeCyqom9I8LINiqkgzc_xCLuBM-caqpea7N3t1Mz3_qpu-H5vI-ftSejk55dSIP7u1BI3mP1kEvaAUyG8L6xUU0w5d_6bB4J5avkEx2kaLAx2FU5Qgrjy/s320/IMG_20220904_145709.jpg" width="320"/></a></p><p>

Mac OS booted and ran fine, including the startup bong and all system sounds, ahem, so next was installing the BeOS. Initially I used the BeOS R5 disc that came with my BeBox (this detail will be important shortly). Although the BeOS Launcher and OS Chooser extension seem to lack resource forks on the CD, they &#34;get fixed&#34; when you copy them over to the Mac. With the BeOS CD in, I started the BeOS Launcher from the Finder.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhasvn6HtCs101SZ7LoNORxAAvHh4RpvJNu5q8WUbRihl1-j3GCreuOKX3hsuo8hZAGdsE1nhLKjJ2kRpICsVqTksGcdwVarsmCFIJExbaubUB4B2O9JLHZEJWzwdmgnXYbmfvAt1Sh0q_Jq8BVXSUaLmzELwKOHPzrHiBvdEDCHs1pEWjp0X1t2qXn/s4080/IMG_20220904_145957.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhasvn6HtCs101SZ7LoNORxAAvHh4RpvJNu5q8WUbRihl1-j3GCreuOKX3hsuo8hZAGdsE1nhLKjJ2kRpICsVqTksGcdwVarsmCFIJExbaubUB4B2O9JLHZEJWzwdmgnXYbmfvAt1Sh0q_Jq8BVXSUaLmzELwKOHPzrHiBvdEDCHs1pEWjp0X1t2qXn/s320/IMG_20220904_145957.jpg" width="320"/></a></p><p>

The entire install with &#34;everything&#34; is just 225MB. Remember when that was a lot?

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEijzzY5ao8roZpQfERYMAGaAUPcT-xuR0HKuF3Z-qItTNOfBpsny1G5dT5faMAFNbZ_R9QrvCBP2AxVxmRZsj7Hm0XLewLXX-6ll26KbUpgvESRvyGJFPrl-ebGhnY7qeB5wyjf508enb_gGp5wG91QVC7xTWMIxu6GJOoMIHa9mbDdrDCQjywPeHiS/s4080/IMG_20221215_190548.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEijzzY5ao8roZpQfERYMAGaAUPcT-xuR0HKuF3Z-qItTNOfBpsny1G5dT5faMAFNbZ_R9QrvCBP2AxVxmRZsj7Hm0XLewLXX-6ll26KbUpgvESRvyGJFPrl-ebGhnY7qeB5wyjf508enb_gGp5wG91QVC7xTWMIxu6GJOoMIHa9mbDdrDCQjywPeHiS/s320/IMG_20221215_190548.jpg" width="320"/></a></p><p>

Selecting BeOS from the OS Chooser (the extension was not updated after R4.5).

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh2SY2dfjIB1bmgZ_BdyE4hEe9zrpaPjZ2fpDLcmDkelEb7XZIUq8X2oopvitfHv4JmJ7kr_F9JtFAld452eKPAnq61gqL7G1SV-2vqTDF-b0Q7dzDT-ISpJDv5AeCh7WgS1P0QJt6kUJFqAiDFTHPppNMG-AImFAv8w32GAfEB-oS_ysA6CJO6-1t_/s4080/IMG_20221215_190351.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh2SY2dfjIB1bmgZ_BdyE4hEe9zrpaPjZ2fpDLcmDkelEb7XZIUq8X2oopvitfHv4JmJ7kr_F9JtFAld452eKPAnq61gqL7G1SV-2vqTDF-b0Q7dzDT-ISpJDv5AeCh7WgS1P0QJt6kUJFqAiDFTHPppNMG-AImFAv8w32GAfEB-oS_ysA6CJO6-1t_/s320/IMG_20221215_190351.jpg" width="320"/></a></p><p>

And into the BeOS desktop. But as I clicked around and worked with the system a bit, there was something odd going on: it was silent. The Media preference showed what looked like standard Mac sound input and output, but it was absolutely mute. Even more odd was that when I tried to play even the </p><tt>BeBeep.wav</tt><p> and </p><tt>BeStartup.wav</tt><p> that came on the disc, Media Player complained it couldn&#39;t even decode the file.
</p><p>
I compared the decoders and extractors with the ones on my BeBox and they were the same and intact, since they both came from the same disc (the BeBox plays audio fine). I went ahead and updated the 6500 to <a href="gopher://gopher.floodgap.com/1/archive/be-power/os">BeOS 5.0.3</a>, and the installation was successful, but there was still no audio and still no functioning Media Player. I plugged in headphones in the front and back to see if there was any difference, and there was, but only slightly: with the headphones in the front jack, there was the tiniest pop in my ears when I muted and unmuted the sound output, so at least <em>something</em> was working. Someone <a href="https://twitter.com/xnupanic/status/1241135931089969153">on Twitter</a> had a similarly mute TAM, which is also a Gazelle board. However, my own TAM (with a 500MHz G3 L2 card) runs 9.2.2, so it wouldn&#39;t be able to boot the BeOS CD, and I had no interest in trying to set up a new drive and installation just for this. It seemed like there might be a way to make the internal speaker work.
</p><p>
Sound on pre-G3 Power Macs was generally based on some version of the AWACS (or AWAC, or AWACs, depending on document) chip, standing for Audio Waveform Amplifier and ConverterS (not to be confused with the <a href="https://en.wikipedia.org/wiki/Boeing_E-3_Sentry">military surveillance and command plane</a>). AWACS descends from the Singer chip used in later 68K Macintoshes and internally incorporates the Waveform Amplifier Chip, thus the name. It exposes a set of control registers and plays audio stored in various formats via DMA. By the time of the beige PCI Power Macs, the AWACS was hung off Grand Central I/O (not to be confused with <a href="https://en.wikipedia.org/wiki/Grand_Central">the stations</a> or <a href="https://en.wikipedia.org/wiki/Grand_Central_Dispatch">the later Apple programming technology</a>), which among other functions serviced interrupts and the system bus, and for AWACS handled its bus interfacing for DMA and PCI devices sending audio. The control registers are accessed through Grand Central&#39;s I/O range. Grand Central evolved into O&#39;Hare in later Power Macs (not to be confused with <a href="https://en.wikipedia.org/wiki/O%27Hare_International_Airport">the airport</a>), which was functionally identical but consolidated several other chips internally; AWACS proper, however, was still a separate IC and handled in the same fashion. AWACS and its supporting electronics remained relatively unchanged over the life of the Old World Power Macs until the beige G3&#39;s <a href="https://github.com/apple-oss-distributions/AppleOnboardAudio/blob/AppleOnboardAudio-256.2.5/AppleLegacyAudio/AppleOWScreamerAudio/AppleOWScreamerAudio.cpp">Screamer</a> chip, an upgraded AWACS with a new name (not to be confused with the horror movie with the letters E and R added at the end), which itself was replaced by a variety of successor chips in New World Macs.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzWgj5uTN5iiWYXZORcBzrbNjzRDfq-FreWy0E0YUV4vJUVm6B1518yDxvB-IZ22TzJqSKyJf9RpASMnSJTri0pFd5t3RQaaMK1mIZp51Y0bV1ZmReLFyrzoabJv_bTyihfV_2cnieno7SadLqG7KLEJey-qIKqnWHYVzFdsENXdCHrqeJGJOQEWO3/s4080/IMG_20220905_163420.jpg"><img alt="" data-original-height="4080" data-original-width="3072" height="320" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzWgj5uTN5iiWYXZORcBzrbNjzRDfq-FreWy0E0YUV4vJUVm6B1518yDxvB-IZ22TzJqSKyJf9RpASMnSJTri0pFd5t3RQaaMK1mIZp51Y0bV1ZmReLFyrzoabJv_bTyihfV_2cnieno7SadLqG7KLEJey-qIKqnWHYVzFdsENXdCHrqeJGJOQEWO3/s320/IMG_20220905_163420.jpg"/></a></p><p>

The 6500/275 logic board looks like this with the Twin Turbo video card removed. The two RAM DIMMs and the L2 cache DIMM are at the top and the 603e is under the active cooler in the centre with the ATI 3D Rage II GPU to its right. The solder pads south of the L2 cache DIMM were for a ROM socket which is not in production models; the actual ROMs are south of that. The velcro pad is for the 4.5V PRAM battery (Ray-O-Vac 840 or equivalent) which is not needed to boot, and can easily be replaced with the equivalent number of AA batteries.
</p><p>
AWACS on the 6500 is the small IC in the lower left corner. It is generally marked 343S0140 or 343S0150; this one is 343S0150-B (National Semiconductor part# S9706AL). The O&#39;Hare I/O chip is the big Lucent IC above it marked 343S0172.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJUx1wFJvls3pH-zGxELc-Phcs5hJJBkh8ytcKrvyuRDettKsaDsfMNhVje8A40FahAsDHzTmtF9v7YkFNbvK1wM1NTt9op6jdoMUS9K08MtEyv-tMn1OGDTUlbvrYfAxXuNsctX_-gs6xvKAP95tUp2UNmS-Ge1jX8PiBToLFM62FntkD2ilcHXfq/s4080/IMG_20220905_165858.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJUx1wFJvls3pH-zGxELc-Phcs5hJJBkh8ytcKrvyuRDettKsaDsfMNhVje8A40FahAsDHzTmtF9v7YkFNbvK1wM1NTt9op6jdoMUS9K08MtEyv-tMn1OGDTUlbvrYfAxXuNsctX_-gs6xvKAP95tUp2UNmS-Ge1jX8PiBToLFM62FntkD2ilcHXfq/s320/IMG_20220905_165858.jpg" width="320"/></a></p><p>

On the back side of the logic board the largest chip is the 343S0065-01 PSX+, marked with a Texas Instruments logo. This is the CPU-PCI bridge chip (the processor bus runs at 50MHz, but the PCI bus runs at 33MHz), and also provides control and timing signals for system cache, ROM, and RAM. The memory control logic supports byte, word, longword and burst accesses to system memory, and can translate unaligned memory accesses into equivalent multiple bus transfers. A mystery chip at the top left is the Orbit chip (343S0014), but its location near the slot for the video input card on the other side suggests it might serve as its bus interface. There are solder pads for motherboard RAM but obviously no RAM is present.
</p><p>
BeOS on x86 has lots of sound card support, but there are just two drivers on PowerPC BeOS, namely AWACS and S3 Sonic Vibes (yes, that S3, the graphics chip makers). Since AWACS wasn&#39;t working, my first attempt was to locate an S3 Sonic Vibes PCI card and put it in. Mac OS didn&#39;t use it and neither did BeOS. Later I found out that this is because it was only designed for the BeBox (which doesn&#39;t have an AWACS) and requires kernel support for the joystick port, which the Power Mac kernel doesn&#39;t have.
</p><p>
After spinning my wheels with that and fruitless fiddling with settings, I heard from another 6500 owner with a 250MHz CPU whose audio seemed to work just fine. However, they used the Gobe 5.0.3 Professional Edition CD (the PowerPC version was never available in the free Personal Edition format). This has different media add-ons than the BeBox release I was using.
</p><p>
Having nothing to lose, I went ahead and wiped the BeOS partitions and installed the Gobe version of BeOS 5.0.3. Amazingly, the new decoders actually did <em>try</em> to play stuff now, but the 6500 was still silent ... until I listened with headphones again. The audio was scratchy and awful, but it was recognizable! It was at the right speed, so the sample rate was right, and it was recognizable <em>enough</em> that it probably wasn&#39;t a sample size or endianness issue. This suggested that the problem wasn&#39;t DMA but rather in the way the BeOS AWACS driver was controlling the sound output.
</p><p>
Classic AWACS has five registers (Screamer has eight). I should note for this discussion before anyone under an Apple NDA starts hyperventilating that all of this can be derived from existing open source descriptions such as <a href="https://github.com/torvalds/linux/tree/master/sound/ppc">the Linux AWACS driver</a> or even <a href="https://github.com/apple-oss-distributions/AppleOnboardAudio/tree/AppleOnboardAudio-256.2.5/AppleLegacyAudio">Apple&#39;s own drivers</a>. In beige PCI Power Macs these registers are part of Grand Central/O&#39;Hare&#39;s address range with 16-byte alignment. The control register (0) handles gain, input and subframe control; AWACS supports up to four subframes of audio. The codec control register (1) sets sample rates and outputs, the codec status register (2) provides chip status on reads such as identifiers and the state of the headphone jack, and on writes line out and headphone (output &#34;A&#34;) channel volumes, the clipping count register (3) provides the number of clipping events that occurred and the output attenuation control register (4) sets channel volumes for the internal speaker (output &#34;C&#34;) plus bits for controlling byteswapping of sample data in later versions.
</p><p>
I went with <a href="https://github.com/torvalds/linux/blob/master/sound/ppc/awacs.c">the Linux AWACS driver</a> as a model since it has specific support for beige Power Macs, but it does a lot of messing around on its Power Mac 5500 specific path. After puzzling over this for awhile, it dawned on me that this was all irrelevant for BeOS, since it handles its own mixers rather differently. Most likely we wanted to look at how the AWACS driver writes to either registers 1 or 4, since those control outputs and the internal speaker levels.
</p><p>
To make sure we were still dealing with a &#34;real&#34; AWACS and that Apple hadn&#39;t snuck in a differently behaving part, the first order of business was to actually identify what was there and see if this triggered different codepaths in Linux. At this point I altered the BeOS AWACS driver binary to emit the manufacturer and revision. When <a href="https://www.haiku-os.org/legacy-docs/benewsletter/Issue4-30.html">classic BeOS debug mode</a> is turned on, this (and other debugging output) is sent out the serial port at 19200bps 8N1. Since we have already removed the 6500&#39;s modem and the serial port is thus no longer locked out, I popped out its factory-shipped plug and got a Mac printer cable out from the box of junk (the beige Mac equivalent of a null modem cable).

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjLPN6EdqDBROoAItysr54scqiNC0XvQI4wF6TzMTQc71KiEYepC0AzfzegnSasA2sq0iyWHGkPXezEe2mdhYwPJYi1x9s93oDix-yzv4yO6kIvzvBst8Z24ruzwavBnuE4laHQh3ZtTN721hDmFdGe-cff9fIONse8GJnvDGTyktP9-FX5PNf8fbKp/s4080/IMG_20221208_194127.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjLPN6EdqDBROoAItysr54scqiNC0XvQI4wF6TzMTQc71KiEYepC0AzfzegnSasA2sq0iyWHGkPXezEe2mdhYwPJYi1x9s93oDix-yzv4yO6kIvzvBst8Z24ruzwavBnuE4laHQh3ZtTN721hDmFdGe-cff9fIONse8GJnvDGTyktP9-FX5PNf8fbKp/s320/IMG_20221208_194127.jpg" width="320"/></a></p><p>

Our sidecar terminal will be <a href="https://oldvcr.blogspot.com/2022/10/refurb-weekend-powerbook-1400.html">the recently refurbished PowerBook 1400</a> running ZTerm. To start the BeOS kernel in debug mode, we hold down Delete on the keyboard until we start seeing output (but not so long that the Mac goes into the boot device menu).

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghi_4blyPjh_HzIxJu1Lc3MbOW1VXvGkenDrCAr3V1aINgpqdDx48ER8XfB8UqmEQPVzjnKA-0SgziLbqmT_sJHQKggnXx_3YU88ab7LOQYPAF3dIfzv4Q6OH4wuDcYWztbD7UGNbdC-4V-pDtLhcYyny3-vSXqDT0RygkfNbJXrgdkeofoBl3JlpK/s4080/IMG_20221208_203457.jpg"><img alt="" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghi_4blyPjh_HzIxJu1Lc3MbOW1VXvGkenDrCAr3V1aINgpqdDx48ER8XfB8UqmEQPVzjnKA-0SgziLbqmT_sJHQKggnXx_3YU88ab7LOQYPAF3dIfzv4Q6OH4wuDcYWztbD7UGNbdC-4V-pDtLhcYyny3-vSXqDT0RygkfNbJXrgdkeofoBl3JlpK/s320/IMG_20221208_203457.jpg" width="320"/></a></p><p>

The traceback shows this to be a manufacturer 2 and revision 2 (both values are stored in register 2). I don&#39;t know what that refers to exactly, but it proves the BeOS driver loads and neither is a value the Linux driver seems to be looking for, suggesting any oddity about the chip is external to it. There are other values the Linux driver checks for but these appear to be derived from Open Firmware properties and there&#39;s no obvious facility in the driver binary to do that, so I started taking a few shots in the dark.
</p><p>
My first attempt was another hack to the BeOS AWACS driver to show what values were being passed into the routine that sets register 4. Register 4 controls the channel volumes for output &#34;C&#34; which is the internal speaker. That came up with normal appearing values and hacking it to force it to a particular value, even the maximum amplitude, didn&#39;t make any sound. For obvious reasons I reverted this.
</p><p>
My second attempt was to look at how the BeOS AWACS driver initialized the chip. The Linux driver has a comment that &#34;looks like <tt>MASK_GAINLINE</tt> triggers something, so we set here as start-up&#34; [sic]. I changed the initial value the BeOS AWACS driver pushes to register 0 to be exactly what the Linux driver does. It sounded a bit better in the headphones, maybe placebo effect, but the speaker was still silent. I kept it anyway because it was probably more correct than what was there previously. While snooping around what sets register 0 I also found a bug that set the mic gain wrong and fixed that too, though obviously that wasn&#39;t the problem I was trying to fix.
</p><p>
My third attempt was to look at the outputs when it set register 1. There are two bits that the Linux driver marks as &#34;Parallel Out (???)&#34; and &#34;Parallel Out (enable speaker).&#34; Those notations make it sound suspiciously like a third output, but the BeOS AWACS driver doesn&#39;t ever set them, potentially explained by this comment in the Linux AWACS driver: &#34;Only machines with external SRS module need <tt>MASK_PAROUT</tt>.&#34; Well, <em>we</em> have SRS audio â€” maybe the whole problem is we&#39;re one of those systems with an external SRS module. So everywhere that set register 1 (except for muting everything when the driver shuts down), I made it set the parallel output bits. Bam! The speaker works! The best part is, because the BeOS mixer handles outputs manually (e.g., plugging in the headphones does not automatically mute the speaker), muting worked without having to squeeze in any code to read the state of the headphone jack.
</p><p>
Now our remaining problem is the audio quality. On my BeBox I have Real-Time Audio enabled in the BeOS Media preference because that really helps on its much slower CPUs (it does have plenty of memory, after all), and I had set it here expecting the audio to similarly improve. Spoiler alert: for reasons unclear to me, this option makes the audio <em>worse</em> on the 6500, possibly other Power Macs. In fairness, the Media preference says you shouldn&#39;t turn it on unless you absolutely need the lowest-latency audio possible, and indeed on my long list of things I do not need is low-latency audio that sounds like an emasculated chainsaw.
</p><p>
This improvement was nevertheless not nearly enough for my tender discriminating ears. Remember that we have SRS audio. SRS audio can be turned off from the Monitors &amp; Sound control panel in Mac OS:

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbx7IUHty_GuQUDTFdx_TsRWCAIoOXjKrwbxUHOsUyVgxu5hvIDouQanSQ5sgftNj5YmXKJo0wwFPgZxUxv4CDvwpUkH-waPy5r4cTKHtv-tVPICbOyDSjQTlXEuVkIfMbse1V7niULNG-cS-5Ss5oTl9Jppu15wGQXGzUKPTCsiWLB2YJIyNNUOiL/s1024/srsoff.png"><img alt="" data-original-height="768" data-original-width="1024" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbx7IUHty_GuQUDTFdx_TsRWCAIoOXjKrwbxUHOsUyVgxu5hvIDouQanSQ5sgftNj5YmXKJo0wwFPgZxUxv4CDvwpUkH-waPy5r4cTKHtv-tVPICbOyDSjQTlXEuVkIfMbse1V7niULNG-cS-5Ss5oTl9Jppu15wGQXGzUKPTCsiWLB2YJIyNNUOiL/s320/srsoff.png" width="320"/></a></p><p>

I did that, and the audio got even clearer. (Maybe something to consider for your 6400 with scratchy audio too?) This setting sticks because BeOS requires Mac OS to boot first and SRS gets turned off as part of the boot process.
</p><p>
But it still wasn&#39;t clear enough! There are two parallel output bits. I tried setting the &#34;???&#34; bit and got no output, but (naturally) &#34;enable speaker&#34; worked, and sounded a little clearer still.
</p><p>
And, well, that&#39;s as far as I could go at this point. The audio is much less scratchy and definitely listenable, but it&#39;s that last little bit that was still bedeviling me. We know the caps are good because they were (unnecessarily) replaced. We know the chip is fine because audio is fine in Mac OS. But bouncing the media server up and down (by restarting it from the Media preference) does, if you hit it right, yield perfectly clean output.
</p><p>
I don&#39;t have a theory for why this is. If the media server were being starved for data, you would expect Real-Time Audio to make the problem better, not worse. If it were a problem with clipping or overdriving, it should be consistent at certain volume levels, whereas even if you crank down the audio to barely audible you can <em>still</em> hear cracks and pops now and then. Oh well! With this hacked driver I now have audio on the built-in speaker! I (mostly) win!
</p><p>
At some point I&#39;d like to dig into the media server and get the output even nicer. It&#39;s still possible it could be another driver issue yet to be discovered, though since the BeBox can also sound scratchy and the Power Mac can sound perfect, I&#39;m not entirely convinced the driver is further at fault at this point.

</p><p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzbdmpPsiXYSTCzcg5NmuHnlR2nQsZFuG9HPScgfSSpwjy-Xb15xI3qkow2v_g7rVX1bHRgFfz4W9QCz7wu4deiG9xb-k42Xnq0UDorePc1rGjJn-Cv18Sf5XChlyqF9ThrHJFHjf7pCnp3vNwbAZxqxaVSVb90pwGnAfahZz6oXiT6o0Jt3f4qyE6/s1024/beboz.png"><img alt="" data-original-height="768" data-original-width="1024" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzbdmpPsiXYSTCzcg5NmuHnlR2nQsZFuG9HPScgfSSpwjy-Xb15xI3qkow2v_g7rVX1bHRgFfz4W9QCz7wu4deiG9xb-k42Xnq0UDorePc1rGjJn-Cv18Sf5XChlyqF9ThrHJFHjf7pCnp3vNwbAZxqxaVSVb90pwGnAfahZz6oXiT6o0Jt3f4qyE6/s320/beboz.png" width="320"/></a></p><p>

As our theme music plays over the closing credits (with a minimum of distortion), what have we learned?
</p><ul>
<li>There appears to be a difference with later 6500s (and other Gazelle systems, presumably) where the internal speaker goes through the AWACS&#39; parallel output. If the Linux driver&#39;s comments are accurate, this is because they have an external SRS module. This is different from the 5400, 6360, 6400 and earlier 5500s, 6500s and TAMs.
</li><li>BeOS may not handle systems with SRS audio correctly. Turn it off from Mac OS if you have bad sound.
</li><li>BeOS&#39; Real-Time Audio is not a panacea on Power Macs. Turn it off if you have bad sound.
</li><li>Scratchy audio can just as easily be software as it can be capacitors. Prophylactically replacing capacitors not proven to be defective runs the risk of wrecking your logic board, even if that risk is small in the hands of someone experienced with soldering. Why not rule out other problems first instead?
</li></ul>
<p>
The AWACS 6500 BeOS driver is a hacked version of a BeOS system driver. It is issued without the
permission of ACCESS Co., Ltd., the current owners of the intellectual
property of the former Be, Inc. and the Be Operating System, who retain any
residual unexpired copyright, trademarks and patents upon it. This driver is
offered in binary format only and its public availability in no way implies
the tacit, implicit or explicit approval of ACCESS Co., Ltd. of its use or
distribution. Your use of this driver accepts all potential legal
eventualities for doing so, however remote or unlikely, and that THERE
IS NO WARRANTY, NOT EVEN AN IMPLIED WARRANTY, OF MERCHANTABILITY OR FITNESS
FOR A PARTICULAR PURPOSE. YOU USE THIS DRIVER AT YOUR OWN RISK.
</p><p>
The AWACS 6500 BeOS driver is available <a href="gopher://gopher.floodgap.com/9/archive/be-power/os/awacs-6500.zip">via Gopher at Be-Power</a>, or see more <a href="gopher://gopher.floodgap.com/1/archive/be-power">PowerPC-compatible BeOS software</a>. Be sure to <a href="gopher://gopher.floodgap.com/0/archive/be-power/os/awacs-6500.txt">read the instructions</a> before installing!
</p>
</div></div>
  </body>
</html>
