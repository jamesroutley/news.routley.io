<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.praetorian.com/blog/spring-core-jdk9-rce/">Original</a>
    <h1>Spring Core on JDK9 is vulnerable to remote code execution</h1>
    
    <div id="readability-page-1" class="page"><div><div><h2 data-node-type="line">Overview</h2><p id="magicdomid4" data-node-type="line"><span>Spring Core on JDK9+ is vulnerable to remote code execution due to a bypass for </span><span><a href="http://blog.o0o.nu/2010/06/cve-2010-1622.html" target="_blank" rel="nofollow noopener noreferrer" data-attrib-id="MTY0ODY1NzIwMTg4Ni1odHRwOi8vYmxvZy5vMG8ubnUvMjAxMC8wNi9jdmUtMjAxMC0xNjIyLmh0bWw=">CVE-2010-1622</a></span><span>. At the time of writing, this vulnerability is unpatched in Spring Framework and there is a public proof-of-concept</span><span> available</span><span>. </span><span>As we have remediation advice for customers (see below), we have elected to share this information publicly. </span></p><p id="magicdomid6" data-node-type="line"><span>Spring Core is</span><span> a </span><span>very </span><span>popular Java framework for building modern Java web applications.</span><span> </span></p><p id="magicdomid8" data-node-type="line"><span>In certain configurations, exploitation of this issue is straightforward, as it only requires an attacker to send a crafted HTTP request to a vulnerable system. However, exploitation of different configurations will require the attacker to do additional research to find payloads that will be effective.</span></p><p id="magicdomid10" data-node-type="line"><span>This vulnerability allows an unauthenticated attacker to execute arbitrary code on the target system.</span></p><p id="magicdomid84" data-node-type="line"><span>As part of our <a href="https://www.praetorian.com/chariot/">Chariot</a> offering, we carefully monitor OSINT sources for news of potential new vulnerabilities. Based on these sources, Praetorian began research</span><span> on March 29th to determine the bypass mechanism and exploit conditions. Exploitation requires an endpoint with DataBinder enabled (e.g. a POST request that decodes data from the request body automatically) and depends heavily on the servlet container for the application. For example, when Spring is deployed to Apache Tomcat, the WebAppClassLoader is accessible, which allows an attacker to call getters and setters to ultimately write a malicious JSP file to disk. However, if Spring is deployed using the Embedded Tomcat Servlet Container the classloader is a LaunchedURLClassLoader which has limited access.</span><span> </span></p><p id="magicdomid14" data-node-type="line"><span>We have disclosed full details of our exploit to the Spring security team, and are holding off on publishing more information until a patch is in place. </span></p><h2 id="magicdomid16" data-node-type="line"><span>Remediation</span></h2><p id="magicdomid18" data-node-type="line"><span>In Spring Framework, DataBinder has functionality to disallow certain patterns. As a temporary mitigation for this vulnerability, Praetorian recommends creating a </span><span>ControllerAdvice</span><span> component (which is a Spring component shared across Controllers) and adding dangerous patterns to the denylist. An example snippet is shown below:</span></p><pre id="magicdomid21" data-node-type="line"><span>import org.springframework.core.Ordered;</span>

<span>import org.springframework.core.annotation.Order;</span>

<span>import org.springframework.web.bind.WebDataBinder;</span>

<span>import org.springframework.web.bind.annotation.ControllerAdvice;</span>

<span>import org.springframework.web.bind.annotation.InitBinder;</span>




<span>@ControllerAdvice</span>

<span>@Order(</span><span>10000</span><span>)</span>

<span>public class BinderControllerAdvice {</span>

<span>    @InitBinder</span>

<span>    public void setAllowedFields(WebDataBinder dataBinder) {</span>

<span>         String[] denylist = new String[]{&#34;class.*&#34;, &#34;Class.*&#34;, &#34;*.class.*&#34;, &#34;*.Class.*&#34;};</span>

<span>         dataBinder.setDisallowedFields(denylist);</span>

<span>    }</span>

<span>}</span></pre></div></div></div>
  </body>
</html>
