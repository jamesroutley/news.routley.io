<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.maximeheckel.com/posts/post-processing-as-a-creative-medium/">Original</a>
    <h1>Post-Processing Shaders as a Creative Medium</h1>
    
    <div id="readability-page-1" class="page"><div><div><p>Spending the better part of 2024 learning new shader techniques and concepts through the lens of post-processing has been the spark I needed to come up with ever more intricate, detailed, and ambitious creative work.
Not only do I now know the inner workings of specific styles like <a href="https://blog.maximeheckel.com/posts/moebius-style-post-processing/">Moebius</a>, <a href="https://blog.maximeheckel.com/posts/on-crafting-painterly-shaders/">Painting</a>, or <a href="https://blog.maximeheckel.com/posts/the-art-of-dithering-and-retro-shading-web/">Retro</a>, but it also got me to a point where I strengthened the many shader mental models
I built along the years enough to experiment with new styles that I see online or that I envision in my mind.</p>
<p>That led me on a sort of <em>creative spree</em> for the past few months that originated from many creative developers, artists, and designers on Bluesky and Twitter such as: <a href="https://twitter.com/dghez_">
@dghez_</a>, <a href="https://twitter.com/Polygon1993">Polygon1993</a>, <a href="https://twitter.com/darkroomdevs">@darkroomdevs</a>, <a href="https://twitter.com/hahajohnx">@hahajohnx</a>, <a href="https://twitter.com/samdape">@samdape</a>, <a href="https://27-b.com">27-b</a> (and many others sources listed throughout this article),
whose works have, quite frankly, nerd-sniped me into reproducing or expanding
their ideas into stylized shaders. Whether those featured <strong>complex pixelated
patterns, trompe l&#39;oeil, optical illusions, or surprising interactions</strong>, transcribing their art
styles into shaders allowed me to not only sharpen my shader skills but also experiment with combining those effects in unique ways.</p>
<figure></figure>
<p>Through this process, I collected a few new shading tricks in my toolbox to share with you and, more importantly, new ways to reuse what I had learned in previous years in a new context.
This is the reason why I wanted to write this article. In it, you&#39;ll see the many sources of inspiration that led to those beautiful post-processing effects, my train of thought to re-implement them, and the full-on recipe behind them so you can reproduce them, expand them, or simply get inspired to create your own.</p>


<section id="intricate-pixel-patterns-section"><h2 id="intricate-pixel-patterns"><a href="#intricate-pixel-patterns" aria-hidden="true" tabindex="-1"><span></span></a>Intricate Pixel Patterns</h2>
<p>I already explored <strong>pixelation</strong> in <a href="https://blog.maximeheckel.com/posts/the-art-of-dithering-and-retro-shading-web/">The Art of Dithering and Retro Shading for the Web</a> where I introduced it alongside color quantization and dithering as it was a necessary effect to achieve a &#34;retro style&#34; akin to old video games on CRT displays.</p>
<p>However, this time I want to go beyond that and show you some of the many effects you can craft with this technique by literally <em>sculpting pixels</em> and creating intricate and elaborate patterns.</p>
<h3 id="pixelating-your-scene"><a href="#pixelating-your-scene" aria-hidden="true" tabindex="-1"><span></span></a>Pixelating your scene</h3>
<p>As a reminder, let&#39;s re-examine the code that I used and still use to this day for all my pixelation work:</p>
<div><div><p data-testid="codesnippet-title">Sampling and pixelating a texture</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uvPixel </span><span data-testid="content-line">=</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> uvPixel</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We first define a <code>pixelSize</code> as the number of pixels in height or width we want in a single <strong>&#34;new pixel&#34;</strong> for our final render/sampling. I tend to keep those as powers of 2: <code>1, 2, 4, 8, 16, ...</code></p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We then <em>normalize</em> the <code>pixelSize</code> based on the resolution, which gives us the size of a single pixel in &#34;UV coordinates&#34; (ranging <code>[(0, 0), (1, 1)]</code>). This is necessary to keep our <strong>&#34;new pixels&#34;</strong> square no matter the window size.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We define a grid of cells by dividing our UV coordinates by the <code>normalizedPixelSize</code>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Adding the <code>floor</code> creates the <code>block</code> effect: the UV coordinates no longer vary smoothly across the screen but instead jump between fixed points.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Finally, we multiply by the <code>normalizedPixelSize</code> to convert the grid of cells to UV coordinates.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We can then use our newly mapped UV coordinates to sample our texture.</p></li>
</ol>
<p>If this formula still feels overwhelming, the best is to break it down with an example:</p>
<div><div><p data-testid="codesnippet-title">Breakdown of pixelation code</p></div><pre><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">resolution = vec2(800, 600)    // Screen size in pixels</span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">pixelSize = vec2(8, 8)         // We want 8x8 pixel blocks</span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">uv = vec2(0.374, 0.567)        // Current texture coordinate</span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">1. Calculate the size of each pixel block in normalized coordinates (0 to 1)</span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line">normalizedPixelSize = (8, 8) / (800, 600) = (0.01, 0.0133)</span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">2. Snap the UV coordinate to the nearest pixel block grid</span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line">floor(uv / normalizedPixelSize) = floor((0.374, 0.567) / (0.01, 0.0133))</span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">                                = floor((37.4, 42.6)) = (37, 42)</span></span></p></div><div data-testid="line"><p>14</p><p><span><span data-testid="content-line">Then multiply back by normalizedPixelSize</span></span></p></div><div data-testid="line"><p>15</p><p><span><span data-testid="content-line">uvPixel = (0.37, 0.559)</span></span></p></div></pre></div>
<p>I also built the widget below for you to <em>see</em> what happens when you apply this code to a texture/scene:</p>
<div><div><div><p><span>0.0<!-- -->,<!-- -->1.0</span></p><p><span>1.0<!-- -->,<!-- -->1.0</span></p><p><span>0.0<!-- -->,<!-- -->0.0</span></p><p><span>1.0<!-- -->,<!-- -->0.0</span></p></div><p><label for="pixelation"><span>Pixelation:<!-- --> </span></label></p></div></div>

<h3 id="shaping-pixels"><a href="#shaping-pixels" aria-hidden="true" tabindex="-1"><span></span></a>Shaping pixels</h3>
<p>We could leave our pixelated output as such, but squares quickly get boring. Moreover, our cells have a lot of pixels we can use to draw interesting patterns, or even better, <em>sculpt</em> any shape we may want.</p>
<p>I saw this very cool <a href="https://sams-receipt.vercel.app">Japanese receipt website</a> made by <a href="https://twitter.com/samdape">@samdape</a> last month, and I liked it so much that <a href="https://r3f.maximeheckel.com/receipt">I recreated this pattern</a> as a post-processing effect. I not only wanted it to work on top of everything and be dynamic but also thought
it would be a great first example for this article, as it&#39;s an easy effect to break down with a lovely/original output.</p>
<div><div><div><p><a href="https://twitter.com/samdape" target="_blank" rel="noopener noreferrer"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2746%27%20height=%2746%27/%3e"/></span><img alt="samdape" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></a></p></div><a href="https://twitter.com/samdape/status/1864642635652075694" target="_blank" rel="noopener noreferrer" aria-label="@samdape&#39;s Twitter profile"><svg viewBox="328 355 335 276" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M 630, 425    A 195, 195 0 0 1 331, 600    A 142, 142 0 0 0 428, 570    A  70,  70 0 0 1 370, 523    A  70,  70 0 0 0 401, 521    A  70,  70 0 0 1 344, 455    A  70,  70 0 0 0 372, 460    A  70,  70 0 0 1 354, 370    A 195, 195 0 0 0 495, 442    A  67,  67 0 0 1 611, 380    A 117, 117 0 0 0 654, 363    A  65,  65 0 0 1 623, 401    A 117, 117 0 0 0 662, 390    A  65,  65 0 0 1 630, 425    Z" style="fill:#3BA9EE"></path></svg></a></div><p>saw this japanese receipt laying around &amp;amp; turned it into my website ðŸŒ€

https://t.co/TfdoXlNIb9 

from idea to live in ~3h with @figma &amp;amp; @v0 https://t.co/lHniV7Lezo</p></div>
<p>Here is how I interpreted this effect by just looking at the screenshots of Sam&#39;s website:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We have a pretty blocky-looking output, so we&#39;ll need to pixelate our <code>inputBuffer</code> by quite a bit.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Each cell is composed of horizontal black <em>bars</em>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The darker the area, the longer the bar.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The lighter the area, the shorter the bar (or no bar).</p></li>
</ul>
<p>With this in mind, we can leverage the pixelation formula we dissected just above and the <code>luma</code> of a given pixel to build this <em>receipt effect</em>.</p>
<figure><p><img alt="Diagram showcasing the bar pattern rendered on each cell based on the luma" loading="lazy" width="700" height="702" decoding="async" data-nimg="1" sizes="(max-width: 768px) 120vw, 75vw" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=640,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 640w, https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 750w, https://images.maximeheckel.com/cdn-cgi/image/width=828,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 828w, https://images.maximeheckel.com/cdn-cgi/image/width=1080,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 1080w, https://images.maximeheckel.com/cdn-cgi/image/width=1200,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 1200w, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 1920w, https://images.maximeheckel.com/cdn-cgi/image/width=2048,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 2048w, https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png 3840w" src="https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Bar_Pattern.png"/></p><figcaption>Diagram showcasing the bar pattern rendered on each cell based on the luma</figcaption></figure>
<div><div><p data-testid="codesnippet-title">Receipt Bar fragment shader</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainImage</span><span data-testid="content-line">(</span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> inputColor</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">out</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> outputColor</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> rowIndex </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uvPixel </span><span data-testid="content-line">=</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> uvPixel</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>8</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> luma </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.2126</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.7152</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0722</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>10</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> lineWidth </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>41</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">if</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">cellUV</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">&gt;</span><span data-testid="content-line"> yStart </span><span data-testid="content-line">&amp;&amp;</span><span data-testid="content-line"> cellUV</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> yEnd </span><span data-testid="content-line">&amp;&amp;</span><span data-testid="content-line"> cellUV</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">&gt;</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line"> </span><span data-testid="content-line">&amp;&amp;</span><span data-testid="content-line"> cellUV</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">&lt;</span><span data-testid="content-line"> lineWidth</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>42</p><p><span><span data-testid="content-line">    color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>44</p><p><span><span data-testid="content-line">    color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line">(</span><span data-testid="content-line">0.70</span><span data-testid="content-line">,</span><span data-testid="content-line">0.74</span><span data-testid="content-line">,</span><span data-testid="content-line">0.73</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>One thing that we should highlight in the code snippet above is this line:</p>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>It returns the <code>cellUV</code> coordinates ranging again from <code>[(0, 0), (1, 1)]</code>, giving us the relative position of a given pixel within each cell. This is the &#34;magic line&#34; that allows us to <em>step inside</em> each cell
and start shaping and sculpting them the way we want. In this specific case, we are conditionally turning the pixels within each cells black or white based on the <code>lineWidth</code> that&#39;s defined through the <code>luma</code> of the pixelated texture.</p>
<p>We will use similar techniques to define many patterns, some of which are depicted in the widget below which uses a similar principle to display those features:</p>
<div><div><div><p><span>0.0<!-- -->,<!-- -->1.0</span></p><p><span>1.0<!-- -->,<!-- -->1.0</span></p><p><span>0.0<!-- -->,<!-- -->0.0</span></p><p><span>1.0<!-- -->,<!-- -->0.0</span></p></div></div></div>
<p>Thanks to both the pixelation formula and this use of the <code>fract</code> glsl function, we established what is to me the two main pillars that we&#39;re going to keep encountering in most post-processing shaders:</p>
<ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><strong>Remapping or distorting the UV coordinates</strong></p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><strong>Shape, sculpt, or tweak each cell individually to create a pattern</strong></p></li>
</ol>
<p>Both of these points are at work in the receipt effect in the demo below:</p>

</section><section id="trompe-lÅ“il-and-other-optical-illusions-section"><h2 id="trompe-lÅ“il-and-other-optical-illusions"><a href="#trompe-lÅ“il-and-other-optical-illusions" aria-hidden="true" tabindex="-1"><span></span></a>Trompe l&#39;Å“il and other optical illusions</h2>
<p>Mimicking close to real life/physical textures and effects is my favorite thing to achieve with post-processing. With a few simple techniques, we can make our output appear to have depth, texture, and lighting. Applied right, these techniques can transform our scenes, making them appear as if they were made out of Legos or woven like Crochet, to look like they are displayed on an LED panel or behind a slick pane of frosted glass.</p>
<p>This section goes through the details behind a few of my favorite post-processing effects that I came up with recently.
We&#39;ll dissect each technique used, and see how combining them and tweaking them the right way can yield beautiful <a href="https://en.wikipedia.org/wiki/Trompe-l&#39;%C5%93il">trompe l&#39;oeil</a> or optical illusion effects running right in your browser.</p>
<h3 id="stagged-led-cell-panel"><a href="#stagged-led-cell-panel" aria-hidden="true" tabindex="-1"><span></span></a>Stagged LED cell panel</h3>
<p>This section features the technique behind my <a href="https://r3f.maximeheckel.com/pixel-statue">Pixel Statue demo</a>, which aimed to mimic a staggered LED cell panel. I was originally inspired by the many LED panels I saw during my recent trip to Japan, whether used on trains or in public spaces to display ads.</p>
<p>The main trick for this scene is to <strong>stagger our cells</strong>, and eventually pixels within our cells, to create a more elaborate LED cell matrix. This is done by offsetting the UV coordinates <em>before</em> remapping them.</p>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> maskStagger </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> coord </span><span data-testid="content-line">=</span><span data-testid="content-line"> uv</span><span data-testid="content-line">/</span><span data-testid="content-line">normalizedPixelSize</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>6</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> columnStagger </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">coord</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> maskStagger</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>9</p><p><span><span data-testid="content-line">offsetUV</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">+=</span><span data-testid="content-line"> columnStagger </span><span data-testid="content-line">*</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uvPixel </span><span data-testid="content-line">=</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">offsetUV </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>This specific code adds an arbitrary vertical offset to every odd column of cells.</p>
<figure><div tabindex="0" role="slider" aria-label="Comparing the simple pixelated output with the staggered one" aria-valuemin="0" aria-valuemax="100" aria-valuenow="50"><p><img alt="Before" loading="eager" width="700" height="478" decoding="async" data-nimg="1" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel.png 1x, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel.png 2x" src="https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel.png"/></p><p><img alt="After" loading="eager" width="700" height="478" decoding="async" data-nimg="1" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel-stagger.png 1x, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel-stagger.png 2x" src="https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel-stagger.png"/></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Comparing the simple pixelated output with the staggered one</figcaption></figure>
<p>Yet, we can push things further and introduce offsets at the <em>&#34;sub-cell level&#34;</em> to create an even more intricate effect. We could, for instance, split our cell into three <strong>sub-cells</strong> as we did for the CRT effect in my Dithering article and stagger each of those sub-cells.</p>
<div><div><p data-testid="codesnippet-title">Defining sub-pixels with offset</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> coord </span><span data-testid="content-line">=</span><span data-testid="content-line"> uv</span><span data-testid="content-line">/</span><span data-testid="content-line">normalizedPixelSize</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> columnStagger </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">coord</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> maskStagger</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>6</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> subcoord </span><span data-testid="content-line">=</span><span data-testid="content-line"> coord </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">3</span><span data-testid="content-line">,</span><span data-testid="content-line">1</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>7</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> subPixelIndex </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">subcoord</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">3.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>8</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> subPixelStagger </span><span data-testid="content-line">=</span><span data-testid="content-line"> subPixelIndex </span><span data-testid="content-line">*</span><span data-testid="content-line"> maskStagger</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>11</p><p><span><span data-testid="content-line">offsetUV</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">+=</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">columnStagger </span><span data-testid="content-line">+</span><span data-testid="content-line"> subPixelStagger</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>Once we remap those staggered UVs, it will look as if you cut each of the cells into three vertical thin slices that you can manipulate at will.</p>
<figure><div tabindex="0" role="slider" aria-label="Comparing the pixelated staggered output with the sub-pixel staggered one" aria-valuemin="0" aria-valuemax="100" aria-valuenow="50"><p><img alt="Before" loading="eager" width="700" height="478" decoding="async" data-nimg="1" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel-stagger.png 1x, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel-stagger.png 2x" src="https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-pixel-stagger.png"/></p><p><img alt="After" loading="eager" width="700" height="478" decoding="async" data-nimg="1" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-sub-pixel-stagger.png 1x, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-sub-pixel-stagger.png 2x" src="https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/statue-sub-pixel-stagger.png"/></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Comparing the pixelated staggered output with the sub-pixel staggered one</figcaption></figure>
<p>We can also use this offset within each cell of our effect to introduce the same staggered offset to any pattern we may want to render within them. In this case, we want our LED cells to be relatively visible, thus having a <strong>mask border</strong> around each sub-pixel is necessary. The trick to adding this border is to create a <code>subCellUV</code> vector by taking the fractional of the <code>subcoord</code> that ranges from <code>(-1, -1)</code> to <code>(1, 1)</code> to create a symmetrical border that surrounds the cell.</p>
<div><div><p data-testid="codesnippet-title">Drawing a black border around each staggered sub-cell</p></div><pre><div data-testid="highlight-line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellOffset </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> columnStagger </span><span data-testid="content-line">+</span><span data-testid="content-line"> subPixelStagger</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> subCellUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">subcoord </span><span data-testid="content-line">+</span><span data-testid="content-line"> cellOffset</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>5</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> border </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> subCellUV </span><span data-testid="content-line">*</span><span data-testid="content-line"> subCellUV </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">MASK_BORDER </span><span data-testid="content-line">-</span><span data-testid="content-line"> luma </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.25</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">mask </span><span data-testid="content-line">*=</span><span data-testid="content-line"> border</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> border</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>7</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> maskStrength </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">smoothstep</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.95</span><span data-testid="content-line">,</span><span data-testid="content-line"> mask</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">*=</span><span data-testid="content-line">  </span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">maskStrength </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> MASK_INTENSITY</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>Finally, to polish this LED panel illusion, we can make the darker pixels in the background somewhat visible by increasing all color channels by a small amount.</p>


<h3 id="woven-crochet-effect"><a href="#woven-crochet-effect" aria-hidden="true" tabindex="-1"><span></span></a>Woven Crochet Effect</h3>
<p>Speaking of staggered columns/rows and offsets, my <a href="https://r3f.maximeheckel.com/crochet">crochet post-processing effect</a> uses a similar technique to create a more <em>organic</em> look and feel for its knitted fabric illusion. This time, however, the offset is applied to the <code>cellUV</code> coordinates themselves.
The inspiration behind this effect comes from a very neat Blender plugin that I saw on Twitter way back in November 2024:</p>
<div><p>Crochet Shader 2.0 #b3d #procedural https://t.co/kVeza2yJ9j</p></div>
<p>Unlike the LED panel effect, where we want to physically move pixels by offsetting the sampling coordinates, the crochet effect maintains the underlying pixelated texture grid while only shifting the pattern mask that creates the knitted appearance.</p>
<div><div><p data-testid="codesnippet-title">Offset defined for our crochet effect</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">vec2</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uvPixel </span><span data-testid="content-line">=</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> uvPixel</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellPosition </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"> </span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> cellUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>8</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> rowOffset </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sin</span><span data-testid="content-line">(</span><span data-testid="content-line">(</span><span data-testid="content-line">random</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> uvPixel</span><span data-testid="content-line">.</span><span data-testid="content-line">y</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.25</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>As for the pattern, I opted for a simple <strong>ellipsis</strong> rotated <code>-65</code> degrees for even cells and <code>65</code> degrees for odd cells.</p>
<figure><p><img alt="Diagram showcasing a simplified depiction of the ellipsis pattern used in the crochet post-processing effect" loading="lazy" width="700" height="473" decoding="async" data-nimg="1" sizes="(max-width: 768px) 120vw, 75vw" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=640,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 640w, https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 750w, https://images.maximeheckel.com/cdn-cgi/image/width=828,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 828w, https://images.maximeheckel.com/cdn-cgi/image/width=1080,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 1080w, https://images.maximeheckel.com/cdn-cgi/image/width=1200,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 1200w, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 1920w, https://images.maximeheckel.com/cdn-cgi/image/width=2048,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 2048w, https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png 3840w" src="https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Crochet_Pattern.png"/></p><figcaption>Diagram showcasing a simplified depiction of the ellipsis pattern used in the crochet post-processing effect</figcaption></figure>
<p>Getting an ellipsis rotated as such in GLSL is luckily straightforward:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We use a standard rotation matrix around the center of the cell to have it positioned at an angle</p></li>
</ul>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> isAlternate </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">cellPosition</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> angle </span><span data-testid="content-line">=</span><span data-testid="content-line"> isAlternate </span><span data-testid="content-line">==</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line"> </span><span data-testid="content-line">?</span><span data-testid="content-line"> </span><span data-testid="content-line">radians</span><span data-testid="content-line">(</span><span data-testid="content-line">-</span><span data-testid="content-line">65.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">:</span><span data-testid="content-line"> </span><span data-testid="content-line">radians</span><span data-testid="content-line">(</span><span data-testid="content-line">65.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line">  center</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">cos</span><span data-testid="content-line">(</span><span data-testid="content-line">angle</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> center</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">sin</span><span data-testid="content-line">(</span><span data-testid="content-line">angle</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  center</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">sin</span><span data-testid="content-line">(</span><span data-testid="content-line">angle</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> center</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">cos</span><span data-testid="content-line">(</span><span data-testid="content-line">angle</span><span data-testid="content-line">)</span><span data-testid="content-line"></span></span></p></div></pre></div>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We create the ellipsis around said center by calculating the distance between the current pixel and the center of the cell, stretching the shape vertically and shifting it up. Eventually, we use that distance with the <code>smoothstep</code> function to create the elliptical shape with soft edges.</p></li>
</ul>
<div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> aspectRatio </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">1.55</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> ellipse </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">length</span><span data-testid="content-line">(</span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">rotated</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">,</span><span data-testid="content-line"> rotated</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">*</span><span data-testid="content-line"> aspectRatio </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">0.075</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">*=</span><span data-testid="content-line"> </span><span data-testid="content-line">smoothstep</span><span data-testid="content-line">(</span><span data-testid="content-line">0.2</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> ellipse</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>Once we reach that stage, 90% of the work is done, we just need to add a few more details. Here&#39;s a list of functions and effects that compound once added to the pattern and make our crochet shader look like fabric:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Apply noise to the center of each cell in the crochet pattern so that the edges of each ellipsis look more <em>rough</em>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Create a stripe pattern for each ellipsis to mimic the fabric. Far from perfect but good enough</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Add a slight hue shift to the color of each ellipse to give it a more organic look, as the thread color may vary.</p></li>
</ul>

<h3 id="lego-bricks"><a href="#lego-bricks" aria-hidden="true" tabindex="-1"><span></span></a>Lego bricks</h3>
<p>This one was a fun effect to build. For one, it has to do with Legos, which I love, but also, it is a simple yet elegant post-processing effect:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>It uses your classic pixelation logic that we went through in the first part</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The stud at the center of each cell is a <strong>lighting illusion</strong>.</p></li>
</ul>

<p>To create the stud at the center of the cell, we can reuse what we learned about the Blinn-Phong lighting model in <a href="https://blog.maximeheckel.com/posts/refraction-dispersion-and-other-shader-light-effects/">Refraction, dispersion, and other shader light effects</a>.</p>
<div><div><p data-testid="codesnippet-title">Defining diffuse lighting for our 2D lego brick effect</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> lighting </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">cellUV </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> lightPosition</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.7</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> dis </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">abs</span><span data-testid="content-line">(</span><span data-testid="content-line">distance</span><span data-testid="content-line">(</span><span data-testid="content-line">cellUV</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">color</span><span data-testid="content-line">.</span><span data-testid="content-line">rgb </span><span data-testid="content-line">*=</span><span data-testid="content-line"> </span><span data-testid="content-line">smoothstep</span><span data-testid="content-line">(</span><span data-testid="content-line">0.1</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> dis</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> lighting </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>Then, from the center of the cell:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We calculate the distance between each point and the center.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Create a soft circular edge using <code>smoothstep</code>.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Combine it with the lighting value.</p></li>
</ul>
<figure><p><img alt="Diagram showcasing how the lighting technique used in this effect draws the stud at the center of each cell" loading="lazy" width="700" height="443" decoding="async" data-nimg="1" sizes="(max-width: 768px) 120vw, 75vw" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=640,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 640w, https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 750w, https://images.maximeheckel.com/cdn-cgi/image/width=828,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 828w, https://images.maximeheckel.com/cdn-cgi/image/width=1080,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 1080w, https://images.maximeheckel.com/cdn-cgi/image/width=1200,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 1200w, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 1920w, https://images.maximeheckel.com/cdn-cgi/image/width=2048,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 2048w, https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png 3840w" src="https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Lego_Pattern.png"/></p><figcaption>Diagram showcasing how the lighting technique used in this effect draws the stud at the center of each cell</figcaption></figure>
<p>With this, each of our cells features a circular shaded stud in the center, just like a 1x1 Lego brick! To polish the effect, we can reuse constructs we&#39;ve seen previously in this article or other pieces of content I got to write in the past:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We can use <strong>color quantization</strong> to limit the color palette of this effect. Lego pieces come in a limited set of colors so it is fair to impose a limit here. I showcased how color quantization works in <a href="https://blog.maximeheckel.com/posts/the-art-of-dithering-and-retro-shading-web/">The Art of Dithering and Retro Shading for the Web</a></p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We can add a subtle border around each cell by reusing the same logic introduced in the LED panel effect, giving the impression that the final output is a mosaic of single-stud Lego pieces.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Finally, we can add a dash of hue shift to bring some variety in the colors used, especially for the scene&#39;s background, which may only feature a single color.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>To top it all off, we can clamp the min and max of each color channel slightly to avoid having Lego pieces that are either too dark or too bright, as the stud would not be very visible in those cases.</p></li>
</ul>


<h3 id="fluted--frosted-glass"><a href="#fluted--frosted-glass" aria-hidden="true" tabindex="-1"><span></span></a>Fluted &amp; frosted glass</h3>
<p>There has been a recent trend in art and media, whether digital or printed, to use <strong>fluted glass</strong> to add what I&#39;d call <em>physically-based distortions</em> to an image. As a post-processing effect, it&#39;s really enticing as it truly feels like a layer of frosted glass is placed between you the viewer and the scene.</p>

<p>This effect might feel like a departure from the ones we&#39;ve seen so far, as it&#39;s the only one in this post that will not feature pixelation. Yet, the techniques and principles behind it are similar to the ones used in some of our previous examples:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>UV Distortion</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Blinn-Phong lighting model</p></li>
</ul>
<p>To build this effect, let&#39;s first see how the <em>shape</em> of the pane of glass gives us the mathematical function that describes the distortion. We want fluted glass so our distortion will look like a <strong>sine wave</strong> such as: <code>sin(uv.x * PI)</code>. When looking at this shape, we can expect that the distortion will be as follows:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Minimum at the <strong>peaks and valleys</strong> of the wave as the surface is flat.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Maximum in between <strong>when the curve grows or decreases</strong>.</p></li>
</ul>
<p>Through this reasoning, we can define the distortion as the <strong>derivative</strong> of the function defining our fluted glass shape, which, in this case, would be: <code>cos(uv.x * PI) * PI</code>.</p>
<figure><p><img alt="Diagram showcasing the sine wave representing our fluted glass shape in relation to its derivative which represents the amount of distortion the fluted glass creates at any given point. (Apologies for the inaccuracy of this chart I have yet to find a good plugin on Figma to draw them. It should be good enough to help you visualize the math behind this effect.)" loading="lazy" width="700" height="358" decoding="async" data-nimg="1" sizes="(max-width: 768px) 120vw, 75vw" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=640,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 640w, https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 750w, https://images.maximeheckel.com/cdn-cgi/image/width=828,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 828w, https://images.maximeheckel.com/cdn-cgi/image/width=1080,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 1080w, https://images.maximeheckel.com/cdn-cgi/image/width=1200,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 1200w, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 1920w, https://images.maximeheckel.com/cdn-cgi/image/width=2048,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 2048w, https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png 3840w" src="https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Fluted_Glass_Derivative.png"/></p><figcaption>Diagram showcasing the sine wave representing our fluted glass shape in relation to its derivative which represents the amount of distortion the fluted glass creates at any given point. (Apologies for the inaccuracy of this chart I have yet to find a good plugin on Figma to draw them. It should be good enough to help you visualize the math behind this effect.)</figcaption></figure>
<p>Translating those mathematical concepts into code yields the following result:</p>
<figure><div tabindex="0" role="slider" aria-label="Comparing the non-distorted output of our effect with the distorted variant" aria-valuemin="0" aria-valuemax="100" aria-valuenow="50"><p><img alt="Before" loading="eager" width="700" height="478" decoding="async" data-nimg="1" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/tp-7-no-distortion.png 1x, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/tp-7-no-distortion.png 2x" src="https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/tp-7-no-distortion.png"/></p><p><img alt="After" loading="eager" width="700" height="478" decoding="async" data-nimg="1" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/tp-7-with-distortion.png 1x, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/tp-7-with-distortion.png 2x" src="https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=75,format=webp/https://cdn.maximeheckel.com/images/blog/tp-7-with-distortion.png"/></p><div id="slider-line"><p><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img" style="transform:rotate(180deg)"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></p></div></div><figcaption>Comparing the non-distorted output of our effect with the distorted variant</figcaption></figure>
<div><div><p data-testid="codesnippet-title">Simple fluted glass-like distortion</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> fluteCount </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">25.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> flutePosition </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> fluteCount </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> distortion </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line">(</span><span data-testid="content-line">cos</span><span data-testid="content-line">(</span><span data-testid="content-line">flutePosition </span><span data-testid="content-line">*</span><span data-testid="content-line"> PI </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> PI </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.15</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> distortedUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> uv </span><span data-testid="content-line">+</span><span data-testid="content-line"> distortion </span><span data-testid="content-line">*</span><span data-testid="content-line"> distortionAmount</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>This is great, but, we&#39;re not seeing any glass yet. The illusion we&#39;re trying to build relies on light to give it its glass texture, so we need to convert our derivative, which tells us &#34;how steep is the surface/how intense is the distortion&#34;, into a vector that tells &#34;which way does the surface point?&#34;, i.e. a <code>normal</code>, which is what we need for light calculations. Our effect is a curved piece of glass, so the normal vector will point towards <em>us</em> the viewer, slightly sideways in the slopes and straight towards us in the valleys and peaks of the curve.</p>
<p>We already have the <code>x</code> component of our <code>normal</code> vector, the <code>y</code> component is <code>0</code> for our case, so we can deduce the <code>z</code> component using the formula <code>normal.xÂ² + normal.yÂ² + normal.zÂ² = 1</code>.</p>
<div><div><p data-testid="codesnippet-title">From distortion to lighting</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">float</span><span data-testid="content-line"> fluteCount </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">25.0</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>2</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> flutePosition </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> fluteCount </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">0.5</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec3</span><span data-testid="content-line"> normal </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>5</p><p><span><span data-testid="content-line">normal</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">cos</span><span data-testid="content-line">(</span><span data-testid="content-line">flutePosition </span><span data-testid="content-line">*</span><span data-testid="content-line"> PI </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">2.0</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> PI </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">0.15</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>7</p><p><span><span data-testid="content-line">normal</span><span data-testid="content-line">.</span><span data-testid="content-line">z </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">sqrt</span><span data-testid="content-line">(</span><span data-testid="content-line">1.0</span><span data-testid="content-line"> </span><span data-testid="content-line">-</span><span data-testid="content-line"> normal</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">*</span><span data-testid="content-line"> normal</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>8</p><p><span><span data-testid="content-line">normal </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">normal</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec3</span><span data-testid="content-line"> lightDir </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">normalize</span><span data-testid="content-line">(</span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">lightPosition</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> diffuse </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">max</span><span data-testid="content-line">(</span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">normal</span><span data-testid="content-line">,</span><span data-testid="content-line"> lightDir</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> specular </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">pow</span><span data-testid="content-line">(</span><span data-testid="content-line">max</span><span data-testid="content-line">(</span><span data-testid="content-line">dot</span><span data-testid="content-line">(</span><span data-testid="content-line">reflect</span><span data-testid="content-line">(</span><span data-testid="content-line">-</span><span data-testid="content-line">lightDir</span><span data-testid="content-line">,</span><span data-testid="content-line"> normal</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">vec3</span><span data-testid="content-line">(</span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">32.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>14</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> distortedUV </span><span data-testid="content-line">=</span><span data-testid="content-line"> uv </span><span data-testid="content-line">+</span><span data-testid="content-line"> normal</span><span data-testid="content-line">.</span><span data-testid="content-line">xy </span><span data-testid="content-line">*</span><span data-testid="content-line"> distortionAmount</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>Finally, to polish things up, we can add a couple of effects to this shader to make it as realistic as possible:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>A dash of noise to create a <em>frosted glass</em> effect.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span></li>
</ul>


</section><section id="dynamic-and-interactive-post-processing-section"><h2 id="dynamic-and-interactive-post-processing"><a href="#dynamic-and-interactive-post-processing" aria-hidden="true" tabindex="-1"><span></span></a>Dynamic and interactive post-processing</h2>
<p>So far, we have considered post-processing effects solely as mere <em>image filters</em>, but we can achieve more with them. Adding <strong>a dash of interactivity</strong> into the mix, whether time-based or by leveraging the cursor of the user for example, can yield some very unique and delightful results and make your effects really stand out.</p>
<h3 id="progressive-depixelation"><a href="#progressive-depixelation" aria-hidden="true" tabindex="-1"><span></span></a>Progressive Depixelation</h3>
<p>I like leveraging pixelation in many of my post-processing experiments, so it felt natural to start my journey into dynamic effects with <a href="https://r3f.maximeheckel.com/pixel-loading">this progressive pixel loading one</a>. We can easily make the <code>pixelSize</code> depend on <code>time</code> or an arbitrary <code>progress</code> uniform, but even more challenging is to have the effect <em>progressively de-pixelated the screen</em> row-by-row, pixel-by-pixel.
The diagram below illustrates my original sketch showcasing how this effect would eventually work:</p>
<figure><p><img alt="Diagram showcasing a sketch breaking down the process behind the Depixelation effect." loading="lazy" width="700" height="497" decoding="async" data-nimg="1" sizes="(max-width: 768px) 120vw, 75vw" srcset="https://images.maximeheckel.com/cdn-cgi/image/width=640,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 640w, https://images.maximeheckel.com/cdn-cgi/image/width=750,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 750w, https://images.maximeheckel.com/cdn-cgi/image/width=828,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 828w, https://images.maximeheckel.com/cdn-cgi/image/width=1080,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 1080w, https://images.maximeheckel.com/cdn-cgi/image/width=1200,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 1200w, https://images.maximeheckel.com/cdn-cgi/image/width=1920,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 1920w, https://images.maximeheckel.com/cdn-cgi/image/width=2048,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 2048w, https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png 3840w" src="https://images.maximeheckel.com/cdn-cgi/image/width=3840,quality=100,format=webp/https://cdn.maximeheckel.com/images/blog/Depixelation.png"/></p><figcaption>Diagram showcasing a sketch breaking down the process behind the Depixelation effect.</figcaption></figure>
<p>To achieve this, the trick consists of:</p>
<ol>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Setting a concept of <code>level</code> based on the original <code>basePixelSize</code> and how far along in the transition we are.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Each level representing &#34;a power of 2&#34; and going down 1 level at a time as the <code>basePixelSize</code> is decreasing.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Calculating the number of pixels per row/column and the current row/column processed at the current level.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>Get the row and position within the row for a given UV.</p></li>
</ol>
<div><div><p data-testid="codesnippet-title">Main variables defined for our depixelation effect</p></div><pre><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> basePixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">pow</span><span data-testid="content-line">(</span><span data-testid="content-line">2.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> LEVELS</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> currentLevel </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">progress </span><span data-testid="content-line">*</span><span data-testid="content-line"> LEVELS</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> currentPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">max</span><span data-testid="content-line">(</span><span data-testid="content-line">basePixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> </span><span data-testid="content-line">pow</span><span data-testid="content-line">(</span><span data-testid="content-line">2.0</span><span data-testid="content-line">,</span><span data-testid="content-line"> currentLevel</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>8</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> currentPixelsPerRow </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">ceil</span><span data-testid="content-line">(</span><span data-testid="content-line">resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">x </span><span data-testid="content-line">/</span><span data-testid="content-line"> currentPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>9</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> currentPixelsPerCol </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">ceil</span><span data-testid="content-line">(</span><span data-testid="content-line">resolution</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">/</span><span data-testid="content-line"> currentPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> currentTotalPixels </span><span data-testid="content-line">=</span><span data-testid="content-line"> currentPixelsPerRow </span><span data-testid="content-line">*</span><span data-testid="content-line"> currentPixelsPerCol</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> levelProgress </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">fract</span><span data-testid="content-line">(</span><span data-testid="content-line">progress </span><span data-testid="content-line">*</span><span data-testid="content-line"> LEVELS</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> currentTotalPixels</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>13</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> currentRowInLevel </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">levelProgress </span><span data-testid="content-line">/</span><span data-testid="content-line"> currentPixelsPerRow</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>14</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> currentPixelInRow </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">mod</span><span data-testid="content-line">(</span><span data-testid="content-line">levelProgress</span><span data-testid="content-line">,</span><span data-testid="content-line"> currentPixelsPerRow</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>16</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">vec2</span><span data-testid="content-line"> gridPos </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">*</span><span data-testid="content-line"> resolution </span><span data-testid="content-line">/</span><span data-testid="content-line"> currentPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>17</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> row </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">currentPixelsPerCol </span><span data-testid="content-line">-</span><span data-testid="content-line"> gridPos</span><span data-testid="content-line">.</span><span data-testid="content-line">y </span><span data-testid="content-line">-</span><span data-testid="content-line"> </span><span data-testid="content-line">1.0</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>18</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">float</span><span data-testid="content-line"> posInRow </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">gridPos</span><span data-testid="content-line">.</span><span data-testid="content-line">x</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span></span></p></div></pre></div>
<p>Once we have all that defined, it&#39;s just a matter of reusing our pixelation effect from part 1, but this time conditionally:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>If the a row of pixels is within any previous row that&#39;s already been processed: <strong>we should use the updated pixel size</strong> (e.g. if we started at <code>128</code>, then it should be <code>64</code>).</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>If we&#39;re on the currently processing row AND the pixel&#39;s horizontal position is less than or equal to how far we&#39;ve processed in this row: <strong>we should use the updated pixel size as well</strong> (e.g. if we started at <code>128</code>, then it should be <code>64</code>).</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p><strong>Else we should be on the old pixel size</strong> (<code>128</code>).</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>We can also add a final case for when we reach a pixel size inferior to or equal to <code>1</code>.</p></li>
</ul>
<p>The demo below showcases the effect linked to a <code>progress</code> uniform. You could also hook it up to a <code>time</code> uniform if you ever wished to have it trigger on page load or any other event without needing a user interaction.</p>

<h3 id="pixelating-mouse-trail"><a href="#pixelating-mouse-trail" aria-hidden="true" tabindex="-1"><span></span></a>Pixelating Mouse Trail</h3>
<p>For this section, I have to shoutout the incredible work of <a href="https://twitter.com/dghez_">@dghez_</a> for his work on <a href="https://blog.maximeheckel.com/posts/post-processing-as-a-creative-medium/rosehip.xyz">rosehip.xyz</a> and <a href="https://27-b.com">27b&#39;s</a> lab section, who both had a take on a <strong>pixelating mouse trail</strong> effect that increases the pixel size and distorts the underlying image as you move your cursor across the screen.</p>
<p>I had previously built a reusable <code>MouseTrail</code> component that I used in some of my shader experiments and I thought to myself that, to achieve a similar effect as the one in the examples above, I could repurpose it and put its output inside a <strong>Frame Buffer Object (FBO)</strong> to feed the resulting texture as an argument to my pixelating effect. The texutre itself would be visible as the user moves the cursor, so I&#39;d only have to make the pixel size and distortion a function of the speed and direction of said cursor.</p>


<p>Using React Three Fiber&#39;s <code>createPortal</code> function, we can render the <code>MouseTrail</code> component demoed above in a separate scene, and dedicate a FBO to store its output as a texture:</p>
<div><div><p data-testid="codesnippet-title">Rendering the MouseTrail component in a portal and storing its output as a texture</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">PixelatingMouseTrail</span><span data-testid="content-line"> </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">(</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">=&gt;</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>2</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">const</span><span data-testid="content-line"> mouseTrail </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">useMemo</span><span data-testid="content-line">(</span><span data-testid="content-line">(</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">=&gt;</span><span data-testid="content-line"> </span><span data-testid="content-line">new</span><span data-testid="content-line"> </span><span data-testid="content-line">THREE</span><span data-testid="content-line">.</span><span data-testid="content-line">Scene</span><span data-testid="content-line">(</span><span data-testid="content-line">)</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">[</span><span data-testid="content-line">]</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">const</span><span data-testid="content-line"> mouseTrailFBO </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">useFBO</span><span data-testid="content-line">(</span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>4</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">minFilter</span><span data-testid="content-line">:</span><span data-testid="content-line"> </span><span data-testid="content-line">THREE</span><span data-testid="content-line">.</span><span data-testid="content-line">LinearFilter</span><span data-testid="content-line">,</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">magFilter</span><span data-testid="content-line">:</span><span data-testid="content-line"> </span><span data-testid="content-line">THREE</span><span data-testid="content-line">.</span><span data-testid="content-line">LinearFilter</span><span data-testid="content-line">,</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">format</span><span data-testid="content-line">:</span><span data-testid="content-line"> </span><span data-testid="content-line">THREE</span><span data-testid="content-line">.</span><span data-testid="content-line">RGBAFormat</span><span data-testid="content-line">,</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">    </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> gl</span><span data-testid="content-line">,</span><span data-testid="content-line"> camera </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">=</span><span data-testid="content-line"> state</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>16</p><p><span><span data-testid="content-line">    gl</span><span data-testid="content-line">.</span><span data-testid="content-line">setRenderTarget</span><span data-testid="content-line">(</span><span data-testid="content-line">mouseTrailFBO</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>17</p><p><span><span data-testid="content-line">    gl</span><span data-testid="content-line">.</span><span data-testid="content-line">render</span><span data-testid="content-line">(</span><span data-testid="content-line">mouseTrail</span><span data-testid="content-line">,</span><span data-testid="content-line"> camera</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>18</p><p><span><span data-testid="content-line">    gl</span><span data-testid="content-line">.</span><span data-testid="content-line">setRenderTarget</span><span data-testid="content-line">(</span><span data-testid="content-line">null</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>23</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"> camera </span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">useThree</span><span data-testid="content-line">(</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>27</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">{</span><span data-testid="content-line">createPortal</span><span data-testid="content-line">(</span><span data-testid="content-line">&lt;</span><span data-testid="content-line">MouseTrail</span><span data-testid="content-line"> </span><span data-testid="content-line">mouse</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">smoothedMouse</span><span data-testid="content-line">}</span><span data-testid="content-line"> </span><span data-testid="content-line">/&gt;</span><span data-testid="content-line">,</span><span data-testid="content-line"> mouseTrail</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>30</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">group</span><span data-testid="content-line"> </span><span data-testid="content-line">ref</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">spaceshipRef</span><span data-testid="content-line">}</span><span data-testid="content-line">&gt;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>33</p><p><span><span data-testid="content-line">      </span><span data-testid="content-line">&lt;</span><span data-testid="content-line">PixelatingMouseTrailEffect</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>34</p><p><span><span data-testid="content-line">        </span><span data-testid="content-line">mouseTrailTexture</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">mouseTrailFBO</span><span data-testid="content-line">.</span><span data-testid="content-line">texture</span><span data-testid="content-line">}</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>35</p><p><span><span data-testid="content-line">        </span><span data-testid="content-line">mouse</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">smoothedMouse</span><span data-testid="content-line">.</span><span data-testid="content-line">current</span><span data-testid="content-line">}</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>36</p><p><span><span data-testid="content-line">        </span><span data-testid="content-line">mouseDirection</span><span data-testid="content-line">=</span><span data-testid="content-line">{</span><span data-testid="content-line">smoothedMouseDirection</span><span data-testid="content-line">.</span><span data-testid="content-line">current</span><span data-testid="content-line">}</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>We can then pass this <code>mouseTrailTexture</code> as a uniform to our shader effect, and use it to have a variable pixelization based on:</p>
<ul>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The distance between the current pixel and the mouse, ranging from <code>1.0</code> if it is close to the mouse to <code>0.0</code> if it is far away.</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>The intensity of the mouse trail, its <code>rg</code> color channel, since its color ranges from <code>red</code> (vertical mouse movements) to <code>green</code> (horizontal mouse movements)</p></li>
<li><span data-list-item="true"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" role="img"><title>Arrow</title><desc>An icon representing an arrow</desc><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><p>With this, we can sample a pixelated version of the mouse trail, which we can use to offset our main UV coordinates. Once again, we&#39;ll reuse the pixelation logic we detailed in the first section.</p></li>
</ul>
<div><div><p data-testid="codesnippet-title">Pixelation based on the mouse trail texture</p></div><pre><div data-testid="line"><p>1</p><p><span><span data-testid="content-line">uniform</span><span data-testid="content-line"> </span><span data-testid="content-line">sampler2D</span><span data-testid="content-line"> mouseTrailTexture</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>3</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">uniform</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> mouseDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>5</p><p><span><span data-testid="content-line"></span><span data-testid="content-line">void</span><span data-testid="content-line"> </span><span data-testid="content-line">mainImage</span><span data-testid="content-line">(</span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> inputColor</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">const</span><span data-testid="content-line"> </span><span data-testid="content-line">in</span><span data-testid="content-line"> </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">out</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> outputColor</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">{</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>6</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> mouseTrailOG </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">mouseTrailTexture</span><span data-testid="content-line">,</span><span data-testid="content-line"> uv</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>7</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> distanceToCenter </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">1.</span><span data-testid="content-line">-</span><span data-testid="content-line">distance</span><span data-testid="content-line">(</span><span data-testid="content-line">uv</span><span data-testid="content-line">,</span><span data-testid="content-line"> mouse</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>9</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">float</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">32.0</span><span data-testid="content-line"> </span><span data-testid="content-line">+</span><span data-testid="content-line"> </span><span data-testid="content-line">length</span><span data-testid="content-line">(</span><span data-testid="content-line">mouseTrailOG</span><span data-testid="content-line">.</span><span data-testid="content-line">rg</span><span data-testid="content-line">)</span><span data-testid="content-line"> </span><span data-testid="content-line">*</span><span data-testid="content-line"> distanceToCenter</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>10</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">=</span><span data-testid="content-line"> pixelSize </span><span data-testid="content-line">/</span><span data-testid="content-line"> resolution</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>11</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec2</span><span data-testid="content-line"> uvPixel </span><span data-testid="content-line">=</span><span data-testid="content-line"> normalizedPixelSize </span><span data-testid="content-line">*</span><span data-testid="content-line"> </span><span data-testid="content-line">floor</span><span data-testid="content-line">(</span><span data-testid="content-line">uv </span><span data-testid="content-line">/</span><span data-testid="content-line"> normalizedPixelSize</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>12</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> mouseTrail </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">mouseTrailTexture</span><span data-testid="content-line">,</span><span data-testid="content-line"> uvPixel</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="highlight-line"><p>16</p><p><span><span data-testid="content-line">  textureUV </span><span data-testid="content-line">-=</span><span data-testid="content-line"> mouseTrail</span><span data-testid="content-line">.</span><span data-testid="content-line">rg </span><span data-testid="content-line">*</span><span data-testid="content-line"> distanceToCenter </span><span data-testid="content-line">*</span><span data-testid="content-line"> mouseDirection</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>18</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> color </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">texture2D</span><span data-testid="content-line">(</span><span data-testid="content-line">inputBuffer</span><span data-testid="content-line">,</span><span data-testid="content-line"> textureUV</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>19</p><p><span><span data-testid="content-line">  </span><span data-testid="content-line">vec4</span><span data-testid="content-line"> trailColor </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">vec4</span><span data-testid="content-line">(</span><span data-testid="content-line">0.9</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.9</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.9</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">0.1</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div><div data-testid="line"><p>20</p><p><span><span data-testid="content-line">  outputColor </span><span data-testid="content-line">=</span><span data-testid="content-line"> </span><span data-testid="content-line">max</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">,</span><span data-testid="content-line"> </span><span data-testid="content-line">mix</span><span data-testid="content-line">(</span><span data-testid="content-line">color</span><span data-testid="content-line">,</span><span data-testid="content-line"> trailColor</span><span data-testid="content-line">,</span><span data-testid="content-line"> mouseTrail</span><span data-testid="content-line">.</span><span data-testid="content-line">r</span><span data-testid="content-line">)</span><span data-testid="content-line">)</span><span data-testid="content-line">;</span><span data-testid="content-line"></span></span></p></div></pre></div>
<p>Finally, those distorted/offset UV coordinates can be used to sample the main scene:</p>

<p>This is one of the many examples of incorporating dynamic/variable pixelation as an effect. You could pass <em>any texture</em> to this, such as a Perlin Noise, a Fractal Brownian Motion noise, etc. The possibilities in terms of dynamic post-processing are truly endless. The best thing to do, as you may have guessed by now, is simply to <strong>try more things you&#39;ve learned on your own shader journey and to combine them with the ideas of this article in a fun and unique way</strong>.</p>
</section><section id="final-thoughts-section"><h2 id="final-thoughts"><a href="#final-thoughts" aria-hidden="true" tabindex="-1"><span></span></a>Final Thoughts</h2>
<p>Each post-processing effect detailed in this post could have deserved its own article, but I thought it would be more interesting to look at them as a whole, as <strong>they share the same tricks and techniques</strong> despite yielding different outputs. This highlights the value of blending ideas and concepts to see what emerges as you learn more about shaders, develop your style, and discover the aesthetics that resonate with you.</p>
<p>When people come to me and ask, <em>&#34;How do you learn about/build those things?&#34;</em> what you saw in this blog post (waving arms around) is what I spend some of my free time doing. The added bonus of doing it with post-processing is that it allows me to experiment with ideas quicker, as it&#39;s a simple 2D canvas on which you can paint pixels in any way you want.</p>
<p>A follow-up goal of mine for post-processing would be to make those shader bits more composable, Ã  la <a href="https://github.com/patriciogonzalezvivo/lygia">Lygia</a>, and who knows, maybe build my own FX package (?). For now, my main focus will be to transition some of those effects to WebGPU as it would be a nice entry point into learning about <strong>compute shaders</strong> and the other new concepts brought by this new API. That topic, however, will be for another time ðŸ˜„ in the meantime, I&#39;ll be on the lookout for
<strong>your own creative post-processing effects</strong> to show up on my Twitter or Bluesky timeline using everything you learned in this post, and if done well enough, maybe you&#39;ll get me to spend some of my time trying to reproduce them.</p></section></div></div></div>
  </body>
</html>
