<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.joshwcomeau.com/react/common-beginner-mistakes/">Original</a>
    <h1>Common Beginner Mistakes with React</h1>
    
    <div id="readability-page-1" class="page"><article><a id="introduction"><h2>Introduction</h2></a><p>A couple years ago, I was teaching React at a local coding bootcamp, and I noticed that there were a handful of things that kept catching students off guard. People kept falling into the same pits!</p><p>In this tutorial, we&#39;re going to explore 9 of the most common gotchas. You&#39;ll learn how to steer around them, and hopefully avoid a lot of frustration.</p><p>In order to keep this blog post light and breezy, we won&#39;t dig <em>too</em> much into the reasons behind these gotchas. This is more of a quick reference.</p><p>Alright, let&#39;s start with one of the most pervasive gotchas. I&#39;ve seen this one ‚Äúin the wild‚Äù on a handful of production apps!</p><p>Take a look at the following setup:</p><!--$?--><template id="B:0"></template><!--/$--><p>Our goal is to conditionally show a shopping list. If we have at least 1 item in the array, we should render a <code>ShoppingList</code> element. Otherwise, we shouldn&#39;t render anything.</p><p>And yet, we wind up with a random <code>0</code> in the UI!</p><p>This happens because <code>items.length</code> evaluates to <code>0</code>. And since 0 is a falsy value in JavaScript, the <code>&amp;&amp;</code> operator short-circuits, and the entire expression resolves to <code>0</code>.</p><p>It&#39;s effectively as if we had done this:</p><pre></pre><p>Unlike other falsy values (<code>&#39;&#39;</code>, <code>null</code>, <code>false</code>, etc), the number 0 is a valid value in JSX. After all, there are plenty of scenarios in which we really <em>do</em> want to print the number <code>0</code>!</p><p><strong>How to fix it:</strong> Our expression should use a ‚Äúpure‚Äù boolean value (true/false):</p><pre></pre><p><code>items.length &gt; 0</code> will always evaluate to either <code>true</code> or <code>false</code>, and so we&#39;ll never have any issues.</p><p>Alternatively, we can use a <em>ternary expression</em>:</p><pre></pre><p>Both options are perfectly valid, and it comes down to personal taste.</p><p>Let&#39;s keep working with our shopping list example. Suppose we have the ability to add new items:</p><!--$?--><template id="B:1"></template><!--/$--><p>The <code>handleAddItem</code> function is called whenever the user submits a new item. Unfortunately, it doesn&#39;t work! When we enter an item and submit the form, that item is not added to the shopping list.</p><p><strong>Here&#39;s the problem:</strong> we&#39;re violating maybe the most sacred rule in React. We&#39;re mutating state.</p><p>Specifically, the problem is this line:</p><pre></pre><p>React relies on an state variable&#39;s <em>identity</em> to tell when the state has changed. When we push an item into an array, we aren&#39;t changing that array&#39;s identity, and so React can&#39;t tell that the value has changed.</p><p><strong>How to fix it:</strong> We need to create a brand new array. Here&#39;s how I&#39;d do it:</p><pre></pre><p>Instead of modifying an existing array, I&#39;m creating a new one from scratch. It includes all of the same items (courtesy of the <code>...</code> <a href="http://archvile.net/operator-lookup/?match=restspread">spread syntax</a>), as well as the newly-entered item.</p><p>The distinction here is between editing an existing item, versus creating a new one. When we pass a value to a state-setter function like <code>setCount</code>, it needs to be a new entity.</p><p><strong>The same thing is true for objects:</strong></p><pre></pre><p>Essentially, the <code>...</code> syntax is a way to copy/paste all of the stuff from an array/object into a brand new entity. This ensures that everything works properly.</p><p>Here&#39;s a warning you&#39;ve likely seen before:</p><p>Warning: Each child in a list should have a unique &#34;key&#34; prop.</p><p>The most common way for this to happen is when mapping over data. Here&#39;s an example of this violation:</p><!--$?--><template id="B:2"></template><!--/$--><p>Whenever we render an array of elements, we need to provide a bit of extra context to React, so that it can identify each item. Critically, this needs to be a <em>unique</em> identifier.</p><p>Many online resources will suggest using the array index to solve this problem:</p><pre></pre><p><strong>I don&#39;t think this is good advice.</strong> This approach will work <em>sometimes</em>, but it can cause some pretty big problems in other circumstances.</p><p>As you gain a deeper understanding of how React works, you&#39;ll be able to tell whether it&#39;s fine or not on a case-by-case basis, but honestly, I think it&#39;s easier to solve the problem in a way which is <em>always</em> safe. That way, you never have to worry about it!</p><p><strong>Here&#39;s the plan:</strong> Whenever a new item is added to the list, we&#39;ll generate a <em>unique ID</em> for it:</p><pre></pre><p><code>crypto.randomUUID</code> is a method built into the browser (it&#39;s not a third-party package). It&#39;s available in <a href="https://caniuse.com/mdn-api_crypto_randomuuid" rel="noopener noreferrer" target="_blank">all major browsers</a>. It has nothing to do with cryptocurrencies.</p><p>This method generates a unique string, like <code>d9bb3c4c-0459-48b9-a94c-7ca3963f7bd0</code>.</p><p>By dynamically generating an ID whenever the user submits the form, we&#39;re <em>guaranteeing</em> that each item in the shopping list has a unique ID.</p><p>Here&#39;s how we&#39;d apply it as the key:</p><pre></pre><p>Importantly, we want to generate the ID <strong>when the state is updated.</strong> We <em>don&#39;t</em> want to do this:</p><pre></pre><p>Generating it in the JSX like this will cause the key to change on every render. Whenever the key changes, React will destroy and re-create these elements, which can have a big negative impact on performance.</p><p>This pattern ‚Äî generating the key when the data is first created ‚Äî can be applied to a wide range of situations. For example, here&#39;s how I&#39;d create unique IDs when fetching data from a server:</p><pre></pre><p>Here&#39;s a dastardly gotcha I see <em>all the time</em> on the web.</p><!--$?--><template id="B:3"></template><!--/$--><p>Notice that the two sentences are all smushed together:</p><span type="default"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27422%27%20height=%2785%27/%3e"/></span><img alt="Annotated playground showing that there&#39;s a space missing between the two sentences" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></span><p>This happens because the JSX compiler (the tool that turns the JSX we write into browser-friendly JavaScript) can&#39;t really distinguish between <em>grammatical</em> whitespace, and the whitespace we add for indentation / code readability.</p><p><strong>How to fix it:</strong> we need to add an explicit space character between the text and the anchor tag:</p><pre></pre><p><strong>One little pro-tip:</strong> if you use Prettier, it&#39;ll add these space characters for you automatically! Just be sure to let it do the formatting (don&#39;t pre-emptively split things onto multiple lines).</p><p>This one catches <em>everyone</em> off-guard at some point or other. When I taught at a local coding bootcamp, I lost track of the number of times people came to me with this issue.</p><p>Here&#39;s a minimal counter application: clicking on the button increments the count. See if you can spot the problem:</p><!--$?--><template id="B:4"></template><!--/$--><p>After incrementing the <code>count</code> state variable, we&#39;re logging the value to the console. Curiously, <em>it&#39;s logging the wrong value:</em></p><span type="default"><img src="http://archvile.net/images/gotchas/mismatched-count-var.png" width="421.5" alt="Annotated screenshot of the playground, showing how the button holds the number 1, but the console logs the number 0"/></span><p><strong>Here&#39;s the problem:</strong> state-setter function in React like <code>setCount</code> are <em>asynchronous</em>.</p><p>This is the problematic code:</p><pre></pre><p>It&#39;s easy to mistakenly believe that <code>setCount</code> functions like assignment, as though it was equivalent to doing this:</p><pre></pre><p><strong>This isn&#39;t how React is built though.</strong> When we call <code>setCount</code>, we&#39;re aren&#39;t re-assigning a variable. We&#39;re <em>scheduling an update.</em></p><p>It can take a while for us to fully wrap our heads around this idea, but here&#39;s something that might help it click: we <em>can&#39;t</em> reassign the <code>count</code> variable, because it&#39;s a constant!</p><pre></pre><p><strong>So how do we fix this?</strong> Fortunately, we already know what this value should be. We need to capture it in a variable, so that we have access to it:</p><pre></pre><p>I like using the ‚Äúnext‚Äù prefix whenever I do stuff like this (<code>nextCount</code>, <code>nextItems</code>, <code>nextEmail</code>, etc). It makes it clearer to me that we&#39;re not updating the <em>current</em> value, we&#39;re scheduling the <em>next</em> value.</p><p>Sometimes, a component needs to return <em>multiple</em> top-level elements.</p><p>For example:</p><!--$?--><template id="B:5"></template><!--/$--><p>We want our <code>LabeledInput</code> component to return two elements: a <code>&lt;label&gt;</code> and an <code>&lt;input&gt;</code>. Frustratingly, we&#39;re getting an error:</p><p>Adjacent JSX elements must be wrapped in an enclosing tag.</p><p>This happens because JSX compiles to plain ol‚Äô JavaScript. Here&#39;s what this code looks like when it hits the browser:</p><pre></pre><p>In JavaScript, we&#39;re not allowed to return multiple things like this. It&#39;s the same reason that this doesn&#39;t work:</p><pre></pre><p><strong>How do we fix it?</strong> For a long time, the standard practice was to wrap both elements in a wrapper tag, like a <code>&lt;div&gt;</code>:</p><pre></pre><p>By grouping our <code>&lt;label&gt;</code> and <code>&lt;input&gt;</code> in a <code>&lt;div&gt;</code>, we&#39;re only returning a single top-level element!</p><p>Here&#39;s what it looks like in plain JS:</p><pre></pre><p>JSX is a wonderful abstraction, but it can often obscure fundamental truths about JavaScript. I think it&#39;s often helpful to see how JSX is transformed into plain JS, to get a handle on what&#39;s actually happening.</p><p>With this new approach, we&#39;re returning a single element, and that element contains two children elements. Problem solved!</p><p>We can make this solution even better using <em>fragments</em>:</p><pre></pre><p><code>React.Fragment</code> is a React component that exists purely to solve this problem. It allows us to bundle up multiple top-level elements <em>without affecting the DOM</em>. This is great: it means we aren&#39;t polluting our markup with an unnecessary <code>&lt;div&gt;</code>.</p><p>It also has a convenient shorthand. We can write fragments like this:</p><pre></pre><p>I like the symbolism here: the React team chose to use an empty HTML tag, <code>&lt;&gt;</code>, as a way of showing that fragments don&#39;t produce any real markup.</p><p>Let&#39;s look at a typical form, binding an input to a piece of React state:</p><!--$?--><template id="B:6"></template><!--/$--><p>If you start typing in this input, you&#39;ll notice a console warning:</p><p>Warning: A component is changing an uncontrolled input to be controlled.</p><p><strong>Here&#39;s how to fix it:</strong> We need to initialize our <code>email</code> state to an empty string:</p><pre></pre><p>When we set the <code>value</code> attribute, we tell React that we want this to be a <em>controlled</em> input. That only works when we pass it a defined value, though! By initializing <code>email</code> to an empty string, we ensure that <code>value</code> is never being set to <code>undefined</code>.</p><p>JSX is made to look and feel quite a lot like HTML, but there are some surprising differences between the two that tend to catch people offguard.</p><p>Most of the differences are well-documented, and the console warnings tend to be very descriptive and helpful. If you accidentally use <code>class</code> instead of <code>className</code>, for example, React will tell you exactly what the problem is.</p><p>But there&#39;s one subtle difference that tends to trip people up: <strong>the <code>style</code> attribute.</strong></p><p>In HTML, <code>style</code> is written as a string:</p><pre></pre><p>In JSX, however, we need to specify it as an <em>object</em>, with camelCased property names.</p><p>Below, I&#39;ve tried to do exactly this, but I wind up with an error. Can you spot the mistake?</p><!--$?--><template id="B:7"></template><!--/$--><p>The problem is that I need to use <em>double squigglies</em>, like this:</p><pre></pre><p>To understand why this is necessary, we need to dig into this syntax a bit.</p><p>In JSX, we use squiggly brackets to create an <em>expression slot</em>. We can put any valid JS expression in this slot. For example:</p><pre></pre><p>Whatever we put between the <code>{}</code> will be evaluated as JavaScript, and the result will be set to this attribute. <code>className</code> will either be <code>&#39;btn primary&#39;</code> or <code>&#39;btn&#39;</code>.</p><p>With <code>style</code>, we first need to create an expression slot, <em>and then</em> we want to pass a JavaScript object into this slot.</p><p>I think it&#39;s clearer if we pull the object out into a variable:</p><pre></pre><p>The outer set of squigglies creates an ‚Äúexpression slot‚Äù in the JSX. The inner set creates a JS object that holds our styles.</p><p>Let&#39;s suppose we have a function which fetches some user data from our API on mount. We&#39;ll use the <code>useEffect</code> hook, and we want to use the <code>await</code> keyword.</p><p>Here&#39;s my first shot at it:</p><!--$?--><template id="B:8"></template><!--/$--><p>Unfortunately, we get an error:</p><p>&#39;await&#39; is only allowed within async functions</p><p>Alright, that&#39;s no problem. Let&#39;s update the effect callback to be an async function, by prefixing it with the <code>async</code> keyword:</p><pre></pre><p>Unfortunately, this doesn&#39;t work either; we get a cryptic error message:</p><p>destroy is not a function</p><p><strong>Here&#39;s the fix:</strong> We need to create a separate async function <em>within</em> our effect:</p><pre></pre><p>To understand why this workaround is necessary, it&#39;s worth considering what the <code>async</code> keyword actually does.</p><p>For example, what would you guess this function returns?</p><pre></pre><p>At first glance, it seems obvious: it returns the string <code>&#34;Hello world!&#34;</code>! But actually, this function returns a <em>promise</em>. That promise <em>resolves</em> to the string <code>&#34;Hello world!&#34;</code>.</p><p>This is a problem, because the <code>useEffect</code> hook isn&#39;t expecting us to return a promise! It expects us to return either nothing (like we are above), or a <em>cleanup function</em>.</p><p>Cleanup functions are well beyond the scope of this tutorial, but they&#39;re incredibly important. Most of our effects will have some sort of teardown logic, and we need to provide it to React ASAP, so that React can invoke it when the dependencies change, or the component unmounts.</p><p>With our &#34;separate async function&#34; strategy, we&#39;re still able to return a cleanup function right away:</p><pre></pre><p>You can name this function whatever you like, but I like the generic name <code>runEffect</code>. It makes clear that it holds the primary effect logic.</p><p>At first glance, a lot of the fixes we&#39;ve seen in this tutorial seem pretty arbitrary. Why, exactly, do we need to provide a unique key? How come we can&#39;t access state after changing it? And why on earth is <code>useEffect</code> so dang finicky?!</p><p>React has always been pretty tricky to become <em>truly</em> comfortable with, and it&#39;s especially true nowadays with hooks. It takes a while for everything to <em>click.</em></p><p>I started using React back in 2015, and I remember thinking: ‚ÄúThis is friggin‚Äô cool, but I have no idea how this works.‚Äù üòÖ</p><p>Since then, I&#39;ve been building my mental model of React one puzzle piece at a time. I&#39;ve had a series of epiphanies, and each time, my mental model has become more sturdy, more robust. I began to understand <em>why</em> React works the way it does.</p><p>I found I didn&#39;t have to keep memorizing arbitrary rules; instead, I could rely on my intuition. It&#39;s hard to overstate how much more <em>fun</em> React became for me!</p><p>For the past year, I&#39;ve been developing an interactive self-paced online course called <a href="https://www.joyofreact.com/" rel="noopener noreferrer" target="_blank"><strong>The Joy of React</strong></a>. It&#39;s a beginner-friendly course with one goal: to help you build your intuition of how React works, so that you can use it to build rich, dynamic web applications.</p><a href="https://www.joyofreact.com/" rel="noopener noreferrer" target="_blank"><span type="default"><span><span><img alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%271394%27%20height=%27620%27/%3e"/></span><img alt="Visit the ‚ÄúJoy of React‚Äù homepage" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic"/></span></span></a><p>My courses aren&#39;t like other courses; you won&#39;t sit and watch me code for hours and hours. <a href="https://www.joyofreact.com/" rel="noopener noreferrer" target="_blank">The Joy of React</a> mixes lots of different media types: there are videos, sure, but there are also interactive articles, challenging exercises, real-world-inspired projects, and even a mini-game or two.</p><p><strong>The Joy of React</strong> will be released in a few months. You can learn much more about it, and sign up for updates, on the course homepage:</p><ul><li><span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span></li></ul><svg preserveAspectRatio="none" fill="none" style="width:100%;max-width:100px"><line x1="0" y1="0" x2="20" y2="10"></line><line x1="20" y1="0" x2="40" y2="10"></line><line x1="40" y1="0" x2="60" y2="10"></line><line x1="60" y1="0" x2="80" y2="10"></line><line x1="80" y1="0" x2="100" y2="10"></line></svg><div><div><h3>Last Updated</h3><p>March 9th, 2023</p></div></div></article></div>
  </body>
</html>
