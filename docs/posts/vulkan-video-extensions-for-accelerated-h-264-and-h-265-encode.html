<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.khronos.org/blog/khronos-finalizes-vulkan-video-extensions-for-accelerated-h.264-and-h.265-encode">Original</a>
    <h1>Vulkan video extensions for accelerated H.264 and H.265 encode</h1>
    
    <div id="readability-page-1" class="page"><p><time itemprop="dateCreated" datetime="2023-12-19T06:00:00-08:00"><i></i> December 19, 2023</time>
        by <span itemprop="author">Lynne Iribarren, Khronos Member of the Vulkan Video TSG and Ahmed Abdelkhalek, AMD, Vulkan Video TSG Chair</span>
        <span itemtype="keywords"><i></i>
        
            <a href="https://www.khronos.org/news/tags/tag/vulkan" title="vulkan">vulkan</a>, 
            <a href="https://www.khronos.org/news/tags/tag/video" title="video">video</a>
        </span>
    </p><div itemprop="description">
    <p>In April 2021, the Vulkan® Working Group at Khronos® <a href="https://www.khronos.org/blog/an-introduction-to-vulkan-video">released a set of provisional extensions</a>, collectively referred to as ‘Vulkan Video’ which provide seamless encoding and decoding of video streams using a variety of video coding standards. The December 2022 release of Vulkan 1.3.238 saw the <a href="https://www.khronos.org/blog/khronos-finalizes-vulkan-video-extensions-for-accelerated-h.264-and-h.265-decode">finalization of the extensions to decode H.264 and H.265</a>, and today, with the release of Vulkan <strong>1.3.274</strong>, Khronos has finalized their counterpart: the extensions to enable <strong>encoding</strong> of H.264 and H.265 video streams. Leveraging the Vulkan framework, they provide a standardized, seamless, low-overhead, and highly controllable way to produce H.264 and H.265 video via hardware accelerators, with applications ranging from real-time, low-latency streaming to offline server-scale transcoding.</p>
<p>Incorporating industry feedback, the extensions saw many improvements since their introduction, from a bidirectional interface (overrides) to help with coding and exposing advanced hardware capabilities, to rate control configuration parameters and an interface to aid with quality vs. performance trade-offs. This feedback also prompted the release of the first video maintenance extension. In addition, given the high industry demand for AV1 codec support, an AV1 decode extension release is imminent, with an AV1 encode extension development also underway. Figure 1 depicts Vulkan Video extensions along with their status and relations.</p>


<figure><img src="https://www.khronos.org/assets/uploads/blogs/2023-blog-vulkan-video-1.jpg"/>Figure 1. Vulkan Video extensions</figure>


<p>The encode extensions grant low-level control over much of the encoding process, while still keeping the efficiency and performance of hardware encoding acceleration. Implementers have the freedom to tweak details such as quantization index, per-slice bit allocation, arithmetic coder, deblocking, and more. Given this flexibility and complexity, a balanced programming interface for rate control gives users a choice between more automated operation and low-level tweaking of frame parameters.</p>
<h2>So, What Changed?</h2>
<p>This section briefly summarizes the changes included in this release relative to <a href="https://www.khronos.org/blog/khronos-finalizes-vulkan-video-extensions-for-accelerated-h.264-and-h.265-decode">prior descriptions</a> of the Vulkan Video extensions.</p>
<h3>Changes to Video Encode</h3>
<h4>Encoder Rate Control</h4>
<p>Often the most important aspect of encoder configuration for applications, the encoder rate control API was given special attention in Vulkan Video. From exposing parameters for standard rate control modes (e.g. CBR/VBR), to allowing applications to provide hints about other intended stream encoding parameters (e.g. picture/reference patterns), to providing the ability to configure per-layer rate control parameters (e.g. for streams with multiple temporal layers), the rate control API offers a rich set of features for various use cases and lays a solid foundation for future extensions. Encoder rate control configuration is performed using the <strong><em>vkCmdControlVideoCodingKHR</em></strong> command.</p>
<h4>Encoder Quality Levels</h4>
<p>Video encoder implementations often fine tune the use of various encoding tools and rate control parameters depending on the desired quality versus performance/latency trade-offs of different use cases. Now implementations report the number of quality levels supported for a given video profile and usage. A new API <strong><em>vkGetPhysicalDeviceVideoEncodeQualityLevelPropertiesKHR </em></strong>may be used to retrieve implementation recommendations for various encoding parameters and configurations (e.g. rate control).</p>
<h4>Implementation Overrides</h4>
<p>Due to the complex nature of video encoding, and the ever-changing nature of hardware encoders and their capabilities, an interface, known as <strong>overrides</strong>, permits bidirectional communication that <strong>guarantees</strong> that the output video stream will be compliant. In addition, applications may opt-in for optimization overrides to allow implementations more flexibility to optimize for the specified usage and hints. Full disclosure about the occurrence of overrides for video session parameters or frame parameters is also reported for developers interested in more detailed analysis of such overrides.</p>
<h4>Retrieval of encoded video session parameters bitstream segments</h4>
<p>To facilitate implementation overrides for bitstream compliance and optimizations, applications are expected to retrieve the encoded video session parameter bitstream segments (e.g. H.264 SPS/PPS) from the implementation using the new API call <strong><em>vkGetEncodedVideoSessionParametersKHR</em></strong> against the given <strong><em>VkVideoSessionParametersKHR</em></strong> object.</p>
<h4>Encoder Feedback Query</h4>
<p>To allow future extension of encoder feedback statistics in a manner similar to pipeline statistics, the new <strong><em>VK_QUERY_TYPE_VIDEO_ENCODE_FEEDBACK_KHR</em></strong> is now used to retrieve the video bitstream offset and size.</p>
<p>Figure 2 depicts the Vulkan Video encoding process, which remains largely unchanged compared to previous descriptions.</p>


<figure><img src="https://www.khronos.org/assets/uploads/blogs/2023-blog-vulkan-video-2.jpg"/>Figure 2. Vulkan Video Encode Process</figure>


<h3>Changes to Video Decode &amp; Encode</h3>
<h4>VK_KHR_video_maintenance1</h4>
<p>Along with the video encoding extensions, Khronos is releasing a maintenance extension incorporating community and industry feedback, which improves flexibility for both decoding and encoding. This extension permits decoding implementations to create images usable with video decoding without the need to explicitly specify the video profiles they will be used with. The same applies for encoding, where an attached per-image video profile limits usability with large and complex transcoding frameworks.</p>
<p>In addition to flexibility improvements, a new, simpler interface for specifying video queries <strong>inline with video decode and encode operation commands</strong> has been added, known as inline queries.</p>
<h4>Requiring pSetupReferenceSlotKHR for non-reference pictures</h4>
<p>When the Vulkan Video decode extensions were finalized applications were required to provide a reconstructed picture resource and DPB slot (via <strong><em>VkVideoDecodeInfoKHR::pSetupReferenceSlot</em></strong>) only if the picture being decoded will become a reference. However, no shipping implementation actually supported specifying <strong><em>NULL</em></strong>for <strong><em>pSetupReferenceSlot</em></strong>, and further some implementations discovered cases that require the use of the reconstructed picture resource and/or DPB slot for transient storage during decoding a non-reference picture. A similar situation applies to encoding non-reference pictures. As a result, the vulkan video extensions were updated to require providing <strong><em>pSetupReferenceSlotKHR</em></strong> for non-reference pictures.</p>
<h2>I Want All The Details!</h2>
<p>The following <strong>proposal documents</strong> provide a much more detailed and thorough review of all finalized Vulkan Video extensions, including the rationale behind the chosen design approach, various issues encountered during the development of Vulkan Video and how they were resolved, as well as code samples to aid in application development:</p>
<ul>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_queue.adoc"><strong><em>VK_KHR_video_queue</em></strong></a></li>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_decode_queue.adoc"><strong><em>VK_KHR_video_decode_queue</em></strong></a></li>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_decode_h264.adoc"><strong><em>VK_KHR_video_decode_h264</em></strong></a></li>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_decode_h265.adoc"><strong><em>VK_KHR_video_decode_h265</em></strong></a></li>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_encode_queue.adoc"><strong><em>VK_KHR_video_encode_queue</em></strong></a></li>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_encode_h264.adoc"><strong><em>VK_KHR_video_encode_h264</em></strong></a></li>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_encode_h265.adoc"><strong><em>VK_KHR_video_encode_h265</em></strong></a></li>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs/blob/main/proposals/VK_KHR_video_maintenance1.adoc"><strong><em>VK_KHR_video_maintenance1</em></strong></a></li>
</ul>
<p>Developers interested in using Vulkan Video are strongly encouraged to read the above proposal documents - they really give you a good head start!</p>
<p>All details about the Vulkan Video API are available in the final extensions <strong>specification</strong> links:</p>
<ul>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_queue.html"><strong><em>VK_KHR_video_queue</em></strong></a></li>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_decode_queue.html"><strong><em>VK_KHR_video_decode_queue</em></strong></a></li>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_decode_h264.html"><strong><em>VK_KHR_video_decode_h264</em></strong></a></li>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_decode_h265.html"><strong><em>VK_KHR_video_decode_h265</em></strong></a></li>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_encode_queue.html"><strong><em>VK_KHR_video_encode_queue</em></strong></a></li>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_encode_h264.html"><strong><em>VK_KHR_video_encode_h264</em></strong></a></li>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_encode_h265.html"><strong><em>VK_KHR_video_encode_h265</em></strong></a></li>
<li><a href="https://registry.khronos.org/vulkan/specs/1.3-extensions/man/html/VK_KHR_video_maintenance1.html"><strong><em>VK_KHR_video_maintenance1</em></strong></a></li>
</ul>
<h2>Call for Action, Feedback &amp; Support!</h2>
<p>The finalization and release of these Vulkan Video extensions marks a significant milestone in the Vulkan ecosystem roadmap, adding fully accelerated H.264 and H.265 encode to this widely available cross-platform GPU API. We encourage developers to utilize these extensions to bring new levels of performance and functionality to their video applications on Windows and Linux.</p>
<p>We welcome you to join <a href="https://vulkan.org/events/vulkanised-2024">Vulkanised 2024</a> (February 5-7 in MountainView CA.), which will include a presentation &amp; live demo about Vulkan Video and much more!</p>
<p>NVIDIA, Intel &amp; AMD are the first IHVs implementing support for these extensions:</p>
<ul>
<li>NVIDIA: Windows and Linux <a href="https://developer.nvidia.com/vulkan-driver">BETA drivers</a> available now</li>
<li>Intel: Coming soon</li>
<li>AMD: Coming soon</li>
</ul>
<p>Additionally, the open-source drivers <a href="https://airlied.blogspot.com/2023/12/radv-vulkan-video-encode-status.html">RADV</a> and <a href="https://gitlab.freedesktop.org/zzoon/mesa/-/tree/h264enc_anv_4?ref_type=heads">ANV</a> are adding support for the finalized Vulkan Video encode extensions, in addition to already supporting the Vulkan Video decode extensions.</p>
<p>Strong ecosystem adoption continues for Vulkan Video, and there are several implementers of the spec:</p>
<ul>
<li>The <a href="https://github.com/nvpro-samples/vk_video_samples">reference app</a> part of the Vulkan Video samples repository with encoding support is coming soon in 1Q24.</li>
<li>FFmpeg, in a <a href="http://lynne.ee/vulkan-video-encoding.html">branch</a> currently under development, soon to be merged into the <a href="https://git.videolan.org/?p=ffmpeg.git;a=log;h=HEAD">main repository</a>.</li>
<li>Gstreamer, in a <a href="https://gitlab.freedesktop.org/gstreamer/gstreamer/-/merge_requests/5739">branch</a> currently under development and a description of the journey can be found <a href="https://blogs.igalia.com/scerveau/vulkan-video-encoder-in-gstreamer/">here</a>.</li>
</ul>
<p>Those interested in testing the code should follow their guidelines and are welcome to submit feedback.</p>
<p>An upcoming release of Vulkan SDK will include updated Vulkan headers and Validation Layer support for the newly released video extensions. In the meantime, you can find the Vulkan headers <a href="https://github.com/KhronosGroup/Vulkan-Headers">here</a>.</p>
<p>We look forward to your use and feedback on Vulkan Video! Please share your experience and thoughts through the <a href="https://github.com/KhronosGroup/Vulkan-Docs/issues/2284">Vulkan Video Encode Release GitHub Issue</a>. This issue will also be updated to provide links to Vulkan Video-related resources as they become available.</p>
<p>We also encourage your participation in extending Vulkan Video to support more codecs and features. See <a href="https://www.khronos.org/members/">khronos.org/members</a> for information about how to join Khronos and participate in the definition of any of our standards.</p>
<p>Thank you for your interest and support of Vulkan Video. We hope you find it effective for your use cases and applications, and we look forward to supporting your needs with more codecs and features!</p>

    </div></div>
  </body>
</html>
