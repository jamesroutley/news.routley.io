<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://rtpg.co/2023/03/02/quines-for-dummies.html">Original</a>
    <h1>Writing the Most Boring Quine</h1>
    
    <div id="readability-page-1" class="page"><article>
    <p>Quines are programs that, when you run, will print out its own source text.</p>
<p>You can <a href="http://www.madore.org/~david/computers/quine.html">read this very long article</a> about how to write one in C. Here we&#39;re going to do it in Python and skip a lot of the details and theory.</p>
<p>You can, of course, &#34;just&#34; read the data from disk:</p>
<div><pre><span></span><code><span>import</span> <span>sys</span>

<span>print</span><span>(</span><span>open</span><span>(</span><span>sys</span><span>.</span><span>argv</span><span>[</span><span>0</span><span>],</span> <span>&#39;r&#39;</span><span>)</span><span>.</span><span>read</span><span>())</span>
</code></pre></div>

<p>This is obviously cheating though. It only works if we call it the right way, and is dependent on the command line to work. Really we want something pure that can be done in most programming languages. Something solid.</p>
<p>Firstly... we want a program that prints out a result. So we&#39;ll need at least one print statement.</p>


<p>This prints out one empty line, but establishes a first thing: we would like to print out <code>print</code>!</p>


<p>So this prints out <code>print()</code>. But now we&#39;re going from two <code>print</code>s down to one.</p>
<p>Right now we have a bit of a problem. If we add a character to the string we print, then our output gets 1 character longer, but so does our target.</p>
<p>We need our output to be the same as the code. So we need the length of our output to catch up to the length of the code.</p>
<p>It&#39;s, of course, very easy to make our output much longer than the length of the source code by doing things like:</p>
<div><pre><span></span><code><span>for</span> \<span>_</span> <span>in</span> <span>range</span><span>(</span><span>100</span><span>):</span>
  <span>print</span><span>(</span><span>&#34;print()&#34;</span><span>)</span>
</code></pre></div>

<p>This will make our output much longer than the source code, though also not very close to the source code.</p>
<p>We want to compress our output data so that we have some chance to catch up.</p>
<p>We have at least two <code>print</code>s in the existing code, so let&#39;s start there.</p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#34;print&#34;</span>
<span>print</span><span>(</span><span>&#34;</span><span>%s</span><span>()&#34;</span> <span>%</span> <span>p</span><span>)</span>
</code></pre></div>

<p>(<code>some_str % parameters</code> is Python&#39;s equivalent to <code>printf</code>, where the string parameters get placed at <code>%s</code>)</p>
<p>This feels like we are going in the wrong direction! Not only have we added more characters, but now there&#39;s not even two <code>print</code> statements, so our compression idea is failing!</p>
<p>But we&#39;re actually on the right track, because we have decoupled our output length from the code length, at least a bit.</p>
<p>Let&#39;s first try to fix our print statement to at least print this new first statement.</p>
<p>As a note, <code>&#34;-&gt;%r&#34; % &#34;abc&#34;</code>gives <code>&#34;-&gt;&#39;abc&#39;&#34;</code>, we are rendering Python values with <code>repr</code> instead of <code>str</code>.</p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#34;print&#34;</span>
<span>print</span><span>(</span><span>&#34;p = </span><span>%r</span><span>\n</span><span>%s</span><span>()&#34;</span> <span>%</span> <span>(</span><span>p</span><span>,</span> <span>p</span><span>))</span>
</code></pre></div>

<p>The above percentage soup gives us, in output:</p>


<p>Now we seem to still have a problem with this <code>print</code> statement. But where as before we were having trouble reproducing the outermost <code>print</code>, now our problem is about generating the innards.</p>
<p>If we try to write the innards of the <code>print</code> statement, we&#39;re going to run into an endless recursion</p>
<div><pre><span></span><code><span>print</span><span>(</span><span>&#34;p = </span><span>%r</span><span>\n</span><span>%s</span><span>(?)&#34;</span> <span>%</span> <span>(</span><span>p</span><span>,</span> <span>p</span><span>))</span>
<span>print</span><span>(</span><span>&#34;p = </span><span>%r</span><span>\n</span><span>%s</span><span>(&#39;p = </span><span>%%</span><span>r</span><span>\n</span><span>%%</span><span>s(?)&#39;)&#34;</span> <span>%</span> <span>(</span><span>p</span><span>,</span> <span>p</span><span>))</span>
</code></pre></div>

<p>Tryin to fill in the <code>?</code> with itself is getting us nowhere fast.</p>
<p>But notice how we <em>don&#39;t</em> have to write the <code>print</code> statement within the <code>print</code> statement anymore. Sure, this was a dead end, but the idea is sound. How can we avoid mentioning the template again?</p>
<p>Let&#39;s factor out this template string into a value called <code>t</code>.</p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#34;print&#34;</span>
<span>t</span> <span>=</span> <span>&#34;p = </span><span>%r</span><span>\n</span><span>%s</span><span>()&#34;</span>
<span>print</span><span>(</span><span>t</span> <span>%</span> <span>(</span><span>p</span><span>,</span> <span>p</span><span>))</span>
</code></pre></div>

<p>From here, again, we want to print out this new assignment by adding <code>t = %r</code></p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#34;print&#34;</span>
<span>t</span> <span>=</span> <span>&#34;p = </span><span>%r</span><span>\n</span><span>t = </span><span>%r</span><span>\n</span><span>%s</span><span>()&#34;</span>
<span>print</span><span>(</span><span>t</span> <span>%</span> <span>(</span><span>p</span><span>,</span> <span>t</span><span>,</span> <span>p</span><span>))</span>
</code></pre></div>

<p>This gets us to the following output:</p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#39;print&#39;</span>
<span>t</span> <span>=</span> <span>&#39;p = </span><span>%r</span><span>\n</span><span>t = </span><span>%r</span><span>\n</span><span>%s</span><span>()&#39;</span>
<span>print</span><span>()</span>
</code></pre></div>

<p>We still do not have the innards of the <code>print</code> call!</p>
<p>The important thing that just happened though is that our attempts to &#34;catch up&#34; to the end of the code has gotten us to a point where we are no longer needing to infinitely expand our template.</p>
<p>We can add new text to the value of <code>t</code>, and that will be nicely reproduced in our end result because we are doing <code>t % (p, t, p)</code>, i.e. injecting the template into the end result.</p>
<p>By typing just one character into <code>t</code>, we can extend our output by <em>2</em> characters!</p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#34;print&#34;</span>
<span>t</span> <span>=</span> <span>&#34;p = </span><span>%r</span><span>\n</span><span>t = </span><span>%r</span><span>\n</span><span>%s</span><span>(t)&#34;</span>
<span>print</span><span>(</span><span>t</span> <span>%</span> <span>(</span><span>p</span><span>,</span> <span>t</span><span>,</span> <span>p</span><span>))</span>
</code></pre></div>

<p>This program outputs</p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#39;print&#39;</span>
<span>t</span> <span>=</span> <span>&#39;p = </span><span>%r</span><span>\n</span><span>t = </span><span>%r</span><span>\n</span><span>%s</span><span>(t)&#39;</span>
<span>print</span><span>(</span><span>t</span><span>)</span>
</code></pre></div>

<p>We have finally caught our own tail, and now are simply starting to type the innards of the (now no longer infinitely recursive) print statement.</p>
<p>Let&#39;s finish typing things up, and fix the quotes to match what <code>repr</code> does to our strings</p>
<div><pre><span></span><code><span>p</span> <span>=</span> <span>&#39;print&#39;</span>
<span>t</span> <span>=</span> <span>&#39;p = </span><span>%r</span><span>\n</span><span>t = </span><span>%r</span><span>\n</span><span>%s</span><span>(t </span><span>%%</span><span> (p, t, p))&#39;</span>
<span>print</span><span>(</span><span>t</span> <span>%</span> <span>(</span><span>p</span><span>,</span> <span>t</span><span>,</span> <span>p</span><span>))</span>
</code></pre></div>

<p>The above is a quine. You run it, and the output is the same as the input. We meandered a bit but finally got there.</p>
<p>Here <code>p</code> isn&#39;t really pulling its weight, let&#39;s clean that up.</p>
<div><pre><span></span><code><span>t</span> <span>=</span> <span>&#39;t = </span><span>%r</span><span>\n</span><span>print(t </span><span>%%</span><span> t)&#39;</span>
<span>print</span><span>(</span><span>t</span> <span>%</span> <span>t</span><span>)</span>
</code></pre></div>

<p>This is, honestly, a bit of an unexciting quine. At this point modifying the source simply involves adding the source, and updating the template.</p>
<p>There are no more real mysteries or challenges to reproducing the exact code itself. The magic is gone, but in its place the minimal quine can help serve as a piece of a larger puzzle.</p>
<p>You could make your quine change over time. The simplest example of this would be with a run count:</p>
<div><pre><span></span><code><span>run_count</span> <span>=</span> <span>0</span>
<span>t</span> <span>=</span> <span>&#39;run_count = </span><span>%s</span><span>\n</span><span>t = </span><span>%r</span><span>\n</span><span>print(t </span><span>%%</span><span> (run_count + 1, t))&#39;</span>
<span>print</span><span>(</span><span>t</span> <span>%</span> <span>(</span><span>run_count</span> <span>+</span> <span>1</span><span>,</span> <span>t</span><span>))</span>
</code></pre></div>

<p>But seeing the bones of the quine too easily removes some of the magic. The point of quines is that they are unintelligable, abusing some weird mechanism.</p>
<p>Instead of using this code directly, you can take this core idea of injecting a template into itself, to think of ways of chaining together interesting behavior. Obfuscate in interesting ways, with weird layout. But mostly try to have fun.</p>
  </article></div>
  </body>
</html>
