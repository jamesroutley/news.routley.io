<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.railsexplained.com/pages/hunting-for-gems/">Original</a>
    <h1>Hunting for Gems: How Ruby&#39;s package management system evolved</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>It‚Äôs time for another installment in our series on loading code in Rails.</p>

<p>We have already discussed:</p>

<ul>
  <li><a href="https://www.railsexplained.com/pages/loading-files-in-ruby/">Part 1 - Loading Files In Ruby</a></li>
  <li><a href="https://www.railsexplained.com/pages/loading-files-in-rails/">Part 2 - Loading Files in Rails</a> (using Ruby‚Äôs in-built mechansims and the Autoloader)</li>
</ul>

<p>But so far, we‚Äôve not talked about gems. ‚ÄúGem‚Äù is the Ruby community‚Äôs name for libraries - essentially other people‚Äôs code.</p>

<p>Using other people‚Äôs code instead of writing your own saves a lot of time, so it‚Äôs an important part of the story.</p>

<h2 id="a-trip-back-in-time">A trip back in time</h2>

<p>Back in the 90s, Ruby was a cool programming language. Probably it‚Äôs what Thomas Anderson was using before he got kicked out of the Matrix.</p>

<p>Unfortunately, it was super janky to share Ruby code with other people. You could download code from other people‚Äôs websites. Then you chucked the code into a folder in the <code>$LOAD_PATH</code>[^setup-rb]. By default, most Ruby libraries were put into a single global folder called <code>/site_ruby</code>[^vendoring].</p>

<p><img src="https://www.railsexplained.com/assets/ruby_casually_storing_code.png" alt="Rubygems"/></p>
<center><em>&#34;I&#39;m sure I&#39;ll find it there later&#34;</em></center>


<p>So, let‚Äôs say you needed a libary called <code>calculator</code>. You‚Äôd add this code to your project:</p>



<p>Ruby goes hunting through all the directories in the <code>$LOAD_PATH</code> array to find a file named <code>calculator.rb</code>.</p>

<p>You‚Äôve already downloaded <code>calculator.rb</code>, and put it in <code>/site_ruby</code> (and you‚Äôve added <code>/site_ruby</code> to  the <code>$LOAD_PATH</code>) - so you‚Äôre good to go üëç.</p>

<h2 id="more-versions-more-problems">More versions, more problems</h2>

<p>But now what if your colleague tells you about a new version of calculator that has just comes out? (It has a new ‚Äúmutiply‚Äù feature that you‚Äôre excited about.)</p>

<p>So, now you have to:</p>

<ul>
  <li>go to the <code>calculator.rb</code> website</li>
  <li>download the latest version of the code (hoping it‚Äôs the right one, there‚Äôs no standard way to check)</li>
  <li>delete all the files from the old <code>calculator.rb</code> (sorry, there‚Äôs no uninstall)</li>
  <li>copy the new code into <code>site_ruby</code> where you keep all your libraries</li>
</ul>

<p>If you did all these steps, you were probably fine. But it was pretty tedious and manual. It was up to you to manage your <code>$LOAD_PATH</code> to ensure that there were no conflicts[^also-catastrophes].</p>
<h2 id="rubygems-to-the-rescue">RubyGems to the Rescue</h2>

<p>So in 2003, RubyGems was released.</p>

<p><img src="https://www.railsexplained.com/assets/rubygems.png" alt="Rubygems" width="250"/></p>
<center><em>RubyGems - here to solve your gem versioning issues</em></center>


<p>RubyGems makes things a lot easier:</p>

<ul>
  <li>it hosts your code for you (at <a href="https://rubygems.org">rubygems.org</a>) ü•≥</li>
  <li>it downloads the code and installs the code for you with a single terminal command üëç</li>
  <li>it lets you download specific versions each library ü•á</li>
  <li>it lets you specify which version of the library each piece of Ruby code needs üéâ</li>
  <li>it uninstalls each gem for you üòÑ</li>
</ul>

<p>This is great. It removes a lot of the tedium. Instead of all the downloading and uninstalling, we can now just run</p>
<div><div><pre><code><span>$:</span> gem <span>install </span>calculator
</code></pre></div></div>
<p>and the code (and all its dependencies) get magically installed onto your machine for you to use.</p>

<p>Now if you want to use this gem, you can just add:</p>

<p>Through a clever hack[^the-clever-hack], Ruby will pass over control to RubyGems and ask it to add a folder containing this gem to the <code>$LOAD_PATH</code>. Magic. ‚ú®</p>

<h2 id="can-we-be-more-specific">Can we be more specific?</h2>

<p>By default, RubyGems will download and use the latest version of a gem. If you want to download or use a specific version though, RubyGems lets you do that too.</p>

<p>To install a specific version:</p>

<div><div><pre><code><span>$:</span> gem <span>install </span>calculator <span>-v</span> 1.0
</code></pre></div></div>
<p>Then put this in your Ruby code to use that version:</p>

<p>By using the <code>gem</code> method in your Ruby code, you are ‚Äúactivating‚Äù the gem. This means that RubyGems is adding the folder containing the gem to the <code>$LOAD_PATH</code>. Then when Ruby <code>requires</code> the gem, it will find the right gem code.</p>

<p>You can even specify that you want a gem version that falls between two versions, and Ruby wil look within all your versions of that gem and return one that satisfies these constraints.</p>

<div><div><pre><code><span>gem</span> <span>&#34;calculator&#34;</span><span>,</span> <span>&#34;&gt;= 1.1&#34;</span><span>,</span> <span>&#34;&lt; 2&#34;</span>
</code></pre></div></div>
<p>Or you can use the pessimistic operator[^pessimistic-operator] <code>~&gt;</code> to allow upgrades but avoid breaking changes.</p>
<div><div><pre><code><span>gem</span> <span>&#34;calculator&#34;</span><span>,</span> <span>&#34;~&gt; 1.1&#34;</span>
</code></pre></div></div>

<p>Rubygems will look for versions that satisfy these constraints <em>among the versions that you have installed on your machine</em>. So, if you start on a new project that specifies a version of <code>calculator</code> <code>~&gt; 1.1</code>, and you have <code>v1.5</code> of <code>calculator</code> on your machine already, RubyGems will activate that version.</p>

<h2 id="putting-it-into-practice">Putting it into practice</h2>

<p>This was great for people who regularly ran more than one Ruby project on their computer. Now you could easily use <code>v1.0</code> of a gem in one project and <code>v2.0</code> in another.</p>

<p>Rails developed a syntax (which used RubyGems <code>gem</code> method under the hood) for specifying the gems that each project needed.</p>

<div><div><pre><code><span>Rails</span><span>::</span><span>Initializer</span><span>.</span><span>run</span> <span>do</span> <span>|</span><span>config</span><span>|</span>
  <span>config</span><span>.</span><span>gem</span> <span>&#34;nokogiri&#34;</span><span>,</span> <span>:version</span> <span>=&gt;</span> <span>&#34;1.4.2&#34;</span>
  <span>config</span><span>.</span><span>gem</span> <span>&#34;paperclip&#34;</span><span>,</span> <span>:version</span> <span>=&gt;</span> <span>&#34;2.3.3&#34;</span>
<span>end</span>
</code></pre></div></div>

<p>Often people used a <code>rake gem:install</code> command to install all of these gems with a single command.</p>

<h2 id="however">However‚Ä¶</h2>

<p>While RubyGems was pretty great, a pretty major problem still lurked. Solving this problem would require the final piece in our Ruby dependency management story.</p>

<p>Read the final part of our series here - <a href="https://www.railsexplained.com/pages/unpacking-bundler/">Part 4 - Unpacking Bundler</a></p>

    




  </div></div>
  </body>
</html>
