<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://til.simonwillison.net/llms/dolly-2">Original</a>
    <h1>Running Dolly 2.0 on Paperspace</h1>
    
    <div id="readability-page-1" class="page"><section>



<p><a href="https://www.databricks.com/blog/2023/04/12/dolly-first-open-commercially-viable-instruction-tuned-llm" rel="nofollow">Dolly 2.0</a> looks to be a big deal. It calls itself &#34;the first open source, instruction-following LLM, fine-tuned on a human-generated instruction dataset licensed for research and commercial use.&#34;</p>
<p>I&#39;ve been trying to run it. I failed to get it to work on my M2 MacBook Pro, so I fired up a 30GB GPU instance on <a href="https://paperspace.com/" rel="nofollow">Paperspace</a> instead.</p>
<p>It sort-of worked. It&#39;s taking nearly 12 minutes to respond to a prompt yet, so I&#39;m suspicious that I&#39;m not using the right incantations to get it to actually run on the GPU there.</p>
<p>Here&#39;s what I did.</p>
<ol>
<li>Sign into Paperspace with my GitHub account</li>
<li>Start a new instance - I used the &#34;from scratch&#34; option</li>
<li>Open the web-based terminal, run <code>python -v</code> to confirm it has Python (it&#39;s running 3.9.16)</li>
<li><code>pip install transformers torch accelerate -U</code></li>
<li>Run <code>python</code>
</li>
</ol>
<p>Then within Python I ran this:</p>
<div><pre><span>from</span> <span>transformers</span> <span>import</span> <span>pipeline</span>
<span>import</span> <span>torch</span>
<span>import</span> <span>time</span>

<span>instruct_pipeline</span> <span>=</span> <span>pipeline</span>(
    <span>model</span><span>=</span><span>&#34;databricks/dolly-v2-12b&#34;</span>,
    <span>torch_dtype</span><span>=</span><span>torch</span>.<span>bfloat16</span>,
    <span>trust_remote_code</span><span>=</span><span>True</span>,
    <span>device_map</span><span>=</span><span>&#34;auto&#34;</span>
)</pre></div>
<p>I wrote a little utility function to measure my prompt response time:</p>
<div><pre><span>def</span> <span>prompt</span>(<span>s</span>):
    <span>start</span> <span>=</span> <span>time</span>.<span>time</span>()
    <span>response</span> <span>=</span> <span>instruct_pipeline</span>(<span>s</span>)     
    <span>end</span> <span>=</span> <span>time</span>.<span>time</span>()
    <span>print</span>(<span>end</span> <span>-</span> <span>start</span>)
    <span>return</span> <span>response</span></pre></div>
<p>Then tested it like this:</p>
<div><pre>&gt;&gt;&gt; prompt(<span><span>&#34;</span>First man on the moon?<span>&#34;</span></span>)
716.0470576286316</pre></div>
<p>The response:</p>
<blockquote>
<p>Apollo 11 was the American spaceflight that first landed humans on the Moon. Commander Neil Armstrong and lunar module pilot Buzz Aldrin landed the Apollo Lunar Module Eagle on July 20, 1969, at 20:17,  and Armstrong became the first person to step onto the Moon&#39;s surface six hours and 39 minutes later, on July 21 at 02:56 UTC. Aldrin joined him 19 minutes later, and they spent about two and a quarter hours together exploring the site they had named Tranquility Base upon landing. Armstrong and Aldrin collected 47.5 pounds (21.5 kg) of lunar material to bring back to Earth as pilot Michael Collins flew the Apollo Command Module Columbia in lunar orbit, and were on the Moon&#39;s surface for 21 hours, 36 minutes before lifting off to rejoin Columbia.</p>
</blockquote>
<p>The good news: it generated a decent looking answer! But it took 716s - nearly 12 minutes - to do that.</p>
<p>I&#39;m clearly doing something wrong here.</p>




  <h3>Related</h3>
  


<p>Created 2023-04-12T09:02:56-07:00 Â· <a href="https://github.com/simonw/til/blob/main/llms/dolly-2.md">Edit</a></p>

</section></div>
  </body>
</html>
