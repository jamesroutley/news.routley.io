<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/abdimoallim/vdb">Original</a>
    <h1>A header-only C vector database library</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A lightweight, header-only C library for storing and searching high-dimensional vector embeddings with optional multithreading support.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/abdimoallim/vdb/blob/main/benchmark.png"><img src="https://github.com/abdimoallim/vdb/raw/main/benchmark.png" alt=""/></a></p>

<ul dir="auto">
<li>Header-only implementation (single file: <code>vdb.h</code>)</li>
<li>Multiple distance metrics (cosine, euclidean, dot product)</li>
<li>Optional thread-safe operations via <code>#define VDB_MULTITHREADED</code></li>
<li>Save/load database to/from disk</li>
<li>Custom memory allocators support</li>
<li>No dependencies (except <code>pthreads</code> for multithreading)</li>
<li>Python bindings (refer to <a href="https://github.com/abdimoallim/vdb/blob/main/vdb.py"><code>vdb.py</code></a>)</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="/*test.c*/
#include &#34;vdb.h&#34;

int main(void) {
  vdb_database *db = vdb_create(128, VDB_METRIC_COSINE);

  float embedding[128] = { /* ... */ };
  vdb_add_vector(db, embedding, &#34;vec1&#34;, NULL);

  float query[128] = { /* ... */ };
  vdb_result_set *results = vdb_search(db, query, 5);

  vdb_free_result_set(results);
  vdb_destroy(db);
  return 0;
}"><pre><span>/*test.c*/</span>
<span>#include</span> <span>&#34;vdb.h&#34;</span>

<span>int</span> <span>main</span>(<span>void</span>) {
  <span>vdb_database</span> <span>*</span><span>db</span> <span>=</span> <span>vdb_create</span>(<span>128</span>, <span>VDB_METRIC_COSINE</span>);

  <span>float</span> <span>embedding</span>[<span>128</span>] <span>=</span> { <span>/* ... */</span> };
  <span>vdb_add_vector</span>(<span>db</span>, <span>embedding</span>, <span>&#34;vec1&#34;</span>, <span>NULL</span>);

  <span>float</span> <span>query</span>[<span>128</span>] <span>=</span> { <span>/* ... */</span> };
  <span>vdb_result_set</span> <span>*</span><span>results</span> <span>=</span> <span>vdb_search</span>(<span>db</span>, <span>query</span>, <span>5</span>);

  <span>vdb_free_result_set</span>(<span>results</span>);
  <span>vdb_destroy</span>(<span>db</span>);
  <span>return</span> <span>0</span>;
}</pre></div>
<p dir="auto">Include <a href="https://github.com/abdimoallim/vdb/blob/main/vdb.h"><code>vdb.h</code></a> and compile with either approach, <code>pthreads</code> is not necessarily available which is why this is behind a flag.</p>
<p dir="auto"><strong>Single-threaded:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="gcc -O2 test.c -o test -lm"><pre>gcc -O2 test.c -o <span>test</span> -lm</pre></div>
<p dir="auto"><strong>Multi-threaded:</strong></p>
<div dir="auto" data-snippet-clipboard-copy-content="gcc -O2 -DVDB_MULTITHREADED test.c -o test -lpthread -lm"><pre>gcc -O2 -DVDB_MULTITHREADED test.c -o <span>test</span> -lpthread -lm</pre></div>


<p dir="auto"><strong><code>vdb_database *vdb_create(size_t dimensions, vdb_metric metric)</code></strong>
Creates a new vector database.</p>
<p dir="auto"><strong><code>void vdb_destroy(vdb_database *db)</code></strong>
Frees all resources associated with the database.</p>
<p dir="auto"><strong><code>size_t vdb_count(const vdb_database *db)</code></strong>
Returns the number of vectors in the database.</p>
<p dir="auto"><strong><code>size_t vdb_dimensions(const vdb_database *db)</code></strong>
Returns the dimensionality of vectors.</p>

<p dir="auto"><strong><code>vdb_error vdb_add_vector(vdb_database *db, const float *data, const char *id, void *metadata)</code></strong>
Adds a vector to the database with optional ID and metadata.</p>
<p dir="auto"><strong><code>vdb_error vdb_remove_vector(vdb_database *db, size_t index)</code></strong>
Removes a vector at the specified index.</p>
<p dir="auto">**<code>vdb_error vdb_get_vector(const vdb_database \*db, size_t index, float **out_data, char **out_id, void **out_metadata)</code>**
Retrieves a vector and its metadata.</p>

<p dir="auto"><strong><code>vdb_result_set *vdb_search(const vdb_database *db, const float *query, size_t k)</code></strong>
Performs <a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" rel="nofollow">k-nearest neighbor</a> search. Returns NULL on error.</p>
<p dir="auto"><strong><code>void vdb_free_result_set(vdb_result_set *result_set)</code></strong>
Frees search results.</p>

<p dir="auto"><strong><code>vdb_error vdb_save(const vdb_database *db, const char *filename)</code></strong>
Saves the database to disk.</p>
<p dir="auto"><strong><code>vdb_database *vdb_load(const char *filename)</code></strong>
Loads a database from disk.</p>

<ul dir="auto">
<li><code>VDB_METRIC_COSINE</code> - Cosine distance (1 - cosine similarity)</li>
<li><code>VDB_METRIC_EUCLIDEAN</code> - Euclidean (L2) distance</li>
<li><code>VDB_METRIC_DOT_PRODUCT</code> - Negative dot product</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="VDB_OK = 0
VDB_ERROR_NULL_POINTER = -1
VDB_ERROR_INVALID_DIMENSIONS = -2
VDB_ERROR_OUT_OF_MEMORY = -3
VDB_ERROR_NOT_FOUND = -4
VDB_ERROR_INVALID_INDEX = -5
VDB_ERROR_THREAD_FAILURE = -6"><pre><span>VDB_OK</span> <span>=</span> <span>0</span>
<span>VDB_ERROR_NULL_POINTER</span> <span>=</span> <span>-1</span>
<span>VDB_ERROR_INVALID_DIMENSIONS</span> <span>=</span> <span>-2</span>
<span>VDB_ERROR_OUT_OF_MEMORY</span> <span>=</span> <span>-3</span>
<span>VDB_ERROR_NOT_FOUND</span> <span>=</span> <span>-4</span>
<span>VDB_ERROR_INVALID_INDEX</span> <span>=</span> <span>-5</span>
<span>VDB_ERROR_THREAD_FAILURE</span> <span>=</span> <span>-6</span></pre></div>

<p dir="auto">Define before including <code>vdb.h</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="#define VDB_MALLOC my_malloc
#define VDB_FREE my_free
#define VDB_REALLOC my_realloc
#include &#34;vdb.h&#34;"><pre><span>#define</span> <span>VDB_MALLOC</span> my_malloc
<span>#define</span> <span>VDB_FREE</span> my_free
<span>#define</span> <span>VDB_REALLOC</span> my_realloc
<span>#include</span> <span>&#34;vdb.h&#34;</span></pre></div>

<p dir="auto">When compiled with <code>VDB_MULTITHREADED</code>, all operations are thread-safe using read-write locks:</p>
<ul dir="auto">
<li>Multiple threads can search simultaneously</li>
<li>Add/remove operations are exclusive</li>
<li>No external locking required</li>
</ul>

<p dir="auto">vdb uses a binary format with magic number <code>0x56444230</code>:</p>
<ul dir="auto">
<li>Header: magic (4 bytes), dimensions, count, metric</li>
<li>Vectors: float array + ID length + ID string (for each vector)</li>
<li>Metadata is not persisted</li>
</ul>

<p dir="auto">Apache v2.0 License</p>
</article></div></div>
  </body>
</html>
