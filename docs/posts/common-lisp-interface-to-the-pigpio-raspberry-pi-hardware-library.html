<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/jetmonk/cl-pigpio">Original</a>
    <h1>Common Lisp interface to the pigpio Raspberry Pi hardware library</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">A Common Lisp interface to the Rapsberry Pi <a href="https://abyz.me.uk/rpi/pigpio/" rel="nofollow">pigpio</a> library (<a href="https://github.com/joan2937/pigpio">pigpio on github</a>)</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-description" aria-hidden="true" tabindex="-1" href="#description"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Description</h2>
<p dir="auto"><a href="https://abyz.me.uk/rpi/pigpio/" rel="nofollow"><em>pigpio</em></a> is a library to provide a
simplified interface to the Raspberry Pi&#39;s hardware devices, like SPI,
I2C, Serial, and GPIO.</p>
<p dir="auto"><em>pigpio</em> has 1) a direct hardware version (linking with <em>libpigpio.so</em>) that
requires the program using it to run as root; and 2) a <em>pigpiod</em>
daemon (linked with <em>libpigpiod_if2.so</em>) that allows user-land
programs to accesss hardware via network calls to the daemon.</p>
<p dir="auto"><em>CL-PIGPIO</em> links with both libraries, and allows the user to select
whether the hardware or the daemon form is called.  If the hardware
version is activated but the user&#39;s program is not running with root
privileges, an error is generated.</p>
<p dir="auto">Only one of the two (hardware or daemon) can be run on the same RPi, but
the daemon on other RPis can be accessed remotely.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-installing" aria-hidden="true" tabindex="-1" href="#installing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installing</h3>
<p dir="auto">Install in your usual Lisp package tree and run</p>
<div data-snippet-clipboard-copy-content="(asdf:load-system &#34;cl-pigpio&#34;)"><pre><code>(asdf:load-system &#34;cl-pigpio&#34;)
</code></pre></div>
<p dir="auto">or, for just the low level FFI, run</p>
<div data-snippet-clipboard-copy-content="(asdf:load-system &#34;pigpio-ffi-universal&#34;)"><pre><code>(asdf:load-system &#34;pigpio-ffi-universal&#34;)
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-low-level-ffi-interface" aria-hidden="true" tabindex="-1" href="#low-level-ffi-interface"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Low level FFI interface</h2>
<p dir="auto">The unified <em>pigpio/pigpiod</em> interface is in the
<em>pigpio-ffi-universal</em> package.</p>
<p dir="auto">Here, the routines are generally the same as
<a href="https://abyz.me.uk/rpi/pigpio/cif.html" rel="nofollow">documented in the C pigpio
interface</a> but with an
additional keyword device specifier.</p>
<p dir="auto">For example, if the C library has</p>
<div data-snippet-clipboard-copy-content="  int i2cOpen(unsigned i2cBus, unsigned i2cAddr, unsigned i2cFlags);"><pre><code>  int i2cOpen(unsigned i2cBus, unsigned i2cAddr, unsigned i2cFlags);
</code></pre></div>
<p dir="auto">then the Lisp version has</p>
<div data-snippet-clipboard-copy-content="  (pigpio-ffi-universal:pigpio-i2copen
         i2cbus i2caddr i2cflags
         &amp;key (pidev pigpio-ffi-unversal:*default-pidev*))"><pre><code>  (pigpio-ffi-universal:pigpio-i2copen
         i2cbus i2caddr i2cflags
         &amp;key (pidev pigpio-ffi-unversal:*default-pidev*))
</code></pre></div>
<p dir="auto">The <em>pidev</em> keyword argument can be set as</p>
<div data-snippet-clipboard-copy-content="  ;; daemon form, setting *default-pidev* to this device
  (pigpio-ffi-universal:open-pidev/daemon :host &#34;localhost&#34; :port &#34;8888&#34;
                                          :set-default t)
  ;; OR open hardware device, this time not setting the default variable
  (defparameter *my-pidev*
     (pigpio-ffi-universal:open-pidev/hardware :set-default nil))"><pre><code>  ;; daemon form, setting *default-pidev* to this device
  (pigpio-ffi-universal:open-pidev/daemon :host &#34;localhost&#34; :port &#34;8888&#34;
                                          :set-default t)
  ;; OR open hardware device, this time not setting the default variable
  (defparameter *my-pidev*
     (pigpio-ffi-universal:open-pidev/hardware :set-default nil))
</code></pre></div>
<p dir="auto">It is necessary to open a device before making any pigpio/pigpiod calls.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-higher-level-interface" aria-hidden="true" tabindex="-1" href="#higher-level-interface"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Higher level interface</h2>
<p dir="auto">The <em>cl-pigpio</em> package contains a higher level interface to SPI, I2C, and GPIO.</p>
<p dir="auto">This interface is not documented in detail, but the exported functions
are visible in <em>cl-pigpio-package.lisp</em>, and the functions generally
have good documentation strings.  I2C, SPI, and GPIO have separate
source files.</p>
<p dir="auto">The purpose of the higher level interface is to translate opaque data
like I2C flags into more easily understable Lisp keywords, and to
perform FFI calls using Lisp buffers rather than using CFFI foreign
pointers.</p>
<p dir="auto">The high level routines also throw a descriptive Lisp error if the
pigpio library returns an error.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-glitches-and-gotchas" aria-hidden="true" tabindex="-1" href="#glitches-and-gotchas"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Glitches and gotchas</h2>
<ul dir="auto">
<li>pigpio does not work for RPi5 (yet?) because hardware interface is not documented</li>
<li>signals are turned off in the hardware version using <code>gpioCfgGetInternals()</code> to prevent clashes with any Lisp use of signals.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-dependencies" aria-hidden="true" tabindex="-1" href="#dependencies"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Dependencies</h2>
<p dir="auto">Tested with 64 bit SBCL, on Bookworm.</p>
<ul dir="auto">
<li><a href="https://github.com/cffi/cffi"><em>cffi</em></a></li>
<li><a href="https://github.com/joan2937/pigpio"><em>pigpio</em></a>, which can be installed as a standard RPi Linux package.</li>
</ul>
</article>
          </div></div>
  </body>
</html>
