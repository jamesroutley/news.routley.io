<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/mgarciaisaia/JavaScript-Is-Weird-as-a-compressor">Original</a>
    <h1>JavaScript-Is-Weird as a compressor</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Have you seen the &#34;JavaScript Is Weird (EXTREME EDITION)&#34; video?</p>
<p dir="auto"><a href="https://www.youtube.com/watch?v=sRWE5tnaxlI" rel="nofollow">This one</a>, in case you&#39;re
wandering &#34;which one of them?&#34;.</p>
<p dir="auto">It&#39;s a ~22-minute video that abuses type coercion issues in JavaScript
to create a prototype of a JavaScript transpiler that outputs valid code
consistinting of only the symbols <code>( ) = &gt; { } [ + ] ! / -</code>. As an
example, this &#34;Hello, world!&#34; program in JavaScript:</p>
<div dir="auto" data-snippet-clipboard-copy-content="console.log(&#34;Hello world!&#34;);"><pre><span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Hello world!&#34;</span><span>)</span><span>;</span></pre></div>
<p dir="auto">Gets converted to <a href="https://github.com/mgarciaisaia/JavaScript-Is-Weird-as-a-compressor/blob/main/output.js">this other valid JavaScript program</a>,
that produces the same result but whose source is really weird. Here&#39;s
the first few bytes of it:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(()=&gt;{})[({}+[])[+!![] + +!![] + +!![] + +!![] + +!![]]+({}+[])[+!![]]+(
(+!![]/+[])+[])[+!![] + +!![] + +!![] + +!![]]+(![]+[])[+!![] + +!![] + 
+!![]]+({}+[])[+!![] + +!![] + +!![] + +!![] + +!![] + +!![]]+(!![]+[])[
+!![]]+(!![]+[])[+!![] + +!![]]+({}+[])[+!![] + +!![] + +!![] + +!![] + "><pre><span>(</span><span>(</span><span>)</span><span>=&gt;</span><span>{</span><span>}</span><span>)</span><span>[</span><span>(</span><span>{</span><span>}</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>]</span><span>+</span><span>(</span><span>{</span><span>}</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>]</span><span>+</span><span>(</span>
<span>(</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>/</span><span>+</span><span>[</span><span>]</span><span>)</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>]</span><span>+</span><span>(</span><span>!</span><span>[</span><span>]</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> 
<span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>]</span><span>+</span><span>(</span><span>{</span><span>}</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>]</span><span>+</span><span>(</span><span>!</span><span>!</span><span>[</span><span>]</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span>
<span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>]</span><span>+</span><span>(</span><span>!</span><span>!</span><span>[</span><span>]</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span><span>]</span><span>+</span><span>(</span><span>{</span><span>}</span><span>+</span><span>[</span><span>]</span><span>)</span><span>[</span><span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> <span>+</span><span>!</span><span>!</span><span>[</span><span>]</span> <span>+</span> </pre></div>
<p dir="auto">If you haven&#39;t seen the video yet, go do it - this post will be waiting
right here.</p>
<h2 tabindex="-1" id="user-content-so-what" dir="auto"><a href="#so-what">So what?<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">So a few months ago I&#39;ve watch the video and had a weird idea. If the
resulting files are basically a different encoding of the same source
code, but using a representation that uses less symbols, is there a
chance that GZIP&#39;ing those files would result in smaller files than
GZIP&#39;ing the original source files? Exchanging GZIP&#39;ed files over the
wire is standard practice for web browsers for a while now, so if the
hypothesis (a really weak one, yes) worked, this weird idea may become
something useful-ish.</p>
<p dir="auto">And if this worked, how would the compression compare to JavaScript
minifiers? And what about runtime performance? Maybe there were some
scenarios in which it&#39;s OK to trade some runtime performance for smaller
file sizes.</p>
<h2 tabindex="-1" id="user-content-lets-try-it" dir="auto"><a href="#lets-try-it">Let&#39;s try it<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">First of all, I&#39;ve downloaded the video&#39;s linked repo with the sample
code and run it locally. Because knowing some NodeJS code worked a year
says very little about that same code working now - and I even didn&#39;t
knew if it worked at all.</p>
<div data-snippet-clipboard-copy-content="$ git clone https://github.com/lowbyteproductions/JavaScript-Is-Weird
Cloning into &#39;JavaScript-Is-Weird&#39;...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (3/3), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 4 (delta 0), reused 0 (delta 0), pack-reused 1
Receiving objects: 100% (4/4), done.
$ cd JavaScript-Is-Weird/
$ node index.js
(()=&gt;{})[({}+[])[+!![] + +!![] + +!![] + +!![] + +!![]]+({}+[])[+!![]]+(
... snip ...
$"><pre><code>$ git clone https://github.com/lowbyteproductions/JavaScript-Is-Weird
Cloning into &#39;JavaScript-Is-Weird&#39;...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (3/3), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 4 (delta 0), reused 0 (delta 0), pack-reused 1
Receiving objects: 100% (4/4), done.
$ cd JavaScript-Is-Weird/
$ node index.js
(()=&gt;{})[({}+[])[+!![] + +!![] + +!![] + +!![] + +!![]]+({}+[])[+!![]]+(
... snip ...
$
</code></pre></div>
<p dir="auto">Inspecting the code, it had <a href="https://github.com/lowbyteproductions/JavaScript-Is-Weird/blob/7245b1e1dc22c900b50f254c9ea0e375ec597eba/index.js#L45">a hard-coded call to the <code>compile</code> function
with the <code>console.log(&#34;Hello, world!&#34;);</code> code in it</a>. So I quickly
<a href="https://github.com/mgarciaisaia/JavaScript-Is-Weird-as-a-compressor/commit/a538bf7b7545c2a6eb4b12b04ee9a3910d50cda4">changed the program to receive the name of the source file as a command
line argument</a> -
by asking ChatGPT for that trivial piece of code.</p>
<p dir="auto">I&#39;ve ran the program against itself, and checked that it kinda worked -
it was producing some output, but I couldn&#39;t ran itself once again
because the transpiler wraps the source code in an anonymous function
call that doesn&#39;t support <code>require</code>ing. But, hey - we have some output!</p>
<div data-snippet-clipboard-copy-content="$ node weird.js weird.js &gt; weird.weird.js
$ gzip &lt; weird.weird.js &gt; weird.weird.js.gzip
$ ls -l weird.*
-rw-r--r--  1 mgarcia  staff     2065 Oct 16 01:28 weird.js
-rw-r--r--  1 mgarcia  staff  7702811 Oct 16 02:44 weird.weird.js
-rw-r--r--  1 mgarcia  staff    85691 Oct 16 02:45 weird.weird.js.gzip"><pre><code>$ node weird.js weird.js &gt; weird.weird.js
$ gzip &lt; weird.weird.js &gt; weird.weird.js.gzip
$ ls -l weird.*
-rw-r--r--  1 mgarcia  staff     2065 Oct 16 01:28 weird.js
-rw-r--r--  1 mgarcia  staff  7702811 Oct 16 02:44 weird.weird.js
-rw-r--r--  1 mgarcia  staff    85691 Oct 16 02:45 weird.weird.js.gzip
</code></pre></div>
<p dir="auto">(Yes, I&#39;ve also renamed the script as <code>weird.js</code> and adopted the
<code>.weird</code> sub-extension since it seemed appropriate and YOLO.)</p>
<p dir="auto">OK, so we are kind of testing the hypotesis already - that file doesn&#39;t
feel smaller than the original one. And let&#39;s not even talk about
minification or gziping the source file.</p>
<div data-snippet-clipboard-copy-content="$ npx minify weird.js &gt; weird.min.js
$ gzip &lt; weird.js &gt; weird.js.gzip
$ ls -l weird.*
-rw-r--r--  1 mgarcia  staff     2065 Oct 16 01:28 weird.js
-rw-r--r--  1 mgarcia  staff      756 Oct 16 02:49 weird.js.gzip
-rw-r--r--  1 mgarcia  staff     1242 Oct 16 02:48 weird.min.js
-rw-r--r--  1 mgarcia  staff  7702811 Oct 16 02:44 weird.weird.js
-rw-r--r--  1 mgarcia  staff    85691 Oct 16 02:45 weird.weird.js.gzip"><pre><code>$ npx minify weird.js &gt; weird.min.js
$ gzip &lt; weird.js &gt; weird.js.gzip
$ ls -l weird.*
-rw-r--r--  1 mgarcia  staff     2065 Oct 16 01:28 weird.js
-rw-r--r--  1 mgarcia  staff      756 Oct 16 02:49 weird.js.gzip
-rw-r--r--  1 mgarcia  staff     1242 Oct 16 02:48 weird.min.js
-rw-r--r--  1 mgarcia  staff  7702811 Oct 16 02:44 weird.weird.js
-rw-r--r--  1 mgarcia  staff    85691 Oct 16 02:45 weird.weird.js.gzip
</code></pre></div>
<p dir="auto">So the original file is 2065 bytes long, the weird version is ~7MB, and
the weird+GZIP version is 85k long (41.5x the size) - while the minified
version is 0.6x the size, and GZIP is 0.36x.</p>
<p dir="auto">I didn&#39;t even care to check the runtime performance, since there&#39;s no
benefits to trade off.</p>
<h2 tabindex="-1" id="user-content-does-this-result-apply-to-other-files" dir="auto"><a href="#does-this-result-apply-to-other-files">Does this result apply to other files?<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">So maybe this one script was <em>weird</em> enough that it didn&#39;t compress that
well? I had to try with some other files, so I got a few examples of
JavaScript files that weren&#39;t <em>so</em> long - after some file lenght, an
<code>Array.join</code> in the transpiler fails with a <code>RangeException</code>, so no
JQuery for our tests.</p>
<p dir="auto">You can check the files in the <a href="https://github.com/mgarciaisaia/JavaScript-Is-Weird-as-a-compressor/blob/main/sample"><code>sample/</code></a> directory. They
all show similar, aweful results:</p>
<div data-snippet-clipboard-copy-content="$ ls -l sample/
total 683064
-rw-r--r--  1 mgarcia  staff      19648 Oct 16 01:39 dommy-2.0.js
-rw-r--r--  1 mgarcia  staff       5379 Oct 16 02:57 dommy-2.0.js.gz
-rw-r--r--  1 mgarcia  staff       8762 Oct 16 01:40 dommy-2.0.min.js
-rw-r--r--  1 mgarcia  staff   51015234 Oct 16 01:40 dommy-2.0.weird.js
-rw-r--r--  1 mgarcia  staff     587229 Oct 16 01:42 dommy-2.0.weird.js.gz
-rw-r--r--  1 mgarcia  staff     115023 Oct 16 01:50 lodash-4.17.15.js
-rw-r--r--  1 mgarcia  staff      24398 Oct 16 02:57 lodash-4.17.15.js.gz
-rw-r--r--  1 mgarcia  staff      13542 Oct 16 01:50 lodash-4.17.15.min.js
-rw-r--r--  1 mgarcia  staff  280028085 Oct 16 01:50 lodash-4.17.15.weird.js
-rw-r--r--  1 mgarcia  staff    3226049 Oct 16 01:51 lodash-4.17.15.weird.js.gz
-rw-r--r--@ 1 mgarcia  staff       7114 Oct 16 01:44 modernizr-custom.js
-rw-r--r--  1 mgarcia  staff       2689 Oct 16 02:57 modernizr-custom.js.gz
-rw-r--r--  1 mgarcia  staff       1296 Oct 16 01:45 modernizr-custom.min.js
-rw-r--r--  1 mgarcia  staff   14293251 Oct 16 01:45 modernizr-custom.weird.js
-rw-r--r--  1 mgarcia  staff     168443 Oct 16 01:45 modernizr-custom.weird.js.gz"><pre><code>$ ls -l sample/
total 683064
-rw-r--r--  1 mgarcia  staff      19648 Oct 16 01:39 dommy-2.0.js
-rw-r--r--  1 mgarcia  staff       5379 Oct 16 02:57 dommy-2.0.js.gz
-rw-r--r--  1 mgarcia  staff       8762 Oct 16 01:40 dommy-2.0.min.js
-rw-r--r--  1 mgarcia  staff   51015234 Oct 16 01:40 dommy-2.0.weird.js
-rw-r--r--  1 mgarcia  staff     587229 Oct 16 01:42 dommy-2.0.weird.js.gz
-rw-r--r--  1 mgarcia  staff     115023 Oct 16 01:50 lodash-4.17.15.js
-rw-r--r--  1 mgarcia  staff      24398 Oct 16 02:57 lodash-4.17.15.js.gz
-rw-r--r--  1 mgarcia  staff      13542 Oct 16 01:50 lodash-4.17.15.min.js
-rw-r--r--  1 mgarcia  staff  280028085 Oct 16 01:50 lodash-4.17.15.weird.js
-rw-r--r--  1 mgarcia  staff    3226049 Oct 16 01:51 lodash-4.17.15.weird.js.gz
-rw-r--r--@ 1 mgarcia  staff       7114 Oct 16 01:44 modernizr-custom.js
-rw-r--r--  1 mgarcia  staff       2689 Oct 16 02:57 modernizr-custom.js.gz
-rw-r--r--  1 mgarcia  staff       1296 Oct 16 01:45 modernizr-custom.min.js
-rw-r--r--  1 mgarcia  staff   14293251 Oct 16 01:45 modernizr-custom.weird.js
-rw-r--r--  1 mgarcia  staff     168443 Oct 16 01:45 modernizr-custom.weird.js.gz
</code></pre></div>
<p dir="auto">Here&#39;s a table:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Source</th>
<th>Weird</th>
<th>Weird.gz</th>
<th>Minified</th>
<th>GZIP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dommy</td>
<td>19648</td>
<td>51015234 (2596x)</td>
<td>587229 (29x)</td>
<td>8762 (0.44x)</td>
<td>5379 (0.27x)</td>
</tr>
<tr>
<td>Lodash</td>
<td>115023</td>
<td>280028085 (2434x)</td>
<td>3226049 (28x)</td>
<td>13542 (0.11x)</td>
<td>24398 (0.21x)</td>
</tr>
<tr>
<td>Modernizr</td>
<td>7114</td>
<td>14293251 (2009x)</td>
<td>168443 (23x)</td>
<td>1296 (0.18x)</td>
<td>2689 (0.37x)</td>
</tr>
</tbody>
</table>
<h2 tabindex="-1" id="user-content-so-what-part-2" dir="auto"><a href="#so-what-part-2">So what? (part 2)<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">So, yeah - this isn&#39;t a good idea. If the Weird transpiler only changes
the encoding of each character with a really weird equivalent, it makes
a lot of sense that it doesn&#39;t compress better than the source one - the
ideal scenario would be to compress the same.</p>
<p dir="auto">I really didn&#39;t expect to get great results out of this, but on the
other hand it was a nice opportunity to scratch some curiosity that I
got - while pushing a bizarre, extreme Internet semi-joke a little bit
more still. And no kittens were hurt during the making of it, so...</p>
</article>
          </div></div>
  </body>
</html>
