<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jdebp.uk/Softwares/djbwares/bernstein-ptyget.html">Original</a>
    <h1>Daniel J. Bernstein&#39;s ptyget toolset</h1>
    
    <div id="readability-page-1" class="page">



<p>
The ptyget package is a toolset for running programs in various ways under pseudo-terminals, making programs exhibit their &#34;interactive mode&#34; behaviours in circumstances where they would normally operate in non-interactive mode.
</p>

<p>
It is, incidentally, notable for exemplifying a very early version of, and one of the few published instances of, <a href="https://jdebp.uk/FGA/introduction-to-redo.html">Bernstein&#39;s own never-published &#34;redo&#34; build system</a>.  
<code>dependon</code>, a command to be found in the <code>.do</code> files in the package, is a clear precursor to <code>redo-ifchange</code>.
</p>


<h2 id="Contents">What it contains</h2>

<p>
It comprises several minor tools (<code>background</code>, the obsolete <code>ttydetach</code>, <code>exclon</code>, <code>excloff</code>, and some internal utilities) and three major ones:
</p>


<h3 id="ptybandage"><code>ptybandage</code></h3>

<p>
<code>ptybandage</code> is what people usually want in a login session. 
Its primary use case is making programs that are sensitive to whether their standard inputs, outputs, or errors are connected to terminals operate that way even though they are in fact in shell pipelines, or have their standard file descriptors redirected to file.
</p>

<p>
It takes a command to run (which has to be a proper external command, of course) and runs it in such a way that it thinks that its standard input, output, and error are attached to a terminal, connecting those through to <code>ptybandage</code>&#39;s original standard input and output.
The command&#39;s standard output and error are merged into <code>ptybandage</code>&#39;s standard output.
</p>

<p>
It deals with the nuances of running under job control shells, ensuring that a terminal STOP character not only stops <code>ptybandage</code> but also stops the program running attached to the inner terminal.
</p>

<p>
<small><i>Manuals: <a href="https://jdebp.uk/Softwares/djbwares/guide/commands/ptybandage.xml"><tt>ptybandage</tt></a> (djbwares toolset) <a href="https://jdebp.uk/Softwares/nosh/guide/commands/ptybandage.xml"><tt>ptybandage</tt></a> (nosh toolset)</i></small>
</p>


<h3 id="ptyrun"><code>ptyrun</code></h3>

<p>
<code>ptyrun</code> is what people usually want in TCP network servers. 
Its primary use case is remote execution environments that have not themselves set up terminals, running programs that don&#39;t operate as desired when there&#39;s no terminal.
</p>

<p>
It doesn&#39;t expect to be running under a job control shell, and if the command being run receives a stop signal it is simply restarted.
</p>

<p>
<small><i>Manuals: <a href="https://jdebp.uk/Softwares/djbwares/guide/commands/ptyrun.xml"><tt>ptyrun</tt></a> (djbwares toolset) <a href="https://jdebp.uk/Softwares/nosh/guide/commands/ptyrun.xml"><tt>ptyrun</tt></a> (nosh toolset)</i></small>
</p>


<h3 id="nobuf"><code>nobuf</code></h3>

<p>
<code>nobuf</code> is what people usually want when redirecting standard output to file.
Its primary use case is making programs that use the C library&#39;s &#34;streams&#34; operate those streams in <em>line buffered</em> mode, the default for the standard input and output streams being <em>block buffered</em> mode if they are not directed to a terminal.
Block buffered mode is not useful for (say) a program that generates output progressively, line by line, where one wants to watch that output happen by monitoring additions to the file it is directed to.
</p>

<p>
Unlike <code>ptybandage</code>, it does not affect standard error.
The C library&#39;s semantics for standard error are that it is always in <em>not buffered</em> mode, so forcing it not to be block buffered is unnecessary.
Programs that look to standard error to decide whether they are &#34;interactive&#34; will not see a terminal if standard error is redirected.
Conversely, <code>ptybandage</code> cannot arrange to keep standard output and standard error separate.
</p>

<p>
Like <code>ptyrun</code>, it doesn&#39;t have any special handling for job control.
</p>

<p>
<small><i>Manuals: <a href="https://jdebp.uk/Softwares/djbwares/guide/nobuf.html"><tt>nobuf</tt></a> (djbwares toolset)</i></small>
</p>


<h2 id="History">History</h2>

<p>
In the 1990s Daniel J. Bernstein wrote a <code>pty</code> package, in order  to cheat at nethack.
Version 1 of the package <a href="https://groups.google.com/forum/#!msg/comp.sources.unix/J8ujaeLTi0M/Nw7ZcOcISOUJ">was published on 1990-10-10 to <code>comp.sources.unix</code></a> (volume 23 issues 031 to 036). 
Rich Salz described it:
</p>

<blockquote><p>
This is the Ginsu knife (it slices, it dices, it never rusts) that Dan has been talking about in <code>comp.unix.wixards/internals</code> for some time now.  
It is a mind-blower. 
</p></blockquote>

<p>
Version 4 of the package <a href="https://groups.google.com/forum/#!msg/comp.sources.unix/37gw-7b9U58/cdP0pp6sctgJ">was published on 1992-02-19 to <code>comp.sources.unix</code></a> (volume 25 issues 127 to 135). 
It is still locatable on the World Wide Web. 
Paul Vixie described it at the time:
</p>

<blockquote><p>
What can I say? 
It slices, it dices, it washes dishes, it walks the dog. 
It &#34;just works&#34;, meaning that if you follow the directions you&#39;ll get a working package without any pulling of hair or gnashing of teeth or other standard porting activities.
</p></blockquote>

<p>
Bernstein later updated this, somewhen on or before 1999-04-07, with a <code>ptyget</code> package, which he announced:
</p>

<blockquote>
<p>
I&#39;ve put together a new pseudo-tty allocator, ptyget. 
An alpha version is at ftp://koobera.math.uic.edu/pub/software/ptyget-0.50.tar.gz. 
There&#39;s a ptyget mailing list; to join, send an empty message to <a href="mailto:postmaster@localhost">djb-ptyget-requests@koobera.math.uic.edu</a>. 
I designed ptyget&#39;s interface from scratch. 
It&#39;s much more modular than <code>pty</code>; the basic <code>pty</code> interface has now been split into three pieces:
</p>

<dl>
<dt><code>ptyget</code></dt>
<dd>a tiny, low-level program — the only setuid program in the package — that allocates a new pseudo-tty and passes it to the program of your choice</dd>
<dt><code>ptyspawn</code></dt>
<dd>another small program that runs a child process under a pseudo-tty, waiting for it to exit and watching for stops</dd>
<dt><code>ptyio</code></dt>
<dd>another, only slightly larger, program that moves data back and forth</dd>
</dl>

<p>
The old Ginsu knife <code>pty</code> is now spelled <code>ptybandage</code>, which is a synonym for <code>ptyget ptyio -t ptyspawn</code>; <code>pty -d</code>, for attaching network programs to pseudo-ttys, is now spelled <code>ptyrun</code>, which is a synonym for <code>ptyget ptyio ptyspawn</code>; and <code>nobuf</code> is a synonym for  <code>ptyget ptyio -r ptyspawn -23x</code>. 
I&#39;ve split off the session management features into a separate package.
</p>
</blockquote>

<p>
That separate package was the &#34;sess&#34; package, implementing <a href="https://jdebp.uk/FGA/bernstein-on-ttys/sess.html">Bernstein&#39;s ideas about session management</a>.
</p>


<h2 id="Download">Where it is available</h2>


<h3 id="DownloadOriginal">Originals</h3>

<p>
Of course, Google Groups still has the original <code>comp.sources.unix</code> postings.
Enjoy shell archives; these are how we used to share our programs with the world, before <code>curl $URL|bash</code> came along and eliminated both portability and human middle-men in one fell swoop.
</p>

<p>
The aforementioned FTP site at ftp://koobera.math.uic.edu/pub/software/ptyget-0.50.tar.gz has long since been shut down.
Bernstein himself has no documentation on his WWW site, nor any indication that the package even still exists.
However, it does and the source archive is still published as <a href="http://cr.yp.to/software/ptyget-0.50.tar.gz">ptyget-0.50.tar.gz</a> there.
</p>

<p>
Dru Nelson publishes both <a href="https://github.com/drudru/pty4">pty version 4</a> and <a href="https://github.com/drudru/ptyget">ptyget</a> in source form using GitHub.
</p>

<p>
There are a few problems with the original packages.
One is that they are written in a programming language that effectively does not exist this century.
C 1999 and C 2011 compilers are a lot stricter about function declarations (missing and K&amp;R style), <code>const</code>-ness, and other stuff.
There are also two long-since defunct BSDisms in the package that prevent it from compiling and working on most modern operating systems: a pseudo-terminal <code>ioctl</code> that sets a &#34;remote mode&#34; that doesn&#39;t exist any more (outwith OpenBSD), and the 1980s-style pseudo-terminal device names (again only to be found on OpenBSD nowadays).
The &#34;remote mode&#34; is a particular difficulty — <code>nobuf</code> relies upon it.
</p>


<h3 id="DownloadFixed">Fixed versions</h3>

<p>
<a href="http://code.dogmap.org./ptyget/">Paul Jarc publishes two differently fixed versions of ptyget</a> that attempt to deal with the two long-since defunct BSDisms.
</p>

<p>
<a href="https://jdebp.uk/Softwares/djbwares/">The Daniel J. Bernstein softwares all-in-one</a> toolset has similarly adjusted versions of the tools.
</p>


<h3 id="DownloadAlternatives">Alternatives</h3>

<p>
<a href="https://jdebp.uk/Softwares/nosh/">The nosh package</a> comes with workalike <code>ptybandange</code> and <code>ptyrun</code> scripts, which use <a href="http://skarnet.org./software/execline/">Laurent Bercot&#39;s execline tool</a> and the nosh package&#39;s own pseudo-terminal management commands. 
As of nosh version 1.23 these are available pre-packaged in the <code>nosh-terminal-extras</code> package. 
(Earlier versions only supplied them to people who built from source.)
</p>


<h2 id="Examples">A few example uses</h2>

<p>
<a href="http://permalink.gmane.org/gmane.comp.lib.ptyget/9">Jurjgen Oskam using <code>ptybandage</code> on AIX</a> to feed input from a here document to a program that explicity opens and read its controlling terminal for a password prompt:
</p>

<pre>$ ptybandage dsmadmc &lt;&lt;EOF &gt;uit.txt
joskam
password
query session
query process
quit
EOF
</pre>

<p>
<a href="http://mailing.openbsd.misc.narkive.com/gPianfGf/bgplgsh-via-telnet">Andy Bradford using <code>ptyrun</code> on OpenBSD under daemontools and ucspi-tcp</a> to make the bgplgsh interactive router control program accessible via the network whilst making it think that it is talking to a terminal:
</p>

<pre>#!/bin/sh
exec 2&gt;&amp;1
exec envuidgid rviews tcpserver -vDRHl0 0 23 ptyrun /usr/bin/bgplgsh
</pre>

<hr/>

<SPAN size="-2">
© Copyright 2016
<a href="https://jdebp.uk/author.html">Jonathan de Boyne Pollard</a>.
&#34;Moral&#34; rights asserted.
</SPAN>


</div>
  </body>
</html>
