<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/stoix-dev/stoix-cloud-saver">Original</a>
    <h1>Forget CDK and AWS&#39;s insane costs. Pulumi and DigitalOcean to the rescue</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">This document provides a step-by-step guide on how to start and set up a Pulumi project and integrate it with the DigitalOcean CLI (<code>doctl</code>) for managing infrastructure on DigitalOcean.</p>

<p dir="auto">Before you begin, ensure you have the following tools installed on your machine:</p>
<ul dir="auto">
<li><a href="https://www.pulumi.com/docs/get-started/install/" rel="nofollow">Pulumi CLI</a></li>
<li><a href="https://nodejs.org/" rel="nofollow">Node.js</a> (Required if using JavaScript/TypeScript for Pulumi)</li>
<li><a href="https://www.python.org/downloads/" rel="nofollow">Python</a> (Required if using Python for Pulumi)</li>
<li><a href="https://docs.digitalocean.com/reference/doctl/how-to/install/" rel="nofollow">doctl</a> (DigitalOcean CLI)</li>
<li><a href="https://git-scm.com/downloads" rel="nofollow">Git</a></li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">In our example we are using the typescript option</h2><a id="user-content-in-our-example-we-are-using-the-typescript-option" aria-label="Permalink: In our example we are using the typescript option" href="#in-our-example-we-are-using-the-typescript-option"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<p dir="auto">Follow the official Pulumi installation guide to install Pulumi on your system. You can verify the installation by running:</p>

<div dir="auto"><h2 tabindex="-1" dir="auto">Step 2: Set Up a New Pulumi Project in case you need</h2><a id="user-content-step-2-set-up-a-new-pulumi-project-in-case-you-need" aria-label="Permalink: Step 2: Set Up a New Pulumi Project in case you need" href="#step-2-set-up-a-new-pulumi-project-in-case-you-need"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir my-pulumi-project
cd my-pulumi-project
pulumi new typescript"><pre>mkdir my-pulumi-project
<span>cd</span> my-pulumi-project
pulumi new typescript</pre></div>


<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 4: Generate doctl token on the API section on Digital Ocean</h2><a id="user-content-step-4-generate-doctl-token-on-the-api-section-on-digital-ocean" aria-label="Permalink: STEP 4: Generate doctl token on the API section on Digital Ocean" href="#step-4-generate-doctl-token-on-the-api-section-on-digital-ocean"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://elijer.github.io/stoix-dev/stoix-cloud-saver/blob/main/image-1.png"><img src="https://elijer.github.io/stoix-dev/stoix-cloud-saver/raw/main/image-1.png" alt="alt text"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://elijer.github.io/stoix-dev/stoix-cloud-saver/blob/main/image-2.png"><img src="https://elijer.github.io/stoix-dev/stoix-cloud-saver/raw/main/image-2.png" alt="alt text"/></a></p>
<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 5: Export the token just generated:</h2><a id="user-content-step-5-export-the-token-just-generated" aria-label="Permalink: STEP 5: Export the token just generated:" href="#step-5-export-the-token-just-generated"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="    export DIGITALOCEAN_TOKEN=&#34;YOUR_TOKEN_HERE&#34;"><pre>    <span>export</span> DIGITALOCEAN_TOKEN=<span><span>&#34;</span>YOUR_TOKEN_HERE<span>&#34;</span></span></pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 6: Authenticate doctl with your Digital Ocean token just generated</h2><a id="user-content-step-6-authenticate-doctl-with-your-digital-ocean-token-just-generated" aria-label="Permalink: STEP 6: Authenticate doctl with your Digital Ocean token just generated" href="#step-6-authenticate-doctl-with-your-digital-ocean-token-just-generated"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 6.1: Authenticate with docker and digital ocean registry</h2><a id="user-content-step-61-authenticate-with-docker-and-digital-ocean-registry" aria-label="Permalink: STEP 6.1: Authenticate with docker and digital ocean registry" href="#step-61-authenticate-with-docker-and-digital-ocean-registry"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content=" docker login -u &#34;youruser&#34; -p &#34;yourtoken&#34;  registry.digitalocean.com"><pre> docker login -u <span><span>&#34;</span>youruser<span>&#34;</span></span> -p <span><span>&#34;</span>yourtoken<span>&#34;</span></span>  registry.digitalocean.com</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 7: Tag the image of your application:</h2><a id="user-content-step-7-tag-the-image-of-your-application" aria-label="Permalink: STEP 7: Tag the image of your application:" href="#step-7-tag-the-image-of-your-application"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="docker tag YOUR_IMAGE registry.digitalocean.com/YOUR_REGISTRY/YOUR_IMAGE"><pre>docker tag YOUR_IMAGE registry.digitalocean.com/YOUR_REGISTRY/YOUR_IMAGE</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 8: Push your image to the Digital Ocean Doker Registry</h2><a id="user-content-step-8-push-your-image-to-the-digital-ocean-doker-registry" aria-label="Permalink: STEP 8: Push your image to the Digital Ocean Doker Registry" href="#step-8-push-your-image-to-the-digital-ocean-doker-registry"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="docker push registry.digitalocean.com/YOUR_REGISTRY/YOUR_IMAGE"><pre>docker push registry.digitalocean.com/YOUR_REGISTRY/YOUR_IMAGE</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 09: Go to the project infra repository  and run the following commands to first create the cluster, make sure to have export the env for the digitlocean token e Kubeconfig path:</h2><a id="user-content-step-09-go-to-the-project-infra-repository--and-run-the-following-commands-to-first-create-the-cluster-make-sure-to-have-export-the-env-for-the-digitlocean-token-e-kubeconfig-path" aria-label="Permalink: STEP 09: Go to the project infra repository  and run the following commands to first create the cluster, make sure to have export the env for the digitlocean token e Kubeconfig path:" href="#step-09-go-to-the-project-infra-repository--and-run-the-following-commands-to-first-create-the-cluster-make-sure-to-have-export-the-env-for-the-digitlocean-token-e-kubeconfig-path"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">To make sure we are using the right cluster versions run:</h2><a id="user-content-to-make-sure-we-are-using-the-right-cluster-versions-run" aria-label="Permalink: To make sure we are using the right cluster versions run:" href="#to-make-sure-we-are-using-the-right-cluster-versions-run"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="doctl kubernetes options versions"><pre>doctl kubernetes options versions</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content=" pulumi up
 doctl kubernetes cluster kubeconfig save the clusteName"><pre> pulumi up
 doctl kubernetes cluster kubeconfig save the clusteName</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 10:  Run the following command to see if the current cluster is the same you created:</h2><a id="user-content-step-10--run-the-following-command-to-see-if-the-current-cluster-is-the-same-you-created" aria-label="Permalink: STEP 10:  Run the following command to see if the current cluster is the same you created:" href="#step-10--run-the-following-command-to-see-if-the-current-cluster-is-the-same-you-created"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="    kubectl config current-context"><pre>    kubectl config current-context</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">STEP 11: run the following command to add this a secret to the cluster:</h2><a id="user-content-step-11-run-the-following-command-to-add-this-a-secret-to-the-cluster" aria-label="Permalink: STEP 11: run the following command to add this a secret to the cluster:" href="#step-11-run-the-following-command-to-add-this-a-secret-to-the-cluster"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content=" kubectl create secret generic digitalocean-dns   --from-literal=access-token=&#34;yourtoken&#34;  --namespace default"><pre> kubectl create secret generic digitalocean-dns   --from-literal=access-token=<span><span>&#34;</span>yourtoken<span>&#34;</span></span>  --namespace default</pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">Step 12: After creating the cluster secret responsible to verify the DNS you can go to the service-infra repo and run:</h2><a id="user-content-step-12-after-creating-the-cluster-secret-responsible-to-verify-the-dns-you-can-go-to-the-service-infra-repo-and-run" aria-label="Permalink: Step 12: After creating the cluster secret responsible to verify the DNS you can go to the service-infra repo and run:" href="#step-12-after-creating-the-cluster-secret-responsible-to-verify-the-dns-you-can-go-to-the-service-infra-repo-and-run"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>

</article></div></div>
  </body>
</html>
