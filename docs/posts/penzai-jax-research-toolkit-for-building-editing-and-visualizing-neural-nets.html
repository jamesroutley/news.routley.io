<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google-deepmind/penzai">Original</a>
    <h1>Penzai: JAX research toolkit for building, editing, and visualizing neural nets</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<blockquote>
<p dir="auto"><strong>盆 (&#34;pen&#34;, tray) 栽 (&#34;zai&#34;, planting)</strong> - <em>an ancient Chinese art of forming
trees and landscapes in miniature, also called penjing and an ancestor of the
Japanese art of bonsai.</em></p>
</blockquote>
<p dir="auto">Penzai is a JAX library for writing models as legible, functional pytree data
structures, along with tools for visualizing, modifying, and analyzing them.
Penzai focuses on <strong>making it easy to do stuff with models after they have been
trained</strong>, making it a great choice for research involving reverse-engineering
or ablating model components, inspecting and probing internal activations,
performing model surgery, debugging architectures, and more. (But if you just
want to build and train a model, you can do that too!)</p>
<p dir="auto">With Penzai, your neural networks could look like this:</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/google-deepmind/penzai/blob/main/docs/_static/readme_teaser.png"><img src="https://github.com/google-deepmind/penzai/raw/main/docs/_static/readme_teaser.png" alt="Screenshot of the Gemma model in Penzai"/></a></p>
<p dir="auto">Penzai is structured as a collection of modular tools, designed together but
each useable independently:</p>
<ul dir="auto">
<li>
<p dir="auto"><code>penzai.nn</code> (<code>pz.nn</code>): A declarative combinator-based neural network
library and an alternative to other neural network libraries like Flax, Haiku,
Keras, or Equinox, which exposes the full structure of your model&#39;s
forward pass in the model pytree. This means you can see everything your model
does by pretty printing it, and inject new runtime logic with <code>jax.tree_util</code>.
Like Equinox, there&#39;s no magic: models are just callable pytrees under the
hood.</p>
</li>
<li>
<p dir="auto"><code>penzai.treescope</code> (<code>pz.ts</code>): A superpowered interactive Python
pretty-printer, which works as a drop-in replacement for the ordinary
IPython/Colab renderer. It&#39;s designed to help understand Penzai models and
other deeply-nested JAX pytrees, with built-in support for visualizing
arbitrary-dimensional NDArrays.</p>
</li>
<li>
<p dir="auto"><code>penzai.core.selectors</code> (<code>pz.select</code>): A pytree swiss-army-knife,
generalizing JAX&#39;s <code>.at[...].set(...)</code> syntax to arbitrary type-driven
pytree traversals, and making it easy to do complex rewrites or
on-the-fly patching of Penzai models and other data structures.</p>
</li>
<li>
<p dir="auto"><code>penzai.core.named_axes</code> (<code>pz.nx</code>): A lightweight named axis system which
lifts ordinary JAX functions to vectorize over named axes, and allows you to
seamlessly switch between named and positional programming styles without
having to learn a new array API.</p>
</li>
<li>
<p dir="auto"><code>penzai.data_effects</code> (<code>pz.de</code>): An opt-in system for side arguments, random
numbers, and state variables that is built on pytree traversal and puts you
in control, without getting in the way of writing or using your model.</p>
</li>
</ul>
<p dir="auto">Documentation on Penzai can be found at
<a href="https://penzai.readthedocs.io" rel="nofollow">https://penzai.readthedocs.io</a>.</p>

<p dir="auto">If you haven&#39;t already installed JAX, you should do that first, since the
installation process depends on your platform. You can find instructions in the
<a href="https://jax.readthedocs.io/en/latest/installation.html" rel="nofollow">JAX documentation</a>.
Afterward, you can install Penzai using</p>

<p dir="auto">and import it using</p>
<div data-snippet-clipboard-copy-content="import penzai
from penzai import pz"><pre><code>import penzai
from penzai import pz
</code></pre></div>
<p dir="auto">(<code>penzai.pz</code> is an <em>alias namespace</em>, which makes it easier to reference
common Penzai objects.)</p>
<p dir="auto">When working in an Colab or IPython notebook, we recommend also configuring
Penzai as the default pretty printer, and enabling some utilities for
interactive use:</p>
<div data-snippet-clipboard-copy-content="pz.ts.register_as_default()
pz.ts.register_autovisualize_magic()
pz.enable_interactive_context()

# Optional: enables automatic array visualization
pz.ts.active_autovisualizer.set_interactive(pz.ts.ArrayAutovisualizer())"><pre><code>pz.ts.register_as_default()
pz.ts.register_autovisualize_magic()
pz.enable_interactive_context()

# Optional: enables automatic array visualization
pz.ts.active_autovisualizer.set_interactive(pz.ts.ArrayAutovisualizer())
</code></pre></div>
<p dir="auto">Here&#39;s how you could initialize and visualize a simple neural network:</p>
<div data-snippet-clipboard-copy-content="from penzai.example_models import simple_mlp
mlp = pz.nn.initialize_parameters(
    simple_mlp.MLP.from_config([8, 32, 32, 8]),
    jax.random.key(42),
)

# Models and arrays are visualized automatically when you output them from a
# Colab/IPython notebook cell:
mlp"><pre><code>from penzai.example_models import simple_mlp
mlp = pz.nn.initialize_parameters(
    simple_mlp.MLP.from_config([8, 32, 32, 8]),
    jax.random.key(42),
)

# Models and arrays are visualized automatically when you output them from a
# Colab/IPython notebook cell:
mlp
</code></pre></div>
<p dir="auto">Here&#39;s how you could capture and extract the activations after the elementwise
nonlinearities:</p>
<div data-snippet-clipboard-copy-content="mlp_with_captured_activations = pz.de.CollectingSideOutputs.handling(
    pz.select(mlp)
    .at_instances_of(pz.nn.Elementwise)
    .insert_after(pz.de.TellIntermediate())
)

output, intermediates = mlp_with_captured_activations(
  pz.nx.ones({&#34;features&#34;: 8})
)"><pre><code>mlp_with_captured_activations = pz.de.CollectingSideOutputs.handling(
    pz.select(mlp)
    .at_instances_of(pz.nn.Elementwise)
    .insert_after(pz.de.TellIntermediate())
)

output, intermediates = mlp_with_captured_activations(
  pz.nx.ones({&#34;features&#34;: 8})
)
</code></pre></div>
<p dir="auto">To learn more about how to build and manipulate neural networks with Penzai,
we recommend starting with the <a href="https://penzai.readthedocs.io/en/stable/notebooks/how_to_think_in_penzai.html" rel="nofollow">&#34;How to Think in Penzai&#34; tutorial</a>, or one
of the other tutorials in the <a href="https://penzai.readthedocs.io" rel="nofollow">Penzai documentation</a>.</p>
<hr/>
<p dir="auto"><em>This is not an officially supported Google product.</em></p>
</article></div></div>
  </body>
</html>
