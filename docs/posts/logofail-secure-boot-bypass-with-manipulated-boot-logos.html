<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://binarly.io/posts/The_Far_Reaching_Consequences_of_LogoFAIL/">Original</a>
    <h1>LogoFAIL: Secure Boot bypass with manipulated boot logos</h1>
    
    <div id="readability-page-1" class="page"><div><p><em>The Binarly REsearch team investigates vulnerable image parsing components across the entire UEFI firmware ecosystem and finds all major device manufacturers are impacted on both x86 and ARM-based devices.</em><iframe width="560" height="315" src="https://www.youtube.com/embed/nJDnPFzSh4E?si=C0J9hMxYF2eeg0PX" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></p>

<p>History frequently repeats itself, and vulnerability research is no exception. Earlier this year, our research team looked at some of the vulnerabilities discovered by the Binarly Transparency Platform and found that the number of image parsers have significantly increased over the years. Today, the UEFI system firmware contains BMP, GIF, JPEG, PCX, and TGA parsers, significantly increasing the attack surface compared to previous research that has been done in this area.</p>

<p>The most famous attack was <a href="https://www.blackhat.com/presentations/bh-usa-09/WOJTCZUK/BHUSA09-Wojtczuk-AtkIntelBios-SLIDES.pdf">presented at Black Hat USA</a> in 2009 by Rafal Wojtczuk and Alexander Tereshkin with the exploitation of a BMP parser bug in the UEFI reference code.</p>

<p><img src="https://binarly.io/assets/uid/c9d1fcf2-46f4-4540-b1e9-613773bfdd31" alt="Figure 1"/></p>
<p><em>Slide from the original Wojtczuk/Tereshkin presentation &#34;<a href="https://www.blackhat.com/presentations/bh-usa-09/WOJTCZUK/BHUSA09-Wojtczuk-AtkIntelBios-SLIDES.pdf">Attacking Intel BIOS</a>&#34;</em></p>

<p>Since then, we haven’t seen any public documentation of  attack surfaces related to graphic image parsers embedded into the UEFI system firmware until a member of our research team had an &#39;a-ha&#39; moment when thinking of supply chain security problems from our previous work &#34;<a href="https://binarly.io/posts/OpenSSL_Usage_in_UEFI_Firmware_Exposes_Weakness_in_SBOMs/">OpenSSL Usage in UEFI Firmware Exposes Weakness in SBOMs</a>&#34;.</p>

<p>What if the graphic image parsers embedded into system firmware do not update frequently and use not only outdated but also customized versions of the common image parsing libraries?</p>

<p>We dive deeper into this wormhole and are shocked by multiple high-impact discoveries that can be used by threat actors to deliver a malicious payload and bypass Secure Boot, Intel Boot Guard, and other security technologies by design. More importantly, it can open doors for attackers to bypass modern endpoint security solutions and should be considered much more powerful than the recent <a href="https://binarly.io/posts/The_Untold_Story_of_the_BlackLotus_UEFI_Bootkit/">BlackLotus</a> bootkit.</p>

<p><strong>The full technical details regarding LogoFAIL vulnerabilities are under embargo until December 6th.  Binarly researchers will present &#34;<a href="https://www.blackhat.com/eu-23/briefings/schedule/index.html#logofail-security-implications-of-image-parsing-during-system-boot-35042">LogoFAIL: Security Implications of Image Parsing During System Boot</a>&#34; at Black Hat Europe.</strong></p>

<p><img src="https://binarly.io/assets/uid/46d3e351-47ee-49f1-ac95-5c7bd5b88974" alt="LogoFail Logo" width="30%"/></p>
<h2>What is LogoFAIL?</h2>
<p>LogoFAIL is a newly discovered set of security vulnerabilities affecting different image parsing libraries used in the system firmware by various vendors during the device boot process. These vulnerabilities are present in most cases inside IBVs (Independent BIOS vendor) reverence code, impacting not a single vendor but the entire ecosystem across this reference code and device vendors where it is used (See &#34;<a href="https://binarly.io/posts/The_Firmware_Supply_Chain_Security_is_broken_Can_we_fix_it">The Firmware Supply-Chain Security is Broken: Can we fix it?</a>&#34;).</p>

<p>One of the most important discoveries is that <strong>LogoFAIL is not silicon-specific and can impact x86 and ARM-based devices. LogoFAIL is UEFI and IBV-specific</strong> because of the specifics of vulnerable image parsers that have been used. That shows a much broader impact from the perspective of the discoveries that will be presented on Dec 6th.</p>

<p>The impact on the entire UEFI ecosystem is illustrated in the figure below.</p>

<p><img src="https://binarly.io/assets/uid/2652045a-ef73-49fd-805d-f64daaa634d1" width="60%" alt="The impact on the entire UEFI ecosystem"/></p>
<p>Originally, we discovered LogoFAIL on Lenovo devices with Insyde, AMI, and Phoenix reference codes on board and reported these vulnerabilities under advisory BRLY-2023-006.</p>

<p>We have been heavily focused on reporting vulnerabilities mainly discovered by the Binarly Transparency Platform product but the work on LogoFAIL was different and originally initiated as a small research project just for fun. After demonstrating a massive number of interesting attack surfaces from image-parsing firmware components, the project grew into a massive industry-wide disclosure. Initial vulnerabilities were found by fuzzing the potentially vulnerable components after we did a preliminary static analysis of the concerning code flows in IDA with the help of <a href="https://github.com/binarly-io/efiXplorer">efiXplorer</a> plugin to bring UEFI context.</p>

<p>After initial fuzzing, we received so many crashes that triaging them manually was quite complicated. We decided to automate triaging with Binarly&#39;s internal program analysis framework, which empowers our products and supports instrumentation with emulation.</p>

<p><img src="https://binarly.io/assets/uid/2d932439-314b-4e4e-825d-6fac62dac14f" width="70%" alt="LogoFail CLI utility work proccess animation"/></p>
<p>Later, we found more vulnerabilities in Insyde code and reported them with the BRLY-2022-018 advisory. After the realization that the impact goes way beyond Lenovo devices, we reported LogoFAIL-related security issues to the <a href="https://kb.cert.org/vince">CERT/CC VINCE</a> system. Based on previous experience, this coordination is very useful for the industry-wide response to cross-vendor issues.</p>

<table>
<thead>
<tr>
<th>BRLY ID</th>
<th>CERT/CC ID</th>
<th>Image Library</th>
<th>Impact</th>
<th>CVSS Score</th>
<th>CWE</th>
</tr>
</thead>
<tbody>
<tr>
<td>BRLY-2023-006</td>
<td>VU#811862</td>
<td>Embargo until </td>
<td>Embargo until </td>
<td>High</td>
<td>CWE-122: Heap-based </td>
</tr>
<tr>
<td>BRLY-2023-018</td>
<td>VU#811862</td>
<td>Embargo until </td>
<td>Embargo until </td>
<td>Medium</td>
<td>CWE-125: Out-of-bounds </td>
</tr>
</tbody>
</table>

<h2>How do LogoFAIL vulnerabilities work?</h2>
<p>The vulnerabilities allow attackers to store malicious logo images either on the <a href="https://en.wikipedia.org/wiki/EFI_system_partition">EFI System Partition (ESP)</a> or inside unsigned sections of a firmware update. When these images are parsed during boot, the vulnerability can be triggered and an attacker-controlled payload can arbitrarily be executed to hijack the execution flow and bypass security features like Secure Boot, including hardware-based Verified Boot mechanisms (like Intel Boot Guard, AMD Hardware-Validated Boot or ARM TrustZone-based Secure Boot).</p>

<p><strong>This attack vector can give an attacker an advantage in bypassing most endpoint security solutions and delivering a stealth firmware bootkit that will persist in an ESP partition or firmware capsule with a modified logo image. Technically, from a high-level perspective, the attack can be simplified into three steps.</strong></p>

<p><img src="https://binarly.io/assets/uid/9baf21a2-0261-4107-aab6-4650bdfc6946" alt="" width="50%" alt="Three simplified steps of attack"/></p>
<p><strong>The full technical details regarding LogoFAIL vulnerabilities are under embargo until December 6th, when it will be presented &#34;<a href="https://www.blackhat.com/eu-23/briefings/schedule/index.html#logofail-security-implications-of-image-parsing-during-system-boot-35042">LogoFAIL: Security Implications of Image Parsing During System Boot</a>&#34; at Black Hat Europe.</strong></p>

<h2>What are the implications of LogoFAIL?</h2>
<p>These vulnerabilities can compromise the entire system&#39;s security, rendering &#34;below-the-OS&#34; security measures like any shade of Secure Boot ineffective, including Intel Boot Guard. This level of compromise means attackers can gain deep control over the affected systems.</p>

<p>We’ve previously seen attackers abusing ESP partitions multiple times to modify operating system-related bootloaders to deliver UEFI bootkits (including BlackLotus). The LogoFAIL case creates a different perspective on the ESP partition attack surface with data-only exploitation by modifying the logo image.</p>

<table>
<thead>
<tr>
<th>Attack Vector</th>
<th>Vulnerability ID</th>
<th>Exploited </th>
<th>Impact</th>
<th>CVSS Score</th>
<th>CWE</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LogoFAIL</strong></td>
<td>VU#811862</td>
<td>N/A</td>
<td>Intel Boot Guard and </td>
<td>High </td>
<td><strong>CWE-122</strong>: Heap-based Buffer Overflow </td>
</tr>
<tr>
<td><strong>Baton Drop</strong></td>
<td>CVE-2022-21894 </td>
<td>BlackLotus</td>
<td>Secure Boot Bypass</td>
<td>6.7 Medium</td>
<td><strong>CWE-358</strong>: Improperly Implemented </td>
</tr>
<tr>
<td><strong>3rd-party Bootloaders</strong></td>
<td>VU#309662</td>
<td>N/A</td>
<td>Secure Boot Bypass</td>
<td>6.7 Medium</td>
<td><strong>CWE-358</strong>: Improperly Implemented </td>
</tr>
<tr>
<td><strong>BootHole</strong></td>
<td>VU#174059</td>
<td>N/A</td>
<td>Secure Boot Bypass</td>
<td>8.2 High</td>
<td><strong>CWE-120</strong>: Buffer Copy without </td>
</tr>
</tbody>
</table>

<p>LogoFAIL differs from <a href="https://media.defense.gov/2023/Jun/22/2003245723/-1/-1/0/CSI_BlackLotus_Mitigation_Guide.PDF">BlackLotus</a> or <a href="https://media.defense.gov/2020/Jul/30/2002467902/-1/-1/0/CSA_MITIGATE_THE_GRUB2_BOOTHOLE_VULNERABILITY_20200730_NSA_GOV%20-%20COPY.PDF">BootHole</a> threats because it doesn’t break runtime integrity by modifying the bootloader or firmware component. In this case, we are dealing with continued exploitation with a modified boot logo image, triggering the payload delivery in runtime, where all the integrity and security measurements happen before the firmware components are loaded.</p>

<p><img src="https://binarly.io/assets/uid/b1e76113-e596-4e47-a977-a3d9d9bba55c" alt="UEFI Secure boot Root of Trust flow chart" with="50%" style="margin: 0 auto"/></p>
<p>We can see from the figure above that any compromised signed UEFI component can break secure boot integrity and bypass it without being detected by platform integrity or Secure Boot related mitigations. Existing device security measurements can effectively detect other threats from the comparison table.</p>

<p>During our presentation at Black Hat Europe on December 6th, Binarly REsearch team will demonstrate new heap exploitation techniques to trigger LogoFAIL vulnerability that leads to arbitrary code execution.</p>

<p><img src="https://binarly.io/assets/uid/07b8e4e5-8466-4e83-a239-47c2b101e537" width="70%" alt="Photo of laptop with ASCII-art of text &#39;Greeting from Binarly Rearch and LogoFAIL!&#39;"/></p>
<h2>Which devices are affected by LogoFAIL?</h2>
<p>Hundreds of consumer and enterprise-grade devices from various vendors, including Intel, Acer, and Lenovo, are potentially vulnerable. The exact list of affected devices is still being determined but it’s crucial to note that all three major IBVs are impacted -- AMI, Insyde, and Phoenix due to multiple security issues related to image parsers they are shipping as a part of their firmware.</p>

<p>Based on this reference code impact, we estimate LogoFAIL impacts almost any device powered by these vendors in one way or another. Also, it’s not limited to specific hardware and can be successfully exploited on x86 or ARM-based devices.</p>

<p>The types -- and sheer volume -- of security vulnerabilities discovered by Binarly show pure product security maturity and code quality in general on IBVs reference code. Most of these companies grew up in the early 90s. They never change their mindset, being more proactive than reactive and fixing only known problems without addressing complete attack surfaces or implementing effective mitigations.</p>

<p><strong>Binarly Transparency Platform uniquely detects LogoFAIL vulnerable components in system firmware, and all our customers are informed about the impact on their code bases or enterprise infrastructure.</strong></p>

<p>Our unique binary code analysis technology identifies vulnerable components not based on integrity or simple version checking to scope the problems. All Binarly detection works on the binary code and shows the problem proven to be present in the analyzed firmware, dramatically reducing the false positives and making an actionable incident response possible.</p>

<p><strong>Are you interested in learning more about Binarly Transparency Platform or other solutions? Don&#39;t hesitate to contact us at fwhunt@binarly.io.</strong></p>
</div></div>
  </body>
</html>
