<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jan.wildeboer.net/2025/08/My-DNS-Part-1/">Original</a>
    <h1>My Own DNS Server at Home – Part 1: IPv4</h1>
    
    <div id="readability-page-1" class="page"><section itemprop="text">
        <p><strong>“It’s always DNS” is a famous meme among network people. Name resolution is technically quite simple. It’s “just” translating a hostname like <code>jan.wildeboer.net</code> to an IP address. What could possibly go wrong? I am a radical optimist and detail-obsessed knowledge collector, so I decided to find out. As part of my goal to make my home network a little island of Digital Sovereignty, meaning that everything at home should JustWork™, even with no working internet connection, a DNS server is needed.</strong></p>

<blockquote>
  <p>Based on and extended from my gist <a href="https://codeberg.org/jwildeboer/gists/src/branch/main/2025/20250826DNSHomelabBind9.md">Bind on Fedora 42 as DNS server</a>.</p>
</blockquote>

<p>I admit, I have a lot of experience with DNS and BIND. But I still consider myself to be merely on the GoodEnough™ side of things. I know how to get DNS configured for my domains. And I want you to feel fearless too. The best place to fail with DNS is the network at home. It limits the impact :)</p>

<p>So read this blog post either as report or as a HOWTO. Both ways can be fun!</p>

<p>In my homelab I have a Raspberry Pi 4 that runs infrastructure services. DNS is one of them, my private CA (Certificate Authority) another. The CA runs as a container on Podman. For DNS I use Bind. It thus has to serve 3 networks:</p>

<ul>
  <li><code>192.168.1.0/24</code> My home IPv4 network</li>
  <li><code>172.16.0.0/16</code> IPv4 Network on the second ethernet ports of my homelab servers</li>
  <li><code>10.88.0.0/16</code> The (virtual) podman network</li>
</ul>

<p>It uses my Fritz box (7490) as forwarder, so I can resolve all hosts, including the DHCP entries that the Fritz Box hands out under its default local domain name <code>fritz.box</code>. For my homelab however, I use the <code>homelab.jhw</code> domain name. That’s what the Bind DNS server has to take care of.</p>

<blockquote>
  <p><strong>WARNING</strong> </p>
</blockquote>

<h2 id="what-we-well-i-have">What we (well, I) have</h2>

<p>Let’s gather what I have in my home network.</p>

<ul>
  <li><code>inf01.homelab.jhw</code> at <code>192.168.1.10</code>: A Raspberry Pi 4 4GB, running Fedora 42 and podman with my Certificate Authority as a container that should be reachable as <code>ca.homelab.jhw</code>. See <a href="https://jan.wildeboer.net/2025/07/letsencrypt-homelab-stepca/">Be the LetsEncrypt in your homelab with step-ca</a> for more details.</li>
  <li>3 ThinkCentre Tiny PCs in the <code>homelab.jhw</code> zone, called hl01 (<code>192.168.1.11</code>), hl02 (<code>192.168.1.12</code>) and hl03 (<code>192.168.1.13</code>), running RHEL10 (Red Hat Enterprise Linux)</li>
  <li>A Fritz Box 7490 at <code>192.168.1.254</code></li>
</ul>

<h2 id="lets-install-bind-on-inf01">Let’s install BIND on inf01</h2>

<p>We need to do two things. Install BIND and some utilities on <code>inf01</code> and open the firewall for DNS traffic.</p>

<div><div><pre><code>dnf install bind bind-utils
firewall-cmd --add-service=dns --permanent
</code></pre></div></div>

<p>That was easy enough :)</p>

<h3 id="configure-bind">Configure BIND</h3>

<p>To run BIND in the correct way, we need to work on 3 configuration files.</p>

<ul>
  <li><code>/etc/named.conf</code> The main configuration file where we tell BIND on which networks it should listen and what zones it will serve.</li>
  <li><code>/var/named/forward.homelab.jhw</code> The forward zone file that maps hostnames in the <code>homelab.jhw</code> domain to IP addresses on my home network</li>
  <li><code>/var/named/reverse.homelab.jhw</code> The reverse zone for the <code>192.168.1.0/24</code> network range, that looks a bit confusing, that does the opposite. It maps IP addresses to hostnames.</li>
  <li><code>/var/named/reverse2.homelab.jhw</code> The second reverse zone for the <code>172.16.0.0/16</code> network range.</li>
</ul>

<p>Let’s start with <code>/etc/named.conf</code>.</p>

<div><div><pre><code>//
// named.conf
//

options {
  listen-on port 53 { 127.0.0.1; 192.168.1.10; 172.16.1.10; 10.88.0.1; };
  listen-on-v6 port 53 { ::1; fdda:a4da:69a5:0:2783:8c26:b2f1:a6f7; };
  allow-query     { localhost; 192.168.1.0/24; 172.16.0.0/16; 10.88.0.0/16; };

  directory       &#34;/var/named&#34;;

  dump-file       &#34;/var/named/data/cache_dump.db&#34;;
  statistics-file &#34;/var/named/data/named_stats.txt&#34;;
  memstatistics-file &#34;/var/named/data/named_mem_stats.txt&#34;;
  secroots-file   &#34;/var/named/data/named.secroots&#34;;
  recursing-file  &#34;/var/named/data/named.recursing&#34;;

  forwarders { 192.168.1.254; };
  recursion yes;

  dnssec-validation no;

  managed-keys-directory &#34;/var/named/dynamic&#34;;
  geoip-directory &#34;/usr/share/GeoIP&#34;;

  pid-file &#34;/run/named/named.pid&#34;;
  session-keyfile &#34;/run/named/session.key&#34;;

  /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
  include &#34;/etc/crypto-policies/back-ends/bind.config&#34;;
};

logging {
        channel default_debug {
                file &#34;data/named.run&#34;;
                severity dynamic;
        };
};

zone &#34;.&#34; IN {
	type hint;
	file &#34;named.ca&#34;;
};

zone &#34;homelab.jhw&#34; IN {
	type master;
	file &#34;forward.homelab.jhw&#34;;
	allow-update { none; };
	allow-query { any; };
};

zone &#34;1.168.192.in-addr.arpa&#34; IN {
	type master;
	file &#34;reverse.homelab.jhw&#34;;
	allow-update { none; };
	allow-query { any; };
};

zone &#34;16.172.in-addr.arpa&#34; IN {
        type master;
        file &#34;reverse2.homelab.jhw&#34;;
        allow-update { none; };
        allow-query { any; };
};

include &#34;/etc/named.rfc1912.zones&#34;;
include &#34;/etc/named.root.key&#34;;
</code></pre></div></div>

<p>The first block declare the general options. Yes, it looks complicated and it is, but let’s walk you through every relevant line (the lines not mentioned are default entries that don’t need to be changed).</p>

<div><div><pre><code>listen-on port 53 { 127.0.0.1; 192.168.1.10; 172.16.1.10; 10.88.0.1; };
listen-on-v6 port 53 { ::1; fdda:a4da:69a5:0:2783:8c26:b2f1:a6f7; };
allow-query     { localhost; 192.168.1.0/24; 172.16.0.0/16; 10.88.0.0/16; };
</code></pre></div></div>

<p>Here we tell BIND that it should listen for queries on port 53 on <code>localhost</code>, <code>192.168.1.10</code>, the IPv4 address in my hoem network, <code>172.16.1.10</code>, the second IPv4 address configured and <code>10.88.0.1</code>, the virtual IPv4 address the Raspberry uses to bridge to the local podman containers.</p>

<p>The second line does the same for IPv6, but that is something we will discuss in Part 2.</p>

<p>The third line tells BIND from whom to accept queries. Essentially from everyone on the three IPv4 networks we are listening to.</p>



<p>This is the directory where BIND will look for its zone files, that we will define later.</p>

<div><div><pre><code>forwarders { 192.168.1.254; };
recursion yes;
</code></pre></div></div>

<p>Now what if someone asks for a hostname that is outside of <code>homelab.jhw</code>? In that case we tell BIND to forward that question to <code>192.168.1.254</code>, our Fritz Box. We will allow recursion and cache results we get from our Fritz box to avoid unneeded traffic.</p>



<p>Our simple setup will not bother with DNSSEC at the moment. Maybe we will have a Part 3 for that.</p>

<p>OK. That was the options part. We will ignore the <code>logging</code> part and the <code>zone &#34;.&#34; IN</code> block.</p>

<p>Next (and finally) we define three zone entries (and zone files). A forward zone called <code>homelab.jhw</code> for our domain and two reverse zones for the IP addresses in the <code>192.168.1.0/24</code> range called <code>1.168.192.in-addr.arpa</code>. Yep. That’s 192.168.1 reversed. 1.168.192. That’s why it’s called the reverse zone ;) We also have <code>16.172.in-addr.arpa</code> for the <code>172.16.0.0/16</code> range. Let’s look at them.</p>

<div><div><pre><code>zone &#34;homelab.jhw&#34; IN {
	type master;
	file &#34;forward.homelab.jhw&#34;;
	allow-update { none; };
	allow-query { any; };
};
</code></pre></div></div>

<p>It’s a zone, all right. It’s the <code>master</code> for this zone, meaning that this DNS server will be the Source of Truth to  answer all queries for the <code>homelab.jhw</code> hostnames.</p>

<p>The exact mapping of all hostnames to IP addresses is in a file called <code>forward.homelab.jhw</code> in the directory <code>/var/named</code>. Remember how we defined that path at the beginning in the <code>options</code> part? Great! We also tell BIND that we do not allow dynamic updates for this zone, meaning that what’s in the file is all we will look at. Finally we tell BIND that any machine in the network is allowed to ask for a reply.</p>

<div><div><pre><code>zone &#34;1.168.192.in-addr.arpa&#34; IN {
	type master;
	file &#34;reverse.homelab.jhw&#34;;
	allow-update { none; };
	allow-query { any; };
};

zone &#34;16.172.in-addr.arpa&#34; IN {
        type master;
        file &#34;reverse2.homelab.jhw&#34;;
        allow-update { none; };
        allow-query { any; };
};
</code></pre></div></div>

<p>The reverse zones with the weird looking zone names are almost the same, except that we define these in two files called <code>reverse.homelab.jhw</code> for the reverse lookup of the <code>192.168.1.0/24</code> range and <code>reverse2.homelab.jhw</code> for the <code>172.16.0.0/16</code> range. Why these zones have weird names will be explained later.</p>

<p>So now we go to the zone files!</p>

<h3 id="forward-zone-for-homelabjhw">Forward zone for homelab.jhw</h3>

<p>The forward zone resolves names to IP addresses using A records (and other types like TXT, CAA and many more exist, but we won’t cover that in this post). It also contains CNAME entries, if you have services on one machine that should be reachable via more than one hostnames. In my homelab the CA (Certificate Authority) server is a container that runs on <code>inf01.homelab.jhw</code>, but should be reachable as <code>ca.homelab.jhw</code> in the home network. The CNAME entry does exactly that. It tells clients that when they want to talk to <code>ca.homelab.jhw</code> they can. By actually talking to <code>inf01.homelab.jhw</code>.</p>

<p>Now here is the big, important lessen for zone files. They have a serial number. Which MUST be incremented with every change. If you don’t, weird things WILL happen. So:</p>

<blockquote>
  <p>NEVER FORGET TO INCREASE THE SERIAL WITH EVERY CHANGE TO A ZONE FILE. OR RISK DNS HELL.</p>
</blockquote>

<p><code>/var/named/forward.homelab.jhw</code></p>

<div><div><pre><code>$TTL 3600
@   IN  SOA     inf01.homelab.jhw. root.homelab.jhw. (
        2025082706  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
@       IN  NS          inf01.homelab.jhw.
@       IN  A           192.168.1.10

inf01           IN  A     192.168.1.10
hl01            IN  A     192.168.1.11
hl02            IN  A     192.168.1.12
hl03            IN  A     192.168.1.13

ca              IN  CNAME inf01.homelab.jhw.

inf01-m         IN  A     172.16.1.10
hl01-m          IN  A     172.16.1.11
hl02-m          IN  A     172.16.1.12
hl03-m          IN  A     172.16.1.13
</code></pre></div></div>

<p>Again, let’s go through this.</p>



<p>The default Time To Live (TTL) for DNS entries is set at 3600 seconds. That’s 1 hour. This means that when a machine in the network gets a DNS reply, it will not ask again for the same thing until the TTL has passed.</p>

<div><div><pre><code>@   IN  SOA     inf01.homelab.jhw. root.homelab.jhw. (
        2025082706  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
</code></pre></div></div>

<p>The Start Of Authority (SOA) block. Here we say which DNS server is the owner of this domain. It’s <code>inf01.homelab.jhw.</code> (yes, that dot at the end is REALLY important). The <code>root.homelab.jhw</code> actually means <code>root@homelab.jhw</code> and is the email address responsible for this domain. Don’t think to much about why and what :)</p>

<div><div><pre><code>@       IN  NS          inf01.homelab.jhw.
@       IN  A           192.168.1.10
</code></pre></div></div>

<p>The first “real” DNS entries! They are special, as the <code>@</code> indicates, which means they represent the domain itself. We first define the nameserver (again? yes, don*‘t ask) as NS record. And right after that we define the <code>A</code> record as the IP address <code>192.168.1.10</code>.</p>

<p>Did you notice that <code>.</code> at the end of <code>inf01.homelab.jhw.</code>? That’s another VERY important thing. The TL;DR is that this final <code>.</code> tells DNS to stop doing fancy recursion and lookups. Just look for the hostname `inf01.homelab.jhw. Period. (pun intended). Don’t care too much about this. Just remember:</p>

<p><strong>EVERY HOSTNAME RECORD ENDS WITH A <code>.</code> YOU WILL FORGET THIS. YOU WILL FIX THIS.</strong></p>

<div><div><pre><code>inf01           IN  A     192.168.1.10
hl01            IN  A     192.168.1.11
hl02            IN  A     192.168.1.12
hl03            IN  A     192.168.1.13
</code></pre></div></div>

<p>Here come the <code>A</code> records for <code>192.168.1.0/24</code>! We finally get to map hostnames to IP addresses. For real! It now is quite self-explanatory, isn’t it? The hostname gets an A record that is the IP address in my local network. And as these are IP addresses, no <code>.</code> is needed at the end.</p>

<div><div><pre><code>ca              IN  CNAME inf01.homelab.jhw.
</code></pre></div></div>

<p>And here is the CNAME record. Which maps the hostname <code>ca.homelab.jhw</code> to the Canonical NAME (CNAME) <code>inf01.homelab.jhw.</code>. This is a hostname at the end! So it needs the <code>.</code> Period :)</p>

<div><div><pre><code>inf01-m         IN  A     172.16.1.10
hl01-m          IN  A     172.16.1.11
hl02-m          IN  A     172.16.1.12
hl03-m          IN  A     172.16.1.13
</code></pre></div></div>

<p>And here we create another set of <code>A</code> records for the same machines, but this time in the <code>172.16.0.0/16</code> range. This range is used for management stuff, hence the <code>-m</code>.</p>

<p>And that’s the gist of it. If you add a new machine to your network, configure it with an IP address (statically or with DHCP) and add it as an A record to the forward zone. Increment the serial and tell DNS to read the updated zone with <code>systemctl reload named</code>. Done.</p>

<h3 id="reverse-zones-for-1921681024-and-172160016">Reverse zones for 192.168.1.0/24 and 172.16.0.0/16</h3>

<p>The reverse zone maps IP addresses to hostnames. Often called the PTR or pointer record. You have to make sure that the entries here are synced to the forward zone.</p>

<blockquote>
  <p>NEVER FORGET TO INCREASE THE SERIAL WITH EVERY CHANGE TO A ZONE FILE. Or risk DNS hell.</p>
</blockquote>

<p>Here is the reverse zone for the <code>192.168.1.0/24</code> range.</p>

<p><code>/var/named/reverse.homelab.jhw</code></p>

<div><div><pre><code>$TTL 3600
@   IN  SOA     inf01.homelab.jhw. root.homelab.jhw. (
        2025082601  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
@       IN  NS          inf01.homelab.jhw.
@       IN  PTR         homelab.jhw.
10      IN  PTR         inf01.homelab.jhw.
11      IN  PTR         hl01.homelab.jhw.
12      IN  PTR         hl02.homelab.jhw.
13      IN  PTR         hl03.homelab.jhw.
</code></pre></div></div>

<p>As this is more or less the same but the other way round, I will not go through everything but instead explain the differences. It’s the reverse zone, so now we have <code>PTR</code> (pointer) entries that map an IPv4 address in the <code>192.168.1.0/24</code> range to hostnames. WITH A DOT AT THE END. DO NOT FORGET THE DOT!</p>

<p>As this is a /24 block, we only need to set the last digit of the IPv4 address.</p>

<p>You might wonder, where is <code>ca</code> here? Well, it’s CNAME is <code>info1.homelab.jhw</code> and that already is in this reverse zone. That is good enough. No separate entry needed.</p>

<p>We also need the reverse zone for the <code>172.16.0.0/16</code> range:</p>

<p><code>/var/named/reverse2.homelab.jhw</code></p>

<div><div><pre><code>$TTL 3600
@   IN  SOA     inf01.homelab.jhw. root.homelab.jhw. (
        2025082901  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
@       IN  NS          inf01.homelab.jhw.
@       IN  PTR         homelab.jhw.
10.1      IN  PTR         inf01-m.homelab.jhw.
11.1      IN  PTR         hl01-m.homelab.jhw.
12.1      IN  PTR         hl02-m.homelab.jhw.
13.1      IN  PTR         hl03-m.homelab.jhw.
</code></pre></div></div>

<p>Looks deceivingly similar. But there is a big difference. This is a /16 network, so we have to define the last two parts of the IPv4 address. And as it is a reverse zone file, yep, we have to reverse it. So now we need <code>10.1</code> to define the entry for <code>172.16.1.10</code>, which is the hostname <code>inf01-m.homelab.jhw</code>. WITH THE DOT AT THE END. AND DID YOU UPDATE THE SERIAL? :)</p>

<p>Phew. That’s the config done!</p>

<p>A final check with the <code>named-checkconf</code> command, which should say nothing when all files are OK. If not, it will tell you what is wrong so you get the chance to fix stuff. You did add all the <code>.</code> at the end of hostnames and you did update the serial of that zone file after you made changes, yes?</p>

<h2 id="start-bind">Start Bind</h2>

<p>The only thing remaining is to start BIND. And persist it as a service, so it starts after every boot. It’s DNS. It must always be available.</p>

<div><div><pre><code>systemctl <span>enable </span>named
systemctl start named
</code></pre></div></div>

<p>You most likely will make typos in your config. So do check with <code>named-checkconf </code> and <code>systemctl status named</code> and <code>journalctl -u named</code>. If something breaks, read this whole entry again. Find that missing <code>.</code> in a zone file. Increment the <code>serial</code> that you forgot to do. You will get there. Don’t give up!</p>

<h2 id="result">Result</h2>

<p>Machines, containers etc can now be resolved in my home network. All with mow own DNS! Yay!</p>

<div><div><pre><code>% nslookup jhwfritz.fritz.box
Server:		192.168.1.10
Address:	192.168.1.10#53

Non-authoritative answer:
Name:	jhwfritz.fritz.box
Address: 192.168.1.254

% nslookup ca.homelab.jhw    
Server:		192.168.1.10
Address:	192.168.1.10#53

ca.homelab.jhw	canonical name <span>=</span> inf01.homelab.jhw.
Name:	inf01.homelab.jhw
Address: 192.168.1.10
</code></pre></div></div>

<p>And now you should be able to <code>ping</code> the machines with their hostname. ssh into them. Get certificates with the CA that runs in the podman container. Life is good!</p>

<p>I hope you enjoyed this post and could learn something new! Feel free to comment or send corrections vie the Toot linked below that collects the comments!</p>
</section></div>
  </body>
</html>
