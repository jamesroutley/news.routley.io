<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mareknarozniak.com/2020/06/22/constraint-programming/">Original</a>
    <h1>Constraint Programming (2020)</h1>
    
    <div id="readability-page-1" class="page"><div>
      <article itemscope="" itemtype="http://schema.org/BlogPosting">
  
  <div itemprop="articleBody">
    <p>Computer programming is more than having a machine blindly following bunch of rules under the form of computer program. There are many paradigms of programming and constraint logic programming <a href="#10.1145/41625.41635">(Jaffar &amp; Lassez, 1987)</a> is a form of nondeterministic programming <a href="#Floyd1967">(Floyd, 1967)</a>. Under constraint program, your “program” is a model involving constraints, which is to be processed by a solver searching for solution or a set of solutions to the model.</p>

<p>The <em>constraint satisfaction problem</em> involves a set of variables <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">X</mi></mrow><annotation encoding="application/x-tex">\Chi</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>X</span></span></span></span></span>, their respective domains <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>D</span></span></span></span> and a set of constraints <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>C</span></span></span></span> that have to be satisfied, putting it all together gives the following structure.</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">X</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(CSP)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">(\Chi, D, C) \tag{CSP}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>(</span><span><span>X</span></span><span>,</span><span></span><span>D</span><span>,</span><span></span><span>C</span><span>)</span></span><span><span></span><span><span>(</span><span><span>C</span><span>S</span><span>P</span></span><span>)</span></span></span></span></span></span></p><p>[diophantine equation over finite domains]</p>

<p>As an example problem, let us define the CSP for solving a particular example of a <a href="https://en.wikipedia.org/wiki/Diophantine_equation">diophantine equation</a> <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>−</mo><msup><mi>z</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x^3+y^2-z^2=0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span>z</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span> over finite domain <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo>…</mo><mn>10</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1 \dots 10]</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>[</span><span>1</span><span></span><span>…</span><span></span><span>1</span><span>0</span><span>]</span></span></span></span> for each of the variables <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span>, <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>y</span></span></span></span> and <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>z</span></span></span></span>.</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>P</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">X</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi mathvariant="normal">X</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">}</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>D</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><mi>x</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo>…</mo><mn>10</mn><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>y</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo>…</mo><mn>10</mn><mo stretchy="false">]</mo><mo separator="true">,</mo><mi>z</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo>…</mo><mn>10</mn><mo stretchy="false">]</mo><mo stretchy="false">}</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>C</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>−</mo><msup><mi>z</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn><mo stretchy="false">}</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
P &amp;= (\Chi, D, C), \\
\Chi &amp;= \{x, y, z\},\\
D &amp;= \{x \in [1 \dots 10], y \in [1 \dots 10], z \in [1 \dots 10]\},\\
C &amp;= \{x^3+y^2-z^2=0\}
\end{aligned}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>P</span></span></span><span><span></span><span><span><span>X</span></span></span></span><span><span></span><span><span>D</span></span></span><span><span></span><span><span>C</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>X</span></span><span>,</span><span></span><span>D</span><span>,</span><span></span><span>C</span><span>)</span><span>,</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>{</span><span>x</span><span>,</span><span></span><span>y</span><span>,</span><span></span><span>z</span><span>}</span><span>,</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>{</span><span>x</span><span></span><span>∈</span><span></span><span>[</span><span>1</span><span></span><span>…</span><span></span><span>1</span><span>0</span><span>]</span><span>,</span><span></span><span>y</span><span></span><span>∈</span><span></span><span>[</span><span>1</span><span></span><span>…</span><span></span><span>1</span><span>0</span><span>]</span><span>,</span><span></span><span>z</span><span></span><span>∈</span><span></span><span>[</span><span>1</span><span></span><span>…</span><span></span><span>1</span><span>0</span><span>]</span><span>}</span><span>,</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>{</span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>−</span><span></span><span><span>z</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span><span>0</span><span>}</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></p><p>Easiest way to get started, at least for me, would be to use a simple constraint programming library for Python <a href="https://pypi.org/project/python-constraint/">python-constraint</a>. Let us start by creating empty model, define variables and their finite domains.</p>

<div><div><pre><code><span>from</span> <span>constraint</span> <span>import</span> <span>Problem</span>
<span>problem</span> <span>=</span> <span>Problem</span><span>()</span>
<span>problem</span><span>.</span><span>addVariable</span><span>(</span><span>&#39;x&#39;</span><span>,</span> <span>range</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>))</span>
<span>problem</span><span>.</span><span>addVariable</span><span>(</span><span>&#39;y&#39;</span><span>,</span> <span>range</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>))</span>
<span>problem</span><span>.</span><span>addVariable</span><span>(</span><span>&#39;z&#39;</span><span>,</span> <span>range</span><span>(</span><span>1</span><span>,</span> <span>10</span><span>))</span>
</code></pre></div></div>

<p>Define custom constraint that checks if the diophantine equation is satisfied.</p>

<div><div><pre><code><span>def</span> <span>constraintCheck</span><span>(</span><span>x</span><span>,</span> <span>y</span><span>,</span> <span>z</span><span>):</span>
    <span>if</span> <span>x</span><span>**</span><span>3</span> <span>+</span> <span>y</span><span>**</span><span>2</span> <span>-</span> <span>z</span><span>**</span><span>2</span> <span>==</span> <span>0</span><span>:</span>
        <span>return</span> <span>True</span>
    <span>return</span> <span>False</span>
<span>problem</span><span>.</span><span>addConstraint</span><span>(</span><span>constraintCheck</span><span>,</span> <span>[</span><span>&#39;x&#39;</span><span>,</span> <span>&#39;y&#39;</span><span>,</span> <span>&#39;z&#39;</span><span>])</span>
</code></pre></div></div>

<p>Process the model and get all the solutions and print them out.</p>

<div><div><pre><code><span>solutions</span> <span>=</span> <span>problem</span><span>.</span><span>getSolutions</span><span>()</span>
<span>for</span> <span>solution</span> <span>in</span> <span>solutions</span><span>:</span>
    <span>print</span><span>(</span><span>solution</span><span>)</span>
    <span>x</span> <span>=</span> <span>solution</span><span>[</span><span>&#39;x&#39;</span><span>]</span>
    <span>y</span> <span>=</span> <span>solution</span><span>[</span><span>&#39;y&#39;</span><span>]</span>
    <span>z</span> <span>=</span> <span>solution</span><span>[</span><span>&#39;z&#39;</span><span>]</span>
    <span># you can do something with the values of x, y, z here
</span></code></pre></div></div>

<p>This provides us with the following output.</p>

<table>
  <thead>
    <tr>
      <th><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>x</span></span></span></span></th>
      <th><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>y</span></span></span></span></th>
      <th><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>z</span></span></span></span></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>3</span></span></span></span></td>
      <td><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>3</span></span></span></span></td>
      <td><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn></mrow><annotation encoding="application/x-tex">6</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>6</span></span></span></span></td>
    </tr>
    <tr>
      <td><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>2</span></span></span></span></td>
      <td><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>1</span></span></span></span></td>
      <td><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>3</span></span></span></span></td>
    </tr>
  </tbody>
</table>

<p>If we plug in those values to <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>3</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>−</mo><msup><mi>z</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x^3+y^2-z^2=0</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>3</span></span></span></span></span></span></span></span><span></span><span>+</span><span></span></span><span><span></span><span><span>y</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>−</span><span></span></span><span><span></span><span><span>z</span><span><span><span><span><span><span></span><span><span>2</span></span></span></span></span></span></span></span><span></span><span>=</span><span></span></span><span><span></span><span>0</span></span></span></span> it indeed check out. It is a small but good example showing how powerful constraint programming is for solving the combinatorial problem.</p>

<p>What about optimization problems? What differs <em>constraint satisfaction problem</em> from <em>constraint optimization problem</em> would be the objective function and a criterion. The objective function is a mathematical function accepting assignment of values to variables <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">X</mi></mrow><annotation encoding="application/x-tex">\Chi</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>X</span></span></span></span></span> withing their respective domains <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>D</span></span></span></span> and returns a number. The criterion is either minimization either maximization, since those are equivalent up to a sign let us just assume from now on we we have minimization by default. If we incorporate those concepts the <em>constraint satisfaction problem</em> will become the <em>constraint optimization problem</em> and what differs them is there is some sort of measure of quality of solution and not all solutions are equivalent, some are preferred over others.</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">X</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mtext>min</mtext><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="normal">X</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(COP)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">(\Chi, D, C, \text{min} f(\Chi)) \tag{COP}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>(</span><span><span>X</span></span><span>,</span><span></span><span>D</span><span>,</span><span></span><span>C</span><span>,</span><span></span><span><span>min</span></span><span>f</span><span>(</span><span><span>X</span></span><span>)</span><span>)</span></span><span><span></span><span><span>(</span><span><span>C</span><span>O</span><span>P</span></span><span>)</span></span></span></span></span></span></p><p>We have a nice example of problem we could use to define and solve an example <em>constraint optimization problem</em>, we have our Pokémon Centers and Pokémon Gyms problem from <a href="https://mareknarozniak.com/2020/04/22/vertex-cover-independent-set-game-level-design/">Vertex Covers and Independent Sets in game level design</a> and we also have a quantum adiabatic solution to compare from <a href="https://mareknarozniak.com/2020/05/22/quantum-adiabatic-optimization/">Quantum Adiabatic Optimization</a>. If you haven’t read those tutorials I highly recommend you check them now to know what the problem is about, and if you are already familiar with it, let us proceed with a model.</p>

<p><span><span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>P</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">X</mi><mo separator="true">,</mo><mi>D</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mtext>min</mtext><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="normal">X</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi mathvariant="normal">X</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><msub><mi>x</mi><mtext>Pallet Town</mtext></msub><mo separator="true">,</mo><msub><mi>x</mi><mtext>Viridian City</mtext></msub><mo separator="true">,</mo><mo>…</mo><msub><mi>x</mi><mtext>Cinnabar Island</mtext></msub><mo stretchy="false">}</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>D</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><mi>x</mi><mo>∈</mo><mo stretchy="false">{</mo><mtext>center</mtext><mo separator="true">,</mo><mtext>gym</mtext><mo stretchy="false">}</mo><mi mathvariant="normal">∣</mi><mi>x</mi><mo>∈</mo><mi mathvariant="normal">X</mi><mo stretchy="false">}</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>C</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">{</mo><mi mathvariant="normal">∣</mi><mo stretchy="false">{</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>b</mi></msub><mo stretchy="false">}</mo><mo>∩</mo><mo stretchy="false">{</mo><mtext>gym</mtext><mo stretchy="false">}</mo><mi mathvariant="normal">∣</mi><mo>≤</mo><mn>1</mn><mi mathvariant="normal">∣</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>a</mi></msub><mo separator="true">,</mo><msub><mi>x</mi><mi>b</mi></msub><mo stretchy="false">)</mo><mo>∈</mo><mi>E</mi><mo stretchy="false">(</mo><mi>G</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi mathvariant="normal">X</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munder><mo>∑</mo><mrow><msub><mi>x</mi><mi>a</mi></msub><mo>∈</mo><mi mathvariant="normal">X</mi></mrow></munder><mi mathvariant="normal">∣</mi><mo stretchy="false">{</mo><msub><mi>x</mi><mi>a</mi></msub><mo stretchy="false">}</mo><mo>∩</mo><mo stretchy="false">{</mo><mtext>center</mtext><mo stretchy="false">}</mo><mi mathvariant="normal">∣</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
P &amp;= (\Chi, D, C, \text{min} f(\Chi)), \\
\Chi &amp;= \{x_\text{Pallet Town}, x_\text{Viridian City}, \dots x_\text{Cinnabar Island}\},\\
D &amp;= \{x \in \{\text{center}, \text{gym}\} \vert x \in \Chi\},\\
C &amp;= \{\vert\{x_a, x_b\} \cap \{\text{gym}\}\vert \leq 1\vert (x_a, x_b) \in E(G)\},\\
f(\Chi) &amp;= \sum_{x_a \in \Chi} \vert\{x_a\} \cap \{\text{center}\}\vert
\end{aligned}</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span><span><span><span><span><span><span></span><span><span>P</span></span></span><span><span></span><span><span><span>X</span></span></span></span><span><span></span><span><span>D</span></span></span><span><span></span><span><span>C</span></span></span><span><span></span><span><span>f</span><span>(</span><span><span>X</span></span><span>)</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span><span><span><span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>(</span><span><span>X</span></span><span>,</span><span></span><span>D</span><span>,</span><span></span><span>C</span><span>,</span><span></span><span><span>min</span></span><span>f</span><span>(</span><span><span>X</span></span><span>)</span><span>)</span><span>,</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>{</span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>Pallet Town</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>Viridian City</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span>…</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span><span>Cinnabar Island</span></span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>}</span><span>,</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>{</span><span>x</span><span></span><span>∈</span><span></span><span>{</span><span><span>center</span></span><span>,</span><span></span><span><span>gym</span></span><span>}</span><span>∣</span><span>x</span><span></span><span>∈</span><span></span><span><span>X</span></span><span>}</span><span>,</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span>{</span><span>∣</span><span>{</span><span><span>x</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>}</span><span></span><span>∩</span><span></span><span>{</span><span><span>gym</span></span><span>}</span><span>∣</span><span></span><span>≤</span><span></span><span>1</span><span>∣</span><span>(</span><span><span>x</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>,</span><span></span><span><span>x</span><span><span><span><span><span><span></span><span><span>b</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>)</span><span></span><span>∈</span><span></span><span>E</span><span>(</span><span>G</span><span>)</span><span>}</span><span>,</span></span></span><span><span></span><span><span></span><span></span><span>=</span><span></span><span><span><span><span><span><span></span><span><span><span><span>x</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>∈</span><span><span>X</span></span></span></span></span><span><span></span><span><span>∑</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span><span></span><span>∣</span><span>{</span><span><span>x</span><span><span><span><span><span><span></span><span><span>a</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span><span>}</span><span></span><span>∩</span><span></span><span>{</span><span><span>center</span></span><span>}</span><span>∣</span></span></span></span><span>​</span></span><span><span><span></span></span></span></span></span></span></span></span></span></span></span></p><p>Variables <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">X</mi></mrow><annotation encoding="application/x-tex">\Chi</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span><span>X</span></span></span></span></span> are towns from Kanto region map from original Pokémon games, their domains <span><span><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span aria-hidden="true"><span><span></span><span>D</span></span></span></span> consist of two values - they can be either Pokémon Centers either Pokémon Gyms, finally the constraints enforce the condition of the <em>independent set</em> and we use the the objective function to minimize the overal number of Pokémon centers, effectively solving the <em>minimum vertex cover problem</em>.</p>

<p>As with the previous example, we start by defining empty model.</p>

<div><div><pre><code><span>G</span> <span>=</span> <span>(</span><span>V</span><span>,</span> <span>E</span><span>)</span>
<span>V</span> <span>=</span> <span>list</span><span>(</span><span>V</span><span>)</span>
<span>E</span> <span>=</span> <span>list</span><span>(</span><span>E</span><span>)</span>
<span>problem</span> <span>=</span> <span>Problem</span><span>()</span>
</code></pre></div></div>

<p>To define the variables and their domains we follow our definition - every town in Kanto can have either a Pokémon Centers either Pokémon Gyms.</p>

<div><div><pre><code><span>for</span> <span>town</span> <span>in</span> <span>V</span><span>:</span>
    <span>varname</span> <span>=</span> <span>town</span><span>.</span><span>lower</span><span>()</span><span>.</span><span>replace</span><span>(</span><span>&#39; &#39;</span><span>,</span> <span>&#39;_&#39;</span><span>)</span>
    <span>problem</span><span>.</span><span>addVariable</span><span>(</span><span>varname</span><span>,</span> <span>[</span><span>&#39;center&#39;</span><span>,</span> <span>&#39;gym&#39;</span><span>])</span>
</code></pre></div></div>

<p>Only one specific constraint is required for each edge of the graph (or each route), it is the <em>independent set</em> constraint - there can be no two Pokémon Gyms next to each other.</p>

<div><div><pre><code><span>for</span> <span>pair</span> <span>in</span> <span>list</span><span>(</span><span>E</span><span>):</span>
    <span>dest_i</span><span>,</span> <span>dest_j</span> <span>=</span> <span>tuple</span><span>(</span><span>pair</span><span>)</span>
    <span>dest_i</span> <span>=</span> <span>dest_i</span><span>.</span><span>lower</span><span>()</span><span>.</span><span>replace</span><span>(</span><span>&#39; &#39;</span><span>,</span> <span>&#39;_&#39;</span><span>)</span>
    <span>dest_j</span> <span>=</span> <span>dest_j</span><span>.</span><span>lower</span><span>()</span><span>.</span><span>replace</span><span>(</span><span>&#39; &#39;</span><span>,</span> <span>&#39;_&#39;</span><span>)</span>
    <span>problem</span><span>.</span><span>addConstraint</span><span>(</span><span>lambda</span> <span>x</span><span>,</span> <span>y</span><span>:</span> <span>True</span> <span>if</span> <span>not</span> <span>x</span> <span>==</span> <span>y</span> <span>==</span> <span>&#39;gym&#39;</span> <span>else</span> <span>False</span><span>,</span> <span>[</span><span>dest_i</span><span>,</span> <span>dest_j</span><span>])</span>
</code></pre></div></div>

<p>We process the model and get the all the CSP solutions</p>

<div><div><pre><code><span>solutions</span> <span>=</span> <span>problem</span><span>.</span><span>getSolutions</span><span>()</span>
</code></pre></div></div>

<p>Now the tricky part, the <code>python-constraint</code> library does not support <em>constraint optimization problems</em>, so we will have to do a little hack to get the COP solutions - we can filter out the solutions that satisfy the criteria. To make things a bit more fun, we will implement both objective function, the <em>minimum vertex cover</em> and <em>maximum independent set</em> criteria just to check if they match (they must).</p>

<div><div><pre><code><span>best_mis</span> <span>=</span> <span>[]</span>
<span>best_mis_size</span> <span>=</span> <span>0</span>
<span>best_mvc</span> <span>=</span> <span>[]</span>
<span>best_mvc_size</span> <span>=</span> <span>len</span><span>(</span><span>V</span><span>)</span> <span>+</span> <span>1</span>
<span># get COP solution
</span><span>for</span> <span>solution</span> <span>in</span> <span>solutions</span><span>:</span>
    <span>values</span> <span>=</span> <span>list</span><span>(</span><span>solution</span><span>.</span><span>values</span><span>())</span>
    <span>nb_gyms</span> <span>=</span> <span>values</span><span>.</span><span>count</span><span>(</span><span>&#39;gym&#39;</span><span>)</span>
    <span>nb_centers</span> <span>=</span> <span>values</span><span>.</span><span>count</span><span>(</span><span>&#39;center&#39;</span><span>)</span>
    <span># MVC criterion
</span>    <span>if</span> <span>nb_centers</span> <span>&lt;</span> <span>best_mvc_size</span><span>:</span>
        <span>best_mvc</span> <span>=</span> <span>[</span><span>solution</span><span>]</span>
        <span>best_mvc_size</span> <span>=</span> <span>nb_centers</span>
    <span>elif</span> <span>nb_gyms</span> <span>==</span> <span>best_mvc_size</span><span>:</span>
        <span>best_mvc</span><span>.</span><span>append</span><span>(</span><span>solution</span><span>)</span>
    <span># MIS criterion
</span>    <span>if</span> <span>nb_gyms</span> <span>&gt;</span> <span>best_mis_size</span><span>:</span>
        <span>best_mis</span> <span>=</span> <span>[</span><span>solution</span><span>]</span>
        <span>best_mis_size</span> <span>=</span> <span>nb_gyms</span>
    <span>elif</span> <span>nb_centers</span> <span>==</span> <span>best_mis_size</span><span>:</span>
        <span>best_mis</span><span>.</span><span>append</span><span>(</span><span>solution</span><span>)</span>
</code></pre></div></div>

<p>Let us this Python trick to check if lists of dictionaries are deeply equal.</p>

<div><div><pre><code><span>assert</span> <span>[</span><span>i</span> <span>for</span> <span>i</span> <span>in</span> <span>best_mis</span> <span>if</span> <span>i</span> <span>not</span> <span>in</span> <span>best_mvc</span><span>]</span> <span>==</span> <span>[]</span>
</code></pre></div></div>

<p>If they don’t match that would crash… And it didn’t (you will have to trust me or run by yourself).</p>

<p>Let us continue the tradition and visualize the solutions in retrograming style!</p>

<figure>
   <a href="#">
     <p><img src="https://mareknarozniak.com/assets/figures/figure-qmvc-cp.png" alt="Comparing the quantum solutions to the set theoretical brute force solutions"/>
      </p>
   </a>
   
</figure>

<p>Totally matches the quantum solution from <a href="https://mareknarozniak.com/2020/05/22/quantum-adiabatic-optimization/">Quantum Adiabatic Optimization</a>… And from now on let us use COP solution as the reference, it is much smarter way to get solutions than brute force we used in <a href="https://mareknarozniak.com/2020/04/22/vertex-cover-independent-set-game-level-design/">Vertex Covers and Independent Sets in game level design</a>. Even if we hacked around to get the COP criterion processed, which is not very memory efficient, it still should be better. For larger models I highly recommend to use library that already incorporates COP criteria in their search algorithm.</p>

<p>I think that would be it, I decided to keep it brief this time. As usual, if you find errors or typos, or just want to discuss, feel free to tweet me!</p>

<p>For the complete source code please consult the <a href="https://gist.github.com/marekyggdrasil/bb953f9bfd85430c1001c294ea7108ce">gist repository</a></p>

<ol><li><p><span id="10.1145/41625.41635">Jaffar, J., &amp; Lassez, J.-L. (1987). Constraint Logic Programming. In <i>Proceedings of the 14th ACM SIGACT-SIGPLAN Symposium on Principles of Programming Languages</i>, POPL ’87 (pp. 111–119). New York, NY, USA: Association for Computing Machinery.</span>
    
    <span><a href="https://doi.org/10.1145/41625.41635">10.1145/41625.41635</a></span>
    
</p>
</li>
<li><p><span id="Floyd1967">Floyd, R. W. (1967). Nondeterministic Algorithms. <i>J. ACM</i>, <i>14</i>(4), 636–644.</span>
    
    <span><a href="https://doi.org/10.1145/321420.321422">10.1145/321420.321422</a></span>
    
</p>
</li></ol>


    <p>[<a href="#top">Back to Top</a>]</p>
  </div>
  

</article>

    </div></div>
  </body>
</html>
