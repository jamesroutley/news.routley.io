<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://android-developers.googleblog.com/2023/12/virtual-machines-as-core-android-primitive.html">Original</a>
    <h1>Virtual Machine as a core Android Primitive</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<meta name="twitter:image" content="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj3K8ZNCgF96aUEngG-N-ilXHjMZv2WidIhseXT1JIua_Z8KiVapdoSViSky-4ChuQ1_hgs6ktkobMo0Jh1OLk4vejenA7mt1gjSi_VQqXr3gLeR8g3aCGForCLlTmZ9-4PQg0GL7Gn1w_F_OYGoUjvywqFf-3ZDe0LCETPDkZLkHjTn93MZ9Fwjkq05dI/s1600/social-Android-Virtualization-as-a-core-Android-Primitive.png"/>
<p>

<em>Posted by Sandeep Patil – Principal Software Engineer, and Irene Ang – Product Manager</em>

<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQUgLI8VNIOZk5Bf6wOTHe-4hrSSwlxck3cwoTbFYyy5uG219Ira8WsI8euGWfx20d3aNbWTGj5aCJX3XuQOdMZv6zS9PRI9HseNAoUwN42t4EjctfvbN_04Gk5vwZDaABvHToYMibcLBHrimTrEPWYbPGbE8hqOKuJoDRFBiezCClclCjLKrNhSOvdzA/s1600/Android-Virtualization-as-a-core-Android-Primitive.png" imageanchor="1"><img data-original-height="800" data-original-width="100%" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQUgLI8VNIOZk5Bf6wOTHe-4hrSSwlxck3cwoTbFYyy5uG219Ira8WsI8euGWfx20d3aNbWTGj5aCJX3XuQOdMZv6zS9PRI9HseNAoUwN42t4EjctfvbN_04Gk5vwZDaABvHToYMibcLBHrimTrEPWYbPGbE8hqOKuJoDRFBiezCClclCjLKrNhSOvdzA/s1600/Android-Virtualization-as-a-core-Android-Primitive.png"/></a></p><p>The <b>Android Virtualization Framework (AVF)</b> will be available on upcoming select Android 14 devices. The AVF, first introduced in Android 13 on Pixel devices, provides new capabilities for platform developers working on privileged applications. </p>


<p>With AVF, we are more broadly supporting virtualization to Android. Virtualization is widely used and deployed to isolate workloads and operating systems from each other. It enables efficient scaling of infrastructure, testing environments, legacy software compatibility, creating virtual desktops and much more.</p>

<p>With AVF virtual machines become a core construct of the Android operating system, similar to the way Android utilizes Linux processes. Developers have the flexibility to choose the level of isolation for a virtual machine:</p>
<ul><ul>
<li><b>One-way isolation:</b> Android (the host) can control and inspect the contents of the VM. These are most commonly used for sandboxing and separation, enabling multiple operating systems to run on the same machine / device, with one operating system host (Android) controlling and watching over all others.</li></ul></ul><ul><ul>


<li><b>Two-way isolation (Isolated VM):</b> Android (the host) and the virtual machine (the guest) are completely isolated from each other. Developers who deal with or store sensitive data may benefit  from an isolated virtual machine. An isolated virtual machine has a two-way barrier, where neither the host (Android) nor the VM have access to each other, except via explicitly-agreed-upon communication channels.  This has 2 main properties:</li></ul></ul><blockquote><blockquote><ol><li>The workload and data inside the VM is inaccessible (confidential) from the host (Android).</li><li>Even if Android is compromised all the way up to (and including) the host kernel, the isolated VM remains uncompromised.</li></ol></blockquote></blockquote>

<h3>Benefits of AVF</h3>
<h4><span>Isolation</span></h4> 
<p>With an isolated VM, developers now have an alternative to Trustzone for use cases that need isolation from Android without escalated privilege.</p>


<h4><span>Portability</span></h4>  
<p>Virtual machines and the applications running inside them are far more portable than trusted applets. For example, a Linux-based virtual machine with a Linux-application payload will work on all devices that support AVF. This means that developers can build an application once and deploy it everywhere. VMs also make porting of existing Linux based applications seamless and easy, compared to porting into a Trustzone operating system.</p>  

<h4><span>Performance</span></h4>
<p>AVF is designed to be lightweight, efficient and flexible. Virtual machines can:</p>
<ul><ul>
<li>be as small as a single C program and as big as an entire operating system depending on the developer’s need;</li>
<li>be persistent or intermittent;</li>
<li>grow in memory or shrink depending on the overall system health; and</li>
<li>honor Android’s scheduler hints and low-memory warnings.</li>
</ul></ul>

<h4><span>Extensibility</span></h4>
<p>AVF is designed with developers in mind. Virtual machines can be customized to meet specific use-case needs. Developers can deploy any VM payload as long as it conforms to certain boot and communication protocols specified by AVF. </p> 


<p>In addition to bringing the power of virtualization to Android and enabling all the possibilities of virtual desktops, sandboxing, AVF’s use of isolated virtual machines can benefit the following common Android use cases (and many more):</p>
<ul><ul>
  <li><b>Biometrics:</b> By deploying biometric trusted applets in an isolated virtual machine, developers will have the isolation guarantee, access to more compute power for biometric algorithms, easy updatability regardless of the Trustzone operating system, and a more streamlined deployment.</li></ul></ul><ul><ul>
  <li><b>DRM:</b> Widevine enables streaming DRM on Android devices. Once deployed in an isolated Virtual Machine, updates to Widevine become much easier across Android devices, regardless of the details of the various Trustzone operating systems being deployed on those devices.</li></ul></ul><ul><ul>
</ul></ul>

<h3>AVF Usage</h3>

<p>AVF provides easy <a href="https://cs.android.com/android/platform/superproject/main/+/main:packages/modules/Virtualization/javalib/README.md" target="_blank">APIs</a> to query the device’s ability to create virtual machines and their supported types, and to set up secure communication channels with these virtual machines from applications and services that create them.</p>

<p>For example, to check for the availability of the AVF APIs, and of isolated and regular VM:</p>

<div><pre><span>VirtualMachineManager manager <span>=</span>
     (VirtualMachineManager)context<span>.</span>
          getSystemService(VirtualMachineManager<span>.</span>class)<span>;</span>
<span>if</span> (manager <span>==</span> null) {
    <span>//</span> AVF <span>not</span> supported
} <span>else</span> {
    <span>int</span> capabilities <span>=</span> manager<span>.</span>getCapabilities()<span>;</span>
    <span>if</span> ((capabilities <span>&amp;</span> CAPABILITY_PROTECTED_VM) <span>!=</span> <span>0</span>) {
        <span>//</span> protected VM is supported
    }
    <span>if</span> ((capabilities <span>&amp;</span> CAPABILITY_NON_PROTECTED_VM) <span>!=</span> <span>0</span>) {
        <span>//</span> non protected VM is supported
    }
}</span>
</pre></div>

<p>Please find additional documentation on AVF and its APIs <a href="https://source.android.com/docs/core/virtualization" target="_blank">here</a>. </p>

<h3>AVF Components</h3>

<p><img/></p><p><img alt="AVF Component architecture" id="imgCaption" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjqoflrFdKllbCL-ksao2ozMc0Vwp3eAXNadr58iaiCyd4noAKVuwaetGcVVoU1s1s_g3FA94wCHv_wg8AYbnczEY518U98tUwpYqkyLM-H2IbKpJcNY55xg6yCw5KO2Nk5HW2uAxAGNBXVdDVm8dNdG4das2y7RBWaQCWleykRilaLbd0sfFnb0JOXgC0/s1600/image1.png"/></p></div>
<hr/>

</div></div>
  </body>
</html>
