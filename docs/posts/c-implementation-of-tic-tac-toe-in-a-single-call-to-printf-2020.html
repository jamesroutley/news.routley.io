<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/carlini/printf-tac-toe">Original</a>
    <h1>C implementation of Tic-Tac-Toe in a single call to printf (2020)</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">A c implementation of tic-tac-toe in a single call to printf. Written for IOCCC 2020.</p>
<div data-snippet-clipboard-copy-content="#include &lt;stdio.h&gt; 

#define N(a)       &#34;%&#34;#a&#34;$hhn&#34;
#define O(a,b)     &#34;%10$&#34;#a&#34;d&#34;N(b)
#define U          &#34;%10$.*37$d&#34;
#define G(a)       &#34;%&#34;#a&#34;$s&#34;
#define H(a,b)     G(a)G(b)
#define T(a)       a a 
#define s(a)       T(a)T(a)
#define A(a)       s(a)T(a)a
#define n(a)       A(a)a
#define D(a)       n(a)A(a)
#define C(a)       D(a)a
#define R          C(C(N(12)G(12)))
#define o(a,b,c)   C(H(a,a))D(G(a))C(H(b,b)G(b))n(G(b))O(32,c)R
#define SS         O(78,55)R &#34;\n\033[2J\n%26$s&#34;;
#define E(a,b,c,d) H(a,b)G(c)O(253,11)R G(11)O(255,11)R H(11,d)N(d)O(253,35)R
#define S(a,b)     O(254,11)H(a,b)N(68)R G(68)O(255,68)N(12)H(12,68)G(67)N(67)

char* fmt = O(10,39)N(40)N(41)N(42)N(43)N(66)N(69)N(24)O(22,65)O(5,70)O(8,44)N(
            45)N(46)N    (47)N(48)N(    49)N( 50)N(     51)N(52)N(53    )O( 28,
            54)O(5,        55) O(2,    56)O(3,57)O(      4,58 )O(13,    73)O(4,
            71 )N(   72)O   (20,59    )N(60)N(61)N(       62)N (63)N    (64)R R
            E(1,2,   3,13   )E(4,    5,6,13)E(7,8,9        ,13)E(1,4    ,7,13)E
            (2,5,8,        13)E(    3,6,9,13)E(1,5,         9,13)E(3    ,5,7,13
            )E(14,15,    16,23)    E(17,18,19,23)E(          20, 21,    22,23)E
            (14,17,20,23)E(15,    18,21,23)E(16,19,    22     ,23)E(    14, 18,
            22,23)E(16,18,20,    23)R U O(255 ,38)R    G (     38)O(    255,36)
            R H(13,23)O(255,    11)R H(11,36) O(254    ,36)     R G(    36 ) O(
            255,36)R S(1,14    )S(2,15)S(3, 16)S(4,    17 )S     (5,    18)S(6,
            19)S(7,20)S(8,    21)S(9    ,22)H(13,23    )H(36,     67    )N(11)R
            G(11)&#34;&#34;O(255,    25 )R        s(C(G(11)    ))n (G(          11) )G(
            11)N(54)R C(    &#34;aa&#34;)   s(A(   G(25)))T    (G(25))N         (69)R o
            (14,1,26)o(    15, 2,   27)o   (16,3,28    )o( 17,4,        29)o(18
            ,5,30)o(19    ,6,31)o(        20,7,32)o    (21,8,33)o       (22 ,9,
            34)n(C(U)    )N( 68)R H(    36,13)G(23)    N(11)R C(D(      G(11)))
            D(G(11))G(68)N(68)R G(68)O(49,35)R H(13,23)G(67)N(11)R C(H(11,11)G(
            11))A(G(11))C(H(36,36)G(36))s(G(36))O(32,58)R C(D(G(36)))A(G(36))SS

#define arg d+6,d+8,d+10,d+12,d+14,d+16,d+18,d+20,d+22,0,d+46,d+52,d+48,d+24,d\
            +26,d+28,d+30,d+32,d+34,d+36,d+38,d+40,d+50,(scanf(d+126,d+4),d+(6\
            -2)+18*(1-d[2]%2)+d[4]*2),d,d+66,d+68,d+70, d+78,d+80,d+82,d+90,d+\
            92,d+94,d+97,d+54,d[2],d+2,d+71,d+77,d+83,d+89,d+95,d+72,d+73,d+74\
            ,d+75,d+76,d+84,d+85,d+86,d+87,d+88,d+100,d+101,d+96,d+102,d+99,d+\
            67,d+69,d+79,d+81,d+91,d+93,d+98,d+103,d+58,d+60,d+98,d+126,d+127,\
            d+128,d+129

char d[538] = {1,0,10,0,10};

int main() {
    while(*d) printf(fmt, arg);
}"><pre>#<span>include</span> <span><span>&lt;</span>stdio.h<span>&gt;</span></span> 

#<span>define</span> <span>N</span>(<span>a</span>)       <span><span>&#34;</span>%<span>&#34;</span></span>#a<span><span>&#34;</span>$hhn<span>&#34;</span></span>
#<span>define</span> <span>O</span>(<span>a,b</span>)     <span><span>&#34;</span>%10$<span>&#34;</span></span>#a<span><span>&#34;</span>d<span>&#34;</span></span>N(b)
#<span>define</span> <span>U</span>          <span><span>&#34;</span><span>%10$.*37$d</span><span>&#34;</span></span>
#<span>define</span> <span>G</span>(<span>a</span>)       <span><span>&#34;</span>%<span>&#34;</span></span>#a<span><span>&#34;</span>$s<span>&#34;</span></span>
#<span>define</span> <span>H</span>(<span>a,b</span>)     G(a)G(b)
#<span>define</span> <span>T</span>(<span>a</span>)       a a 
#<span>define</span> <span>s</span>(<span>a</span>)       T(a)T(a)
#<span>define</span> <span>A</span>(<span>a</span>)       s(a)T(a)a
#<span>define</span> <span>n</span>(<span>a</span>)       A(a)a
#<span>define</span> <span>D</span>(<span>a</span>)       n(a)A(a)
#<span>define</span> <span>C</span>(<span>a</span>)       D(a)a
#<span>define</span> <span>R</span>          <span>C</span>(C(N(<span>12</span>)G(<span>12</span>)))
#<span>define</span> <span>o</span>(<span>a,b,c</span>)   C(H(a,a))D(G(a))C(H(b,b)G(b))n(G(b))O(<span>32</span>,c)R
#<span>define</span> <span>SS</span>         <span>O</span>(<span>78</span>,<span>55</span>)R &#34;\n\033[2J\n%26$s&#34;;
#<span>define</span> <span>E</span>(<span>a,b,c,d</span>) H(a,b)G(c)O(<span>253</span>,<span>11</span>)R <span>G</span>(<span>11</span>)O(<span>255</span>,<span>11</span>)R H(<span>11</span>,d)N(d)O(<span>253</span>,<span>35</span>)R
#<span>define</span> <span>S</span>(<span>a,b</span>)     O(<span>254</span>,<span>11</span>)H(a,b)N(<span>68</span>)R <span>G</span>(<span>68</span>)O(<span>255</span>,<span>68</span>)N(<span>12</span>)H(<span>12</span>,<span>68</span>)G(<span>67</span>)N(<span>67</span>)

char* fmt = O(<span>10</span>,<span>39</span>)N(<span>40</span>)N(<span>41</span>)N(<span>42</span>)N(<span>43</span>)N(<span>66</span>)N(<span>69</span>)N(<span>24</span>)O(<span>22</span>,<span>65</span>)O(<span>5</span>,<span>70</span>)O(<span>8</span>,<span>44</span>)N(
            <span>45</span>)N(<span>46</span>)N    (<span>47</span>)N(<span>48</span>)N(    <span>49</span>)N( <span>50</span>)N(     <span>51</span>)N(<span>52</span>)N(<span>53</span>    )O( <span>28</span>,
            <span>54</span>)O(<span>5</span>,        <span>55</span>) O(<span>2</span>,    <span>56</span>)O(<span>3</span>,<span>57</span>)O(      <span>4</span>,<span>58</span> )O(<span>13</span>,    <span>73</span>)O(<span>4</span>,
            <span>71</span> )N(   <span>72</span>)O   (<span>20</span>,<span>59</span>    )N(<span>60</span>)N(<span>61</span>)N(       <span>62</span>)N (<span>63</span>)N    (<span>64</span>)R R
            E(<span>1</span>,<span>2</span>,   <span>3</span>,<span>13</span>   )E(<span>4</span>,    <span>5</span>,<span>6</span>,<span>13</span>)E(<span>7</span>,<span>8</span>,<span>9</span>        ,<span>13</span>)E(<span>1</span>,<span>4</span>    ,<span>7</span>,<span>13</span>)E
            (<span>2</span>,<span>5</span>,<span>8</span>,        <span>13</span>)E(    <span>3</span>,<span>6</span>,<span>9</span>,<span>13</span>)E(<span>1</span>,<span>5</span>,         <span>9</span>,<span>13</span>)E(<span>3</span>    ,<span>5</span>,<span>7</span>,<span>13</span>
            )E(<span>14</span>,<span>15</span>,    <span>16</span>,<span>23</span>)    E(<span>17</span>,<span>18</span>,<span>19</span>,<span>23</span>)E(          <span>20</span>, <span>21</span>,    <span>22</span>,<span>23</span>)E
            (<span>14</span>,<span>17</span>,<span>20</span>,<span>23</span>)E(<span>15</span>,    <span>18</span>,<span>21</span>,<span>23</span>)E(<span>16</span>,<span>19</span>,    <span>22</span>     ,<span>23</span>)E(    <span>14</span>, <span>18</span>,
            <span>22</span>,<span>23</span>)E(<span>16</span>,<span>18</span>,<span>20</span>,    <span>23</span>)R U O(<span>255</span> ,<span>38</span>)R    G (     <span>38</span>)O(    <span>255</span>,<span>36</span>)
            R H(<span>13</span>,<span>23</span>)O(<span>255</span>,    <span>11</span>)R H(<span>11</span>,<span>36</span>) O(<span>254</span>    ,<span>36</span>)     R G(    <span>36</span> ) O(
            <span>255</span>,<span>36</span>)R S(<span>1</span>,<span>14</span>    )S(<span>2</span>,<span>15</span>)S(<span>3</span>, <span>16</span>)S(<span>4</span>,    <span>17</span> )S     (<span>5</span>,    <span>18</span>)S(<span>6</span>,
            <span>19</span>)S(<span>7</span>,<span>20</span>)S(<span>8</span>,    <span>21</span>)S(<span>9</span>    ,<span>22</span>)H(<span>13</span>,<span>23</span>    )H(<span>36</span>,     <span>67</span>    )N(<span>11</span>)R
            G(<span>11</span>)&#34;&#34;O(<span>255</span>,    <span>25</span> )R        s(C(G(<span>11</span>)    ))n (G(          <span>11</span>) )G(
            <span>11</span>)N(<span>54</span>)R C(    <span><span>&#34;</span>aa<span>&#34;</span></span>)   s(A(   G(<span>25</span>)))T    (G(<span>25</span>))N         (<span>69</span>)R o
            (<span>14</span>,<span>1</span>,<span>26</span>)o(    <span>15</span>, <span>2</span>,   <span>27</span>)o   (<span>16</span>,<span>3</span>,<span>28</span>    )o( <span>17</span>,<span>4</span>,        <span>29</span>)o(<span>18</span>
            ,<span>5</span>,<span>30</span>)o(<span>19</span>    ,<span>6</span>,<span>31</span>)o(        <span>20</span>,<span>7</span>,<span>32</span>)o    (<span>21</span>,<span>8</span>,<span>33</span>)o       (<span>22</span> ,<span>9</span>,
            <span>34</span>)n(C(U)    )N( <span>68</span>)R H(    <span>36</span>,<span>13</span>)G(<span>23</span>)    N(<span>11</span>)R C(D(      G(<span>11</span>)))
            D(G(<span>11</span>))G(<span>68</span>)N(<span>68</span>)R G(<span>68</span>)O(<span>49</span>,<span>35</span>)R H(<span>13</span>,<span>23</span>)G(<span>67</span>)N(<span>11</span>)R C(H(<span>11</span>,<span>11</span>)G(
            <span>11</span>))A(G(<span>11</span>))C(H(<span>36</span>,<span>36</span>)G(<span>36</span>))s(G(<span>36</span>))O(<span>32</span>,<span>58</span>)R C(D(G(<span>36</span>)))A(G(<span>36</span>))SS

#<span>define</span> <span>arg</span> d+<span>6</span>,d+<span>8</span>,d+<span>10</span>,d+<span>12</span>,d+<span>14</span>,d+<span>16</span>,d+<span>18</span>,d+<span>20</span>,d+<span>22</span>,<span>0</span>,d+<span>46</span>,d+<span>52</span>,d+<span>48</span>,d+<span>24</span>,d\
            +<span>26</span>,d+<span>28</span>,d+<span>30</span>,d+<span>32</span>,d+<span>34</span>,d+<span>36</span>,d+<span>38</span>,d+<span>40</span>,d+<span>50</span>,(scanf(d+<span>126</span>,d+<span>4</span>),d+(<span>6</span>\
            -<span>2</span>)+<span>18</span>*(<span>1</span>-d[<span>2</span>]%<span>2</span>)+d[<span>4</span>]*<span>2</span>),d,d+<span>66</span>,d+<span>68</span>,d+<span>70</span>, d+<span>78</span>,d+<span>80</span>,d+<span>82</span>,d+<span>90</span>,d+\
            <span>92</span>,d+<span>94</span>,d+<span>97</span>,d+<span>54</span>,d[<span>2</span>],d+<span>2</span>,d+<span>71</span>,d+<span>77</span>,d+<span>83</span>,d+<span>89</span>,d+<span>95</span>,d+<span>72</span>,d+<span>73</span>,d+<span>74</span>\
            ,d+<span>75</span>,d+<span>76</span>,d+<span>84</span>,d+<span>85</span>,d+<span>86</span>,d+<span>87</span>,d+<span>88</span>,d+<span>100</span>,d+<span>101</span>,d+<span>96</span>,d+<span>102</span>,d+<span>99</span>,d+\
            <span>67</span>,d+<span>69</span>,d+<span>79</span>,d+<span>81</span>,d+<span>91</span>,d+<span>93</span>,d+<span>98</span>,d+<span>103</span>,d+<span>58</span>,d+<span>60</span>,d+<span>98</span>,d+<span>126</span>,d+<span>127</span>,\
            d+<span>128</span>,d+<span>129</span>

<span>char</span> d[<span>538</span>] = {<span>1</span>,<span>0</span>,<span>10</span>,<span>0</span>,<span>10</span>};

<span>int</span> <span>main</span>() {
    <span>while</span>(*d) <span>printf</span>(fmt, arg);
}</pre></div>
<p dir="auto">If this is the kind of thing that you enjoy, you might also like <a href="https://github.com/HexHive/printbf">printbf</a>.</p>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>USAGE</h2>
<div data-snippet-clipboard-copy-content="gcc -o prog prog.c
./prog"><pre><code>gcc -o prog prog.c
./prog
</code></pre></div>
<p dir="auto">Alternates between P1 and P2. Enter a digit [1-9] to move:</p>
<div data-snippet-clipboard-copy-content="1 | 2 | 3
---------
4 | 5 | 6
---------
7 | 8 | 9"><pre><code>1 | 2 | 3
---------
4 | 5 | 6
---------
7 | 8 | 9
</code></pre></div>
<p dir="auto">The game ends if:</p>
<ul dir="auto">
<li>A player completes three in a row; that player wins</li>
<li>All squares are taken; neither player wins</li>
<li>A player makes an illegal move; their opponent wins</li>
</ul>
<h2 dir="auto"><a id="user-content-why" aria-hidden="true" href="#why"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>WHY?</h2>
<p dir="auto"><a href="http://ioccc.org" rel="nofollow">IOCCC</a></p>
<h2 dir="auto"><a id="user-content-obfuscation" aria-hidden="true" href="#obfuscation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>OBFUSCATION</h2>
<p dir="auto">The entirety of the program consists of a single call to printf.</p>
<div data-snippet-clipboard-copy-content="int main() {
    while(*d) printf(fmt, arg);
}"><pre><code>int main() {
    while(*d) printf(fmt, arg);
}
</code></pre></div>
<p dir="auto">Here, <code>fmt</code> is a single string, and <code>arg</code> is a series of arguments to printf.</p>
<p dir="auto">While its primary purpose is to serve as The One True Debugger, printf also happens
to be Turing complete. (See &#34;Control-Flow Bending: On the Effectiveness of Control-Flow
Integrity&#34; where we introduced this in an actual, published, academic paper. The
things you can get away with sometimes.)</p>
<p dir="auto">We ab^H^Huse this fact to implement a the logic of tic-tac-toe entirely within
this one printf call (and a call to scanf() to read user input).</p>
<p dir="auto">Here&#39;s (briefly) how it works.</p>
<h3 dir="auto"><a id="user-content-preliminaries" aria-hidden="true" href="#preliminaries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Preliminaries</h3>
<p dir="auto">This program uses three printf format specifiers.</p>
<ul dir="auto">
<li><code>%d</code> takes an integer argument and prints it</li>
<li><code>%s</code> takes a string argument and prints it</li>
<li><code>%n</code> takes a pointer and writes (!!) the number of bytes printed so far.</li>
</ul>
<p dir="auto">Okay, everyone probably knows this. Let&#39;s get a bit more advanced.</p>
<p dir="auto">Format specifiers can take extra &#34;arguments&#34;.</p>
<ul dir="auto">
<li><code>&#34;%hhn&#34;</code>: store the number of bytes written mod 256 to the char pointer</li>
<li><code>&#34;%2$d&#34;</code>: print argument 2 to printf (and not the sequentially next argument)</li>
<li><code>&#34;%8d&#34;</code>: pad the printed integer to 8 characters</li>
<li><code>&#34;%3$.*4$d&#34;</code>: print argument 3 to printf with as many zeros as in argument 4.</li>
</ul>
<p dir="auto">For example, the following expression</p>
<div data-snippet-clipboard-copy-content="printf(&#34;%1$.*2$d%3$hhn&#34;, 5, 10, &amp;x)"><pre><code>printf(&#34;%1$.*2$d%3$hhn&#34;, 5, 10, &amp;x)
</code></pre></div>
<p dir="auto">will have the same effect as if we had written</p>

<p dir="auto">because it will print out <code>0000000005</code> (5 padded to size 10) and then write the
number of bytes written to x.</p>
<h3 dir="auto"><a id="user-content-printf-oriented-programming" aria-hidden="true" href="#printf-oriented-programming"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Printf Oriented Programming</h3>
<p dir="auto">Alright, now we can get to the real fun.</p>
<p dir="auto">We perform arbitrary computation with printf treating memory as a binary
array---one bit per pair of bytes:</p>
<ul dir="auto">
<li>The zero bit is represented by the sequence <code>00 00</code></li>
<li>The one-bit is represented by the sequence <code>xx 00</code> where <code>xx</code> is any non-zero byte.</li>
</ul>
<p dir="auto">We can use format strings to compute the OR/NOT of arbitrary &#34;bits&#34;.</p>
<p dir="auto">We&#39;ll start with the simplest, OR:</p>
<div data-snippet-clipboard-copy-content="printf(&#34;%1$s%2$s%3$hhn&#34;, a, b, c)"><pre><code>printf(&#34;%1$s%2$s%3$hhn&#34;, a, b, c)
</code></pre></div>
<p dir="auto">will compute</p>
<div data-snippet-clipboard-copy-content="*c = strlen(a) + strlen(b)"><pre><code>*c = strlen(a) + strlen(b)
</code></pre></div>
<p dir="auto">but given that strlen(x) is 1 for a 1-bit and 0 for a 0-bit, we have</p>

<p dir="auto">Computing the NOT of a single value is also easy:</p>
<div data-snippet-clipboard-copy-content="printf(&#34;%1$255d%1$s%hhn&#34;, a, b)"><pre><code>printf(&#34;%1$255d%1$s%hhn&#34;, a, b)
</code></pre></div>
<p dir="auto">will compute</p>
<div data-snippet-clipboard-copy-content="*b = (strlen(a)+255)%256 = strlen(a)-1"><pre><code>*b = (strlen(a)+255)%256 = strlen(a)-1
</code></pre></div>
<p dir="auto">and again, because <code>strlen(x)</code> is either <code>1</code> or <code>0</code> we have</p>

<p dir="auto">From here we can compute any binary circuit. Doing something efficient,
though, still takes work.</p>
<h3 dir="auto"><a id="user-content-tic-tac-toe" aria-hidden="true" href="#tic-tac-toe"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Tic-Tac-Toe</h3>
<p dir="auto">The game itself is represented as a board of 18 bits, 9 bits per player, along
with a turn counter that alternates between player 1 and player 2.</p>
<p dir="auto">To detect who has won, we implement the following logic. Let A, B, and C be
pointers to three squares in a row to test, and D be where to save if there is a
win or not.</p>
<div data-snippet-clipboard-copy-content="&#34;%A$s%B$s%C$s%1$253d%11$hhn&#34; // r11 = !(*A &amp; *B &amp; *C)
ZERO
&#34;%11$s%1$255d%11hhn&#34; // r11 = !r11
ZERO
&#34;%11$s%D$s%D$hhn&#34; // *D = *D | r11"><pre><code>&#34;%A$s%B$s%C$s%1$253d%11$hhn&#34; // r11 = !(*A &amp; *B &amp; *C)
ZERO
&#34;%11$s%1$255d%11hhn&#34; // r11 = !r11
ZERO
&#34;%11$s%D$s%D$hhn&#34; // *D = *D | r11
</code></pre></div>
<p dir="auto">That is, we set <code>*D</code> to <code>1</code> if there is a three-in-a-row. We repeat this for all
possible three-in-a-row configurations, for both players.</p>
<p dir="auto">The ZERO macro ensures that the number of bytes written out is 0 mod 256 with
the following expression</p>
<div data-snippet-clipboard-copy-content="&#34;%1$hhn%1$s&#34; (repeated 256 times)"><pre><code>&#34;%1$hhn%1$s&#34; (repeated 256 times)
</code></pre></div>
<p dir="auto">where argument 1 is a pointer to a temporary variable followed by a null byte.</p>
<p dir="auto">This works because if the current count is 0 mod 256, then &#34;%1$hhn&#34; will write
zero to argument 1 and then &#34;%1$s&#34; will never emit any text. If, on the other
hand, the count is not 0 mod 256, a length-1 string will be written to argument
1, and then &#34;%1$s&#34; will increment the count by one. By repeating this 256
times we&#39;re eventually going to reach 0 mod 256.</p>
<p dir="auto">Checking if there has been an invalid move is achieved similarly.</p>
<p dir="auto">In order to decide what to print out, we have to cast the &#34;in-memory&#34; array of
bits to Xs and Os to print out. This is actually rather straightforward. Given
in 1<math-renderer data-static-url="https://github.githubassets.com/static">$ the pointer to player 1&#39;s square, and 2$</math-renderer> the pointer to player 2&#39;s, and
in 3$ the pointer to the board string, we can compute</p>
<div data-snippet-clipboard-copy-content="&#34;%1$s&#34; (repeated 47 times) &#34;%2$s&#34; (repeated 56 times) %1$32d%3$hhn&#34;"><pre><code>&#34;%1$s&#34; (repeated 47 times) &#34;%2$s&#34; (repeated 56 times) %1$32d%3$hhn&#34;
</code></pre></div>
<p dir="auto">which will, in effect, compute</p>
<div data-snippet-clipboard-copy-content="*r3 = (*r1) * 47 + (*r2) * 56 + 32"><pre><code>*r3 = (*r1) * 47 + (*r2) * 56 + 32
</code></pre></div>
<p dir="auto">which will output &#39; &#39; if neither are true, &#39;X&#39; if r1 is, or &#39;O&#39; if r2 is.</p>
<h3 dir="auto"><a id="user-content-further-obfuscations" aria-hidden="true" href="#further-obfuscations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Further Obfuscations</h3>
<p dir="auto">In order to be able to finally display the board, while still only using one
printf statement, we finish the statement with</p>

<p dir="auto">which is the escape sequence to clear the screen, and then prints argument 26.
Argument 26 is a pointer to a char* in memory, that initially is undefined,
but within the printf statement we will construct this string to look like a
tic-tac-toe board.</p>
<p dir="auto">After the board, we need to print one of the following strings:</p>
<div data-snippet-clipboard-copy-content="P1&gt;_
P2&gt;_
P1 WINS
P2 WINS
P1 TIES
P2 TIES"><pre><code>P1&gt;_
P2&gt;_
P1 WINS
P2 WINS
P1 TIES
P2 TIES
</code></pre></div>
<p dir="auto">Depending on if it&#39;s P1 or P2&#39;s turn to move, the game is over and someone
won, or the game is over and it is a draw.</p>
<p dir="auto">This turns out not to be as hard as it might look. Using the same trick as
before, we set byte for to be</p>
<div data-snippet-clipboard-copy-content="*byte4 = is_win * &#39;W&#39; + is_tie * &#39;T&#39;"><pre><code>*byte4 = is_win * &#39;W&#39; + is_tie * &#39;T&#39;
</code></pre></div>
<p dir="auto">The byte <code>&#39;I&#39;</code> and <code>&#39;S&#39;</code> can always be the same, and we do the same for <code>&#39;E&#39;</code>/<code>&#39;N&#39;</code>.</p>
<p dir="auto">We do this same on-the-fly creation of the <code>scanf()</code> format string, but for a
different reason. We first want to run <code>printf()</code> to show the first board, and
then alternate between runs to <code>scanf()</code> and <code>printf()</code> reading and then displaying
moves. importantly, we <em>do not</em> want a final scanf when the game ends. It should
just exit.</p>
<p dir="auto">One option would be to implement the logic as</p>
<div data-snippet-clipboard-copy-content="printf()
while (*ok) {
    scanf();
    printf();
}"><pre><code>printf()
while (*ok) {
    scanf();
    printf();
}
</code></pre></div>
<p dir="auto">but this would DOUBLE the number of calls to printf we require. So instead we
implement it like this</p>
<div data-snippet-clipboard-copy-content="while (*ok) {
    scanf();
    printf();
}"><pre><code>while (*ok) {
    scanf();
    printf();
}
</code></pre></div>
<p dir="auto">(In reality we actually pass <code>scanf()</code> as an argument to avoid the extra
statement, but it has the same effect.)</p>
<p dir="auto">Notice there is now no initial <code>printf()</code>. In order make sure the program doesn&#39;t
block before the first <code>printf()</code>, but we initialize the <code>scanf()</code> format to the null
string so that it returns right away without blocking. The first time the <code>printf()</code>
call runs, it writes out <code>&#34;%hhd&#34;</code> to create the create the <code>scanf()</code> format string.</p>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>LICENSE</h2>
<p dir="auto">This program is clearly some groundbreaking achievement the likes of which have
never been seen before. Therefore, if you would like to use this program in
anything, it&#39;s licensed under the GPL v3.</p>
<p dir="auto">This program is free software: you can redistribute it and/or modify</p>
<p dir="auto">This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
General Public License for more details.</p>
<p dir="auto">You should have received a copy of the GNU General Public License
along with this program. If not, see <a href="http://www.gnu.org/licenses/" rel="nofollow">http://www.gnu.org/licenses/</a>.</p>
</article>
          </div></div>
  </body>
</html>
