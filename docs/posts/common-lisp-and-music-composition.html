<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ldbeth.sdf.org/articles/cm.html">Original</a>
    <h1>Common Lisp and Music Composition</h1>
    
    <div id="readability-page-1" class="page"><div>

<section id="R_s1_1">
<header>
<h2><span>1<span> </span></span>Introduction</h2>
</header>
<p>Once upon a time, there were many music composition software
packages, mostly written in Common LISP. To name a few I know,
Common Music, Symbolic Composer (not related to the Symbolics Lisp
Machine). Common Music is still available in source code but I
doubt if anyone is still able to setup that. Symbolic Composer just
vaporized decades ago, which some archived programs scattered over
the Internet. The package is also a 32bit Intel program so newer
macOS versions would not support it and it is license protected
anyway. Yet another is Patchwork, a more graphic oriented composing
program, and I&#39;d be surprise if it is able to survive from bit
rot.</p>
<p>The one I actually uses is Opusmodus, similar in the spirit of
Symbolic Composer. Opusmodus has release 3.0 based on LispWorks on
Dec 2022 which has Apple M1 support, and the Windows port is on the
way.</p>
</section>
<section id="R_s1_2">
<header>
<h2><span>2<span> </span></span>Modulate Modulation</h2>
</header>
<p>Before introducing all the fancy terms about algorithm
composition, let&#39;s first see a brief example that generates melody
from modulation of sin wave.</p>
<div>
<pre><span><span>  <span>|</span></span><span><code><span>(</span><span>setq</span><span> </span><span>pitch</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>      </span><span>(</span><span>filter-repeat</span><span> </span><span>1</span><span> </span><span>(</span><span>quarter-tone-closest</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>                        </span><span>(</span><span>vector-to-pitch</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>                         </span><span>&#39;</span><span>(</span><span>g3</span><span> </span><span>g5</span><span>)</span></code></span></span>
<span><span>5 <span>|</span></span><span><code><span>                         </span><span>(</span><span>add-sine-waves</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>                            </span><span>12</span><span> </span><span>120</span><span> </span><span>9</span><span> </span><span>4.2</span><span> </span><span>:phase</span><span> </span><span>7</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>                            </span><span>:modulation</span><span> </span><span>(</span><span>gen-sine</span><span> </span><span>120</span><span> </span><span>1</span><span> </span><span>0.4</span><span> </span><span>:phase</span><span> </span><span>60</span><span>))</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>                         </span><span>:quantize</span><span> </span><span>1/2</span><span>))))</span></code></span></span>
</pre></div>
<div id="R_s1_2_fig1">

<header>
<p><span>Figure<span> </span></span><span>2<span>.</span>1<span> </span></span>Visualized
waveform.</p>
</header>
</div>
<p>Then add some classic euclidean rhythm. Since this is a
randomized process, a <code>:seed</code> argument
is provided to produce consistent result.</p>
<div>
<pre><span><span>  <span>|</span></span><span><code><span>(</span><span>setq</span><span> </span><span>rythm</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>      </span><span>(</span><span>euclidean-rhythm</span><span> </span><span>(</span><span>gen-repeat</span><span> </span><span>18</span><span> </span><span>8</span><span>)</span><span> </span><span>1/2</span><span> </span><span>8</span><span> </span><span>1/16</span><span> </span><span>:seed</span><span> </span><span>9941</span><span>))</span></code></span></span>
</pre></div>
<div id="R_s1_2_fig2">


<header>
<p><span>Figure<span> </span></span><span>2<span>.</span>2<span> </span></span>The generated
piece.</p>
</header>
</div>
</section>
<section id="R_s1_3">
<header>
<h2><span>3<span> </span></span>Polyphony? No problem</h2>
</header>
<p>Sometimes it is just desirable to have some polyphonic part playing. This
time, we could add some variation by changing velocity a bit. The
basic idea is still sine wave modulation.</p>
<div>
<pre><span><span>   <span>|</span></span><span><code><span>(</span><span>setq</span><span> </span><span>rythm</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>      </span><span>(</span><span>quantize</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>       </span><span>(</span><span>add-sine-waves</span><span> </span><span>17</span><span> </span><span>120</span><span> </span><span>9</span><span> </span><span>0.3</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>                       </span><span>:phase</span><span> </span><span>44</span></code></span></span>
<span><span> 5 <span>|</span></span><span><code><span>                       </span><span>:modulation</span><span> </span><span>(</span><span>gen-sine</span><span> </span><span>120</span><span> </span><span>3</span><span> </span><span>0.4</span><span> </span><span>:phase</span><span> </span><span>60</span><span>))</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>       </span><span>&#39;</span><span>(</span><span>1</span><span> </span><span>2</span><span> </span><span>3</span><span> </span><span>4</span><span>)</span><span> </span><span>:type</span><span> </span><span>:ratio</span><span>))</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>(</span><span>setq</span><span> </span><span>pitch</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>      </span><span>(</span><span>chord-inner-remove</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>       </span><span>&#39;</span><span>(</span><span>5</span><span> </span><span>1</span><span>)</span></code></span></span>
<span><span>10 <span>|</span></span><span><code><span>       </span><span>(</span><span>harmonic-progression</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>      </span><span>(</span><span>filter-repeat</span><span> </span><span>2</span><span> </span><span>(</span><span>mapcar</span><span> </span><span>#&#39;</span><span>floor</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>              </span><span>(</span><span>add-sine-waves</span><span> </span><span>12</span><span> </span><span>120</span><span> </span><span>9</span><span> </span><span>1</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>                              </span><span>:phase</span><span> </span><span>9</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>                              </span><span>:modulation</span></code></span></span>
<span><span>15 <span>|</span></span><span><code><span>                              </span><span>(</span><span>gen-sine</span><span> </span><span>120</span><span> </span><span>1</span><span> </span><span>0.3</span><span> </span><span>:phase</span><span> </span><span>3</span><span>))))</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>      </span><span>&#39;</span><span>(</span><span>c</span><span> </span><span>major</span><span>))</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>       </span><span>:seed</span><span> </span><span>564</span><span>))</span></code></span></span>
<span><span>   <span>|</span></span><span><code> </code></span></span>
<span><span>   <span>|</span></span><span><code><span>(</span><span>setq</span><span> </span><span>score</span><span> </span><span>(</span><span>make-omn</span><span> </span><span>:pitch</span><span> </span><span>pitch</span><span> </span><span>:length</span><span> </span><span>rythm</span></code></span></span>
<span><span>20 <span>|</span></span><span><code><span>                      </span><span>:velocity</span><span> </span><span>&#39;</span><span>(</span><span>f</span><span> </span><span>mf</span><span> </span><span>p</span><span> </span><span>mp</span><span>)))</span></code></span></span>
</pre></div>
<div id="R_s1_3_fig1">


<header>
<p><span>Figure<span> </span></span><span>3<span>.</span>1<span> </span></span>Generated
polyphony chords.</p>
</header>
</div>
</section>
<section id="R_s1_4">
<header>
<h2><span>4<span> </span></span>General composition structure</h2>
</header>
<section id="R_s1_4_s2_1">
<header>
<h3><span>4<span>.</span>1<span> </span></span>Multi-track length alignment</h3>
</header>
<p>To start composing music it is important to first decide how
many sections one would like to have. Which that settled one can
use <code>get-span</code> to acquire the length
information, then use <code>length-span</code> to
fill other materials like percussion generated by <code>gen-euclidean-omn</code> into the desirable length.</p>
<div>
<div>
<p>✎︎</p>
<div>
<header>
<p>Note</p>
</header>
<p>Instead of specify a very long <code>count</code> number to <code>gen-euclidean-omn</code>, which would cause a long time
to compute, <code>length-span</code> takes much
less time to since it just repeats materials.</p>
</div>
</div>
</div>
</section>
<section id="R_s1_4_s2_2">
<header>
<h3><span>4<span>.</span>2<span> </span></span>Snap to the scale</h3>
</header>
<p>Now we have some method to generate wave forms and quantize them
to twelve tones. But just playing these pitches won&#39;t make you feel
right. The thing is, you have to decide an interesting scale and
map the generated notes to it.</p>
<p>To do that, we have <code>tonality-map</code>.</p>
<div>
<pre><span><span>   <span>|</span></span><span><code><span>(</span><span>setq</span><span> </span><span>pitch</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>      </span><span>(</span><span>quarter-tone-closest</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>       </span><span>(</span><span>vector-to-pitch</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>        </span><span>&#39;</span><span>(</span><span>g3</span><span> </span><span>g5</span><span>)</span></code></span></span>
<span><span> 5 <span>|</span></span><span><code><span>        </span><span>(</span><span>add-sine-waves</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>         </span><span>12</span><span> </span><span>120</span><span> </span><span>9</span><span> </span><span>4.2</span><span> </span><span>:phase</span><span> </span><span>7</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>         </span><span>:modulation</span><span> </span><span>(</span><span>gen-sine</span><span> </span><span>120</span><span> </span><span>1</span><span> </span><span>0.4</span><span> </span><span>:phase</span><span> </span><span>60</span><span>))</span></code></span></span>
<span><span>   <span>|</span></span><span><code><span>        </span><span>:quantize</span><span> </span><span>1/2</span><span>))))</span></code></span></span>
<span><span>   <span>|</span></span><span><code> </code></span></span>
<span><span>10 <span>|</span></span><span><code><span>(</span><span>filter-repeat</span><span> </span><span>3</span><span> </span><span>(</span><span>tonality-map</span><span> </span><span>&#39;</span><span>(</span><span>c4e4a4f4e5</span><span>)</span><span> </span><span>pitch</span><span>))</span></code></span></span>
</pre></div>
<div id="R_s1_4_s2_2_fig1">


<header>
<p><span>Figure<span> </span></span><span>4<span>.</span>2<span>.</span>1<span> </span></span>Generated score</p>
</header>
</div>
</section>
</section>
<section id="R_s1_5">
<header>
<h2><span>5<span> </span></span>Quick music theory</h2>
</header>
<section id="R_s1_5_s2_1">
<header>
<h3><span>5<span>.</span>1<span> </span></span>Major keys</h3>
</header>
<p>Major keys are of the <code>&#39;(0 2 4 5 7 9 11
12)</code> interval. The key
signatures are hard to remember, but one trick is for sharp keys
the name is one half step higher than last sharp; for flat keys the
name is the second to last flat. The reason why it works is
demonstrated below. The name is just from the first note in each
scale.</p>
<div id="R_s1_5_s2_1_fig1">


<header>
<p><span>Figure<span> </span></span><span>5<span>.</span>1<span>.</span>1<span> </span></span>A list of major keys</p>
</header>
</div>
<p>This is produced by OMN generated by this lisp loop:</p>
<div>
<pre><span><span>  <span>|</span></span><span><code><span>(</span><span>loop</span><span> </span><span>for</span><span> </span><span>i</span><span> </span><span>from</span><span> </span><span>0</span><span> </span><span>to</span><span> </span><span>11</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>  </span><span>collect</span><span> </span><span>(</span><span>append</span><span> </span><span>&#39;</span><span>(</span><span>q</span><span>)</span></code></span></span>
<span><span>  <span>|</span></span><span><code><span>                  </span><span>(</span><span>integer-to-pitch</span><span> </span><span>(</span><span>x+b</span><span> </span><span>&#39;</span><span>(</span><span>0</span><span> </span><span>2</span><span> </span><span>4</span><span> </span><span>5</span><span> </span><span>7</span><span> </span><span>9</span><span> </span><span>11</span><span> </span><span>12</span><span>)</span><span> </span><span>i</span><span>))))</span></code></span></span>
</pre></div>
</section>
</section>
</div></div>
  </body>
</html>
