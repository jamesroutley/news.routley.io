<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.pathsensitive.com/2023/12/should-you-split-that-file.html">Original</a>
    <h1>Should you split that file?</h1>
    
    <div id="readability-page-1" class="page"><div>



<p><span>
</span>
<span></span>
<time itemprop="datePublished">December 01, 2023</time>
</p>
<p>You’re a line programmer for EvilCorp, and it’s just an average day working on some code to collapse the economy.
</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjXa7Ojd48gOzOpJQvf_p15kEzCY2xQsnxjPg4HQjMh7X6MOjlbqK7Jlgdts-_gwY1xJeZPzP-9HWLcTTIWkTk4WADlioeq5x24b8Zm1mUxXv8yqLJYqMJnMMuJJ9RHHub8ZZ6KNfPR03NT2LbXQch-OAuh0YUxZ7T6edCWp4vKHpHwf__qe_P7R8caaAK1/s1600/image18.png"><img alt="" data-original-height="764" data-original-width="1476" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjXa7Ojd48gOzOpJQvf_p15kEzCY2xQsnxjPg4HQjMh7X6MOjlbqK7Jlgdts-_gwY1xJeZPzP-9HWLcTTIWkTk4WADlioeq5x24b8Zm1mUxXv8yqLJYqMJnMMuJJ9RHHub8ZZ6KNfPR03NT2LbXQch-OAuh0YUxZ7T6edCWp4vKHpHwf__qe_P7R8caaAK1/s1600/image18.png"/></a></p>

<p>Then you realize you need some code for disrupting supply chains.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjWVacH65c0Thp5oldvLQti_IK42V68luMD91R4OomETGFkV2lV5m3zzWxCjWchPXvuNPR1KVu8EiRvBmVUNISog-kAjVs913RKhAS0zkWigC5uZ1KczgkcG1KxuA_sXVBzcHVuEOEkr-YKAq5LXjECqQ54D4nLH_L5dY_MdQSvi2JbPRZJZCD9aitBwSGZ/s1600/image25.png"><img alt="" data-original-height="544" data-original-width="1298" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjWVacH65c0Thp5oldvLQti_IK42V68luMD91R4OomETGFkV2lV5m3zzWxCjWchPXvuNPR1KVu8EiRvBmVUNISog-kAjVs913RKhAS0zkWigC5uZ1KczgkcG1KxuA_sXVBzcHVuEOEkr-YKAq5LXjECqQ54D4nLH_L5dY_MdQSvi2JbPRZJZCD9aitBwSGZ/s1600/image25.png"/></a></p>

<p>Should you split it into a new file?</p>

<p>Let’s say you do.</p>

<p>Pretty soon your directory looks like this:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhuoilHbSVAfD9OnAnUitArES3xlSrLtSMysH7ew4K46Xb8NyQbyuif8_cpLf7VpnC_ciKRnkYauvjAabQYMYX1yRcTTjwsPySol-IgQeWFbgiZN1WRMWj_YByxPHBMdHkMuqCNFyGOERTgm9I8kBa4zvGDIJMS7NmmCOMJWlVBOOBs6Sl7iSzV45sL9pZ5/s1600/image13.png"><img alt="" data-original-height="1080" data-original-width="770" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhuoilHbSVAfD9OnAnUitArES3xlSrLtSMysH7ew4K46Xb8NyQbyuif8_cpLf7VpnC_ciKRnkYauvjAabQYMYX1yRcTTjwsPySol-IgQeWFbgiZN1WRMWj_YByxPHBMdHkMuqCNFyGOERTgm9I8kBa4zvGDIJMS7NmmCOMJWlVBOOBs6Sl7iSzV45sL9pZ5/s1600/image13.png"/></a></p>

<p>It’s so well organized! You want to know what it tracks about the robot armies, it’s right there.</p>

<p>Except that all your files look like this:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgimsLUKWy9aVZxDGBhAlftXSA18uxaLvzlTxo2eE_XWSLdtxfgB3autK8vvzzb_Wq3lQVVBSg_1oh7l2fkEzEPaCsrxRZpDs33DMxJgt0fU0ZaOoQ4GoqtxoYRdwEfROnx_i9-Cw15Cn64HiHnfHv_svYkE-X5uBZSVoc_qOXLvyYES1sDfRSu_omDtQoe/s1600/image20.png"><img alt="" data-original-height="724" data-original-width="1128" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgimsLUKWy9aVZxDGBhAlftXSA18uxaLvzlTxo2eE_XWSLdtxfgB3autK8vvzzb_Wq3lQVVBSg_1oh7l2fkEzEPaCsrxRZpDs33DMxJgt0fU0ZaOoQ4GoqtxoYRdwEfROnx_i9-Cw15Cn64HiHnfHv_svYkE-X5uBZSVoc_qOXLvyYES1sDfRSu_omDtQoe/s1600/image20.png"/></a></p>

<p>And the control flow through the files looks like this:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgRjxEuFGF9LxHNu3DW446kOceC0BGsujcPGC3J_hR3KIZ3Sy1DyIgijJ-0k0STiUJdjY_Ah4XKS3o6o4oCQsZvXM3iMlFgiEra_MqACv1JP9w87_eJp4GcMdUSAeejM3oY31CiKWLp3ozm6jZJACgwb0cnBuy0zrRBT6IKELYzOQk91tArgeASPwV4XHTF/s1600/image14.png"><img alt="" data-original-height="605" data-original-width="1091" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgRjxEuFGF9LxHNu3DW446kOceC0BGsujcPGC3J_hR3KIZ3Sy1DyIgijJ-0k0STiUJdjY_Ah4XKS3o6o4oCQsZvXM3iMlFgiEra_MqACv1JP9w87_eJp4GcMdUSAeejM3oY31CiKWLp3ozm6jZJACgwb0cnBuy0zrRBT6IKELYzOQk91tArgeASPwV4XHTF/s1600/image14.png"/></a></p>

<p>Now you’re starting to regret having broken it up so aggressively.</p>

<p>Now back up a bit.</p>

<p>Let’s say you keep it in one file, at least for now.</p>

<p>Then you need to add some code for supply chain and robot info.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjRM2kkYz5nFhQEMwh2QmrM3z57rYFiwlvBpjUNj_nGWJgDbzf5DOX4zmZRCzuB9H3Ysx2JnvKqKTiDkeIfF9TUci7wt-Z1DbWaNq3sarHfJB8xD2Udu7T3dqMhYkjkQW1Ni_op9ZvF8XVQcwbZcCIRVGoFpB0vlWa6kkvYZThuRhbwRktr23BKN-npHTBZ/s1600/image5.png"><img alt="" data-original-height="806" data-original-width="1046" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjRM2kkYz5nFhQEMwh2QmrM3z57rYFiwlvBpjUNj_nGWJgDbzf5DOX4zmZRCzuB9H3Ysx2JnvKqKTiDkeIfF9TUci7wt-Z1DbWaNq3sarHfJB8xD2Udu7T3dqMhYkjkQW1Ni_op9ZvF8XVQcwbZcCIRVGoFpB0vlWa6kkvYZThuRhbwRktr23BKN-npHTBZ/s1600/image5.png"/></a></p>

<p>This repeats a few times. If you’re lucky, the file looks like this, where lines of the same color represent related code:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEipjAVSCRX4SfwaoqJwQQPjdptrdq5pssjhBa_J3eESI8bKHK2FgriAriZ02cv5rlEMDnOO60DLMvyA_iEcThyLoqxOXl6pT9aF3HGtgEvizmBLd6WNGTiP2DUQ2mR8Kh9AB7i0Io0WwLmflkqsi6M8m5nrY8TZJKKnPXf3HMUVAY0D84hSD9rqR9WhOnF2/s1600/code1.png"><img alt="" data-original-height="652" data-original-width="356" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEipjAVSCRX4SfwaoqJwQQPjdptrdq5pssjhBa_J3eESI8bKHK2FgriAriZ02cv5rlEMDnOO60DLMvyA_iEcThyLoqxOXl6pT9aF3HGtgEvizmBLd6WNGTiP2DUQ2mR8Kh9AB7i0Io0WwLmflkqsi6M8m5nrY8TZJKKnPXf3HMUVAY0D84hSD9rqR9WhOnF2/s1600/code1.png"/></a></p>

<p>There, we can see related code is mostly together, but there’s some degradation, and a few things don’t fit neatly into any category. Needs some weeding, but overall a decently-kept garden.</p>

<p>If you’re less lucky, it looks more like this:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjrl6qfs8Lk8AGM5hn2RRsZ0C0kvG6HqLpJNZLl2t5bq9R7ZZNjvkljSKNYisgPZebrQ96BofJuk_Keh8loDo-rLBGUeIwZDCKOyLejD-CbeJg_lgRZF0MM-4hE-7MaSouyjqN4KH-seDJoG8HlS84VTuJ7FW490a3-XywfxfFwUVuuz8L5OyS9emzIxSmH/s1600/Screenshot%202023-12-01%20at%206.07.38%E2%80%AFPM.png"><img alt="" data-original-height="1034" data-original-width="496" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjrl6qfs8Lk8AGM5hn2RRsZ0C0kvG6HqLpJNZLl2t5bq9R7ZZNjvkljSKNYisgPZebrQ96BofJuk_Keh8loDo-rLBGUeIwZDCKOyLejD-CbeJg_lgRZF0MM-4hE-7MaSouyjqN4KH-seDJoG8HlS84VTuJ7FW490a3-XywfxfFwUVuuz8L5OyS9emzIxSmH/s1600/Screenshot%202023-12-01%20at%206.07.38%E2%80%AFPM.png"/></a></p>

<p>This is a file where there clearly used to be some structure, but now it’s overgrown with chaos.</p>

<p>Of course, if you don’t have the whole file committed in memory, it looks more like this:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvNuc4xksGNcahw3-W-aj3h0Jm3cwNstFeqjAKlSaSmNOGRyurfeNKYNNUjnxkjOWXS5MwtTh-XFvU4vu3ITexNFvOF-TxY2rDLA8YHD8PBz1E2O4SGSJTqYWxeDF1Q2_E0aFGNHur2FZXF854Zxcu1vNmBoQGPsX3nS__iyxMvvxzffpcv6Vvl7fSuILJ/s1600/image23.png"><img alt="" data-original-height="762" data-original-width="926" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgvNuc4xksGNcahw3-W-aj3h0Jm3cwNstFeqjAKlSaSmNOGRyurfeNKYNNUjnxkjOWXS5MwtTh-XFvU4vu3ITexNFvOF-TxY2rDLA8YHD8PBz1E2O4SGSJTqYWxeDF1Q2_E0aFGNHur2FZXF854Zxcu1vNmBoQGPsX3nS__iyxMvvxzffpcv6Vvl7fSuILJ/s1600/image23.png"/></a></p>

<p>Man, just figuring how it directs the army is a headache. That really should be broken out into its own file. But don’t you wish you had done so earlier?</p>

<p>In nearly all ecosystems, programs consist of files consisting of text. When you break code into more files for more categories, it becomes easier to find and understand code for each category, but harder to read anything involving multiple categories. When you keep code together into fewer files, it becomes easier to track the control flow for individual operations, but harder to form a mental map of the code.</p>

<p>What if I told you that you can eat the cake and have it too?</p>

<p>Here’s how.</p>

<h2>The magic third way</h2>

<p>Let’s look at your colleague Tom in the service division of the robotics department. He works on the repair manual that keeps the whole company’s army running smoothly. One day he’s working on the section for how to maintain the mirrors in the laser cannons.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiN-zY_G1T3tL6zs_X6ZQ3afm_lT-VdVyr_E7wZodYLEuq5g1KU4PxlZ4w3dfoE2mR3oW6H8L7poFipFJq5YAsVGYorwB4eRGTMu7ghZNhmZKUS_QCNV8Cwsij1E6E6n9BFF11djVHyvEpHLWcGcvJrXeoUJ6ll57MN_t8ei8-pG5gXg9ROBWm9Xj4JSnXS/s1600/image21.png"><img alt="" data-original-height="472" data-original-width="1496" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiN-zY_G1T3tL6zs_X6ZQ3afm_lT-VdVyr_E7wZodYLEuq5g1KU4PxlZ4w3dfoE2mR3oW6H8L7poFipFJq5YAsVGYorwB4eRGTMu7ghZNhmZKUS_QCNV8Cwsij1E6E6n9BFF11djVHyvEpHLWcGcvJrXeoUJ6ll57MN_t8ei8-pG5gXg9ROBWm9Xj4JSnXS/s1600/image21.png"/></a></p>

<p>He realizes that he actually wants to add quite a few things about polishing the mirror. You see, the mirrors can only be polished with a custom nanoparticle solution, and so part of maintaining the mirror is really about maintaining the polish. Where to put this information?</p>

<p>Unlike in code, it’s a pretty big deal to “split stuff out into a new file,” since they like to keep everything in one volume for the technicians. Putting it in a new chapter would mean an awful lot of page flipping. And it’s quite messy to just mix in a lot of sections about maintaining the polish into the larger chapter on the laser cannon.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhB55cZu6Nsgi6DOnbTQ5tqc61nW95GtSVUlHx4unaXUeU2HFscfMaoJ4MQzXxbi7sEpFWmNyJX8OTh1K9g7H2at6Lj_5mYSW9854G9-8ZhBVhiw97BUySm4P749rnch0GvzxlqZz9aJcOnh9NYK9kd3PgIIrLAIvyHh3lPqzyivbtZDjziY1sPqKT4PiRp/s1600/image22.png"><img alt="" data-original-height="588" data-original-width="1498" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhB55cZu6Nsgi6DOnbTQ5tqc61nW95GtSVUlHx4unaXUeU2HFscfMaoJ4MQzXxbi7sEpFWmNyJX8OTh1K9g7H2at6Lj_5mYSW9854G9-8ZhBVhiw97BUySm4P749rnch0GvzxlqZz9aJcOnh9NYK9kd3PgIIrLAIvyHh3lPqzyivbtZDjziY1sPqKT4PiRp/s1600/image22.png"/></a></p>

<p>But he has no problem adding them with more organization:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi5exd9eRciVZFdxfh14IXNOp5j1QS0j68ZSxVHQVw5GOY6Zo2fP30GOPQSuR3jaTAmM9aR7XQ02nKvAc7Mv3jxtPRkYkcGMbPqCUQFmbv4ObVmNpYElIQ7wSZNRAItGiyNMKpaaclwP_rkdA4AN3vLLB9CDAGjlsHuGcj_WnbcwsHTC2khaW4XynKbxT6c/s1600/image17.png"><img alt="" data-original-height="932" data-original-width="1526" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi5exd9eRciVZFdxfh14IXNOp5j1QS0j68ZSxVHQVw5GOY6Zo2fP30GOPQSuR3jaTAmM9aR7XQ02nKvAc7Mv3jxtPRkYkcGMbPqCUQFmbv4ObVmNpYElIQ7wSZNRAItGiyNMKpaaclwP_rkdA4AN3vLLB9CDAGjlsHuGcj_WnbcwsHTC2khaW4XynKbxT6c/s1600/image17.png"/></a></p>

<p>That’s the normal way to organize books, with chapters and subchapters (and sub-subchapters).  Or, in HTML: h1, h2, etc.</p>

<p>We have them in code too.</p>

<p>They look like this:</p>

<div><pre><span>/*******************************************************</span>
<span> **************** h1 in C/C++/Java/JS ******************</span>
<span> *******************************************************/</span>

<span>/**************</span>
<span> ********* This is an h2</span>
<span> **************/</span>


<span>/********</span>
<span> **** An h3</span>
<span> ********/</span>
</pre></div>

<p>Or this:</p>

<div><pre><span>################ Python/Ruby/Bash H1 ################</span>

<span>############## An H2</span>

<span>##### An H3</span>
</pre></div>

<p>Or this:</p>

<div><pre><span>--------------------------------------------------------</span>
<span>--                   Haskell/Lua h1                   --</span>
<span>--------------------------------------------------------</span>


<span>-----------                An h2             -----------</span>


<span>------ An h3</span>
</pre></div>


<p>Or any of countless other variations. They all get the job done. I tend to like the ones that more visibly break up the text, so: like the first bunch, except translated into whatever language I’m using.</p>

<p>I teach people a lot of things about software design. Some of them are things I dusted off from papers written in the 70’s. Many more I can claim to have invented myself.</p>

<p>This one, not in the slightest. In fact, <a href="https://github.com/Semantic-Org/Semantic-UI/blob/master/src/definitions/elements/button.less#L217" target="_blank">here’s</a> some CSS guys doing it, in the frontend framework “Semantic UI”:</p>

<!-- HTML generated using hilite.me -->
<div>
  <table>
    <tbody><tr>
      <td>
        <pre>217
218
219
220
221
222
223
224
225
226
227
228
229
230
231</pre>
      </td>
      <td>
        <pre><span>/*******************************</span>
<span>             Types</span>
<span>*******************************/</span>

<span>/*-------------------</span>
<span>       Animated</span>
<span>--------------------*/</span>

<span>.ui.animated.button</span> {
  <span>position</span><span>:</span> <span>relative</span>;
  <span>overflow</span><span>:</span> <span>hidden</span>;
  <span>padding-right</span><span>:</span> <span>0em</span> <span>!important</span>;
  <span>vertical-align</span><span>:</span> <span>@</span>animatedVerticalAlign;
  <span>z-index</span><span>:</span> <span>@</span>animatedZIndex;
}
</pre>
      </td>
    </tr>
  </tbody></table>
</div>

<p>And here’s some smart-contract developers:</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOpI1sx7P8mLUNUut27mXdSIP2lOmeCt9GzpflNFBBsb46-Mr8vyXs8z8hK2TmjYyEe9_LBimvoh2Qg40gOnC01mCDuUMcBc7ZFHMFkVT5u64z2AXY368zvibyibxVKRmRNnNbPOar9UF0Ch_RukAVxiciXIrGKRPLXEoEzJNQKJGF-lc7mhgU1bFkBwLh/s1600/image7.png"><img alt="" data-original-height="780" data-original-width="1420" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOpI1sx7P8mLUNUut27mXdSIP2lOmeCt9GzpflNFBBsb46-Mr8vyXs8z8hK2TmjYyEe9_LBimvoh2Qg40gOnC01mCDuUMcBc7ZFHMFkVT5u64z2AXY368zvibyibxVKRmRNnNbPOar9UF0Ch_RukAVxiciXIrGKRPLXEoEzJNQKJGF-lc7mhgU1bFkBwLh/s1600/image7.png"/></a></p>

<p>But I can say that I’ve never seen anyone else write about it explicitly, nor take them as far as I do.</p>

<p>“Jimmy,” one listener commented. “At my workplace, I’ve seen a lot of code with these sections, but stuff keeps getting added in the middle, and then the sections become meaningless.”</p>

<p>“Is it too hard to just add a subsection for exactly the stuff added?”</p>

<p>“Actually” he replied, “I don’t think I’ve ever seen subsections.”</p>

<p>But my code these days has it everywhere. On occasion to three or more levels of organization.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdLRb7Rj7ahg6iCrHr83Scj49Bz49V8ckFOYNNn7d0MjakRu1uWW3kpJeU0uPFzGXY9JmjFJXjvwkzBVaAX5IPiASlobr9irKZ9kQAg-z3N7WCTPLD6JzsLlA3V-6edxDVSei9HSqIpU2dnGEEZ1cnT17rWAqyMkiYD4LBWqh4wnAMtNgb3xqhQvx6OzWq/s1600/image19.png"><img alt="" data-original-height="890" data-original-width="1586" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdLRb7Rj7ahg6iCrHr83Scj49Bz49V8ckFOYNNn7d0MjakRu1uWW3kpJeU0uPFzGXY9JmjFJXjvwkzBVaAX5IPiASlobr9irKZ9kQAg-z3N7WCTPLD6JzsLlA3V-6edxDVSei9HSqIpU2dnGEEZ1cnT17rWAqyMkiYD4LBWqh4wnAMtNgb3xqhQvx6OzWq/s1600/image19.png"/></a></p>

<p>(What in the world is this code doing, just renaming strings? Another deep idea and another discussion. Short version: Trying to get the benefits of having a fancy datatype for identifiers without actually doing any work.)</p>

<p>Aggressively splitting files into sections and (sub-)subsections is the biggest way my code has changed in the last 5 years. It requires little skill, and, once you build the habit, little effort. But I’ve found it makes a huge difference in how pleasant it is to live in a codebase.</p>

<h2>Cognitive load and design reconstruction</h2>

<p>Hopefully I don’t have to argue too hard that code organized into sections and subsections is nicer to read, if not to write. Here are two versions of a code snippet (<a href="https://github.com/Semantic-Org/Semantic-UI/blob/49b9cbf47c172c65dc265d213c609ad5e651a6a9/src/definitions/elements/button.less" target="_blank">source</a>) from Semantic UI: the original, and one with the section dividers removed. Personally, even at a glance, I find the version with them present more inviting.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjGNnDG1W_od-V3j1IxIt6-Gxy29ElmNt8KD8nfMhsDJU8Z9H11IIl4Lk-OWRgK7xfq41b7gJQJZFn7f6Z3nEAnP95IQLRdticWDaj3MK_Mvps5oKJZ0I-G9nfvuBYYtRo4X04GfNp7JeuyWPLLpIV0RqXq1jmHUYVxF_buqIX3Y0L4d-wWfxHoW15lvTyE/s1600/Untitled%20design%20%2810%29.png"><img alt="" data-original-height="800" data-original-width="652" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjGNnDG1W_od-V3j1IxIt6-Gxy29ElmNt8KD8nfMhsDJU8Z9H11IIl4Lk-OWRgK7xfq41b7gJQJZFn7f6Z3nEAnP95IQLRdticWDaj3MK_Mvps5oKJZ0I-G9nfvuBYYtRo4X04GfNp7JeuyWPLLpIV0RqXq1jmHUYVxF_buqIX3Y0L4d-wWfxHoW15lvTyE/s1600/Untitled%20design%20%2810%29.png"/></a></p>

<p>There are actually some pretty deep reasons why sub-file organization works.</p>

<p>We saw that splitting a file comes with advantages and disadvantages. As does not splitting.</p>

<p>But, actually, for not splitting, all the disadvantages were in reading it.</p>

<p>When you start a new feature, you have some high-level intentions. By some process, you turn the high-level intentions into low-level intentions into code.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhtrFf6A-D30JQSt_vJHEV4KqKIFfTwiqllHNtTg_69f7TXmb6zR0hcBtrjjEe59liOctfhAJ6E5R3vCpUTasKDaYTLpKQj07tCUch0KooGhIvcqZcR-0uCA56kiVZhVMkqlWUfzu4mHbu8Wr2oAT-zEgfU_AvJ1pPhh0ohcJ3eQzY6bt1REjSpUCmFipG8/s1600/image16.png"><img alt="" data-original-height="582" data-original-width="1588" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhtrFf6A-D30JQSt_vJHEV4KqKIFfTwiqllHNtTg_69f7TXmb6zR0hcBtrjjEe59liOctfhAJ6E5R3vCpUTasKDaYTLpKQj07tCUch0KooGhIvcqZcR-0uCA56kiVZhVMkqlWUfzu4mHbu8Wr2oAT-zEgfU_AvJ1pPhh0ohcJ3eQzY6bt1REjSpUCmFipG8/s1600/image16.png"/></a></p>

<p>But when someone first looks at a file, it’s just a blob.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFXlaYpHIX04o5QzUKmZz6db7-Z0lQ6WHbLZcqfe5j8KLlgTHfuQ50r-mC_mcPTm4zkkEmAPexZ2EA5GqVXIpoFjZJ89hgd6pAq7JaSi_6qqdmAL6Vcl_Y004KW4dDetB6U1mGEPhbA5irZyH94pTAIC2ytFnUbyBCSqSRPscQW0hpu3WWEfn2_7Mm47pP/s1600/image3.png"><img alt="" data-original-height="920" data-original-width="668" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhFXlaYpHIX04o5QzUKmZz6db7-Z0lQ6WHbLZcqfe5j8KLlgTHfuQ50r-mC_mcPTm4zkkEmAPexZ2EA5GqVXIpoFjZJ89hgd6pAq7JaSi_6qqdmAL6Vcl_Y004KW4dDetB6U1mGEPhbA5irZyH94pTAIC2ytFnUbyBCSqSRPscQW0hpu3WWEfn2_7Mm47pP/s1600/image3.png"/></a></p>

<p>Then they start to read and build an understanding of each piece.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEju6LN4HemKmp3vC8uazjtSpayEAwPNg3hrIxl0jJh8pMps0G0aeBXfhQo4AFVduPRr7sIyNhtkxTlFVScVnd3Ydw4bmhtV6rU1mEuPYFoffp4zCWCUgxQXAhveekviT-2GogJIhilevtWAdUxZYSjOnWroYeKyCTEBSkZ98nhCCgj2dxseivA7B0shHsIN/s1600/image24.png"><img alt="" data-original-height="792" data-original-width="564" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEju6LN4HemKmp3vC8uazjtSpayEAwPNg3hrIxl0jJh8pMps0G0aeBXfhQo4AFVduPRr7sIyNhtkxTlFVScVnd3Ydw4bmhtV6rU1mEuPYFoffp4zCWCUgxQXAhveekviT-2GogJIhilevtWAdUxZYSjOnWroYeKyCTEBSkZ98nhCCgj2dxseivA7B0shHsIN/s1600/image24.png"/></a></p>

<p>As they understand more pieces, they can begin to understand how they fit together into a bigger picture.</p>

<p>But all this is wasted work! The reader is just trying to reconstruct knowledge that was already known to the writer!</p>

<p>That’s a very general problem. Anything done to counter it falls under the umbrella of what I call the <a href="https://www.pathsensitive.com/2018/02/making-bugs-impossible-illustrating.html" target="_blank">Embedded Design Principle</a>. Splitting a file into sections is just one particularly effective instance of this broader idea. As poetically explained in <a href="https://www.pathsensitive.com/2023/07/the-11-aspects-of-good-code.html" target="_blank">The 11 Aspects of Good Code</a>:</p>

<blockquote>
  <b>Good code makes it easy to recover the intent of the programmer</b></blockquote>

<p>Back to the robot armies. The reader has started to piece together a bigger picture.</p>

<p><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhxzB6Cu48luFHzxitR4g3myUU1WD27UkkZIMfY02XGlLLcebWxhKN2XkZTXhpg_t4p52Z1DK6lzPNc3RG27CpogPh340AT5zEtDOZXmYewn2TnpFTE1ca98MGlhMiRy5iSlfLAhSBGK1l36Ar70RrFhvOe0ChA3A-qJlY4iSe18CGZVV5PN__D616hR4oT/s1600/image6.png"><img alt="" data-original-height="572" data-original-width="784" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhxzB6Cu48luFHzxitR4g3myUU1WD27UkkZIMfY02XGlLLcebWxhKN2XkZTXhpg_t4p52Z1DK6lzPNc3RG27CpogPh340AT5zEtDOZXmYewn2TnpFTE1ca98MGlhMiRy5iSlfLAhSBGK1l36Ar70RrFhvOe0ChA3A-qJlY4iSe18CGZVV5PN__D616hR4oT/s1600/image6.png"/></a></p>

<p>In this example, the code was written in three sections and then not edited. That brings an offer: understand the first three functions, and you understand the big ideas of the mechanics behind sending forth a robot army. Understand the next three, and you understand the bigger picture. But the reader in the picture hasn’t found that structure yet.</p>

<p>Piecing this code together is like a jigsaw puzzle. And in a jigsaw puzzle, if I were to give you a box with only pieces from the left half, and a box with only the pieces from the right half, it would be more than twice as easy.<sup id="top1"><a href="#1">1</a></sup> That’s a lot like what you’re doing for the reader by labeling code sections.<sup><a href="#2" name="top2">2</a>
</sup></p>

<p>There’s one more benefit too. I and many others I showed this to report a sense of relaxation and calm from skimming through a well-sectioned file, a lot like coming home to a clean room. I think what’s going on here is cognitive ease: there’s a psychological phenomenon in which easy things literally cause happiness. There’s an entire chapter on it in Kahnemann’s Thinking Fast and Slow.</p>

<p>Oh, and then there’s also how naming is one of the two hard problems of computer science (the others being cache invalidation and off-by-one errors). If you put two functions that coordinate robotics surrounding and invading a factory into a file, then you’re going to want to think of some general name that captures both these and everything similar that should go in the same file. That sounds kinda tough; my best is “offensive_tactics.ts.” But you just cordon these off into a little section of a larger file containing the whole supply-chain disruption logic, then naming that section is a much lower bar. After you find yourself writing additional related functions, then you can break it off into a new file as easily as you can change a subchapter in a book into a full chapter.</p>

<p>

So there&#39;s a lot of costs and benefits to breaking up a file vs. keeping it together, and we&#39;ve seen that having sections and subsections does a lot to lower the cost of keeping it together. But actually, it&#39;s pretty rare that I&#39;ve seen people go too aggressive in breaking up files. More often I see people who think breaking up a file would make it more organized, but there&#39;s just too much inertia. And the bigger a file grows, the harder it becomes to break out meaningful components. </p>

<p>
  That&#39;s why having a handful of giant files used to be the hallmark of a bad codebase, one completely disorganized. But this is the real greatness of sections: it&#39;s a way to get much of the benefits of splitting up files, but it feels more like jotting down a thought you had than actually doing work. And if you keep things organized in sections, then it&#39;s not any harder to break apart a file later than it is now.
</p>

<p>So now we know that, just by recording a little bit more of your thinking when writing code, it’s possible to have files which are both large and well-organized. And doing so lets you read code faster, follow control-flow better, delay having to find good names, and literally injects happiness into your life.  Let’s make our files large again!</p>

<p>Of course, this is still not the easiest thing you can do to lower the cost of large files.</p>

<p>That would be buying a bigger monitor.</p>

<p><span><i>Thank you to Jonathan Camenisch, James He, and Supachai “Champ” Suwanthip for discussion on the ideas behind this blog post. Thank you to Benoît Fleury, Torbjörn Gannholm, Oliver Chambers, and William Berglund for comments on earlier drafts.</i></span></p><p><i>


<p>
  <span>
    <a href="#top1" name="1"><sup>1</sup></a> 
    I had to check this one and, <a href="https://journeyofsomething.com/blogs/news/how-long-does-it-take-to-finish-jigsaw-puzzles-of-different-sizes" target="_blank">it turns out</a>, average solving time for jigsaws is remarkably linear in the number of pieces. But, if you like jigsaws and know some computer science, we can reason about the complexity of each step of solving: first find the corners and edges (linear), then group pieces by region (linear-ish), then solve the parts of the puzzle where each piece looks distinct (linear to quadratic), then solve the parts of the puzzle where the pieces all look similar (near quadratic). Through this lens, a large jigsaw is actually composed of many subregions, each of which could take near-quadratic solving time. In the worst case, the jigsaw is just a solid color, and you’re stuck comparing each edge pairwise, which is clearly quadratic unless you’re really good at indexing on the shapes of the holes and protrusions. This invites the more accurate statement: for each of the quadratic-time subregions of a jigsaw puzzle, if I were to split the pieces into a left and right half, the solving speed for that subregion would roughly improve by 4x. This is both more accurate and a better metaphor for the effect of adding subdivisions to a source file.
</span>
</p>

<p>
  <span>
    <a href="#top2" name="2"><sup>2</sup></a> The ideal would be to do the code equivalent of handing someone a painting instead of cutting it up into jigsaw pieces in the first place. The programming equivalent would be to actually make your designs into the program. Choices for approaching that include writing with declarative libraries, using symbolic program synthesis techniques, or using ChatGPT and letting natural language be the code.
  </span>
</p>


</i></p></div></div>
  </body>
</html>
