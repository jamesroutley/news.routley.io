<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/noperator/jqfmt">Original</a>
    <h1>Jqfmt like gofmt, but for jq</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto">
  <themed-picture data-catalyst-inline="true"><picture>
    <source media="(prefers-color-scheme: dark)" srcset="https://camo.githubusercontent.com/6f161d9edb569b0467b4501670437fb382dc7f99e27042cf86593f88a7b9cd42/68747470733a2f2f692e696d6775722e636f6d2f51456d594477342e706e67" data-canonical-src="https://i.imgur.com/QEmYDw4.png"/>
    <img alt="jqfmt logo" src="https://camo.githubusercontent.com/d2b59e6ec0d896c51ef278ebb3ff6f4202384cee78756ffe0e681d45c13cb8e5/68747470733a2f2f692e696d6775722e636f6d2f6f51546e564e622e706e67" width="300px" data-canonical-src="https://i.imgur.com/oQTnVNb.png"/>
  </picture></themed-picture>
</p>

<p dir="auto">I&#39;m frequently passed long shell one-liners that require some visual inspection before running. These days, there&#39;s about as much jq in that one-liner as there is bash. I wrote jqfmt to help add line breaks in sensible locations while reading (or writing!) jq.</p>
<p dir="auto">
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/26c37c1a1ebcef12a03421adff235c8be371614e91144f330486168e96fd8b3e/68747470733a2f2f692e696d6775722e636f6d2f736749493163652e706e67"><img alt="ray" src="https://camo.githubusercontent.com/26c37c1a1ebcef12a03421adff235c8be371614e91144f330486168e96fd8b3e/68747470733a2f2f692e696d6775722e636f6d2f736749493163652e706e67" width="400px" data-canonical-src="https://i.imgur.com/sgII1ce.png"/></a>
</p>
<p dir="auto">At time of initial development, I naturally turned to <a href="https://github.com/itchyny/gojq">https://github.com/itchyny/gojq</a> expecting to be able to generate and walk a syntax tree‚Äîbut gojq didn&#39;t seem to provide an AST that could be &#34;walked,&#34; and it doesn&#39;t export its parsing logic to be used in library form. So, I yanked the relevant code out of <a href="https://github.com/itchyny/gojq/blob/main/query.go">https://github.com/itchyny/gojq/blob/main/query.go</a> and started from there.</p>
<p dir="auto">Side note: Ever tried Googling for &#34;jq formatter&#34;? Reading search results is a nightmare since jq itself <em>is</em>, among other things, a formatter.</p>


<div data-snippet-clipboard-copy-content="go install -v github.com/noperator/jqfmt/cmd/jqfmt@latest"><pre><code>go install -v github.com/noperator/jqfmt/cmd/jqfmt@latest
</code></pre></div>

<div data-snippet-clipboard-copy-content="ùÑ¢ jqfmt -h
Usage of jqfmt:
  -ar
    	arrays
  -f string
    	file
  -o	one line
  -ob
    	objects
  -op string
    	operators
  -v	verbose"><pre><code>ùÑ¢ jqfmt -h
Usage of jqfmt:
  -ar
    	arrays
  -f string
    	file
  -o	one line
  -ob
    	objects
  -op string
    	operators
  -v	verbose
</code></pre></div>
<p dir="auto">Let&#39;s take this line of jq‚Ä¶</p>
<div data-snippet-clipboard-copy-content="ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt
{ one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine))) }"><pre><code>ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt
{ one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine))) }
</code></pre></div>
<p dir="auto">‚Ä¶and format objects.</p>
<div data-snippet-clipboard-copy-content="
ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt -ob
{
    one: .two,
    three: [.four, .five, [.fivetwo, .fivethree]],
    six: map(select((.seven | .eight | .nine)))
}"><pre><code>
ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt -ob
{
    one: .two,
    three: [.four, .five, [.fivetwo, .fivethree]],
    six: map(select((.seven | .eight | .nine)))
}
</code></pre></div>
<p dir="auto">Nice! Let&#39;s also do arrays.</p>
<div data-snippet-clipboard-copy-content="ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt -ob -ar
{
    one: .two,
    three: [
        .four,
        .five,
        [
            .fivetwo,
            .fivethree
        ]
    ],
    six: map(select((.seven | .eight | .nine)))
}"><pre><code>ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt -ob -ar
{
    one: .two,
    three: [
        .four,
        .five,
        [
            .fivetwo,
            .fivethree
        ]
    ],
    six: map(select((.seven | .eight | .nine)))
}
</code></pre></div>
<p dir="auto">It&#39;ll read easier if we also break on pipes.</p>
<div data-snippet-clipboard-copy-content="ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt -ob -ar -op pipe
{
    one: .two,
    three: [
        .four,
        .five,
        [
            .fivetwo,
            .fivethree
        ]
    ],
    six: map(select((.seven |
        .eight |
        .nine)))
}"><pre><code>ùÑ¢ echo &#39;{one: .two, three: [.four, .five, [.fivetwo, .fivethree]], six: map(select((.seven | .eight | .nine)))}&#39; |
    jqfmt -ob -ar -op pipe
{
    one: .two,
    three: [
        .four,
        .five,
        [
            .fivetwo,
            .fivethree
        ]
    ],
    six: map(select((.seven |
        .eight |
        .nine)))
}
</code></pre></div>
<details><summary>Full list of valid operators</summary>
<div data-snippet-clipboard-copy-content="pipe
comma
add
sub
mul
div
mod
eq
ne
gt
lt
ge
le
and
or
alt
assign
modify
updateAdd
updateSub
updateMul
updateDiv
updateMod
updateAlt"><pre><code>pipe
comma
add
sub
mul
div
mod
eq
ne
gt
lt
ge
le
and
or
alt
assign
modify
updateAdd
updateSub
updateMul
updateDiv
updateMod
updateAlt
</code></pre></div>

</details>


<ul dir="auto">
<li>@zjzeit for helping me believe that formatting jq is a reasonable thing to do.</li>
<li>@colindean for helping me believe that jqfmt was a reasonable thing to build.</li>
<li>@tracertea for writing jq lines long enough to warrant a formatter.</li>
<li>@addyosmani for &#34;First do it, then do it right, then do it better.&#34; I wrote this on a plane (as the <a href="https://github.com/tomnomnom/hacks/tree/master/kxss">best</a> <a href="https://github.com/moloch--/godns">tools</a> are) over a year ago, but always had more features I wanted to add before releasing it. Doing it &#34;right&#34; might mean a refactor or clean-up; &#34;better&#34; would probably mean incorporating an AST.</li>
</ul>

<ul dir="auto">
<li><a href="https://news.ycombinator.com/item?id=9448128" rel="nofollow">https://news.ycombinator.com/item?id=9448128</a></li>
<li><a data-error-text="Failed to load title" data-id="1045236954" data-permission-text="Title is private" data-url="https://github.com/jqlang/jq/issues/2366" data-hovercard-type="issue" data-hovercard-url="/jqlang/jq/issues/2366/hovercard" href="https://github.com/jqlang/jq/issues/2366#issue-1045236954">jqlang/jq#2366 (comment)</a></li>
<li><a data-error-text="Failed to load title" data-id="788853107" data-permission-text="Title is private" data-url="https://github.com/itchyny/gojq/issues/62" data-hovercard-type="issue" data-hovercard-url="/itchyny/gojq/issues/62/hovercard" href="https://github.com/itchyny/gojq/issues/62">itchyny/gojq#62</a></li>
<li><a data-error-text="Failed to load title" data-id="1486704542" data-permission-text="Title is private" data-url="https://github.com/wader/jqjq/issues/8" data-hovercard-type="issue" data-hovercard-url="/wader/jqjq/issues/8/hovercard" href="https://github.com/wader/jqjq/issues/8">wader/jqjq#8</a></li>
</ul>

<ul>
<li> handle func definitions</li>
<li> quickly format jq by appending <code>fmt</code> to <code>jq</code> on the CLI</li>
</ul>

<p dir="auto">This project is licensed under the <a href="https://github.com/noperator/jqfmt/blob/main/LICENSE.md">MIT License</a>.</p>
</article></div></div>
  </body>
</html>
