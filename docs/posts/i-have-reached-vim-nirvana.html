<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.maxwellrules.com/misc/nvim_jupyter.html">Original</a>
    <h1>I have reached Vim nirvana</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
    <h2>NeoVim Notebooks</h2>

    <p>I have reached Vim nirvana with my latest setup. I can finally bring all
the advantages of working within Jupyter to my favorite text editor. You
get the code cells and interactive development with a fine-tuned editor and
plain text files which can be put through linters and code formatters. Lo
and behold:</p>
<center>
<video controls="true" width="720">  <source src="../images/data/nvim_setup_2.mp4" type="video/mp4"/></video>
<br/>
</center>
<p>As easy to navigate and execute as the Jupyter interface but with a real editor behind.
I can&#39;t ask for more.</p>
<p>This setup is powered by the following plugins:</p>
<ul>
<li><a href="https://github.com/goerz/jupytext.vim">jupytext.vim</a></li>
<li><a href="https://github.com/hkupty/iron.nvim">iron.nvim</a></li>
<li><a href="https://github.com/GCBallesteros/vim-textobj-hydrogen">vim-textobj-hydrogen</a></li>
</ul>
<p>Of course, I use a bunch of other plugins for linting, autocompletion, code
navigation...  If you are interested on those you can find my <a href="https://github.com/GCBallesteros/dotfiles/blob/master/init.vim">init.vim
here</a>.</p>
<h3>Jupytext</h3>
<center>
<img src="https://www.maxwellrules.com/images/data/jupytext_logo.svg" height="100" alt="Jupytext logo."/>
</center>
<p>Manipulating raw ipynb files is difficult and unergonomic. Tools such as
<a href="https://github.com/aaren/notedown">notedown</a> and
<a href="https://github.com/mwouts/jupytext">jupytext</a> make it possible to transform
ipynb files to and from a plain text representation. To automate the process I
use the jupytext.vim plugin. It will open the notebook and load it into the
buffer as a python script. On save, it will do the roundtrip back to an ipynb
for you. Very handy!.</p>
<p>I actually use my <a href="https://github.com/GCBallesteros/jupytext.vim">own fork of
jupytext.vim</a> because we need to
be able to specify the output format.  As soon as the pull request gets merged
I&#39;ll get rid of this comment. In the meantime if you want to reproduce the
setup you&#39;ll have to use
<a href="https://github.com/GCBallesteros/jupytext.vim">GCBallesteros/jupytext.vim</a>.</p>
<h3>Iron.nvim</h3>
<p>Connecting nvim with IPython couldn&#39;t be easier than using iron.nvim. It also
supports many other REPLs so no matter what your language of choice it will
have you covered.</p>
<p><img src="https://www.maxwellrules.com/images/data/iron_repl.png" height="400" alt="Screenshot of iron repl in action."/></p>
<p>You can either send text to the REPL via a motion/text object or through a
visual selection.</p>
<h3>vim-textobj-hydrogen</h3>
<p>The final ingredient was to have (n)vim understand code cells. I couldn&#39;t find
any off-the-shelf solution but developing my own plugin wasn&#39;t too hard by
building atop the excellent
<a href="https://github.com/kana/vim-textobj-user">vim-textobj-user</a>.  The result is
<a href="https://github.com/GCBallesteros/vim-textobj-hydrogen">vim-textobj-hydrogen</a>.
It introduces two text objects, <code>ih</code> and <code>ah</code>, that correspond to cells defined
in the hydrogen format. I also included two motions, <code>]h</code> and <code>[h</code>, to quickly
move across cells.</p>
<h3>Configuration</h3>
<p>Below is all you will need to add to your nvim configuration. The only part
that may require some explanation is the mapping for <code>]x</code>. We start by using
the IronRepl defaul map to send a motion into the REPL, i.e.  <code>ctr</code>.  Then we
follow that with the text object defined in vim-textobj-hydrogen, <code>ih</code> and
finally we run a search to reach the beginning of the next cell, <code>/^# %%</code>. The
double <code>&lt;CR&gt;</code> turns off the highlighting that was started by the search.</p>
<pre data-src="../code_samples/nvim_notebook_config.vim"></pre>

<p>Edit: To set ipython as the default REPL for python you will need to create a
file <code>plugins.lua</code> in the same folder where init.vim is with the
following contents:</p>
<pre data-src="../code_samples/nvim_notebook_config.lua"></pre>

<p>Thanks for reading!</p>
</div>
  </div></div>
  </body>
</html>
