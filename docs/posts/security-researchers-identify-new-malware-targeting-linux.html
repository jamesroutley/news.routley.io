<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.welivesecurity.com/en/eset-research/unveiling-wolfsbane-gelsemiums-linux-counterpart-to-gelsevirine/">Original</a>
    <h1>Security researchers identify new malware targeting Linux</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>ESET researchers have identified multiple samples of Linux backdoor, which we have named WolfsBane, that we attribute with high confidence to the Gelsemium advanced persistent threat (APT) group. This China-aligned threat actor has a known history dating back to 2014 and until now, there have been no public reports of Gelsemium using Linux malware. Additionally, we discovered another Linux backdoor, which we named FireWood. However, we cannot definitively link FireWood to other Gelsemium tools, and its presence in the analyzed archives might be coincidental. Thus, we attribute FireWood to Gelsemium with low confidence, considering it could be a tool shared among multiple China-aligned APT groups.</p>
<p>The most notable samples we found in archives uploaded to VirusTotal are two backdoors resembling known Windows malware used by Gelsemium. WolfsBane is the Linux counterpart of Gelsevirine, while FireWood is connected to Project Wood. We also discovered other tools potentially related to Gelsemium’s activities. The goal of the backdoors and tools discovered is cyberespionage targeting sensitive data such as system information, user credentials, and specific files and directories. These tools are designed to maintain persistent access and execute commands stealthily, enabling prolonged intelligence gathering while evading detection.</p>
<p>The trend of APT groups focusing on Linux malware is becoming more noticeable. We believe this shift is due to improvements in Windows email and endpoint security, such as the widespread use of endpoint detection and response (EDR) tools and Microsoft’s decision to disable Visual Basic for Applications (VBA) macros by default. Consequently, threat actors are exploring new attack avenues, with a growing focus on exploiting vulnerabilities in internet-facing systems, most of which run on Linux.</p>
<p>In this blogpost, we provide technical analysis of the Linux malware, mainly focusing on the two different backdoors.</p>
<blockquote>
<p><strong>Key points of the blogpost:</strong></p>
<ul>
<li>ESET researchers found archives with multiple Linux samples, containing two previously unknown backdoors.</li>
<li>The first backdoor, WolfsBane, is a Linux version of Gelsevirine, a Windows backdoor used by Gelsemium.</li>
<li>Its dropper is the equivalent of the Gelsemine dropper, and features a hider based on an open-source userland rootkit.</li>
<li>The second backdoor, which we have named FireWood, is connected to Project Wood. The Windows version of the Project Wood backdoor was previously used by the Gelsemium group in Operation TooHash.</li>
<li>Alongside the backdoors, we found additional tools, mainly web shells based on publicly available code.</li>
</ul>
</blockquote>
<h2>Overview</h2>
<p>In 2023, we found these samples in archives uploaded to VirusTotal from Taiwan, the Philippines, and Singapore, probably originating from an incident response on a compromised server. Gelsemium has <a href="https://www.welivesecurity.com/2021/06/09/gelsemium-when-threat-actors-go-gardening/" target="_blank" rel="noopener">previously</a> targeted entities in Eastern Asia and the Middle East.</p>
<p>The first backdoor is a part of a simple loading chain consisting of the dropper, launcher, and backdoor. We named this malware WolfsBane. As explained in the <a href="#Attribution and connection"><em>Attribution and connection</em></a> and <em><a href="#Technical analysis">Technical analysis</a></em> sections, WolfsBane is a Linux equivalent of Gelsemium’s Gelsevirine backdoor and the WolfsBane dropper is analogous to the Gelsemine dropper. Our name for Gelsemium comes from one possible translation of the name we found in the report from <a href="https://www.venustech.com.cn/uploads/2018/08/231401512426.pdf" target="_blank" rel="noopener">VenusTech</a>, who dubbed the group 狼毒草. It’s the name of a genus of flowering plants in the family Gelsemiaceae, and <em>Gelsemium elegans</em> is the species that contains toxic compounds like Gelsemine, Gelsenicine, and Gelsevirine, which we chose as names for the three components of this malware family. We previously analyzed Gelsevirine and Gelsemine in <a href="https://web-assets.esetstatic.com/wls/2021/06/eset_gelsemium.pdf" target="_blank" rel="noopener">this white paper</a>. Part of the analyzed WolfsBane attack chain is also a modified open-source userland rootkit, a type of software that exists in the user space of an operating system and hides its activities.</p>
<p>The second backdoor, which we named FireWood, is connected to a backdoor tracked by ESET researchers under the name Project Wood, previously analyzed in the <em>Project Wood</em> section of <a href="https://www.welivesecurity.com/en/eset-research/nspx30-sophisticated-aitm-enabled-implant-evolving-since-2005/" target="_blank" rel="noopener">this blogpost</a>. We have traced it back to 2005 and observed it evolving into more sophisticated versions.</p>
<p>The archives we analyzed also contain several additional tools, mostly webshells, that allow remote control to a user once they are installed on a compromised server, and simple utility tools.</p>
<h2>Attribution and connection<a id="Attribution and connection"></a></h2>
<p>In this section, we explain the similarities that led us to attribute the WolfsBane malware to the Gelsemium APT group and establish a connection between the FireWood backdoor and the Project Wood malware.</p>
<h3>WolfsBane links to Windows Gelsevirine</h3>
<p>Based on the following similarities, we assess that the WolfsBane backdoor is the Linux version of <a href="https://www.welivesecurity.com/2021/06/09/gelsemium-when-threat-actors-go-gardening/" target="_blank" rel="noopener">Gelsevirine</a>. Therefore, we attribute WolfsBane to the Gelsemium APT group with high confidence:</p>
<ul>
<li><strong>Custom libraries for network communication:</strong> Both the Linux and Windows versions load an embedded custom library for network communication, with a different library for each communication protocol used. The backdoor accesses the library’s functions by calling its <span>create_seesion</span> export/symbol; notably, the typo <span>seesion</span> is the same in both versions (as shown in Figure 1).</li>
</ul>
<figure><img title="Figure 1. Accessing the create_seesion export in Linux (left) and Windows (right) versions of backdoor" src="https://web-assets.esetstatic.com/wls/2024/11-2024/wolfsbane/figure-1.jpeg" alt="Figure 1. Accessing the create_seesion export in Linux and Windows versions of backdoor" width="" height=""/>
<figcaption><em>Figure 1. Accessing the </em><span>create_seesion</span><em> export in Linux (left) and Windows (right) versions of backdoor</em></figcaption>
</figure>
<ul>
<li><strong>Command execution mechanism:</strong> Both versions use the same mechanism for executing commands received from the C&amp;C server. The backdoor creates a table with hashes (derived from the command name) and corresponding pointers to functions that handle those commands (Figure 2). We provide more details in the <em><a href="#Technical analysis">Technical analysis</a></em> section.</li>
</ul>
<figure><img title="Figure 2. Comparison of plugin command names found in the Linux Wolfsbane (left) and Windows Gelsevirine (right) backdoors" src="https://web-assets.esetstatic.com/wls/2024/11-2024/wolfsbane/figure-2.jpeg" alt="Figure 2. Comparison of plugin command names" width="" height=""/>
<figcaption><em>Figure 2. Comparison of plugin command names found in the Linux Wolfsbane (left) and Windows Gelsevirine (right) backdoors</em></figcaption>
</figure>
<ul>
<li><strong>Configuration structure:</strong> Both backdoors use a very similar configuration structure. While the Linux version has some omitted fields and some extra ones, most of the field names are consistent. For example, the value of <span>pluginkey</span> found in the configuration is the same as in all Windows Gelsevirine samples from 2019. Additionally, the <span>controller_version</span> values in the Linux version configuration match those in the Gelsevirine samples.</li>
<li><strong>Domain Usage: </strong>The domain <span>dsdsei[.]com</span>, used by the Linux version, was previously flagged by ESET researchers as an indicator of compromise (IoC) associated with the Gelsemium APT group.</li>
</ul>
<h3>FireWood connection to Project Wood</h3>
<p>We have found code similarities between the FireWood sample and the backdoor used in Operation TooHash (SHA-1: <span>ED5342D9788392C6E854AAEFA655C4D3B4831B6B</span>), as <a href="https://paper.seebug.org/papers/APT/APT_CyberCriminal_Campagin/2014/GDATA_TooHash_CaseStudy_102014_EN_v1.pdf" target="_blank" rel="noopener">described by G DATA</a>, who consider it to be a part of the DirectsX rootkit. ESET researchers later named this backdoor <a href="https://www.welivesecurity.com/en/eset-research/nspx30-sophisticated-aitm-enabled-implant-evolving-since-2005/" target="_blank" rel="noopener">Project Wood</a>. Those similarities include:</p>
<ul>
<li><strong>Naming conventions:</strong> Both use the &#34;Wood&#34; string in naming. For example, the FireWood backdoor configuration structure is referenced by the symbol <span>WoodConf</span>, and Win32 versions use the mutex name <span>IMPROVING CLIENT Want Wood To Exit?</span>.</li>
<li><strong>File extensions:</strong> Both samples share specific filename extensions such as <span>.k2</span> and <span>.v2</span>.</li>
<li><strong>TEA encryption algorithm:</strong> The implementation of the TEA encryption algorithm with a variable number of rounds is the same in both samples.</li>
<li><strong>C&amp;C communication strings:</strong> Both samples use the same strings in the code responsible for C&amp;C communications, XORed with the same single-byte key (<span>0x26</span>).</li>
<li><strong>Networking code:</strong> The networking code in both samples is very similar.</li>
</ul>
<p>Based on these findings, we assess with high confidence that the FireWood backdoor is the Linux continuation of the Project Wood backdoor. A connection between the FireWood backdoor to other Gelsemium tools cannot be proved and its presence in the archives analyzed could be coincidental. So, we make our attribution to Gelsemium only with low confidence and acknowledge the possibility that it is a tool shared by multiple Chinese APT groups, perhaps through a common digital quartermaster as we have seen with other China-aligned groups.</p>
<h2>Technical analysis<a id="Technical analysis"></a></h2>
<p>The <a href="https://www.virustotal.com/gui/file/3aa8a5afa686e6b21fcc268760ea1f344560607abe9a3edb3f23d14a6032597b">first archive</a> was uploaded to VirusTotal on March 6<sup>th</sup>, 2023, from Taiwan. Subsequent archives were uploaded also from the Philippines and Singapore. Based on the folder structure (Figure 3), the target was probably an Apache Tomcat webserver running an unidentified Java web application.</p>
<figure><img title="Figure 3. Example of archive structure" src="https://web-assets.esetstatic.com/wls/2024/11-2024/wolfsbane/figure-3-1.png" alt="Figure 3. Example of archive structure" width="" height=""/>
<figcaption><em>Figure 3. Example of archive structure</em></figcaption>
</figure>
<h4>Initial access</h4>
<p>Although we lack concrete evidence regarding the initial access vector, the presence of multiple webshells (as shown in Table 1 and described in the <em><a href="#Webshells">Webshells</a> </em>section) and the tactics, techniques, and procedures (TTPs) used by the Gelsemium APT group in recent years, we conclude with medium confidence that the attackers exploited an unknown web application vulnerability to gain server access.</p>
<p><em>Table 1. Webshells found in analyzed archives</em></p>
<table>
<thead>
<tr>
<td><strong>SHA-1</strong></td>
<td><strong>Filename</strong></td>
<td><strong>Description</strong></td>
</tr>
</thead>
<tbody>
<tr>
<td><span>238C8E8EB7A732D85D8A<wbr/>7F7CA40B261D8AE4183D</span></td>
<td><span>login.jsp</span></td>
<td>Modified <a href="https://github.com/AntSwordProject/AntSword-JSP-Template/blob/master/web/shell.jsp" target="_blank" rel="noopener">AntSword JSP</a> webshell.</td>
</tr>
<tr>
<td><span>9F7790524BD759373AB5<wbr/>7EE2AAFA6F5D8BCB918A</span></td>
<td><span>yy1.jsp</span></td>
<td><a href="https://github.com/tennc/webshell/blob/master/jsp/icesword.jsp" target="_blank" rel="noopener">icesword</a> webshell.</td>
</tr>
<tr>
<td><span>FD601A54BC622C041DF0<wbr/>242662964A7ED31C6B9C</span></td>
<td><span>a.jsp</span></td>
<td>Obfuscated JSP webshell.</td>
</tr>
</tbody>
</table>
<h3>Toolset</h3>
<h4>WolfsBane</h4>
<p>WolfsBane components and chain of execution are depicted in Figure 4.</p>
<figure><img title="Figure 4. WolfsBane execution chain" src="https://web-assets.esetstatic.com/wls/2024/11-2024/wolfsbane/figure-4.jpeg" alt="Figure 4. WolfsBane execution chain" width="" height=""/>
<figcaption><em>Figure 4. WolfsBane execution chain</em></figcaption>
</figure>
<h5>Stage 1: WolfsBane dropper</h5>
<p>The dropper for WolfsBane was found in a file named <span>cron</span>, mimicking the <a href="https://en.wikipedia.org/wiki/Cron">legitimate command scheduling tool</a>. Upon execution, it first places the launcher and the primary backdoor in the <span>$HOME/.Xl1</span> hidden directory (note the use of the letter l), created by the dropper. The directory is most likely deliberately named to resemble X11 – a commonly used folder name in the <a href="https://en.wikipedia.org/wiki/X_Window_System">X Window System</a>.</p>
<p>The dropper then establishes persistence based on the system’s configuration and execution context:</p>
<p>If executed as <span>root</span>:</p>
<ul>
<li>Checks for the presence of the <span>systemd</span> suite.</li>
<li>If <span>systemd</span> is present, writes the file <span>/lib/systemd/system/display-managerd.service</span> with the path to the next stage (WolfsBane launcher) as the <span>ExecStart</span> entry (see Figure 5). This ensures the launcher runs as a system service, because <span>.service</span> files in this folder are parsed during system startup.</li>
<li>Disables the <a href="https://www.redhat.com/en/topics/linux/what-is-selinux">SELinux</a>  security module by changing the <span>SELINUX</span> entry in the SELinux configuration file from <span>enforcing to disabled</span>.</li>
</ul>
<pre><code>[Unit]
Description=Display-Manager
[Service]
Type=simple
ExecStart=&lt;PATH_TO_LAUNCHER_EXECUTABLE&gt;
[Install]
WantedBy=multi-user.targetComment</code></pre>
<p><em>Figure 5. Content of the </em><span>display-managerd.service</span><em> file</em></p>
<p>If <span>systemd</span> is not present, the dropper writes a simple bash script that executes the launcher (Figure 6), to a file named <span>S60dlump</span> into all <span>rc[1-5].d</span> startup folders.</p>
<pre><code>#!/bin/bash
/usr/bin/.Xl1/kde</code></pre>
<p><em>Figure 6. Script executing WolfsBane launcher</em></p>
<p>If executed as an unprivileged user on a Debian-based system, it:</p>
<ul>
<li>writes a similar bash script to the <span>profile.sh</span> file, and</li>
<li>adds the command <span>/home/www/.profile.sh 2&gt;/dev/null</span> to <span>.bashrc</span> and <span>.profile</span> files in the user’s home folder, ensuring that the Wolfsbane launcher starts automatically after the victim logs in.</li>
</ul>
<p>For other Linux distributions it creates the same <span>profile.sh</span> file but adds its path only to <span>.bashrc</span>.</p>
<p>Additionally, if the dropper is executed with root privileges, it drops the WolfsBane Hider rootkit as <span>/usr/lib/libselinux.so</span> and adds this command to <span>/etc/ld.so.preload</span>, ensuring that the rootkit library loads into all processes.</p>
<p>Finally, the dropper removes itself from the disk and executes the next stage – the launcher.</p>
<h5>Stage 2: WolfsBane launcher</h5>
<p>A small binary named <span>kde</span> is used to maintain persistence, cleverly disguised as a legitimate <a href="https://en.wikipedia.org/wiki/KDE">KDE desktop component</a> to avoid detection and maintain persistence. Regardless of establishment method, the aim is to execute this binary, whose main function is to parse its embedded configuration and initiate the next stage – the WolfsBane backdoor – from the specified file in the configuration.</p>
<h5>Stage 3: WolfsBane backdoor</h5>
<p>The WolfsBane backdoor, stored in a file named <span>udevd</span>, begins by loading an embedded library and calling its <span>main_session</span> export, which contains the main backdoor functionalities. This library, named by its authors as <span>libMainPlugin.so</span>, is analogous to the <span>MainPlugin.dll</span> used in the Windows version of the Gelsevirine backdoor.</p>
<p>Similar to its Windows version, the WolfsBane backdoor uses other embedded libraries for network communication. In the samples we’ve collected, they are named <span>libUdp.so</span> and <span>libHttps.so</span>, and both export the symbol <span>create_seesion</span> (the spelling mistake is exactly the same as in the Windows version of the Gelsevirine TCP module). These shared libraries provide C&amp;C communications via UDP and HTTPS protocols, respectively.</p>
<p>The backdoor encrypts the <span>libMainPlugin.so</span> library using the RC4 algorithm (with the key obtained from the <span>pluginkey</span> value in the configuration) and saves it to <span>&lt;work_directory&gt;/X1l/data/gphoto2</span>. On subsequent executions, the backdoor first checks for this file: if it exists, the file is decrypted and loaded instead of the embedded <span>libMainPlugin.so</span>. This mechanism allows the backdoor to be updated by overwriting the file.</p>
<p>The WolfsBane backdoor uses a similar approach to its Windows counterpart for executing commands received from its C&amp;C server.</p>
<h5>WolfsBane Hider rootkit</h5>
<p>WolfsBane backdoor uses a modified open-source <a href="https://github.com/unix-thrust/beurk/tree/dev" target="_blank" rel="noopener">BEURK</a> userland rootkit to hide its activities. Located in <span>/usr/lib/libselinux.so</span>, this rootkit abuses the operating system’s preload mechanism to load into new processes before other libraries by adding its path to the <span>/etc/ld.so.preload</span> file, thus enabling its functions to hook the original ones.</p>
<p>The WolfsBane Hider rootkit hooks many basic standard C library functions such as <span>open</span>, <span>stat</span>, <span>readdir</span>, and <span>access</span>. While these hooked functions invoke the original ones, they filter out any results related to the WolfsBane malware. Unlike the original BEURK rootkit, which uses an embedded configuration file for filtering, the WolfsBane developers retained the default configuration but modified the source code to exclude information related to the hardcoded filenames of the malware executables <span>udevd</span> and <span>kde</span>. Additionally, the original BEURK rootkit’s network traffic-hiding features are absent.</p>
<h4>FireWood backdoor</h4>
<p>The FireWood backdoor, in a file named <span>dbus</span>, is the Linux OS continuation of the Project Wood malware, as noted in the <a href="#Attribution and connection"><em>Attribution and connection</em></a> section. The analyzed code suggests that the file <span>usbdev.ko</span> is a kernel driver module working as a rootkit to hide processes. The FireWood backdoor communicates with the kernel drivers using the <a href="https://en.wikipedia.org/wiki/Netlink">Netlink protocol</a>.</p>
<p>FireWood uses a configuration file named <span>kdeinit</span> that is XOR encrypted with the single-byte key <span>0x26</span>. The configuration file’s structure is detailed in Table 2.</p>
<p><em>Table 2. Selected offsets and their corresponding values from the FireWood backdoor configuration file</em></p>
<table>
<thead>
<tr>
<td><strong>Offset</strong></td>
<td><strong>Value</strong></td>
<td><strong>Meaning</strong></td>
</tr>
</thead>
<tbody>
<tr>
<td><span>0x00</span></td>
<td><span>20190531110402</span></td>
<td>Unknown timestamp.</td>
</tr>
<tr>
<td><span>0x28</span></td>
<td><span>AAAAAAAAAA</span></td>
<td>Placeholder for backdoor working directory.</td>
</tr>
<tr>
<td><span>0x3C</span></td>
<td><span>0.0.0.0</span></td>
<td>C&amp;C IP address (if 0.0.0.0, the backdoor uses the C&amp;C domain).</td>
</tr>
<tr>
<td><span>0x66</span></td>
<td><span>asidomain[.]com</span></td>
<td>C&amp;C domain.</td>
</tr>
<tr>
<td><span>0xCC</span></td>
<td><span>[scsi_eh_7]</span></td>
<td>Spoofed process name.</td>
</tr>
<tr>
<td><span>0x164</span></td>
<td><span>0x072BA1E6</span></td>
<td>TEA encryption key.</td>
</tr>
<tr>
<td><span>0x1E0</span></td>
<td><span>4</span></td>
<td>Connection day (backdoor connects every fourth day of the month).</td>
</tr>
<tr>
<td><span>0x1E4</span></td>
<td><span>5</span></td>
<td>Delay time.</td>
</tr>
<tr>
<td><span>0x1E8</span></td>
<td><span>0x0474</span></td>
<td>Connection time (in minutes).</td>
</tr>
</tbody>
</table>
<p>FireWood renames its process based on the value in the configuration.</p>
<p>To establish persistence on the system, it creates a file named <span>/.config/autostart/gnome-control.desktop</span>. During startup, all files with a <span>.desktop</span> extension in the <span>/.config/autostart/ directory</span> are parsed, and any commands listed in the <span>Exec</span> entry are executed. The contents of the <span>gnome-control.desktop</span> file can be seen in Figure 7.</p>
<pre><code>[Desktop Entry]
Type=Application
Exec=&lt;PATH/TO/OWN/EXECUTABLE&gt;
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
Name[en_US]=gnome-calculator
Name=gnome-control
Comment[en_US]=</code></pre>
<p><em>Figure 7. Contents of the </em><span>gnome-control.desktop</span><em> file used for persistence by the FireWood backdoor</em></p>
<p>FireWood communicates with its C&amp;C server via TCP, as specified in its configuration. All data is encrypted using the TEA encryption algorithm with a variable number of rounds. The encryption key and number of rounds are provided in the FireWood configuration file, as shown back in Table 2.</p>
<p>The structure of sent and received messages is shown in Figure 8. The outcome of executing a command varies depending on the command type, but typically, <span>0x10181</span> indicates success, while <span>0x10180</span> denotes an error.</p>
<pre><code>struct data{
    DWORD commandID_or_return_code_value ; 
    BYTE  data [];
}</code></pre>
<p><em>Figure 8. Data. structure for C&amp;C communications used by FireWood backdoor</em></p>
<p>This backdoor is capable of executing several commands, as described in Table 3.</p>
<p><em>Table 3. FireWood backdoor commands</em></p>
<table>
<thead>
<tr>
<td><strong>Command ID</strong></td>
<td><strong>Description</strong></td>
</tr>
</thead>
<tbody>
<tr>
<td><span>0x105</span></td>
<td>Download an executable file from the C&amp;C to <span>&lt;PATH&gt;/tmpWood</span> and execute it with the ‌<span>‑UPDATE</span> parameter.</td>
</tr>
<tr>
<td><span>0x110</span></td>
<td>Execute a shell command using the <span>popen</span> function.</td>
</tr>
<tr>
<td><span>0x111</span></td>
<td>Change connection time value in the configuration.</td>
</tr>
<tr>
<td><span>0x112</span></td>
<td>Hide a process using the <span>usbdev.ko</span> kernel module.</td>
</tr>
<tr>
<td><span>0x113</span></td>
<td>Change delay time in configuration.</td>
</tr>
<tr>
<td><span>0x114</span></td>
<td>Change connection day value in configuration.</td>
</tr>
<tr>
<td><span>0x132</span></td>
<td>Clean up and exit.</td>
</tr>
<tr>
<td><span>0x181</span></td>
<td>List contents of the specified directory.</td>
</tr>
<tr>
<td><span>0x182</span></td>
<td>Exfiltrate specified file to C&amp;C server.</td>
</tr>
<tr>
<td><span>0x183</span></td>
<td>Delete specified file.</td>
</tr>
<tr>
<td><span>0x184</span></td>
<td>Rename specified file.</td>
</tr>
<tr>
<td><span>0x185</span></td>
<td>Execute specified file using the <span>system</span> function.</td>
</tr>
<tr>
<td><span>0x186</span></td>
<td>Download file from C&amp;C server.</td>
</tr>
<tr>
<td><span>0x189</span></td>
<td>Exfiltrate specified folder to C&amp;C server.</td>
</tr>
<tr>
<td><span>0x193</span></td>
<td>Load specified kernel module or shared library.</td>
</tr>
<tr>
<td><span>0x194</span></td>
<td>Unload specified kernel module or shared library.</td>
</tr>
<tr>
<td><span>0x19F</span></td>
<td>Modify specified file timestamp.</td>
</tr>
<tr>
<td><span>0x200</span></td>
<td>Delete specified directory.</td>
</tr>
<tr>
<td><span>0x201</span></td>
<td>Read content of the specified file and send it to the C&amp;C server.</td>
</tr>
<tr>
<td><span>0x1018F</span></td>
<td>Search for the specified file in the folder defined in the command.</td>
</tr>
</tbody>
</table>
<h4>Other tools</h4>
<p>We discovered two additional tools in the archives, which could be related to Gelsemium activity: the SSH password stealer and a small privilege escalation tool.</p>
<p>The SSH password stealer is an SSH client based on the open-source <a href="https://www.openssh.com/">OpenSSH</a> software, modified to collect users’ SSH credentials necessary for authenticating the user’s access to a server. The adversaries replaced the original SSH client binary in <span>/usr/bin/ssh</span> with a trojanized version. While it functions as a normal SSH client, it saves all login data in the format <span>&lt;USERNAME&gt;@&lt;HOST&gt;\t&lt;PASSWORD&gt;</span> into the file <span>/tmp/zijtkldse.tmp</span>.</p>
<p>The privilege escalation tool is a small binary, named <span>ccc</span>, that just escalates user privileges by setting UID and GUID of the execution context to <span>0</span> and executes a program at a path received as an argument. To perform this technique, the user must have root privileges to add SUID permission to this executable in advance, making it a tool for maintaining privileges rather than for obtaining them.</p>
<h4>Webshells<a id="Webshells"></a></h4>
<p>The <span>login.jsp</span> is a modified <a href="https://github.com/AntSwordProject/AntSword-JSP-Template">AntSword JSP</a> webshell that executes Java bytecode from attackers. The payload, a Java class file, is base64 encoded in the <span>tiger</span> parameter of an HTTP POST request. The original webshell also supports remote terminal, file operations, and database operations.</p>
<p>The <span>yy1.jsp</span> webshell, which we identified as icesword JSP, is sourced from internet forums, primarily those in Chinese. The icesword JSP webshell features a complete graphical user interface within its server-side code, allowing it to render a GUI in the attacker’s browser. It is not obfuscated and collects system information, executes system commands, and performs file operations. It also connects to SQL databases on the compromised host and executes SQL queries.</p>
<p>The <span>a.jsp</span> webshell, similar to <span>login.jsp</span> but obfuscated, carries a binary Java payload that is AES encrypted with the key <span>6438B9BD2AB3C40A</span> and then base64 encoded. The payload is provided in the <span>Tas9er</span> parameter. The obfuscation includes garbage comments, \u-escaped Unicode strings (which are made harder to read), and random string variables and function names. The result, base64 encoded and inserted into the string <span>1F2551A37335B564&lt;base64_encoded_result&gt;8EF53BE997851B95</span>, is sent to the attackers in the response body.</p>
<h2>Conclusion</h2>
<p>This report describes the Linux malware toolset and its connections with Windows malware samples utilized by the Gelsemium APT group. We have focused on capabilities of WolfsBane and FireWood backdoors, and analyzed WolfsBane execution chain and its utilization of the userland rootkit. This is the first public report documenting Gelsemium’s use of Linux malware, marking a notable shift in their operational strategy.</p>
<p>The trend of malware shifting towards Linux systems seems to be on the rise in the APT ecosystem. From our perspective, this development can be attributed to several advancements in email and endpoint security. The ever-increasing adoption of EDR solutions, along with Microsoft’s default strategy of disabling VBA macros, are leading to a scenario where adversaries are being forced to look for other potential avenues of attack.</p>
<p>As a result, the vulnerabilities present in internet-facing infrastructure, particularly those systems that are Linux-based, are becoming increasingly targeted. This means that these Linux systems are becoming the new preferred targets for these adversaries.</p>
<blockquote>
<p><em>For any inquiries about our research published on WeLiveSecurity, please contact us at <a href="mailto:threatintel@eset.com?utm_source=welivesecurity.com&amp;utm_medium=referral&amp;utm_campaign=autotagging&amp;utm_content=eset-research&amp;utm_term=en">threatintel@eset.com</a>. </em></p>
<p><em>ESET Research offers private APT intelligence reports and data feeds. For any inquiries about this service, visit the <a href="https://www.eset.com/int/business/services/threat-intelligence/?utm_source=welivesecurity.com&amp;utm_medium=referral&amp;utm_campaign=wls-research&amp;utm_content=unveiling-wolfsbane-gelsemiums-linux-counterpart-to-gelsevirine&amp;sfdccampaignid=7011n0000017htTAAQ" target="_blank" rel="noopener">ESET Threat Intelligence</a> page.</em></p>
</blockquote>
<h2>IoCs</h2>
<p>A comprehensive list of indicators of compromise (IoCs) and samples can be found in <a href="https://github.com/eset/malware-ioc/tree/master/gelsemium">our GitHub repository</a>.</p>
<h3>Files</h3>
<table>
<thead>
<tr>
<td><strong>SHA-1</strong></td>
<td><strong>Filename</strong></td>
<td><strong>Detection</strong></td>
<td><strong>Description</strong></td>
</tr>
</thead>
<tbody>
<tr>
<td><span> </span> <span>0FEF89711DA11C550D39<wbr/>14DEBC0E663F5D2FB86C</span></td>
<td><span> </span> <span>dbus</span></td>
<td>Linux/Agent.WF</td>
<td>FireWood backdoor.</td>
</tr>
<tr>
<td><span> </span> <span>44947903B2BC760AC2E7<wbr/>36B25574BE33BF7AF40B</span></td>
<td><span> </span> <span>libselinux.so</span></td>
<td>Linux/Rootkit.Agent.EC</td>
<td>WolfsBane Hider rootkit.</td>
</tr>
<tr>
<td><span> </span> <span>0AB53321BB9699D354A0<wbr/>32259423175C08FEC1A4</span></td>
<td><span> </span> <span>udevd</span></td>
<td>Linux/Agent.WF</td>
<td>WolfsBane backdoor.</td>
</tr>
<tr>
<td><span> </span> <span>8532ECA04C0F58172D80<wbr/>D8A446AE33907D509377</span></td>
<td><span> </span> <span>kde</span></td>
<td>Linux/Agent.WF</td>
<td>WolfsBane launcher.</td>
</tr>
<tr>
<td><span> </span> <span>B2A14E77C96640914399<wbr/>E5F46E1DEC279E7B940F</span></td>
<td><span> </span> <span>cron</span></td>
<td>Linux/Agent.WF</td>
<td>WolfsBane dropper.</td>
</tr>
<tr>
<td><span> </span> <span>209C4994A42AF7832F52<wbr/>6E09238FB55D5AAB34E5</span></td>
<td><span> </span> <span>ccc</span></td>
<td>Linux/Agent.WF</td>
<td>Privilege escalation helper tool.</td>
</tr>
<tr>
<td><span> </span> <span>F43D4D46BAE9AD963C2E<wbr/>B05EF43E90AA3A5D88E3</span></td>
<td><span> </span> <span>ssh</span></td>
<td>Linux/SSHDoor.IC</td>
<td>Trojanized SSH client.</td>
</tr>
<tr>
<td><span> </span> <span>FD601A54BC622C041DF0<wbr/>242662964A7ED31C6B9C</span></td>
<td><span> </span> <span>a.jsp</span></td>
<td>Java/Agent.BP</td>
<td>JSP webshell.</td>
</tr>
<tr>
<td><span> </span> <span>9F7790524BD759373AB5<wbr/>7EE2AAFA6F5D8BCB918A</span></td>
<td><span> </span> <span>yy1.jsp</span></td>
<td>Java/JSP.J</td>
<td>icesword webshell.</td>
</tr>
<tr>
<td><span> </span> <span>238C8E8EB7A732D85D8A<wbr/>7F7CA40B261D8AE4183D</span></td>
<td><span> </span> <span>login.jsp</span></td>
<td>Java/Webshell.AM</td>
<td>Modified AntSword JSP webshell.</td>
</tr>
<tr>
<td><span> </span> <span>F1DF0C5A74C9885CB593<wbr/>4E3EEE5E7D3CF4D291C0</span></td>
<td><span> </span> <span>virus.tgz</span></td>
<td>Linux/Agent.WF</td>
<td>VirusTotal archive.</td>
</tr>
<tr>
<td><span> </span> <span>B3DFB40336C2F17EC740<wbr/>51844FFAF65DDB874CFC</span></td>
<td><span> </span> <span>virus-b.tgz</span></td>
<td>Linux/Agent.WF</td>
<td>VirusTotal archive.</td>
</tr>
<tr>
<td><span> </span> <span>85528EAC10090AE743BC<wbr/>F102B4AE7007B6468255</span></td>
<td><span> </span> <span>CHINA-APT-Trojan.zip</span></td>
<td>Java/Agent.BP</td>
<td>VirusTotal archive.</td>
</tr>
<tr>
<td><span> </span> <span>CDBBB6617D8937D17A1A<wbr/>9EF12750BEE1CDDF4562</span></td>
<td><span> </span> <span>CHINA-APT-Trojan.zip</span></td>
<td>Linux/Rootkit.Agent.EC</td>
<td>VirusTotal archive.</td>
</tr>
<tr>
<td><span> </span> <span>843D6B0054D066845628<wbr/>E2D5DB95201B20E12CD2</span></td>
<td><span> </span> <span>CHINA-APT-Trojan.zip</span></td>
<td>Linux/Rootkit.Agent.EC</td>
<td>VirusTotal archive.</td>
</tr>
<tr>
<td><span> </span> <span>BED9EFB245FAC8CFFF83<wbr/>33AE37AD78CCFB7E2198</span></td>
<td><span> </span> <span>Xl1.zip</span></td>
<td>Linux/Rootkit.Agent.EC</td>
<td>VirusTotal archive.</td>
</tr>
<tr>
<td><span> </span> <span>600C59733444BC8A5F71<wbr/>D41365368F3002465B10</span></td>
<td><span> </span> <span>CHINA-APT-Trojan.zip</span></td>
<td>Linux/Rootkit.Agent.EC</td>
<td>VirusTotal archive.</td>
</tr>
<tr>
<td><span> </span> <span>72DB8D1E3472150C1BE9<wbr/>3B68F53F091AACC2234D</span></td>
<td><span> </span> <span>virus.tgz</span></td>
<td>Linux/Agent.WF</td>
<td>VirusTotal archive.</td>
</tr>
</tbody>
</table>
<h3>Network</h3>
<table>
<thead>
<tr>
<td><strong>IP</strong></td>
<td><strong>Domain</strong></td>
<td><strong>Hosting provider</strong></td>
<td><strong>First seen</strong></td>
<td><strong>Details</strong></td>
</tr>
</thead>
<tbody>
<tr>
<td>N/A</td>
<td><span>dsdsei[.]com</span></td>
<td>N/A</td>
<td>2020⁠-⁠08⁠-⁠16</td>
<td>WolfsBane backdoor C&amp;C server.</td>
</tr>
<tr>
<td>N/A</td>
<td><span>asidomain[.]com</span></td>
<td>N/A</td>
<td>2022⁠-⁠01⁠-⁠26</td>
<td>FireWood backdoor C&amp;C server.</td>
</tr>
</tbody>
</table>
<h2>MITRE ATT&amp;CK techniques</h2>
<p>This table was built using <a href="https://attack.mitre.org/resources/versions/">version 15</a> of the MITRE ATT&amp;CK framework.</p>
<table>
<thead>
<tr>
<td>
<p><strong>Tactic</strong></p>
</td>
<td>
<p><strong>ID</strong></p>
</td>
<td>
<p><strong>Name</strong></p>
</td>
<td>
<p><strong>Description</strong></p>
</td>
</tr>
</thead>
<tbody>
<tr>
<td rowspan="3">
<p><strong>Resource Development</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1583/001">T1583.001</a></p>
</td>
<td>
<p>Acquire Infrastructure: Domains</p>
</td>
<td>
<p>Gelsemium has registered domains through commercial providers.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1583/004">T1583.004</a></p>
</td>
<td>
<p>Acquire Infrastructure: Server</p>
</td>
<td>
<p>Gelsemium most likely acquires VPS from commercial providers.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1587/001">T1587.001</a></p>
</td>
<td>
<p>Develop Capabilities: Malware</p>
</td>
<td>
<p>Gelsemium develops its own custom malware.</p>
</td>
</tr>
<tr>
<td>
<p><strong>Execution</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1059/004">T1059.004</a></p>
</td>
<td>
<p>Command-Line Interface: Unix Shell</p>
</td>
<td>
<p>Gelsemium malware is capable of executing Linux shell commands.</p>
</td>
</tr>
<tr>
<td rowspan="4">
<p><strong>Persistence</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1037/004">T1037.004</a></p>
</td>
<td>
<p>Boot or Logon Initialization Scripts: RC Scripts</p>
</td>
<td>
<p>The WolfsBane launcher remains persistent on the system by using RC startup scripts.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1543/002">T1543.002</a></p>
</td>
<td>
<p>Create or Modify System Process: Systemd Service</p>
</td>
<td>
<p>The WolfsBane dropper can create a new system service for persistence.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1574/006">T1574.006</a></p>
</td>
<td>
<p>Hijack Execution Flow: Dynamic Linker Hijacking</p>
</td>
<td>
<p>The WolfsBane Hider rootkit abuses the <span>ld.so.preload</span> preload technique.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1547/013">T1547.013</a></p>
</td>
<td>
<p>Boot or Logon Autostart Execution: XDG Autostart Entries</p>
</td>
<td>
<p>The FireWood backdoor persists on the system by creating the <span>gnome-control.desktop</span> autostart file.</p>
</td>
</tr>
<tr>
<td rowspan="2">
<p><strong>Privilege Escalation</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1546/004">T1546.004</a></p>
</td>
<td>
<p>Event Triggered Execution: .bash_profile and .bashrc</p>
</td>
<td>
<p>The WolfsBane dropper tampers with various shell configuration files to achieve persistence.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1548/001">T1548.001</a></p>
</td>
<td>
<p>Abuse Elevation Control Mechanism: Setuid and Setgid</p>
</td>
<td>
<p>Gelsemium uses a simple tool abusing setuid and setguid for keeping escalated privileges.</p>
</td>
</tr>
<tr>
<td rowspan="8">
<p><strong>Defense Evasion</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1070/004">T1070.004</a></p>
</td>
<td>
<p>Indicator Removal: File Deletion</p>
</td>
<td>
<p>The WolfsBane dropper removes itself.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1070/006">T1070.006</a></p>
</td>
<td>
<p>Indicator Removal: Timestomp</p>
</td>
<td>
<p>The FireWood backdoor has a command for modifying the MAC time of files.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1070/009">T1070.009</a></p>
</td>
<td>
<p>Indicator Removal: Clear Persistence</p>
</td>
<td>
<p>The WolfsBane dropper removes itself from disk.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1564/001">T1564.001</a></p>
</td>
<td>
<p>Hide Artifacts: Hidden Files and Directories</p>
</td>
<td>
<p>Both the WolfsBane and FireWood backdoors are located/installed in hidden folders.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1222/002">T1222.002</a></p>
</td>
<td>
<p>File Permissions Modification: Linux and Mac File and Directory Permissions Modification</p>
</td>
<td>
<p>The WolfsBane dropper uses Linux chmod commands to modify permissions of dropped executables.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1027/009">T1027.009</a></p>
</td>
<td>
<p>Obfuscated Files or Information: Embedded Payloads</p>
</td>
<td>
<p>The WolfsBane dropper has all its payloads compressed and embedded.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1014">T1014</a></p>
</td>
<td>
<p>Rootkit</p>
</td>
<td>
<p>Both WolfsBane and FireWood malware utilize rootkits for evasion.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1036/005">T1036.005</a></p>
</td>
<td>
<p>Masquerading: Match Legitimate Name or Location</p>
</td>
<td>
<p>Gelsemium often names its malware to match legitimate files and folders.</p>
</td>
</tr>
<tr>
<td rowspan="2">
<p><strong>Discovery</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1082">T1082</a></p>
</td>
<td>
<p>System Information Discovery</p>
</td>
<td>
<p>The WolfsBane dropper enumerates system information.</p>
</td>
</tr>
<tr>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1083">T1083</a></p>
</td>
<td>
<p>File and Directory Discovery</p>
</td>
<td>
<p>The FireWood backdoor is capable of searching in the machine file system for specified files and folders.</p>
</td>
</tr>
<tr>
<td>
<p><strong>Collection</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1056">T1056</a></p>
</td>
<td>
<p>Input Capture</p>
</td>
<td>
<p>The SSH password stealer captures user credentials.</p>
</td>
</tr>
<tr>
<td>
<p><strong>Exfiltration</strong></p>
</td>
<td>
<p><a href="https://attack.mitre.org/versions/v15/techniques/T1041">T1041</a></p>
</td>
<td>
<p>Exfiltration Over C2 Channel</p>
</td>
<td>
<p>The FireWood backdoor exfiltrates collected data utilizing C&amp;C communications.</p>
</td>
</tr>
</tbody>
</table>
<p><a href="https://www.eset.com/int/business/services/threat-intelligence/?utm_source=welivesecurity.com&amp;utm_medium=referral&amp;utm_campaign=wls-research&amp;utm_content=unveiling-wolfsbane-gelsemiums-linux-counterpart-to-gelsevirine&amp;sfdccampaignid=7011n0000017htTAAQ" target="_blank" rel="noopener"><img src="https://web-assets.esetstatic.com/wls/2023/2023-12/welivesecurity-eset-threat-intelligence.jpeg" alt="" width="915" height="296"/></a></p>
</div></div>
  </body>
</html>
