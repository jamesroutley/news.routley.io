<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://datanarratives.com/blog/notion-headless-cms/">Original</a>
    <h1>Using Notion as a headless CMS for our blog</h1>
    
    <div id="readability-page-1" class="page"><div id="__next"><article><article><section><p><span>Headless CMSes have </span><span><a href="https://trends.google.com/trends/explore?date=today%205-y&amp;q=%2Fg%2F11fz9zt_82,notion">caught on</a></span><span> in popularity recently. When building a CMS for the </span><span><a href="https://datanarratives.com/blog">Data Narratives Blog</a></span><span>, we wanted to try one out. While there are </span><span><a href="https://en.wikipedia.org/wiki/Headless_content_management_system#List_of_headless_content_management_systems">plenty of specialized solutions</a></span><span>, we went with Notion. It‚Äôs stable, everyone is familiar with it, and has a super easy to use API.</span></p><h2><span>Setting up a Notion Database</span></h2><p><span>To use Notion as a headless CMS, we first had to set up a database that would have all of our blogposts. This was easy! I created a few fields (like an excerpt, a hero image url, tags, and author name). I also created a field called </span><span>Status</span><span>, so that we could work on drafts without publishing them.</span></p><figure><p><span><img alt="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p></figure><p><span>Notion automatically includes fields like </span><span>created_at</span><span> and </span><span>updated_at</span><span> in its API, so we did not have to worry about them.</span></p><h2><span>Connecting the Database with an API</span></h2><p><span>Next, I created an integration by going to </span><span><a href="https://www.notion.so/my-integrations">https://www.notion.so/my-integrations</a></span><span>, and specifying the ‚Äúcapabilities‚Äù of the integration. I chose an internal integration with read only access. After this, notion issued an internal integration token.</span></p><figure><p><span><img alt="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p></figure><p><span>Once this was done, I had to add my integration as a connection to the Database, like in the image below.</span></p><figure><p><span><img alt="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p></figure><p><span>Additionally, I also needed the database id. To get it, I needed to look at the URL of the database by going to the share menu. More on that </span><span><a href="https://developers.notion.com/docs/getting-started#step-2-share-a-database-with-your-integration">here</a></span><span>.</span></p><pre><code>https://www.notion.so/myworkspace/a8aec43384f447ed84390e8e42c2e089?v=...
                                  |--------- Database ID --------|</code></pre><h2><span>Integrating the Notion API with NextJS</span></h2><p><span>Once I had the integration token, database id, and had connected the database with the integration, I could use Notion‚Äôs official client library (</span><span>@notionhq/client</span><span>) to get data from the database.</span></p><p><span>I liberally lifted code from Samuel Kraft‚Äôs wonderful </span><span>notion-blog-nextjs</span><span> repository </span><span><a href="https://github.com/samuelkraft/notion-blog-nextjs">on Github</a></span><span> to do this.</span></p><p><span>And that‚Äôs it! Samuel repo does most of the heavy lifting. You will have to do some additional work to enable embeds, callouts, quotes etc.</span></p><p><span>Sample code for getting all items that were marked as published in the database is below!</span></p><pre><code>export const getStaticProps = async () =&gt; {
  const databaseId = &#34;610489ee90164deba22a9da545da9a5e&#34;;
  const database = await getDatabase(databaseId);
  const posts = database.filter((item) =&gt; item.properties.Status.select.name === &#34;Published&#34;);
  return {
    props: {
      posts: posts,
    },
    revalidate: 60,
  };
};</code></pre><h2><span>Future changes</span></h2><p><span>We still have some teething issues. The url slug is Notion‚Äôs page id instead of something semantically meaningful, code snippets (like the one above) display ‚Äì but don‚Äôt have any colors on them. We‚Äôll fix those soon. For now, this is a pretty easy way to blog üòÄ</span></p></section></article></article></div></div>
  </body>
</html>
