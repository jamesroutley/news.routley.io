<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/bytedance/monoio">Original</a>
    <h1>Monoio – A thread-per-core Rust async runtime with io_uring</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto">A thread-per-core Rust runtime with io_uring.</p>
<p dir="auto"><a href="https://crates.io/crates/monoio" rel="nofollow"><img src="https://camo.githubusercontent.com/e6f4affeac50143d2190d47c86ec8ccdacd97b42947e56053789ad76a29c5c27/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f762f6d6f6e6f696f2e737667" alt="Crates.io" data-canonical-src="https://img.shields.io/crates/v/monoio.svg"/></a>
<a href="https://github.com/bytedance/monoio/blob/master/LICENSE-MIT"><img src="https://camo.githubusercontent.com/43130a86f5ddaa533565af91ccc42e98748a79e3e57ae571710473b651bd92c8/68747470733a2f2f696d672e736869656c64732e696f2f6372617465732f6c2f6d6f6e6f696f2e737667" alt="MIT/Apache-2 licensed" data-canonical-src="https://img.shields.io/crates/l/monoio.svg"/></a>
<a href="https://github.com/bytedance/monoio/actions"><img src="https://github.com/bytedance/monoio/actions/workflows/ci.yml/badge.svg" alt="Build Status"/></a>
<a href="https://github.com/bytedance/monoio/blob/master/README-zh.md">中文说明</a></p>
<h2 dir="auto"><a id="user-content-design-goal" aria-hidden="true" href="#design-goal"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Design Goal</h2>
<p dir="auto">As a runtime based on io_uring, Monoio is designed to be the most efficient and performant Rust runtime.</p>
<p dir="auto">For some use cases, it is not necessary to make task schedulable between threads. For example, if we want to implement a load balancer like nginx, we may want to write it in a thread-per-core way. The thread local data need not to be shared between threads, so the <code>Sync</code> and <code>Send</code> will not have to be implemented.</p>
<p dir="auto">Also, the Monoio is designed to be efficient. To achieve this goal, we enabled many Rust unstable features like GAT; and we designed a whole new IO abstraction to avoid copying, which may cause some compatibility problems.</p>
<p dir="auto"><a href="https://github.com/bytedance/monoio/blob/master/docs/en/benchmark.md">Our benchmark</a> shows that Monoio has a better performance than other common Rust runtimes.</p>
<h2 dir="auto"><a id="user-content-quick-start" aria-hidden="true" href="#quick-start"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Quick Start</h2>
<p dir="auto">To use monoio, you need the latest nightly rust toolchain. If you already installed it, please make sure it is the latest version.</p>
<p dir="auto">To force using nightly, create a file named <code>rust-toolchain</code> and write <code>nightly</code> in it. Also, you can use <code>cargo +nightly</code> to build or run.</p>
<p dir="auto">Here is a basic exmaple of how to use Monoio.</p>
<div data-snippet-clipboard-copy-content="/// A echo example.
///
/// Run the example and `nc 127.0.0.1 50002` in another shell.
/// All your input will be echoed out.
use monoio::io::{AsyncReadRent, AsyncWriteRentExt};
use monoio::net::{TcpListener, TcpStream};

#[monoio::main]
async fn main() {
    let listener = TcpListener::bind(&#34;127.0.0.1:50002&#34;).unwrap();
    println!(&#34;listening&#34;);
    loop {
        let incoming = listener.accept().await;
        match incoming {
            Ok((stream, addr)) =&gt; {
                println!(&#34;accepted a connection from {}&#34;, addr);
                monoio::spawn(echo(stream));
            }
            Err(e) =&gt; {
                println!(&#34;accepted connection failed: {}&#34;, e);
                return;
            }
        }
    }
}

async fn echo(stream: TcpStream) -&gt; std::io::Result&lt;()&gt; {
    let mut buf: Vec&lt;u8&gt; = Vec::with_capacity(8 * 1024);
    loop {
        // read
        let (res, _buf) = stream.read(buf).await;
        buf = _buf;
        let res: usize = res?;
        if res == 0 {
            return Ok(());
        }

        // write all
        let (res, _buf) = stream.write_all(buf).await;
        buf = _buf;
        res?;

        // clear
        buf.clear();
    }
}
"><pre><span>/// A echo example.</span>
<span>///</span>
<span>/// Run the example and `nc 127.0.0.1 50002` in another shell.</span>
<span>/// All your input will be echoed out.</span>
<span>use</span> monoio<span>::</span>io<span>::</span>{AsyncReadRent, AsyncWriteRentExt};
<span>use</span> monoio<span>::</span>net<span>::</span>{TcpListener, TcpStream};

#[monoio::main]
<span>async</span> <span>fn</span> <span>main</span>() {
    <span>let</span> listener <span>=</span> TcpListener<span>::</span><span>bind</span>(<span>&#34;127.0.0.1:50002&#34;</span>).<span>unwrap</span>();
    <span>println!</span>(<span>&#34;listening&#34;</span>);
    <span>loop</span> {
        <span>let</span> incoming <span>=</span> listener.<span>accept</span>().<span>await</span>;
        <span>match</span> incoming {
            <span>Ok</span>((stream, addr)) <span>=&gt;</span> {
                <span>println!</span>(<span>&#34;accepted a connection from {}&#34;</span>, addr);
                monoio<span>::</span><span>spawn</span>(<span>echo</span>(stream));
            }
            <span>Err</span>(e) <span>=&gt;</span> {
                <span>println!</span>(<span>&#34;accepted connection failed: {}&#34;</span>, e);
                <span>return</span>;
            }
        }
    }
}

<span>async</span> <span>fn</span> <span>echo</span>(stream: TcpStream) -&gt; std::io::<span>Result</span>&lt;()&gt; {
    <span>let</span> <span>mut</span> buf: <span>Vec</span><span>&lt;</span><span>u8</span><span>&gt;</span> <span>=</span> <span>Vec</span><span>::</span><span>with_capacity</span>(<span>8</span> <span>*</span> <span>1024</span>);
    <span>loop</span> {
        <span>// read</span>
        <span>let</span> (res, _buf) <span>=</span> stream.<span>read</span>(buf).<span>await</span>;
        buf <span>=</span> _buf;
        <span>let</span> res: <span>usize</span> <span>=</span> res?;
        <span>if</span> res <span>==</span> <span>0</span> {
            <span>return</span> <span>Ok</span>(());
        }

        <span>// write all</span>
        <span>let</span> (res, _buf) <span>=</span> stream.<span>write_all</span>(buf).<span>await</span>;
        buf <span>=</span> _buf;
        res?;

        <span>// clear</span>
        buf.<span>clear</span>();
    }
}</pre></div>
<h2 dir="auto"><a id="user-content-limitations" aria-hidden="true" href="#limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Limitations</h2>
<ol dir="auto">
<li>Since we rely on io_uring, currently monoio depends on Linux 5.6 or later. Epoll or other multiplex I/O will be supported soon.</li>
<li>Monoio can not solve all problems. If the workload is very unbalanced, it may cause performance degradation than Tokio since CPU cores may not be fully utilized.</li>
</ol>
<h2 dir="auto"><a id="user-content-contributors" aria-hidden="true" href="#contributors"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contributors</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/f594ea14f3639768abaaf24010a82dc0474c2eaa16c278a8f2b37691eb456cb1/68747470733a2f2f636f6e747269622e726f636b732f696d6167653f7265706f3d6279746564616e63652f6d6f6e6f696f"><img src="https://camo.githubusercontent.com/f594ea14f3639768abaaf24010a82dc0474c2eaa16c278a8f2b37691eb456cb1/68747470733a2f2f636f6e747269622e726f636b732f696d6167653f7265706f3d6279746564616e63652f6d6f6e6f696f" alt="GitHub Contributors Image" data-canonical-src="https://contrib.rocks/image?repo=bytedance/monoio"/></a></p>
<p dir="auto">Thanks for their contributions!</p>
<h2 dir="auto"><a id="user-content-licenses" aria-hidden="true" href="#licenses"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Licenses</h2>
<p dir="auto">Monoio is licensed under the MIT license or Apache license.</p>
<p dir="auto">During developing we referenced a lot from Tokio, Mio, Tokio-uring and other related projects. We would like to thank the authors of these projects.</p>
</article>
        </div></div>
  </body>
</html>
