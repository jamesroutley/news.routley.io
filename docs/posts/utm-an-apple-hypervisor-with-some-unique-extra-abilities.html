<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.theregister.com/2023/09/29/utm_apple_hypervisor_foss_fest/">Original</a>
    <h1>UTM: An Apple hypervisor with some unique extra abilities</h1>
    
    <div id="readability-page-1" class="page"><div id="body">
<p><span>Friday FOSS Fest</span> UTM is a handy hypervisor for Macs and Apple fondleslabs, but it&#39;s more than just that. It has some very particular skills. We are quite taken with it.</p>
<p><a href="https://github.com/utmapp/UTM" rel="nofollow">UTM</a> is a desktop hypervisor for Apple kit – notably for Macs with macOS 11 or later, but it also <a href="https://getutm.app/" rel="nofollow">supports</a> some iOS devices too. (Sadly, <em>The Reg</em> FOSS desk has none new or powerful enough to give this a try.) It supports both x86-64 and Apple Silicon based Macs, but it can do more than most other hypervisors. Judging from the Alan Turing quotation on its Github page, we think that the name stands for <a target="_blank" href="https://www.theregister.com/2021/05/11/turing_machine_0day_no_patch_available/">Universal Turing Machine</a>.</p>
<p>Among other things, UTM can act as a front-end to Apple&#39;s built-in hypervisor, a feature in macOS 10.10 or above, called simply <a target="_blank" href="https://developer.apple.com/documentation/hypervisor" rel="nofollow">Hypervisor</a>. In its own right, the Apple hypervisor offers some useful facilities: for instance, it <a target="_blank" href="https://www.theregister.com/2022/06/09/apple_linux_support_macos/">enables Linux VMs to call Rosetta 2</a> for very fast x86-64 to Arm64 translation. However, UTM supports other forms of virtualization as well.</p>
<div><p><a href="https://regmedia.co.uk/2023/09/29/debian-arm64-x86-mac.jpg" target="_blank"><img src="https://regmedia.co.uk/2023/09/29/debian-arm64-x86-mac.jpg?x=648&amp;y=370&amp;infer_y=1" alt="The Arm64 edition of Debian running on an Intel-based iMac is much easier to achieve with UTM than it is with unassisted QEMU." title="The Arm64 edition of Debian running on an Intel-based iMac is much easier to achieve with UTM than it is with unassisted QEMU." height="370" width="648"/></a></p><p>The Arm64 edition of Debian running on an Intel-based iMac is much easier to achieve with UTM than it is with unassisted QEMU (click to enlarge)</p>
</div>
<p>There&#39;s already a choice of desktop hypervisors for Macs, of course: VMware Fusion, Parallels Desktop, and of course the cross-platform VirtualBox. Most are available in native versions for Apple Silicon Macs, too – but as with any standard hypervisor, what they do is run virtual machines of the same CPU type as the underlying host machine. So, for instance, Parallels&#39; knowledge base carefully <a target="_blank" href="https://kb.parallels.com/125343" rel="nofollow">explains</a> that it can only run Windows <em>for Arm</em> on Apple Silicon Macs.</p>
<p>This is standard behavior for a hypervisor: they virtualize the underlying hardware, so VMs get the same type of CPU as the host. So, if you run an x86-64 hypervisor on x86-64, it can only run x86-64 guests, and if you run an Arm hypervisor on Arm, it can only run Arm guests.</p>

    

<p>This is where UTM is different. As well as the Apple hypervisor, it also supports the open source <a href="https://www.qemu.org/" rel="nofollow">QEMU</a> by French low-level programming <a href="https://www.theregister.com/2014/12/12/bpg_jpeg_killer/">überboffin Fabrice Bellard</a>.</p>

        


        

<p>QEMU is an unusual and complex tool, able to operate in several different ways, which means that it is often misunderstood. QEMU is able to act as a whole-system emulator, running software for one CPU family on a totally different CPU. In order to do this, it has tools for creating and managing emulated hard disk drives, graphics and network cards and so on: all the virtual hardware that the emulated system needs to run.</p>
<p>However, where it gets confusing is that ever since version 2.6.20 back in 2007, the Linux kernel has its own built-in KVM hypervisor, which in turn uses the hardware virtualization facilities in all modern Intel and AMD chips, as the <em>Reg</em> FOSS Desk <a target="_blank" href="https://www.theregister.com/2011/07/11/a_brief_history_of_virtualisation_part_one/">covered in painstaking detail back in 2011</a>. But <em>all</em> that KVM can do is talk to the CPU&#39;s built-in facilities that start and stop virtualized instances. KVM on its own has no ability to define virtual disk drives, or graphics adaptors, or any of that.</p>

        

<p><em>That</em> is where QEMU comes in. It&#39;s widely used in most Linux distros to provide this supplementary front-end scaffolding: to create, provide and manage all the additional hardware for VMs. Essentially, the Linux kernel provides the CPU, and QEMU does the rest. In this mode, QEMU does no processor emulation at all: the OS is providing that, meaning that the guest code runs at close to native speed on the real underlying CPU. Rather less well known is that it can do <a target="_blank" href="https://wiki.qemu.org/Hosts/Mac" rel="nofollow">the same on macOS</a>.</p>
<p>This is where the misunderstanding of QEMU comes from. It can work <em>both</em> as a full-system emulator <em>and</em> as a <a target="_blank" href="https://www.theregister.com/2011/06/23/client_side_virtualisation/">type 2 hypervisor</a> with the help of a kernel and CPU that provide the relevant functionality.</p>
<p>UTM wraps a friendly GUI around two different hypervisors, one of them able to run in two different modes. It can use the Apple hypervisor directly, virtualizing your underlying Intel or Apple Silicon CPU, but as well as that, it can also use QEMU, either as a hypervisor for native-speed virtualization, but also, in emulation mode.</p>
<div><p><a href="https://regmedia.co.uk/2023/09/29/utm-sonoma-classic-sunos.jpg" target="_blank"><img src="https://regmedia.co.uk/2023/09/29/utm-sonoma-classic-sunos.jpg?x=648&amp;y=405&amp;infer_y=1" alt="UTM running both classic MacOS and Solaris on an M1 MacBook Air under Sonoma." title="UTM running both classic MacOS and Solaris on an M1 MacBook Air under Sonoma." height="405" width="648"/></a></p><p>UTM running both classic MacOS and Solaris on an M1 MacBook Air under Sonoma (click to enlarge)</p>
</div>
<p>This means that UTM can run an x86 guest on Apple Silicon, or it can run an Arm64 guest on an Intel Mac. And it&#39;s not limited to Arm and x86: it can run a PowerPC or SPARC VM on both Intel and Arm64 Macs, as well.</p>
<p>To test this, we downloaded a MacOS 9.2.2 universal install ISO file from <a href="http://macos9lives.com/smforum/index.php?topic=2109.0" rel="nofollow">MacOS9Lives</a>, chose a PowerPC VM, and a few minutes later we were deeply impressed to be running Classic under macOS Ventura. We also installed the Arm64 edition of Debian 12 on a Core i7 iMac.</p>

        

<p>If you don&#39;t want to configure your own VM, UTM offers a <a href="https://mac.getutm.app/gallery/" rel="nofollow">gallery</a> of pre-built guest images, and in testing, we&#39;ve successfully run the PowerPC-native Classic MacOS 9.2.1 on both M1 and Core i7 Macs. We also got the SPARC version of Sun Solaris 9 running on both machines, too.</p>
<ul>

<li><a href="https://www.theregister.com/2022/01/07/foss_fest_foreign_letter_key_guide/">Never mind the Panic button – there&#39;s a key to Compose yourself</a></li>

<li><a href="https://www.theregister.com/2021/12/17/tilde_text_editor/">Fans of original gangster editors, look away now: It&#39;s Tilde, a text editor that doesn&#39;t work like it&#39;s 1976</a></li>

<li><a href="https://www.theregister.com/2023/04/14/return_flying_toasters/">The return of the classic Flying Toasters screensaver</a></li>

<li><a href="https://www.theregister.com/2022/02/04/friday_foss_fest_taekwindow/">Taekwindow: Time to make your middle mouse button earn its keep</a></li>
</ul>
<p>Emulation is nowhere near as fast as true virtualization: the SPARC VM was not exactly snappy, but it&#39;s usable. However, even an eight-year-old Core i7 is substantially faster than the fastest Macs able to <a href="https://everymac.com/mac-answers/mac-os-9-classic-support-faq/last-macs-to-boot-startup-macos-9.html" rel="nofollow">natively boot MacOS 9</a>, and MacOS 9 <a href="https://lowendmac.com/2013/low-end-macs-compleat-guide-to-mac-os-9/" rel="nofollow">requires</a> just 40MB of RAM and ran well on 233MHz G3 Macs: it&#39;s not a demanding OS by 21st century standards.</p>
<p>This isn&#39;t the same thing as Classic Mode in Mac OS X 10.0 through to 10.4: there&#39;s little integration between the host and guest OS, and you must work out for yourself how to move files between them. Even so, we were very impressed how easy UTM makes it go get this feat of emulation working.</p>
<p>We also tested the <a href="https://www.theregister.com/2023/09/27/beta_ubuntu_fedora/">Fedora 39 beta</a> in UTM, and it ran more smoothly than under VirtualBox – doubtless because Fedora&#39;s native hypervisor, GNOME Boxes, uses the same underlying QEMU tooling.</p>
<div><p><a href="https://regmedia.co.uk/2023/09/29/utm-macos12-fed39.jpg" target="_blank"><img src="https://regmedia.co.uk/2023/09/29/utm-macos12-fed39.jpg?x=648&amp;y=618&amp;infer_y=1" alt="Even if you don&#39;t want all the emulation stuff, it&#39;s a perfectly serviceable x86-on-x86 hypervisor, here running the latest Fedora beta." title="Even if you don&#39;t want all the emulation stuff, it&#39;s a perfectly serviceable x86-on-x86 hypervisor, here running the latest Fedora beta." height="618" width="648"/></a></p><p>Even if you don&#39;t want all the emulation stuff, it&#39;s a perfectly serviceable x86-on-x86 hypervisor, here running the latest Fedora beta (click to enlarge)</p>
</div>
<p>Running entire x86-64 OSes on our M1 MacBook Air was less impressive: Rosetta 2 does app-by-app translation, and it can&#39;t help with full-system emulation. Performance of the guest OS was a little sluggish, but bearable: you could tolerate it for modest use.</p>
<p>It reminded this vulture strongly of using Acorn&#39;s <a href="http://chrisacorns.computinghistory.org.uk/docs/Acorn/Manuals/Acorn_LearningCurvePCEm17UG.pdf" rel="nofollow">!PCEm</a> [PDF] software PC emulator on the original ARM desktop computer, the Acorn Archimedes, under RISC OS in the late 1980s. While you&#39;d always prefer to use native software if it&#39;s available, it was very impressive that an 8MHz ARM2 had the raw horsepower to completely emulate an x86 PC at usable speed. It was impressive an ARM computer could emulate a sub-5MHz XT-class IBM compatible with 640 kB of RAM 35 years ago, and it&#39;s just as impressive it can emulate a 64-bit multi-core PC with 4GB of RAM today.</p>
<p>UTM is a free download from Github, but if you get it from Apple&#39;s macOS App Store, it <a href="https://apps.apple.com/us/app/utm-virtual-machines/id1538878817" rel="nofollow">costs</a> $9.99, which helps to fund the program&#39;s development. ®</p>                                
                    </div></div>
  </body>
</html>
