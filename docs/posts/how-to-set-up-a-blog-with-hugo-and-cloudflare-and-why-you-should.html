<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://smaller.fish/posts/hugo">Original</a>
    <h1>How to set up a blog with Hugo and Cloudflare, and why you should</h1>
    
    <div id="readability-page-1" class="page"><div role="main">
      
  
  <article>

    <div>
      <p><span> 15 minutes read</span>
        <span>— 3131 words</span>
      </p><p>The internet is not as good as it used to be. Information is siloed into walled gardens like Facebook, Nextdoor, and so on. Google results are saturated with SEO spam. Wordpress is a mess that keeps on chugging through inertia; Medium, while clean, is behind a paywall; Reddit and Twitter are increasingly hiding their value behind registration and/or paywalls; Substack is fine if you want to be paid, but is yet another commercial enterprise that will take articles offline if and when it goes boom. Early easy-webpage-builders like Geocities highlight the issue of link-rot: when the money runs out, huge numbers of sites can disappear from the web.</p>
<p>Ironically enough, old media companies are doing a better job of preserving archives online than most, although they too (understandably) have gone down the road of paywalls. In 2022, information apparently wants to be commoditized. Indeed, in 2022, information is being strangled by content. Back in the early 2000s we thought blogs would overturn traditional media. Somewhere along the way it turned out to be online advertising that did that, instead. Online advertising lives in <em>content</em>.</p>
<p>The fact that the word <em>content</em> is so widely used is evidence that the mindset of marketing has wormed its way into the deepest recesses of all of our brains (“gee whiz Bob, you sure make some fine content”). <em>Content</em> is filler. <em>Content</em> is bland. <em>Content</em> is monetized. Create a blog to tell <em>stories</em>, to share ideas, opinions and information, or to show photos, videos, songs, and things that you’ve created. Don’t create <em>content</em>. Make a real human blog.</p>
<p>You can be a small part of the change you want to see by creating a blog and sharing something genuine. Instead of posting ideas into a closed platform, consider creating a blog that runs on open source technologies, and hosting it on an easy to use platform with a generous free tier (which is trivial enough to move from if they ever become a problem.) By all means share your own blog posts on social media; that’ll make it more likely, after all, that your site gets well indexed by search engines, and that your posts show up in search results. Don’t sweat audience and SEO though, as that turns blogging into a job. Keep it fun. (And don’t show ads on your blog, please!)</p>
<p>In this article I’ll describe a way to build a blog using <em>Hugo</em>, <em>Git</em>, and <em>Cloudflare</em> that you can host for free (i.e. no monthly charge), aside from your annual domain registration fee. I’m not going to <a href="https://www.freecodecamp.org/news/learn-the-basics-of-git-in-under-10-minutes-da548267cc91/">explain git</a> here (because it’s out of scope for this post), but you can copy/paste what I’m doing and search for more information about how to use it. I’ll go into enough depth on Hugo that you can set up a <a href="http://tantalizingsloth.win">Medium-like blog</a>, and walk through the Cloudflare setup in detail. I will give you all commands you’ll need to run in order to get a site with a blog post published on the internet, but to benefit from this you’ll need to be at least moderately technical, and in particular not be scared of using the terminal on OSX or Linux. Follow the 5 steps below, and your first post will be live within 30 minutes (or your money back).</p>
<p>If you want a sneak preview of what it looks like to create new blog posts using Hugo, skip ahead to section 5 below, and then come back up here if this sounds like something you can cope with. (Otherwise, it’s been fun, and see you around.)</p>
<p>To get started, you’ll need accounts on Cloudflare and Github, so go get them first:</p>
<ul>
<li><a href="https://dash.cloudflare.com/sign-up">Register a Cloudflare Account</a></li>
<li><a href="https://github.com/signup">Register a Github Account</a></li>
</ul>
<p>Now we’ll get into the setup.</p>

<p>We’re going to use Cloudflare to register the domain for the sake of this example, but it really doesn’t matter which domain registrar you use. If you’re on a different registrar then you’ll need to enter Cloudflare’s domain servers in one of the steps below in order to wire up the hosting. If you’re on Cloudflare, it’s a little smoother to associate the domain with your pages.</p>
<p>In Cloudflare:</p>
<ul>
<li>Click Registrar in the sidebar</li>
<li>Click Register</li>
<li>Enter a domain name or a couple of words describing your idea</li>
<li>Once you find something you like, purchase it</li>
</ul>
<p>Cloudflare’s search is reasonably smart, so you can enter one or more words and it will find available domains that are nearby in concept. For the sake of this article I registered <a href="https://tantalizingsloth.win">tantalizingsloth.win</a>, for $3.16 a year, and $4.16 renewal every year after that. (Watch out for high renewal fees, particularly if using a scammy registrar like Godaddy or Namecheap.)</p>
<p><img src="https://smaller.fish/images/blog-register.png" alt="Register A Domain"/></p>

<p>There is excellent <a href="https://gohugo.io/getting-started/quick-start/">initial setup documentation</a> on the official Hugo site, which I will summarize here:</p>
<h2 id="2a-install-hugo-and-git">2a. Install Hugo and Git</h2>
<p>Choose one of the following, depending on your platform. (If you’re a mac user and this stuff is all new to you, go with Homebrew).</p>
<pre><code># for mac (if you prefer macports. Check out https://guide.macports.org/#installing)
port install hugo
port install git

# for mac (if you prefer homebrew. Check out https://docs.brew.sh/Installation)
brew install hugo 
brew install git

# for ubuntu
apt install hugo
apt install git
</code></pre><h2 id="2b-create-a-new-site-and-install-a-theme">2b. Create a new site and install a theme</h2>
<p>Now we’re going to get hugo to set up the initial directory structure for the site. Obviously swap out tantalizingsloth for the name of your site; easiest if you name the site after your domain name, but you don’t strictly have to. Run this command:</p>
<pre><code>hugo new site tantalizingsloth
</code></pre><p>This creates a directory with the name that you gave it, and some initial files and directories within it. Look around if you like, but I’ll point you at everything you need as we go through the next few steps.</p>
<p>Now we need get and install a <a href="https://themes.gohugo.io/">theme</a>. A lot of the Hugo documentation out there will instruct you to install the theme as a git submodule, but we’re not going to do that here, because it can break Cloudflare in confusing ways. Instead we’ll just clone the theme, strip the git metadata from it, and include it directly in our site. (That means that if you want to apply theme updates in future that you’ll have to reclone, and copy into your site. I look on the theme as a foundation to build and hack on, so I’m fine taking the “fork” implied by doing it this way. If these parentheses made no sense to you, don’t worry about it. Blog post in 25 mins or less!)</p>
<p>Note that to some extent you can switch between themes, but there are variations between themes in expected layout of files, properties, etc, so they’re not 100% compatible. It’s best to experiment with different themes up front with one or two posts, and then to stick with it for the duration of the site. Here I’m installing <a href="https://themes.gohugo.io/themes/newsroom/">newsroom</a>, which is a reasonably clean theme. If you choose a different theme and something doesn’t work the same way as I describe it below, consult the theme’s documentation for more info (or use newsroom instead just for the sake of getting up and running).</p>
<pre><code># first get a copy of newsroom, and remove the git metadata
cd /tmp
git clone https://github.com/onweru/newsroom.git
cd newsroom
rm -fr .git exampleSite i8n 

# then move the theme (newsroom) into our site
cd ~/tantalizingsloth 
# if that didn&#39;t work, find your way back to wherever you were when you made the site, above
mv /tmp/newsroom themes
mkdir static/images
</code></pre><p>As an end result of this, you should have <code>themes/newsroom</code> within your blog folder structure.</p>
<p>Now edit <code>config.toml</code>, and change (as appropriate) to be close to the following:</p>
<pre><code>baseURL = &#34;https://tantalizingsloth.win&#34;
languageCode = &#34;en-us&#34;
title = &#34;Tantalizing Sloth&#34;
theme = &#34;newsroom&#34;
relativeURLs = true
uglyURLs = true
</code></pre><p>Obviously baseURL and title should be appropriate for your blog. If you’re installed a different theme than newsroom, then set that as the theme instead (if and when you play around with themes in future, you just need to switch the theme in this config file and rebuild the site; remember my caveat above, though). Read about the <a href="https://gohugo.io/content-management/urls/">relative and ugly url settings here</a>. I’ve found that this combination works best for running both in local mode and on an actual published site, and that the defaults lead to confusing behavior. You can experiment with them later.</p>

<p>Next, we’re going to initialize a git repository locally (meaning: we’re going to tell git to start tracking your blog files), and then use git to upload the repository to Github. In a few moments we’ll wire up Cloudflare to detect whenever you upload changes to Github, which will trigger their software to publish your blog.</p>
<pre><code># still in your blog folder 

git init
git add *
git status     # show what&#39;s &#34;changed&#34;, which is everything given that this is entirely new
git commit -m &#34;Set up new blog&#34;
</code></pre><p>Now go to <a href="https://www.github.com">Github</a>, and create a new repository, ideally matching the name of your Hugo site. To do this, in Github:</p>
<ul>
<li>New
<ul>
<li>Repository Name: name-of-your-blog</li>
<li>Private</li>
<li>Create Repository</li>
</ul>
</li>
<li>If you know what you’re doing with SSH, use that. Otherwise, click on HTTPS and copy the url, which should look something like <code>https://github.com/yourname/tantalizingsloth.git</code>. I’m going with the HTTPS instructions here to keep the bar low. Paste the url into a text editor for now.
<ul>
<li>If you’re using HTTPS, get a <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">personal access token</a> following the linked instructions (you only need to select the “repo” checkbox). Copy and paste the token, and store it somewhere safe on your computer. You can always make additional tokens, so it’s not the end of the world if you lose it.</li>
</ul>
</li>
</ul>
<p>Back on the command line, enter the following to upload your site to Github:</p>
<pre><code># Replace the url with the HTTPS url you got above
git remote add origin https://github.com/yourname/tantalizingsloth.git
git branch -m main
git push -u origin main 
# enter your personal access token instead of password, when prompted
</code></pre><p>Now if you click back to your Github home page, you’ll see the repository that you just pushed to it. Don’t worry about some of the empty directories not being present; they’ll show up in a few minutes, when we add the first post.</p>

<p>Now we’re going to set up Cloudflare. There’s several components that need to be wired together. This will all work automatically once done, so this is just a one time setup. Lots of clicking, but nothing here is too hairy.</p>
<h2 id="4a-create-a-cloudflare-website">4a. Create a Cloudflare Website</h2>
<p>Click on Websites. If you registered your domain with Cloudflare, then you should see your site listed, and you can move on to the next step. If you registered your domain elsewhere, click on Add a Site, and follow the instructions to configure your domain registrar to point at Cloudflare.</p>
<h2 id="4b-create-a-cloudflare-page-for-your-blog">4b. Create a Cloudflare “Page” For Your Blog</h2>
<p>This is a little confusing. On Cloudflare, Websites are roughly equivalent to domains. <em>Pages</em> are where websites are actually hosted. Hopefully Cloudflare can make these less separate in future.</p>
<p>Follow these steps in Cloudflare:</p>
<ul>
<li>Back to Cloudflare home</li>
<li>Pages</li>
<li>Create a Project
<ul>
<li>Github</li>
<li>Add Account</li>
<li>If you don’t see your repository listed, click on the Cloudflare Pages link near the bottom of the form (we made the repository “Private”, so Cloudflare can’t see it yet). This will take you to Github
<ul>
<li>Under “Only Select Repositories”, choose your repository</li>
<li>Save</li>
<li>There’s a bug here in that when you click “Save” in Github, it takes you back to Cloudflare home. However, the form that you were previously filling out in Cloudflare is in a different browser tab. Click back to that tab, and you should see the repository list refresh to include the one you just authorized. If you get lost here, just go back to the starting point of 4b, and you should see the repository listed this time around.</li>
</ul>
</li>
<li>Click on your repository</li>
<li>Begin Setup - this will take you to a new screen</li>
</ul>
</li>
<li>On the <em>Set up builds and deployments</em> screen:
<ul>
<li>Leave Project Name and Production Branch as they are</li>
<li>Framework Preset - none (you might be tempted to select “Hugo” here, but Cloudflare only supports a subset of Hugo themes; we’re going to build the blog locally and just push raw HTML each time, which will give us freedom to try whatever themes we like)</li>
<li>Build command - leave blank</li>
<li>Build output directory - <code>public</code> (this is telling Cloudflare where to look in the git repository for your website content)</li>
<li>Save and Deploy</li>
</ul>
</li>
</ul>
<p>Ignore the build that kicks off. It’s not going to be super useful for now.</p>
<h2 id="4c-associate-pages-with-your-domain">4c. Associate “Pages” With Your Domain</h2>
<p>Finally we connect Websites and Pages within Cloudflare.</p>
<ul>
<li>Back to Cloudflare home</li>
<li>Pages</li>
<li>Select your project</li>
<li>Custom Domains</li>
<li>Set up a Custom Domain
<ul>
<li>Domain - enter the domain name that you registered (e.g. “tantalizingsloth.win”)</li>
<li>If you’re using an external registrar, follow the instructions Cloudflare gives you; otherwise click Activate Domain</li>
<li>After submitting the form, sometimes it lands on the wrong state; if so, refresh the page</li>
<li>After a few moments, the domain should change to “Active” (this will take longer if you’re using an external registrar)</li>
</ul>
</li>
</ul>
<p>Congratulations! Give yourself a high five. We’re done with all of the setup. Let’s go create an actual blog post!</p>
<p><img src="https://smaller.fish/images/highfive.gif" alt="High Five"/></p>

<p>For the sake of example, my first post is going to have files based around the name <em>greatsloth</em> - purely as an organizational tool. Swap this out for whatever makes sense for your needs. I like to keep the name of the text file related to the names of the images that are in the blog post, just to make it easier to manage them in future (in case, for example, I wanted to take the blog post down and remove associated images.)</p>
<h2 id="5a-get-one-or-more-images-for-your-post">5a. Get One or More Images For Your Post</h2>
<p>First, find some images that you want to use in the post, and move them to the folder where Hugo expects images to live, i.e. <code>static/images</code>. You can use subdirectories to keep organized - just be sure to adjust urls in the steps below, if you do. (Of course you can add more images while you’re writing the post too.)</p>
<pre><code>mv ~/Downloads/sloth.jpg static/images/greatsloth1.jpg
mv ~/Downloads/bear.jpg static/images/greatsloth2.jpg
</code></pre><h2 id="5b-start-up-hugo-in-preview-mode">5b. Start Up Hugo in “Preview Mode”</h2>
<p>We’re going to start Hugo so that you can preview your site as you make edits. Leave this running while your write your post.</p>
<pre><code>hugo server -D
</code></pre><h2 id="5c-create-and-write-a-post">5c. Create and Write a Post</h2>
<p>This command creates a file for you to write in, inside the <code>content/posts</code> folder. In a new terminal window (and having navigated to the blog directory) run:</p>
<pre><code>hugo new posts/greatsloth.md
</code></pre><p>Open a text (or markdown) editor on <code>content/posts/greatsloth.md</code>. First we’re going to change the properties of the post (note that Hugo made most of these already for you):</p>
<pre><code>---
title: &#34;This was a great sloth&#34;
date: 2022-02-13T11:03:27-06:00
draft: false
image: greatsloth1.jpg
tags:
  - sloth
  - bear
---
</code></pre><p>Now open a browser tab on <a href="http://localhost:1313">http://localhost:1313</a> and you should see your post listed. Progress!</p>
<p>Go back to your text editor and write below the header (i.e. at the bottom, under the last three dashes):</p>
<pre><code># Great Sloths

This sloth was _truly_ great. I admire her.

[Find Out More](https://lmddgtfy.net/?q=great%20sloth)

## Compared to Bears

![A Bear](/images/greatsloth2.jpg)

This is a bear. It&#39;s not as good as a sloth.
</code></pre><p>Refresh your browser to see what this did. You’ll write your posts using <a href="https://hugoloveit.com/basic-markdown-syntax/">markdown</a>; I’ve used a few of the features you’ll probably want to use the most as quick examples. Compare what you see in your browser vs the syntax above.</p>
<h2 id="5d-building-and-publishing-the-site">5d. Building and Publishing The Site</h2>
<p>Keep working on your post until you’re happy with it. Once you’re done, we’re now going to publish the site to the world.</p>
<p>To start, first build the site:</p>
<pre><code>hugo   
</code></pre><p>This builds a <em>static</em> version of your site inside the <code>public</code> folder - i.e. it renders your posts using the theme that you set up, and creates connecting pages. Run this every time you want to publish, as it’s the content of <code>public</code> that Cloudflare is going to serve from your domain.</p>
<p>Next, push to Github:</p>
<pre><code>git status # optional, but good practice
git add *
git commit -m &#34;A post about sloths&#34;
git push origin main
</code></pre><p>(If you forgot your “personal access token”, go up to section 3 and make a new one, then try the git push command again. If this gets annoying then learn how to use SSH with Github.)</p>
<p>Now you are done. Within around 5 minutes your post will automatically show up on your site.</p>
<p>Just in case you’re not clear on what happened:</p>
<ul>
<li>You built the site locally</li>
<li>You pushed it to Github</li>
<li>Cloudflare noticed that Github had been updated</li>
<li>Cloudflare pulled down the changes</li>
<li>Cloudflare pushed them out to the server(s) your site is served from</li>
</ul>
<p>Pretty nifty, right?</p>
<h2 id="5e-debugging-or-watching-cloudflare-hamsters-work">5e. Debugging (Or Watching Cloudflare Hamsters Work)</h2>
<p>If you want to figure out why something hasn’t posted (or want to watch a new post get published):</p>
<ul>
<li>Back to Cloudflare home</li>
<li>Pages</li>
<li>Click your project</li>
<li>Under All Deployments, you should see a build marked “In Progress” in the Status column</li>
<li>Click “View Build”</li>
<li>Watch the magic happen</li>
</ul>

<p>Browse around under the theme directory to tweak the general layout. Before getting too hacky, read the theme documentation, as they may have suggestions on how to organize changes. If you’re using newsroom, some of the edits you may want to make are:</p>
<ul>
<li><code>layouts/partials/header.html</code> - add third party scripts or includes here</li>
<li><code>assets/sass/_custom.sass</code> - add style overrides here</li>
<li><code>layouts/index.html</code> - if you really want to make fundamental changes, modify logic here</li>
</ul>
<p>Note that if you modify styles, and changes aren’t showing, you need to clear the cache in Cloudflare. You’ll find this under Websites. You may need to shift-f5 in your browser also to skip your browser cache.</p>

<p>Your site isn’t innately tied to Cloudflare. If you want to move from Cloudflare in future (should they turn evil in some way, or you have another provider in mind), you need to facilitate the following:</p>
<ul>
<li>Possibly move your domain registration to a new registrar (if you registered with Cloudflare)</li>
<li>Change your domain to point at the new server (following your provider’s instructions)</li>
<li>Set up a way to publish the content of your “public” directory to the new location. This may not involve automatic detection of git push to Github, so be prepared to set up new wiring for this (possibly something as crude as an FTP upload)</li>
</ul>
<p>You could look at providers like <a href="https://smaller.fish/posts/fly.io">fly.io</a> or <a href="https://fleek.co/">Fleek</a>. You can also configure github to serve your blog directly.</p>
<ul>
  
   <li>
     <a href="https://smaller.fish/tags/tech">tech</a>
   </li>
  
</ul>

    </div>


  </article>

    </div></div>
  </body>
</html>
