<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/IPv6OurPassiveExposure">Original</a>
    <h1>Thinking about our passive exposure to IPv6 issues</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Thinking about our passive exposure to IPv6 issues</h2>

	<p><small>April 24, 2023</small></p>
</div><div><p>Over on the Fediverse, I recently saw <a href="https://infosec.exchange/@IvyMike/110164662305086035">a thought-provoking remark
by Michael Gebis</a>
(<a href="https://mendeddrum.org/@fanf">via</a>):</p>

<blockquote><p>If I were an evil threat actor, I&#39;d be learning as much about #ipv6 as
possible right now.  I&#39;m convinced that many companies that say they
&#34;aren&#39;t using&#34; IPv6 are in reality just ignoring IPv6, and it would
be easy to set up a &#34;shadow network&#34; consisting of IPv6 traffic where
you could get away with murder.  Nobody at the company is logging IPv6
traffic and events, none of the tools are configured to monitor it,
and a large majority of the staff knows nothing about it.</p>

<p>&#34;But we disable IPv6!&#34;</p>

<p>Really?  On your users mobile devices?  On printers?  On random IoT
devices?  And most of all, on your remote user&#39;s networks?  Good luck,
my guy.</p>
</blockquote>

<p>This got me thinking about what I&#39;ll call our passive exposure to
<a href="https://en.wikipedia.org/wiki/IPv6">IPv6</a>. By that I mean whatever
exposure we get from having IPv6 enabled on random devices, and
perhaps automatically configured by systems or deliberately set up
by <a href="https://en.wikipedia.org/wiki/Threat_actor">a threat actor</a>.
For example, could a threat actor use IPv6 to bypass firewall
protections or pass traffic in ways that would be invisible to our
normal monitoring?</p>

<p>So far, <a href="https://support.cs.toronto.edu/">we</a> don&#39;t have IPv6 set
up on any of our networks, and as a result we have no deliberate
IPv6 network to network routing (or public IPv6 address assignment
through any of <a href="https://en.wikipedia.org/wiki/DHCPv6">DHCP6</a>,
<a href="https://en.wikipedia.org/wiki/IPv6#Stateless_address_autoconfiguration_(SLAAC)">SLAAC</a>,
or static assignment). However, as is the way of the world these
days almost all of our servers have IPv6 enabled and they&#39;ve assigned
themselves fe80::/10 <a href="https://en.wikipedia.org/wiki/Link-local_address">link local</a> IPv6 addresses.
It&#39;s likely that people&#39;s desktops, laptops, and mobile devices
have done similarly on the networks where they live. When we look
at general network traffic with tools like <code>tcpdump</code>, we do see a
certain amount of IPv6 traffic trying to happen (using fe80::/10
link local addresses from what I&#39;ve seen).</p>

<p>All of our firewalls explicitly block IPv6 traffic, and our core
router doesn&#39;t have any IPv6 routes (because we have no IPv6
networks). A threat actor that wanted to use plain IPv6 across
network boundaries would have to compromise one or more firewall
rule sets, and getting plain IPv6 routing to the outside world would
be quite complex. However, because we don&#39;t have IPv6 active on our
own networks, we probably wouldn&#39;t notice if a threat actor set up
a DHCP6 or SLAAC server that advertised itself as an IPv6 gateway
to the local network. The attacker would have to tunnel the traffic
in and out through IPv4, but there are various options for that
that we probably wouldn&#39;t notice.</p>

<p>(Our core router might automatically start routing IPv6 traffic
between our public subnets if those subnets started advertising
appropriate IPv6 bits, but I don&#39;t know. However, those subnets can
already reach each other with IPv4, and we&#39;re not doing traffic
monitoring on the core router.)</p>

<p>Machines on internal networks that don&#39;t have port isolation can talk to
each other with IPv6 (using link local addresses or addresses handed out
by a threat actor), but then they can already talk to each other with
IPv4. Machines on <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/CSLabNetworkLayout">port isolated internal networks</a>
should still be port isolated from each other even if they use IPv6, but
I admit we haven&#39;t tested the behavior of our switches to be completely
sure of that.</p>

<p>(Port isolation is theoretically an Ethernet layer thing, not an
IP layer one, but switches are extra smart these days so one is
never entirely sure.)</p>

<p>We mostly don&#39;t use IP filtering on servers themselves, only on
firewalls, so we don&#39;t have to worry about server IP filtering not
being set up for IPv6 (an issue that I once had on my home machine).
Where we do have some IP filtering, it&#39;s in the form of a default
deny with a restricted positive allowance (for example, systemd&#39;s
IP access controls or Apache access controls); this means that using
an IPv6 address to access the service instead of an IPv4 address
wouldn&#39;t bypass access restrictions; you specifically have to have
the right IPv4 IP address.</p>

<p>We handle our DNS ourselves, so compromising our DNS infrastructure
to add IPv6 addresses for some of our services would already be a
pretty bad compromise by itself. We&#39;re no more or less likely to
notice the addition of IPv6 records than we are to notice any other
DNS change that doesn&#39;t visibly and clearly degrade services. I can
imagine that the addition of IPv6 records might be able to do some
damage because it might let an attacker get TLS certificates for
some of our names and intercept the traffic of outside people on
networks with IPv6 support.</p>

<p>(To avoid people noticing the service not working, the attacker
could then send the traffic to the original server via IPv4.)</p>

<p>So on the whole I think we have a low passive exposure to IPv6
issues. A lot of this comes down to the long ago decision to
explicitly block IPv6 traffic on all of our firewalls, even
though we didn&#39;t (and still don&#39;t) have any IPv6 traffic.</p>
</div></div>
  </body>
</html>
