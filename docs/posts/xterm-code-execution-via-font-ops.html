<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.openwall.com/lists/oss-security/2022/11/10/1">Original</a>
    <h1>Xterm code execution via font ops</h1>
    
    <div id="readability-page-1" class="page">







<a href="https://jvns.ca/blog/2022/2022/11/08/2">[&lt;prev]</a> <a href="https://jvns.ca/blog/2022/11/06/making-a-dns-query-in-ruby-from-scratch/2">[next&gt;]</a> <a href="https://jvns.ca/blog/2022/11/06/making-a-dns-query-in-ruby-from-scratch/">[day]</a> <a href="https://jvns.ca/blog/2022/11/06/">[month]</a> <a href="https://jvns.ca/blog/2022/11/">[year]</a> <a href="https://jvns.ca/blog/2022/">[list]</a>
<pre>Date: Thu, 10 Nov 2022 14:42:41 +1100
From: David Leadbeater &lt;dgl@....cx&gt;
To: oss-security@...ts.openwall.com
Subject: CVE-2022-45063: xterm &lt;375 code execution via font ops

xterm before patch 375 can enable an RCE under certain conditions.

Fix:

Upgrade to xterm patch #375
<a href="https://invisible-island.net/xterm/xterm.log.html" rel="nofollow">https://invisible-island.net/xterm/xterm.log.html</a>

Mitigation:

Set this Xresource:
XTerm*allowFontOps: false

Details:

The issue is in the OSC 50 sequence, which is for setting and querying
the font. If a given font does not exist, it is not set, but a query
will return the name that was set. Control characters can&#39;t be
included, but the response string can be terminated with ^G. This
essentially gives us a primitive for echoing text back to the terminal
and ending it with ^G.

It so happens ^G is in Zsh when in vi line editing mode bound to
&#34;list-expand&#34;. Which can run commands as part of the expansion leading
to command execution without pressing enter!

This does mean to exploit this vulnerability the user needs to be
using Zsh in vi line editing mode (usually via $EDITOR having &#34;vi&#34; in
it). While somewhat obscure this is not a totally unknown
configuration.

In that configuration, something like:
printf &#34;\e]50;i\$(touch /tmp/hack-like-its-1999)\a\e]50;?\a&#34; &gt; cve-2022-45063
cat cve-2022-45063  # or another way to deliver this to the victim

Will touch that file. It will leave the line on the user&#39;s screen;
I&#39;ll leave it as an exercise for the reader to use the vi line editing
commands to hide the evidence.

Debian, Red Hat and others disable font ops by default (see some
good foresight at[1] or this very list[2]), but users can re-enable them
via a configuration option or menu. Additionally upstream xterm does
not disable them by default, so some distributions include a
vulnerable default configuration.

This has been assigned CVE-2022-45063.

David


[1]: <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=510030" rel="nofollow">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=510030</a>
[2]: <a href="https://www.openwall.com/lists/oss-security/2015/09/20/2">https://www.openwall.com/lists/oss-security/2015/09/20/2</a> towards the end.
</pre>
<p><a href="http://www.openwall.com/blists/">Powered by blists</a> - <a href="http://lists.openwall.net">more mailing lists</a>


</p><p>
Please check out the
<a href="https://oss-security.openwall.org/wiki/">
Open Source Software Security Wiki</a>, which is counterpart to this
<a href="https://oss-security.openwall.org/wiki/mailing-lists/oss-security">mailing list</a>.
</p><p>
Confused about <a href="https://jvns.ca/lists/">mailing lists</a> and their use?
<a href="https://en.wikipedia.org/wiki/Electronic_mailing_list">Read about mailing lists on Wikipedia</a>
and check out these
<a href="https://www.complang.tuwien.ac.at/anton/mail-news-errors.html">guidelines on proper formatting of your messages</a>.
</p><p>

<a href="https://jvns.ca/Owl/" title="Powered by Openwall GNU/*/Linux - security-enhanced &#34;Linux distribution&#34;"><img src="https://jvns.ca/Owl/artwork/buttons/80x15/Owl-80x15-4.png" width="80" height="15" alt="Powered by Openwall GNU/*/Linux"/></a>
<a href="https://openvz.org" title="Powered by OpenVZ - OS virtualization solution for Linux"><img src="https://jvns.ca/images/OpenVZ-80x15-cd.png" width="80" height="15" alt="Powered by OpenVZ"/></a>





</p></div>
  </body>
</html>
