<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://eclecticlight.co/2022/03/31/what-is-triald-and-why-is-it-taking-so-much-disk-space/">Original</a>
    <h1>What is triald and why is it taking so much disk space?</h1>
    
    <div id="readability-page-1" class="page"><article id="post-64665">
	
	<!-- .entry-header -->

	
		<div data-first_letter="O">
		<p>Over the last year or so Mac users have run into problems that appear related to a background service named <code>triald</code>. Some report it stealing huge amounts of CPU, others associate it with various glitches, and a few have noticed gigabytes of disk space apparently being taken up by its folder at ~/Library/Trial, and in their Time Machine backups. This article explains as much as I know about this mysterious new service, and ponders what’s going on.</p>
<p>Trial, as I’ll refer to it, was introduced to macOS in Big Sur, when it appeared in three new private frameworks named Trial, TrialProto and TrialServer. At that time it was version 1.0, with a build number of 174.4 in macOS 11.0.1, and the latter has since risen to 292.18 in Monterey 12.3. In addition to those private frameworks, there are three essential components:</p>
<ul>
<li>the background service /usr/libexec/triald</li>
<li>an XPC service TrialArchivingService.xpc contained in TrialServer.framework</li>
<li>a launch agent /System/Library/LaunchAgents/com.apple.triald.plist.</li>
</ul>
<p>Note that all these are on the SSV, therefore can’t be tampered with in any way. The high build number of the version first shipped in Big Sur suggests that Trial may have already been included in iOS, and it’s listed on some iOS sites as being present, with the suggestion that it has something to do with “Apple A/B testing”.</p>
<p><strong>Storage</strong></p>
<p>After a user Home folder has been created, Trial normally creates its own root directory at ~/Library/Trial, which contains folders of NamespaceDescriptors, Treatments, and an SQLite database in the folder v6 named trialdb.db. None of these appears specially protected, although each folder is a warren of sub-folders which makes extracting information from them very difficult. The Trial root directory can readily occupy substantial amounts of disk space: on my production Mac, it appears to contain 1.47 GB in 148,618 items, which is a hefty chunk in backups. Even on a lightly used Mac, it may amount to more than 1 GB and over 300,000 items. However, most of those may be symbolic links, and its real size may thus be considerably less.</p>
<p>This Trial root directory isn’t included in the standard Time Machine exclusions, so unless explicitly added to the user’s exclusion list, it will normally be backed up automatically with the rest of the contents of the Home folder.</p>
<p><strong>Activation and activity</strong></p>
<p>It has been suggested that Trial is only activated on Macs which have been enrolled in Apple’s beta programmes. I don’t think that’s correct, as my production Mac has never been so enrolled, nor has my M1 Pro MBP, but both are active Trial participants. I’m not aware of any control over or opt-out from Trial, although it could be covered in Apple’s general request to share data including panic logs, if you can remember where to control that.</p>
<p>I first noticed Trial when studying Visual Look Up in the log. At the start of each Look Up, the subsystem com.apple.trial enters the following into the log:</p>
<p>Otherwise Trial is most active in the log when a Mac isn’t in use, but isn’t asleep. Its activities are normally scheduled and dispatched through the DAS-CTS mechanism, and on M1 series Macs run exclusively on their E cores. In addition to what appear to be opportunistic periods during the day, Trial undertakes its most extensive maintenance activity at 0330 daily. Log excerpts detailing active sesssions are provided in the Appendix at the end.</p>
<p>Trial (<code>triald</code>) has CloudKit entitlements, and often communicates over CloudKit, from where it appears to get Experiments, and to upload its data. I have so far been unable to discover whether it has any dedicated container, though.</p>
<p>Intense maintenance periods can occur in the small hours of the morning, in my case 0330, or soon after starting the Mac up if it’s not left on for long periods. These include maintenance on the Trial root directory, CloudKit access, and checking for the availability of new Experiments, which appear to be rolled out through iCloud. Each Experiment appears to have its own history, maintained by Trial.</p>
<p><strong>Investigation</strong></p>
<p>Trial is very visible in the Unified log, even if its entries are cryptic and full of &lt;private&gt;. The two key subsystems to include in predicates are com.apple.trial and com.apple.triald, and they can usefully be extended by processes containing trial.</p>
<p>With limited understanding of Trial, it’s hard to guess the best approaches to dealing with problems. Users who have tried killing <code>triald</code> have inevitably discovered how quickly it’s restarted, and deleting its root directory in ~/Library/Trial also results in its reappearance. For the time being, the most attractive approach is to restart in Safe mode, wait a couple of minutes, and restart back in normal mode. If you want to try deleting its root directory, that too would appear to be safest in Safe mode.</p>
<p><strong>Conclusions</strong></p>
<ul>
<li>Trial is a new and hitherto undocumented service introduced in Big Sur.</li>
<li>Although problems with Trial aren’t common, they do occur, and without any documentation they can be mystifying.</li>
<li>Trial appears primarily concerned with gathering data from Experiments distributed via CloudKit. These notably include ML features such as Visual Look Up.</li>
<li>Although there’s no indication that Trial gathers or uploads sensitive data, its root directory at ~/Library/Trial is unprotected and its activities are opaque. While Apple presumably considers those activities and use of data fall within its existing policies, suspicious users may presume the worst. Silence only fuels suspicion and rumour.</li>
<li>Trial’s root directory at ~/Library/Trial should be added routinely to all backup exclusion lists. Apple should add it to Time Machine’s system exclusions at the earliest opportunity.</li>
<li>Trial’s periods of intense maintenance normally occur when the user isn’t present. If they are started soon after startup or when the user is active, they can cause concern. This needs to be addressed, at least by informing users.</li>
<li>Apple needs to come clean and explain Trial properly.</li>
</ul>
<p><strong>Appendix: Log excerpts</strong></p>
<p>Entries from a short session occurring with the Mac quiet during the day, showing involvement with CloudKit:</p>
<p><code>com.apple.triald TrialServer Enqueueing eligible task &lt;TRIFetchMultipleExperimentNotificationsTask:(null)&gt; [tid:9719]</code></p>
<p>When sleep is disabled, these are short excerpts from copious entries made during Trial Maintenance performed at 0330:</p>
<p><code>com.apple.triald triald TrialServer Enqueueing eligible task &lt;TRIRolloutTargetingTask:61af99aeda72d16a4beb7756.240000067&gt; [tid:9735]</code></p>
<p><code>com.apple.triald triald TrialServer [LOCK_SH] GC scan found 0 live symlinks into reference-managed directory: /Users/hoakley/Library/Trial/NamespaceDescriptors/v2/rolloutV2/61301e3a61217b3110231469/240000016</code></p>
<p><code>com.apple.triald triald TrialServer Garbage collection for asset store /Users/hoakley/Library/Trial/v6/AssetStore removed 2 assets.</code></p>
	</div><!-- .entry-content -->

	
	<!-- .entry-footer -->

</article></div>
  </body>
</html>
