<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/compiler-devel/llvm-project/commit/cfd497fadb8bae4c5428f40ea50cfc760649afa4">Original</a>
    <h1>Show HN: Modifying Clang for a Safer, More Explicit C&#43;&#43;</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p><a href="https://github.com/compiler-devel/llvm-project/tree/cfd497fadb8bae4c5428f40ea50cfc760649afa4" title="Browse the repository at this point in the history" rel="nofollow">Browse files</a>

    <span>
    </span></p><p>
      Modified C++
    </p>

    <div><pre>Inspired by the paper &#34;Some Were Meant for C&#34; by Stephen Kell, I decided
to show that it&#39;s possible to iterate C++ to be safer, more explicit,
and less error-prone.

Here&#39;s a possible starting point: I didn&#39;t invent a new language or
compiler, but took the world&#39;s best compiler, clang, and modified it
to begin iterating towards a new furture of C++. Naming things is hard,
so I call this &#39;Modified C++&#39;. Some of the following could be implemented
as tooling in a linter or checker, but the idea is to update the compiler
directly. I also wanted to learn more about clang. This compiler needs a
flag to enable/disable this functionality so that existing library code
can be used with a &#39;diagnostic ignored&#39; pragma.

You can build clang using the normal non-bootstrap process and you&#39;ll
be left with a clang that compiles C++ but with the following modifications:

 - All basic types (excluding pointers and references) are const by
 default and may be marked &#39;mutable&#39; to allow them to be changed after
 declaration
 - Lambda capture lists must be explicit (no [&amp;] or [=], by themselves)
 - Braces are required for conditional statements, case and default
 statements within switches, and loops
 - Implicit conversions to bool are prohibited (e.g., pointers must be
 compared against nullptr/NULL)
 - No goto support
 - Explicit &#39;rule of six&#39; for classes must be programmer-implemented
 (default, copy, and move c&#39;tors, copy and move assignment, d&#39;tor)
 - No C style casts

Here&#39;s an example program that&#39;s valid in Modified C++:

mutable int main(int, char**)
{
  mutable int x = 0;
  return x;
}

Here&#39;s another that will fail to compile:

mutable int main(int, char**)
{
  int x = 1;
  x = 0;  // x is constant
  return x;
}

I&#39;d like your feedback. Future changes I&#39;m thinking about are:
 - feature flag for modified c++ to enable/disable with &#39;diagnostic ignored&#39;
 pragma, to support existing headers and libraries
 - support enum classes only
 - constructor declarations are explicit by default
 - namespaces within classes
 - normalize lambda and free function syntax
 - your ideas here</pre></div>

  <div>
  <include-fragment src="/compiler-devel/llvm-project/branch_commits/cfd497fadb8bae4c5428f40ea50cfc760649afa4" id="async-branches-list">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path fill-rule="evenodd" d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"></path>
</svg>
    <ul>
      <li>Loading branch information<span></span></li>
    </ul>
</include-fragment></div>


  
</div></div>
  </body>
</html>
