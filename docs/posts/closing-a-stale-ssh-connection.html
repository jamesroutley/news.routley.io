<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://davidisaksson.dev/posts/closing-stale-ssh-connections/">Original</a>
    <h1>Closing a stale SSH connection</h1>
    
    <div id="readability-page-1" class="page"><div><article><div><p>Suppose you’re connected to a remote host with SSH and after a while the SSH
session goes stale. The terminal is unresponsive and no keypress seem to take
effect. There might be something with the network, the remote host is
restarting or maybe your machine has been in hibernation, there could be
multiple reasons for a stale session.</p><p>The first solution that might come to mind is to just close the terminal
emulator and create another one, but <strong>there is a better way</strong>.</p><h2 id="ssh-escape-sequences">SSH escape sequences</h2><p>Before I show the trick we take a quick detour and explore a kind of hidden
feature that is implemented in many of the available SSH clients.</p><p>Built in to the SSH client are multiple hidden commands that can be triggered
with a so called <em>escape sequence</em>. These commands can be access by a
combination of the tilde prefix (<code>~</code>) followed by the command.</p><p>For example <code>~?</code> print the help message containing all of the supported escape
sequences:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>david@remote-host:~$ ~?
</span></span><span><span>Supported escape sequences:
</span></span><span><span> ~.   - terminate session
</span></span><span><span> ~B   - send a BREAK to the remote system
</span></span><span><span> ~R   - request rekey
</span></span><span><span> ~#   - list forwarded connections
</span></span><span><span> ~?   - this message
</span></span><span><span> ~~   - send the escape character by typing it twice
</span></span><span><span><span>(</span>Note that escapes are only recognized immediately after newline.<span>)</span>
</span></span></code></pre></div><p>Pay extra attention to the last line;</p><blockquote><p><em>(Note that escapes are only recognized immediately after <strong>newline</strong>.)</em></p></blockquote><p>This means that for the escape sequence to take effect a preceding newline is
required.</p><p>Also, a small note for people using a keyboard with a <strong>nordic layout</strong>; To
type the tilde character, press <code>AltGr+^ &lt;Space&gt;</code>. I know that this tripped me
up when I first learned about escape sequences.</p><h3 id="the-terminate-session-escape-sequence">The “terminate session” escape sequence</h3><p>So, back to the initial problem.</p><p>As the help message stated above we can close the session with <code>~.</code>. And
remember, press enter a couple of times before initiating the sequence:</p><div><pre tabindex="0"><code data-lang="bash"><span><span>david@remote-host:~$ ~.
</span></span><span><span>david@remote-host:~$ Shared connection to remote-host.davidisaksson.dev closed.
</span></span><span><span>david@local:~$ echo $?
</span></span><span><span><span>255</span>
</span></span></code></pre></div><p>From here we can try to initiate the connection again, or just reuse the terminal.</p><hr/><p><a href="https://news.ycombinator.com/item?id=35504402" target="_blank"><img src="https://davidisaksson.dev/img/hn.png" alt="Hacker News"/>
<span>Discuss on Hacker News</span></a></p></div></article></div></div>
  </body>
</html>
