<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://erikarow.land/notes/esgleam-embed">Original</a>
    <h1>Embedding Gleam in my blog with esgleam</h1>
    
    <div id="readability-page-1" class="page"><section id="Embedding-Gleam-in-my-blog-with-esgleam">

<p>Previously in <a href="https://github.com/notes/gleam-vite">Embedding Gleam in my blog with Vite</a>, I used the <code>vite-gleam</code> plugin to bundle my compiled Gleam JS and embed it into my blog. Since then, the creator of the <code>vite-gleam</code> plugin has created <a href="https://hexdocs.pm/esgleam/index.html"><code>esgleam</code></a><label for="fn1"></label><span><span>As of the time of writing, the most recent version of <code>esgleam</code> is 0.3.0.</span></span> which allows me to bundle my Gleam JS without needing Node installed.</p>
<p><code>esgleam</code> downloads <code>esbuild</code> as a pre-built executable which acts as a bundler for my project’s javascript.</p>
<p>I explained in detail how the Gleam application works in my <a href="https://github.com/notes/gleam-vite">previous article</a>, so I will focus on how <code>esgleam</code> makes it easier for me to deploy here.</p>
<section id="esgleam">
<h2><code>esgleam</code></h2>
<p>Adding <code>esgleam</code> to my <code>shiny_counter</code> project was simple:</p>
<pre><code>gleam add esgleam
</code></pre>
<p>I could then run <code>esgleam/install</code> to download the <code>esbuild</code> executable:</p>
<pre><code>gleam run -m esgleam/install
</code></pre>
<p>And then bundling the <code>shiny_counter</code> Javascript was simple:</p>
<pre><code>gleam run -m esgleam/bundle
</code></pre>
<p>By default <code>esgleam</code> finds my <code>src/shiny_counter.gleam</code> and turns it into <code>dist/shiny_counter.js</code>.<label for="fn2"></label><span><span>I found that the defaults were perfect for my needs, but <code>esgleam</code> has an <a href="https://hexdocs.pm/esgleam/index.html">Advanced Usage</a> which allows for specific customization of the bundling process.</span></span></p>
<p>That was all I needed to do to bundle the Javascript for my project. Then all I needed were a few more steps to embed the Javascript in my project:</p>
</section>
<section id="Embedding-the-Javascript">
<h2>Embedding the Javascript</h2>
<p>I then copied the <code>shiny_counter.js</code> to my static sites assets folder. Unlike when I bundled with <code>vite</code>, I didn’t have a <code>main.js</code> that enabled the listener for the project, so I need to that manually here:<label for="fn3"></label><span><span>As a reminder, the <code>gleam_example</code> is a custom attribute which <code>shiny_counter</code> is using a CSS selector to find and mount the Lustre application to.</span></span></p>
<pre><code>```=html
&lt;div style=&#34;border: 1px solid&#34;&gt;
  &lt;div gleam_example&gt;
  &lt;script type=&#34;module&#34;&gt; 
  import { main } from &#39;/assets/shiny_counter.js&#39;

  document.addEventListener(&#34;DOMContentLoaded&#34;, () =&gt; {
    const dispatch = main({});
  });
  &lt;/script&gt;
  &lt;/div&gt;
&lt;/div&gt;
```
</code></pre>
<p>Which works!<label for="fn4"></label><span><span>Thanks to <a href="https://github.com/Enderchief">Enderchief</a> for creating <code>esgleam</code> to simplify the deployment story for Gleam browser Javascript!</span></span></p>

</section>
</section></div>
  </body>
</html>
