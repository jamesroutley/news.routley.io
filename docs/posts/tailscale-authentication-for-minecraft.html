<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tailscale.com/blog/tailscale-auth-minecraft/">Original</a>
    <h1>Tailscale Authentication for Minecraft</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p>You can do many things with computers. Some of them are more productive than
others. My recent blog post shows how to authenticate to any service, such as
<a href="https://tailscale.com/blog/grafana-auth/">Grafana</a>.
Some people took the idea of using Tailscale for authenticating to any service
as a neat fact. Others took this as a challenge to come up with even more
creative applications of Tailscale for authentication. This is the story of one
of the latter cases. This is how you can make your Minecraft server join your
tailnet and authenticate to it with Tailscale.</p>
<p>One big question you may be asking is, “why on earth would you want to do this?”
I would like to counter this with another question: “why not?” As <a href="https://en.wikipedia.org/wiki/Cave_Johnson_(Portal)">a great
man</a> has said, “science
isn’t about ‘why?’ it’s about ‘why not?’” We take this philosophy seriously at
Tailscale.</p>
<p>Putting your Minecraft server into your tailnet with Tailscale for
authentication gives you these advantages:</p>
<ul>
<li>You can lock down your Minecraft server to just your tailnet so only people
you know can access it.</li>
<li>You can use <a href="https://tailscale.com/kb/1018/acls/">ACLs</a> to lock down access
even further (if you want to allow everyone but the known griefer to connect).</li>
<li>You can attribute Minecraft users to Tailscale users to allow you to keep a
better log of who is using the server.</li>
<li>You do not have to modify your Minecraft server with Forge, Bukkit, Paper or
Spigot mods, this allows you to use a fully vanilla setup with very little
extra configuration.</li>
<li>You can use <a href="https://tailscale.com/kb/1084/sharing/">Node Sharing</a> to add your
friends, compatriots in blood, and squadmates to your Minecraft server without
having to expose it to the scary internet. You can also expose it to your
hopefully less scary friends that are on your tailnet already.</li>
<li>Your Minecraft server will show up on your tailnet like any other machine.</li>
</ul>
<p>This also comes with a fairly large set of disadvantages too:</p>
<ul>
<li>This will not work with the Bedrock version of Minecraft (the one that runs on
consoles, phones, and tablets). If you are unsure what version of Minecraft
you have, check
<a href="https://funcaptains.com/blog/java-or-bedrock-what-minecraft-version-do-i-have">here</a>
to learn how to tell the difference between the two.</li>
<li>You have to disable the Minecraft server’s authentication stack.
<ul>
<li>If your server listens on the public internet, this will allow anyone to
join it without validating who they are. This is the opposite of what we
want here.</li>
</ul>
</li>
<li>You can’t use Minecraft <a href="https://help.minecraft.net/hc/en-us/articles/4408894664461-Minecraft-Java-Edition-Skins">skins</a>.
<ul>
<li>You may be able to work around this by using server side mods, but those
are out of scope for this article as we are focused on using unmodded
Minecraft clients and servers.</li>
</ul>
</li>
<li>Your tailscale username may have <a href="https://help.minecraft.net/hc/en-us/articles/4408950195341-Minecraft-Java-Edition-Username-VS-Gamertag-FAQ">characters that are
invalid</a>
in Minecraft usernames.
<ul>
<li>Use a different email address to work around this in the worst case.</li>
</ul>
</li>
</ul>
<p>This works by creating an authentication proxy much like 
<a href="https://tailscale.com/blog/grafana-auth/">we did before with Grafana</a>. The
proxy will listen for traffic on your tailnet and then forward it to the
Minecraft server with one notable exception. At the beginning of a Minecraft
session, the client will send the server a packet that contains the username of
the person trying to log in.</p>
<p>Normally the server is supposed to take the contents of that packet and check it
against Mojang authentication servers to ensure that you are actually logged in
as that username in your Minecraft launcher. The server will then allow or deny
the connection based on the result. Instead of relying on Mojang for
authentication, by using Tailscale we can rely on Tailscale for authentication.
If we also had Mojang for authentication, the proxy will look up Tailscale
identity information for that Minecraft session and replace the Minecraft
username the client gave you with the user information from Tailscale - but
Mojang’s authentication servers will have no idea what to do with this. We just
bypass them with offline mode in Minecraft, which does not require any
authentication.</p>
<p>After the authentication dance, the proxy will forward Minecraft traffic like
any other proxy. Then you can mine and craft to your heart’s content with the
people you trust. You will be able to chat with your coworkers and create great
things together.</p>
<h2 id="setup">Setup</h2>
<p>If you want to set up this on your tailnet, you will need to use the <a href="https://github.com/tjhorner/infrared/commit/202226ef19cd5ee7ca7f8dbfa5c59d67d98db2bc">patched version of
the
proxy</a>
<a href="https://github.com/haveachin/infrared">infrared</a>. Infrared is normally used by
Minecraft server networks to host giant Minecraft servers that can scale up to
thousands of total players at once, but it’s also generic enough that we can use
it to proxy to a simple vanilla Minecraft server.</p>
<p>Set up everything as you would normally with infrared, but be sure to set the
environment variable <code>TS_AUTHKEY</code> to <a href="https://login.tailscale.com/admin/settings/keys">a brand new
authkey</a>. If you tag the key,
your Minecraft server’s node key <a href="https://tailscale.com/blog/tagged-key-expiry/">will not
expire</a>, so it stays connected to
your tailnet, allowing you to craft and mine forever!</p>
<p>Something to keep in mind is that infrared will want you to connect with the
full domain name of the Minecraft server. It is very picky about this. We will
use the <a href="https://tailscale.com/kb/1081/magicdns/">MagicDNS domain</a> that every
tailnet gets for free. Assuming your Minecraft server is on port 25565, copy the
following into <code>configs/tailscale.json</code>:</p>
<div><pre tabindex="0"><code data-lang="json"><span><span><span>{</span>
</span></span><span><span>  <span>&#34;domainName&#34;</span><span>:</span> <span>&#34;minecraft-proxy.$your-account-domain-name.beta.tailscale.net&#34;</span><span>,</span>
</span></span><span><span>  <span>&#34;listenTo&#34;</span><span>:</span> <span>&#34;:25565&#34;</span><span>,</span>
</span></span><span><span>  <span>&#34;proxyTo&#34;</span><span>:</span> <span>&#34;127.0.0.1:25565&#34;</span>
</span></span><span><span><span>}</span>
</span></span></code></pre></div><p>You can find this domain out by going to <a href="https://login.tailscale.com/admin/dns">the DNS settings
page</a> and looking for the domain that
ends in <code>.beta.tailscale.net</code> - it should be your account’s domain followed by
<code>.beta.tailscale.net</code>. Add <code>minecraft-proxy.</code> at the beginning of this to get
your full domain name.</p>
<pre tabindex="0"><code>minecraft-proxy.$your-account-domain-name.beta.tailscale.net
</code></pre><p>Be sure to set <code>server-ip</code> to <code>127.0.0.1</code> and <code>server-port</code> to <code>25565</code> in your
<code>server.properties</code> file so that it’s not listening on the public internet:</p>
<pre tabindex="0"><code data-lang="properties">server-ip=127.0.0.1
server-port=25565
</code></pre><p>If you have other inventive ideas for things we can do with computers, reach out
to us on Twitter <a href="https://twitter.com/Tailscale">@Tailscale</a> or head to <a href="https://forum.tailscale.com/">our
forum</a> to tell us the horrors beyond description
that you have created.</p>
<p>The forging of this beautiful creation was thanks to the efforts of <a href="https://tjhorner.dev/">TJ
Horner</a>. I hope this was enlightening.</p>

    </div></div>
  </body>
</html>
