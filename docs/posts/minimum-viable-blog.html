<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ostwilkens.se/blog/setting-up-blog">Original</a>
    <h1>Minimum Viable Blog</h1>
    
    <div id="readability-page-1" class="page"><div>
<pre><span></span><code><span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;</span><span>html</span> <span>lang</span><span>=</span><span>&#34;en&#34;</span><span>&gt;</span>

<span>&lt;</span><span>head</span><span>&gt;</span>
    <span>&lt;</span><span>meta</span> <span>charset</span><span>=</span><span>&#34;UTF-8&#34;</span> <span>/&gt;</span>
    <span>&lt;</span><span>meta</span> <span>name</span><span>=</span><span>&#34;viewport&#34;</span> <span>content</span><span>=</span><span>&#34;width=device-width, initial-scale=1.0&#34;</span> <span>/&gt;</span>
    <span>&lt;</span><span>title</span><span>&gt;</span>Carl Öst Wilkens&#39; Blog<span>&lt;/</span><span>title</span><span>&gt;</span>
    <span>&lt;</span><span>style</span><span>&gt;</span>
<span>        </span><span>:</span><span>root</span><span> </span><span>{</span>
<span>            </span><span>color-scheme</span><span>:</span><span> </span><span>light</span><span> </span><span>dark</span><span>;</span>
<span>        </span><span>}</span>
<span>        </span><span>html</span><span> </span><span>{</span>
<span>            </span><span>font-family</span><span>:</span><span> </span><span>system-ui</span><span>,</span><span> </span><span>sans-serif</span><span>;</span>
<span>            </span><span>max-width</span><span>:</span><span> </span><span>70</span><span>ch</span><span>;</span>
<span>            </span><span>padding</span><span>:</span><span> </span><span>3</span><span>em</span><span> </span><span>1</span><span>em</span><span>;</span>
<span>            </span><span>margin</span><span>:</span><span> </span><span>auto</span><span>;</span>
<span>            </span><span>line-height</span><span>:</span><span> </span><span>1.5</span><span>;</span>
<span>            </span><span>font-size</span><span>:</span><span> </span><span>1.25</span><span>em</span><span>;</span>
<span>        </span><span>}</span>
<span>    </span><span>&lt;/</span><span>style</span><span>&gt;</span>
<span>&lt;/</span><span>head</span><span>&gt;</span>

<span>&lt;</span><span>body</span><span>&gt;</span>
    <span>&lt;</span><span>a</span> <span>href</span><span>=</span><span>&#34;/&#34;</span> <span>id</span><span>=</span><span>&#34;head-link&#34;</span><span>&gt;</span>Carl Öst Wilkens&#39; Blog<span>&lt;/</span><span>a</span><span>&gt;</span>
    {{ content }}
<span>&lt;/</span><span>body</span><span>&gt;</span>

<span>&lt;/</span><span>html</span><span>&gt;</span>
</code></pre>
</div><div>
<pre><span></span><code><span>import</span><span> </span><span>os</span>
<span>import</span><span> </span><span>markdown2</span>


<span>def</span><span> </span><span>main</span><span>():</span>
    <span># Define the directory containing the Markdown files</span>
    <span>posts_dir</span> <span>=</span> <span>&#39;./posts&#39;</span>
    <span>output_dir</span> <span>=</span> <span>&#39;./blog&#39;</span>

    <span># Read template.html</span>
    <span>with</span> <span>open</span><span>(</span><span>&#34;template.html&#34;</span><span>,</span> <span>&#39;r&#39;</span><span>,</span> <span>encoding</span><span>=</span><span>&#39;utf-8&#39;</span><span>)</span> <span>as</span> <span>file</span><span>:</span>
        <span>template</span> <span>=</span> <span>file</span><span>.</span><span>read</span><span>()</span>

    <span># Create output directory if it doesn&#39;t exist</span>
    <span>os</span><span>.</span><span>makedirs</span><span>(</span><span>output_dir</span><span>,</span> <span>exist_ok</span><span>=</span><span>True</span><span>)</span>

    <span># Iterate over all dirs in the posts directory</span>
    <span>for</span> <span>post_directory</span> <span>in</span> <span>os</span><span>.</span><span>listdir</span><span>(</span><span>posts_dir</span><span>):</span>
        <span>post_code</span> <span>=</span> <span>post_directory</span>

        <span># Construct full file path</span>
        <span>file_path</span> <span>=</span> <span>os</span><span>.</span><span>path</span><span>.</span><span>join</span><span>(</span><span>posts_dir</span><span>,</span> <span>post_directory</span><span>,</span> <span>&#39;eng.md&#39;</span><span>)</span>

        <span># Read the Markdown file</span>
        <span>with</span> <span>open</span><span>(</span><span>file_path</span><span>,</span> <span>&#39;r&#39;</span><span>,</span> <span>encoding</span><span>=</span><span>&#39;utf-8&#39;</span><span>)</span> <span>as</span> <span>file</span><span>:</span>
            <span>md_content</span> <span>=</span> <span>file</span><span>.</span><span>read</span><span>()</span>

        <span># Find first line which contains &#34;# &#34;</span>
        <span>title</span> <span>=</span> <span>md_content</span><span>.</span><span>split</span><span>(</span><span>&#34;# &#34;</span><span>,</span> <span>1</span><span>)</span><span>.</span><span>pop</span><span>(</span><span>1</span><span>)</span><span>.</span><span>split</span><span>(</span><span>&#34;</span><span>\n</span><span>&#34;</span><span>)</span><span>.</span><span>pop</span><span>(</span><span>0</span><span>)</span>

        <span># Convert Markdown to HTML</span>
        <span>html_content</span> <span>=</span> <span>markdown2</span><span>.</span><span>markdown</span><span>(</span><span>md_content</span><span>,</span> <span>extras</span><span>=</span><span>[</span><span>&#39;fenced-code-blocks&#39;</span><span>,</span> <span>&#34;header-ids&#34;</span><span>])</span>
        <span>html_content</span> <span>=</span> <span>html_content</span><span>.</span><span>replace</span><span>(</span><span>&#39;&lt;img src=&#34;&#39;</span><span>,</span> <span>f</span><span>&#39;&lt;img src=&#34;/posts/</span><span>{</span><span>post_code</span><span>}</span><span>/&#39;</span><span>)</span>
        <span>html_content</span> <span>=</span> <span>template</span><span>.</span><span>replace</span><span>(</span><span>&#39;{{ content }}&#39;</span><span>,</span> <span>html_content</span><span>)</span>
        <span>html_content</span> <span>=</span> <span>html_content</span><span>.</span><span>replace</span><span>(</span><span>&#39;Minimum viable blog&#39;</span><span>,</span> <span>title</span><span>)</span>

        <span># Construct HTML file path</span>
        <span>html_filename</span> <span>=</span> <span>post_code</span> <span>+</span> <span>&#39;.html&#39;</span>  <span># Replace .md with .html</span>
        <span>html_path</span> <span>=</span> <span>os</span><span>.</span><span>path</span><span>.</span><span>join</span><span>(</span><span>output_dir</span><span>,</span> <span>html_filename</span><span>)</span>

        <span># Save the HTML file</span>
        <span>with</span> <span>open</span><span>(</span><span>html_path</span><span>,</span> <span>&#39;w&#39;</span><span>,</span> <span>encoding</span><span>=</span><span>&#39;utf-8&#39;</span><span>)</span> <span>as</span> <span>file</span><span>:</span>
            <span>file</span><span>.</span><span>write</span><span>(</span><span>html_content</span><span>)</span>
        <span>print</span><span>(</span><span>f</span><span>&#34;Rendered </span><span>{</span><span>post_code</span><span>}</span><span> to </span><span>{</span><span>html_filename</span><span>}</span><span>&#34;</span><span>)</span>

    <span># Render index.html</span>
    <span>index_html</span> <span>=</span> <span>&#34;&#34;</span>

    <span># Load greetings.md</span>
    <span>with</span> <span>open</span><span>(</span><span>&#34;greetings.md&#34;</span><span>,</span> <span>&#39;r&#39;</span><span>,</span> <span>encoding</span><span>=</span><span>&#39;utf-8&#39;</span><span>)</span> <span>as</span> <span>file</span><span>:</span>
        <span>md_content</span> <span>=</span> <span>file</span><span>.</span><span>read</span><span>()</span>
    <span>index_html</span> <span>=</span> <span>markdown2</span><span>.</span><span>markdown</span><span>(</span><span>md_content</span><span>,</span> <span>extras</span><span>=</span><span>[</span><span>&#39;fenced-code-blocks&#39;</span><span>,</span> <span>&#34;header-ids&#34;</span><span>])</span>

    <span>for</span> <span>post_directory</span> <span>in</span> <span>os</span><span>.</span><span>listdir</span><span>(</span><span>posts_dir</span><span>):</span>
        <span>post_code</span> <span>=</span> <span>post_directory</span>
        <span>file_path</span> <span>=</span> <span>os</span><span>.</span><span>path</span><span>.</span><span>join</span><span>(</span><span>posts_dir</span><span>,</span> <span>post_directory</span><span>,</span> <span>&#39;eng.md&#39;</span><span>)</span>
        <span>with</span> <span>open</span><span>(</span><span>file_path</span><span>,</span> <span>&#39;r&#39;</span><span>,</span> <span>encoding</span><span>=</span><span>&#39;utf-8&#39;</span><span>)</span> <span>as</span> <span>file</span><span>:</span>
            <span>md_content</span> <span>=</span> <span>file</span><span>.</span><span>read</span><span>()</span>
        <span>title</span> <span>=</span> <span>md_content</span><span>.</span><span>split</span><span>(</span><span>&#34;# &#34;</span><span>,</span> <span>1</span><span>)</span><span>.</span><span>pop</span><span>(</span><span>1</span><span>)</span><span>.</span><span>split</span><span>(</span><span>&#34;</span><span>\n</span><span>&#34;</span><span>)</span><span>.</span><span>pop</span><span>(</span><span>0</span><span>)</span>
        <span>index_html</span> <span>+=</span> <span>f</span><span>&#39;&lt;li&gt;&lt;a href=&#34;/blog/</span><span>{</span><span>post_code</span><span>}</span><span>.html&#34;&gt;</span><span>{</span><span>title</span><span>}</span><span>&lt;/a&gt;&lt;/li&gt;&#39;</span>
    <span>index_html</span> <span>=</span> <span>template</span><span>.</span><span>replace</span><span>(</span><span>&#39;{{ content }}&#39;</span><span>,</span> <span>index_html</span><span>)</span>
    <span>index_html</span> <span>=</span> <span>index_html</span><span>.</span><span>replace</span><span>(</span><span>&#39;Minimum viable blog&#39;</span><span>,</span> <span>&#34;Index&#34;</span><span>)</span>
    <span>index_path</span> <span>=</span> <span>&#34;index.html&#34;</span>
    <span>with</span> <span>open</span><span>(</span><span>index_path</span><span>,</span> <span>&#39;w&#39;</span><span>,</span> <span>encoding</span><span>=</span><span>&#39;utf-8&#39;</span><span>)</span> <span>as</span> <span>file</span><span>:</span>
        <span>file</span><span>.</span><span>write</span><span>(</span><span>index_html</span><span>)</span>
    <span>print</span><span>(</span><span>f</span><span>&#34;Rendered index.html&#34;</span><span>)</span>

<span>main</span><span>()</span>
</code></pre>
</div></div>
  </body>
</html>
