<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.scannedinavian.com/how-to-run-haskell-source-files-like-shell-scripts.html">Original</a>
    <h1>How to run Haskell source files like shell scripts</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
	    
	    <p>
    Posted on 2024-11-14
    
</p>

<p><img src="https://www.scannedinavian.com/images/skelkunarstafur.png"/></p>
<p>I have a Haskell source file, I want to set the executable bit and run it like a shell script.</p>
<p>How to do that?</p>

<p>Wikipedia says it’s these two characters: <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29">#!</a> and that’s a vaguely tolerable answer.</p>
<p>There’s a link a bit further down the page to <a href="https://en.wikipedia.org/wiki/Interpreter_directive">interpreter directive</a> and that’s a much better answer in my opinion.</p>
<p>If you’ve done anything with Linux, you’ve probably seen files that have a first line like this: <code>#!/usr/bin/env bash</code></p>
<p>This sucked me into a <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%29#Version_8_improved_shell_scripts">wikipedia rabbit hole</a>, so I will not tell you whether the # character was a comment before #! was used for “run this file by handing it to this other program”.</p>
<p>Anyway, we use a shebang in the two scripts below to pass the Haskell source file to something that will compile and run it.</p>

<p>As long as you have the GHC compiler installed, this is the easy way that doesn’t let you specify package dependencies.</p>
<div id="cb1"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span>#!/usr/bin/env runhaskell</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>main <span>=</span> <span>print</span> <span>&#34;Hello World!&#34;</span></span></code></pre></div>
<p>If you also have cabal installed, this way is nice because you can put package dependencies in the source file (and <a href="https://cabal.readthedocs.io/en/stable/cabal-commands.html#cabal-run">specify compiler version and more</a>).</p>
<div id="cb2"><pre><code><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a> <span>#!/</span>usr<span>/</span>bin<span>/</span>env cabal</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span>{- cabal:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span> build-depends: base</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span>      , hedgehog</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span> -}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a> <span>{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a> <span>module</span> <span>Main</span> <span>where</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a> <span>import</span> <span>Hedgehog</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a> <span>import</span> <span>qualified</span> <span>Hedgehog.Gen</span> <span>as</span> <span>Gen</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a> <span>import</span> <span>qualified</span> <span>Hedgehog.Range</span> <span>as</span> <span>Range</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span> prop_associative_float ::</span> <span>Property</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a> prop_associative_float <span>=</span> property <span>$</span> <span>do</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>   a <span>&lt;-</span> forAll <span>$</span> Gen.float (Range.linearFrac (<span>-</span><span>100</span>) (<span>100</span>))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>   b <span>&lt;-</span> forAll <span>$</span> Gen.float (Range.linearFrac (<span>-</span><span>10000</span>) (<span>10000</span>))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>   c <span>&lt;-</span> forAll <span>$</span> Gen.float (Range.linearFrac <span>5</span> <span>1000000</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>   ((a <span>*</span> b) <span>*</span> c) <span>===</span> (a <span>*</span> (b <span>*</span> c))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span> prop_reflexive ::</span> <span>Property</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a> prop_reflexive <span>=</span> property <span>$</span> <span>do</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>   a <span>&lt;-</span> forAll <span>$</span> Gen.float (Range.linearFrac (<span>-</span><span>100</span>) (<span>100</span>))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>   (a <span>/</span> <span>0</span>) <span>===</span> (a <span>/</span> <span>0</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a> main <span>=</span> <span>do</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>   checkParallel <span>$</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>     <span>Group</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span>&#34;Example&#34;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>[ (<span>&#34;prop_reflexive&#34;</span>, prop_reflexive),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  (<span>&#34;prop_associative_float&#34;</span>, prop_associative_float)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
<p>You can try this yourself by copying the Haskell program above into “Foo.hs” and running <code>chmod u+x ./Foo.hs</code> and then running “./Foo.hs”.</p>
<p>On my system, the very first run takes</p>

<p>I heard from <a href="https://fosstodon.org/@simonmic">Simon Michael</a> that this can break if your installed GHC changes versions and the library no longer matches the API. That makes sense, but I hadn’t thought about it.</p>
<p>The hedgehog script above takes one minute forty seconds on first run! I don’t know why it takes so much time. On later runs it’s less than two seconds, but golly that first run is rough.</p>
<p>Does anyone know how to speed this up?</p>

<p>If you prefer using stack instead of cabal, that <a href="https://docs.haskellstack.org/en/stable/topics/scripts/">works too</a>.</p>

	</div></div>
  </body>
</html>
