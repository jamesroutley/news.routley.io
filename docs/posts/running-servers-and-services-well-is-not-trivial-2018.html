<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/RunningServersNotTrivial">Original</a>
    <h1>Running servers and services well is not trivial (2018)</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Running servers (and services) well is not trivial</h2>

	<p><small>June 22, 2018</small></p>
</div><div><p>It all started with a Reddit comment thread called <a href="https://old.reddit.com/r/programming/comments/8ra7kn/the_mass_exodus_from_github_to_gitlab_10_days/">The &#34;mass
exodus&#34; from Github to GitLab: 10 days later</a>.
In it, someone commented that they didn&#39;t understand why there was
a need for cloud Git services in the first place, since running
your own Git server for your company was easy enough. I think that
part of this view is due to <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/OnPremiseVsOffPremiseApproach">the difference between &#39;on premise&#39;
and &#39;off premise&#39; approaches to environments</a>, but as a sysadmin <a href="https://old.reddit.com/r/programming/comments/8ra7kn/the_mass_exodus_from_github_to_gitlab_10_days/e0pq8bm/">I had a twitchy
reaction to the &#39;it&#39;s easy&#39; part</a>.</p>

<p>These days, it&#39;s often relatively easy to &#39;just set up a server&#39;
or a service, especially if you already work in the cloud. Spin up
a VM or a Docker image, install some stuff, done, right? Well, not
if you want this to be reliable infrastructure. So let&#39;s run down
what you or I would have to do to set up a general equivalent of
Github for internal company use:</p>

<ul><li>Figure out the Git server software you want to use, including
whether you want the full Github experience or a web Git thing
that people in can pull from and push to. Or you could go very
old school and demand that people use SSH logins to a Unix machine
where they do filesystem level git operations, although I&#39;m not
sure that would work well for very long.</li>
<li>Possibly figure out how to configure this Git server software
for your particular requirements, setup, and available other
pieces.</li>
<li>Figure out how you&#39;re going to handle authentication for this
Git service. Do you have a company authentication system? How
will you tie this service to any 2FA that you use (and you probably
want to consider 2FA)?<p>
If you can&#39;t outsource all authentication to some other system in
your company, you&#39;ve just taken on an ongoing maintenance task
of adding, removing, and updating users and groups (and any other
things that have to authenticate to the Git server). Failure to
do this well, or failure to be hooked into other aspects of the
company&#39;s authentication and HR systems, can result in fun things
like fired employees still retaining high-privilege access to
your Git server (ie the company&#39;s Git server). You probably don&#39;t
want that.</p><p>
(Non-integrated authentication causes sufficiently many problems
that <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/DisablingAccountChallenge">it&#39;s featured in a sysadmin test</a>.)</p></li>
<li>Install a &#39;server&#39; to run all of the necessary components on. In
the best case, you use Docker or something that uses Docker images
and there&#39;s a pre-packaged Docker image that you can throw on.
In the worst case, you get to find and install a physical server
for this, including hooking it into any fleet-wide management
systems so that it automatically gets kept up to date on security
patches, and then install a host of un-packaged software from
source (or install random binaries you download from the Internet,
if you feel like doing that).<p>
If you&#39;re using Docker or a VPS in the cloud, don&#39;t forget to
figure out how you&#39;re going to get persistent storage.</p></li>
<li>Figure out how to back up the important data on the system. Even
if you have persistent cloud storage, you want some form of backups
or ability to roll back in time, because sooner or later someone
will accidentally do something destructive to a bit of the system
(eg &#39;oops, I mass-deleted a bunch of open issues by mistake&#39;) and
you&#39;ll need to fix it.<p>
Once you have backups set up, make sure that you&#39;re monitoring them
on an ongoing basis so that you can find out if they break.</p></li>
<li>If your company has continuous integration systems and similar
development automation, or has production servers that pull from
your Git repos (or that get pushed to by them), you&#39;re going to
need to figure out how to connect all of this to the Git server
software. This includes things like how to authenticate various
parties to each other, unless everyone can pull anything from
your Git server.</li>
</ul>

<p>I&#39;m going to generously assume that the system never has performance
problems (which you&#39;d have to troubleshoot) and never experiences
software issues with your chosen Git server and any databases and
the like that it may depend on (which you&#39;d have to troubleshoot
too). Once set up, it stays quietly running in the corner and doesn&#39;t
actively require your attention. This is, shall we say, not always
the experience that you actually get.</p>

<p>(I&#39;m also assuming that you can just get TLS certificates from Let&#39;s
Encrypt and that you know how to do this. Or perhaps the Git server
stuff you picked does this all for you.)</p>

<p>Unfortunately we&#39;re not done, because the world is not a nice place.
Even with the service just working, we still have more things to worry
about:</p>

<ul><li>Figure out how to get notified if there are security issues or
important bugfixes in either the Git server software or the
underlying environment that it runs on. You can be confident
that there will be some, sooner or later.</li>
<li>Even without security problems, someday you&#39;re going to have to
update to a new version of the Git server software. Will it be
fully compatible as a drop-in replacement? If your Git server is
important to your company, you don&#39;t really want to just drop the
new version in and hope for the best; you&#39;re going to have to
spend time building out an environment to test the new version in
(with something like your data).<p>
New versions may require changes to other bits of the system, any
local customizations, or to things you integrated the old version
with. Updates are often a pain but at the same time you have to do
them sooner or later.</p></li>
<li>In general you need to worry about how to secure both the Git
server software and the underlying environment it runs on. The
defaults are not necessarily secure and are not necessarily
appropriate for your company.</li>
<li>You may want to set up some degree of monitoring for things like
disk space usage. If this Git server is important, people will
notice right away if it goes down, but they may not notice in
time if the disk space is just quietly getting closer and closer
to running out because more and more people in the company are
using it for more stuff.</li>
</ul>

<p>If this is something that matters to the company and the company
is more than a few people, it&#39;s also not just &#39;you&#39; (a single person)
who will be looking after the server. The company needs at least a
few people involved so that you can go on vacation or even just get
sick without the company running the risk of the central Git server
that all the developers use just falling over and no one knowing
how to bring it back.</p>

<p>In some environments this Git server will either be exposed to the
Internet (even if it&#39;s only used by company people) or at least
available across multiple &#39;internal network&#39; locations because,
say, your developers are not really on the same network as your
production servers in the cloud. This will likely raise additional
network security issues and perhaps authentication issues. This is
very especially the case if you have to expose this Git service to
the Internet. Mere obscurity and use only by company insiders is
not enough any more these days; there are systems that mass scan
the entire IPv4 Internet and keep world-accessible databases of
what they find. If you have open ports or services, you have problems,
and that means you&#39;re going to have to do the work to close things
down.</p>

<p>Basically all of this applies to pretty much any service, not just
Git. If you want to run a mailer, or an IMAP server, or a web server
hosting a blog or CMS, or a DNS server, or whatever, you will have
to face all of these issues and often more. Under the right
circumstances, the initial setup can appear extremely trivial; you
grab a Docker image, you start it somewhere, you make your internal
DNS point a name to it, and you can call it up in your browser or
otherwise start poking it. But that&#39;s just the start of a long and
tiresome journey to a reliable, secure service that can be sustained
over the long haul and won&#39;t blow up in your face someday.</p>

<p>I&#39;m naturally inclined toward the &#39;on premise&#39; view of things where
we do stuff internally. But all of this is why, if someone approached
me at work about setting up a Github-like service locally, I would
immediately ask &#39;is there some reason we can&#39;t pay Github to do
this for us?&#39; I&#39;m pretty confident that Github&#39;ll do it better, and
<a href="https://utcc.utoronto.ca/~cks/space/blog/tech/UniversitiesSunkStaff">if staff time isn&#39;t free</a> they&#39;ll
probably do it cheaper.</p>

<p>PS: I&#39;ve probably missed some things you&#39;d need to think about and
tackle, which just goes to show how non-trivial this really is.</p>
</div></div>
  </body>
</html>
