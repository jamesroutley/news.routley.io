<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/clemensmanert/fas">Original</a>
    <h1>Show HN: Floating point arithmetic types in C&#43;&#43; for any size and any base</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a href="https://github.com/clemensmanert/fas/actions"><img src="https://github.com/clemensmanert/fas/actions/workflows/cmake-single-platform.yml/badge.svg" alt="Build Status Ubuntu"/></a></p>

<p dir="auto"><em>fas</em> is floating point arithmetic for arbitrary mantissa and exponent
types in <em>modern header-only C++</em>.  It lets you construct various
different float types using template parameters for the mantissa,
exponent and base.</p>
<p dir="auto">The constructed float-types look and fell like a native float/double
for arithmetic operations. Furthermore all methods are performed on
the stack and do not require any heap space.</p>
<p dir="auto"><em>fas</em> is <em>header-only</em>.</p>

<div dir="auto"><h3 tabindex="-1" dir="auto">Choose your desired mantissa and exponent</h3><a id="user-content-choose-your-desired-mantissa-and-exponent" aria-label="Permalink: Choose your desired mantissa and exponent" href="#choose-your-desired-mantissa-and-exponent"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="fas::Float&lt;int16_t, int8_t&gt; f;"><pre>fas::Float&lt;<span>int16_t</span>, <span>int8_t</span>&gt; f;</pre></div>
<p dir="auto">This will result in a float using a signed 16 bit mantissa and a signed 8 bit
exponent.</p>

<p dir="auto">The arithmetical operations are supported using their corresponding operators
<code>+ - * / += -= *= /= ++ --</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="fas::Float&lt;int16_t, int8_t&gt; f1 = 10;
auto f2 = f1;

f2 = -f1;     // =&gt; -10

f2 = f1 + 10; // =&gt; 20
f2 = f1 - f1; // =&gt; 0
f2 = f1 * f1; // =&gt; 100
f2 = f1 / 20; // =&gt; 0.5

f2 += 1;      // =&gt; 1.5
f2 -= 1;      // =&gt; 0.5
f2 *= 2;      // =&gt; 1
f2 /= 2;      // =&gt; 0.5

f1++;         // =&gt; 11
++f1;         // =&gt; 12
f1--;         // =&gt; 11
--f1;         // =&gt; 10"><pre>fas::Float&lt;<span>int16_t</span>, <span>int8_t</span>&gt; f1 = <span>10</span>;
<span>auto</span> f2 = f1;

f2 = -f1;     <span><span>//</span> =&gt; -10</span>

f2 = f1 + <span>10</span>; <span><span>//</span> =&gt; 20</span>
f2 = f1 - f1; <span><span>//</span> =&gt; 0</span>
f2 = f1 * f1; <span><span>//</span> =&gt; 100</span>
f2 = f1 / <span>20</span>; <span><span>//</span> =&gt; 0.5</span>

f2 += <span>1</span>;      <span><span>//</span> =&gt; 1.5</span>
f2 -= <span>1</span>;      <span><span>//</span> =&gt; 0.5</span>
f2 *= <span>2</span>;      <span><span>//</span> =&gt; 1</span>
f2 /= <span>2</span>;      <span><span>//</span> =&gt; 0.5</span>

f1++;         <span><span>//</span> =&gt; 11</span>
++f1;         <span><span>//</span> =&gt; 12</span>
f1--;         <span><span>//</span> =&gt; 11</span>
--f1;         <span><span>//</span> =&gt; 10</span></pre></div>

<p dir="auto">Each type knows its boundaries:</p>
<ul dir="auto">
<li><code>MAX()</code> returns the largest value</li>
<li><code>MIN()</code> returns the smallest positive value</li>
<li><code>LOWEST()</code> returns the smallest value
The naming is the same as with internal float/double.</li>
</ul>
<p dir="auto">There are overloadings for <code>std::numeric_limits</code> available:
<code>fas::Float&lt;int8_t, int8_t&gt;::MAX()</code> returns the same as
<code>std::numeric_limits&lt;fas::Float&lt;std::int16_t, std::int8_t&gt;&gt;::MAX()</code>
which is approx <code>2.16079e+40</code>.</p>

<p dir="auto"><em>fas</em> supports type traits:</p>
<div dir="auto" data-snippet-clipboard-copy-content="is_fundamental&lt;int16_t, int16_t&gt;::value               // =&gt; true
is_floating_point&lt;fas::Float&lt;int16_t, int16_t&gt;::value // =&gt; true
is_arithmetic&lt;int16_t, int16_t&gt;::value                // =&gt; true
is_scalar&lt;int16_t, int16_t&gt;::value                    // =&gt; true
is_object&lt;int16_t, int16_t&gt;::value                    // =&gt; true"><pre>is_fundamental&lt;<span>int16_t</span>, <span>int16_t</span>&gt;::value               <span><span>//</span> =&gt; true</span>
is_floating_point&lt;fas::Float&lt;<span>int16_t</span>, <span>int16_t</span>&gt;::value <span><span>//</span> =&gt; true</span>
is_arithmetic&lt;<span>int16_t</span>, <span>int16_t</span>&gt;::value                <span><span>//</span> =&gt; true</span>
is_scalar&lt;<span>int16_t</span>, <span>int16_t</span>&gt;::value                    <span><span>//</span> =&gt; true</span>
is_object&lt;<span>int16_t</span>, <span>int16_t</span>&gt;::value                    <span><span>//</span> =&gt; true</span></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Everything is a constant expression</h3><a id="user-content-everything-is-a-constant-expression" aria-label="Permalink: Everything is a constant expression" href="#everything-is-a-constant-expression"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="constexpr c = fas::Float&lt;std::int16_t, std::int8_t&gt;(1);"><pre><span>constexpr</span> c = fas::Float&lt;std::<span>int16_t</span>, std::<span>int8_t</span>&gt;(<span>1</span>);</pre></div>
<p dir="auto">Even the operations&#39; results:</p>
<div dir="auto" data-snippet-clipboard-copy-content="constexpr c1 = fas::Float&lt;std::int16_t, std::int8_t&gt;(1);
constexpr c2 = fas::Float&lt;std::int16_t, std::int8_t&gt;(2);

constexpr c3 = c1 + c2; // =&gt; 3"><pre><span>constexpr</span> c1 = fas::Float&lt;std::<span>int16_t</span>, std::<span>int8_t</span>&gt;(<span>1</span>);
<span>constexpr</span> c2 = fas::Float&lt;std::<span>int16_t</span>, std::<span>int8_t</span>&gt;(<span>2</span>);

<span>constexpr</span> c3 = c1 + c2; <span><span>//</span> =&gt; 3</span></pre></div>

<p dir="auto"><em>fas</em> offers an output stream overload, which can be used for <code>std::cout</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="#include &#34;fas/stream.hpp&gt;

...

fas::Float&lt;int8_t, int8_t&gt; fas_float(1);
fas_float /= 3;
std::cout &lt;&lt; fas_float &lt;&lt; &#34;\n&#34;; // =&gt; 70 * 7 ^ fffffffd ≈ 0.32653061224489793313"><pre>#<span>include</span> <span><span>&#34;</span>fas/stream.hpp&gt;</span>
<span></span>
<span>...</span>
<span></span>
<span>fas::Float&lt;int8_t, int8_t&gt; fas_float(1);</span>
<span>fas_float /= 3;</span>
<span>std::cout &lt;&lt; fas_float &lt;&lt; <span>&#34;</span></span>\n<span><span>&#34;</span>; // =&gt; 70 * 7 ^ fffffffd ≈ 0.32653061224489793313</span></pre></div>

<p dir="auto">Typical floats such as <code>float</code> or <code>double</code> are to the base of
<code>2</code>. <em>fas</em> allows to construct floats to any base:</p>
<div dir="auto" data-snippet-clipboard-copy-content="fas::Float&lt;int8_t, int8_t, 7&gt; fas_float(0);
double cpp_float = 0;

for(auto i=0; i&lt;7; ++i) {
	fas_float += fas::Float&lt;int8_t, int8_t, 7&gt;(1)/7;
	cpp_float += 1.0/7;
}

std::cout &lt;&lt; std::setprecision(20);
std::cout &lt;&lt; fas_float &lt;&lt; &#34;\n&#34;;    // =&gt; exaclty 1
std::cout &lt;&lt; cpp_float &lt;&lt; &#34;\n&#34;;    // =&gt; 0.99999999999999977796"><pre>fas::Float&lt;<span>int8_t</span>, <span>int8_t</span>, <span>7</span>&gt; <span>fas_float</span>(<span>0</span>);
<span>double</span> cpp_float = <span>0</span>;

<span>for</span>(<span>auto</span> i=<span>0</span>; i&lt;<span>7</span>; ++i) {
	fas_float += fas::Float&lt;<span>int8_t</span>, <span>int8_t</span>, <span>7</span>&gt;(<span>1</span>)/<span>7</span>;
	cpp_float += <span>1.0</span>/<span>7</span>;
}

std::cout &lt;&lt; std::setprecision(<span>20</span>);
std::cout &lt;&lt; fas_float &lt;&lt; <span><span>&#34;</span><span>\n</span><span>&#34;</span></span>;    <span><span>//</span> =&gt; exaclty 1</span>
std::cout &lt;&lt; cpp_float &lt;&lt; <span><span>&#34;</span><span>\n</span><span>&#34;</span></span>;    <span><span>//</span> =&gt; 0.99999999999999977796</span></pre></div>
<p dir="auto">The setting of different bases allows to represent specific fractions exaclty.
In this case the base is <code>7</code>, so any fraction by <code>7</code> is represented exactly.
Compare to the native <code>double</code> which is always to the base of <code>2</code>, thus can not
represent <code>1/7</code> exactly.</p>

<p dir="auto">Download the
<a href="https://raw.githubusercontent.com/clemensmanert/fas/master/fas/float.hpp" rel="nofollow">float.hpp</a>
and include it in your source. Don&#39;t forget to add it in your include path.</p>

<p dir="auto">To build and run unit tests type:</p>
<div dir="auto" data-snippet-clipboard-copy-content="mkdir build; cd build; cmake ..; make &amp;&amp; ./tests/tests"><pre>mkdir build<span>;</span> <span>cd</span> build<span>;</span> cmake ..<span>;</span> make <span>&amp;&amp;</span> ./tests/tests</pre></div>

<ul dir="auto">
<li>The Stl&#39;s <code>std::numeric_limits</code> is required the limits of the specified types for mantissa and exponent.</li>
<li><a href="https://github.com/catchorg/Catch2">Catch2</a> is required to build the unit tests.</li>
</ul>

<ul dir="auto">
<li>(configurable) rounding support</li>
<li><code>exp</code>, <code>sqrt</code>, <code>pow</code> and other math.h functions</li>
<li>string constructor</li>
<li>string representation</li>
<li>value constructor for all ints and other types</li>
<li>a version without <em>stl</em></li>
</ul>
</article></div></div>
  </body>
</html>
