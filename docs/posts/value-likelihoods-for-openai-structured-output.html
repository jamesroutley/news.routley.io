<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arena-ai.github.io/structured-logprobs/">Original</a>
    <h1>Show HN: Value likelihoods for OpenAI structured output</h1>
    
    <div id="readability-page-1" class="page"><div data-md-component="container">
      
      
        
          
        
      
      <main data-md-component="main">
        <div>
          
            
              
              
            
            
              
              
            
          
          
            <div data-md-component="content">
              <article>
                
                  

  
  


<p><img alt="structured-logprobs" src="https://github.com/arena-ai/structured-logprobs/blob/main/docs/images/logo.png?raw=true"/></p>
<p><strong>structured-logprobs</strong> is an open-source Python library that enhances <a href="https://platform.openai.com/docs/guides/structured-outputs">OpenAI&#39;s structured outputs</a> by providing detailed information about token log probabilities.</p>
<p><img alt="structured-logprobs" src="https://arena-ai.github.io/structured-logprobs/images/pitch.png"/></p>
<p>This library is designed to offer valuable insights into the <strong>reliability of an LLM&#39;s structured outputs</strong>. It works with OpenAI&#39;s <a href="https://platform.openai.com/docs/guides/structured-outputs">Structured Outputs</a>, a feature that ensures the model consistently generates responses adhering to a supplied JSON Schema. This eliminates concerns about missing required keys or hallucinating invalid values.</p>

<p>Simply install with <code>pip install structured-logprobs</code></p>
<p>Then use it this way:</p>
<div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span>from</span> <span>openai</span> <span>import</span> <span>OpenAI</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span>from</span> <span>structured_logprobs.main</span> <span>import</span> <span>add_logprobs</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span>client</span> <span>=</span> <span>OpenAI</span><span>()</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span>completion</span> <span>=</span> <span>client</span><span>.</span><span>chat</span><span>.</span><span>completions</span><span>.</span><span>create</span><span>(</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span>model</span><span>=</span><span>&#34;gpt-4o&#34;</span><span>,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span>messages</span><span>=</span><span>[</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span>{</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>            <span>&#34;role&#34;</span><span>:</span> <span>&#34;system&#34;</span><span>,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>            <span>&#34;content&#34;</span><span>:</span> <span>(</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>                <span>&#34;Please output metadata about &#39;structured-logprobs&#39;&#34;</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>            <span>),</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span>}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span>],</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span>logprobs</span><span>=</span><span>True</span><span>,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span>response_format</span><span>=</span><span>{</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span>&#34;type&#34;</span><span>:</span> <span>&#34;json_schema&#34;</span><span>,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        <span>&#34;json_schema&#34;</span><span>:</span> <span>{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>            <span>&#34;name&#34;</span><span>:</span> <span>&#34;answear&#34;</span><span>,</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>            <span>&#34;schema&#34;</span><span>:</span> <span>{</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>                <span>&#34;type&#34;</span><span>:</span> <span>&#34;object&#34;</span><span>,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>                <span>&#34;properties&#34;</span><span>:</span> <span>{</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>                    <span>&#34;name&#34;</span><span>:</span> <span>{</span><span>&#34;type&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>},</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>                    <span>&#34;version&#34;</span><span>:</span> <span>{</span><span>&#34;type&#34;</span><span>:</span> <span>&#34;string&#34;</span><span>},</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>                <span>},</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>            <span>},</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>        <span>},</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>    <span>},</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span>)</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span>chat_completion</span> <span>=</span> <span>add_logprobs</span><span>(</span><span>completion</span><span>)</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span>print</span><span>(</span><span>chat_completion</span><span>)</span>
</span></code></pre></div>
<p>For more details, visit <a href="https://arena-ai.github.io/structured-logprobs/notebooks/notebook/">Getting Started</a>.</p>

<p>The module contains a function for mapping characters to token indices (<code>map_characters_to_token_indices</code>) and two methods for incorporating log probabilities:</p>
<ol>
<li>Adding log probabilities as a separate field in the response (<code>add_logprobs</code>).</li>
<li>Embedding log probabilities inline within the message content (<code>add_logprobs_inline</code>).</li>
</ol>












                
              </article>
            </div>
          
          

        </div>
        
      </main>
      
        
      
    </div></div>
  </body>
</html>
