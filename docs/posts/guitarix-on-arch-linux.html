<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nayak.io/posts/guitar-to-linux/">Original</a>
    <h1>Guitarix on Arch Linux</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>I recently bought an electric guitar. But I didn’t buy an amplifier or an effects pedal. My plan was simple, connect my guitar to my Linux machine and use a virtual guitar amplifier. Traditionally a guitar amplifier amplifies the guitar signal and produces the sound through its speakers. Most modern amplifiers can also modify the tone produced.</p>
<p>But we have machines with billions of transistors, surely we can use them instead? That’s right, we can! On Linux, <a href="https://guitarix.org/">Guitarix</a> is a virtual amplifier which also provides a lot of effects with minimal latency. It is FOSS and is designed to work with <a href="https://jackaudio.org/">JACK</a>. Lets start off by connecting your guitar to the linux machine.</p>
<h2 id="connections">
Connections
<a href="#connections">
<i aria-hidden="true" title="Link to heading"></i>
<span>Link to heading</span>
</a>
</h2>
<p>You need to connect your guitar to your Linux machine, while there are multiple ways for this, the simplest and most popular option is to use an audio interface. An audio interface converts the audio signal from the pickup into a digital signal for the machine. I picked up a <a href="https://www.thomann.de/gb/focusrite_scarlett_2i2_3rd_gen.htm">3rd Gen Scarlet 2i2</a> for 100€ from <a href="https://nayak.io/posts/guitar-to-linux/ebay-kleinanzeigen.de/">ebay-kleinanzeigen</a>.</p>
<p><img src="https://nayak.io/guitarix/scarlet.jpg" alt="Scarlet 2i2 audio interface"/></p><p>We connect the guitar to the audio interface using a quarter inch cable.</p>
<p><img src="https://nayak.io/guitarix/guitar.jpg" alt="Guitar"/></p><p>Finally, we connect the audio interface to the Linux machine; for the Scarlet 2i2, I simply plugged it into the USB-C port on the back.</p>
<h2 id="linux-configuration">
Linux Configuration
<a href="#linux-configuration">
<i aria-hidden="true" title="Link to heading"></i>
<span>Link to heading</span>
</a>
</h2>
<h3 id="install-guitarix">
Install Guitarix
<a href="#install-guitarix">
<i aria-hidden="true" title="Link to heading"></i>
<span>Link to heading</span>
</a>
</h3>
<p>Guitarix interacts with <a href="https://wiki.archlinux.org/title/JACK_Audio_Connection_Kit">JACK</a> to provide real-time, low-latency audio. For <a href="https://wiki.archlinux.org/title/PipeWire">pipewire</a> users, there is a pipewire implementation called <code>pipewire-jack</code>. We will use <code>qpwgraph</code> to create the correct audio routing, i.e. from the audio interface to Guitarix and from Guitarix to the speakers. To install these packages on Arch Linux, we can run:</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="sh"><span><span>sudo pacman -S guitarix pipewire-jack qpwgraph
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><h3 id="groups">
Groups
<a href="#groups">
<i aria-hidden="true" title="Link to heading"></i>
<span>Link to heading</span>
</a>
</h3>
<p>To ensure we have least latency for the user running guitarix we need to add them to the following group:</p>
<ul>
<li>realtime (create if it doesn’t exist)</li>
<li>audio</li>
</ul>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span><span>2
</span><span>3
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="sh"><span><span>sudo groupadd realtime <span># creates the group</span>
</span></span><span><span>sudo usermod -a -G realtime $USER
</span></span><span><span>sudo usermod -a -G audio $USER
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><p>Make sure you logout/login (or reboot) to make sure your user is added to the groups. You can always check by running <code>groups</code>.</p>
<h3 id="latency">
Latency
<a href="#latency">
<i aria-hidden="true" title="Link to heading"></i>
<span>Link to heading</span>
</a>
</h3>
<p>To reduce the audio latency we want to set the required <code>node.latency</code> in <code>pipewire-jack</code>. To do this, we first copy the sample file to the user’s config:</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="sh"><span><span>cp  /usr/share/pipewire/jack.conf  ~/.config/pipewire/jack.conf
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><p>Then we change the <code>node.latency</code> value to <code>128/48000</code> by uncommenting and modifying the line.</p>
<h3 id="ulimit">
Ulimit
<a href="#ulimit">
<i aria-hidden="true" title="Link to heading"></i>
<span>Link to heading</span>
</a>
</h3>
<p>Finally, make sure that your <code>ulimit -l</code> value is set to <code>unlimited</code>. If not, you’ll see an error like <code>system init *** mlockall failed </code>. If your <code>ulimit</code> value is not unlimited, you can create an exception rule by creating the file <code>/etc/security/limits.d/audio.conf</code> with content:</p>
<div><div>
<table><tbody><tr><td>
<pre tabindex="0"><code><span>1
</span><span>2
</span></code></pre></td>
<td>
<pre tabindex="0"><code data-lang="fallback"><span><span>@audio   -  rtprio     95
</span></span><span><span>@audio   -  memlock    unlimited
</span></span></code></pre></td></tr></tbody></table>
</div>
</div><h2 id="qpwgraph">
QPWGraph
<a href="#qpwgraph">
<i aria-hidden="true" title="Link to heading"></i>
<span>Link to heading</span>
</a>
</h2>
<p>In <code>qpwgraph</code> make sure you pipe the output of your audio interface to the input of <code>guitarix</code> and the output of <code>guitarix</code> to the input of your speakers.</p>
<p><img src="https://nayak.io/guitarix/qpwgraph.png" alt="QPWGraph showing connections"/></p>
<p>Run Guitarix and see that you have no errors.</p>
<p><img src="https://nayak.io/guitarix/guitarix.png" alt="Guitarix"/></p><p>That’s it! You should now be able to play your guitar and hear the audio being routed from Guitarix to your speakers. Have fun rocking out! \m/</p>
<hr/>
<p>This is post 005 of <a href="https://100daystooffload.com/">#100DaysToOffload</a>.</p>
</div></div>
  </body>
</html>
