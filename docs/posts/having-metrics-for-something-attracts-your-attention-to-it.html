<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/MetricsAttractAttention">Original</a>
    <h1>Having metrics for something attracts your attention to it</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Having metrics for something attracts your attention to it</h2>

	<p><small>May 17, 2023</small></p>
</div><div><p>For reasons beyond the scope of this entry, we didn&#39;t collect any
metrics from our Ubuntu 18.04 <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/ZFSFileserverSetupIII">ZFS fileservers</a> (<a href="https://utcc.utoronto.ca/~cks/space/blog/linux/Ubuntu1804OddKernelPanic">trying to do so early on led
to kernel panics</a>). When we
upgraded all of them to Ubuntu 22.04, we changed this, putting
various host agents on them and collecting a horde of metrics that
go into <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/PrometheusGrafanaSetup-2019">our Prometheus metrics system</a>,
some of which automatically appear on our dashboards. One of the
results of this is that we&#39;ve started noticing things about what&#39;s
happening on our fileservers. For example, at various times, we&#39;ve
noticed significant NFS read volume, significant NFS RPC counts,
visible load averages, and specific moments when the <a href="https://openzfs.github.io/openzfs-docs/Performance%20and%20Tuning/Workload%20Tuning.html#adaptive-replacement-cache">ZFS ARC</a>
has shrunk. Noticing these things has led us to investigate some
of them and pushed me to put together tools to make this easier.</p>

<p>What we haven&#39;t seen is any indication that these things we&#39;re now
noticing are causing issues on our NFS clients (ie, our normal
Ubuntu servers), or that they&#39;re at all unusual. Right now, my best
guess is that everything we&#39;re seeing now has been quietly going
on for some time. Every so often for years, people have run jobs
on <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/SlurmHowWeUseIt">our SLURM cluster</a> that repeatedly read a lot
of data over NFS, and other people have run things that scan
directories a lot, and I know <a href="https://utcc.utoronto.ca/~cks/space/blog/linux/ZFSOnLinuxARCShrinkage">our ZFS ARC size has been bouncing
around for a long time</a>. Instead,
what we&#39;re seeing is that <strong>metrics attract attention</strong>, at least
when they&#39;re new.</p>

<p>This isn&#39;t necessarily a bad thing, as long as we don&#39;t over-react.
Before we had these metrics we probably had very little idea what was
a normal operating state for our fileservers, so if we&#39;d had to look
at them during a problem we&#39;d have had much less idea what was normal
and what was exceptional. Now we&#39;re learning more, and in a while the
various things these metrics are telling us probably won&#39;t be surprising
news (and to a certain extent that&#39;s already happening).</p>

<p>This is in theory not a new idea for me, but it&#39;s one thing to know
it intellectually and another thing to experience it as new metrics
appear and I start digging into them and what they expose. It&#39;s at
least been a while since I went through this experience, and this
time around is a useful reminder.</p>

<p>(This is related to the idea that <a href="https://utcc.utoronto.ca/~cks/space/blog/tech/DangerousMetrics">having metrics for something
can be dangerous</a> and also <a href="https://utcc.utoronto.ca/~cks/space/blog/sysadmin/DashboardAttentionProblem">that dashboards
can be overly attractive</a>. Have I maybe
spent a bit too much time fiddling with ZFS ARC metrics when our
ARC sizes don&#39;t really matter because our ARC hit rates are high?
Possibly.)</p>

<p>PS: Technically what attracts attention is being able to readily
see those metrics, not the metrics themselves. We collect huge piles
of metrics that draw no attention at all because they go straight
into the Prometheus database and never get visualized on any
dashboards. But that&#39;s a detail, so let&#39;s pretend that we collect
metrics because we&#39;re going to use them instead of because they&#39;re
there by default.</p>
</div></div>
  </body>
</html>
