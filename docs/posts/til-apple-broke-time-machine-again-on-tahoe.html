<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://taoofmac.com/space/til/2026/02/01/1630">Original</a>
    <h1>TIL: Apple Broke Time Machine Again on Tahoe</h1>
    
    <div id="readability-page-1" class="page"><div data-clarity-region="article">
<p><a href="https://taoofmac.com/space/til/2026/02/01/1630">Feb 1<sup>st</sup> 2026</a> · 3 min read
 · <small>
#docker 
#proxmox 
#smb 
#synology 
#til 
#timemachine 
#zfs 
</small>
</p>
    
    <section id="main">
    <p>So… Here we are again.</p>
<p>Today, after a minor disaster with my <a href="https://taoofmac.com/space/apps/obsidian" rel="next">Obsidian</a> vault, I decided to restore from Time Machine, and… I realized that it had silently broken across both my Tahoe machines. I use a <a href="https://taoofmac.com/space/com/synology" rel="next">Synology</a> NAS as Time Machine target, exporting the share over <a href="https://taoofmac.com/space/protocols/smb" rel="next">SMB</a> and that has worked flawlessly for years, but this came as a surprise because I could have sworn it was working fine a couple of months ago–but no, it wasn’t.</p>
<p>After some research, I found out that the issue is with <a href="https://taoofmac.com/space/com/apple" rel="next">Apple’s</a> unilateral decision to change their SMB defaults (without apparently notifying anyone), and came across a few possible fixes.</p>
<a id="anchor-what-seems-to-be-working-now" href="https://taoofmac.com/space/til/2026/02/01/1630#what-seems-to-be-working-now" rel="anchor"><h2 id="what-seems-to-be-working-now">What Seems To Be Working Now</h2></a><p>I found <a href="https://gist.github.com/Zahorone/6915be6f5088edb2f64018ce9e4dfe97?utm_source=taoofmac.com&amp;utm_medium=web&amp;utm_campaign=unsolicited_traffic&amp;utm_content=external_link" rel="external">this gist</a>, which I am reproducing here for posterity, that seems to be working for me, but which entails editing the <code>nsmb.conf</code> file on the Mac itself–which is not exactly ideal, since I’m pretty sure Apple will break this again in the future.</p>
<div><pre><span><code>sudo<span> </span>nano<span> </span>/etc/nsmb.conf<span> </span><span># I used vim, of course</span>
</code></span></pre></div>

<p>…and adding the following lines (the file should be empty):</p>
<div><pre><span><code><span>[default]</span>
<span>signing_required</span><span>=</span><span>yes</span>
<span>streams</span><span>=</span><span>yes</span>
<span>soft</span><span>=</span><span>yes</span>
<span>dir_cache_max_cnt</span><span>=</span><span>0</span>
<span>protocol_vers_map</span><span>=</span><span>6</span>
<span>mc_prefer_wired</span><span>=</span><span>yes</span>
</code></span></pre></div>

<p>The explanation here is that <a href="https://taoofmac.com/space/com/apple/macos" rel="next">macOS</a> Tahoe changed the default from <code>signing_required=no</code> to stricter control, and NAS devices with relaxed SMB settings cannot handle this without explicit configuration.</p>
<p>Another common pitfall is name encoding issues in machine names, so you should remove Non-ASCII Characters from the <code>.sparsebundle</code> name (that wasn’t an issue for me, but YMMV).</p>
<p>On the <a href="https://taoofmac.com/space/com/synology" rel="next">Synology</a> side, the recommendation was to go to <code>Control Panel &gt; File Services &gt; SMB &gt; Advanced</code> and set:</p>
<ul>
<li>Maximum SMB protocol: SMB3</li>
<li>Enable Opportunistic Locking: Yes</li>
<li>Enable SMB2 Lease: Yes</li>
<li>Enable SMB Durable Handles: Yes</li>
<li>Server signing: No (or “Auto”)</li>
<li>Transport encryption: Disabled</li>
</ul>
<p>That doesn’t quite match my DSM UI, but it’s close enough, and my settings now look like this:</p>
<figure><img alt="My SMB settings, as of DSM 7.3.2-86009-1" src="https://taoofmac.com/media/til/2026/02/01/1630/fY_oAYhU-aPe6gdiXpboLe7GTwI=/image.png" width="1384" height="1462"/><figcaption>My SMB settings, as of DSM 7.3.2-86009-1</figcaption></figure>
<a id="anchor-my-backup-backup-plan" href="https://taoofmac.com/space/til/2026/02/01/1630#my-backup-backup-plan" rel="anchor"><h2 id="my-backup-backup-plan">My Backup Backup Plan</h2></a><p>Since I’m tired of Apple breaking <a href="https://hub.docker.com/r/mbentley/timemachine?utm_source=taoofmac.com&amp;utm_medium=web&amp;utm_campaign=unsolicited_traffic&amp;utm_content=external_link" rel="external">Time Machine</a> every few years and the lack of transparency around this (it’s not Synology’s fault), I have decided to implement a more robust solution that doesn’t depend on Synology’s SMB implementation.</p>
<p>I already have <a href="https://taoofmac.com/space/blog/2024/12/26/2330" rel="next">a Proxmox server with ZFS as the backend storage</a> that has an LXC container running Samba for general file sharing, so I decided to look into that as a possible Time Machine target.</p>
<p>As it happens, <a href="https://hub.docker.com/r/mbentley/timemachine?utm_source=taoofmac.com&amp;utm_medium=web&amp;utm_campaign=unsolicited_traffic&amp;utm_content=external_link" rel="external"><code>mbentley/timemachine</code></a> is a <a href="https://taoofmac.com/space/os/linux/docker" rel="next">Docker</a> image specifically designed for this purpose, and it seems to be well-maintained, so I’m testing it like this:</p>
<div><pre><span><code><span>services</span><span>:</span>
<span>  </span><span>timemachine</span><span>:</span>
<span>    </span><span>image</span><span>:</span><span> </span><span>mbentley/timemachine:smb</span>
<span>    </span><span>container_name</span><span>:</span><span> </span><span>timemachine</span>
<span>    </span><span>restart</span><span>:</span><span> </span><span>always</span>
<span>    </span><span>network_mode</span><span>:</span><span> </span><span>host</span>
<span>    </span><span>environment</span><span>:</span>
<span>      </span><span>-</span><span> </span><span>TM_USERNAME=timemachine</span>
<span>      </span><span>-</span><span> </span><span>TM_GROUPNAME=timemachine</span>
<span>      </span><span>-</span><span> </span><span>PASSWORD=timemachine</span>
<span>      </span><span>-</span><span> </span><span>TM_UID=65534</span><span> </span><span># &#39;nobody&#39; user</span>
<span>      </span><span>-</span><span> </span><span>TM_GID=65534</span><span> </span><span># &#39;nobody&#39; group</span>
<span>      </span><span>-</span><span> </span><span>SET_PERMISSIONS=false</span>
<span>      </span><span>-</span><span> </span><span>VOLUME_SIZE_LIMIT=0</span>
<span>    </span><span>volumes</span><span>:</span>
<span>      </span><span># this is a pass-though mountpoint to the ZFS volume in Proxmox</span>
<span>      </span><span>-</span><span> </span><span>/mnt/shares/timemachine:/opt/timemachine</span>
<span>    </span><span>tmpfs</span><span>:</span>
<span>      </span><span>-</span><span> </span><span>/run/samba</span>
</code></span></pre></div>

<p>Right now the first option <em>seems</em> to be working, but I will probably switch to the Docker solution in the near future, since it gives me more control over the <a href="https://taoofmac.com/space/protocols/smb" rel="next">SMB</a> implementation and avoids relying on <a href="https://taoofmac.com/space/com/synology" rel="next">Synology</a>’s software.</p>
<p>But if anyone from Apple is reading this: please, stop breaking <a href="https://hub.docker.com/r/mbentley/timemachine?utm_source=taoofmac.com&amp;utm_medium=web&amp;utm_campaign=unsolicited_traffic&amp;utm_content=external_link" rel="external">Time Machine</a> every few years. It’s a critical piece of infrastructure for many users, and the lack of communication around these changes is frustrating.</p>
<p>Plus I’m annoyed enough that earlier this morning I tried to set up a new <a href="https://taoofmac.com/space/com/apple/ios" rel="next">iOS</a> device and the infamous <code>Restore in Progress: An estimated 100 MB will be downloaded…</code> bug (which has bitten me repeatedly <em>over the last <strong>six</strong> years</em>) is still there.</p>
<p>The usual fix was hitting <code>Reset Network Settings</code> and a full hardware reboot, plus reconnecting to Wi-Fi… But this time it took <em>three</em> attempts.</p>
<p>Come on, Apple, get your act together. Hire people who care about the OS experience, not just <a href="https://taoofmac.com/space/notes/2025/09/15/2359" rel="next">Liquid Glass</a>.</p>
    </section>
</div></div>
  </body>
</html>
