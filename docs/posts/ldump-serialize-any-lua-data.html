<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/girvel/ldump">Original</a>
    <h1>Show HN: Ldump – serialize any Lua data</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a href="https://github.com/girvel/ldump/blob/master/docs/api.md">API</a> | <a href="https://github.com/girvel/ldump/blob/master/docs/overloading.md">Overloading serialization</a> | <a href="https://github.com/girvel/ldump/blob/master/docs/development.md">Development</a></p>
<div dir="auto"><a id="user-content-ldump--serializer-for-any-lua-type" aria-label="Permalink: ldump — serializer for any lua type" href="#ldump--serializer-for-any-lua-type"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>ldump</code> is a flexible serializer, able to serialize any data, starting with circular references, tables as keys, functions with upvalues, metatables and ending with coroutines, threads and userdata (by defining how they should be serialized). It outputs valid Lua code that recreates the original object, doing the deserialization through <code>load(data)()</code>. It aims for functionality and flexibility instead of speed and size, allowing full serialization of complex data, such as video game saves. The output is large, but can be drastically reduced with modern compression algorithms.</p>
<p dir="auto">Inspired by <a href="https://github.com/gvx/Ser"><code>Ser</code></a>. Supports Lua 5.1, 5.2, 5.3, 5.4 and LuaJIT. Tested for edge cases, such as joined upvalues and _ENV redefinition. Fully annotated in compatibility with LuaLS.</p>
<p dir="auto"><strong>WARNING:</strong> <code>ldump</code>&#39;s deserialization function is Lua&#39;s builtin <code>load</code>, which can load malicious code. Treat serialized data as arbitrary Lua code (which it is), <a href="https://github.com/girvel/ldump/issues/42" data-hovercard-type="issue" data-hovercard-url="/girvel/ldump/issues/42/hovercard"><code>.safe_load</code> is coming soon</a>.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Type</th>
<th>Support</th>
</tr>
</thead>
<tbody>
<tr>
<td>nil, boolean, number, string</td>
<td>full</td>
</tr>
<tr>
<td>function</td>
<td>full</td>
</tr>
<tr>
<td>userdata</td>
<td>user-defined</td>
</tr>
<tr>
<td>thread</td>
<td>user-defined</td>
</tr>
<tr>
<td>table</td>
<td>full</td>
</tr>
<tr>
<td>metatables<a href="https://github.com/girvel/ldump/blob/master/docs/development.md#plans">*</a></td>
<td>full</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div dir="auto"><h2 tabindex="-1" dir="auto">TL;DR show me the code</h2><a id="user-content-tldr-show-me-the-code" aria-label="Permalink: TL;DR show me the code" href="#tldr-show-me-the-code"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="local ldump = require(&#34;ldump&#34;)

local upvalue = 42
local world = {
  name = &#34;New world&#34;,
  get_answer = function() return upvalue end,
}

local serialized_data = ldump(world)  -- serialize to a string
local loaded_world = load(serialized_data)()  -- deserialize the string

assert.are_equal(world.name, loaded_world.name)
assert.are_equal(world.get_answer(), loaded_world.get_answer())"><pre><span>local</span> <span>ldump</span> <span>=</span> <span>require</span>(<span><span>&#34;</span>ldump<span>&#34;</span></span>)

<span>local</span> <span>upvalue</span> <span>=</span> <span>42</span>
<span>local</span> <span>world</span> <span>=</span> {
  <span>name</span> <span>=</span> <span><span>&#34;</span>New world<span>&#34;</span></span>,
  <span>get_answer</span> <span>=</span> <span>function</span>() <span>return</span> <span>upvalue</span> <span>end</span>,
}

<span>local</span> <span>serialized_data</span> <span>=</span> <span>ldump</span>(<span>world</span>)  <span><span>--</span> serialize to a string</span>
<span>local</span> <span>loaded_world</span> <span>=</span> <span>load</span>(<span>serialized_data</span>)()  <span><span>--</span> deserialize the string</span>

<span>assert</span>.<span>are_equal</span>(<span>world</span>.<span>name</span>, <span>loaded_world</span>.<span>name</span>)
<span>assert</span>.<span>are_equal</span>(<span>world</span>.<span>get_answer</span>(), <span>loaded_world</span>.<span>get_answer</span>())</pre></div>
<p dir="auto">See as a test at <a href="https://github.com/girvel/ldump/blob/master/tests/test_use_case.lua#L7">/tests/test_use_case.lua:7</a></p>
<div dir="auto"><h2 tabindex="-1" dir="auto">The full power of ldump</h2><a id="user-content-the-full-power-of-ldump" aria-label="Permalink: The full power of ldump" href="#the-full-power-of-ldump"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="local ldump = require(&#34;ldump&#34;)

-- basic tables
local game_state = {
  player = {name = &#34;Player&#34;},
  boss = {name = &#34;Boss&#34;},
}

-- circular references &amp; tables as keys
game_state.deleted_entities = {
  [game_state.boss] = true,
}

-- functions even with upvalues
local upvalue = 42
game_state.get_answer = function() return upvalue end

-- fundamentally non-serializable types if overriden
local create_coroutine = function()
  return coroutine.wrap(function()
    coroutine.yield(1337)
    coroutine.yield(420)
  end)
end

-- override serialization
game_state.coroutine = create_coroutine()
ldump.serializer.handlers[game_state.coroutine] = create_coroutine

local serialized_data = ldump(game_state)  -- serialize
local loaded_game_state = load(serialized_data)()  -- deserialize

-- assert
assert.are_equal(game_state.get_answer(), loaded_game_state.get_answer())
assert.are_equal(game_state.coroutine(), loaded_game_state.coroutine())
assert.are_equal(game_state.coroutine(), loaded_game_state.coroutine())

assert.are_same(game_state.player, loaded_game_state.player)
assert.are_same(game_state.boss, loaded_game_state.boss)
assert.are_same(
  game_state.deleted_entities[game_state.boss],
  loaded_game_state.deleted_entities[loaded_game_state.boss]
)"><pre><span>local</span> <span>ldump</span> <span>=</span> <span>require</span>(<span><span>&#34;</span>ldump<span>&#34;</span></span>)

<span><span>--</span> basic tables</span>
<span>local</span> <span>game_state</span> <span>=</span> {
  <span>player</span> <span>=</span> {<span>name</span> <span>=</span> <span><span>&#34;</span>Player<span>&#34;</span></span>},
  <span>boss</span> <span>=</span> {<span>name</span> <span>=</span> <span><span>&#34;</span>Boss<span>&#34;</span></span>},
}

<span><span>--</span> circular references &amp; tables as keys</span>
<span>game_state</span>.<span>deleted_entities</span> <span>=</span> {
  [<span>game_state</span>.<span>boss</span>] <span>=</span> <span>true</span>,
}

<span><span>--</span> functions even with upvalues</span>
<span>local</span> <span>upvalue</span> <span>=</span> <span>42</span>
<span>game_state</span>.<span>get_answer</span> <span>=</span> <span>function</span>() <span>return</span> <span>upvalue</span> <span>end</span>

<span><span>--</span> fundamentally non-serializable types if overriden</span>
<span>local</span> <span>create_coroutine</span> <span>=</span> <span>function</span>()
  <span>return</span> <span>coroutine.wrap</span>(<span>function</span>()
    <span>coroutine.yield</span>(<span>1337</span>)
    <span>coroutine.yield</span>(<span>420</span>)
  <span>end</span>)
<span>end</span>

<span><span>--</span> override serialization</span>
<span>game_state</span>.<span>coroutine</span> <span>=</span> <span>create_coroutine</span>()
<span>ldump</span>.<span>serializer</span>.<span>handlers</span>[<span>game_state</span>.<span>coroutine</span>] <span>=</span> <span>create_coroutine</span>

<span>local</span> <span>serialized_data</span> <span>=</span> <span>ldump</span>(<span>game_state</span>)  <span><span>--</span> serialize</span>
<span>local</span> <span>loaded_game_state</span> <span>=</span> <span>load</span>(<span>serialized_data</span>)()  <span><span>--</span> deserialize</span>

<span><span>--</span> assert</span>
<span>assert</span>.<span>are_equal</span>(<span>game_state</span>.<span>get_answer</span>(), <span>loaded_game_state</span>.<span>get_answer</span>())
<span>assert</span>.<span>are_equal</span>(<span>game_state</span>.<span>coroutine</span>(), <span>loaded_game_state</span>.<span>coroutine</span>())
<span>assert</span>.<span>are_equal</span>(<span>game_state</span>.<span>coroutine</span>(), <span>loaded_game_state</span>.<span>coroutine</span>())

<span>assert</span>.<span>are_same</span>(<span>game_state</span>.<span>player</span>, <span>loaded_game_state</span>.<span>player</span>)
<span>assert</span>.<span>are_same</span>(<span>game_state</span>.<span>boss</span>, <span>loaded_game_state</span>.<span>boss</span>)
<span>assert</span>.<span>are_same</span>(
  <span>game_state</span>.<span>deleted_entities</span>[<span>game_state</span>.<span>boss</span>],
  <span>loaded_game_state</span>.<span>deleted_entities</span>[<span>loaded_game_state</span>.<span>boss</span>]
)</pre></div>
<p dir="auto">See as a test at <a href="https://github.com/girvel/ldump/blob/master/tests/test_use_case.lua#L23">/tests/test_use_case.lua:23</a></p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Installation</h2><a id="user-content-installation" aria-label="Permalink: Installation" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Copy the <a href="https://raw.githubusercontent.com/girvel/ldump/refs/tags/v1.2.0/init.lua" rel="nofollow">raw contents of init.lua from the latest release</a> into your <code>lib/ldump.lua</code> or <code>git clone -b v1.2.0 https://github.com/girvel/ldump</code> inside the <code>lib/</code> — you still would be able to do <code>require(&#34;ldump&#34;)</code>.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Credits</h2><a id="user-content-credits" aria-label="Permalink: Credits" href="#credits"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="https://www.reddit.com/user/paulstelian97/" rel="nofollow">paulstelian97</a> for providing a joined upvalue test case</li>
<li><a href="https://www.reddit.com/user/lambda_abstraction/" rel="nofollow">lambda_abstraction</a> for suggesting a way to join upvalues</li>
</ul>
</article></div></div>
  </body>
</html>
