<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://yossarian.net/til/post/any-program-can-be-a-github-actions-shell/">Original</a>
    <h1>Any program can be a GitHub Actions shell</h1>
    
    <div id="readability-page-1" class="page"><div>
            <p>In GitHub Actions, you can use the <code>shell</code> keyword to specify the shell
that runs a given <code>run:</code> block. This keyword is optional for workflows
but mandatory for action definitions.</p>
<p>The shell normally defaults to something sensible for your runner,
e.g. <code>bash</code> on Linux and macOS, and <code>pwsh</code> on Windows. But it can also be
specified, and <a href="https://docs.github.com/en/actions/writing-workflows/workflow-syntax-for-github-actions#defaultsrunshell">GitHub documents</a> that specifying it explicitly also
implies some flags of their choosing:</p>
<pre><code><span><span>-</span> <span><span>shell</span></span><span>:</span> <span>bash</span>
  <span><span>run</span></span><span>:</span> <span>|</span>
<span>    echo &#34;Hello, world!&#34;
</span></span></code></pre>
<p>Based on that, you might think that there&#39;s a fixed number of valid
<code>shell</code> values, which GitHub tracks and adds their special flags to.
But you&#39;d be wrong!</p>
<p>As it turns out, you can set <code>shell</code> to any executable on the <code>$PATH</code>,
and GitHub will happily use it to execute the <code>run</code> block. If the command
doesn&#39;t already take a single file as input, you need to pass it
the special <code>{0}</code> argument, which GitHub replaces with the temporary file
that it generates the template-expanded <code>run</code> block into.</p>
<p>Thanks to this, we can do all kinds of cursed things.</p>
<p>Using C as our step runner <a href="https://github.com/woodruffw-experiments/actions-experiments/pull/3">works fine</a>:</p>
<pre><code><span><span>-</span> <span><span>run</span></span><span>:</span> <span>sudo apt install -y tcc</span>
<span>-</span> <span><span>shell</span></span><span>:</span> <span>tcc -run {0}</span>
  <span><span>run</span></span><span>:</span> <span>|</span>
<span>    #include &lt;stdio.h&gt;
    int main() {
      printf(&#34;Hello, world!\n&#34;);
      return 0;
    }
</span></span></code></pre>
<p>...and so does <a href="https://github.com/woodruffw-experiments/actions-experiments/pull/5">dynamically modifying</a> the <code>$PATH</code> via <code>$GITHUB_PATH</code>:</p>
<pre><code><span><span>-</span> <span><span>run</span></span><span>:</span> <span>|</span>
<span>    touch ./bash
    chmod +x ./bash
    echo &#39;#!/bin/sh&#39; &gt; ./bash
    echo &#39;echo hello from fake bash&#39; &gt;&gt; ./bash
    echo &#34;${PWD}&#34; &gt;&gt; &#34;${GITHUB_PATH}&#34;
</span><span>-</span> <span><span>run</span></span><span>:</span> <span>|</span>
<span>    echo &#34;this doesn&#39;t do what you expect&#34;
</span>  <span><span>shell</span></span><span>:</span> <span>bash</span>
</span></code></pre>
<p>Does this matter from a security perspective? It&#39;s hard to say â€” there
are plenty of other ways in which file writes imply execution in GitHub Actions,
including <code>GITHUB_ENV</code> itself.</p>
<p>On the other hand, it&#39;s surprising (IMO) that GitHub does <code>$PATH</code> lookups even
for their &#34;well-known&#34; shell values; I would expect those to be fixed to
specific values (e.g. <code>bash</code> to <code>/bin/bash</code>), especially since they inject
flags into the <code>run</code>&#39;s command line based on those well-known values.</p>


        </div></div>
  </body>
</html>
