<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zod.dev/v4">Original</a>
    <h1>Zod 4</h1>
    
    <div id="readability-page-1" class="page"><div><p>After a year of active development: Zod 4 is now stable! It&#39;s faster, slimmer, more <code>tsc</code>-efficient, and implements some long-requested features.</p>
<div><p>❤️</p><div><p>Huge thanks to <a href="https://go.clerk.com/zod-clerk" rel="noreferrer noopener" target="_blank">Clerk</a>, who supported my work on Zod 4 through their extremely generous <a href="https://clerk.com/blog/zod-fellowship" rel="noreferrer noopener" target="_blank">OSS Fellowship</a>. They were an amazing partner throughout the (much longer than anticipated!) development process.</p></div></div>
<p>To simplify the migration process both for users and Zod&#39;s ecosystem of associated libraries, Zod 4 is being published alongside Zod 3 as part of the <code>zod@3.25</code> release. To upgrade:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>npm upgrade zod@^3.25.0</span></span></code></pre></div></div></div></figure>
<p>Then import Zod 4 from the <code>&#34;/v4&#34;</code> subpath:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4&#34;</span><span>;</span></span></code></pre></div></div></div></figure>
<p>Refer to the <a href="https://todaythings.substack.com/v4/changelog">Migration guide</a> for a complete list of breaking changes. This page covers the new features and improvements.</p>
<!-- -->
<h2 id="why-a-new-major-version"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=why-a-new-major-version">Why a new major version?</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Zod v3.0 was released in May 2021 (!). Back then Zod had 2700 stars on GitHub and 600k weekly downloads. Today it has 37.8k stars and 31M weekly downloads (up from 23M when the beta came out 6 weeks ago!). After 24 minor versions, the Zod 3 codebase had hit a ceiling; the most commonly requested features and improvements require breaking changes.</p>
<p>Zod 4 fixes a number of long-standing design limitations of Zod 3 in one fell swoop, paving the way for several long-requested features and a huge leap in performance. It closes 9 of Zod&#39;s <a href="https://github.com/colinhacks/zod/issues?q=is%3Aissue%20state%3Aopen%20sort%3Areactions-%2B1-desc" rel="noreferrer noopener" target="_blank">10 most upvoted open issues</a>. With luck, it will serve as the new foundation for many more years to come.</p>
<p>For a scannable breakdown of what&#39;s new, see the table of contents. Click on any item to jump to that section.</p>
<h2 id="benchmarks"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=benchmarks">Benchmarks</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>You can run these benchmarks yourself in the Zod repo:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>$</span><span> git</span><span> clone</span><span> git@github.com:colinhacks/zod.git</span></span>
<span><span>$</span><span> cd</span><span> zod</span></span>
<span><span>$</span><span> git</span><span> switch</span><span> v4</span></span>
<span><span>$</span><span> pnpm</span><span> install</span></span></code></pre></div></div></div></figure>
<p>Then to run a particular benchmark:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>$</span><span> pnpm</span><span> bench</span><span> &lt;</span><span>nam</span><span>e</span><span>&gt;</span></span></code></pre></div></div></div></figure>
<h3 id="14x-faster-string-parsing"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=14x-faster-string-parsing">14x faster string parsing</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>$</span><span> pnpm</span><span> bench</span><span> string</span></span>
<span><span>runtime:</span><span> node</span><span> v22.13.0</span><span> (arm64-darwin)</span></span>
<span> </span>
<span><span>benchmark</span><span>      time</span><span> (avg)             (</span><span>min</span><span> …</span><span> max</span><span>)       p75       p99      p999</span></span>
<span><span>-------------------------------------------------</span><span> -----------------------------</span></span>
<span><span>•</span><span> z.string</span><span>()</span><span>.parse</span></span>
<span><span>-------------------------------------------------</span><span> -----------------------------</span></span>
<span><span>zod3</span><span>          363</span><span> µs/iter</span><span>       (338 </span><span>µs</span><span> …</span><span> 683</span><span> µs</span><span>)    351 µs    467 µs    572 µs</span></span>
<span><span>zod4</span><span>       24</span><span>&#39;674 ns/iter    (21&#39;083</span><span> ns</span><span> …</span><span> 235</span><span> µs</span><span>) 24</span><span>&#39;209 ns 76&#39;</span><span>125 ns    120 µs</span></span>
<span> </span>
<span><span>summary</span><span> for</span><span> z.string</span><span>()</span><span>.parse</span></span>
<span><span>  zod4</span></span>
<span><span>   14.71x</span><span> faster</span><span> than</span><span> zod3</span></span></code></pre></div></div></div></figure>
<h3 id="3x-faster-array-parsing"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=3x-faster-array-parsing">3x faster array parsing</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>$</span><span> pnpm</span><span> bench</span><span> array</span></span>
<span><span>runtime:</span><span> node</span><span> v22.13.0</span><span> (arm64-darwin)</span></span>
<span> </span>
<span><span>benchmark</span><span>      time</span><span> (avg)             (</span><span>min</span><span> …</span><span> max</span><span>)       p75       p99      p999</span></span>
<span><span>-------------------------------------------------</span><span> -----------------------------</span></span>
<span><span>•</span><span> z.array</span><span>() </span><span>parsing</span></span>
<span><span>-------------------------------------------------</span><span> -----------------------------</span></span>
<span><span>zod3</span><span>          147</span><span> µs/iter</span><span>       (137 </span><span>µs</span><span> …</span><span> 767</span><span> µs</span><span>)    140 µs    246 µs    520 µs</span></span>
<span><span>zod4</span><span>       19</span><span>&#39;817 ns/iter    (18&#39;125</span><span> ns</span><span> …</span><span> 436</span><span> µs</span><span>) 19</span><span>&#39;125 ns 44&#39;</span><span>500 ns    137 µs</span></span>
<span> </span>
<span><span>summary</span><span> for</span><span> z.array</span><span>() </span><span>parsing</span></span>
<span><span>  zod4</span></span>
<span><span>   7.43x</span><span> faster</span><span> than</span><span> zod3</span></span></code></pre></div></div></div></figure>
<h3 id="65x-faster-object-parsing"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=65x-faster-object-parsing">6.5x faster object parsing</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>This runs the <a href="https://moltar.github.io/typescript-runtime-type-benchmarks/" rel="noreferrer noopener" target="_blank">Moltar validation library benchmark</a>.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>$</span><span> pnpm</span><span> bench</span><span> object-moltar</span></span>
<span><span>benchmark</span><span>      time</span><span> (avg)             (</span><span>min</span><span> …</span><span> max</span><span>)       p75       p99      p999</span></span>
<span><span>-------------------------------------------------</span><span> -----------------------------</span></span>
<span><span>•</span><span> z.object</span><span>() </span><span>safeParse</span></span>
<span><span>-------------------------------------------------</span><span> -----------------------------</span></span>
<span><span>zod3</span><span>          805</span><span> µs/iter</span><span>     (771 </span><span>µs</span><span> …</span><span> 2</span><span>&#39;802 µs)    804 µs    928 µs  2&#39;802</span><span> µs</span></span>
<span><span>zod4</span><span>          124</span><span> µs/iter</span><span>     (118 </span><span>µs</span><span> …</span><span> 1</span><span>&#39;236 µs)    119 µs    231 µs    329 µs</span></span>
<span> </span>
<span><span>summary for z.object() safeParse</span></span>
<span><span>  zod4</span></span>
<span><span>   6.5x faster than zod3</span></span></code></pre></div></div></div></figure>
<h2 id="100x-reduction-in-tsc-instantiations"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=100x-reduction-in-tsc-instantiations">100x reduction in <code>tsc</code> instantiations</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Consider the following simple file:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4&#34;</span><span>;</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> A</span><span> =</span><span> z.</span><span>object</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>  d: z.</span><span>string</span><span>(),</span></span>
<span><span>  e: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> B</span><span> =</span><span> A</span><span>.</span><span>extend</span><span>({</span></span>
<span><span>  f: z.</span><span>string</span><span>(),</span></span>
<span><span>  g: z.</span><span>string</span><span>(),</span></span>
<span><span>  h: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span></code></pre></div></div></div></figure>
<p>Compiling this file with <code>tsc --extendedDiagnostics</code> using <code>&#34;zod/v3&#34;</code> results in &gt;25000 type instantiations. With <code>&#34;zod/v4&#34;</code> it only results in ~175.</p>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><div><p>The Zod repo contains a <code>tsc</code> benchmarking playground. Try this for yourself using the compiler benchmarks in <code>packages/tsc</code>. The exact numbers may change as the implementation evolves.</p><figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>$</span><span> cd</span><span> packages/tsc</span></span>
<span><span>$</span><span> pnpm</span><span> bench</span><span> object-with-extend</span></span></code></pre></div></div></div></figure></div></div></div>
<p>More importantly, Zod 4 has redesigned and simplified the generics of <code>ZodObject</code> and other schema classes to avoid some pernicious &#34;instantiation explosions&#34;. For instance, chaining <code>.extend()</code> and <code>.omit()</code> repeatedly—something that previously caused compiler issues:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4&#34;</span><span>;</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> a</span><span> =</span><span> z.</span><span>object</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> b</span><span> =</span><span> a.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> c</span><span> =</span><span> b.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> d</span><span> =</span><span> c.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> e</span><span> =</span><span> d.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> f</span><span> =</span><span> e.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> g</span><span> =</span><span> f.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> h</span><span> =</span><span> g.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> i</span><span> =</span><span> h.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> j</span><span> =</span><span> i.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> k</span><span> =</span><span> j.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> l</span><span> =</span><span> k.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> m</span><span> =</span><span> l.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> n</span><span> =</span><span> m.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> o</span><span> =</span><span> n.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> p</span><span> =</span><span> o.</span><span>omit</span><span>({</span></span>
<span><span>  a: </span><span>true</span><span>,</span></span>
<span><span>  b: </span><span>true</span><span>,</span></span>
<span><span>  c: </span><span>true</span><span>,</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>export</span><span> const</span><span> q</span><span> =</span><span> p.</span><span>extend</span><span>({</span></span>
<span><span>  a: z.</span><span>string</span><span>(),</span></span>
<span><span>  b: z.</span><span>string</span><span>(),</span></span>
<span><span>  c: z.</span><span>string</span><span>(),</span></span>
<span><span>});</span></span></code></pre></div></div></div></figure>
<p>In Zod 3, this took <code>4000ms</code> to compile; and adding additional calls to <code>.extend()</code> would trigger a &#34;Possibly infinite&#34; error. In Zod 4, this compiles in <code>400ms</code>, <code>10x</code> faster.</p>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p>Coupled with the upcoming <a href="https://github.com/microsoft/typescript-go" rel="noreferrer noopener" target="_blank"><code>tsgo</code></a> compiler, Zod 4&#39;s editor performance will scale to vastly larger schemas and codebases.</p></div></div>
<h2 id="2x-reduction-in-core-bundle-size"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=2x-reduction-in-core-bundle-size">2x reduction in core bundle size</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Consider the following simple script.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4&#34;</span><span>;</span></span>
<span> </span>
<span><span>const</span><span> schema</span><span> =</span><span> z.</span><span>boolean</span><span>();</span></span>
<span> </span>
<span><span>schema.</span><span>parse</span><span>(</span><span>true</span><span>);</span></span></code></pre></div></div></div></figure>
<p>It&#39;s about as simple as it gets when it comes to validation. That&#39;s intentional; it&#39;s a good way to measure the <em>core bundle size</em>—the code that will end up in the bundle even in simple cases. We&#39;ll bundle this with <code>rollup</code> using both Zod 3 and Zod 4 and compare the final bundles.</p>
<div><table><thead><tr><th>Package</th><th>Bundle (gzip)</th></tr></thead><tbody><tr><td><code>zod/v3</code></td><td><code>12.47kb</code></td></tr><tr><td><code>zod/v4</code></td><td><code>5.36kb</code></td></tr></tbody></table></div>
<p>The core bundle is ~57% smaller in Zod 4 (2.3x). That&#39;s good! But we can do a lot better.</p>
<h2 id="introducing-zod-mini"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=introducing-zod-mini">Introducing Zod Mini</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Zod&#39;s method-heavy API is fundamentally difficult to tree-shake. Even our simple <code>z.boolean()</code> script pulls in the implementations of a bunch of methods we didn&#39;t use, like <code>.optional()</code>, <code>.array()</code>, etc. Writing slimmer implementations can only get you so far. That&#39;s where <code>zod/v4-mini</code> comes in.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>npm</span><span> install</span><span> zod@^3.25.0</span></span></code></pre></div></div></div></figure>
<p>It&#39;s a Zod variant with a functional, tree-shakable API that corresponds one-to-one with <code>zod</code>. Where Zod uses methods, <code>zod/v4-mini</code> generally uses wrapper functions:</p>
<div dir="ltr" data-orientation="horizontal"><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R1bd97nqt7b»-trigger-zod-mini" id="radix-«R1bd97nqt7b»-content-zod-mini" tabindex="0"><figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4-mini&#34;</span><span>;</span></span>
<span> </span>
<span><span>z.</span><span>optional</span><span>(z.</span><span>string</span><span>());</span></span>
<span> </span>
<span><span>z.</span><span>union</span><span>([z.</span><span>string</span><span>(), z.</span><span>number</span><span>()]);</span></span>
<span> </span>
<span><span>z.</span><span>extend</span><span>(z.</span><span>object</span><span>({ </span><span>/* ... */</span><span> }), { age: z.</span><span>number</span><span>() });</span></span></code></pre></div></div></div></figure></div></div>
<p>Not all methods are gone! The parsing methods are identical in <code>zod/v4</code> and <code>zod/v4-mini</code>.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4-mini&#34;</span><span>;</span></span>
<span> </span>
<span><span>z.</span><span>string</span><span>().</span><span>parse</span><span>(</span><span>&#34;asdf&#34;</span><span>);</span></span>
<span><span>z.</span><span>string</span><span>().</span><span>safeParse</span><span>(</span><span>&#34;asdf&#34;</span><span>);</span></span>
<span><span>await</span><span> z.</span><span>string</span><span>().</span><span>parseAsync</span><span>(</span><span>&#34;asdf&#34;</span><span>);</span></span>
<span><span>await</span><span> z.</span><span>string</span><span>().</span><span>safeParseAsync</span><span>(</span><span>&#34;asdf&#34;</span><span>);</span></span></code></pre></div></div></div></figure>
<p>There&#39;s also a general-purpose <code>.check()</code> method used to add refinements.</p>
<div dir="ltr" data-orientation="horizontal"><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R1fd97nqt7b»-trigger-zod-mini" id="radix-«R1fd97nqt7b»-content-zod-mini" tabindex="0"><figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4-mini&#34;</span><span>;</span></span>
<span> </span>
<span><span>z.</span><span>array</span><span>(z.</span><span>number</span><span>()).</span><span>check</span><span>(</span></span>
<span><span>  z.</span><span>minLength</span><span>(</span><span>5</span><span>), </span></span>
<span><span>  z.</span><span>maxLength</span><span>(</span><span>10</span><span>),</span></span>
<span><span>  z.</span><span>refine</span><span>(</span><span>arr</span><span> =&gt;</span><span> arr.</span><span>includes</span><span>(</span><span>5</span><span>))</span></span>
<span><span>);</span></span></code></pre></div></div></div></figure></div></div>
<p>The following top-level refinements are available in <code>zod/v4-mini</code>. It should be fairly self-explanatory which methods they correspond to.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4-mini&#34;</span><span>;</span></span>
<span> </span>
<span><span>// custom checks</span></span>
<span><span>z.</span><span>refine</span><span>();</span></span>
<span> </span>
<span><span>// first-class checks</span></span>
<span><span>z.</span><span>lt</span><span>(value);</span></span>
<span><span>z.</span><span>lte</span><span>(value); </span><span>// alias: z.maximum()</span></span>
<span><span>z.</span><span>gt</span><span>(value);</span></span>
<span><span>z.</span><span>gte</span><span>(value); </span><span>// alias: z.minimum()</span></span>
<span><span>z.</span><span>positive</span><span>();</span></span>
<span><span>z.</span><span>negative</span><span>();</span></span>
<span><span>z.</span><span>nonpositive</span><span>();</span></span>
<span><span>z.</span><span>nonnegative</span><span>();</span></span>
<span><span>z.</span><span>multipleOf</span><span>(value);</span></span>
<span><span>z.</span><span>maxSize</span><span>(value);</span></span>
<span><span>z.</span><span>minSize</span><span>(value);</span></span>
<span><span>z.</span><span>size</span><span>(value);</span></span>
<span><span>z.</span><span>maxLength</span><span>(value);</span></span>
<span><span>z.</span><span>minLength</span><span>(value);</span></span>
<span><span>z.</span><span>length</span><span>(value);</span></span>
<span><span>z.</span><span>regex</span><span>(regex);</span></span>
<span><span>z.</span><span>lowercase</span><span>();</span></span>
<span><span>z.</span><span>uppercase</span><span>();</span></span>
<span><span>z.</span><span>includes</span><span>(value);</span></span>
<span><span>z.</span><span>startsWith</span><span>(value);</span></span>
<span><span>z.</span><span>endsWith</span><span>(value);</span></span>
<span><span>z.</span><span>property</span><span>(key, schema); </span><span>// for object schemas; check `input[key]` against `schema`</span></span>
<span><span>z.</span><span>mime</span><span>(value); </span><span>// for file schemas (see below)</span></span>
<span> </span>
<span><span>// overwrites (these *do not* change the inferred type!)</span></span>
<span><span>z.</span><span>overwrite</span><span>(</span><span>value</span><span> =&gt;</span><span> newValue);</span></span>
<span><span>z.</span><span>normalize</span><span>();</span></span>
<span><span>z.</span><span>trim</span><span>();</span></span>
<span><span>z.</span><span>toLowerCase</span><span>();</span></span>
<span><span>z.</span><span>toUpperCase</span><span>();</span></span></code></pre></div></div></div></figure>
<p>This more functional API makes it easier for bundlers to tree-shaking the APIs you don&#39;t use. While <code>zod/v4</code> is still recommended for the majority of use cases, any projects with uncommonly strict bundle size constraints should consider <code>zod/v4-mini</code>.</p>
<h3 id="66x-reduction-in-core-bundle-size"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=66x-reduction-in-core-bundle-size">6.6x reduction in core bundle size</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>Here&#39;s the script from above, updated to use <code>&#34;zod/v4-mini&#34;</code> instead of <code>&#34;zod&#34;</code>.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4-mini&#34;</span><span>;</span></span>
<span> </span>
<span><span>const</span><span> schema</span><span> =</span><span> z.</span><span>boolean</span><span>();</span></span>
<span><span>schema.</span><span>parse</span><span>(</span><span>false</span><span>);</span></span></code></pre></div></div></div></figure>
<p>When we build this with <code>rollup</code>, the gzipped bundle size is <code>1.88kb</code>. That&#39;s an 85% (6.6x) reduction in core bundle size compared to <code>zod@3</code>.</p>
<div><table><thead><tr><th>Package</th><th>Bundle (gzip)</th></tr></thead><tbody><tr><td><code>zod/v3</code></td><td><code>12.47kb</code></td></tr><tr><td><code>zod/v4</code></td><td><code>5.36kb</code></td></tr><tr><td><code>zod/v4-mini</code></td><td><code>1.88kb</code></td></tr></tbody></table></div>
<p>Learn more on the dedicated <a href="https://todaythings.substack.com/packages/mini"><code>zod/v4-mini</code></a> docs page. Complete API details are mixed into existing documentation pages; code blocks contain separate tabs for <code>&#34;Zod&#34;</code> and <code>&#34;Zod Mini&#34;</code> wherever their APIs diverge.</p>
<h2 id="metadata"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=metadata">Metadata</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Zod 4 introduces a new system for adding strongly-typed metadata to your schemas. Metadata isn&#39;t stored inside the schema itself; instead it&#39;s stored in a &#34;schema registry&#34; that associates a schema with some typed metadata. To create a registry with <code>z.registry()</code>:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4&#34;</span><span>;</span></span>
<span> </span>
<span><span>const</span><span> myRegistry</span><span> =</span><span> z.</span><span>registry</span><span>&lt;{ </span><span>title</span><span>:</span><span> string</span><span>; </span><span>description</span><span>:</span><span> string</span><span> }&gt;();</span></span></code></pre></div></div></div></figure>
<p>To add schemas to your registry:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> emailSchema</span><span> =</span><span> z.</span><span>string</span><span>().</span><span>email</span><span>();</span></span>
<span> </span>
<span><span>myRegistry.</span><span>add</span><span>(emailSchema, { title: </span><span>&#34;Email address&#34;</span><span>, description: </span><span>&#34;...&#34;</span><span> });</span></span>
<span><span>myRegistry.</span><span>get</span><span>(emailSchema);</span></span>
<span><span>// =&gt; { title: &#34;Email address&#34;, ... }</span></span></code></pre></div></div></div></figure>
<p>Alternatively, you can use the <code>.register()</code> method on a schema for convenience:</p>
<!-- -->
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>emailSchema.</span><span>register</span><span>(myRegistry, { title: </span><span>&#34;Email address&#34;</span><span>, description: </span><span>&#34;...&#34;</span><span> })</span></span>
<span><span>// =&gt; returns emailSchema</span></span></code></pre></div></div></div></figure>
<h3 id="the-global-registry"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=the-global-registry">The global registry</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>Zod also exports a global registry <code>z.globalRegistry</code> that accepts some common JSON Schema-compatible metadata:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.globalRegistry.</span><span>add</span><span>(z.</span><span>string</span><span>(), { </span></span>
<span><span>  id: </span><span>&#34;email_address&#34;</span><span>,</span></span>
<span><span>  title: </span><span>&#34;Email address&#34;</span><span>,</span></span>
<span><span>  description: </span><span>&#34;Provide your email&#34;</span><span>,</span></span>
<span><span>  examples: [</span><span>&#34;naomie@example.com&#34;</span><span>],</span></span>
<span><span>  extraKey: </span><span>&#34;Additional properties are also allowed&#34;</span></span>
<span><span>});</span></span></code></pre></div></div></div></figure>
<h3 id="meta"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=meta"><code>.meta()</code></a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>To conveniently add a schema to <code>z.globalRegistry</code>, use the <code>.meta()</code> method.</p>
<!-- -->
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>string</span><span>().</span><span>meta</span><span>({ </span></span>
<span><span>  id: </span><span>&#34;email_address&#34;</span><span>,</span></span>
<span><span>  title: </span><span>&#34;Email address&#34;</span><span>,</span></span>
<span><span>  description: </span><span>&#34;Provide your email&#34;</span><span>,</span></span>
<span><span>  examples: [</span><span>&#34;naomie@example.com&#34;</span><span>],</span></span>
<span><span>  // ...</span></span>
<span><span>});</span></span></code></pre></div></div></div></figure>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><div><p>For compatibility with Zod 3, <code>.describe()</code> is still available, but <code>.meta()</code> is preferred.</p><figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>string</span><span>().</span><span>describe</span><span>(</span><span>&#34;An email address&#34;</span><span>);</span></span>
<span> </span>
<span><span>// equivalent to</span></span>
<span><span>z.</span><span>string</span><span>().</span><span>meta</span><span>({ description: </span><span>&#34;An email address&#34;</span><span> });</span></span></code></pre></div></div></div></figure></div></div></div>
<h2 id="json-schema-conversion"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=json-schema-conversion">JSON Schema conversion</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Zod 4 introduces first-party JSON Schema conversion via <code>z.toJSONSchema()</code>.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4&#34;</span><span>;</span></span>
<span> </span>
<span><span>const</span><span> mySchema</span><span> =</span><span> z.</span><span>object</span><span>({name: z.</span><span>string</span><span>(), points: z.</span><span>number</span><span>()});</span></span>
<span> </span>
<span><span>z.</span><span>toJSONSchema</span><span>(mySchema);</span></span>
<span><span>// =&gt; {</span></span>
<span><span>//   type: &#34;object&#34;,</span></span>
<span><span>//   properties: {</span></span>
<span><span>//     name: {type: &#34;string&#34;},</span></span>
<span><span>//     points: {type: &#34;number&#34;},</span></span>
<span><span>//   },</span></span>
<span><span>//   required: [&#34;name&#34;, &#34;points&#34;],</span></span>
<span><span>// }</span></span></code></pre></div></div></div></figure>
<p>Any metadata in <code>z.globalRegistry</code> is automatically included in the JSON Schema output.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> mySchema</span><span> =</span><span> z.</span><span>object</span><span>({</span></span>
<span><span>  firstName: z.</span><span>string</span><span>().</span><span>describe</span><span>(</span><span>&#34;Your first name&#34;</span><span>),</span></span>
<span><span>  lastName: z.</span><span>string</span><span>().</span><span>meta</span><span>({ title: </span><span>&#34;last_name&#34;</span><span> }),</span></span>
<span><span>  age: z.</span><span>number</span><span>().</span><span>meta</span><span>({ examples: [</span><span>12</span><span>, </span><span>99</span><span>] }),</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>z.</span><span>toJSONSchema</span><span>(mySchema);</span></span>
<span><span>// =&gt; {</span></span>
<span><span>//   type: &#39;object&#39;,</span></span>
<span><span>//   properties: {</span></span>
<span><span>//     firstName: { type: &#39;string&#39;, description: &#39;Your first name&#39; },</span></span>
<span><span>//     lastName: { type: &#39;string&#39;, title: &#39;last_name&#39; },</span></span>
<span><span>//     age: { type: &#39;number&#39;, examples: [ 12, 99 ] }</span></span>
<span><span>//   },</span></span>
<span><span>//   required: [ &#39;firstName&#39;, &#39;lastName&#39;, &#39;age&#39; ]</span></span>
<span><span>// }</span></span></code></pre></div></div></div></figure>
<p>Refer to the <a href="https://todaythings.substack.com/json-schema">JSON Schema docs</a> for information on customizing the generated JSON Schema.</p>
<h2 id="recursive-objects"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=recursive-objects">Recursive objects</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>This was an unexpected on. After years of trying to crack this problem, I finally <a href="https://x.com/colinhacks/status/1919286275133378670" rel="noreferrer noopener" target="_blank">found a way</a> to properly infer recursive object types in Zod. To define a recursive type:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> Category</span><span> =</span><span> z.</span><span>object</span><span>({</span></span>
<span><span>  name: z.</span><span>string</span><span>(),</span></span>
<span><span>  get</span><span> subcategories</span><span>(){</span></span>
<span><span>    return</span><span> z.</span><span>array</span><span>(Category)</span></span>
<span><span>  }</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>type</span><span> Category</span><span> =</span><span> z</span><span>.</span><span>infer</span><span>&lt;</span><span>typeof</span><span> Category&gt;;</span></span>
<span><span>// { name: string; subcategories: Category[] }</span></span></code></pre></div></div></div></figure>
<p>You can also represent <em>mutually recursive types</em>:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> User</span><span> =</span><span> z.</span><span>object</span><span>({</span></span>
<span><span>  email: z.</span><span>email</span><span>(),</span></span>
<span><span>  get</span><span> posts</span><span>(){</span></span>
<span><span>    return</span><span> z.</span><span>array</span><span>(Post)</span></span>
<span><span>  }</span></span>
<span><span>});</span></span>
<span> </span>
<span><span>const</span><span> Post</span><span> =</span><span> z.</span><span>object</span><span>({</span></span>
<span><span>  title: z.</span><span>string</span><span>(),</span></span>
<span><span>  get</span><span> author</span><span>(){</span></span>
<span><span>    return</span><span> User</span></span>
<span><span>  }</span></span>
<span><span>});</span></span></code></pre></div></div></div></figure>
<p>Unlike the Zod 3 pattern for recursive types, there&#39;s no type casting required. The resulting schemas are plain <code>ZodObject</code> instances and have the full set of methods available.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>Post.</span><span>pick</span><span>({ title: </span><span>true</span><span> })</span></span>
<span><span>Post.</span><span>partial</span><span>();</span></span>
<span><span>Post.</span><span>extend</span><span>({ publishDate: z.</span><span>date</span><span>() });</span></span></code></pre></div></div></div></figure>
<h2 id="file-schemas"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=file-schemas">File schemas</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>To validate <code>File</code> instances:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> fileSchema</span><span> =</span><span> z.</span><span>file</span><span>();</span></span>
<span> </span>
<span><span>fileSchema.</span><span>min</span><span>(</span><span>10_000</span><span>); </span><span>// minimum .size (bytes)</span></span>
<span><span>fileSchema.</span><span>max</span><span>(</span><span>1_000_000</span><span>); </span><span>// maximum .size (bytes)</span></span>
<span><span>fileSchema.</span><span>type</span><span>(</span><span>&#34;image/png&#34;</span><span>); </span><span>// MIME type</span></span></code></pre></div></div></div></figure>
<h2 id="internationalization"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=internationalization">Internationalization</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Zod 4 introduces a new <code>locales</code> API for globally translating error messages into different languages.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>import</span><span> { z } </span><span>from</span><span> &#34;zod/v4&#34;</span><span>;</span></span>
<span> </span>
<span><span>// configure English locale (default)</span></span>
<span><span>z.</span><span>config</span><span>(z.locales.</span><span>en</span><span>());</span></span></code></pre></div></div></div></figure>
<p>At the time of this writing only the English locale is available; There will be a call for pull request from the community shortly; this section will be updated with a list of supported languages as they become available.</p>
<h2 id="error-pretty-printing"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=error-pretty-printing">Error pretty-printing</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>The popularity of the <a href="https://www.npmjs.com/package/zod-validation-error" rel="noreferrer noopener" target="_blank"><code>zod-validation-error</code></a> package demonstrates that there&#39;s significant demand for an official API for pretty-printing errors. If you are using that package currently, by all means continue using it.</p>
<p>Zod now implements a top-level <code>z.prettifyError</code> function for converting a <code>ZodError</code> to a user-friendly formatted string.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> myError</span><span> =</span><span> new</span><span> z.</span><span>ZodError</span><span>([</span></span>
<span><span>  {</span></span>
<span><span>    code: </span><span>&#39;unrecognized_keys&#39;</span><span>,</span></span>
<span><span>    keys: [ </span><span>&#39;extraField&#39;</span><span> ],</span></span>
<span><span>    path: [],</span></span>
<span><span>    message: </span><span>&#39;Unrecognized key: &#34;extraField&#34;&#39;</span></span>
<span><span>  },</span></span>
<span><span>  {</span></span>
<span><span>    expected: </span><span>&#39;string&#39;</span><span>,</span></span>
<span><span>    code: </span><span>&#39;invalid_type&#39;</span><span>,</span></span>
<span><span>    path: [ </span><span>&#39;username&#39;</span><span> ],</span></span>
<span><span>    message: </span><span>&#39;Invalid input: expected string, received number&#39;</span></span>
<span><span>  },</span></span>
<span><span>  {</span></span>
<span><span>    origin: </span><span>&#39;number&#39;</span><span>,</span></span>
<span><span>    code: </span><span>&#39;too_small&#39;</span><span>,</span></span>
<span><span>    minimum: </span><span>0</span><span>,</span></span>
<span><span>    inclusive: </span><span>true</span><span>,</span></span>
<span><span>    path: [ </span><span>&#39;favoriteNumbers&#39;</span><span>, </span><span>1</span><span> ],</span></span>
<span><span>    message: </span><span>&#39;Too small: expected number to be &gt;=0&#39;</span></span>
<span><span>  }</span></span>
<span><span>]);</span></span>
<span> </span>
<span><span>z.</span><span>prettifyError</span><span>(myError);</span></span></code></pre></div></div></div></figure>
<p>This returns the following pretty-printable multi-line string:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>✖ Unrecognized </span><span>key</span><span>: </span><span>&#34;extraField&#34;</span></span>
<span><span>✖ Invalid </span><span>input</span><span>: expected string, received number</span></span>
<span><span>  → at username</span></span>
<span><span>✖ Invalid </span><span>input</span><span>: expected number, received string</span></span>
<span><span>  → at favoriteNumbers[</span><span>1</span><span>]</span></span></code></pre></div></div></div></figure>
<p>Currently the formatting isn&#39;t configurable; this may change in the future.</p>
<h2 id="top-level-string-formats"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=top-level-string-formats">Top-level string formats</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>All &#34;string formats&#34; (email, etc.) have been promoted to top-level functions on the <code>z</code> module. This is both more concise and more tree-shakable. The method equivalents (<code>z.string().email()</code>, etc.) are still available but have been deprecated. They&#39;ll be removed in the next major version.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>email</span><span>();</span></span>
<span><span>z.</span><span>uuidv4</span><span>();</span></span>
<span><span>z.</span><span>uuidv7</span><span>();</span></span>
<span><span>z.</span><span>uuidv8</span><span>();</span></span>
<span><span>z.</span><span>ipv4</span><span>();</span></span>
<span><span>z.</span><span>ipv6</span><span>();</span></span>
<span><span>z.</span><span>cidrv4</span><span>();</span></span>
<span><span>z.</span><span>cidrv6</span><span>();</span></span>
<span><span>z.</span><span>url</span><span>();</span></span>
<span><span>z.</span><span>e164</span><span>();</span></span>
<span><span>z.</span><span>base64</span><span>();</span></span>
<span><span>z.</span><span>base64url</span><span>();</span></span>
<span><span>z.</span><span>jwt</span><span>();</span></span>
<span><span>z.</span><span>ascii</span><span>();</span></span>
<span><span>z.</span><span>utf8</span><span>();</span></span>
<span><span>z.</span><span>lowercase</span><span>();</span></span>
<span><span>z.iso.</span><span>date</span><span>();</span></span>
<span><span>z.iso.</span><span>datetime</span><span>();</span></span>
<span><span>z.iso.</span><span>duration</span><span>();</span></span>
<span><span>z.iso.</span><span>time</span><span>();</span></span></code></pre></div></div></div></figure>
<h3 id="custom-email-regex"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=custom-email-regex">Custom email regex</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>The <code>z.email()</code> API now supports a custom regular expression. There is no one canonical email regex; different applications may choose to be more or less strict. For convenience Zod exports some common ones.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>// Zod&#39;s default email regex (Gmail rules)</span></span>
<span><span>// see colinhacks.com/essays/reasonable-email-regex</span></span>
<span><span>z.</span><span>email</span><span>(); </span><span>// z.regexes.email</span></span>
<span> </span>
<span><span>// the regex used by browsers to validate input[type=email] fields</span></span>
<span><span>// https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/email</span></span>
<span><span>z.</span><span>email</span><span>({ pattern: z.regexes.html5Email });</span></span>
<span> </span>
<span><span>// the classic emailregex.com regex (RFC 5322)</span></span>
<span><span>z.</span><span>email</span><span>({ pattern: z.regexes.rfc5322Email });</span></span>
<span> </span>
<span><span>// a loose regex that allows Unicode (good for intl emails)</span></span>
<span><span>z.</span><span>email</span><span>({ pattern: z.regexes.unicodeEmail });</span></span></code></pre></div></div></div></figure>
<h2 id="template-literal-types"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=template-literal-types">Template literal types</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Zod 4 implements <code>z.templateLiteral()</code>. Template literal types are perhaps the biggest feature of TypeScript&#39;s type system that wasn&#39;t previously representable.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> hello</span><span> =</span><span> z.</span><span>templateLiteral</span><span>([</span><span>&#34;hello, &#34;</span><span>, z.</span><span>string</span><span>()]);</span></span>
<span><span>// `hello, ${string}`</span></span>
<span> </span>
<span><span>const</span><span> cssUnits</span><span> =</span><span> z.</span><span>enum</span><span>([</span><span>&#34;px&#34;</span><span>, </span><span>&#34;em&#34;</span><span>, </span><span>&#34;rem&#34;</span><span>, </span><span>&#34;%&#34;</span><span>]);</span></span>
<span><span>const</span><span> css</span><span> =</span><span> z.</span><span>templateLiteral</span><span>([z.</span><span>number</span><span>(), cssUnits]);</span></span>
<span><span>// `${number}px` | `${number}em` | `${number}rem` | `${number}%`</span></span>
<span> </span>
<span><span>const</span><span> email</span><span> =</span><span> z.</span><span>templateLiteral</span><span>([</span></span>
<span><span>  z.</span><span>string</span><span>().</span><span>min</span><span>(</span><span>1</span><span>),</span></span>
<span><span>  &#34;@&#34;</span><span>,</span></span>
<span><span>  z.</span><span>string</span><span>().</span><span>max</span><span>(</span><span>64</span><span>),</span></span>
<span><span>]);</span></span>
<span><span>// `${string}@${string}` (the min/max refinements are enforced!)</span></span></code></pre></div></div></div></figure>
<p>Every Zod schema type that can be stringified stores an internal regex: strings, string formats like <code>z.email()</code>, numbers, boolean, bigint, enums, literals, undefined/optional, null/nullable, and other template literals. The <code>z.templateLiteral</code> constructor concatenates these into a super-regex, so things like string formats (<code>z.email()</code>) are properly enforced (but custom refinements are not!).</p>
<p>Read the <a href="https://todaythings.substack.com/api#template-literals">template literal docs</a> for more info.</p>
<h2 id="number-formats"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=number-formats">Number formats</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>New numeric &#34;formats&#34; have been added for representing fixed-width integer and float types. These return a <code>ZodNumber</code> instance with proper minimum/maximum constraints already added.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>int</span><span>();      </span><span>// [Number.MIN_SAFE_INTEGER, Number.MAX_SAFE_INTEGER],</span></span>
<span><span>z.</span><span>float32</span><span>();  </span><span>// [-3.4028234663852886e38, 3.4028234663852886e38]</span></span>
<span><span>z.</span><span>float64</span><span>();  </span><span>// [-1.7976931348623157e308, 1.7976931348623157e308]</span></span>
<span><span>z.</span><span>int32</span><span>();    </span><span>// [-2147483648, 2147483647]</span></span>
<span><span>z.</span><span>uint32</span><span>();   </span><span>// [0, 4294967295]</span></span></code></pre></div></div></div></figure>
<p>Similarly the following <code>bigint</code> numeric formats have also been added. These integer types exceed what can be safely represented by a <code>number</code> in JavaScript, so these return a <code>ZodBigInt</code> instance with the proper minimum/maximum constraints already added.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>int64</span><span>();    </span><span>// [-9223372036854775808n, 9223372036854775807n]</span></span>
<span><span>z.</span><span>uint64</span><span>();   </span><span>// [0n, 18446744073709551615n]</span></span></code></pre></div></div></div></figure>
<h2 id="stringbool"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=stringbool">Stringbool</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>The existing <code>z.coerce.boolean()</code> API is very simple: falsy values (<code>false</code>, <code>undefined</code>, <code>null</code>, <code>0</code>, <code>&#34;&#34;</code>, <code>NaN</code> etc) become <code>false</code>, truthy values become <code>true</code>.</p>
<p>This is still a good API, and its behavior aligns with the other <code>z.coerce</code> APIs. But some users requested a more sophisticated &#34;env-style&#34; boolean coercion. To support this, Zod 4 introduces <code>z.stringbool()</code>:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> strbool</span><span> =</span><span> z.</span><span>stringbool</span><span>();</span></span>
<span> </span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;true&#34;</span><span>)         </span><span>// =&gt; true</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;1&#34;</span><span>)            </span><span>// =&gt; true</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;yes&#34;</span><span>)          </span><span>// =&gt; true</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;on&#34;</span><span>)           </span><span>// =&gt; true</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;y&#34;</span><span>)            </span><span>// =&gt; true</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;enable&#34;</span><span>)       </span><span>// =&gt; true</span></span>
<span> </span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;false&#34;</span><span>);       </span><span>// =&gt; false</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;0&#34;</span><span>);           </span><span>// =&gt; false</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;no&#34;</span><span>);          </span><span>// =&gt; false</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;off&#34;</span><span>);         </span><span>// =&gt; false</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;n&#34;</span><span>);           </span><span>// =&gt; false</span></span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>&#34;disabled&#34;</span><span>);    </span><span>// =&gt; false</span></span>
<span> </span>
<span><span>strbool.</span><span>parse</span><span>(</span><span>/* anything else */</span><span>); </span><span>// ZodError&lt;[{ code: &#34;invalid_value&#34; }]&gt;</span></span></code></pre></div></div></div></figure>
<p>To customize the truthy and falsy values:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>stringbool</span><span>({</span></span>
<span><span>  truthy: [</span><span>&#34;yes&#34;</span><span>, </span><span>&#34;true&#34;</span><span>],</span></span>
<span><span>  falsy: [</span><span>&#34;no&#34;</span><span>, </span><span>&#34;false&#34;</span><span>]</span></span>
<span><span>})</span></span></code></pre></div></div></div></figure>
<p>Refer to the <a href="https://todaythings.substack.com/api#stringbools"><code>z.stringbool()</code> docs</a> for more information.</p>
<h2 id="simplified-error-customization"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=simplified-error-customization">Simplified error customization</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>The majority of breaking changes in Zod 4 involve the <em>error customization</em> APIs. They were a bit of a mess in Zod 3; Zod 4 makes things significantly more elegant, to the point where I think it&#39;s worth highlighting here.</p>
<p>Long story short, there is now a single, unified <code>error</code> parameter for customizing errors, replacing the following APIs:</p>
<p>Replace <code>message</code> with <code>error</code>. (The <code>message</code> parameter is still supported but deprecated.)</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>- z.string().min(5, { message: &#34;Too short.&#34; });</span></span>
<span><span>+ z.string().min(5, { error: &#34;Too short.&#34; });</span></span></code></pre></div></div></div></figure>
<p>Replace <code>invalid_type_error</code> and <code>required_error</code> with <code>error</code> (function syntax):</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>// Zod 3</span></span>
<span><span>- z.string({ </span></span>
<span><span>-   required_error: &#34;This field is required&#34; </span></span>
<span><span>-   invalid_type_error: &#34;Not a string&#34;, </span></span>
<span><span>- });</span></span>
<span> </span>
<span><span>// Zod 4 </span></span>
<span><span>+ z.string({ error: (issue) =&gt; issue.input === undefined ? </span></span>
<span><span>+  &#34;This field is required&#34; :</span></span>
<span><span>+  &#34;Not a string&#34; </span></span>
<span><span>+ });</span></span></code></pre></div></div></div></figure>
<p>Replace <code>errorMap</code> with <code>error</code> (function syntax):</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>// Zod 3 </span></span>
<span><span>- z.string({</span></span>
<span><span>-   errorMap: (issue, ctx) =&gt; {</span></span>
<span><span>-     if (issue.code === &#34;too_small&#34;) {</span></span>
<span><span>-       return { message: `Value must be &gt;${issue.minimum}` };</span></span>
<span><span>-     }</span></span>
<span><span>-     return { message: ctx.defaultError };</span></span>
<span><span>-   },</span></span>
<span><span>- });</span></span>
<span> </span>
<span><span>// Zod 4</span></span>
<span><span>+ z.string({</span></span>
<span><span>+   error: (issue) =&gt; {</span></span>
<span><span>+     if (issue.code === &#34;too_small&#34;) {</span></span>
<span><span>+       return `Value must be &gt;${issue.minimum}`</span></span>
<span><span>+     }</span></span>
<span><span>+   },</span></span>
<span><span>+ });</span></span></code></pre></div></div></div></figure>
<h2 id="upgraded-zdiscriminatedunion"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=upgraded-zdiscriminatedunion">Upgraded <code>z.discriminatedUnion()</code></a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Discriminated unions now support a number of schema types not previously supported, including unions, pipes, and nested objects:</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> MyResult</span><span> =</span><span> z.</span><span>discriminatedUnion</span><span>(</span><span>&#34;status&#34;</span><span>, [</span></span>
<span><span>  // simple literal</span></span>
<span><span>  z.</span><span>object</span><span>({ status: z.</span><span>literal</span><span>(</span><span>&#34;aaa&#34;</span><span>), data: z.</span><span>string</span><span>() }),</span></span>
<span><span>  // union discriminator</span></span>
<span><span>  z.</span><span>object</span><span>({ status: z.</span><span>union</span><span>([z.</span><span>literal</span><span>(</span><span>&#34;bbb&#34;</span><span>), z.</span><span>literal</span><span>(</span><span>&#34;ccc&#34;</span><span>)]) }),</span></span>
<span><span>  // pipe discriminator</span></span>
<span><span>  z.</span><span>object</span><span>({ status: z.</span><span>object</span><span>({ value: z.</span><span>literal</span><span>(</span><span>&#34;fail&#34;</span><span>) }) }),</span></span>
<span><span>]);</span></span></code></pre></div></div></div></figure>
<p>Perhaps most importantly, discriminated unions now <em>compose</em>—you can use one discriminated union as a member of another.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> BaseError</span><span> =</span><span> z.</span><span>object</span><span>({ status: z.</span><span>literal</span><span>(</span><span>&#34;failed&#34;</span><span>), message: z.</span><span>string</span><span>() });</span></span>
<span><span>const</span><span> MyErrors</span><span> =</span><span> z.</span><span>discriminatedUnion</span><span>(</span><span>&#34;code&#34;</span><span>, [</span></span>
<span><span>  BaseError.</span><span>extend</span><span>({ code: z.</span><span>literal</span><span>(</span><span>400</span><span>) }),</span></span>
<span><span>  BaseError.</span><span>extend</span><span>({ code: z.</span><span>literal</span><span>(</span><span>401</span><span>) }),</span></span>
<span><span>  BaseError.</span><span>extend</span><span>({ code: z.</span><span>literal</span><span>(</span><span>500</span><span>) })</span></span>
<span><span>]);</span></span>
<span> </span>
<span><span>const</span><span> MyResult</span><span> =</span><span> z.</span><span>discriminatedUnion</span><span>(</span><span>&#34;status&#34;</span><span>, [</span></span>
<span><span>  z.</span><span>object</span><span>({ status: z.</span><span>literal</span><span>(</span><span>&#34;success&#34;</span><span>), data: z.</span><span>string</span><span>() }),</span></span>
<span><span>  MyErrors</span></span>
<span><span>]);</span></span></code></pre></div></div></div></figure>
<h2 id="multiple-values-in-zliteral"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=multiple-values-in-zliteral">Multiple values in <code>z.literal()</code></a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>The <code>z.literal()</code> API now optionally supports multiple values.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> httpCodes</span><span> =</span><span> z.</span><span>literal</span><span>([ </span><span>200</span><span>, </span><span>201</span><span>, </span><span>202</span><span>, </span><span>204</span><span>, </span><span>206</span><span>, </span><span>207</span><span>, </span><span>208</span><span>, </span><span>226</span><span> ]);</span></span>
<span> </span>
<span><span>// previously in Zod 3:</span></span>
<span><span>const</span><span> httpCodes</span><span> =</span><span> z.</span><span>union</span><span>([</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>200</span><span>),</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>201</span><span>),</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>202</span><span>),</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>204</span><span>),</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>206</span><span>),</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>207</span><span>),</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>208</span><span>),</span></span>
<span><span>  z.</span><span>literal</span><span>(</span><span>226</span><span>)</span></span>
<span><span>]);</span></span></code></pre></div></div></div></figure>
<h2 id="refinements-live-inside-schemas"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=refinements-live-inside-schemas">Refinements live inside schemas</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>In Zod 3, they were stored in a <code>ZodEffects</code> class that wrapped the original schema. This was inconvenient, as it meant you couldn&#39;t interleave <code>.refine()</code> with other schema methods like <code>.min()</code>.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>string</span><span>()</span></span>
<span><span>  .</span><span>refine</span><span>(</span><span>val</span><span> =&gt;</span><span> val.</span><span>includes</span><span>(</span><span>&#34;@&#34;</span><span>))</span></span>
<span><span>  .</span><span>min</span><span>(</span><span>5</span><span>);</span></span>
<span><span>// ^ ❌ Property &#39;min&#39; does not exist on type ZodEffects&lt;ZodString, string, string&gt;</span></span></code></pre></div></div></div></figure>
<p>In Zod 4, refinements are stored inside the schemas themselves, so the code above works as expected.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>string</span><span>()</span></span>
<span><span>  .</span><span>refine</span><span>(</span><span>val</span><span> =&gt;</span><span> val.</span><span>includes</span><span>(</span><span>&#34;@&#34;</span><span>))</span></span>
<span><span>  .</span><span>min</span><span>(</span><span>5</span><span>); </span><span>// ✅</span></span></code></pre></div></div></div></figure>
<h3 id="overwrite"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=overwrite"><code>.overwrite()</code></a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h3>
<p>The <code>.transform()</code> method is extremely useful, but it has one major downside: the output type is no longer <em>introspectable</em> at runtime. The transform function is a black box that can return anything. This means (among other things) there&#39;s no sound way to convert the schema to JSON Schema.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>const</span><span> Squared</span><span> =</span><span> z.</span><span>number</span><span>().</span><span>transform</span><span>(</span><span>val</span><span> =&gt;</span><span> val </span><span>**</span><span> 2</span><span>);</span></span>
<span><span>// =&gt; ZodPipe&lt;ZodNumber, ZodTransform&gt;</span></span></code></pre></div></div></div></figure>
<p>Zod 4 introduces a new <code>.overwrite()</code> method for representing transforms that <em>don&#39;t change the inferred type</em>. Unlike <code>.transform()</code>, this method returns an instance of the original class. The overwrite function is stored as a refinement, so it doesn&#39;t (and can&#39;t) modify the inferred type.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>z.</span><span>number</span><span>().</span><span>overwrite</span><span>(</span><span>val</span><span> =&gt;</span><span> val </span><span>**</span><span> 2</span><span>).</span><span>max</span><span>(</span><span>100</span><span>);</span></span>
<span><span>// =&gt; ZodNumber</span></span></code></pre></div></div></div></figure>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p>The existing <code>.trim()</code>, <code>.toLowerCase()</code> and <code>.toUpperCase()</code> methods have been reimplemented using <code>.overwrite()</code>.</p></div></div>
<h2 id="an-extensible-foundation-zodv4core"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=an-extensible-foundation-zodv4core">An extensible foundation: <code>zod/v4/core</code></a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>While this will not be relevant to the majority of Zod users, it&#39;s worth highlighting. The addition of <code>zod/v4-mini</code> necessitated the creation of a shared sub-package <code>zod/v4/core</code> which contains the core functionality shared between <code>zod/v4</code> and <code>zod/v4-mini</code>.</p>
<p>I was resistant to this at first, but now I see it as one of Zod 4&#39;s most important features. It lets Zod level up from a simple library to a fast validation &#34;substrate&#34; that can be sprinkled into other libraries.</p>
<p>If you&#39;re building a schema library, refer to the implementations of <code>zod/v4</code> and <code>zod/v4-mini</code> to see how to build on top of the foundation <code>zod/v4/core</code> provides. Don&#39;t hesitate to get in touch in GitHub discussions or via <a href="https://x.com/colinhacks" rel="noreferrer noopener" target="_blank">X</a>/<a href="https://bsky.app/profile/colinhacks.com" rel="noreferrer noopener" target="_blank">Bluesky</a> for help or feedback.</p>
<h2 id="wrapping-up"><a data-card="" href="https://todaythings.substack.com/p/how-many-calories-from-a-pumpkin?id=wrapping-up">Wrapping up</a><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-label="Link to section"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>I&#39;m planning to write up a series of additional posts explaining the design process behind some major features like <code>zod/v4-mini</code>. I&#39;ll update this section as those get posted.</p>
<p>For library authors, there is now a dedicated <a href="https://todaythings.substack.com/library-authors">For library authors</a> guide that describes the best practices for building on top of Zod. It answers common questions about how to support Zod 3 &amp; Zod 4 (including Mini) simultaneously.</p>
<figure tabindex="0"><div dir="ltr"><div data-radix-scroll-area-viewport=""><div><pre><code><span><span>pnpm</span><span> upgrade</span><span> zod@^3.25.0</span></span></code></pre></div></div></div></figure>
<p>Happy parsing!</p></div></div>
  </body>
</html>
