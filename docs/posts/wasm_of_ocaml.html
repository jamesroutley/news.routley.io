<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ocaml-wasm/wasm_of_ocaml">Original</a>
    <h1>Wasm_of_OCaml</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Wasm_of_ocaml is a fork of Js_of_ocaml which compiles OCaml bytecode to WebAssembly.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-requirements" aria-hidden="true" href="#requirements"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Requirements</h2>
<p dir="auto">Wasm_of_ocaml relies on the Binaryen toolchain. At the moment, you need to install it <a href="https://github.com/WebAssembly/binaryen/">from the main branch on GitHub</a>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-supported-engines" aria-hidden="true" href="#supported-engines"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Supported engines</h2>
<p dir="auto">The generated code works with <a href="https://www.google.com/chrome/beta/" rel="nofollow">Chrome beta</a> and <a href="https://nodejs.org/download/v8-canary/v21.0.0-v8-canary20230711fb76fe1ec2/" rel="nofollow">node V8 canary</a>. For Chrome, you need to enable WebAssembly Garbage Collection and WebAssembly Stringref from chrome://flags/. For node, you need to use the following flags:<code>--experimental-wasm-gc  --experimental-wasm-stringref</code>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Installation</h2>
<p dir="auto">The following commands will perform a minimal installation:</p>
<div data-snippet-clipboard-copy-content="opam pin add -n --with-version 5.3.0 .
opam install wasm_of_ocaml-compiler"><pre><code>opam pin add -n --with-version 5.3.0 .
opam install wasm_of_ocaml-compiler
</code></pre></div>
<p dir="auto">You may want to install additional packages. For instance:</p>
<div data-snippet-clipboard-copy-content="opam install js_of_ocaml-ppx js_of_ocaml-lwt"><pre><code>opam install js_of_ocaml-ppx js_of_ocaml-lwt
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Usage</h2>
<p dir="auto">You can try compiling the program in <code>examples/cubes</code>. Your program must first be compiled using the OCaml bytecode compiler <code>ocamlc</code>. JavaScript bindings are provided by the <code>js_of_ocaml</code> package. The syntax extension is provided by <code>js_of_ocaml-ppx</code> package. Package <code>js_of_ocaml-lwt</code> provides Javascript specific Lwt functions.</p>
<div data-snippet-clipboard-copy-content="ocamlfind ocamlc -package js_of_ocaml,js_of_ocaml-ppx,js_of_ocaml-lwt -linkpkg -o cubes.byte cubes.mli cubes.ml"><pre><code>ocamlfind ocamlc -package js_of_ocaml,js_of_ocaml-ppx,js_of_ocaml-lwt -linkpkg -o cubes.byte cubes.mli cubes.ml
</code></pre></div>
<p dir="auto">Then, run the <code>wasm_of_ocaml</code> compiler to produce WebAssembly code:</p>

<p dir="auto">This outputs a file <code>cubes.js</code> which loads the WebAssembly code from file <code>cube.wasm</code>. For debugging, we currently also output the generated WebAssembly code in text file to <code>cube.wat</code>. Since Chrome does not allow loading from the filesystem, you need to serve the files using some Web server. For instance:</p>
<div data-snippet-clipboard-copy-content="python3 -m http.server 8000 --directory ."><pre><code>python3 -m http.server 8000 --directory .
</code></pre></div>
<p dir="auto">As a larger example, you can try <a href="https://github.com/linoscope/CAMLBOY">CAMLBOY</a>. You need to install a forked version of <a href="https://github.com/ocaml-wasm/brr/tree/wasm">Brr</a>. Once the Js_of_ocaml UI is compiled (with <code>dune build</code>), you can generate WebAssembly code instead with the following command:</p>
<div data-snippet-clipboard-copy-content="wasm_of_ocaml _build/default/bin/web/index.bc-for-jsoo"><pre><code>wasm_of_ocaml _build/default/bin/web/index.bc-for-jsoo
</code></pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-implementation-status" aria-hidden="true" href="#implementation-status"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Implementation status</h2>
<p dir="auto">A large part of the runtime is <a href="https://github.com/ocaml-wasm/wasm_of_ocaml/issues/5" data-hovercard-type="issue" data-hovercard-url="/ocaml-wasm/wasm_of_ocaml/issues/5/hovercard">implemented</a>. File-related functions, marshaling and dynamic linking are not supported yet.</p>
<p dir="auto">Separate compilation is not implemented yet.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-compatibility-with-js_of_ocaml" aria-hidden="true" href="#compatibility-with-js_of_ocaml"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Compatibility with Js_of_ocaml</h2>
<p dir="auto">Since the value representation is different, some adaptations are necessary.</p>
<p dir="auto">The most notable change is that, except for integers, OCaml numbers are no longer mapped to JavaScript numbers. So, explicit conversions <code>Js.to_float</code> and <code>Js.float</code> are now necessary to convert between OCaml floats and JavaScript numbers. The typing of JavaScript Typed Arrays has also been changed to deal with this.</p>
<p dir="auto">Additionally, OCaml physical equality will not work properly on JavaScript objects (it compares boxed values instead of values themselves). You should use <code>Js.string_equals</code> instead.</p>
<p dir="auto">Some forked versions of <a href="https://github.com/ocaml-wasm/brr/tree/wasm">Brr</a> and
<a href="https://github.com/ocaml-wasm/gen_js_api/tree/wasm">Gen_js_api</a> are compatible with Wasm_of_ocaml.</p>
</article>
          </div></div>
  </body>
</html>
