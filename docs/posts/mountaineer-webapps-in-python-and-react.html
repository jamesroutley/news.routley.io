<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/piercefreeman/mountaineer">Original</a>
    <h1>Show HN: Mountaineer ‚Äì Webapps in Python and React</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/media/header.png"><img src="https://ntietz.com/piercefreeman/mountaineer/raw/main/docs/media/header.png" alt="Mountaineer Header"/></a></p>
<p dir="auto"><i>Move fast. Climb mountains. Don&#39;t break things.</i></p>
<p dir="auto">Mountaineer üèîÔ∏è is a framework to easily build webapps in Python and React. If you&#39;ve used either of these languages before for development, we think you&#39;ll be right at home.</p>

<p dir="auto">Each framework has its own unique features and tradeoffs. Mountaineer focuses on developer productivity above all else, with production speed a close second.</p>
<ul dir="auto">
<li>üìù Typehints up and down the stack: frontend, backend, and database</li>
<li>üéôÔ∏è Trivially easy client&lt;-&gt;server communication, data binding, and function calling</li>
<li>üåé Optimized server rendering for better accessibility and SEO</li>
<li>üèπ Static analysis of web pages for strong validation: link validity, data access, etc.</li>
<li>ü§© Skip the API or Node.js server just to serve frontend clients</li>
</ul>
<blockquote>
<p dir="auto">We built Mountaineer out of a frustration that we were reinventing the webapp wheel time and time again. We love Python for backend development and the interactivity of React for frontend UX. But they don&#39;t work seamlessly together without a fair amount of glue. So: we built the glue. While we were at it, we embedded a V8 engine to provide server-side rendering, added conventions for application configuration, built native Typescript integrations, and more. Our vision is for you to import one slim dependency and you&#39;re off to the races.</p>
<p dir="auto">We&#39;re eager for you to give Mountaineer a try, and equally devoted to making you successful if you like it. File an Issue if you see anything unexpected or if there&#39;s a steeper learning curve than you expect. There&#39;s much more to do - and we&#39;re excited to do it together.</p>
<p dir="auto">~ Pierce</p>
</blockquote>


<p dir="auto">To get started as quickly as possible, we bundle a project generator that sets up a simple project after a quick Q&amp;A. Make sure you have pipx <a href="https://pipx.pypa.io/stable/installation/" rel="nofollow">installed</a>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ pipx run create-mountaineer-app

? Project name [my-project]: my_webapp
? Author [Pierce Freeman &lt;pierce@freeman.vc&gt;] Default
? Use poetry for dependency management? [Yes] Yes
? Create stub MVC files? [Yes] Yes
? Use Tailwind CSS? [Yes] Yes"><pre>$ pipx run create-mountaineer-app

<span>?</span> Project name [my-project]: my_webapp
<span>?</span> Author [Pierce Freeman <span>&lt;</span>pierce@freeman.vc<span>&gt;</span>] Default
<span>?</span> Use poetry <span>for</span> dependency management<span>?</span> [Yes] Yes
<span>?</span> Create stub MVC files<span>?</span> [Yes] Yes
<span>?</span> Use Tailwind CSS<span>?</span> [Yes] Yes</pre></div>
<p dir="auto">Mountaineer projects all follow a similar structure. After running this CLI you should see a new folder called <code>my_webapp</code>, with folders like the following:</p>
<div data-snippet-clipboard-copy-content="my_webapp
  /controllers
    /home.py
  /models
    /mymodel.py
  /views
    /app
      /home
        /page.tsx
      /layout.tsx
    /package.json
    /tsconfig.json
  /app.py
  /cli.py
pyproject.toml
poetry.lock"><pre><code>my_webapp
  /controllers
    /home.py
  /models
    /mymodel.py
  /views
    /app
      /home
        /page.tsx
      /layout.tsx
    /package.json
    /tsconfig.json
  /app.py
  /cli.py
pyproject.toml
poetry.lock
</code></pre></div>
<p dir="auto">Every service file is nested under the <code>my_webapp</code> root package. Views are defined in a disk-based hierarchy (<code>views</code>) where nested routes are in nested folders. This folder acts as your React project and is where you can define requirements and build parameters in <code>package.json</code> and <code>tsconfig.json</code>. Controllers are defined nearby in a flat folder (<code>controllers</code>) where each route is a separate file. Everything else is just standard Python code for you to modify as needed.</p>

<p dir="auto">If you&#39;re starting a new application from scratch, you&#39;ll typically want to create your new database tables. Make sure you have postgres running. We bundle a docker-compose file for convenience with <code>create-mountaineer-app</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker-compose up -d
poetry run createdb"><pre>docker-compose up -d
poetry run createdb</pre></div>
<p dir="auto">Mountaineer relies on watching your project for changes and doing progressive compilation. We provide a few CLI commands to help with this.</p>
<p dir="auto">While doing development work, you&#39;ll usually want to preview the frontend and automatically build dependent files. You can do this with:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ poetry run runserver

INFO:     Started server process [93111]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:5006 (Press CTRL+C to quit)"><pre>$ poetry run runserver

INFO:     Started server process [93111]
INFO:     Waiting <span>for</span> application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:5006 (Press CTRL+C to quit)</pre></div>
<p dir="auto">Navigate to <a href="http://127.0.0.1:5006" rel="nofollow">http://127.0.0.1:5006</a> to see your new webapp running.</p>
<p dir="auto">Or, if you just want to watch the source tree for changes without hosting the server. Watching will allow your frontend to pick up API definitions from your backend controllers:</p>

<p dir="auto">Both of these CLI commands are specified in your project&#39;s <code>cli.py</code> file.</p>

<p dir="auto">Below we go through some of the unique aspects of Mountaineer. Let&#39;s create a simple Todo list where we can add new items.</p>
<p dir="auto">For the purposes of this walkthrough we assume your project is generated with <code>create-mountaineer-app</code> and you&#39;ve skipped MVC stub files. If not, you&#39;ll have to delete some of the pre-existing files.</p>
<p dir="auto">Let&#39;s get started by creating the data models that will persist app state to the database. These definitions are effectively Pydantic schemas that will be bridged to the database via <a href="https://github.com/tiangolo/sqlmodel">SQLModel</a>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# my_webapp/models/todo.py

from mountaineer.database import SQLModel, Field
from uuid import UUID, uuid4

class TodoItem(SQLModel, table=True):
    id: UUID = Field(default_factory=uuid4, primary_key=True)

    description: str
    completed: bool = False"><pre><span># my_webapp/models/todo.py</span>

<span>from</span> <span>mountaineer</span>.<span>database</span> <span>import</span> <span>SQLModel</span>, <span>Field</span>
<span>from</span> <span>uuid</span> <span>import</span> <span>UUID</span>, <span>uuid4</span>

<span>class</span> <span>TodoItem</span>(<span>SQLModel</span>, <span>table</span><span>=</span><span>True</span>):
    <span>id</span>: <span>UUID</span> <span>=</span> <span>Field</span>(<span>default_factory</span><span>=</span><span>uuid4</span>, <span>primary_key</span><span>=</span><span>True</span>)

    <span>description</span>: <span>str</span>
    <span>completed</span>: <span>bool</span> <span>=</span> <span>False</span></pre></div>
<p dir="auto">Update the index file as well:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# my_webapp/models/__init__.py

from .todo import TodoItem # noqa: F401"><pre><span># my_webapp/models/__init__.py</span>

<span>from</span> .<span>todo</span> <span>import</span> <span>TodoItem</span> <span># noqa: F401</span></pre></div>
<p dir="auto">Make sure you have a Postgres database running. We bundle a docker-compose file for convenience with <code>create-mountaineer-app</code>. Launch it in the background and create the new database tables from these code definitions:</p>
<div dir="auto" data-snippet-clipboard-copy-content="docker-compose up -d
poetry run createdb
poetry run runserver"><pre>docker-compose up -d
poetry run createdb
poetry run runserver</pre></div>
<p dir="auto">Great! At this point we have our database tables created and have a basic server running. We next move to creating a new controller, since this will define which data you can push and pull to your frontend.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# my_webapp/controllers/home.py

from mountaineer import sideeffect, ControllerBase, RenderBase
from mountaineer.database import DatabaseDependencies

from fastapi import Request, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from sqlmodel import select

from my_webapp.models.todo import TodoItem

class HomeRender(RenderBase):
    client_ip: str
    todos: list[TodoItem]

class HomeController(ControllerBase):
    url = &#34;/&#34;
    view_path = &#34;/app/home/page.tsx&#34;

    async def render(
        self,
        request: Request,
        session: AsyncSession = Depends(DatabaseDependencies.get_db_session)
    ) -&gt; HomeRender:
        todos = await session.execute(select(TodoItem))

        return HomeRender(
            client_ip=(
                request.client.host
                if request.client
                else &#34;unknown&#34;
            ),
            todos=todos.scalars().all()
        )"><pre><span># my_webapp/controllers/home.py</span>

<span>from</span> <span>mountaineer</span> <span>import</span> <span>sideeffect</span>, <span>ControllerBase</span>, <span>RenderBase</span>
<span>from</span> <span>mountaineer</span>.<span>database</span> <span>import</span> <span>DatabaseDependencies</span>

<span>from</span> <span>fastapi</span> <span>import</span> <span>Request</span>, <span>Depends</span>
<span>from</span> <span>sqlalchemy</span>.<span>ext</span>.<span>asyncio</span> <span>import</span> <span>AsyncSession</span>
<span>from</span> <span>sqlmodel</span> <span>import</span> <span>select</span>

<span>from</span> <span>my_webapp</span>.<span>models</span>.<span>todo</span> <span>import</span> <span>TodoItem</span>

<span>class</span> <span>HomeRender</span>(<span>RenderBase</span>):
    <span>client_ip</span>: <span>str</span>
    <span>todos</span>: <span>list</span>[<span>TodoItem</span>]

<span>class</span> <span>HomeController</span>(<span>ControllerBase</span>):
    <span>url</span> <span>=</span> <span>&#34;/&#34;</span>
    <span>view_path</span> <span>=</span> <span>&#34;/app/home/page.tsx&#34;</span>

    <span>async</span> <span>def</span> <span>render</span>(
        <span>self</span>,
        <span>request</span>: <span>Request</span>,
        <span>session</span>: <span>AsyncSession</span> <span>=</span> <span>Depends</span>(<span>DatabaseDependencies</span>.<span>get_db_session</span>)
    ) <span>-&gt;</span> <span>HomeRender</span>:
        <span>todos</span> <span>=</span> <span>await</span> <span>session</span>.<span>execute</span>(<span>select</span>(<span>TodoItem</span>))

        <span>return</span> <span>HomeRender</span>(
            <span>client_ip</span><span>=</span>(
                <span>request</span>.<span>client</span>.<span>host</span>
                <span>if</span> <span>request</span>.<span>client</span>
                <span>else</span> <span>&#34;unknown&#34;</span>
            ),
            <span>todos</span><span>=</span><span>todos</span>.<span>scalars</span>().<span>all</span>()
        )</pre></div>
<p dir="auto">The only three requirements of a controller are setting the:</p>
<ul dir="auto">
<li>URL</li>
<li>View path</li>
<li>Initial data payload</li>
</ul>
<p dir="auto">This <code>render()</code> function is a core building block of Mountaineer. All Controllers need to have one. It defines all the data that your frontend will need to resolve its view. This particular controller retrieves all Todo items from the database, alongside the user&#39;s current IP.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p><p dir="auto">render() functions accepts all parameters that FastAPI endpoints do: paths, query parameters, and dependency injected functions. Right now we&#39;re just grabbing the <code>Request</code> object to get the client IP.</p>
</div>
<p dir="auto">Note that the database session is provided via dependency injection, which plug-and-plays with <a href="https://github.com/tiangolo/fastapi">FastAPI&#39;s</a> Depends syntax. The standard library provides two main dependency providers:</p>
<ul dir="auto">
<li>mountaineer.CoreDependencies: helper functions for configurations and general dependency injection</li>
<li>mountaineer.database.DatabaseDependencies: helper functions for database lifecycle and management</li>
</ul>
<p dir="auto">Now that we&#39;ve newly created this controller, we wire it up to the application. This registers it for display when you load the homepage.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# my_webapp/app.py
from mountaineer.app import AppController
from mountaineer.js_compiler.postcss import PostCSSBundler
from mountaineer.render import LinkAttribute, Metadata

from my_webapp.views import get_view_path
from my_webapp.config import AppConfig
from my_webapp.controllers.home import HomeController

controller = AppController(
    view_root=get_view_path(&#34;&#34;),
    config=AppConfig(),
    global_metadata=Metadata(
        links=[LinkAttribute(rel=&#34;stylesheet&#34;, href=&#34;/static/app_main.css&#34;)]
    ),
    custom_builders=[
        PostCSSBundler(),
    ],
)

controller.register(HomeController())"><pre><span># my_webapp/app.py</span>
<span>from</span> <span>mountaineer</span>.<span>app</span> <span>import</span> <span>AppController</span>
<span>from</span> <span>mountaineer</span>.<span>js_compiler</span>.<span>postcss</span> <span>import</span> <span>PostCSSBundler</span>
<span>from</span> <span>mountaineer</span>.<span>render</span> <span>import</span> <span>LinkAttribute</span>, <span>Metadata</span>

<span>from</span> <span>my_webapp</span>.<span>views</span> <span>import</span> <span>get_view_path</span>
<span>from</span> <span>my_webapp</span>.<span>config</span> <span>import</span> <span>AppConfig</span>
<span>from</span> <span>my_webapp</span>.<span>controllers</span>.<span>home</span> <span>import</span> <span>HomeController</span>

<span>controller</span> <span>=</span> <span>AppController</span>(
    <span>view_root</span><span>=</span><span>get_view_path</span>(<span>&#34;&#34;</span>),
    <span>config</span><span>=</span><span>AppConfig</span>(),
    <span>global_metadata</span><span>=</span><span>Metadata</span>(
        <span>links</span><span>=</span>[<span>LinkAttribute</span>(<span>rel</span><span>=</span><span>&#34;stylesheet&#34;</span>, <span>href</span><span>=</span><span>&#34;/static/app_main.css&#34;</span>)]
    ),
    <span>custom_builders</span><span>=</span>[
        <span>PostCSSBundler</span>(),
    ],
)

<span>controller</span>.<span>register</span>(<span>HomeController</span>())</pre></div>
<p dir="auto">Let&#39;s move over to the frontend.</p>
<div dir="auto" data-snippet-clipboard-copy-content="/* my_webapp/views/app/home/page.tsx */

import React from &#34;react&#34;;
import { useServer, ServerState } from &#34;./_server/useServer&#34;;

const CreateTodo = ({ serverState }: { serverState: ServerState }) =&gt; {
  return (
  &lt;div className=&#34;flex gap-x-4&#34;&gt;
    &lt;input
      type=&#34;text&#34;
      className=&#34;grow rounded border-2 border-gray-200 px-4 py-2&#34;
    /&gt;
    &lt;button
      className=&#34;rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700&#34;
    &gt;
      Create
    &lt;/button&gt;
  &lt;/div&gt;
  )
}

const Home = () =&gt; {
  const serverState = useServer();

  return (
    &lt;div className=&#34;mx-auto max-w-2xl space-y-8 p-8 text-2xl&#34;&gt;
      &lt;p&gt;
        Hello {serverState.client_ip}, you have {serverState.todos.length} todo items.
      &lt;/p&gt;
      &lt;CreateTodo serverState={serverState} /&gt;
      {
        /* Todo items are exposed as typehinted Typescript interfaces */
        serverState.todos.map((todo) =&gt; (
          &lt;div key={todo.id} className=&#34;rounded border-2 border-gray-200 p-4&#34;&gt;
            &lt;div&gt;{todo.description}&lt;/div&gt;
          &lt;/div&gt;
        ))
      }
    &lt;/div&gt;
  );
};

export default Home;"><pre><span>/* my_webapp/views/app/home/page.tsx */</span>

<span>import</span> <span>React</span> <span>from</span> <span>&#34;react&#34;</span><span>;</span>
<span>import</span> <span>{</span> <span>useServer</span><span>,</span> <span>ServerState</span> <span>}</span> <span>from</span> <span>&#34;./_server/useServer&#34;</span><span>;</span>

<span>const</span> <span>CreateTodo</span> <span>=</span> <span>(</span><span>{</span> serverState <span>}</span>: <span>{</span> <span>serverState</span>: <span>ServerState</span> <span>}</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>(</span>
  <span>&lt;</span><span>div</span> <span>className</span><span>=</span><span>&#34;flex gap-x-4&#34;</span><span>&gt;</span>
    <span>&lt;</span><span>input</span>
      <span>type</span><span>=</span><span>&#34;text&#34;</span>
      <span>className</span><span>=</span><span>&#34;grow rounded border-2 border-gray-200 px-4 py-2&#34;</span>
    <span>/</span><span>&gt;</span>
    <span>&lt;</span><span>button</span>
      <span>className</span><span>=</span><span>&#34;rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700&#34;</span>
    <span>&gt;</span>
      Create
    <span>&lt;</span><span>/</span><span>button</span><span>&gt;</span>
  <span>&lt;</span><span>/</span><span>div</span><span>&gt;</span>
  <span>)</span>
<span>}</span>

<span>const</span> <span>Home</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>serverState</span> <span>=</span> <span>useServer</span><span>(</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>div</span> <span>className</span><span>=</span><span>&#34;mx-auto max-w-2xl space-y-8 p-8 text-2xl&#34;</span><span>&gt;</span>
      <span>&lt;</span><span>p</span><span>&gt;</span>
        Hello <span>{</span><span>serverState</span><span>.</span><span>client_ip</span><span>}</span>, you have <span>{</span><span>serverState</span><span>.</span><span>todos</span><span>.</span><span>length</span><span>}</span> todo items.
      <span>&lt;</span><span>/</span><span>p</span><span>&gt;</span>
      <span>&lt;</span><span>CreateTodo</span> <span>serverState</span><span>=</span><span>{</span><span>serverState</span><span>}</span> <span>/</span><span>&gt;</span>
      <span>{</span>
        <span>/* Todo items are exposed as typehinted Typescript interfaces */</span>
        <span>serverState</span><span>.</span><span>todos</span><span>.</span><span>map</span><span>(</span><span>(</span><span>todo</span><span>)</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>div</span> <span>key</span><span>=</span><span>{</span><span>todo</span><span>.</span><span>id</span><span>}</span> <span>className</span><span>=</span><span>&#34;rounded border-2 border-gray-200 p-4&#34;</span><span>&gt;</span>
            <span>&lt;</span><span>div</span><span>&gt;</span><span>{</span><span>todo</span><span>.</span><span>description</span><span>}</span><span>&lt;</span><span>/</span><span>div</span><span>&gt;</span>
          <span>&lt;</span><span>/</span><span>div</span><span>&gt;</span>
        <span>)</span><span>)</span>
      <span>}</span>
    <span>&lt;</span><span>/</span><span>div</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> <span>Home</span><span>;</span></pre></div>
<p dir="auto">We define a simple view to show the data coming from the backend. To accomplish this conventionally, we&#39;d need to wire up an API layer, a Node server, or format the page with Jinja templates.</p>
<p dir="auto">Here instead we use our automatically generated <code>useServer()</code> hook. This hook payload will provide all the <code>HomeRender</code> fields as properties of serverState. And it&#39;s available instantly on page load without any roundtrip fetches. Also - if your IDE supports language servers (which most do these days), you should see the fields auto-suggesting for <code>serverState</code> as you type.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/media/ide_typehints.png"><img src="https://ntietz.com/piercefreeman/mountaineer/raw/main/docs/media/ide_typehints.png" alt="IDE Typehints" width="500px"/></a></p>
<p dir="auto">If you access this in your browser at <code>localhost:5006/</code> we can see our welcome message, but we can&#39;t really <em>do</em> anything with the todos yet. Let&#39;s add some interactivity.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p><p dir="auto">Try disabling Javascript in your browser. The page will still render as-is with all variables intact, thanks to our server-side rendering.</p>
</div>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/media/server_side_rendering.png"><img src="https://ntietz.com/piercefreeman/mountaineer/raw/main/docs/media/server_side_rendering.png" alt="Server-side rendering" height="400px"/></a></p>
<p dir="auto">What good is todo list that doesn&#39;t get longer? We define a <code>add_todo</code> function that accepts a pydantic model <code>NewTodoRequest</code>, which defines the required parameters for a new todo item. We then cast this to a database object and add it to the postgres table.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# my_webapp/controllers/home.py

from pydantic import BaseModel

class NewTodoRequest(BaseModel):
    description: str

class HomeController(ControllerBase):
    ...

    @sideeffect
    async def add_todo(
        self,
        payload: NewTodoRequest,
        session: AsyncSession = Depends(DatabaseDependencies.get_db_session)
    ):
        new_todo =  TodoItem(description=payload.description)
        session.add(new_todo)
        await session.commit()"><pre><span># my_webapp/controllers/home.py</span>

<span>from</span> <span>pydantic</span> <span>import</span> <span>BaseModel</span>

<span>class</span> <span>NewTodoRequest</span>(<span>BaseModel</span>):
    <span>description</span>: <span>str</span>

<span>class</span> <span>HomeController</span>(<span>ControllerBase</span>):
    ...

    <span>@<span>sideeffect</span></span>
    <span>async</span> <span>def</span> <span>add_todo</span>(
        <span>self</span>,
        <span>payload</span>: <span>NewTodoRequest</span>,
        <span>session</span>: <span>AsyncSession</span> <span>=</span> <span>Depends</span>(<span>DatabaseDependencies</span>.<span>get_db_session</span>)
    ):
        <span>new_todo</span> <span>=</span>  <span>TodoItem</span>(<span>description</span><span>=</span><span>payload</span>.<span>description</span>)
        <span>session</span>.<span>add</span>(<span>new_todo</span>)
        <span>await</span> <span>session</span>.<span>commit</span>()</pre></div>
<p dir="auto">The important part here is the <code>@sideeffect</code>. Once you create a new Todo item, the previous state on the frontend is outdated. It will only show the todos before you created a new one. That&#39;s not what we want in an interactive app. This decorator indicates that we want the frontend to refresh its data, since after we update the todo list on the server the client state will be newly outdated.</p>
<p dir="auto">Mountaineer detects the presence of this sideeffect function and analyzes its signature. It then exposes this to the frontend as a normal async function.</p>
<div dir="auto" data-snippet-clipboard-copy-content="/* my_webapp/views/app/home/page.tsx */

import React, { useState } from &#34;react&#34;;
import { useServer } from &#34;./_server/useServer&#34;;

/* Replace the existing CreateTodo component definition you have */
const CreateTodo = ({ serverState }: { serverState: ServerState }) =&gt; {
  const [newTodo, setNewTodo] = useState(&#34;&#34;);

  return (
    &lt;div className=&#34;flex gap-x-4&#34;&gt;
      &lt;input
        type=&#34;text&#34;
        className=&#34;grow rounded border-2 border-gray-200 px-4 py-2&#34;
        value={newTodo}
        onChange={(e) =&gt; setNewTodo(e.target.value)}
      /&gt;
      &lt;button
        className=&#34;rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700&#34;
        onClick={
          /* Here we call our sideeffect function */
          async () =&gt; {
            await serverState.add_todo({
              requestBody: {
                description: newTodo,
              },
            });
            setNewTodo(&#34;&#34;);
            setShowNew(false);
          }
        }
      &gt;
        Create
      &lt;/button&gt;
    &lt;/div&gt;
  );
};

...

export default Home;"><pre><span>/* my_webapp/views/app/home/page.tsx */</span>

<span>import</span> <span>React</span><span>,</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>&#34;react&#34;</span><span>;</span>
<span>import</span> <span>{</span> <span>useServer</span> <span>}</span> <span>from</span> <span>&#34;./_server/useServer&#34;</span><span>;</span>

<span>/* Replace the existing CreateTodo component definition you have */</span>
<span>const</span> <span>CreateTodo</span> <span>=</span> <span>(</span><span>{</span> serverState <span>}</span>: <span>{</span> <span>serverState</span>: <span>ServerState</span> <span>}</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>[</span><span>newTodo</span><span>,</span> <span>setNewTodo</span><span>]</span> <span>=</span> <span>useState</span><span>(</span><span>&#34;&#34;</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>div</span> <span>className</span><span>=</span><span>&#34;flex gap-x-4&#34;</span><span>&gt;</span>
      <span>&lt;</span><span>input</span>
        <span>type</span><span>=</span><span>&#34;text&#34;</span>
        <span>className</span><span>=</span><span>&#34;grow rounded border-2 border-gray-200 px-4 py-2&#34;</span>
        <span>value</span><span>=</span><span>{</span><span>newTodo</span><span>}</span>
        <span>onChange</span><span>=</span><span>{</span><span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>setNewTodo</span><span>(</span><span>e</span><span>.</span><span>target</span><span>.</span><span>value</span><span>)</span><span>}</span>
      <span>/</span><span>&gt;</span>
      <span>&lt;</span><span>button</span>
        <span>className</span><span>=</span><span>&#34;rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700&#34;</span>
        <span>onClick</span><span>=</span><span>{</span>
          <span>/* Here we call our sideeffect function */</span>
          <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
            <span>await</span> <span>serverState</span><span>.</span><span>add_todo</span><span>(</span><span>{</span>
              <span>requestBody</span>: <span>{</span>
                <span>description</span>: <span>newTodo</span><span>,</span>
              <span>}</span><span>,</span>
            <span>}</span><span>)</span><span>;</span>
            <span>setNewTodo</span><span>(</span><span>&#34;&#34;</span><span>)</span><span>;</span>
            <span>setShowNew</span><span>(</span><span>false</span><span>)</span><span>;</span>
          <span>}</span>
        <span>}</span>
      <span>&gt;</span>
        Create
      <span>&lt;</span><span>/</span><span>button</span><span>&gt;</span>
    <span>&lt;</span><span>/</span><span>div</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

...

<span>export</span> <span>default</span> <span>Home</span><span>;</span></pre></div>
<p dir="auto"><code>useServer()</code> exposes our <code>add_todo</code> function so we can call our backend directly from our frontend. Also notice that we don&#39;t have to read or parse the output value of this function to render the new todo item to the list. Since the function is marked as a sideeffect, the frontend will automatically refresh its data after the function is called.</p>
<p dir="auto">Go ahead and load it in your browser. If you open up your web tools, you can create a new Todo and see POST requests sending data to the backend and receiving the current server state. The actual data updates and merging happens internally by Mountaineer.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/media/final_todo_list.png"><img src="https://ntietz.com/piercefreeman/mountaineer/raw/main/docs/media/final_todo_list.png" alt="Getting Started Final TODO App" height="400px"/></a></p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/media/network_debug.png"><img src="https://ntietz.com/piercefreeman/mountaineer/raw/main/docs/media/network_debug.png" alt="Getting Started Final TODO App" height="400px"/></a></p>
<p dir="auto">You can use these serverState variables anywhere you&#39;d use dynamic React state variables (useEffect, useCallback, etc). But unlike React state, these variables are automatically updated when a relevant sideeffect is triggered.</p>
<p dir="auto">And that&#39;s it. We&#39;ve just built a fully interactive web application without having to worry about an explicit API. You specify the data model and actions on the server and the appropriate frontend hooks are generated and updated automatically. It gives you the power of server rendered html and the interactivity of a virtual DOM, without having to compromise on complicated data mutations to keep everything in sync.</p>

<p dir="auto">We have additional documentation that does more of a technical deep dive on different features of Mountaineer. We order these roughly in the order that we anticipate you&#39;ll need them.</p>
<ul dir="auto">
<li><a href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/client_actions.md">Client Actions</a>: Details on @sideeffect, @passthrough, and masking @sideeffect fields for partial re-rendering.</li>
<li><a href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/view.md">View Definition</a>: How to define the view and use the serverState hook. Covers <code>page.tsx</code> and <code>layout.tsx</code> conventions to easily nest your site designs.</li>
<li><a href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/metadata.md">Page Metadata</a>: How to set the title, description, and other metadata for your pages.</li>
<li><a href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/links.md">Link Generation</a>: Generate links to other pages within your webapp, with typehinting and automatic URL generation.</li>
<li><a href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/error_handling.md">Error Handling</a>: Conventions for handling client-side errors while fetching data in your webapp.</li>
<li><a href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/postcss.md">PostCSS</a>: PostCSS build plugin for TailwindCSS support and other CSS processing.</li>
<li><a href="https://ntietz.com/piercefreeman/mountaineer/blob/main/docs/core_library.md">Core Library</a>: Details on how to do local development on the core library.</li>
</ul>
</article></div></div>
  </body>
</html>
