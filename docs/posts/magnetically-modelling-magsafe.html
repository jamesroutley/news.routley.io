<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://kavi.sblmnl.co.za/magnetically-modelling-magsafe/">Original</a>
    <h1>Magnetically Modelling MagSafe</h1>
    
    <div id="readability-page-1" class="page"><div>
				<p>MagSafe Magnets? How do they work?</p>

<p>After writing my <a href="https://kavi.sblmnl.co.za/magsafe-on-iphone/">last post on MagSafe</a>, I wanted to go deeper into the magnet array. What was it that had me so fascinated? It has this property, best described in video:</p>
<p><iframe loading="lazy" title="Magnetically Modelling Magsafe - Intro Video (Link in Description)" width="736" height="414" src="https://www.youtube.com/embed/iAMtdQ-h_dk?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></p>
<p>I’d never seen this property of self alignment before and as my powers of imagination were failing me regarding how this all worked, it was time for a model..</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash-1024x683.jpg" alt="" width="736" height="491" srcset="https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash-1024x683.jpg 1024w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash-300x200.jpg 300w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash-768x512.jpg 768w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash-1536x1024.jpg 1536w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash-1400x933.jpg 1400w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash-600x400.jpg 600w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/05/yogendra-singh-_c56tTiztfA-unsplash.jpg 1920w" sizes="(max-width: 736px) 100vw, 736px"/></p>
<p>What? No no, wrong model <span>(<span><span><a href="https://unsplash.com/photos/_c56tTiztfA">Photo credit</a></span></span>)</span></p>
<p>I’m (of course) referring to creating a <a href="https://en.wikipedia.org/wiki/Scientific_modelling">magnetic model</a> of the MagSafe magnet arrays, moving them around and seeing the magnetic fields and forces to infer what is going on. To start, I’d need to find some software to help me and that’s when I came across this wonderful Python package called <a href="https://magpylib.readthedocs.io/en/latest/">Magpylib</a>:</p>
<p><iframe loading="lazy" title="Introduction to the open-source project Magpylib" width="736" height="414" src="https://www.youtube.com/embed/LeUx6cM1vcs?start=1145&amp;feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></p>
<p>There really is a Python package for <a href="https://xkcd.com/353/">everything</a></p>
<h3><b>Setting up the MagSafe Array<br/>
</b></h3>
<p>Digging once again into Apple’s <a href="https://developer.apple.com/accessories/Accessory-Design-Guidelines.pdf">Accessory Design Guidelines</a> (Release R21, p148), I took the measurements from the drawings, fired up <a href="https://kavi.sblmnl.co.za/write-your-first-program/">Google Colab</a> and built this model:</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/3d_magsafe_animation.gif" alt="" width="600" height="375"/></p>
<p>3D, fun</p>
<p>Looking at the arrays edge-on, here are some pretty field lines:</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/2d_magsafe_field.png" alt="" width="471" height="470" srcset="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/2d_magsafe_field.png 471w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/2d_magsafe_field-300x300.png 300w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/2d_magsafe_field-150x150.png 150w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/2d_magsafe_field-50x50.png 50w" sizes="(max-width: 471px) 100vw, 471px"/></p>
<p>White and black boxes show the position of the upper and lower MagSafe arrays and if we zoom into the red box and animate the upper array moving right:</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/2dmagfield.gif" alt="" width="500" height="394"/></p>
<p>Squiggly wiggly field lines</p>
<p>Now that all these cool visualizations were done, I assumed that it’d be pretty simple to calculate the forces. My assumption was <em>wholly incorrect</em>. There’s no native way in magpylib to calculate forces! Instead of waiting for <a href="https://github.com/magpylib/magpylib/issues/348">this issue</a> to be resolved, I looked for another solution. <a href="https://github.com/MateusRodolfo/magforce">magforce</a> looked promising but I couldn’t get it to work. Time to discard the accurate model..</p>
<h3><b>Maths time, yay<br/>
</b></h3>
<p>So with no easy way to do it, time to go back to the <a href="https://en.wikipedia.org/wiki/Force_between_magnets">physics textbook</a> and find an equation:</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation1-300x72.png" alt="" width="300" height="72" srcset="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation1-300x72.png 300w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation1-768x185.png 768w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation1-600x144.png 600w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation1.png 856w" sizes="(max-width: 300px) 100vw, 300px"/></p>
<p>Oh no, way too complicated</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-1024x114.png" alt="" width="736" height="82" srcset="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-1024x114.png 1024w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-300x33.png 300w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-768x85.png 768w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-1536x171.png 1536w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-2048x228.png 2048w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-1400x156.png 1400w, https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/equation2-600x67.png 600w" sizes="(max-width: 736px) 100vw, 736px"/></p>
<p>Ah, much better!</p>
<p>If I simplify (using rotational symmetry) from a fancy, three-dimensional model to a 2D model and reduce the magnet dimensions to idealized “point” magnets, I can use that equation to find the forces.</p>
<p>This isn’t the best because it assumes the magnets are now hypothetical “point” magnets called <a href="https://en.wikipedia.org/wiki/Magnetic_dipole">magnetic dipoles</a>. However, the model only needs to be good enough to show the self-centering property I saw in the intro video. This is kavi’s blog after all, not <a href="https://journals.aps.org/rmp/">Reviews of Modern Physics</a>!</p>
<p>Skipping over a bunch of <a href="https://www.python.org/">Python</a> and <a href="https://www.youtube.com/watch?v=Wfl3S_5FD0Q">a helpful YouTube video</a>, out pops this animation:</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/magforcesv2.gif" alt="" width="900" height="650"/></p>
<p>Eureka, I can see the forces now! The red arrow is the one to look at. You can clearly see the force on the array pointing right when the upper array is slightly offset to the left and vice versa. That shows the forces responsible for that centering action. The black arrows show the forces on each dipole and the green arrow shows the torque direction.</p>
<h3><b>Enter p5.js<br/>
</b></h3>
<p>Python was cool and all, but the animation method I used was janky as hell. I wanted something a little more interactive. That’s when I found the awesome <a href="https://p5js.org/">p5.js</a> and it’s incredibly cool <a href="https://editor.p5js.org/">live editor</a>. After porting over the Python code to Javascript:</p>
<p><img decoding="async" loading="lazy" src="https://kavi.sblmnl.co.za/wp-content/uploads/2023/09/p5jsanimation.gif" alt="" width="608" height="640"/></p>
<p>The array can be moved with the mouse or the sliders and the force lines are updated dynamically.</p>
<p>I can’t have all the fun myself though..</p>
<h3><b>You can play with this too!<br/>
</b></h3>
<p>To play around with the p5.js animation, click <a href="https://kavinaidoo.github.io/magneticallymodellingmagsafe/"><strong>here</strong></a> (only works on desktop browsers, sorry!)</p>
<p>To play with the Python versions (and all the source code used for making the models and animations) get them from GitHub<strong> <a href="https://github.com/kavinaidoo/magneticallymodellingmagsafe">here</a></strong>.</p>
<h3><b>Conclusion<br/>
</b></h3>
<p>Clearly, this way of arranging magnets has some cool properties. Modelling the magnet array with visualized forces really shows the interplay between the magnets’ repulsion and attraction and how it leads to the unique MagSafe attach experience. If you find other interesting properties that the model describes that you can replicate with physical devices, share it with me!</p>
<p>Speaking of the layout of the magnets, it would be incredibly weird if no-one else has come up with this array before. That said, Apple <a href="https://patents.google.com/patent/US11715983B2">does have this patent</a> that appears to cover the MagSafe array for use in inductive charging. While digging, I also found <a href="https://patents.google.com/patent/US20220416590A1/en?oq=20220416590">this Apple patent</a> that allows for “bimodal” devices to be built. Maybe we’ll see devices that can attach to “A” or “B” devices soon! (see Magnet section <a href="https://kavi.sblmnl.co.za/magsafe-on-iphone/">here</a> for reference). Perhaps a new USB-C MagSafe battery pack that can also be charged using MagSafe? You heard it here first folks.</p>
<h3>The Future</h3>
<p>With magpylib hopefully getting force calculations in the future, it would be cool to model the forces generated by the full 3D model. It would also be awesome to play around more with <a href="https://p5js.org/">p5.js</a> and add in proper physics simulation to the 2D version. Also, why not try modelling a “bimodal” device…</p>
<p>If you have any questions/would like to share your experience with MagSafe, Python, JavaScript or the modelling of magnetic fields, leave a reply below. To receive an email when I publish a post, <a href="https://kavi.sblmnl.co.za/subscribe/">subscribe here</a>.</p>
<p><span>(Featured image remixed from<span> <a href="https://unsplash.com/photos/6sKQYJpQ5gE">this photo</a></span>)</span></p>

			</div></div>
  </body>
</html>
