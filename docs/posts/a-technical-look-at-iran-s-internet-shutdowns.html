<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zola.ink/blog/posts/a-technical-look-at-irans-internet-shutdown">Original</a>
    <h1>A technical look at Iran&#39;s internet shutdowns</h1>
    
    <div id="readability-page-1" class="page"><div>
        



<article>
  
  <span>At <time datetime="2025-07-13T00:00:00+00:00">13 Jul 2025</time> By </span>
  <p>Every time mass protests erupt in Iran, a familiar pattern follows: the flow of information stops. The internet slows to a crawl or disappears entirely.</p>

<p>But how does a modern country survive cutting itself off from the internet? Wouldn’t that break everything?</p>

<p>Not quite, because the Islamic Republic has spent the last decade building an internet within the internet.</p>

<h2 id="the-national-information-network-nin-isolation-by-design">The National Information Network (NIN): Isolation by Design</h2>

<p>Iran’s <strong>National Information Network (NIN)</strong> is a state-controlled intranet designed to keep domestic services running even when international connectivity is cut off. Think of it as a national sandbox: websites, banking portals, messaging apps, and e-government services that function entirely within Iran’s borders.</p>

<p>This setup serves two primary functions:</p>

<ul>
  <li>
    <p>It <strong>enables selective blackouts</strong>: the state can block international platforms (like WhatsApp, Instagram, or news sites) while keeping local services (like state media, banking apps) fully operational.</p>
  </li>
  <li>
    <p>It <strong>forces ISPs to route traffic through government-controlled gateways</strong>, making it easier to monitor, filter, or shut down parts of the network on demand.</p>
  </li>
</ul>

<p>Layered on top of this is the <strong>IRGFW</strong>—the Iranian Great Firewall. Modeled after China’s Great Firewall (GFW), but with stricter enforcement and more centralized control, it filters, blocks, and surveils traffic across the country.
On paper, it seems solid and impenetrable.</p>

<p>But there’s always a hole. Always.</p>

<h2 id="what-can-be-done-in-this-situation">What Can Be Done in This Situation?</h2>

<p>The Iranian internet blockade is aggressive but it’s not perfect. Like any large-scale filtering system, it relies on outdated metadata, and static blocklists. And that’s where cracks begin to form.</p>

<h3 id="the-known-flaw-ips-are-rented-not-owned">The Known Flaw: IPs Are Rented, Not Owned</h3>

<p>IPv4 addresses are limited and constantly reallocated. Most are rented and passed between hosting providers, resold between datacenters, or migrated across regions. The Iranian filtering system uses <strong>GeoIP databases and BGP information</strong> to decide which IP ranges to trust and which to block. But those records lag behind the changes.</p>

<p>An IP that once belonged to a local Iranian provider may now be assigned to a server in Amsterdam, but unless the IRGFW updates its filters in real time (which it doesn’t), that IP might still be allowed through.</p>

<p>This opens up a small but real opportunity: <strong>scanning IP space</strong> for reachable proxies, VPNs, or relays that haven’t yet been added to blocklists.</p>

<p>Yes, it’s mostly brute-force. But when everything else is down, even a single working IP can be a tunnel into the world.</p>

<h3 id="pingtunnel-slow-but-better-than-nothing">Pingtunnel: Slow, but Better Than Nothing</h3>

<p>To prevent scanning or circumvention, the IRGFW has tried to block most outbound protocols. But one thing they haven’t (yet) blocked completely is <strong>ICMP</strong> which is the protocol behind <code>ping</code>.</p>

<p>ICMP packets are typically used for diagnostics (checking whether a server is alive), and blocking them outright would break a lot of legitimate network functionality. So they’re still allowed, even under heavy shutdown conditions.</p>

<p>That’s where tools like <strong>Pingtunnel</strong> come in.</p>

<p>Pingtunnel allows you to <strong>smuggle data inside ICMP packets</strong>, essentially tunneling TCP traffic over a stream of pings. It’s really slow and It’s prone to packet loss. But it works, especially for text-based communication, command-line access, or sending small files.</p>

<p>It’s not secure against DPI or timing analysis. But in a shutdown scenario, <strong>“slow but working” is better than nothing</strong>. Even a shell session or basic messaging tool can be a critical line to the outside world.</p>

<h2 id="starlinks-behind-nats-iranians-bypass-censorship-despite-criminalization">Starlinks Behind NATs: Iranians Bypass Censorship Despite Criminalization</h2>

<p>Despite Iran’s very aggressive criminalization of Starlink receivers, many Iranians still manage to get their hands on one of them. Starlink connections can be securely shared with others by routing traffic through NAT-enabled local routers using encrypted tunnels like WireGuard.</p>

<h3 id="what-does-behind-nat-means">What Does “Behind NAT” Means?</h3>

<p>Starlink provides an independent internet connection via satellite, bypassing local ISP infrastructure entirely. However, because Starlink devices receive <strong>dynamic, often private IPv4/IPv6 addresses</strong> and operate outside traditional ISP infrastructure, they are typically <strong>behind NATs</strong> when connected to local Iranian networks or user devices.</p>

<p>Here’s what this looks like:</p>

<ul>
  <li>
    <p>A <strong>Starlink terminal</strong> (user terminal + router) connects to the satellite network and obtains an IP address from Starlink’s global network.</p>
  </li>
  <li>
    <p>Meanwhile, the user’s devices in Iran are connected to the <strong>local ISP’s network</strong>, which uses its own IP addressing and NAT systems.</p>
  </li>
  <li>
    <p>The user sets up a <strong>local router or gateway inside Iran</strong> that bridges these two networks, routing local traffic through the Starlink link.</p>
  </li>
</ul>

<h3 id="how-this-setup-bypasses-censorship">How This Setup Bypasses Censorship</h3>

<p>The key is that <strong>Iranian ISPs and firewalls cannot effectively block Starlink traffic without physically confiscating or disabling the terminals</strong>, because Starlink’s satellites communicate directly with user terminals over encrypted, proprietary protocols.</p>

<p>To share this Starlink connection with friends and family inside Iran, users employ <strong>WireGuard VPN tunnels</strong>:</p>

<ol>
  <li>
    <p><strong>WireGuard Server Setup:</strong></p>

    <ul>
      <li>
        <p>The <strong>WAN interface</strong> connected to the Iranian ISP network.</p>
      </li>
      <li>
        <p>The <strong>LAN interface</strong> connected to the Starlink terminal (or vice versa, depending on setup).</p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Traffic Routing:</strong></p>
  </li>
  <li>
    <p><strong>NAT and IP Translation:</strong></p>
  </li>
  <li>
    <p><strong>WireGuard Configuration Sharing:</strong></p>
  </li>
</ol>

<h3 id="why-this-setup-is-resilient">Why This Setup Is Resilient</h3>

<ul>
  <li>
    <p><strong>Starlink traffic is encrypted and satellite-based</strong>, making it extremely difficult for IRGFW to inspect or block without physical interference.</p>
  </li>
  <li>
    <p><strong>WireGuard uses UDP and a small handshake footprint</strong>, making detection and blocking via DPI harder.</p>
  </li>
  <li>
    <p><strong>NAT hides the underlying IP structure</strong>, so Iranian firewalls see only standard encrypted traffic to the local router — they can’t easily distinguish if that traffic is then routed over Starlink.</p>
  </li>
  <li>
    <p>This also <strong>allows multiple users to share a single Starlink terminal</strong>, maximizing scarce and expensive hardware.</p>
  </li>
</ul>

<h2 id="how-to-survive-inside-the-nin">How to Survive Inside the NIN?</h2>

<p>Sometimes, when the National Information Network (NIN) is up but Iran’s connection to the global internet is completely cut off, you simply <em>can’t</em> reach friends and family outside the country. Even communicating inside Iran becomes a challenge.</p>

<p>So what are your options?</p>

<p><strong>SMS?</strong></p>

<p><strong>Phone calls?</strong></p>

<hr/>

<h3 id="exploiting-the-local-network-self-hosted-encrypted-services">Exploiting the Local Network: Self-Hosted Encrypted Services</h3>

<p>But here’s the catch: the NIN <em>does</em> allow traffic inside Iran’s local network. This means you can run services completely inside Iran, avoiding the censored global internet but still enabling communication.</p>

<p>One powerful option is setting up your own <strong>end-to-end encrypted messaging and calling service</strong>. like a <strong>Matrix Synapse server</strong> which can be fully hosted on a VPS inside an Iranian ISP.</p>

<p><strong>Why Matrix?</strong></p>

<p><strong>What do you need?</strong></p>

<ul>
  <li>
    <p>A VPS hosted by an Iranian ISP, so the server is reachable inside the NIN.</p>
  </li>
  <li>
    <p>A domain name pointing to that VPS, ideally registered with an Iranian registrar or configured to resolve within the NIN’s DNS system.</p>
  </li>
  <li>
    <p>The Matrix Synapse server software installed and configured on the VPS.</p>
  </li>
</ul>

<p><strong>How does it help?</strong></p>

<hr/>

<p>Surviving inside the NIN means adapting to its limitations and exploiting its architecture. Running your own encrypted local communication service allows Iranians to stay connected securely, even when the global internet is a no-go.</p>

<p>It’s not perfect. there are risks, and setting up these services requires some technical knowledge. but it’s a crucial lifeline in a digital environment designed to isolate and surveil.</p>

</article>





      </div></div>
  </body>
</html>
