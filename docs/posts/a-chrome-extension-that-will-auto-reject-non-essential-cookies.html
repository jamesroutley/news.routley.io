<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.bymitch.com/posts/reject-cookies/">Original</a>
    <h1>Show HN: A Chrome extension that will auto-reject non-essential cookies</h1>
    
    <div id="readability-page-1" class="page"><section><p><a href="https://chromewebstore.google.com/detail/bnbodofigkfjljnopfggfoecokhmhamc?utm_source=item-share-cb">Add the extension</a></p>
<p><img src="https://blog.bymitch.com/reject-cookies/reject-cookies-no.png" alt="Reject Cookies Logo" title="Logo"/></p>
<h2 id="a-chrome-extension">A Chrome Extension</h2>
<p>Everyone can agree that cookie consent banners are frustrating. It might be one of the few unifying factors on the internet today. Even though it’s a couple clicks, the couple clicks are a pain, and the couple clicks can happen on many sites each day.</p>
<p>There are browser extensions out there that will auto-accept cookies like <a href="https://chromewebstore.google.com/detail/i-dont-care-about-cookies/fihnjjcciajhdojfnbdddfaoknhalnja">I don’t care about cookies</a> and it’s open source fork <a href="https://chromewebstore.google.com/detail/i-still-dont-care-about-c/edibdbjcniadpccecjdfdjjppcpchdlm">I still don’t care about cookies</a>. You can even chain this extension with another that will auto-clean up your cookies. This is an adequate solution and ascribes to <a href="https://en.wikipedia.org/wiki/Unix_philosophy">unix philosophy</a>.</p>
<p>Additionally, there are extensions like <a href="https://ublockorigin.com/">uBlock Origin</a> with additional filters to help ignore these annoying pop ups. Or <a href="https://privacybadger.org/">Privacy Badger</a> to block cookie trackers. Although there is space to provide an extension that just auto-rejects non essential cookies.</p>
<p>That’s what led to the “Reject Cookies” chrome extension. It will first attempt to reject the cookies on the page. If that is unsuccessful, it will then attempt to close the cookie pop up or banner. To comply with the regulations governing cookies under the <a href="https://gdpr.eu/cookies/">GDPR and the ePrivacy Directive you must</a></p>
<blockquote>
<p>Receive users’ consent before you use any cookies except strictly necessary cookies.</p>
</blockquote>
<p>So the omission of an acceptance should be on par with an explicit rejection. If you’re interested in how it works the code is <a href="https://github.com/mitch292/reject-cookies">open source and on github</a>, but let’s step through it at a high level.</p>
<h2 id="how-its-implemented">How it’s implemented</h2>
<p>Vibe coding is the answer. I leveraged Cursor and let it auto-select the model. This combination while extremely useful, did not serve me as well as recent past experience. On the project setup front, I had not previously written a Chrome extension. Having the Cursor agent set up the boilerplate was convenient. Although, it requested too liberal of permissions in the permissions to start and wouldn’t go and update them as the design of the app changed. Below is a snippet of the <code>manifest.json</code> to show what the permissions ended up looking like.</p>
<div><pre tabindex="0"><code data-lang="json"><span><span>{
</span></span><span><span>  <span>&#34;permissions&#34;</span>: [<span>&#34;activeTab&#34;</span>, <span>&#34;sidePanel&#34;</span>, <span>&#34;tabs&#34;</span>],
</span></span><span><span>  <span>&#34;content_scripts&#34;</span>: [
</span></span><span><span>    {
</span></span><span><span>      <span>&#34;matches&#34;</span>: [<span>&#34;http://*/*&#34;</span>, <span>&#34;https://*/*&#34;</span>],
</span></span><span><span>      <span>&#34;js&#34;</span>: [<span>&#34;content.js&#34;</span>]
</span></span><span><span>    }
</span></span><span><span>  ]
</span></span><span><span>}
</span></span></code></pre></div><p>Next on the implementation side of things, it started with a set of common selectors that could possibly be relevant to non-essential cookies. The problem was once again these selectors were extremely liberal things like elements with the class “accept”. I opted to take a more targeted approach and aim the logic at specific cookie consent vendors that most sites seem to leverage. Cursor’s agent was, as expected, not able to help much with this implementation.</p>
<p>The extension will go through the configured providers.</p>
<div><pre tabindex="0"><code data-lang="typescript"><span><span><span>const</span> <span>findAndClickRejectButtons</span> <span>=</span> () <span>=&gt;</span> {
</span></span><span><span>	<span>commonCookiePopupChecks</span>.<span>forEach</span>(({ <span>check</span>, <span>rejectOrClose</span> }) <span>=&gt;</span> {
</span></span><span><span>	  <span>if</span> (<span>check</span>()) {
</span></span><span><span>		<span>rejectOrClose</span>();
</span></span><span><span>		<span>// assume that there is only one cookie consent provider and we can exit
</span></span></span><span><span><span></span>		<span>return</span>;
</span></span><span><span>	  }
</span></span><span><span>	});
</span></span><span><span>  }
</span></span></code></pre></div><p>A check for a provider will look for a specific element that identifies it.</p>
<div><pre tabindex="0"><code data-lang="typescript"><span><span><span>const</span> <span>checkForOneTrust</span> <span>=</span> ()<span>:</span> <span>boolean</span> <span>=&gt;</span> <span>!!</span>document.<span>getElementById</span>(<span>&#39;onetrust-consent-sdk&#39;</span>);
</span></span></code></pre></div><p>Then attempt to reject the cookies and fallback to removing the consent banner or popup if it’s not able to reject the non-essential cookies.</p>
<div><pre tabindex="0"><code data-lang="typescript"><span><span><span>const</span> <span>closeOrRejectOneTrust</span> <span>=</span> () <span>=&gt;</span> {
</span></span><span><span>  <span>const</span> <span>rejectButton</span> <span>=</span> document.<span>getElementById</span>(<span>&#39;onetrust-reject-all-handler&#39;</span>);
</span></span><span><span>  <span>if</span> (<span>rejectButton</span>) {
</span></span><span><span>    <span>rejectButton</span>.<span>click</span>();
</span></span><span><span>    <span>return</span> <span>true</span>;
</span></span><span><span>  }
</span></span><span><span>
</span></span><span><span>  <span>const</span> <span>consentSDK</span> <span>=</span> document.<span>getElementById</span>(<span>&#39;onetrust-consent-sdk&#39;</span>);
</span></span><span><span>  <span>if</span> (<span>consentSDK</span>) {
</span></span><span><span>    <span>consentSDK</span>.<span>remove</span>();
</span></span><span><span>    <span>return</span> <span>true</span>;
</span></span><span><span>  }
</span></span><span><span>  <span>return</span> <span>false</span>;
</span></span><span><span>};
</span></span></code></pre></div><p>Not much more to it other than that.</p>
<p><img src="https://blog.bymitch.com/reject-cookies/reject-cookies-umbrella.png" alt="Reject Cookies Umbrella" title="Umbrella"/></p>
<h2 id="help-it-get-better">Help it get better</h2>
<p><strong>Reject Cookies is still a work in progress.</strong> It can use your support to help cover more use cases and report bugs. As mentioned the design targets specific cookie consent implementations from different vendors. There are more vendors out there and different flavors of each vendors implementation. The side panel allows you to report sites where the cookie consent rejection was missed along with a place to report bugs or issues with the extension. The side panel can be accessed by clicking on the chrome extension’s menu in Chrome. You can also feel free to reach out to <a href="https://blog.bymitch.com/cdn-cgi/l/email-protection#31585f575e7153485c584552591f525e5c"><span data-cfemail="c6afa8a0a986a4bfabafb2a5aee8a5a9ab">[email protected]</span></a> with any feedback.</p>
<p><img src="https://blog.bymitch.com/reject-cookies/side-panel.png" alt="Side panel debugging screenshot" title="Side Panel"/></p>
</section></div>
  </body>
</html>
