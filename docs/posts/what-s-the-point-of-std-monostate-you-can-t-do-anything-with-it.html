<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://devblogs.microsoft.com/oldnewthing/20240708-00/?p=109959">Original</a>
    <h1>What&#39;s the point of std:monostate? You can&#39;t do anything with it</h1>
    
    <div id="readability-page-1" class="page"><div id="featured">

	<div>
                         <p>
            July 8th, 2024</p><!-- .entry-meta -->
        <p>C++17 introduced <code>std::<wbr/>monostate</code>, and I used it <a title="In C++/WinRT, how can I await multiple coroutines and capture the results?, part 3" href="https://devblogs.microsoft.com/oldnewthing/20240112-00/?p=109267"> as a placeholder to represent the results of a coroutine that produces nothing</a>. In the comments, Neil Rashbrook asked <a href="https://devblogs.microsoft.com/oldnewthing/20240112-00/?p=109267#comment-141049"> what you are expected to do with a <code>std::<wbr/>monostate</code></a>, seeing as has no members and only trivial member functions.</p>
<p>The answer is “nothing”.</p>
<p>The purpose of <code>std::<wbr/>monostate</code> is to be a dummy type that does nothing. All instances are considered equal to each other. It is basically this:</p>
<pre>struct monostate {};
// plus relational operators and a hash specialization
</pre>
<p>You can see it in <a href="https://github.com/llvm/llvm-project/blob/22f6e97d24f6e7190a447fd60e11e8ea03fd8356/libcxx/include/__variant/monostate.h#L26C42-L26C42"> libcxx (LLVM/clang)</a>, <a href="https://github.com/gcc-mirror/gcc/blob/5d2a360f0a541646abb11efdbabc33c6a04de7ee/libstdc%2B%2B-v3/include/std/variant#L1237"> libstdc++ (gcc)</a>, and <a href="https://github.com/microsoft/STL/blob/3eac329d1f614ecf138d96c22a3b02f87076bc4a/stl/inc/xutility#L7126"> stl (msvc)</a>.</p>
<p>But what’s the point of a class that does nothing, and which you can do nothing with?</p>
<p>You don’t use <code>monostate</code> because you want to do something. You use <code>monostate</code> when you <i>don’t want to do anything</i>.</p>
<p>Its original purpose was to be used as the initial type in a <code>std::<wbr/>variant</code> to allow it to be default-constructed in an empty state.</p>
<pre>struct Widget
{
    // no default constructor
    Widget(std::string const&amp; id);

    ⟦ other members ⟧
};

struct PortListener
{
    // default constructor has unwanted side effects
    PortListener(int port = 80);

    ⟦ other members ⟧
};

std::variant&lt;Widget, PortListener&gt; thingie; // can&#39;t do this
</pre>
<p>The <code>std::variant</code>‘s default constructor default-constructs its first alternative. Since <code>Widget</code> doesn’t have a default constructor, you can’t put it first. And <code>Port­Listener</code>‘s default constructor has unwanted side effects, so we don’t want to put it first.</p>
<p>Enter <code>std::<wbr/>monostate</code>. You can put that guy first.</p>
<pre>std::variant&lt;std::monostate, Widget, PortListener&gt; thingie;
</pre>
<p>The <code>thingie</code> default-constructs into a <code>monostate</code>. What can you do with a <code>monostate</code>? Nothing! Its job is just to be a dummy type that you can use when you are forced to provide a default-constructible type but don’t want to.</p>
<p>In the case of a <code>std::<wbr/>variant</code>, you can think of inserting <code>std::<wbr/>monostate</code> as a way to add an “empty” state to a <code>variant</code>,¹ saving you the trouble of having to create a <code>std::<wbr/>optional&lt;std::<wbr/>variant&lt;...&gt;&gt;</code>. You can treat the <code>std::<wbr/>monostate</code> as the “empty” state.</p>
<p>In our usage of <code>std::<wbr/>monostate</code>, we used it as just a dummy type that stands in for <code>void</code>.²</p>
<p>¹ More precisely, a way to add <i>another</i> “empty” state to a <code>variant</code>. There is already an “empty” state for a <code>std::<wbr/>variant</code>, known as <code>valueless_<wbr/>by_<wbr/>exception</code>. This state is wacky, though, so you want to avoid it as much as possible. Another topic for another day.</p>
<p>² Bonus reading: <a href="https://wg21.link/p0146r1"> Regular Void</a>, which has stalled.</p>

        

        
		
        
	</div><!-- .entry-content -->

</div></div>
  </body>
</html>
