<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/matt-kimball/allocscope">Original</a>
    <h1>Show HN: I wrote a tool in Rust for tracking all allocations in a Linux process</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/97f3918e6f93277e7d23d50ed4ccb2e3c9c94ca79f0d7e77830822fd1c620e72/68747470733a2f2f616c6c6f6373636f70652e636f6d2f62616e6e65722e706e67"><img src="https://camo.githubusercontent.com/97f3918e6f93277e7d23d50ed4ccb2e3c9c94ca79f0d7e77830822fd1c620e72/68747470733a2f2f616c6c6f6373636f70652e636f6d2f62616e6e65722e706e67" alt="allocscope banner" data-canonical-src="https://allocscope.com/banner.png"/></a></p>

<h3 dir="auto"><a id="user-content-a-memory-tracking-tool" aria-hidden="true" href="#a-memory-tracking-tool"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>a memory tracking tool</h3>
<p dir="auto">allocscope is a tool for tracking down where the most egregiously large allocations are occurring
in a C, C++ or Rust codebase.  It is particilarly intendend to be useful for developers who want to
get a handle on excessive allocations and are working in a large codebase with multiple
contributors with allocations occuring in many modules or libraries.</p>
<p dir="auto">It is composed of two commands:</p>
<p dir="auto"><code>allocscope-trace</code> attaches to another process as a debugger.  By using breakpoints on memory
allocation functions such as <code>malloc</code> it tracks allocations made by that process.  During the
trace, the callstack of all allocations are recorded to an <code>.atrace</code> file.  Tracing programs
which spawn multiple threads and tracing calls through shared libraries are supported.  You can
spawn a process to trace by specifying a full commandline to <code>allocscope-trace</code>, or you can
attach to an existing running process.</p>
<p dir="auto"><code>allocscope-view</code> reads the <code>.atrace</code> file produced by <code>allocscope-trace</code>.  It presents a summary
of all allocations made in a call tree format, which can be sorted by largest concurrent
allocation, total number of blocks, number of unfreed allocation blocks, or the sequence of
the allocation.  The summary can be navigated interactively through a curses-based terminal user
interface, or a text report suitable for non-interactive use can be generated.</p>
<h2 dir="auto"><a id="user-content-installing-prebuilt-binaries" aria-hidden="true" href="#installing-prebuilt-binaries"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installing prebuilt binaries</h2>
<p dir="auto">The easiest way to get started with allocscope is to install prebuilt binaries.</p>
<p dir="auto">To install the latest version:</p>
<p dir="auto"><code>curl -s https://allocscope.com/install.sh | sudo sh</code></p>
<p dir="auto">Currently only Linux on x86_64 processors is supported, but I&#39;d like to support more operating systems
and processors in the future.</p>
<h2 dir="auto"><a id="user-content-getting-started" aria-hidden="true" href="#getting-started"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Getting started</h2>
<p dir="auto">While it will be likely be most useful to use allocscope on a program with symbols, which you
have compiled yourself, you can verify that it functions correctly by performing a trace on a
standard system command, such as <code>ls</code>:</p>
<div data-snippet-clipboard-copy-content="allocscope-trace ls -l
allocscope-view ls.atrace"><pre><code>allocscope-trace ls -l
allocscope-view ls.atrace
</code></pre></div>
<h2 dir="auto"><a id="user-content-building-from-source" aria-hidden="true" href="#building-from-source"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building from source</h2>
<p dir="auto">On recent Ubuntu releases, allocscope can be built from source with the following sequence
of commands:</p>
<div data-snippet-clipboard-copy-content="apt-get update
apt-get install cargo git libclang-dev libiberty-dev libncurses-dev libsqlite3-dev libunwind-dev
git clone https://github.com/matt-kimball/allocscope.git
cd allocscope
cargo install --path allocscope-trace
cargo install --path allocscope-view"><pre><code>apt-get update
apt-get install cargo git libclang-dev libiberty-dev libncurses-dev libsqlite3-dev libunwind-dev
git clone https://github.com/matt-kimball/allocscope.git
cd allocscope
cargo install --path allocscope-trace
cargo install --path allocscope-view
</code></pre></div>
<p dir="auto">Statically linked binaries can also be built using the <code>build-static/build.sh</code> script, though this requires
Docker installed on the build system.</p>
<h2 dir="auto"><a id="user-content-support-development" aria-hidden="true" href="#support-development"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Support development</h2>
<p dir="auto">If you find allocscope useful, please consider supporting development.</p>
<p dir="auto">Visit <a href="https://allocscope.com/support" rel="nofollow">https://allocscope.com/support</a></p>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto">allocscope is licensed GNU General Public License version 3.</p>
</article>
          </div></div>
  </body>
</html>
