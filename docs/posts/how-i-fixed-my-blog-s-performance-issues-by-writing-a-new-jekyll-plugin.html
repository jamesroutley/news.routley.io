<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arclight.run/how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/">Original</a>
    <h1>How I fixed my blog&#39;s performance issues by writing a new Jekyll plugin</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
            <article>
    

    <div>
  <p>ðŸ’¡ If you don&#39;t want to read the full story, you can <a href="https://github.com/arclight0/jekyll-skyhook">check out the jekyll-skyhook plugin on GitHub here</a>.</p>
</div>

<p>When I started writing this blog, I figured I could write my posts, submit my website to <a href="https://search.google.com/search-console/about">Google Search Console</a> for indexing, and presto - my posts would start appearing in Google search results.</p>

<p>That way, people who encounter issues like <a href="https://arclight.run/fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/">I did with dark/light mode not working in Ubuntu 24.04</a> would be a search result away from finding my fix.</p>

<p>I guess I sort of forgot what it took to start a blog from zero, because I recently decided to check on my website&#39;s stats in Search Console, and I was surprised to see that Google has <strong>not been indexing my pages at all</strong> - most are marked as &#34;Crawled - currently not indexed&#34;!</p>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-formatavif-width400-f85c3465a75e112f31913f73fa39e833.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-formatavif-width672-024133de0f09a39eddd05e370a56b6da.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-formatavif-width900-ee206507f58337d174c66078b660e826.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-formatwebp-width400-d7e5260bd4e0b59a9ba0507bcdfee03e.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-formatwebp-width672-28d029350f701286b244acc9a8442710.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-formatwebp-width900-358a75e73412c0abcf321f6ba4b04281.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-width900-a4eacbc3b576e31f5f1d9199fcfbbb41.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-width400-94fe4cbab39015144d25add4fc60eb49.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-width672-41b565818b58e6369011764dcd8f5894.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/not-indexed-width900-a4eacbc3b576e31f5f1d9199fcfbbb41.png 900w" alt="Google not indexing my site" width="833" height="1065" loading="lazy"/>
</picture>

<p>When I looked into why the heck that would be, I discovered that trying to determine the reason for a particular page not being indexed is pretty opaque. However, the general causes seem to be:</p>

<ul>
  <li>Poor content</li>
  <li>Not enough backlinks</li>
  <li>Poor website performance</li>
</ul>

<p>Well, if my content stinks there&#39;s not much I can do about that (except <em>try harder</em> I guess). And it&#39;s true I haven&#39;t submitted anything I&#39;ve written yet to other sites like Reddit, Hacker News, etc. where people might share it and generate backlinks.</p>

<p>That leaves performance.</p>

<p>So, I opened up Google <a href="https://pagespeed.web.dev/">PageSpeed Insights</a>, entered in one of my post URLs, <a href="https://pagespeed.web.dev/analysis/https-arclight-run-booting-an-old-server-from-nvme-that-doesnt-support-it/hcswqlhqnp?form_factor=mobile">and saw this</a>:</p>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-formatavif-width400-3a137107fff986adc9142afa63d859ef.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-formatavif-width672-40033dff9dac18eb5adc60ccba97eced.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-formatavif-width900-d2c92baa80dfd63b0d2a29c2cecef138.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-formatwebp-width400-ea5db5f6a747d2658816d55f47625910.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-formatwebp-width672-ba28ddfb696361ee2726b3679dc28ea0.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-formatwebp-width900-44db9628675c0442c3196cf4b9a04ad3.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-width900-4b4c1a49851518dc4bf3dc909f616a73.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-width400-419e1f13efa97e534892431c97d855ac.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-width672-67a95a3d4cc80b9e118ee4c1857916e0.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-insights-initial-width900-4b4c1a49851518dc4bf3dc909f616a73.png 900w" alt="YouTube embed performance problems" width="1183" height="1251" loading="lazy"/>
</picture>

<p><strong>Wow!</strong> A big red 43 out of 100 - an abysmal failure. I was surprised at how bad the score was. I thought I kept my site pretty lean!</p>

<p>Surprisingly, some of the biggest dings I got on the report were for naively <strong>using Google products</strong>!</p>

<h3 id="google-fonts">Google Fonts</h3>

<p>First, loading a font using Google Fonts&#39; &#34;get embed code&#34; button that uses their font CDN causes several issues:</p>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-formatavif-width400-e8d777733d319065986291a5d8be06ff.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-formatavif-width672-249bb6c82faca23f1d769f91fa809406.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-formatavif-width900-5b5e6a31a7d6ae0fa746479b6fcac626.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-formatwebp-width400-64da29421bfd4aa6e0fe4db7c6afda89.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-formatwebp-width672-863ec0eb6a2b1a0f0b80550a76309fb9.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-formatwebp-width900-92df97ea6bc917769cae4a13009b88d1.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-width900-54be6e90d81e6de6887a1d5acdaf30b8.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-width400-09d59377d2c7b52f10a8db32e12d1dd5.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-width672-ac91f732fdeb56c07497702288860c19.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/fonts-perf-width900-54be6e90d81e6de6887a1d5acdaf30b8.png 900w" alt="Google Fonts performance problems" width="976" height="1034" loading="lazy"/>
</picture>

<p>I fixed that by <a href="https://fonts.google.com/knowledge/using_type/self_hosting_web_fonts">self-hosting the fonts</a>. That involved manually downloading the .css and .woff2 files that Google Fonts was fetching, and embedding the .css directly into my site&#39;s CSS and changing it to reference my self-hosted .woff2 files. I also trimmed out all the non-Latin <code>@font-face</code>s which weren&#39;t being used.</p>

<p>There&#39;s a tool called <a href="https://gwfh.mranftl.com/fonts">google-webfonts-helper</a> that I found after the fact which appears to do the same thing that I did manually that I could have used.</p>

<h3 id="youtube-embed">YouTube embed</h3>

<p>Second, naively embedding YouTube videos <strong>using YouTube&#39;s own &#34;share&#34; button embed code</strong> is apparently an awful idea:</p>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-formatavif-width400-e4bba16789feff8ffca67960baf7ea92.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-formatavif-width672-78063a8338987b31088341433898743d.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-formatavif-width900-ab276a9905b496034d0312424ee3e220.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-formatwebp-width400-43c6bdd25197383cf5752a019c98eab2.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-formatwebp-width672-2450b8034923fe7264f31bead35a2630.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-formatwebp-width900-0aa356b98c481772e66c250cccdf0826.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-width900-2913599540a1aedf3994a7f82d994a0c.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-width400-3598161e76cfb3f226440325f2dc086b.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-width672-dd84106755f9bebdaf96cf38c1556140.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/youtube-embed-perf-width900-2913599540a1aedf3994a7f82d994a0c.png 900w" alt="YouTube embed performance problems" width="967" height="1231" loading="lazy"/>
</picture>

<p>Google has a <a href="https://developer.chrome.com/docs/lighthouse/performance/third-party-facades/?utm_source=lighthouse&amp;utm_medium=lr">performance audit page</a> that specifically recommends using third-party libraries rather than their own embed code (!) to fix this issue.</p>

<p>So I fixed this issue by using <a href="https://github.com/justinribeiro/lite-youtube"><code>justinribeiro/lite-youtube</code></a> from Google&#39;s list of recommended libraries, although <a href="https://github.com/justinribeiro/lite-youtube/pull/138">I made a PR</a> because it doesn&#39;t automatically load thumbnails for playlists like how YouTube&#39;s default embed does.</p>

<h3 id="image-delivery">Image delivery</h3>

<p>Of the remaining issues, most of them were related to poorly optimized images.</p>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-formatavif-width400-7e355ebd674172da696ac51aa4fb7a3f.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-formatavif-width672-ccfe040c05ecd064bf72f9aec12b461f.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-formatavif-width900-67f7bb651af3c853ab257939b883da31.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-formatwebp-width400-06bdc25fcdb773dc721a5e523bd76bab.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-formatwebp-width672-a3ec32ecf51cb58c1d50d89f172dd72b.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-formatwebp-width900-7f64fd42dd4648011b44650c6cb2802e.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-width900-47efdb4a3b36f3bad2da3aa97151092e.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-width400-6c828a9dbff6f11040c135133a768a78.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-width672-7872b651008a80182b410f128f2ee4b3.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-1-width900-47efdb4a3b36f3bad2da3aa97151092e.png 900w" alt="Image performance problems screenshot 1" width="985" height="611" loading="lazy"/>
</picture>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-formatavif-width400-ca361d4a4f0a31f1a171741b9d97ef8e.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-formatavif-width672-3370f8ac2870cbb38e2cb491290ab99f.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-formatavif-width900-80a85b72e9fef9fc73aa1a9dd782b65c.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-formatwebp-width400-b95e0f03bd5bdbc5ef415ad7d28f40b3.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-formatwebp-width672-2dbe3607120904ab74822d050e49e1ff.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-formatwebp-width900-5d0d7498ae6071fd4531d99588e3be56.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-width900-618c14ec8953846f459c39044c1d94a9.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-width400-b8c3969a94d5c8eab2773a472f33f23c.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-width672-0a0f306103c0a2677aae178ad1c7c646.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-images-2-width900-618c14ec8953846f459c39044c1d94a9.png 900w" alt="Image performance problems screenshot 2" width="982" height="942" loading="lazy"/>
</picture>

<p>I had only been using single, high-resolution images that I referenced directly with <code>&lt;img&gt;</code> tags. No different images based on screen size, and no lazy loading. Yeah, that was kinda dumb.</p>

<p>An ideal solution would be to offer multiple image formats, including modern ones like AVIF and WebP, make them responsive by offering multiple sizes for different screen sizes (by using <code>srcset</code>), and lazy-loading them.</p>

<p>On an old Jekyll blog, I had used <a href="https://github.com/envygeeks/jekyll-assets"><code>jekyll-assets</code></a> to accomplish something like that, but I remember it being a pain to get started with. And at this point, the library seems to have been abandoned as it hasn&#39;t been updated in over 5 years.</p>

<p>More importantly, it uses <a href="https://github.com/rails/sprockets">Sprockets</a> to implement an outdated, heavyweight Rails-style asset pipeline in Ruby. That old asset pipeline does not easily integrate with modern JavaScript build tools most codebases today use like <code>esbuild</code>, <code>bun</code>, or Tailwind&#39;s CLI build tool.</p>

<p>Nowadays, Rails has made the wise decision to embrace JavaScript/Node tools for processing assets, and dramatically shrink Ruby&#39;s role. Today, the lightweight <a href="https://github.com/rails/propshaft">Propshaft</a> library is used instead, which basically just takes post-processed CSS and JS, stamps them with a hash digest (for cache friendliness), and rewrites CSS <code>url()</code> references to the new asset paths as needed. Modern JavaScript build tools are easily integrated into Rails apps with this approach.</p>

<p>I like the Propshaft approach quite a bit, but I don&#39;t see any comparable approaches in Jekyll-land. So, I wrote one myself.</p>

<h3 id="my-solution-jekyll-skyhook">My solution: jekyll-skyhook</h3>

<p>I created <a href="https://github.com/arclight0/jekyll-skyhook">the Jekyll plugin jekyll-skyhook</a> to meet my needs. It has the following features:</p>

<ul>
  <li>Image transformations - resize, format conversion (WebP, AVIF, etc.)</li>
  <li>Responsive images - automatic <code>srcset</code> generation</li>
  <li>Cache-busting digests - fingerprinted asset URLs</li>
  <li>CSS <code>url()</code> rewriting - automatic asset path updates</li>
  <li>Development file watcher - automatic regeneration</li>
  <li>Manifest-based caching - avoid duplicate processing</li>
</ul>

<p>By default it looks in the <code>assets</code> directory for assets to process (can be changed in <code>_config.yml</code> - see README).</p>

<p>For image transformations, we use the <a href="https://github.com/janko/image_processing"><code>image_processing</code> gem</a>.</p>

<p>For regular assets that we only want to create a digest of, an <code>{% asset %}</code> tag is available, e.g.:</p>

<div><div><pre><code>&lt;link rel=&#34;stylesheet&#34; href=&#34;{% asset assets/styles.css %}&#34;&gt;
&lt;script src=&#34;{% asset assets/app.js %}&#34;&gt;&lt;/script&gt;
</code></pre></div></div>

<p>For image transformations, there&#39;s a <code>{% image_transform %}</code> Liquid tag:</p>

<div><div><pre><code>&lt;!-- Resize image --&gt;
{% image_transform assets/hero.jpg[width=&#34;400&#34;] %}

&lt;!-- Convert format --&gt;
{% image_transform assets/hero.jpg[format=&#34;webp&#34;] %}

&lt;!-- Multiple transformations --&gt;
{% image_transform assets/hero.jpg[width=&#34;800&#34;][format=&#34;avif&#34;] %}

&lt;!-- Use in img tag --&gt;
&lt;img src=&#34;{% image_transform assets/hero.jpg[width=&#34;400&#34;][format=&#34;webp&#34;] %}&#34;
     alt=&#34;Hero image&#34; loading=&#34;lazy&#34;&gt;
</code></pre></div></div>

<p>For responsive images, there&#39;s a <code>{% srcset %}</code> Liquid tag:</p>

<div><div><pre><code>&lt;!-- Generate multiple sizes in original format --&gt;
{% srcset assets/hero.jpg 400 800 1200 %}

&lt;!-- Generate multiple sizes in specific format --&gt;
{% srcset assets/hero.jpg[format=&#34;webp&#34;] 400 800 1200 %}
</code></pre></div></div>

<h3 id="my-blog-setup">My blog setup</h3>

<p>The way I do things in my blog is, I have a <code>src/</code> directory where I have my unprocessed JavaScript and CSS stored in. I then have <code>npm</code> tasks like this defined in my <code>package.json</code> to process them and output them in the <code>assets</code> dir:</p>

<div><div><pre><code>  &#34;scripts&#34;: {
    &#34;build:css&#34;: &#34;tailwindcss -i ./src/main.css -o ./assets/css/main.css --minify&#34;,
    &#34;watch:css&#34;: &#34;tailwindcss -i ./src/main.css -o ./assets/css/main.css --watch&#34;,
    &#34;build:js&#34;: &#34;esbuild ./src/main.js --bundle --minify --outfile=./assets/js/main.js&#34;,
    &#34;watch:js&#34;: &#34;esbuild ./src/main.js --bundle --watch --outfile=./assets/js/main.js&#34;
  },
</code></pre></div></div>

<p>Then in my site HTML I reference them with the <code>{% asset %}</code> tag:</p>

<div><div><pre><code>&lt;link rel=&#34;stylesheet&#34; href=&#34;{% asset assets/css/main.css %}&#34; media=&#34;print&#34; onload=&#34;this.media=&#39;all&#39;&#34;&gt;
&lt;script type=&#34;module&#34; src=&#34;{% asset assets/js/main.js %}&#34;&gt;&lt;/script&gt;
</code></pre></div></div>

<p>For writing drafts in development, I run <a href="https://github.com/ddollar/foreman">foreman</a> with this <code>Procfile</code>:</p>

<div><div><pre><code>build: npm run watch:css
js: npm run watch:js
serve: bundle exec jekyll serve -D -P 4001 --trace --watch
</code></pre></div></div>

<p>For building for deployment, my <code>Makefile</code> has tasks like this:</p>

<div><div><pre><code>.PHONY: build clean serve serve-production deploy-staging deploy-production

build:
	npm run build:css
	npm run build:js
	bundle exec jekyll build --trace

clean:
	rm -rf _site
	rm -f assets/css/main.css
	rm -f assets/js/main.js
	rm -rf _digested
	rm -rf .jekyll-cache

serve: build
	bundle exec foreman start

serve-production: build
	bundle exec jekyll serve -P 4001

deploy-preview: clean build
	wrangler pages deploy _site --project-name=arclight-automata --branch=preview

deploy-production: clean build
	wrangler pages deploy _site --project-name=arclight-automata --branch=master
</code></pre></div></div>

<p>Finally, I store my images in <code>assets/images</code> directly and typically use this <code>responsive-image</code> helper include I wrote:</p>

<div><div><pre><code>{% comment %}
Responsive image include for optimal performance across all devices.

Usage:
{% include responsive-image.html
   src=&#34;assets/images/posts/post-slug/image.jpg&#34;
   alt=&#34;Description of the image&#34;
   widths=&#34;400 672 900&#34;
   sizes=&#34;(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px&#34;
   class=&#34;mx-auto w-full max-w-2xl&#34; %}

Parameters:
- src: Image path (required)
- alt: Alt text (required)
- width: Image width in pixels (optional - auto-detected if not provided)
- height: Image height in pixels (optional - auto-detected if not provided)
- widths: Space-separated list of widths for srcset (default: &#34;400 672 900&#34;)
- sizes: Sizes attribute for responsive images (default optimized for blog layout)
- class: CSS classes (default: &#34;mx-auto w-full max-w-2xl&#34;)
- loading: Loading attribute (default: &#34;lazy&#34;)
{% endcomment %}

{% assign widths = include.widths | default: &#34;400 672 900&#34; %}
{% assign sizes = include.sizes | default: &#34;(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px&#34; %}
{% assign css_class = include.class | default: &#34;mx-auto w-full max-w-2xl&#34; %}
{% assign loading = include.loading | default: &#34;lazy&#34; %}
{% assign widths_array = widths | split: &#34; &#34; %}
{% assign largest_width = widths_array | last %}

{% comment %}Auto-construct post image path if only filename provided and we&#39;re in a post{% endcomment %}
{% unless include.src contains &#34;/&#34; %}
  {% if page.layout == &#34;post&#34; %}
    {% capture post_slug %}{{ page.path | split: &#39;/&#39; | last | replace: &#39;.md&#39;, &#39;&#39; }}{% endcapture %}
    {% assign final_src = &#39;assets/images/posts/&#39; | append: post_slug | append: &#39;/&#39; | append: include.src %}
  {% endif %}
{% else %}
  {% assign final_src = include.src %}
{% endunless %}

{% comment %}Get image dimensions automatically or use provided values{% endcomment %}
{% assign auto_width = final_src | image_width %}
{% assign auto_height = final_src | image_height %}
{% assign final_width = include.width | default: auto_width %}
{% assign final_height = include.height | default: auto_height %}

{% capture avif_srcset %}{% for width in widths_array %}{% image_transform {{ final_src }}[format=&#34;avif&#34;][width=&#34;{{ width }}&#34;] %} {{ width }}w{% unless forloop.last %}, {% endunless %}{% endfor %}{% endcapture %}
{% capture webp_srcset %}{% for width in widths_array %}{% image_transform {{ final_src }}[format=&#34;webp&#34;][width=&#34;{{ width }}&#34;] %} {{ width }}w{% unless forloop.last %}, {% endunless %}{% endfor %}{% endcapture %}
{% capture original_srcset %}{% for width in widths_array %}{% image_transform {{ final_src }}[width=&#34;{{ width }}&#34;] %} {{ width }}w{% unless forloop.last %}, {% endunless %}{% endfor %}{% endcapture %}

&lt;picture&gt;
  &lt;source
    type=&#34;image/avif&#34;
    srcset=&#34;{{ avif_srcset }}&#34;
    sizes=&#34;{{ sizes }}&#34;&gt;

  &lt;source
    type=&#34;image/webp&#34;
    srcset=&#34;{{ webp_srcset }}&#34;
    sizes=&#34;{{ sizes }}&#34;&gt;

  &lt;img
    src=&#34;{% image_transform {{ final_src }}[width=&#34;{{ largest_width }}&#34;] %}&#34;
    srcset=&#34;{{ original_srcset }}&#34;
    alt=&#34;{{ include.alt }}&#34;
    width=&#34;{{ final_width }}&#34;
    height=&#34;{{ final_height }}&#34;
    loading=&#34;{{ loading }}&#34;
    class=&#34;{{ css_class }}&#34;&gt;
&lt;/picture&gt;
</code></pre></div></div>

<p>Which I call in my posts like:</p>

<div><div><pre><code>{% include responsive-image.html
   src=&#34;settings.png&#34;
   alt=&#34;Ubuntu settings&#34; %}
</code></pre></div></div>

<p>which transforms the image into AVIF, WebP, and the original format, resizes them, and outputs responsive HTML like this:</p>

<div><div><pre><code>&lt;picture&gt;
  &lt;source type=&#34;image/avif&#34; srcset=&#34;/_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-formatavif-width400-e775ca2abe38ee3428829ad88d348e6b.avif 400w, /_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-formatavif-width672-eeaf5541e25c6e5306815fc3db34e197.avif 672w, /_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-formatavif-width900-4f26b438aa6e0471a377195b4f9027eb.avif 900w&#34; sizes=&#34;(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px&#34;&gt;

  &lt;source type=&#34;image/webp&#34; srcset=&#34;/_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-formatwebp-width400-7cfb0678cb0ac7ab51ea9c6b4ef060de.webp 400w, /_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-formatwebp-width672-2f39ba847e34ed821604402bb37cac98.webp 672w, /_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-formatwebp-width900-b9890313e6c7f1aede6a1d1391bbd08f.webp 900w&#34; sizes=&#34;(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px&#34;&gt;

  &lt;img src=&#34;/_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-width900-0295066c055a667540c36da9f88dfbb1.png&#34; srcset=&#34;/_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-width400-ec8d7bddddbf0caafc5db3311973a2e2.png 400w, /_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-width672-1a8ef86068ff4dab2fc573bb5cf66821.png 672w, /_digested/assets/images/posts/2025-02-04-fixing-chrome-stuck-in-dark-mode-on-ubuntu-2404-with-regolith-i3/settings-width900-0295066c055a667540c36da9f88dfbb1.png 900w&#34; alt=&#34;Ubuntu settings&#34; width=&#34;1199&#34; height=&#34;979&#34; loading=&#34;lazy&#34; class=&#34;mx-auto w-full max-w-2xl&#34;&gt;
&lt;/picture&gt;
</code></pre></div></div>

<h3 id="updated-result">Updated result</h3>

<p>After making as many of the changes as I could, and integrating my library, <a href="https://pagespeed.web.dev/analysis/https-arclight-run-booting-an-old-server-from-nvme-that-doesnt-support-it/9aw4785dge?form_factor=mobile">my PageSpeed score jumped way up</a> to a green 99/100:</p>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-formatavif-width400-6f894454709aab9e4572270c838b16a8.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-formatavif-width672-99ee2ed6137bad79eadefdf721714603.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-formatavif-width900-84144e6c32dfa935fcc364a3b068f1c6.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-formatwebp-width400-0b5507dfe95a5362ce4ae42c8643033f.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-formatwebp-width672-a56164a9f28b2fbcf0ab97778aa59c98.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-formatwebp-width900-89bceb7407b408666fcef5538ccb5d95.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-width900-5280e45f3dd5ec9b720ccc67a6cf16b1.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-width400-cb9942fa14eac3ed26a97b28296b0910.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-width672-0f87a2390a862df69fc61b7a1c46757b.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/pagespeed-current-score-width900-5280e45f3dd5ec9b720ccc67a6cf16b1.png 900w" alt="YouTube embed performance problems" width="1183" height="1258" loading="lazy"/>
</picture>

<p>Amusingly, some of the only remaining issues are from external Google assets that I have no control over, like cache headers and unoptimized image formats on YouTube thumbnails:</p>

<picture>
  <source type="image/avif" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-formatavif-width400-1184f700cf5cb9fd4a15a6d513f1b1c7.avif 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-formatavif-width672-4399f142b495ab9796b3b91053c097b9.avif 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-formatavif-width900-92c5cee3ab48ebc4a828af9568446792.avif 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <source type="image/webp" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-formatwebp-width400-b64ab4bb561071933154f2b327b3d43f.webp 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-formatwebp-width672-961b3cc2b912ff3d34eeb20b5c4b6c84.webp 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-formatwebp-width900-b98716b61c7809a993ed92fcfe868f3c.webp 900w" sizes="(max-width: 640px) calc(100vw - 32px), (max-width: 710px) calc(100vw - 48px), (max-width: 899px) 640px, 672px"/>

  <img src="https://arclight.run/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-width900-c56bf39caddf2b1d2a4c530a6777228a.png" srcset="/_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-width400-bfd577cecddf14629dfc62b0a9532752.png 400w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-width672-eeb05bfba080d27aaf317fa1ea64ab90.png 672w, /_digested/assets/images/posts/2025-07-24-how-i-fixed-my-blogs-performance-issues-by-writing-a-new-jekyll-plugin-jekyll-skyhook/google-assets-width900-c56bf39caddf2b1d2a4c530a6777228a.png 900w" alt="Google asset problems" width="979" height="627" loading="lazy"/>
</picture>

<p>Now all I need to do is focus on creating content and sharing it on social mediaâ€¦</p>

</article>

        </div></div>
  </body>
</html>
