<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Picsart-AI-Research/Text2Video-Zero">Original</a>
    <h1>Text2Video-Zero Code and Weights Released by Picsart AI Research (12G VRAM)</h1>
    
    <div id="readability-page-1" class="page"><div>
    
    <p>
        By <a href="http://cyberdemon.org/">Dmitry Mazin</a>.
        <time datetime="2023-03-28T00:00:00+00:00" itemprop="datePublished">
          
          Mar 28, 2023
        </time>
        <br/>
    </p>
  </div><div itemprop="articleBody">
    <p>More than 5 years ago, in <a href="https://www.cyberdemon.org/2017/12/12/pink-lexical-slime.html">Pink Lexical Slime</a>, I warned that choosing an AI’s suggestion over coming up with your own idea was tantamount to voting yourself out of existence.</p>

<blockquote>
  <p>To put it bluntly, when you use [Gmail’s] Smart Reply, you are effectively voting for your own agency to be automated away.</p>
</blockquote>

<p>It’s worth revisiting that article, but this blog post is not about that.</p>

<p>This post is about augmenting a tedious task that I, honestly, mislike: writing commit messages. I am lazy.</p>

<p>So, I wrote a tool, <code>git-lazy-commit</code>, which comes up with a surprisingly good commit message for your staged git changes.
You can install it from PyPi: <code>pip install git-lazy-commit</code>.</p>

<p>Here are some examples.</p>

<p>Here’s a diff from my <a href="https://github.com/dmazin/dotfiles">dotfiles repo</a> where I added the direnv plugin to oh-my-zsh.</p>
<div><div><pre><code><span>diff --git a/.zshrc.base.inc b/.zshrc.base.inc
index 7926b0e..34b54e0 100644
</span><span>--- a/.zshrc.base.inc
</span><span>+++ b/.zshrc.base.inc
</span><span>@@ -11,6 +11,7 @@</span> plugins=(
   asdf
   # git clone https://github.com/davidparsson/zsh-pyenv-lazy.git ~/.oh-my-zsh/custom/plugins/pyenv-lazy
   pyenv-lazy
<span>+  direnv
</span> )
</code></pre></div></div>

<p><strong>what I’d have written if I wasn’t lazy</strong>: add direnv plugin to oh-my-zsh</p>

<p><strong>git-lazy-commit</strong>: feat: add direnv plugin to zshrc base configuration file</p>

<p>Note that it prepended a silly little “feat:”. It’s not perfect! For this reason, git-lazy-commit lets you edit the proposed commit message using the $EDITOR of your choice.</p>

<p>Another example. Here’s a diff from the git-lazy-commit repo, where I gave up trying to generate the diff with GitPython (I couldn’t figure out how to make its output match <code>git diff --staged</code>) and just used subprocess to run <code>git diff --staged</code> directly.</p>
<div><div><pre><code><span>diff --git a/assistant/core.py b/assistant/core.py
index bea132e..7524ed4 100755
</span><span>--- a/assistant/core.py
</span><span>+++ b/assistant/core.py
</span><span>@@ -1,6 +1,7 @@</span>
 import os
<span>-import git
</span> import argparse
<span>+import subprocess
+import git
</span> from .chatbot import ChatBot


<span>@@ -11,8 +12,9 @@</span> class Assistant:
             model=model,
         )

-    def get_uncommitted_changes(self, repo):
<span>-        uncommitted_changes = repo.git.diff().split(&#34;\n&#34;)
</span><span>+    def get_uncommitted_changes(self):
+        staged_changes = subprocess.run([&#34;git&#34;, &#34;diff&#34;, &#34;--staged&#34;], capture_output=True, text=True)
+        uncommitted_changes = staged_changes.stdout.split(&#39;\n&#39;)
</span>         return uncommitted_changes

     def generate_commit_message(self, changes_summary):
<span>@@ -47,7 +49,7 @@</span> def main(args=None):
     assistant = Assistant(args.model)

     repo = git.Repo(os.getcwd())
<span>-    uncommitted_changes = assistant.get_uncommitted_changes(repo)
</span><span>+    uncommitted_changes = assistant.get_uncommitted_changes()
</span>     changes_summary = &#34;\n&#34;.join(uncommitted_changes)
     generated_commit_message = assistant.generate_commit_message(changes_summary)
</code></pre></div></div>

<p><strong>what I’d have written if I wasn’t lazy</strong>: Use subprocess to call <code>git diff --staged</code> instead of trying to get gitpython to print what I want</p>

<p><strong>git-lazy-commit</strong>: Refactored uncommitted changes retrieval to use subprocess instead of git module</p>

<p>Here, I wanted update the interactivity of git-lazy-commit to allow a user to enter “y” instead of “yes” (etc).</p>
<div><div><pre><code><span>diff --git a/d1c2fee b/2c59fd1
index d1c2fee..2c59fd1 100644
</span><span>--- a/assistant/core.py
</span><span>+++ b/assistant/core.py
</span><span>@@ -39,11 +39,11 @@</span> class Assistant:
             input(&#34;Do you approve this commit message? ((y)es/(n)o/(e)ditor): &#34;).strip().lower()
         )
 
<span>-        if user_input == &#34;yes&#34;:
</span><span>+        if user_input in [&#34;yes&#34;, &#34;y&#34;]:
</span>             return True, commit_msg
<span>-        elif user_input == &#34;no&#34;:
</span><span>+        elif user_input in [&#34;no&#34;, &#34;n&#34;]:
</span>             return False, commit_msg
<span>-        elif user_input == &#34;e&#34;:
</span><span>+        elif user_input in [&#34;editor&#34;, &#34;e&#34;]:
</span>             return self.edit_commit_message(commit_msg)
         else:
             print(&#34;Invalid input. Please enter &#39;yes (or y)&#39;, &#39;no (or n)&#39;, or &#39;editor (or e)&#39;.&#34;)
<span>diff --git a/setup.py b/setup.py
index fccccad..50e03a7 100644
</span><span>--- a/setup.py
</span><span>+++ b/setup.py
</span><span>@@ -2,7 +2,7 @@</span> from setuptools import setup, find_packages
 
 setup(
     name=&#34;git-lazy-commit&#34;,
<span>-    version=&#34;0.9&#34;,
</span><span>+    version=&#34;0.10&#34;,
</span>     packages=find_packages(),
     entry_points={&#34;console_scripts&#34;: [&#34;git-lazy-commit = assistant:main&#34;]},
     install_requires=[&#34;openai&#34;, &#34;GitPython&#34;],
</code></pre></div></div>

<p><strong>what I’d have written if I wasn’t lazy</strong>: allow user to enter “y” instead of “yes” (etc); bump version</p>

<p><strong>git-lazy-commit</strong>: Update version number in setup.py and add support for ‘y’ and ‘n’ input in Assistant class.</p>

<h2 id="documentation">Documentation</h2>
<p>Full documentation is available in the <a href="https://github.com/dmazin/git-lazy-commit/blob/main/README.md">README</a>.</p>

<p>You can get it from PyPi: <code>pip install git-lazy-commit</code>. You’ll need an <a href="https://platform.openai.com/account/api-keys">OpenAPI API key</a>.</p>

<p>And here’s the <a href="https://github.com/dmazin/git-lazy-commit">source repo</a>. Feel free to open issues and make pull requests! One of the funny things about ChatGPT is that additions and modifications are not daunting given that ChatGPT is so good at generating code.</p>

<h2 id="caveats">Caveats</h2>
<p>git-lazy-commit works much better with small diffs. I am finding myself committing more often for this reason. This is a positive change: breaking work into multiple commits makes tracking your work easier. We just don’t do it because writing commit messages is a bit of a pain!</p>

<p>One thing you may notice between my commit messages and ChatGPT’s is that I explain the why while ChatGPT doesn’t. This is important. I think the output is great for quick, lazy commits in personal projects, but for collaborative projects you should add the <em>why</em> as well. This is why <code>git-lazy-commit</code> augments, rather than replaces you: use it come up with an initial message, and then add the why. (This is honestly something we aren’t great at in general. Our comments, commit messages, and PR descriptions need a lot more “why”.)</p>

<h2 id="how-it-works">How it works</h2>
<p><code>git-lazy-commit</code> uses ChatGPT’s API, which I’m using via a module written by <a href="https://til.simonwillison.net/gpt3/chatgpt-api">Simon Willison</a>. Everything about my assistant is plumbing, except for the <a href="https://platform.openai.com/docs/guides/chat/instructing-chat-models">system message</a>. This is the core prompt for the assistant. For example, it’s used to establish the personality and identity of the assistant. Right now, the system message is: “Please generate a commit message given the output of <code>git diff</code>. Please respond with a commit message without any additional text.” The first message we send to ChatGPT is the diff. If a user is unhappy with the output, we say to ChatGPT, “Please come up with another commit message for the diff I sent earlier”.</p>

    
  </div></div>
  </body>
</html>
