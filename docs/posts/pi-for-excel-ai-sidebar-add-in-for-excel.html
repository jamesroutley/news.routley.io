<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/tmustier/pi-for-excel">Original</a>
    <h1>Pi for Excel: AI sidebar add-in for Excel</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Open-source, multi-model AI sidebar add-in for Microsoft Excel. Powered by <a href="https://pi.dev" rel="nofollow">Pi</a>.</p>
<p dir="auto">Pi for Excel is an AI agent that lives inside Excel. It reads your workbook, makes changes, and does research — using any model you choose. Bring your own API key or OAuth login for Anthropic, OpenAI, Google Gemini, or GitHub Copilot.</p>

<p dir="auto"><strong>Core spreadsheet tools</strong> — 16 built-in tools that the AI can call to interact with your workbook:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Tool</th>
<th>What it does</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get_workbook_overview</code></td>
<td>Structural blueprint — sheets, headers, named ranges, tables, charts, pivots</td>
</tr>
<tr>
<td><code>read_range</code></td>
<td>Read cells in compact (markdown), CSV, or detailed (with formatting) mode</td>
</tr>
<tr>
<td><code>write_cells</code></td>
<td>Write values/formulas with overwrite protection and auto-verification</td>
</tr>
<tr>
<td><code>fill_formula</code></td>
<td>AutoFill a formula across a range (relative refs adjust automatically)</td>
</tr>
<tr>
<td><code>search_workbook</code></td>
<td>Find text, values, or formula references across all sheets</td>
</tr>
<tr>
<td><code>modify_structure</code></td>
<td>Insert/delete rows/columns, add/rename/delete/hide sheets</td>
</tr>
<tr>
<td><code>format_cells</code></td>
<td>Apply formatting — fonts, colors, number formats, borders, named styles</td>
</tr>
<tr>
<td><code>conditional_format</code></td>
<td>Add or clear conditional formatting rules</td>
</tr>
<tr>
<td><code>trace_dependencies</code></td>
<td>Trace formula lineage (precedents upstream or dependents downstream)</td>
</tr>
<tr>
<td><code>explain_formula</code></td>
<td>Plain-language formula explanation with cited cell references</td>
</tr>
<tr>
<td><code>view_settings</code></td>
<td>Gridlines, headings, freeze panes, tab color, sheet visibility</td>
</tr>
<tr>
<td><code>comments</code></td>
<td>Read, add, update, reply, resolve/reopen cell comments</td>
</tr>
<tr>
<td><code>workbook_history</code></td>
<td>List/restore automatic in-between-saves backups for workbook mutations</td>
</tr>
<tr>
<td><code>instructions</code></td>
<td>Persistent user-level and workbook-level guidance for the AI</td>
</tr>
<tr>
<td><code>conventions</code></td>
<td>Configurable formatting defaults (currency, negatives, zeros, decimal places)</td>
</tr>
<tr>
<td><code>skills</code></td>
<td>Bundled Agent Skills for task-specific workflows</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><strong>Multi-model support</strong> — use any supported provider; switch models mid-conversation:</p>
<ul dir="auto">
<li><strong>Anthropic</strong> (Claude) — API key or OAuth</li>
<li><strong>OpenAI</strong> / <strong>OpenAI Codex</strong> — API key</li>
<li><strong>Google Gemini</strong> — API key</li>
<li><strong>GitHub Copilot</strong> — OAuth</li>
</ul>
<p dir="auto"><strong>Session management</strong> — multiple session tabs per workbook, auto-save/restore, session history, <code>/resume</code> to pick up where you left off.</p>
<p dir="auto"><strong>Auto-context injection</strong> — the AI automatically receives the workbook blueprint, your current selection, and recent cell changes before every turn. No need to manually describe what you&#39;re looking at.</p>
<p dir="auto"><strong>Workbook recovery</strong> — automatic checkpoints before every mutation. One-click revert from the sidebar if something goes wrong.</p>
<p dir="auto"><strong>Formatting conventions</strong> — define your house style once (currency symbol, negative style, decimal places) and the AI follows it automatically.</p>
<p dir="auto"><strong>Slash commands</strong> — <code>/model</code>, <code>/login</code>, <code>/settings</code>, <code>/rules</code>, <code>/extensions</code>, <code>/integrations</code>, <code>/export</code>, <code>/compact</code>, <code>/new</code>, <code>/resume</code>, <code>/history</code>, <code>/shortcuts</code>, and more.</p>
<p dir="auto"><strong>Extensions</strong> — install sidebar extensions (mini-apps) from chat. The AI can generate and install extension code directly via the <code>extensions_manager</code> tool. Extensions run in an iframe sandbox by default.</p>
<p dir="auto"><strong>Integrations</strong> — opt-in external tool integrations:</p>
<ul dir="auto">
<li><strong>Web Search</strong> (Serper/Tavily/Brave) + <code>fetch_page</code> — find and read external sources without leaving Excel</li>
<li><strong>MCP Gateway</strong> — connect to user-configured MCP servers for custom tool access</li>
</ul>
<p dir="auto"><strong>Feature-flagged capabilities</strong> (managed via <code>/experimental</code>):</p>
<ul dir="auto">
<li>Tmux bridge — local terminal control from the sidebar</li>
<li>Python / LibreOffice bridge — run Python scripts and convert files locally</li>
<li>Files workspace write/delete gate — shared artifact storage across sessions (assistant built-in docs under <code>assistant-docs/</code> are always available read-only)</li>
<li>External skills discovery — opt-in loading of locally configured external <code>SKILL.md</code> sources</li>
<li>Advanced extension controls — remote URL opt-in, permission enforcement, sandbox rollback, and Widget API v2</li>
</ul>
<p dir="auto">(Web Search + MCP are managed in <code>/integrations</code>.)</p>

<ol dir="auto">
<li>Download <a href="https://pi-for-excel.vercel.app/manifest.prod.xml" rel="nofollow"><code>manifest.prod.xml</code></a></li>
<li>Add it to Excel — see <a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/install.md"><strong>install guide</strong></a> for step-by-step instructions (macOS + Windows)</li>
<li>Click <strong>Open Pi</strong> in the ribbon</li>
<li>Connect a provider (paste an API key or sign in with OAuth)</li>
<li>Start chatting — try <code>What sheets do I have?</code> or <code>Summarize my current selection</code></li>
</ol>


<ul dir="auto">
<li><strong>Node.js ≥ 20</strong></li>
<li><strong>mkcert</strong> — for local HTTPS (required by Office.js)</li>
</ul>

<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/tmustier/pi-for-excel.git
cd pi-for-excel
npm install

# Generate local HTTPS certs (Office.js requires HTTPS)
mkcert -install   # one-time CA setup
mkcert localhost   # creates localhost.pem + localhost-key.pem
mv localhost-key.pem key.pem
mv localhost.pem cert.pem"><pre>git clone https://github.com/tmustier/pi-for-excel.git
<span>cd</span> pi-for-excel
npm install

<span><span>#</span> Generate local HTTPS certs (Office.js requires HTTPS)</span>
mkcert -install   <span><span>#</span> one-time CA setup</span>
mkcert localhost   <span><span>#</span> creates localhost.pem + localhost-key.pem</span>
mv localhost-key.pem key.pem
mv localhost.pem cert.pem</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="npm run dev        # Vite dev server on https://localhost:3000"><pre>npm run dev        <span><span>#</span> Vite dev server on https://localhost:3000</span></pre></div>
<p dir="auto">Then sideload the dev manifest into Excel:</p>
<p dir="auto"><strong>macOS</strong> (<a href="https://learn.microsoft.com/en-us/office/dev/add-ins/testing/sideload-an-office-add-in-on-mac" rel="nofollow">Microsoft docs</a>):</p>
<div dir="auto" data-snippet-clipboard-copy-content="cp manifest.xml ~/Library/Containers/com.microsoft.Excel/Data/Documents/wef/"><pre>cp manifest.xml <span>~</span>/Library/Containers/com.microsoft.Excel/Data/Documents/wef/</pre></div>
<p dir="auto">Then open Excel → <strong>Insert</strong> → <strong>My Add-ins</strong> → <strong>Pi for Excel</strong>.</p>
<p dir="auto"><strong>Windows</strong> (<a href="https://learn.microsoft.com/en-us/office/dev/add-ins/testing/sideload-office-add-ins-for-testing" rel="nofollow">Microsoft docs</a>):</p>
<p dir="auto">Open Excel → <strong>Insert</strong> → <strong>My Add-ins</strong> → <strong>Upload My Add-in</strong> → select <code>manifest.xml</code>.</p>
<p dir="auto">The dev manifest points to <code>https://localhost:3000</code>. The production manifest (<code>manifest.prod.xml</code>) points to the hosted Vercel deployment.</p>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>npm run dev</code></td>
<td>Start Vite dev server (port 3000, HTTPS)</td>
</tr>
<tr>
<td><code>npm run build</code></td>
<td>Production build → <code>dist/</code></td>
</tr>
<tr>
<td><code>npm run check</code></td>
<td>Lint + typecheck + CSS theme checks</td>
</tr>
<tr>
<td><code>npm run typecheck</code></td>
<td>TypeScript type checking only</td>
</tr>
<tr>
<td><code>npm run lint</code></td>
<td>ESLint</td>
</tr>
<tr>
<td><code>npm run test:models</code></td>
<td>Unit tests — model ordering</td>
</tr>
<tr>
<td><code>npm run test:context</code></td>
<td>Unit tests — tools, context, sessions, extensions, integrations</td>
</tr>
<tr>
<td><code>npm run test:security</code></td>
<td>Security policy tests — proxy, CORS, sandbox, OAuth</td>
</tr>
<tr>
<td><code>npm run proxy:https</code></td>
<td>CORS proxy for OAuth flows (default <code>https://localhost:3003</code>)</td>
</tr>
<tr>
<td><code>npm run validate</code></td>
<td>Validate the Office add-in manifest</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">Some OAuth token endpoints are blocked by CORS inside Office webviews. If OAuth login fails:</p>
<ol dir="auto">
<li>User setup command: <code>npx pi-for-excel-proxy</code> (or <code>curl -fsSL https://piforexcel.com/proxy | sh</code> if Node is missing)</li>
<li>Dev/source setup command: <code>npm run proxy:https</code> (defaults to <code>https://localhost:3003</code>)</li>
<li>In Pi → <code>/settings</code> → <strong>Proxy</strong> → enable and set the URL</li>
<li>Retry login</li>
</ol>
<p dir="auto">API-key auth generally works without the proxy.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Local bridges (Python / tmux)</h3><a id="user-content-local-bridges-python--tmux" aria-label="Permalink: Local bridges (Python / tmux)" href="#local-bridges-python--tmux"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Use one-command local bridge helpers:</p>
<ul dir="auto">
<li>Python / LibreOffice bridge: <code>npx pi-for-excel-python-bridge</code> (default URL <code>https://localhost:3340</code>, real mode)</li>
<li>tmux bridge: <code>npx pi-for-excel-tmux-bridge</code> (default URL <code>https://localhost:3341</code>, real mode)</li>
</ul>
<p dir="auto">In Pi, these localhost bridge URLs are used by default. Configure <code>/experimental ...-bridge-url</code> only when you want a non-default URL.</p>
<p dir="auto">Real-mode prerequisites:</p>
<ul dir="auto">
<li><code>python3</code> must be installed for <code>python_run</code> / <code>python_transform_range</code></li>
<li>LibreOffice (<code>soffice</code> or <code>libreoffice</code>) is required for <code>libreoffice_convert</code></li>
<li><code>tmux</code> is required for the tmux bridge real mode</li>
</ul>
<p dir="auto">Optional assisted install (macOS/Homebrew):</p>
<ul dir="auto">
<li><code>npx pi-for-excel-python-bridge --install-missing</code></li>
<li><code>npx pi-for-excel-tmux-bridge --install-missing</code></li>
</ul>
<p dir="auto">Manual macOS install:</p>
<div dir="auto" data-snippet-clipboard-copy-content="brew install tmux
brew install --cask libreoffice"><pre>brew install tmux
brew install --cask libreoffice</pre></div>
<p dir="auto">To force safe simulated mode instead:</p>
<ul dir="auto">
<li><code>PYTHON_BRIDGE_MODE=stub npx pi-for-excel-python-bridge</code></li>
<li><code>TMUX_BRIDGE_MODE=stub npx pi-for-excel-tmux-bridge</code></li>
</ul>
<p dir="auto">Source-checkout alternatives remain available via <code>npm run python:bridge:https</code> and <code>npm run tmux:bridge:https</code>.</p>

<p dir="auto">Pi for Excel is a single-page Office taskpane add-in built with:</p>
<ul dir="auto">
<li><strong><a href="https://vite.dev/" rel="nofollow">Vite</a></strong> — dev server + production bundler</li>
<li><strong><a href="https://lit.dev/" rel="nofollow">Lit</a></strong> — web components for the sidebar UI</li>
<li><strong><a href="https://www.npmjs.com/package/@mariozechner/pi-agent-core" rel="nofollow">pi-agent-core</a></strong> — agent runtime (tool loop, streaming, state management)</li>
<li><strong><a href="https://www.npmjs.com/package/@mariozechner/pi-ai" rel="nofollow">pi-ai</a></strong> — multi-provider LLM abstraction (Anthropic, OpenAI, Google, GitHub Copilot)</li>
<li><strong><a href="https://www.npmjs.com/package/@mariozechner/pi-web-ui" rel="nofollow">pi-web-ui</a></strong> — shared web UI components (message rendering, storage, settings dialogs)</li>
<li><strong><a href="https://learn.microsoft.com/en-us/office/dev/add-ins/" rel="nofollow">Office.js</a></strong> — Excel workbook API</li>
</ul>

<div data-snippet-clipboard-copy-content="src/
├── taskpane/          # App init, session management, tab layout, context injection
├── taskpane.html      # Entry HTML (loads Office.js + taskpane.ts)
├── taskpane.ts        # Entry script
├── boot.ts            # Pre-mount setup (CSS, patches)
├── tools/             # 16 core tools + feature-flagged tools + registry
├── prompt/            # System prompt builder
├── context/           # Workbook blueprint cache, selection/change tracking
├── auth/              # OAuth providers, API proxy, credential restore
├── models/            # Model ordering + version scoring
├── ui/                # Sidebar component, tool renderers, theme CSS
│   └── theme/         # Design tokens, component styles (DM Sans + teal-green palette)
├── commands/          # Slash command registry + builtins
├── extensions/        # Extension store, sandbox runtime, permissions
├── integrations/      # Web Search + MCP Gateway integration catalog
├── skills/            # Agent Skills catalog + runtime loader
├── experiments/       # Feature flag definitions + toggle logic
├── workbook/          # Workbook identity (hashed), session association, coordinator
├── conventions/       # Formatting defaults (currency, negatives, dp)
├── rules/             # Persistent user/workbook rules store
├── compaction/        # Auto-compaction thresholds + logic
├── storage/           # IndexedDB initialization
├── files/             # Files workspace (read/list always on; write/delete feature-gated)
├── audit/             # Workbook change audit log
├── messages/          # Message conversion helpers
├── debug/             # Debug mode utilities
├── stubs/             # Browser stubs for CSP/Node-only deps (Ajv, Bedrock, stream, etc.)
├── compat/            # Compatibility patches (Lit, marked, model selector)
└── utils/             # Shared helpers (HTML escape, type guards, errors)

scripts/               # Dev helpers — CORS proxy, tmux/python bridges, manifest gen
pkg/proxy/             # Publishable npm CLI package: `pi-for-excel-proxy`
pkg/python-bridge/     # Publishable npm CLI package: `pi-for-excel-python-bridge`
pkg/tmux-bridge/       # Publishable npm CLI package: `pi-for-excel-tmux-bridge`
tests/                 # Unit + security tests (~50 test files)
docs/                  # Current docs (install/deploy/features/policy) + archive/ for historical plans
skills/                # Bundled Agent Skill definitions (web-search, mcp-gateway)
public/assets/         # Add-in icons (16/32/80/128px)"><pre><code>src/
├── taskpane/          # App init, session management, tab layout, context injection
├── taskpane.html      # Entry HTML (loads Office.js + taskpane.ts)
├── taskpane.ts        # Entry script
├── boot.ts            # Pre-mount setup (CSS, patches)
├── tools/             # 16 core tools + feature-flagged tools + registry
├── prompt/            # System prompt builder
├── context/           # Workbook blueprint cache, selection/change tracking
├── auth/              # OAuth providers, API proxy, credential restore
├── models/            # Model ordering + version scoring
├── ui/                # Sidebar component, tool renderers, theme CSS
│   └── theme/         # Design tokens, component styles (DM Sans + teal-green palette)
├── commands/          # Slash command registry + builtins
├── extensions/        # Extension store, sandbox runtime, permissions
├── integrations/      # Web Search + MCP Gateway integration catalog
├── skills/            # Agent Skills catalog + runtime loader
├── experiments/       # Feature flag definitions + toggle logic
├── workbook/          # Workbook identity (hashed), session association, coordinator
├── conventions/       # Formatting defaults (currency, negatives, dp)
├── rules/             # Persistent user/workbook rules store
├── compaction/        # Auto-compaction thresholds + logic
├── storage/           # IndexedDB initialization
├── files/             # Files workspace (read/list always on; write/delete feature-gated)
├── audit/             # Workbook change audit log
├── messages/          # Message conversion helpers
├── debug/             # Debug mode utilities
├── stubs/             # Browser stubs for CSP/Node-only deps (Ajv, Bedrock, stream, etc.)
├── compat/            # Compatibility patches (Lit, marked, model selector)
└── utils/             # Shared helpers (HTML escape, type guards, errors)

scripts/               # Dev helpers — CORS proxy, tmux/python bridges, manifest gen
pkg/proxy/             # Publishable npm CLI package: `pi-for-excel-proxy`
pkg/python-bridge/     # Publishable npm CLI package: `pi-for-excel-python-bridge`
pkg/tmux-bridge/       # Publishable npm CLI package: `pi-for-excel-tmux-bridge`
tests/                 # Unit + security tests (~50 test files)
docs/                  # Current docs (install/deploy/features/policy) + archive/ for historical plans
skills/                # Bundled Agent Skill definitions (web-search, mcp-gateway)
public/assets/         # Add-in icons (16/32/80/128px)
</code></pre></div>

<ul dir="auto">
<li><strong>Tool registry as single source of truth</strong> — <code>src/tools/registry.ts</code> defines all core tool names and construction. UI renderers, input humanizers, and prompt docs all derive from it.</li>
<li><strong>Workbook coordinator</strong> — serializes mutating tool calls per-workbook to prevent concurrent writes from multiple session tabs.</li>
<li><strong>Auto-context</strong> — the workbook blueprint, selection state, and recent changes are injected before each user message so the AI always knows what it&#39;s looking at.</li>
<li><strong>Execution policy</strong> — each tool is classified as <code>read/none</code> or <code>mutate/content|structure</code> to determine locking and checkpoint behavior.</li>
<li><strong>Recovery checkpoints</strong> — mutations automatically snapshot affected cells before writing, enabling one-click rollback.</li>
<li><strong>Extension sandbox</strong> — untrusted extensions (inline code, remote URLs) run in an iframe sandbox by default; built-in/local modules run on the host.</li>
</ul>

<p dir="auto">The production build is a static site deployed to <a href="https://vercel.com" rel="nofollow">Vercel</a>. See <a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/deploy-vercel.md">docs/deploy-vercel.md</a> for maintainer setup.</p>
<p dir="auto">Users install by downloading <code>manifest.prod.xml</code> and uploading it in Excel — the manifest points to the hosted Vercel URL. Updates are automatic (close and reopen the taskpane).</p>

<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Doc</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/install.md">docs/install.md</a></td>
<td>Non-technical install guide</td>
</tr>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/deploy-vercel.md">docs/deploy-vercel.md</a></td>
<td>Hosted deployment (Vercel)</td>
</tr>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/extensions.md">docs/extensions.md</a></td>
<td>Extension authoring guide</td>
</tr>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/integrations-external-tools.md">docs/integrations-external-tools.md</a></td>
<td>Web Search + MCP integration setup</td>
</tr>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/security-threat-model.md">docs/security-threat-model.md</a></td>
<td>Security threat model</td>
</tr>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/docs/compaction.md">docs/compaction.md</a></td>
<td>Session compaction (<code>/compact</code>)</td>
</tr>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/src/tools/DECISIONS.md">src/tools/DECISIONS.md</a></td>
<td>Tool behavior decisions log</td>
</tr>
<tr>
<td><a href="https://github.com/tmustier/pi-for-excel/blob/main/src/ui/README.md">src/ui/README.md</a></td>
<td>UI architecture + Tailwind v4 notes</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<ul dir="auto">
<li><a href="https://github.com/badlogic/pi-mono">Pi</a> by <a href="https://github.com/badlogic">@badlogic</a> (Mario Zechner) — the agent framework powering this project. Pi for Excel uses pi-agent-core, pi-ai, and pi-web-ui for the agent loop, LLM abstraction, and session storage.</li>
<li><a href="https://github.com/mitsuhiko/agent-stuff/blob/main/pi-extensions/whimsical.ts">whimsical.ts</a> by <a href="https://github.com/mitsuhiko">@mitsuhiko</a> (Armin Ronacher) — the rotating &#34;Working…&#34; messages are adapted from his Pi extension, rewritten for a spreadsheet/finance audience.</li>
</ul>

<p dir="auto"><a href="https://github.com/tmustier/pi-for-excel/blob/main/LICENSE">MIT</a> © Thomas Mustier</p>
</article></div></div>
  </body>
</html>
