<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246">Original</a>
    <h1>Firefox &#34;Copy&#34; has been inconsistent and broken for 8 months</h1>
    
    <div id="readability-page-1" class="page"><div id="main-inner">










<section>
  
</section>


<section id="module-categories">
    
  
</section>


<section id="module-tracking">
    
  
</section>



<section id="module-people">
    
  
</section>


<section id="module-references">
    
  
</section>


<section id="module-details">
    
  
</section>
















<section id="module-attachments">
    
  
</section>







<meta name="firefox-versions" content="{&#34;FIREFOX_AURORA&#34;:&#34;&#34;,&#34;FIREFOX_DEVEDITION&#34;:&#34;128.0b9&#34;,&#34;FIREFOX_ESR&#34;:&#34;115.12.0esr&#34;,&#34;FIREFOX_ESR_NEXT&#34;:&#34;&#34;,&#34;FIREFOX_NIGHTLY&#34;:&#34;129.0a1&#34;,&#34;LAST_MERGE_DATE&#34;:&#34;2024-06-10&#34;,&#34;LAST_RELEASE_DATE&#34;:&#34;2024-06-11&#34;,&#34;LAST_SOFTFREEZE_DATE&#34;:&#34;2024-06-06&#34;,&#34;LAST_STRINGFREEZE_DATE&#34;:&#34;2024-06-07&#34;,&#34;LATEST_FIREFOX_DEVEL_VERSION&#34;:&#34;128.0b9&#34;,&#34;LATEST_FIREFOX_OLDER_VERSION&#34;:&#34;3.6.28&#34;,&#34;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&#34;:&#34;128.0b9&#34;,&#34;LATEST_FIREFOX_VERSION&#34;:&#34;127.0.2&#34;,&#34;NEXT_MERGE_DATE&#34;:&#34;2024-07-08&#34;,&#34;NEXT_RELEASE_DATE&#34;:&#34;2024-07-09&#34;,&#34;NEXT_SOFTFREEZE_DATE&#34;:&#34;2024-07-04&#34;,&#34;NEXT_STRINGFREEZE_DATE&#34;:&#34;2024-07-05&#34;}"/>



<div id="c0"><div id="ct-0" data-comment-id="16653179" data-ismarkdown="true"><p>+++ This bug was initially created as a clone of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1860426" title="RESOLVED DUPLICATE - Copy disabled despite selection existing in the content process">Bug #1860426</a> +++</p>
<p>When I test <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1860426" title="RESOLVED DUPLICATE - Copy disabled despite selection existing in the content process">Bug 1860426</a>.</p>
<p>Steps to reproduce:</p>
<ol>
<li>
<p>Set Bookmarks Toolbar to <code>Always Show</code>(to simplify the procedure)</p>
</li>
<li>
<p>Bookmark <a href="https://www.google.com/" rel="nofollow">https://www.google.com/</a> as Google. And place it on the bookmark toolbar.</p>
</li>
<li>
<p>Copy any text to clipboard (to simplify the reprocedure)</p>
</li>
<li>
<p>Close and reopen Firefox.</p>
</li>
<li>
<p>Click on <code>Getting Started</code>(I don&#39;t think it&#39;s limited to this one) in the Bookmarks Toolbar</p>
</li>
<li>
<p>Click on <code>Google</code> in the Bookmarks Toolbar</p>
</li>
<li>
<p>Right mouse click on Google&#39;s input field</p>
</li>
</ol>
<p>OR</p>
<ol>
<li>Open <a href="https://www.google.com/" rel="nofollow">https://www.google.com/</a> in a tab</li>
<li>Open  <a href="https://ftp.mozilla.org/pub/firefox/nightly/" rel="nofollow">https://ftp.mozilla.org/pub/firefox/nightly/</a> in the same tab</li>
<li>Click on Go back button (or Alt+Left Arrow)</li>
<li>Click on Go forward button (Alt+Right Arrow)</li>
<li>Select some text</li>
<li>Right click</li>
</ol>
<p>Actual Results:</p>
<p>Expected Results:</p>
<p>Regression window:</p>
</div></div><div id="a871_293623"><div><p>Summary: Copy and Past Bug → Copy and Past context menu are disabled in some case</p></div></div><div id="c1"><div id="ct-1" data-comment-id="16653185" data-ismarkdown="true"><p>Set release status flags based on info from the regressing <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1732358" title="RESOLVED FIXED - Enable Fission pref by default in Firefox 97">bug 1732358</a></p>
<p>:nika, since you are the author of the regressor, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1732358" title="RESOLVED FIXED - Enable Fission pref by default in Firefox 97">bug 1732358</a>, could you take a look? Also, could you set the severity field?</p>
<p>For more information, please visit <a href="https://wiki.mozilla.org/BugBot#needinfo_regression_author.py" rel="nofollow">BugBot documentation</a>.</p>
</div></div><div id="a34387_159069"><div><p>Summary: Copy and Past context menu are disabled in some case → Copy and Paste context menu are disabled in some case</p></div></div><div id="c2"><div id="ct-2" data-comment-id="16655984" data-ismarkdown="true"><p>The regressing bug here is enabling Fission, meaning that this is likely a behaviour change in our clipboard enable/disable logic caused by process switches. Redirecting to :masayuki for some insight from the editor side as to what might be going on?</p>
<p>There&#39;s also a chance this is an issue with APZ and input event targeting, given that this is intended to be a context menu on an input field.</p>
</div><div><p>Flags: needinfo?(nika) → needinfo?(masayuki)</p></div></div><div id="c3"><p>Ok,</p><div><p>Component: DOM: UI Events &amp; Focus Handling → DOM: Navigation</p></div></div><div id="c4"><div><p>Flags: <span>needinfo?(masayuki)</span></p></div></div><div id="c5"><p>Masayuki, could you assign a severity?</p><div><p>Flags: needinfo?(masayuki)</p></div></div><div id="c7"><div id="ct-7" data-comment-id="16659421" data-ismarkdown="true"><p>(In reply to Masayuki Nakano [:masayuki] (he/him)(JST, +0900) from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246#c4" title="ASSIGNED - Copy and Paste context menu entries are sometimes disabled when they should not be">comment #4</a>)</p>
<blockquote>
<p>So I guess that the command state manager asked wrong document, but looks like the <code>&lt;input&gt;</code> of Google search is not in a sub-document. So I have no idea where is wrong.</p>
</blockquote>
<p>Did you see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1860426#c6" title="RESOLVED DUPLICATE - Copy disabled despite selection existing in the content process">bug 1860426 comment 6</a>? And does that help at all?</p>
<p>(In reply to Neil Deakin from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1860426#c6" title="RESOLVED DUPLICATE - Copy disabled despite selection existing in the content process">bug 1860426 comment #6</a>)</p>
<blockquote>
<p>I can reproduce this fairly reliably. It looks like nsFocusManager::GetActiveBrowsingContextInChrome is returning null for some reason.</p>
</blockquote>
</div></div><div id="c8"><p>I just commented from the editor side (as requested). I&#39;m not familiar with the focus management between content processes.</p><div><p>Flags: <span>needinfo?(masayuki)</span></p></div></div><div id="c9"><p>Henri, you did work on the Fission focus handling. Do you have an idea of what&#39;s going on?</p><div><p>Flags: needinfo?(hsivonen)</p></div></div><div id="c12"><div id="ct-12" data-comment-id="16661367" data-ismarkdown="true"><p>(In reply to Andreas Farre [:farre] from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246#c9" title="ASSIGNED - Copy and Paste context menu entries are sometimes disabled when they should not be">comment #9</a>)</p>
<blockquote>
<p>Do you have an idea of what&#39;s going on?</p>
</blockquote>
<p>Not beyond:</p>
<blockquote>
<blockquote>
<p>I can reproduce this fairly reliably. It looks like nsFocusManager::GetActiveBrowsingContextInChrome is returning null for some reason.</p>
</blockquote>
</blockquote>
<p>That is, I don&#39;t have an idea of why active browsing context tracking in the parent process gets out of sync.</p>
</div><div><p>Flags: <span>needinfo?(hsivonen)</span></p></div></div><div id="c13"><p>Hmm. Considering what the regressor is, perhaps we fail to restore the activeness status properly when a page comes out of the bf cache?</p></div><div id="c14"><p>I noticed that an easy workaround when this happens is to click the address bar to change selection focus, then interact with the page again.  After that, the &#34;Copy&#34; entry in the context menu works again without reopening the tab.  Maybe this can give a hint about what might be causing it.</p></div><div id="c15"><div id="ct-15" data-comment-id="16665906" data-ismarkdown="true"><p>(In reply to lexlexlex from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246#c14" title="ASSIGNED - Copy and Paste context menu entries are sometimes disabled when they should not be">comment #14</a>)</p>
<blockquote>
<p>I noticed that an easy workaround when this happens is to click the address bar to change selection focus, then interact with the page again.  After that, the &#34;Copy&#34; entry in the context menu works again without reopening the tab.  Maybe this can give a hint about what might be causing it.</p>
</blockquote>
<p>I can confirm that this workaround is valid for me in Win11 latest.</p>
</div></div><div id="c16"><p>To clarify, I am running Manjaro XFCE with X11, so along with Mark&#39;s confirmation above, it sounds like this workaround is confirmed for both Linux and Windows.  Therefore, I expect that we can conclude that this issue and its specific manifested behavior is not platform-specific.</p></div><div id="c18"><p>Set release status flags based on info from the regressing <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1720990" title="RESOLVED FIXED - The &#34;Copy&#34; menu item gets broken (not-clickable) after unsuccessful navigation (bfcacheInParent)">bug 1720990</a></p></div><div id="c19"><p>In a rather unexpected turn of events, I discovered that the bug on my Mac was resolved perfectly once I disabled uBlock Origin. I suspect it has something to do with anti-tracking features, or something along those lines. As someone who&#39;s not particularly tech-savvy, that&#39;s just my guess.</p></div><div id="a1945569_24295"><div><p>Assignee: nobody → peterv</p><p>Status: NEW → ASSIGNED</p><p>Flags: <span>needinfo?(peterv)</span></p></div></div><div id="c21"><p>I still haven&#39;t been able to reproduce this. I tried the STR from this bug, the duplicates and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1761430" title="NEW - Edit context menu items are incorrectly disabled/broken after searching with searchfox.org, or www.basschouten.com">bug 1761430</a>.</p></div><div id="c23"><div id="ct-23" data-comment-id="16703772" data-ismarkdown="true"><p>A few days ago that I reproduced it, I noticed that, the text seemed to be successfully copied to the clipboard, as it was listed in both klipper (KDE) and fcitx5 (IME; its clipboard manager). I just wasn&#39;t able to paste it anywhere, Firefox or other software, through, either the context menu or the shortcut.</p>
<p>I have two clipboard-related prefs in non-default states: <code>dom.event.clipboardevents.enabled:false</code> and <code>clipboard.autocopy:false</code>.</p>
</div></div><div id="c24"><div id="ct-24" data-comment-id="16706825" data-ismarkdown="true"><p>@tgn-ff is describing some other bug, because their described behavior is not this bug&#39;s observed behavior.  This bug is simply the context menu entries being disabled, with a workaround of focusing the address bar.</p>
<p>I have no clipboard-related prefs in non-default states and this bug manifests for me once or twice per day.  I use multiple Firefox windows, each with many tabs.</p>
</div></div><div id="c25"><div id="ct-25" data-comment-id="16706870" data-ismarkdown="true"><p>(In reply to arsdn from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246#c19" title="ASSIGNED - Copy and Paste context menu entries are sometimes disabled when they should not be">comment #19</a>)</p>
<blockquote>
<p>In a rather unexpected turn of events, I discovered that the bug on my Mac was resolved perfectly once I disabled uBlock Origin. I suspect it has something to do with anti-tracking features, or something along those lines. As someone who&#39;s not particularly tech-savvy, that&#39;s just my guess.</p>
</blockquote>
<p>After several days of browsing, I noticed that this bug still occurred once or twice a day, even after turning off all extensions, including uBlock Origin. So, I have now proven my initial guess wrong. Also, my browser version is 120.0.1 (64-bit).</p>
</div></div><div id="c26"><p>I am finally able to reproduce this issue, but still not reliably, and it&#39;s happening probably once out of tens of attempts.</p></div><div id="c27"><p>I believe this is not caused by the bookmark system, since I see it often and almost never use bookmarks.  I never have the bookmarks bar enabled, either.  I may use a bookmark once per 2 months, yet this bug manifests multiple times per week.</p></div><div id="c28"><p>I cleared browsing &amp; download, cache and form &amp; search histories then opened and closed Firefox 10 times. Each time I went to the bookmarks menu. I used three different websites for the test, giving the website sufficient time to load. Then selected non-linked text. On the context menu copy was grayed out 4 times out of those ten times. I opened a new tab then went back to the first tab and copy was no longer grayed out.</p></div><div id="c29"><div id="ct-29" data-comment-id="16713710" data-ismarkdown="true"><p>Debugging shows that the focus manager for the process for the page being unloaded is receiving WindowHidden() which clears the mActiveBrowsingContextInChrome field. The focus manager for the process for the page being loaded is receiving WindowRaised() which sets the mActiveBrowsingContextInChrome field.</p>
<p>On success, the two processes perform those steps in that order. On failure, they perform those steps in the reverse order. There&#39;s a bunch of code in ProcessPendingActiveBrowsingContextActionId that is supposed to handle these calls being out of order, but I can&#39;t figure out what it is trying to do, but it seems to fail in this case.</p>
<p>I can reproduce with the steps in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1860426#c2">https://bugzilla.mozilla.org/show_bug.cgi?id=1860426#c2</a> about 20-30% of the time, but I don&#39;t need to exit each time; it is sufficient at step 2 to just open a new window.</p>
</div></div><div id="c38"><p>Thanks for the clarification. No argument here.</p></div><div id="c42"><div id="ct-42" data-comment-id="16742187" data-ismarkdown="true"><p>I&#39;m able to reproduce this bug without any extensions installed on a brand new profile (Firefox 121 on Linux 6.6.10).</p>
<p>The only workaround is to click into the address bar, swap tabs or just play around with random UI and then right click the selected text again.</p>
<p>This is a pretty annoying bug that affects a core functionality of the UX, any updates on a patch or fix?</p>
</div></div><div id="c43"><p>Any progress will be posted here.</p></div><div id="c51"><p>The easiest and simplest workaround of all and surprisingly has not been mentioned and which I find works is to highlight text and press Ctrl-C.</p></div><div id="c55"><div id="ct-55" data-comment-id="16780870" data-ismarkdown="true"><p>Got the same problem, all add-ons deactivated and the context menu option &#34;copy&#34; is still greyed out. Had the same problem since at least two Firefox versions ago.</p>
<p>Firefox version: 122.0 (64-bit)</p>
</div></div><div id="c57"><div id="ct-57" data-comment-id="16794051" data-ismarkdown="true"><p>(In reply to me from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246#c56" title="ASSIGNED - Copy and Paste context menu entries are sometimes disabled when they should not be">comment #56</a>)</p>
<blockquote>
<p>If it helps fellow sufferers or those working on this bug the Copy/Paste Plaintext add-on does not suffer from this issue</p>
<p><a href="https://addons.mozilla.org/en-GB/firefox/addon/copy-plaintext/" rel="nofollow">https://addons.mozilla.org/en-GB/firefox/addon/copy-plaintext/</a></p>
</blockquote>
<p>Ich kann jetzt nicht genau sagen ab welcher Version es anfing aber ab Ende 2023 war es nach ein Update von Firefox auf einmal da leider sehr sporadisch aber es nervt echt schon.</p>
<p>Für mich war es zum Schluss nicht mehr brauchbar („11.2023“) weil wenn es drauf ankommt was zu Kopieren der Menüpunkt grau hinterlegt ist, bin zur ESR Version ausgewichen was einbandfrei läuft.</p>
<p>Jetzt nach ihren Beitrag mit dem Copy/Paste Plaintext add-on habe ich es noch mal versucht in der 122.0.1 (64-Bit) und ja („Copy Plain Text == add-on“) geht auch wenn Kopieren in Menüpunkt grau hinterlegt ist, das ist zwar nicht die Lösung aber man kann wieder mit der Version von Firefox arbeiten.</p>
<p>Ich hoffe sehr dass man den Fehler (&#34;Bugs&#34;) noch findet.</p>
<p>System:</p>
</div></div><div id="c62"><div id="ct-62" data-comment-id="16808046" data-ismarkdown="true"><p>Should the title of this ticket be changed to demonstrate that this ticket is the officially-acknowledged ticket for this issue?  The current title&#39;s grammar makes it look unofficial or not acknowledged, so potential bug reporters searching for this issue may not realize it has been acknowledged, which may be contributing to various duplicate reports.  Here are some suggestions:</p>
<ul>
<li>&#34;Clipboard actions in page context menus are disabled in some cases&#34;</li>
<li>&#34;Clipboard actions in page context menus become disabled under some circumstances&#34;</li>
<li>&#34;Copy and paste context menu entries are sometimes disabled&#34;</li>
</ul>
</div></div><div id="a9466406_159069"><div><p>Summary: Copy and Paste context menu are disabled in some case → Copy and Paste context menu entries are sometimes disabled when they should not be</p></div></div><div id="c64"><p>Peter, any update on this? I can actually reproduce this with the steps in <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1887229" title="RESOLVED DUPLICATE - Copy option is inactive in Linux version">bug 1887229</a>.</p></div><div id="c65">

  <p>Also here same bug (like from video).</p></div><div id="c71"><p>:sefeng could this be triaged for a priority?</p></div><div id="a16536708_625922"><div><p>Flags: <span>needinfo?(sefeng)</span></p><p>Priority: -- → P2</p></div></div><div id="c72"><div id="ct-72" data-comment-id="16936587" data-ismarkdown="true"><p>(In reply to Donal Meehan [:dmeehan] from <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246#c71" title="ASSIGNED - Copy and Paste context menu entries are sometimes disabled when they should not be">comment #71</a>)</p>
<blockquote>
<p>:sefeng could this be triaged for a priority?</p>
</blockquote>
<p>Yup, it&#39;s P2. And we&#39;ve got a recording of this issue and we&#39;ve been debugging it.</p>
</div></div><div id="c73"><div id="ct-73" data-comment-id="16952314" data-ismarkdown="true"><p>Confirmed with the second steps to reproduce, but not always, try these steps:</p>
<ul>
<li>copy to clipboard <code>https://www.bbc.com/future/article/20240521-these-wildlife-corridors-help-grizzly-bears</code> (do not open this site in other tab)</li>
<li>open <a href="https://www.google.com/" rel="nofollow">https://www.google.com/</a> in a tab</li>
<li>at the same tab (google), click the address bar and press Ctrl+V and Enter</li>
<li>click on Go back button (or Alt+Left Arrow)</li>
<li>click on Go forward button (Alt+Right Arrow)</li>
<li>double click any word to select it, e.g. <code>tunnels</code></li>
<li>right click</li>
</ul>
<p>If the &#34;copy&#34; item is available, repeat these steps 5 - 10 times:</p>
<ul>
<li>press Esc key</li>
<li>Alt+Left Arrow</li>
<li>Alt+Right Arrow</li>
<li>double click any word to select it, e.g. <code>tunnels</code></li>
<li>right click</li>
</ul>
<p><strong>Workaround - toggle reader view, press F9 twice, this fixes it for me, always.</strong></p>
<p>The only issue is, that reader view is not available at all sites.</p>
<p><strong>Another workaround - duplicate tab.</strong></p>
<p>Firefox 126.0 (64-bit) (portable), Windows 10 22H2 64-bit.</p>
<p>Tested also in private browsing window, where all extensions are disabled, I can reproduce it too, but not every time either.</p>
<p>Confirmed also in Firefox Nightly, latest version 128.0a1 (2024-05-24) (64-bit), default settings, no extensions!</p>
</div></div><div id="c75"><div id="ct-75" data-comment-id="16952471" data-ismarkdown="true"><blockquote>
<p>Workaround - toggle reader view, press F9 twice, this fixes it for me, always.</p>
<p>The only issue is, that reader view is not available at all sites.</p>
<p>Another workaround - duplicate tab.</p>
</blockquote>
<p>There&#39;s an easier workaround documented in this ticket.  Focusing the address bar by clicking it works around the issue immediately without needing any new tabs, reader view, or anything like that.</p>
</div></div><div id="c80"><div id="ct-80" data-comment-id="16986989" data-ismarkdown="true"><p>Per <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1863246#c72" title="ASSIGNED - Copy and Paste context menu entries are sometimes disabled when they should not be">comment 72</a>, the team responsible for this bug is working to fix it. More +1 and advocacy comments aren&#39;t helping that happen faster but are adding unnecessary noise to this bug. A reminder that there are etiquette expectations when interacting in Bugzilla - it&#39;s not a free-for-all discussion forum.</p>
<p>I&#39;m restricting comments to keep further discussion focused where it needs to be on fixing this bug and getting it into a shipping release as soon as can be reasonably done.</p>
</div></div><div id="c81"><div id="ct-81" data-comment-id="16991911" data-ismarkdown="true"><p>So the issue here is that when a page goes to BFCache, it&#39;d set the active browsing context to null, and the page that is about to show would update the active browsing context to itself. And these two operations are racy because they are triggered in different processes with different actionId. We are going to explore some potential solutions.</p>
<p>I am first going to try to make the page that goes to BFCache to not updating the active browsing context because we know it&#39;ll be updated by the page that&#39;s about to show. I&#39;ll try this and see what breaks.</p>
<p>If the above doesn&#39;t work, I&#39;ll need to make they use the same actionId, so that the one that sets the active browsing context to non-null will always win. This might requires converting <code>IsInBFCache</code> to be an IPC message rather than synced field, so that the actionId can be passed over from parent to child.</p>
<p>If folks have different ideas, let me know!</p>
</div></div><div id="a19664823_434964"><div><p>Assignee: peterv → sefeng</p></div></div><div id="c82">

  <div id="ct-82" data-comment-id="17012617" data-ismarkdown="true"><p>Currently, when a page enters BFCache, it updates the parent process</p>
<p>This patch fixes the above issue by not updating the parent process</p>
<p>This only applies to BFCacheInParent is enabled.</p>
</div></div>







<dialog id="att-overlay" aria-labelledby="att-overlay-title" data-attachment-count="2">
  
</dialog>

</div></div>
  </body>
</html>
