<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://repost.aws/knowledge-center/eks-api-server-unauthorized-error">Original</a>
    <h1>AWS paywalling select knowledge base articles, requiring Premium Support plan</h1>
    
    <div id="readability-page-1" class="page"><div id="__next"><section id="app_layout"><main><div><div><div data-show="true" role="alert"><div><p>Share Your AWS re:Post Experience - Quick 3 Question Survey</p><p>Help us improve AWS re:Post! We&#39;re interested in understanding how you use re:Post and its impact on your AWS journey. Please take a moment to complete our brief <a href="https://amazonexteu.qualtrics.com/jfe/form/SV_86ti37Lm6wrKzK6" rel="nofollow noopener noreferrer" target="_blank" aria-label="3-question survey amazonexteu.qualtrics">3-question survey</a>.</p></div></div></div><div><nav aria-label="Breadcrumb"><ol><li><span><a data-testid="home-breadcrumb" title="Go to Home" href="https://repost.aws/"><span role="img" aria-label="home"><svg viewBox="64 64 896 896" focusable="false" data-icon="home" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path></svg></span></a></span><span>/</span></li><li><span><span aria-label="How do I resolve the error &#34;You must be logged in to the server (Unauthorized)&#34; when I connect to the Amazon EKS API server?">How do I resolve the error &#34;You must be logged in to the server (Unauthorized)&#34; when I connect to the Amazon EKS API server?<span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></span></span><span>/</span></li></ol></nav></div><div data-test="kcArticle-detail"><div><div data-test="kcArticle-view"><div><div><div><p>I use kubectl commands to connect to the Amazon Elastic Kubernetes Service (Amazon EKS) API server. I received the message &#34;error: You must be logged in to the server (Unauthorized)&#34;.</p><div data-test="kcArticle-body"><h2>Short description</h2>
<p>You get this error when the AWS Identity and Access Management (IAM) entity that&#39;s configured in kubectl isn&#39;t authenticated by Amazon EKS. You are authenticated and authorized to access your Amazon EKS cluster based on the IAM entity (user or role) that you use. This error is usually caused by one of the following configurations:</p>
<ul>
<li>You configured the kubectl tool to use your IAM user or role.</li>
<li>You mapped your IAM entity to the aws-auth ConfigMap.</li>
</ul>
<p>To resolve this issue, complete the steps in one of the following sections based on your use case:</p>
<ul>
<li>You&#39;re the cluster creator</li>
<li>You&#39;re not the cluster creator</li>
<li>Use <a href="https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html#creating-access-entries" rel="nofollow noopener noreferrer" target="_blank" aria-label="access entries docs.aws.amazon">access entries</a></li>
</ul>
<h2>Resolution</h2>
<p><strong>Note:</strong> If you receive errors when you run AWS Command Line Interface (AWS CLI) commands, then see <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-troubleshooting.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="Troubleshoot AWS CLI errors docs.aws.amazon">Troubleshoot AWS CLI errors</a>. Also, make sure that <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="you&#39;re using the most recent AWS CLI version docs.aws.amazon">you&#39;re using the most recent AWS CLI version</a>.</p>
<h3>You&#39;re the cluster creator</h3>
<p>If your IAM entity was used to create the Amazon EKS cluster, then you&#39;re the cluster creator. To resolve the error as the cluster creator, complete the following steps:</p>
<ol>
<li>
<p>In <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/AnalyzingLogData.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="Amazon CloudWatch Log Insights docs.aws.amazon">Amazon CloudWatch Log Insights</a>, select the log group for your Amazon EKS cluster. For example, <strong>/aws/eks/my-cluster/cluster</strong>. Then, run the following query:</p>
<pre><pre node="[object Object]"><code>fields @logstream, @timestamp, @message| sort @timestamp desc
| filter @logStream like /authenticator/
| filter @message like &#34;username=kubernetes-admin&#34;
| limit 50</code></pre></pre>
<p><strong>Note:</strong> <a href="https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html#enabling-control-plane-log-export" rel="nofollow noopener noreferrer" target="_blank" aria-label="Turn on Amazon EKS authenticator logs docs.aws.amazon">Turn on Amazon EKS authenticator logs</a>.<!-- --></p>
<pre><pre node="[object Object]"><code>@messagetime=&#34;2022-05-26T18:55:30Z&#34; level=info msg=&#34;access granted&#34; arn=&#34;arn:aws:iam::123456789000:user/testuser&#34; client=&#34;127.0.0.1:57586&#34; groups=&#34;[system:masters]&#34; method=POST path=/authenticate uid=&#34;aws-iam-authenticator:123456789000:AROAFFXXXXXXXXXX&#34; username=kubernetes-admin</code></pre></pre>
</li>
<li>
<p>Review the cluster creator IAM entity for the AWS CLI. To see if the IAM entity is configured for AWS CLI in your shell environment, run the following command:</p>
<pre><pre node="[object Object]"><code>$ aws sts get-caller-identity</code></pre></pre>
<p>You can also use a specific profile to run this command:</p>
<pre><pre node="[object Object]"><code>$ aws sts get-caller-identity --profile MY-PROFILE</code></pre></pre>
<p>The output returns the Amazon Resource Name (ARN) of the IAM entity that&#39;s configured for AWS CLI.</p>
<pre><pre node="[object Object]"><code>{
    &#34;UserId&#34;: &#34;XXXXXXXXXXXXXXXXXXXXX&#34;,
    &#34;Account&#34;: &#34;XXXXXXXXXXXX&#34;,
    &#34;Arn&#34;: &#34;arn:aws:iam::XXXXXXXXXXXX:user/testuser&#34;
}</code></pre></pre>
<p>Confirm that the IAM entity that&#39;s returned matches the cluster creator IAM entity. If the returned IAM entity isn&#39;t the cluster creator, then <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="update the AWS CLI configuration docs.aws.amazon">update the AWS CLI configuration</a> to use the cluster creator IAM entity.</p>
</li>
<li>
<p>To update or generate the <strong>kubeconfig</strong> file, run the following command:</p>
<pre><pre node="[object Object]"><code>$ aws eks update-kubeconfig --name eks-cluster-name --region aws-region</code></pre></pre>
<p><strong>Note:</strong> Replace <strong>eks-cluster-name</strong> with the name of your cluster. Replace <strong>aws-region</strong> with the name of your AWS Region.<!-- --></p>
<pre><pre node="[object Object]"><code>$ aws eks update-kubeconfig --name eks-cluster-name --region aws-region --profile my-profile</code></pre></pre>
<p><strong>Note:</strong> Replace <strong>eks-cluster-name</strong> with the name of your cluster. Replace <strong>aws-region</strong> with the name of your Region. Replace <strong>my-profile</strong> with the name of your profile.</p>
</li>
<li>
<p>To confirm that the <strong>kubeconfig</strong> file is updated, run the following command:</p>
<pre><pre node="[object Object]"><code>$ kubectl config view --minify</code></pre></pre>
</li>
<li>
<p>To confirm that your IAM entity is authenticated and that you can access your EKS cluster, run the following command:</p>
<pre><pre node="[object Object]"><code>$ kubectl get svc</code></pre></pre>
<p>Example output:</p>
<pre><pre node="[object Object]"><code>NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
kubernetes      ClusterIP   10.100.0.1     &lt;none&gt;        443/TCP   77d</code></pre></pre>
</li>
</ol>
<h3>You&#39;re not the cluster creator</h3>
<p>If your IAM entity wasn&#39;t used to create the cluster, then you&#39;re not the cluster creator. In this case, complete the following steps to map your IAM entity to the aws-auth ConfigMap to allow access to the cluster:</p>
<ol>
<li>
<p>Review the cluster creator IAM entity for the AWS CLI. To see the IAM entity that&#39;s configured for AWS CLI in your shell environment, run the following command:</p>
<pre><pre node="[object Object]"><code>$ aws sts get-caller-identity</code></pre></pre>
<p>You can also use a specific profile to run this command:</p>
<pre><pre node="[object Object]"><code>$ aws sts get-caller-identity --profile my-profile</code></pre></pre>
<p>The output returns the ARN of the IAM entity that&#39;s configured for AWS CLI.<!-- --></p>
<pre><pre node="[object Object]"><code>{
    &#34;UserId&#34;: &#34;XXXXXXXXXXXXXXXXXXXXX&#34;,
    &#34;Account&#34;: &#34;XXXXXXXXXXXX&#34;,
    &#34;Arn&#34;: &#34;arn:aws:iam::XXXXXXXXXXXX:user/testuser&#34;
}</code></pre></pre>
<p>Confirm that the IAM entity that&#39;s returned matches the cluster creator IAM entity. If the returned IAM entity isn&#39;t the cluster creator, then <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="update the AWS CLI configuration docs.aws.amazon">update the AWS CLI configuration</a> to use the cluster creator IAM entity. Then, use kubectl to retry to access your cluster. If you continue to have the issue, then continue to the next step.</p>
</li>
<li>
<p>If the returned IAM entity isn&#39;t the cluster creator, then add your entity to the aws-auth ConfigMap to allow the entity to access the cluster. Because only the cluster admin can modify aws-auth ConfigMap, complete one of the following tasks:<!-- -->
<!-- --></p>
</li>
<li>
<p>To check if your IAM entity is in the aws-auth ConfigMap, run the following command:</p>
<pre><pre node="[object Object]"><code>eksctl get iamidentitymapping --cluster cluster-name</code></pre></pre>
<p>-or-</p>
<pre><pre node="[object Object]"><code>kubectl describe configmap aws-auth -n kube-system</code></pre></pre>
<p>If your IAM entity is in the aws-auth ConfigMap, then continue to the next step. If your IAM entity isn&#39;t in the aws-auth ConfigMap, then run the following command to automatically map your IAM entity:</p>
<pre><pre node="[object Object]"><code>eksctl create iamidentitymapping \
    --cluster $CLUSTER-NAME \
    --region $REGION \
    --arn arn:aws:iam::XXXXXXXXXXXX:user/testuser \
    --group system:masters \
    --no-duplicate-arns \
    --username admin-user1</code></pre></pre>
<p>Or, edit the aws-auth ConfigMap to manually map your IAM entity:</p>
<pre><pre node="[object Object]"><code>$ kubectl edit configmap aws-auth -namespace kube-system</code></pre></pre>
<p>To add an IAM entity to the aws-auth ConfigMap, add the IAM user or role ARN to <strong>mapUsers</strong>.<!-- --></p>
<pre><pre node="[object Object]"><code>mapUsers: |
  - userarn: arn:aws:iam::XXXXXXXXXXXX:user/testuser
    username: testuser
    groups:
      - system:masters</code></pre></pre>
<p>IAM role Example:</p>
<pre><pre node="[object Object]"><code>mapRoles: |
  - rolearn: arn:aws:iam::XXXXXXXXXXXX:role/testrole
    username: testrole
    groups:
      - system:masters</code></pre></pre>
<p><strong>Important:</strong><!-- -->
<!-- -->
<!-- --></p>
</li>
<li>
<p>Run the following command to update or generate the <strong>kubeconfig</strong> file. Make sure that the AWS CLI is configured with your IAM entity.</p>
<pre><pre node="[object Object]"><code>$ aws eks update-kubeconfig --name eks-cluster-name --region aws-region</code></pre></pre>
<p><strong>Note:</strong> Replace <strong>eks-cluster-name</strong> with the name of your cluster. Replace <strong>aws-region</strong> with the name of your Region.<!-- --></p>
<pre><pre node="[object Object]"><code>$ aws eks update-kubeconfig --name eks-cluster-name --region aws-region --profile my-profile</code></pre></pre>
<p><strong>Note:</strong> Replace <strong>eks-cluster-name</strong> with the name of your cluster. Replace <strong>aws-region</strong> with the name of your Region. Replace <strong>my-profile</strong> with the name of your profile.</p>
</li>
<li>
<p>To confirm that the <strong>kubeconfig</strong> file is updated, run the following command:</p>
<pre><pre node="[object Object]"><code>$ kubectl config view --minify</code></pre></pre>
</li>
<li>
<p>To confirm that your IAM user or role is authenticated, access the cluster again. For example, you can run the following command to confirm that the error is resolved:</p>
<pre><pre node="[object Object]"><code>$ kubectl get svc</code></pre></pre>
<p>Example output:</p>
<pre><pre node="[object Object]"><code>NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
kubernetes      ClusterIP   10.100.0.1     &lt;none&gt;        443/TCP   77d</code></pre></pre>
</li>
</ol>
<h3>Use access entries to regain access to the cluster</h3>
<p>Use the <a href="https://docs.aws.amazon.com/eks/latest/APIReference/API_CreateAccessEntry.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="CreateAccessEntry docs.aws.amazon">CreateAccessEntry</a> API to provide or restore access to your Amazon EKS cluster. For more information, see <a href="https://repost.aws/knowledge-center/eks-api-recover-cluster-access" rel="nofollow noopener noreferrer" target="_blank" aria-label="How can I use the Amazon EKS access entry API to recover access to an EKS cluster? repost">How can I use the Amazon EKS access entry API to recover access to an EKS cluster?</a></p>
<h3>Troubleshooting</h3>
<p>When you run a kubectl command, a request is sent to the Amazon EKS cluster API server. Then, the Amazon EKS authenticator tries to authenticate this request. If the Amazon EKS authenticator can&#39;t authenticate the request, then check the EKS authenticator logs in CloudWatch. Use the following troubleshooting tips to identify the issue.</p>
<p><strong>Access your EKS authenticator logs</strong></p>
<ol>
<li><a href="https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="Turn on logging for your Amazon EKS cluster docs.aws.amazon">Turn on logging for your Amazon EKS cluster</a>.</li>
<li><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_AnalyzeLogData_RunSampleQuery.html#CWL_AnalyzeLogData_RunQuerySample" rel="nofollow noopener noreferrer" target="_blank" aria-label="Open CloudWatch Log Insights docs.aws.amazon">Open CloudWatch Log Insights</a>.</li>
<li>Select the log group for your cluster. Example: &#34;/aws/eks/example-cluster/cluster&#34;.</li>
<li>Run the following query:<!-- -->
<pre><pre node="[object Object]"><code>fields @timestamp, @message| filter @logStream like /authenticator/
| sort @timestamp desc
| limit 1000</code></pre></pre>
<!-- -->To identify log lines for the same time interval when you got the error, run kubectl commands.</li>
</ol>
<p><strong>Review your EKS authenticator logs</strong></p>
<p>Based on the cause of the error, complete the following tasks:</p>
<ul>
<li>
<p>If the issue is from the use of an incorrect IAM entity for kubectl, then review the kubectl kubeconfig and AWS CLI configuration. Make sure that you use the correct IAM entity. In the following output example, the IAM entity that kubectl used can&#39;t be validated. Review the IAM entity that kubectl uses and make sure that the entity exists in IAM and the entity&#39;s programmatic access is turned on.</p>
<pre><pre node="[object Object]"><code>time=&#34;2022-12-26T20:46:48Z&#34; level=warning msg=&#34;access denied&#34; client=&#34;127.0.0.1:43440&#34; error=&#34;sts getCallerIdentity failed: error from AWS (expected 200, got 403). Body: {\&#34;Error\&#34;:{\&#34;Code\&#34;:\&#34;InvalidClientTokenId\&#34;,\&#34;Message\&#34;:\&#34;The security token included in the request is invalid.\&#34;,\&#34;Type\&#34;:\&#34;Sender\&#34;},\&#34;RequestId\&#34;:\&#34;a9068247-f1ab-47ef-b1b1-cda46a27be0e\&#34;}&#34; method=POST path=/authenticate</code></pre></pre>
</li>
<li>
<p>If the issue because your IAM entity isn&#39;t mapped or is incorrectly mapped in aws-auth ConfigMap, then review the aws-auth ConfigMap. Make sure that the IAM entity is correctly mapped and meets the requirements that are listed in the <strong>You&#39;re not cluster creator</strong> section. For incorrectly mapped or missing IAM entities, the EKS authenticator logs look similar to the following output example:</p>
<pre><pre node="[object Object]"><code>time=&#34;2022-12-28T15:37:19Z&#34; level=warning msg=&#34;access denied&#34; arn=&#34;arn:aws:iam::XXXXXXXXXX:role/admin-test-role&#34; client=&#34;127.0.0.1:33384&#34; error=&#34;ARN is not mapped&#34; method=POST path=/authenticate</code></pre></pre>
</li>
<li>
<p>If the aws-auth ConfigMap was updated and you lost access to the cluster, then use the cluster creator IAM entity to access the cluster. Because the cluster creator doesn&#39;t need to be mapped in the aws-auth ConfigMap, use this IAM entity to access the cluster.</p>
</li>
<li>
<p>If the cluster creator IAM entity was deleted, then recreate the same IAM entity with the same naming convention. Then, this recreated cluster creator IAM entity can have the same ARN as the IAM entity. Then, complete the steps in the <strong>You&#39;re the cluster creator</strong> section to use the IAM entity to access the cluster.</p>
</li>
<li>
<p>If the cluster creator is an IAM role that was created for an SSO user that was removed, then you can&#39;t recreate this IAM role. In this case, reach out to AWS Support for assistance.</p>
</li>
</ul>
<h2>Related information</h2>
<p><a href="https://repost.aws/knowledge-center/amazon-eks-cluster-access" rel="nofollow noopener noreferrer" target="_blank" aria-label="How do I provide access to other IAM users and roles after cluster creation in Amazon EKS? repost">How do I provide access to other IAM users and roles after cluster creation in Amazon EKS?</a></p>
<p><a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" rel="nofollow noopener noreferrer" target="_blank" aria-label="Using RBAC authorization kubernetes">Using RBAC authorization</a> on the Kubernetes website</p>
<p><a href="https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="Grant IAM users access to Kubernetes with EKS access entries docs.aws.amazon">Grant IAM users access to Kubernetes with EKS access entries</a></p>
<p><a href="https://eksctl.io/usage/access-entries/" rel="nofollow noopener noreferrer" target="_blank" aria-label="EKS Access Entries eksctl">EKS Access Entries</a> on the eksctl website</p></div></div></div></div></div></div><div><div><div><div><p><span><img src="https://repost.aws/static/images/aws.png" alt="AWS OFFICIAL"/></span></p><p><span>AWS OFFICIAL</span><span data-test="last-updated">Updated<!-- --> <!-- -->5 months ago</span></p></div></div></div></div></div></div><div><div><div><p><span data-test="article-replies">10 Comments</span></p><div><div tabindex="-1" id="COGI2eHbflRgSAbJioptqn-g"><div data-test="reply-view"><p>I had this problem and, eventually, I figured out it had to do with the CLI.  I thought it was a bug but it seems that it&#39;s expected behavior.  (I built the EKS cluster using Terraform.)</p>
<p>Some text on this page helped me figure it out:<a href=""> https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html</a></p>
<blockquote>
<p>You can specify an IAM role ARN with the --role-arn option to use for authentication when you issue kubectl commands. Otherwise, the IAM principal in your default AWS CLI or SDK credential chain is used. You can view your default AWS CLI or SDK identity by running the aws sts get-caller-identity command.</p>
</blockquote>
<p>Specifically, it&#39;s this sentence: <em>Otherwise, the IAM principal in your default AWS CLI or SDK credential chain is used.</em></p>
<p>I have several profiles configured for the AWS CLI.  The only profile used is the <strong>default</strong> one.  The others are ignored.</p>
<p>My fix was to create and export two environmental variables with the corresponding information:</p>
<pre><code node="[object Object]">aws_access_key_id
</code></pre>
<p>and</p>
<pre><code node="[object Object]">aws_secret_access_key
</code></pre>
<p>After I did this, things worked as expected.</p></div></div><div tabindex="-1" id="COG8LxCLa-S-WqwwmFu1Bsvw"><p>Thank you for your comment. We&#39;ll review and update the Knowledge Center article as needed.</p><div><div><div data-test="avatar-wrapper-class"><p><span><span aria-label=""><img alt="profile picture" loading="lazy" width="36" height="36" decoding="async" data-nimg="1" src="https://repost.aws/media/profilePicture/thumbnails/small/IMIbLGE7q9TBG0T2PaOb6yJA"/></span><span><img alt="AWS" loading="lazy" width="14" height="8" decoding="async" data-nimg="1" src="https://repost.aws/static/icons/common/aws_logo_rgb_white.svg"/></span></span></p><div><p><span><span>EXPERT</span></span></p><p><span>replied<!-- --> <!-- -->2 years ago</span><span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></p></div></div></div></div></div><div tabindex="-1" id="COMvltD_w_SBm29kcGjjZvfw"><p>If you created a cluster, and you are using the same IAM user, and  you still get errors like &#34;error: You must be logged in to the server (the server has asked for the client to provide credentials)&#34;, &#34;Identity is not mapped&#34;, &#34;Your current IAM principal doesn&#39;t have access to Kubernetes objects on this cluster. This might be due to the current principal not having an IAM access entry with permissions to access the cluster.&#34; from CLI (kubectl), CloudWatch, and Console respectively, then you have to go to the cluster from the AWS console, access tab, create access entry, select the ARN of your principal (you can see it from CLI with command aws sts get-caller-identity), add access policy, select AmazonEKSAdminPolicy, create and go back to the access tab, click on the access entry you added for your user ARN, add access policy, select AmazonEKSClusterAdminPolicy and try running the kubectl commands again.</p></div><div tabindex="-1" id="COIBu1ScfgS3GVhWHRtQHS-g"><p>Thank you for your comment. We&#39;ll review and update the Knowledge Center article as needed.</p><div><div><div data-test="avatar-wrapper-class"><p><span><span aria-label=""><img alt="profile picture" loading="lazy" width="36" height="36" decoding="async" data-nimg="1" src="https://repost.aws/media/profilePicture/thumbnails/small/IMIbLGE7q9TBG0T2PaOb6yJA"/></span><span><img alt="AWS" loading="lazy" width="14" height="8" decoding="async" data-nimg="1" src="https://repost.aws/static/icons/common/aws_logo_rgb_white.svg"/></span></span></p><div><p><span><span>EXPERT</span></span></p><p><span>replied<!-- --> <!-- -->a year ago</span><span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></p></div></div></div></div></div><div tabindex="-1" id="CO9pjJOYJuS5aneq4lQ8-r8Q"><div data-test="reply-view"><p>is the identity mapping configuration supporting wildcards on <em><strong>aws-auth</strong></em>? like:</p>
<pre><code node="[object Object]">mapRoles: |
  - rolearn: arn:aws:iam::XXXXXXXXXXXX:role/testrole-*
    username: testrole
    groups:
      - system:masters
</code></pre></div></div><div tabindex="-1" id="CO9aYilIDzRw2lb_eW3-uljg"><p>Thank you for your comment. We&#39;ll review and update the Knowledge Center article as needed.</p><div><div><div data-test="avatar-wrapper-class"><p><span><span aria-label=""><img alt="profile picture" loading="lazy" width="36" height="36" decoding="async" data-nimg="1" src="https://repost.aws/media/profilePicture/thumbnails/small/IMIbLGE7q9TBG0T2PaOb6yJA"/></span><span><img alt="AWS" loading="lazy" width="14" height="8" decoding="async" data-nimg="1" src="https://repost.aws/static/icons/common/aws_logo_rgb_white.svg"/></span></span></p><div><p><span><span>EXPERT</span></span></p><p><span>replied<!-- --> <!-- -->a year ago</span><span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></p></div></div></div></div></div><div tabindex="-1" id="CO6VITbu50T2-BaCJuMEh6KA"><div data-test="reply-view"><p>When running this command:</p>
<pre><code node="[object Object]">kubectl edit configmap aws-auth --namespace kube-system
</code></pre>
<p>You receive this error now:
Error from server (NotFound): configmaps &#34;aws-auth&#34; not found</p>
<p>A quick search brings up <a href="https://docs.aws.amazon.com/eks/latest/userguide/auth-configmap.html" rel="nofollow noopener noreferrer" target="_blank" aria-label="this AWS documentation link docs.aws.amazon">this AWS documentation link</a> stating that &#34;The aws-auth ConfigMap is deprecated. The reccomended method to manage access to Kubernetes APIs is Access Entries.&#34;</p>
<p>So unfortunately, it seems like most of this article is now out-of-date.</p></div><div><div><div data-test="avatar-wrapper-class"><div><p><span>replied<!-- --> <!-- -->9 months ago</span><span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></p></div></div></div></div></div><div tabindex="-1" id="COUYtpcnKdTImVPdwa3HzShg"><p>Thank you for your comment. We&#39;ll review and update the Knowledge Center article as needed.</p><div><div><div data-test="avatar-wrapper-class"><p><span><span aria-label=""><img alt="profile picture" loading="lazy" width="36" height="36" decoding="async" data-nimg="1" src="https://repost.aws/media/AWS_official.png"/></span><span><img alt="AWS" loading="lazy" width="14" height="8" decoding="async" data-nimg="1" src="https://repost.aws/static/icons/common/aws_logo_rgb_squid.svg"/></span></span></p><div><p><span><span>MODERATOR</span></span></p><p><span>replied<!-- --> <!-- -->9 months ago</span><span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></p></div></div></div></div></div><div tabindex="-1" id="COCR6Eu25kRz-YLKWl0bDYvw"><div data-test="reply-view"><p>I have created eks and continuously trying to connect from windows cli, but always throwing error. I am able to check aws resources from cli also able to see cluster and nodegroup with command like
eksctl get iamidentitymapping --cluster myeks_cluster1</p>
<p>but getting issue with kubectl
E0928 20:24:40.071813    7228 memcache.go:265] &#34;Unhandled Error&#34; err=&#34;couldn&#39;t get current server API group list: the server has asked for the client to provide credentials&#34;</p>
<p>C:\Windows\System32&gt;eksctl get iamidentitymapping --cluster myeks_cluster1
Error: getting auth ConfigMap: Unauthorized</p>
<p>C:\Windows\System32&gt;kubectl version
Client Version: v1.31.0-eks-a737599
Kustomize Version: v5.4.2
error: You must be logged in to the server (the server has asked for the client to provide credentials)</p>
<p>C:\Windows\System32&gt;kubectl get pods -v=10</p>
<p>&#34;metadata&#34;: {},
&#34;status&#34;: &#34;Failure&#34;,
&#34;message&#34;: &#34;the server has asked for the client to provide credentials&#34;,
&#34;reason&#34;: &#34;Unauthorized&#34;,
&#34;details&#34;: {
&#34;causes&#34;: [
{
&#34;reason&#34;: &#34;UnexpectedServerResponse&#34;,
&#34;message&#34;: &#34;unknown&#34;
}
]
},
&#34;code&#34;: 401
}]
error: You must be logged in to the server (the server has asked for the client to provide credentials)</p>
<p>pls help!</p></div><div><div><div data-test="avatar-wrapper-class"><div><p><span>replied<!-- --> <!-- -->5 months ago</span><span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></p></div></div></div></div></div></div></div><div><div data-test="relevant-content"><h2>Relevant content</h2><div><div><div><ul><li></li><li></li><li></li><li></li><li></li><li><div><div><p><span><img src="https://repost.aws/static/images/aws.png" alt="AWS OFFICIAL"/></span></p><p><span>AWS OFFICIAL</span><span data-test="last-updated">Updated<!-- --> <!-- -->a year ago</span></p></div></div></li><li><div><div><p><span><img src="https://repost.aws/static/images/aws.png" alt="AWS OFFICIAL"/></span></p><p><span>AWS OFFICIAL</span><span data-test="last-updated">Updated<!-- --> <!-- -->10 months ago</span></p></div></div></li><li><div><div><p><span><img src="https://repost.aws/static/images/aws.png" alt="AWS OFFICIAL"/></span></p><p><span>AWS OFFICIAL</span><span data-test="last-updated">Updated<!-- --> <!-- -->3 years ago</span></p></div></div></li><li><div><div><p><span><img src="https://repost.aws/static/images/aws.png" alt="AWS OFFICIAL"/></span></p><p><span>AWS OFFICIAL</span><span data-test="last-updated">Updated<!-- --> <!-- -->2 years ago</span></p></div></div></li><li><div><div data-test="avatar-wrapper-class"><p><span><span aria-label=""><img alt="profile picture" loading="lazy" width="36" height="36" decoding="async" data-nimg="1" src="https://repost.aws/media/profilePicture/thumbnails/small/IMSTR5YekJTbyoYd7dliep6A"/></span><span><img alt="AWS" loading="lazy" width="14" height="8" decoding="async" data-nimg="1" src="https://repost.aws/static/icons/common/aws_logo_rgb_white.svg"/></span></span></p><div><p><span><span>EXPERT</span></span></p><p><span>published<!-- --> <!-- -->a year ago</span><span aria-hidden="true">lg</span><span aria-hidden="true"><span aria-hidden="true">...</span></span></p></div></div></div></li></ul></div></div></div></div></div></div></div></main></section></div></div>
  </body>
</html>
