<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.jacobvosmaer.nl/0009-development-feb-2022/">Original</a>
    <h1>9. Development setup, February 2022</h1>
    
    <div id="readability-page-1" class="page"><div><p><i><a href="https://blog.jacobvosmaer.nl/">Jacob Vosmaer&#39;s blog</a></i></p>

<p>2022-02-??</p>

<p>It&#39;s been a while since I wrote about using <a href="https://blog.jacobvosmaer.nl/0007-xhyve/">xhyve for virtual
machines</a>. Or about <a href="https://blog.jacobvosmaer.nl/0006-acme/">using</a>
<a href="https://blog.jacobvosmaer.nl/0008-booting-acme/">Acme</a>. But I&#39;m still at it, with two
changes.</p>

<p>The first change is the fact that I turned Acme into a remote editor, so I
can work on a local Linux VM while staying in the host macOS GUI. I do
this by turning plan9port&#39;s <code>devdraw</code> into a kind of X display server.
Acme itself runs on the VM, but whenever it tries to talk to
<code>devdraw</code>, its commands go across an SSH forwarded connection back to
<code>devdraw</code> running on the host OS. There is some inevitable friction, but
for the most part I&#39;m able to separate my activities into things that
happen on the host (web browsing, Slack, etc.) and on the VM (editing
source code, compiling, running tests etc.). It helps a lot that Acme
is a combined text editor and shell.</p>

<p>The big benefit of working like this is that I get a lot of the
upsides of working on Linux, without the downsides of having to keep
Linux-on-the-desktop working smoothly. Some of the benefits are that I
can use <code>perf record</code> the same way I use it on real servers (<code>perf</code> is
for Linux only), and that compilation and test suites that spawn many
processes run much faster (macOS makes spawning processes slow).</p>

<p>The second change is that I replaced Xhyve with a <a href="https://gitlab.com/jacobvosmaer/jvvm">homegrown
replacement</a> based on Virtualization.framework.
<a href="https://github.com/machyve/xhyve">Xhyve</a>, which extends
<a href="https://developer.apple.com/documentation/hypervisor?language=objc">Hypervisor.framework</a>
into something actually useful, does not work on the new M1 ARM Apple
computers. Luckily, most of the functionality of Xhyve is now provided
by macOS itself, via <a href="https://developer.apple.com/documentation/virtualization?language=objc">Virtualization.framework</a>. By writing a small
&#34;glue&#34; application that calls into the framework I was able to replace
Xhyve in my virtual machine management tooling. The glue application I
wrote is based on <a href="https://github.com/evansm7/vftool">vftool</a>.</p>

<p>Apart from the obvious improvement that now I have a VM system that
works at all on M1 hardware, it is also nice that it is now possible
to boot the VM without <code>sudo</code>.</p>
<p>Tags:
<a href="https://blog.jacobvosmaer.nl/acme.html">acme</a>
</p><details><summary>Edit history</summary><table>
<tbody><tr><td>2023-12-08</td><td></td><td>Remove embedded dates in favor of meta.json</td></tr>
<tr><td>2023-12-08</td><td></td><td>Add dates to header</td></tr>
<tr><td>2023-12-07</td><td></td><td>Add atom.xml</td></tr>
<tr><td>2023-11-28</td><td></td><td>Add some dates</td></tr>
<tr><td>2023-11-28</td><td></td><td>Add tag system</td></tr>
<tr><td>2023-11-28</td><td></td><td>0009: add link to jvvm</td></tr>
<tr><td>2023-11-28</td><td></td><td>Add 0009</td></tr>
</tbody></table></details><p><a href="https://blog.jacobvosmaer.nl/">Back</a></p>
</div></div>
  </body>
</html>
