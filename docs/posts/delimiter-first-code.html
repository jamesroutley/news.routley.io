<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arogozhnikov.github.io/2022/11/29/delimiter-comes-first.html">Original</a>
    <h1>Delimiter-first code</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        <div>

  

  <article>
    

<h2 id="summary">Summary</h2>

<p>I argue for wider usage of delimiter-first in the code</p>
<ul>
  <li><code>three friends [tic, tac, toe]</code> becomes <code>three friends ・tic ・tac ・toe</code>.</li>
</ul>

<p>A new top-level syntax for programming languages is proposed to show advantages of this method.
New syntax is arguably as simple, but more consistent, better preserves visual structure and solves some issues in code formatting.</p>



<p>A well-known proposal is to write commas first in languages like javascript, JSON or SQL, which don’t have trailing commas (JS has these days, but not the other two):</p>

<div>
  <div><div><pre><code>    <span>-- trailing commas              </span>
    <span>SELECT</span> <span>employee_name</span><span>,</span>
      <span>company_name</span><span>,</span>
      <span>salary</span><span>,</span>
      <span>state_code</span><span>,</span>
      <span>city</span>
    <span>FROM</span> <span>`employees`</span>
</code></pre></div>  </div>
  <div><div><pre><code>    <span>-- leading commas               </span>
    <span>SELECT</span> <span>employee_name</span>
         <span>,</span> <span>company_name</span>
         <span>,</span> <span>salary</span>
         <span>,</span> <span>state_code</span>
         <span>,</span> <span>city</span>
    <span>FROM</span> <span>`employees`</span>
</code></pre></div>  </div>
</div>

<p>While it is <strong>not what I am discussing here</strong>, there is a large overlap.
This style wasn’t widely adopted, and it is interesting why.</p>

<p>All criticism essentially comes down to: 
1) tools can solve common issues solved by this notation
2) it is not natural / you don’t write text like this.</p>

<p>Argument 1) is irrelevant since tools can handle any notation, even completely non-readable for human. 
Argument 2) is weak, however similarity to known things drastically simplifies adoption.</p>

<p>Over time, however, code culture diverged in multiple ways from ‘usual writing’: 
we enumerate from zero, write identifiers with underscores, don’t follow usual rules for quotes, and indent code instead of writing in paragraphs.
When some tools have shown that the alternative way works, further adoption happens more easily.</p>

<p>More importantly, argument 2) is really broken:</p>

<div>
  <div><div><pre><code>    ・this version          
    ・is far more 
    ・natural
</code></pre></div>  </div>
  <div><div><pre><code>    than this version・          
    with a delimiter・
    after
</code></pre></div>  </div>
</div>

<p>so when it came to enumerating in a visually distinctive way, 
‘usual writing’ uses delimiter-first.</p>

<p>I want to point the source of this controversy with one more example:</p>

<pre>You need eggs, cheese, bread.               <span># ok</span>  
You need ,eggs ,cheese ,bread.              <span># sucks</span>
You need a) eggs b) cheese c) bread.        <span># ok</span>
You need 1. eggs 2. cheese 3. bread.        <span># ok</span>
You need ・eggs ・cheese ・bread.            <span># ok</span>   
</pre>

<p>So complains are not because delimiter-first looks wrong - in fact, it is common.
It is about commas being used as <em>leading</em> elements, not trailing - a lesson to remember.</p>

<p>Both argument 1) and 2) pinpoint reasons <em>why things the way they are</em>: habit and tools.
But different code examples (<a href="https://hoffa.medium.com/winning-arguments-with-data-leading-with-commas-in-sql-672b3b81eac9">SQL examples</a> by Felipe Hopfa and <a href="https://gist.github.com/isaacs/357981">JS examples</a> by Isaac Z. Schlueter) show benefits of delimiter-first.</p>

<p>I expected to find in discussions some code examples where delimiter-last is better, but I didn’t.</p>

<p><em>Later addition:</em> haskell community <a href="https://github.com/tibbe/haskell-style-guide/blob/master/haskell-style.md">adopted</a> leading commas in many projects, because trailing commas were not supported at first.
Later haskell got support for trailing, but now majority <a href="https://www.reddit.com/r/haskell/comments/hr5c2n/comment/fy25hpm/?utm_source=share&amp;utm_medium=web2x&amp;context=3">votes</a> for advantages of leading commas.</p>

<h2 id="is-delimiter-a-right-word">Is ‘delimiter’ a right word?</h2>

<p>Delimiter (just as separator) separates items. Though there is <a href="https://stackoverflow.com/questions/9118769/when-to-use-the-terms-delimiter-terminator-and-separator">no consensus</a> about it.</p>

<p>E.g. in <code>[ 1, 2, 3 ]</code> we have a sequence of tokens:</p>
<div><div><pre><code>start  item delimiter  item  delimiter   item   end
  [     1       ,        2        ,       3      ]
</code></pre></div></div>

<p>So what I’m arguing for is having a start-of-item token. 
Like this: <code>・1 ・2 ・3</code>.
Do we need to point an end of last token? As we’ll see next, that’s usually not the case.</p>

<p>We have a special word for end-of-item token: terminator, but no startinator or any similar word.
I see some irony in this.<sup>*</sup></p>

<p>Meanwhile, I keep using the word ‘delimiter’ (albeit it’s maybe incorrect)</p>

<h2 id="collections-in-html">Collections in HTML</h2>

<p>Different markup languages give some food for thought, as they commonly deal with collections.</p>

<p>E.g. html allows using start-of-item (<code>&lt;li&gt;</code>) and skipping end-of-item (<code>&lt;/li&gt;</code>)</p>
<div><div><pre><code><span>&lt;ul&gt;</span>
    <span>&lt;li&gt;</span> first item
    <span>&lt;li&gt;</span> second item
<span>&lt;/ul&gt;</span>
</code></pre></div></div>

<h2 id="collections-in-yaml">Collections in YAML</h2>

<p>Yaml, which focuses on a hierarchy of collections, also uses a delimiter-first approach.</p>

<div><div><pre><code><span>-</span> <span>point </span><span>1</span>
  <span>-</span> <span>point </span><span>1.1</span>
  <span>-</span> <span>point </span><span>1.2</span>
    <span>-</span> <span>point 1.2.1</span>
    <span>-</span> <span>point 1.2.2</span>
  <span>-</span> <span>point </span><span>1.3</span>
<span>-</span> <span>point 2</span> 
</code></pre></div></div>

<p>Let me reinterpret this example. <strong>This reinterpretation is important in further discussion</strong>.</p>

<p>There are 3 delimiters: <code>\n-</code>, <code>\n__-</code> and <code>\n____-</code> (underscore = whitespace).
All three delimiters are distinct, and the whole structure now reads as</p>

<pre><span>1</span>point 1
<span>2</span>point 1.1
<span>2</span>point 1.2
<span>3</span>point 1.2.1
<span>3</span>point 1.2.2
<span>2</span>point 1.3
<span>1</span>point 2 
</pre>

<p>No end token needed in yaml: the last item ends when a collection ends, i.e. at a delimiter of higher level.
There is no need to know or parse anything about an internal structure between two <lvl1> tokens.</lvl1></p>

<p>Correspondingly, the only expectation we have from contents enclosed between <code>&lt;lvl2&gt;</code> is 
that there are no tokens <code>&lt;lvl1&gt;</code> or <code>&lt;lvl2&gt;</code> and that’s it.</p>

<p>Intermediate conclusion: delimiter-first is very common, 
and in markup languages it is even standard (but not in programing languages!)</p>

<h2 id="line-should-start-from-n-not-end-with-it">Line should start from <code>\n</code>, not end with it</h2>

<p>This sounds mad (after many years of programming it just should), but see for yourself:</p>

<div><div><pre><code>Let&#39;s assume I&#39;ve had some very long text ending here.

Chapter 2.
Let&#39;s learn about belonging of indentation elements to logical elements.
</code></pre></div></div>

<p>Pay attention to the blank line between last line of previous chapter and a header of new line.
Undoubtedly, blank line is a part of ‘Chapter 2’ logical element, 
because empty line focuses our attention on ‘Chapter 2’ label. 
It is not because we need to end the paragraph.</p>

<p>For the same reason, in html additional margins ‘belong’ to headers, not preceding elements.</p>

<p>Same for lines: <em>we highlight a beginning of a new line</em>, not an end of previous one.
Ironically, that’s in the name: it is newline, not endline.</p>

<p>When we turn to code, the same thought is seen with this small snippet, 
where I compare normal <code>print</code> with a hypothetical <code>print</code> that outputs newline before the output:</p>

<div>
  <div>
    <div><div><pre><code><span>print</span><span>(</span><span>&#39;step1. downloading&#39;</span><span>,</span> <span>end</span><span>=</span><span>&#39;&#39;</span><span>)</span>
<span>for</span> <span>chunk</span> <span>in</span> <span>download</span><span>(...):</span>
    <span>print</span><span>(</span><span>end</span><span>=</span><span>&#39;.&#39;</span><span>)</span>
<span>print</span><span>()</span> <span># to keep steps on separate lines
</span>
<span>print</span><span>(</span><span>&#39;step2. processing&#39;</span><span>,</span> <span>end</span><span>=</span><span>&#39;&#39;</span><span>)</span>
<span>for</span> <span>chunk</span> <span>in</span> <span>process</span><span>(...):</span>
    <span>print</span><span>(</span><span>end</span><span>=</span><span>&#39;.&#39;</span><span>)</span>
<span>print</span><span>()</span> <span># to keep steps on separate lines
</span></code></pre></div>    </div>
    <center>
Code with \n auto-printed after the arguments
</center>
  </div>
  <div>
    <div><div><pre><code><span>print</span><span>(</span><span>&#39;step1. downloading&#39;</span><span>)</span>              
<span>for</span> <span>chunk</span> <span>in</span> <span>download</span><span>(...):</span>
    <span>print</span><span>(</span><span>start</span><span>=</span><span>&#39;.&#39;</span><span>)</span>

<span>print</span><span>(</span><span>&#39;step2. processing&#39;</span><span>)</span>
<span>for</span> <span>chunk</span> <span>in</span> <span>process</span><span>(...):</span>
    <span>print</span><span>(</span><span>start</span><span>=</span><span>&#39;.&#39;</span><span>)</span>
    
    
</code></pre></div>    </div>
    <center>
Code with \n auto-printed before the arguments
</center>
  </div>
</div>

<p>result:</p>
<div><div><pre><code>step1. downloading.........
step2. processing.........
</code></pre></div></div>

<p>Version of code with leading <code>\n</code> is more straightforward.</p>

<p>If things were the opposite way:</p>
<div><div><pre><code>.......step1. downloaded
.......step2. processed
</code></pre></div></div>
<p>then <code>\n</code> in the end would be more optimal, but this order is not natural.
Normally we first describe the collection, then enumerate items, not vice versa.</p>

<h2 id="unixs-newline-in-the-end-of-line">Unix’s newline in the end of line</h2>

<p>Unix does not use <code>\n</code> as a delimiter of lines.
Instead, it is more of line-terminator, because file with text <em>should</em> end with <code>\n</code>.
Not doing so would break simplicity of unix tools and simplicity of definitions, see <a href="https://stackoverflow.com/questions/729692/why-should-text-files-end-with-a-newline">this SO thread</a>.</p>

<p>For layman, why newline is required in unix:</p>
<div><div><pre><code><span>$ </span><span>echo</span> <span>-n</span> <span>&#39;good file with newline in the end\n&#39;</span> <span>&amp;&amp;</span> <span>echo</span> <span>-n</span> <span>&#39;another good file with newline in the end\n&#39;</span>
good file with newline <span>in </span>the end
another good file with newline <span>in </span>the end
</code></pre></div></div>

<p>Missed newline in the first file:</p>
<div><div><pre><code><span>$ </span><span>echo</span> <span>-n</span> <span>&#39;bad file without newline in the end&#39;</span> <span>&amp;&amp;</span> <span>echo</span> <span>-n</span> <span>&#39;another good file with newline in the end\n&#39;</span>
bad file without  newline <span>in </span>the endanother good file with newline <span>in </span>the end
</code></pre></div></div>
<p>problem is in the first file, but it is the second one to get printed the wrong way.
No such misattrbution issue with newline-first.</p>

<p>If it is ok to end each file with <code>\n</code>, then it is ok to start it with <code>\n</code>.</p>

<p>Having lines start with <code>\n</code> maintains the simplicity of unix utilities, but is a bit simpler to visualize in editor.</p>

<p>Imagine that in parallel universe text and binary files are different in the very first character. What a science finction we could live in!</p>

<p><strong>Do I really want to change all files to newline-first?</strong> 
Of course not.
But I have to point that if in the course of history files were newline-first from the start, that would be a better system.</p>

<p>I hypothesize, that newline-last comes from unix mainframes:
when line in shell is entered, it can be passed to a mainframe for processing.
I can’t confirm this, but it sounds plausible. 
If so, time has shown that to be a wrong choice: 
all the messengers these days make distinction between new line (enter) and sending messages (shift+enter).
Jupyter knows that, IDEs know that, messengers know that. Terminals still don’t know that.</p>

<h2 id="using-indentation-to-structure-code">Using indentation to structure code</h2>

<p>Code indentation is available in all major languages, 
but python (and scala, F#, haskell, …) relies on indentation to define logical structure.</p>

<p>And that works very well. Let’s see how we can re-interpret the python code the way we did with yaml</p>

<div><div><pre><code><span>class</span> <span>MyClass</span><span>:</span>
    <span>def</span> <span>__init__</span><span>(</span><span>self</span><span>):</span>
        <span>pass</span>
    
    <span>def</span> <span>some_method</span><span>(</span><span>self</span><span>):</span>
        <span>pass</span>
</code></pre></div></div>

<p>now we reinterpret the structure with <code>&lt;lvl1&gt;=\n</code>,  <code>&lt;lvl2&gt;=\n____</code>,  <code>&lt;lvl3&gt;=\n________</code>.</p>

<pre><span>1</span>class MyClass
<span>2</span>def __init__(self)
<span>3</span>pass
<span>2</span>
<span>2</span>def some_method(self):
<span>3</span>pass
</pre>

<p>so, we see very basic organization of code is available just by looking at sequence of start tokens (which just mirrors indentation).</p>

<h2 id="some-problems-with-multiline-strings">Some problems with multiline strings</h2>

<p>There are places where python allows code to ‘escape’ indentation:
continuation of previous line (explicit with \ or implicit with different brackets)
and multiline strings.</p>

<p>Continuations are ‘solvable’ with code formatting tools, but not multiline literals:</p>

<div><div><pre><code><span>if</span> <span>True</span><span>:</span>
    <span>print</span><span>(</span><span>&#34;&#34;&#34;
    This is python&#39;s
    multiline string
    &#34;&#34;&#34;</span><span>)</span>
</code></pre></div></div>

<p>Output (###### just shows where the line ends):</p>

<pre><cmnt>######</cmnt>
    This is python&#39;s<cmnt>######</cmnt>
    multiline string<cmnt>######</cmnt>
    <cmnt>######</cmnt>    
</pre>

<p>To get proper output we need to break visual alignment:</p>
<div><div><pre><code><span>if</span> <span>True</span><span>:</span>
    <span>print</span><span>(</span><span>&#34;&#34;&#34;This is python&#39;s
multiline string
&#34;&#34;&#34;</span><span>)</span>
    <span># takes effort to realize that the same block of code continues here
</span>    <span>return</span> <span>False</span>
</code></pre></div></div>

<p>There are problems with multiline: first line, last line and indentation.
Multilines in javascript/go face all the same issues, so it is a generic problem.</p>

<p>I think there is a way to solve this issue too, and it will be discussed.</p>

<h2 id="delimiter-first-pseudo-python">Delimiter-first pseudo-python</h2>

<p>To better demostrate how all these ideas come together, I’ll imagine a new language (pseudo-python).
To focus only on syntax changes, I’ll keep all other aspects of the language the same.</p>

<p>I will consider an artificially complicated example. It includes different arguments, list, empty list, string, multiline string, method chaining, multiline logical arithmetics, few or no arguments</p>

<p>Goal is to demonstrate that any wild mix is representable and does not produce mess.</p>

<div>
  <div><div><pre><code><span>prepare_message</span><span>(</span>
    <span>title</span><span>=</span><span>&#34;Hey {}, ready for Christmas?&#34;</span><span>.</span><span>format</span><span>(</span><span>user_name</span><span>),</span>
    <span>email</span><span>=</span><span>email</span><span>,</span>
    <span>body</span><span>=</span><span>f</span><span>&#34;&#34;&#34;Reminder: please clean your chimneys!

Oh, and prepare &#34;Santa Landing Spot&#34; on your roof

Thank you </span><span>{</span><span>user_name</span><span>}</span><span> for cooperation,</span><span>\n</span><span>Santa Corp.
&#34;&#34;&#34;</span><span>,</span>
    <span>additional_sections</span><span>=</span><span>[</span>
        <span>get_current_promotions</span><span>(</span><span>n_promotions</span><span>=</span><span>4</span><span>),</span>
        <span>get_recent_news</span><span>(),</span>
    <span>],</span>
    <span>unsubscribe_link</span><span>=</span><span>generate_unsubscribe_link</span><span>(</span>
        <span>email</span><span>,</span> 
        <span>message</span><span>=</span><span>message</span><span>,</span>
        <span>**</span><span>unsubscribe_settings</span><span>,</span>
    <span>),</span>
    <span>attachments</span> <span>=</span> <span>[],</span>
<span>).</span><span>schedule_for_submission</span><span>(</span>
    <span>holidays_queue</span><span>,</span>
    <span>important</span><span>=</span><span>user_is_santa</span> <span>|</span>  <span>user_is_deer</span> \
     <span>|</span> <span>user_previously_had_issues_with_christmas_delivery</span><span>,</span>
<span>)</span>

</code></pre></div>  </div>
  <pre>prepare_message<hngr>(</hngr>
    <pnct>,</pnct> <kwrg>title=</kwrg><strn>&#34;Hey {}, ready for Christmas?&#34;</strn>.format(user_name)
    <pnct>,</pnct> <kwrg>email=</kwrg>email
    <pnct>,</pnct> <kwrg>body=</kwrg><hngr>f&#34;&#34;&#34;</hngr>
        <strn>&#34;Reminder: please clean your chimneys!              </strn>
        <strn>&#34;                                                   </strn>
        <strn>&#34;Oh, and prepare &#34;Santa Landing Spot&#34; on your roof  </strn>
        <strn>&#34;                                                   </strn>
        <strn>&#34;Thank you {<kwrg>user_name</kwrg>} for cooperation,\nSanta Corp.</strn>
    <pnct>,</pnct> additional_sections=<hngr>[</hngr>
        <pnct>,</pnct> get_current_promotions(n_promotions=4)
        <pnct>,</pnct> get_recent_news()
    <hngr>]</hngr>
    <pnct>,</pnct> unsubscribe_link=generate_unsubscribe_link<hngr>(</hngr>
        <pnct>,</pnct> email
        <pnct>,</pnct> message=message
        <pnct>,</pnct> **unsubscribe_settings
    <hngr>)</hngr>
    <pnct>,</pnct> attachments = []
<hngr>)</hngr>
<pnct>\</pnct>.schedule_for_submission<hngr>(</hngr>
    <pnct>,</pnct> holidays_queue
    <pnct>,</pnct> important=user_is_santa | user_is_deer 
      \| user_previously_had_issues_with_christmas_delivery
<hngr>)</hngr>
</pre>
</div>

<p>I welcome you to study this example for a minute.
Structure overall did not change much. Note differences in line breaks <code>\</code> and multiline strings.</p>

<p>An important distinction:
leading commas get the same role as hyphens in yaml: they define structure, their position is not arbitrary.</p>

<div>
  <div><div><pre><code><span># normal python
# this is legal code            
</span><span>print</span><span>(</span>
    <span>1</span><span>,</span> 
        <span>2</span><span>,</span>
<span>)</span>
</code></pre></div>  </div>
  <div><div><pre><code><span># proposed
# this is incorrect code        
</span><span>print</span><span>(</span>
    <span>,</span> <span>1</span>
        <span>,</span> <span>2</span>
<span>)</span>
</code></pre></div>  </div>
</div>

<p>In new code there is no need in closing brackets (see that yourself by staring at the code more!). </p>

<div>
  <div><div><pre><code><span>prepare_message</span><span>(</span>
    <span>title</span><span>=</span><span>&#34;Hey {}, ready for Christmas?&#34;</span><span>.</span><span>format</span><span>(</span><span>user_name</span><span>),</span>
    <span>email</span><span>=</span><span>email</span><span>,</span>
    <span>body</span><span>=</span><span>f</span><span>&#34;&#34;&#34;Reminder: please clean your chimneys!

Oh, and prepare &#34;Santa Landing Spot&#34; on your roof

Thank you </span><span>{</span><span>user_name</span><span>}</span><span> for cooperation,</span><span>\n</span><span>Santa Corp.
&#34;&#34;&#34;</span><span>,</span>
    <span>additional_sections</span><span>=</span><span>[</span>
        <span>get_current_promotions</span><span>(</span><span>n_promotions</span><span>=</span><span>4</span><span>),</span>
        <span>get_recent_news</span><span>(),</span>
    <span>],</span>
    <span>unsubscribe_link</span><span>=</span><span>generate_unsubscribe_link</span><span>(</span>
        <span>email</span><span>,</span> 
        <span>message</span><span>=</span><span>message</span><span>,</span>
        <span>**</span><span>unsubscribe_settings</span><span>,</span>
    <span>),</span>
    <span>attachments</span> <span>=</span> <span>[],</span>
<span>).</span><span>schedule_for_submission</span><span>(</span>
    <span>holidays_queue</span><span>,</span>
    <span>important</span><span>=</span><span>user_is_santa</span> <span>|</span>  <span>user_is_deer</span> \
     <span>|</span> <span>user_previously_had_issues_with_christmas_delivery</span><span>,</span>
<span>)</span>
</code></pre></div>  </div>
  <pre>prepare_message<hngr>(</hngr>
    <pnct>,</pnct> <kwrg>title=</kwrg><strn>&#34;Hey {}, ready for Christmas?&#34;</strn>.format(user_name)
    <pnct>,</pnct> <kwrg>email=</kwrg>email
    <pnct>,</pnct> <kwrg>body=</kwrg><hngr>f&#34;&#34;&#34;</hngr>
        <strn>&#34;Reminder: please clean your chimneys!                </strn>
        <strn>&#34;                                                     </strn>
        <strn>&#34;Oh, and prepare &#34;Santa Landing Spot&#34; on your roof    </strn>
        <strn>&#34;                                                     </strn>
        <strn>&#34;Thank you {<kwrg>user_name</kwrg>} for cooperation,\nSanta Corp.  </strn>
    <pnct>,</pnct> additional_sections=<hngr>[</hngr>
        <pnct>,</pnct> get_current_promotions(n_promotions=4)
        <pnct>,</pnct> get_recent_news()
    <pnct>,</pnct> unsubscribe_link=generate_unsubscribe_link<hngr>(</hngr>
        <pnct>,</pnct> email
        <pnct>,</pnct> message=message
        <pnct>,</pnct> **unsubscribe_settings
    <pnct>,</pnct> attachments = []
<pnct>\</pnct>.schedule_for_submission<hngr>(</hngr>
    <pnct>,</pnct> holidays_queue
    <pnct>,</pnct> important=user_is_santa | user_is_deer 
      \| user_previously_had_issues_with_christmas_delivery
</pre>
</div>

<p>Don’t pay much attention to number of lines - denser code is a byproduct, not a goal.</p>

<p>Further I’ll discuss several advantages of this syntax.</p>

<h2 id="new-multiline-strings">New multiline strings</h2>

<pre>print<hngr>(f&#34;&#34;&#34;</hngr>
    <strn>&#34;This is new</strn>
    <strn>&#34;multiline string</strn>
</pre>
<p>output:</p>
<div><div><pre><code>This is new
multiline string
</code></pre></div></div>

<p>Everything looks perfect, multiple issues are solved in one shot. But … with a minor catch: that’s how output looks like in raw form:
<code><cmnt>\n</cmnt>This is new<cmnt>\n</cmnt>multiline string</code> 
(i.e. it is newline-first).
Technically, one can produce newline-last outputs, but that’s artificial.
See the elegance of match between delimiter-first and newline-first approach: delimiter just gets replaced with newline. That’s an operation that one can visually imagine by shifting all lines to the left.</p>

<p>One more example:</p>
<pre>print<hngr>(f&#34;&#34;&#34;</hngr>
    <strn>&#34;you can place anything here: &#39; &#39;&#39; &#39;&#39;&#39; &#34; &#34;&#34; &#34;&#34;&#34; f&#34;&#34;&#34; etc etc.</strn>
    <cmnt># and you can put comments in the middle of multiline</cmnt>
    <strn>&#34;multiline string can&#39;t be broken or terminated by any sequence within a line </strn>
</pre>

<p>Now, python literals do not work like that.</p>
<div><div><pre><code><span>&#39;&#39;&#39;
&#34;&#34;&#34; and &#39;&#39;&#39;</span> <span>should</span> <span>be</span> <span>escaped</span> <span>(</span><span>otherwise</span> <span>interpreted</span> <span>as</span> <span>literal</span> <span>terminator</span><span>)</span>
<span>&#39;&#39;&#39;


&#39;&#39;&#39;&#39;&#39;</span>
<span>&#39;&#39;&#39;  # this trick (available in markdown) does not work in python
&#39;&#39;&#39;&#39;&#39;</span>
</code></pre></div></div>

<h2 id="new-parsing">New parsing</h2>

<p>In contrast to normal python, line alone does not inform if the instruction is complete, or it should be continued on the next line. 
Parsing one more line is required to confirm that current code section is complete 
(only prefix of next line should be parsed, to be more precise).</p>

<p>In this approach top-level parsing is quite ignorant to language details, and it relies on the same visual cues as we humans do: parser does not need to analyze line in detail to figure out if the instruction continues or not.</p>

<p>Let me ‘parse’ this example:</p>

<div><div><pre><code>Delimiter   Token class    Rest of line
            <span>&lt;lvl1-instr</span>   <span>&gt;</span>prepare_message(
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>title=&#34;Hey {}, ready for Christmas?&#34;.format(user_name)
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>email=email
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>body= f&#34;&#34;&#34;
        &#34;   <span>&lt;lvl3-literal</span> <span>&gt;</span>Reminder: please clean your chimneys!
        &#34;   <span>&lt;lvl3-literal</span> <span>&gt;</span>
        &#34;   <span>&lt;lvl3-literal</span> <span>&gt;</span>Oh, and prepare &#34;Santa Landing Spot&#34; on your roof
        &#34;   <span>&lt;lvl3-literal</span> <span>&gt;</span>
        &#34;   <span>&lt;lvl3-literal</span> <span>&gt;</span>Thank you {user_name} for cooperation,\nSanta Corp.
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>additional_sections=[
        ,   <span>&lt;lvl3-item</span>    <span>&gt;</span>get_current_promotions(n_promotions=4)
        ,   <span>&lt;lvl3-item</span>    <span>&gt;</span>get_recent_news()
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>unsubscribe_link=generate_unsubscribe_link(
        ,   <span>&lt;lvl3-item</span>    <span>&gt;</span>email
        ,   <span>&lt;lvl3-item</span>    <span>&gt;</span>message=message
        ,   <span>&lt;lvl3-item</span>    <span>&gt;</span>**unsubscribe_settings
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>attachments = []
\           <span>&lt;lvl1-continue&gt;</span>.schedule_for_submission(
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>holidays_queue
    ,       <span>&lt;lvl2-item</span>    <span>&gt;</span>important=user_is_santa | user_is_deer 
      \|    <span>&lt;lvl2-continue&gt;</span>| user_previously_had_issues_with_christmas_delivery
</code></pre></div></div>

<p>By looking only at the sequence of delimiters (there are several subtypes of them), 
one can deduct limits of every code block / call / literal, i.e. derive top-level structure of the program.
Parser now deals with a simpler task of checking that elements fit this pre-defined structure,
and can point places where ‘structure’ does not match ‘content’.</p>

<p>Good bye old times when one deleted bracket caused complete rebuild of AST and numerous errors.</p>

<h2 id="new-editing">New editing</h2>

<div>
<div>
    <p>Normal python. </p>
    <pre>print(<caret></caret>)
</pre>
    <p>after you hit enter in IDE:</p>
    <pre>print(
    <caret></caret>
)
</pre>
    <p>then you type argument and comma. </p>
    <pre>print(
    42,
    <caret></caret>
)
</pre>
    <p>Done? Arrow down + enter</p>
    <pre>print(
    42,
    43,
)
<caret></caret>
</pre>
    <p>Forgot something? </p>
    <pre>print(
    42,
    43,
    <caret></caret>
)
</pre>
  </div>
 
<div>
    <p>Delimiter-first pseudo-python. </p>
    <pre>print(<caret></caret>)
</pre>
    <p>after you hit enter in IDE comma is auto-added:</p>
    <pre>print(
    , <caret></caret>

</pre>
    <p>you type only argument. </p>
    <pre>print(
    , 42
    , <caret></caret>
</pre>
    <p>Done? Enter + shift-tab</p>
    <pre>print(
    , 42
    , 43 
<caret></caret>
</pre>
    <p>Forgot something?
Tab</p>
    <pre>print(
    , 42
    , 43 
    , <caret></caret>
</pre>
  </div>
</div>

<p>The process of editing such structures was polished with hierarchical lists in word and other text processors.</p>

<p>Below is an animated example from workflowy (taken from <a href="https://www.process.st/take-better-notes/">post</a> by B. Brandall):
<img src="https://www.process.st/wp-content/uploads/2016/01/ezgif.com-crop-1.gif"/></p>

<p>Even minimalist note-taking apps these days recognize the importance of hierarchical organization. 
Their interface focuses on effectively traversing and modifying this structure.</p>

<p>But with code - this extremely structured and standardized pieces of linked information - we continue the game of imitation: ‘hey, that’s just text files, you can use notepad here!’.</p>

<h2 id="new-versioning">New versioning</h2>

<p>Missing trailing commas make diffs a bit annoying because of including an additional line.</p>

<p>New syntax has this solved. In other aspects versioning should work the same.</p>

<h2 id="new-formatting">New formatting</h2>

<p>The goal of formatting is to produce a visual code structure that is easy to read,
as if you already see all main components without reading anything.</p>

<p>New syntax enforces this, and leaves fewer degrees of freedom.
Writing something non-readable would be challenging… I suppose.</p>

<p>Role of formatters thus would be minor, or they can be skipped.</p>

<h2 id="limitations">Limitations</h2>

<p>First, I did not try to solve following perceptual problems:</p>

<ul>
  <li>commas are leading, and I’ve mentioned that this was a problem for comma-first formatting</li>
  <li>open brackets without a matching pair create visual discomfort. Also my eyes already trained to focus on closing brackets, but proper color scheme seems to solve this</li>
</ul>

<p>This post is already long, and leaving things closer to python simplifies example.
I think both points can be improved, and feel free to post your ideas on this.</p>

<p>Second, I intentionally focused only on improving multi-line constructs, but single-line collections were left untouched. That does not mean delimiter-first does not work there, but scale of necessary changes is just too high to justify gains. At least for now.</p>

<h2 id="if-you-made-it-this-far">If you made it this far</h2>

<p>Wow, thank you!</p>

<p>I hope an adventure was interesting and slightly mind blowing.</p>

<p>Don’t be too surprised if this proposal evokes “hey this looks wrong, just plain wrong” reaction. </p>

<p><small>
Thanks to Alexander Molchanov for proofreading, improving text, and leaving comments.
</small></p>

<p><small>* 
Later addition: Isaac Z. Schlueter advised there is a term ‘initiator’, used in “… specification discussion threads, where it’s common to dig deep into the particulars of parsing semantics.  Very much a ‘deep in the weeds’ kind of technical term.” 
</small></p>

  </article>

  <!-- adding temp info -->
  <!--
  <div class='job-looking' style='background: #DEF; font-size: 1.2em; padding: 30px;'  >
    Psst. Looking for a <strong>research scientist in machine learning</strong> to join your team? <br />
    Drop me an email, I'm currently open for opportunities! <a href='http://arogozhnikov.github.io/cv/AlexRogozhnikov.html' >My CV</a>.
  </div>
  -->
  <!-- end of temp info -->

</div>

      </div>
    </div></div>
  </body>
</html>
