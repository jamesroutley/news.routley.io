<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://guicommits.com/how-to-log-in-python-like-a-pro/">Original</a>
    <h1>Logging in Python like a pro</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
			<article id="6138872d9afe296ec72df589">
	
	<div>
		<p><span>
			<a href="https://guicommits.com/author/gui/">gui</a>

			commited 10 months ago
		</span>

		<span> ¬∑ <a href="https://dkmccandless.github.io/tag/python/">üêç Python</a></span>
	</p></div>
	<p>Beyond <a href="https://guicommits.com/handling-exceptions-in-python-like-a-pro/">exception handling</a>, there&#39;s something else I see people struggling with, which is logging.</p><p>Most people don&#39;t know what to log, so they decide to log anything thinking it might be better than nothing, and end up creating <strong>just noise</strong>. Noise is a piece of information that doesn&#39;t help you or your team understand what&#39;s going on or resolving a problem.</p><p>Furthermore, I feel people are uncertain about how to use log levels, and so they default to <code>logger.info</code> everywhere (when not using <code>print</code> statements).</p><p>Lastly, people seem clueless on how to config logging in python, they have no idea what are handlers, filters, formatters, etc.</p><p>My goal here is to clarify what good logging is, and how you should implement it. I&#39;ll try to give meaningful examples, and provide you a flexible rule of thumb that should be used when logging for ANY application you&#39;re ever going to build.</p><h2 id="%F0%9F%93%96-intro">üìñ Intro</h2><p>Examples make things easier to visualize, let&#39;s consider a system where:</p><ul><li>Users can connect multiple integrations from third parties to list resources (e.g. GitHub, Slack, AWS, etc.)</li><li>Resources are unique based on the integration (e.g. GitHub lists repositories, Slack list conversations, AWS lists EC2 instances, etc.)</li><li>Each integration is unique and has its own set of complexities, endpoints, steps, etc.</li><li>Each integration may produce different errors at any time (e.g. Authentication invalid, resource does not exist, etc.)</li></ul><figure><img src="https://guicommits.com/content/images/2021/09/flow-sample.png" alt="Flow Sample" loading="lazy" width="344" height="681"/><figcaption>Flow sample</figcaption></figure><p>I won&#39;t be focusing on <a href="https://guicommits.com/building-an-agnostic-microservice-architecture-with-kafka/">the challenges of maintaining such integrations</a> but only <strong>observing them</strong>.</p><h2 id="%F0%9F%8C%B3-the-nature-of-logging-good-logging-matters">üå≥ The nature of logging: good logging matters</h2><p><em>(Google SEO, please, don&#39;t relate this post to forests üôè).</em></p><p>First, let&#39;s analyze the log characteristics.</p><p>Logs are:</p><ul><li><strong>Descriptive</strong>;</li><li><strong>Contextual</strong>;</li><li><strong>Reactive</strong>;</li></ul><p>They&#39;re <strong>descriptive</strong> in the sense that they give you a piece of information, they&#39;re <strong>contextual</strong> because they give you an overview of the state of things at the moment, and finally, they&#39;re <strong>reactive</strong> because they allow you to take action only after something happened (even though your logs are sent/consumed real-time, there&#39;s not really something you can do to change what just happened).</p><p><strong>If you don&#39;t respect the nature of a log, you&#39;re going to produce only noise, which decreases your performance.</strong></p><p>Here, take some examples based on the system we defined together:</p><p>If you give it a description like <em>&#34;operation connect failed&#34;</em>, but don&#39;t give context, it&#39;s hard to understand which integration failed, who was affected, what step of the connection it failed, thus you can&#39;t react! You&#39;ll end up digging into more logs and having no clue but just guesses on what could be the issue.</p><p>Oh, also don&#39;t underestimate a developer&#39;s capacity to ruin the descriptive characteristic. It can be easily done by giving shallow messages with no context at all like: <em>&#34;An error happened&#34;</em>, or <em>&#34;An unexpected exception was raised&#34;</em>. By reading it I can&#39;t even consider the impact of an error, because I don&#39;t know WHAT failed. So, yes, it&#39;s possible to ruin the core nature of a log.</p><p><strong>Logs are private intel from your software to keep you aware and react to situations. Any log that can&#39;t give you this ability is pure noise.</strong></p><h3 id="%E2%8F%B2%EF%B8%8F-when-to-log">‚è≤Ô∏è When to log?</h3><p>To keep logs &#34;reactive&#34; you need to log &#34;events&#34;. Make them as clear and easy to read as this blog post, maybe you didn&#39;t read every single line I wrote above, but you can still follow up, skip sections you don&#39;t want, and focus/read what caught your attention. Logs should be the same.</p><p>As a rule of thumb consider logging:</p><figure><img src="https://guicommits.com/content/images/2021/09/when-to-log.png" alt="When to log" loading="lazy" width="561" height="31"/><figcaption>When to log</figcaption></figure><ul><li><strong>At the start</strong> of relevant operations or flows (e.g. Connection to third-party, etc);</li><li><strong>At any relevant progress</strong> (e.g. Authentication successful, got a valid response code, etc);</li><li><strong>At the conclusion</strong> of an operation (e.g. EITHER succeeded or failed);</li></ul><p><strong>Logs should tell you a story, every story has a beginning, middle, and end.</strong></p><p>Be strict with &#34;relevant&#34;, it&#39;s easier to add logs than to remove them, anything below relevant is noise.</p><h3 id="%F0%9F%AA%B5-what-to-log">ü™µ What to log?</h3><p>To keep logs &#34;descriptive&#34; and &#34;contextual&#34;, you need to provide the correct set of information, and that&#39;s impossible to tell you which are they without knowing your case. Let&#39;s use our example instead.</p><p>Consider the AWS integration from our example, It would be great to have:</p><h4 id="successful-logs-example">Successful logs example</h4><!--kg-card-begin: html--><table>
    <thead>
        <tr>
            <th>
                Message</th>
            <th>
                Instant knowledge</th>
            <th>
                Context</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>Connecting to AWS</code>
            </td>
            <td>AWS operation started</td>
            <td>Log attributes should allow me to
                find out who triggered it</td>
        </tr>
        <tr>
            <td>
                <code>Retrieved instances from all regions</code>
            </td>
            <td>
                One relevant progress has been made</td>
            <td>
                -</td>
        </tr>
        <tr>
            <td>
                <code>Connection to AWS has been successful</code>
            </td>
            <td>
                AWS operation finished</td>
            <td>
                Log attributes should allow me to find who got positively affected</td>
        </tr>
    </tbody>
</table><!--kg-card-end: html--><h4 id="error-logs-example">Error logs example</h4><p>Consider that retrieving instances from region <code>af-south-1</code> failed due to some random issue over that region.</p><!--kg-card-begin: html--><table>
    <thead>
        <tr>
            <th>
                Message</th>
            <th>
                Instant knowledge</th>
            <th>
                Context</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>Connecting to AWS</code>
            </td>
            <td>AWS operation started</td>
            <td>Log attributes should allow me to
                find out who triggered it</td>
        </tr>
        <tr>
            <td>
                <code>Failed to retrieve instances from regions af-south-1 when connecting to AWS for user X</code>
            </td>
            <td>
                AWS operation didn&#39;t finish, region<span>¬†</span><code>af-south-1</code><span>¬†</span>failed,
                user<span>¬†</span><code>X</code><span>¬†</span>got
                affected</td>
            <td>
                I should be able to see the error&#39;s stack trace to dive into the &#34;why&#34; it failed</td>
        </tr>
    </tbody>
</table><!--kg-card-end: html--><p>For both cases, I can track when something happened (logs have timestamps), what happened, and who got affected.</p><p>I decided to not refer the user when the operation starts and succeeds because it&#39;s irrelevant (so it&#39;s noise), see:</p><ul><li>If I know something started, and don&#39;t even know the result - <strong>what can I do?</strong></li><li>If everything seems fine, <strong>why should I bother?</strong></li></ul><p>Adding such data make logs noisy because they&#39;re impossible to react: I got nothing to do! I still should be able to gather details by reading attributes (who, when, why, etc). If you&#39;re willing to measure something you should be using metrics, not logs.</p><p>On the other side, the error log seems way more verbose, and it should be! Reading these logs makes me confident enough to act <strong>RIGHT AWAY</strong>:</p><ul><li>Ask a dev to check AWS status on the region <code>af-south-1</code>, and maybe run some sanity checks;</li><li>Call user X and proactively notify him you&#39;re aware of the issue that is affecting that region;</li></ul><p>The key point here is: <strong>You can react RIGHT AWAY</strong>, no deeper investigation is needed to. You know everything you have to, and <strong>you can take immediate action to reduce impact</strong>. Developers might need to dig deeper into stack traces to gather more context (in case of a bug), but the big picture is already clear.</p><p>Any other error message missing these minimum info becomes noise because it raises concern, but takes away your condition to react. You need to investigate first to acknowledge how bad is the issue.</p><p>If still unsure of how to build such messages, I&#39;ll share a very simple hack with you.</p><!--kg-card-begin: html--><!--kg-card-end: html--><!--kg-card-begin: html-->



<!--kg-card-end: html--><!--kg-card-begin: html--><!--kg-card-end: html-->
	





	


  	
</article>



		</div></div>
  </body>
</html>
