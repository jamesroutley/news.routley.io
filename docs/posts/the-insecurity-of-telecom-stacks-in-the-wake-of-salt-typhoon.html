<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://soatok.blog/2025/03/12/on-the-insecurity-of-telecom-stacks-in-the-wake-of-salt-typhoon/">Original</a>
    <h1>The Insecurity of Telecom Stacks in the Wake of Salt Typhoon</h1>
    
    <div id="readability-page-1" class="page"><div>

		<div>

			
<p>Towards the end of last year, we learned that a group (allegedly affiliated with the Chinese government, referred to as “Salt Typhoon”) <a href="https://web.archive.org/web/20241127172349/https://www.t-mobile.com/news/un-carrier/update-cyberattacks-targeting-us-wireless-companies">breached T-Mobile and other telecommunications companies</a> and caused all sorts of havoc.</p>



<p>This isn’t really a blog post about that incident, but it was the catalyst that inspired a bit of curiosity within me.</p>



<p>I can’t (legally) access most mobile phone companies’ networks to see what vulnerabilities I can find, but there are plenty of open source software projects related to telecommunications on GitHub. So when I heard about the Salt Typhoon hacks, I wondered, “Is any of this open source telecom software any good?”</p>



<p>In a previous life, I worked with companies that used <a href="https://github.com/asterisk/asterisk" target="_blank" rel="noreferrer noopener">Asterisk</a> and <a href="https://github.com/signalwire/freeswitch" target="_blank" rel="noreferrer noopener">FreeSWITCH</a>, but I’d never really looked into them beyond the surface-level familiarity congruent to “this uses a similar protocol as RedPhone, somewhere” (this was when <a href="https://soatok.blog/2025/02/18/reviewing-the-cryptography-used-by-signal/" target="_blank" rel="noreferrer noopener">Signal</a> was still called TextSecure).</p>



<p>I don’t know much about PBX systems, SIP, or even audio encoding. Furthermore, some of the best C programmers I’ve ever met worked in telecom. Hell, some of the longest-running hacker communities have their roots in phone phreaking from the 1980s. Not to mention all the legendary engineers that trace their roots to Bell Labs.</p>



<p>This is all to say, I thought looking at this sort of software would be a fruitless endeavor. </p>



<p><em>Surely all of the low-hanging fruit would be found already?</em></p>



<p>Thus, I opened FreeSWITCH’s source code on GitHub and almost immediately found a vulnerability.</p>





<h2>Buffer Overflow in HTTP Request Handler for XMLRPC</h2>



<p>In <a href="https://github.com/signalwire/freeswitch/blob/75566bc270f7b4064eb9ff3aed68e2f752fc17ee/libs/xmlrpc-c/lib/abyss/src/handler.c#L243-L250">this excerpt of code</a>, the HTTP request handler for the XMLRPC library bundled with FreeSWITCH writes an arbitrary-length URI to a 4096-byte stack variable called z.</p>


<div><pre title="">char z[4096];
char *p,z1[26],z2[20],z3[9],u;
const char * z4;
int16_t i;
uint32_t k;

if (text) {
    sprintf(z, &#34;Index of %s&#34; CRLF, uri);
</pre></div>


<p>The <code>uri</code> variable <a href="https://github.com/signalwire/freeswitch/blob/75566bc270f7b4064eb9ff3aed68e2f752fc17ee/libs/xmlrpc-c/include/xmlrpc-c/abyss.h#L366-L370">is populated by the path part of the Request URI</a>, which is attacker-provided.</p>



<p>This is not typically a problem, since <a href="https://stackoverflow.com/a/417184" target="_blank" rel="noreferrer noopener">most browsers don’t support URLs longer than 2048 characters</a>, but the relevant RFCs support up to about 8 KB in most cases. (CloudFlare supports up to 32KB.)</p>



<p>I think it’s reasonable to assume that attackers are capable of sending a Request URI longer than 4096 characters.</p>



<p>Putting these observations together, it’s pretty easy to see this is a no-auth buffer overflow in their XMLRPC library. </p>



<blockquote>
<p>Turning this into remote code execution is an exercise left to the reader (mostly because I’m not really up-to-date on OS-level exploit mitigation techniques, and how to bypass them).</p>
</blockquote>



<h3>How To Fix This Issue</h3>



<p><a href="https://sternumiot.com/iot-blog/sprintf-and-snprintf-c-functions-usage-examples-and-security-best-practices/" target="_blank" rel="noreferrer noopener">Use <code>snprintf()</code> instead</a>.</p>



<p>This is kind of “defensive C programming practices 101” level.</p>



<h2 id="disclosure">Soatok Attempts Coordinated Disclosure</h2>



<p>(n.b., <a href="https://soatok.blog/2025/01/21/too-many-people-dont-value-the-time-of-security-researchers/#:~:text=Responsible%20Disclosure%2C%20Isn%E2%80%99t" target="_blank" rel="noreferrer noopener">Please stop saying “responsible” disclosure</a>.)</p>



<p><strong>2025-01-27</strong>: I send an email on to the email address <a href="https://github.com/signalwire/freeswitch/blob/master/SECURITY.md" target="_blank" rel="noreferrer noopener">listed on FreeSWITCH’s security policy</a> with the details of the vulnerability.</p>



<p><strong>2025-02-07</strong>: I send a follow-up email to ensure they received my report.</p>



<p><strong>2025-02-07</strong>: Andrey Volk responds:</p>



<blockquote>
<p>Hello Soatok.</p>



<p>Thank you for your email!</p>



<p>Issues you describe were recently fixed.</p>



<p>Please see:</p>



<p><a href="https://github.com/signalwire/freeswitch/pull/2752" target="_blank" rel="noreferrer noopener">https://github.com/signalwire/freeswitch/pull/2752</a></p>



<p><a href="https://github.com/signalwire/freeswitch/pull/2753" target="_blank" rel="noreferrer noopener">https://github.com/signalwire/freeswitch/pull/2753</a></p>



<p><a href="https://github.com/signalwire/freeswitch/pull/2754" target="_blank" rel="noreferrer noopener">https://github.com/signalwire/freeswitch/pull/2754</a></p>



<p>Best regards,</p>
</blockquote>



<p>Since the fixes are now public, I’m left to assume that “embargo has broken,” so to speak. That means I’m free to blog about this publicly.</p>



<p>However, I notice they haven’t tagged a new release with this security fix for FreeSWITCH users. I reply:</p>



<blockquote>
<p>Oh, wonderful. Thanks for getting back to me.</p>



<p>Do you have an ETA on when the release will be tagged? I don’t want to publish anything until people can easily install an updated version.</p>
</blockquote>



<p>A few hours later, Andrey responds to my email.</p>



<p>Brace yourselves, it’s a stupid one.</p>



<p>…</p>



<blockquote>
<p>Hello Soatok.</p>



<p>Thank you for your interest in FreeSWITCH.</p>



<p>We do not have plans to make a release of FreeSWITCH Community till summer 2025.</p>



<p>Best regards,</p>
</blockquote>


<div>
<figure><img data-recalc-dims="1" decoding="async" width="512" height="512" data-attachment-id="1205" data-permalink="https://soatok.blog/soatoktelegrams2020-05/" data-orig-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-05.png?fit=512%2C512&amp;ssl=1" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="SoatokTelegrams2020-05" data-image-description="" data-image-caption="&lt;p&gt;wat sticker&lt;/p&gt;
" data-medium-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-05.png?fit=300%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-05.png?fit=512%2C512&amp;ssl=1" src="https://i0.wp.com/soatok.blog/wp-content/uploads/2020/08/soatoktelegrams2020-05.png?resize=512%2C512&amp;ssl=1" alt="wat sticker`"/><figcaption>wat</figcaption></figure></div>


<h3>What Just Happened?</h3>



<p>To recap: An employee of SignalWire (which develops FreeSWITCH) came right out and said they would let people who aren’t <a href="https://web.archive.org/web/20250226171744/https://signalwire.com/products/freeswitch-enterprise">paying for FreeSWITCH Advantage</a> stay vulnerable until their regularly scheduled release (sometime in the Summer).</p>



<p>There are <a href="https://web.archive.org/web/20250312042655/https://www.shodan.io/search?query=freeswitch" target="_blank" rel="noreferrer noopener">about 8,300 hits on Shodan for FreeSWITCH</a> as I write this. I highly doubt they’re all paying for enterprise support, so we’re talking about potentially thousands of telecom stacks around the world that SignalWire has decided to keep vulnerable until the Summer, even after they published the patches on GitHub.</p>



<p>While such a decision might be perfectly legal, it really does not inspire trust in the stewards of this software project to give a shit about the harm their careless coding practices inflict upon their users.</p>



<h2>TelecomSec: A Systemic Issue</h2>



<p>The worst part is, when I confided in a friend that works in telecom (after SignalWire published the fixes, of course) about this carnival-quality vulnerability management from the FreeSWITCH developers, their response was:</p>



<blockquote>
<p>That fast?</p>



<p>[…]</p>



<p>December 2024 is the last time that alarms were once again raised about known SS7 vulnerabilities that have continued to exist in telephone networks for the past 17 years.</p>
</blockquote>



<p>And, to be honest, that <em>kind of took the wind out of my sails</em> so I didn’t bother looking at Asterisk or any of the other software.</p>



<p>I mean, why bother? I already had the answer to the question that prompted me to look in the first place: <strong>Telecom security sucks today</strong>.</p>



<p>The reason things sucks is largely because there’s very little (if any) money to be made in securing these systems today.</p>



<p>Things don’t <em>have to</em> be this way, of course.</p>



<p>Maybe there’s some opportunity for some enterprising young hacker to write a FreeSWITCH competitor in Rust that has sane vulnerability management around it.</p>



<p>(Or, at least, is marginally harder to find vulnerabilities in than <a href="https://github.com/digininja/DVWA" target="_blank" rel="noreferrer noopener">Damn Vulnerable Web Application</a>. Maybe the OpenBSD team can be inspired to act?)</p>



<p>Maybe in the future, we’ll find the political will to invest in the security of America’s telecommunications infrastructure. Who knows, some of that money might even percolate towards open source software, and they can hire someone who knows how to run valgrind.</p>



<p>Or maybe everything will continue to suck, because incentives rule anything, and there currently aren’t any to do better.</p>





<h2>Closing Thoughts</h2>



<p>It took me a long time to write this one up, despite it being a rather simple technical issue, because I’m sure there are eldritch horrors lurking beneath the surface of this relatively simple finding.</p>



<p>The vendor’s response was pretty lame, yeah. But is this vendor the lamest in their industry? I’m not so sure about that one. At least they responded within 90 days and fixed the issue on their GitHub.</p>



<p>But, hey, if you’re waiting on SignalWire to get around to running <code>git tag</code>… maybe rebuild from source or block public HTTP access to your FreeSWITCH stack at the firewall level?</p>



<p>Sorry I can’t help more.</p>





		</div><!-- .entry-content -->

	</div></div>
  </body>
</html>
