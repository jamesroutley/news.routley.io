<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/mitjafelicijan/makext">Original</a>
    <h1>Show HN: Making GNU Make a better Task Runner</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Makext is a collection of useful extensions for Makefiles, aimed
at simplifying and enhancing the functionality of Make-based
projects. These extensions provide additional features and
convenience functions to improve the overall usage of <a href="https://www.gnu.org/software/make/" rel="nofollow">GNU
Make</a> as a task runner.</p>
<p dir="auto">All the extensions are written in GNU Make so no other languages are used
making this very embedable and has zero dependencies other than GNU Make.</p>
<p dir="auto">Other than <code>makext.mk</code> all the other files in the repository are either
license or readme files or just testing data that is/are not needed to
use it.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p><p dir="auto">This extensions are abusing GNU Make in some sense since it was not
meant to really be a task runner. Keep that in mind. However, despite
that, I constantly find myself using it as such.</p>
</div>

<table>
<thead>
<tr>
<th>Extension</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>help</td>
<td>Displays all targets with a comment in help format.</td>
</tr>
<tr>
<td>assure</td>
<td>Check for the existence of programs on a machine.</td>
</tr>
<tr>
<td>environment</td>
<td>Loads environmental variables from other files.</td>
</tr>
</tbody>
</table>
<p dir="auto">Additional features:</p>
<ul dir="auto">
<li>Automatic description inclusion in help message.</li>
<li>Automatic license inclusion in help message.</li>
</ul>
<p dir="auto">Tested on:</p>
<ul dir="auto">
<li>GNU Linux Debian 12 with GNU Make 4.3</li>
<li>macOS Sonoma 14.4.1 with GNU Make 3.81</li>
</ul>
<p dir="auto">If you have an idea for a new feature <a href="https://github.com/mitjafelicijan/makext/issues/new">open a new
issue</a>.</p>

<p dir="auto">First you will need to download <code>makext.mk</code> file from the repository to
the same directory where you have <code>Makefile</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="wget -O makext.mk https://github.com/mitjafelicijan/makext/raw/master/makext.mk"><pre>wget -O makext.mk https://github.com/mitjafelicijan/makext/raw/master/makext.mk</pre></div>
<p dir="auto">Now you can include it in your <code>Makefile</code>.</p>
<div dir="auto" data-snippet-clipboard-copy-content="include makext.mk

help: .help"><pre><span>include</span> makext.mk

<span>help</span>: .help</pre></div>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p dir="auto">Make sure you create first target <code>help: .help</code> before any other
targets in your <code>Makefile</code>. GNU Make will execute first target if
no target provided as an argument when calling <code>make</code>.</p>
</div>

<p dir="auto">One of the extensions is <code>.help</code> which displays all the targets in the
<code>Makefile</code> and their descriptions which are provided as comments next
to the target definition.</p>
<p dir="auto">Lets check how and example <code>Makefile</code> would look like. It
is recommended to use <code>.PHONY</code> for targets that are not
actual files. In the example below I am not doing that
though, but it is wise to follow that rule. Check <a href="https://www.gnu.org/software/make/manual/make.html#Phony-Targets" rel="nofollow">4.6 Phony
Targets</a>
section in the GNU Make manual.</p>
<div dir="auto" data-snippet-clipboard-copy-content="include makext.mk

help: .help

build-app: clean-cache # Build the application
	@echo &#34;Building the application...&#34;

clean-cache: # Clean the cache
	@echo &#34;Cleaning the cache...&#34;

deploy-prod: # Deploy to production
	@echo &#34;Deploying to production...&#34;

run-tests:
	@echo &#34;Running tests...&#34;"><pre><span>include</span> makext.mk

<span>help</span>: .help

<span>build-app</span>: clean-cache <span><span>#</span> Build the application</span>
	@echo <span><span>&#34;</span>Building the application...<span>&#34;</span></span>

<span>clean-cache</span>: <span><span>#</span> Clean the cache</span>
	@echo <span><span>&#34;</span>Cleaning the cache...<span>&#34;</span></span>

<span>deploy-prod</span>: <span><span>#</span> Deploy to production</span>
	@echo <span><span>&#34;</span>Deploying to production...<span>&#34;</span></span>

<span>run-tests</span>:
	@echo <span><span>&#34;</span>Running tests...<span>&#34;</span></span></pre></div>
<p dir="auto">This will give us the following result when we execute command <code>make</code>
without any arguments.</p>
<div data-snippet-clipboard-copy-content="$ make
Targets:
  build-app                 Build the application
  clean-cache               Clean the cache
  deploy-prod               Deploy to production"><pre lang="text"><code>$ make
Targets:
  build-app                 Build the application
  clean-cache               Clean the cache
  deploy-prod               Deploy to production
</code></pre></div>
<ul dir="auto">
<li>Targets without defined comment next to the target will be ignored
from help list. In this case <code>run-tests</code> is missing from the list.</li>
<li>Targets that start with <code>.</code> will also be ignored.</li>
<li>Prerequisites in targets will be omitted from the result. See how
<code>clean-cache</code> is missing from <code>build-app</code> target.</li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Description &amp; License information</h2><a id="user-content-description--license-information" aria-label="Permalink: Description &amp; License information" href="#description--license-information"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can provide description for the project that will be displayed
together with <code>help</code>. To do this provide this information in the
<code>MEX_DESCRIPTION</code> variable.</p>
<p dir="auto">Same goes for license information. Provide this information by creating
<code>MEX_LICENSE</code> variable.</p>
<p dir="auto">If these variables are not present this information will not be displayed
in the help.</p>
<p dir="auto">Description and license information is also formatted to max 75 characters
per row.</p>
<div dir="auto"><p dir="auto"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p dir="auto">Variables <code>MEX_DESCRIPTION</code> and <code>MEX_LICENSE</code> must be defined before you
include <code>makext.mk</code> to your <code>Makefile</code>. This is needed because the way
GNU Make is parsing Makefiles.</p>
</div>
<div dir="auto" data-snippet-clipboard-copy-content="MEX_DESCRIPTION=&#34;This provides some additional tools for this project.&#34;
MEX_LICENSE=&#34;Released under the BSD two-clause license, see the LICENSE file for more information.&#34;

include makext.mk

help: .help

build-app: clean-cache # Build the application
	@echo &#34;Building the application...&#34;

clean-cache: # Clean the cache
	@echo &#34;Cleaning the cache...&#34;"><pre><span>MEX_DESCRIPTION</span>=&#34;This provides some additional tools for this project.&#34;
<span>MEX_LICENSE</span>=&#34;Released under the BSD two-clause license, see the LICENSE file for more information.&#34;

<span>include</span> makext.mk

<span>help</span>: .help

<span>build-app</span>: clean-cache <span><span>#</span> Build the application</span>
	@echo <span><span>&#34;</span>Building the application...<span>&#34;</span></span>

<span>clean-cache</span>: <span><span>#</span> Clean the cache</span>
	@echo <span><span>&#34;</span>Cleaning the cache...<span>&#34;</span></span></pre></div>
<p dir="auto">The following example will produce the following result.</p>
<div data-snippet-clipboard-copy-content="$ make
This provides some additional tools for this project.

Targets:
  build-app                 Build the application
  clean-cache               Clean the cache

Released under the BSD two-clause license, see the LICENSE file for
more information."><pre lang="text"><code>$ make
This provides some additional tools for this project.

Targets:
  build-app                 Build the application
  clean-cache               Clean the cache

Released under the BSD two-clause license, see the LICENSE file for
more information.
</code></pre></div>

<p dir="auto">Often times project uses multiple programs and to ensure that these
programs are already installed before recipes are executed <code>.assure</code> can
be used. If programs are missing recipes can only partially be executed
leaving project in a potentially broken state.</p>
<div dir="auto" data-snippet-clipboard-copy-content="MEX_ASSURE=&#34;python3 ls tree clang&#34;

include makext.mk

build-app: .assure
	@echo &#34;Building the application...&#34;"><pre><span>MEX_ASSURE</span>=&#34;python3 ls tree clang&#34;

<span>include</span> makext.mk

<span>build-app</span>: .assure
	@echo <span><span>&#34;</span>Building the application...<span>&#34;</span></span></pre></div>
<p dir="auto"><code>.assure</code> prerequisite will loop over the list of programs defined in
<code>MEX_ASSURE</code> variable and in case one is missing will exit <code>make</code> with
error status code 1. This will stop executing the recipe and therefore
not execute anything in target <code>build-app</code>.</p>

<p dir="auto">This extension helps loading of additional environmental files in your
project. The files should have environmental variables defined in the
usual way. Separate each file by a space and that is about it.</p>
<p dir="auto">If a file is missing this will break the execution of make and exit with
status code 1.</p>
<div dir="auto" data-snippet-clipboard-copy-content="API_KEY=abc123
SECRET_KEY=def456"><pre><span>API_KEY</span><span>=</span><span>abc123</span>
<span>SECRET_KEY</span><span>=</span><span>def456</span></pre></div>
<p dir="auto">By defining <code>MEX_ENVIRONMENT</code> variable you can provide additional files
and they will be loaded automatically.</p>
<div dir="auto" data-snippet-clipboard-copy-content="MEX_ENVIRONMENT=&#34;local.env second.env&#34;

include makext.mk

demo-envars:
	@echo &#34;Environment variables&#34;
	@echo &#34;  HOME: $(HOME)&#34;
	@echo &#34;  TERM: $(TERM)&#34;
	@echo &#34;  ENV: $(MEX_ENVIRONMENT)&#34;
	@echo &#34;  AUDIO_BUCKET: $(AUDIO_BUCKET)&#34;
	@echo &#34;  DB_HOST: $(DB_HOST)&#34;"><pre><span>MEX_ENVIRONMENT</span>=&#34;local.env second.env&#34;

<span>include</span> makext.mk

<span>demo-envars</span>:
	@echo <span><span>&#34;</span>Environment variables<span>&#34;</span></span>
	@echo <span><span>&#34;</span>  HOME: <span><span>$(</span>HOME<span>)</span></span><span>&#34;</span></span>
	@echo <span><span>&#34;</span>  TERM: <span><span>$(</span>TERM<span>)</span></span><span>&#34;</span></span>
	@echo <span><span>&#34;</span>  ENV: <span><span>$(</span>MEX_ENVIRONMENT<span>)</span></span><span>&#34;</span></span>
	@echo <span><span>&#34;</span>  AUDIO_BUCKET: <span><span>$(</span>AUDIO_BUCKET<span>)</span></span><span>&#34;</span></span>
	@echo <span><span>&#34;</span>  DB_HOST: <span><span>$(</span>DB_HOST<span>)</span></span><span>&#34;</span></span></pre></div>
<p dir="auto">After that they can be used in your recipes like all the other variables
you have. They will however override variables the shell already has
defined.</p>

<ul dir="auto">
<li><a href="https://github.com/casey/just">https://github.com/casey/just</a></li>
<li><a href="https://github.com/ruby/rake">https://github.com/ruby/rake</a></li>
<li><a href="https://github.com/taskctl/taskctl">https://github.com/taskctl/taskctl</a></li>
<li><a href="https://github.com/go-task/task">https://github.com/go-task/task</a></li>
<li><a href="https://github.com/pydoit/doit">https://github.com/pydoit/doit</a></li>
</ul>

<ul dir="auto">
<li><a href="https://stackoverflow.com/a/59087509" rel="nofollow">https://stackoverflow.com/a/59087509</a></li>
</ul>

<p dir="auto"><a href="https://github.com/mitjafelicijan/makext">makext</a> was written by <a href="https://mitjafelicijan.com" rel="nofollow">Mitja
Felicijan</a> and is released under the BSD
two-clause license, see the LICENSE file for more information.</p>
</article></div></div>
  </body>
</html>
