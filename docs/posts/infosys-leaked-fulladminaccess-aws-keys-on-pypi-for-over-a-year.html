<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/">Original</a>
    <h1>Infosys leaked FullAdminAccess AWS keys on PyPI for over a year</h1>
    
    <div id="readability-page-1" class="page"><section><div><div><h3>Infosys has a lot to say about security</h3><div><div><div><div><figure><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/website.png"/></figure></div></div></div><div><p>You can check out <a href="https://www.infosys.com/services/cyber-security.html" target="_blank">their website for a lot of buzwords</a>
, but it‚Äôs
clear from all the stock photos that they take security Very Seriously Indeed ‚Ñ¢Ô∏è.</p><p>However, from what I‚Äôve found recently, it seems that Infosys follow the following Comprehensive Management-Endorsed
Proficiently Driven Cybersecurity Strategy and Framework items:</p><ul><li>Don‚Äôt use AWS roles or temporary credentials for your developers</li><li>Instead, use IAM user keys and give them all <code>FullAdminAccess</code> permissions</li><li>Never rotate these keys and store them as plaintext in git</li><li>Use these keys to protect what appears to be medical data about COVID patients</li><li>Have someone publish those keys and the code in a public package to pypi</li><li>Keep those keys active for days after leakage</li><li>Make nonsensical pull requests to try and remove all references to the leak</li></ul></div></div><h3>The Leak</h3><div><div><div><div><figure><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/github.png"/></figure></div></div></div><div><p>This morning I woke up to a very <a href="https://github.com/orf/pypi-data/pull/2" target="_blank">strange pull request</a>
on my <a href="https://github.com/orf/pypi-data" target="_blank">pypi-data</a>
project.
This project contains metadata for every package published on PyPi (<a href="https://github.com/orf/pypi-data/blob/main/release_data/f/l/flask.json" target="_blank">e.g Flask</a>
),
and it exists because querying the data from PyPi in bulk was annoying and I didn‚Äôt want to <a href="https://warehouse.pypa.io/api-reference/bigquery-datasets.html" target="_blank">use BigQuery</a>
.</p><p>The user was attempting to delete a project called <code>ihip</code>. Looking at the file they where trying to remove, it seemed
to be an internal package that was published by mistake on the 2nd of February <strong>2021</strong>. The metadata of the package
referenced the internal infosys Github instance as it‚Äôs homepage, but otherwise looked pretty innocuous.</p><p>It seems my project didn‚Äôt correctly account for complete packages that have been deleted from PyPi - my bad! I‚Äôm not
sure how to handle that to be honest - once the package is published the metadata is out there.</p><p>Out of interest I downloaded the publicly available release file that was specified in the metadata and found
something interesting.</p></div></div><h3>The Keys</h3><div><div><div><div><figure><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/code.png"/></figure></div></div></div><div><p>At the top of the file, embedded as string constants, was an AWS access key and AWS secret key. The rest of the code
seemed to be interacting with a S3 bucket in pretty standard ways: pulling data, loading it into pandas and computing
some basic aggregates. It seems like this code came from an internal Github instance inside Infosys and was accidentally
published.</p><p>I assumed the key had been revoked (it‚Äôs been public for over a year!), but to my great surprise I found it was still
active!</p><p><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/sts.png" alt=""/></p></div></div><h3>The Bucket</h3><div><div><div><div><figure><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/bucket.jpg"/></figure></div></div></div><div><p>So this is definitely something that should be reported to them. I always let my curiosity get the better of me, so I
listed the root of the bucket. From the contents it seems that this bucket contains data used to train COVID prediction
models. Inside the <code>John_Hopkins_Hospital/</code> prefix there appeared to be file names that looked like they contained
some form of clinical data, which I did not access to verify:</p><p><code>Johns_Hopkins_Hospital/Input/Excel/Covid_patientdetails/covid_patient_details.xlsx</code></p></div></div><h3>The Permissions</h3><div><div><div><div><figure><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/access.png"/></figure></div></div></div><div><p>By now it was clear that this was pretty serious. There‚Äôs a bucket potentially containing some form of medical data,
with the contents listable by a leaked, now public set of IAM credentials.</p><p>I wanted to know if I <em>could</em> access them, so I inspected my assigned IAM permissions. I found that the key has
<code>AdministratorAccess</code>. <a href="https://github.com/SummitRoute/aws_managed_policies/blob/master/policies/AdministratorAccess" target="_blank">This policy</a>
gives <em>unrestricted</em> access to <strong>all IAM actions, on all services</strong>. It‚Äôs AWS‚Äôs ‚Äúgod mode‚Äù policy, and it‚Äôs <em>not</em> a good
idea to assign these to long-lived credentials issued to developers.</p></div></div><h3>The Takedown</h3><div><div><div><div><figure><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/takedown.png"/></figure></div></div></div><div><p>Meanwhile I received a ‚Äútakedown request‚Äù for a specific file in the pypi-data repository, specifically for the data
associated with the <a href="https://pypi.org/project/reaction-utils/" target="_blank">reaction-utils package</a>
. It seems that it‚Äôs a pretty
vanilla package which is still available on PyPi.</p><p>I expect, but I have no proof, that the same person who opened and immediately closed three merge requests in the
project (commenting ‚ÄúNa‚Äù and ‚ÄúAh‚Äù?) messed up again.</p></div></div><h3 id="the-cleanup">The Cleanup</h3><p>Ok, so at this point I was pretty concerned. For the life of me I could not find out how to contact them to report a
security issue like this. Endless forms, numbers and emails to <strong>buy</strong> security consultancy services, but none to <strong>report</strong>
security issues.</p><p>So far my exposure to Infosys has been someone who didn‚Äôt know how to use Github, spurting random nonsensical comments
and then deleting his account, then issuing a takedown notice for a completely random file in the repository. Meanwhile,
the key was <em>still</em> active and <em>still</em> had access to what appeared to be patient data.</p><p>To put it bluntly, I‚Äôm not sure I trusted Infosys to revoke this key in a timely manner. So I did it for them with
<code>aws iam delete-access-key --access-key-id=$AWS_ACCESS_KEY_ID</code>, and now the key is useless:</p><p><img src="https://tomforb.es/infosys-leaked-fulladminaccess-aws-keys-on-pypi-for-over-a-year/cleanup.png" alt=""/></p><p>Now this is a sketchy thing to do. One of the golden rules is to <em>not touch anything you find</em>: just document and report.
Except in this case the key had been public for over a year, there seemed to be sensitive data there and the key also
appeared to be a non-critical user key rather than a key for a system. I also didn‚Äôt really look into the account other
than the bucket and the policies, there could have been a lot of other data there that could be exfiltrated.</p><p>If there is sensitive data would it be better to not ‚Äúclose the door‚Äù and increase the exposure time, and thus the
risk that someone malicious gains access to the account? I opted to close the door ü§∑.</p><h3 id="the-conclusion">The Conclusion</h3><p>Infosys has a lot to say about security, but I‚Äôm not sure if they practice what they preach.</p><p>They appear to issue AWS keys to developers that are not rotated for several years as well as store these keys in git.
They also don‚Äôt have a clear place to report security issues like this.</p><p>Everything I‚Äôve seen has been pretty shocking in terms of security and completely against any form of best practices.</p></div></div></section></div>
  </body>
</html>
