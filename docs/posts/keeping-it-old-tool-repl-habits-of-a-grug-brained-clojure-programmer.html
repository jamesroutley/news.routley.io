<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.evalapply.org/posts/demo-clojure-workflow-scicloj/index.html">Original</a>
    <h1>Keeping it Old-Tool: REPL habits of a grug-brained Clojure programmer</h1>
    
    <div id="readability-page-1" class="page"><div id="the-very-top">
        
  <main id="main">
    <article id="blog-post">
  <header>
      <p>Keeping it Old-Tool: REPL habits of a grug-brained Clojure programmer</p>

      <p>
        <span>[ ↓ <a href="#blog-post-toc" rel="bookmark" target="_self">toc</a> ]</span>
        <span>Published: 2025-03-28</span>
        <span>Updated: 2025-03-28</span>
        
      </p>

      <p>
        Is demo of Grug Clojure code vibe. He no catch onto cloud LLM magics for some reason. Still prefer program with only brain-muscles. Prefer use Grug language standard library and standard dev tools. Prefer make and use all byte on local disk. Maybe luddite, maybe obsolete. Grug no mind. Fine with how he code. Besides, Grug like muscles. Hope maybe you see tip, trick, tactic to steal. Take what can use, no take what no can use.
      </p>
     
     
  </header>
  <hr/>
  <section>
      
<hr/>
  
<p>Presented at the SciCloj visual-tools meeting no. 32 (<a href="https://clojureverse.org/t/visual-tools-meeting-32-workflow-demos-6-old-school-tools-repl-emacs-org-mode-ai-mcp-more/11289">more at clojureverse</a>).</p>
<p>Mine is a complete contrast to the one by m&#39;friend, colleague, Clojure nerd, and all-round mensch, <a href="https://kapilreddy.me/">Kapil Reddy</a>.</p>
<ul>
<li>First, Kapil (begins at ~15m 50s): How he LLMs / MCPs with ClojureScript and Clojure.</li>
<li>Next, I (begins at ~46m 50s): Keeping it Old-Tool: REPL habits of a grug-brained Clojurist.</li>
</ul>
<figure>
  <iframe width="640" height="480" src="https://www.youtube.com/embed/oV9F9bmPr58?si=QU3cIBANcdmMlCGv" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>
  
</figure>


<p><strong>nb. Somewhat biased toward JVM Clojure, which I use.</strong></p>
<ul>
<li>Build a core muscle memory of manipulating the live Clojure runtime that does <em>not</em> depend on any editor or third-party tool.</li>
<li>Lean on the <a href="https://clojuredocs.org/core-library">Clojure standard library</a> as much as possible, especially for <a href="https://clojuredocs.org/quickref#namespaces">namespaces</a>, clojure.pprint, clojure.repl, clojure.reflect, clojure.datafy.</li>
<li>Prefer using the out-of-the-box <a href="https://clojure.org/guides/deps_and_cli">deps and cli</a> and <a href="https://clojure.org/guides/tools_build">build</a> tools, even though they pose a more effortful learning curve <a href="#fn1" target="_self" id="fnref1" role="doc-noteref"><sup>1</sup></a> than, say, Leiningen.</li>
<li>Compose a notebook <em>on top of</em> your workflow, like <a href="https://clerk.vision/">Clerk</a> or <a href="https://scicloj.github.io/clay/">Clay</a> or <a href="https://gorilla-repl.org/">Gorilla REPL</a>, or <a href="https://calva.io/notebooks/">Calva&#39;s Clojure Notebooks</a> feature. Or my all-time ultimate favourite, org-mode with org-babel.</li>
<li>Port and use this dynamic workflow to other (not-Clojure) contexts, e.g. orchestrating multiple LLMs using structured prompting techniques. For more about that see what m&#39;colleague Kapil is doing (same video), and listen to the discussion. That&#39;s above my pay grade.</li>
</ul>

<p>… which is just a plain old org-mode file that you will see being used to deliver the live-coded demo, which I&#39;ve rendered into this blog post.</p>
<h2 id="whoami">whoami</h2>
<ul>
<li>walking paradox of mechanical sympathy
<ul>
<li>rapidly becoming obsolete</li>
</ul></li>
<li>severely allergic to dependencies</li>
<li>half a slot of working memory
<ul>
<li><em>have</em> to write to think</li>
<li>unable to LLM, smol brain no handle big context <a href="#fn2" target="_self" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
</ul></li>
<li>&#34;Writing for nerds&#34; (on a hammock) &gt;&gt; &#34;Vibe coding for nerds&#34;</li>
</ul>
<h2 id="whereami">whereami</h2>
<ul>
<li><a href="https://www.evalapply.org/tags/clojure">evalapply.org/tags/clojure</a></li>
<li><a href="https://www.youtube.com/@evalapplydotorg">youtube.com/@evalapplydotorg</a></li>
<li><a href="https://www.github.com/adityaathalye">github.com/adityaathalye</a></li>
<li><a href="https://www.linkedin.com/in/adityaathalye">linkedin.com/in/adityaathalye</a></li>
</ul>
<h2 id="polyglot-notebook-ftw-sales-pitch-for-org-mode">Polyglot notebook FTW (sales pitch for org-mode :)</h2>
<div id="cb1" data-results="output"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>(<span>ns</span> user</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  (<span>:require</span> [ring.adapter.jetty <span>:as</span> jetty])</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  (<span>:gen-class</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> echo-handler </span>[request]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  {<span>:status</span> <span>200</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>   <span>:headers</span> {<span>&#34;Content-Type&#34;</span> <span>&#34;text/html;charset=utf-8&#34;</span>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>   <span>:body</span> (<span>pr-str</span> request)})</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> run-jetty</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  [port]</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  (<span>println</span> <span>&#34;Starting Jetty server at port:&#34;</span> port)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  (jetty/run-jetty echo-handler</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                   {<span>:port</span> port <span>:join</span>? <span>false</span>}))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> -main </span>[]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  (run-jetty <span>3000</span>))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>(<span>comment</span> <span>; &#34;&#39;Rich&#39; comment form&#34;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span>;; clojure -M -m org.evalapply.catchall-app</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span>;; OR:</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  (<span>def</span><span> server </span>(run-jetty <span>3001</span>))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  (.stop server)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>And check…</p>

<p>And pipeline…</p>
<div id="cb3" data-results="output"><pre><code><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span>curl</span> <span>-s</span> <span>&#34;localhost:3001&#34;</span> <span>|</span> <span>bb</span> <span>-e</span> <span>&#39;(-&gt; *input* :headers)&#39;</span></span></code></pre></div>
<div id="cb4"><pre><code><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(<span>require</span> &#39;[clj-http.client <span>:as</span> http])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>(http/get <span>&#34;http://localhost:3001&#34;</span>)</span></code></pre></div>
<div id="cb5"><pre><code><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(<span>require</span> <span>&#39;clojure.pprint</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<h2 id="inspect-live-object">Inspect live object</h2>
<div id="cb6" data-results="output"><pre><code><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(<span>-&gt;</span> server</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    clojure.reflect/reflect</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span>;; alt: cider pprint from edit buffer</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    clojure.pprint/pprint)</span></code></pre></div>
<h2 id="capture-values-to-inspect-them-at-will">Capture values to inspect them at will</h2>
<div id="cb7"><pre><code><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(<span>defonce</span><span> responses </span>(<span>atom</span> []))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> capture-response</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  [response]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  (<span>swap!</span> responses <span>conj</span> response))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>(add-tap capture-response)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>(tap&gt; {<span>:status</span> <span>200</span> <span>:body</span> <span>&#34;hi&#34;</span>})</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span>@responses</span></span></code></pre></div>
<p>Tabulate</p>
<div id="cb8" data-results="output"><pre><code><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(clojure.pprint/print-table [<span>:status</span> <span>:body</span>] <span>@responses</span>)</span></code></pre></div>
<p>Visual inspector</p>
<div id="cb9"><pre><code><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(<span>require</span> &#39;[clojure.inspector <span>:as</span> inspector])</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>(inspector/inspect-tree (clojure.reflect/reflect server))</span></code></pre></div>
<h2 id="try-out-dependencies">Try Out dependencies</h2>
<ul>
<li>Add without modifying deps.edn file</li>
<li>refactor echo-handler to handle json=true query parameter</li>
<li>copy down and replace body (dynamic REPL-driven dev.)</li>
</ul>
<div id="cb10"><pre><code><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(<span>require</span> <span>&#39;clojure.repl.deps</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>(clojure.<span>repl</span>.deps/add-libs</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a> {<span>&#39;org.clojure/data.json</span> {<span>:mvn/version</span> <span>&#34;2.5.1&#34;</span>}})</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>(<span>require</span> &#39;[clojure.data.json <span>:as</span> json])</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>(<span>defn</span><span> TODO-override-echo-handler </span>[])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>(<span>require</span> &#39;[clj-http.client <span>:as</span> http])</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>(<span>let</span> [base-uri <span>&#34;http://localhost:3001&#34;</span>]</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  (http/get (<span>str</span> base-uri <span>&#34;/foobar?json=true&#34;</span>)))</span></code></pre></div>


  </section>
  
</article>
  </main>
      
    </div></div>
  </body>
</html>
