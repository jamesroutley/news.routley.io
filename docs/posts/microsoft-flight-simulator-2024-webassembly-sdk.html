<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/WebAssembly.htm">Original</a>
    <h1>Microsoft Flight Simulator 2024: WebAssembly SDK</h1>
    
    <div id="readability-page-1" class="page"><div>
  <h2>WEBASSEMBLY (WASM)</h2>
  <p>In order to provide both security and portability, it was decided to move away from add-ons distributed as <code>DLL</code>s in favour of add-ons distributed as <a href="https://developer.mozilla.org/en-US/docs/WebAssembly"> <strong>WebAssembly modules</strong></a>. In order to do so without requiring a full rewrite of existing add-ons, a new platform toolset was designed for Visual Studio with the following capabilities:</p>
  <ul>
    <li>Direct compilation of C/C++ projects into WebAssembly (as <a href="#" data-popovertext="WASM is short for &#39;WebAssembly&#39; which is an open standard that defines a portable binary-code format for executable programs. It has a corresponding textual assembly language, as well as interfaces for facilitating interactions between such programs and their host environment." data-rhwidget="TextPopOver">WASM</a>).</li>
    <li>Debugging of WebAssembly modules by attaching to the game executable.</li>
    <li>Full support for the standard C library.</li>
    <li>Large support for the standard C++ library (see below).</li>
    <li><a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/GDI_Plus.htm">GDI+</a> wrapper based on the NanoVG API to facilitate porting existing add-ons.</li>
  </ul>
  
  <p>While WebAssembly itself is <a href="https://developer.mozilla.org/en-US/docs/WebAssembly" title="Mozilla WebAssembly Documentation">well documented</a>, there seems to be some confusion as to how WebAssembly modules can be run outside of a web environment. To clear a few misconceptions:</p>
  <ul>
    <li>The add-ons developed in WebAssembly for <span data-keyref="game_name">Microsoft Flight Simulator 2024</span> are not interpreted but rather converted to native code ahead of time (as DLLs).</li>
    <li>WebAssembly itself doesn&#39;t offer API &#34;X&#34;, &#34;Y&#34; or &#34;Z&#34; - it is up to its implementation to grant access to these APIs.</li>
  </ul>
  
  <p>You can also find a complete tutorial to get you started using WASM for your gauges on the following pages (including information on <strong>Debugging</strong>):</p>
  <ul>
    <li><a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Creating_A_WASM_Project.htm">Creating A WASM Project</a></li>
    <li><a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Creating_WASM_Gauges.htm">Creating WASM Gauges</a></li>
    <li><a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Creating_WASM_Systems.htm">Creating WASM Systems</a></li>
    <li><a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Creating_WASM_Airports.htm">Creating WASM Airports</a></li>
    <li><a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Debugging_WASM.htm">Debugging WASM Gauges</a></li>
  </ul>
  
  
  <h3 id="api">SDK APIs</h3>
  <p>The API&#39;s supplied with the SDK for use in Visual Studio are as follows:</p>
  <p><img alt="Location Of The MSFS.h File" src="https://docs.flightsimulator.com/msfs2024/html/assets/images/6_Programming/WASM/wasm_tutorial/msfs_h_location.png" title="Location Of The MSFS.h File"/></p>
  
  <ul>
    <li><code>MSFS.h</code> and <code>MSFS_Core.h</code> - These are the &#34;base&#34; files that should be included in all projects that are creating WASM gauges. You can find more information here: <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Core_And_Helpers.htm">Core And Helpers</a></li>
    <li><code>MSFS_AirportContext.h</code> - This is the &#34;base&#34; file that should be included in all projects that are wanting to support WebAssembly modules in airports.</li>
    <li><code>MSFS_CommBus.h</code> - This file corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Communication_API/Communication_API.htm">Communication API</a>.</li>
    <li><code>MSFS_Event.h</code> - This file corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Event_API/Event_API.htm">Event API</a>.</li>
    <li><code>MSFS_GaugeContext.h</code> - This is the &#34;base&#34; file that should be included in all projects that are creating WASM gauges using the <span data-keyref="game_name_short">MSFS 2024</span> callbacks.</li>
    <li><code>MSFS_IO.h</code> - This file corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/IO_API/IO_API.htm">IO API</a>.</li>
    <li><code>MSFS_MapView.h</code> - This corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/MapView_API/MapView_API.htm">MapView API</a>.</li>
    <li><code>MSFS_Network.h</code> - This corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Network_API/Network_API.htm">Network API</a>.</li>
    <li><code>MSFS_PlannedRoute.h</code> - This corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Planned_Route_API/Planned_Route_API.htm">Planned Route API</a>.</li>
    <li><code>MSFS_Render.h</code> - This corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Low_Level_API/NanoVG_API.htm">NanoVG API</a>.</li>
    <li><code>MSFS_Utils.h</code> - This is a small library of functions used by several API.</li>
    <li><code>MSFS_Vars.h</code> - This file corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Vars_API/Vars_API.htm">Vars API</a>.</li>
    <li><code>MSFS_Vector.h</code> - This is a small library of helper functions for vector maths.</li>
    <li><code>MSFS_Vfx.h</code> - This corresponds to the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/VFX_API/VFX_API.htm">VFX API</a>.</li>
    <li><code>MSFS_WindowsTypes.h</code> - This is a library of type definitions for that defines some types used by windows/rendering with their equivalent in WASM.</li>
    <li><code>Legacy/gauges.h</code> and <code>Legacy/gps_info.h</code> - These files are the main gauge API and they have multiple functions related to getting and setting data, rendering, etc... You can find full details here: <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Gauge_API/Gauge_API.htm">Gauge API</a> <span></span>.</li>
  </ul>
  
  
  <h3 id="module-upgrade">Upgrade a WebAssembly module from <span data-keyref="game_name_legacy_short">MSFS 2020</span> to <span data-keyref="game_name_short">MSFS 2024</span></h3>
  <p>Unlike <span data-keyref="game_name_legacy">Microsoft Flight Simulator 2020</span> where all WebAssembly modules were run on the main thread, <span data-keyref="game_name">Microsoft Flight Simulator 2024</span> runs WebAssembly modules on different threads (however, each module is still single threaded). Thanks to that improvement, the entire frame can be used to run updates, callbacks... which increases overall performance. Standalone modules will automatically benefit from this improvement, but gauge modules will <em>not</em> benefit from the entire feature without changes (see <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Creating_WASM_Gauges.htm">Creating WASM Gauges</a> for information). Things to note about the updated WASM modules are as follows:</p>
  
  <ul>
    <li>New <a data-xref="{text}" href="#modules">WebAssembly Modules Usage</a> are designed to be used the entire frame.</li>
  </ul>
  
  <ul>
    <li>The Gauge API has been deprecated and is now considered a <strong>legacy API</strong>, mainly because its architecture is not compatible with the <span data-keyref="game_name">Microsoft Flight Simulator 2024</span> simulation architecture anymore. However the features provided by this API are still available through the <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Vars_API/Vars_API.htm">Vars API</a> and <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Event_API/Event_API.htm">Event API</a>.</li>
  </ul>
  
  <ul>
    <li>Standalone modules now have an update callback to avoid having a SimConnect connection used only for this purpose.</li>
  </ul>
  
  <ul>
    <li><span data-keyref="game_name">Microsoft Flight Simulator 2024</span> streams a lot of content, including WebAssembly packages of all types. Because of this, dependency files (data, assets...) might not have been downloaded yet when referenced. If a WebAssembly module tries to read a file which has not been downloaded yet (using synchronous <code>libc</code> functions to read the file), the module will be &#34;paused&#34; for few frames until the file is ready to be used that in way. To avoid this behavior, we strongly advise you to use the new <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/IO_API/IO_API.htm">IO API</a> for read purposes.</li>
  </ul>
  
  <ul>
    <li>Some SimConnect functions will send a different structure than the one sent from <span data-keyref="game_name_legacy">Microsoft Flight Simulator 2020</span> (ie: members are the same but the size of some of them has been changed). Because of this change, some logic will need to be reviewed to be sure that every thing works correctly, especially if the module uses short static buffers with those functions. More information here: <a data-xref="{title}" href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/SimConnect/SimConnect_SDK.htm">SimConnect SDK</a>.</li>
  </ul>
  
  <ul>
    <li>A new library has been added - <code>MSFS_WasmVersions.a</code> - that must be linked with your WASM project for it to be detected as a <span data-keyref="game_name_short">MSFS 2024</span> module (SimConnect for instance). Without this, those features will behave as if they were from a <span data-keyref="game_name_legacy_short">MSFS 2020</span> module. If you are using the <span data-keyref="game_name">Microsoft Flight Simulator 2024</span> platform toolset to compile your WebAssembly module, then this library is linked automatically, otherwise you will have to integrate it into your pipeline yourself.</li>
  </ul>
  
  
  <h3 id="module-usage">WebAssembly Modules Usage</h3>
  <p>A WebAssembly module can be used by <span data-keyref="game_name">Microsoft Flight Simulator 2024</span> in different ways:</p>
  <ul>
    <li>As a <strong>standalone</strong> module if it is placed in the modules subfolder of a package - it is then automatically loaded when the package is mounted into the <a href="#" data-popovertext="A &#39;Virtual File System&#39; is programming that forms an interface between an operating system&#39;s kernel and a more concrete file system. The VFS serves as an abstraction layer that gives applications access to different types of file systems and local and network storage devices." data-rhwidget="TextPopOver">VFS</a>.</li>
    <li>As a <strong>gauge</strong> module which can contain one or more gauge callbacks, see <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Creating_WASM_Gauges.htm">Creating WASM Gauges</a>.</li>
    <li>As an <strong>airport</strong> module if it is linked to a scenery, in which case it will be automatically loaded (and unloaded) according to the scenery spawn and de-spawn.</li>
    <li>As a <strong>system</strong> module which can contain system callbacks, see <a href="https://docs.flightsimulator.com/msfs2024/html/6_Programming_APIs/WASM/Creating_WASM_Systems.htm">Creating WASM Systems</a>.</li>
  </ul>
  
  <p>In all cases the game will look for and execute the following module functions if they exist:</p>
  <ul>
    <li><code>extern &#34;C&#34; MSFS_CALLBACK void module_init(void)</code>: upon loading or after sign-in.</li>
    <li><code>extern &#34;C&#34; MSFS_CALLBACK void module_deinit(void)</code>: upon closing the game or after sign-out.</li>
  </ul>
  
  
  <h3>File Access</h3>
  <p>In order to access files from within an add-on, filenames can be prefixed in two ways:</p>
  <ul>
    <li>&#34; <code>.\</code>&#34;: to access the files from within the add-on package. This has a read-only access.</li>
    <li>&#34; <code>\work</code>&#34;: to access a persistent storage that the add-on can use. This is a read/write access.</li>
  </ul>
  
  <p>It is important to note that when publishing your packages to the <span data-keyref="game_name">Microsoft Flight Simulator 2024</span> Marketplace for PC (this does not apply for Xbox), an encryption system is applied to protect the package contents. This encryption system means that your WASM modules can no longer access certain files within the package, meaning the module will not be able to retrieve the information it requests. It is because of this that you should never rely on parsing the files listed below <span>when designing your code.</span></p>
  
  <p>For SimObjects, you shouldn&#39;t try to access any file that ends with the following:</p>
  <ul>
    <li><code>*engines.cfg</code></li>
    <li><code>*flight_model.cfg</code></li>
    <li><code>*systems.cfg</code></li>
    <li><code>*.xml</code></li>
    <li><code>*LOD0.bin</code></li>
    <li><code>*LOD0.gltf</code></li>
  </ul>
  
  <ul>
    <li><code>*aircraft.cfg</code></li>
    <li><code>*sim.cfg</code></li>
    <li><code>*LOD0.bin</code></li>
    <li><code>*LOD0.gltf</code></li>
    <li><code>*LOD00.bin</code></li>
    <li><code>*LOD00.gltf</code></li>
    <li><code>*.dds</code></li>
  </ul>
  
  <p>For scenery, you shouldn&#39;t try to access any files with the following extension:</p>
  <ul>
    <li><code>*.bgl</code></li>
  </ul>
  
  <p>If there is information within these files that is required by your WASM module, we advise you to copy this information to a different file that is known to remain un-encrypted (ie: a file that is not of the type listed above), and include that file with your package.</p>
  <p><span><strong>NOTE</strong>: This system may be reviewed, updated, and improved upon in future releases.</span></p>
  
  
  <h3 id="issues">Known Issues and Limitations</h3>
  <p>With the current releases of the game and SDK, the following limitations exist:</p>
  <ul>
    <li>The Windows API is not supported.</li>
    <li>C++ exceptions are not supported.</li>
    <li>C++ threads are not supported.</li>
    <li>The GDI+ wrapper is very incomplete.</li>
    <li>The WebAssembly module must be compiled in Debug mode for C/C++ code for symbols to be visible while debugging.</li>
  </ul>
  
  
  

</div></div>
  </body>
</html>
