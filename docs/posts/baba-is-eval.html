<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://fi-le.net/baba/">Original</a>
    <h1>Baba Is Eval</h1>
    
    <div id="readability-page-1" class="page">
 <div>
   <h3><a href="https://fi-le.net"><span>T</span>he Fiefdom of Files</a></h3> </div>
 <section>
   
   <p>3rd of July, 2025</p>

   <p>
    <video autoplay="" muted="" loop="" controls="" width="85%">
       <source src="https://fi-le.net/video/baba.mp4" type="video/mp4"/>
       Your browser does not support the video tag.
     </video>
    </p>
    <div>
    <div>
       <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" style="flex-shrink: 0;">
         <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
       </svg>
       <p><strong>
         <a href="https://github.com/lennart-finke/baba_is_eval" target="_blank" rel="noopener noreferrer">Repository</a>
       </strong>
     </p></div>

    </div>
     
    
    

   

   <p>
     <span>B</span>aba is You is a sokoban puzzle game where the rules themselves have to be manipulated to win. (For the uninitiated, the <a href="https://store.steampowered.com/app/736260/Baba_Is_You/" target="_blank" rel="noopener noreferrer">store page</a> should explain the idea best.) The level of abstraction required to solve most levels makes it a formidable reasoning benchmark, with many reasoning steps being completely orthogonal to other tasks out there. The game is turn-based, meaning the number of turns required to solve a level naturally serves as a more fine-grained metric beyond accuracy.
   </p>

   <p>
     This renders <i>Baba is You</i> quite similar to the proposed <a href="https://youtu.be/AT3Tfc3Um20?t=371" target="_blank" rel="noopener noreferrer">ARC-AGI-3 benchmark</a>, scheduled for release in 2026. Except it already exists! That is, however, also the main problem for using it as a serious benchmark: The solutions for the main game are out there in both text and image form. Luckily though, if that ends up being a problem, there is also a wealth of clever and high-quality levels, and even level packs with entirely new mechanics, created by players. Those mostly don&#39;t have a solution published online.
   </p>

   <p>
     Inspired by <a href="https://www.anthropic.com/research/visible-extended-thinking" target="_blank" rel="noopener noreferrer">Claude plays Pokémon</a> and the <a href="https://jackhopkins.github.io/factorio-learning-environment/" target="_blank" rel="noopener noreferrer">Factorio Learning Environment</a>, in this devlog we&#39;ll turn <i>Baba is You</i> into a demo version of <i>Baba is Eval</i>.
   </p>

   <h2>Desiderata</h2>

   <p>
     Be it Factorio or ARC-AGI, usually current multimodal models still do best with a text-representation of the 2D world. Screenshots are often less helpful. Therefore, we need to implement (1) fetching the game state into the language model context. Then, (2) the model should be able to control the level, which involves only the principal actions left, right, up, down, undo and reset. Ideally, this would be faster than a human takes to input. We&#39;ll also want (3) menu navigation to completely automate the state management.
   </p>

   <h3>Fetching Game State</h3>

   <p>
     Humans interact with the game visually, so the first thought might be to read it in via a vision model. In the case of <i>Baba is You</i> though, it pays off to look at the game files exposed to us. Opening the game files, we see the binary size itself is only 8MB. Quite a bit of game logic is implemented in plaintext Lua scripts, extending the base engine Multimedia Fusion 2. The game even defines hooks to be used by mods, which fire on events like &#34;level_start&#34;, which is perfect for us.
   </p>

   <p>
     Out of all exposed functions (<a href="https://github.com/PlasmaFlare/baba-modding-guide/blob/master/references/MF_documentation.txt" target="_blank" rel="noopener noreferrer">documentation</a>), we find two that allow I/O: <code>MF_read(storage(str), group(str), item(str)) -&gt; result(str)</code> and <code>MF_store(storage(str), group(str), item(str), value(str))</code>. These write to one of four predefined storage files (such as &#34;level&#34;), in an INI format with sections delineated by <code>[group]</code> followed with <code>key=value</code> pairs on each new line.
   </p>

   <p>
     To actually get the current game state, there luckily is a function <code>MF_getunits() -&gt; {fixed(int)}</code>. This returns a table of objects that, as inferred by other uses in the source code, can be deserialized with <code>mmf.newObject</code>, then yielding a Lua object table containing all the entities in a level. While the entities&#39; fields aren&#39;t accessible, through other instances in the code we can tell it has properties <code>UNITNAME</code>, <code>XPOS</code>, <code>YPOS</code>, <code>ZPOS</code>. We can now construct a table of all the elements in a level and put that in the context. We also need a way to signal when the game has been won, which can be recorded in the <code>level_won</code> mod hook.
   </p>

   <p>
     We set up a Python MCP server. It gets a tool to displays this information. On every state change, we serialize the table from Lua, then read it in on demand with <code>configparser</code> from Python. Because language models aren&#39;t that best at spacial reasoning from coordinates, we would want to print a grid with all the entities. We also need to find out the bounds of the level, which are conveniently already loaded in a global variable in Lua (<code>roomsizex</code>). For multiple entities on top of each other at the same X,Y-position, we print them in the same cell ordered by their Z value (&#34;z99&gt;z1&#34;). Although it matters in some levels, we ignore the direction of an object.
   </p>

   <p>
     Let&#39;s take a look at a small level to demonstrate, &#34;Lake-Extra 1: Submerged Ruins&#34;. If you like, you can assume the role of the LLM and come up with a solution, if you happen to know the game already. It&#39;s quite tricky, but possible, to solve it without trial and error. </p>
   

  <p>
     Calling the MCP tool returns:
   </p>
   

   <pre><code>y/x|    1    |   2   |    3    |   4   |   5    |  6  |  7  |  8  |  9  |  10 |    11   |    12   |     13    |   14   |  15
---+---------+-------+---------+-------+--------+-----+-----+-----+-----+-----+---------+---------+-----------+--------+-----
1  |         |       |         |       |        |     |     |     |wall |wall |wall     |wall     |wall       |wall    |wall
2  |         |       |         |baba   |        |     |     |     |rock |     |         |text_crab|text_flag  |        |wall
3  |         |       |text_baba|text_is|text_you|     |     |     |wall |     |         |wall     |text_is    |text_is |wall
4  |         |       |         |       |        |     |     |     |wall |     |         |wall     |text_defeat|text_win|wall
5  |         |       |         |       |wall    |wall |wall |wall |wall |     |         |wall     |wall       |wall    |wall
6  |         |       |         |       |wall    |     |     |     |wall |     |         |         |           |        |wall
7  |         |       |         |       |crab    |crab |flag |     |wall |     |text_rock|text_is  |text_push  |        |wall
8  |text_wall|text_is|text_stop|wall   |wall    |     |     |     |wall |     |         |         |           |        |wall</code></pre>

   <p>
     This looks like a surprisingly comfortable format to play the game even as a human, which is a good sign.
   </p>

   <h3>Control</h3>

   <p>
     We could simulate key presses, but that&#39;s a bit boring and slow, especially in comparison to a direct call from code. In <code>syntax.lua</code>, we find <code>command(key,player_)</code>, which gives access to the four movement directions and restart. There is also <code>undo()</code> in <code>undo.lua</code>.
   </p>

   <p>
     The problem is how to call these asynchronously. Maybe there is some way to define a new hook, but I found only the following ugly method. In the <code>always</code> mod hook, we attempt to open a new command Lua file, and execute its contents if it exists. From the server, we know what the Lua backend is looking for and asynchronously write to that file when the language model has decided on commands. This gives high latency of 50-150ms per list of commands read, but at least the commands themselves are executed nearly instantly one after the other, much faster than keypresses.
   </p>

   <p>
     Manually solving the level we looked at above, we find a solution <code>rrrrrrddddrrrrdldllluuuuurulllllllrrrrrrddddddrrruldlluuuuurullllllrrrrrrddddrdldluuuuurulllllullldlllllddlldluldddrruldlluurddddldrrrrrlluuurrrruurrrrllllllullld</code>, where each letter stands for left, right, up or down, giving 324 bits. Executing this via MCP, the result is:
   </p>

   <p>
     <video autoplay="" muted="" loop="" width="100%">
       <source src="https://fi-le.net/video/baba_solve.mp4" type="video/mp4"/>
       Your browser does not support the video tag.
     </video>
     </p>

   <p>
     Did you catch what happened? The screen capture frequency is not fast enough to get even a single in-between frame, but the game graphics themselves are even slower. Apparently the true position and current screen space position are interpolated to get the next frame, so for 12 frames or so we can see all entities move from their initial to the final position in a straight line.
   </p>

   <h3>Level Selection</h3>

   <p>
     This is a surprisingly hard part of the problem. The Lua-side code for level selection is sparse and complicated, so to save some development time and add a cool visual effect, we enter levels with the same input functionality to navigate on the map, then simulate two enter presses with <code>pyautogui</code>. This further uglifies the solution, especially because simulated inputs are seemingly quite unreliable.
   </p>

   <h3>The Language Model Client</h3>

   <p>
     We use Claude Desktop as the demo client, again mainly for visual effect. It feels so weird to have a consumer-facing app do things like this. We also get some basic tool call prompting (and context management?) for free, which is very helpful. We also implement a help function in the MCP so that the model can get an explanation for the game rules and keywords, in case it doesn&#39;t know.
   </p>

   <h2>Results</h2>

   <p>
     Claude 4 is pretty bad at this. It can reliably solve level 0, where the solution is inputting &#34;right&#34; 8 times. Beyond that though, it struggles with all component subtasks of even the first levels: Keeping track of the rules, identifying blocked paths, planning, getting input patterns correct, keeping track of the win condition, identifying a lost game, coming up with rules to try, identifying rules that need to be broken, et cetera. It&#39;s François Chollet&#39;s insight playing out live. This is why the video of Claude solving level 1 at the top was actually (<em>dramatic musical cue</em>) staged, and only possible via a move-for-move tutorial that Claude nicely rationalized post hoc.
   </p>

   <p>
     Reasoning models like o3 might be better equipped to come up with a plan, so a natural step would be to try switching to those, away from Claude Desktop. This would also enable more sophisticated context management, which is needed because for more complicated, larger levels the game states would start using too many tokens. A more dense representation of the game state, specifically for tokenizers instead of humans, e.g. with less whitespace, could also help. Finally, as with the Factorio Learning Environment, maybe the input space can be abstracted with, say, a <code>move_to()</code> tool. Only for some levels, like those containing <code>PULL</code> and <code>MOVE</code>, full control is really needed.
   </p>

   <p>
     <i>Baba is You</i> any% is still a while off. If you&#39;d like to keep an eye on the progress bar for it, and maybe try your hand at developing it, you can head over to the <a href="https://github.com/lennart-finke/baba_is_eval" target="_blank" rel="noopener noreferrer">repo</a> for this project. I anticipate that many readers will have ideas on how to do this much better than the above.
   </p>

 </section>
 <!-- Footer -->
 <div>
   <hr/> 
      <form action="footer.php" method="POST" target="dummy" onsubmit="document.getElementById(&#39;email&#39;).style.display = &#39;none&#39;; document.getElementById(&#39;emailButton&#39;).value = &#39;Submitted, thanks!&#39;">
      © 2021 - 2025 <a href="https://fi-le.net/">fi-le.net, 
      <span>t</span>he fiefdom of files</a> | <a href="https://fi-le.net/feed.xml">RSS</a> |
      Newsletter Signup: 
      
      </form> </div>
 


</div>
  </body>
</html>
