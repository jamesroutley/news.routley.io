<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sigh.dev/posts/ctrl-tinycolor-post-mortem/">Original</a>
    <h1>Tinycolor supply chain attack post-mortem</h1>
    
    <div id="readability-page-1" class="page"><div>  <h2 id="tldr"><a href="#tldr">TL;DR</a></h2>
<p>A malicious GitHub Actions workflow was pushed to a shared repo and exfiltrated a npm token with broad publish rights. The attacker then used that token to publish malicious versions of 20 packages, including <code>@ctrl/tinycolor</code>.</p>
<p>My GitHub account, the @ctrl/tinycolor repository were not directly compromised. There was no phishing involved, and no malicious packages were installed on my machine and I already use pnpm to avoid unapproved postinstall scripts. There was no pull request involved because a repo admin does not need a pull request to add new github actions.</p>
<p>GitHub/npm security responded quickly, unpublishing the malicious versions. I followed by releasing clean versions to flush caches, as advised.</p>
<p>For broader context, see <a href="https://socket.dev/blog/tinycolor-supply-chain-attack-affects-40-packages" rel="noreferrer noopener" target="_blank">Socket’s write-up</a> or <a href="https://www.stepsecurity.io/blog/ctrl-tinycolor-and-40-npm-packages-compromised" rel="noreferrer noopener" target="_blank">StepSecurity’s analysis</a>. For community discussion, see this <a href="https://news.ycombinator.com/item?id=45260741" rel="noreferrer noopener" target="_blank">Hacker News post</a>, which spent 24 hours on the front page. I’m also finding this <a href="https://www.wiz.io/blog/shai-hulud-npm-supply-chain-attack" rel="noreferrer noopener" target="_blank">wiz.io</a> post helpful.</p>
<h2 id="how-i-found-out"><a href="#how-i-found-out">How I Found Out</a></h2>
<p>On September 15 around 4:30
 PM PT, <a href="https://bsky.app/profile/notwes.bsky.social" rel="noreferrer noopener" target="_blank">Wes Todd</a> DM’d me on Bluesky and looped me into the OpenJS Foundation Slack. By that point, Wes had already alerted GitHub/npm security, who were compiling lists of affected packages and rapidly unpublishing compromised versions.</p>
<p>Early guidance (attributed to Daniel Pereira) was to look for suspicious <code>Shai-Hulud</code> repos or branches. I wasn’t able to find any of these repos or branches on my own personal repos. The mystery was: how was I impacted at all?</p>
<blockquote>
<p>Shai-Hulud was the Fremen term for the sandworm of Arrakis. - <a href="https://dune.fandom.com/wiki/Shai-Hulud" rel="noreferrer noopener" target="_blank">dune wiki</a></p>
</blockquote>
<h2 id="what-actually-happened"><a href="#what-actually-happened">What Actually Happened</a></h2>
<p>A while ago, I collaborated on <a href="https://github.com/angulartics/angulartics2" rel="noreferrer noopener" target="_blank">angulartics2</a>, a shared repository where multiple people still had admin rights. That repo still contained a GitHub Actions secret — a npm token with broad publish rights. This collaborator had access to projects with other people which I believe explains some of the other 40 initial packages that were affected.</p>
<p>A new Shai-Hulud branch was force pushed to angulartics2 with a malicious github action workflow by a collaborator. The workflow ran immediately on push (did not need review since the collaborator is an admin) and stole the npm token. With the stolen token, the attacker published malicious versions of 20 packages. Many of which are not widely used, however the @ctrl/tinycolor package is downloaded about 2 million times a week.</p>
<p>GitHub and npm security teams moved quickly to unpublish the malicious versions. I then re-published fresh, verified versions of the packages I maintain to flush caches and restore trust.</p>
<h2 id="impact"><a href="#impact">Impact</a></h2>
<p>Malicious versions of several packages — including @ctrl/tinycolor — were briefly available on npm before removal. Installing those compromised versions would have triggered a postinstall payload, which is documented in detail by <a href="https://www.stepsecurity.io/blog/ctrl-tinycolor-and-40-npm-packages-compromised#attack-mechanism" rel="noreferrer noopener" target="_blank">StepSecurity</a>.</p>
<p>What should you do if you’ve installed a compromised version of a package? <a href="https://www.stepsecurity.io/blog/ctrl-tinycolor-and-40-npm-packages-compromised#immediate-actions-required" rel="noreferrer noopener" target="_blank">see StepSecurity’s immediate actions</a>.</p>
<h2 id="publishing-setup--interim-plan"><a href="#publishing-setup--interim-plan">Publishing Setup &amp; Interim Plan</a></h2>
<p>I currently use <a href="https://github.com/semantic-release/semantic-release" rel="noreferrer noopener" target="_blank">semantic-release</a> with GitHub Actions to handle publishing. The automation is convenient and predictable. I also have npm provenance enabled on many packages, which provides attestations of how they were built. Unfortunately, provenance didn’t prevent this attack because the attacker had a valid token.</p>
<p>My goal is to move to npm’s <strong>Trusted Publishing (OIDC)</strong> to eliminate static tokens altogether. However, semantic-release integration is still in progress: <a href="https://github.com/npm/cli/issues/8525" rel="noreferrer noopener" target="_blank">npm/cli#8525</a>.</p>
<p><img alt="npm Publishing access settings" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 1618px) 1618px, 100vw" data-astro-image="constrained" width="1618" height="804" src="https://sigh.dev/_astro/publishing-access.DTmYbTkJ_Z2may3Q.webp" srcset="/_astro/publishing-access.DTmYbTkJ_1Fa49o.webp 640w, /_astro/publishing-access.DTmYbTkJ_Z22BseH.webp 750w, /_astro/publishing-access.DTmYbTkJ_Z27AVbY.webp 828w, /_astro/publishing-access.DTmYbTkJ_ZGtYiM.webp 1080w, /_astro/publishing-access.DTmYbTkJ_Z11X4ph.webp 1280w, /_astro/publishing-access.DTmYbTkJ_Z2may3Q.webp 1618w"/></p><p>For the forseeable future, @ctrl/tinycolor requires 2FA for publishing, and all tokens have been revoked. Not expecting to merge any new changes anytime soon.</p>
<p>For smaller packages, I’ll continue using semantic-release but under stricter controls: no new contributors will be added, and each repo will use a granular npm token limited to publish-only rights for that specific package.</p>
<p>Local 2FA based publishing isn’t sustainable, so I’m watching OIDC/Trusted Publishing closely and will adopt it as soon as it fits the workflow.</p>
<p>I plan to continue using pnpm that prevents unapproved postinstall scripts from being run and I’ll look into adding pnpm’s new <a href="https://pnpm.io/settings#minimumreleaseage" rel="noreferrer noopener" target="_blank">minimumReleaseAge</a> setting.</p>
<h2 id="publishing-wishlist"><a href="#publishing-wishlist">Publishing Wishlist</a></h2>
<p>If I could wave a magic wand and design my ideal setup, npm would allow me to require Trusted Publishing (OIDC) with a single toggle for all of my packages. That same toggle would block any release missing provenance, enforcing security at the account level. I’d also want first-class semantic-release support with OIDC and provenance so no static tokens are ever needed.</p>
<p>On top of that, I’d like a secure, human-approved publishing option directly in the GitHub UI: a protected workflow_dispatch flow that uses github 2FA approval to satisfy 2FA, without requiring me to publish from my laptop.</p>
<p>GitHub Environments — or equivalent workflow protections — should be available without a Pro subscription, or else integrated directly into Trusted Publishing so that security doesn’t depend on the pricing tier.</p>
<p>It would be really nice if NPM also had a more visible mark on the package details page to indicate if the package had a postinstall script. Also, once the packages are pulled its not clear what versions were removed and why.</p>
<h2 id="thanks"><a href="#thanks">Thanks</a></h2>
<p>Thanks to Wes Todd, the OpenJS Foundation, and the GitHub/npm security teams for their rapid and coordinated response. Everyone was incredibly fast, helpful, and knowledgeable.</p>
<p><img alt="dune worm [wide] | dune worm via chatgpt" loading="lazy" decoding="async" fetchpriority="auto" sizes="(min-width: 1536px) 1536px, 100vw" data-astro-image="constrained" width="1536" height="1024" src="https://sigh.dev/_astro/dune-worm.QN2JLFkT_ZOy594.webp" srcset="/_astro/dune-worm.QN2JLFkT_ZWljFi.webp 640w, /_astro/dune-worm.QN2JLFkT_Z24bQ0U.webp 750w, /_astro/dune-worm.QN2JLFkT_1CdkyI.webp 828w, /_astro/dune-worm.QN2JLFkT_1kRnJS.webp 1080w, /_astro/dune-worm.QN2JLFkT_Z1xwr04.webp 1280w, /_astro/dune-worm.QN2JLFkT_ZOy594.webp 1536w"/>  </p></div></div>
  </body>
</html>
