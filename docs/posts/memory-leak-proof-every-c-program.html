<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://flak.tedunangst.com/post/memory-leak-proof-every-C-program">Original</a>
    <h1>Memory leak proof every C program</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Memory leaks have plagued C programs for as long as the language has existed. Many solutions have been proposed, even going so far as to suggest we should rewrite C programs in other languages. But thereâ€™s a better way.</p><p>Presented here is a simple solution that will eliminate the memory leaks from every C program. Link this into your program, and memory leaks are a thing of the past.</p><details><summary>leakproof.c</summary><pre><code><span>#include &lt;dlfcn.h&gt;</span>
<span>#include &lt;stdio.h&gt;</span>

<span>struct</span> leaksaver <span>{</span>
        <span>struct</span> leaksaver <span>*</span>next;
        <span>void</span> <span>*</span>pointer;
<span>}</span> <span>*</span>bigbucket;

<span>void</span> <span>*</span>
malloc<span>(</span>size_t len<span>)</span>
<span>{</span>
        <span>static</span> <span>void</span> <span>*</span><span>(</span><span>*</span>nextmalloc<span>)</span><span>(</span>size_t<span>)</span>;
        nextmalloc <span>=</span> dlsym<span>(</span>RTLD_NEXT<span>,</span> <span>&#34;malloc&#34;</span><span>)</span>;
        <span>void</span> <span>*</span>ptr <span>=</span> nextmalloc<span>(</span>len<span>)</span>;
        <span>if</span> <span>(</span>ptr<span>)</span> <span>{</span>
                <span>struct</span> leaksaver <span>*</span>saver <span>=</span> nextmalloc<span>(</span>sizeof<span>(</span><span>*</span>saver<span>)</span><span>)</span>;
                saver<span>-&gt;</span>pointer <span>=</span> ptr;
                saver<span>-&gt;</span>next <span>=</span> bigbucket;
                bigbucket <span>=</span> saver;
        <span>}</span>
        <span>return</span> ptr;
<span>}</span></code></pre></details></div><div><p>
Posted 19 Jan 2024 16:55 by tedu Updated: 19 Jan 2024 16:55 
</p></div></div>
  </body>
</html>
