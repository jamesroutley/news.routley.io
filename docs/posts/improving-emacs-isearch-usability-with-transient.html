<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://yummymelon.com/devnull/improving-emacs-isearch-usability-with-transient.html">Original</a>
    <h1>Improving Emacs Isearch Usability with Transient</h1>
    
    <div id="readability-page-1" class="page"><div>
<p>Emacs incremental search (<strong>isearch</strong>) has an <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Incremental-Search.html">embarrassingly rich feature set</a>. That said, I rarely use <strong>isearch</strong> beyond its basics for the twofold reasons: </p>
<ul>
<li>There are many <strong>isearch</strong> commands that are difficult to discover, much less remember.</li>
<li>The default keybindings for said commands are <em>cursed</em>. (Seriously, <code>C-M-@</code> to call <code>isearch-query-replace-regexp</code> ?)</li>
</ul>
<p>However with the addition of the <a href="https://www.gnu.org/software/emacs/manual/html_mono/transient.html">Transient</a> package to Emacs 29.1, there is now recourse to work around these objections: when in <strong>isearch</strong> mode, we can make available an <strong>isearch</strong>-specific <strong>Transient</strong> menu. This post shows you how. </p>

<p>This is the use case I want solved:</p>
<p>When in basic <strong>isearch</strong>, I want to be able to use the function key (in this case <code>&lt;f2&gt;</code>) to invoke a <strong>Transient</strong> menu offering a set of <strong>isearch</strong>-specific commands. These commands would be grouped as follows:</p>
<ul>
<li>
<p>Edit commands on the search string/regexp</p>
<ul>
<li><code>isearch-edit-string</code></li>
<li><code>isearch-yank-word-or-char</code></li>
<li><code>isearch-yank-symbol-or-char</code></li>
<li><code>isearch-yank-line</code></li>
<li><code>isearch-yank-kill</code></li>
<li><code>isearch-forward-thing-at-point</code> (imho, this is an amazing odd-ball function)</li>
</ul>
</li>
<li>
<p>Replace commands (provided the buffer is not read-only)</p>
<ul>
<li><code>isearch-query-replace</code></li>
<li><code>isearch-query-replace-regexp</code></li>
</ul>
</li>
<li>
<p>Toggle commands</p>
<ul>
<li><code>isearch-toggle-regexp</code></li>
<li><code>isearch-toggle-symbol</code></li>
<li><code>isearch-toggle-word</code></li>
<li><code>isearch-toggle-case-fold</code></li>
<li><code>isearch-toggle-lax-whitespace</code></li>
</ul>
</li>
<li>
<p>Misc</p>
<ul>
<li><code>isearch-occur</code></li>
</ul>
</li>
</ul>
<p>While not all <strong>isearch</strong> commands are enumerated in this menu, this selection seems more than sufficient for my routine needs.</p>

<p>The following demo screenshots show this menu at work. First is a screenshot of Emacs in basic <strong>isearch</strong> mode, searching for the string “Screenshot 2”.</p>
<p><img src="http://yummymelon.com/devnull/images/improving-isearch/isearch-start.png" alt="Screenshot of Emacs with basic isearch."/></p>
<p>Pressing the <code>&lt;f2&gt;</code> button will activate the <strong>isearch</strong>-specific <strong>Transient</strong> menu shown below. The user can then select the next action by either a key press or mouse button (typically 1) press.</p>
<p><img src="http://yummymelon.com/devnull/images/improving-isearch/isearch-transient-menu.png" alt="Screenshot of Emacs isearch Transient menu."/></p>

<p>The following <a href="https://github.com/kickingvegas/cclisp/blob/a4c7bacbd35c6ef665a90fa0a3989233598d9e07/cc-isearch-menu.el" title="source on GitHub">source</a> shows the implementation of the workflow above, patterned after the examples shown in <a href="https://github.com/positron-solutions/transient-showcase/blob/master/README.org">Transient Showcase</a>.</p>
<div><table><tbody><tr><td><div><pre><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span>
<span>19</span>
<span>20</span>
<span>21</span>
<span>22</span>
<span>23</span>
<span>24</span>
<span>25</span>
<span>26</span>
<span>27</span>
<span>28</span>
<span>29</span>
<span>30</span>
<span>31</span>
<span>32</span>
<span>33</span>
<span>34</span>
<span>35</span>
<span>36</span>
<span>37</span>
<span>38</span>
<span>39</span>
<span>40</span>
<span>41</span>
<span>42</span>
<span>43</span>
<span>44</span>
<span>45</span>
<span>46</span>
<span>47</span>
<span>48</span>
<span>49</span>
<span>50</span>
<span>51</span>
<span>52</span>
<span>53</span>
<span>54</span>
<span>55</span>
<span>56</span>
<span>57</span>
<span>58</span>
<span>59</span>
<span>60</span>
<span>61</span>
<span>62</span>
<span>63</span>
<span>64</span>
<span>65</span>
<span>66</span>
<span>67</span>
<span>68</span>
<span>69</span>
<span>70</span>
<span>71</span></pre></div></td><td><div><pre><span></span><code><span>(</span><span>require</span><span> </span><span>&#39;transient</span><span>)</span>

<span>(</span><span>transient-define-prefix</span><span> </span><span>cc/isearch-menu</span><span> </span><span>()</span>
<span>  </span><span>&#34;isearch Menu&#34;</span>
<span>  </span><span>[[</span><span>&#34;Edit Search String&#34;</span>
<span>    </span><span>(</span><span>&#34;e&#34;</span>
<span>     </span><span>&#34;Edit the search string (recursive)&#34;</span>
<span>     </span><span>isearch-edit-string</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;w&#34;</span>
<span>     </span><span>&#34;Pull next word or character word from buffer&#34;</span>
<span>     </span><span>isearch-yank-word-or-char</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;s&#34;</span>
<span>     </span><span>&#34;Pull next symbol or character from buffer&#34;</span>
<span>     </span><span>isearch-yank-symbol-or-char</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;l&#34;</span>
<span>     </span><span>&#34;Pull rest of line from buffer&#34;</span>
<span>     </span><span>isearch-yank-line</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;y&#34;</span>
<span>     </span><span>&#34;Pull string from kill ring&#34;</span>
<span>     </span><span>isearch-yank-kill</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;t&#34;</span>
<span>     </span><span>&#34;Pull thing from buffer&#34;</span>
<span>     </span><span>isearch-forward-thing-at-point</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)]</span>

<span>   </span><span>[</span><span>&#34;Replace&#34;</span>
<span>    </span><span>(</span><span>&#34;q&#34;</span>
<span>     </span><span>&#34;Start ‘query-replace’&#34;</span>
<span>     </span><span>isearch-query-replace</span>
<span>     </span><span>:if-nil</span><span> </span><span>buffer-read-only</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;x&#34;</span>
<span>     </span><span>&#34;Start ‘query-replace-regexp’&#34;</span>
<span>     </span><span>isearch-query-replace-regexp</span>
<span>     </span><span>:if-nil</span><span> </span><span>buffer-read-only</span><span>     </span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)]]</span>

<span>  </span><span>[[</span><span>&#34;Toggle&#34;</span>
<span>    </span><span>(</span><span>&#34;X&#34;</span>
<span>     </span><span>&#34;Toggle regexp searching&#34;</span>
<span>     </span><span>isearch-toggle-regexp</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;S&#34;</span>
<span>     </span><span>&#34;Toggle symbol searching&#34;</span>
<span>     </span><span>isearch-toggle-symbol</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;W&#34;</span>
<span>     </span><span>&#34;Toggle word searching&#34;</span>
<span>     </span><span>isearch-toggle-word</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;F&#34;</span>
<span>     </span><span>&#34;Toggle case fold&#34;</span>
<span>     </span><span>isearch-toggle-case-fold</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)</span>
<span>    </span><span>(</span><span>&#34;L&#34;</span>
<span>     </span><span>&#34;Toggle lax whitespace&#34;</span>
<span>     </span><span>isearch-toggle-lax-whitespace</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)]</span>

<span>   </span><span>[</span><span>&#34;Misc&#34;</span>
<span>    </span><span>(</span><span>&#34;o&#34;</span>
<span>     </span><span>&#34;occur&#34;</span>
<span>     </span><span>isearch-occur</span>
<span>     </span><span>:transient</span><span> </span><span>nil</span><span>)]])</span>

<span>(</span><span>define-key</span><span> </span><span>isearch-mode-map</span><span> </span><span>(</span><span>kbd</span><span> </span><span>&#34;&lt;f2&gt;&#34;</span><span>)</span><span> </span><span>&#39;cc/isearch-menu</span><span>)</span>
</code></pre></div></td></tr></tbody></table></div>

<p>Verified in Emacs 29.1</p>

<p>Since implementing this <strong>Transient</strong> menu, <strong>isearch</strong> has become my primary interface to <code>query-replace</code> and <code>query-replace-regexp</code>. Also the ability to yank different object types and toggle different search behavior as I go along has been revelatory. Despite that fact that these features have always been there, their discoverability and keybindings have made them all but unusable to me. With <strong>Transient</strong> these features are finally made <em>usable</em>. </p>
<p>While the inclusion of <strong>Transient</strong> in Emacs 29.1 is relatively recent, the potential to revisit older Emacs workflows with this new capability seems to be a green field. I look forward to seeing what others do with <strong>Transient</strong>.</p>

<ul>
<li><a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Incremental-Search.html">Incremental Search (GNU Emacs Manual)</a></li>
<li><a href="https://www.gnu.org/software/emacs/manual/html_mono/transient.html">Transient User and Developer Manual</a></li>
<li><a href="https://github.com/positron-solutions/transient-showcase/blob/master/README.org">transient-showcase/README.org at master · positron-solutions/transient-showcase</a></li>
</ul>
<p>
 <a href="http://yummymelon.com/devnull/tag/emacs.html">emacs</a>
</p>
 
</div></div>
  </body>
</html>
