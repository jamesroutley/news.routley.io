<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://jamiepalatnik.com/day-47-three-paths-home/">Original</a>
    <h1>Day 47: Three Paths Home</h1>
    
    <div id="readability-page-1" class="page"><article>
    
    <abbr>12 Dec 2016</abbr>
    <p>Robert Vanderbei has written a <a href="http://orfe.princeton.edu/~rvdb/tex/sunset/ms.pdf">beautiful</a> <a href="http://orfe.princeton.edu/~rvdb/tex/sunset/34-39.OPN.1108twoup.pdf">series</a> of <a href="http://orfe.princeton.edu/~rvdb/tex/sunset/sunset.pdf">articles</a> and <a href="http://orfe.princeton.edu/u/rvdb/tex/talks/sunset/sunsetTalk_RutgersREU_small.pdf">talks</a> about a method for finding the radius of the earth based on a single photograph of a sunset over a large, calm lake.</p>

<p>Vanderbei’s analysis is an elegant and subtle exercise in classical trigonometry. In this post, I would like to present an alternative analysis in a different language: Geometric Algebra. I believe that geometric algebra is a more powerful system for formulating and solving trigonometry problems than the classical “lengths and angles” approach, and it deserves to be better known. Vanderbei’s sunset problem is simple to understand and challenging to solve, so it makes a nice benchmark.</p>

<p>Here’s Vanderbei’s sunset problem. If the earth was flat, photographs of the sun setting over water would look like this:</p>

<p><img alt="Flat earth sunset diagram" src="https://www.shapeoperator.com/img/sunset-flat.png"/>
</p>

<p>Notice that the reflection dips just as far below the horizon as the sun peaks above it.</p>

<p>Actual photographs of the sun setting over calm water (<a href="http://www.princeton.edu/~rvdb/Sunset-crop-lossless.jpg">like Vanderbei’s</a><label for="photo-skepticism"><sup>⊕</sup></label><span>Update: I should have been more careful to note that most photographs of sunsets over water actually don’t look like Vanderbei’s photograph (or my diagram) because of waves and atmospheric effects, and that sensor saturation artifacts make it hard to interpret images like this. Reproducing Vanderbei’s image may be somewhere between hard and impossible. <a href="#skepticism">More Below</a>.</span>) look more like this:</p>

<p><img alt="Round earth sunset diagram" src="https://www.shapeoperator.com/img/sunset-round.png"/>
</p>

<!--more-->

<p>Notice the shortened reflection. This happens because of the curvature of the earth, and by measuring the size of this effect, it is possible to infer the ratio of the earth’s radius to the camera’s height above the water<label for="Al-Biruni"><sup>⊕</sup></label><span>The main virtue of Vanderbei’s method is that the evidence is so directly visual (and that you can collect it with a smart phone on vacation). If you want to make a simpler and better measurement with a similar flavor, <a href="https://en.wikipedia.org/wiki/History_of_geodesy#Al-Biruni">climb a mountain and use an astrolabe</a>; the math is simpler and the measurement will be more accurate.</span>.</p>

<p>Vanderbei calls the angle of the sun above the horizon <span>\alpha</span>, and the angle of the sun’s reflection below the horizon <span>\beta</span>. With geometric algebra at our disposal, it’s often algebraically simpler to work with unit directions than angles, so I will also label unit directions from the camera to the top of the sun, <span>s</span>, the horizon, <span>t</span>, and the bottom of the sun’s reflection from the water, <span>w</span>.</p>

<p><img alt="Labeled round earth sunset diagram" src="https://www.shapeoperator.com/img/sunset-round-labeled.png"/>
</p>

<p>To analyze this problem, it’s helpful to consider a side view:</p>

<p><img alt="Side view sunset diagram" src="https://www.shapeoperator.com/img/sunset-side-view.png"/>
</p>

<p>There are two important triangles in this diagram: the triangle formed by the center of the earth, the camera, and the horizon (drawn in red), and the triangle formed by the center of the earth, the camera, and the reflection point where the top of the sun reflects off the water (drawn in green).</p>

<h4 id="the-triangle-equations">The triangle equations</h4>

<p>Triangles have a very simple algebraic representation in terms of vectors<label for="notation"><sup>⊕</sup></label><span>In this post, I am following the common geometric algebra convention of writing vectors as plain, lower-case letters, and using Greek letters for scalars. This takes a little getting used to if you are accustomed to bold face or over-arrows for vectors, but skipping all the decorations makes it simpler to work with lots of vectors.</span>:</p>

<p>
  \begin{aligned}
  r_1 - d_1 = p \\
  r_2 - d_2 = p
  \end{aligned}
</p>

<p>These simple sums of vectors subsume all the information about the relationships of lengths and angles that is expressed in classical trigonometry through “soh-cah-toa”, the triangle postulate (sum of interior angles is 180 degrees), the Pythagorean theorem, and the laws of cosines and sines. Quite an improvement.</p>

<p>It will be useful to re-express <span>d_1</span> and <span>d_2</span> in terms of the unit directions defined previously in order to relate other vectors to known directions:</p>

<p><span>(1a)</span></p>
<p>r_1 - |d_1|t = p</p>

<p><span>(1b)</span></p>
<p>r_2 - |d_2|w = p</p>

<p>In other words, <span>d_1</span> is directed toward the horizon, and <span>d_2</span> is directed toward the bottom of the reflection from the water.</p>

<p>Besides these triangles, there are a few salient geometric facts:</p>

<h4 id="the-horizon-condition">The horizon condition</h4>

<p>The line of sight to the horizon is tangent to the earth at the horizon, and is therefore perpendicular to the radius of the earth through the horizon.</p>

<p><span>(2)</span></p>
<p>r_1 \cdot d_1 = r_1 \cdot t = 0</p>

<h4 id="the-reflection-condition">The reflection condition</h4>

<p>In terms of angles, this is expressed as “angle of incidence equals angle of reflection”. In terms of vectors, it can be restated as</p>

<p>r_2 \cdot s = - r_2 \cdot w</p>

<p>or</p>

<p><span>(3)</span></p>
<p>r_2 \cdot (s + w) = 0</p>

<h4 id="known-lengths">Known lengths</h4>

<p>We know the lengths of some of these vectors in terms of the earth’s radius, <span>\rho</span>, and the height of the camera above the shoreline, <span>\delta</span>,</p>

<p><span>(4a)</span></p>
<p>r_1^2 = r_2^2 = \rho^2</p>

<p><span>(4b)</span></p>
<p>p^2 = (\rho + \delta)^2</p>

<p><span>(4c)</span></p>
<p>s^2 = w^2 = t^2 = 1</p>

<p>Squaring both sides of the first triangle equation (1a), and using the horizon condition (2) (or equivalently, using the Pythagorean theorem) also allows finding the length of <span>d_1</span>:</p>

<p><span>(4d)</span></p>
<p>d_1^2 = p^2 - r_1^2 = (\rho + \delta)^2 - \rho^2</p>

<p>Equations (1-4) contain all of the geometrical information<label for="distant-sun"><sup>⊕</sup></label><span>I assumed one other important piece of geometrical information by writting “s” in two places on the side-view diagram. This corresponds to the (excellent) approximation that the sun is very far away compared to other lengths.</span> needed to solve algebraically for the Earth’s radius, <span>\rho</span>, in terms of the given angles/directions (<span>\alpha</span> and <span>\beta</span>, or <span>s</span>, <span>w</span>, and <span>t</span>) and the height of the camera above the shoreline, <span>\delta</span>.</p>

<h3 id="introducing-geometric-algebra">Introducing Geometric Algebra</h3>

<p>So far, I have formulated everything in terms of vector algebra that should look familiar to students of physics or engineering (Gibbs vector algebra). To actually solve the equations, I will use a few additional notions from geometric algebra.</p>

<p>Geometric algebra is the answer to the question “what if I could multiply and divide by vectors?” It introduces a new associative (but non-commutative) invertible product between vectors: the geometric product. The geometric product between vectors <span>a</span> and <span>b</span> is simply written <span>ab</span>. The geometric product of a vector with itself equals a scalar (the square of the length of the vector),</p>

<p>aa = a^2 = |a|^2</p>

<p>This fact, combined with associativity and the other familiar rules for multiplication, is enough to define the geometric product uniquely.</p>

<p>The symmetric and anti-symmetric parts of the geometric product have important geometric meaning, and are traditionally given their own special symbols<label for="commutation"><sup>⊕</sup></label><span>Physicists may be mystified to realize that, based on this definition of the geometric product, parallel vectors commute, and perpendicular vectors <em>anti</em>-commute. What else does that remind you of?</span>:</p>

<p>
  \begin{aligned}
  (ab + ba)/2 &amp; = a \cdot b  = b \cdot a \\
  (ab - ba)/2 &amp; = a \wedge b = - b \wedge a
  \end{aligned}
</p>

<p>I will assume that the dot product, <span>a \cdot b</span>, is familiar: it is related to the projection of one vector onto another, and proportional to the cosine of the angle between them.</p>

<p>The wedge product, <span>a \wedge b</span>, is probably only familiar if you have studied differential forms (or geometric algebra, of course), but it is very similar to the more familiar cross product, <span>a \times b</span>. It represents the directed area of the parallelogram spanned by two vectors, and is proportional to the sine of the angle between them<label for="wedge-product"><sup>⊕</sup></label><span>Anti-symmetry and bi-linearity are exactly what is needed to represent area: a vector spans no area with itself (anti-symmetry), and the area of a parallelogram scales linearly with the lengths of each of its legs (bi-linearity).</span>. Whereas the cross product represents directed area by a vector orthogonal to the area (a trick that works only in 3 dimensions), the wedge product represents a directed area by a different kind of object called a &#34;bivector.&#34; The wedge product is associative (like the geometric product, but unlike the cross or dot products), and the wedge product of more than two vectors builds objects of higher &#34;grades.&#34; The wedge product between 3 vectors is a trivector representing a directed volume (of the parallelepiped spanned by them), and the wedge product between k different vectors is a k-vector representing a directed k-dimensional volume (which is always zero in spaces of dimension less than k).</p>

<p>We can turn these definitions around to write the geometric product in terms of the dot and wedge products,</p>

<p>ab = a \cdot b + a \wedge b = \left\langle a b \right\rangle_0 + \left\langle a b \right\rangle_2</p>

<p>where <span>\left\langle a b \right\rangle_0</span> and <span>\left\langle a b \right\rangle_2</span> are notations for “the scalar part” and “the bivector part”.</p>

<p>There is a strange thing about this object: it represents the sum of two different “kinds of things,” a scalar and a bivector. But this should be no more troubling than the fact that a complex number represents the sum of a “real number” and an “imaginary number,” (in fact, there is an extremely close relationship between complex numbers and the geometric product of two vectors). With experience, it becomes clear that a sum of a scalar and a bivector is exactly what is needed to represent the product of two vectors in an associative, invertible way.</p>

<p>The geometric product gives us two new super powers when working with vector equations:</p>

<h4 id="solving-equations-involving-products-of-vectors">Solving equations involving products of vectors.</h4>

<p>Given an equation for two different products of vectors</p>

<p>ab = cd</p>

<p>if <span>b</span> is known, we can solve for <span>a</span> by right-multiplying by <span>b^{-1}</span> (i.e. dividing by <span>b</span>).</p>

<p>a = cdb^{-1}</p>

<p><span>b^{-1}</span> is well-defined by demanding</p>

<p>bb^{-1} = 1</p>

<p>left-multiplying by <span>b</span></p>

<p>b^2 b^{-1} = b</p>

<p>and dividing through by the scalar <span>b^2</span></p>

<p>b^{-1} = \frac{b}{b^2}</p>

<p>Contrast this to the dot product and the cross/wedge product. In general, even when <span>b</span> is known, it is not possible to uniquely solve any one of the following equations for <span>a</span>.</p>

<p>
  \begin{aligned}
  a \cdot b &amp; = c \cdot d \\
  a \wedge b &amp; = c \wedge d \\
  a \times b &amp; = c \times d
  \end{aligned}
</p>

<p>The first equation only determines the part of <span>a</span> that is parallel to <span>b</span>, and the second two equations only determine the part of <span>a</span> that is perpendicular to <span>b</span>. You need both of these to solve for all of <span>a</span>, and that’s what the single geometric product gives you.</p>

<h4 id="transitive-relationships-between-vectors">Transitive relationships between vectors</h4>

<p>It frequently occurs that we know the relationships of two vectors <span>a</span> and <span>b</span> to a third vector <span>c</span>, and we would like to use this information to determine the relationship between <span>a</span> and <span>b</span>. Algebraically, we can take the unknown product</p>

<p>ab</p>

<p>and insert the identity</p>

<p>cc^{-1} = \frac{cc}{|c|^2} = 1</p>

<p>between the factors and re-associate</p>

<p>ab = a \left(cc^{-1}\right) b = \left(a c\right) \left(c^{-1} b\right) = \frac{1}{|c|^2}(ac)(cb)</p>

<p>thus re-expressing the unknown product <span>ab</span> in terms of the known products products <span>ac</span> and <span>cb</span>.</p>

<p>Because <span>cc^{-1} = 1</span>, we can insert it anywhere that it’s convenient in any product of vectors. This has the same practical effect as resolving vectors into parts parallel and perpendicular to c. This is an example of a very general technique that shows up in many forms throughout mathematics: inserting an identity to resolve a product into simpler pieces.</p>

<p>We will use this trick twice below at a critical moment in solving the sunset problem.</p>

<h3 id="reformulating-the-horizon-and-reflection-conditions">Reformulating the horizon and reflection conditions</h3>

<p>In order to make efficient use of geometric algebra’s tools, it is useful to reformulate equations (2) and (3) (the horizon and  reflection conditions) in terms of the geometric product instead of the dot product.</p>

<h4 id="horizon-condition">Horizon condition</h4>

<p>Consider the geometric product</p>

<p>r_1 t = r_1 \cdot t + r_1 \wedge t = r_1 \wedge t</p>

<p>where the first equality is an expression of the general vector identity <span>ab = a \cdot b + a \wedge b</span>, and the second equality follows from <span>r_1 \cdot t = 0</span>, our previous form of the horizon condition (2).</p>

<p>In two dimensions, there is only one unit bivector, called <span>I</span>, spanned by any two orthogonal unit vectors <span>e_1</span> and <span>e_2</span>:</p>

<p>e_1 \wedge e_2 = e_1 e_2 = I</p>

<p>Therefore <span>r_1 \wedge t</span> is proportional to <span>I</span>, and since <span>r_1</span> and <span>t</span> are orthogonal, we can write</p>

<p><span>(2’)</span></p>
<p>r_1 t = r_1 \wedge t = |r_1||t|I = |r_1|I = \rho I</p>

<h4 id="reflection-condition">Reflection Condition</h4>

<p>Our previous version of the reflection condition (3) also has the form of an orthogonality condition:</p>

<p>r_2 \cdot (s + w) = 0</p>

<p>so, similarly to the way we rewrote the horizon condition, we can rewrite this in terms of the geometric product as <label for="reflections"><sup>⊕</sup></label><span>There’s another way to write reflections in geometric algebra that shows up more commonly: <span>r_2 s = - w r_2</span> or <span>s = - r_2^{-1} w r_2 = - r_2 w r_2^{-1} </span>.</span></p>

<p>r_2 (s + w) = |r_2| |s + w| I</p>

<p>It will simplify later algebra to define a new unit vector based on this equation:</p>

<p>
  g \equiv \frac{ s + w }{|s + w|}
</p>

<p>g^2 = 1</p>

<p>so that the reflection condition becomes</p>

<p><span>(3’)</span></p>
<p>r_2 g = |r_2| |g| I = |r_2| I = \rho I</p>

<h3 id="solving-for-the-earths-radius">Solving for the Earth’s radius</h3>

<p>Now that we have rewritten our main geometric conditions in terms of the geometric product instead of the dot product, we are ready to solve the triangle equations.</p>

<p>First, eliminate <span>p</span> and set the left hand sides of (1a) and (1b) equal to one another<label for="quadrilateral-equation"><sup>⊕</sup></label><span>This equation involving a sum of four vectors is a “quadrilateral equation” in exactly the same sense as our earlier triangle equations: it expresses the fact that the red vectors and green vectors in our diagram form a quadrilateral.</span>:</p>

<p>r_1 - |d_1| t = r_2 - |d_2| w</p>

<p>The magnitude <span>|d_2|</span> is unknown, so we could proceed by solving for it, but it is more efficient to simply eliminate it in the following way. First, multiply both sides of the equation on the right by <span>w</span>:</p>

<p>r_1 w - |d_1| t w = r_2 w - |d_2| w^2</p>

<p>Now we can use “grade separation” to separately consider the scalar and bivector parts of this equation. Since <span>w^2</span> is a scalar, the <span>|d_2|</span> dependence drops out of the bivector part:</p>

<p>\left\langle r_1 w - |d_1| t w \right\rangle_2 = \left\langle r_2 w \right\rangle_2</p>

<p>Rearranging to isolate the <span>|d_1|</span> term gives</p>

<p>|d_1| \left\langle t w \right\rangle_2 = \left\langle r_1 w - r_2 w \right\rangle_2</p>

<p>We can now take advantage of the horizon and reflection conditions to rewrite the unknown products <span> r_1 w</span> and <span>r_2 w</span> in terms of known products by inserting factors of <span>t t = 1</span> and <span>g g = 1</span> and re-associating (this is the second “super power” from the introduction above):</p>

<p>|d_1|\left\langle t w \right\rangle_2 = \left\langle r_1 t t w -  r_2 g g w \right\rangle_2</p>

<p>We can simplify both <span>r_1 t</span> and <span>r_2 g</span> to <span>\rho I</span> using the horizon (2’) and reflection (3’) conditions:</p>

<p>|d_1| \left\langle t w \right\rangle_2 = \rho \left\langle I t w - I g w \right\rangle_2</p>

<p>Now expanding the geometric products of vectors into dot and wedge product gives</p>

<p>|d_1| t \wedge w = \rho I (g \cdot w - t \cdot w)</p>

<p>where I have dropped terms like <span>\left\langle t \cdot w\right\rangle_2 = 0</span> and <span>\left\langle I (t \wedge w - g \wedge w)\right\rangle_2 = 0</span> because they contain no part with grade 2.</p>

<p>We can take advantage of the known length <span>|d_1|^2</span> derived as (4d) by taking the magnitude squared of both sides:</p>

<p>
  \begin{aligned}
  |d_1|^2 |t \wedge w|^2 &amp; = \rho^2 \left(g \cdot w - t \cdot w\right)^2 \\
  |d_1|^2 &amp; = \rho^2 \left[ \frac{\left(g \cdot w - t \cdot w\right)^2}{|t \wedge w|^2}\right]
  \end{aligned}
</p>

<p>To simplify further algebra, for the term in brackets, introduce</p>

<p>\epsilon^2 \equiv \frac{(g \cdot w - t \cdot w)^2}{|t \wedge w|^2}</p>

<p>which is written entirely in terms of known products of directions. This gives</p>

<p>|d_1|^2 = \rho^2 \epsilon^2</p>

<p>Now substituting from (4d) for <span>|d_1|^2</span> gives</p>

<p>(\rho + \delta)^2 - \rho^2 = \rho^2 \epsilon^2</p>

<p>and dividing through by <span>\rho^2</span> gives</p>

<p>\left(1 + \frac{\delta}{\rho}\right)^2 - 1 = \epsilon^2</p>

<p>and finally, we are able to solve for <span>\rho</span>, the radius of the earth<label for="positive-root"><sup>⊕</sup></label><span>I (and Vanderbei) have chosen a positive square root here. What, if anything, does the negative square root represent?</span></p>

<p><span>(5)</span></p>
<p>\rho = \frac{\delta}{\sqrt{1 + \epsilon^2} - 1}</p>

<p>We can recover Vanderbei’s final answer by rewriting <span>\epsilon^2</span> in terms of angles using the following relationships:</p>

<p>
  \begin{aligned}
    t \cdot w &amp; = \cos(\beta) \\
    t \wedge w &amp; = \sin(\beta) I \\
    g \cdot w &amp; = \cos(\gamma) = \cos\left(\frac{\alpha + \beta}{2}\right)
  \end{aligned}
</p>

<p>so</p>

<p><span>
\epsilon^2 = \frac{\left(\cos(\gamma) - \cos(\beta)\right)^2}{\sin(\beta)^2}
</span></p>

<p>From this and (5), it is a simple exercise in trigonometric identities to recover the form given on slide 28 in <a href="http://orfe.princeton.edu/u/rvdb/tex/talks/sunset/sunsetTalk_RutgersREU_small.pdf">Vanderbei’s talk</a>, but there are two better forms that I will show instead.</p>

<p>First, a small angle form.</p>

<p>Using the general approximations</p>

<p>
  \begin{aligned}
  \sqrt{1+x^2} &amp;\approx 1 + x^2/2 &amp;\mathrm{for}\quad x \ll 1 \\
  \sin{\theta} &amp;\approx \theta &amp;\mathrm{for}\quad \theta \ll 1 \\
  \cos{\theta} &amp;\approx 1 - \theta^2/2 &amp;\mathrm{for}\quad \theta \ll 1 \\
  \end{aligned}
</p>

<p>we can simplify (5) to</p>

<p><span>(5’)</span></p>
<p>\rho \approx \frac{2}{\epsilon^2}\delta \approx \frac{8\beta^2}{\left(\beta^2 - \gamma^2\right)^2} \delta</p>

<p>The angles in Vanderbei’s photo are quite small, so this approximation is accurate to better than one part in a million<label for="simpler-approximation"><sup>⊕</sup></label><span>It’s also simpler than other small angle approximations previously given by Vanderbei.</span>. Since the uncertainty in the angles and camera height are about 10% each, this small angle approximation is certainly sufficient.</p>

<p>In fact, when calculating with rounded (floating point) arithmetic, the small angle form (5’) is actually more accurate than the exact form given by Vanderbei. This counterintuitive fact occurs because the exact form suffers from “catastrophic cancellation,” the result of subtracting approximately equal values that have been computed with rounding error.</p>

<p>We can get rid of one place such cancellation occurs by multiplying the numerator and denominator of our exact expression (5) by <span>1 + \sqrt{1 + \epsilon^2}</span> to get</p>

<p><span>(5’’)</span></p>
<p>\rho = \frac{ \sqrt{ 1 + \epsilon^2 } + 1 }{\epsilon^2}\delta</p>

<p>and we can get rid of another source of cancelation by replacing the difference of cosines in our expression for <span>\epsilon^2</span> with a difference of sines using the general trigonometric identity<label for="versine"><sup>⊕</sup></label><span>This identity is related to the classical <a href="https://en.wikipedia.org/wiki/Haversine_formula">Haversine Formula</a> from spherical trigonometry. Evelyn Lamb has written a wonderful blog post on this and other creatures in the zoo of <a href="https://blogs.scientificamerican.com/roots-of-unity/10-secret-trig-functions-your-math-teachers-never-taught-you/">forgotten trigonometry functions</a>.</span></p>

<p>\cos(\theta) = 1-2\sin ^2\left(\frac{\theta}{2}\right)</p>

<p>so that:</p>

<p>\epsilon^2 = 4 \frac{\left(\sin^2\left(\frac{\gamma}{2}\right) - \sin^2\left(\frac{\beta}{2}\right)\right)^2}{\sin(\beta)^2}</p>

<p>This is helpful because we’re now subtracting two numbers that are very close to 0 instead of very close to 1, and intermediate rounding to a fixed number of digits throws away less information for numbers that are close to 0 than for numbers that are close to 1.</p>

<p>Plugging this expression for <span>\epsilon^2</span> into the non-cancelling form for <span>\rho</span> (5’’) now allows computing <span>\rho</span> without undue rounding issues.</p>

<p>To evaluate <span>\rho</span> in terms of measured parameters, insert the following values into either (5’) or (5’’)</p>

<p>
  \begin{aligned}
    \alpha &amp;= 69\ \mathrm{px} \cdot 0.5^{\circ}/317\ \mathrm{px} &amp;=&amp; 0.001899\ \mathrm{rad}\\
    \beta &amp;= 29\ \mathrm{px} \cdot 0.5^{\circ}/317\ \mathrm{px}  &amp;=&amp; 0.0007983\ \mathrm{rad}\\
    \gamma &amp;= \frac{\alpha + \beta}{2} &amp;=&amp; 0.001349\ \mathrm{rad}\\
    \epsilon^2 &amp;= 5.482 \times 10^{-7} \\
    \delta &amp;= 7\ \mathrm{ft} \\
    \rho &amp;= 2.55 \times 10^{7}\ \mathrm{ft} &amp;=&amp; 4836\ \mathrm{mi}
  \end{aligned}
</p>

<p>This is 20% larger than the true value, 3960 mi<label for="rounding-error"><sup>⊕</sup></label><span>It’s also different in the second digit from the answer <a href="http://orfe.princeton.edu/u/rvdb/tex/talks/sunset/sunsetTalk_RutgersREU_small.pdf">given by Vanderbei</a> (slide 28). I think this is attributable to the “catastrophic cancellation” discussed above, combined with low precision calculation.</span>. Not too bad.</p>

<h3 id="comparison-to-other-systems">Comparison to other systems</h3>

<h4 id="classical-trigonometry">Classical trigonometry</h4>

<p>At this point, perhaps you are thinking that I’m crazy to believe that the analysis above is simpler than doing classical trigonometry. We learned trigonometry in high school, and it wasn’t all that hard, right? And the geometric algebra analysis involves a bunch of unfamiliar notations, keeping track of non-commuting multiplications, and the new geometric notion of “bivector<label for="super-powers"><sup>⊕</sup></label><span>On the other hand, it does give you algebraic super powers.</span>.”</p>

<p>But the classical trigonometry analysis of this problem is <em>hard</em>. Harder than the trigonometry problems that you solved in high school. If you don’t believe me, take a crack at solving it without referring to Vanderbei’s analysis. Or even just follow along with <a href="http://orfe.princeton.edu/u/rvdb/tex/talks/sunset/sunsetTalk_RutgersREU_small.pdf">the talk</a> and fill in all the algebra.</p>

<p>The subtlest part of Vanderbei’s formulation of the problem involves noticing a non-trivial relationship between 4 angles:</p>

<p>\phi + \beta = \theta + \gamma</p>

<p>and the subtlest part of solving the problem involves solving the trigonometric equation<label for="trigonometric-equation"><sup>⊕</sup></label><span>This equation is transcendental in the angles, but turns out to be algebraic (quadratic) in <span>\cos(\phi)</span>.</span></p>

<p>\cos(\phi + \beta) = \cos(\phi)\cos(\gamma)</p>

<p>for <span>\cos(\phi)</span>.</p>

<p>Solving difficult trigonometry problems in the classical language tends to involve constantly moving back and forth between algebraic expressions and the diagrams. This is because the full relationships between lengths and angles as separate entities are much more complicated than the relationships between vectors, which keep information about magnitude and direction conveniently integrated together. For this reason, in classical analyses, much of the information about lengths and angles is typically left implicit in diagrams, rather than being written down in an explicitly algebraic form.</p>

<p>In contrast, in the geometric algebra formulation, once the (fairly simple) equations (1-4) were written down, the rest of the solution was entirely algebraic. It also did not involve invoking any laws for relationships between transcendental functions (<span>\sin</span> and <span>\cos</span>).</p>

<p>Besides classical trigonometry, there are a few other competing (and partially overlapping) algebraic systems for solving geometrical problems, and all of them are capable of solving this problem.</p>

<h4 id="gibbs-vector-algebra">Gibbs Vector Algebra</h4>

<p>You could stick to Gibbs’ vector analysis (dot products and cross products), and use a cross product with <span>w</span> to annihilate <span>|d_2|</span> in a similar way that we used “grade separation”. There is no explicitly algebraic analogue to our trick of inserting factors of <span>gg = 1</span> and <span>tt = 1</span> to relate unknown products of two vectors to known products with a third. Even so, you could split <span>r_1</span> and <span>r_2</span> into parts parallel and perpendicular to <span>g</span> and <span>t</span> and achieve essentially similar results, with a little bit more of the reasoning left in prose instead of algebra. The major deficiency of Gibbs’ vector analysis is that the cross product is funny in 2D (because it returns an object that lives outside the plane), forces you to think about things like “pseudo-vectors<label for="pseudo-vectors"><sup>⊕</sup></label><span>pseudo-vectors are vectors that want to be bivectors.</span>” in 3D if you consider the behavior of the cross product under transformations, and doesn’t work at all in more than 3 dimensions. But none of those problems is fatal here, and Gibbs’ vector algebra is a good and efficient way to solve plane trigonometry problems. If you know it, use it.</p>

<h4 id="complex-numbers">Complex Numbers</h4>

<p>Alternatively, you could use complex numbers, and this works very well for problems in the plane. Like geometric algebra, complex numbers provide an associative and invertible product between directed magnitudes in the plane, and there are analogues to all the algebraic tricks we used here. The following mapping is useful for understanding the relationship between systems:</p>

<p>
  \begin{aligned}
  a \cdot b &amp;\longleftrightarrow \mathrm{Re}\left(a b^{\dagger}\right) \\
  a \wedge b &amp;\longleftrightarrow \mathrm{Im}\left(a b^{\dagger}\right) \\
  a b &amp;\longleftrightarrow a b^{\dagger}
  \end{aligned}
</p>

<p>The main deficiencies of complex numbers are that they don’t extend well to three or more dimensions, and that they single out the real axis as a special direction in the plane in a way that isn’t appropriate to problems with rotational symmetry. I also think there isn’t as much of a culture of viewing and understanding complex numbers geometrically as there is for Gibbs vector analysis or geometric algebra. For example, did you know that if two complex numbers are oriented along orthogonal directions, then</p>

<p>\mathrm{Re}\left(a b^{\dagger}\right) = 0</p>

<p>This is an important geometric idea, but I only know it because it falls out of the mapping to geometric algebra.</p>

<h4 id="rational-trigonometry">Rational Trigonometry</h4>

<p>NJ Wildberger has recently advocated a system of doing trigonometry called <a href="https://en.wikipedia.org/wiki/Rational_trigonometry">Rational Trigonometry</a> that avoids all use of transcendental functions and many uses of the square root function. It’s a pretty system with some definite merits, and I’d be interested to see someone analyze this problem with it.</p>

<p>Nevertheless, with geometric algebra, we were able to avoid all the same transcendental functions and square roots that Wildberger’s system avoids, and geometric algebra extends more easily to more than two dimensions and is more thoroughly coordinate free. Rational trigonometry also has the same problem as classical trigonometry in that directions and magnitudes are represented and manipulated separately instead of integrated together as vectors.</p>

<p>I wonder what a Rational Trigonometer would do at the step where we use grade separation to annihilate <span>|d_2|</span>, or at the steps where we insert factors of <span>gg = 1</span> and <span>tt = 1</span> to decompose unknown vectors against known vectors.</p>

<h4 id="pauli-matrices">Pauli Matrices</h4>

<p>Physicists use Pauli matrices to model 3D geometry in quantum mechanics problems. That system is completely isomorphic to the geometric algebra of 3D vectors, and can (and should) be used completely algebraically without ever introducing explicit matrix representations. But physicists rarely contemplate using Pauli matrices to solve non-quantum mechanical geometry problems because they believe that Pauli matrices are fundamentally quantum objects, somehow related to spin-1/2 particles like the electron. I have never seen someone try to use Pauli matrices to solve a trigonometry problem, but it can certainly be done.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Through years of experience solving physics and computer graphics problems, I have slowly learned to be skeptical of angles. In many problems where your input data is given in terms of coordinates or lengths, it is possible to solve the problem completely without ever introducing angles, and in these cases, introducing angles adds algebraic complications and computational inefficiencies. In 3D, introducing angles also invites <a href="https://en.wikipedia.org/wiki/Gimbal_lock#Gimbal_lock_in_applied_mathematics">gimbal lock</a>.</p>

<p>This is not to say that angles are never useful; quite the contrary<label for="ga-angles"><sup>⊕</sup></label><span>Lest I give the wrong impression, geometric algebra is perfectly capable of handling angles, and in fact smoothly extends the way that complex numbers handle angles to more dimensions. It’s just that it also allows you to avoid angles where they aren’t fundamental.</span>. They are exactly what you need for problems explicitly involving arc lengths on a circle (so especially problems involving rolling discs, cylinders, or spheres), or rotation at a uniform rate, or for interpolating continuously between known discrete rotations. They’re also handy for making small angle approximations. However, for most problems involving areas, projections, reflections, and other simple relationships between vectors (in other words, most problems of <em>trigonometry</em>), angles are a distraction from more direct solutions.</p>

<p>To say it another way, Wildberger (author of Rational Trigonometry) emphasizes that you don’t need to think about arc lengths on a circle to understand triangles, and on this point I agree with him completely. Of course, you do need to think about arc lengths on a circle to understand problems involving… arc lengths on a circle. For these problems, we should of course know and use angles.</p>

<p>Given this point of view, when I came across Vanderbei’s sunset problem, I thought “there must be a simpler way with fewer angles.” So this is my best attempt, using the most efficient tool I know.</p>

<p>If you didn’t know any geometric algebra before, and you have made it here, thank you and congratulations. I hope I have at least made you more intrigued about its possibilities. It is impossible to teach someone geometric algebra in one blog post (just as it is impossible to teach someone classical trigonometry, complex numbers, or vector analysis in one blog post). The best places I know to learn more are:</p>

<ul>
  <li>Hestenes’ <a href="http://scitation.aip.org/content/aapt/journal/ajp/71/2/10.1119/1.1522700">Oersted Medal lecture</a>: (<a href="http://geocalc.clas.asu.edu/pdf/OerstedMedalLecture.pdf">PDF</a>). This is a compact introduction by the founder of modern Geometric Algebra.</li>
  <li>Dorst, Fontijne, and Mann, <a href="https://www.amazon.com/Geometric-Algebra-Computer-Science-Revised/dp/0123749425">Geometric Algebra for Computer Science</a>. This book is by far the best pedagogical introduction I have seen if you want to actually learn how to calculate things. Unlike most other books on the subject, you don’t need to know any physics (or even care about physics) to appreciate it.</li>
</ul>

<p>Additionally, Hestenes’ <a href="http://geocalc.clas.asu.edu/">website</a> has many wonderful papers, and I also especially recommend two of his other books for more advanced readers:</p>

<ul>
  <li><a href="https://www.amazon.com/Space-Time-Algebra-David-Hestenes/dp/3319184121">Space-Time Algebra</a>. Hestenes’ original book on the subject, a very compact, energetic, and wide-ranging presentation with some deep physical applications. Recently re-issued by Birkhäuser.</li>
  <li><a href="https://www.amazon.com/Clifford-Algebra-Geometric-Calculus-Mathematics/dp/9027725616">Clifford Algebra to Geometric Calculus</a>. This is a challenging, advanced, and sometimes frustrating reference book, but it presents the subject in far more depth than it has been presented anywhere else. It used to be hard to find, and I suspect that few people have truly read it carefully. But it contains results that will probably continue to be rediscovered for decades. Chapter 7 on directed integration theory is especially notable: it contains extensions of most of the magical integral formulas of complex analysis (like Cauchy’s integral formula) to any number of dimensions (and even to curved manifolds!).</li>
</ul>

<p>Finally, thank you to Steven Strogatz for first <a href="https://twitter.com/stevenstrogatz/status/800136462612201472">pointing me to this problem</a> (and a related, fiendishly difficult pure <a href="https://twitter.com/stevenstrogatz/status/799740091795120133">trigonometric functions problem</a>). And of course, thank you to Robert Vanderbei for dreaming up this wonderful problem, and presenting it so beautifully.</p>

<h3 id="updates">Updates</h3>

<p>Bret Victor <a href="https://twitter.com/worrydream/status/808532834386210816">notes on Twitter</a> that many more of the equations in this post could be accompanied by diagrams. Interactive diagrams. His example:</p>

<p><a href="https://twitter.com/worrydream/status/808532834386210816"><img alt="Side view sunset diagram annotated with bivectors." src="https://www.shapeoperator.com/img/sunset-bv-bivector-diagram.png"/></a></p>

<p>I’ll list a few relevant resources along these lines:</p>

<ul>
  <li>Daniel Fontijne wrote a program called <a href="http://www.geometricalgebra.net/gaviewer_download.html">GAViewer</a> to accompany <em>Geometric Algebra for Computer Science</em> (recommended above) that allows visualizing and visually manipulating GA expressions. I wish you could embed it on the web.</li>
  <li><a href="http://aprt.us">Apparatus</a> is a very cool environment for drawing interactive diagrams, and I hear you can embed apparatus creations into other web pages now. Maybe someone can teach it how to speak GA!</li>
  <li><a href="https://github.com/weshoke">weshoke</a> ported the <a href="http://versor.mat.ucsb.edu/">Versor GA library</a> to Javascript (<a href="https://github.com/weshoke/versor.js/">Versor.js</a>) and there are stubs of an <a href="https://github.com/weshoke/versor.js/tree/master/cli">expression parser</a> and a <a href="https://github.com/weshoke/versor.js/tree/master/render">canvas renderer</a> written by a few other contributors (including me). Maybe you could be the one to flesh this out!</li>
  <li>Finally, I’ll mention that <a href="https://www.desmos.com/">Desmos</a> (my employer) is a great way to interact with equations, functions, and graphs (but GA isn’t on our current roadmap).</li>
</ul>

<hr/>

<p>Jacob Rus writes to suggest a few more resources for learning about GA:</p>

<blockquote>
  <p>I was a bit surprised you didn’t mention Hestenes’s NFCM book, as that seems closest to the type of problem solving you were doing:</p>

  <p>David Hestenes, <a href="http://geocalc.clas.asu.edu/html/NFCM.html">New Foundations for Classical Mechanics</a></p>

  <p>A couple other sources you might mention:</p>

  <ul>
    <li>Alan Bromborsky, <a href="http://www2.montgomerycollege.edu/departments/planet/planet/Numerical_Relativity/bookGA.pdf">An Introduction to Geometric Algebra and Calculus</a></li>
    <li>Eric Chisholm, <a href="https://arxiv.org/abs/1205.5935">Geometric Algebra</a></li>
  </ul>

  <p>At a closer to high school geometry level, perhaps also:</p>

  <ul>
    <li>Ramon González Calvet, <a href="http://www.xtec.cat/~rgonzal1/cgga.htm">The Clifford-Grassmann Geometric Algebra</a></li>
    <li>James A Smith, <a href="http://vixra.org/author/james_a_smith">viXra papers on Geometric Algebra</a></li>
  </ul>
</blockquote>

<p><em>New Foundations for Classical Mechanics</em> is the first book I read about GA. It has tons of great diagrams, and gives some interesting new perspectives on well known mechanics problems. This book got me excited about GA, but I personally found <em>Geometric Algebra for Computer Science</em> (recommended above) did a better job teaching me how to calculate things and solve problems on my own.</p>

<hr/>

<p><a id="skepticism"></a>A few readers have written in with skepticism about whether Vanderbei’s photograph shows what he (and I) said it shows. A quick <a href="https://www.google.com/search?q=sunset+over+water&amp;tbm=isch">search on Google Images</a> shows that ripples and waves in water generally play a dominant role in the appearance of the sun’s reflection. Vanderbei addresses waves, atmospheric effects, and CCD saturation in <a href="http://orfe.princeton.edu/~rvdb/tex/sunset/34-39.OPN.1108twoup.pdf">his article</a> and concludes that the reflection in his image does display the geometric effect under discussion, but that he was lucky to obtain such an image.</p>

<p>Randall Munroe writes:</p>

<blockquote>
  <p>There are some cool and somewhat similar tricks for estimating the size of the Earth by carefully observing the sunset. My favorite is to go to a beach at sunrise and stand atop some steps or a lifeguard stand. When the sun first appears, start a stopwatch. Then run/drop quickly to the ground, and time how long it takes the sun to appear a second time. I think you can use that to work out the Earth’s radius.</p>
</blockquote>

<p>Here’s a page spelling out the <a href="http://www.astro.princeton.edu/~dns/teachersguide/MeasECAct.html">relevant calculations</a>. If you live on the West Coast, like me, you don’t even have to wake up early to try this.</p>

  </article></div>
  </body>
</html>
