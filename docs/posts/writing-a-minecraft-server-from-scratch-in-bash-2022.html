<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sdomi.pl/weblog/15-witchcraft-minecraft-server-in-bash/">Original</a>
    <h1>Writing a Minecraft server from scratch in Bash (2022)</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
<div><h3>My thoughts on writing a Minecraft server from scratch (in Bash)</h3>
<p>For the past year or so, I&#39;ve been thinking about writing a Minecraft server in Bash as a thought excercise. I once tried that before with the Classic protocol (the one from 2009), but I quickly realized there wasn&#39;t really a way to properly parse binary data in bash. Take the following code sample:</p>

<p><code>function a() {
	read -n 2 uwu
	echo &#34;$uwu&#34; | xxd
}
</code></p><p>This would read two bytes into a variable, and then pass them to `xxd`, which should show the hexdump of the data.</p>

<p><img src="https://sdomi.pl/weblog/15-witchcraft-minecraft-server-in-bash/img/1.png"/>
<small>Picture 1 - bash&#39;s lack of support for nullbytes</small></p><p>Everything&#39;s great, until we pass a nullbyte (0x00). Not only does Bash ignore nullbytes in strings, it also doesn&#39;t present any way to detect that a nullbyte has occured. Considering that the protocol I&#39;m trying to implement is strictly binary, this can severely mangle the data.</p>

</div><p><span>Everyone</span> at 15.02.2022, 16:40:40</p><p>Liked that</p><p><span>helpful person</span> at 15.02.2022, 16:59:22</p><p>This project is wicked cool but your font choices make it super hard to read.  And this black-on-dark-gray comment box is insane! :D</p><p><span><a href="https://saphi.re/">Saphire</a></span> at 15.02.2022, 17:10:48</p><p>Oh dear, that is cursed. Much more so than the HTTP(s) server in bash that I have seen around... I love it~!

...wait is the font for this the minecraft font. And agree with previous comment, the black-on-gray is hard to read q-q</p><p><span>new reader</span> at 15.02.2022, 17:48:56</p><p>as someone that knows very little bash, this was extremely fun to read. love the website too! :)</p><p><span>awesome stuff</span> at 15.02.2022, 17:49:01</p><p>awesome stuff</p><p><span>josÃ©</span> at 15.02.2022, 18:06:37</p><p>I&#39;ve had this idea a few months ago and I didn&#39;t think it was possible. This is awesome! good work.</p><p><span><a href="https://artur.co">Artur</a></span> at 15.02.2022, 18:15:27</p><p>Awesome stuff</p><p><span><a href="http://lilybee.club">lily</a></span> at 15.02.2022, 18:17:05</p><p>i hate it here</p><p><span><a href="https://nanoshinono.me">prefetcher</a></span> at 15.02.2022, 18:22:08</p><p>This is absolutely awesome! Great work!!</p><p><span>Rafael</span> at 15.02.2022, 18:49:27</p><p>Amazing work!</p><p><span><a href="https://daniel.harka.com">Daniel</a></span> at 15.02.2022, 18:49:40</p><p>That&#39;s amazing! Good job!</p><p><span>keldu</span> at 15.02.2022, 19:20:46</p><p>That&#39;s crazy. I wrote a small MC network implementation in C++ and gave up after I started to see how they randomly change packets in different versions.

I didn&#39;t want to keep up with that. But do this in bash for MC is crazy.
I went back and wrote a small reverse proxy server for MC though.</p><p><span><a href="https://ted.ge">Theo</a></span> at 15.02.2022, 19:36:33</p><p>Your website is great. Your posts are great. Your everything is great. Keep up the work, It&#39;s definitely worth it...</p><p><span>bigking</span> at 15.02.2022, 19:39:06</p><p>ilove this. gonna play with it, if i manage to make something worthwhile i let you know. thanks for this interesting unconventional project.</p><p><span>Mikael</span> at 15.02.2022, 20:03:07</p><p>Cool project! May I ask how much time went into it? I don&#39;t really know how complex the protocol is or how long time each test takes, like if you need to restart the client and stuff.</p><p><span>anon</span> at 15.02.2022, 20:53:12</p><p>nice</p><p><span>Triggernometry</span> at 15.02.2022, 21:16:27</p><p>this is a glorious write-up of the process tho.
one of the best ways to learn coding is to do or see &#34;what if i did this stupid pointless thing&#34; then seeing aaaaaall the pitfalls</p><p><span>eggmtf</span> at 15.02.2022, 21:19:43</p><p>this is insane but really cool, nice work!</p><p><span><a href="https://edwinkofler.com">hyperupcall</a></span> at 15.02.2022, 21:25:36</p><p>I do a lot of Bash and lemmie tell you, this is pretty badass! Some people would say it&#39;s cursed, but I think its just cool - Thanks for sharing ^w^</p><p><span>egg</span> at 15.02.2022, 22:03:16</p><p>Wow for the hackery of the &#34;in Bash&#34;, and nice font reminds me of some VGA stuff.</p><p><span>anon</span> at 15.02.2022, 22:17:18</p><p>neato</p><p><span><a href="https://j3s.sh">j3s</a></span> at 16.02.2022, 01:34:09</p><p>dope af</p><p><span>a nat you don&#39;t know</span> at 16.02.2022, 02:19:17</p><p>delightfully cursed, i love it</p><p><span><a href="https://sucipto.id">chip</a></span> at 16.02.2022, 02:49:23</p><p>Hardcore :D</p><p><span>ayo</span> at 16.02.2022, 06:12:39</p><p>noice</p><p><span>trekkie1701c</span> at 16.02.2022, 06:16:55</p><p>You can hackily handle floating point numbers in a bash script by piping the equation through BCMath.

In the case that I&#39;ve had to do it, it&#39;s pretty much:

var=$(echo &#34;scale=9;$num1/$num2&#34; | bc)

Where the 9 is the number of decimal places and / is the operand and can be replaced by whatever.

This is probably highly inefficient but hey it works.</p><p><span>punk xfce</span> at 16.02.2022, 08:19:20</p><p>I didn&#39;t read that</p><p><span>annow</span> at 16.02.2022, 11:11:57</p><p>i&#39;ve never think about it, congrats</p><p><span>M</span> at 16.02.2022, 11:21:37</p><p>This is exactly the kind of insane (in a good way) stuff I love to read about! Looking forward to more of this! :3</p><p><span>Charles Duffy</span> at 16.02.2022, 13:13:19</p><p>You can absolutely read and write streams containing NULs in bash -- the trick is to store them as arrays (with the terminal element containing everything after the last NUL) instead of as strings. Also, echo is an abomination in general, and even the POSIX spec describing it says that printf should be used instead -- search for the excellent answer by StÃ©phane Chazelas to &#34;Why is printf better than echo?&#34; on unix.stackexchange.com</p><p><span>RJM</span> at 16.02.2022, 19:12:40</p><p>I respect your work so much! Awesome job!</p><p><span>RSEA</span> at 16.02.2022, 20:00:24</p><p>Great piece. Terminus font in the screenshots also, the best terminal font by far.</p><p><span><a href="https://leigergaming.com">LeigerGaming</a></span> at 16.02.2022, 22:23:12</p><p>Interesting!</p><p><span>Wensz</span> at 16.02.2022, 22:42:09</p><p>I got rickrolled at the ending.</p><p><span>Francois Scheurer</span> at 17.02.2022, 10:43:56</p><p>nice work!
I was puzzled with the line:
a=$(dd count=2 bs=$len status=none | xxd -p)

as dd cannot will hangs here on an empty stdin.
or maybe it&#39;s lacking context and your script stdin is filled already with data...?

or are you using some function like this?
function a() { dd count=$len bs=1 status=none | xxd -p; }

anyway it is a clever idea to use dd to deal with null chars!

Another way would be to use tempfiles (in ram) instead of strings variables, but that would probably perform slower.</p><p><span>Drygord</span> at 19.02.2022, 18:40:39</p><p>Cool project - what is the font and color scheme of this webpage?</p><p><span>A</span> at 03.03.2022, 01:10:46</p><p>SO</p><p><span>mine</span> at 04.03.2022, 21:41:59</p><p>craft</p><p><span><a href="https://chfour.github.io/">chfour</a></span> at 10.03.2022, 19:11:45</p><p>that is, quite literally, witchcraft. I&#39;m amazed. I mean I made an HTTP server in browser Javascript, and that&#39;s NOTHING compared to this. this is a fully functional, real time minecraft server. a full-on online 3D game. Wow.
also, lovely font choice ;)</p><p><span><a href="http://quadsplace.neocities.org">me</a></span> at 10.03.2022, 19:17:31</p><p>My BRAIN IS BOGELED</p><p><span><a href="https://notnite.com/">NotNite</a></span> at 04.05.2022, 23:21:31</p><p>wow this is horrifying</p><p><span>some guy on the interweb of tubes</span> at 25.12.2022, 23:42:35</p><p>This is sooo cool! I once tried to write an http server in bash and gave up on it after writing file serving code became too hard for me</p><p><span>test</span> at 29.12.2022, 16:01:13</p><p>test</p><p><span><a href="http://juh.gay">juh</a></span> at 06.02.2023, 17:36:51</p><p>inspires fear in friends and enemies alike :D</p><p><span>nigga</span> at 02.03.2024, 17:13:16</p><p>nig</p><p><span>Bot</span> at 02.03.2024, 17:27:23</p><p>Ah yes, a comment section with no captcha. I hope bots don&#39;t evade it.</p><p><span>Bobby Tables</span> at 02.03.2024, 20:04:46</p><p>cool post, i loved it&#39;); DROP TABLE comment_section --</p><p><span>ğŸ¤ª</span> at 02.03.2024, 20:41:05</p><p>ğŸ¤ª</p><p><span>Lit</span> at 02.03.2024, 20:49:23</p><p>This is a beautiful abomination. I hope you&#39;re proud of yourself. ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥</p><p><span>keratoconus</span> at 02.03.2024, 20:58:13</p><p>Please add a light theme :(</p><p><span>Slug</span> at 02.03.2024, 22:36:54</p><p>Agree that the font makes this super hard to read. If i zoom in or out at all in Chrome it becomes blurry. BUT - persevered to read the content of the article which was super cool! Awesome work</p><p><span>anonymouse</span> at 03.03.2024, 02:25:04</p><p>function stdin2hexdump() {
  local LC_ALL= LC_CTYPE=C LC_COLLATE=C LANG=
  local IFS=&#34;&#34; c b h o=0 hs= cs= i1=$&#39;\033[7m&#39; i0=$&#39;\033[27m&#39;
  while read -r -s -d &#34;&#34; -n 1 c; do
    printf -v b &#34;%d&#34; &#34;&#39;${c}&#34;
    printf -v h &#34;%02X&#34; &#34;${b}&#34;
    case &#34;${c}&#34; in
      $&#39;\000&#39; ) c=&#34;${i1}@${i0}&#34;;;
      $&#39;\001&#39; ) c=&#34;${i1}A${i0}&#34;;;
      $&#39;\002&#39; ) c=&#34;${i1}B${i0}&#34;;;
      $&#39;\003&#39; ) c=&#34;${i1}C${i0}&#34;;;
      $&#39;\004&#39; ) c=&#34;${i1}D${i0}&#34;;;
      $&#39;\005&#39; ) c=&#34;${i1}E${i0}&#34;;;
      $&#39;\006&#39; ) c=&#34;${i1}F${i0}&#34;;;
      $&#39;\007&#39; ) c=&#34;${i1}G${i0}&#34;;;
      $&#39;\010&#39; ) c=&#34;${i1}H${i0}&#34;;;
      $&#39;\011&#39; ) c=&#34;${i1}I${i0}&#34;;;
      $&#39;\012&#39; ) c=&#34;${i1}J${i0}&#34;;;
      $&#39;\013&#39; ) c=&#34;${i1}K${i0}&#34;;;
      $&#39;\014&#39; ) c=&#34;${i1}L${i0}&#34;;;
      $&#39;\015&#39; ) c=&#34;${i1}M${i0}&#34;;;
      $&#39;\016&#39; ) c=&#34;${i1}N${i0}&#34;;;
      $&#39;\017&#39; ) c=&#34;${i1}O${i0}&#34;;;
      $&#39;\020&#39; ) c=&#34;${i1}P${i0}&#34;;;
      $&#39;\021&#39; ) c=&#34;${i1}Q${i0}&#34;;;
      $&#39;\022&#39; ) c=&#34;${i1}R${i0}&#34;;;
      $&#39;\023&#39; ) c=&#34;${i1}S${i0}&#34;;;
      $&#39;\024&#39; ) c=&#34;${i1}T${i0}&#34;;;
      $&#39;\025&#39; ) c=&#34;${i1}U${i0}&#34;;;
      $&#39;\026&#39; ) c=&#34;${i1}V${i0}&#34;;;
      $&#39;\027&#39; ) c=&#34;${i1}W${i0}&#34;;;
      $&#39;\030&#39; ) c=&#34;${i1}X${i0}&#34;;;
      $&#39;\031&#39; ) c=&#34;${i1}Y${i0}&#34;;;
      $&#39;\032&#39; ) c=&#34;${i1}Z${i0}&#34;;;
      $&#39;\033&#39; ) c=&#34;${i1}[${i0}&#34;;;
      $&#39;\034&#39; ) c=&#34;${i1}\\${i0}&#34;;;
      $&#39;\035&#39; ) c=&#34;${i1}]${i0}&#34;;;
      $&#39;\036&#39; ) c=&#34;${i1}^${i0}&#34;;;
      $&#39;\037&#39; ) c=&#34;${i1}_${i0}&#34;;;
      $&#39;\177&#39; ) c=&#34;${i1}?${i0}&#34;;;
    esac
    (( b &gt; 127 )) &amp;&amp; c=&#34;${i1}.${i0}&#34;
    hs+=&#34; ${h}&#34;
    cs+=&#34;${c}&#34;
    (( o++ ))
    (( o % 16 )) || { printf &#34;%08X |%s | %s |\n&#34; &#34;$(( ${o} - 16 ))&#34; &#34;${hs}&#34; &#34;${cs}&#34;; hs=; cs=; }
  done
  (( o % 16 )) &amp;&amp; printf &#34;%08X |%-48s | %s |\n&#34; &#34;$(( ${o} - ( ${o} % 16 ) ))&#34; &#34;${hs}&#34; &#34;${cs}&#34;
}</p>        <p>
        By commenting, you agree for the session cookie to be stored on your device ;p</p></div></div>
  </body>
</html>
