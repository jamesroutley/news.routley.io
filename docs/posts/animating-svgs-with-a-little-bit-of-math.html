<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://bensch.ac/blog/animated-blog-post-background">Original</a>
    <h1>Animating SVGs with A Little Bit of Math</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><h2 role="heading" text-rendering="optimizelegibility">Introduction</h2>
<p text-rendering="optimizelegibility">I recently purchased <a href="https://natureofcode.com/">Nature of Code</a> and wanted to recreate the cover pattern with a ripple effect animation that responds to mouse hover.</p>
<blockquote>
<p text-rendering="optimizelegibility">This is the background of all posts on this blog. If you hover over the background, you&#39;ll see the lines animate toward the mouse.</p>
</blockquote>
<p><span></span>
<img width="300" aspectratio="16/9" src="https://a.media-amazon.com/images/I/61FsVwW7SnL._SY522_.jpg"/></p><p text-rendering="optimizelegibility">Additionally, all of the code is open source, if jumping to the code implementation is more your style.</p>
<p text-rendering="optimizelegibility">The more interesting part of the animation is the rotation calculation and the smooth animation of the SVG lines.</p>
<h2 role="heading" text-rendering="optimizelegibility">Setting Up the Canvas</h2>
<p text-rendering="optimizelegibility">The animation is on an SVG canvas that fills the entire width of the container and 70% of the viewport height, and is absolutely positioned at the top of the page.</p>
<pre><p><code><span><span>&lt;</span><span>svg</span><span>
</span></span><span><span>  </span><span>style</span><span>=</span><span>{</span><span>{</span><span> position</span><span>:</span><span> </span><span>&#39;absolute&#39;</span><span>,</span><span> top</span><span>:</span><span> </span><span>0</span><span>,</span><span> left</span><span>:</span><span> </span><span>0</span><span>,</span><span> width</span><span>:</span><span> </span><span>&#39;100%&#39;</span><span>,</span><span> height</span><span>:</span><span> </span><span>&#39;70vh&#39;</span><span> </span><span>}</span><span>}</span><span>
</span></span><span><span>  </span><span>ref</span><span>=</span><span>{</span><span>svgRef</span><span>}</span><span>
</span></span><span><span>  </span><span>width</span><span>=</span><span>&#34;</span><span>100%</span><span>&#34;</span><span>
</span></span><span><span>  </span><span>viewBox</span><span>=</span><span>&#34;</span><span>0 0 100 100</span><span>&#34;</span><span>
</span></span><span><span>  </span><span>preserveAspectRatio</span><span>=</span><span>&#34;</span><span>xMidYMid slice</span><span>&#34;</span><span>
</span></span><span><span>  </span><span>onMouseMove</span><span>=</span><span>{</span><span>handleMouseMove</span><span>}</span><span>
</span></span><span><span>  </span><span>onMouseLeave</span><span>=</span><span>{</span><span>handleMouseLeave</span><span>}</span><span>
</span></span><span><span></span><span>&gt;</span></span></code></p></pre>
<blockquote>
<p text-rendering="optimizelegibility">The <code>preserveAspectRatio</code> attribute is set to <code>xMidYMid slice</code> to ensure the SVG fills the entire container while maintaining its aspect ratio. <code>slice</code> is used to ensure the SVG is cropped to fit the container. <code>xMidYMid</code> is used to center the SVG within the container.</p>
</blockquote>
<h2 role="heading" text-rendering="optimizelegibility">The Line Object</h2>
<p text-rendering="optimizelegibility">Each line in the grid is represented by an object with the following properties:</p>
<pre><p><code><span><span>interface</span><span> </span><span>Line</span><span> </span><span>{</span><span>
</span></span><span><span>  </span><span>
</span></span><span><span>  x</span><span>:</span><span> </span><span>number</span><span>
</span></span><span><span>  </span><span>
</span></span><span><span>  y</span><span>:</span><span> </span><span>number</span><span>
</span></span><span><span>  </span><span>
</span></span><span><span>  rotation</span><span>:</span><span> </span><span>number</span><span>
</span></span><span><span>  </span><span>
</span></span><span><span>  targetRotation</span><span>:</span><span> </span><span>number</span><span>
</span></span><span><span>  </span><span>
</span></span><span><span>  color</span><span>:</span><span> </span><span>string</span><span>
</span></span><span><span></span><span>}</span></span></code></p></pre>
<h2 role="heading" text-rendering="optimizelegibility">Interaction and a Little Bit of Math</h2>
<p text-rendering="optimizelegibility">The interactivity lies in the rotation calculation during mouse hover. When the mouse moves, the component calculates the angle between each line and the mouse position.</p>
<h3 role="heading" text-rendering="optimizelegibility">Geometry and Trigonometry</h3>
<p text-rendering="optimizelegibility">Distance between two points is calculated using the <a href="https://en.wikipedia.org/wiki/Euclidean_distance">Euclidean distance formula</a>, which is the square root of the sum of the squares of the differences in the coordinates.</p>
<p><span></span>
<img alt="Euclidean distance formula" src="https://www.researchgate.net/profile/Young-Sun-Lee-2/publication/263889770/figure/fig1/AS:890653479284740@1589359745492/An-example-of-Euclidean-distance-between-two-objects-on-variables-X-and-Y.png"/></p><p text-rendering="optimizelegibility">This is also known as the Pythagorean distance.</p>
<p text-rendering="optimizelegibility">Next, we calculate the distance between the mouse and the line.</p>
<pre><p><code><span><span>// Calculate the distance between the mouse and the x position of the line</span><span>
</span></span><span><span></span><span>const</span><span> dx </span><span>=</span><span> mousePos</span><span>.</span><span>x</span><span> </span><span>-</span><span> line</span><span>.</span><span>x</span><span>
</span></span><span><span></span><span>// Calculate the distance between the mouse and the y position of the line</span><span>
</span></span><span><span></span><span>const</span><span> dy </span><span>=</span><span> mousePos</span><span>.</span><span>y</span><span> </span><span>-</span><span> line</span><span>.</span><span>y</span><span>
</span></span><span><span></span><span>// Calculate the distance between the mouse and the line</span><span>
</span></span><span><span></span><span>//  √((-dx)² + (-dy)²) - Euclidean distance</span><span>
</span></span><span><span></span><span>const</span><span> distance </span><span>=</span><span> </span><span>Math</span><span>.</span><span>sqrt</span><span>(</span><span>dx </span><span>*</span><span> dx </span><span>+</span><span> dy </span><span>*</span><span> dy</span><span>)</span><span>
</span></span><span><span></span><span>const</span><span> maxDistance </span><span>=</span><span> </span><span>10</span><span> </span><span>// Max distance of effect</span><span>
</span></span><span>
</span><span><span></span><span>// If the distance between the mouse and the line is less than the max distance, and the mouse is not at the edge of the screen, then we calculate the angle between the mouse and the line</span><span>
</span></span><span><span></span><span>if</span><span> </span><span>(</span><span>distance </span><span>&lt;</span><span> maxDistance </span><span>&amp;&amp;</span><span> mousePos</span><span>.</span><span>x</span><span> </span><span>!==</span><span> </span><span>-</span><span>1</span><span> </span><span>&amp;&amp;</span><span> mousePos</span><span>.</span><span>y</span><span> </span><span>!==</span><span> </span><span>-</span><span>1</span><span>)</span><span> </span><span>{</span><span>
</span></span><span><span>  </span><span>// Calculate the angle between the mouse and the line</span><span>
</span></span><span><span>  </span><span>// atan2(dy, dx) returns the angle in radians between the positive x-axis and the point (dy, dx)</span><span>
</span></span><span><span>  </span><span>const</span><span> angle </span><span>=</span><span> </span><span>Math</span><span>.</span><span>atan2</span><span>(</span><span>dy</span><span>,</span><span> dx</span><span>)</span><span> </span><span>*</span><span> </span><span>(</span><span>180</span><span> </span><span>/</span><span> </span><span>Math</span><span>.</span><span>PI</span><span>)</span><span>
</span></span><span><span>  newTargetRotation </span><span>=</span><span> angle
</span></span><span><span></span><span>}</span></span></code></p></pre>
<p text-rendering="optimizelegibility">Using the <a href="https://en.wikipedia.org/wiki/Atan2"><code>atan2</code></a> function, which returns the angle in radians between the positive x-axis and the point given by the coordinates (dy, dx), we specifically use <code>Math.atan2(dy, dx)</code> to get the angle between the mouse and the line on a Cartesian plane to generate the new rotation of the line.</p>
<p text-rendering="optimizelegibility">Then, we convert radians to degrees for easier manipulation by multiplying by <code>(180 / Math.PI)</code>.</p>
<h3 role="heading" text-rendering="optimizelegibility">Smooth Animation</h3>
<p text-rendering="optimizelegibility">To create a smooth animation, the component doesn&#39;t immediately set the line to its target rotation, but gradually moves towards it.</p>
<pre><p><code><span><span>const</span><span> rotationDiff </span><span>=</span><span> newTargetRotation </span><span>-</span><span> line</span><span>.</span><span>rotation</span><span>
</span></span><span><span></span><span>// 0.1 is the speed of the line rotation to its target rotation</span><span>
</span></span><span><span></span><span>const</span><span> newRotation </span><span>=</span><span> line</span><span>.</span><span>rotation</span><span> </span><span>+</span><span> rotationDiff </span><span>*</span><span> </span><span>0.1</span></span></code></p></pre>
<h3 role="heading" text-rendering="optimizelegibility">Performance Considerations</h3>
<p text-rendering="optimizelegibility">To ensure smooth performance, especially on lower-end devices, the component employs two key strategies:</p>
<ol>
<li text-rendering="optimizelegibility"><strong>Debouncing</strong>: The window resize event is debounced to prevent excessive recalculations. I don&#39;t really think users are going to be resizing their browser window that often, but generally, on the safe side, it&#39;s a good idea to debounce the event.</li>
</ol>
<pre><p><code><span><span>// Using lodash&#39;s debounce function would probably be better lol</span><span>
</span></span><span><span></span><span>function</span><span> </span><span>debounce</span><span>(</span><span>func</span><span>:</span><span> </span><span>Function</span><span>,</span><span> wait</span><span>:</span><span> </span><span>number</span><span>)</span><span> </span><span>{</span><span>
</span></span><span><span>  </span><span>let</span><span> timeout</span><span>:</span><span> </span><span>number</span><span>
</span></span><span><span>  </span><span>return</span><span> </span><span>function</span><span> </span><span>(</span><span>this</span><span>:</span><span> </span><span>any</span><span>,</span><span> </span><span>...</span><span>args</span><span>:</span><span> </span><span>any</span><span>[</span><span>]</span><span>)</span><span> </span><span>{</span><span>
</span></span><span><span>    </span><span>const</span><span> context </span><span>=</span><span> </span><span>this</span><span>
</span></span><span><span>    </span><span>clearTimeout</span><span>(</span><span>timeout</span><span>)</span><span>
</span></span><span><span>    timeout </span><span>=</span><span> </span><span>window</span><span>.</span><span>setTimeout</span><span>(</span><span>(</span><span>)</span><span> </span><span>=&gt;</span><span> func</span><span>.</span><span>apply</span><span>(</span><span>context</span><span>,</span><span> args</span><span>)</span><span>,</span><span> wait</span><span>)</span><span>
</span></span><span><span>  </span><span>}</span><span>
</span></span><span><span></span><span>}</span><span>
</span></span><span>
</span><span><span></span></span><span> *
</span><span></span><span></span><span></span><span><span>
</span></span><span><span></span><span>function</span><span> </span><span>useDebounce</span><span>(</span><span>callback</span><span>:</span><span> </span><span>Function</span><span>,</span><span> delay</span><span>:</span><span> </span><span>number</span><span>)</span><span> </span><span>{</span><span>
</span></span><span><span>  </span><span>// Make sure the debounce function is only created once</span><span>
</span></span><span><span>  </span><span>// and not recreated on every render</span><span>
</span></span><span><span>  </span><span>const</span><span> debouncedFn </span><span>=</span><span> </span><span>useRef</span><span>(</span><span>debounce</span><span>(</span><span>callback</span><span>,</span><span> delay</span><span>)</span><span>)</span><span>.</span><span>current</span><span>
</span></span><span><span>  </span><span>return</span><span> debouncedFn
</span></span><span><span></span><span>}</span></span></code></p></pre>
<ol start="2">
<li text-rendering="optimizelegibility"><strong>RequestAnimationFrame</strong>: The animation loop uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame"><code>requestAnimationFrame</code></a> for smooth, optimized updates at 60fps:</li>
</ol></div></div></div></div>
  </body>
</html>
