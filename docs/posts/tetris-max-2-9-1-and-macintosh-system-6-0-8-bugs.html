<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.bigmessowires.com/2023/07/28/tetris-max-2-9-1-and-macintosh-system-6-0-8-bugs/">Original</a>
    <h1>Tetris Max 2.9.1 and Macintosh System 6.0.8 Bugs</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p><img src="https://www.bigmessowires.com/wp-content/uploads/2015/12/tetris-max-2.png" alt="tetris max 2" width="502" height="349" srcset="https://www.bigmessowires.com/wp-content/uploads/2015/12/tetris-max-2.png 502w, https://www.bigmessowires.com/wp-content/uploads/2015/12/tetris-max-2-300x209.png 300w" sizes="(max-width: 502px) 100vw, 502px"/></p>
<p>31 years ago <a href="https://www.bigmessowires.com/2015/12/11/the-story-of-tetris-max/">Tetris Max</a> for the Macintosh was born, an improved clone of tetris, and it became an insanely popular Mac game during the 1990s. I may or may not have had some involvement in its development. Macintosh System 6 was the current OS version at the time of the game’s release, but System 7 was introduced shortly afterwards. It’s recently come to my attention that the final version of Tetris Max (v2.9.1) may not work when running System 6 on certain Mac hardware, even though the game was advertised as System 6 compatible. I haven’t yet been able to fully verify this myself, but there’s a <a href="https://macintoshgarden.org/games/tetris-max">Macintosh Garden bug report</a> from ironboy36 in 2022, and more recently a detailed bug report <a href="https://www.youtube.com/watch?v=8ipwMhWtouw">complete with video</a> (thank you James!) Obviously I need to fix this stuff ASAP – 31-year-old bug be damned. And I need your help! Consider this a group debugging effort.</p>
<p>Both bug reports mention an “Unimplemented Trap” error message, which probably means Tetris Max tried to call a Toolbox function that’s only available in System 7 or later, and isn’t available from System 6. I suspect this bug only applies to color-capable 68K Macintosh models running System 6, because Tetris Max 2.9 works OK under System 6.0.8 on my B&amp;W-only Macintosh SE. That limits the hardware options to the Macintosh II family (including the Mac SE/30), because later Mac models can’t run System 6 and earlier models (like the Mac Plus and original SE) aren’t color-capable. </p>
<p>James’ test was performed on a Mac SE/30 with the built-in black-and-white screen, running System 6.0.8 loaded from a <a href="https://www.bigmessowires.com/floppy-emu/">BMOW Floppy Emu</a> disk emulator. I think he was also using a <a href="https://www.bigmessowires.com/mac-rom-inator-ii/">Mac ROM-inator II</a> replacement ROM during this test. Ironboy36 didn’t mention what hardware was used, so we can only guess.</p>

<p>Challenge #1 is simply reproducing the bug. Unfortunately I think this needs to be done on real hardware, and not under emulation, because I’m not aware of any software that can emulate a color-capable 68K Macintosh running System 6. Mini vMac only emulates non-color Macs like the Plus and SE. Basilisk II can’t handle 24-bit addressing or System 6, and Sheepshaver is PowerPC-only emulation. There’s MESS, but I’m not sure about its capabilities, and setting it up is daunting.</p>
<p>Working on real hardware is OK, even if it’ll be more difficult, but I don’t have easy access to any appropriate machines. My SE/30 needs to be recapped and currently doesn’t boot. I also have a Mac IIci and a Mac IIsi, but one is missing the power supply and the other has an unknown motherboard problem. I can probably get one of those machines working again, but at least for now I need to rely on other people to run Tetris Max with System 6 on systems like these, and send me reports.</p>

<p>I don’t remember intentionally dropping System 6 support in later versions of Tetris Max, but it’s possible. After 31 years, with no source control and no release notes, I couldn’t tell you exactly what changed between the last few versions of Tetris Max. Version 2.9.1 was the last public release, but there was a stealth 2.9.2x release in 2016 which supported running from a ROM disk like the one provided by the <a href="https://www.bigmessowires.com/mac-rom-inator-ii/">Mac ROM-inator II</a>. There’s also a version 2.9 floating around the web, predating 2.9.1. For the purposes of troubleshooting this bug, I think all three versions behave identically.</p>
<p>It’s possible this is actually a Mac ROM-inator II problem, since that’s what James used and possibly ironboy36 too. It would help to try running Tetris Max on the same computer, with the same System version, with the Mac ROM-inator and then again with the stock Apple ROM. Maybe the game is confused into thinking the SE/30 is a IIsi, and then tries to call some System routines that aren’t available in the SE/30? Just a guess. </p>
<p>Another possibility is that the version of 6.0.8 that’s included with the Floppy Emu is missing something that’s supposed to be there, and which is actually the source of the problem. For example, I know it’s missing some of the standard bitmap font sizes, though this shouldn’t cause an Unimplemented Trap error. I suspect this particular 6.0.8 System file was borrowed from a Disk Tools floppy rather than being the result of running the full 6.0.8 installer. It would help to try Tetris Max on a Macintosh II series machine with either System 6.0.7, or a fresh install of 6.0.8 from the installer floppies.</p>

<p>I was able to dig through many layers of old archives, and get Tetris Max running in the debugger with Codewarrior Pro, on an emulated System 9.0 PPC Macintosh with Sheepshaver. I stepped through all the code that runs between application launch and when the game window appears, and didn’t see anything that’s obviously System 7-only, but there’s a lot of code and I don’t have a good sense of which OS calls might be to blame. If you’re a developer, you can find the source code at Macintosh Garden.</p>
<p>Ideally I would run Tetris Max in the debugger on a color-capable 68K Mac with System 6.0.8, and go step-by-step until the game crashes, but there are a couple of problems with that approach. The version of Codewarrior Pro that Tetris Max is built with probably doesn’t work under System 6, or on Mac systems as old as the Macintosh II series. Even if it does, I don’t currently have working hardware to do it.</p>
<p>Macintosh Garden also has older versions of Tetris Max, including 2.8, 2.3.1, and older. If I can get the game running on real hardware, or somebody else can try it and report their results, I could find out what version broke the System 6 compatibility. That could provide more clues.</p>
<p>If my dusty memory is correct, someone could also install MacsBug and then they’d get more debugging info when the error occurs, instead of a mostly-useless “unimplemented trap” message. I think it would report which Toolbox trap the game tried to call, which might shed more light on the problem. </p>
<p>For the moment, the only viable approach I can think of is to create a series of instrumented builds of Tetris Max, that beep or log their progress to a file during startup, and share these builds with people who can help test. That could eventually narrow down the point of the crash until the offending Toolbox call is identified. From there I could hopefully implement a work-around. But this approach is barely better than inserting PRINT statements into a 1979 BASIC program to aid with debugging, and I don’t like it very much.</p>
      
<p><a href="https://www.bigmessowires.com/2023/07/28/tetris-max-2-9-1-and-macintosh-system-6-0-8-bugs/#comments">Read 7 comments and join the conversation</a>       
    </p></div></div>
  </body>
</html>
