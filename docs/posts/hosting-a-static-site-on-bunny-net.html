<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bugwhisperer.dev/blog/static-site-hosting-on-bunnynet/">Original</a>
    <h1>Hosting A Static Site On Bunny.net</h1>
    
    <div id="readability-page-1" class="page"><div id="main-content"><p><span><a href="https://github.com/tags/web-dev">web-dev</a></span></p><p>I have been looking around for a new place to host this website for a while now. <a href="https://bunny.net/?ref=toxnfh7k0d" rel="noopener" target="_blank">Bunny.Net</a> is a European cloud service provider based in Slovenia that offers CDN services, storage solutions, and serverless functions at competitive prices. After exploring several options, I found it to be the perfect solution for my needs.</p><p>Initially, I was mostly happy with SourceHut‚Äôs <a href="https://srht.site/" rel="noopener" target="_blank">pages hosting service</a>. However, I wanted to add a form where visitors could submit questions or send me messages. This required a backend server to process POST submissions and notify me‚Äîsomething not possible with SourceHut‚Äôs static-only hosting. It was important to maintain a static site setup while adding serverless functions only where needed, avoiding the overhead of a full backend server which would be excessive for this primarily static site.</p><p>I first tried CloudFlare Workers but abandoned that path when I realized I would need to move my domain DNS entirely to their platform. Next, I briefly tested AWS Lambdas but decided against further entanglement with US-based services. Fortunately, I discovered Bunny.Net, which fit my criteria perfectly: affordable, easy to set up, offering serverless function capabilities, and EU-based. I‚Äôll break down what it took to get this site up and running (spoiler: less than a day including serverless function code writing). Join me!</p><h2 id="dns-transfer">DNS Transfer</h2><p>I wasn‚Äôt initially planning on doing this step, but decided it was a good opportunity to pull DNS under the same roof. I first downloaded a Zone File from my DNS provider. Then I hopped over to Bunny.net and imported the file. Boom! All ~40 of my DNS records were setup! üòç The only thing left was to update my domain registrar with the new nameservers that pointed to Bunny.net.</p><h2 id="setting-up-the-static-site">Setting up the static site</h2><p>If you are familiar with AWS tools and services, much of Bunny.net will seem familiar (same services, different names).</p><table><thead><tr><th>Bunny.Net</th><th>AWS</th></tr></thead><tbody><tr><td>Storage Zone</td><td>S3 Buckets</td></tr><tr><td>Pull Zone</td><td>CloudFront</td></tr><tr><td>Edge Scripting</td><td>Lambda Functions</td></tr></tbody></table><h3 id="storage-zone">Storage Zone</h3><p>Storage Zones are the ‚Äúorigin‚Äù for all of your site‚Äôs files and contents. It‚Äôs the filesystem that holds HTML, CSS, JavaScript, image files, etc. These Zones can have optional replication zones enabled. This essentially duplicates your files at various geographic server locations. There‚Äôs an additional cost for each replication zone added (though it seems to be a log-based cost curve). This is important because Storage Zones serve as origin points when a user goes to your site and there is not a cached version of the request found. If latency is a concern, having origin points as close to your end users as possible will help with this. I decided to go all in, since it came out to ~$0.055 per GB to have all the Storage Zone replication options enabled. This protects my site uptime from all but a global catastrophe and provides my readers with as fast as possible connection times all for around $0.01 per month. My site is very lite and has very few static assets to speak of. As the size grows that number will go up, but I don‚Äôt expect to measurably move the needle on that for quite a long time.</p><h3 id="pull-zone">Pull Zone</h3><p>Storage Zones are the source that Pull Zones, the edge cache endpoints, are using to fetch and serve your static site‚Äôs data from. Cache misses fall back to the Storage Zone origin and the file gets cached and propagated. The site‚Äôs domain is linked to the Pull Zone endpoint URL via a DNS CNAME record. There are a bunch of settings that can be used to set cache duration times and other options like setting headers.</p><p>Pull Zones can have powerful ‚ÄúRules‚Äù that can be set up to match against various combinations of criteria from incoming requests, such as HTTP Method, content-type, or URL path. For example, you could create a rule that redirects mobile users to a mobile-optimized version of your site, blocks requests from specific countries, or forwards requests with a specific URL pattern (like ‚Äú/api/*‚Äù) to an Edge Script. These rules follow a condition-action model where you define what to match and what to do when that match occurs, giving you granular control over your content delivery without writing custom code.</p><h3 id="edge-script">Edge Script</h3><p>Bunny.net‚Äôs answer to AWS Lambdas, these Edge Scripts function in much the same way. There‚Äôs two ‚Äúflavors‚Äù: middleware and standalone scripts. Middleware scripts allow modification of headers or authentication checks from within the CDN request flow. Standalone scripts are given their own URL and take requests and return responses. It‚Äôs the latter that I used to make a form processing endpoint for my ‚ÄúAsk-Me-Anything‚Äù form. The online Edge Script editor was nice enough to use and there‚Äôs also integrations with GitHub to manage and deploy new scripts. The billing for scripting is a bit different from AWS, in that your total script compute usage and requests served count towards a billing threshold. It starts at $0.20 per million requests and $0.02 / 1000 seconds of compute time. This means there‚Äôs a base cost of $0.22 to use the Edge Scripting.</p><p>This is where Bunny.net falters compared to some of the competitors (Fly.io, Netlify, etc). While there‚Äôs no <code>awscli</code> tooling or something like <code>SAM</code> to deploy infrastructure, they do have an API that‚Äôs easy to understand and comes with a ‚Äúrequest builder‚Äù for each of the endpoints that should feel familiar for those who‚Äôve worked with API docs before. I grabbed my API Key from the Admin settings area of my Profile and got to work to build a script that would build my blog, sync up the changed files, and finally bust the CDN cache if needed. The end goal was to have a simple bash script to glue these various actions together with the help of some local environment variables.</p><h3 id="step-1-build-the-blog">Step 1: Build the blog</h3><p>The blog building step was a simple <code>zola build</code> to create a <code>public</code> folder that had all of my site‚Äôs files ready.</p><h3 id="step-2-ftp-files-up-to-bunny-net">Step 2: FTP files up to Bunny.Net</h3><p>Doing an FTP push of <strong>all</strong> the blog files was not hard. The original setup I had used the tool <a href="https://lftp.yar.ru/" rel="noopener" target="_blank">lftp</a> and looked like this:</p><pre data-lang="sh"><code data-lang="sh"><span>lftp</span><span> -c </span><span>&#34;set -a ftp:list-options;
</span><span>	open &#39;$</span><span>FTPURL</span><span>&#39;;
</span><span>	lcd $</span><span>LCD</span><span>;
</span><span>	cd $</span><span>RCD</span><span>;
</span><span>	mirror --reverse --use-cache --verbose --allow-chown --allow-suid --no-umask --parallel=2 --exclude-glob --verbose --delete&#34;
</span></code></pre><p>When thinking about the temperamental nature of the internet where I live, I didn‚Äôt want to waste time and bandwidth pushing lots of files if only 1-2 files might have changed between deployments. Trying to achieve FTP synchronization proved to be tricky. Fortunately after a few false starts and failed attempts, I lucked out and stumbled upon a Go lang tool <a href="https://github.com/skibish/bunnysync" rel="noopener" target="_blank">Bunnysync</a> that fit the bill perfectly. It handles tracking what files changed and pushing up only ones needed updating. Bunnysync keeps track of changed files uploaded in a log file.</p><h3 id="step-3-bust-the-cache">Step 3: Bust the cache</h3><p>For this last step it‚Äôs a simple matter of first checking if the log file from Bunnysync had uploaded any files. If the answer is yes, we POST a request to the Bunny.Net API via curl to bust the cache of our Pull Zone CDN. And that‚Äôs it! The newly updated files would propagate from Storage to the Edge CDN and get served to users.</p><h3 id="pulling-it-all-together">Pulling it all together!</h3><p>Here‚Äôs the final script if you‚Äôre interested in the details or trying to automate something similar:</p><pre data-lang="sh"><code data-lang="sh"><span>#!/bin/sh
</span><span>set </span><span>-e
</span><span>
</span><span># Fresh build of site to public folder
</span><span>cd </span><span>$PRJ_DIR
</span><span>zola</span><span> build
</span><span>
</span><span># Sync newly build site to Bunny.net Storage
</span><span>bunnysync</span><span> -src </span><span>$PRJ_DIR/public</span><span> -zone-name </span><span>$BUNNY_STORAGE_ZONE</span><span> -password </span><span>$BUNNY_PSWD </span><span>| </span><span>tee </span><span>$HOME/bunnysync.log
</span><span>echo </span><span>&#34;‚úÖ Sync&#39;d Zola site to Bunny.net Storage!&#34;
</span><span>
</span><span># Check if need to bust the Pull Zone cache
</span><span>line_count</span><span>=</span><span>$</span><span>(</span><span>wc</span><span> -l </span><span>&lt; </span><span>$</span><span>HOME</span><span>/bunnysync.log</span><span>)
</span><span>if </span><span>[ </span><span>&#34;$</span><span>line_count</span><span>&#34; </span><span>-eq</span><span> 0 </span><span>]</span><span>; </span><span>then
</span><span>  </span><span>echo </span><span>&#34;Nothing needed to be refresh in Pull Zone cache.&#34;
</span><span>  </span><span>exit</span><span> 0
</span><span>else
</span><span>  </span><span>curl</span><span> --show-error </span><span>\
</span><span>    --request</span><span> POST </span><span>\
</span><span>    --url</span><span> https://api.bunny.net/pullzone/$BUNNY_PULL_ZONE/purgeCache </span><span>\
</span><span>    --header </span><span>&#39;AccessKey: $BUNNY_API_KEY&#39; </span><span>\
</span><span>    --header </span><span>&#39;content-type: application/json&#39;
</span><span>  </span><span>echo </span><span>&#34;‚úÖ Cache busted for Bunny.net Pull Zone!&#34;
</span><span>fi
</span></code></pre><h2 id="cost-comparison">Cost Comparison</h2><p>Here‚Äôs a rough comparison of the costs between Bunny.net and some of the other alternatives:</p><table><thead><tr><th>Service</th><th>Monthly Cost</th><th>Notes</th></tr></thead><tbody><tr><td>Bunny.net</td><td>~$0.23</td><td>$0.01 for storage, $0.22 for Edge Script usage</td></tr><tr><td>AWS</td><td>~$1.50+</td><td>S3 + Lambda + CloudFront minimum costs</td></tr><tr><td>Netlify</td><td>$0-$19</td><td>Free tier limited, paid tier starts at $19/month</td></tr><tr><td>Cloudflare Pages</td><td>$0-$20</td><td>Free tier with limitations, $20/month for pro</td></tr></tbody></table><p>For my small site, with minimal traffic, Bunny.net represents a significant savings while providing all the features I need.</p><h2 id="conclusion">Conclusion</h2><p>This setup gets me a globally available, fast and caching-aware, scripting-ready website that I can build upon and add more dynamic features as needed. The tooling is not as slick as AWS though, but a little bit of scripting on my end, plus some other tools, took care of most of the major needs and pain points I would expect to have.</p><p>The combination of static site hosting with targeted serverless functions has proven to be the right approach for my needs‚Äîmaintaining simplicity while adding just enough backend capability to support features like contact forms. Time will tell, but I‚Äôm quite optimistic with how this turned out!</p></div></div>
  </body>
</html>
