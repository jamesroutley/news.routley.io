<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Florents-Tselai/WarcDB">Original</a>
    <h1>Show HN: WarcDB: Web crawl data as SQLite databases</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><code>WarcDB</code> is a an <code>SQLite</code>-based file format that makes web crawl data easier to share and query.</p>
<p dir="auto">It is based on the standardized <a href="https://en.wikipedia.org/wiki/Web_ARChive" rel="nofollow">Web ARChive format</a>,
used by web archivers.</p>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<div data-snippet-clipboard-copy-content="pip install warcdb"><pre>pip install warcdb</pre></div>
<div data-snippet-clipboard-copy-content="
# Load the `archive.warcdb` file with data.
warcdb import archive.warcdb ./tests/google.warc ./tests/frontpages.warc.gz &#34;https://tselai.com/data/google.warc&#34;

warcdb enable-fts ./archive.warcdb response payload

# Saarch for records that mention &#34;stocks&#34; in their response body
warcdb search ./archive.warcdb response &#34;stocks&#34; -c &#34;WARC-Record-ID&#34;"><pre><span><span>#</span> Load the `archive.warcdb` file with data.</span>
warcdb import archive.warcdb ./tests/google.warc ./tests/frontpages.warc.gz <span><span>&#34;</span>https://tselai.com/data/google.warc<span>&#34;</span></span>

warcdb enable-fts ./archive.warcdb response payload

<span><span>#</span> Saarch for records that mention &#34;stocks&#34; in their response body</span>
warcdb search ./archive.warcdb response <span><span>&#34;</span>stocks<span>&#34;</span></span> -c <span><span>&#34;</span>WARC-Record-ID<span>&#34;</span></span></pre></div>
<p dir="auto">As you can see you can use any mix of local/remote and raw/compressed archives.</p>
<p dir="auto">For example to get a part of the <a href="https://data.commoncrawl.org/crawl-data/CC-MAIN-2022-05/index.html" rel="nofollow">Common Crawl January 2022 Crawl Archive </a> in a streaming fashion:</p>
<div data-snippet-clipboard-copy-content="warcdb import archive.warcdb &#34;https://data.commoncrawl.org/crawl-data/CC-MAIN-2022-05/segments/1642320306346.64/warc/CC-MAIN-20220128212503-20220129002503-00719.warc.gz"><pre>warcdb import archive.warcdb <span><span>&#34;</span>https://data.commoncrawl.org/crawl-data/CC-MAIN-2022-05/segments/1642320306346.64/warc/CC-MAIN-20220128212503-20220129002503-00719.warc.gz</span></pre></div>
<h2 dir="auto"><a id="user-content-how-it-works" aria-hidden="true" href="#how-it-works"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How It Works</h2>
<p dir="auto">Individual <code>.warc</code> files are read and parsed and their data is inserted into an SQLite database with the relational schema seen below.</p>
<h2 dir="auto"><a id="user-content-schema" aria-hidden="true" href="#schema"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Schema</h2>
<p dir="auto">Here&#39;s the relational schema of the <code>.warcdb</code> file.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://commoncog.com/Florents-Tselai/WarcDB/blob/main/schema.png"><img src="https://commoncog.com/Florents-Tselai/WarcDB/raw/main/schema.png" alt="WarcDB Schema"/></a></p>
<h2 dir="auto"><a id="user-content-motivation" aria-hidden="true" href="#motivation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Motivation</h2>
<p dir="auto">From the <code>WARC</code> <a href="https://iipc.github.io/warc-specifications/specifications/warc-format/warc-1.1/" rel="nofollow">formal specification</a>:</p>
<blockquote>
<p dir="auto">The WARC (Web ARChive) file format offers a convention for concatenating multiple resource records (data objects),
each consisting of a set of simple text headers and an arbitrary data block into one long file.</p>
</blockquote>
<p dir="auto">Many organizations such as Commoncrawl, WebRecorder, Archive.org and libraries around the world, use the <code>warc</code> format
to archive and store web data.</p>
<p dir="auto">The full datasets of these services range in the few pebibytes(PiB),
making them impractical to query using non-distributed systems.</p>
<p dir="auto">This project aims to make <strong>subsets</strong> such data easier to access and query using SQL.</p>
<p dir="auto">Currently, this is implemented on top of SQLite and is a wrapper around the
excellent <a href="https://sqlite-utils.datasette.io/en/stable/" rel="nofollow">SQLite-Utils</a> utility.</p>
<p dir="auto"><code>&#34;wrapper&#34;</code> means that all
existing <code>sqlite-utils</code> <a href="https://sqlite-utils.datasette.io/en/stable/cli-reference.html" rel="nofollow">CLI commands</a>
can be called as expected like</p>
<div data-snippet-clipboard-copy-content="sqlite-utils &lt;command&gt; archive.warcdb`"><pre>sqlite-utils <span>&lt;</span>command<span>&gt;</span> archive.warcdb<span><span>`</span></span></pre></div>
<p dir="auto">or</p>
<div data-snippet-clipboard-copy-content="warcdb &lt;command&gt; example.warcdb"><pre>warcdb <span>&lt;</span>command<span>&gt;</span> example.warcdb</pre></div>
<h2 dir="auto"><a id="user-content-examples" aria-hidden="true" href="#examples"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Examples</h2>
<h3 dir="auto"><a id="user-content-populate-with-wget" aria-hidden="true" href="#populate-with-wget"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Populate with <code>wget</code></h3>
<div data-snippet-clipboard-copy-content="wget --warc-file tselai &#34;https://tselai.com&#34;

warcdb import archive.warcdb tselai.warc.gz"><pre>wget --warc-file tselai <span><span>&#34;</span>https://tselai.com<span>&#34;</span></span>

warcdb import archive.warcdb tselai.warc.gz</pre></div>
<h3 dir="auto"><a id="user-content-get-all-response-headers" aria-hidden="true" href="#get-all-response-headers"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Get all response headers</h3>
<div data-snippet-clipboard-copy-content="sqlite3 archive.warcdb &lt;&lt;SQL
select  json_extract(h.value, &#39;$.header&#39;) as header, 
        json_extract(h.value, &#39;$.value&#39;) as value
from response,
     json_each(http_headers) h
SQL"><pre>sqlite3 archive.warcdb <span><span>&lt;&lt;</span><span>SQL</span></span>
<span>select  json_extract(h.value, &#39;$.header&#39;) as header, </span>
<span>        json_extract(h.value, &#39;$.value&#39;) as value</span>
<span>from response,</span>
<span>     json_each(http_headers) h</span>
<span><span>SQL</span></span></pre></div>
<h3 dir="auto"><a id="user-content-get-cookie-headers-for-requests-and-responses" aria-hidden="true" href="#get-cookie-headers-for-requests-and-responses"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Get Cookie Headers for requests and responses</h3>
<div data-snippet-clipboard-copy-content="sqlite3 archive.warcdb &lt;&lt;SQL
select json_extract(h.value, &#39;$.header&#39;) as header, json_extract(h.value, &#39;$.value&#39;) as value
from response,
     json_each(http_headers) h
where json_extract(h.value, &#39;$.header&#39;) like &#39;%Cookie%&#39;
union
select json_extract(h.value, &#39;$.header&#39;) as header, json_extract(h.value, &#39;$.value&#39;) as value
from request,
     json_each(http_headers) h
where json_extract(h.value, &#39;$.header&#39;) like &#39;%Cookie%&#39;
SQL"><pre>sqlite3 archive.warcdb <span><span>&lt;&lt;</span><span>SQL</span></span>
<span>select json_extract(h.value, &#39;$.header&#39;) as header, json_extract(h.value, &#39;$.value&#39;) as value</span>
<span>from response,</span>
<span>     json_each(http_headers) h</span>
<span>where json_extract(h.value, &#39;$.header&#39;) like &#39;%Cookie%&#39;</span>
<span>union</span>
<span>select json_extract(h.value, &#39;$.header&#39;) as header, json_extract(h.value, &#39;$.value&#39;) as value</span>
<span>from request,</span>
<span>     json_each(http_headers) h</span>
<span>where json_extract(h.value, &#39;$.header&#39;) like &#39;%Cookie%&#39;</span>
<span><span>SQL</span></span></pre></div>
<h2 dir="auto"><a id="user-content-resources-on-warc" aria-hidden="true" href="#resources-on-warc"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Resources on WARC</h2>
<ul dir="auto">
<li><a href="https://archive-it.org/blog/post/the-stack-warc-file/" rel="nofollow">The stack: An introduction to the WARC file</a></li>
</ul>
</article>
          </div></div>
  </body>
</html>
