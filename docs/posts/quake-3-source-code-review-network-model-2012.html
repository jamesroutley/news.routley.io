<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://fabiensanglard.net/quake3/network.php">Original</a>
    <h1>Quake 3 Source Code Review: Network Model (2012)</h1>
    
    <div id="readability-page-1" class="page"><div id="main">
           
					
			



    





<!-- / #header -->
<section id="content" role="main">



		


<p>
       June 30, 2012</p>
   <a href="https://fabiensanglard.net/quake3/qvm.php">
   </a><p id="paperbox"><a href="https://fabiensanglard.net/quake3/qvm.php">
	   	
          </a><a href="https://fabiensanglard.net/quake3/index.php">
          <img src="https://fabiensanglard.net/quake3/quake3_icon.jpg"/>   
          </a> 
         

The network model of Quake3 is with no doubt the most elegant part of the engine. At the lower level Quake III still abstract communications
with the <a href="https://fabiensanglard.net/quakeSource/quakeSourceNetWork.php">NetChannel module that first appeared in Quake World</a>.
The most important thing to understand is:</p><ul>
    <li>Encryption using preshared key.</li>
    <li>Compression with pre-computed huffman key.</li>
</ul>




<h3>Architecture</h3>
<p id="paperbox">
The Client side of the network model is fairly simple: Client sends commands to the Server each frame and receive update for the gamestate. The Server side is as bit more complex since it has to propagate the Master gamestate to each Client while accounting for lost UDP packets. This mechanism features three key elements:</p><ul>
  <li>A <b>Master Gamestate</b> that is the universal true state of things. Clients send theirs commands on the Netchannel. They are transformed in event_t which will modifiy the state of the game when they arrive on the Server.</li>
  <li>For each Client the server keeps the <b>32 last gamestate</b> sent over the network in a cycling array: They are called snapshots. The array cycle with the famous binary mask trick I mentioned in Quake World Network (<a href="http://fabiensanglard.net/quakeSource/quakeSourceNetWork.php">Some elegant things</a>).</li>
  <li>The server also features <b>a &#34;dummy&#34; gamestate</b> with every single field set to zero. This is used to delta snapshots when there is no &#34;previous state&#34; available.</li>
 </ul>
 <p>
When the server decides to send an update to a client it uses each three elements in order to generate a message that is then carried over the NetChannel.</p>


<h3>Snapshot systems</h3>
<p id="paperbox">
In order to understand the snapshop system, here is an example with the following conditions:
</p><ul>
    <li>The server is sending update to a Client1.</li>
    <li>The server is attempting to propagate the state of Client2 which has four 4  fields (3 ints position[X], position[Y], position[Z] and one int health).</li>
    <li>Communication are done over UDP/IP: Those messages gets lost quite often on the internet.</li>
</ul>
<!-- <h2>Comments</h2>
<p> -->


     <!-- <div id="disqus_thread"></div> -->
    <!-- <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'fabiensanglardswebsite'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || 
                document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> -->
    <!--<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->
<!--     




</p> -->

 


		</section></div></div>
  </body>
</html>
