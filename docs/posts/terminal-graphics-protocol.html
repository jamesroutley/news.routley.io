<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://sw.kovidgoyal.net/kitty/graphics-protocol/">Original</a>
    <h1>Terminal graphics protocol</h1>
    
    <div id="readability-page-1" class="page"><article role="main">
          <section id="terminal-graphics-protocol">

<p>The goal of this specification is to create a flexible and performant protocol
that allows the program running in the terminal, hereafter called the <em>client</em>,
to render arbitrary pixel (raster) graphics to the screen of the terminal
emulator. The major design goals are:</p>
<ul>
<li><p>Should not require terminal emulators to understand image formats.</p></li>
<li><p>Should allow specifying graphics to be drawn at individual pixel positions.</p></li>
<li><p>The graphics should integrate with the text, in particular it should be possible to draw graphics
below as well as above the text, with alpha blending. The graphics should also scroll with the text, automatically.</p></li>
<li><p>Should use optimizations when the client is running on the same computer as the terminal emulator.</p></li>
</ul>
<p>For some discussion regarding the design choices, see <a href="https://github.com/kovidgoyal/kitty/issues/33">#33</a>.</p>
<p>To see a quick demo, inside a <em>kitty</em> terminal run:</p>
<div><div><pre><span></span><span>kitten</span> <span>icat</span> <span>path</span><span>/</span><span>to</span><span>/</span><span>some</span><span>/</span><span>image</span><span>.</span><span>png</span>
</pre></div>
</div>
<p>You can also see a screenshot with more sophisticated features such as
alpha-blending and text over graphics.</p>
<img alt="Demo of graphics rendering in kitty" src="https://user-images.githubusercontent.com/1308621/31647475-1188ab66-b326-11e7-8d26-24b937f1c3e8.png"/>
<p>Some programs and libraries that use the kitty graphics protocol:</p>
<ul>
<li><p><a href="https://github.com/dsanson/termpdf.py">termpdf.py</a> - a terminal PDF/DJVU/CBR viewer</p></li>
<li><p><a href="https://github.com/ranger/ranger">ranger</a> - a terminal file manager, with image previews</p></li>
<li><p><a href="https://sw.kovidgoyal.net/kitty/kittens/diff/"><span>kitty-diff</span></a> - a side-by-side terminal diff program with support for images</p></li>
<li><p><a href="https://github.com/jesvedberg/tpix">tpix</a> - a statically compiled binary that can be used to display images and easily installed on remote servers without root access</p></li>
<li><p><a href="https://github.com/mpv-player/mpv/commit/874e28f4a41a916bb567a882063dd2589e9234e1">mpv</a> - A video player that can play videos in the terminal</p></li>
<li><p><a href="https://github.com/mirukana/pixcat">pixcat</a> - a third party CLI and python library that wraps the graphics protocol</p></li>
<li><p><a href="https://github.com/dylanaraps/neofetch">neofetch</a> - A command line system
information tool</p></li>
<li><p><a href="https://github.com/atanunq/viu">viu</a> - a terminal image viewer</p></li>
<li><p><a href="https://ctx.graphics/">ctx.graphics</a> - Library for drawing graphics</p></li>
<li><p><a href="https://github.com/hzeller/timg">timg</a> - a terminal image and video viewer</p></li>
<li><p><a href="https://github.com/dankamongmen/notcurses">notcurses</a> - C library for terminal graphics with bindings for C++, Rust and Python</p></li>
<li><p><a href="https://github.com/BourgeoisBear/rasterm">rasterm</a>  - Go library to display images in the terminal</p></li>
<li><p><a href="https://github.com/hpjansson/chafa">chafa</a>  - a terminal image viewer</p></li>
<li><p><a href="https://github.com/edluffy/hologram.nvim">hologram.nvim</a>  - view images inside nvim</p></li>
<li><p><a href="https://github.com/romgrk/kui.nvim">kui.nvim</a>  - Build sophisticated UIs inside neovim using the kitty graphics protocol</p></li>
<li><p><a href="https://github.com/3rd/image.nvim">image.nvim</a> - Bringing images to neovim</p></li>
<li><p><a href="https://github.com/AnonymouX47/term-image">term-image</a>  - A Python library, CLI and TUI to display and browse images in the terminal</p></li>
<li><p><a href="https://github.com/michaeljclark/glkitty">glkitty</a> - C library to draw OpenGL shaders in the terminal with a glgears demo</p></li>
<li><p><a href="https://github.com/Xithrius/twitch-tui">twitch-tui</a> - Twitch chat in the terminal</p></li>
<li><p><a href="https://github.com/chase/awrit">awrit</a> - Chromium-based web browser rendered in Kitty with mouse and keyboard support</p></li>
<li><p><a href="https://github.com/junegunn/fzf/commit/d8188fce7b7bea982e7f9050c35e488e49fb8fd0">fzf</a> - A command line fuzzy finder</p></li>
</ul>
<p>Other terminals that have implemented the graphics protocol:</p>
<ul>
<li><p><a href="https://github.com/wez/wezterm/issues/986">WezTerm</a></p></li>
<li><p><a href="https://invent.kde.org/utilities/konsole/-/merge_requests/594">Konsole</a></p></li>
<li><p><a href="https://github.com/91861/wayst">wayst</a></p></li>
</ul>
<section id="getting-the-window-size">
<h2>Getting the window size<a href="#getting-the-window-size" title="Link to this heading">#</a></h2>
<p>In order to know what size of images to display and how to position them, the
client must be able to get the window size in pixels and the number of cells
per row and column. The cell width is then simply the window size divided by the
number of rows. This can be done by using the <code><span>TIOCGWINSZ</span></code> ioctl. Some
code to demonstrate its use</p>
<div>
<p><label for="tab-set--0-input--1">C</label></p><div>
<div><div><pre><span></span><span>#include</span><span> </span><span>&lt;stdio.h&gt;</span>
<span>#include</span><span> </span><span>&lt;sys/ioctl.h&gt;</span>

<span>int</span><span> </span><span>main</span><span>(</span><span>int</span><span> </span><span>argc</span><span>,</span><span> </span><span>char</span><span> </span><span>**</span><span>argv</span><span>)</span><span> </span><span>{</span>
<span>    </span><span>struct</span><span> </span><span>winsize</span><span> </span><span>sz</span><span>;</span>
<span>    </span><span>ioctl</span><span>(</span><span>0</span><span>,</span><span> </span><span>TIOCGWINSZ</span><span>,</span><span> </span><span>&amp;</span><span>sz</span><span>);</span>
<span>    </span><span>printf</span><span>(</span>
<span>        </span><span>&#34;number of rows: %i, number of columns: %i, screen width: %i, screen height: %i</span><span>\n</span><span>&#34;</span><span>,</span>
<span>        </span><span>sz</span><span>.</span><span>ws_row</span><span>,</span><span> </span><span>sz</span><span>.</span><span>ws_col</span><span>,</span><span> </span><span>sz</span><span>.</span><span>ws_xpixel</span><span>,</span><span> </span><span>sz</span><span>.</span><span>ws_ypixel</span><span>);</span>
<span>    </span><span>return</span><span> </span><span>0</span><span>;</span>
<span>}</span>
</pre></div>
</div>
</div>
<p><label for="tab-set--0-input--2">Python</label></p><div>
<div><div><pre><span></span><span>import</span> <span>array</span><span>,</span> <span>fcntl</span><span>,</span> <span>sys</span><span>,</span> <span>termios</span>
<span>buf</span> <span>=</span> <span>array</span><span>.</span><span>array</span><span>(</span><span>&#39;H&#39;</span><span>,</span> <span>[</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>,</span> <span>0</span><span>])</span>
<span>fcntl</span><span>.</span><span>ioctl</span><span>(</span><span>sys</span><span>.</span><span>stdout</span><span>,</span> <span>termios</span><span>.</span><span>TIOCGWINSZ</span><span>,</span> <span>buf</span><span>)</span>
<span>print</span><span>((</span>
    <span>&#39;number of rows: </span><span>{}</span><span> number of columns: </span><span>{}</span><span>&#39;</span>
    <span>&#39;screen width: </span><span>{}</span><span> screen height: </span><span>{}</span><span>&#39;</span><span>)</span><span>.</span><span>format</span><span>(</span><span>*</span><span>buf</span><span>))</span>
</pre></div>
</div>
</div>
<p><label for="tab-set--0-input--3">Go</label></p><div>
<div><div><pre><span></span><span>package</span><span> </span><span>main</span>

<span>import</span><span> </span><span>(</span>
<span>    </span><span>&#34;fmt&#34;</span>
<span>    </span><span>&#34;os&#34;</span>

<span>    </span><span>&#34;golang.org/x/sys/unix&#34;</span>
<span>)</span>

<span>func</span><span> </span><span>main</span><span>()</span><span> </span><span>{</span>
<span>    </span><span>var</span><span> </span><span>err</span><span> </span><span>error</span>
<span>    </span><span>var</span><span> </span><span>f</span><span> </span><span>*</span><span>os</span><span>.</span><span>File</span>
<span>    </span><span>if</span><span> </span><span>f</span><span>,</span><span> </span><span>err</span><span> </span><span>=</span><span> </span><span>os</span><span>.</span><span>OpenFile</span><span>(</span><span>&#34;/dev/tty&#34;</span><span>,</span><span> </span><span>unix</span><span>.</span><span>O_NOCTTY</span><span>|</span><span>unix</span><span>.</span><span>O_CLOEXEC</span><span>|</span><span>unix</span><span>.</span><span>O_NDELAY</span><span>|</span><span>unix</span><span>.</span><span>O_RDWR</span><span>,</span><span> </span><span>0666</span><span>);</span><span> </span><span>err</span><span> </span><span>==</span><span> </span><span>nil</span><span> </span><span>{</span>
<span>        </span><span>var</span><span> </span><span>sz</span><span> </span><span>*</span><span>unix</span><span>.</span><span>Winsize</span>
<span>        </span><span>if</span><span> </span><span>sz</span><span>,</span><span> </span><span>err</span><span> </span><span>=</span><span> </span><span>unix</span><span>.</span><span>IoctlGetWinsize</span><span>(</span><span>int</span><span>(</span><span>f</span><span>.</span><span>Fd</span><span>()),</span><span> </span><span>unix</span><span>.</span><span>TIOCGWINSZ</span><span>);</span><span> </span><span>err</span><span> </span><span>==</span><span> </span><span>nil</span><span> </span><span>{</span>
<span>            </span><span>fmt</span><span>.</span><span>Printf</span><span>(</span><span>&#34;rows: %v columns: %v width: %v height %v\n&#34;</span><span>,</span><span> </span><span>sz</span><span>.</span><span>Row</span><span>,</span><span> </span><span>sz</span><span>.</span><span>Col</span><span>,</span><span> </span><span>sz</span><span>.</span><span>Xpixel</span><span>,</span><span> </span><span>sz</span><span>.</span><span>Ypixel</span><span>)</span>
<span>            </span><span>return</span>
<span>        </span><span>}</span>
<span>    </span><span>}</span>
<span>    </span><span>fmt</span><span>.</span><span>Fprintln</span><span>(</span><span>os</span><span>.</span><span>Stderr</span><span>,</span><span> </span><span>err</span><span>)</span>
<span>    </span><span>os</span><span>.</span><span>Exit</span><span>(</span><span>1</span><span>)</span>
<span>}</span>
</pre></div>
</div>
</div>
<p><label for="tab-set--0-input--4">Bash</label></p><div>
<div><div><pre><span></span><span>#!/bin/bash</span>

<span># This uses the kitten standalone binary from kitty to get the pixel sizes</span>
<span># since we can&#39;t do IOCTLs directly. Fortunately, kitten is a static exe</span>
<span># pre-built for every Unix like OS under the sun.</span>

<span>builtin</span><span> </span><span>read</span><span> </span>-r<span> </span>rows<span> </span>cols<span> </span>&lt;<span> </span>&lt;<span>(</span><span>command</span><span> </span>stty<span> </span>size<span>)</span>
<span>IFS</span><span>=</span>x<span> </span><span>builtin</span><span> </span><span>read</span><span> </span>-r<span> </span>width<span> </span>height<span> </span>&lt;<span> </span>&lt;<span>(</span><span>command</span><span> </span>kitten<span> </span>icat<span> </span>--print-window-size<span>)</span><span>;</span><span> </span><span>builtin</span><span> </span><span>unset</span><span> </span>IFS
<span>builtin</span><span> </span><span>echo</span><span> </span><span>&#34;number of rows: </span><span>$rows</span><span> number of columns: </span><span>$cols</span><span> screen width: </span><span>$width</span><span> screen height: </span><span>$height</span><span>&#34;</span>
</pre></div>
</div>
</div>
</div>
<p>Note that some terminals return <code><span>0</span></code> for the width and height values. Such
terminals should be modified to return the correct values.  Examples of
terminals that return correct values: <code><span>kitty,</span> <span>xterm</span></code></p>
<p>You can also use the <em>CSI t</em> escape code to get the screen size. Send
<code><span>&lt;ESC&gt;[14t</span></code> to <code><span>STDOUT</span></code> and kitty will reply on <code><span>STDIN</span></code> with
<code><span>&lt;ESC&gt;[4;&lt;height&gt;;&lt;width&gt;t</span></code> where <code><span>height</span></code> and <code><span>width</span></code> are the window
size in pixels. This escape code is supported in many terminals, not just
kitty.</p>
</section>
<section id="a-minimal-example">
<h2>A minimal example<a href="#a-minimal-example" title="Link to this heading">#</a></h2>
<p>Some minimal code to display PNG images in kitty, using the most basic
features of the graphics protocol:</p>
<div>
<p><label for="tab-set--1-input--1">Bash</label></p><div>
<div><div><pre><span></span><span>#!/bin/bash</span>
transmit_png<span>()</span><span> </span><span>{</span>
<span>    </span><span>data</span><span>=</span><span>$(</span>base64<span> </span><span>&#34;</span><span>$1</span><span>&#34;</span><span>)</span>
<span>    </span><span>data</span><span>=</span><span>&#34;</span><span>${</span><span>data</span><span>//[[:</span><span>space</span><span>:]]</span><span>}</span><span>&#34;</span>
<span>    </span><span>builtin</span><span> </span><span>local</span><span> </span><span>pos</span><span>=</span><span>0</span>
<span>    </span><span>builtin</span><span> </span><span>local</span><span> </span><span>chunk_size</span><span>=</span><span>4096</span>
<span>    </span><span>while</span><span> </span><span>[</span><span> </span><span>$pos</span><span> </span>-lt<span> </span><span>${#</span><span>data</span><span>}</span><span> </span><span>]</span><span>;</span><span> </span><span>do</span>
<span>        </span><span>builtin</span><span> </span><span>printf</span><span> </span><span>&#34;\e_G&#34;</span>
<span>        </span><span>[</span><span> </span><span>$pos</span><span> </span><span>=</span><span> </span><span>&#34;0&#34;</span><span> </span><span>]</span><span> </span><span>&amp;&amp;</span><span> </span><span>printf</span><span> </span><span>&#34;a=T,f=100,&#34;</span>
<span>        </span><span>builtin</span><span> </span><span>local</span><span> </span><span>chunk</span><span>=</span><span>&#34;</span><span>${</span><span>data</span><span>:</span><span>$pos</span><span>:</span><span>$chunk_size</span><span>}</span><span>&#34;</span>
<span>        </span><span>pos</span><span>=</span><span>$((</span><span>$pos</span><span>+</span><span>$chunk_size</span><span>))</span>
<span>        </span><span>[</span><span> </span><span>$pos</span><span> </span>-lt<span> </span><span>${#</span><span>data</span><span>}</span><span> </span><span>]</span><span> </span><span>&amp;&amp;</span><span> </span><span>builtin</span><span> </span><span>printf</span><span> </span><span>&#34;m=1&#34;</span>
<span>        </span><span>[</span><span> </span><span>${#</span><span>chunk</span><span>}</span><span> </span>-gt<span> </span><span>0</span><span> </span><span>]</span><span> </span><span>&amp;&amp;</span><span> </span><span>builtin</span><span> </span><span>printf</span><span> </span><span>&#34;;%s&#34;</span><span> </span><span>&#34;</span><span>${</span><span>chunk</span><span>}</span><span>&#34;</span>
<span>        </span><span>builtin</span><span> </span><span>printf</span><span> </span><span>&#34;\e\\&#34;</span>
<span>    </span><span>done</span>
<span>}</span>

transmit_png<span> </span><span>&#34;</span><span>$1</span><span>&#34;</span>
</pre></div>
</div>
</div>
<p><label for="tab-set--1-input--2">Python</label></p><div>
<div><div><pre><span></span><span>#!/usr/bin/python</span>
<span>import</span> <span>sys</span>
<span>from</span> <span>base64</span> <span>import</span> <span>standard_b64encode</span>

<span>def</span> <span>serialize_gr_command</span><span>(</span><span>**</span><span>cmd</span><span>):</span>
    <span>payload</span> <span>=</span> <span>cmd</span><span>.</span><span>pop</span><span>(</span><span>&#39;payload&#39;</span><span>,</span> <span>None</span><span>)</span>
    <span>cmd</span> <span>=</span> <span>&#39;,&#39;</span><span>.</span><span>join</span><span>(</span><span>f</span><span>&#39;</span><span>{</span><span>k</span><span>}</span><span>=</span><span>{</span><span>v</span><span>}</span><span>&#39;</span> <span>for</span> <span>k</span><span>,</span> <span>v</span> <span>in</span> <span>cmd</span><span>.</span><span>items</span><span>())</span>
    <span>ans</span> <span>=</span> <span>[]</span>
    <span>w</span> <span>=</span> <span>ans</span><span>.</span><span>append</span>
    <span>w</span><span>(</span><span>b</span><span>&#39;</span><span>\033</span><span>_G&#39;</span><span>),</span> <span>w</span><span>(</span><span>cmd</span><span>.</span><span>encode</span><span>(</span><span>&#39;ascii&#39;</span><span>))</span>
    <span>if</span> <span>payload</span><span>:</span>
        <span>w</span><span>(</span><span>b</span><span>&#39;;&#39;</span><span>)</span>
        <span>w</span><span>(</span><span>payload</span><span>)</span>
    <span>w</span><span>(</span><span>b</span><span>&#39;</span><span>\033\\</span><span>&#39;</span><span>)</span>
    <span>return</span> <span>b</span><span>&#39;&#39;</span><span>.</span><span>join</span><span>(</span><span>ans</span><span>)</span>

<span>def</span> <span>write_chunked</span><span>(</span><span>**</span><span>cmd</span><span>):</span>
    <span>data</span> <span>=</span> <span>standard_b64encode</span><span>(</span><span>cmd</span><span>.</span><span>pop</span><span>(</span><span>&#39;data&#39;</span><span>))</span>
    <span>while</span> <span>data</span><span>:</span>
        <span>chunk</span><span>,</span> <span>data</span> <span>=</span> <span>data</span><span>[:</span><span>4096</span><span>],</span> <span>data</span><span>[</span><span>4096</span><span>:]</span>
        <span>m</span> <span>=</span> <span>1</span> <span>if</span> <span>data</span> <span>else</span> <span>0</span>
        <span>sys</span><span>.</span><span>stdout</span><span>.</span><span>buffer</span><span>.</span><span>write</span><span>(</span><span>serialize_gr_command</span><span>(</span><span>payload</span><span>=</span><span>chunk</span><span>,</span> <span>m</span><span>=</span><span>m</span><span>,</span>
                                                    <span>**</span><span>cmd</span><span>))</span>
        <span>sys</span><span>.</span><span>stdout</span><span>.</span><span>flush</span><span>()</span>
        <span>cmd</span><span>.</span><span>clear</span><span>()</span>

<span>with</span> <span>open</span><span>(</span><span>sys</span><span>.</span><span>argv</span><span>[</span><span>-</span><span>1</span><span>],</span> <span>&#39;rb&#39;</span><span>)</span> <span>as</span> <span>f</span><span>:</span>
    <span>write_chunked</span><span>(</span><span>a</span><span>=</span><span>&#39;T&#39;</span><span>,</span> <span>f</span><span>=</span><span>100</span><span>,</span> <span>data</span><span>=</span><span>f</span><span>.</span><span>read</span><span>())</span>
</pre></div>
</div>
</div>
</div>
<p>Save this script as <code><span>send-png</span></code>, then you can use it to display any PNG
file in kitty as:</p>
<div><div><pre><span></span><span>chmod</span> <span>+</span><span>x</span> <span>send</span><span>-</span><span>png</span>
<span>./</span><span>send</span><span>-</span><span>png</span> <span>file</span><span>.</span><span>png</span>
</pre></div>
</div>
</section>
<section id="the-graphics-escape-code">
<h2>The graphics escape code<a href="#the-graphics-escape-code" title="Link to this heading">#</a></h2>
<p>All graphics escape codes are of the form:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_G</span><span>&lt;</span><span>control</span> <span>data</span><span>&gt;</span><span>;</span><span>&lt;</span><span>payload</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>This is a so-called <em>Application Programming Command (APC)</em>. Most terminal
emulators ignore APC codes, making it safe to use.</p>
<p>The control data is a comma-separated list of <code><span>key=value</span></code> pairs.  The payload
is arbitrary binary data, base64-encoded to prevent interoperation problems
with legacy terminals that get confused by control codes within an APC code.
The meaning of the payload is interpreted based on the control data.</p>
<p>The first step is to transmit the actual image data.</p>
</section>
<section id="transferring-pixel-data">
<span id="id1"></span><h2>Transferring pixel data<a href="#transferring-pixel-data" title="Link to this heading">#</a></h2>
<p>The first consideration when transferring data between the client and the
terminal emulator is the format in which to do so. Since there is a vast and
growing number of image formats in existence, it does not make sense to have
every terminal emulator implement support for them. Instead, the client should
send simple pixel data to the terminal emulator. The obvious downside to this
is performance, especially when the client is running on a remote machine.
Techniques for remedying this limitation are discussed later. The terminal
emulator must understand pixel data in three formats, 24-bit RGB, 32-bit RGBA and
PNG. This is specified using the <code><span>f</span></code> key in the control data. <code><span>f=32</span></code> (which is the
default) indicates 32-bit RGBA data and <code><span>f=24</span></code> indicates 24-bit RGB data and <code><span>f=100</span></code>
indicates PNG data. The PNG format is supported both for convenience, and as a compact way
of transmitting paletted images.</p>
<section id="rgb-and-rgba-data">
<h3>RGB and RGBA data<a href="#rgb-and-rgba-data" title="Link to this heading">#</a></h3>
<p>In these formats the pixel data is stored directly as 3 or 4 bytes per pixel,
respectively. The colors in the data <strong>must</strong> be in the <em>sRGB color space</em>.  When
specifying images in this format, the image dimensions <strong>must</strong> be sent in the
control data. For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gf</span><span>=</span><span>24</span><span>,</span><span>s</span><span>=</span><span>10</span><span>,</span><span>v</span><span>=</span><span>20</span><span>;</span><span>&lt;</span><span>payload</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>Here the width and height are specified using the <code><span>s</span></code> and <code><span>v</span></code> keys respectively. Since
<code><span>f=24</span></code> there are three bytes per pixel and therefore the pixel data must be <code><span>3</span> <span>*</span> <span>10</span> <span>*</span> <span>20</span> <span>=</span> <span>600</span></code>
bytes.</p>
</section>
<section id="png-data">
<h3>PNG data<a href="#png-data" title="Link to this heading">#</a></h3>
<p>In this format any PNG image can be transmitted directly.  For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gf</span><span>=</span><span>100</span><span>;</span><span>&lt;</span><span>payload</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>The PNG format is specified using the <code><span>f=100</span></code> key. The width and height of
the image will be read from the PNG data itself. Note that if you use both PNG and
compression, then you must provide the <code><span>S</span></code> key with the size of the PNG data.</p>
</section>
<section id="compression">
<h3>Compression<a href="#compression" title="Link to this heading">#</a></h3>
<p>The client can send compressed image data to the terminal emulator, by
specifying the <code><span>o</span></code> key. Currently, only <span id="index-0"></span><a href="https://datatracker.ietf.org/doc/html/rfc1950.html"><strong>RFC 1950</strong></a> ZLIB based deflate
compression is supported, which is specified using <code><span>o=z</span></code>. For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gf</span><span>=</span><span>24</span><span>,</span><span>s</span><span>=</span><span>10</span><span>,</span><span>v</span><span>=</span><span>20</span><span>,</span><span>o</span><span>=</span><span>z</span><span>;</span><span>&lt;</span><span>payload</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>This is the same as the example from the RGB data section, except that the
payload is now compressed using deflate (this occurs prior to base64-encoding).
The terminal emulator will decompress it before rendering. You can specify
compression for any format. The terminal emulator will decompress before
interpreting the pixel data.</p>
</section>
<section id="the-transmission-medium">
<h3>The transmission medium<a href="#the-transmission-medium" title="Link to this heading">#</a></h3>
<p>The transmission medium is specified using the <code><span>t</span></code> key. The <code><span>t</span></code> key defaults to <code><span>d</span></code>
and can take the values:</p>
<div>
<table>
<thead>
<tr><th><p>Value of <cite>t</cite></p></th>
<th><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><code><span>d</span></code></p></td>
<td><p>Direct (the data is transmitted within the escape code itself)</p></td>
</tr>
<tr><td><p><code><span>f</span></code></p></td>
<td><p>A simple file (regular files only, not named pipes, device files, etc.)</p></td>
</tr>
<tr><td><p><code><span>t</span></code></p></td>
<td><p>A temporary file, the terminal emulator will delete the file after reading the pixel data. For security reasons
the terminal emulator should only delete the file if it
is in a known temporary directory, such as <code><span>/tmp</span></code>,
<code><span>/dev/shm</span></code>, <code><span>TMPDIR</span> <span>env</span> <span>var</span> <span>if</span> <span>present</span></code> and any platform
specific temporary directories and the file has the
string <code><span>tty-graphics-protocol</span></code> in its full file path.</p></td>
</tr>
<tr><td><p><code><span>s</span></code></p></td>
<td><p>A <em>shared memory object</em>, which on POSIX systems is a
<a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/shm_open.html">POSIX shared memory object</a>
and on Windows is a
<a href="https://docs.microsoft.com/en-us/windows/win32/memory/creating-named-shared-memory">Named shared memory object</a>.
The terminal emulator must read the data from the memory
object and then unlink and close it on POSIX and just
close it on Windows.</p></td>
</tr>
</tbody>
</table>
</div>
<p>When opening files, the terminal emulator must follow symlinks. In case of
symlink loops or too many symlinks, it should fail and respond with an error,
similar to reporting any other kind of I/O error. Since the file paths come
from potentially untrusted sources, terminal emulators <strong>must</strong> refuse to read
any device/socket/etc. special files. Only regular files are allowed.
Additionally, terminal emulators may refuse to read files in <em>sensitive</em>
parts of the filesystem, such as <code><span>/proc</span></code>, <code><span>/sys</span></code>, <code><span>/dev/</span></code>, etc.</p>
<section id="local-client">
<h4>Local client<a href="#local-client" title="Link to this heading">#</a></h4>
<p>First let us consider the local client techniques (files and shared memory). Some examples:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gf</span><span>=</span><span>100</span><span>,</span><span>t</span><span>=</span><span>f</span><span>;</span><span>&lt;</span><span>encoded</span> <span>/</span><span>path</span><span>/</span><span>to</span><span>/</span><span>file</span><span>.</span><span>png</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>Here we tell the terminal emulator to read PNG data from the specified file of
the specified size:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gs</span><span>=</span><span>10</span><span>,</span><span>v</span><span>=</span><span>2</span><span>,</span><span>t</span><span>=</span><span>s</span><span>,</span><span>o</span><span>=</span><span>z</span><span>;</span><span>&lt;</span><span>encoded</span> <span>/</span><span>some</span><span>-</span><span>shared</span><span>-</span><span>memory</span><span>-</span><span>name</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>Here we tell the terminal emulator to read compressed image data from
the specified shared memory object.</p>
<p>The client can also specify a size and offset to tell the terminal emulator
to only read a part of the specified file. The is done using the <code><span>S</span></code> and <code><span>O</span></code>
keys respectively. For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gs</span><span>=</span><span>10</span><span>,</span><span>v</span><span>=</span><span>2</span><span>,</span><span>t</span><span>=</span><span>s</span><span>,</span><span>S</span><span>=</span><span>80</span><span>,</span><span>O</span><span>=</span><span>10</span><span>;</span><span>&lt;</span><span>encoded</span> <span>/</span><span>some</span><span>-</span><span>shared</span><span>-</span><span>memory</span><span>-</span><span>name</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>This tells the terminal emulator to read <code><span>80</span></code> bytes starting from the offset <code><span>10</span></code>
inside the specified shared memory buffer.</p>
</section>
<section id="remote-client">
<h4>Remote client<a href="#remote-client" title="Link to this heading">#</a></h4>
<p>Remote clients, those that are unable to use the filesystem/shared memory to
transmit data, must send the pixel data directly using escape codes. Since
escape codes are of limited maximum length, the data will need to be chunked up
for transfer. This is done using the <code><span>m</span></code> key. The pixel data must first be
base64 encoded then chunked up into chunks no larger than <code><span>4096</span></code> bytes. All
chunks, except the last, must have a size that is a multiple of 4. The client
then sends the graphics escape code as usual, with the addition of an <code><span>m</span></code> key
that must have the value <code><span>1</span></code> for all but the last chunk, where it must be
<code><span>0</span></code>. For example, if the data is split into three chunks, the client would
send the following sequence of escape codes to the terminal emulator:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gs</span><span>=</span><span>100</span><span>,</span><span>v</span><span>=</span><span>30</span><span>,</span><span>m</span><span>=</span><span>1</span><span>;</span><span>&lt;</span><span>encoded</span> <span>pixel</span> <span>data</span> <span>first</span> <span>chunk</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
<span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gm</span><span>=</span><span>1</span><span>;</span><span>&lt;</span><span>encoded</span> <span>pixel</span> <span>data</span> <span>second</span> <span>chunk</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
<span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gm</span><span>=</span><span>0</span><span>;</span><span>&lt;</span><span>encoded</span> <span>pixel</span> <span>data</span> <span>last</span> <span>chunk</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>Note that only the first escape code needs to have the full set of control
codes such as width, height, format, etc. Subsequent chunks <strong>must</strong> have only
the <code><span>m</span></code> and optionally <code><span>q</span></code> keys. When sending animation frame data, subsequent
chunks <strong>must</strong> also specify the <code><span>a=f</span></code> key. The client <strong>must</strong> finish sending
all chunks for a single image before sending any other graphics related escape
codes. Note that the cursor position used to display the image <strong>must</strong> be the
position when the final chunk is received. Finally, terminals must not display
anything, until the entire sequence is received and validated.</p>
</section>
</section>
<section id="querying-support-and-available-transmission-mediums">
<h3>Querying support and available transmission mediums<a href="#querying-support-and-available-transmission-mediums" title="Link to this heading">#</a></h3>
<p>Since a client has no a-priori knowledge of whether it shares a filesystem/shared memory
with the terminal emulator, it can send an id with the control data, using the <code><span>i</span></code> key
(which can be an arbitrary positive integer up to 4294967295, it must not be zero).
If it does so, the terminal emulator will reply after trying to load the image, saying
whether loading was successful or not. For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gi</span><span>=</span><span>31</span><span>,</span><span>s</span><span>=</span><span>10</span><span>,</span><span>v</span><span>=</span><span>2</span><span>,</span><span>t</span><span>=</span><span>s</span><span>;</span><span>&lt;</span><span>encoded</span> <span>/</span><span>some</span><span>-</span><span>shared</span><span>-</span><span>memory</span><span>-</span><span>name</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>to which the terminal emulator will reply (after trying to load the data):</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gi</span><span>=</span><span>31</span><span>;</span><span>error</span> <span>message</span> <span>or</span> <span>OK</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>Here the <code><span>i</span></code> value will be the same as was sent by the client in the original
request.  The message data will be a ASCII encoded string containing only
printable characters and spaces. The string will be <code><span>OK</span></code> if reading the pixel
data succeeded or an error message.</p>
<p>Sometimes, using an id is not appropriate, for example, if you do not want to
replace a previously sent image with the same id, or if you are sending a dummy
image and do not want it stored by the terminal emulator. In that case, you can
use the <em>query action</em>, set <code><span>a=q</span></code>. Then the terminal emulator will try to load
the image and respond with either OK or an error, as above, but it will not
replace an existing image with the same id, nor will it store the image.</p>
<p>As of May 2023, kitty has a complete implementation of this protocol and
WezTerm has a mostly complete implementation. Konsole and wayst have partial
support. We intend that any terminal emulator that wishes to support it can do so. To
check if a terminal emulator supports the graphics protocol the best way is to
send the above <em>query action</em> followed by a request for the <a href="https://vt100.net/docs/vt510-rm/DA1.html">primary device
attributes</a>. If you get back an
answer for the device attributes without getting back an answer for the <em>query
action</em> the terminal emulator does not support the graphics protocol.</p>
<p>This means that terminal emulators that support the graphics protocol, <strong>must</strong>
reply to <em>query actions</em> immediately without processing other input. Most
terminal emulators handle input in a FIFO manner, anyway.</p>
<p>So for example, you could send:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gi</span><span>=</span><span>31</span><span>,</span><span>s</span><span>=</span><span>1</span><span>,</span><span>v</span><span>=</span><span>1</span><span>,</span><span>a</span><span>=</span><span>q</span><span>,</span><span>t</span><span>=</span><span>d</span><span>,</span><span>f</span><span>=</span><span>24</span><span>;</span><span>AAAA</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\<span>&lt;</span><span>ESC</span><span>&gt;</span><span>[</span><span>c</span>
</pre></div>
</div>
<p>If you get back a response to the graphics query, the terminal emulator supports
the protocol, if you get back a response to the device attributes query without
a response to the graphics query, it does not.</p>
</section>
</section>
<section id="display-images-on-screen">
<h2>Display images on screen<a href="#display-images-on-screen" title="Link to this heading">#</a></h2>
<p>Every transmitted image can be displayed an arbitrary number of times on the
screen, in different locations, using different parts of the source image, as
needed. Each such display of an image is called a <em>placement</em>.  You can either
simultaneously transmit and display an image using the action <code><span>a=T</span></code>, or first
transmit the image with a id, such as <code><span>i=10</span></code> and then display it with
<code><span>a=p,i=10</span></code> which will display the previously transmitted image at the current
cursor position. When specifying an image id, the terminal emulator will reply
to the placement request with an acknowledgement code, which will be either:</p>

<p>when the image referred to by id was found, or:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gi</span><span>=&lt;</span><span>id</span><span>&gt;</span><span>;</span><span>ENOENT</span><span>:</span><span>&lt;</span><span>some</span> <span>detailed</span> <span>error</span> <span>msg</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>when the image with the specified id was not found. This is similar to the
scheme described above for querying available transmission media, except that
here we are querying if the image with the specified id is available or needs to
be re-transmitted.</p>
<p>Since there can be many placements per image, you can also give placements an
id. To do so add the <code><span>p</span></code> key with a number between <code><span>1</span></code> and <code><span>4294967295</span></code>.
When you specify a placement id, it will be added to the acknowledgement code
above. Every placement is uniquely identified by the pair of the <code><span>image</span> <span>id</span></code>
and the <code><span>placement</span> <span>id</span></code>. If you specify a placement id for an image that does
not have an id (i.e. has id=0), it will be ignored. In particular this means
there can exist multiple images with <code><span>image</span> <span>id=0,</span> <span>placement</span> <span>id=0</span></code>.
An example response:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gi</span><span>=&lt;</span><span>image</span> <span>id</span><span>&gt;</span><span>,</span><span>p</span><span>=&lt;</span><span>placement</span> <span>id</span><span>&gt;</span><span>;</span><span>OK</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>If you send two placements with the same <code><span>image</span> <span>id</span></code> and <code><span>placement</span> <span>id</span></code> the
second one will replace the first. This can be used to resize or move
placements around the screen, without flicker.</p>
<p><span>New in version 0.19.3: </span>Support for specifying placement ids (see <a href="https://sw.kovidgoyal.net/kitty/kittens/query_terminal/"><span>Query terminal</span></a> to query kitty version)</p>
<section id="controlling-displayed-image-layout">
<h3>Controlling displayed image layout<a href="#controlling-displayed-image-layout" title="Link to this heading">#</a></h3>
<p>The image is rendered at the current cursor position, from the upper left corner of
the current cell. You can also specify extra <code><span>X=3</span></code> and <code><span>Y=4</span></code> pixel offsets to display from
a different origin within the cell. Note that the offsets must be smaller that the size of the cell.</p>
<p>By default, the entire image will be displayed (images wider than the available
width will be truncated on the right edge). You can choose a source rectangle (in pixels)
as the part of the image to display. This is done with the keys: <code><span>x,</span> <span>y,</span> <span>w,</span> <span>h</span></code> which specify
the top-left corner, width and height of the source rectangle.</p>
<p>You can also ask the terminal emulator to display the image in a specified rectangle
(num of columns / num of lines), using the control codes <code><span>c,r</span></code>. <code><span>c</span></code> is the number of columns
and <cite>r</cite> the number of rows. The image will be scaled (enlarged/shrunk) as needed to fit
the specified area. Note that if you specify a start cell offset via the <code><span>X,Y</span></code> keys, it is not
added to the number of rows/columns.</p>
<p>Finally, you can specify the image <em>z-index</em>, i.e. the vertical stacking order. Images
placed in the same location with different z-index values will be blended if
they are semi-transparent. You can specify z-index values using the <code><span>z</span></code> key.
Negative z-index values mean that the images will be drawn under the text. This
allows rendering of text on top of images. Negative z-index values below
INT32_MIN/2 (-1,073,741,824) will be drawn under cells with non-default background
colors. If two images with the same z-index overlap then the image with the
lower id is considered to have the lower z-index. If the images have the same
z-index and the same id, then the behavior is undefined.</p>
<div>
<p>Note</p>
<p>After placing an image on the screen the cursor must be moved to the
right by the number of cols in the image placement rectangle and down by the
number of rows in the image placement rectangle. If either of these cause
the cursor to leave either the screen or the scroll area, the exact
positioning of the cursor is undefined, and up to implementations.
The client can ask the terminal emulator to not move the cursor at all
by specifying <code><span>C=1</span></code> in the command, which sets the cursor movement policy
to no movement for placing the current image.</p>
</div>
<p><span>New in version 0.20.0: </span>Support for the C=1 cursor movement policy</p>
</section>
<section id="unicode-placeholders">
<span id="graphics-unicode-placeholders"></span><h3>Unicode placeholders<a href="#unicode-placeholders" title="Link to this heading">#</a></h3>
<p><span>New in version 0.28.0: </span>Support for image display via Unicode placeholders</p>
<p>You can also use a special Unicode character <code><span>U+10EEEE</span></code> as a placeholder for
an image. This approach is less flexible, but it allows using images inside
any host application that supports Unicode, foreground colors (tmux, vim, weechat, etc.),
and a way to pass escape codes through to the underlying terminal.</p>
<p>The central idea is that we use a single <em>Private Use</em> Unicode character as a
<em>placeholder</em> to indicate to the terminal that an image is supposed to be
displayed at that cell. Since this character is just normal text, Unicode aware
application will move it around as needed when they redraw their screens,
thereby automatically moving the displayed image as well, even though they know
nothing about the graphics protocol. So an image is first created using the
normal graphics protocol escape codes (albeit in quiet mode (<code><span>q=2</span></code>) so that there are
no responses from the terminal that could confuse the host application). Then,
the actual image is displayed by getting the host application to emit normal
text consisting of <code><span>U+10EEEE</span></code> and various diacritics (Unicode combining
characters) and colors.</p>
<p>To use it, first create an image as you would normally with the graphics
protocol with (<code><span>q=2</span></code>), but do not create a placement for it, that is, do not
display it. Then, create a <em>virtual image placement</em> by specifying <code><span>U=1</span></code> and
the desired number of lines and columns:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>p</span><span>,</span><span>U</span><span>=</span><span>1</span><span>,</span><span>i</span><span>=&lt;</span><span>image_id</span><span>&gt;</span><span>,</span><span>c</span><span>=&lt;</span><span>columns</span><span>&gt;</span><span>,</span><span>r</span><span>=&lt;</span><span>rows</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>The creation of the placement need not be a separate escape code, it can be
combined with <code><span>a=T</span></code> to both transmit and create the virtual placement with a
single code.</p>
<p>The image will eventually be fit to the specified rectangle, its aspect ratio
preserved. Finally, the image can be actually displayed by using the
placeholder character, encoding the image ID in its foreground color. The row
and column values are specified with diacritics listed in
<a download="" href="https://sw.kovidgoyal.net/kitty/_downloads/f0a0de9ec8d9ff4456206db8e0814937/rowcolumn-diacritics.txt"><code><span>rowcolumn-diacritics.txt</span></code></a>.  For
example, here is how you can print a <code><span>2x2</span></code> placeholder for image ID <code><span>42</span></code>:</p>
<div><div><pre><span></span><span>printf</span><span> </span><span>&#34;\e[38;5;42m\U10EEEE\U0305\U0305\U10EEEE\U0305\U030D\e[39m\n&#34;</span>
<span>printf</span><span> </span><span>&#34;\e[38;5;42m\U10EEEE\U030D\U0305\U10EEEE\U030D\U030D\e[39m\n&#34;</span>
</pre></div>
</div>
<p>Here, <code><span>U+305</span></code> is the diacritic corresponding to the number <code><span>0</span></code>
and <code><span>U+30D</span></code> corresponds to <code><span>1</span></code>. So these two commands create the following
<code><span>2x2</span></code> placeholder:</p>
<div>
<table>
<tbody>
<tr><td><p>(0, 0)</p></td>
<td><p>(0, 1)</p></td>
</tr>
<tr><td><p>(1, 0)</p></td>
<td><p>(1, 1)</p></td>
</tr>
</tbody>
</table>
</div>
<p>This will cause the image with ID <code><span>42</span></code> to be displayed in a <code><span>2x2</span></code> grid.
Ideally, you would print out as many cells as the number of rows and columns
specified when creating the virtual placement, but in case of a mismatch only
part of the image will be displayed.</p>
<p>By using only the foreground color for image ID you are limited to either 8-bit IDs in 256 color
mode or 24-bit IDs in true color mode. Since IDs are in a global namespace
there can easily be collisions. If you need more bits for the image
ID, you can specify the most significant byte via a third diacritic. For
example, this is the placeholder for the image ID <code><span>33554474</span> <span>=</span> <span>42</span> <span>+</span> <span>(2</span> <span>&lt;&lt;</span> <span>24)</span></code>:</p>
<div><div><pre><span></span><span>printf</span><span> </span><span>&#34;\e[38;5;42m\U10EEEE\U0305\U0305\U030E\U10EEEE\U0305\U030D\U030E\n&#34;</span>
<span>printf</span><span> </span><span>&#34;\e[38;5;42m\U10EEEE\U030D\U0305\U030E\U10EEEE\U030D\U030D\U030E\n&#34;</span>
</pre></div>
</div>
<p>Here, <code><span>U+30E</span></code> is the diacritic corresponding to the number <code><span>2</span></code>.</p>
<p>You can also specify a placement ID using the underline color (if it’s omitted
or zero, the terminal may choose any virtual placement of the given image). The
background color is interpreted as the background color, visible if the image is
transparent. Other text attributes are reserved for future use.</p>
<p>Row, column and most significant byte diacritics may also be omitted, in which
case the placeholder cell will inherit the missing values from the placeholder
cell to the left, following the algorithm:</p>
<ul>
<li><p>If no diacritics are present, and the previous placeholder cell has the same
foreground and underline colors, then the row of the current cell will be the
row of the cell to the left, the column will be the column of the cell to the
left plus one, and the most significant image ID byte will be the most
significant image ID byte of the cell to the left.</p></li>
<li><p>If only the row diacritic is present, and the previous placeholder cell has
the same row and the same foreground and underline colors, then the column of
the current cell will be the column of the cell to the left plus one, and the
most significant image ID byte will be the most significant image ID byte of
the cell to the left.</p></li>
<li><p>If only the row and column diacritics are present, and the previous
placeholder cell has the same row, the same foreground and underline colors,
and its column is one less than the current column, then the most significant
image ID byte of the current cell will be the most significant image ID byte
of the cell to the left.</p></li>
</ul>
<p>These rules are applied left-to-right, which allows specifying only row
diacritics of the first column, i.e. here is a 2 rows by 3 columns placeholder:</p>
<div><div><pre><span></span><span>printf</span><span> </span><span>&#34;\e[38;5;42m\U10EEEE\U0305\U10EEEE\U10EEEE\n&#34;</span>
<span>printf</span><span> </span><span>&#34;\e[38;5;42m\U10EEEE\U030D\U10EEEE\U10EEEE\n&#34;</span>
</pre></div>
</div>
<p>This will not work for horizontal scrolling and overlapping images since the two
given rules will fail to guess the missing information. In such cases, the
terminal may apply other heuristics (but it doesn’t have to).</p>
<p>It is important to distinguish between virtual image placements and real images
displayed on top of Unicode placeholders. Virtual placements are invisible and only play
the role of prototypes for real images. Virtual placements can be deleted by a
deletion command only when the <cite>d</cite> key is equal to <code><span>i</span></code>, <code><span>I</span></code>, <code><span>n</span></code> or <code><span>N</span></code>.
The key values <code><span>a</span></code>, <code><span>c</span></code>, <code><span>p</span></code>, <code><span>q</span></code>, <code><span>x</span></code>, <code><span>y</span></code>, <code><span>z</span></code> and their capital
variants never affect virtual placements because they do not have a physical
location on the screen.</p>
<p>Real images displayed on top of Unicode placeholders are not considered
placements from the protocol perspective. They cannot be manipulated using
graphics commands, instead they should be moved, deleted, or modified by
manipulating the underlying Unicode placeholder as normal text.</p>
</section>
<section id="relative-placements">
<span id="relative-image-placement"></span><h3>Relative placements<a href="#relative-placements" title="Link to this heading">#</a></h3>
<p><span>New in version 0.31.0: </span>Support for positioning images relative to other images</p>
<p>You can specify that a placement is positioned relative to another placement.
This is particularly useful in combination with
<a href="#graphics-unicode-placeholders"><span>Unicode placeholders</span></a> above. It can be used to specify a single
transparent pixel image using a Unicode placeholder, which moves around
naturally with the text, the real image(s) can base their position relative to
the placeholder.</p>
<p>To specify that a placement should be relative to another, use the
<code><span>P=&lt;image_id&gt;,Q=&lt;placement_id&gt;</span></code> keys, when creating the relative placement.
For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>p</span><span>,</span><span>i</span><span>=&lt;</span><span>image_id</span><span>&gt;</span><span>,</span><span>p</span><span>=&lt;</span><span>placement_id</span><span>&gt;</span><span>,</span><span>P</span><span>=&lt;</span><span>parent_img_id</span><span>&gt;</span><span>,</span><span>Q</span><span>=&lt;</span><span>parent_placement_id</span><span>&gt;&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>This will create a <em>relative placement</em> that refers to the <em>parent placement</em>
specified by the <code><span>P</span></code> and <code><span>Q</span></code> keys. When the parent placement moves, the
relative placement moves along with it. The relative placement can be offset
from the parent’s location by a specified number of cells, using the <code><span>H</span></code> and
<code><span>V</span></code> keys for horizontal and vertical displacement. Positive values move right
and down. Negative values move left and up. The origin is the top left cell of
the parent placement.</p>
<p>The lifetime of a relative placement is tied to the lifetime of its parent. If
its parent is deleted, it is deleted as well. If the image that the relative
placement is a placement of, has no more placements, the image is deleted as
well. Thus, a parent and its relative placements form a <em>group</em> that is managed
together.</p>
<p>A relative placement can refer to another relative placement as its parent.
Thus the relative placements can form a chain. It is implementation dependent
how long a chain of such placements is allowed, but implementation must allow
a chain of length at least 8. If the implementation max depth is exceeded, the
terminal must respond with the <code><span>ETOODEEP</span></code> error code.</p>
<p>Virtual placements created for Unicode placeholder based images cannot also be
relative placements. However, a relative placement can refer to a virtual
placement as its parent. When a virtual placement is the parent, its position
is derived from all the actual Unicode placeholder images that refer to it.
The x position is the minimum of all the placeholder x positions and the y
position is the minimum of all the placeholder y positions. If a client
attempts to make a virtual placement relative the terminal must respond with
the <code><span>EINVAL</span></code> error code.</p>
<p>Terminals are required to reject the creation of a relative placement
that would create a cycle, such as when A is relative to B and B is relative to
C and C is relative to A. In such cases, the terminal must respond with the
<code><span>ECYCLE</span></code> error code.</p>
<p>If a client attempts to create a reference to a placement that does not exist
the terminal must respond with the <code><span>ENOPARENT</span></code> error code.</p>
<div>
<p>Note</p>
<p>Since a relative placement gets its position specified based on another
placement, instead of the cursor, the cursor must not move after a relative
position, regardless of the value of the <code><span>C</span></code> key to control cursor
movement.</p>
</div>
</section>
</section>
<section id="deleting-images">
<h2>Deleting images<a href="#deleting-images" title="Link to this heading">#</a></h2>
<p>Images can be deleted by using the delete action <code><span>a=d</span></code>. If specified without any
other keys, it will delete all images visible on screen. To delete specific images,
use the <cite>d</cite> key as described in the table below. Note that each value of d has
both a lowercase and an uppercase variant. The lowercase variant only deletes the
images without necessarily freeing up the stored image data, so that the images can be
re-displayed without needing to resend the data. The uppercase variants will delete
the image data as well, provided that the image is not referenced elsewhere, such as in the
scrollback buffer. The values of the <code><span>x</span></code> and <code><span>y</span></code> keys are the same as cursor positions (i.e.
<code><span>x=1,</span> <span>y=1</span></code> is the top left cell).</p>
<div>
<table>
<thead>
<tr><th><p>Value of <code><span>d</span></code></p></th>
<th><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><code><span>a</span></code> or <code><span>A</span></code></p></td>
<td><p>Delete all placements visible on screen</p></td>
</tr>
<tr><td><p><code><span>i</span></code> or <code><span>I</span></code></p></td>
<td><p>Delete all images with the specified id, specified using the <code><span>i</span></code> key. If you specify a <code><span>p</span></code> key for the placement                      id as well, then only the placement with the specified image id and placement id will be deleted.</p></td>
</tr>
<tr><td><p><code><span>n</span></code> or <code><span>N</span></code></p></td>
<td><p>Delete newest image with the specified number, specified using the <code><span>I</span></code> key. If you specify a <code><span>p</span></code> key for the
placement id as well, then only the placement with the specified number and placement id will be deleted.</p></td>
</tr>
<tr><td><p><code><span>c</span></code> or <code><span>C</span></code></p></td>
<td><p>Delete all placements that intersect with the current cursor position.</p></td>
</tr>
<tr><td><p><code><span>f</span></code> or <code><span>F</span></code></p></td>
<td><p>Delete animation frames.</p></td>
</tr>
<tr><td><p><code><span>p</span></code> or <code><span>P</span></code></p></td>
<td><p>Delete all placements that intersect a specific cell, the cell is specified using the <code><span>x</span></code> and <code><span>y</span></code> keys</p></td>
</tr>
<tr><td><p><code><span>q</span></code> or <code><span>Q</span></code></p></td>
<td><p>Delete all placements that intersect a specific cell having a specific z-index. The cell and z-index is specified using the <code><span>x</span></code>, <code><span>y</span></code> and <code><span>z</span></code> keys.</p></td>
</tr>
<tr><td><p><code><span>x</span></code> or <code><span>X</span></code></p></td>
<td><p>Delete all placements that intersect the specified column, specified using the <code><span>x</span></code> key.</p></td>
</tr>
<tr><td><p><code><span>y</span></code> or <code><span>Y</span></code></p></td>
<td><p>Delete all placements that intersect the specified row, specified using the <code><span>y</span></code> key.</p></td>
</tr>
<tr><td><p><code><span>z</span></code> or <code><span>Z</span></code></p></td>
<td><p>Delete all placements that have the specified z-index, specified using the <code><span>z</span></code> key.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Note when all placements for an image have been deleted, the image is also
deleted, if the capital letter form above is specified. Also, when the terminal
is running out of quota space for new images, existing images without
placements will be preferentially deleted.</p>
<p>Some examples:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>d</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\              <span># delete all visible placements</span>
<span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>d</span><span>,</span><span>d</span><span>=</span><span>i</span><span>,</span><span>i</span><span>=</span><span>10</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\     <span># delete the image with id=10, without freeing data</span>
<span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>d</span><span>,</span><span>d</span><span>=</span><span>i</span><span>,</span><span>i</span><span>=</span><span>10</span><span>,</span><span>p</span><span>=</span><span>7</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\ <span># delete the image with id=10 and placement id=7, without freeing data</span>
<span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>d</span><span>,</span><span>d</span><span>=</span><span>Z</span><span>,</span><span>z</span><span>=-</span><span>1</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\     <span># delete the placements with z-index -1, also freeing up image data</span>
<span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>d</span><span>,</span><span>d</span><span>=</span><span>p</span><span>,</span><span>x</span><span>=</span><span>3</span><span>,</span><span>y</span><span>=</span><span>4</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\  <span># delete all placements that intersect the cell at (3, 4), without freeing data</span>
</pre></div>
</div>
</section>
<section id="suppressing-responses-from-the-terminal">
<h2>Suppressing responses from the terminal<a href="#suppressing-responses-from-the-terminal" title="Link to this heading">#</a></h2>
<p>If you are using the graphics protocol from a limited client, such as a shell
script, it might be useful to avoid having to process responses from the
terminal. For this, you can use the <code><span>q</span></code> key. Set it to <code><span>1</span></code> to suppress
<code><span>OK</span></code> responses and to <code><span>2</span></code> to suppress failure responses.</p>
<p><span>New in version 0.19.3: </span>The ability to suppress responses (see <a href="https://sw.kovidgoyal.net/kitty/kittens/query_terminal/"><span>Query terminal</span></a> to query kitty version)</p>
</section>
<section id="requesting-image-ids-from-the-terminal">
<h2>Requesting image ids from the terminal<a href="#requesting-image-ids-from-the-terminal" title="Link to this heading">#</a></h2>
<p>If you are writing a program that is going to share the screen with other
programs and you still want to use image ids, it is not possible to know
what image ids are free to use. In this case, instead of using the <code><span>i</span></code>
key to specify an image id use the <code><span>I</span></code> key to specify an image number
instead. These numbers are not unique.
When creating a new image, even if an existing image has the same number a new
one is created. And the terminal will reply with the id of the newly created
image. For example, when creating an image with <code><span>I=13</span></code>, the terminal will
send the response:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gi</span><span>=</span><span>99</span><span>,</span><span>I</span><span>=</span><span>13</span><span>;</span><span>OK</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>Here, the value of <code><span>i</span></code> is the id for the newly created image and the value of
<code><span>I</span></code> is the same as was sent in the creation command.</p>
<p>All future commands that refer to images using the image number, such as
creating placements or deleting images, will act on only the newest image with
that number. This allows the client program to send a bunch of commands dealing
with an image by image number without waiting for a response from the terminal
with the image id. Once such a response is received, the client program should
use the <code><span>i</span></code> key with the image id for all future communication.</p>
<div>
<p>Note</p>
<p>Specifying both <code><span>i</span></code> and <code><span>I</span></code> keys in any command is an error. The
terminal must reply with an EINVAL error message, unless silenced.</p>
</div>
<p><span>New in version 0.19.3: </span>The ability to use image numbers (see <a href="https://sw.kovidgoyal.net/kitty/kittens/query_terminal/"><span>Query terminal</span></a> to query kitty version)</p>
</section>
<section id="animation">
<span id="animation-protocol"></span><h2>Animation<a href="#animation" title="Link to this heading">#</a></h2>
<p><span>New in version 0.20.0: </span>Animation support (see <a href="https://sw.kovidgoyal.net/kitty/kittens/query_terminal/"><span>Query terminal</span></a> to query kitty version)</p>
<p>When designing support for animation, the two main considerations were:</p>
<ol>
<li><p>There should be a way for both client and terminal driven animations.
Since there is unknown and variable latency between client and terminal,
especially over SSH, client driven animations are not sufficient.</p></li>
<li><p>Animations often consist of small changes from one frame to the next, the
protocol should thus allow transmitting these deltas for efficiency and
performance reasons.</p></li>
</ol>
<p>Animation support is added to the protocol by adding two new modes for the
<code><span>a</span></code> (action) key. A <code><span>f</span></code> mode for transmitting frame data and an <code><span>a</span></code> mode
for controlling the animation of an image. Animation proceeds in two steps,
first a normal image is created as described earlier. Then animation frames are
added to the image to make it into an animation. Since every animation is
associated with a single image, all animation escape codes must specify either
the <code><span>i</span></code> or <code><span>I</span></code> keys to identify the image being operated on.</p>
<section id="transferring-animation-frame-data">
<h3>Transferring animation frame data<a href="#transferring-animation-frame-data" title="Link to this heading">#</a></h3>
<p>Transferring animation frame data is very similar to
<a href="#transferring-pixel-data"><span>Transferring pixel data</span></a> above. The main difference is that the image
the frame belongs to must be specified and it is possible to transmit data for
only part of a frame, declaring the rest of the frame to be filled in by data
from a previous frame, or left blank. To transfer frame data the <code><span>a=f</span></code>
key must be used in all escape codes.</p>
<p>First, to transfer a simple frame that has data for the full image area, the
escape codes used are exactly the same as for transferring image data, with the
addition of: <code><span>a=f,i=&lt;image</span> <span>id&gt;</span></code> or <code><span>a=f,I=&lt;image</span> <span>number&gt;</span></code>.</p>
<p>If the frame has data for only a part of the image, you can specify the
rectangle for it using the <code><span>x,</span> <span>y,</span> <span>s,</span> <span>v</span></code> keys, for example:</p>
<div><div><pre><span></span><span>x</span><span>=</span><span>10</span><span>,</span><span>y</span><span>=</span><span>5</span><span>,</span><span>s</span><span>=</span><span>100</span><span>,</span><span>v</span><span>=</span><span>200</span>  <span># A 100x200 rectangle with its top left corner at (10, 5)</span>
</pre></div>
</div>
<p>Frames are created by composing the transmitted data onto a background canvas.
This canvas can be either a single color, or the pixels from a previous frame.
The composition can be of two types, either a simple replacement (<code><span>X=1</span></code>) key
or a full alpha blend (the default).</p>
<p>To use a background color for the canvas, specify the <code><span>Y</span></code> key as a 32-bit
RGBA color. For example:</p>
<div><div><pre><span></span><span>Y</span><span>=</span><span>4278190335</span> <span># 0xff0000ff opaque red</span>
<span>Y</span><span>=</span><span>16711816</span>   <span># 0x00ff0088 translucent green (alpha=0.53)</span>
</pre></div>
</div>
<p>The default background color when none is specified is <code><span>0</span></code> i.e. a black,
transparent pixel.</p>
<p>To use the data from a previous frame, specify the <code><span>c</span></code> key which is a 1-based
frame number. Thus <code><span>c=1</span></code> refers to the root frame (the base image data),
<code><span>c=2</span></code> refers to the second frame and so on.</p>
<p>If the frame is composed of multiple rectangular blocks, these can be expressed
by using the <code><span>r</span></code> key. When specifying the <code><span>r</span></code> key the data for an existing
frame is edited. The same composition operation as above happens, but now the
background canvas is the existing frame itself. <code><span>r</span></code> is a 1-based index, so
<code><span>r=1</span></code> is the root frame (base image data), <code><span>r=2</span></code> is the second frame and so
on.</p>
<p>Finally, while transferring frame data, the frame <em>gap</em> can also be specified
using the <code><span>z</span></code> key. The gap is the number of milliseconds to wait before
displaying the next frame when the animation is running. A value of <code><span>z=0</span></code> is
ignored, <code><span>z=positive</span> <span>number</span></code> sets the gap to the specified number of
milliseconds and <code><span>z=negative</span> <span>number</span></code> creates a <em>gapless</em> frame. Gapless
frames are not displayed to the user since they are instantly skipped over,
however they can be useful as the base data for subsequent frames. For example,
for an animation where the background remains the same and a small object or two
move.</p>
</section>
<section id="controlling-animations">
<h3>Controlling animations<a href="#controlling-animations" title="Link to this heading">#</a></h3>
<p>Clients can control animations by using the <code><span>a=a</span></code> key in the escape code sent
to the terminal.</p>
<p>The simplest is client driven animations, where the client transmits the frame
data and then also instructs the terminal to make a particular frame the current
frame.  To change the current frame, use the <code><span>c</span></code> key:</p>

<p>This will make the seventh frame in the image with id <code><span>3</span></code> the current frame.</p>
<p>However, client driven animations can be sub-optimal, since the latency between
the client and terminal is unknown and variable especially over the network.
Also they require the client to remain running for the lifetime of the
animation, which is not desirable for cat like utilities.</p>
<p>Terminal driven animations are achieved by the client specifying <em>gaps</em> (time
in milliseconds) between frames and instructing the terminal to stop or start
the animation.</p>
<p>The animation state is controlled by the <code><span>s</span></code> key. <code><span>s=1</span></code> stops the
animation. <code><span>s=2</span></code> runs the animation, but in <em>loading</em> mode, in this mode when
reaching the last frame, instead of looping, the terminal will wait for the
arrival of more frames. <code><span>s=3</span></code> runs the animation normally, after the last
frame, the terminal loops back to the first frame. The number of loops can be
controlled by the <code><span>v</span></code> key. <code><span>v=0</span></code> is ignored, <code><span>v=1</span></code> is loop infinitely,
and any other positive number is loop <code><span>number</span> <span>-</span> <span>1</span></code> times. Note that stopping
the animation resets the loop counter.</p>
<p>Finally, the <em>gap</em> for frames can be set using the <code><span>z</span></code> key. This can be
specified either when the frame is created as part of the transmit escape code
or separately using the animation control escape code. The <em>gap</em> is the time in
milliseconds to wait before displaying the next frame in the animation.
For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Ga</span><span>=</span><span>a</span><span>,</span><span>i</span><span>=</span><span>7</span><span>,</span><span>r</span><span>=</span><span>3</span><span>,</span><span>z</span><span>=</span><span>48</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>This sets the gap for the third frame of the image with id <code><span>7</span></code> to <code><span>48</span></code>
milliseconds. Note that <em>gapless</em> frames are not displayed to the user since
the next frame comes immediately, however they can be useful to store base data
for subsequent frames, such as in an animation with an object moving against a
static background.</p>
<p>In particular, the first frame or <em>root frame</em> is created with the base image
data and has no gap, so its gap must be set using this control code.</p>
</section>
<section id="composing-animation-frames">
<h3>Composing animation frames<a href="#composing-animation-frames" title="Link to this heading">#</a></h3>
<p><span>New in version 0.22.0: </span>Support for frame composition</p>
<p>Clients can <em>compose</em> animation frames, this means that they can compose pixels
in rectangular regions from one frame onto another frame. This allows for fast
and low band-width modification of frames.</p>
<p>To achieve this use the <code><span>a=c</span></code> key. The source frame is specified with
<code><span>r=frame</span> <span>number</span></code> and the destination frame as <code><span>c=frame</span> <span>number</span></code>. The size of
the rectangle is specified as <code><span>w=width,h=height</span></code> pixels. If unspecified, the
full image width and height are used. The offset of the rectangle from the
top-left corner for the source frame is specified by the <code><span>x,y</span></code> keys and the
destination frame by the <code><span>X,Y</span></code> keys. The composition operation is specified
by the <code><span>C</span></code> key with the default being to alpha blend the source rectangle
onto the destination rectangle. With <code><span>C=1</span></code> it will be a simple replacement
of pixels. For example:</p>
<div><div><pre><span></span><span>&lt;</span><span>ESC</span><span>&gt;</span><span>_Gi</span><span>=</span><span>1</span><span>,</span><span>r</span><span>=</span><span>7</span><span>,</span><span>c</span><span>=</span><span>9</span><span>,</span><span>w</span><span>=</span><span>23</span><span>,</span><span>h</span><span>=</span><span>27</span><span>,</span><span>X</span><span>=</span><span>4</span><span>,</span><span>Y</span><span>=</span><span>8</span><span>,</span><span>x</span><span>=</span><span>1</span><span>,</span><span>y</span><span>=</span><span>3</span><span>&lt;</span><span>ESC</span><span>&gt;</span>\
</pre></div>
</div>
<p>Will compose a <code><span>23x27</span></code> rectangle located at <code><span>(4,</span> <span>8)</span></code> in the <code><span>7th</span> <span>frame</span></code>
onto the rectangle located at <code><span>(1,</span> <span>3)</span></code> in the <code><span>9th</span> <span>frame</span></code>. These will be
in the image with <code><span>id=1</span></code>.</p>
<p>If the frames or the image are not found the terminal emulator must
respond with <cite>ENOENT</cite>. If the rectangles go out of bounds of the image
the terminal must respond with <cite>EINVAL</cite>. If the source and destination frames are
the same and the rectangles overlap, the terminal must respond with <cite>EINVAL</cite>.</p>
<div>
<p>Note</p>
<p>In kitty, doing a composition will cause a frame to be <em>fully rendered</em>
potentially increasing its storage requirements, when the frame was previously
stored as a set of operations on other frames. If this happens and there
is not enough storage space, kitty will respond with ENOSPC.</p>
</div>
</section>
</section>
<section id="image-persistence-and-storage-quotas">
<h2>Image persistence and storage quotas<a href="#image-persistence-and-storage-quotas" title="Link to this heading">#</a></h2>
<p>In order to avoid <em>Denial-of-Service</em> attacks, terminal emulators should have a
maximum storage quota for image data. It should allow at least a few full
screen images.  For example the quota in kitty is 320MB per buffer. When adding
a new image, if the total size exceeds the quota, the terminal emulator should
delete older images to make space for the new one. In kitty, for animations,
the additional frame data is stored on disk and has a separate, larger quota of
five times the base quota.</p>
</section>
<section id="control-data-reference">
<h2>Control data reference<a href="#control-data-reference" title="Link to this heading">#</a></h2>
<p>The table below shows all the control data keys as well as what values they can
take, and the default value they take when missing. All integers are 32-bit.</p>
<div>
<table>
<thead>
<tr><th><p>Key</p></th>
<th><p>Value</p></th>
<th><p>Default</p></th>
<th><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr><td><p><code><span>a</span></code></p></td>
<td><p>Single character.
<code><span>(a,</span> <span>c,</span> <span>d,</span> <span>f,</span> <span>``</span>
<span>``p,</span> <span>q,</span> <span>t,</span> <span>T)</span></code></p></td>
<td><p><code><span>t</span></code></p></td>
<td><p>The overall action this graphics command is performing.
<code><span>t</span></code> - transmit data, <code><span>T</span></code> - transmit data and display image,
<code><span>q</span></code> - query terminal, <code><span>p</span></code> - put (display) previous transmitted image,
<code><span>d</span></code> - delete image, <code><span>f</span></code> - transmit data for animation frames,
<code><span>a</span></code> - control animation, <code><span>c</span></code> - compose animation frames</p></td>
</tr>
<tr><td><p><code><span>q</span></code></p></td>
<td><p><code><span>0,</span> <span>1,</span> <span>2</span></code></p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>Suppress responses from the terminal to this graphics command.</p></td>
</tr>
<tr><td colspan="4"><p><strong>Keys for image transmission</strong></p></td>
</tr>
<tr><td><p><code><span>f</span></code></p></td>
<td><p>Positive integer.
<code><span>(24,</span> <span>32,</span> <span>100)</span></code>.</p></td>
<td><p><code><span>32</span></code></p></td>
<td><p>The format in which the image data is sent.</p></td>
</tr>
<tr><td><p><code><span>t</span></code></p></td>
<td><p>Single character.
<code><span>(d,</span> <span>f,</span> <span>t,</span> <span>s)</span></code>.</p></td>
<td><p><code><span>d</span></code></p></td>
<td><p>The transmission medium used.</p></td>
</tr>
<tr><td><p><code><span>s</span></code></p></td>
<td><p>Positive integer.</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The width of the image being sent.</p></td>
</tr>
<tr><td><p><code><span>v</span></code></p></td>
<td><p>Positive integer.</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The height of the image being sent.</p></td>
</tr>
<tr><td><p><code><span>S</span></code></p></td>
<td><p>Positive integer.</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The size of data to read from a file.</p></td>
</tr>
<tr><td><p><code><span>O</span></code></p></td>
<td><p>Positive integer.</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The offset from which to read data from a file.</p></td>
</tr>
<tr><td><p><code><span>i</span></code></p></td>
<td><p>Positive integer.
<code><span>(0</span> <span>-</span> <span>4294967295)</span></code></p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The image id</p></td>
</tr>
<tr><td><p><code><span>I</span></code></p></td>
<td><p>Positive integer.
<code><span>(0</span> <span>-</span> <span>4294967295)</span></code></p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The image number</p></td>
</tr>
<tr><td><p><code><span>p</span></code></p></td>
<td><p>Positive integer.
<code><span>(0</span> <span>-</span> <span>4294967295)</span></code></p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The placement id</p></td>
</tr>
<tr><td><p><code><span>o</span></code></p></td>
<td><p>Single character.
<code><span>only</span> <span>z</span></code></p></td>
<td><p><code><span>null</span></code></p></td>
<td><p>The type of data compression.</p></td>
</tr>
<tr><td><p><code><span>m</span></code></p></td>
<td><p>zero or one</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>Whether there is more chunked data available.</p></td>
</tr>
<tr><td colspan="4"><p><strong>Keys for image display</strong></p></td>
</tr>
<tr><td><p><code><span>x</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The left edge (in pixels) of the image area to display</p></td>
</tr>
<tr><td><p><code><span>y</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The top edge (in pixels) of the image area to display</p></td>
</tr>
<tr><td><p><code><span>w</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The width (in pixels) of the image area to display. By default, the entire width is used</p></td>
</tr>
<tr><td><p><code><span>h</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The height (in pixels) of the image area to display. By default, the entire height is used</p></td>
</tr>
<tr><td><p><code><span>X</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The x-offset within the first cell at which to start displaying the image</p></td>
</tr>
<tr><td><p><code><span>Y</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The y-offset within the first cell at which to start displaying the image</p></td>
</tr>
<tr><td><p><code><span>c</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The number of columns to display the image over</p></td>
</tr>
<tr><td><p><code><span>r</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The number of rows to display the image over</p></td>
</tr>
<tr><td><p><code><span>C</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>Cursor movement policy. <code><span>0</span></code> is the default, to move the cursor to after the image.
<code><span>1</span></code> is to not move the cursor at all when placing the image.</p></td>
</tr>
<tr><td><p><code><span>U</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>Set to <code><span>1</span></code> to create a virtual placement for a Unicode placeholder.
<code><span>1</span></code> is to not move the cursor at all when placing the image.</p></td>
</tr>
<tr><td><p><code><span>z</span></code></p></td>
<td><p>32-bit integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The <em>z-index</em> vertical stacking order of the image</p></td>
</tr>
<tr><td><p><code><span>P</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The id of a parent image for relative placement</p></td>
</tr>
<tr><td><p><code><span>Q</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The id of a placement in the parent image for relative placement</p></td>
</tr>
<tr><td><p><code><span>H</span></code></p></td>
<td><p>32-bit integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The offset in cells in the horizontal direction for relative placement</p></td>
</tr>
<tr><td><p><code><span>V</span></code></p></td>
<td><p>32-bit integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The offset in cells in the vertical direction for relative placement</p></td>
</tr>
<tr><td colspan="4"><p><strong>Keys for animation frame loading</strong></p></td>
</tr>
<tr><td><p><code><span>x</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The left edge (in pixels) of where the frame data should be updated</p></td>
</tr>
<tr><td><p><code><span>y</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The top edge (in pixels) of where the frame data should be updated</p></td>
</tr>
<tr><td><p><code><span>c</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The 1-based frame number of the frame whose image data serves as the base data
when creating a new frame, by default the base data is black, fully transparent pixels</p></td>
</tr>
<tr><td><p><code><span>r</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The 1-based frame number of the frame that is being edited. By default, a new frame is created</p></td>
</tr>
<tr><td><p><code><span>z</span></code></p></td>
<td><p>32-bit integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The gap (in milliseconds) of this frame from the next one. A value of
zero is ignored. Negative values create a <em>gapless</em> frame. If not specified,
frames have a default gap of <code><span>40ms</span></code>. The root frame defaults to zero gap.</p></td>
</tr>
<tr><td><p><code><span>X</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The composition mode for blending pixels when creating a new frame or
editing a frame’s data. The default is full alpha blending. <code><span>1</span></code> means a
simple overwrite.</p></td>
</tr>
<tr><td><p><code><span>Y</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The background color for pixels not
specified in the frame data. Must be in 32-bit RGBA format</p></td>
</tr>
<tr><td colspan="4"><p><strong>Keys for animation frame composition</strong></p></td>
</tr>
<tr><td><p><code><span>c</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The 1-based frame number of the frame whose image data serves as the overlaid data</p></td>
</tr>
<tr><td><p><code><span>r</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The 1-based frame number of the frame that is being edited.</p></td>
</tr>
<tr><td><p><code><span>x</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The left edge (in pixels) of the destination rectangle</p></td>
</tr>
<tr><td><p><code><span>y</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The top edge (in pixels) of the destination rectangle</p></td>
</tr>
<tr><td><p><code><span>w</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The width (in pixels) of the source and destination rectangles. By default, the entire width is used</p></td>
</tr>
<tr><td><p><code><span>h</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The height (in pixels) of the source and destination rectangles. By default, the entire height is used</p></td>
</tr>
<tr><td><p><code><span>X</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The left edge (in pixels) of the source rectangle</p></td>
</tr>
<tr><td><p><code><span>Y</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The top edge (in pixels) of the source rectangle</p></td>
</tr>
<tr><td><p><code><span>C</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The composition mode for blending
pixels. Default is full alpha blending. <code><span>1</span></code> means a simple overwrite.</p></td>
</tr>
<tr><td colspan="4"><p><strong>Keys for animation control</strong></p></td>
</tr>
<tr><td><p><code><span>s</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p><code><span>1</span></code> - stop animation, <code><span>2</span></code> - run animation, but wait for new frames, <code><span>3</span></code> - run animation</p></td>
</tr>
<tr><td><p><code><span>r</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The 1-based frame number of the frame that is being affected</p></td>
</tr>
<tr><td><p><code><span>z</span></code></p></td>
<td><p>32-bit integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The gap (in milliseconds) of this frame from the next one. A value of
zero is ignored. Negative values create a <em>gapless</em> frame.</p></td>
</tr>
<tr><td><p><code><span>c</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The 1-based frame number of the frame that should be made the current frame</p></td>
</tr>
<tr><td><p><code><span>v</span></code></p></td>
<td><p>Positive integer</p></td>
<td><p><code><span>0</span></code></p></td>
<td><p>The number of loops to play. <code><span>0</span></code> is
ignored, <code><span>1</span></code> is play infinite and is the default and larger number
means play that number <code><span>-1</span></code> loops</p></td>
</tr>
<tr><td colspan="4"><p><strong>Keys for deleting images</strong></p></td>
</tr>
<tr><td><p><code><span>d</span></code></p></td>
<td><p>Single character.
<code><span>(a,</span> <span>A,</span> <span>c,</span> <span>C,</span> <span>n,</span> <span>N,</span>
<span>i,</span> <span>I,</span> <span>p,</span> <span>P,</span> <span>q,</span> <span>Q,</span> <span>x,</span>
<span>X,</span> <span>y,</span> <span>Y,</span> <span>z,</span> <span>Z)</span></code>.</p></td>
<td><p><code><span>a</span></code></p></td>
<td><p>What to delete.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="interaction-with-other-terminal-actions">
<h2>Interaction with other terminal actions<a href="#interaction-with-other-terminal-actions" title="Link to this heading">#</a></h2>
<p>When resetting the terminal, all images that are visible on the screen must be
cleared.  When switching from the main screen to the alternate screen buffer
(1049 private mode) all images in the alternate screen must be cleared, just as
all text is cleared. The clear screen escape code (usually <code><span>&lt;ESC&gt;[2J</span></code>) should
also clear all images. This is so that the clear command works.</p>
<p>The other commands to erase text must have no effect on graphics.
The dedicated delete graphics commands must be used for those.</p>
<p>When scrolling the screen (such as when using index cursor movement commands,
or scrolling through the history buffer), images must be scrolled along with
text. When page margins are defined and the index commands are used, only
images that are entirely within the page area (between the margins) must be
scrolled. When scrolling them would cause them to extend outside the page area,
they must be clipped.</p>
</section>
</section>

        </article></div>
  </body>
</html>
