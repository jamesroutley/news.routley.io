<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://igorstechnoclub.com/sandbox-exec/">Original</a>
    <h1>macOS&#39;s Little-Known Command-Line Sandboxing Tool</h1>
    
    <div id="readability-page-1" class="page"><div>
    

    

    
        

        <p>
            <i>
                <time datetime="2025-04-17T08:22Z">
    17 Apr, 2025
</time>
            </i>
        </p>
    

    
<h2 id="what-is-codesandbox-execcode">What is <code>sandbox-exec</code>?</h2><p><code>sandbox-exec</code> is a built-in macOS command-line utility that enables users to execute applications within a sandboxed environment. In essence, it creates a secure, isolated space where applications can run with limited access to system resources – only accessing what you explicitly permit.</p>
<p>The concept behind sandboxing is fundamental to modern security: by restricting what an application can access, you minimize the potential damage from malicious code or unintended behavior. Think of it as putting an application in a secure room where it can only interact with specific objects you&#39;ve placed there.</p>
<h2 id="benefits-of-application-sandboxing">Benefits of Application Sandboxing</h2><p>Before diving into usage, let&#39;s understand why sandboxing matters:</p>
<ol>
<li><p><strong>Protection from malicious code</strong>: If you&#39;re testing an unfamiliar application or script, sandboxing can prevent it from accessing sensitive files or sending data across the network.</p>
</li>
<li><p><strong>Damage limitation</strong>: Even trusted applications can have vulnerabilities. Sandboxing limits the potential impact if an application is compromised.</p>
</li>
<li><p><strong>Privacy control</strong>: You can explicitly deny applications access to personal directories like Documents, Photos, or Contacts.</p>
</li>
<li><p><strong>Testing environment</strong>: Developers can test how applications function with limited permissions before implementing formal App Sandbox entitlements.</p>
</li>
<li><p><strong>Resource restriction</strong>: Beyond security, sandboxing can limit an application&#39;s resource consumption or network access.</p>
</li>
</ol>
<h2 id="getting-started-with-codesandbox-execcode">Getting Started with <code>sandbox-exec</code></h2><p>Using <code>sandbox-exec</code> requires creating a sandbox profile (configuration file) that defines the rules for your secure environment. The basic syntax is:</p>
<div><pre><span></span>sandbox-exec<span> </span>-f<span> </span>profile.sb<span> </span>command_to_run
</pre></div>
<p>Where <code>profile.sb</code> contains the rules defining what the sandboxed application can and cannot do, and <code>command_to_run</code> is the application you want to run within those constraints.</p>
<h3 id="understanding-sandbox-profiles">Understanding Sandbox Profiles</h3><p>Sandbox profiles use a Scheme-like syntax (a LISP dialect) with parentheses grouping expressions. The basic structure includes:</p>
<ul>
<li>A version declaration: <code>(version 1)</code></li>
<li>Default policy: <code>(deny default)</code> or <code>(allow default)</code></li>
<li>Specific rules allowing or denying operations</li>
</ul>
<p>Rules can target specific resources using:</p>
<ul>
<li>Literal paths: <code>(literal &#34;/path/to/file&#34;)</code></li>
<li>Regular expressions: <code>(regex &#34;^/System&#34;)</code></li>
<li>Glob patterns: <code>(subpath &#34;/Library&#34;)</code></li>
</ul>
<p>See Appendix for more complete list of available rules</p>
<h3 id="two-fundamental-approaches-to-sandboxing">Two Fundamental Approaches to Sandboxing</h3><p>There are two primary philosophies when creating sandbox profiles:</p>
<h4 id="1-deny-by-default-most-secure">1. Deny by Default (Most Secure)</h4><p>This approach starts by denying everything and explicitly allowing only required operations:</p>
<div><pre><span></span>(version 1)
(deny default)
(allow file-read-data (regex &#34;^/usr/lib&#34;))
(allow process-exec (literal &#34;/usr/bin/python3&#34;))
</pre></div>
<p>This is the most secure approach, ideal for running untrusted code, but requires careful configuration to make applications functional.</p>
<h4 id="2-allow-by-default-more-permissive">2. Allow by Default (More Permissive)</h4><p>Alternatively, you can allow everything except specific operations:</p>
<div><pre><span></span>(version 1)
(allow default)
(deny network*)
(deny file-write* (regex &#34;^/Users&#34;))
</pre></div>
<p>This approach is easier to implement but less secure, as you must anticipate every potential risky operation.</p>
<h2 id="practical-examples-of-codesandbox-execcode-in-action">Practical Examples of <code>sandbox-exec</code> in Action</h2><p>Let&#39;s explore some real-world examples to demonstrate the power of custom sandboxing.</p>
<h3 id="example-sandboxed-terminal-session">Example: Sandboxed Terminal Session</h3><p>Create a sandboxed terminal session that can&#39;t access the network:</p>
<div><pre><span></span># Create terminal-sandbox.sb:
(version 1)
(allow default)
(deny network*)
(deny file-read-data (regex &#34;^/Users/[^/]+/(Documents|Pictures|Desktop)&#34;))

# Run a sandboxed terminal
sandbox-exec -f terminal-sandbox.sb zsh
</pre></div>
<p>This creates a terminal session that functions normally but cannot access the network or read from your personal directories.</p>
<h3 id="example-using-pre-built-system-profiles">Example: Using Pre-built System Profiles</h3><p>macOS includes several pre-built sandbox profiles in <code>/System/Library/Sandbox/Profiles</code>:</p>
<div><pre><span></span><span># Run a command with the system&#39;s no-network profile</span>
sandbox-exec<span> </span>-f<span> </span>/System/Library/Sandbox/Profiles/weatherd.sb<span> </span><span>command</span>
</pre></div>
<p>These system profiles provide configurations for common restriction scenarios and applications. Some of them have quite good comments so you can use it as basis for your future profiles.</p>
<h2 id="debugging-sandbox-issues">Debugging Sandbox Issues</h2><p>When applications fail in a sandbox, determining the cause can be challenging. Here are effective debugging techniques:</p>
<h3 id="using-the-console-app">Using the Console App</h3><ol>
<li>Open Console.app (Applications → Utilities → Console)</li>
<li>Search for &#34;sandbox&#34; and your application name</li>
<li>Look for lines containing &#34;deny&#34; to identify blocked operations</li>
</ol>
<h3 id="using-terminal-for-real-time-logs">Using Terminal for Real-time Logs</h3><p>For real-time monitoring of sandbox violations:</p>
<div><pre><span></span>log<span> </span>stream<span> </span>--style<span> </span>compact<span> </span>--predicate<span> </span><span>&#39;sender==&#34;Sandbox&#34;&#39;</span>
</pre></div>
<p>To filter for a specific application:</p>
<div><pre><span></span>log<span> </span>stream<span> </span>--style<span> </span>compact<span> </span>--predicate<span> </span><span>&#39;sender==&#34;Sandbox&#34; and eventMessage contains &#34;python&#34;&#39;</span>
</pre></div>
<p>These logs show exactly which operations are being denied, helping you refine your sandbox profile.</p>
<h2 id="advanced-sandbox-techniques">Advanced Sandbox Techniques</h2><h3 id="creating-a-sandbox-alias">Creating a Sandbox Alias</h3><p>For frequent sandboxing, add an alias to your shell configuration:</p>
<div><pre><span></span><span># Add to ~/.zshrc or ~/.bash_profile</span>
<span>alias</span><span> </span>sandbox-no-network<span>=</span><span>&#39;sandbox-exec -p &#34;(version 1)(allow default)(deny network*)&#34;&#39;</span>

<span># Then use it as:</span>
sandbox-no-network<span> </span>curl<span> </span>-v<span> </span>https://google.com
</pre></div>
<p>but when I did the same for UI applications it didn&#39;t work for some reason (I can still open Google.com):</p>
<div><pre><span></span>sandbox-no-network /Applications/Firefox.app/Contents/MacOS/firefox
</pre></div>
<h3 id="importing-existing-profiles">Importing Existing Profiles</h3><p>You can import and extend existing profiles:</p>
<div><pre><span></span>(version 1)
(import &#34;/System/Library/Sandbox/Profiles/bsd.sb&#34;)
(deny network*)  # Add additional restrictions
</pre></div>
<h2 id="limitations-and-considerations">Limitations and Considerations</h2><p>Despite its power, <code>sandbox-exec</code> has some limitations to consider:</p>
<ol>
<li><p><strong>Deprecation status</strong>: While functional, Apple discourages its direct use in favor of App Sandbox for developers.</p>
</li>
<li><p><strong>Complex applications</strong>: Modern applications often have complex requirements that make comprehensive sandboxing challenging without extensive testing.</p>
</li>
<li><p><strong>Trial and error</strong>: Creating effective sandbox profiles often requires iterative testing to identify all necessary permissions.</p>
</li>
<li><p><strong>No GUI</strong>: Unlike App Sandbox in Xcode, <code>sandbox-exec</code> has no graphical interface for configuration.</p>
</li>
<li><p><strong>System updates</strong>: Major macOS updates might change how <code>sandbox-exec</code> works or what rules are effective.</p>
</li>
</ol>
<p>While Apple has moved toward more user-friendly security models, <code>sandbox-exec</code> remains a powerful tool for those willing to invest time in learning its intricacies. It offers a level of control and customization that GUI-based solutions simply cannot match.</p>
<p>For security-conscious users, developers testing applications, or anyone working with potentially untrusted code, <code>sandbox-exec</code> provides a native macOS solution for creating finely-tuned security environments. Though it requires knowledge of all it&#39;s possibility, despite lack of documentation, the security benefits make it well worth the effort.</p>
<p>The most powerful aspect of <code>sandbox-exec</code> is its flexibility – you can create custom security profiles tailored to specific applications and use cases, going far beyond the one-size-fits-all approach of most security tools.</p>
<h2 id="whats-next">What&#39;s Next</h2><p>If you&#39;re interested in learning more about macOS security tools and techniques, check out Apple&#39;s official documentation on <a href="https://developer.apple.com/documentation/security/app_sandbox">App Sandbox</a> or explore the pre-built sandbox profiles in <code>/System/Library/Sandbox/Profiles</code> to see how Apple implements sandboxing for system services</p>


    

    
        

        
            


        

        
            
        
    


  </div></div>
  </body>
</html>
