<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/leeoniya/uWrap">Original</a>
    <h1>Show HN: uWrap.js â€“ A faster and more accurate text wrapping util in &lt; 2KB</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A <a href="#performance">10x faster</a> and more accurate text wrapping util in <a href="https://github.com/leeoniya/uWrap/blob/main/dist/uWrap.iife.min.js">&lt; 2KB (min)</a> <em>(MIT Licensed)</em></p>
<hr/>

<p dir="auto">uWrap exists to efficiently predict varying row heights for list and grid <a href="https://www.patterns.dev/vanilla/virtual-lists/" rel="nofollow">virtualization</a>, a technique for UI performance optimization when rendering large, scrollable datasets.
Doing this both quickly and accurately turns out to be a non-trivial task since Canvas2D provides no API for text wrapping, and <code>measureText()</code> is quite expensive;
measuring via DOM is also a non-starter due to poor performance.
Additionally, font size, variable-width <a href="https://www.canva.com/learn/kerning/" rel="nofollow">kerning</a>, <code>letter-spacing</code>, explicit line breaks, and different <code>white-space</code> choices affect the number of wrapped lines.</p>
<p dir="auto">Notes:</p>
<ul dir="auto">
<li>Today, works most accurately with Latin charsets</li>
<li>Does not yet handle Windows-style <code>\r\n</code> explicit line breaks</li>
<li>Only <code>pre-line</code> wrapping strategy is implemented so far</li>
</ul>
<hr/>

<p dir="auto">uWrap handily out-performs <a href="https://github.com/glideapps/canvas-hypertxt">canvas-hypertxt</a> in both CPU and memory usage by a wide margin while being significantly <em>more</em> accurate.</p>
<p dir="auto">The benchmark below wraps 100,000 random sentences in boxes of random widths between 50px and 250px.
You can see this live in DevTools console of the <a href="https://leeoniya.github.io/uWrap/demo/" rel="nofollow">demo page</a>.</p>
<markdown-accessiblity-table><table>
  <tbody><tr>
    <th></th>
    <th>Chrome 135</th>
    <th>Firefox 137</th>
    <th>Safari 18.1</th>
  </tr>
  <tr>
    <td><a href="https://github.com/leeoniya/uWrap">uWrap</a></td>
    <td>82ms</td>
    <td>90ms</td>
    <td>185ms</td>
  </tr>
  <tr>
    <td><a href="https://github.com/glideapps/canvas-hypertxt">canvas-hypertxt</a></td>
    <td>770ms</td>
    <td>1660ms</td>
    <td>1430ms</td>
  </tr>
</tbody></table></markdown-accessiblity-table>
<hr/>


<p dir="auto">or</p>
<div dir="auto" data-snippet-clipboard-copy-content="&lt;script src=&#34;./dist/uWrap.iife.min.js&#34;&gt;&lt;/script&gt;"><pre><span>&lt;</span><span>script</span> <span>src</span>=&#34;<span>./dist/uWrap.iife.min.js</span>&#34;<span>&gt;</span><span>&lt;/</span><span>script</span><span>&gt;</span></pre></div>
<hr/>

<p dir="auto">A 10 LoC <a href="https://github.com/leeoniya/uWrap/blob/main/dist/uWrap.d.ts">uWrap.d.ts</a> TypeScript def.</p>
<hr/>

<div dir="auto" data-snippet-clipboard-copy-content="// import util for wrapping variable-width fonts using pre-line strategy
import { varPreLine } from &#39;uwrap&#39;;

// create a Canvas2D context with desired font settings
let ctx = document.createElement(&#39;canvas&#39;).getContext(&#39;2d&#39;);
ctx.font = &#34;14px Inter, sans-serif&#34;;
ctx.letterSpacing = &#39;0.15px&#39;;

// init util fns
const { count, test, split } = varPreLine(ctx);

// example text
let text = &#39;The quick brown fox jumps over the lazy dog.&#39;;

// count lines
let numLines = count(text, width);

// test if text will wrap
let willWrap = test(text, width);

// split lines (with optional limit)
let lines = split(text, width, 3);"><pre><span>// import util for wrapping variable-width fonts using pre-line strategy</span>
<span>import</span> <span>{</span> <span>varPreLine</span> <span>}</span> <span>from</span> <span>&#39;uwrap&#39;</span><span>;</span>

<span>// create a Canvas2D context with desired font settings</span>
<span>let</span> <span>ctx</span> <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;canvas&#39;</span><span>)</span><span>.</span><span>getContext</span><span>(</span><span>&#39;2d&#39;</span><span>)</span><span>;</span>
<span>ctx</span><span>.</span><span>font</span> <span>=</span> <span>&#34;14px Inter, sans-serif&#34;</span><span>;</span>
<span>ctx</span><span>.</span><span>letterSpacing</span> <span>=</span> <span>&#39;0.15px&#39;</span><span>;</span>

<span>// init util fns</span>
<span>const</span> <span>{</span> count<span>,</span> test<span>,</span> split <span>}</span> <span>=</span> <span>varPreLine</span><span>(</span><span>ctx</span><span>)</span><span>;</span>

<span>// example text</span>
<span>let</span> <span>text</span> <span>=</span> <span>&#39;The quick brown fox jumps over the lazy dog.&#39;</span><span>;</span>

<span>// count lines</span>
<span>let</span> <span>numLines</span> <span>=</span> <span>count</span><span>(</span><span>text</span><span>,</span> <span>width</span><span>)</span><span>;</span>

<span>// test if text will wrap</span>
<span>let</span> <span>willWrap</span> <span>=</span> <span>test</span><span>(</span><span>text</span><span>,</span> <span>width</span><span>)</span><span>;</span>

<span>// split lines (with optional limit)</span>
<span>let</span> <span>lines</span> <span>=</span> <span>split</span><span>(</span><span>text</span><span>,</span> <span>width</span><span>,</span> <span>3</span><span>)</span><span>;</span></pre></div>
</article></div></div>
  </body>
</html>
