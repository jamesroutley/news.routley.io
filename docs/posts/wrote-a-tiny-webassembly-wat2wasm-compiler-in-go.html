<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/thomscoder/luna">Original</a>
    <h1>Show HN: Wrote a tiny WebAssembly (wat2wasm) compiler in Go</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Luna is a reeeaaally tiny, yet expanding, sample compiler for WebAssembly Text Format, written in Go and built as one of my quest to conquer the WebAssembly dungeon.</p>
<p dir="auto">(I just wanted to build something like wat2wasm)</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/7522d290ae51504c7c4ec0968d20022f0c0ed5046ba3237a427307ddd412cb91/68747470733a2f2f692e6962622e636f2f686463563168302f53637265656e73686f742d323032322d31312d30312d616c6c652d31372d34372d30362e706e67"><img src="https://camo.githubusercontent.com/7522d290ae51504c7c4ec0968d20022f0c0ed5046ba3237a427307ddd412cb91/68747470733a2f2f692e6962622e636f2f686463563168302f53637265656e73686f742d323032322d31312d30312d616c6c652d31372d34372d30362e706e67" alt="luna" data-canonical-src="https://i.ibb.co/hdcV1h0/Screenshot-2022-11-01-alle-17-47-06.png"/></a></p>
<p dir="auto">It is so tiny that can only make additions lol.</p>
<p dir="auto">I&#39;ve built Luna because I wanted to learn how to build a compiler while learning WebAssembly.</p>
<p dir="auto">The goal of Luna is not to replace (in a long distant future) solid tools like <a href="https://webassembly.github.io/wabt/demo/wat2wasm/" rel="nofollow">wat2wasm</a>, <a href="https://github.com/wasmerio/wasmer">wasmer</a> or others;
nor to do fancy stuff, the goal of this project is to be useful for anyone approaching WebAssembly and/or as a blueprint for anyone that wants to develop a compiled-to-wasm programming language.</p>
<p dir="auto">I tried to document each section of the code as much as I could (I&#39;m still doing it) with link to resources I&#39;ve studied while building this, but if you want to improve it, feel free to open issues and pull requests.</p>

<p dir="auto">Followed the amazing articles about the <a href="https://blog.scottlogic.com/2019/05/17/webassembly-compiler.html" rel="nofollow">Chasm compiler</a> (a WAT compiler written in Typescript for the Chasm language) and a guide to write a WAT compiler in Rust <a href="https://www.bitfalter.com/webassembly-compiler-building-a-compiler" rel="nofollow"></a></p>
<ul dir="auto">
<li>Luna takes a <code>.wat</code> file (or string if used in the browser)</li>
<li>Splits it into tokens <code>./compiler/tokenizer.go</code></li>
<li>Creates a very simple AST of the tokens <code>./compiler/parser.go</code></li>
<li>Compiles <code>./compiler/compiler.go</code></li>
</ul>

<p dir="auto">Luna can also be used in the browsers</p>
<p dir="auto">Demo: <a href="https://luna-demo.vercel.app/" rel="nofollow">https://luna-demo.vercel.app/</a></p>
<p dir="auto">The</p>

<p dir="auto">or</p>

<p dir="auto">commands will build (or update) with TinyGo the <code>./example/main.wasm</code> file to be imported in the browser
In the <code>./example</code> directory there&#39;s a working example of how to do that.</p>

<ul dir="auto">
<li>Go</li>
<li>Tinygo</li>
<li>Make</li>
<li>syscall/js set up (or simply comment out the startLuna function and the syscall/js import)</li>
</ul>

<ol dir="auto">
<li>
<h3 dir="auto"><a id="user-content-more-interactivity" aria-hidden="true" href="#more-interactivity"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>More interactivity</h3>
</li>
</ol>
<p dir="auto">Currently Luna supports only the renaming of the exported function and some order scrumbling</p>
<ol start="2" dir="auto">
<li>
<h3 dir="auto"><a id="user-content-more-arithmetics" aria-hidden="true" href="#more-arithmetics"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>More arithmetics</h3>
</li>
</ol>
<p dir="auto">Currently Luna supports only addition</p>
<ol start="3" dir="auto">
<li>
<h3 dir="auto"><a id="user-content-expansion-of-wat-syntax" aria-hidden="true" href="#expansion-of-wat-syntax"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Expansion of Wat syntax</h3>
</li>
</ol>
<p dir="auto">Luna is by no means finished there are a lot of things that can be implemented and A LOT of things that can be improved. Any suggestions, pull requests, issues or feedback is greatly welcomed!!!</p>
</article>
          </div></div>
  </body>
</html>
