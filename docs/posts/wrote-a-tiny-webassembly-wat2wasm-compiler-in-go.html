<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/thomscoder/luna">Original</a>
    <h1>Show HN: Wrote a tiny WebAssembly (wat2wasm) compiler in Go</h1>
    
    <div id="readability-page-1" class="page"><article>
    

    <p><strong>Saturday, October 29, 2022</strong></p>

    <p>I&#39;m halfway done with my RC batch now.
Time feels like it has sped up.
The feeling that my time at RC is infinite is gone.
This was compounded by seeing folks from the Fall 1 batch conclude their batches yesterday.
We&#39;ll get a new boost from the Winter 1 batch joining on Monday, which I&#39;m really pumped for!
New people, new excitement, new energy!</p>
<p>I&#39;m happy with how things have gone so far in the batch.
I don&#39;t think I want to do anything dramatically different in the second half of the batch, except be a little bit more focused on one project instead of splitting between two.</p>
<p>I did have a less social week this week than most weeks, because I have some personal life stress right now (should wrap up next week) and it made it hard to focus, and I withdrew a little bit.
Despite that, I still had a pretty social week!
Something for me to take away here is that RC has shifted my understanding of where I get energy from and how much I do benefit from social things.</p>
<p>This week, I...</p>
<ul>
<li>had 5 pairing sessions</li>
<li>had 5 coffee chats</li>
<li>went to the Rust and theorem prover groups</li>
</ul>
<p>Next week I&#39;m going to have more coffee chats probably, since the new folks are joining.
But I&#39;m going to remember to be kind to myself, and to be realistic.
There are some factors outside of my control (taking a family member to a couple of appointments, plus two 8-hour drives to/from there) which will limit how much I can do next week.</p>
<p>But!
I did get through some code this week, and I really want to share what I did.</p>

<p>I learned to use the <a href="https://github.com/Geal/nom/">nom</a>, a parser combinator library.
I wrote a <a href="https://en.wikipedia.org/wiki/Portable_Game_Notation">PGN</a> parser (and improved it and sped it up, with the help of two other Recursers, yay pairing and community!) which worked pretty well.
It can parse a 5.6 million game file in about 30 seconds on my laptop.
In comparison, <a href="https://crates.io/crates/pgn-reader">pgn-reader</a>, which is reputed to be reasonably quick, takes 60 seconds for the same dataset on my same hardware.</p>
<p>Ultimately, though, I did trade in my own parser to use <code>pgn-reader</code> instead.
Performance of the parser itself isn&#39;t what I want to spend my time on.
Actually, I don&#39;t want to spend my time on the parser at all right now, since I want to get into the database portion of my chess database.
My own parser was failing on 0.1% of the games, and there were enough edge cases that it was going to be a significant time sink to fix them all.</p>
<p>You can see the source for the custom parser at commit <a href="https://git.sr.ht/%7Entietz/isabella-db/tree/8713d3ae12d83635f807927ce81cabb3d17c5ab6">8713d3ae</a> if you&#39;re curious.
It&#39;ll be around if I ever decide that no, I <em>do</em> want it to go ridiculously fast thankyouverymuch.</p>
<p>While I&#39;m not using the parser I wrote, this was a very useful exercise.
I&#39;m not afraid of parsers anymore!
They&#39;re a lot more approachable than I thought before.
In fact, I&#39;m going to have to write another one for this project.
I&#39;ll have a query language of <em>some</em> sort (TBD, but I have a batchmate who is very into programming languages, compilers, and parsers, and I hope they&#39;ll help me design it!).
That will, naturally, require a parser.
That&#39;ll be a lot of fun to tackle, and I won&#39;t have any way to back out of it!</p>

<p>Beyond pulling data in from the PGN file, there&#39;s a lot of work to do to actually make a chess database in the full sense of the word &#34;database&#34;.
People will often colloquially refer to a big PGN file as a database, but I&#39;m referring to the software portion that allows loading that, querying on it, and doing analysis on it.</p>
<p>My initial <a href="https://git.sr.ht/%7Entietz/isabella-db/tree/main/item/docs/0001-initial-design-and-plan.md">design doc</a> is available if anyone wants to look at it.
I&#39;m also working on reading through a paper on a columnar database, which matches how I was thinking about storing and indexing the data.
There will be a lot of fun challenges with getting things to be searchable in a nice, efficient manner.</p>

<p>The data storage and retrieval side of things is a little fuzzy for me until I get in the weeds, just some details are out of focus.
But I think the thing that&#39;s the biggest unknown really comes down to product type things:</p>
<ul>
<li>What queries will users want to do? (This is needed to choose what things to index on!)</li>
<li>How should users interact with it? What should the query language be like?</li>
</ul>
<p>Because these unknowns are product-y, I&#39;m focusing right now on getting something usable that I can start playing with.</p>
<p>Next week, I want to get the position index up (so I can, given a position, find all other games that contained that position) and build a UI that exposes searching positions by clicking through an opening tree.
That&#39;ll be enough for me to start thinking about how I want to use it.
I&#39;m also going to continue pondering design: I have some ideas on how to pull out fields to a columnar store, but I&#39;m less clear on how query planning and optimization will work in <em>any</em> format, so that&#39;s on my docket to learn about!</p>
<p>Next week I&#39;ll have a pretty full schedule:</p>
<ul>
<li>Lighter pairing load, because of personal life obligations</li>
<li>Coffee chats at least once a day! It&#39;ll be exciting with the new batch coming in.</li>
<li>Write a couple of blog posts. I have two that are in the queue that I have some research done for, so I need to buckle down and write them. I&#39;ll stagger their releases.</li>
<li>Work on IsabellaDB (position index and frontend)</li>
<li>Finish reading and summarizing my current Red Book paper</li>
</ul>
<p>It&#39;s going to be a full week!
I&#39;m excited to welcome in the new batch, and keep in contact with all the folks from Fall 1.</p>
<p>See you next week!</p>

  </article><p>
    If you have comments, questions, or feedback, please email <a href="mailto:~ntietz/public-inbox@lists.sr.ht">my public inbox</a>.
    To get new posts, please use my <a href="https://ntietz.com/atom.xml">RSS feed</a>.
  </p></div>
  </body>
</html>
