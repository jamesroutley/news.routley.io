<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/modal-labs/devlooper">Original</a>
    <h1>How to generate tested software packages using LLMs, a sandbox and a while loop</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><code>devlooper</code> is a program synthesis agent that autonomously fixes its output by running tests!</p>
<p dir="auto">Here&#39;s <code>devlooper</code> in action, taking 11 iterations to create a Python library that generates voronoi diagrams:</p>
<p dir="auto">
  <a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/5786378/257645025-0dfa6086-96e2-484b-92c8-23d1017471ab.gif"><img width="600" alt="devlooper demo" src="https://user-images.githubusercontent.com/5786378/257645025-0dfa6086-96e2-484b-92c8-23d1017471ab.gif"/></a>
</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-Ô∏è-how-it-works" aria-hidden="true" href="#Ô∏è-how-it-works"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>‚öôÔ∏è How it works</h2>
<p dir="auto">This project extends <a href="https://github.com/smol-ai/developer">smol developer</a> by giving it access to a <a href="https://modal.com/docs/guide/sandbox" rel="nofollow">sandbox</a> to run tests in. The agent iterates until all tests pass, by updating the code and fixing the environment (installing packages).</p>
<h3 tabindex="-1" dir="auto"><a id="user-content--environment-templates" aria-hidden="true" href="#-environment-templates"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji alias="package" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f4e6.png">üì¶</g-emoji> Environment templates</h3>
<p dir="auto">The project uses environment &#34;templates&#34; to define the basic setup and test harness for a given language/framework. For now, three templates are provided:</p>
<ul dir="auto">
<li>React + Jest</li>
<li>Python</li>
<li>Rust</li>
</ul>
<p dir="auto">However, any language/framework should work, as long as it can be installed within a container. Contributions for more templates are welcome (see <a href="https://github.com/modal-labs/devlooper/blob/main/src/env_templates.py"><code>env_templates.py</code></a>).</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-Ô∏è-sandbox" aria-hidden="true" href="#Ô∏è-sandbox"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>üèñÔ∏è Sandbox</h3>
<p dir="auto">We use <a href="http://modal.com/" rel="nofollow">Modal</a>&#39;s new <a href="https://modal.com/docs/guide/sandbox" rel="nofollow">Sandbox</a> primitive to run tests in an isolated environment and fetch the output. This allows us to construct the image incrementally as well (similar to building up a Dockerfile in layers that are cached).</p>
<h3 tabindex="-1" dir="auto"><a id="user-content--debug-loop" aria-hidden="true" href="#-debug-loop"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji alias="robot" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f916.png">ü§ñ</g-emoji> Debug loop</h3>
<p dir="auto">In each iteration, the agent runs the test command for the environment. If a non-zero exit code is received, the agent passes the <code>stdout</code> and <code>stderr</code> from the sandbox to the LLM to diagnose the error. This diagnosis is used in a separate step to generate a <code>DebugPlan</code> consisting of three types of actions:</p>
<ol dir="auto">
<li>Inspect and fix a file</li>
<li>Install a package in the image</li>
<li>Run commands in the image</li>
</ol>
<p dir="auto">More types of actions can be implemented pretty easily ‚Äî once again, contributions are welcome!</p>
<p dir="auto">Running the diagnosis as a separate step seems to boost model accuracy by quite a bit (instead of immediately predicting the <code>DebugPlan</code>). We suspect the benefits are similar to why Chain-of-Thought prompting works so well.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content--usage" aria-hidden="true" href="#-usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>üßë‚ÄçüöÄ Usage</h2>
<h3 tabindex="-1" dir="auto"><a id="user-content-set-up" aria-hidden="true" href="#set-up"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Set up</h3>
<ul dir="auto">
<li>Create a <a href="http://modal.com/" rel="nofollow">Modal</a> account (<a href="mailto:akshat@modal.com">reach out to us</a> if you are still on the waitlist!)</li>
<li>Install <code>modal</code> in your current Python environment</li>
</ul>

<ul dir="auto">
<li>Create a Modal token</li>
</ul>

<ul dir="auto">
<li>Create an <a href="https://openai.com/" rel="nofollow">OpenAI</a> account and get an API key</li>
<li><a href="https://modal.com/secrets/create" rel="nofollow">Create a Modal secret</a> named <code>openai-secret</code></li>
</ul>
<h3 tabindex="-1" dir="auto"><a id="user-content-generate" aria-hidden="true" href="#generate"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Generate!</h3>
<p dir="auto">You&#39;re ready to generate! From the root directory of this repo, <code>modal run</code> the program with your choice of <code>prompt</code> and <code>template</code>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="modal run src.main --prompt=&#34;a simple 2D graphics library&#34; --template=&#34;rust&#34;"><pre>modal run src.main --prompt=<span><span>&#34;</span>a simple 2D graphics library<span>&#34;</span></span> --template=<span><span>&#34;</span>rust<span>&#34;</span></span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="modal run src.main --prompt=&#34;a todo-list app&#34; --template=&#34;react&#34;"><pre>modal run src.main --prompt=<span><span>&#34;</span>a todo-list app<span>&#34;</span></span> --template=<span><span>&#34;</span>react<span>&#34;</span></span></pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="modal run src.main --prompt=&#34;a webscraper that checks if there are new reservations for a given restaurant on Resy&#34; --template=&#34;python&#34;"><pre>modal run src.main --prompt=<span><span>&#34;</span>a webscraper that checks if there are new reservations for a given restaurant on Resy<span>&#34;</span></span> --template=<span><span>&#34;</span>python<span>&#34;</span></span></pre></div>
<p dir="auto">Once all tests pass, the output will be written to <code>output/</code> in the same directory by default. This can be overridden using <code>--output-path</code>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content--showcase" aria-hidden="true" href="#-showcase"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>‚ú® Showcase</h2>
<p dir="auto"><em>Coming soon</em></p>
<h2 tabindex="-1" dir="auto"><a id="user-content--future-directions" aria-hidden="true" href="#-future-directions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><g-emoji alias="crystal_ball" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f52e.png">üîÆ</g-emoji> Future directions</h2>
<p dir="auto">This project is mostly a proof of concept, and there&#39;s a lot of cool additions that will make this better. Here are some ideas:</p>
<ul dir="auto">
<li>Allowing feedback from users in the loop, or accepting an existing project + plan as input and making suggested changes to it.</li>
<li>Making the debugging prompt better with relevant parts of the code, retrieved using embeddings.</li>
<li>Go out and fetch the documentation for a package if needed.</li>
<li>Using previous edits in the prompt somewhere to prevent the model from going into a loop.</li>
<li>Synthesizing <code>EnvTemplate</code>s from scratch.</li>
<li>Generalizing this to more LLMs, including open-source ones!</li>
</ul>
</article>
          </div></div>
  </body>
</html>
