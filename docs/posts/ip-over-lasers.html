<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.mikekohn.net/micro/ip_over_lasers.php">Original</a>
    <h1>IP over Lasers</h1>
    
    <div id="readability-page-1" class="page"><div><center>
</center>
<p><i>September 29, 2025</i></p>

<p><b>Introduction</b></p>

<p>A typical computer is connected to the local network using either
an Ethernet cable or WiFi. This project connects two computers together
through lasers.</p>

<p>This project takes advantage of the Linux support for a tun (tunnel)
network device. Like any other network device, it gets its own IP
address. The difference is, when network traffic is routed to it,
a user land computer reads in the data and from there can do whatever
it wants with it. Likewise, packets can be written to the tunnel
device and the kernel will use it the same as if it came from
a hardware network card.</p>

<p>Explanation, video, pictures, and source code below.</p>

<p><b>Related Projects @mikekohn.net</b></p>


<p><b>Video</b></p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/U-pM_YwO_94?si=o0Rh4kRADtPyIj7U" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>

<p>YouTube: <a href="https://youtu.be/U-pM_YwO_94">https://youtu.be/U-pM_YwO_94</a></p>

<p>Above is a video with a demo and short explanation of the project. One
mistake I make while making the video, I was playing around with different
baud rates while having some problems and thought I left it at 2400 baud.
It&#39;s actually running here at 1200 baud, but it does for sure work at
2400 baud.</p>

<p><b>Explanation</b></p>

<p>Both computers (in this case a laptop and a Raspberry Pi 5) have
USB-UART cables connected to them. Those cables are connected to
two pins on ATtiny85s. The ATtiny85s on two other pins have a laser
and a phototransitors. Each laser is pointed to the phototransistor
on the opposite microcontroller.</p>

<p>Originally, the plan was to try to use a 38kHz IR sensor, so the
lasers would flicker at 38kHz when they were on and light &#34;noise&#34;
would therefore not affect the system. It actually seemed to detect
the laser sometimes, but it was kind of obvious it wasn&#39;t going to
work so instead a phototransistor is used.</p>

<p>I did use these lasers for other projects, including the
<a href="https://www.mikekohn.net/micro/drag_racing_tree.php">Drag Racing Tree</a> circuit
and never used eye protection. Kind of realized that was probably
a really stupid idea so I ordered some cheap $10 goggles. It
made working on the project more difficult, but better to be
safe than blind.</p> 

<p>Using minicom, data could be transferred character by character
over the lasers at 4800 baud. At 9600 baud only garbage was transfered.
I was having trouble with the relay of IP data so I dropped it down to
2400 baud. There were some bugs in the code at that time so maybe it
could be bumped back up to 4800. Either way, ping time isn&#39;t pretty
and connecting using SSH takes... a minute or so.</p>

<p><b>ATtiny85</b></p>

<p>The code running on the ATtiny85 is extremely simple. The pins are
set up like this:</p>

<code>
  ;; PB0: UART-TX (output)
  ;; PB1: UART-RX (input)
  ;; PB3: laser-out
  ;; PB4: light-in (reverse logic)

</code>

<p>From the UART cable, the TX pin is connected to the PB1 in and the
RX pin is connected to the PB0 pin. Code does the following logic:</p>

<code>
Input:
  If PB1 is set as 1, PB3 is high (laser on).
  If PB1 is set as 0, PB3 is low  (laser off).

Output:
  If PB4 is 0 (the laser is on)  PB0 is high.
  If PB4 is 1 (the laser is off) PB1 is low.

</code>

<p><b>laser0 / tun0</b></p>

<p>The tun0 device is set up with the follow commands:</p>

<code>
Computer 1:
  sudo ip tuntap add mode tun dev laser0
  sudo ip addr add 192.168.3.101/24 dev laser0
  sudo ip link set dev laser0 up

Computer 2:
  sudo ip tuntap add mode tun dev laser0
  sudo ip addr add 192.168.3.100/24 dev laser0
  sudo ip link set dev laser0 up

</code>

<p>Each computer runs a program called relay. This program simply sits
in a while loop that does simply this:</p>

<code>
  * Check tun0 for a packet. If packet is available read into buffer and
    send out UART.

  * Check UART for data. If data is available read in 4 bytes to see if
    it&#39;s 0xff 0xff and the next 2 bytes are number of bytes to read for
    the size of the packet. Read in the read of the packet and then transfer
    to tun0.

</code>

<p><b>Pictures</b></p>

<p><a href="https://www.mikekohn.net/micro/pics/misc/lasers_ip_1.jpeg"><img src="https://www.mikekohn.net/micro/pics/misc/lasers_ip_1_thumb.jpeg" alt="IP over lasers circuit"/></a></p>

<p>Above is a close up picture of the two circuits and the two lasers.
Each circuit runs on 3v of battery which was nice since the battery
holders had on/off switches. This allowed me to turn the lasers off
if I needed to make some code changes.</p>

<p><a href="https://www.mikekohn.net/micro/pics/misc/lasers_ip_2.jpeg"><img src="https://www.mikekohn.net/micro/pics/misc/lasers_ip_2_thumb.jpeg" alt="IP over lasers circuit"/></a></p>

<p>And this is bigger picture. Between the two computers are the
laser saftey goggles I used for eye protection.</p>

<p><b>Source Code</b></p>
<p><a href="https://github.com/mikeakohn/small_projects/tree/main/ip_over_lasers">https://github.com/mikeakohn/small_projects/tree/main/ip_over_lasers</a></p>

<p>
Copyright 1997-2025 - <a href="https://www.mikekohn.net/">Michael Kohn</a>
</p>

</div></div>
  </body>
</html>
