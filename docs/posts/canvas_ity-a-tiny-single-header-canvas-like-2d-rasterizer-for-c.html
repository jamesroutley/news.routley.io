<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/a-e-k/canvas_ity">Original</a>
    <h1>Canvas_ity: A tiny, single-header &lt;canvas&gt;-like 2D rasterizer for C&#43;&#43;</h1>
    
    <div id="readability-page-1" class="page"><div>
<td>
<sub>
<div dir="auto" data-snippet-clipboard-copy-content="#include &lt;algorithm&gt;
#include &lt;fstream&gt;
// Include the library header and implementation.
#define CANVAS_ITY_IMPLEMENTATION
#include &#34;canvas_ity.hpp&#34;
int main()
{
    // Construct the canvas.
    static int const width = 256, height = 256;
    canvas_ity::canvas context( width, height );

    // Build a star path.
    context.move_to( 128.0f,  28.0f ); context.line_to( 157.0f,  87.0f );
    context.line_to( 223.0f,  97.0f ); context.line_to( 175.0f, 143.0f );
    context.line_to( 186.0f, 208.0f ); context.line_to( 128.0f, 178.0f );
    context.line_to(  69.0f, 208.0f ); context.line_to(  80.0f, 143.0f );
    context.line_to(  32.0f,  97.0f ); context.line_to(  98.0f,  87.0f );
    context.close_path();

    // Set up the drop shadow.
    context.set_shadow_blur( 8.0f );
    context.shadow_offset_y = 4.0f;
    context.set_shadow_color( 0.0f, 0.0f, 0.0f, 0.5f );

    // Fill the star with yellow.
    context.set_color( canvas_ity::fill_style, 1.0f, 0.9f, 0.2f, 1.0f );
    context.fill();

    // Draw the star with a thick red stroke and rounded points.
    context.line_join = canvas_ity::rounded;
    context.set_line_width( 12.0f );
    context.set_color( canvas_ity::stroke_style, 0.9f, 0.0f, 0.5f, 1.0f );
    context.stroke();

    // Draw the star again with a dashed thinner orange stroke.
    float segments[] = { 21.0f, 9.0f, 1.0f, 9.0f, 7.0f, 9.0f, 1.0f, 9.0f };
    context.set_line_dash( segments, 8 );
    context.line_dash_offset = 10.0f;
    context.line_cap = canvas_ity::circle;
    context.set_line_width( 6.0f );
    context.set_color( canvas_ity::stroke_style, 0.95f, 0.65f, 0.15f, 1.0f );
    context.stroke();

    // Turn off the drop shadow.
    context.set_shadow_color( 0.0f, 0.0f, 0.0f, 0.0f );

    // Add a shine layer over the star.
    context.set_linear_gradient( canvas_ity::fill_style, 64.0f, 0.0f, 192.0f, 256.0f );
    context.add_color_stop( canvas_ity::fill_style, 0.30f, 1.0f, 1.0f, 1.0f, 0.0f );
    context.add_color_stop( canvas_ity::fill_style, 0.35f, 1.0f, 1.0f, 1.0f, 0.8f );
    context.add_color_stop( canvas_ity::fill_style, 0.45f, 1.0f, 1.0f, 1.0f, 0.8f );
    context.add_color_stop( canvas_ity::fill_style, 0.50f, 1.0f, 1.0f, 1.0f, 0.0f );

    context.global_composite_operation = canvas_ity::source_atop;
    context.fill_rectangle( 0.0f, 0.0f, 256.0f, 256.0f );

    // Fetch the rendered RGBA pixels from the entire canvas.
    unsigned char *image = new unsigned char[ height * width * 4 ];
    context.get_image_data( image, width, height, width * 4, 0, 0 );
    // Write them out to a TGA image file (TGA uses BGRA order).
    unsigned char header[] = { 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0,
        width &amp; 255, width &gt;&gt; 8, height &amp; 255, height &gt;&gt; 8, 32, 40 };
    for ( int pixel = 0; pixel &lt; height * width; ++pixel )
        std::swap( image[ pixel * 4 + 0 ], image[ pixel * 4 + 2 ] );
    std::ofstream stream( &#34;example.tga&#34;, std::ios::binary );
    stream.write( reinterpret_cast&lt; char * &gt;( header ), sizeof( header ) );
    stream.write( reinterpret_cast&lt; char * &gt;( image ), height * width * 4 );
    delete[] image;
}"><pre>#<span>include</span> <span><span>&lt;</span>algorithm<span>&gt;</span></span>
#<span>include</span> <span><span>&lt;</span>fstream<span>&gt;</span></span>
<span><span>//</span> Include the library header and implementation.</span>
#<span>define</span> <span>CANVAS_ITY_IMPLEMENTATION</span>
#<span>include</span> <span><span>&#34;</span>canvas_ity.hpp<span>&#34;</span></span>
<span>int</span> <span>main</span>()
{
    <span><span>//</span> Construct the canvas.</span>
    <span>static</span> <span>int</span> <span>const</span> width = <span>256</span>, height = <span>256</span>;
    canvas_ity::canvas <span>context</span>( width, height );

    <span><span>//</span> Build a star path.</span>
    context.<span>move_to</span>( <span>128</span>.<span>0f</span>,  <span>28</span>.<span>0f</span> ); context.<span>line_to</span>( <span>157</span>.<span>0f</span>,  <span>87</span>.<span>0f</span> );
    context.<span>line_to</span>( <span>223</span>.<span>0f</span>,  <span>97</span>.<span>0f</span> ); context.<span>line_to</span>( <span>175</span>.<span>0f</span>, <span>143</span>.<span>0f</span> );
    context.<span>line_to</span>( <span>186</span>.<span>0f</span>, <span>208</span>.<span>0f</span> ); context.<span>line_to</span>( <span>128</span>.<span>0f</span>, <span>178</span>.<span>0f</span> );
    context.<span>line_to</span>(  <span>69</span>.<span>0f</span>, <span>208</span>.<span>0f</span> ); context.<span>line_to</span>(  <span>80</span>.<span>0f</span>, <span>143</span>.<span>0f</span> );
    context.<span>line_to</span>(  <span>32</span>.<span>0f</span>,  <span>97</span>.<span>0f</span> ); context.<span>line_to</span>(  <span>98</span>.<span>0f</span>,  <span>87</span>.<span>0f</span> );
    context.<span>close_path</span>();

    <span><span>//</span> Set up the drop shadow.</span>
    context.<span>set_shadow_blur</span>( <span>8</span>.<span>0f</span> );
    context.<span>shadow_offset_y</span> = <span>4</span>.<span>0f</span>;
    context.<span>set_shadow_color</span>( <span>0</span>.<span>0f</span>, <span>0</span>.<span>0f</span>, <span>0</span>.<span>0f</span>, <span>0</span>.<span>5f</span> );

    <span><span>//</span> Fill the star with yellow.</span>
    context.<span>set_color</span>( canvas_ity::fill_style, <span>1</span>.<span>0f</span>, <span>0</span>.<span>9f</span>, <span>0</span>.<span>2f</span>, <span>1</span>.<span>0f</span> );
    context.<span>fill</span>();

    <span><span>//</span> Draw the star with a thick red stroke and rounded points.</span>
    context.<span>line_join</span> = canvas_ity::rounded;
    context.<span>set_line_width</span>( <span>12</span>.<span>0f</span> );
    context.<span>set_color</span>( canvas_ity::stroke_style, <span>0</span>.<span>9f</span>, <span>0</span>.<span>0f</span>, <span>0</span>.<span>5f</span>, <span>1</span>.<span>0f</span> );
    context.<span>stroke</span>();

    <span><span>//</span> Draw the star again with a dashed thinner orange stroke.</span>
    <span>float</span> segments[] = { <span>21</span>.<span>0f</span>, <span>9</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>9</span>.<span>0f</span>, <span>7</span>.<span>0f</span>, <span>9</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>9</span>.<span>0f</span> };
    context.<span>set_line_dash</span>( segments, <span>8</span> );
    context.<span>line_dash_offset</span> = <span>10</span>.<span>0f</span>;
    context.<span>line_cap</span> = canvas_ity::circle;
    context.<span>set_line_width</span>( <span>6</span>.<span>0f</span> );
    context.<span>set_color</span>( canvas_ity::stroke_style, <span>0</span>.<span>95f</span>, <span>0</span>.<span>65f</span>, <span>0</span>.<span>15f</span>, <span>1</span>.<span>0f</span> );
    context.<span>stroke</span>();

    <span><span>//</span> Turn off the drop shadow.</span>
    context.<span>set_shadow_color</span>( <span>0</span>.<span>0f</span>, <span>0</span>.<span>0f</span>, <span>0</span>.<span>0f</span>, <span>0</span>.<span>0f</span> );

    <span><span>//</span> Add a shine layer over the star.</span>
    context.<span>set_linear_gradient</span>( canvas_ity::fill_style, <span>64</span>.<span>0f</span>, <span>0</span>.<span>0f</span>, <span>192</span>.<span>0f</span>, <span>256</span>.<span>0f</span> );
    context.<span>add_color_stop</span>( canvas_ity::fill_style, <span>0</span>.<span>30f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>0</span>.<span>0f</span> );
    context.<span>add_color_stop</span>( canvas_ity::fill_style, <span>0</span>.<span>35f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>0</span>.<span>8f</span> );
    context.<span>add_color_stop</span>( canvas_ity::fill_style, <span>0</span>.<span>45f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>0</span>.<span>8f</span> );
    context.<span>add_color_stop</span>( canvas_ity::fill_style, <span>0</span>.<span>50f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>1</span>.<span>0f</span>, <span>0</span>.<span>0f</span> );

    context.<span>global_composite_operation</span> = canvas_ity::source_atop;
    context.<span>fill_rectangle</span>( <span>0</span>.<span>0f</span>, <span>0</span>.<span>0f</span>, <span>256</span>.<span>0f</span>, <span>256</span>.<span>0f</span> );

    <span><span>//</span> Fetch the rendered RGBA pixels from the entire canvas.</span>
    <span>unsigned</span> <span>char</span> *image = <span>new</span> <span>unsigned</span> <span>char</span>[ height * width * <span>4</span> ];
    context.<span>get_image_data</span>( image, width, height, width * <span>4</span>, <span>0</span>, <span>0</span> );
    <span><span>//</span> Write them out to a TGA image file (TGA uses BGRA order).</span>
    <span>unsigned</span> <span>char</span> header[] = { <span>0</span>, <span>0</span>, <span>2</span>, <span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>, <span>0</span>,
        width &amp; <span>255</span>, width &gt;&gt; <span>8</span>, height &amp; <span>255</span>, height &gt;&gt; <span>8</span>, <span>32</span>, <span>40</span> };
    <span>for</span> ( <span>int</span> pixel = <span>0</span>; pixel &lt; height * width; ++pixel )
        <span>std::swap</span>( image[ pixel * <span>4</span> + <span>0</span> ], image[ pixel * <span>4</span> + <span>2</span> ] );
    std::ofstream <span>stream</span>( <span><span>&#34;</span>example.tga<span>&#34;</span></span>, std::ios::binary );
    stream.<span>write</span>( <span>reinterpret_cast</span>&lt; <span>char</span> * &gt;( header ), <span>sizeof</span>( header ) );
    stream.<span>write</span>( <span>reinterpret_cast</span>&lt; <span>char</span> * &gt;( image ), height * width * <span>4</span> );
    <span>delete[]</span> image;
}</pre></div>
</sub>
</td>
<td>
<sub>
<div dir="auto" data-snippet-clipboard-copy-content="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;Example&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;canvas id=&#34;example&#34; width=&#34;256&#34; height=&#34;256&#34;&gt;&lt;/canvas&gt;
  &lt;script type=&#34;text/javascript&#34;&gt;
    const context = document.getElementById( &#34;example&#34; ).getContext( &#34;2d&#34; );


    // Build a star path.
    context.moveTo( 128.0,  28.0 ); context.lineTo( 157.0,  87.0 );
    context.lineTo( 223.0,  97.0 ); context.lineTo( 175.0, 143.0 );
    context.lineTo( 186.0, 208.0 ); context.lineTo( 128.0, 178.0 );
    context.lineTo(  69.0, 208.0 ); context.lineTo(  80.0, 143.0 );
    context.lineTo(  32.0,  97.0 ); context.lineTo(  98.0,  87.0 );
    context.closePath();

    // Set up the drop shadow.
    context.shadowBlur = 8.0;
    context.shadowOffsetY = 4.0;
    context.shadowColor = &#34;rgba(0,0,0,0.5)&#34;;

    // Fill the star with yellow.
    context.fillStyle = &#34;#ffe633&#34;;
    context.fill();

    // Draw the star with a thick red stroke and rounded points.
    context.lineJoin = &#34;round&#34;;
    context.lineWidth = 12.0;
    context.strokeStyle = &#34;#e60080&#34;;
    context.stroke();

    // Draw the star again with a dashed thinner orange stroke.
    const segments = [ 21.0, 9.0, 1.0, 9.0, 7.0, 9.0, 1.0, 9.0 ];
    context.setLineDash( segments );
    context.lineDashOffset = 10.0;
    context.lineCap = &#34;round&#34;;
    context.lineWidth = 6.0;
    context.strokeStyle = &#34;#f2a626&#34;;
    context.stroke();

    // Turn off the drop shadow.
    context.shadowColor = &#34;rgba(0,0,0,0.0)&#34;;

    // Add a shine layer over the star.
    let gradient = context.createLinearGradient( 64.0, 0.0, 192.0, 256.0 );
    gradient.addColorStop( 0.30, &#34;rgba(255,255,255,0.0)&#34; );
    gradient.addColorStop( 0.35, &#34;rgba(255,255,255,0.8)&#34; );
    gradient.addColorStop( 0.45, &#34;rgba(255,255,255,0.8)&#34; );
    gradient.addColorStop( 0.50, &#34;rgba(255,255,255,0.0)&#34; );
    context.fillStyle = gradient;
    context.globalCompositeOperation = &#34;source-atop&#34;;
    context.fillRect( 0.0, 0.0, 256.0, 256.0 );

  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;











"><pre><span>&lt;!DOCTYPE html<span>&gt;</span></span>
<span>&lt;</span><span>html</span><span>&gt;</span>
<span>&lt;</span><span>head</span><span>&gt;</span>
  <span>&lt;</span><span>title</span><span>&gt;</span>Example<span>&lt;/</span><span>title</span><span>&gt;</span>
<span>&lt;/</span><span>head</span><span>&gt;</span>
<span>&lt;</span><span>body</span><span>&gt;</span>
  <span>&lt;</span><span>canvas</span> <span>id</span>=&#34;<span>example</span>&#34; <span>width</span>=&#34;<span>256</span>&#34; <span>height</span>=&#34;<span>256</span>&#34;<span>&gt;</span><span>&lt;/</span><span>canvas</span><span>&gt;</span>
  <span>&lt;</span><span>script</span> <span>type</span>=&#34;<span>text/javascript</span>&#34;<span>&gt;</span>
    <span>const</span> <span>context</span> <span>=</span> <span>document</span><span>.</span><span>getElementById</span><span>(</span> <span>&#34;example&#34;</span> <span>)</span><span>.</span><span>getContext</span><span>(</span> <span>&#34;2d&#34;</span> <span>)</span><span>;</span>


    <span>// Build a star path.</span>
    <span>context</span><span>.</span><span>moveTo</span><span>(</span> <span>128.0</span><span>,</span>  <span>28.0</span> <span>)</span><span>;</span> <span>context</span><span>.</span><span>lineTo</span><span>(</span> <span>157.0</span><span>,</span>  <span>87.0</span> <span>)</span><span>;</span>
    <span>context</span><span>.</span><span>lineTo</span><span>(</span> <span>223.0</span><span>,</span>  <span>97.0</span> <span>)</span><span>;</span> <span>context</span><span>.</span><span>lineTo</span><span>(</span> <span>175.0</span><span>,</span> <span>143.0</span> <span>)</span><span>;</span>
    <span>context</span><span>.</span><span>lineTo</span><span>(</span> <span>186.0</span><span>,</span> <span>208.0</span> <span>)</span><span>;</span> <span>context</span><span>.</span><span>lineTo</span><span>(</span> <span>128.0</span><span>,</span> <span>178.0</span> <span>)</span><span>;</span>
    <span>context</span><span>.</span><span>lineTo</span><span>(</span>  <span>69.0</span><span>,</span> <span>208.0</span> <span>)</span><span>;</span> <span>context</span><span>.</span><span>lineTo</span><span>(</span>  <span>80.0</span><span>,</span> <span>143.0</span> <span>)</span><span>;</span>
    <span>context</span><span>.</span><span>lineTo</span><span>(</span>  <span>32.0</span><span>,</span>  <span>97.0</span> <span>)</span><span>;</span> <span>context</span><span>.</span><span>lineTo</span><span>(</span>  <span>98.0</span><span>,</span>  <span>87.0</span> <span>)</span><span>;</span>
    <span>context</span><span>.</span><span>closePath</span><span>(</span><span>)</span><span>;</span>

    <span>// Set up the drop shadow.</span>
    <span>context</span><span>.</span><span>shadowBlur</span> <span>=</span> <span>8.0</span><span>;</span>
    <span>context</span><span>.</span><span>shadowOffsetY</span> <span>=</span> <span>4.0</span><span>;</span>
    <span>context</span><span>.</span><span>shadowColor</span> <span>=</span> <span>&#34;rgba(0,0,0,0.5)&#34;</span><span>;</span>

    <span>// Fill the star with yellow.</span>
    <span>context</span><span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;#ffe633&#34;</span><span>;</span>
    <span>context</span><span>.</span><span>fill</span><span>(</span><span>)</span><span>;</span>

    <span>// Draw the star with a thick red stroke and rounded points.</span>
    <span>context</span><span>.</span><span>lineJoin</span> <span>=</span> <span>&#34;round&#34;</span><span>;</span>
    <span>context</span><span>.</span><span>lineWidth</span> <span>=</span> <span>12.0</span><span>;</span>
    <span>context</span><span>.</span><span>strokeStyle</span> <span>=</span> <span>&#34;#e60080&#34;</span><span>;</span>
    <span>context</span><span>.</span><span>stroke</span><span>(</span><span>)</span><span>;</span>

    <span>// Draw the star again with a dashed thinner orange stroke.</span>
    <span>const</span> <span>segments</span> <span>=</span> <span>[</span> <span>21.0</span><span>,</span> <span>9.0</span><span>,</span> <span>1.0</span><span>,</span> <span>9.0</span><span>,</span> <span>7.0</span><span>,</span> <span>9.0</span><span>,</span> <span>1.0</span><span>,</span> <span>9.0</span> <span>]</span><span>;</span>
    <span>context</span><span>.</span><span>setLineDash</span><span>(</span> <span>segments</span> <span>)</span><span>;</span>
    <span>context</span><span>.</span><span>lineDashOffset</span> <span>=</span> <span>10.0</span><span>;</span>
    <span>context</span><span>.</span><span>lineCap</span> <span>=</span> <span>&#34;round&#34;</span><span>;</span>
    <span>context</span><span>.</span><span>lineWidth</span> <span>=</span> <span>6.0</span><span>;</span>
    <span>context</span><span>.</span><span>strokeStyle</span> <span>=</span> <span>&#34;#f2a626&#34;</span><span>;</span>
    <span>context</span><span>.</span><span>stroke</span><span>(</span><span>)</span><span>;</span>

    <span>// Turn off the drop shadow.</span>
    <span>context</span><span>.</span><span>shadowColor</span> <span>=</span> <span>&#34;rgba(0,0,0,0.0)&#34;</span><span>;</span>

    <span>// Add a shine layer over the star.</span>
    <span>let</span> <span>gradient</span> <span>=</span> <span>context</span><span>.</span><span>createLinearGradient</span><span>(</span> <span>64.0</span><span>,</span> <span>0.0</span><span>,</span> <span>192.0</span><span>,</span> <span>256.0</span> <span>)</span><span>;</span>
    <span>gradient</span><span>.</span><span>addColorStop</span><span>(</span> <span>0.30</span><span>,</span> <span>&#34;rgba(255,255,255,0.0)&#34;</span> <span>)</span><span>;</span>
    <span>gradient</span><span>.</span><span>addColorStop</span><span>(</span> <span>0.35</span><span>,</span> <span>&#34;rgba(255,255,255,0.8)&#34;</span> <span>)</span><span>;</span>
    <span>gradient</span><span>.</span><span>addColorStop</span><span>(</span> <span>0.45</span><span>,</span> <span>&#34;rgba(255,255,255,0.8)&#34;</span> <span>)</span><span>;</span>
    <span>gradient</span><span>.</span><span>addColorStop</span><span>(</span> <span>0.50</span><span>,</span> <span>&#34;rgba(255,255,255,0.0)&#34;</span> <span>)</span><span>;</span>
    <span>context</span><span>.</span><span>fillStyle</span> <span>=</span> <span>gradient</span><span>;</span>
    <span>context</span><span>.</span><span>globalCompositeOperation</span> <span>=</span> <span>&#34;source-atop&#34;</span><span>;</span>
    <span>context</span><span>.</span><span>fillRect</span><span>(</span> <span>0.0</span><span>,</span> <span>0.0</span><span>,</span> <span>256.0</span><span>,</span> <span>256.0</span> <span>)</span><span>;</span>

  <span>&lt;/</span><span>script</span><span>&gt;</span>
<span>&lt;/</span><span>body</span><span>&gt;</span>
<span>&lt;/</span><span>html</span><span>&gt;</span>










</pre></div>
</sub>
</td>
</div></div>
  </body>
</html>
