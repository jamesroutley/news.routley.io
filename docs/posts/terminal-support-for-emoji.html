<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://darrenburns.net/posts/emoji-in-the-terminal/">Original</a>
    <h1>Terminal Support for Emoji</h1>
    
    <div id="readability-page-1" class="page"><div><div><h2>Some terminals don&#39;t understand them</h2><p>If your terminal doesn&#39;t treat multi-codepoint emoji correctly (Hyper, for example), it will essentially just iterate through each codepoint and render it as is:</p><div><pre><p><span>&gt;&gt;</span><span>&gt;</span><span> </span><span>print</span><span>(</span><span>&#34;\U0001F468\u200D\U0001F467\u200D\U0001F466&#34;</span><span>)</span><span></span></p><p><span>ğŸ‘¨ğŸ‘§ğŸ‘¦</span></p></pre></div><p>This is problematic for terminal-based applications because two identical strings can display with different widths depending on the environment.</p><p>If a user is running Hyper, three emoji are rendered (ğŸ‘¨ğŸ‘§ğŸ‘¦).</p><p>If they&#39;re on iTerm2, a single emoji is rendered (ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦).</p><h2>Terminals that do understand them don&#39;t know how wide they are</h2><p>Even worse, terminal emulators themselves often don&#39;t know how much visual space an emoji will take up.
Graphical emoji are typically treated as &#34;East Asian Wide&#34; characters, which take up 2 &#34;cell-widths&#34; in the terminal.
In other words, they take up the same width as two ASCII characters:</p><div><pre><p><span>&gt;&gt;</span><span>&gt;</span><span> </span><span>print</span><span>(</span><span>&#34;ğŸ‘¨\n12&#34;</span><span>)</span><span>  </span><span></span></p><p><span>ğŸ‘¨                   </span><span></span></p><p><span></span><span>12</span><span>                   </span></p></pre></div><p>You might wonder:</p><div><p>&#34;Can&#39;t you just detect the width of an emoji by writing it to the terminal and checking how many columns the cursor has moved forward by?&#34;</p></div><p>Unfortunately not. Most terminals incorrectly regard graphical Emoji Presentation Sequences as having cell width of 1.
For example, iTerm2 considers the &#34;rosette&#34; ğŸµï¸ emoji to have width 1, so when it
writes the emoji it only progresses the cursor forward 1 column. This means any text that comes after it will overlap with the emoji:</p><p><span>
      <a href="https://darrenburns.net/static/e18918a65b3c7345f1509cdb2751a7a0/4c42d/rosette_overlap.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Rosette overlapping with text" title="Rosette overlapping with text" src="https://darrenburns.net/static/e18918a65b3c7345f1509cdb2751a7a0/a6d36/rosette_overlap.png" srcset="/static/e18918a65b3c7345f1509cdb2751a7a0/222b7/rosette_overlap.png 163w,/static/e18918a65b3c7345f1509cdb2751a7a0/ff46a/rosette_overlap.png 325w,/static/e18918a65b3c7345f1509cdb2751a7a0/a6d36/rosette_overlap.png 650w,/static/e18918a65b3c7345f1509cdb2751a7a0/4c42d/rosette_overlap.png 896w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy" decoding="async"/>
  </a>
    </span></p><p>This issue affects every terminal I&#39;ve tested: Visual Studio Code, iTerm2, Alacritty, and Hyper.</p><h2>Why does this happen?</h2><p>A single character can take up more than one cell, and the <a href="https://www.unicode.org/Public/13.0.0/ucd/EastAsianWidth.txt">East Asian Width Unicode database</a> is generally used by terminals to
determine how &#34;wide&#34; the character will be. East Asian Wide characters (such as Chinese, Japanese, and Korean ideographs) take up two cell widths in a terminal.</p><p>This approach comes from the <code>wcwidth</code> utility, and the comment at the top of the <a href="https://www.cl.cam.ac.uk/~mgk25/ucs/wcwidth.c">C source file</a> provides further insight into the difficulties faced here.</p><p>The clue to why some emoji are rendered incorrectly can be found via the <code>unicodedata</code> module. Let&#39;s use it to query the &#34;East Asian Width&#34; property of two codepoints in the Unicode database.</p><div><pre><p><span>&gt;&gt;</span><span>&gt;</span><span> unicodedata</span><span>.</span><span>east_asian_width</span><span>(</span><span>&#34;\U0001F4A3&#34;</span><span>)</span><span>  </span><span></span></p><p><span></span><span>&#39;W&#39;</span><span>  </span><span></span></p><p><span></span><span>&gt;&gt;</span><span>&gt;</span><span> unicodedata</span><span>.</span><span>east_asian_width</span><span>(</span><span>&#34;\U0001F6E5&#34;</span><span>)</span><span>  </span><span></span></p><p><span></span><span>&#39;N&#39;</span><span>  </span></p></pre></div><p>Here&#39;s how these emoji render in a terminal:</p><p><span>
      <a href="https://darrenburns.net/static/b593b0f95b3fa2fb2e0fa441a0d8b344/a1792/bomb_boat.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Rendering of the bomb and motorboat emojis in a terminal" title="Rendering of the bomb and motorboat emojis in a terminal" src="https://darrenburns.net/static/b593b0f95b3fa2fb2e0fa441a0d8b344/a6d36/bomb_boat.png" srcset="/static/b593b0f95b3fa2fb2e0fa441a0d8b344/222b7/bomb_boat.png 163w,/static/b593b0f95b3fa2fb2e0fa441a0d8b344/ff46a/bomb_boat.png 325w,/static/b593b0f95b3fa2fb2e0fa441a0d8b344/a6d36/bomb_boat.png 650w,/static/b593b0f95b3fa2fb2e0fa441a0d8b344/a1792/bomb_boat.png 780w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy" decoding="async"/>
  </a>
    </span></p><p>All terminal emulators I tested consider codepoints with an &#34;East Asian Width&#34; of <code>N</code> to have cell width of 1.
This is incorrect in the case of <a href="https://unicode.org/emoji/charts/emoji-variants.html">Emoji Presentation Sequences</a> -</p><p>In summary: a massive headache, avoid if possible.</p></div></div></div>
  </body>
</html>
