<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://liorsinai.github.io/mathematics/2021/11/05/quaternion-1-intro.html">Original</a>
    <h1>Quaternions</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
      <div>

        <p><em>Introduction to quaternions and rotations in 3D.</em></p>





<p>This is part of a series. The other articles are:</p>
<ul>
  <li><a href="https://liorsinai.github.io/mathematics/2021/11/28/quaternion-2-2d">Part 2: 2D rotations</a>.</li>
  <li><a href="https://liorsinai.github.io/mathematics/2021/12/03/quaternion-3">Part 3: quaternions</a>.</li>
  <li><a href="https://liorsinai.github.io/mathematics/2021/12/06/quaternion-4-interpolation">Part 4: interpolation</a>.</li>
</ul>

<p>This is a mathematical series and the following prerequisites are recommended: trigonometry, algebra, complex numbers, Euclidean geometry and linear algebra (matrices).</p>

<h3 id="table-of-contents">Table of Contents</h3>
<ul>
  <li><a href="#animating-in-3d">Animating in 3D</a></li>
  <li><a href="#mathematical-representations-of-rotations-in-3d">Mathematical representations of rotations in 3D</a>
    <ul>
      <li><a href="#1-three-angles-and-an-order">1. Three angles and an order</a></li>
      <li><a href="#2-an-axis-and-an-angle">2. An axis and an angle</a></li>
    </ul>
  </li>
  <li><a href="#outline">Outline</a></li>
  <li><a href="#extra-other-forms-of-axis-angle-rotations">Extra: Other forms of axis-angle rotations</a></li>
  <li><a href="#references">References</a></li>
</ul>


<h2 id="animating-in-3d">Animating in 3D</h2>

<p>A common problem in computer animations is rotating an object in fully 3D space. 
Think objects, spaceships and heroes tumbling and turning in complex sequences.
This is usually accomplished with an arcane mathematical object called a quaternion.<sup id="fnref:quarternion" role="doc-noteref"><a href="#fn:quarternion" rel="footnote">1</a></sup>
For example, here is a spaceship rotating in <a href="https://unity.com/">Unity</a>, a popular game engine that is often used to make mobile games:</p>

<figure>
<img src="https://liorsinai.github.io/assets/posts/quaternions/slerp10.gif" alt="rotating cruiser"/>
<figcaption>Space Cruiser 1 by <a href="https://assetstore.unity.com/packages/3d/vehicles/air/space-cruiser-1-124172">Gamer Squid</a></figcaption>
</figure>

<p>The code to implement this uses Unity’s inbuilt <code>Quaternion</code>, making it very succinct:</p>

<figure><pre><code data-lang="csharp"><span>var</span> <span>t</span> <span>=</span> <span>Time</span><span>.</span><span>time</span> <span>*</span> <span>speed</span><span>;</span>
<span>transform</span><span>.</span><span>rotation</span> <span>=</span> <span>Quaternion</span><span>.</span><span>Slerp</span><span>(</span><span>init</span><span>.</span><span>rotation</span><span>,</span> <span>final</span><span>.</span><span>rotation</span><span>,</span> <span>t</span><span>);</span></code></pre></figure>

<p>In Unity’s UI the <code>init</code> and <code>final</code> rotations are specified by three angles, which are then transformed into quaternions in the backend. This means that printing a rotation will result in four numbers, not three.</p>

<p>What are these four numbers? Unity’s own <a href="https://docs.unity3d.com/ScriptReference/Quaternion.html">documentation</a> is very elusive on what quaternions are. It is worth quoting it:</p>

<blockquote>
	<p>
	Quaternions are used to represent rotations. 
	</p>
	<p>
	They are compact, don&#39;t suffer from gimbal lock and can easily be interpolated. Unity internally uses Quaternions to represent all rotations.  
	</p>
	<p>
	They are based on complex numbers and are not easy to understand intuitively. You almost never access or modify individual Quaternion components ...
	</p>
</blockquote>

<p>This is a common caveat next to the descriptions of properties:</p>
<blockquote>
	Don&#39;t modify this directly unless you know quaternions inside out.
</blockquote>

<p>I did not encounter quaternions in all my years of engineering, although a lecturer once alluded to them during a class in my masters.
They are frowned upon in favour of more intuitive and versatile vectors and matrices.
Those can also be used to calculate 3D rotations and that is an approach that I did use in engineering, especially in my masters.</p>

<p>So why then are computer game developers and animators left to battle with this obscure mathematics that engineers won’t touch? Unity gives good reasons: compactness (4 numbers), numerical stability (“don’t suffer from Gimbal lock”) and interpolation (easy to find rotations between other rotations).<sup id="fnref:interpolation" role="doc-noteref"><a href="#fn:interpolation" rel="footnote">2</a></sup>
These are significant differentiating factors in computer games and animations, which may need to compute many thousands of rotations every frame.</p>

<p>This series of posts seeks to illuminate quaternions so that you are one of those people who knows them “inside out”.
Later posts will build the logical foundations for quaternions and describe the mathematics in detail.
For the meantime, the rest of this post will be an interactive review of rotation methods in 3D.</p>

<h2 id="mathematical-representations-of-rotations-in-3d">Mathematical representations of rotations in 3D</h2>

<p>There are two main methods to describe 3D rotations:</p>
<ol>
  <li>Three angles and an order.</li>
  <li>An axis with three co-ordinates and an angle.</li>
</ol>

<p>In both cases four quantities are used to describe the rotation, but usually one degree of freedom is fixed.
For three angles, the order is fixed. For the axis-angle representation, the axis is set to have a unit length, so it can only exist on the unit sphere and hence two numbers are sufficient to describe it (latitude and longitude).
In either case, there are three remaining degrees of freedom.</p>

<h3 id="1-three-angles-and-an-order">1. Three angles and an order</h3>

<div><p>
	Instructions: slide each angle in the following order: ψ, θ, φ.
	</p>
	
	
	
	
	<p><span> For the best user experience, use a large monitor. </span>
</p></div>

<p>An intuitive way to describe a rotation is with three separate angles. These are known as the Euler angles after the great mathematician Leonhard Euler.
There are many different conventions for Euler angles depending on the axes and orders chosen.
For the interactive graph I have used the Tait-Bryan angle representation, which is often used in engineering.
Here is an illustration:</p>
<figure>
<img src="https://liorsinai.github.io/assets/posts/quaternions/Plane_ZYX.png" alt="Tait-Bryran angles"/>
<figcaption>Modified from <a href="https://en.wikipedia.org/wiki/File:Plane_with_ENU_embedded_axes.svg">Wikipedia</a></figcaption>
</figure>
<p>The three angles are:</p>
<ul>
  <li>$\psi$: yaw, about the $z$ axis.</li>
  <li>$\theta$: pitch, about the $y’$ axis<sup id="fnref:pitch" role="doc-noteref"><a href="#fn:pitch" rel="footnote">3</a></sup></li>
  <li>$\phi$: roll, about the $x’’$ axis.</li>
</ul>

<p>The order used is yaw-pitch-roll, also called $\psi$-$\theta$-$\phi$ or $z$-$y’$-$x’’$ or ZYX. 
As an example of how the order affects the final rotation, here are two rotations done with a yaw of 30° and a roll of 90°. The left uses the yaw-roll order and the right a roll-yaw order.</p>
<figure>
<img src="https://liorsinai.github.io/assets/posts/quaternions/Cruiser_euler.png" alt="Tait-Bryan angles"/>
<figcaption>Yaw-roll (left) and roll-yaw (right). </figcaption>
</figure>
<p>On the left, the cruiser first rotates 30° to the left and then rolls on its side.
On the right, the cruiser rolls on it side first, so that a pilot sitting inside would perceive his left as <em>up</em>, and hence the yaw rotation results in a 30° movement upwards.
This is why the order needs to be specified.</p>

<p>Given the order, each angle can be used to construct a 3×3 rotation matrix $R_{\alpha}$ which represents a 2D rotation about an axis. See <a href="https://liorsinai.github.io/mathematics/2021/11/28/quaternion-2-2d">part 2</a> for more detail.
Then the rotated vector $v_r$ is obtained from $v$ by multiplying each matrix in order:</p><p>

\[v_r = R_{\phi}R_{\theta}R_{\psi}v\]

</p><div>
  <div>
    <h5>Matrix defintions</h5>
    <p>
		\[
		R_{\psi} =
		\begin{bmatrix} 
			\cos(\psi) &amp; -\sin(\psi) &amp; 0 \\
			\sin(\psi) &amp;  \phantom{+}\cos(\psi) &amp; 0 \\
			0 &amp; 0 &amp; 1 
		\end{bmatrix}
		\]
		\[
		R_{\theta} =
		\begin{bmatrix} 
			\phantom{+}\cos(\theta) &amp; 0 &amp; \sin(\theta) \\
			0 &amp;  1  &amp; 0 \\
			-\sin(\theta) &amp; 0 &amp; \cos(\theta) 
		\end{bmatrix}
		\]
		\[
		R_{\phi} =
		\begin{bmatrix} 
			1 &amp; 0 &amp; 0 \\
			0 &amp; \cos(\phi)  &amp; -\sin(\phi) \\
			0 &amp; \sin(\phi) &amp;  \phantom{+}\cos(\phi) 
		\end{bmatrix}
		\]
	</p>
  </div>
</div>

<p>I would like to emphasise that the above graph is dynamically generated by using this equation to update the 3D co-ordinates for the Plotly charting library.
The result is a natural looking rotation.<sup id="fnref:plotly_rotations" role="doc-noteref"><a href="#fn:plotly_rotations" rel="footnote">4</a></sup>
The JavaScript code can be found <a href="https://liorsinai.github.io/assets/posts/quaternions/EulerAngles.js">here</a> or with your browser’s inspection tools.</p>

<p>If you do follow the order, the base will rotate about one circle of the gimbal at the time.
But what if you don’t follow it?
For example, you move $\theta$ and $\phi$ before $\psi$?
Go back and try this if you haven’t already.
The answer is, the whole gimbal rotates to the orientation <em>where it would have been</em> if the rotation order of $z$-$y’$-$x’’$ was respected.
This path cannot be represented with the angles $\psi$, $\theta$ or $\phi$. (It can be with other Euler angles but that only shifts the problem.)
This already illustrates one of the biggest problems with Euler angles: it enforces unnatural constraints.</p>

<p>To see how this can create complexity, consider the interpolation problem in the initial GIF of this post.
Given the angles for the first and final rotation, how would you find the rotation at the middle point?</p>
<figure>
<img src="https://liorsinai.github.io/assets/posts/quaternions/missing.png" alt="cruiser static frames - missing middle"/>
<figcaption></figcaption>
</figure>
<p>First make a circle that connects the nose of the cruiser from its starting position to its final position.
Then for each point on the arc of the circle, find some $\psi$, $\theta$ and $\phi$ applied in that order that will result in a rotation to that point.
This requires adjusting three angles simultaneously. 
One can imagine an algorithm where you adjust $\psi$, then $\theta$ then $\phi$ and if the point doesn’t fall on the circle where it is supposed to go, start from the beginning at $\psi$ again.
A better algorithm is provided below, but it is still constrained by the same underlying process.
We’ll see shortly that the quaternion algorithm is much, much simpler.</p>

<p>
  <a data-toggle="collapse" href="#EulerInterp" role="button" aria-expanded="false" aria-controls="collapseExample">
    More detail: interpolation with Euler angles ⇩
  </a>
</p>
<div id="EulerInterp">
  <div>
		<ol>
			<li>
				Using the inner product: $\cos(\alpha) = \vec{p}_0 \cdot \vec{p}_1 = x_1 x_2 + y_1 y_2 + z_1 z_2 $
			</li>
			<li>
				The equation of the circle is $\vec{p}_t = r\cos(\alpha t)\hat{x} + r\sin(\alpha t)\hat{y}$
				<ul>
					<li> Define $r = \lvert  \vec{p}_0 \rvert = \lvert  \vec{p}_1 \rvert $ </li>
					<li> Define $\hat{x} = \frac{1}{r}\vec{p}_0 $ </li>
					<li> Calculate $\hat{y}$ from $\vec{p}_1 = r\cos(\alpha)\hat{x} + r\sin(\alpha)\hat{y}$  </li>
				</ul>
				We can use $t=0.5$ to find the middle vector.
			</li>
			<li>
				With (2) there is enough information to create the animation, but what if we want the angles?
				This requires solving 3 highly non-linear trigonometric equations from $p_t=R_{\phi}R_{\theta}R_{\psi}p_0$.
				An alternative is to calculate an axis-angle rotation matrix with $\hat{n} = \hat{x} \times \hat{y}$ and $\theta = \alpha t$. Then compare terms with the Euler rotation matrix.
			</li>
		</ol>
  </div>
</div>

<p>Another problem comes from gimbal lock. 
This is not an issue when the rotations are enforced, which is the situation in animations.
But going the other way, where rotations need to be calculated from accelerations and velocities - as is often the case in physics problems - this is a major problem.
In particular, when the pitch is 90°, yaw and roll switch, and this provides enough ambiguity in the equations to inject significant numeric instability. (The same happens at a 90° angle for yaw and roll but only the middle angle causes a problem.)
For this reason, Euler angles should never be used in physics simulations - I speak from experience.</p>

<p>
  <a data-toggle="collapse" href="#gimballock" role="button" aria-expanded="false" aria-controls="collapseExample">
    More detail: proving gimbal lock ⇩
  </a>
</p>
<div id="gimballock">
  <p>
  The symbol $\omega$ is used to denote an angular velocity e.g. $\omega_\alpha = \frac{d\alpha}{dt}$, measured in radians/second. In physics problems we often have the angular velocity in the world frame, $\omega^0$ but we need the angular velocities of the Euler angles to integrate to get the Euler angles. These angular velocities are related as follows:
		\[
		\begin{align}
		\vec{\omega}^0
		&amp;=
		\omega_{\psi}\hat{z} + \omega_{\theta}\hat{y}&#39; + \omega_{\phi}\hat{x}&#39;&#39; \\
		\begin{bmatrix} 
			\omega_{x}^0 \\
			\omega_{y}^0 \\
			\omega_{z}^0
		\end{bmatrix} 
		&amp;=
		\omega_{\psi}
		\begin{bmatrix} 
			0 \\
			0 \\
			1
		\end{bmatrix}
		+
		\omega_{\theta} R_{\psi}
		\begin{bmatrix} 
			0 \\
			1 \\
			0
		\end{bmatrix}
		+
		\omega_{\phi} R_{\psi}R_{\theta}
		\begin{bmatrix} 
			1 \\
			0 \\
			0
		\end{bmatrix} \\
		&amp;=
		\omega_{\psi}
		\begin{bmatrix} 
			0 \\
			0 \\
			1
		\end{bmatrix}
		+
		\omega_{\theta}
		\begin{bmatrix} 
			-\sin(\phi) \\
			\phantom{+}\cos(\phi) \\
			0
		\end{bmatrix}
		+
		\omega_{\phi}
		\begin{bmatrix} 
			\cos(\phi)\cos(\theta) \\
			\sin(\phi)\cos(\theta) \\
			-\sin(\theta)
		\end{bmatrix} \\
		&amp;= 
		\begin{bmatrix} 
			\cos(\phi)\cos(\theta) &amp; -\sin(\phi) &amp; 0 \\
			\sin(\phi)\cos(\theta) &amp; \phantom{+}\cos(\phi) &amp; 0\\
			-\sin(\theta)         &amp; 0 &amp; 1
		\end{bmatrix} 
		\begin{bmatrix} 
			\omega_{\phi} \\
			\omega_{\theta} \\
			\omega_{\psi}
		\end{bmatrix} 
		\end{align} 
		\]
		Invert the matrix to get the unknown Euler velocities in terms of the known world velocities:
		\[
		\begin{align}
		\Rightarrow
		\begin{bmatrix} 
			\omega_{\phi} \\
			\omega_{\theta} \\
			\omega_{\psi}
		\end{bmatrix}
		&amp;=
		\frac{1}{\cos(\theta)}
		\begin{bmatrix} 
			\cos(\psi) &amp; \sin(\psi) &amp; 0 \\
			-\sin(\psi)\cos(\theta) &amp; \cos(\psi)\cos(\theta) &amp; 0\\
			\phantom{+}\cos(\psi)\sin(\theta)  &amp; \sin(\psi)\sin(\theta) &amp; 1
		\end{bmatrix} 
		\begin{bmatrix} 
			\omega_{x}^0 \\
			\omega_{y}^0 \\
			\omega_{z}^0
		\end{bmatrix}
		\end{align} 
		\]
		This expression is undefined for $\cos\theta = 0$, which happens at $\theta = n\frac{\pi}{2} \;, n \in \mathbb{Z}$.
		This is where gimbal lock happens.
  </p>
</div>

<p>Concluding this section, we have discovered that Euler angles are intuitive and work well for static systems.
However they are not suited for dynamic systems, whether that be through interpolation or numerical integration.
Thankfully the next method does work well in the latter case.</p>

<h3 id="2-an-axis-and-an-angle">2. An axis and an angle</h3>

<div><p>
	Instructions: slide the α and β sliders to change the normal vector. Slide θ to rotate in a circle around the normal vector.
	</p>
	
	
	
	<p id="quaternionText-q">
		q = +1.000 + 0.000i + 0.000j + 0.000k
	</p>
	
	<p><span> For the best user experience, use a large monitor. </span>
</p></div>

<p>Note that every point on the circle can be reached twice: through the clockwise rotation or through the anti-clockwise rotation.
This is known as the double cover property.</p>

<p>There are multiple ways to calculate the axis-angle representation. 
This graph uses a quaternion. 
See the source code <a href="https://liorsinai.github.io/assets/posts/quaternions/Quaternion.js">here</a> or with your browser’s inspection tools.</p>

<p>What is a quaternion? Here is a mathematical definition:</p>
<div>
  <div>
    <h5>Definition: Quaternion</h5>
	<h6>/kwəˈtəːnɪən/</h6>
    <p>
		A quaternion is a number of the form $$s + xi+yj + zk \; ; \; s, x, y, z \in 	\mathbb{R}$$
		where the basis elements $i$, $j$ and $k$ obey the following rules of multiplication: 
		$$i^2 = j^2 = k^2 = ijk = -1 \;,\; ij=k \;,\; ji=-k$$
	</p>
  </div>
</div>
<p>It may be unusual that $ij=k$ but $ji=-k$, but this should not be surprising after the Euler angles section.
3D rotations depend on order and hence any mathematics that represents them must depend on order.
<a href="https://liorsinai.github.io/mathematics/2021/12/03/quaternion-3">Part 3</a> will provide further physical justifications for this abstract definition.</p>

<p>The quaternion is calculated from the normal vector and $\theta$ as follows:</p><p>

\[\begin{aligned}
\hat{n} &amp;= \cos(\beta)\cos(\alpha)i + \cos(\beta)\sin(\alpha)j + \sin(\beta)k \\
		q &amp;= \cos(\tfrac{\theta}{2}) + \sin(\tfrac{\theta}{2})\hat{n}
\end{aligned}\]

</p><p>The rotation is then done with this formula (proved in <a href="https://liorsinai.github.io/mathematics/2021/12/03/quaternion-3">part 3</a>):</p><p>

\[\begin{aligned}
	v_r &amp;= qvq^{*}\\
		&amp;= (\cos (\tfrac{\theta}{2}) + \sin (\tfrac{\theta}{2})\hat{n})v(\cos (\tfrac{\theta}{2})- \sin (\tfrac{\theta}{2}) \hat{n})
\end{aligned}\]

</p><p>Euler angles are 3D which we can visualise, while quaternions are 4D which means we cannot.
Why then should we prefer quaternions?
Their main advantage comes with interpolations.
Here again is the problem of finding the middle rotation between the starting and final rotations in the GIF:</p>
<figure>
<img src="https://liorsinai.github.io/assets/posts/quaternions/static.png" alt="cruiser static frames"/>
<figcaption></figcaption>
</figure>
<p>Again we draw the arc of a circle which the nose of the cruiser will travel along.
The axis-angle representation is a natural fit to this problem, because this arc can itself be represented with a normal vector and an angle.
Even so, the quaternion solution to the problem is unexpectedly simple.
For this special case of $t=0.5$, calculate the quaternion:</p><p>

\[q_{0.5} = \frac{q_{0.0} + q_{1.0}}{2}\]

</p><p>and apply the rotation formula. Done.</p>

<p>In general the expression for $q_t$ is more complex. But I hope this example gives a sense of the power of quaternions.</p>

<h2 id="outline">Outline</h2>

<p>Using quaternions for 3D rotations is a very sensible choice for animation software.
They are essentially an array of four numbers with the normal rules for addition and subtraction and some special rules for multiplication. Encode that, and you get rotation functions and stateless, fast, interpolations almost for free.</p>

<p>I hope this post has illuminated some of their properties and advantages.
If you wish to learn more, the rest of the series will expand more on the mathematics of quaternions.</p>
<ul>
  <li><a href="https://liorsinai.github.io/mathematics/2021/11/28/quaternion-2-2d">Part 2</a> describes rotations in 2D. It describes complex numbers, which can be thought of as a simpler type of quaternion.</li>
  <li><a href="https://liorsinai.github.io/mathematics/2021/12/03/quaternion-3">Part 3</a> describes the fundamentals of quaternions and their mathematics. A few proofs of their properties are given.</li>
  <li><a href="https://liorsinai.github.io/mathematics/2021/12/06/quaternion-4-interpolation">Part 4</a> focuses on interpolation. 
An interactive graph with a stick aeroplane in place of the Unity space cruiser is presented.</li>
</ul>

<p>To get the most out of this series, you should be comfortable with trigonometry, algebra, complex numbers, Euclidean geometry and linear algebra (matrices).
This maths was covered in my first year of engineering.</p>

<p>This series is the kind I would have liked to see.
When I first learnt about quaternions I found that I had to consult many sources to understand them properly.
Nearly every source began with a story of an Irish mathematician, a bridge, and an epiphany that caused him to carve the fundamental formula of quaternions into the stone. It’s a nice story but it is a confusing one to begin with. 
Why did he have this epiphany? What “magic” did he grasp that day and can we also?
In <a href="https://liorsinai.github.io/mathematics/2021/12/03/quaternion-3">part 3</a> I do tell this story, but at a point where sufficient mathematics has been discussed so we can somewhat approximate the mathematician’s thoughts that day. Instead I chose to lead with a different story; one about why quaternions are still relevant 178 years later. I hope this was appreciated.</p>

<p>This series is written from the perspective of an engineer. 
I try to introduce ideas and justify them in as intuitive a way as possible.
Mathematical proofs are only done for identities where that is difficult.
I also do not explore how quaternions fit into the general context of mathematical fields and algebras,
or more general versions of quaternion algebra.</p>



<p>Identical rotations could also be accomplished with other formulas, namely the Rodrigues’ formulas and with Pauli matrices.
I will give the formulas without going into detail; this is only to compare forms.</p>

<p>The Rodrigues’ formulas are as follows:</p><p>

\[\begin{aligned}
\vec{v}_r &amp;=  \cos \theta \vec{v}+ 
			\sin \theta (\hat{n} \times \vec{v})
			+ (1-\cos \theta)(\vec{v} \cdot \hat{n}) \hat{n} \\
\vec{v}_r &amp;= [I_3 + \sin\theta N + (1-\cos \theta) N^2]\vec{v} \;, \; N\vec{v} = \hat{n} \times \vec{v}
\end{aligned}\]

</p><p>Note that $\vec{v} = (x, y, z)^T \equiv 0 + xi + yj + zk = v$.</p>

<p>The Pauli matrices formula is a sort of intermediate form between quaternions and the Rodrigues formulas. It uses 2×2 matrices and complex numbers:</p><p>

\[\begin{aligned}
	\vec{v} \cdot \vec{\sigma} &amp;= 
	\begin{bmatrix}
	z    &amp; x + iy \\
	x - iy &amp; -z
	\end{bmatrix} \\
	U &amp;= \cos (\tfrac{\theta}{2}) I_2 - \sin (\tfrac{\theta}{2})(i\hat{n} \cdot \vec{\sigma}) \\
	\vec{v}_r \cdot \vec{\sigma} &amp;= U(\vec{v} \cdot \vec{\sigma} ) U^\dagger 
\end{aligned}\]

</p><p>Here again is the quaternion formula:</p><p>

\[\begin{aligned}
	v_r &amp;= qvq^{*}\\
		&amp;= (\cos (\tfrac{\theta}{2}) + \sin (\tfrac{\theta}{2})\hat{n})v(\cos (\tfrac{\theta}{2})- \sin (\tfrac{\theta}{2}) \hat{n})
\end{aligned}\]

</p><p>These are four different formulas which are based on four different branches of mathematics (Euclidean geometry, linear algebra and complex numbers, quaternions) with multiple different types of multiplications (scalar multiplication, quaternion multiplication, dot products, vector cross products and matrix multiplication), yet these formulas all represent the same physical rotation and will result in identical vectors $\vec{v}_r$.</p>

<p>For a comparison of all formulas in Julia, please see this repository: <a href="https://github.com/LiorSinai/Rotations.jl">Rotations.jl</a>.</p>

<p>Quaternions are best for interpolations and hence animations.
But any of these methods will work for physics simulations.
Personally, I have successfully used the Rodrigues matrix formula on simulations of complex 3D robots.</p>

<p>
  <a data-toggle="collapse" href="#axisAngleVelocity" role="button" aria-expanded="false" aria-controls="collapseExample">
    More detail: axis-angle formulas from angular velocities ⇩
  </a>
</p>
<div id="axisAngleVelocity">
  <p>
	It is straightforward to calculate the normal vector and angle from angular velocities.
	An object with an angular velocity $\vec{\omega}$ rotates about an axis parallel to $\vec{\omega}$. So the normal vector is $\hat{n} = \frac{\vec{\omega}}{\lvert \vec{\omega} \rvert}$. $\theta$ is a measure of the magnitude of this rotation: $ \theta = \lvert \vec{\omega} \rvert \Delta t = \sqrt{ \omega_x^2  + \omega_y^2  + \omega_z^2 }\Delta t $. Then apply any  of the axis-angle formulas.
  </p>
</div>

<h2 id="references">References</h2>

<p>There are many sources I used to learn about quaternions.
Each provides more detail in some area, whether it be animations, mathematical formulas, or visualisations.</p>
<ul>
  <li><a href="https://web.mit.edu/2.998/www/QuaternionReport1.pdf">Quaternions, Interpolation and Animation by Erik B. Dam, Martin Koch and Martin Lillholm (1998)</a>: a comprehensive guide of quaternion mathematics and how to use them in animations. The main source material for this series.</li>
  <li><a href="https://link.springer.com/book/10.1007/978-3-030-56694-4">Quaternion Algebras by John Voight (2021)</a>: a complete textbook on Quaternion Algebras. It shows that quaternions as used in animations are a choice within a larger group of similar algebras. It presents many elegant proofs for the properties of quaternions. It quickly goes beyond normal quaternions and most certainly this author’s knowledge.</li>
  <li><a href="https://www.astro.rug.nl/software/kapteyn-beta/_downloads/attitude.pdf">Representing Attitude: Euler Angles, Unit Quaternions, and Rotation Vectors by James Diebel (2006)</a>: a concise guide to Euler angles and quaternions, with formulas for many different kinds and conversion formulas between each type.</li>
  <li><a href="https://eater.net/quaternions">Visualizing quaternion by Grant Sanderson and Ben Eater</a>: a stunning interactive website with tutorials on visualising 4 dimensional quaternions in 3 dimensions through stereographic projections.</li>
  <li><a href="https://www.youtube.com/watch?v=ACZC_XEyg9U">Dirac’s belt trick, Topology, and Spin ½ particles by Noah Miller</a>: an interesting video on the applications of 3D rotations in quantum mechanics. I encountered the Pauli matrices rotation formula for the first time in this video.</li>
  <li><a href="https://en.wikipedia.org/wiki/Quaternion">Wikipedia</a>: comprehensive articles on quaternions and related subjects.</li>
  <li><a href="https://www.wired.com/story/meet-the-four-dimensional-numbers-that-led-to-modern-algebra/">Wired article</a> on quaternions: a brief history of quaternions, their old rivalry with vectors and their impact.</li>
</ul>

<hr/>




        <hr/>

        

      </div>
    </div>
  </div></div>
  </body>
</html>
