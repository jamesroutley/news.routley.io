<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.royvanrijn.com/blog/2022/03/all-the-music-megamix/">Original</a>
    <h1>I became the world&#39;s most prolific DJ, using code</h1>
    
    <div id="readability-page-1" class="page"><div>
      <p><a itemprop="mainEntityOfPage" href="https://www.royvanrijn.com/blog/2022/03/all-the-music-megamix/" title="All The Music: the Megamix">
        
          <img itemprop="image" src="https://www.royvanrijn.com/thumbnails/default.jpg" alt="All The Music: the Megamix" width="100" height="100"/>
        
      </a>
      </p>
      <p>
        Written by  (<span itemprop="publisher" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">royvanrijn.com</span></span>) on 
        <span itemprop="dateModified" content="2022-03-23T22:23:03+01:00">
        <span itemprop="datePublished" content="2022-03-23T22:23:03+01:00">
          Mar 23, 2022 22:23:03
        </span>
        : <a href="https://royvanrijn.com/blog/2022/03/all-the-music-megamix/#disqus_thread">0 comments</a>
      </span></p>
      
    </div><div itemprop="articleBody">
    <p>Or a clickbait title:</p>

<blockquote>
  <p>How I became the world‚Äôs most prolific DJ, using code.</p>
</blockquote>

<p>This week I stumbled across a cool project: <a href="http://allthemusic.info/">All The Music</a>.</p>

<p>Damien Riehl (programmer/copyright attorney) and Noah Rubin (programmer) decided to generate <strong>all possible songs</strong> with the basic 8 major notes (C4,D4,E4,F4,G4,A4,B4 and C5) with length 12. All these songs have been ‚Äòfreely‚Äô released under the ‚ÄòCreative Commons‚Äô license. Their goal is to stop copyright claims on melodies.</p>

<iframe type="text/html" width="640" height="390" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" src="https://www.youtube.com/embed/sJtm0MoOgiU?title=0&amp;byline=0&amp;portrait=0"></iframe>

<p>While watching their excellent TED talk and hearing about the challenges they had to generate these songs, my head instantly made some connections. They generated <strong>all</strong> songs of length <code>n=12</code> with <code>k=8</code> notes, this amounts to a staggering <code>n^k = 8^12 = 68,719,476,736</code> unique songs.</p>

<p>All these songs are 12 notes long and have their own MIDI file which adds even more overhead. The size of this dataset is <strong>huge</strong>, 1.2TB compressed using GZIP.</p>



<p>This is when I got an idea: perhaps we can use a <a href="https://www.royvanrijn.com/blog/2011/02/generating-de-bruijn-sequences-and-lyndon-words/">de Bruijn sequence</a> for this?</p>

<p>I‚Äôve blogged about those sequences before, basically it is an optimal way to arrange these N elements into a single sequence so that each and every combination of K-length is present in the sequence.</p>

<p>For example if we have all combinations of <code>0,1,2</code> of length <code>4</code> the na√Øve way would be to do it:</p>
<div><div><pre><code>0000
0001
0002
0010
0011
0012 (etc)
</code></pre></div></div>

<p>Instead when creating a de Bruijn we have:</p>

<div><div><pre><code>000012200210002212021211212222011221022211012101001011112001102111002012010202202[000]
</code></pre></div></div>

<p>Every possible 4-length combination/permutation is present in this single line (check them!).</p>

<p>What if we could <em>remix</em> <strong>every</strong> possible 12 note melody into one huge megamix!?</p>

<p>That would mean I‚Äôm mathematically the world‚Äôs best DJ, remixing almost all existing songs including <em>EVERY</em> song from the <a href="http://allthemusic.info/">All The Music</a> dataset into <strong>one</strong> song.</p>



<p>I already have some very efficient code to generate these sequences. What if I output the sequence as a single MIDI file?</p>

<p>Because a de Bruijn sequence usually wraps around, if we want to create all <code>n=12</code> length melodies we‚Äôll need to append the first <code>n-1</code> notes to the <strong>end</strong> of the sequence (which I‚Äôve done above as well). This means we‚Äôll need just a single MIDI file with <code>68,719,476,747</code> unique notes in it.</p>

<p>This gave me a <em>tiny</em> problem: a MIDI file has a ‚ÄòLENGTH‚Äô field stored in just 4-bytes. And <code>2^32</code> is <em>only</em> <code>4,294,967,295</code>. So we‚Äôve hit a technical problem, we can‚Äôt fit our remix into a single MIDI file.</p>

<p>To solve this I decided to cut the single song up into a collection of ‚Äòsmaller‚Äô more managable songs. In the end I settled on <code>2052</code> unique songs that create one huge megamix album. On this album is every single song possible with notes C4,D4,E4,F4,G4,A4,B4 and C5 of length 12. The same as is contained in the ATM‚Äôs dataset.</p>

<p>When breaking up a de Bruijn sequence, each new song has to repeat the final <code>n-1</code> notes of the previous song, that way each melody is contained in full. For example if we split the above sequence into two parts we‚Äôll need to do:</p>

<div><div><pre><code>Song 1: 000012200210002212021211212222011221022211012
Song 2: [012]101001011112001102111002012010202202[000]
</code></pre></div></div>

<p>This results in the following:</p>

<ul>
  <li><strong>1</strong> remix album: debruijn8-12.tar</li>
  <li>Size: 16.735.957.504 bytes (16,75 GB on disk)</li>
</ul>

<p>Contains:</p>

<ul>
  <li><strong>2052</strong> GZIP-ed MIDI songs</li>
  <li>2051 songs with a 33,500,000 note melody</li>
  <li>1 song with a 10,999,308 note melody</li>
</ul>



<p>Let‚Äôs listen to some songs that are in the dataset (somewhere):</p>

<p>Example 1, Twinkle Twinkle:</p>

<midi-player src="/music/example1.mid" sound-font="" visualizer="#myVisualizer-/music/example1.mid">
</midi-player>

<p>Example 2, Jingle Bells:</p>

<midi-player src="/music/example2.mid" sound-font="" visualizer="#myVisualizer-/music/example2.mid">
</midi-player>

<p>Example 3, Can You Feel The Love Tonight.</p>

<midi-player src="/music/example3.mid" sound-font="" visualizer="#myVisualizer-/music/example3.mid">
</midi-player>

<p>All possible 12 note melodies are in the remix.</p>



<p>This got me thinking, why didn‚Äôt Damien and Noah go for this approach? It is much smaller and faster to generate (in a single morning).</p>

<p>So I turned to Twitter and asked Damien Riehl!
And sure enough: his answer makes total sense:</p>

<blockquote>
  <p>We had initially considered a ‚Äúde Bruijn‚Äù sequence. But if we were to use a <em>single</em> file, that would have down sides:</p>

  <ul>
    <li>
      <p>If someone infringes our work, it would only be a tiny percentage (0.0000000001%?) of the ‚Äúwork‚Äù ‚Äî so someone would argue ‚Äúfair use‚Äù</p>
    </li>
    <li>
      <p>Same idea with others incorporating ATM works in theirs (‚Äútiny percentage‚Äù)</p>
    </li>
  </ul>

  <p>So our technical/legal design is ‚ÄúOne MIDI file per melody‚Äù ‚Äî which I think is a legal feature, not a bug.  üôÇ</p>
</blockquote>

<p>Of course I should have known there was a valid reason. He encouraged me to continue though and so I generated my own <code>de Bruijn album</code>. Now I can say I‚Äôve officially remixed <code>68,719,476,736</code> songs. Is there like a Guiness Book of World Records entry for me now?</p>

<p>If you‚Äôre curious what this remix sounds like, here is a snippet:</p>

<midi-player src="/music/snippet.mid" sound-font="" visualizer="#myVisualizer-/music/snippet.mid">
</midi-player>

<p>It was a fun exercise! I really love de Bruijn sequences and learned a lot about streaming GZIP/File API‚Äôs to easily store everything (generating the sequence first isn‚Äôt an option).</p>

<p>The album is, for now, only stored on my hard disk, but I‚Äôm working with Damien to get the songs added to their ATM collection on the <a href="https://archive.org/details/allthemusicllc-datasets">Internet Archive</a>.</p>

<p>Oh, and you can‚Äôt have a remix album without a proper album cover:</p>

<p><img src="https://www.royvanrijn.com/images/debruijn_album.jpg" alt="de Bruijn album cover"/></p>


    </div></div>
  </body>
</html>
