<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/krychu/wfc">Original</a>
    <h1>Wave Function Collapse library in pure C</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
          <article itemprop="text">
<p dir="auto">Single-file Wave Function Collapse library in C, plus a command-line tool</p>
<ul dir="auto">
<li>License: MIT</li>
<li>Version: 0.01</li>
</ul>
<p dir="auto">This is an early version that supports the overlapping WFC method.
The method takes an input image and generates output image which is
locally similar to the input image. Here&#39;re a few examples of
input/output pairs:</p>
<p><a target="_blank" rel="noopener noreferrer" href="https://user-images.githubusercontent.com/947457/116161084-6f546e00-a6f3-11eb-87d8-3ed9c2c7e26c.png"><img width="950px" src="https://user-images.githubusercontent.com/947457/116161084-6f546e00-a6f3-11eb-87d8-3ed9c2c7e26c.png"/></a></p>
<p dir="auto">For a good read on WFC see <a href="https://www.gridbugs.org/wave-function-collapse/" rel="nofollow">this
article</a>. It&#39;s particularly
useful for procedural generation of game levels.</p>
<h2 dir="auto"><a id="user-content-how-to-use-the-library" aria-hidden="true" href="#how-to-use-the-library"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>HOW TO USE THE LIBRARY</h2>
<p dir="auto">One file in your project should include <code>wfc.h</code> like this:</p>
<div data-snippet-clipboard-copy-content="        #define WFC_IMPLEMENTATION
        #include &#34;wfc.h&#34;"><pre>        #<span>define</span> <span>WFC_IMPLEMENTATION</span>
        #<span>include</span> <span><span>&#34;</span>wfc.h<span>&#34;</span></span></pre></div>
<p dir="auto">Other files can also include and use <code>wfc.h</code> but they shouldn&#39;t define
<code>WFC_IMPLEMENTATION</code> macro.</p>
<p dir="auto">Usage:</p>
<div data-snippet-clipboard-copy-content="        struct wfc *wfc = wfc_overlapping(
            128,             // Output image width in pixels
            128,             // Output image height in pixels
            input_image,     // Input image that will be cut into tiles
            3,               // Tile width in pixels
            3,               // Tile height in pixels
            1,               // Expand input image on the right and bottom
            1,               // Add horizontal flips of all tiles
            1,               // Add vertical flips of all tiles
            1                // Add n*90deg rotations of all tiles
        );

        wfc_run(wfc, -1);    // Run Wave Function Collapse
                             // -1 means no limit on iterations
        struct wfc_image *output_image = wfc_output_image(wfc);
        wfc_destroy(wfc);
        // use output_image-&gt;data
        // wfc_img_destroy(output_image);"><pre>        <span>struct</span> wfc *wfc = wfc_overlapping(
            <span>128</span>,             <span><span>//</span> Output image width in pixels</span>
            <span>128</span>,             <span><span>//</span> Output image height in pixels</span>
            input_image,     <span><span>//</span> Input image that will be cut into tiles</span>
            <span>3</span>,               <span><span>//</span> Tile width in pixels</span>
            <span>3</span>,               <span><span>//</span> Tile height in pixels</span>
            <span>1</span>,               <span><span>//</span> Expand input image on the right and bottom</span>
            <span>1</span>,               <span><span>//</span> Add horizontal flips of all tiles</span>
            <span>1</span>,               <span><span>//</span> Add vertical flips of all tiles</span>
            <span>1</span>                <span><span>//</span> Add n*90deg rotations of all tiles</span>
        );

        <span>wfc_run</span>(wfc, -<span>1</span>);    <span><span>//</span> Run Wave Function Collapse</span>
                             <span><span>//</span> -1 means no limit on iterations</span>
        <span>struct</span> wfc_image *output_image = wfc_output_image(wfc);
        <span>wfc_destroy</span>(wfc);
        <span><span>//</span> use output_image-&gt;data</span>
        <span><span>//</span> wfc_img_destroy(output_image);</span></pre></div>
<p dir="auto">By default you work with <code>struct wfc_image</code> for inputs and outputs.</p>
<div data-snippet-clipboard-copy-content="        struct wfc_image {
            unsigned char *data;
            int component_cnt;
            int width;
            int height;
         }"><pre>        <span>struct</span> wfc_image {
            <span>unsigned</span> <span>char</span> *data;
            <span>int</span> component_cnt;
            <span>int</span> width;
            <span>int</span> height;
         }</pre></div>
<p dir="auto"><code>data</code> is tightly packed without padding. Each pixel consists of
<code>component_cnt</code> components (e.g., four components for rgba format).
The output image will have the same number of components as the input
image.</p>
<p dir="auto"><code>wfc_run</code> returns 0 if it cannot find a solution. You can try again like so:</p>
<div data-snippet-clipboard-copy-content="        wfc_init(wfc);
        wfc_run(wfc, -1);"><pre>        <span>wfc_init</span>(wfc);
        <span>wfc_run</span>(wfc, -<span>1</span>);</pre></div>
<h3 dir="auto"><a id="user-content-working-with-image-files" aria-hidden="true" href="#working-with-image-files"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Working with image files</h3>
<p dir="auto">wfc can optionally use <a href="https://github.com/nothings/stb">stb_image.h</a> and <a href="https://github.com/nothings/stb">stb_write.h</a> to provide
convenience functions for working directly with image files.</p>
<p dir="auto">You will normally place <code>stb_image.h</code> and <code>stb_write.h</code> in the same
directory as <code>wfc.h</code> and include their implementations in one of the
project files:</p>
<div data-snippet-clipboard-copy-content="        #define STB_IMAGE_IMPLEMENTATION
        #define STB_IMAGE_WRITE_IMPLEMENTATION
        #include &#34;stb_image.h&#34;
        #include &#34;stb_image_write.h&#34;"><pre>        #<span>define</span> <span>STB_IMAGE_IMPLEMENTATION</span>
        #<span>define</span> <span>STB_IMAGE_WRITE_IMPLEMENTATION</span>
        #<span>include</span> <span><span>&#34;</span>stb_image.h<span>&#34;</span></span>
        #<span>include</span> <span><span>&#34;</span>stb_image_write.h<span>&#34;</span></span></pre></div>
<p dir="auto">Further, you will instruct <code>wfc.h</code> to use stb:</p>
<div data-snippet-clipboard-copy-content="        #define WFC_IMPLEMENTATION
        #define WFC_USE_STB
        #include &#34;wfc.h&#34;"><pre>        #<span>define</span> <span>WFC_IMPLEMENTATION</span>
        #<span>define</span> <span>WFC_USE_STB</span>
        #<span>include</span> <span><span>&#34;</span>wfc.h<span>&#34;</span></span></pre></div>
<p dir="auto">Usage:</p>
<div data-snippet-clipboard-copy-content="        struct wfc_image *input_image = wfc_img_load(&#34;input.png&#34;);
        struct wfc *wfc = wfc_overlapping(
            ...
            input_image,
            ...
        );

        wfc_run(wfc, -1);    // Run Wave Function Collapse
                             // -1 means no restriction on number of iterations
        wfc_export(wfc, &#34;output.png&#34;);
        wfc_img_destroy(input_image);
        wfc_destroy(wfc);"><pre>        <span>struct</span> wfc_image *input_image = wfc_img_load(<span><span>&#34;</span>input.png<span>&#34;</span></span>);
        <span>struct</span> wfc *wfc = wfc_overlapping(
            ...
            input_image,
            ...
        );

        <span>wfc_run</span>(wfc, -<span>1</span>);    <span><span>//</span> Run Wave Function Collapse</span>
                             <span><span>//</span> -1 means no restriction on number of iterations</span>
        <span>wfc_export</span>(wfc, <span><span>&#34;</span>output.png<span>&#34;</span></span>);
        <span>wfc_img_destroy</span>(input_image);
        <span>wfc_destroy</span>(wfc);</pre></div>
<p dir="auto">Extra functions enabled by the inclusion of stb:</p>
<div data-snippet-clipboard-copy-content="        struct wfc_image *image = wfc_img_load(&#34;image.png&#34;)
        wfc_img_save(image, &#34;image.png&#34;)
        wfc_export(wfc, &#34;output.png&#34;)
        wfc_export_tiles(wfc, &#34;directory&#34;)
        // don&#39;t forget to wfc_img_destroy(image) loaded images"><pre>        <span>struct</span> wfc_image *image = wfc_img_load(<span><span>&#34;</span>image.png<span>&#34;</span></span>)
        <span>wfc_img_save</span>(image, <span><span>&#34;</span>image.png<span>&#34;</span></span>)
        wfc_export(wfc, <span><span>&#34;</span>output.png<span>&#34;</span></span>)
        wfc_export_tiles(wfc, <span><span>&#34;</span>directory<span>&#34;</span></span>)
        <span><span>//</span> don&#39;t forget to wfc_img_destroy(image) loaded images</span></pre></div>
<h2 dir="auto"><a id="user-content-command-line-tool" aria-hidden="true" href="#command-line-tool"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>COMMAND-LINE TOOL</h2>
<p dir="auto">The command-line tool uses the library and allows to generate WFC images.
The tool depends on <a href="https://github.com/nothings/stb">stb_image.h</a>
and <a href="https://github.com/nothings/stb">stb_write.h</a>. Place both files in the same
directory as <code>wfctool.c</code>.</p>

<p dir="auto">Run <code>./wfc</code> to see available options</p>
<p dir="auto">Basic usage:</p>
<div data-snippet-clipboard-copy-content="        ./wfc -m overlapping -w 128 -h 128 input.png output.png"><pre><code>        ./wfc -m overlapping -w 128 -h 128 input.png output.png
</code></pre></div>
<h2 dir="auto"><a id="user-content-thanks" aria-hidden="true" href="#thanks"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>THANKS</h2>
<p dir="auto">Thanks for using wfc. If you find any bugs, have questions, or feedback please
let me know. Also, if you&#39;d like to share your works it&#39;s very appreciated.</p>
<p dir="auto">samp.krystian at gmail.com</p>
</article>
        </div></div>
  </body>
</html>
