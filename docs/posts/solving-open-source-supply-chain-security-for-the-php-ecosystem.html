<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://paragonie.com/blog/2022/01/solving-open-source-supply-chain-security-for-php-ecosystem">Original</a>
    <h1>Solving Open Source Supply Chain Security for the PHP Ecosystem</h1>
    
    <div id="readability-page-1" class="page"><div>
                    <p>To assert that &#34;There exist supply-chain security risks&#34; in any software ecosystem doesn&#39;t require a formal analysis nor multiple experts to peer review such a notion. It&#39;s kind of a given, especially with recent tech news.</p>
<p><strong>However, it&#39;s not a new problem.</strong> We were vocal about it <a href="https://paragonie.com/blog/2015/04/introducing-asgard-authentic-software-guard">in 2015</a>, when it was common practice for software projects to tell you to install their widget by running <code>curl http://some-domain | sh</code> in a terminal window. This specific anti-pattern had already been criticized widely by others since <a href="https://www.seancassidy.me/dont-pipe-to-your-shell.html">at least 2013</a>, but we were more interested in proposing a general solution to <a href="https://defuse.ca/triangle-of-secure-code-delivery.htm">secure code delivery</a>.</p>
<p>The only things that have really changed in the intervening years are:</p>
<ol>
<li>More people are aware of the risks today than 7 years ago,</li>
<li>More disasters have been caused by the lack of supply-chain security for open source software, and</li>
<li>
<strong>We know it&#39;s a solvable problem.</strong>
</li>
</ol>
<p>That last item might seem bold, but we&#39;ve been laying the groundwork for elegantly solving these problems for the PHP ecosystem since our company&#39;s inception. We had briefly introduced our complete solution when we <a href="https://paragonie.com/blog/2019/05/wordpress-5-2-mitigating-supply-chain-attacks-against-33-internet">announced that WordPress would cryptographically sign its automatic updates</a> in 2019. (If you&#39;d like more depth into this subject, we&#39;ve previously written about <a href="https://paragonie.com/blog/2017/09/supply-chain-attacks-and-secure-software-updates">supply-chain security in 2017</a> and <a href="https://paragonie.com/blog/2016/10/guide-automatic-security-updates-for-php-developers">automatic security updates in 2016</a>.)</p>
<p>Part of making an acceptable solution even possible required <a href="https://wiki.php.net/rfc/libsodium">getting modern cryptography into PHP</a> and writing a <a href="https://github.com/paragonie/sodium_compat">pure-PHP polyfill of ext/sodium for legacy versions of PHP</a>. (These are just two of the things that we&#39;re known for in the PHP community.)</p>
<p>So with all that in mind, let&#39;s take a quick look at Gossamer, our proposal for securing the software supply-chain for the PHP ecosystem.</p>
<h2>Gossamer: Security Through Transparency</h2>
<p>The elevator pitch for Gossamer is, <strong>Code-signing and third-party attestations published to a transparency log.</strong></p>
<h3>How Gossamer is Different</h3>
<p>Code-signing isn&#39;t a novel concept; most of the applications on your computer or smartphone are digitally signed by some entity (hopefully the developer), and typically involves a lot of X.509 machinations to work. There are other code-signing proposals for solving supply chain woes today (e.g. <a href="https://theupdateframework.io">TUF</a>).</p>
<p>The use of a transparency log isn&#39;t quite unique either. This requirement was first outlined in <a href="https://defuse.ca/triangle-of-secure-code-delivery.htm">the Triangle of Secure Code Delivery</a> (Userbase Consistency Verification), and has been adopted by <a href="https://www.sigstore.dev/">Sigstore</a>.</p>
<p>What makes Gossamer distinct from proposals that offer code-signing and transparency logs is:</p>
<ol>
<li>Gossamer provides a mechanism for third-party review before updates are applied to dependencies
<ul>
<li>We call these third-party reviews of a software update &#34;attestations&#34;</li>
<li>There are currently several types of attestations <a href="https://github.com/paragonie/libgossamer/blob/master/docs/specification/Protocol.md#attestupdate">specified</a>, ranging from <code>spot-check</code> to <code>sec-audit</code>; as well as a <code>vote-against</code> attestation for package updates <a href="https://www.theverge.com/2022/1/9/22874949/developer-corrupts-open-source-libraries-projects-affected">that shouldn&#39;t be installed at all</a>
</li>
</ul>
</li>
<li>Gossamer requires no centralized Certificate Authorities, ever
<ul>
<li>This largely mitigates the risk of <a href="https://blog.trailofbits.com/2012/06/11/analyzing-the-md5-collision-in-flame/">extralegal government action</a>
</li>
<li>Some ecosystems may optionally support a Super-Provider account that&#39;s capable of taking emergency action as a break-glass feature for mitigating emergencies</li>
</ul>
</li>
<li>Developers remain in control of their signing keys
<ul>
<li>This is drastically different than, e.g., <a href="https://developer.android.com/studio/publish/app-signing#app-signing-google-play">what Google does for Android apps</a>
</li>
<li>Instead, publishers are mapped to a set of <strong>public keys</strong>, and all changes to this mapping are distinct messages appended to the transparency log.</li>
</ul>
</li>
</ol>
<p>Additionally, all <strong>changes to public keys</strong>, <strong>software updates</strong>, and <strong>attestations</strong> are published onto a single transparency log, rather than different ones for each purpose. This prevents a partial censorship attack (i.e. allow updates to go through, but not key revocations or attestations, thereby preventing targets from rejecting known malware).</p>
<h3>Why Third-Party Attestations Matter</h3>
<p>There&#39;s an old belief in the Free and Open Source Software community, rooted in something called <a href="https://en.wikipedia.org/wiki/Linus&#39;s_law">Linus&#39;s Law</a>: &#34;Given enough eyeballs, all bugs are shallow.&#34;</p>
<p>Their reasoning goes: &#34;If software is open source, it is necessarily more secure than closed source software because more people <em>can</em> review the source code to identify vulnerabilities. Consequently, vulnerabilities will persist longer in closed source software (due to less scrutiny). Therefore, the average security of an open source software project is expected to be greater than if it was closed source.&#34;</p>
<p>However, as we&#39;ve seen over the years with GnuPG, OpenSSL, and Log4j (Did someone reading this just shout &#34;BINGO&#34;?), Linus&#39;s Law isn&#39;t a robust hypothesis. It assumes that, because anyone <em>can</em> inspect the code, then someone <em>will</em>. But there&#39;s no enforcement mechanism, so there will always be gaps, and there&#39;s no way for you or I to know where the gaps lie.</p>
<blockquote>
<p>But what if we could prove whether or not a particular software update was inspected, and to what degree?</p>
</blockquote>
<p>That&#39;s what Gossamer&#39;s Attestations do. In the current version of the Gossamer specification, there are five types of attestations permitted by <a href="https://github.com/paragonie/libgossamer/blob/master/docs/specification/Protocol.md#attestupdate">the <code>AttestUpdate</code> message</a>:</p>
<ul>
<li>
<code>vote-against</code>: &#34;This is malicious; don&#39;t install it.&#34;</li>
<li>
<code>reproduced</code>: &#34;We were able to reproduce this update from the source code.&#34; <strong>Requires open source software.</strong>
</li>
<li>
<code>spot-check</code>: &#34;We quickly looked at the code and didn&#39;t identify anything obviously malicious, like an infinite loop or a cryptocurrency miner. It&#39;s probably not terrible.&#34;</li>
<li>
<code>code-review</code>: &#34;We thoroughly reviewed this software update, and we have some concept of how the changes fit into the larger project, and we think it&#39;s fine.&#34;</li>
<li>
<code>sec-audit</code>: &#34;We&#39;re security experts and took the time to deliberately audit this update, its dependencies, how its dependencies are used, etc.&#34;</li>
</ul>
<p>This data isn&#39;t just lying around inert on the transparency log collecting dust, either. You can directly <a href="https://github.com/paragonie/libgossamer/blob/master/docs/tutorials/01-configuring-gossamer-client.md#step-two-configure-your-attestation-policy">configure an Attestation Policy for your update logic</a> in a Gossamer client, too.</p>
<p>For example (with contrived usernames):</p>
<pre><code>&lt;?php
use ParagonIE\Gossamer\Client\AttestPolicy;
use ParagonIE\Gossamer\Client\PolicyRules\AttestedAt;
use ParagonIE\Gossamer\Client\PolicyRules\AttestedAtOrAbove;
use ParagonIE\Gossamer\Client\PolicyRules\GroupAnd;
use ParagonIE\Gossamer\Client\PolicyRules\GroupOr;
use ParagonIE\Gossamer\Client\PolicyRules\Not;
use ParagonIE\Gossamer\Client\TrustMode\LocalTrust;
use ParagonIE\Gossamer\Db\PDO as PDOAdapter;

// Trust mode (local for simplicity)
$db = new PDOAdapter(new PDO(&#39;sqlite:/path/to/database.sql&#39;));
$myTrustMode = new LocalTrust($db);

// Attestation Policy:
$myAttestPolicy = (new AttestPolicy())
    -&gt;addRule(
        new GroupAnd(
            new AttestedAt(
                AttestPolicy::REPRODUCED,
                [&#39;reproduced-bot&#39;]
            ),
            new GroupOr(
                new AttestedAtOrAbove(
                    AttestPolicy::SPOT_CHECK,
                    [&#39;paragonie&#39;, &#39;symfony&#39;, &#39;laravel&#39;, &#39;ncc&#39;],
                    2
                ),
                new AttestedAtOrAbove(
                    AttestPolicy::CODE_REVIEW,
                    [&#39;paragonie&#39;, &#39;ncc&#39;]
                )
            ),
            new Not(
                new AttestedAt(
                    AttestPolicy::VOTE_AGAINST,
                    [&#39;jedisct1&#39;, &#39;muglug&#39;]
                )
            )
        )
    );

// Instantiate via dependency injection:
$gossamer = new GossamerClient(
    $myTrustMode,
    $myAttestPolicy
);

// Get an update record from the transparency log:
$record = $gossamer-&gt;getUpdate(&#39;symfony/polyfill-php80&#39;, &#39;v1.20.0&#39;);

// If it&#39;s valid...
if ($record-&gt;isFileValid($file)) {
    // Install it!
    my_custom_installer($file);
}</code></pre>
<p>In this example, even if an attacker pushed a malicious version of <code>symfony/polyfill-php80</code> to Packagist, it would not be installed by the client using this configuration unless all of the following conditions were met:</p>
<ol>
<li>It was confirmed as reproducible from the source code, by a hypothetical bot account that verifies this.</li>
<li>Either...
<ol>
<li>Two of the allow-listed vendors spot checked the release, or</li>
<li>One of the more security-focused vendors code-reviewed it.</li>
</ol>
</li>
<li>Neither of two separate vendors published a <code>vote-against</code> about this update.</li>
</ol>
<p>This is why Third-Party Attestations matter: They allow end users to prevent code from being installed when a developer goes rogue, without forcing end users to entirely in-house their review of third-party code.</p>
<h4>What Happens if a Third Party is Compromised?</h4>
<p>Attestations are immutable. There is no &#34;revoke&#34; feature for an attestation, only for keys and updates.</p>
<p>If an independent third-party publishes a bad attestation for an update, they have ceased to be trustworthy. The only recourse is to distrust said third party from your configuration.</p>
<p>This is an intentional feature of Gossamer&#39;s design; it forces security vendors to be transparent and accountable for the code they review.</p>
<h4>What Happens if Nobody Publishes Attestations, Fearing This Immutability?</h4>
<p>Would you trust a security vendor to protect you from attackers if they&#39;re <em>completely unwilling</em> to have some skin in the game and publicly stake their own reputation to help protect the open source community?</p>
<p>At the first sign of trouble, would they protect you and your customers, or clam up to cover their own asses? This would be a dumb problem to have, which is easily solved by getting better security vendors into the space.</p>
<h3>Why Not Use Blockchain To Solve This?</h3>
<p>When all you have is a hammer, every problem looks like a nail.</p>
<p>When all you have is a cryptocurrency, every problem looks like a good fit for blockchain technology.</p>
<p><a href="https://paragonie.com/blog/2017/07/chronicle-will-make-you-question-need-for-blockchain-technology">You don&#39;t need a blockchain</a>.</p>
<h2>Gossamer Project Status</h2>
<p>We published <a href="https://github.com/paragonie/libgossamer">libgossamer</a> years ago, which includes all of the pieces needed to get Composer and WordPress to onboard the protocol.</p>
<p>We also created a standalone <a href="https://github.com/paragonie/gossamer-server">gossamer-server</a>, which serves as a middleware between the Gossamer client and the transparency log (which is powered by <a href="https://github.com/paragonie/chronicle">Chronicle</a>). (We have a TODO item to create an alternative server implementation as a WordPress plugin, but this might be better developed by someone else.)</p>
<p>What we <em>haven&#39;t</em> published yet is the command-line interface for communicating with a Gossamer Server. This is mostly due to our perfectionism; striking the right balance between code flexibility and user experience has resulted in a ton of iterations that we&#39;re not currently satisfied with. Usable security is hard. But we&#39;re making progress, so expect this to arrive in 2022.</p>
<p>If you&#39;d like an up-to-date resource for the status of the Gossamer project, we created a dedicated website for it: <a href="https://gossamer.tools">https://gossamer.tools</a>.</p>
<p>Note: Pay special attention to the <a href="https://gossamer.tools/page/questions">Questions &amp; Answers</a> page. We&#39;ve answered a lot of questions from previous discussions of Gossamer there, including questions you may have.</p>
            </div></div>
  </body>
</html>
