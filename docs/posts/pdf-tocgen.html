<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://krasjet.com/voice/pdf.tocgen/">Original</a>
    <h1>Pdf.tocgen</h1>
    
    <div id="readability-page-1" class="page"><div>
<pre><code>                          in.pdf                                    
                            │                                       
     ┌──────────────────────┼────────────────────┐                  
     │                      │                    │                  
     ▽                      ▽                    ▽                  
┌──────────┐  recipe  ┌───────────┐   ToC   ┌──────────┐            
│ pdfxmeta ├─────────▷│ pdftocgen ├────────▷│ pdftocio ├───▷ out.pdf
└──────────┘          └───────────┘         └──────────┘            

</code></pre>
<p><a href="https://sink.krj.st/pdf.tocgen/">pdf.tocgen</a> is a set of command-line tools for automatically extracting and generating the table of contents (ToC) of a <span>PDF</span> file. It uses the embedded font attributes and position of headings to deduce the basic outline of a <span>PDF</span> file.</p>

<p>For example, for the <span>PDF</span> version of Paul Graham’s book <em>On Lisp</em>, available for download on <a href="http://www.paulgraham.com/onlisptext.html">his website</a> but comes <em>without</em> a table of content, we can use the <code>pdfxmeta</code> command to build a <span>recipe</span> file,</p>
<div><p>In [1]</p><pre><span></span><code><span>$</span> pdfxmeta --auto <span>1</span> --page <span>14</span> onlisp.pdf <span>&#34;Extensible&#34;</span> &gt;&gt; recipe.toml
</code></pre></div>

<div><p>In [2]</p><pre><span></span><code><span>$</span> pdfxmeta --auto <span>2</span> --page <span>14</span> onlisp.pdf <span>&#34;^Design&#34;</span> &gt;&gt; recipe.toml
</code></pre></div>

<div><p>In [3]</p><pre><span></span><code><span>$</span> sed <span>&#39;/^#.*/d&#39;</span> &lt; recipe.toml
</code></pre></div>

<div><p>Out [3]</p><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>19.92530059814453</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.9552001953125</span>
</code></pre></div>

<p>saved as <code>recipe.toml</code>. Then use <code>pdftocgen</code> to automatically generate a table of contents for the book, extracted using the recipe.</p>
<div><p>In [4]</p><pre><span></span><code><span>$</span> pdftocgen onlisp.pdf &lt; recipe.toml
</code></pre></div>

<div><p>Out [4]</p><pre><span></span><code><span>&#34;Preface&#34; 5</span>
<span>    &#34;Bottom-up Design&#34; 5</span>
<span>    &#34;Plan of the Book&#34; 7</span>
<span>    &#34;Examples&#34; 9</span>
<span>    &#34;Acknowledgements&#34; 9</span>
<span>&#34;Contents&#34; 11</span>
<span>&#34;The Extensible Language&#34; 14</span>
<span>    &#34;1.1 Design by Evolution&#34; 14</span>
<span>    &#34;1.2 Programming Bottom-Up&#34; 16</span>
<span>    &#34;1.3 Extensible Software&#34; 18</span>
<span>    &#34;1.4 Extending Lisp&#34; 19</span>
<span>    &#34;1.5 Why Lisp (or When)&#34; 21</span>
<span>&#34;Functions&#34; 22</span>
<span>    &#34;2.1 Functions as Data&#34; 22</span>
<span>    &#34;2.2 Defining Functions&#34; 23</span>
<span>    &#34;2.3 Functional Arguments&#34; 26</span>
<span>    &#34;2.4 Functions as Properties&#34; 28</span>
<span>    &#34;2.5 Scope&#34; 29</span>
<span>    &#34;2.6 Closures&#34; 30</span>
<span>    &#34;2.7 Local Functions&#34; 34</span>
<span>    &#34;2.8 Tail-Recursion&#34; 35</span>
<span>    &#34;2.9 Compilation&#34; 37</span>
<span>    &#34;2.10 Functions from Lists&#34; 40</span>
<span>[--snip--]</span>
</code></pre></div>

<p>We could save the output to a file called <code>toc</code>,</p>
<div><p>In [5]</p><pre><span></span><code><span>$</span> pdftocgen onlisp.pdf &lt; recipe.toml &gt; toc
</code></pre></div>

<p>and import it to the original <span>PDF</span> file using the <code>pdftocio</code> command, saving it as <span><code>output.pdf</code></span>.</p>
<div><p>In [6]</p><pre><span></span><code><span>$</span> pdftocio -o output.pdf onlisp.pdf &lt; toc
</code></pre></div>

<p>This is just an overview of the basic workflow. Please read <a href="#a-worked-example">section <span>4</span></a> for a detailed explanation and walk-through.</p>
<p>pdf.tocgen works best for <span>PDF</span> files produces from a <img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHdpZHRoPScyNC4xODI2ODhwdCcgaGVpZ2h0PScxNC4xOTMxNzZwdCcgdmlld0JveD0nMCAtOC4zNjg2MTggMTguODkyNzI1IDExLjA4ODQxOSc+CjxkZWZzPgo8cGF0aCBpZD0nZzAtNjknIGQ9J002LjgzODM1Ni0xLjk2MDY0OEg2LjQxOTkyNUw2LjM2MDE0OS0xLjU1NDE3MkM2LjI4ODQxOC0xLjA0MDEgNi4xMzMwMDEtLjY2OTQ4OSA1Ljk2NTYyOS0uNjA5NzE0QzUuNzE0NTctLjUyNjAyNyA0Ljg0MTg0My0uNDY2MjUyIDMuNzY1ODc4LS40NjYyNTJDMy4xNDQyMDktLjQ2NjI1MiAyLjkyOTAxNi0uNDkwMTYyIDIuNTgyMzE2LS41NjE4OTNWLTMuOTA5MzRMNC40OTUxNDMtMy45NDUyMDVDNS4wMjExNzEtMy45NDUyMDUgNS4yNDgzMTktMy44OTczODUgNS4zMzIwMDUtMy41MDI4NjRDNS4zNzk4MjYtMy4yMzk4NTEgNS4zOTE3ODEtMi43OTc1MDkgNS4zOTE3ODEtMi43OTc1MDlINS43NTA0MzZDNS43MjY1MjYtMy4yMzk4NTEgNS43MTQ1Ny0zLjY4MjE5MiA1LjcxNDU3LTQuMTI0NTMzQzUuNzE0NTctNC41OTA3ODUgNS43MjY1MjYtNS4wNDUwODEgNS43NTA0MzYtNS41MTEzMzNINS4zOTE3ODFDNS4zOTE3ODEtNS41MTEzMzMgNS4zOTE3ODEtNS4xMTY4MTIgNS4zMzIwMDUtNC44ODk2NjRDNS4yMzYzNjQtNC40ODMxODggNS4wMDkyMTUtNC40MzUzNjcgNC40OTUxNDMtNC40MzUzNjdDMy44OTczODUtNC40MzUzNjcgMy4xMDgzNDQtNC40NDczMjMgMi41ODIzMTYtNC40ODMxODhWLTcuNjc1MjE4QzIuOTUyOTI3LTcuNzU4OTA0IDMuMTU2MTY0LTcuNzcwODU5IDMuOTgxMDcxLTcuNzcwODU5QzQuNjYyNTE2LTcuNzcwODU5IDUuMzMyMDA1LTcuNzExMDgzIDUuNzE0NTctNy42MDM0ODdDNi4wMDE0OTQtNy41MTk4MDEgNi4wMzczNi03LjQ3MTk4IDYuMDM3MzYtNy4xOTcwMTFWLTYuNDE5OTI1SDYuNDU1NzkxQzYuNDU1NzkxLTcuMTM3MjM1IDYuNTE1NTY3LTcuNzExMDgzIDYuNjQ3MDczLTguMjM3MTExTDUuMTY0NjMzLTguMjcyOTc2QzQuMjQ0MDg1LTguMjQ5MDY2IDMuMzExNTgyLTguMjM3MTExIDIuMzkxMDM0LTguMjM3MTExQzEuNjg1Njc5LTguMjM3MTExIC45NjgzNjktOC4yNDkwNjYgLjI2MzAxNC04LjI3Mjk3NlYtNy45MTQzMjFMLjgzNjg2Mi03Ljg3ODQ1NkMxLjM4NjgtNy44NDI1OSAxLjQ0NjU3NS03Ljc0Njk0OSAxLjQ0NjU3NS02LjgwMjQ5MVYtMS40MzQ2MkMxLjQ0NjU3NS0uNDkwMTYyIDEuMzk4NzU1LS40MDY0NzYgLjgzNjg2Mi0uMzU4NjU1TC40MDY0NzYtLjMyMjc5Vi4wMzU4NjZDLjg5NjYzOCAuMDExOTU1IDEuMzg2OCAwIDEuODc2OTYxIDBDMi43OTc1MDkgMCAzLjczMDAxMiAuMDExOTU1IDQuNjUwNTYgLjAzNTg2Nkw2LjY0NzA3MyAwQzYuNjQ3MDczLS42OTM0IDYuNzE4ODA0LTEuMzM4OTc5IDYuODM4MzU2LTEuOTYwNjQ4WicvPgo8cGF0aCBpZD0nZzAtODQnIGQ9J003LjExMzMyNS04LjI3Mjk3Nkw0LjUzMTAwOS04LjIzNzExMUgyLjY0MjA5MkwuMjE1MTkzLTguMjcyOTc2Qy4yNzQ5NjktNy41OTE1MzIgLjI5ODg3OS03LjEyNTI4IC4yOTg4NzktNi4zNDgxOTRILjY2OTQ4OUwuNzE3MzEtNy4yOTI2NTNDLjcyOTI2NS03LjU3OTU3NyAuODYwNzcyLTcuNjg3MTczIDEuMTk1NTE3LTcuNjg3MTczSDMuMDQ4NTY4QzMuMDg0NDMzLTcuMjgwNjk3IDMuMDk2Mzg5LTcuMDA1NzI5IDMuMDk2Mzg5LTYuNDkxNjU2Vi0xLjQzNDYyQzMuMDk2Mzg5LS40OTAxNjIgMy4wMzY2MTMtLjM5NDUyMSAyLjQ4NjY3NS0uMzU4NjU1TDEuOTEyODI3LS4zMjI3OVYuMDM1ODY2QzIuNDk4NjMgLjAxMTk1NSAzLjA3MjQ3OCAwIDMuNjU4MjgxIDBTNC44Mjk4ODggLjAxMTk1NSA1LjQxNTY5MSAuMDM1ODY2Vi0uMzIyNzlMNC44NDE4NDMtLjM1ODY1NUM0LjI5MTkwNS0uMzk0NTIxIDQuMjMyMTMtLjQ5MDE2MiA0LjIzMjEzLTEuNDM0NjJWLTYuNDkxNjU2QzQuMjMyMTMtNy4wMjk2MzkgNC4yNDQwODUtNy4yOTI2NTMgNC4yNzk5NS03LjY4NzE3M0g2LjEzMzAwMUM2LjQ2Nzc0Ni03LjY4NzE3MyA2LjU5OTI1My03LjU3OTU3NyA2LjYxMTIwOC03LjI5MjY1M0w2LjY1OTAyOS02LjM0ODE5NEg3LjAyOTYzOUM3LjAyOTYzOS03LjEyNTI4IDcuMDUzNTQ5LTcuNTkxNTMyIDcuMTEzMzI1LTguMjcyOTc2WicvPgo8cGF0aCBpZD0nZzAtODgnIGQ9J003Ljc0Njk0OSAuMDM1ODY2Vi0uMzIyNzlMNy4zODgyOTQtLjM1ODY1NUM3LjE2MTE0Ni0uMzgyNTY1IDYuOTkzNzczLS41NzM4NDggNi41OTkyNTMtMS4xOTU1MTdMNC40OTUxNDMtNC41NDI5NjRMNi4zMzYyMzktNy4wMjk2MzlDNi44MTQ0NDYtNy42NzUyMTggNi45Njk4NjMtNy44MzA2MzUgNy4xNDkxOTEtNy44NDI1OUw3LjYzOTM1Mi03Ljg3ODQ1NlYtOC4yMzcxMTFINi40MzE4OEw0LjIyMDE3NC01LjAwOTIxNUwyLjY4OTkxMy03LjU5MTUzMkMyLjQxNDk0NC04LjA0NTgyOCAyLjIzNTYxNi04LjI0OTA2NiAyLjAwODQ2OC04LjM2ODYxOEwuMzIyNzktOC4wNDU4MjhMLjM0NjctNy43MzQ5OTRMLjg4NDY4Mi03LjY5OTEyOEMxLjE3MTYwNi03LjY3NTIxOCAxLjU5MDAzNy03LjI4MDY5NyAxLjk4NDU1OC02LjYyMzE2M0wzLjUxNDgxOS00LjA3NjcxMkwxLjE4MzU2Mi0uOTMyNTAzQy44ODQ2ODItLjUyNjAyNyAuNzQxMjItLjM5NDUyMSAuNDc4MjA3LS4zNTg2NTVMLjE2NzM3Mi0uMzIyNzlWLjAzNTg2NkMuMzcwNjEgLjAxMTk1NSAuNTg1ODAzIDAgLjc4OTA0MSAwUzEuMTk1NTE3IC4wMTE5NTUgMS4zOTg3NTUgLjAzNTg2NkwzLjgxMzY5OS0zLjYyMjQxNkw2LjAxMzQ1IC4wMzU4NjZDNi4zMTIzMjkgLjAxMTk1NSA2LjU5OTI1MyAwIDYuODk4MTMyIDBDNy4xODUwNTYgMCA3LjQ2MDAyNSAuMDExOTU1IDcuNzQ2OTQ5IC4wMzU4NjZaJy8+CjwvZGVmcz4KPGc+Cjx1c2UgeD0nMCcgeT0nMCcgeGxpbms6aHJlZj0nI2cwLTg0Jy8+Cjx1c2UgeD0nNS4zMzU1NjMnIHk9JzIuNjgzOTM1JyB4bGluazpocmVmPScjZzAtNjknLz4KPHVzZSB4PScxMS4xNDU3NzYnIHk9JzAnIHhsaW5rOmhyZWY9JyNnMC04OCcvPgo8L2c+Cjwvc3ZnPg=="/> document using <code>pdftex</code> (and its friends <code>pdflatex</code>, <code>pdfxetex</code>, etc.), but it’s designed to work with any <em>software-generated</em> <span>PDF</span> files<span>That is, you shouldn’t expect it to work with scanned <span>PDF</span>s</span>. Some examples include <code>troff</code>/<wbr/><code>groff</code>, Adobe InDesign, Microsoft Word, and probably more.</p>
<p>pdf.tocgen is a free software. The source code can be found in the <a href="https://sink.krj.st/pdf.tocgen/">sink</a> or on <a href="https://github.com/Krasjet/pdf.tocgen/">GitHub</a> and is licensed under the GPLv<span>3</span> license. You are free to tinker with the source code, but any derivatives <em>must</em> guarantee the <a href="https://www.gnu.org/philosophy/free-sw.en.html">freedom</a> of users. If you want to contribute to this project, send a <a href="https://sink.krj.st">patch</a> or open a pull request on <a href="https://github.com/Krasjet/pdf.tocgen/">GitHub</a>.</p>


<p>pdf.tocgen is written in Python <span>3</span>. It is known to work with Python <span>3</span>.<span>7</span> to <span>3</span>.<span>11</span> on Linux, Windows, and macOS<span>On BSDs, you probably need to build PyMuPDF yourself</span>. Use</p>
<div><p>In [7]</p><pre><span></span><code><span>$</span> pip install -U pdf.tocgen
</code></pre></div>

<p>to install the latest version systemwide. Alternatively, use <a href="https://pipxproject.github.io/pipx/"><code>pipx</code></a> or</p>
<div><p>In [8]</p><pre><span></span><code><span>$</span> pip install -U --user pdf.tocgen
</code></pre></div>

<p>to install it for the current user. I would recommend the latter approach to avoid messing up the package manager on your system.</p>
<p>If you are using an Arch-based Linux distro, the package is also available on <a href="https://aur.archlinux.org/packages/pdf.tocgen/">AUR</a>. It can be installed using any <span>AUR</span> helper, for example <a href="https://github.com/Jguer/yay"><code>yay</code></a>:</p>
<div><p>In [9]</p><pre><span></span><code><span>$</span> yay -S pdf.tocgen
</code></pre></div>


<p>Before we continue, note that this tool targets <em>readers</em>, not <em>authors</em>.</p>
<p>The intended usage is to generate a table of contents for <a href="https://see.stanford.edu/materials/lsoftaee261/book-fall-07.pdf">lecture notes</a>, <a href="https://felleisen.org/matthias/HtDC/htdc.pdf">draft books</a>, or possibly the papers on <a href="https://arxiv.org/">arXiv</a> for <em>easier navigation</em>. If you are a <img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHdpZHRoPSczNC40NTg5NzZwdCcgaGVpZ2h0PScxNC4xOTMxNzZwdCcgdmlld0JveD0nMCAtOC4zNjg2MTggMjYuOTIxMDc1IDExLjA4ODQxOSc+CjxkZWZzPgo8cGF0aCBpZD0nZzAtNjUnIGQ9J002LjYyNzk0OCAuMDI2MzAxVi0uMjM2NzEyTDYuMzI5ODY1LS4yNjMwMTRDNi4xMDE5Mi0uMjgwNTQ4IDYuMDA1NDgyLS40NDcxMjMgNS42OTg2MzItMS4xNTcyNjFMMy41NzY5ODgtNi4xMzY5ODhIMy4yOTY0MzlDMy4yOTY0MzktNi4xMzY5ODggMy4yMDAwMDEtNS44Mzg5MDYgMi44NjY4NS01LjA5MzdMLjkyOTMxNS0uNjkyNjAzQy44MTUzNDMtLjQzODM1NiAuNjQ4NzY3LS4yODA1NDggLjQ1NTg5MS0uMjYzMDE0TC4xMzE1MDctLjIzNjcxMlYuMDI2MzAxQy40NDcxMjMgLjAwODc2NyAuNzcxNTA3IDAgMS4wODcxMjQgMEMxLjQzNzgwOSAwIDEuNzk3MjYxIC4wMDg3NjcgMi4xNDc5NDYgLjAyNjMwMVYtLjIzNjcxMkwxLjgyMzU2Mi0uMjYzMDE0QzEuNTE2NzEzLS4yODkzMTUgMS40MDI3NC0uMzUwNjg1IDEuNDAyNzQtLjQ5MDk1OUMxLjQwMjc0LS42MDQ5MzIgMS41MjU0OC0uOTgxOTE4IDEuNzA5NTktMS40MjAyNzRMMS45NTUwNjktMi4wMDc2NzJINC40ODAwMDJMNC44ODMyODktLjk5OTQ1MkM1LjAzMjMzMS0uNjMxMjMzIDUuMDY3Mzk5LS41MTcyNiA1LjA2NzM5OS0uNDM4MzU2QzUuMDY3Mzk5LS4zNDE5MTggNC45MjcxMjUtLjI4MDU0OCA0LjcwNzk0Ny0uMjYzMDE0TDQuMjk1ODkyLS4yMzY3MTJWLjAyNjMwMUM0LjY5OTE4IC4wMDg3NjcgNS4xMTEyMzUgMCA1LjUxNDUyMiAwQzUuODgyNzQyIDAgNi4yNTk3MjggLjAwODc2NyA2LjYyNzk0OCAuMDI2MzAxWk00LjMyMjE5My0yLjM1ODM1N0gyLjEwNDExTDMuMjE3NTM1LTQuOTcwOTYxTDQuMzIyMTkzLTIuMzU4MzU3WicvPgo8cGF0aCBpZD0nZzAtNjknIGQ9J001LjAxNDc5Ni0xLjQzNzgwOUg0LjcwNzk0N0w0LjY2NDExMS0xLjEzOTcyNkM0LjYxMTUwOC0uNzYyNzQgNC40OTc1MzYtLjQ5MDk1OSA0LjM3NDc5Ni0uNDQ3MTIzQzQuMTkwNjg2LS4zODU3NTQgMy41NTA2ODYtLjM0MTkxOCAyLjc2MTY0NS0uMzQxOTE4QzIuMzA1NzU0LS4zNDE5MTggMi4xNDc5NDYtLjM1OTQ1MiAxLjg5MzY5OS0uNDEyMDU1Vi0yLjg2Njg1TDMuMjk2NDM5LTIuODkzMTUyQzMuNjgyMTkzLTIuODkzMTUyIDMuODQ4NzY4LTIuODU4MDgzIDMuOTEwMTM4LTIuNTY4NzY4QzMuOTQ1MjA3LTIuMzc1ODkxIDMuOTUzOTc0LTIuMDUxNTA4IDMuOTUzOTc0LTIuMDUxNTA4SDQuMjE2OTg4QzQuMTk5NDU0LTIuMzc1ODkxIDQuMTkwNjg2LTIuNzAwMjc1IDQuMTkwNjg2LTMuMDI0NjU5QzQuMTkwNjg2LTMuMzY2NTc3IDQuMTk5NDU0LTMuNjk5NzI3IDQuMjE2OTg4LTQuMDQxNjQ1SDMuOTUzOTc0QzMuOTUzOTc0LTQuMDQxNjQ1IDMuOTUzOTc0LTMuNzUyMzMgMy45MTAxMzgtMy41ODU3NTVDMy44NDAwMDEtMy4yODc2NzIgMy42NzM0MjYtMy4yNTI2MDQgMy4yOTY0MzktMy4yNTI2MDRDMi44NTgwODMtMy4yNTI2MDQgMi4yNzk0NTMtMy4yNjEzNzEgMS44OTM2OTktMy4yODc2NzJWLTUuNjI4NDk1QzIuMTY1NDgtNS42ODk4NjUgMi4zMTQ1MjEtNS42OTg2MzIgMi45MTk0NTMtNS42OTg2MzJDMy40MTkxNzktNS42OTg2MzIgMy45MTAxMzgtNS42NTQ3OTYgNC4xOTA2ODYtNS41NzU4OTJDNC40MDEwOTctNS41MTQ1MjIgNC40MjczOTktNS40Nzk0NTQgNC40MjczOTktNS4yNzc4MVYtNC43MDc5NDdINC43MzQyNDhDNC43MzQyNDgtNS4yMzM5NzQgNC43NzgwODQtNS42NTQ3OTYgNC44NzQ1MjItNi4wNDA1NUwzLjc4NzM5OS02LjA2Njg1MUMzLjExMjMzLTYuMDQ5MzE3IDIuNDI4NDk0LTYuMDQwNTUgMS43NTM0MjUtNi4wNDA1NUMxLjIzNjE2NS02LjA0MDU1IC43MTAxMzctNi4wNDkzMTcgLjE5Mjg3Ny02LjA2Njg1MVYtNS44MDM4MzhMLjYxMzY5OS01Ljc3NzUzNkMxLjAxNjk4Ny01Ljc1MTIzNSAxLjA2MDgyMi01LjY4MTA5OCAxLjA2MDgyMi00Ljk4ODQ5NVYtMS4wNTIwNTVDMS4wNjA4MjItLjM1OTQ1MiAxLjAyNTc1NC0uMjk4MDgyIC42MTM2OTktLjI2MzAxNEwuMjk4MDgyLS4yMzY3MTJWLjAyNjMwMUMuNjU3NTM0IC4wMDg3NjcgMS4wMTY5ODcgMCAxLjM3NjQzOSAwQzIuMDUxNTA4IDAgMi43MzUzNDMgLjAwODc2NyAzLjQxMDQxMiAuMDI2MzAxTDQuODc0NTIyIDBDNC44NzQ1MjItLjUwODQ5MyA0LjkyNzEyNS0uOTgxOTE4IDUuMDE0Nzk2LTEuNDM3ODA5WicvPgo8cGF0aCBpZD0nZzAtNzYnIGQ9J001LjEzNzUzNi0xLjUwNzk0Nkg0Ljg1Njk4OEw0Ljc1MTc4Mi0xLjA2OTU4OUM0LjY3Mjg3OC0uNzI3NjcxIDQuNjExNTA4LS41NDM1NjIgNC41NTg5MDYtLjQ5OTcyNkM0LjQ0NDkzMy0uNDAzMjg4IDMuNjgyMTkzLS4zNDE5MTggMi42Mzg5MDUtLjM0MTkxOEMyLjMyMzI4OC0uMzQxOTE4IDIuMTIxNjQ1LS4zNTk0NTIgMS44OTM2OTktLjQxMjA1NVYtNC45ODg0OTVDMS44OTM2OTktNS42ODEwOTggMS45Mzc1MzUtNS43NTEyMzUgMi4zNDA4MjMtNS43Nzc1MzZMMi43NjE2NDUtNS44MDM4MzhWLTYuMDY2ODUxQzIuMzMyMDU2LTYuMDQ5MzE3IDEuOTAyNDY2LTYuMDQwNTUgMS40NzI4NzctNi4wNDA1NVMuNjIyNDY2LTYuMDQ5MzE3IC4xOTI4NzctNi4wNjY4NTFWLTUuODAzODM4TC42MTM2OTktNS43Nzc1MzZDMS4wMTY5ODctNS43NTEyMzUgMS4wNjA4MjItNS42ODEwOTggMS4wNjA4MjItNC45ODg0OTVWLS44MzI4NzdDMS4wNjA4MjItLjU3ODYzIC45ODE5MTgtLjM4NTc1NCAuODQxNjQ0LS4zMTU2MTdMLjU2OTg2My0uMTc1MzQzVi4wMjYzMDFDLjg1OTE3OCAuMDA4NzY3IDEuMTQ4NDk0IDAgMS40Mzc4MDkgMEMyLjEyMTY0NSAwIDIuNzk2NzEzIC4wMjYzMDEgMy40ODA1NDkgLjAyNjMwMUMzLjg0ODc2OCAuMDI2MzAxIDMuNzYxMDk3IC4wMjYzMDEgNC45NTM0MjYgMEM1LjAxNDc5Ni0uMzc2OTg2IDUuMDQ5ODY1LS42NTc1MzQgNS4xMzc1MzYtMS41MDc5NDZaJy8+CjxwYXRoIGlkPSdnMC04NCcgZD0nTTUuMjE2NDQtNi4wNjY4NTFMMy4zMjI3NDEtNi4wNDA1NUgxLjkzNzUzNUwuMTU3ODA4LTYuMDY2ODUxQy4yMDE2NDQtNS41NjcxMjUgLjIxOTE3OC01LjIyNTIwNyAuMjE5MTc4LTQuNjU1MzQ0SC40OTA5NTlMLjUyNjAyOC01LjM0Nzk0N0MuNTM0Nzk1LTUuNTU4MzU4IC42MzEyMzMtNS42MzcyNjIgLjg3NjcxMy01LjYzNzI2MkgyLjIzNTYxN0MyLjI2MTkxOS01LjMzOTE4IDIuMjcwNjg2LTUuMTM3NTM2IDIuMjcwNjg2LTQuNzYwNTVWLTEuMDUyMDU1QzIuMjcwNjg2LS4zNTk0NTIgMi4yMjY4NS0uMjg5MzE1IDEuODIzNTYyLS4yNjMwMTRMMS40MDI3NC0uMjM2NzEyVi4wMjYzMDFDMS44MzIzMjkgLjAwODc2NyAyLjI1MzE1MSAwIDIuNjgyNzQxIDBTMy41NDE5MTkgLjAwODc2NyAzLjk3MTUwOCAuMDI2MzAxVi0uMjM2NzEyTDMuNTUwNjg2LS4yNjMwMTRDMy4xNDczOTgtLjI4OTMxNSAzLjEwMzU2My0uMzU5NDUyIDMuMTAzNTYzLTEuMDUyMDU1Vi00Ljc2MDU1QzMuMTAzNTYzLTUuMTU1MDcgMy4xMTIzMy01LjM0Nzk0NyAzLjEzODYzMS01LjYzNzI2Mkg0LjQ5NzUzNkM0Ljc0MzAxNS01LjYzNzI2MiA0LjgzOTQ1NC01LjU1ODM1OCA0Ljg0ODIyMS01LjM0Nzk0N0w0Ljg4MzI4OS00LjY1NTM0NEg1LjE1NTA3QzUuMTU1MDctNS4yMjUyMDcgNS4xNzI2MDUtNS41NjcxMjUgNS4yMTY0NC02LjA2Njg1MVonLz4KPHBhdGggaWQ9J2cwLTg4JyBkPSdNNS42ODEwOTggLjAyNjMwMVYtLjIzNjcxMkw1LjQxODA4NC0uMjYzMDE0QzUuMjUxNTA5LS4yODA1NDggNS4xMjg3NjktLjQyMDgyMiA0LjgzOTQ1NC0uODc2NzEzTDMuMjk2NDM5LTMuMzMxNTA4TDQuNjQ2NTc3LTUuMTU1MDdDNC45OTcyNjItNS42Mjg0OTUgNS4xMTEyMzUtNS43NDI0NjggNS4yNDI3NDItNS43NTEyMzVMNS42MDIxOTQtNS43Nzc1MzZWLTYuMDQwNTVINC43MTY3MTRMMy4wOTQ3OTYtMy42NzM0MjZMMS45NzI2MDMtNS41NjcxMjVDMS43NzA5Ni01LjkwMDI3NiAxLjYzOTQ1My02LjA0OTMxNyAxLjQ3Mjg3Ny02LjEzNjk4OEwuMjM2NzEyLTUuOTAwMjc2TC4yNTQyNDctNS42NzIzMzFMLjY0ODc2Ny01LjY0NjAyOUMuODU5MTc4LTUuNjI4NDk1IDEuMTY2MDI4LTUuMzM5MTggMS40NTUzNDMtNC44NTY5ODhMMi41Nzc1MzUtMi45ODk1OUwuODY3OTQ2LS42ODM4MzZDLjY0ODc2Ny0uMzg1NzU0IC41NDM1NjItLjI4OTMxNSAuMzUwNjg1LS4yNjMwMTRMLjEyMjc0LS4yMzY3MTJWLjAyNjMwMUMuMjcxNzgxIC4wMDg3NjcgLjQyOTU4OSAwIC41Nzg2MyAwUy44NzY3MTMgLjAwODc2NyAxLjAyNTc1NCAuMDI2MzAxTDIuNzk2NzEzLTIuNjU2NDM5TDQuNDA5ODY1IC4wMjYzMDFDNC42MjkwNDMgLjAwODc2NyA0LjgzOTQ1NCAwIDUuMDU4NjMyIDBDNS4yNjkwNDMgMCA1LjQ3MDY4NyAuMDA4NzY3IDUuNjgxMDk4IC4wMjYzMDFaJy8+Cjx1c2UgaWQ9J2cxLTY5JyB4bGluazpocmVmPScjZzAtNjknIHRyYW5zZm9ybT0nc2NhbGUoMS4zNjM2MzYpJy8+Cjx1c2UgaWQ9J2cxLTc2JyB4bGluazpocmVmPScjZzAtNzYnIHRyYW5zZm9ybT0nc2NhbGUoMS4zNjM2MzYpJy8+Cjx1c2UgaWQ9J2cxLTg0JyB4bGluazpocmVmPScjZzAtODQnIHRyYW5zZm9ybT0nc2NhbGUoMS4zNjM2MzYpJy8+Cjx1c2UgaWQ9J2cxLTg4JyB4bGluazpocmVmPScjZzAtODgnIHRyYW5zZm9ybT0nc2NhbGUoMS4zNjM2MzYpJy8+CjwvZGVmcz4KPGc+Cjx1c2UgeD0nMCcgeT0nMCcgeGxpbms6aHJlZj0nI2cxLTc2Jy8+Cjx1c2UgeD0nMy4wMDA3NDEnIHk9Jy0yLjA1NDY4OCcgeGxpbms6aHJlZj0nI2cwLTY1Jy8+Cjx1c2UgeD0nOC4wMjgzNScgeT0nMCcgeGxpbms6aHJlZj0nI2cxLTg0Jy8+Cjx1c2UgeD0nMTMuMzYzOTEzJyB5PScyLjY4MzkzNScgeGxpbms6aHJlZj0nI2cxLTY5Jy8+Cjx1c2UgeD0nMTkuMTc0MTI2JyB5PScwJyB4bGluazpocmVmPScjZzEtODgnLz4KPC9nPgo8L3N2Zz4="/> user, please <em>do not</em> use this tool to generate table of contents for your own manuscripts.</p>
<p>Use the <a href="https://ctan.org/pkg/hyperref">hyperref</a> package instead,</p>


<p>since it understands your document better and provides more customizations.</p>

<p>The design of pdf.tocgen is influenced by the <a href="https://en.wikipedia.org/wiki/Unix_philosophy">Unix philosophy</a>. I intentionally separated pdf.tocgen to <span>3</span> separate programs. They work together, but each of them is useful on its own.</p>
<p>They represents the <span>3</span> steps necessary to add table of contents to a <span>PDF</span> file:</p>
<ol type="1">
<li><code>pdfxmeta</code>: extract the metadata (font attributes, positions) of headings to build a <span>recipe</span> file.</li>
<li><code>pdftocgen</code>: generate a table of contents from the recipe.</li>
<li><code>pdftocio</code>: import the table of contents to the <span>PDF</span> document.</li>
</ol>
<p>Again, we will use Paul Graham’s book <em>On Lisp</em>, freely available on <a href="http://www.paulgraham.com/onlisptext.html">his website</a> as a <span>PDF</span> but comes without a table of contents embedded, to demonstrate how these <span>3</span> programs work together.</p>
<p>If you want to follow along, go ahead and download the book and save it as <code>onlisp.pdf</code>.</p>
<h2 data-number="" id="step-1-build-a-recipe">Step <span>1</span>: Build a recipe</h2>
<p><code>pdftocgen</code> extracts the headings using the font attributes and position (bounding box) of text embedded in a <span>PDF</span> file. We need to supply it with a <span>recipe</span>, which is a <a href="https://toml.io">TOML</a> file that tells <code>pdftocgen</code> what a heading, subheading, or subsubheading should look like.</p>
<p>The recipe for our example, <em>On Lisp</em>, which I have already mentioned before, looks like this:</p>
<div><pre><span></span><code><span># filter for level 1 heading</span>
<span>[[heading]]</span>
<span># heading level</span>
<span>level</span> <span>=</span> <span>1</span>
<span># attributes to search for</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>19.92530059814453</span>

<span># filter for level 2 heading</span>
<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.9552001953125</span>
</code></pre></div>

<p>A recipe is a list of <span>filters</span>, each of which specifies the attributes <span><code>pdftocgen</code></span> should look for. For example, in the recipe above, a level <span>1</span> heading, which corresponds to chapter titles in <em>On Lisp</em>, should</p>
<ol type="1">
<li>Have font name matching <code>&#34;Times-Bold&#34;</code></li>
<li>Have font size <code>19.92530059814453</code></li>
</ol>
<p>Of course, the font size don’t have to be this precise, you could set a tolerance level using the <code>font.size_tolerance</code> attributes:</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span># match anything between 19.9-20.1</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>20</span>
<span>font</span><span>.</span><span>size_tolerance</span> <span>=</span> <span>0.1</span>
</code></pre></div>

<p>How do we know what attributes a heading should have<span>?</span> This is why we need to use <code>pdfxmeta</code> to extract the metadata of text in a <span>PDF</span> file.</p>
<p>Open up the <span>PDF</span> file you just downloaded in your favorite <span>PDF</span> reader. We will use <a href="https://pwmt.org/projects/zathura/">zathura</a> here, but use anything you are comfortable with.</p>
<div><p>In [10]</p><pre><span></span><code><span>$</span> zathura onlisp.pdf <span>&amp;</span>
</code></pre></div>

<p>Scroll down to page <span>14</span>, counting from the title page. This is where the first chapter’s title “The Extensible Language” is. To look at the metadata associated with this title, use the <code>pdfxmeta</code> command:</p>
<div><p>In [11]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>14</span> onlisp.pdf <span>&#34;The Extensible&#34;</span>
</code></pre></div>

<div><p>Out [11]</p><pre><span></span><code><span>The Extensible Language:</span>
<span>    font.name = &#34;Times-Bold&#34;</span>
<span>    font.size = 19.92530059814453</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 138.60000610351562</span>
<span>    bbox.top = 306.947998046875</span>
<span>    bbox.right = 354.4866638183594</span>
<span>    bbox.bottom = 334.5445251464844</span>
</code></pre></div>

<p>The <code>-p</code> flag tells <code>pdfxmeta</code> that it should only search on page <span>14</span>. It is not required, but I highly recommend specifying it to make the search less ambiguous.</p>
<p>Now that we have extracted the metadata for chapter titles, we could make it a filter by copy-pasting it, or redirect the output, to a recipe file called <code>recipe.toml</code>.</p>
<div><p>In [12]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>14</span> onlisp.pdf <span>&#34;The Extensible&#34;</span> &gt;&gt; recipe.toml
</code></pre></div>

<p>Use your favorite editor to open up the recipe file and remove the indentations<span>In Vim, you could press <code>&lt;&lt;</code> in normal mode to dedent a line</span>, and add the <code>[[heading]]</code> header and the <code>level</code> attribute to specify the heading level.</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>19.92530059814453</span>
<span>font</span><span>.</span><span>color</span> <span>=</span> <span>0</span><span>x000000</span>
<span>font</span><span>.</span><span>superscript</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>italic</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>serif</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>monospace</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>bold</span> <span>=</span> <span>true</span>
<span>bbox</span><span>.</span><span>left</span> <span>=</span> <span>138.60000610351562</span>
<span>bbox</span><span>.</span><span>top</span> <span>=</span> <span>306.947998046875</span>
<span>bbox</span><span>.</span><span>right</span> <span>=</span> <span>354.4866638183594</span>
<span>bbox</span><span>.</span><span>bottom</span> <span>=</span> <span>334.5445251464844</span>
</code></pre></div>

<p>This is already a valid recipe file, but it is too specific. It is very unlikely that other chapter titles would match all four bounding box (<code>bbox</code>) values, which means they would have exactly the same position and width as this chapter’s title.</p>
<p>If you want to ignore an attribute, simply remove it from the filter. From my experience, <code>font.name</code> and <code>font.size</code> is usually enough.</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>19.92530059814453</span>
</code></pre></div>

<p>If you are lazy, you can also use the <code>--auto</code> or <code>-a</code> flag to format the output as a heading filter with the default settings. But the output will be slightly harder to read:</p>
<div><p>In [13]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>1</span> -p <span>14</span> onlisp.pdf <span>&#34;The Extensible&#34;</span>
</code></pre></div>

<div><p>Out [13]</p><pre><span></span><code><span>[[heading]]</span>
<span># The Extensible Language</span>
<span>level</span> <span>=</span> <span>1</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>19.92530059814453</span>
<span># font.size_tolerance = 1e-5</span>
<span># font.color = 0x000000</span>
<span># font.superscript = false</span>
<span># font.italic = false</span>
<span># font.serif = true</span>
<span># font.monospace = false</span>
<span># font.bold = true</span>
<span># bbox.left = 138.60000610351562</span>
<span># bbox.top = 306.947998046875</span>
<span># bbox.right = 354.4866638183594</span>
<span># bbox.bottom = 334.5445251464844</span>
<span># bbox.tolerance = 1e-5</span>
</code></pre></div>

<p>The argument after the <code>-a</code> flag is the heading level of the output heading filter, which in this case is <code>1</code>. Don’t worry about the <code>greedy</code> option right now, it is not necessary for this book.</p>
<p>Next, we need to extract the metadata of level <span>2</span> headings:</p>
<div><p>In [14]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>14</span> -i onlisp.pdf <span>&#34;^design&#34;</span>
</code></pre></div>

<div><p>Out [14]</p><pre><span></span><code><span>Design by Evolution:</span>
<span>    font.name = &#34;Times-Bold&#34;</span>
<span>    font.size = 11.9552001953125</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 165.42388916015625</span>
<span>    bbox.top = 624.02880859375</span>
<span>    bbox.right = 268.2960205078125</span>
<span>    bbox.bottom = 640.5867309570312</span>
</code></pre></div>

<p>Note that we could use regular expressions (Python-style) as the pattern. The <code>-i</code> option can be used to enable case-insensitive search.</p>
<p>Use the <code>-a</code> flag to dump it to <code>recipe.toml</code></p>
<div><p>In [15]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>2</span> -p <span>14</span> -i onlisp.pdf <span>&#34;^design&#34;</span> &gt;&gt; recipe.toml
</code></pre></div>

<p>and pick the attributes we need:</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.9552001953125</span>
</code></pre></div>

<p>If you can’t find want you are looking for, leave out the query string to dump the entire page,</p>
<div><p>In [16]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>14</span> onlisp.pdf
</code></pre></div>

<div><p>Out [16]</p><pre><span></span><code><span>1:</span>
<span>    font.name = &#34;Times-Bold&#34;</span>
<span>    font.size = 24.906600952148438</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 138.60000610351562</span>
<span>    bbox.top = 239.2274932861328</span>
<span>    bbox.right = 151.05331420898438</span>
<span>    bbox.bottom = 273.72314453125</span>
<span>The Extensible Language:</span>
<span>    font.name = &#34;Times-Bold&#34;</span>
<span>    font.size = 19.92530059814453</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 138.60000610351562</span>
<span>    bbox.top = 306.947998046875</span>
<span>    bbox.right = 354.4866638183594</span>
<span>    bbox.bottom = 334.5445251464844</span>
<span>[--snip--]</span>
</code></pre></div>

<p>but it is very likely that <code>pdftocgen</code> can’t generate a meaningful table of contents for you if you can’t find the heading using <code>pdfxmeta</code>. Sorry about that.</p>
<p>As a side node, sometimes you would see the <code>+</code> symbol in <code>font.name</code>, for example in the <span>PDF</span> draft of <a href="https://felleisen.org/matthias/HtDC/htdc.pdf"><em>How to design Classes</em></a> by Matthias Felleisen et al.<span>In the latest version, the subset will be automatically stripped off, so you might not see this anymore</span></p>
<div><p>In [17]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>19</span> htdc.pdf <span>&#34;The Varieties&#34;</span>
</code></pre></div>

<div><p>Out [17]</p><pre><span></span><code><span>The Varieties of Data:</span>
<span>    font.name = &#34;UFRVLO+Palatino-Bold&#34;</span>
<span>    font.size = 17.21540069580078</span>
<span>    font.color = 0x221f1f</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 293.6400146484375</span>
<span>    bbox.top = 129.75328063964844</span>
<span>    bbox.right = 459.6872253417969</span>
<span>    bbox.bottom = 146.77931213378906</span>
</code></pre></div>

<p>The <code>UFRVLO+</code> in <code>font.size</code> represent a <em>subset</em> in the complete font family <code>Palatino-Bold</code>. The font in different headings might be distributed into multiple subsets, so it is <em>almost always</em> a good idea to match against the entire family by removing the subset prefix:</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Palatino-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>17.21540069580078</span>
<span>font</span><span>.</span><span>color</span> <span>=</span> <span>0</span><span>x221f1f</span>
</code></pre></div>

<p>You could also use the <code>-a</code> flag as before to handle this automatically.</p>
<div><p>In [18]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>1</span> -p <span>19</span> htdc.pdf <span>&#34;The Varieties&#34;</span>
</code></pre></div>

<div><p>Out [18]</p><pre><span></span><code><span>[[heading]]</span>
<span># The Varieties of Data</span>
<span>level</span> <span>=</span> <span>1</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Palatino-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>17.21540069580078</span>
<span># font.size_tolerance = 1e-5</span>
<span># font.color = 0x221f1f</span>
<span># font.superscript = false</span>
<span># font.italic = false</span>
<span># font.serif = true</span>
<span># font.monospace = false</span>
<span># font.bold = true</span>
<span># bbox.left = 293.6400146484375</span>
<span># bbox.top = 129.75328063964844</span>
<span># bbox.right = 459.6872253417969</span>
<span># bbox.bottom = 146.77931213378906</span>
<span># bbox.tolerance = 1e-5</span>
</code></pre></div>

<p>Also, note that <code>font.name</code> can take a regular expression:</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>3</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;(Palatino-Bold|Palatino-Italic)&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.9552001953125</span>
<span>font</span><span>.</span><span>color</span> <span>=</span> <span>0</span><span>x221f1f</span>
</code></pre></div>

<p>You might need some experiments to determine the best recipe for the <span>PDF</span>. You could find some pre-made recipes <a href="https://github.com/Krasjet/pdf.tocgen/tree/master/recipes">here</a>, but in most cases you would need to design your own recipes. You are welcome to contribute more recipes by sending patches or pull requests.</p>
<h2 data-number="" id="step-2-generate-table-of-contents">Step <span>2</span>: Generate table of contents</h2>
<p>Now that we have crafted a recipe for <em>On Lisp</em> in <code>recipe.toml</code>,</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>19.92530059814453</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.9552001953125</span>
</code></pre></div>

<p>we could use the <code>pdftocgen</code> command to generate the table of contents for our <span>PDF</span></p>
<div><p>In [19]</p><pre><span></span><code><span>$</span> pdftocgen onlisp.pdf &lt; recipe.toml
</code></pre></div>

<div><p>Out [19]</p><pre><span></span><code><span>&#34;Preface&#34; 5</span>
<span>    &#34;Bottom-up Design&#34; 5</span>
<span>    &#34;Plan of the Book&#34; 7</span>
<span>    &#34;Examples&#34; 9</span>
<span>    &#34;Acknowledgements&#34; 9</span>
<span>&#34;Contents&#34; 11</span>
<span>&#34;The Extensible Language&#34; 14</span>
<span>    &#34;1.1 Design by Evolution&#34; 14</span>
<span>    &#34;1.2 Programming Bottom-Up&#34; 16</span>
<span>    &#34;1.3 Extensible Software&#34; 18</span>
<span>    &#34;1.4 Extending Lisp&#34; 19</span>
<span>    &#34;1.5 Why Lisp (or When)&#34; 21</span>
<span>&#34;Functions&#34; 22</span>
<span>    &#34;2.1 Functions as Data&#34; 22</span>
<span>    &#34;2.2 Defining Functions&#34; 23</span>
<span>    &#34;2.3 Functional Arguments&#34; 26</span>
<span>    &#34;2.4 Functions as Properties&#34; 28</span>
<span>    &#34;2.5 Scope&#34; 29</span>
<span>    &#34;2.6 Closures&#34; 30</span>
<span>    &#34;2.7 Local Functions&#34; 34</span>
<span>    &#34;2.8 Tail-Recursion&#34; 35</span>
<span>    &#34;2.9 Compilation&#34; 37</span>
<span>    &#34;2.10 Functions from Lists&#34; 40</span>
<span>&#34;Functional Programming&#34; 41</span>
<span>    &#34;3.1 Functional Design&#34; 41</span>
<span>    &#34;3.2 Imperative Outside-In&#34; 46</span>
<span>    &#34;3.3 Functional Interfaces&#34; 48</span>
<span>    &#34;3.4 Interactive Programming&#34; 50</span>
<span>[--snip--]</span>
</code></pre></div>

<p>The output of <code>pdftocgen</code> is a dialect of <span>CSV</span>. The main differences are</p>
<ol type="1">
<li>Every <em><span>4</span> spaces</em> of indent represents a new heading level <span>so a level <span>3</span> heading is <em><span>8</span> spaces</em> of indent</span></li>
<li>The separator is a single space, not comma</li>
<li>Titles need to be quoted using double quotes.</li>
</ol>
<p>This format is intentionally designed to be easily <em>edited</em> (in Vim), since the output of <span><code>pdftocgen</code></span> is <em>expected to be</em> inaccurate in many cases and you are likely to tweak the table of contents before you import it to the original <span>PDF</span> file.</p>
<p>If a heading contains the actual double quote character (<code>&#34;</code>), use two double quotes (<code>&#34;&#34;</code>) to escape it,</p>
<pre><code>&#34;a &#34;&#34;quoted&#34;&#34; heading&#34; 2</code></pre>
<p>but the double quotes in most <span>PDF</span>s are usually smart quotes (<code>“</code> and <code>”</code>), so escaping is rarely necessary.</p>
<p>If you don’t want to import the table of contents to <span>PDF</span>, you could instead use the <code>-H</code> flag to print the table of contents in a more readable format,</p>
<div><p>In [20]</p><pre><span></span><code><span>$</span> pdftocgen -H onlisp.pdf &lt; recipe.toml
</code></pre></div>

<div><p>Out [20]</p><pre><span></span><code><span>Preface ··· 5</span>
<span>    Bottom-up Design ··· 5</span>
<span>    Plan of the Book ··· 7</span>
<span>    Examples ··· 9</span>
<span>    Acknowledgements ··· 9</span>
<span>Contents ··· 11</span>
<span>The Extensible Language ··· 14</span>
<span>    1.1 Design by Evolution ··· 14</span>
<span>    1.2 Programming Bottom-Up ··· 16</span>
<span>    1.3 Extensible Software ··· 18</span>
<span>    1.4 Extending Lisp ··· 19</span>
<span>    1.5 Why Lisp (or When) ··· 21</span>
<span>Functions ··· 22</span>
<span>    2.1 Functions as Data ··· 22</span>
<span>    2.2 Defining Functions ··· 23</span>
<span>    2.3 Functional Arguments ··· 26</span>
<span>    2.4 Functions as Properties ··· 28</span>
<span>    2.5 Scope ··· 29</span>
<span>    2.6 Closures ··· 30</span>
<span>    2.7 Local Functions ··· 34</span>
<span>    2.8 Tail-Recursion ··· 35</span>
<span>    2.9 Compilation ··· 37</span>
<span>    2.10 Functions from Lists ··· 40</span>
<span>Functional Programming ··· 41</span>
<span>    3.1 Functional Design ··· 41</span>
<span>    3.2 Imperative Outside-In ··· 46</span>
<span>    3.3 Functional Interfaces ··· 48</span>
<span>    3.4 Interactive Programming ··· 50</span>
<span>[--snip--]</span>
</code></pre></div>

<p>but this format can’t be read by <code>pdftocio</code>.</p>
<p>For now, we will save the table of contents to a file called <code>toc</code>:</p>
<div><p>In [21]</p><pre><span></span><code><span>$</span> pdftocgen onlisp.pdf &lt; recipe.toml &gt; toc
</code></pre></div>

<h2 data-number="" id="step-3-import-the-toc-to-pdf">Step <span>3</span>: Import the ToC to <span>PDF</span></h2>
<p>To import the generated table of contents to the original <span>PDF</span> file, simply redirect the <code>toc</code> file to <code>pdftocio</code>.</p>
<div><p>In [22]</p><pre><span></span><code><span>$</span> pdftocio onlisp.pdf &lt; toc
</code></pre></div>

<p>The output <span>PDF</span> document is named <code>onlisp_out.pdf</code><span>Use the <code>-o</code> flag if you want a different file name</span>. When you open it up in zathura</p>
<div><p>In [23]</p><pre><span></span><code><span>$</span> zathura onlisp_out.pdf
</code></pre></div>

<p>and press the <code>TAB</code> key, you should see the table of contents has been successfully imported to the <span>PDF</span> file.</p>
<p>In fact, if you don’t want to edit the table of contents, the output of <span><code>pdftocgen</code></span> can be directly piped into <code>pdftocio</code></p>
<div><p>In [24]</p><pre><span></span><code><span>$</span> pdftocgen onlisp.pdf &lt; recipe.toml <span>|</span> pdftocio onlisp.pdf
</code></pre></div>

<p>I call this program <code>pdftocio</code> because it can also be used to <em>output</em> the existing table of contents of a <span>PDF</span> document if you don’t supply any external input</p>
<div><p>In [25]</p><pre><span></span><code><span>$</span> pdftocio onlisp_out.pdf
</code></pre></div>

<div><p>Out [25]</p><pre><span></span><code><span>&#34;Preface&#34; 5</span>
<span>    &#34;Bottom-up Design&#34; 5</span>
<span>    &#34;Plan of the Book&#34; 7</span>
<span>    &#34;Examples&#34; 9</span>
<span>    &#34;Acknowledgements&#34; 9</span>
<span>&#34;Contents&#34; 11</span>
<span>&#34;The Extensible Language&#34; 14</span>
<span>    &#34;1.1 Design by Evolution&#34; 14</span>
<span>    &#34;1.2 Programming Bottom-Up&#34; 16</span>
<span>    &#34;1.3 Extensible Software&#34; 18</span>
<span>    &#34;1.4 Extending Lisp&#34; 19</span>
<span>    &#34;1.5 Why Lisp (or When)&#34; 21</span>
<span>&#34;Functions&#34; 22</span>
<span>    &#34;2.1 Functions as Data&#34; 22</span>
<span>    &#34;2.2 Defining Functions&#34; 23</span>
<span>    &#34;2.3 Functional Arguments&#34; 26</span>
<span>    &#34;2.4 Functions as Properties&#34; 28</span>
<span>    &#34;2.5 Scope&#34; 29</span>
<span>    &#34;2.6 Closures&#34; 30</span>
<span>    &#34;2.7 Local Functions&#34; 34</span>
<span>    &#34;2.8 Tail-Recursion&#34; 35</span>
<span>    &#34;2.9 Compilation&#34; 37</span>
<span>    &#34;2.10 Functions from Lists&#34; 40</span>
<span>&#34;Functional Programming&#34; 41</span>
<span>    &#34;3.1 Functional Design&#34; 41</span>
<span>    &#34;3.2 Imperative Outside-In&#34; 46</span>
<span>    &#34;3.3 Functional Interfaces&#34; 48</span>
<span>    &#34;3.4 Interactive Programming&#34; 50</span>
<span>[--snip--]</span>
</code></pre></div>

<p>or with the <code>-H</code> flag to display it in a more readable format.</p>
<div><p>In [26]</p><pre><span></span><code><span>$</span> pdftocio -H onlisp_out.pdf
</code></pre></div>

<div><p>Out [26]</p><pre><span></span><code><span>Preface ··· 5</span>
<span>    Bottom-up Design ··· 5</span>
<span>    Plan of the Book ··· 7</span>
<span>    Examples ··· 9</span>
<span>    Acknowledgements ··· 9</span>
<span>Contents ··· 11</span>
<span>The Extensible Language ··· 14</span>
<span>    1.1 Design by Evolution ··· 14</span>
<span>    1.2 Programming Bottom-Up ··· 16</span>
<span>    1.3 Extensible Software ··· 18</span>
<span>    1.4 Extending Lisp ··· 19</span>
<span>    1.5 Why Lisp (or When) ··· 21</span>
<span>Functions ··· 22</span>
<span>    2.1 Functions as Data ··· 22</span>
<span>    2.2 Defining Functions ··· 23</span>
<span>    2.3 Functional Arguments ··· 26</span>
<span>    2.4 Functions as Properties ··· 28</span>
<span>    2.5 Scope ··· 29</span>
<span>    2.6 Closures ··· 30</span>
<span>    2.7 Local Functions ··· 34</span>
<span>    2.8 Tail-Recursion ··· 35</span>
<span>    2.9 Compilation ··· 37</span>
<span>    2.10 Functions from Lists ··· 40</span>
<span>Functional Programming ··· 41</span>
<span>    3.1 Functional Design ··· 41</span>
<span>    3.2 Imperative Outside-In ··· 46</span>
<span>    3.3 Functional Interfaces ··· 48</span>
<span>    3.4 Interactive Programming ··· 50</span>
<span>[--snip--]</span>
</code></pre></div>

<h2 data-number="" id="a-summary">A summary</h2>
<p>Although the example above gets quite long, the essential steps are very simple.</p>
<p>First, search for metadata of headings using <code>pdfxmeta</code></p>
<div><p>In [27]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>1</span> -p page in.pdf <span>&#34;Section&#34;</span> &gt;&gt; recipe.toml
<span>$</span> pdfxmeta -a <span>2</span> -p page in.pdf <span>&#34;Subsection&#34;</span> &gt;&gt; recipe.toml
</code></pre></div>

<p>Edit the <code>recipe.toml</code> file to pick out the attributes you need, or leave it at default if you don’t need any customizations:</p>
<div><p>In [28]</p><pre><span></span><code><span>$</span> vim recipe.toml <span># edit</span>
</code></pre></div>

<p>Then use the recipe to generate a table of contents and import it to the <span>PDF</span> file</p>
<div><p>In [29]</p><pre><span></span><code><span>$</span> pdftocgen in.pdf &lt; recipe.toml <span>|</span> pdftocio -o out.pdf in.pdf
</code></pre></div>

<p>Or if you want to edit the table of contents before importing it,</p>
<div><p>In [30]</p><pre><span></span><code><span>$</span> pdftocgen in.pdf &lt; recipe.toml &gt; toc
<span>$</span> vim toc <span># edit</span>
<span>$</span> pdftocio in.pdf &lt; toc
</code></pre></div>

<p>Each of the three programs has some extra functionalities. Use the <code>-h</code> option to see all the options you could pass in.</p>

<p>pdf.tocgen’s recipe format provides some convenient options for handling math symbols in headings. They are especially useful for handling lecture notes, textbook, or papers in mathematics.</p>
<p>Let us look at another example, the <a href="https://see.stanford.edu/materials/lsoftaee261/book-fall-07.pdf">lecture notes</a> for <span>EE<span>261</span></span> in Stanford, written by Prof. Brad Osgood. This document also doesn’t come with a table of contents, and the headings contains many math symbols such as <img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHdpZHRoPSc1Ny43MjAzOHB0JyBoZWlnaHQ9JzE2LjUzNDAxN3B0JyB2aWV3Qm94PScuMjM5MTA5IC0xMC4zODAyNjQgNDUuMDk0MDQ3IDEyLjkxNzIwMSc+CjxkZWZzPgo8dXNlIGlkPSdnOC00OCcgeGxpbms6aHJlZj0nI2c3LTQ4JyB0cmFuc2Zvcm09J3NjYWxlKDEuMzYzNjM2KScvPgo8dXNlIGlkPSdnOC00OScgeGxpbms6aHJlZj0nI2c3LTQ5JyB0cmFuc2Zvcm09J3NjYWxlKDEuMzYzNjM2KScvPgo8cGF0aCBpZD0nZzEtMTg1JyBkPSdNMy42MjA3OTMtOC45OTI0M0MxLjgxMDM5Ny03LjgxMzI5IC43MTQ2My01Ljc3NjU5NCAuNzE0NjMtMy4yMTU4MzZDLjcxNDYzLS44ODEzNzcgMS44NDYxMjggMS4zNDU4ODcgMy41ODUwNjIgMi41MzY5MzdMMy43Mzk4OTggMi4zMzQ0NTlDMi4wODQzMzggLjkwNTE5OCAxLjc5ODQ4Ni0uNDg4MzMxIDEuNzk4NDg2LTMuMjYzNDc4UzIuMTIwMDctNy40Nzk3OTYgMy43Mzk4OTgtOC43ODk5NTJMMy42MjA3OTMtOC45OTI0M1onLz4KPHBhdGggaWQ9J2cxLTE4NicgZD0nTS41MDAyNDEtOC45OTI0M0wuMzgxMTM2LTguNzg5OTUyQzIuMDAwOTY1LTcuNDc5Nzk2IDIuMzIyNTQ4LTYuMDM4NjI1IDIuMzIyNTQ4LTMuMjYzNDc4UzIuMDM2Njk2IC45MDUxOTggLjM4MTEzNiAyLjMzNDQ1OUwuNTM1OTczIDIuNTM2OTM3QzIuMjc0OTA2IDEuMzQ1ODg3IDMuNDA2NDA0LS44ODEzNzcgMy40MDY0MDQtMy4yMTU4MzZDMy40MDY0MDQtNS43NzY1OTQgMi4zMTA2MzgtNy44MTMyOSAuNTAwMjQxLTguOTkyNDNaJy8+CjxwYXRoIGlkPSdnMS0xODcnIGQ9J00zLjc1MTgwOSAyLjEwODE1OUgyLjY2Nzk1M0MyLjI1MTA4NSAyLjEwODE1OSAyLjA2MDUxNyAxLjg5Mzc3IDIuMDYwNTE3IDEuNDUzMDgxVi03Ljk5MTk0OEMyLjA2MDUxNy04LjM4NDk5NSAyLjIxNTM1NC04LjU1MTc0MiAyLjYyMDMxMS04LjU1MTc0MkgzLjc1MTgwOVYtOC44NjE0MTVIMS4xMDc2NzdWMi40MTc4MzJIMy43NTE4MDlWMi4xMDgxNTlaJy8+CjxwYXRoIGlkPSdnMS0xODgnIGQ9J00uNDI4Nzc4IDIuMTA4MTU5VjIuNDE3ODMySDMuMDcyOTFWLTguODYxNDE1SC40Mjg3NzhWLTguNTUxNzQySDEuNTAwNzIzQzEuOTE3NTkxLTguNTUxNzQyIDIuMTIwMDctOC4zMzczNTMgMi4xMjAwNy03Ljg5NjY2NFYxLjU2MDI3NkMyLjEyMDA3IDEuOTUzMzIzIDEuOTUzMzIzIDIuMTA4MTU5IDEuNTYwMjc2IDIuMTA4MTU5SC40Mjg3NzhaJy8+CjxwYXRoIGlkPSdnNy00OCcgZD0nTTQuMDc2NzE0LTMuMjA4NzY4QzQuMDc2NzE0LTUuMTI4NzY5IDMuNTA2ODUxLTYuMDQwNTUgMi4zMDU3NTQtNi4wNDA1NUMuOTQ2ODUtNi4wNDA1NSAuMjU0MjQ3LTQuOTYyMTk0IC4yNTQyNDctMi44NDA1NDlDLjI1NDI0Ny0xLjgxNDc5NSAuNDM4MzU2LS45MjkzMTUgLjc0NTIwNi0uNDk5NzI2UzEuNTQzMDE0IC4xNzUzNDMgMi4wODY1NzYgLjE3NTM0M0MzLjQxMDQxMiAuMTc1MzQzIDQuMDc2NzE0LS45NjQzODQgNC4wNzY3MTQtMy4yMDg3NjhaTTMuMzQwMjc1LTIuNzcwNDEyQzMuMzQwMjc1LS45MDMwMTQgMy4wMDcxMjQtLjEzMTUwNyAyLjIwMDU0OS0uMTMxNTA3QzEuMzUwMTM3LS4xMzE1MDcgLjk5MDY4NS0xLjAxNjk4NyAuOTkwNjg1LTMuMTU2MTY1Qy45OTA2ODUtNS4wMDYwMjkgMS4zMTUwNjktNS43MzM3MDEgMi4xNDc5NDYtNS43MzM3MDFDMi45OTgzNTctNS43MzM3MDEgMy4zNDAyNzUtNC44NzQ1MjIgMy4zNDAyNzUtMi43NzA0MTJaJy8+CjxwYXRoIGlkPSdnNy00OScgZD0nTTMuNjY0NjU5IC4wMjYzMDFWLS4yMzY3MTJMMy4yMDg3NjgtLjI2MzAxNEMyLjcyNjU3Ni0uMjg5MzE1IDIuNjM4OTA1LS4zODU3NTQgMi42Mzg5MDUtLjg0MTY0NFYtNi4wNDA1NUwyLjUxNjE2NS02LjA4NDM4NkMxLjk0NjMwMi01Ljc4NjMwMyAxLjMyMzgzNi01LjUyMzI5IC41MjYwMjgtNS4yNDI3NDJMLjU4NzM5Ny00Ljg2NTc1NUguNjc1MDY5TDEuODA2MDI4LTUuMzc0MjQ4TDEuODMyMzI5LTUuMzgzMDE2QzEuODg0OTMyLTUuMzgzMDE2IDEuOTAyNDY2LTUuMzA0MTExIDEuOTAyNDY2LTUuMDkzN1YtLjg0MTY0NEMxLjkwMjQ2Ni0uMzg1NzU0IDEuODA2MDI4LS4yODkzMTUgMS4zMzI2MDMtLjI2MzAxNEwuODQxNjQ0LS4yMzY3MTJWLjAyNjMwMUMxLjMyMzgzNiAuMDA4NzY3IDEuODA2MDI4IDAgMi4yODgyMiAwQzIuNzQ0MTExIDAgMy4yMDg3NjggLjAwODc2NyAzLjY2NDY1OSAuMDI2MzAxWicvPgo8cGF0aCBpZD0nZzctNTAnIGQ9J000LjEwMzAxNSAuMDI2MzAxQzQuMDg1NDgxLS4xNTc4MDggNC4wODU0ODEtLjI0NTQ4IDQuMDg1NDgxLS4zNjgyMTlDNC4wODU0ODEtLjQ4MjE5MiA0LjA4NTQ4MS0uNTY5ODYzIDQuMTAzMDE1LS43NjI3NEwxLjA2OTU4OS0uNjc1MDY5TDIuNjY1MjA2LTIuMzY3MTI0QzMuNTE1NjE4LTMuMjcwMTM4IDMuNzc4NjMxLTMuNzUyMzMgMy43Nzg2MzEtNC40MDk4NjVDMy43Nzg2MzEtNS40MTgwODQgMy4wOTQ3OTYtNi4wNDA1NSAxLjk4MTM3MS02LjA0MDU1QzEuMzUwMTM3LTYuMDQwNTUgLjkyMDU0OC01Ljg2NTIwOCAuNDkwOTU5LTUuNDI2ODUxTC4zNDE5MTgtNC4yMzQ1MjJILjU5NjE2NUwuNzEwMTM3LTQuNjM3ODFDLjg1MDQxMS01LjE0NjMwMyAxLjE2NjAyOC01LjM2NTQ4MSAxLjc1MzQyNS01LjM2NTQ4MUMyLjUwNzM5OC01LjM2NTQ4MSAyLjk4OTU5LTQuODkyMDU2IDIuOTg5NTktNC4xNDY4NTFDMi45ODk1OS0zLjQ4OTMxNiAyLjYyMTM3MS0yLjg0MDU0OSAxLjYzMDY4NS0xLjc4ODQ5NEwuMTQwMjc0LS4yMDE2NDRWLjAyNjMwMUMuNzg5MDQxIC4wMDg3NjcgMS40NDY1NzYgMCAyLjA5NTM0MyAwQzIuNzYxNjQ1IDAgMy40MzY3MTQgLjAwODc2NyA0LjEwMzAxNSAuMDI2MzAxWicvPgo8cGF0aCBpZD0nZzUtMzMnIGQ9J001Ljk1NTI1MiAwQzUuOTQzMzQxLS4yOTc3NjMgNi4wNzQzNTctMS4yMjY3ODIgNi4yMjkxOTMtMS45NjUyMzNINS44NTk5NjhMNS42NTc0ODktMS4yMjY3ODJDNS41NTAyOTUtLjg0NTY0NiA1LjQ1NTAxMS0uNjQzMTY3IDUuMzM1OTA2LS41OTU1MjVDNS4xOTI5OC0uNTI0MDYyIDQuMjg3NzgxLS40NjQ1MSAzLjYyMDc5My0uNDY0NTFDMi45NjU3MTUtLjQ2NDUxIDIuNjY3OTUzLS40NzY0MiAxLjkyOTUwMi0uNTQ3ODgzQzEuOTI5NTAyLS42OTA4MDkgMS45Mjk1MDItLjgyMTgyNSAxLjk1MzMyMy0uOTY0NzUxTDMuMDQ5MDg5LTcuMzAxMTM5QzMuMTMyNDYyLTcuNzUzNzM4IDMuMjE1ODM2LTcuODM3MTExIDMuNjU2NTI1LTcuODcyODQzTDQuMTU2NzY2LTcuOTA4NTc0TDQuMTkyNDk3LTguMjQyMDY5QzMuNzE2MDc3LTguMjE4MjQ4IDMuMjM5NjU3LTguMjA2MzM3IDIuNzYzMjM3LTguMjA2MzM3QzIuMjI3MjY0LTguMjA2MzM3IDEuNjkxMjkyLTguMjE4MjQ4IDEuMTU1MzE5LTguMjQyMDY5TDEuMTE5NTg3LTcuOTA4NTc0TDEuNjc5MzgxLTcuODg0NzUzQzEuOTY1MjMzLTcuODcyODQzIDIuMDk2MjQ5LTcuNzc3NTU5IDIuMDk2MjQ5LTcuNTc1MDhDMi4wOTYyNDktNy4zOTY0MjMgMi4wNjA1MTctNy4wNTEwMTggMS45ODkwNTQtNi42NTc5NzJMLjk2NDc1MS0uNjU1MDc4Qy45MjkwMTktLjQ0MDY4OSAuNzc0MTgzLS4zNTczMTUgLjI1MDEyMS0uMjczOTQyTC4xOTA1NjggLjAzNTczMkMuNzk4MDA0IC4wMTE5MTEgMS40MTczNSAwIDIuMDI0Nzg2IDBDMi45MTgwNzMgMCAzLjgxMTM2MSAuMDM1NzMyIDQuNzA0NjQ5IC4wMzU3MzJDNS4xOTI5OCAuMDM1NzMyIDUuNTM4Mzg0IC4wMzU3MzIgNS45NTUyNTIgMFonLz4KPHBhdGggaWQ9J2c1LTE1MCcgZD0nTTIuNTk2NDktMS4yOTgyNDVMMi40Mjk3NDMtMS40NjQ5OTJDMi4xMDgxNTktMS4zNTc3OTcgMS44OTM3Ny0xLjI4NjMzNCAxLjI2MjUxMy0xLjEwNzY3N0MxLjE3OTE0LS4yMDI0NzkgLjg4MTM3NyAuNTcxNzA0IC4xOTA1NjggMS43MTUxMTNMLjM1NzMxNSAxLjg0NjEyOEwuODQ1NjQ2IDEuNjE5ODI5QzEuODEwMzk3IC4zNjkyMjYgMi4yNjI5OTYtLjM4MTEzNiAyLjU5NjQ5LTEuMjk4MjQ1WicvPgo8L2RlZnM+CjxnPgo8dXNlIHg9Jy4yMzkxMDknIHk9JzAnIHhsaW5rOmhyZWY9JyNnNS0zMycvPgo8dXNlIHg9JzcuMDA1NzM0JyB5PSctNC4zMzk3MTQnIHhsaW5rOmhyZWY9JyNnNy01MCcvPgo8dXNlIHg9JzExLjg4NzQyMScgeT0nMCcgeGxpbms6aHJlZj0nI2cxLTE4NScvPgo8dXNlIHg9JzE2LjAyMzkwNicgeT0nMCcgeGxpbms6aHJlZj0nI2cxLTE4NycvPgo8dXNlIHg9JzIwLjIwODIyJyB5PScwJyB4bGluazpocmVmPScjZzgtNDgnLz4KPHVzZSB4PScyNi41NDQ0NTUnIHk9JzAnIHhsaW5rOmhyZWY9JyNnNS0xNTAnLz4KPHVzZSB4PSczMS43NjQ4NTQnIHk9JzAnIHhsaW5rOmhyZWY9JyNnOC00OScvPgo8dXNlIHg9JzM3Ljc0MjQzOCcgeT0nMCcgeGxpbms6aHJlZj0nI2cxLTE4OCcvPgo8dXNlIHg9JzQxLjkyNjc1MScgeT0nMCcgeGxpbms6aHJlZj0nI2cxLTE4NicvPgo8L2c+Cjwvc3ZnPg=="/>, <img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHdpZHRoPSc2LjY0MTMzNXB0JyBoZWlnaHQ9JzcuMTE1NzE2cHQnIHZpZXdCb3g9JzAgLTUuNTU5MTUzIDUuMTg4NTQzIDUuNTU5MTUzJz4KPGRlZnM+CjxwYXRoIGlkPSdnMC0zJyBkPSdNMy4yODc2NzEtNS4xMDQ4NTdDMy4yOTk2MjYtNS4yNzIyMjkgMy4yOTk2MjYtNS41NTkxNTMgMi45ODg3OTItNS41NTkxNTNDMi43OTc1MDktNS41NTkxNTMgMi42NDIwOTItNS40MDM3MzYgMi42Nzc5NTgtNS4yNDgzMTlWLTUuMDkyOTAyTDIuODQ1MzMtMy4yMzk4NTFMMS4zMTUwNjgtNC4zNTE2ODFDMS4yMDc0NzItNC40MTE0NTcgMS4xODM1NjItNC40MzUzNjcgMS4wOTk4NzUtNC40MzUzNjdDLjkzMjUwMy00LjQzNTM2NyAuNzc3MDg2LTQuMjY3OTk1IC43NzcwODYtNC4xMDA2MjNDLjc3NzA4Ni0zLjkwOTM0IC44OTY2MzgtMy44NjE1MTkgMS4wMTYxODktMy44MDE3NDNMMi43MTM4MjMtMi45ODg3OTJMMS4wNjQwMS0yLjE4Nzc5NkMuODcyNzI3LTIuMDkyMTU0IC43NzcwODYtMi4wNDQzMzQgLjc3NzA4Ni0xLjg2NTAwNlMuOTMyNTAzLTEuNTMwMjYyIDEuMDk5ODc1LTEuNTMwMjYyQzEuMTgzNTYyLTEuNTMwMjYyIDEuMjA3NDcyLTEuNTMwMjYyIDEuNTA2MzUxLTEuNzU3NDFMMi44NDUzMy0yLjcyNTc3OEwyLjY2NjAwMi0uNzE3MzFDMi42NjYwMDItLjQ2NjI1MiAyLjg4MTE5Ni0uNDA2NDc2IDIuOTc2ODM3LS40MDY0NzZDMy4xMjAyOTktLjQwNjQ3NiAzLjI5OTYyNi0uNDkwMTYyIDMuMjk5NjI2LS43MTczMUwzLjEyMDI5OS0yLjcyNTc3OEw0LjY1MDU2LTEuNjEzOTQ4QzQuNzU4MTU3LTEuNTU0MTcyIDQuNzgyMDY3LTEuNTMwMjYyIDQuODY1NzUzLTEuNTMwMjYyQzUuMDMzMTI2LTEuNTMwMjYyIDUuMTg4NTQzLTEuNjk3NjM0IDUuMTg4NTQzLTEuODY1MDA2QzUuMTg4NTQzLTIuMDQ0MzM0IDUuMDgwOTQ2LTIuMTA0MTEgNC45Mzc0ODQtMi4xNzU4NDFDNC4yMjAxNzQtMi41MzQ0OTYgNC4xOTYyNjQtMi41MzQ0OTYgMy4yNTE4MDYtMi45NzY4MzdMNC45MDE2MTktMy43Nzc4MzNDNS4wOTI5MDItMy44NzM0NzQgNS4xODg1NDMtMy45MjEyOTUgNS4xODg1NDMtNC4xMDA2MjNTNS4wMzMxMjYtNC40MzUzNjcgNC44NjU3NTMtNC40MzUzNjdDNC43ODIwNjctNC40MzUzNjcgNC43NTgxNTctNC40MzUzNjcgNC40NTkyNzgtNC4yMDgyMTlMMy4xMjAyOTktMy4yMzk4NTFMMy4yODc2NzEtNS4xMDQ4NTdaJy8+CjwvZGVmcz4KPGc+Cjx1c2UgeD0nMCcgeT0nMCcgeGxpbms6aHJlZj0nI2cwLTMnLz4KPC9nPgo8L3N2Zz4="/>, <img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPScxLjEnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycgeG1sbnM6eGxpbms9J2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnIHdpZHRoPSc2Ljk2NzE2OHB0JyBoZWlnaHQ9JzEwLjk0NjIyOXB0JyB2aWV3Qm94PScuMzU4NjUyIC04LjM2MTE3NCA1LjQ0MzEgOC41NTE3NDInPgo8ZGVmcz4KPHBhdGggaWQ9J2cxLTE2JyBkPSdNNS40NDMxLTMuNDE4MzE1QzUuNDQzMS01LjU4NjAyNiAyLjY0NDEzMi02LjAyNjcxNSAyLjY0NDEzMi03LjQwODMzM0MyLjY0NDEzMi03LjkwODU3NCAzLjI3NTM4OS04LjA4NzIzMiAzLjY4MDM0Ni04LjA4NzIzMkM0LjA5NzIxMy04LjA4NzIzMiA0LjUwMjE3LTcuOTU2MjE2IDQuODQ3NTc1LTcuNzI5OTE3TDQuOTc4NTkxLTcuODAxMzhDNC45NDI4NTktNy45NDQzMDYgNC44OTUyMTctOC4xMTEwNTMgNC44MjM3NTQtOC4yNjU4OUM0LjUzNzkwMi04LjMyNTQ0MiA0LjI0MDEzOS04LjM2MTE3NCAzLjk0MjM3Ny04LjM2MTE3NEMzLjIwMzkyNi04LjM2MTE3NCAxLjc5ODQ4Ni04LjA1MTUwMSAxLjc5ODQ4Ni03LjExMDU3MUMxLjc5ODQ4Ni02LjQxOTc2MiAyLjY0NDEzMi01Ljg3MTg3OCAzLjE1NjI4My01LjUyNjQ3NEwzLjE0NDM3My01LjQ1NTAxMUMxLjQ1MzA4MS01LjA3Mzg3NSAuMzgxMTM2LTMuNjIwNzkzIC4zODExMzYtMS45MDU2ODFDLjM4MTEzNi0uNjMxMjU3IC45MDUxOTggLjE5MDU2OCAyLjI1MTA4NSAuMTkwNTY4QzQuMTIxMDM0IC4xOTA1NjggNS40NDMxLTEuNjU1NTYgNS40NDMxLTMuNDE4MzE1Wk00LjUzNzkwMi0zLjIwMzkyNkM0LjUzNzkwMi0yLjA3MjQyOCAzLjk2NjE5OC0uMTQyOTI2IDIuNTYwNzU4LS4xNDI5MjZDMS41NjAyNzYtLjE0MjkyNiAxLjI5ODI0NS0xLjE3OTE0IDEuMjk4MjQ1LTEuOTg5MDU0QzEuMjk4MjQ1LTMuNTEzNTk5IDEuODEwMzk3LTQuODk1MjE3IDMuMzk0NDk0LTUuMzM1OTA2QzQuMTMyOTQ1LTQuNzUyMjkxIDQuNTM3OTAyLTQuMTgwNTg3IDQuNTM3OTAyLTMuMjAzOTI2WicvPgo8L2RlZnM+CjxnPgo8dXNlIHg9Jy4zNTg2NTInIHk9JzAnIHhsaW5rOmhyZWY9JyNnMS0xNicvPgo8L2c+Cjwvc3ZnPg=="/>, etc.</p>
<p>These math symbols do not have the same font as the surrounding text, which can be a problem if we specify the headings using <span><code>font.name</code></span>:</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>24.78696060180664</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346190452575684</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>3</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.955169677734375</span>
</code></pre></div>

<p>The recipe above is generated using</p>
<div><p>In [31]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>1</span> -p <span>7</span> ft.pdf <span>&#34;Fourier Series&#34;</span> &gt;&gt; ft.toml
</code></pre></div>

<div><p>In [32]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>2</span> -p <span>7</span> ft.pdf <span>&#34;Introduction&#34;</span> &gt;&gt; ft.toml
</code></pre></div>

<div><p>In [33]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>3</span> -p <span>28</span> ft.pdf <span>&#34;punchline&#34;</span> &gt;&gt; ft.toml
</code></pre></div>

<p>with comments cleaned up.</p>
<p>If we pass the recipe file <code>pdftocgen</code>, you would notice that some of the math symbols are missing from the title.</p>
<div><p>In [34]</p><pre><span></span><code><span>$</span> pdftocgen -H ft.pdf &lt; ft.toml
</code></pre></div>

<div><p>Out [34]</p><pre><span></span><code><span>EE 261 ··· 1</span>
<span>Contents ··· 3</span>
<span>Fourier Series ··· 7</span>
<span>    1.1 Introduction and Choices to Make ··· 7</span>
<span>    1.2 Periodic Phenomena ··· 8</span>
<span>        1.2.1 Time and space ··· 8</span>
<span>        1.2.2 More on spatial periodicity ··· 9</span>
<span>    1.3 Periodicity: Definitions, Examples, and Things to Come ··· 10</span>
<span>        1.3.1 The view from above ··· 12</span>
<span>        1.3.2 The building blocks: a few more examples ··· 13</span>
<span>        1.3.3 Musical pitch and tuning ··· 14</span>
<span>    1.4 It All Adds Up ··· 15</span>
<span>    1.5 Lost at ··· 16</span>
<span>    1.6 Period, Frequencies, and Spectrum ··· 19</span>
<span>        1.6.1 What if the period isn’t 1? ··· 20</span>
<span>    1.7 Two Examples and a Warning ··· 22</span>
<span>    1.8 The Math, the Majesty, the End ··· 27</span>
<span>        1.8.1 Square integrable functions ··· 27</span>
<span>        1.8.2 The punchline revealed ··· 28</span>
<span>    1.9 Orthogonality ··· 32</span>
<span>    1.10 Appendix: The Cauchy-Schwarz Inequality and its Consequences ··· 39</span>
<span>    1.11 Appendix: More on the Complex Inner Product ··· 42</span>
<span>    1.12 Appendix: Best Approximation by Finite Fourier Series ··· 44</span>
<span>    1.13 Fourier Series in Action ··· 45</span>
<span>        1.13.1 Hot enough for ya? ··· 45</span>
<span>        1.13.2 A nonclassical example: What’s the buzz? ··· 53</span>
<span>    1.14 Notes on Convergence of Fourier Series ··· 56</span>
<span>        1.14.1 How big are the Fourier coefficients? ··· 56</span>
<span>        1.14.2 Rates of convergence and smoothness ··· 59</span>
<span>        1.14.3 Convergence if it’s not continuous? ··· 60</span>
<span>    1.15 Appendix: Pointwise Convergence vs. Uniform Convergence ··· 64</span>
<span>    1.16 Appendix: Studying Partial Sums via the Dirichlet Kernel: The Buzz Is Back ··· 65</span>
<span>    1.17 Appendix: The Complex Exponentials Are a Basis for ··· 67</span>
<span>    1.18 Appendix: More on the Gibbs Phenomenon ··· 68</span>
<span>[--snip--]</span>
</code></pre></div>

<p>Pay attention to the title of section <span>1</span>.<span>5</span>, <span>1</span>.<span>12</span>, and <span>1</span>.<span>17</span>. Comparing it with page <span>3</span> of the <span>PDF</span>, you should notice that the math symbols are missing from the headings.</p>
<p>There are several options to deal with this issue.</p>
<h2 data-number="" id="option-1-greedy-filter">Option <span>1</span>: greedy filter</h2>
<p>This is the recommended approach, as you might have noticed. It is the default setting for the <code>-a</code> option of <code>pdfxmeta</code>, because it’s simple and it works the best among all the options.</p>
<p>A <span>greedy</span> filter will extract any text from the <em>enclosed</em> or <em>surrounding</em> region of the heading, even if some parts don’t match the current filter.</p>
<p>This is exactly our case here, since a math symbol in headings is usually surrounded by plain text matching the filter, but they are in a different font themselves.</p>
<p>If you want to make a heading filter <span>greedy</span>, just add</p>
<pre><code>greedy = true</code></pre>
<p>to the corresponding heading filter in the recipe file. For example, for the recipe above, we have</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>24.78696060180664</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346190452575684</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>3</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.955169677734375</span>
</code></pre></div>

<p>Now the recipe should extract the math symbols in the headings automatically.</p>
<div><p>In [35]</p><pre><span></span><code><span>$</span> pdftocgen -H ft.pdf &lt; ft.toml
</code></pre></div>

<div><p>Out [35]</p><pre><span></span><code><span>EE 261 ··· 1</span>
<span>Contents ··· 3</span>
<span>Fourier Series ··· 7</span>
<span>    1.1 Introduction and Choices to Make ··· 7</span>
<span>    1.2 Periodic Phenomena ··· 8</span>
<span>        1.2.1 Time and space ··· 8</span>
<span>        1.2.2 More on spatial periodicity ··· 9</span>
<span>    1.3 Periodicity: Definitions, Examples, and Things to Come ··· 10</span>
<span>        1.3.1 The view from above ··· 12</span>
<span>        1.3.2 The building blocks: a few more examples ··· 13</span>
<span>        1.3.3 Musical pitch and tuning ··· 14</span>
<span>    1.4 It All Adds Up ··· 15</span>
<span>    1.5 Lost at c ··· 16</span>
<span>    1.6 Period, Frequencies, and Spectrum ··· 19</span>
<span>        1.6.1 What if the period isn’t 1? ··· 20</span>
<span>    1.7 Two Examples and a Warning ··· 22</span>
<span>    1.8 The Math, the Majesty, the End ··· 27</span>
<span>        1.8.1 Square integrable functions ··· 27</span>
<span>        1.8.2 The punchline revealed ··· 28</span>
<span>    1.9 Orthogonality ··· 32</span>
<span>    1.10 Appendix: The Cauchy-Schwarz Inequality and its Consequences ··· 39</span>
<span>    1.11 Appendix: More on the Complex Inner Product ··· 42</span>
<span>    1.12 Appendix: Best L 2  Approximation by Finite Fourier Series ··· 44</span>
<span>    1.13 Fourier Series in Action ··· 45</span>
<span>        1.13.1 Hot enough for ya? ··· 45</span>
<span>        1.13.2 A nonclassical example: What’s the buzz? ··· 53</span>
<span>    1.14 Notes on Convergence of Fourier Series ··· 56</span>
<span>        1.14.1 How big are the Fourier coefficients? ··· 56</span>
<span>        1.14.2 Rates of convergence and smoothness ··· 59</span>
<span>        1.14.3 Convergence if it’s not continuous? ··· 60</span>
<span>    1.15 Appendix: Pointwise Convergence vs. Uniform Convergence ··· 64</span>
<span>    1.16 Appendix: Studying Partial Sums via the Dirichlet Kernel: The Buzz Is Back ··· 65</span>
<span>    1.17 Appendix: The Complex Exponentials Are a Basis for L 2 ([0 , 1]) ··· 67</span>
<span>    1.18 Appendix: More on the Gibbs Phenomenon ··· 68</span>
<span>[--snip--]</span>
</code></pre></div>

<p>Of course, it still needs some further clean up, but it should be easy using a decent text editor.</p>
<h2 data-number="" id="option-2-regex">Option <span>2</span>: Regex</h2>
<p>Alternatively, since <code>font.name</code> takes an regular expression, we could supply multiple font name using the <code>(a|b)</code> syntax. For example, we could first use <span>GNU</span> or <span>BSD</span> <code>grep</code> to find the metadata of a math symbol:</p>
<div><p>In [36]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>16</span> ft.pdf <span>|</span> grep -A <span>25</span> <span>&#34;Lost at&#34;</span>
</code></pre></div>

<div><p>Out [36]</p><pre><span></span><code><span>Lost at:</span>
<span>    font.name = &#34;HYPGHW+CMBX12&#34;</span>
<span>    font.size = 14.346190452575684</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 87.12625122070312</span>
<span>    bbox.top = 510.04034423828125</span>
<span>    bbox.right = 137.03665161132812</span>
<span>    bbox.bottom = 524.40087890625</span>
<span> c:</span>
<span>    font.name = &#34;SYTZSX+CMMIB10&#34;</span>
<span>    font.size = 14.346190452575684</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = true</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 137.03665161132812</span>
<span>    bbox.top = 510.04034423828125</span>
<span>    bbox.right = 150.005615234375</span>
<span>    bbox.bottom = 524.3865356445312</span>
</code></pre></div>

<p>Now that we know the font name of <code>c</code> is <code>CMMIB10</code>, we could modify the filter to include it.</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;(CMBX12|CMMIB10)&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346190452575684</span>
</code></pre></div>

<p>However, since superscripts usually have different font sizes than the surrounding text, this approach doesn’t work here.</p>
<h2 data-number="" id="option-3-multiple-filters">Option <span>3</span>: Multiple filters</h2>
<p>Another option is to use multiple filters for the same heading level. Internally, matched text of the same level will be collapsed into one if they are in the same block.</p>
<p>For the example in the previous section, it is equivalent to write</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346190452575684</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMMIB10&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346190452575684</span>
</code></pre></div>

<p>but this allows us to specify different font sizes.</p>
<p>Using the same approach as in previous section, we could find the metadata of all the math symbols in the text and create separate heading filters for them, which gives us the following recipe:</p>
<div><pre><span></span><code><span>[[heading]]</span>
<span>level</span> <span>=</span> <span>1</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>24.78696060180664</span>

<span>[[heading]]</span>
<span># text</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346190452575684</span>

<span>[[heading]]</span>
<span># math</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;(CMMIB10|CMMI12|CMR12)&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346190452575684</span>

<span>[[heading]]</span>
<span># superscript</span>
<span>level</span> <span>=</span> <span>2</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMR10&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>9.962639808654785</span>
<span>font</span><span>.</span><span>superscript</span> <span>=</span> <span>true</span>

<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>3</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>11.955169677734375</span>
</code></pre></div>

<p>This filter is able to extract all the math symbols,</p>
<div><p>In [37]</p><pre><span></span><code><span>$</span> pdftocgen -H ft.pdf &lt; ft.toml
</code></pre></div>

<div><p>Out [37]</p><pre><span></span><code><span>EE 261 ··· 1</span>
<span>    Prof. Brad Osgood Electrical Engineering Department Stanford University ··· 1</span>
<span>Contents ··· 3</span>
<span>Fourier Series ··· 7</span>
<span>    1.1 Introduction and Choices to Make ··· 7</span>
<span>    1.2 Periodic Phenomena ··· 8</span>
<span>        1.2.1 Time and space ··· 8</span>
<span>        1.2.2 More on spatial periodicity ··· 9</span>
<span>    1.3 Periodicity: Definitions, Examples, and Things to Come ··· 10</span>
<span>        1.3.1 The view from above ··· 12</span>
<span>        1.3.2 The building blocks: a few more examples ··· 13</span>
<span>    1 ··· 13</span>
<span>    1 ··· 13</span>
<span>        1.3.3 Musical pitch and tuning ··· 14</span>
<span>    1.4 It All Adds Up ··· 15</span>
<span>    1.5 Lost at c ··· 16</span>
<span>    1.6 Period, Frequencies, and Spectrum ··· 19</span>
<span>        1.6.1 What if the period isn’t 1? ··· 20</span>
<span>    1.7 Two Examples and a Warning ··· 22</span>
<span>    1.8 The Math, the Majesty, the End ··· 27</span>
<span>        1.8.1 Square integrable functions ··· 27</span>
<span>        1.8.2 The punchline revealed ··· 28</span>
<span>    1.9 Orthogonality ··· 32</span>
<span>    1.10 Appendix: The Cauchy-Schwarz Inequality and its Consequences ··· 39</span>
<span>    1.11 Appendix: More on the Complex Inner Product ··· 42</span>
<span>    1.12 Appendix: Best L 2 Approximation by Finite Fourier Series ··· 44</span>
<span>    1.13 Fourier Series in Action ··· 45</span>
<span>        1.13.1 Hot enough for ya? ··· 45</span>
<span>        1.13.2 A nonclassical example: What’s the buzz? ··· 53</span>
<span>    1.14 Notes on Convergence of Fourier Series ··· 56</span>
<span>        1.14.1 How big are the Fourier coefficients? ··· 56</span>
<span>        1.14.2 Rates of convergence and smoothness ··· 59</span>
<span>        1.14.3 Convergence if it’s not continuous? ··· 60</span>
<span>    1.15 Appendix: Pointwise Convergence vs. Uniform Convergence ··· 64</span>
<span>    1.16 Appendix: Studying Partial Sums via the Dirichlet Kernel: The Buzz Is Back ··· 65</span>
<span>    1.17 Appendix: The Complex Exponentials Are a Basis for L 2 ([0 , 1]) ··· 67</span>
<span>    1.18 Appendix: More on the Gibbs Phenomenon ··· 68</span>
<span>[--snip--]</span>
</code></pre></div>

<p>but it is less accurate and introduces many unnecessary symbols, but they should be relatively easy to clean up in post processing.</p>
<p>When in doubt, just use option <span>1</span> and make the filter greedy. Options <span>2</span> and <span>3</span> are only the last resort.</p>

<p>Except all the metadata generated by <code>pdfxmeta</code>, there are a few other options you could specify in the recipe file. Here is a list of all the valid keys for each heading filter.</p>
<div><pre><span></span><code><span># filter for level 1 heading</span>
<span>[[heading]]</span>
<span># heading level</span>
<span>level</span> <span>=</span> <span>1</span>
<span># makes this filter a *greedy* filter, useful for PDFs</span>
<span># containing many math symbols</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX12&#34;</span>
<span># matches font.size ± font.size_tolerance</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>14.346199989318848</span>
<span>font</span><span>.</span><span>size_tolerance</span> <span>=</span> <span>1e-5</span>
<span>font</span><span>.</span><span>color</span> <span>=</span> <span>0</span><span>x000000</span>
<span>font</span><span>.</span><span>superscript</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>italic</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>serif</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>monospace</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>bold</span> <span>=</span> <span>true</span>
<span># matches bbox.left ± bbox.tolerance</span>
<span>bbox</span><span>.</span><span>left</span> <span>=</span> <span>157.98439025878906</span>
<span># matches bbox.top ± bbox.tolerance</span>
<span>bbox</span><span>.</span><span>top</span> <span>=</span> <span>335.569580078125</span>
<span># matches bbox.right ± bbox.tolerance</span>
<span>bbox</span><span>.</span><span>right</span> <span>=</span> <span>477.66058349609375</span>
<span># matches bbox.bottom ± bbox.tolerance</span>
<span>bbox</span><span>.</span><span>bottom</span> <span>=</span> <span>349.93011474609375</span>
<span>bbox</span><span>.</span><span>tolerance</span> <span>=</span> <span>1e-5</span>

<span># filter for level 2 heading</span>
<span>[[heading]]</span>
<span>level</span> <span>=</span> <span>2</span>
<span>greedy</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;CMBX10&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>9.962599754333496</span>
<span>font</span><span>.</span><span>size_tolerance</span> <span>=</span> <span>1e-5</span>
<span>font</span><span>.</span><span>color</span> <span>=</span> <span>0</span><span>x000000</span>
<span>font</span><span>.</span><span>superscript</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>italic</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>serif</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>monospace</span> <span>=</span> <span>false</span>
<span>font</span><span>.</span><span>bold</span> <span>=</span> <span>true</span>
<span>bbox</span><span>.</span><span>left</span> <span>=</span> <span>168.76663208007812</span>
<span>bbox</span><span>.</span><span>top</span> <span>=</span> <span>127.2930679321289</span>
<span>bbox</span><span>.</span><span>right</span> <span>=</span> <span>280.66656494140625</span>
<span>bbox</span><span>.</span><span>bottom</span> <span>=</span> <span>137.2556610107422</span>
<span>bbox</span><span>.</span><span>tolerance</span> <span>=</span> <span>1e-5</span>

<span># ...</span>
</code></pre></div>

<p>Again, don’t be too specific about bounding boxes, since headings generally have different widths. Use the <code>-a</code> option of <code>pdfxmeta</code> if you are not sure what attributes to pick.</p>

<p>Because of the modularity of design, each program is useful on its own, despite being part of the pipeline. This section will provide some more examples on how you could use them. Feel free to come up with more.</p>
<h2 data-number="7.1" id="pdftocio"> <code>pdftocio</code></h2>
<p><code>pdftocio</code> should best demonstrate this point, this program can do a lot on its own.</p>
<p>To display existing table of contents in a <span>PDF</span> to <code>stdout</code>:</p>
<div><p>In [38]</p><pre><span></span><code><span>$</span> pdftocio doc.pdf
</code></pre></div>

<div><p>Out [38]</p><pre><span></span><code><span>&#34;Level 1 heading 1&#34; 1</span>
<span>    &#34;Level 2 heading 1&#34; 1</span>
<span>        &#34;Level 3 heading 1&#34; 2</span>
<span>        &#34;Level 3 heading 2&#34; 3</span>
<span>    &#34;Level 2 heading 2&#34; 4</span>
<span>&#34;Level 1 heading 2&#34; 5</span>
</code></pre></div>

<p>To write existing table of contents in a <span>PDF</span> to a file named <code>toc</code>:</p>
<div><p>In [39]</p><pre><span></span><code><span>$</span> pdftocio doc.pdf &gt; toc
</code></pre></div>

<p>To write a <code>toc</code> file back to <code>doc.pdf</code>:</p>
<div><p>In [40]</p><pre><span></span><code><span>$</span> pdftocio doc.pdf &lt; toc
</code></pre></div>

<p>To specify the name of output <span>PDF</span>:</p>
<div><p>In [41]</p><pre><span></span><code><span>$</span> pdftocio -o out.pdf doc.pdf &lt; toc
</code></pre></div>

<p>To copy the table of contents from <code>doc1.pdf</code> to <code>doc2.pdf</code>:</p>
<div><p>In [42]</p><pre><span></span><code><span>$ </span>pdftocio<span> </span>-v<span> </span>doc1.pdf<span> </span><span>|</span><span> </span>pdftocio<span> </span>doc2.pdf
</code></pre></div>

<p>Note that the <code>-v</code> flag helps preserve the vertical positions of headings during the copy.</p>
<p>To print the table of contents for reading:</p>
<div><p>In [43]</p><pre><span></span><code><span>$</span> pdftocio -H doc.pdf
</code></pre></div>

<div><p>Out [43]</p><pre><span></span><code><span>Level 1 heading 1 ··· 1</span>
<span>    Level 2 heading 1 ··· 1</span>
<span>        Level 3 heading 1 ··· 2</span>
<span>        Level 3 heading 2 ··· 3</span>
<span>    Level 2 heading 2 ··· 4</span>
<span>Level 1 heading 2 ··· 5</span>
</code></pre></div>

<h2 data-number="7.2" id="pdftocgen"> <code>pdftocgen</code></h2>
<p>If you have obtained an existing recipe <code>rcp.toml</code> for <code>doc.pdf</code>, you could apply it and print the outline to <code>stdout</code> by</p>
<div><p>In [44]</p><pre><span></span><code><span>$ </span>pdftocgen<span> </span>doc.pdf<span> </span>&lt;<span> </span>rcp.toml
</code></pre></div>

<div><p>Out [44]</p><pre><span></span><code><span>&#34;Level 1 heading 1&#34; 1</span>
<span>    &#34;Level 2 heading 1&#34; 1</span>
<span>        &#34;Level 3 heading 1&#34; 2</span>
<span>        &#34;Level 3 heading 2&#34; 3</span>
<span>    &#34;Level 2 heading 2&#34; 4</span>
<span>&#34;Level 1 heading 2&#34; 5</span>
</code></pre></div>

<p>To output the table of contents to a file called <code>toc</code>:</p>
<div><p>In [45]</p><pre><span></span><code><span>$</span> pdftocgen doc.pdf &lt; rcp.toml &gt; toc
</code></pre></div>

<p>To import the generated table of contents to the <span>PDF</span> file, and output to <code>doc_out.pdf</code>:</p>
<div><p>In [46]</p><pre><span></span><code><span>$</span> pdftocgen doc.pdf &lt; rcp.toml <span>|</span> pdftocio -o doc_out.pdf doc.pdf
</code></pre></div>

<p>To print the generated table of contents for reading:</p>
<div><p>In [47]</p><pre><span></span><code><span>$</span> pdftocgen -H doc.pdf &lt; rcp.toml
</code></pre></div>

<div><p>Out [47]</p><pre><span></span><code><span>Level 1 heading 1 ··· 1</span>
<span>    Level 2 heading 1 ··· 1</span>
<span>        Level 3 heading 1 ··· 2</span>
<span>        Level 3 heading 2 ··· 3</span>
<span>    Level 2 heading 2 ··· 4</span>
<span>Level 1 heading 2 ··· 5</span>
</code></pre></div>

<p>If you want to include the vertical position in a page for each heading, use the <code>-v</code> flag</p>
<div><p>In [48]</p><pre><span></span><code><span>$</span> pdftocgen -v doc.pdf &lt; rcp.toml
</code></pre></div>

<div><p>Out [48]</p><pre><span></span><code><span>&#34;Level 1 heading 1&#34; 1 306.947998046875</span>
<span>    &#34;Level 2 heading 1&#34; 1 586.3488159179688</span>
<span>        &#34;Level 3 heading 1&#34; 2 586.5888061523438</span>
<span>        &#34;Level 3 heading 2&#34; 3 155.66879272460938</span>
<span>    &#34;Level 2 heading 2&#34; 4 435.8687744140625</span>
<span>&#34;Level 1 heading 2&#34; 5 380.78875732421875</span>
</code></pre></div>

<p><code>pdftocio</code> can understand the vertical position in the output to generate table of contents entries that link to the exact position of the heading, instead of the top of the page.</p>
<div><p>In [49]</p><pre><span></span><code><span>$</span> pdftocgen -v doc.pdf &lt; rcp.toml <span>|</span> pdftocio doc.pdf
</code></pre></div>

<p>Note that the default output of <code>pdftocio</code> here is <code>doc_out.pdf</code>.</p>

<p>To search for <code>Anaphoric</code> in the entire <span>PDF</span></p>
<div><p>In [50]</p><pre><span></span><code><span>$</span> pdfxmeta onlisp.pdf <span>&#34;Anaphoric&#34;</span>
</code></pre></div>

<div><p>Out [50]</p><pre><span></span><code><span>14. Anaphoric Macros:</span>
<span>    font.name = &#34;Times-Bold&#34;</span>
<span>    font.size = 9.962599754333496</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = true</span>
<span>    bbox.left = 308.6400146484375</span>
<span>    bbox.top = 307.1490478515625</span>
<span>    bbox.right = 404.33282470703125</span>
<span>    bbox.bottom = 320.9472351074219</span>
<span>[--snip--]</span>
</code></pre></div>

<p>To output the result as a heading filter with the automatic settings,</p>
<div><p>In [51]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>1</span> onlisp.pdf <span>&#34;Anaphoric&#34;</span>
</code></pre></div>

<div><p>Out [51]</p><pre><span></span><code><span>[[heading]]</span>
<span># 14. Anaphoric Macros</span>
<span>level</span> <span>=</span> <span>1</span>
<span>greedy</span> <span>=</span> <span>true</span>
<span>font</span><span>.</span><span>name</span> <span>=</span> <span>&#34;Times-Bold&#34;</span>
<span>font</span><span>.</span><span>size</span> <span>=</span> <span>9.962599754333496</span>
<span># font.size_tolerance = 1e-5</span>
<span># font.color = 0x000000</span>
<span># font.superscript = false</span>
<span># font.italic = false</span>
<span># font.serif = true</span>
<span># font.monospace = false</span>
<span># font.bold = true</span>
<span># bbox.left = 308.6400146484375</span>
<span># bbox.top = 307.1490478515625</span>
<span># bbox.right = 404.33282470703125</span>
<span># bbox.bottom = 320.9472351074219</span>
<span># bbox.tolerance = 1e-5</span>
<span># [--snip--]</span>
</code></pre></div>

<p>which can be directly write to a recipe file:</p>
<div><p>In [52]</p><pre><span></span><code><span>$</span> pdfxmeta -a <span>1</span> onlisp.pdf <span>&#34;Anaphoric&#34;</span> &gt;&gt; recipe.toml
</code></pre></div>

<p>To case-insensitive search for <code>Anaphoric</code> in the entire <span>PDF</span>:</p>
<div><p>In [53]</p><pre><span></span><code><span>$</span> pdfxmeta -i onlisp.pdf <span>&#34;Anaphoric&#34;</span>
</code></pre></div>

<div><p>Out [53]</p><pre><span></span><code><span>to compile-time. Chapter 14 introduces anaphoric macros, which allow you to:</span>
<span>    font.name = &#34;Times-Roman&#34;</span>
<span>    font.size = 9.962599754333496</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = false</span>
<span>    bbox.left = 138.60000610351562</span>
<span>    bbox.top = 295.6583557128906</span>
<span>    bbox.right = 459.0260009765625</span>
<span>    bbox.bottom = 308.948486328125</span>
<span>[--snip--]</span>
</code></pre></div>

<p>Use regular expression to case-insensitive search search for <code>Anaphoric</code> in the entire <span>PDF</span>:</p>
<div><p>In [54]</p><pre><span></span><code><span>$</span> pdfxmeta onlisp.pdf <span>&#34;[Aa]naphoric&#34;</span>
</code></pre></div>

<div><p>Out [54]</p><pre><span></span><code><span>to compile-time. Chapter 14 introduces anaphoric macros, which allow you to:</span>
<span>    font.name = &#34;Times-Roman&#34;</span>
<span>    font.size = 9.962599754333496</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = false</span>
<span>    bbox.left = 138.60000610351562</span>
<span>    bbox.top = 295.6583557128906</span>
<span>    bbox.right = 459.0260009765625</span>
<span>    bbox.bottom = 308.948486328125</span>
<span>[--snip--]</span>
</code></pre></div>

<p>To search only on page <span>203</span>:</p>
<div><p>In [55]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>203</span> onlisp.pdf <span>&#34;anaphoric&#34;</span>
</code></pre></div>

<div><p>Out [55]</p><pre><span></span><code><span>anaphoric if, called:</span>
<span>    font.name = &#34;Times-Roman&#34;</span>
<span>    font.size = 9.962599754333496</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = false</span>
<span>    bbox.left = 138.60000610351562</span>
<span>    bbox.top = 283.17822265625</span>
<span>    bbox.right = 214.81094360351562</span>
<span>    bbox.bottom = 296.4683532714844</span>
<span>[--snip--]</span>
</code></pre></div>

<p>To dump the entire page of <span>203</span>:</p>
<div><p>In [56]</p><pre><span></span><code><span>$</span> pdfxmeta -p <span>203</span> onlisp.pdf
</code></pre></div>

<div><p>Out [56]</p><pre><span></span><code><span>190:</span>
<span>    font.name = &#34;Times-Roman&#34;</span>
<span>    font.size = 9.962599754333496</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = false</span>
<span>    bbox.left = 138.60000610351562</span>
<span>    bbox.top = 126.09941101074219</span>
<span>    bbox.right = 153.54388427734375</span>
<span>    bbox.bottom = 139.38951110839844</span>
<span>[--snip--]</span>
</code></pre></div>

<p>To dump the entire <span>PDF</span> document:</p>
<div><p>In [57]</p><pre><span></span><code><span>$</span> pdfxmeta onlisp.pdf
</code></pre></div>

<div><p>Out [57]</p><pre><span></span><code><span>i:</span>
<span>    font.name = &#34;Times-Roman&#34;</span>
<span>    font.size = 9.962599754333496</span>
<span>    font.color = 0x000000</span>
<span>    font.superscript = false</span>
<span>    font.italic = false</span>
<span>    font.serif = true</span>
<span>    font.monospace = false</span>
<span>    font.bold = false</span>
<span>    bbox.left = 458.0400085449219</span>
<span>    bbox.top = 126.09941101074219</span>
<span>    bbox.right = 460.8096008300781</span>
<span>    bbox.bottom = 139.38951110839844</span>
<span>[--snip--]</span>
</code></pre></div>


<p>If you want to modify the source code or contribute anything, first install <a href="https://python-poetry.org/"><code>poetry</code></a>, which is a dependency and package manager for Python used by pdf.tocgen. Then run</p>


<p>in the root directory of the repository to set up development dependencies.</p>
<p>If you want to test the development version of pdf.tocgen, add</p>
<pre><code>poetry run</code></pre>
<p>prefix to each commands, for example</p>
<div><p>In [59]</p><pre><span></span><code><span>$</span> poetry run pdfxmeta in.pdf <span>&#34;pattern&#34;</span>
</code></pre></div>

<p>Alternatively, you could also use the</p>


<p>command to open up a virtual environment and run the development version directly:</p>
<div><p>In [61]</p><pre><span></span><code><span>(pdf.tocgen)</span> <span>$</span> pdfxmeta in.pdf <span>&#34;pattern&#34;</span>
</code></pre></div>

<p>Before you send a patch or pull request, make sure the unit test passes by running:</p>



<p>If you are a Emacs user, you could install Daniel Nicolai’s <a href="https://github.com/dalanicolai/toc-mode">toc-mode</a> package as a <span>GUI</span> front end for pdf.tocgen, though it offers many more functionalities, such as extracting (printed) table of contents from a <span>PDF</span> file. Note that it uses pdf.tocgen under the hood, so you still need to install pdf.tocgen before using toc-mode as a front end for pdf.tocgen.</p>

<p>pdf.tocgen itself a is free software. The source code of pdf.tocgen is licensed under the GNU GPLv<span>3</span> license. However, the recipes in the <code>recipes</code> directory is separately licensed under the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA <span>4</span>.<span>0</span> License</a> to prevent any commercial usage, and thus not included in the distribution.</p>
<p>pdf.tocgen is based on <a href="https://github.com/pymupdf/PyMuPDF">PyMuPDF</a>, licensed under the GNU GPLv<span>3</span> license, which is again based on MuPDF, licensed under the GNU AGPLv<span>3</span> license. A copy of the AGPLv<span>3</span> license is included in the repository.</p>
<p>If you want to make any derivatives based on this project, please follow the terms of the GNU GPLv<span>3</span> license.</p>
</div></div>
  </body>
</html>
