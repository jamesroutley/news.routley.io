<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.yakkomajuri.com/blog/local-rag">Original</a>
    <h1>So you wanna build a local RAG?</h1>
    
    <div id="readability-page-1" class="page"><div><section><p>November 26, 2025</p><article><p>When we launched <a target="_blank" rel="noopener noreferrer" href="https://github.com/skaldlabs/skald">Skald</a>, we wanted it to not only be self-hostable, but also for one to be able to run it without sending any data to third-parties.</p>
<p>With LLMs getting better and better, privacy-sensitive organizations shouldn&#39;t have to choose between being left behind by not accessing frontier models and doing away with their committment (or legal requirement) for data privacy.</p>
<p>So here&#39;s what we did to support this use case and also some benchmarks comparing performance when using proprietary APIs vs self-hosted open-source tech.</p>
<h2 id="rag-components-and-their-oss-alternatives"><a href="#rag-components-and-their-oss-alternatives"></a>RAG components and their OSS alternatives</h2>
<p>A basic RAG usually has the following core components:</p>
<ul>
<li>A vector database</li>
<li>A vector embeddings model</li>
<li>An LLM</li>
</ul>
<p>And most times it also has these as well:</p>
<ul>
<li>A reranker</li>
<li>Document parsing (for PDFs, PowerPoints, etc)</li>
</ul>
<p>What that means is that when you&#39;re looking to build a fully local RAG setup, you&#39;ll need to substitute whatever SaaS providers you&#39;re using for a local option for each of those components.</p>
<p>Here&#39;s a table with some examples of what we might use in a scenario where we can use third-party Cloud services and one where we can&#39;t:</p>



































<table><thead><tr><th>Component</th><th>Proprietary Options</th><th>Open-Source Options</th></tr></thead><tbody><tr><td>Vector Database</td><td>Pinecone, Turbopuffer, Weaviate Cloud, Qdrant Cloud</td><td>Qdrant, Weaviate, Postgres with pgvector</td></tr><tr><td>Vector Embeddings Provider</td><td>OpenAI, Cohere, Voyage</td><td>Sentence Transformers, BGE, E5</td></tr><tr><td>LLM</td><td>GPT, Claude, Gemini</td><td>Llama, Mistral, GPT-OSS</td></tr><tr><td>Reranker</td><td>Cohere, Voyage</td><td>BGE Reranker, Sentence Transformers Cross-Encoder</td></tr><tr><td>Document Parsing</td><td>Reducto, Datalab</td><td>Docling</td></tr></tbody></table>
<blockquote>
<p>Do note that running something locally does not mean it <em>needs</em> to be open-source, as one could pay for a license to self-host proprietary software. But at Skald our goal was to use fully open-source tech, which is what I&#39;ll be convering here.</p>
</blockquote>
<p>The table above is far from covering all available options on both columns, but basically it gives you an indication of what to research into in order to pick a tool that works for you.</p>
<p>As with anything, what works for you will greatly depend on your use case. And you need to be prepared to run a few more services than you&#39;re used to if you&#39;ve just been calling APIs.</p>
<p>For our local stack, we went with the easiest setup for now to get it working (and it does! see writeup on this lower down) but will be running benchmarks on all other options to determine the best possible setup.</p>
<p>This is what we have today:</p>
<p><strong>Vector DB:</strong> Postgres + pgvector. We already use Postgres and didn&#39;t want to bundle another service into our stack, but this is <a target="_blank" rel="noopener noreferrer" href="https://alex-jacobs.com/posts/the-case-against-pgvector/">controversial</a> and we will be running benchmarks to make a better informed decision here. Note that pgvector will serve a lot of use cases well all the way up to hundreds of thousands of documents, though.</p>
<p><strong>Vector embeddings:</strong> Users can configure this in Skald and we use Sentence Transformers (<a target="_blank" rel="noopener noreferrer" href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2">all-MiniLM-L6-v2</a>) as our default (solid all-around performer for speed and retrieval, English-only). I also ran Skald with bge-m3 (larger, multi-language) and share the results later in this post.</p>
<p><strong>LLM:</strong> We don&#39;t even bundle a default with Skald and it&#39;s up to the users to run and manage this. I tested our setup with GPT-OSS 20B on EC2 (results shown below).</p>
<p><strong>Reranker:</strong> Users can also configure this in Skald, and the default is the Sentence Transformers <a target="_blank" rel="noopener noreferrer" href="https://huggingface.co/cross-encoder">cross encoder</a> (solid, English-only). I&#39;ve also used bge-reranker-v2-m3 and mmarco-mMiniLMv2-L12-H384-v1 which offer multi-lingual support.</p>
<p><strong>Document parsing:</strong> There isn&#39;t much of a question on this one. We&#39;re using Docling. It&#39;s great. We run it via <a target="_blank" rel="noopener noreferrer" href="https://github.com/docling-project/docling-serve">docling-serve</a>.</p>
<h2 id="does-it-perform-though"><a href="#does-it-perform-though"></a>Does it perform though?</h2>
<p>So the main goal here was first to get something working then ensure it worked well with our platform and could be easily deployed. From here we&#39;ll be running extensive benchmarks and working with our clients to provide a solid setup that both performs well but is also not a nightmare to deploy and manage.</p>
<p>From that perspective, this was a great success.</p>
<p>Deploying a production instance of Skald with this whole stack took me 8 minutes, and that comes bundled with the vector database (well, Postgres), a reranking and embedding service, and Docling.</p>
<p>The only thing I needed to run separately was the LLM, which I did via <a target="_blank" rel="noopener noreferrer" href="https://github.com/ggml-org/llama.cpp">llama.cpp</a>.</p>
<p>Having gotten this sorted, I imported all the content from the PostHog website <a href="#footnotes">[1]</a> and set up a tiny dataset <a href="#footnotes">[2]</a> of questions and expected answers inside of Skald, then used our Experiments feature to run the RAG over this dataset.</p>
<p>I explicitly kept the topK values really high (100 for the vector search and 50 for post-reranking), as I was mostly testing for accuracy and wanted to see the performance when questions required e.g. aggregating context over 15+ documents.</p>
<details><summary>Full config</summary><p>Here are the params configured in the Skald UI for the the experiment.</p>




































<table><thead><tr><th>Config option</th><th>Selection</th></tr></thead><tbody><tr><td>Extra system prompt</td><td>Be really concise in your answers</td></tr><tr><td>Query rewriting</td><td>Off</td></tr><tr><td>Vector search topK</td><td>100</td></tr><tr><td>Vector search distance threshold</td><td>0.8</td></tr><tr><td>Reranking</td><td>On</td></tr><tr><td>Reranking topK</td><td>50</td></tr><tr><td>References</td><td>Off</td></tr></tbody></table></details>
<p>So without any more delay, here are the results of my not-very-scientific at all benchmark using the experimentation platform inside of Skald.</p>
<p><img alt="skald experiments" src="https://blog.yakkomajuri.com/images/voyage-claude.png"/></p>
<h3 id="voyage-claude"><a href="#voyage-claude"></a>Voyage + Claude</h3>
<p>This is our default Cloud setup. We use voyage-3-large and rerank-2.5 from <a target="_blank" rel="noopener noreferrer" href="https://www.voyageai.com/">Voyage AI</a> as our embedding and reranking models respectively, and we default to Claude Sonnet 3.7 for responses (users can configure the model though).</p>
<p>It passed with flying colors.</p>
<p>Our LLM-as-a-Judge gave an average score of 9.45 to the responses, and I basically agree with the assessment. All answers were correct, with one missing a few extra bits of context.</p>
<h3 id="voyage-gpt-oss-20b"><a href="#voyage-gpt-oss-20b"></a>Voyage + GPT-OSS 20B</h3>
<p>With the control experiment done, I then moved on to a setup where I kept Voyage as the embeddings provider and reranker, and then used GPT-OSS 20B running on a llama.cpp server on a g5.2xlarge EC2 instance as the LLM.</p>
<p>The goal here was to see how well the open-source LLM model itself stacked up against a frontier model accessed via API.</p>
<p>And it did great!</p>
<p>We don&#39;t yet support LLM-as-a-Judge on fully local deployments, so the only score we have here is mine. I scored the answers an average of 9.18 and they were all correct, with two of them just missing a few bits of information or highlighting less relevant information from the context.</p>
<h3 id="fully-local-gpt-oss-20b"><a href="#fully-local-gpt-oss-20b"></a>Fully local + GPT-OSS 20B</h3>
<p>Lastly, it was time for the moment of truth: running a fully local setup.</p>
<p>For this I ran two tests:</p>
<p><strong>1. Default sentence transformers embedding and reranking models</strong></p>
<p>The most popular open-source models are <a target="_blank" rel="noopener noreferrer" href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2">all-MiniLM-L6-v2</a> for embeddings and <a target="_blank" rel="noopener noreferrer" href="https://huggingface.co/cross-encoder/ms-marco-MiniLM-L6-v2">ms-marco-MiniLM-L6-v2</a> as the reranker, so I used those for my first benchmark.</p>
<p>Here the average score was 7.10. Not bad, but definitely not great. However, when we dig into the results, we can get a better understanding of how this setup fails.</p>
<p>Basically, it got all point queries right, which are questions where the answer is somewhere in the mess of documents, but can be found from one specific place.</p>
<p>Where it failed was:</p>
<ul>
<li>Non-english query: The embeddings model and the reranker are English-based, so my question in Portuguese obviously got no answer</li>
<li>An ambiguous question with very little context (&#34;what&#39;s ch&#34;)</li>
<li>Aggregating information from multiple documents/chunks e.g. it only found 5 out of PostHog&#39;s 7 funding rounds, and only a subset of the PostHog competitors that offer session replay (as mentioned in the source data)</li>
</ul>
<p>In my view, this is good news. That means that the default options will go a long way and should give you very good performance if your use case is only doing point queries in English. The other great thing is that these models are also fast.</p>
<p>Now, if you need to handle ambiguity better, or handle questions in other languages, then this setup is simply not for you.</p>
<p><strong>2. Multi-lingual models</strong></p>
<p>The next test I did used <a target="_blank" rel="noopener noreferrer" href="https://huggingface.co/BAAI/bge-m3">bge-m3</a> as the embeddings model and <a target="_blank" rel="noopener noreferrer" href="https://huggingface.co/jeffwan/mmarco-mMiniLMv2-L12-H384-v1">mmarco-mMiniLMv2-L12-H384-v1</a> as the reranker. The embeddings model is supposedly much better than the one used in the previous test and is also multi-lingual. The reranker on the other hand uses the same cross-encoder from the previous test as the base model but also adds multi-lingual support. The more standard option here would have been the much more popular <a target="_blank" rel="noopener noreferrer" href="https://huggingface.co/BAAI/bge-reranker-v2-m3">bge-reranker-v2-m3</a> model, but I found it to be much slower. I intend to tweak my setup and test it again, however.</p>
<p>Anyway, onto the results! I scored it 8.63 on average, which is very good. There were no complete failures, and it handled the question in Portuguese well.</p>
<p>The mistakes it made were:</p>
<ul>
<li>This new setup also did not do the best job at aggregating information, missing 2 of PostHog&#39;s funding rounds, and a couple of its session replay competitors</li>
<li>It also answered a question correctly, but added incorrect additional context after it</li>
</ul>
<p>So overall it performed quite well. Again what we what saw was the main problem is when the context needed for the response is scattered across multiple documents. There are various techniques to help with this and we&#39;ll be trialing some soon! They haven&#39;t been needed on the Cloud version because better models save you from having to add complexity for minimal performance gains, but as we&#39;re focused on building a really solid setup for local deploys, we&#39;ll be looking into this more and more.</p>
<h2 id="now-what"><a href="#now-what"></a>Now what?</h2>
<p>I hope this writeup has provided you with at least some insight and context into building a local RAG, and also the fact that it does work, it can serve a lot of use cases, and that the tendency is for this setup to get better and better as a) models improve b) we get more open-source models across the board, with both being things that we seem to be trending towards.</p>
<p>As for us at Skald, we intend to polish this setup further in order to serve even more use cases really well, as well as intend to soon be publishing more legitimate benchmarks for models in the open-source space, from LLMs to rerankers.</p>
<p>If you&#39;re a company that needs to run AI tooling in air-gapped infrastructure, let&#39;s chat -- feel free to email me at yakko [at] useskald [dot] com.</p>
<p>Lastly, if you want to get involved, feel free to chat to us over on our <a target="_blank" rel="noopener noreferrer" href="https://github.com/skaldlabs/skald">GitHub repo</a> (MIT-licensed) or catch us on <a target="_blank" rel="noopener noreferrer" href="https://join.slack.com/t/skaldcommunity/shared_invite/zt-3he986lub-UWKTZneOAUeTFa4LDXpFEg">Slack</a>.</p>
<hr/>

<p><strong>[1]</strong> I used the PostHog website here because the website content is MIT-licensed (yes, wild) and readily-available as markdown on <a target="_blank" rel="noopener noreferrer" href="https://github.com/PostHog/posthog.com">GitHub</a> and having worked there I know a lot of answers off the top of my head making it a great dataset of ~2000 documents that I know well.</p>
<p><strong>[2]</strong> The questions and answers dataset I used for the experiments was the following:</p>
<details><summary>Dataset</summary>
































































<table><thead><tr><th>Question</th><th>Expected answer</th><th>Comments</th></tr></thead><tbody><tr><td>How many raises did PostHog do?</td><td>PostHog has raised money 7 times: it raised $150k from YCombinator, then did a seed round ($3.025M), a series A ($12M), a series B ($15M), a series C ($10M), a series D ($70M), and a series E ($75M).</td><td>Requires aggregating context from at least 7 documents</td></tr><tr><td>When did group analytics launch?</td><td>December 16, 2021.</td><td>Point query, multiple mentions to &#34;group analytics&#34; in the source docs</td></tr><tr><td>Why was the sessions page removed?</td><td>The sessions page was removed because it was confusing and limited in functionality. It was replaced by the &#39;Recordings&#39; tab.</td><td>Point query, multiple mentions to &#34;sessions&#34; in the source docs</td></tr><tr><td>What&#39;s the difference between a product engineer and other roles?</td><td>Compared to product managers, product engineers focus more on building rather than deep research and planning. When it comes to software engineers, both product and software engineers write code, but software engineers focus on building great software, whereas product engineers focus on building great products.</td><td>Requires aggregating context from multiple docs + there are a ton of mentions of &#34;product engineer&#34; in the source docs</td></tr><tr><td>What were the main benefits of YC?</td><td>The main benefits of YC were: Network Access, Investor Reviews, Office Hours, Funding Opportunities, Hiring Resources, Angel Investing Opportunities, Accelerated Growth and Experience, Shift in Self-Perception, Customer Acquisition, Product Market Fit, Ambitious Goal Setting, Access to Thought Leaders, Community Support</td><td>Point query</td></tr><tr><td>quem foi o primeiro investidor da posthogg?</td><td>O primeiro investidor da PostHog foi o YCombinator.</td><td>Question in Portuguese, with PostHog misspelled</td></tr><tr><td>what posthog competitors also offer session replays</td><td>LogRocket, Smartlook, FullStory, Microsoft Clarity, Contentsquare, Mouseflow, Heap, Pendo, Hotjar, Glassbox, and Amplitude.</td><td>Requires aggregating content from at least 11 docs (more because I actually missed some in my expected answer)</td></tr><tr><td>top tips find client</td><td>1. Leverage your inner circle 2. Join relevant communities 3. Be laser-focused 4. Set achievable goals 5. Frame conversations properly</td><td>Point query, worded weirdly</td></tr><tr><td>what&#39;s ch</td><td>CH most likely refers to ClickHouse, a column-oriented OLAP database.</td><td>Really ambiguous. I meant ClickHouse with my question.</td></tr><tr><td>what is mixedpanel</td><td>Mixpanel is a popular product analytics tool that was founded in 2009</td><td>Mixpanel misspelled as Mixedpanel</td></tr><tr><td>how was prpoerty filtering made faster?</td><td>Using materialized columns allowed ClickHouse to skip JSON parsing during queries and made queries with property filtering 25x faster.</td><td>Point query with a typo</td></tr></tbody></table></details></article><div><p>subscribe to get notified of new posts</p></div></section><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></div></div>
  </body>
</html>
