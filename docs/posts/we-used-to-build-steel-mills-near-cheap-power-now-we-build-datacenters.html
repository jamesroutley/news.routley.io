<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://danluu.com/datacenter-power/">Original</a>
    <h1>We used to build steel mills near cheap power. Now we build datacenters</h1>
    
    <div id="readability-page-1" class="page"><div> <p>Why are people so concerned with hardware power consumption nowadays? Some common answers to this question are that <a href="http://www.vox.com/2015/3/9/8178213/apple-macbook-all-batteries">power is critically important for phones, tablets, and laptops</a> and that <a href="ftp://ftp.cs.utexas.edu/pub/dburger/papers/ISCA11.pdf">we can put more silicon on a modern chip than we can effectively use</a>. In 2001 <a href="http://ieeexplore.ieee.org/xpl/login.jsp?tp=&amp;arnumber=912412&amp;url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D912412">Patrick Gelsinger observed that if scaling continued at then-current rates</a>, chips would have the power density of a nuclear reactor by 2005, a rocket nozzle by 2010, and the surface of the sun by 2015. Needless to say, that didn&#39;t happen. The importance of portables and scaling limits are both valid and important reasons, but since they&#39;re widely discussed, I&#39;m going to talk about an underrated reason.</p> <p>People often focus on the portable market because it&#39;s cannibalizing desktop market, but that&#39;s not the only growth market -- servers are also becoming more important than desktops, and power is really important for servers. To see why power is important for servers, let&#39;s look at some calculations about how what it costs to run a datacenter from <a href="http://www.amazon.com/gp/product/012383872X/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=012383872X&amp;linkCode=as2&amp;tag=abroaview-20&amp;linkId=Y6Z2OBCUCR72ALEB">Hennessy &amp; Patterson</a>.</p>  <p>One of the issues is that you pay for power multiple times. Some power is lost at the substation, although we might not have to pay for that directly. Then we lose more storing energy in a UPS. This figure below states 6%, but smaller scale datacenters can easily lose twice that. After that, we lose more power stepping down the power to a voltage that a server can accept. That&#39;s over a 10% loss for a setup that&#39;s pretty efficient.</p> <p>After that, we lose more power in the server&#39;s power supply, stepping down the voltage to levels that are useful inside a computer, which is often about another 10% loss (not pictured in the figure below).</p> <p><img src="https://danluu.com/images/datacenter-power/power_conversion.png" alt="Power conversion figure from Hennessy &amp; Patterson, which reproduced the figure from Hamilton" width="640" height="383"/></p> <p>And then once we get the power into servers, it gets turned into waste heat. To keep the servers from melting, we have to pay for power to cool them. <a href="http://www.morganclaypool.com/doi/abs/10.2200/S00193ED1V01Y200905CAC006">Barroso and Holzle</a> estimated that 30%-50% of the power drawn by a datacenter is used for chillers, and that an additional 10%-20% is for the <a href="http://www.dchuddle.com/2011/crac-v-crah/">CRAC</a> (air circulation). That means for every watt of power used in the server, we pay for another 1-2 watts of support power.</p> <p>And to actually get all this power, we have to pay for the infrastructure required to get the power into and throughout the datacenter. Hennessy &amp; Patterson estimate that of the $90M cost of an example datacenter (just the facilities -- not the servers), 82% is associated with power and cooling. The servers in the datacenter are estimated to only cost $70M. It&#39;s not fair to compare those numbers directly since servers need to get replaced more often than datacenters; once you take into account the cost over the entire lifetime of the datacenter, the amortized cost of power and cooling comes out to be 33% of the total cost, when servers have a 3 year lifetime and infrastructure has a 10-15 year lifetime.</p> <p>If we look at all the costs, the breakdown is:</p>  <table> <tbody><tr> <th>category</th><th>%</th></tr> <tr> <td>server machines</td><td>53</td></tr> <tr> <td>power &amp; cooling infra</td><td>20</td></tr> <tr> <td>power use</td><td>13</td></tr> <tr> <td>networking</td><td>8</td></tr> <tr> <td>other infra</td><td>4</td></tr> <tr> <td>humans</td><td>2</td></tr> </tbody></table> <p>Power use and people are the cost of operating the datacenter (OPEX), whereas server machines, networking, power &amp; cooling infra, and other infra are capital expenditures that are amortized across the lifetime of the datacenter (CAPEX).</p> <p>Computation uses a lot of power. <a href="http://www.datacenterknowledge.com/archives/2010/05/19/microsoft-building-new-data-center-in-quincy/">We used to build steel mills near cheap sources of power</a>, but <a href="http://www.datacenterknowledge.com/archives/2010/05/19/microsoft-building-new-data-center-in-quincy/">now that&#39;s where we build datacenters</a>. As companies start considering the full cost of applications, we&#39;re seeing a lot more power optimized solutions. Unfortunately, this is really hard. On the software side, with the exceptions of toy microbenchmark examples, <a href="http://arcade.cs.columbia.edu/energy-oopsla14.pdf">best practices for writing power efficient code still aren&#39;t well understood</a>. On the hardware side, Intel recently released a new generation of chips with significantly improved performance per watt that doesn&#39;t have much better absolute performance than the previous generation. On the hardware accelerator front, some large companies are building dedicated power-efficient hardware for specific computations. But with existing tools, hardware accelerators are costly enough that dedicated hardware only makes sense for the largest companies. There isn&#39;t an easy answer to this problem.</p> <p><small> If you liked this post, you&#39;d probably like chapter 6 of <a href="http://www.amazon.com/gp/product/012383872X/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=012383872X&amp;linkCode=as2&amp;tag=abroaview-20&amp;linkId=Y6Z2OBCUCR72ALEB">Hennessy &amp; Patterson</a>, which walks through not only the cost of power, but a number of related back of the envelope calculations relating to datacenter performance and cost.</small></p> <p>Apologies for the quickly scribbled down post. I jotted this down shortly before signing an NDA for an interview where I expected to learn some related information and I wanted to make sure I had my thoughts written down before there was any possibility of being contaminated with information that&#39;s under NDA. </p>  </div></div>
  </body>
</html>
