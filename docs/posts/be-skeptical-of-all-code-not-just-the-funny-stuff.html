<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://eieio.games/blog/be-skeptical-of-all-code-not-just-the-funny-stuff">Original</a>
    <h1>Be Skeptical of All Code - Not Just the Funny Stuff</h1>
    
    <div id="readability-page-1" class="page"><article>
<p>Should you be more skeptical of code that is a “self-admitted keylogger” than code that purports to be useful? I’m not so sure.</p>
<p>Last week I made a <a href="https://github.com/nolenroyalty/global-capslock">global caps lock key</a>. It’s a joke project <a>1</a> - a small client that keeps caps lock in sync for everyone running the client.</p>
<div data-is-footnote="true"><div><div><div><p><span>1</span></p><p>It’s a joke, but it’s real - I did make this and it does work. It’s good to
commit to the bit!</p></div></div></div></div>
<p>It has been relatively popular on <a href="https://x.com/itseieio/status/1887283293298553032">various</a> social media <a href="https://bsky.app/profile/itseieio.bsky.social/post/3lhhqzzmpok2r">platforms</a>. So I’ve heard from a lot of strangers about it. And a comment I keep hearing is:</p>
<blockquote><p>This is a massive risk and it’s insane that anyone has installed it!!</p></blockquote>
<p>I don’t fully disagree. But I’d like to stress one point: <em>this code requires no special permissions on Windows or Linux</em> <a>2</a>.</p>
<div data-is-footnote="true"><div><div><div><p><span>2</span></p><p>MacOS does require a relatively general accessibility permission for the code
to be able to send keystrokes to your computer - but you have to grant that
permission to the terminal that’s running the program, not my script.</p></div></div></div></div>
<p>If you’re on one of those platforms, <em>any</em> code a stranger gives you could be doing the exact same thing. If you want to be intellectually consistent, I think you should apply the same mindset to any other program whose source you haven’t read.</p>
<p>At least my code is an easy to read open-source 200 line python script!</p>
<!-- -->
<h2 id="toc:arguing-with-myself">Arguing with myself</h2>
<p>Maybe I’m not being totally fair. Here are a few thoughts</p>
<h3 id="toc:caps-lock-is-special">Caps Lock is special</h3>
<p>It’s a lot easier to access the state of caps lock than it is to intercept every key someone types, and that’s a good thing.</p>
<p>My program doesn’t work by intercepting caps lock key presses. Instead it polls the caps lock <em>state</em> - it checks whether it’s currently on or off and compares that to a past value. Platforms make this relatively easy to do - reading from <code>/sys/class/leds</code> on Linux, for example - and that kinda makes sense.</p>
<p>So maybe it’s more accurate to say “any script you run on Linux could read the state of your caps lock key and if you don’t read the source you’d have no idea.” That’s a little less scary.</p>
<p>Although I don’t know how difficult it is to write a python script that intercepts every keystroke, or what permissions it would need on various platforms. Do you?</p>
<h3 id="toc:this-code-explicitly-targets-the-keyboard">This code explicitly targets the keyboard</h3>
<p>Let’s say I was trying to make a malicious program that targets your keyboard. Would it be more effective to:</p>
<ul>
<li>Make a funny program that explicitly interfaces with your keyboard</li>
<li>Make a funny program that <em>doesn’t</em> explicitly interface with your keyboard</li>
<li>Make a useful, innocuous tool and smuggle something in, <a href="https://en.wikipedia.org/wiki/XZ_Utils_backdoor">xz-style</a></li>
</ul>
<p>I’m not sure!</p>
<p>But I don’t think that “code that explicitly interfaces with the keyboard” is the obvious winner. What was stopping me from adding something malicious to <a href="https://eieio.games/blog/flappy-bird-in-macos-finder/">flappy bird in Finder</a> or my <a href="https://eieio.games/blog/breaktime/">chrome extension that ran Brick Breaker in Google Calendar</a>?</p>
<p>I mean the real answer is “I’m not looking to write malicious software.” But setting that aside, I guess it’s “the programs are open source and someone could have read the code.”</p>
<p>But ultimately those were programs that I put on the internet and let strangers run. They could do anything!</p>
<h3 id="toc:this-code-talks-to-a-server">This code talks to a server</h3>
<p>I am more sympathetic to this point. My code talks to a server, so that server is also a target. If it was compromised, someone could attempt to send malicious data to users of my program.</p>
<p>I tried to handle this by making my protocol dead-simple. The server sends the string “1” or “0” back to clients and nothing else. Clients check for <em>exactly</em> that string in the messages they receive, and drop all other input without logging what it was.</p>
<pre><code><span>data <span>=</span> <span>await</span> get_latest_message<span>(</span>websocket<span>)</span>
</span><span><span>if</span> data <span>==</span> <span>&#34;1&#34;</span> <span>and</span> current_state <span>==</span> <span>False</span><span>:</span>
</span><span>    set_capslock_state<span>(</span><span>True</span><span>)</span>
</span><span>    current_state <span>=</span> <span>True</span>
</span><span>    last_state <span>=</span> <span>True</span>
</span><span><span>elif</span> data <span>==</span> <span>&#34;0&#34;</span> <span>and</span> current_state <span>==</span> <span>True</span><span>:</span>
</span><span>    set_capslock_state<span>(</span><span>False</span><span>)</span>
</span><span>    current_state <span>=</span> <span>False</span>
</span><span>    last_state <span>=</span> <span>False</span>
</span><span><span>elif</span> data <span>==</span> <span>&#34;0&#34;</span> <span>or</span> data <span>==</span> <span>&#34;1&#34;</span><span>:</span>
</span><span>    
</span><span>    <span>pass</span>
</span><span><span>elif</span> data <span>is</span> <span>None</span><span>:</span>
</span><span>    
</span><span>    <span>pass</span>
</span><span><span>else</span><span>:</span>
</span><span>    <span>print</span><span>(</span><span><span>f&#34;ignoring invalid data...&#34;</span></span><span>)</span>
</span></code></pre>
<p>There’s no parsing beyond whatever the python <code>websocket</code> library does to give me a string, and I pass a hardcoded value to <code>set_capslock_state</code> instead of passing in the message from the server.</p>
<p>So I think that helps. But I still take the point here. There is an additional target here.</p>
<p>That said, and I apologize that I keep repeating this point but I think it bears repeating:</p>
<p><strong>Any script whose source you have not read could also be talking to a server, and it could be doing something really dumb</strong></p>
<h3 id="toc:this-code-passes-input-from-a-server-directly-to-a-tool-that-controls-my-keyboard">This code passes input from a server directly to a tool that controls my keyboard</h3>
<p>So I don’t think that this is actually true. My <code>set_capslock_state</code> function takes in a boolean and then runs a hardcoded command based on that boolean.</p>
<p>But I understand how, if you haven’t looked at the source of my script, you might believe this.</p>
<h2 id="toc:concluding">Concluding</h2>
<p>I could keep going. And I am not sure that I am fully on my own side here: I am sympathetic to why this project triggered alarm bells for some people.</p>
<p>But those comments triggered the same reaction that I have when I see complaints about installing something with <code>curl website.com/install | bash -x</code> or whatever.</p>
<p>Yes, it’s possible that the script is malicious. Yes, you can even make your server detect the <code>curl $site | bash</code> pattern and serve a different script in that case.</p>
<p>But if you don’t read the code before you run it, it doesn’t really matter.</p></article></div>
  </body>
</html>
