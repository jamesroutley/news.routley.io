<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://notebook.kulchenko.com/programming/lua-good-different-bad-and-ugly-parts">Original</a>
    <h1>Lua: Good, Bad, and Ugly Parts (2012)</h1>
    
    <div id="readability-page-1" class="page"><div id="alpha">
                        <div id="alpha-inner">


                            <div id="entry-125">
                                
                                <div>

                                    <div>
                                        <p>I have been programming in Lua for about 9 months and it seemed like a good time to pause and reflect on my experience with it. I have used various languages over the years -- Perl (<a href="http://soaplite.com/">soaplite.com</a> and other projects, including my current consulting work), C (<a href="http://notebook.kulchenko.com/dhcplite/dhcp-server-with-arduino-v012">a <span>DHCP</span>/DNS server for Arduino</a> and <a href="http://notebook.kulchenko.com/juggling/robot-juggles-two-ping-pong-balls">a ping-pong juggling robot</a>), JavaScript (<a href="http://notebook.kulchenko.com/maps/google-maps-using-multiple-api-versions">experiments with Google Maps and canvas</a>), <span>MATLAB </span>(<a href="http://notebook.kulchenko.com/juggling/robot-juggles-two-ping-pong-balls">ping-pong juggling robot</a>), and others, from Turbo Pascal to F# -- and it was interesting to see how Lua compares to the other languages I&#39;ve worked with. I have done different types of projects in Lua: a remote debugger (<a href="https://github.com/pkulchenko/MobDebug">MobDebug</a>), extending a Lua <span>IDE </span>(<a href="http://studio.zerobrane.com/">ZeroBrane Studio</a>), a mobile app (<a href="https://github.com/pkulchenko/LuaRemote">LuaRemote</a>), several educational scripts (<a href="https://github.com/pkulchenko/ZeroBraneEduPack">EduPack</a>), and a demo of <a href="http://notebook.kulchenko.com/programming/drawing-on-browser-canvas-with-lua">drawing on browser canvas with Lua</a>.</p>

<p>I have come across several detailed lists that mention good and not-so-good parts of Lua (for example, <a href="http://lua-users.org/lists/lua-l/2007-11/msg00248.html">Lua benefits</a>, <a href="http://blog.datamules.com/blog/2012/01/30/why-lua/">why Lua</a>, <a href="http://lua-users.org/lists/lua-l/2012-01/msg00731.html">why Lua is not more widely used</a>, <a href="http://stackoverflow.com/questions/564665/advantages-of-lua">advantages of Lua</a>, <a href="http://gergely.imreh.net/blog/2011/07/language-of-the-month-lua-part-2/">Lua good/bad</a>, <a href="http://stackoverflow.com/questions/1022560/subtle-differences-between-javascript-and-lua">Lua vs. JavaScript</a>, and <a href="http://www.luafaq.org/gotchas.html">Lua Gotchas</a>), but I found that some of the features that tripped me or that I cared about were not listed, so I put together my own list. It is far from being comprehensive and some aspects of the language are not covered (for example, math and string libraries), but it captures the gist of my experience with the language.</p>
                                    </div>


                                    <div id="more">
                                        <h2>Good</h2>


<ul>
<li>Small: <a href="http://www.lua.org/about.html">20000 lines of C code</a> that can be built into a 182K executable interpreter (under Linux).</li>
<li>Portable: builds on any platform with an <span>ANSI</span> C compiler. You can see it running on almost anything from <a href="http://www.eluaproject.net/">microcontrollers</a> and <a href="http://hempeldesigngroup.com/lego/pblua/">Lego Minstorms <span>NXT</span></a>, to <a href="http://stackoverflow.com/a/5204415/1442917">game engines</a>, to <a href="http://stackoverflow.com/a/11789271/1442917">mobile toolkits</a>, to <a href="http://blog.brokenfunction.com/2011/11/how-to-make-a-massively-cross-platform-game/">game consoles</a>, to a <a href="http://notebook.kulchenko.com/programming/drawing-on-browser-canvas-with-lua">browser</a> (translated to JavaScript).</li>
<li><a href="http://www.lua.org/pil/24.html">Embedded and extensible language</a> that provides a straightforward interface to/from C/C++.</li>
<li>Sufficiently fast: <a href="http://benchmarksgame.alioth.debian.org/">performs well comparing to other languages</a> and has a <a href="http://luajit.org/performance.html"><span>JIT </span>compiler</a> that noticeably improves performance on many tasks; those who may still be not satisfied with the performance, can implement critical parts in C and, given the ease of integration with C, still benefit from other good aspects. <strong>[Updated 3/9/2013]</strong> replaced shootout results that are no longer available with <a href="http://benchmarksgame.alioth.debian.org/">benchmarksgame</a>.</li>
<li>Well documented: <a href="http://www.lua.org/manual/">reference manual</a>, <a href="http://lua.org/pil/">book</a>, <a href="http://lua-users.org/wiki/">wiki</a>, <a href="http://www.capgo.com/Resources/SoftwareDev/LuaShortRef51.pdf">6-page short reference</a> and more.</li>
<li>Friendly and enthusiastic <a href="http://lua-users.org/">community</a>. Between the excellent documentation, the wiki, the <a href="http://www.lua.org/lua-l.html">mailing list</a>, and <a href="http://stackoverflow.com/questions/tagged/lua">StackOverflow</a>, I didn&#39;t have any issues finding answers to my questions.</li>
<li>Clean and simple syntax suitable for beginners and accessible to non-programmers. Lua has borrowed most of its control syntax from <a href="http://en.wikipedia.org/wiki/Modula">Modula</a>, the descendent of <a href="http://en.wikipedia.org/wiki/Pascal_%28programming_language%29">Pascal</a>, which was widely used in education as an introductory language. I still remember using early versions of Philippe Kahn&#39;s fast and elegant <a href="http://en.wikipedia.org/wiki/Turbo_Pascal">Turbo Pascal</a> <span>IDE.</span></li>
<li>Integrated interpreter: just run <code>lua</code> from the command line.</li>
<li>Native support for <a href="http://www.lua.org/pil/9.html">coroutines</a> to implement <a href="http://www.lua.org/pil/9.3.html">iterators</a> and <a href="http://www.lua.org/pil/9.4.html">non-preemptive multi-threading</a>.</li>
<li>Incremental <a href="http://www.lua.org/manual/5.1/manual.html#2.10">garbage collector</a> that has low latency, no additional memory cost, little implementation complexity, and support for <a href="http://www.lua.org/pil/17.html">weak tables</a>.</li>
<li>Powerful heterogeneous <a href="http://www.lua.org/pil/2.5.html">tables</a> that store values of any type (except <code>nil</code>) and can be indexed by values of any type (except <code>nil</code>): <code>{1, 2, 5, foo = &#34;bar&#34;, [func] = &#34;something&#34;, [&#34;some spaces&#34;] = value()}</code>.</li>
<li>Lexical scoping.</li>
<li><a href="http://www.lua.org/pil/6.html">Functional programming</a> with <a href="http://www.lua.org/pil/5.html">first class functions</a> and <a href="http://www.lua.org/pil/6.1.html">closures</a>.</li>
<li><a href="http://www.lua.org/pil/6.3.html">Tail calls</a>: <code>return functioncall()</code>.</li>
<li>Recursive functions don&#39;t need to be pre-declared: <code>local function foo() ... foo() ... end</code>; note this doesn&#39;t work with <code>local foo = function() ... foo() ... end</code>.</li>
<li>Functions return <a href="http://www.lua.org/pil/5.1.html">multiple values</a>: <code>return 1, 2, 3</code>. The caller can expect any number of values returned: if less than three is expected, the rest is discarded and if more than three is expected, the rest is <code>nil</code>-initialized.</li>
<li>Functions allow variable number of parameters with <code>function foo(...) local args = {...}; bar(param, ...) end</code>.</li>
<li>Tables can be &#34;unpacked&#34; into a list of parameters with <code>unpack</code> (or <code>table.unpack</code> in Lua 5.2): <code>print(unpack({1, 2, 3}))</code> prints <code>1 2 3</code>.</li>
<li>Manipulating environments (<code>getfenv</code> and <code>setfenv</code> in Lua 5.1 and <code>_ENV</code> manipulation in Lua 5.2), which allows building <a href="http://lua-users.org/wiki/SandBoxes">sandboxes</a> among other things.</li>
<li>Assignment to a list of variables: <code>local a, b, c = 1, 2</code>, <code>x, y = y, x</code>, or <code>a, b = foo()</code>.</li>
<li>Multiline strings (using <code>[[...]]</code>; can be enclosed with <code>[[...[=[...]=]...]]</code>) and comments (<code>--[[...]]</code>).</li>
<li>Semicolon as a statement separator is optional (mostly used to resolve ambiguous cases as in <code>a = f; (g).x(a)</code>).</li>
<li>Overloading using <a href="http://www.lua.org/manual/5.1/manual.html#2.8">metatables</a>.</li>
<li><a href="http://metalua.luaforge.net/">Metaprogramming</a> to do things from getting and modifying an abstract syntax tree to creating a new syntax for your <a href="http://en.wikipedia.org/wiki/Domain-specific_language"><span>DSL</span></a>.</li>
<li>The <code>for</code> statement has two forms: <a href="http://www.lua.org/pil/4.3.5.html">generic</a> (loops over iterators: <code>for a in iter() do ... end</code>) and <a href="http://www.lua.org/pil/4.3.4.html">numeric</a> (loops over numbers: <code>for a = 1, 5, 0.1 do ... end</code>); the numeric one supports all numeric values for steps (not just integers).</li>
<li>Syntactic sugar for function calls (<code>f&#39;string&#39;</code>, <code>f&#34;string&#34;</code>, <code>f[[string]]</code>, and <code>f{table}</code>) and method calls (<code>obj:m()</code>).</li>
<li>Simple yet powerful <a href="http://www.lua.org/pil/23.html">debug</a> library.</li>
<li><a href="http://luajit.org/performance.html">Fast</a> and powerful <span>JIT </span>compiler/interpreter (<a href="http://luajit.org/">LuaJIT</a>) which includes <a href="http://luajit.org/ext_ffi_semantics.html"><span>FFI </span>library</a> and is <span>ABI</span>-compatible with Lua 5.1 (this means that it can load binary modules compiled for Lua 5.1).</li>
</ul>



<h2>Different</h2>


<ul>
<li>Tables and strings are indexed from 1 rather than 0.</li>
<li>Assigning <code>nil</code> as a value removes the element from a table. This is consistent with returning <code>nil</code> for non-existing element, so it makes no difference whether the element does not exist or exists with a value of <code>nil</code>. <code>a = {b = nil}</code> produces an empty table.</li>
<li>No integers as a separate numeric type; <a href="http://www.lua.org/pil/2.3.html">the number type</a> represent real numbers. The next version of Lua (5.3) may <a href="http://lua-users.org/lists/lua-l/2013-07/msg00167.html">change that</a>.</li>
<li>No classes; <a href="http://www.lua.org/pil/16.html">object-orientation</a> is implemented using <a href="http://www.lua.org/pil/2.5.html">tables</a> and <a href="http://www.lua.org/pil/2.6.html">functions</a>; inheritance is implemented using the <a href="http://www.lua.org/manual/5.1/manual.html#2.8">metatable</a> mechanism.</li>
<li>Method calls are implemented using <code>object:method(args)</code> notation, which is the same as <code>object.method(object, args)</code> notation, but with <code>object</code> evaluated only once.</li>
<li><code>nil</code> and <code>false</code> are the only false values; 0, 0.0, &#34;0&#34; and all other values evaluate as <code>true</code>.</li>
<li>Non-equality operator is ~= (for example, <code>if a ~= 1 then ... end</code>).</li>
<li><code>not, or, and</code> keywords used for logical operators.</li>
<li><a href="http://www.lua.org/pil/4.1.html">Assignments are statements</a>, which means there is no <code>a=b=1</code> or <code>if (a=1) then ... end</code>.</li>
<li>No <code>a+=1</code>, <code>a++</code>, or similar shorthand forms.</li>
<li>No <code>continue</code> statement, although there is an <a href="http://www.luafaq.org/#T1.26">explanation</a> and a number of alternatives, like using <code>repeat break until true</code> inside the loop to break out of or a <code>goto</code> statement introduced in Lua 5.2.</li>
<li>No <code>switch</code> statement.</li>
<li>Brackets may be required in some contexts; for example, <code>a = {}; a.field</code> works, but <code>{}.field</code> doesn&#39;t; the latter needs to be specified as <code>({}).field</code>.</li>
<li>A control variable in a loop is localized by default and is not available after the loop.</li>
<li>Limit and step values in the numeric <code>for</code> loop are <a href="http://www.lua.org/pil/4.3.4.html">cached</a>; this means that in <code>for i = init(), limit(), step() do ... end</code> all three functions <code>init</code>, <code>limit</code>, and <code>step</code> are called once before the loop is executed.</li>
<li><a href="http://www.lua.org/pil/4.3.1.html">Conditionals</a> and other control structures require no brackets.</li>
<li>Strings and numbers are automatically converted (if string is used where a number is expected and vice versa), but not in equality/inequality comparisons: <code>0 == &#34;0&#34;</code> is <code>false</code>, <code>{} ~= 1</code> is <code>true</code>, and <code>foo[&#34;0&#34;]</code> and <code>foo[0]</code> refer to two different keys in the table; other relational operators generate errors on comparing values of different types.</li>
<li>Both commas and <a href="http://www.lua.org/pil/3.6.html">semicolons</a> can be used in table literals; both can be placed before the closing curly bracket as an <a href="http://www.lua.org/pil/3.6.html">optional separator</a>: <code>a = {a = 1, b = 2, }</code>.</li>
<li>Smaller than expected number of components that are available &#34;out of the box&#34;; some people see this as &#34;batteries not included&#34;. This is the other side of having a compact and portable core and is well compensated by having <a href="http://luarocks.org/">LuaRocks</a> and libraries like <a href="http://stevedonovan.github.com/Penlight/">Penlight</a>.</li>
</ul>



<h2>Bad</h2>


<ul>
<li>Limited <a href="http://www.lua.org/pil/8.4.html">error handling support</a> (using <a href="http://www.lua.org/manual/5.1/manual.html#pdf-pcall">pcall</a> and <a href="http://www.lua.org/manual/5.1/manual.html#pdf-xpcall">xpcall</a>), although some may <a href="http://lua-users.org/lists/lua-l/2010-09/msg00364.html">argue that it is sufficient</a> and just needs some syntactic sugar and more feature support (like deterministic finalizers). The combination of <code>pcall</code> and <code>error</code> is quite powerful, especially given that <code>error</code> can return anything (for example, a table) rather than just a string, but having <code>catch ... finally</code> constructs may be cleaner and simpler to read in many cases.</li>
<li>Global scoping by default (this has been <a href="http://lua-users.org/lists/lua-l/2010-02/msg00753.html">partially addressed in Lua 5.2</a>, which has no globals). There is a <a href="http://metalua.luaforge.net/src/lib/strict.lua.html">strict</a> module that requires all global variables to be initialized. I have not had many issues caused by uninitialized globals, but still put this one into the &#34;bad&#34; category as I once made a mistake of calling a variable &#34;next&#34; and not localizing it, which <a href="https://github.com/pkulchenko/ZeroBraneStudio/commit/867de8f3e46ea0ff868a9ae78c632a03fdf7747c">caused an issue</a> with an iterator in a completely different module as it overwrote the <a href="http://www.lua.org/pil/7.3.html">next</a> function used with iterators.</li>
<li>No <a href="http://lua-users.org/wiki/LuaUnicode">Unicode support</a> (at the very least you don&#39;t get <code>string.len</code> and pattern matching functions to recognize Unicode characters); there is a <a href="https://github.com/duncanc/icu4lua">binding</a> to <a href="http://en.wikipedia.org/wiki/International_Components_for_Unicode"><span>ICU</span></a> library that implements full Unicode support. See also this <a href="http://lua-users.org/lists/lua-l/2012-02/msg00241.html">message</a> and follow-ups for a good summary of what is already supported and what modifications may be required for <code>string.*</code> functions.</li>
<li>Limited <a href="http://www.lua.org/pil/20.1.html">pattern-matching support</a>, although the included one is still quite powerful. After using Perl for over 15 years, I miss some of the regexp features (mostly look-aheads, optional groups <code>(group )?</code>, and groups inside groups), but nothing that warrants the additional complexity in the implementation. Those who need more power in their regexps can use <a href="http://www.inf.puc-rio.br/~roberto/lpeg/lpeg.html">LPeg</a> and its <a href="http://www.inf.puc-rio.br/~roberto/lpeg/re.html">re</a> module.</li>
<li>No ternary operator; <a href="http://lua-users.org/wiki/TernaryOperator">several alternatives are available</a>. I usually end up using <code>foo = test and value1 or value2</code> form with the caveat that <code>value2</code> can be assigned if both <code>test</code> and <code>value1</code> end up being <code>false</code>.</li>
<li>No <span>POSIX </span>functions built-in. There is the <a href="https://github.com/rrthomas/luaposix">luaposix</a> module, but it requires compilation, which is not always an option. I didn&#39;t miss this much, but I did come across a case where I needed to get/set an environment variable, and having access to <code>getenv</code> and <code>setenv</code> would be convenient <strong>[Updated 6/1/2012]</strong> As miko noted in the comments, there is <a href="http://www.lua.org/manual/5.1/manual.html#pdf-os.getenv">os.getenv</a>, but no corresponding <code>os.setenv</code>.</li>
<li>No class/object finalizers. Lua provides finalizer functionality through the  <a href="http://www.lua.org/pil/29.html">__gc metamethod</a>, but it is available only for userdata types (and not tables) and doesn&#39;t match the functionality provided by other languages, for example, <a href="http://perldoc.perl.org/perltoot.html#Destructors"><span>DESTROY</span></a> and <a href="http://perldoc.perl.org/perltoot.html#Class-Destructors"><span>END</span></a> methods in Perl. <strong>[Updated 05/27/2012]</strong> There is an undocumented <a href="http://lua-users.org/wiki/HiddenFeatures">newproxy</a> feature in Lua 5.1 that allows implementation of finalizers on tables; Lua 5.2 removed that feature as it added support for <a href="http://www.luafaq.org/#T8.1.6">__gc metamethod on tables</a>.</li>
<li>No yielding between Lua and C code: <code>coroutine.yield</code> call across Lua/C boundary fails with <code>attempt to yield across metamethod/C-call boundary</code>. I happened to come across this error several times as I was doing async programming with <a href="http://w3.impa.br/~diego/software/luasocket/">luasocket</a> and coroutines, but solved it using the <a href="http://keplerproject.github.com/copas/">copas</a> module. This has been addressed in Lua 5.2.</li>
<li>No built-in bit operations in Lua 5.1. This is addressed in LuaJIT (<a href="http://bitop.luajit.org/">BitOp</a>) and Lua 5.2 (bit32), which both include bit libraries.</li>
</ul>



<h2>Ugly</h2>

<ul>
<li>Number of elements in a table is not easy to get and the result depends on how you do this (or what you mean by &#34;length&#34;). This is probably not surprising, given how powerful tables are in Lua and the fact that they support flexible indexing (by numbers and any other Lua type except <code>nil</code>). Tables in Lua have two parts: an &#34;array/vector&#34; part (generated with <code>t = {1, 2, 3}</code>) and a &#34;hash&#34; part (generated with <code>t = {a = &#34;foo&#34;, [&#34;b&#34;] = 2}</code>); the two can be flexibly combined. <code>#table</code> returns the length of the shortest &#34;array/vector&#34; part (without any gaps) and <code>table.maxn(t)</code> returns the longest &#34;array/vector&#34; part (this function is removed in Lua 5.2). The &#34;hash&#34; part doesn&#39;t have a defined length. Both parts can be iterated over using the <code>pairs</code> method, which allows you to count the number of elements in them. However, <code>print(#{1, 2, nil, 3})</code> prints 4 and not 2 as one may expect, whereas <code>print(#{1, 2, nil, 3, nil})</code> prints 2. I&#39;m sure there is a good reasonable explanation for this, but for now it is in the &#34;ugly&#34; bucket.

<strong>[Updated 11/17/2012]</strong> As FireFly noted in the comments, in Lua 5.2 the length operator is <a href="http://www.lua.org/manual/5.2/manual.html#3.4.6">only defined</a> for tables that don&#39;t have holes in them.</li>
<li><code>return</code> statement can&#39;t be used if it&#39;s not the last statement in a block; in other words, <code>function foo() print(1); return; print(2) end</code> will trigger an error <code>&#39;end&#39; expected...</code> or <code>unexpected symbol near &lt;whatever statement you have after &#39;return&#39;&gt;</code> (depending on whether you have semicolon after <code>return</code> or not). Not that anyone would want use this for anything other than debugging, but I got bitten by it couple of times. I would have put this in the &#34;different&#34; category, but I find it inconsistent that I can&#39;t use <code>return</code>, but can use <code>do return end</code> in exactly the same place.

<strong>[Updated 5/19/2012]</strong> This also applies to <code>break</code> statement, although in Lua 5.2 <code>break</code> is <a href="http://lua-list.2524044.n2.nabble.com/patch-to-goto-optional-semicolon-changing-opcodes-td7566529.html">no longer required to be the last statement in a block</a>.</li>
<li>Only one value is returned from a function if it&#39;s not the last one in a list; for example:

<pre><code>  function f123() return 1, 2, 3 end
  function f456() return 4, 5, 6 end
  print(f123(), f456()) -- prints 1, 4, 5, 6
  print(f456(), f123()) -- prints 4, 1, 2, 3</code></pre>

The related behavior of <code>return</code> is also affected by this rule: <code>return f456()</code> returns three values, but <code>return (f456())</code> returns only one value (note the extra pair of parentheses). This matches the overall simplicity of the language and is <a href="http://www.lua.org/pil/5.1.html">well documented</a>, but I still find it to be a bit ugly (although ugliness as beauty is in the eye of the beholder).</li>
</ul>

<p>Overall, I have so far enjoyed the simplicity and consistency of the language, although there are few things I wish were done a bit differently. My eight-year-old son also picked Lua syntax quickly, which reminded me a lot about my experience with Turbo Pascal decades ago.</p>
                                    </div>


<div><p>You should <strong>get a copy</strong> of my slick <a href="http://studio.zerobrane.com/">ZeroBrane Studio IDE</a> and <strong>follow me on twitter</strong> <a href="https://twitter.com/zerobrane">here</a>.</p></div>

                                </div>
                                
                            </div>










                    
                    

                        </div>
                    </div></div>
  </body>
</html>
