<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/puma/puma/blob/master/6.0-Upgrade.md">Original</a>
    <h1>Welcome to Puma 6: Sunflower</h1>
    
    <div id="readability-page-1" class="page"><div>

    <div data-target="readme-toc.content">
      
  


        <div id="readme">
    <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/845662/192706685-774d3d0d-f4a9-4b93-b27b-5a3b7f44ff31.jpg"><img src="https://user-images.githubusercontent.com/845662/192706685-774d3d0d-f4a9-4b93-b27b-5a3b7f44ff31.jpg" alt="Image by Todd Trapani, Unsplash"/></a></p>
<p dir="auto">Puma 6 brings performance improvements for most applications, experimental Rack 3 support, support for Sidekiq 7 Capsules, and more.</p>
<p dir="auto">Here&#39;s what you should do:</p>
<ol dir="auto">
<li>Review the Upgrade section below to look for breaking changes that could affect you.</li>
<li>Upgrade to version 6.0 in your Gemfile and deploy.</li>
<li>Open up a new bug issue if you find any problems.</li>
<li>Join us in building Puma! We welcome first-timers. See <a href="https://github.com/puma/puma/blob/master/CONTRIBUTING.md">CONTRIBUTING.md</a>.</li>
</ol>
<p dir="auto">For a complete list of changes, see <a href="https://github.com/puma/puma/blob/master/History.md">History.md</a>.</p>
<h2 dir="auto"><a id="user-content-whats-new" aria-hidden="true" href="#whats-new"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>What&#39;s New</h2>
<p dir="auto">Puma 6 is mostly about a few nice-to-have performance changes, and then a few breaking API changes we&#39;ve been putting off for a while.</p>
<h3 dir="auto"><a id="user-content-improved-performance" aria-hidden="true" href="#improved-performance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Improved Performance</h3>
<p dir="auto">We&#39;ve improved throughput and latency in Puma 6 in a few areas.</p>
<ol dir="auto">
<li><strong>Large chunked response body throughput 3-10x higher</strong> Chunked response bodies &gt;100kb should be 3 to 10 times faster than in Puma 5. String response bodies should be ~10% faster.</li>
<li><strong>File response throughput is 3x higher.</strong> File responses (e.g. assets) should be about 3x faster.</li>
<li><strong>wait_for_less_busy_worker is now default, meaning lower latencies for high-utilization servers</strong> <code>wait_for_less_busy_worker</code> was an experimental feature in Puma 5 and it&#39;s now the default in Puma 6. This feature makes each Puma child worker in cluster mode wait before listening on the socket, and that wait time is proportional to N * <code>number_of_threads_responding_to_requests</code>. This means that it&#39;s more likely that a request is picked up by the least-loaded Puma child worker listening on the socket. Many users reported back that this option was stable and decreased average latency, particularly in environments with high load and utilization.</li>
</ol>
<h3 dir="auto"><a id="user-content-experimental-rack-3-support" aria-hidden="true" href="#experimental-rack-3-support"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Experimental Rack 3 Support</h3>
<p dir="auto"><a href="https://github.com/rack/rack/blob/main/UPGRADE-GUIDE.md">Rack 3 is now out</a> and we&#39;ve started on Rack 3 support. Please open a bug if you find any incompatibilites.</p>
<h3 dir="auto"><a id="user-content-sidekiq-7-capsules" aria-hidden="true" href="#sidekiq-7-capsules"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Sidekiq 7 Capsules</h3>
<p dir="auto">Sidekiq 7 (releasing soon) introduces Capsules, which allows you to run a Sidekiq server inside your Puma server (or any other Ruby process for that matter). We&#39;ve added support by allowing you to pass data into <code>run_hooks</code>, see <a href="https://github.com/puma/puma/issues/2915" data-hovercard-type="issue" data-hovercard-url="/puma/puma/issues/2915/hovercard">issue #2915</a>.</p>
<h2 dir="auto"><a id="user-content-upgrade" aria-hidden="true" href="#upgrade"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Upgrade</h2>
<p dir="auto">Check the following list to see if you&#39;re depending on any of these behaviors:</p>
<ol dir="auto">
<li>Configuration constants like <code>DefaultRackup</code> removed, see <a href="https://github.com/puma/puma/pull/2928/files#diff-2dc4e3e83be7fd97cebc482ae07d6a8216944003de82458783fb00b5ae9524c8">#2928</a> for the full list.</li>
<li>We have changed the names of the following environment variables: <code>DISABLE_SSL</code> is now <code>PUMA_DISABLE_SSL</code>, <code>MAKE_WARNINGS_INTO_ERRORS</code> is now <code>PUMA_MAKE_WARNINGS_INTO_ERRORS</code>, and <code>WAIT_FOR_LESS_BUSY_WORKERS</code> is now <code>PUMA_WAIT_FOR_LESS_BUSY_WORKERS</code>.</li>
<li>Nakayoshi GC (<code>nakayoshi_fork</code> option in config) has been removed without replacement.</li>
<li><code>wait_for_less_busy_worker</code> is now on by default. If you don&#39;t want to use this feature, you must add <code>wait_for_less_busy_worker false</code> in your config.</li>
<li>We&#39;ve removed the following public methods on Puma::Server: <code>Puma::Server#min_threads</code>, <code>Puma::Server#max_threads</code>. Instead, you can pass in configuration as an option to Puma::Server#new. This might make certain gems break (<code>capybara</code> for example).</li>
<li>We&#39;ve removed the following constants: <code>Puma::StateFile::FIELDS</code>, <code>Puma::CLI::KEYS_NOT_TO_PERSIST_IN_STATE</code> and <code>Puma::Launcher::KEYS_NOT_TO_PERSIST_IN_STATE</code>, and <code>Puma::ControlCLI::COMMANDS</code>.</li>
<li>We no longer support Ruby 2.2, 2.3, or JRuby on Java 1.7 or below.</li>
<li>The behavior of <code>remote_addr</code> has changed. When using the set_remote_address header: &#34;header_name&#34; functionality, if the header is not passed, REMOTE_ADDR is now set to the physical peeraddr instead of always being set to 127.0.0.1. When an error occurs preventing the physical peeraddr from being fetched, REMOTE_ADDR is now set to the unspecified source address (&#39;0.0.0.0&#39;) instead of to &#39;127.0.0.1&#39;</li>
</ol>
<p dir="auto">Then, update your Gemfile:</p>
<p dir="auto"><code>gem &#39;puma&#39;, &#39;&lt; 7&#39;</code></p>
</article>
  </div>

    </div>

  </div></div>
  </body>
</html>
