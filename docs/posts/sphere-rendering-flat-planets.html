<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://emildziewanowski.com/flat-planets/">Original</a>
    <h1>Sphere Rendering: Flat Planets</h1>
    
    <div id="readability-page-1" class="page"><div data-simplebar="">
            <div>
                                    <article>
                        <div>
                            
                            
<p>I often envy those who can accurately estimate the time their tasks will take, particularly the seemingly small ones. Experience has taught me that it’s these ‘simple’ tasks that are often the most deceptive. What appears to be a 15-minute fix can unexpectedly turn into a bizarre edge case, transforming a supposed one-line code change into a day-long hunt for answers on the Wayback Machine. And yet, even with all that experience, the task that led me down the deepest rabbit hole, surprisingly, was texturing a sphere.</p>







<h2>Skybox</h2>



<p>Sky can serve as an excellent narrative device. Movie directors and game developers understand this well, often using it for exposition. What better way to convey the sense of being on a far-off planet than by presenting an alien sky, complete with unfamiliar-looking moons and planets hanging over the horizon?</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/01\/AlienSkies.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-200&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Sky in games and movies&#34;,&#34;alt&#34;:&#34;Sky in games and movies&#34;}" data-wp-interactive="core/image"><img fetchpriority="high" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/01/AlienSkies-1024x576.jpg" alt="Sky in games and movies" srcset="https://emildziewanowski.com/wp-content/uploads/2024/01/AlienSkies-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/01/AlienSkies-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/01/AlienSkies-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/01/AlienSkies-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/01/AlienSkies-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>I’m taking a similar approach in my project. The skybox I’m working on will feature an animated moon and a gas giant, adding some extra visual flair.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/SkyboxConcept.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-381&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1400,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Skybox concepts&#34;,&#34;alt&#34;:&#34;Skybox concepts&#34;}" data-wp-interactive="core/image"><img decoding="async" width="1024" height="560" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/SkyboxConcept-1024x560.jpg" alt="Skybox concepts" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/SkyboxConcept-1024x560.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/SkyboxConcept-300x164.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/SkyboxConcept-768x420.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/SkyboxConcept-1536x840.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/SkyboxConcept-2048x1120.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Both planets will spin, and in addition, the gas giant will feature moving atmospheric currents. Normally, these motions are too subtle to be seen, but I’ll accelerate them for greater visual impact. As for the artistic direction, I’m going for a semi-realistic style, inspired by the sci-fi art of the ’70s and ’80s.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/70SciFiArt.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-233&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Style inspiration&#34;,&#34;alt&#34;:&#34;Style inspiration&#34;}" data-wp-interactive="core/image"><img decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/70SciFiArt-1024x576.jpg" alt="Style inspiration" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/70SciFiArt-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/70SciFiArt-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/70SciFiArt-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/70SciFiArt-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/70SciFiArt-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h2>Planet’s Surface</h2>



<p>While the gas giant’s surface texture will be generated in realtime using a pixel shader and a render-to-texture approach, moon texture will be created using Substance Designer. This allows for experimenting with various looks by simply changing the color palette and material seed.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/SubstanceWorkflow.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-252&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Substance Designer generated planets&#34;,&#34;alt&#34;:&#34;Substance Designer generated planets&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/SubstanceWorkflow-1024x576.jpg" alt="Substance Designer generated planets" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/SubstanceWorkflow-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/SubstanceWorkflow-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/SubstanceWorkflow-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/SubstanceWorkflow-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/SubstanceWorkflow-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Animated gas giant, while visually captivating, presents its own set of challenges. Rendering texture for each frame will impact performance, with the rendering cost quadrupling if the texture resolution is doubled.</p>







<p>I want one solution that works consistently, regardless of whether the input is a static texture created in Substance Designer or dynamically rendered in Unreal as described in <a href="https://emildziewanowski.com/flowfields/" data-type="post" data-id="119">Flowfields.</a></p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/GasGiantvsMoonTex-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-750&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Generated vs static textures&#34;,&#34;alt&#34;:&#34;Generated vs static textures&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/GasGiantvsMoonTex-1-1024x576.jpg" alt="Generated vs static textures" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/GasGiantvsMoonTex-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/GasGiantvsMoonTex-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/GasGiantvsMoonTex-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/GasGiantvsMoonTex-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/GasGiantvsMoonTex-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>This leaves 2 options for storing the planet surface – a square or rectangular texture. Although a cubemap was considered initially, its potential performance impact – consuming six times the resources of its square texture counterpart – makes it completely impractical. Furthermore, Substance Designer doesn’t support cubemap generation.</p>



<h2>UV Sphere Problems</h2>



<p>With texture choices narrowed down to square or rectangle, the next step is mapping them onto a sphere. The UV sphere is an obvious choice here, as it is easy to align its texture coordinates with the a 2×1 rectangular texture.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/UVSphere.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-640&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: UV sphere texture layout&#34;,&#34;alt&#34;:&#34;UV sphere texture layout&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/UVSphere-1024x576.jpg" alt="UV sphere texture layout" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/UVSphere-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/UVSphere-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/UVSphere-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/UVSphere-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/UVSphere-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p> Given that only one side of the sphere is visible at a time, there is no need to use a full, unique rectangular texture,  a tiling square one can be used instead.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/RectangularVsSquare.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-262&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Square vs Rectangular Texture&#34;,&#34;alt&#34;:&#34;Square vs Rectangular Texture&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/RectangularVsSquare-1024x576.jpg" alt="Square vs Rectangular Texture" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/RectangularVsSquare-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/RectangularVsSquare-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/RectangularVsSquare-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/RectangularVsSquare-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/RectangularVsSquare-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h3>Jagged Edges</h3>



<p>Using UV sphere might be the easiest option, but unfortunately in this case is not the best one. Firstly the outline is visibly angular – it doesn’t have to be a perfect circle, but at least should be smooth.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/JaggedEdges.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-264&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Polycount an jagged edges&#34;,&#34;alt&#34;:&#34;Polycount an jagged edges&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/JaggedEdges-1024x576.jpg" alt="Polycount an jagged edges" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/JaggedEdges-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/JaggedEdges-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/JaggedEdges-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/JaggedEdges-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/JaggedEdges-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>When triangle count is not an issue this problem can be solved by using a sphere with more subdivisions. Alternatively the edge can be masked using pixel shader.</p>



<h2>Texture Usage</h2>



<p>Most of the sphere’s surface is viewed at an angle, leading to sampling from lower mipmaps. This is particularly problematic for dynamic textures, where each pixel is rendered per frame. Most of the generated image gets wasted on areas where it is barely visible.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/InefficientTextureUsage-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-269&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Poor texture usage&#34;,&#34;alt&#34;:&#34;Poor texture usage&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/InefficientTextureUsage-1-1024x576.jpg" alt="Poor texture usage" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/InefficientTextureUsage-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/InefficientTextureUsage-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/InefficientTextureUsage-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/InefficientTextureUsage-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/InefficientTextureUsage-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p> While increasing tiling can mitigate this issue, it introduces another problem.</p>



<h3>Seams</h3>



<p>To maintain a continuous pattern across the whole sphere, the tiling can only be increased in whole numbers. However, even doubling the initial tiling makes the repetition noticeable. </p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/VisibleSeam-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-280&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Seam and tiling&#34;,&#34;alt&#34;:&#34;Seam and tiling&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/VisibleSeam-1-1024x576.jpg" alt="Seam and tiling" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/VisibleSeam-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/VisibleSeam-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/VisibleSeam-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/VisibleSeam-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/VisibleSeam-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Fractional values, on the other hand, create a seam running from the north to the south pole.</p>



<h3>Polar Distortion</h3>



<p>Another problem is texture pinching at the poles. Not only the pinching is visually jarring, mapping onto triangles generates additional distortion, similiar to PSX’s ‘floaty’ texturing. </p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/PolePinching-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-282&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: With and without polar patch&#34;,&#34;alt&#34;:&#34;With and without polar patch&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/PolePinching-1-1024x576.jpg" alt="With and without polar patch" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/PolePinching-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/PolePinching-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/PolePinching-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/PolePinching-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/PolePinching-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>A common workaround in game development has been to conceal these pinched areas with a textured patch.</p>



<h3>Atmosphere</h3>



<p>Finally, when considering the UV sphere for a planetary model, the inability to depict atmospheric halos becomes a limitation. Since mesh only allows surface drawing, an additional model is required for the halo, complicating the setup.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/HaloMeshes-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-278&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Ways of adding atmosphere&#34;,&#34;alt&#34;:&#34;Ways of adding atmosphere&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/HaloMeshes-1-1024x576.jpg" alt="Ways of adding atmosphere" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/HaloMeshes-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/HaloMeshes-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/HaloMeshes-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/HaloMeshes-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/HaloMeshes-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The UV sphere may seem as a feasible solution, but the laundry list of necessary modifications and creative hacks turns it into a Frankenstein’s monster. It is still used for modeling a planet, but for my application, the skybox, I was considering another option.</p>



<h2>Flat Disk</h2>



<p>Opting for an actual spherical mesh to represent the planet is primarily for the ease of texture mapping. In the case of a skybox, however, there’s no need for a complex 3D mesh – it will be observed from a distance and from one position. A basic disk will work just as good. The main issue, texture mapping, can be effectively managed through a pixel shader. This technique also has the added benefit of allowing the atmospheric halo to be drawn on the same mesh.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/FlatDiskVsSphere.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-285&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Using flat disk vs using 3D sphere&#34;,&#34;alt&#34;:&#34;Using flat disk vs using 3D sphere&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/FlatDiskVsSphere-1024x576.jpg" alt="Using flat disk vs using 3D sphere" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/FlatDiskVsSphere-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlatDiskVsSphere-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlatDiskVsSphere-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlatDiskVsSphere-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/FlatDiskVsSphere-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The disk mesh I’ll use is a straightforward filled circular polygon. The key feature to note is that its texture coordinates have their origin exactly at the center of the disk. If we assume that the planet has a radius of 1, then the UV coordinates have to extend beyond that to make some space for rendering the atmosphere.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/01\/PolygonalDiscCoords.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-204&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Flat disk UV coordinates&#34;,&#34;alt&#34;:&#34;Flat disk UV coordinates&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/01/PolygonalDiscCoords-1024x576.jpg" alt="Flat disk UV coordinates" srcset="https://emildziewanowski.com/wp-content/uploads/2024/01/PolygonalDiscCoords-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/01/PolygonalDiscCoords-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/01/PolygonalDiscCoords-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/01/PolygonalDiscCoords-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/01/PolygonalDiscCoords-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h2>Pixel Shader</h2>



<p>There are several features of the 3D UV Sphere mesh I want to recreate in the shader. Obviously, the shader version of a planet has to be visually indistinguishable from the mesh one. It also has to be free of all the problems of the mesh listed before. The shader creation process will be broken down to several steps.</p>



<ul>
<li>Surface Equation: Without the triangle mesh, the surface has to be defined in analytical terms.</li>



<li>Texture Mapping: UV coordinates have to be defined as a function of position on a sphere. This includes scaling and TBN calculation</li>



<li>Orientation: The shader must allow for the tilting of the planet’s axis.</li>



<li>Rotation: The planet should be able to spin around its axis.</li>
</ul>



<h2>Surface Equation</h2>



<p>One important note on coordinates: I’ll be using a left-handed, Y-up system, as it is most consistent with DirectX. I will also use the DirectX normal map format. While Unreal Engine also uses a left-handed system,  Z is the up-direction. It is a good practice to double- or triple-check orientations and the format of normal maps used.</p>



<p>The surface equation maps a 2D position on a disc plane to a corresponding 3D position on a spherical surface. In simpler terms – it is a function that draws a ball.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/SurfaceEquation.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-287&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Surface equation diagram&#34;,&#34;alt&#34;:&#34;Surface equation diagram&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/SurfaceEquation-1024x576.jpg" alt="Surface equation diagram" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/SurfaceEquation-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/SurfaceEquation-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/SurfaceEquation-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/SurfaceEquation-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/SurfaceEquation-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The first step is figuring out if the pixel lies on the surface of a sphere. To create a bounding circle mask, verify if the length of the UV vector is less than the sphere’s radius:</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/CircleMaskEquation-2.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-249&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Circle equation&#34;,&#34;alt&#34;:&#34;Circle equation&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/CircleMaskEquation-2-1024x576.jpg" alt="Circle equation" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/CircleMaskEquation-2-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/CircleMaskEquation-2-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/CircleMaskEquation-2-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/CircleMaskEquation-2-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/CircleMaskEquation-2-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<div><pre data-lang="HLSL"><code>float CircleMask( float2 uv, float radius)
{
    return length(uv) &lt; radius? 1.0: 0.0;
}</code></pre></div>



<p>It’s important to note that this approach will function correctly only when the UV coordinates are aligned with the center of the mesh.</p>



<p>Next step is to create surface vector – or the local position of the surface of the sphere. Luckily both x and y components of the UV coordinates are the same as the corresponding surface vector components. The only thing left to do is to reconstruct z component. </p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/ZComponentReconstruction-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-292&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Surface vector equation&#34;,&#34;alt&#34;:&#34;Surface vector equation&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/ZComponentReconstruction-1-1024x576.jpg" alt="Surface vector equation" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/ZComponentReconstruction-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/ZComponentReconstruction-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/ZComponentReconstruction-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/ZComponentReconstruction-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/ZComponentReconstruction-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<div><pre data-lang="HLSL"><code>float3 ReconstructSurface(float2 uv)
{
    float zSquared = 1.0 - dot(uv, uv);
    float z = sqrt(zSquared);
    return float3(uv, z);
}</code></pre></div>



<h2>Texture Mapping</h2>



<p>Mapping the square texture to spherical surface can be broken down to 3 operations:</p>



<ol>
<li>Wrapping around cylinder</li>



<li>Repeating the same for y axis</li>



<li>Deforming the result into a circle</li>
</ol>







<p>Process of wrapping might seem counterintuitive. The x coordinate of texture will be proportional to the angle the texture would wrap around the cylinder. To find this angle it is enough to calculate the arcsine(x). Then the angle has to be remapped from [-<strong>π</strong>, <strong>π </strong>] to [0, 1]. </p>



<p>To form a circle it is necessary to define the circular curve as a distance from y axis:</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/01\/HalfCircleEquation.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-224&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Generatrix equation&#34;,&#34;alt&#34;:&#34;Generatrix equation&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/01/HalfCircleEquation-1024x576.jpg" alt="Generatrix equation" srcset="https://emildziewanowski.com/wp-content/uploads/2024/01/HalfCircleEquation-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/01/HalfCircleEquation-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/01/HalfCircleEquation-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/01/HalfCircleEquation-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/01/HalfCircleEquation-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The ‘local width’ of the sphere, or the generatrix, is then used to pinch the coordinates at the poles. This is achieved by dividing the x-component of the surface position.</p>



<div><pre data-lang="HLSL"><code>float2 GenerateSphericalUV(float3 position)
{
    float width = sqrt(1.0 - position.y * position.y);
    float generatrixX = position.x / width * sign(position.z);
    float2 generatrix = float2(generatrixX, position.y);
    float2 uv = asin(generatrix) / 3.14159 + float2(0.5, 0.5);  
    return float2(uv);
}</code></pre></div>



<h2>Orientation</h2>



<p>To make the planet look more natural, we need to adjust the orientation of its axis, specifically the pitch and roll. Planets in the sci-fi art are usually tilted, as it creates more dynamic composition and allows to show ice capes on the poles.</p>



<p>The yaw, which corresponds to the planet’s spinning motion, will be dealt with in separate step to avoid the seam issue mentioned when discussing UV spheres.</p>







<p>In the conventional approach, a mesh sphere is typically reoriented or transformed using a matrix.  In our case, where each pixel defines the surface position, we can use a simplified 3⨯3 matrix limited to rotation – eliminating the need for a full set of transformations.</p>



<p>Building such a matrix is pretty straightforward. Identify the ‘right,’ ‘up,’ and ‘forward’ vectors of the rotated sphere and organize them as columns in the matrix.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/01\/BuildingRotationMatrix.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-206&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Rotation matrix&#34;,&#34;alt&#34;:&#34;Rotation matrix&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/01/BuildingRotationMatrix-1024x576.jpg" alt="Rotation matrix" srcset="https://emildziewanowski.com/wp-content/uploads/2024/01/BuildingRotationMatrix-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/01/BuildingRotationMatrix-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/01/BuildingRotationMatrix-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/01/BuildingRotationMatrix-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/01/BuildingRotationMatrix-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Material editor doesn’t support matrices as a data format, but Unreal offers a walk-around:</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/UnrealMatrixBasis.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-238&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Rotation matrix in Unreal material graph&#34;,&#34;alt&#34;:&#34;Rotation matrix in Unreal material graph&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/UnrealMatrixBasis-1024x576.jpg" alt="Rotation matrix in Unreal material graph" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/UnrealMatrixBasis-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/UnrealMatrixBasis-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/UnrealMatrixBasis-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/UnrealMatrixBasis-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/UnrealMatrixBasis-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>When the rotations are limited to just pitch and roll the matrix looks like this:</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/PitchRollMatrix.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-236&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Rotation matrix for pitch and roll&#34;,&#34;alt&#34;:&#34;Rotation matrix for pitch and roll&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/PitchRollMatrix-1024x576.jpg" alt="Rotation matrix for pitch and roll" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/PitchRollMatrix-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/PitchRollMatrix-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/PitchRollMatrix-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/PitchRollMatrix-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/PitchRollMatrix-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/RotationMatrixUnreal-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-231&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Pitch and roll matrix in Unreal material graph&#34;,&#34;alt&#34;:&#34;Pitch and roll matrix in Unreal material graph&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/RotationMatrixUnreal-1-1024x576.jpg" alt="Pitch and roll matrix in Unreal material graph" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/RotationMatrixUnreal-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/RotationMatrixUnreal-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/RotationMatrixUnreal-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/RotationMatrixUnreal-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/RotationMatrixUnreal-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>In HLSL 3⨯3 matrix can be represented using float3x3:</p>



<div><pre data-lang="HLSL"><code>float3x3 CreateRotationMatrix(float pitch, float roll) {
    float cosPitch = cos(pitch);
    float sinPitch = sin(pitch);
    float cosRoll = cos(roll);
    float sinRoll = sin(roll);

    return (float3x3)(
        cosRoll, -sinRoll * cosPitch, sinRoll * sinPitch,
        sinRoll, cosRoll * cosPitch, -cosRoll * sinPitch,
        0.0, sinPitch, cosPitch
    );
}</code></pre></div>



<h2>Scale</h2>







<p>Before adding the spinning motion, there is one problem that needs to be adressed – uv seams. Right now the texture is mapped in such a way, that the seams are aligned with the edges of the texture, and thus invisible. But if we change the scale, the discontinuity becomes obvious. It is not a problem that can be easily solved, but it can be partially masked by moving to the backside. This requires changes in mapping function:</p>



<div><pre data-lang="HLSL"><code>float2 GenerateSphericalUV(float3 position, float scale)
{
    float width = sqrt(1.0 - position.y * position.y);
    float generatrixX = position.x / width * sign(position.z);
    float2 generatrix = float2(generatrixX, position.y);
    float2 uv = asin(generatrix) / 3.14159 + float2(0.5, 0.5);  
    return float2(uv);
}</code></pre></div>



<h2>Rotation</h2>



<p>With all the prerequisites in place, adding the spinning is straightforward, even if counterintuitive. To keep the seam in well masked position, we will not rotater sphere’s surface, but pan the surface texture along x axis. </p>



<div><pre data-lang="HLSL"><code>float2 GenerateSphericalUV(float3 position, float scale, float spin)
{
    float width = sqrt(1.0 - position.y * position.y);
    float generatrixX = position.x / width * sign(position.z);
    float2 generatrix = float2(generatrixX, position.y);
    float2 uv = asin(generatrix) / 3.14159 + float2(0.5, 0.5);  
    return float2(uv);
}</code></pre></div>



<div><pre data-lang="HLSL" data-start="6"><code>float2 sphericalVU = GenerateSphericalUV(position, scale, time*speed)</code></pre></div>







<h2>Shading</h2>



<p>For the ball to appear truly round, shading is crucial. Typically, it would be handled by the engine, but in the case of a planet, it is not that easy. A planet consists of two distinctive layers – the surface and the atmosphere. Typical materials describe only one medium. Therefore, we have to define how both layers are lit and blend them together manually.</p>



<h3>Normal</h3>



<p>Regardless of the chosen shading model, surface normal must be provided. Fortunately it is already there – surface position, before rotation, in case where radius is 1 is equal to surface normal. It is enough to perform basic shading.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/02\/PositionToNormal.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-298&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Normal and surface vector similiarity&#34;,&#34;alt&#34;:&#34;Normal and surface vector similiarity&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/02/PositionToNormal-1024x576.jpg" alt="Normal and surface vector similiarity" srcset="https://emildziewanowski.com/wp-content/uploads/2024/02/PositionToNormal-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/02/PositionToNormal-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/02/PositionToNormal-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/02/PositionToNormal-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/02/PositionToNormal-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<h3>Light</h3>



<p>I want to replicate the aesthetics of sci-fi book covers, with a stylized version inspired by NASA photos. Realism isn’t my primary concern. I’ll be using the simplest Lambertian model, where the light is equal to the dot product of the surface normal and light vector.</p>



<div><pre data-lang="HLSL"><code>float LambertianLight(float3 normal, float3 lightDirection) {
    float NdotL = max(dot(normal, lightDirection), 0.0);
    return NdotL;
}</code></pre></div>







<h3>Bump Mapping</h3>



<p>A simple normal might suffice for cases where the planet appears smooth, such as gas giants. However, planets with rocky surfaces are often covered with geological formations like mountains, ridges, or craters. These are best simulated using normal maps.</p>



<p>To use normal maps, we require a complete set of vectors: Tangent, Bitangent, and Normal. This set comprises three unit vectors perpendicular to each other and aligned to UV mapping. These vectors can be thought of as ‘UV Local Space’.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/TBNExplained-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-669&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: TBN set in general case&#34;,&#34;alt&#34;:&#34;TBN set in general case&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="http://emildziewanowski.com/wp-content/uploads/2024/03/TBNExplained-1-1024x576.jpg" alt="TBN set in general case" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/TBNExplained-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/TBNExplained-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/TBNExplained-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/TBNExplained-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/TBNExplained-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>In the case of a sphere, calculations need to be done per pixel. It’s often convenient to store these calculations as columns of the TBN matrix. This matrix can then be used to recalculate the normal from the normal map into World Space Coordinates.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/SphereTBN-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-672&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: TBN set for sphere&#34;,&#34;alt&#34;:&#34;TBN set for sphere&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/SphereTBN-1-1024x576.jpg" alt="TBN set for sphere" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/SphereTBN-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/SphereTBN-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/SphereTBN-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/SphereTBN-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/SphereTBN-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Shaded surface and the corresponding normalmap:</p>







<h2>UV Discontinuities</h2>



<p>When discussing the generation of UV coordinates in the pixel shader, one critical topic to address is discontinuities. Take, for instance, the case of the back seam – the horizontal component of the UV should wrap perfectly as it is equal to 0.0 and 1.0 on the borders. However, instead of a seamless transition, there is a line of blocky artifacts along the seam.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/DDXDiscontinuity.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-676&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Source of ddx seam&#34;,&#34;alt&#34;:&#34;Source of ddx seam&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/DDXDiscontinuity-1024x576.jpg" alt="Source of ddx seam" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/DDXDiscontinuity-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXDiscontinuity-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXDiscontinuity-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXDiscontinuity-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXDiscontinuity-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>This line corresponds to the DDX of the UV. DDX and DDY, in this case, measure the rate of change of UV in the respective screen space axes. They are then fed into the texture sampler and used to determine which mipmap to use. Low values of UV derivative correspond to a high-resolution mipmap, and vice versa.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/DDXExplained.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-679&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: DDX and DDY explained&#34;,&#34;alt&#34;:&#34;DDX and DDY explained&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/DDXExplained-1024x576.jpg" alt="DDX and DDY explained" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/DDXExplained-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXExplained-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXExplained-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXExplained-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXExplained-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>There’s a ‘jump’ in values between the left and right sides of the seam, causing the DDX to be high. Consequently, the texture is sampled from the lowest mipmap, resulting in the gray color.</p>



<p>In the case of a planet, it won’t be a significant issue, as it will be covered with a polar patch anyway. However, in other visually jarring scenarios, the DDX and DDY of the seam have to be manually corrected and fed into the sampler.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/DDXSampling.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-684&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Fix for ddx and ddy seam in Unreal material graph&#34;,&#34;alt&#34;:&#34;Fix for ddx and ddy seam in Unreal material graph&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/DDXSampling-1024x576.jpg" alt="Fix for ddx and ddy seam in Unreal material graph" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/DDXSampling-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXSampling-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXSampling-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXSampling-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/DDXSampling-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The presented ‘fix’ is merely for illustrative purposes. Typically, formulas for proper values of DDX and DDY have to be derived manually to match the mapping accurately.</p>



<h2>Polar Patches</h2>



<p>Last problem that needs adressing is the distortion on the poles. As mentioned before – the tried and tested solution is to just cover them. Seems like a hack, but in the case of a planet or a moon makes a lot of sense. Polar areas are often covered with ice, and visually distinct from the rest of the planet, so having a patch of different texture not only hides the prolem but also add visual interest.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/MarsIceCap.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-681&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Photo of ice cap on Mars&#34;,&#34;alt&#34;:&#34;Photo of ice cap on Mars&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/MarsIceCap-1024x576.jpg" alt="Photo of ice cap on Mars" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/MarsIceCap-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/MarsIceCap-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/MarsIceCap-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/MarsIceCap-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/MarsIceCap-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Easiest way to add polar patch wolud be to map it in the plane perpendicular to the axis of rotation and rotate resulting coordinates:</p>



<div><pre data-lang="HLSL"><code>float2 PolarPatchMapping(float3 position, float scale, float spin)
{
    float width = sqrt(1.0 - position.y * position.y);
    float generatrixX = position.x / width * sign(position.z);
    float2 generatrix = float2(generatrixX, position.y);
    float2 uv = asin(generatrix) / 3.14159 + float2(0.5, 0.5);  
    return float2(uv);
}</code></pre></div>







<h2>Atmosphere</h2>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/EarthAtmosphereISS.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-688&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Photo of Earth\u0027s atmosphere taken from ISS&#34;,&#34;alt&#34;:&#34;Photo of Earth\u0027s atmosphere taken from ISS&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/EarthAtmosphereISS-1024x576.jpg" alt="Photo of Earth&#39;s atmosphere taken from ISS" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/EarthAtmosphereISS-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/EarthAtmosphereISS-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/EarthAtmosphereISS-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/EarthAtmosphereISS-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/EarthAtmosphereISS-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Planet’s surface doesn’t occupy the entire area of the disk, leaving enough space to draw the atmospheric halo. Drawn with the same shader, it can be seamlessly merged with the atmosphere drawn over the planet.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/SurfaceAndAtmosphere.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-704&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Surface and atmosphere on flat disc&#34;,&#34;alt&#34;:&#34;Surface and atmosphere on flat disc&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/SurfaceAndAtmosphere-1024x576.jpg" alt="Surface and atmosphere on flat disc" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/SurfaceAndAtmosphere-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/SurfaceAndAtmosphere-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/SurfaceAndAtmosphere-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/SurfaceAndAtmosphere-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/SurfaceAndAtmosphere-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>There are countless whitepapers discussing atmosphere rendering. Most are <a href="https://en.wikipedia.org/wiki/Rayleigh_scattering">physically based</a> and rely on raymarching to deliver the most realistic image possible. I will use none of them. There is a nice trick from Quake I want to try.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/Quake2MonsterLighting-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-689&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Quake 2 screenshot&#34;,&#34;alt&#34;:&#34;Quake 2 screenshot&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2MonsterLighting-1-1024x576.jpg" alt="Quake 2 screenshot" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2MonsterLighting-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2MonsterLighting-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2MonsterLighting-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2MonsterLighting-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2MonsterLighting-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>In both Quake 1 and 2, lighting was achieved using mostly lightmaps, a technique popular at the time and still used until recently for static light scenarios. In this approach, computationally expensive lighting calculations are precomputed during development and stored as a separate texture covering all surfaces in the level.</p>



<p>However, since lightmaps only work for static lighting, idSoftware had to devise a solution for dynamic objects like monsters. They sampled the lightmap below the dynamic object and used it to modulate the color of the object. While this technique wasn’t physically accurate, it was good enough to make the monster blend with its surroundings.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/Quake2LightmapSampling-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-731&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Quake2 character light&#34;,&#34;alt&#34;:&#34;Quake2 character light&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2LightmapSampling-1-1024x576.jpg" alt="Quake2 character light" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2LightmapSampling-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2LightmapSampling-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2LightmapSampling-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2LightmapSampling-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/Quake2LightmapSampling-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>In a similar manner, I’ll use the planet’s surface to approximate the lighting of the atmospheric halo. It is enough to extend the surface normal before bump mapping to calculate the halo’s brightness.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/AtmosphericNormalAndLight.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-711&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Extended surface normal and light&#34;,&#34;alt&#34;:&#34;Extended surface normal and light&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphericNormalAndLight-1024x576.jpg" alt="Extended surface normal and light" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphericNormalAndLight-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphericNormalAndLight-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphericNormalAndLight-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphericNormalAndLight-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphericNormalAndLight-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>To further enhance the effect, the brightness of each channel can be remapped differently. This is a simple yet effective method for simulating the absorption of different light wavelengths.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/MappedLambertLighting-1.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-717&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Remapped light color components&#34;,&#34;alt&#34;:&#34;Remapped light color components&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/MappedLambertLighting-1-1024x576.jpg" alt="Remapped light color components" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/MappedLambertLighting-1-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/MappedLambertLighting-1-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/MappedLambertLighting-1-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/MappedLambertLighting-1-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/MappedLambertLighting-1-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>The visibility of the atmosphere is more pronounced at oblique angles. This effect can be replicated by remapping the Z component of the surface normal. Additionally, to recreate the halo’s fading effect, the distance from the sphere’s surface must be calculated.</p>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/AtmosphereOpacity.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-721&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Light opacity components&#34;,&#34;alt&#34;:&#34;Light opacity components&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphereOpacity-1024x576.jpg" alt="Light opacity components" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphereOpacity-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphereOpacity-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphereOpacity-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphereOpacity-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/AtmosphereOpacity-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Finally, both the surface and atmosphere need to be alpha-blended together.</p>







<h2>Conclusions</h2>



<figure data-wp-context="{&#34;uploadedSrc&#34;:&#34;https:\/\/emildziewanowski.com\/wp-content\/uploads\/2024\/03\/CompletePlanetMaterialGraph.jpg&#34;,&#34;figureClassNames&#34;:&#34;wp-block-image size-large&#34;,&#34;figureStyles&#34;:null,&#34;imgClassNames&#34;:&#34;wp-image-785&#34;,&#34;imgStyles&#34;:null,&#34;targetWidth&#34;:2560,&#34;targetHeight&#34;:1440,&#34;scaleAttr&#34;:false,&#34;ariaLabel&#34;:&#34;Enlarge image: Full Unreal material graph&#34;,&#34;alt&#34;:&#34;Full Unreal material graph&#34;}" data-wp-interactive="core/image"><img loading="lazy" decoding="async" width="1024" height="576" data-wp-init="callbacks.setButtonStyles" data-wp-on--click="actions.showLightbox" data-wp-on--load="callbacks.setButtonStyles" data-wp-on-window--resize="callbacks.setButtonStyles" src="https://emildziewanowski.com/wp-content/uploads/2024/03/CompletePlanetMaterialGraph-1024x576.jpg" alt="Full Unreal material graph" srcset="https://emildziewanowski.com/wp-content/uploads/2024/03/CompletePlanetMaterialGraph-1024x576.jpg 1024w, https://emildziewanowski.com/wp-content/uploads/2024/03/CompletePlanetMaterialGraph-300x169.jpg 300w, https://emildziewanowski.com/wp-content/uploads/2024/03/CompletePlanetMaterialGraph-768x432.jpg 768w, https://emildziewanowski.com/wp-content/uploads/2024/03/CompletePlanetMaterialGraph-1536x864.jpg 1536w, https://emildziewanowski.com/wp-content/uploads/2024/03/CompletePlanetMaterialGraph-2048x1152.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px"/></figure>



<p>Although it took more steps than anticipated, the result works great. The planet is a perfect sphere, and the mapping allows for all the texture and shader manipulations I wanted. I can create a single Substance Designer graph generating surface texture, and the result doesn’t require any further post-processing. The same goes for animated texture – I can use a smaller size and thus save performance, then adjust the tiling as needed.</p>



<figure><p>
<iframe loading="lazy" title="Flat Planet Shader" width="500" height="281" src="https://www.youtube.com/embed/gbzJpvsuzfc?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>
</p></figure>
                        </div>
                    </article>
                        </div>
    </div></div>
  </body>
</html>
