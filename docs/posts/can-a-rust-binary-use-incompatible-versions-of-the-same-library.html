<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/brannondorsey/rust-incompatible-transitive-dependencies">Original</a>
    <h1>Can a Rust binary use incompatible versions of the same library?</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Yes it can.</p>

<p dir="auto">As I&#39;ve continued learning Rust and the Cargo ecosystem, one question has continued to puzzle me:</p>
<blockquote>
<p dir="auto">Can a Rust project import multiple SemVer-incompatible library crates, or will the dependency resolver reject this scenario and cause your code to fail to compile?</p>
</blockquote>
<div dir="auto"><h3 tabindex="-1" dir="auto">Transitive dependency conflicts</h3><a id="user-content-transitive-dependency-conflicts" aria-label="Permalink: Transitive dependency conflicts" href="#transitive-dependency-conflicts"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This is a scenario which occurs mostly with <a href="https://en.wikipedia.org/wiki/Transitive_dependency" rel="nofollow">transitive dependencies</a> and sorting them out can be a real headache, especially if you are using unmaintained libraries. A transitive dependency is a dependency of one of your dependencies, and you often don&#39;t get to control this version.</p>
<blockquote>
<p dir="auto">A (your app) &gt; B (your app&#39;s dependency) &gt; C (your dependency&#39;s dependency)</p>
</blockquote>
<p dir="auto">In this scenario, C is considered a transitive dependency of A.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Is Rust like <code>npm</code> or is it like <code>pip</code>?</h3><a id="user-content-is-rust-like-npm-or-is-it-like-pip" aria-label="Permalink: Is Rust like npm or is it like pip?" href="#is-rust-like-npm-or-is-it-like-pip"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Does the <code>cargo</code> + Rust ecosystem behave more like <a href="#nodejs--npm"><code>npm</code> + Node.js by allowing</a> incompatible transitive dependency versions, or is it more like <a href="#python--pip"><code>pip</code> + Python</a>, which does not?</p>
<p dir="auto">Spoiler: It behaves like <code>npm</code> and thank god for that. ðŸ˜‡</p>

<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/brannondorsey/rust-incompatible-transitive-dependencies
cd rust-incompatible-transitive-dependencies/

cargo run # see example output below"><pre>git clone https://github.com/brannondorsey/rust-incompatible-transitive-dependencies
<span>cd</span> rust-incompatible-transitive-dependencies/

cargo run <span><span>#</span> see example output below</span></pre></div>
<div data-snippet-clipboard-copy-content="   Compiling a v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/a)
   Compiling b v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/b)
   Compiling dependency-test v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.74s
     Running `target/debug/dependency-test`
2024-08-17T23:02:02.709Z INFO  [a] logged using log@0.4.22
2024-08-17T23:02:02.709Z INFO  [b] logged using log@0.3.9"><pre lang="plain"><code>   Compiling a v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/a)
   Compiling b v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/b)
   Compiling dependency-test v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.74s
     Running `target/debug/dependency-test`
2024-08-17T23:02:02.709Z INFO  [a] logged using log@0.4.22
2024-08-17T23:02:02.709Z INFO  [b] logged using log@0.3.9
</code></pre></div>

<p dir="auto">The example binary crate below uses two library crates, <code>a</code> and <code>b</code>, each requiring their own incompatible versions of the <a href="https://crates.io/crates/log" rel="nofollow">log</a> crate.</p>
<p dir="auto"><code>cargo.toml</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="[package]
name = &#34;dependency-test&#34;
version = &#34;0.1.0&#34;
edition = &#34;2021&#34;

[dependencies]
a = { version = &#34;0.1.0&#34;, path = &#34;a&#34; }
b = { version = &#34;0.1.0&#34;, path = &#34;b&#34; }
simple_logger = &#34;5.0.0&#34;"><pre>[<span>package</span>]
<span>name</span> = <span><span>&#34;</span>dependency-test<span>&#34;</span></span>
<span>version</span> = <span><span>&#34;</span>0.1.0<span>&#34;</span></span>
<span>edition</span> = <span><span>&#34;</span>2021<span>&#34;</span></span>

[<span>dependencies</span>]
<span>a</span> = { <span>version</span> = <span><span>&#34;</span>0.1.0<span>&#34;</span></span>, <span>path</span> = <span><span>&#34;</span>a<span>&#34;</span></span> }
<span>b</span> = { <span>version</span> = <span><span>&#34;</span>0.1.0<span>&#34;</span></span>, <span>path</span> = <span><span>&#34;</span>b<span>&#34;</span></span> }
<span>simple_logger</span> = <span><span>&#34;</span>5.0.0<span>&#34;</span></span></pre></div>
<p dir="auto"><code>main.rs</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="use a::log as log_a;
use b::log as log_b;
use simple_logger::SimpleLogger;

fn main() {
    SimpleLogger::new()
        .init()
        .expect(&#34;Failed to initialize logger&#34;);
    log_a();
    log_b();
}"><pre><span>use</span> a<span>::</span>log <span>as</span> log_a<span>;</span>
<span>use</span> b<span>::</span>log <span>as</span> log_b<span>;</span>
<span>use</span> simple_logger<span>::</span><span>SimpleLogger</span><span>;</span>

<span>fn</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>SimpleLogger</span><span>::</span><span>new</span><span>(</span><span>)</span>
        <span>.</span><span>init</span><span>(</span><span>)</span>
        <span>.</span><span>expect</span><span>(</span><span>&#34;Failed to initialize logger&#34;</span><span>)</span><span>;</span>
    <span>log_a</span><span>(</span><span>)</span><span>;</span>
    <span>log_b</span><span>(</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<p dir="auto"><code>a/cargo.toml</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="[package]
name = &#34;a&#34;
version = &#34;0.1.0&#34;
edition = &#34;2021&#34;

[dependencies]
log = &#34;0.4.22&#34;"><pre>[<span>package</span>]
<span>name</span> = <span><span>&#34;</span>a<span>&#34;</span></span>
<span>version</span> = <span><span>&#34;</span>0.1.0<span>&#34;</span></span>
<span>edition</span> = <span><span>&#34;</span>2021<span>&#34;</span></span>

[<span>dependencies</span>]
<span>log</span> = <span><span>&#34;</span>0.4.22<span>&#34;</span></span></pre></div>
<p dir="auto"><code>a/src/lib.rs</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="use log::info;

pub fn log() {
    info!(&#34;logged using log@0.4.22&#34;);
}"><pre><span>use</span> log<span>::</span>info<span>;</span>

<span>pub</span> <span>fn</span> <span>log</span><span>(</span><span>)</span> <span>{</span>
    <span>info</span><span>!</span><span>(</span><span>&#34;logged using log@0.4.22&#34;</span><span>)</span><span>;</span>
<span>}</span></pre></div>
<p dir="auto"><code>b/cargo.toml</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="[package]
name = &#34;b&#34;
version = &#34;0.1.0&#34;
edition = &#34;2021&#34;

[dependencies]
# Intentionally using an outdated version
log = &#34;0.3.9&#34;"><pre>[<span>package</span>]
<span>name</span> = <span><span>&#34;</span>b<span>&#34;</span></span>
<span>version</span> = <span><span>&#34;</span>0.1.0<span>&#34;</span></span>
<span>edition</span> = <span><span>&#34;</span>2021<span>&#34;</span></span>

[<span>dependencies</span>]
<span><span>#</span> Intentionally using an outdated version</span>
<span>log</span> = <span><span>&#34;</span>0.3.9<span>&#34;</span></span></pre></div>
<p dir="auto"><code>b/src/lib.rs</code></p>
<div dir="auto" data-snippet-clipboard-copy-content="// Required for the outdated 0.3.* version of log
#[macro_use]
extern crate log;

use log::info;

pub fn log() {
    info!(&#34;logged using log@0.3.9&#34;);
}"><pre><span>// Required for the outdated 0.3.* version of log</span>
<span>#<span>[</span>macro_use<span>]</span></span>
<span>extern</span> <span>crate</span> log<span>;</span>

<span>use</span> log<span>::</span>info<span>;</span>

<span>pub</span> <span>fn</span> <span>log</span><span>(</span><span>)</span> <span>{</span>
    <span>info</span><span>!</span><span>(</span><span>&#34;logged using log@0.3.9&#34;</span><span>)</span><span>;</span>
<span>}</span></pre></div>

<p dir="auto">It turns out Cargo actually has a nifty method to check your dependencies for duplicate versions.</p>
<div data-snippet-clipboard-copy-content="cargo tree --duplicates
log v0.3.9
â””â”€â”€ b v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/b)
    â””â”€â”€ rust-incompatible-transitive-version-example v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)

log v0.4.22
â”œâ”€â”€ a v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/a)
â”‚   â””â”€â”€ rust-incompatible-transitive-version-example v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)
â”œâ”€â”€ log v0.3.9 (*)
â””â”€â”€ simple_logger v5.0.0
    â””â”€â”€ rust-incompatible-transitive-version-example v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)"><pre lang="plain"><code>cargo tree --duplicates
log v0.3.9
â””â”€â”€ b v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/b)
    â””â”€â”€ rust-incompatible-transitive-version-example v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)

log v0.4.22
â”œâ”€â”€ a v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies/a)
â”‚   â””â”€â”€ rust-incompatible-transitive-version-example v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)
â”œâ”€â”€ log v0.3.9 (*)
â””â”€â”€ simple_logger v5.0.0
    â””â”€â”€ rust-incompatible-transitive-version-example v0.1.0 (/home/brannon/Documents/code/rust-incompatible-transitive-dependencies)
</code></pre></div>
<div dir="auto"><h2 tabindex="-1" dir="auto">What&#39;s happening under the hood?</h2><a id="user-content-whats-happening-under-the-hood" aria-label="Permalink: What&#39;s happening under the hood?" href="#whats-happening-under-the-hood"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div dir="auto" data-snippet-clipboard-copy-content="cargo build --release

tree target/debug
target/release
â”œâ”€â”€ build
â”‚Â Â  â”œâ”€â”€ ...
â”œâ”€â”€ deps
â”‚Â Â  â”œâ”€â”€ a-5a849d8d164ba2f5.d
â”‚Â Â  â”œâ”€â”€ b-1132515820191c83.d
â”‚Â Â  â”œâ”€â”€ ...
â”‚Â Â  â”œâ”€â”€ liblog-918cd93f416d7029.rlib
â”‚Â Â  â”œâ”€â”€ liblog-918cd93f416d7029.rmeta
â”‚Â Â  â”œâ”€â”€ liblog-fee03072b48908b6.rlib
â”‚Â Â  â”œâ”€â”€ liblog-fee03072b48908b6.rmeta
â”‚Â Â  â”œâ”€â”€ ...
â”‚Â Â  â”œâ”€â”€ log-918cd93f416d7029.d
â”‚Â Â  â”œâ”€â”€ log-fee03072b48908b6.d
â”‚Â Â  â”œâ”€â”€ ...
â”œâ”€â”€ examples
â”œâ”€â”€ incremental
â”œâ”€â”€ rust-incompatible-transitive-version-example
â””â”€â”€ rust-incompatible-transitive-version-example.d"><pre>cargo build --release

tree target/debug
target/release
â”œâ”€â”€ build
â”‚Â Â  â”œâ”€â”€ ...
â”œâ”€â”€ deps
â”‚Â Â  â”œâ”€â”€ a-5a849d8d164ba2f5.d
â”‚Â Â  â”œâ”€â”€ b-1132515820191c83.d
â”‚Â Â  â”œâ”€â”€ ...
â”‚Â Â  â”œâ”€â”€ liblog-918cd93f416d7029.rlib
â”‚Â Â  â”œâ”€â”€ liblog-918cd93f416d7029.rmeta
â”‚Â Â  â”œâ”€â”€ liblog-fee03072b48908b6.rlib
â”‚Â Â  â”œâ”€â”€ liblog-fee03072b48908b6.rmeta
â”‚Â Â  â”œâ”€â”€ ...
â”‚Â Â  â”œâ”€â”€ log-918cd93f416d7029.d
â”‚Â Â  â”œâ”€â”€ log-fee03072b48908b6.d
â”‚Â Â  â”œâ”€â”€ ...
â”œâ”€â”€ examples
â”œâ”€â”€ incremental
â”œâ”€â”€ rust-incompatible-transitive-version-example
â””â”€â”€ rust-incompatible-transitive-version-example.d</pre></div>
<p dir="auto">Notice that Cargo has built two versions of the <code>.d</code>, <code>.rmeta</code>, and <code>.rlib</code> files for each separate version of the log dependency.</p>
<blockquote>
<p dir="auto">NOTE: Run <code>cat target/release/deps/log-*.d</code> to see which source files were used to generate each compiled binary file.</p>
</blockquote>
<p dir="auto">As an exercise, try setting SemVer <em>compatible</em> versions of the log crate in <code>a/Cargo.toml</code> and <code>b/Cargo.toml</code> and then.</p>
<ol dir="auto">
<li>Run <code>cargo clean</code> to empty <code>target/*</code></li>
<li>Run <code>cargo build --release</code> again</li>
<li>Inspect the <code>target/release</code> directory again.</li>
</ol>
<p dir="auto">You should see only a single collection of intermediate files named <code>*log*</code>.</p>
<blockquote>
<p dir="auto">NOTE: Did you change <code>b/Cargo.toml</code> to a <code>0.4</code> version of log that is <em>lower</em> than <code>0.4.22</code>?</p>
<p dir="auto">If so, you may be surprised to find only the <code>0.4.22</code> version requested by <code>a/Cargo.toml</code> was fetched and built. This is because the Cargo dependency resolver takes the liberty to use the highest SemVer compatible crate version required by another dependency. I.e. <code>0.4.10</code> can be treated by Cargo as <code>0.4.x</code> (unless it is specified like <code>=0.4.22</code> which should be avoided in most cases).</p>
</blockquote>
<div dir="auto"><h2 tabindex="-1" dir="auto">How does this behavior relate to other languages?</h2><a id="user-content-how-does-this-behavior-relate-to-other-languages" aria-label="Permalink: How does this behavior relate to other languages?" href="#how-does-this-behavior-relate-to-other-languages"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">As you can see below, <a href="#python--pip">Python can&#39;t handle</a> the situation we&#39;ve just described above. But <a href="#nodejs--npm">Node.js can</a>.</p>
<blockquote>
<p dir="auto">NOTE: These languages were selected because they are both popular and have canonical package managers.</p>
</blockquote>

<p dir="auto">Unfortunately, you&#39;re out of luck if you find yourself using Python and requiring incompatible transitive dependency versions. The dependency resolver will simply reject your install and the path forward may be difficult.</p>
<div dir="auto" data-snippet-clipboard-copy-content="# Can actually be omitted because the install will fail 
# and no modules will be globally anyway
python -m venv venv &amp;&amp; source venv/bin/activate

cat &lt;&lt;EOF &gt; requirements.txt
flask==2.0.0
werkzeug==1.0.0
EOF

pip install -r requirements.txt"><pre><span><span>#</span> Can actually be omitted because the install will fail </span>
<span><span>#</span> and no modules will be globally anyway</span>
python -m venv venv <span>&amp;&amp;</span> <span>source</span> venv/bin/activate

cat <span><span>&lt;&lt;</span><span>EOF</span> &gt; requirements.txt</span>
<span>flask==2.0.0</span>
<span>werkzeug==1.0.0</span>
<span><span>EOF</span></span>

pip install -r requirements.txt</pre></div>
<div data-snippet-clipboard-copy-content="Collecting flask==2.0.0 (from -r requirements.txt (line 1))
  Using cached Flask-2.0.0-py3-none-any.whl.metadata (3.8 kB)
Collecting werkzeug==1.0.0 (from -r requirements.txt (line 2))
  Using cached Werkzeug-1.0.0-py2.py3-none-any.whl.metadata (4.7 kB)
INFO: pip is looking at multiple versions of flask to determine which version is compatible with other requirements. This could take a while.
ERROR: Cannot install -r requirements.txt (line 1) and werkzeug==1.0.0 because these package versions have conflicting dependencies.

The conflict is caused by:
    The user requested werkzeug==1.0.0
    flask 2.0.0 depends on Werkzeug&gt;=2.0

To fix this you could try to:
1. loosen the range of package versions you&#39;ve specified
2. remove package versions to allow pip to attempt to solve the dependency conflict

ERROR: ResolutionImpossible: for help visit https://pip.pypa.io/en/latest/topics/dependency-resolution/#dealing-with-dependency-conflicts"><pre lang="plain"><code>Collecting flask==2.0.0 (from -r requirements.txt (line 1))
  Using cached Flask-2.0.0-py3-none-any.whl.metadata (3.8 kB)
Collecting werkzeug==1.0.0 (from -r requirements.txt (line 2))
  Using cached Werkzeug-1.0.0-py2.py3-none-any.whl.metadata (4.7 kB)
INFO: pip is looking at multiple versions of flask to determine which version is compatible with other requirements. This could take a while.
ERROR: Cannot install -r requirements.txt (line 1) and werkzeug==1.0.0 because these package versions have conflicting dependencies.

The conflict is caused by:
    The user requested werkzeug==1.0.0
    flask 2.0.0 depends on Werkzeug&gt;=2.0

To fix this you could try to:
1. loosen the range of package versions you&#39;ve specified
2. remove package versions to allow pip to attempt to solve the dependency conflict

ERROR: ResolutionImpossible: for help visit https://pip.pypa.io/en/latest/topics/dependency-resolution/#dealing-with-dependency-conflicts
</code></pre></div>
<p dir="auto">As far as I&#39;m aware, this is a fundamental problem with Python packages and this scenario can&#39;t be avoided by newer package managers like <a href="https://rye.astral.sh/" rel="nofollow">Rye</a> or <a href="https://python-poetry.org/" rel="nofollow">Poetry</a>.</p>

<p dir="auto">Like Cargo, the Node Package Manager (<code>npm</code>) allows multiple incompatible dependency versions to be used in the same project.</p>
<div dir="auto" data-snippet-clipboard-copy-content="cat &lt;&lt;EOF &gt; package.json
{
  &#34;name&#34;: &#34;incompatible-dependencies-example&#34;,
  &#34;version&#34;: &#34;1.0.0&#34;,
  &#34;description&#34;: &#34;Example project demonstrating npm allowing incompatible transitive dependencies&#34;,
  &#34;main&#34;: &#34;index.js&#34;,
  &#34;dependencies&#34;: {
    &#34;har-validator&#34;: &#34;^4.2.1&#34;,
    &#34;request&#34;: &#34;^2.88.2&#34;
  }
}
EOF

npm install # Note the dependency resolver exits just fine

grep har-validator package-lock.json"><pre>cat <span><span>&lt;&lt;</span><span>EOF</span> &gt; package.json</span>
<span>{</span>
<span>  &#34;name&#34;: &#34;incompatible-dependencies-example&#34;,</span>
<span>  &#34;version&#34;: &#34;1.0.0&#34;,</span>
<span>  &#34;description&#34;: &#34;Example project demonstrating npm allowing incompatible transitive dependencies&#34;,</span>
<span>  &#34;main&#34;: &#34;index.js&#34;,</span>
<span>  &#34;dependencies&#34;: {</span>
<span>    &#34;har-validator&#34;: &#34;^4.2.1&#34;,</span>
<span>    &#34;request&#34;: &#34;^2.88.2&#34;</span>
<span>  }</span>
<span>}</span>
<span><span>EOF</span></span>

npm install <span><span>#</span> Note the dependency resolver exits just fine</span>

grep har-validator package-lock.json</pre></div>
<div data-snippet-clipboard-copy-content="grep har-validator package-lock.json

        &#34;har-validator&#34;: &#34;^4.2.1&#34;,
    &#34;node_modules/har-validator&#34;: {
      &#34;resolved&#34;: &#34;https://registry.npmjs.org/har-validator/-/har-validator-4.2.1.tgz&#34;,
        &#34;har-validator&#34;: &#34;~5.1.3&#34;,
    &#34;node_modules/request/node_modules/har-validator&#34;: {
      &#34;resolved&#34;: &#34;https://registry.npmjs.org/har-validator/-/har-validator-5.1.5.tgz&#34;,
"><pre lang="plain"><code>grep har-validator package-lock.json

        &#34;har-validator&#34;: &#34;^4.2.1&#34;,
    &#34;node_modules/har-validator&#34;: {
      &#34;resolved&#34;: &#34;https://registry.npmjs.org/har-validator/-/har-validator-4.2.1.tgz&#34;,
        &#34;har-validator&#34;: &#34;~5.1.3&#34;,
    &#34;node_modules/request/node_modules/har-validator&#34;: {
      &#34;resolved&#34;: &#34;https://registry.npmjs.org/har-validator/-/har-validator-5.1.5.tgz&#34;,

</code></pre></div>
<p dir="auto">Notice how <code>npm</code> has resolved separate incompatible versions of the har-validator package? The former is the one we explicitly required and the later is the one <code>request</code> needs. Each resides in a separate location in <code>node_modules/</code> and can be accessed by the project at runtime.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">References and further reading</h2><a id="user-content-references-and-further-reading" aria-label="Permalink: References and further reading" href="#references-and-further-reading"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>The <a href="https://doc.rust-lang.org/cargo/reference/resolver.html" rel="nofollow">Dependency Resolution</a> chapter of the Cargo book, particularly the section on <a href="https://doc.rust-lang.org/cargo/reference/resolver.html#version-incompatibility-hazards" rel="nofollow">version incompatibility hazards</a>.</li>
<li>The &#34;Dependency Resolution with multiple versions?&#34; <a href="https://users.rust-lang.org/t/dependency-resolution-with-multiple-versions/81936" rel="nofollow">question</a> on the Rust language users forum (which was part of the motivation to create this example repo).</li>
</ul>
</article></div></div>
  </body>
</html>
