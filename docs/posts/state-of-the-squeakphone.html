<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://syndicate-lang.org/journal/2022/06/03/phone-progress">Original</a>
    <h1>State of the SqueakPhone</h1>
    
    <div id="readability-page-1" class="page"><div>
    <section>
      

<p>One of my projects over the past couple of years has been <a href="https://synit.org">Synit</a>, a
<em>Syn</em>dicate <em>init</em> (really, <code>systemd</code> and <code>D-Bus</code>) replacement. Synit underpins another
project, <em>#squeak-phone</em>, a sketch of an alternative to Android for personal computing on a
mobile device.</p>

<p>These are one-person projects at present, and the current round of development is coming to a
close. This is a summary of where things stand.</p>

<blockquote>
  <p><strong>Goals.</strong> Aim for a hackable, tweakable, pocket-sized Smalltalk system that’s also a phone.
Also, see what happens if we replace <code>systemd</code>, <code>D-Bus</code> etc with Syndicate-style
alternatives.</p>

  <p><strong>Outcomes.</strong> It runs! Smalltalk on a phone. Weird but fun alternative universe, not Android,
not systemd. You can make calls, send/receive SMS, use cellular data, WIFI, look at maps,
etc. No browser yet.</p>
</blockquote>



<p><span><a href="https://syndicate-lang.org/img/2022-06-03-phone-progress/edited/PXL_20220603_195230949.jpg"><img src="https://syndicate-lang.org/img/2022-06-03-phone-progress/scaled/PXL_20220603_195230949.jpg" alt="Synit on PostmarketOS boot splash screen."/></a><small>Synit on PostmarketOS boot splash screen.</small></span></p>

<p><a href="https://synit.org">Synit</a> is my experimental alternative “system layer” for Linux. I chose to
use my <em>#squeak-phone</em> project as the initial vehicle for exploring the idea.</p>

<p>Squeak-phone uses the <a href="https://synit.org/book/syndicated-actor-model.html">Syndicated Actor
Model</a> in conjunction with <a href="https://squeak.org/">Squeak
Smalltalk</a> and a few other bits of software to have a foundation for
exploring an alternative universe of mobile personal computing.</p>

<h2 id="links">Links</h2>

<p>I’ve written a few posts about it both <a href="https://syndicate-lang.org/journal/tag/squeak-phone/">on this site</a> and <a href="https://eighty-twenty.org/tag/squeak-phone/">on
eighty-twenty.org</a>). <a href="https://syndicate-lang.org/projects/2021/system-layer/">This page</a> outlines the portion of the project that was funded by
<a href="https://nlnet.nl/">NLNet</a>’s <a href="https://nlnet.nl/NGI0/">NGI Zero</a>. (Thanks, NLNet!) The Synit
project has <a href="https://synit.org/">a homepage at synit.org</a> now, with links to
<a href="https://synit.org/book/">documentation</a> and <a href="https://git.syndicate-lang.org/synit/">code</a>.
Common Syndicate parts of the project of course remain here at
<a href="https://syndicate-lang.org/">syndicate-lang.org</a> and in the <a href="https://git.syndicate-lang.org/syndicate-lang/">Syndicate git
repositories</a>.</p>

<h2 id="booting-linux-into-a-syndicated-world">Booting Linux into a Syndicated world</h2>

<p>The prototype Synit system is based on <a href="https://postmarketos.org/">postmarketOS</a>, which is an
<a href="https://www.alpinelinux.org/">Alpine Linux</a> distribution for cellphones. Synit adds a few
custom Alpine packages, <a href="https://git.syndicate-lang.org/synit/synit/src/branch/main/packaging/packages/synit-config">one of
which</a>
does unspeakable things to the normal postmarketOS packages to outright replace <code>/sbin/init</code>
with a Syndicate replacement.</p>

<p>The first thing the Syndicated <a href="https://git.syndicate-lang.org/synit/synit/src/branch/main/synit-pid1/src/main.rs">PID
1</a> does is
start a <a href="https://synit.org/book/operation/system-bus.html">syndicate-server</a> instance as the
root <em>system bus</em>, which then uses Erlang-style supervision patterns to spawn the rest of the
system.</p>

<h2 id="smalltalk-as-the-phone-ui">Smalltalk as the phone UI</h2>

<p><span><a href="https://syndicate-lang.org/img/2022-06-03-phone-progress/edited/PXL_20220603_195314653.jpg"><img src="https://syndicate-lang.org/img/2022-06-03-phone-progress/scaled/PXL_20220603_195314653.jpg" alt="After booting, the most-recently-saved Smalltalk image comes back to life."/></a><small>After booting, the most-recently-saved Smalltalk image comes back to life.</small></span></p>

<p>One of the actors started by the system bus is a Squeak Smalltalk image. The photo here shows
the Smalltalk image just after the phone completes booting: it has a Smalltalk workspace
visible, containing useful snippets of Smalltalk code for interacting with the phone that I can
execute with the tap of a (couple of) finger(s).</p>

<p>It’s a regular Smalltalk image, so I can make changes to the code, save snapshots, and so on.
When I reboot the phone, the most recent image snapshot is loaded.</p>

<h2 id="lots-of-languages-working-together">Lots of languages working together</h2>

<p>Both PID 1 and syndicate-server are written in Rust, but system actors can be written in any
language that speaks the <a href="https://synit.org/book/protocol.html">Syndicate protocol</a>; this
currently means TypeScript/JavaScript, Bash (!), Smalltalk, Python, Nim, Rust, and Racket.</p>

<h2 id="reactivity">Reactivity</h2>

<p>The system is <em>reactive</em>. It self-organises around the information placed in the system
dataspace. <a href="https://synit.org/book/guide/preserves.html">Schemas</a> are used to strongly
(dynamically) type the system.
<a href="https://synit.org/book/syndicated-actor-model.html#object-capabilities-for-access-control">Object-capabilities</a>
are used to secure the system. Various system actors react to changes in the machine’s
environment, such as (dis)appearance of WIFI SSIDs, hotplugging of devices, and so on.</p>

<p>For example, placing a <a href="https://preserves.dev/preserves.html#records">record</a>
<code>&lt;configure-interface &#34;lo&#34; &lt;static &#34;127.0.0.1/8&#34;&gt;&gt;</code> into the dataspace triggers an actor that
uses the <code>ip</code> command-line tool to set up the interface. Removing the record causes the same
actor to use <code>ip</code> again to tear the interface down. Likewise, addition of <code>&lt;configure-interface
&#34;eth0&#34; &lt;dhcp&gt;&gt;</code> causes startup of a DHCP client daemon; subsequent removal terminates the
daemon and removes the interface.</p>

<h2 id="squeak-phone-applications">Squeak-phone Applications</h2>

<p>One of the schemas,
<a href="https://git.syndicate-lang.org/synit/synit/src/branch/main/protocols/schemas/ui.prs">ui.prs</a>,
describes a Syndicate protocol for user interfaces. It’s a very rough sketch at the moment, and
woefully underdocumented - but here are a few “applications” written using it:</p>



<p>Each application is a Syndicate actor running either inside the Smalltalk image or as a
neighbouring process on the system, interacting with a Smalltalk UI daemon that speaks the
protocol defined in ui.prs.</p>

<p>The UI-presenting actors are separate from the actors that manage the underlying information,
such as the brightness status and control, or the details of the system’s current power status.</p>

<p>The on-screen keyboard is <a href="https://eighty-twenty.org/2021/04/20/on-screen-keyboard-morph">a simple Smalltalk
program</a>. The red, blue, and
yellow rectangles beneath the keyboard are shift-like keys used to change the interpretation of
a finger tap: they correspond to left, middle, and right-clicks, respectively.</p>

<p><span><a href="https://syndicate-lang.org/img/2022-06-03-phone-progress/edited/PXL_20220603_195511261.jpg"><img src="https://syndicate-lang.org/img/2022-06-03-phone-progress/scaled/PXL_20220603_195511261.jpg" alt="A tiled-map (&#34;slippy map&#34;) widget."/></a><small>A tiled-map (“slippy map”) widget.</small></span>
<span><a href="https://syndicate-lang.org/img/2022-06-03-phone-progress/edited/PXL_20220603_195528917.jpg"><img src="https://syndicate-lang.org/img/2022-06-03-phone-progress/scaled/PXL_20220603_195528917.jpg" alt="The placeholder &#34;apps&#34; menu, including both SqueakPhone and ordinary Squeak &#34;applications&#34;."/></a><small>The placeholder “apps” menu, including both SqueakPhone and ordinary Squeak “applications”.</small></span>
<span><a href="https://syndicate-lang.org/img/2022-06-03-phone-progress/edited/PXL_20220603_195553756.jpg"><img src="https://syndicate-lang.org/img/2022-06-03-phone-progress/scaled/PXL_20220603_195553756.jpg" alt="The ordinary Squeak preference browser."/></a><small>The ordinary Squeak preference browser.</small></span></p>

<p>A little Smalltalk program wraps a
<a href="https://eighty-twenty.org/2018/02/11/squeak-tiledmaps">TiledMapMorph</a> I wrote a few years ago
to provide a “map” application, backed by <a href="https://www.openstreetmap.org/">OpenStreetMap</a> by
default.</p>

<p>The system enables cellular data by default, so the maps can be used when you’re out and about.
You can configure WIFI SSID/password information, too, but you have to do it using a text
editor at the moment. There’s only one of me!</p>

<p>Finally, it’s still very much a regular Smalltalk system, with only the lightest of
customisation for handheld use. All the normal Squeak “applications” are available, such as
version control, code editing, font management, preference settings etc.</p>

<h2 id="lessons-learned">Lessons learned</h2>

<p>I think the experiment so far has been a success.</p>

<p>The big reusable pieces, likely to find application in other projects besides the continuation
of this one, are <a href="https://preserves.dev/">Preserves</a>, <a href="https://preserves.dev/preserves-schema.html">Preserves
Schema</a>, the <a href="https://synit.org/book/syndicated-actor-model.html">Syndicated Actor
Model</a> itself, and the
<a href="https://git.syndicate-lang.org/syndicate-lang/syndicate-rs/">syndicate-server</a> program.</p>

<p>The idea of synit—using Syndicate as a system layer, replacing <code>D-Bus</code>, <code>systemd</code> and so on—has
worked out really well, and I want to try it out for desktop and server systems, too.</p>

<p>Smalltalk-on-a-phone is also really promising, and it’s super fun to be able to hack about with
the phone without needing a separate desktop/laptop system to develop on. However, careful
design of both the user interfaces as well as the underlying system protocols will be crucial
to actually make a usable and securable system. The system-layer stuff is simple in comparison.</p>

<p>Lots remains to be done. I’m looking forward to it!</p>

    </section>
  </div></div>
  </body>
</html>
