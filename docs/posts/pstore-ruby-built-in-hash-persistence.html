<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/ruby/pstore">Original</a>
    <h1>Pstore: Ruby Built-In Hash Persistence</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">PStore implements a file based persistence mechanism based on a Hash.  User
code can store hierarchies of Ruby objects (values) into the data store file
by name (keys).  An object hierarchy may be just a single object.  User code
may later read values back from the data store or even update data, as needed.</p>
<p dir="auto">The transactional behavior ensures that any changes succeed or fail together.
This can be used to ensure that the data store is not left in a transitory
state, where some values were updated but others were not.</p>
<p dir="auto">Behind the scenes, Ruby objects are stored to the data store file with
Marshal.  That carries the usual limitations.  Proc objects cannot be
marshalled, for example.</p>
<h2 dir="auto"><a id="user-content-installation" aria-hidden="true" href="#installation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Installation</h2>
<p dir="auto">Add this line to your application&#39;s Gemfile:</p>

<p dir="auto">And then execute:</p>

<p dir="auto">Or install it yourself as:</p>

<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Usage</h2>
<div dir="auto" data-snippet-clipboard-copy-content="require &#34;pstore&#34;

# a mock wiki object...
class WikiPage
  def initialize( page_name, author, contents )
    @page_name = page_name
    @revisions = Array.new

    add_revision(author, contents)
  end

  attr_reader :page_name

  def add_revision( author, contents )
    @revisions &lt;&lt; { :created  =&gt; Time.now,
                    :author   =&gt; author,
                    :contents =&gt; contents }
  end

   def wiki_page_references
    [@page_name] + @revisions.last[:contents].scan(/\b(?:[A-Z]+[a-z]+){2,}/)
  end

   # ...
end

# create a new page...
home_page = WikiPage.new( &#34;HomePage&#34;, &#34;James Edward Gray II&#34;,
                          &#34;A page about the JoysOfDocumentation...&#34; )

 # then we want to update page data and the index together, or not at all...
wiki = PStore.new(&#34;wiki_pages.pstore&#34;)
wiki.transaction do  # begin transaction; do all of this or none of it
  # store page...
  wiki[home_page.page_name] = home_page
  # ensure that an index has been created...
  wiki[:wiki_index] ||= Array.new
  # update wiki index...
  wiki[:wiki_index].push(*home_page.wiki_page_references)
end                   # commit changes to wiki data store file

 ### Some time later... ###

 # read wiki data...
wiki.transaction(true) do  # begin read-only transaction, no changes allowed
  wiki.roots.each do |data_root_name|
    p data_root_name
    p wiki[data_root_name]
  end
end"><pre><span>require</span> <span>&#34;pstore&#34;</span>

<span># a mock wiki object...</span>
<span>class</span> <span>WikiPage</span>
  <span>def</span> <span>initialize</span><span>(</span> <span>page_name</span><span>,</span> <span>author</span><span>,</span> <span>contents</span> <span>)</span>
    <span>@page_name</span> <span>=</span> <span>page_name</span>
    <span>@revisions</span> <span>=</span> <span>Array</span><span>.</span><span>new</span>

    <span>add_revision</span><span>(</span><span>author</span><span>,</span> <span>contents</span><span>)</span>
  <span>end</span>

  <span>attr_reader</span> <span>:page_name</span>

  <span>def</span> <span>add_revision</span><span>(</span> <span>author</span><span>,</span> <span>contents</span> <span>)</span>
    <span>@revisions</span> &lt;&lt; <span>{</span> <span>:created</span>  <span>=&gt;</span> <span>Time</span><span>.</span><span>now</span><span>,</span>
                    <span>:author</span>   <span>=&gt;</span> <span>author</span><span>,</span>
                    <span>:contents</span> <span>=&gt;</span> <span>contents</span> <span>}</span>
  <span>end</span>

   <span>def</span> <span>wiki_page_references</span>
    <span>[</span><span>@page_name</span><span>]</span> + <span>@revisions</span><span>.</span><span>last</span><span>[</span><span>:contents</span><span>]</span><span>.</span><span>scan</span><span>(</span><span>/<span>\b</span>(?:[A-Z]+[a-z]+){2,}/</span><span>)</span>
  <span>end</span>

   <span># ...</span>
<span>end</span>

<span># create a new page...</span>
<span>home_page</span> <span>=</span> <span>WikiPage</span><span>.</span><span>new</span><span>(</span> <span>&#34;HomePage&#34;</span><span>,</span> <span>&#34;James Edward Gray II&#34;</span><span>,</span>
                          <span>&#34;A page about the JoysOfDocumentation...&#34;</span> <span>)</span>

 <span># then we want to update page data and the index together, or not at all...</span>
<span>wiki</span> <span>=</span> <span>PStore</span><span>.</span><span>new</span><span>(</span><span>&#34;wiki_pages.pstore&#34;</span><span>)</span>
<span>wiki</span><span>.</span><span>transaction</span> <span>do</span>  <span># begin transaction; do all of this or none of it</span>
  <span># store page...</span>
  <span>wiki</span><span>[</span><span>home_page</span><span>.</span><span>page_name</span><span>]</span> <span>=</span> <span>home_page</span>
  <span># ensure that an index has been created...</span>
  <span>wiki</span><span>[</span><span>:wiki_index</span><span>]</span> ||= <span>Array</span><span>.</span><span>new</span>
  <span># update wiki index...</span>
  <span>wiki</span><span>[</span><span>:wiki_index</span><span>]</span><span>.</span><span>push</span><span>(</span>*<span>home_page</span><span>.</span><span>wiki_page_references</span><span>)</span>
<span>end</span>                   <span># commit changes to wiki data store file</span>

 <span>### Some time later... ###</span>

 <span># read wiki data...</span>
<span>wiki</span><span>.</span><span>transaction</span><span>(</span><span>true</span><span>)</span> <span>do</span>  <span># begin read-only transaction, no changes allowed</span>
  <span>wiki</span><span>.</span><span>roots</span><span>.</span><span>each</span> <span>do</span> |<span>data_root_name</span>|
    <span>p</span> <span>data_root_name</span>
    <span>p</span> <span>wiki</span><span>[</span><span>data_root_name</span><span>]</span>
  <span>end</span>
<span>end</span></pre></div>
<h2 dir="auto"><a id="user-content-development" aria-hidden="true" href="#development"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Development</h2>
<p dir="auto">After checking out the repo, run <code>bin/setup</code> to install dependencies. Then, run <code>rake test</code> to run the tests. You can also run <code>bin/console</code> for an interactive prompt that will allow you to experiment.</p>
<p dir="auto">To install this gem onto your local machine, run <code>bundle exec rake install</code>. To release a new version, update the version number in <code>version.rb</code>, and then run <code>bundle exec rake release</code>, which will create a git tag for the version, push git commits and tags, and push the <code>.gem</code> file to <a href="https://rubygems.org" rel="nofollow">rubygems.org</a>.</p>
<h2 dir="auto"><a id="user-content-contributing" aria-hidden="true" href="#contributing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Contributing</h2>
<p dir="auto">Bug reports and pull requests are welcome on GitHub at <a href="https://github.com/ruby/pstore">https://github.com/ruby/pstore</a>.</p>
</article>
          </div></div>
  </body>
</html>
