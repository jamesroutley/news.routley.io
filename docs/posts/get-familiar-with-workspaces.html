<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://go.dev/blog/get-familiar-with-workspaces">Original</a>
    <h1>Get familiar with workspaces</h1>
    
    <div id="readability-page-1" class="page"><div data-slug="/blog/get-familiar-with-workspaces">
    
    
    

    
      
      
      
      <p>Go 1.18 adds workspace mode to Go, which lets you work on multiple modules
simultaneously.</p>
<p>You can get Go 1.18 by visiting the <a href="https://go.dev/dl/" rel="noreferrer" target="_blank">download</a> page. The
<a href="https://go.dev/doc/go1.18" rel="noreferrer" target="_blank">release notes</a> have more details about all the
changes.</p>
<h2 id="workspaces">Workspaces</h2>
<p><a href="https://go.dev/ref/mod#workspaces" rel="noreferrer" target="_blank">Workspaces</a> in Go 1.18 let you work on
multiple modules simultaneously without having to edit <code>go.mod</code> files for each
module. Each module within a workspace is treated as a root module when
resolving dependencies.</p>
<p>Previously, to add a feature to one module and use it in another module, you
needed to either publish the changes to the first module, or <a href="https://go.dev/doc/tutorial/call-module-code" rel="noreferrer" target="_blank">edit the
go.mod</a> file of the dependent
module with a <code>replace</code> directive for your local, unpublished module changes. In
order to publish without errors, you had to remove the <code>replace</code> directive from
the dependent module’s <code>go.mod</code> file after you published the local changes to
the first module.</p>
<p>With Go workspaces, you control all your dependencies using a <code>go.work</code> file in
the root of your workspace directory. The <code>go.work</code> file has <code>use</code> and
<code>replace</code> directives that override the individual <code>go.mod</code> files, so there is
no need to
edit each <code>go.mod</code> file individually.</p>
<p>You create a workspace by running <code>go work init</code> with a list of module
directories as space-separated arguments. The workspace doesn’t need to contain
the modules you’re working with. The<code> init</code> command creates a <code>go.work</code> file
that lists modules in the workspace.  If you run <code>go work init</code> without
arguments, the command creates an empty workspace.</p>
<p>To add modules to the workspace, run <code> go work use [moddir]</code> or manually edit
the <code>go.work</code> file. Run <code>go work use -r</code> to recursively add directories in the
argument directory with a <code>go.mod</code> file to your workspace. If a directory
doesn’t have a <code>go.mod</code> file, or no longer exists, the <code>use</code> directive for that
directory is removed from your <code>go.work</code> file.</p>
<p>The syntax of a <code>go.work</code> file is similar to a <code>go.mod</code> file and contains the
following directives:</p>
<ul>
<li><code>go</code>: the go toolchain version e.g. <code>go 1.18</code></li>
<li><code>use</code>: adds a module on disk to the set of main modules in a workspace.
Its argument is a relative path to the directory containing the module’s
<code>go.mod</code> file. A <code>use</code> directive doesn’t add modules in subdirectories of
the specified directory.</li>
<li><code>replace</code>: Similar to a <code>replace</code> directive in a <code>go.mod</code> file, a
<code>replace</code> directive in a <code>go.work</code> file replaces the contents of a
<em>specific version</em> of a module, or <em>all versions</em> of a module, with
contents found elsewhere.</li>
</ul>
<h2 id="workflows">Workflows</h2>
<p>Workspaces are flexible and support a variety of workflows. The following
sections are a brief overview of the ones we think will be the most common.</p>
<h3 id="add-a-feature-to-an-upstream-module-and-use-it-in-your-own-module">Add a feature to an upstream module and use it in your own module</h3>
<ol>
<li>
<p>Create a directory for your workspace.</p>
</li>
<li>
<p>Clone the upstream module you want to edit. If you haven’t contributed to
Go before, read the <a href="https://go.dev/doc/contribute" rel="noreferrer" target="_blank">contribution guide</a>.</p>
</li>
<li>
<p>Add your feature to the local version of the upstream module.</p>
</li>
<li>
<p>Run <code>go work init [path-to-upstream-mod-dir]</code> in the workspace folder.</p>
</li>
<li>
<p>Make changes to your own module in order to implement the feature added
to the upstream module.</p>
</li>
<li>
<p>Run <code>go work use [path-to-your-module]</code> in the workspace folder.</p>
<p>The <code>go work use</code> command adds the path to your module to your <code>go.work</code>
file:</p>
<pre><code>go 1.18

use (
       ./path-to-upstream-mod-dir
       ./path-to-your-module
)
</code></pre>
</li>
<li>
<p>Run and test your module using the new feature added to the upstream module.</p>
</li>
<li>
<p>Publish the upstream module with the new feature.</p>
</li>
<li>
<p>Publish your module using the new feature.</p>
</li>
</ol>
<h3 id="work-with-multiple-interdependent-modules-in-the-same-repository">Work with multiple interdependent modules in the same repository</h3>
<p>While working on multiple modules in the same repository, the <code>go.work</code> file
defines the workspace instead of using <code>replace</code> directives in each module’s
<code>go.mod</code> file.</p>
<ol>
<li>
<p>Create a directory for your workspace.</p>
</li>
<li>
<p>Clone the repository with the modules you want to edit. The modules don’t
have to be in your workspace folder as you specify the relative path to
each with the <code>use</code> directive.</p>
</li>
<li>
<p>Run <code>go work init [path-to-module-one] [path-to-module-two]</code> in your
workspace directory.</p>
<p>Example: You are working on <code>example.com/x/tools/groundhog</code> which depends
on other packages in the <code>example.com/x/tools</code> module.</p>
<p>You clone the repository and then run <code>go work init tools tools/groundhog</code> in
your workspace folder.</p>
<p>The contents of your <code>go.work</code> file resemble the following:</p>
<pre><code>go 1.18

use (
        ./tools
        ./tools/groundhog
)
</code></pre>
<p>Any local changes made in the <code>tools</code> module will be used by
<code>tools/groundhog</code> in your workspace.</p>
</li>
</ol>
<h3 id="switching-between-dependency-configurations">Switching between dependency configurations</h3>
<p>To test your modules with different dependency configurations you can either
create multiple workspaces with separate <code>go.work</code> files, or keep one workspace
and comment out the <code>use</code> directives you don’t want in a single <code>go.work</code>
file.</p>
<p>To create multiple workspaces:</p>
<ol>
<li>Create separate directories for different dependency needs.</li>
<li>Run <code>go work init</code> in each of your workspace directories.</li>
<li>Add the dependencies you want within each directory via <code>go work use [path-to-dependency]</code>.</li>
<li>Run <code>go run [path-to-your-module]</code> in each workspace directory to use the
dependencies specified by its <code>go.work</code> file.</li>
</ol>
<p>To test out different dependencies within the same workspace, open the <code>go.work</code>
file and add or comment out the desired dependencies.</p>
<h3 id="still-using-gopath">Still using GOPATH?</h3>
<p>Maybe using workspaces will change your mind. <code>GOPATH</code> users can resolve their
dependencies using a <code>go.work</code> file located at the base of their <code>GOPATH</code>
directory. Workspaces don’t aim to completely recreate all <code>GOPATH</code> workflows,
but they can create a setup that shares some of the convenience of <code>GOPATH</code>
while still providing the benefits of modules.</p>
<p>To create a workspace for GOPATH:</p>
<ol>
<li>Run <code>go work init</code> in the root of your <code>GOPATH</code> directory.</li>
<li>To use a local module or specific version as a dependency in your
workspace, run <code>go work use [path-to-module]</code>.</li>
<li>To replace existing dependencies in your modules&#39; <code>go.mod</code> files use
<code>go work replace [path-to-module]</code>.</li>
<li>To add all the modules in your GOPATH or any directory, run <code>go work use -r</code> to recursively add directories with a <code>go.mod</code> file to your workspace.
If a directory doesn’t have a <code>go.mod</code> file, or no longer exists, the <code>use</code>
directive for that directory is removed from your <code>go.work</code> file.</li>
</ol>
<blockquote>
<p>Note: If you have projects without <code>go.mod</code> files that you want to add to
the workspace, change into their project directory and run <code>go mod init</code>,
then add the new module to your workspace with <code>go work use [path-to-module].</code></p>
</blockquote>
<h2 id="workspace-commands">Workspace commands</h2>
<p>Along with <code>go work init</code> and <code>go work use</code>, Go 1.18 introduces the following
commands for workspaces:</p>
<ul>
<li><code>go work sync</code>: pushes the dependencies in the <code>go.work</code> file back into
the <code>go.mod</code> files of each workspace module.</li>
<li><code>go work edit</code>: provides a command-line interface for editing <code>go.work</code>,
for use primarily by tools or scripts.</li>
</ul>
<p>Module-aware build commands and some <code>go mod</code> subcommands examine the <code>GOWORK</code>
environment variable to determine if they are in a workspace context.</p>
<p>Workspace mode is enabled if the <code>GOWORK</code> variable names a path to a file that
ends in <code>.work</code>. To determine which <code>go.work</code> file is being used, run
<code>go env GOWORK</code>. The output is empty if the <code>go</code> command is not in workspace
mode.</p>
<p>When workspace mode is enabled, the <code>go.work</code> file is parsed to determine the
three parameters for workspace mode: A Go version, a list of directories, and a
list of replacements.</p>
<p>Some commands to try in workspace mode (provided you already know what they
do!):</p>
<pre><code>go work init
go work sync
go work use
go list
go build
go test
go run
go vet
</code></pre>
<h2 id="editor-experience-improvements">Editor experience improvements</h2>
<p>We’re particularly excited about the upgrades to Go’s language server
<a href="https://pkg.go.dev/golang.org/x/tools/gopls" rel="noreferrer" target="_blank">gopls</a> and the
<a href="https://marketplace.visualstudio.com/items?itemName=golang.go" rel="noreferrer" target="_blank">VSCode Go extension</a>
that make working with multiple modules in an LSP-compatible editor a smooth
and rewarding experience.</p>
<p>Find references, code completion, and go to definitions work across modules
within the workspace. Version <a href="https://github.com/golang/tools/releases/tag/gopls%2Fv0.8.1" rel="noreferrer" target="_blank">0.8.1</a>
of <code>gopls</code> introduces diagnostics, completion, formatting, and hover for
<code>go.work</code> files. You can take advantage of these gopls features with any
<a href="https://microsoft.github.io/language-server-protocol/" rel="noreferrer" target="_blank">LSP</a>-compatible editor.</p>
<h4 id="editor-specific-notes">Editor specific notes</h4>
<ul>
<li>The latest <a href="https://github.com/golang/vscode-go/releases/tag/v0.32.0" rel="noreferrer" target="_blank">vscode-go
release</a> allows
quick access to your workspace’s <code>go.work</code> file via the Go status bar’s
Quick Pick menu.</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/4999471/157268414-fba63843-5a14-44ba-be82-d42765568856.gif" alt="Access the go.work file via the Go status bar&amp;rsquo;s Quick Pick menu"/></p>
<ul>
<li><a href="https://www.jetbrains.com/go/" rel="noreferrer" target="_blank">GoLand</a> supports workspaces and has
plans to add syntax highlighting and code completion for <code>go.work</code> files.</li>
</ul>
<p>For more information on using <code>gopls</code> with different editors see the <code>gopls</code><a href="https://pkg.go.dev/golang.org/x/tools/gopls#readme-editors" rel="noreferrer" target="_blank">
documentation</a>.</p>
<h2 id="whats-next">What’s next?</h2>
<ul>
<li>Download and install <a href="https://go.dev/dl/" rel="noreferrer" target="_blank">Go 1.18</a>.</li>
<li>Try using <a href="https://go.dev/ref/mod#workspaces" rel="noreferrer" target="_blank">workspaces</a> with the <a href="https://go.dev/doc/tutorial/workspaces" rel="noreferrer" target="_blank">Go
workspaces Tutorial</a>.</li>
<li>If you encounter any problems with workspaces, or want to suggest
something, file an <a href="https://github.com/golang/go/issues/new/choose" rel="noreferrer" target="_blank">issue</a>.</li>
<li>Read the
<a href="https://pkg.go.dev/cmd/go#hdr-Workspace_maintenance" rel="noreferrer" target="_blank">workspace maintenance documentation</a>.</li>
<li>Explore module commands for <a href="https://go.dev/ref/mod#commands-outside" rel="noreferrer" target="_blank">working outside of a single
module</a> including <code>go work init</code>,
<code>go work sync</code> and more.</li>
</ul>

    </div></div>
  </body>
</html>
