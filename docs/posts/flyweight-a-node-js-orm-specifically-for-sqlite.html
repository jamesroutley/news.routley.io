<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/thebinarysearchtree/flyweight">Original</a>
    <h1>Flyweight: A Node.js ORM Specifically for SQLite</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">An ORM for SQLite and NodeJS. Flyweight combines a very simple API for performing basic operations, with the ability to create SQL queries that are parsed by the ORM.</p>
<p dir="auto">For example, if you create a query in <code>./database/sql/users/roles.sql</code> that looks like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="select
    u.id,
    u.name,
    groupArray(r.name) as roles
from
    users u join
    userRoles ur on ur.userId = u.id join
    roles r on ur.roleId = r.id
where 
    u.name = $name
group by 
    u.id"><pre><span>select</span>
    <span>u</span>.<span>id</span>,
    <span>u</span>.<span>name</span>,
    groupArray(<span>r</span>.<span>name</span>) <span>as</span> roles
<span>from</span>
    users u <span>join</span>
    userRoles ur <span>on</span> <span>ur</span>.<span>userId</span> <span>=</span> <span>u</span>.<span>id</span> <span>join</span>
    roles r <span>on</span> <span>ur</span>.<span>roleId</span> <span>=</span> <span>r</span>.<span>id</span>
<span>where</span> 
    <span>u</span>.<span>name</span> <span>=</span> $name
<span>group by</span> 
    <span>u</span>.<span>id</span></pre></div>
<p dir="auto">A function <code>db.users.roles</code> will be available in the API with the correct types.</p>
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/thebinarysearchtree/flyweight/blob/main/hero.png"><img src="https://github.com/thebinarysearchtree/flyweight/raw/main/hero.png" alt="auto-completed code"/></a></p>

<div dir="auto" data-snippet-clipboard-copy-content="object(
    u.id, 
    u.name, 
    u.social) as user"><pre>object(
    <span>u</span>.<span>id</span>, 
    <span>u</span>.<span>name</span>, 
    <span>u</span>.<span>social</span>) <span>as</span> user</pre></div>
<p dir="auto">is just shorthand for</p>
<div dir="auto" data-snippet-clipboard-copy-content="json_object(
    &#39;id&#39;, u.id, 
    &#39;name&#39;, u.name, 
    &#39;social&#39;, u.social) as user"><pre>json_object(
    <span><span>&#39;</span>id<span>&#39;</span></span>, <span>u</span>.<span>id</span>, 
    <span><span>&#39;</span>name<span>&#39;</span></span>, <span>u</span>.<span>name</span>, 
    <span><span>&#39;</span>social<span>&#39;</span></span>, <span>u</span>.<span>social</span>) <span>as</span> user</pre></div>
<p dir="auto">Other commands available are <code>groupArray</code> which is shorthand for <code>json_group_array</code>, and <code>array</code>, which is shorthand for <code>json_array</code>.</p>

<p dir="auto">Normally, SQLite doesn&#39;t support aliased stars, but this syntax is now available when writing SQL statements with Flyweight.</p>
<div dir="auto" data-snippet-clipboard-copy-content="select
    e.*,
    l.name as locationName
from 
    events e join
    locations l on e.locationId = l.id"><pre><span>select</span>
    e.<span>*</span>,
    <span>l</span>.<span>name</span> <span>as</span> locationName
<span>from</span> 
    events e <span>join</span>
    locations l <span>on</span> <span>e</span>.<span>locationId</span> <span>=</span> <span>l</span>.<span>id</span></pre></div>

<p dir="auto">Tables are created the same way as they are in SQL. The native types available in strict mode are <code>integer</code>, <code>real</code>, <code>text</code>, <code>blob</code>, and <code>any</code>. In addition to these types, four additional types are included by default: <code>boolean</code>, <code>date</code>, and <code>json</code>. <code>boolean</code> is a column in which the values are restricted to 1 or 0, <code>date</code> is a JavaScript <code>Date</code> stored as an ISO8601 string, and <code>json</code> is json stored as text. These additional types are automatically parsed by the ORM.</p>
<div dir="auto" data-snippet-clipboard-copy-content="create table events (
    id integer primary key,
    name text not null,
    startTime date not null,
    locationId integer references locations
);"><pre><span>create</span> <span>table</span> <span>events</span> (
    id <span>integer</span> <span>primary key</span>,
    name <span>text</span> <span>not null</span>,
    startTime <span>date</span> <span>not null</span>,
    locationId <span>integer</span> <span>references</span> locations
);</pre></div>
<p dir="auto">Each table has a singular and plural form. If you want to get one row with the basic API, you can use:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const event = await db.event.get({ id: 100 });"><pre><span>const</span> <span>event</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>event</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>id</span>: <span>100</span> <span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">If you want to get many rows, you can use:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const names = await db.events.get({ id: eventIds }, &#39;name&#39;);"><pre><span>const</span> <span>names</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>events</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>id</span>: <span>eventIds</span> <span>}</span><span>,</span> <span>&#39;name&#39;</span><span>)</span><span>;</span></pre></div>
<p dir="auto">If you want to insert a row, you can do:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const id = await db.coach.insert({
  name: &#39;Eugene Bareman&#39;,
  city: &#39;Auckland&#39;
});"><pre><span>const</span> <span>id</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>coach</span><span>.</span><span>insert</span><span>(</span><span>{</span>
  <span>name</span>: <span>&#39;Eugene Bareman&#39;</span><span>,</span>
  <span>city</span>: <span>&#39;Auckland&#39;</span>
<span>}</span><span>)</span><span>;</span></pre></div>

<div data-snippet-clipboard-copy-content="mkdir test
cd test
npm init
npx create-flyweight database"><pre><code>mkdir test
cd test
npm init
npx create-flyweight database
</code></pre></div>
<p dir="auto">You can run the <code>npx</code> command at the root of either an existing or a new project. Once that is done, you can import the database this way:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { db } from &#39;./database/db.js&#39;;

await db.user.insert({ name: &#39;Andrew&#39; });
const users = await db.users.get();
console.log(users);"><pre><span>import</span> <span>{</span> <span>db</span> <span>}</span> <span>from</span> <span>&#39;./database/db.js&#39;</span><span>;</span>

<span>await</span> <span>db</span><span>.</span><span>user</span><span>.</span><span>insert</span><span>(</span><span>{</span> <span>name</span>: <span>&#39;Andrew&#39;</span> <span>}</span><span>)</span><span>;</span>
<span>const</span> <span>users</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>users</span><span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>
<span>console</span><span>.</span><span>log</span><span>(</span><span>users</span><span>)</span><span>;</span></pre></div>
<p dir="auto">A <code>users</code> table has already been created for you to play around with.</p>
<p dir="auto">You can update types whenever you change the SQL by either calling <code>npm run watch</code> to automatically update the types, or <code>npm run types</code> to do it manually.</p>

<p dir="auto">Tables are defined in <code>./database/sql/tables.sql</code>. You can add or change tables from here and then run the migration command <code>npm run migrate &lt;migration-name&gt;</code>.</p>
<p dir="auto">If you want to add a new column to a table without needing to drop the table, make sure you put the column at the end of the list of columns.</p>

<p dir="auto">Flyweight supports regular expressions in some of its methods. These regular expressions are converted to <code>like</code> statements, which limits what kind of regular expressions you can make.</p>
<div dir="auto" data-snippet-clipboard-copy-content="const coach = await db.coach.get({ name: /^Eugene.+/ });"><pre><span>const</span> <span>coach</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>coach</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>name</span>: <span><span>/</span>^Eugene.+<span>/</span></span> <span>}</span><span>)</span><span>;</span></pre></div>

<p dir="auto">Default values can be set for boolean and date columns using the following syntax:</p>
<div dir="auto" data-snippet-clipboard-copy-content="create table users (
  id integer primary key,
  isDisabled boolean not null default false,
  createdAt date not null default now()
);"><pre><span>create</span> <span>table</span> <span>users</span> (
  id <span>integer</span> <span>primary key</span>,
  isDisabled <span>boolean</span> <span>not null</span> default false,
  createdAt <span>date</span> <span>not null</span> default now()
);</pre></div>
<p dir="auto"><code>current_timestamp</code> will not work properly when wanting to set the default date to the current time. This is because <code>current_timestamp</code> does not include timezone information and therefore when parsing the date string from the database, JavaScript will assume it is in local time when it is in fact in UTC time.</p>

<p dir="auto">Every table has <code>get</code>, <code>update</code>, <code>insert</code>, and <code>remove</code> methods available to it, along with any of the custom methods that are created when you add a new SQL file to the corresponding table&#39;s folder. Views only have the <code>get</code> method available to them.</p>

<p dir="auto"><code>insert</code> simply takes one argument - <code>params</code>, with the keys and values corresponding to the column names and values you want to insert. It returns the primary key, or part of the primary key if the table has a composite primary key. The plural version of <code>insert</code> is for batch inserts and takes an array of <code>params</code>. It doesn&#39;t return anything.</p>

<p dir="auto"><code>update</code> takes two arguments - the <code>query</code> (or null), and the <code>params</code> you want to update. It returns a number representing the number of rows that were affected by the query. For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="await db.coach.update({ id: 100 }, { city: &#39;Brisbane&#39; });"><pre><span>await</span> <span>db</span><span>.</span><span>coach</span><span>.</span><span>update</span><span>(</span><span>{</span> <span>id</span>: <span>100</span> <span>}</span><span>,</span> <span>{</span> <span>city</span>: <span>&#39;Brisbane&#39;</span> <span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">which corresponds to</p>
<div dir="auto" data-snippet-clipboard-copy-content="update coaches set city = &#39;Brisbane&#39; where id = 100;"><pre><span>update</span> coaches <span>set</span> city <span>=</span> <span><span>&#39;</span>Brisbane<span>&#39;</span></span> <span>where</span> id <span>=</span> <span>100</span>;</pre></div>

<p dir="auto"><code>get</code> takes two optional arguments. The first is <code>params</code> - an object representing the where clause. For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const fights = await db.fights.get({ cardId: 9, titleFight: true });"><pre><span>const</span> <span>fights</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>fights</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>cardId</span>: <span>9</span><span>,</span> <span>titleFight</span>: <span>true</span> <span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">translates to</p>
<div dir="auto" data-snippet-clipboard-copy-content="select * from fights where cardId = 9 and titleFight = 1;"><pre><span>select</span> <span>*</span> <span>from</span> fights <span>where</span> cardId <span>=</span> <span>9</span> <span>and</span> titleFight <span>=</span> <span>1</span>;</pre></div>
<p dir="auto">The keys to <code>params</code> must be the column names of the table. The values can either be of the same type as the column, an array of values that are the same type as the column, null, or a regular expression if the column is text. If an array is passed in, an <code>in</code> clause is used, such as:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const fights = await db.fights.get({ cardId: [1, 2, 3] });"><pre><span>const</span> <span>fights</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>fights</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>cardId</span>: <span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>]</span> <span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">which translates to</p>
<div dir="auto" data-snippet-clipboard-copy-content="select * from fights where cardId in (1, 2, 3);"><pre><span>select</span> <span>*</span> <span>from</span> fights <span>where</span> cardId <span>in</span> (<span>1</span>, <span>2</span>, <span>3</span>);</pre></div>
<p dir="auto">If null is passed in as the value, the SQL will use <code>is null</code>. If a regular expression is passed in, the SQL will use <code>like</code>.</p>
<p dir="auto">All of the arguments are passed in as parameters for security reasons.</p>
<p dir="auto">The second argument to <code>get</code> can be one of three possible values:</p>
<ol dir="auto">
<li>a string representing a column to select. In this case, the result returned is a single value or array of single values, depending on whether a plural or singular table name is used in the query.</li>
<li>an array of strings, representing the columns to select.</li>
<li>An object with one or more of the following properties:</li>
</ol>
<p dir="auto"><code>select</code> or <code>exclude</code>: <code>select</code> can be a string or array representing the columns to select. <code>exclude</code> can be an array of columns to exclude, with all of the other columns being selected.</p>
<p dir="auto"><code>orderBy</code>: a string representing the column to order the result by, or an array of columns to order the result by.</p>
<p dir="auto"><code>desc</code>: set to true when using <code>orderBy</code> if you want the results in descending order.</p>
<p dir="auto"><code>limit</code> and <code>offset</code>: corresponding to the SQL keywords with the same name.</p>
<p dir="auto"><code>distinct</code>: adds the <code>distinct</code> keywords to the start of the select clause.</p>
<p dir="auto">For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="const fighters = await db.fighters.get({ isActive: true }, {
  select: [&#39;name&#39;, &#39;hometown&#39;],
  orderBy: &#39;reachCm&#39;,
  limit: 10
});"><pre><span>const</span> <span>fighters</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>fighters</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>isActive</span>: <span>true</span> <span>}</span><span>,</span> <span>{</span>
  <span>select</span>: <span>[</span><span>&#39;name&#39;</span><span>,</span> <span>&#39;hometown&#39;</span><span>]</span><span>,</span>
  <span>orderBy</span>: <span>&#39;reachCm&#39;</span><span>,</span>
  <span>limit</span>: <span>10</span>
<span>}</span><span>)</span><span>;</span></pre></div>
<p dir="auto">While the default interpretation of the query parameters is <code>=</code>, you can modify the meaning by importing <code>not</code>, <code>gt</code>, <code>gte</code>, <code>lt</code>, and <code>lte</code>.</p>
<p dir="auto">For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { not } from &#39;flyweightjs&#39;;

const excluded = [1, 2, 3];
const users = await db.users.get({ id: not(excluded) });"><pre><span>import</span> <span>{</span> <span>not</span> <span>}</span> <span>from</span> <span>&#39;flyweightjs&#39;</span><span>;</span>

<span>const</span> <span>excluded</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>]</span><span>;</span>
<span>const</span> <span>users</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>users</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>id</span>: <span>not</span><span>(</span><span>excluded</span><span>)</span> <span>}</span><span>)</span><span>;</span></pre></div>

<p dir="auto">These functions take one argument representing the where clause.</p>
<div dir="auto" data-snippet-clipboard-copy-content="const count = await db.fighters.count({ hometown: &#39;Brisbane, Australia&#39; });
const exists = await db.fighter.exists({ name: &#39;Israel Adesanya&#39; });"><pre><span>const</span> <span>count</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>fighters</span><span>.</span><span>count</span><span>(</span><span>{</span> <span>hometown</span>: <span>&#39;Brisbane, Australia&#39;</span> <span>}</span><span>)</span><span>;</span>
<span>const</span> <span>exists</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>fighter</span><span>.</span><span>exists</span><span>(</span><span>{</span> <span>name</span>: <span>&#39;Israel Adesanya&#39;</span> <span>}</span><span>)</span><span>;</span></pre></div>

<p dir="auto"><code>remove</code> takes one argument representing the where clause and returns the number of rows affected by the query.</p>
<div dir="auto" data-snippet-clipboard-copy-content="const changes = await db.fighters.remove({ id: 100 });"><pre><span>const</span> <span>changes</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>fighters</span><span>.</span><span>remove</span><span>(</span><span>{</span> <span>id</span>: <span>100</span> <span>}</span><span>)</span><span>;</span></pre></div>

<p dir="auto">When creating SQL queries, make sure you give an alias to any columns in the select statement that don&#39;t have a name. For example, do not do:</p>
<div dir="auto" data-snippet-clipboard-copy-content="select max(startTime) from events;"><pre><span>select</span> <span>max</span>(startTime) <span>from</span> events;</pre></div>
<p dir="auto">as there is no name given to <code>max(startTime)</code>.</p>
<p dir="auto">Parameters in SQL files should use the <code>$name</code> notation. If you want to include dynamic content that cannot be parameterized, you should use the <code>${column}</code> format and then pass in a second argument when calling the SQL statement in JavaScript. For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="select * from users where location = $location order by ${column};"><pre><span>select</span> <span>*</span> <span>from</span> users <span>where</span> location <span>=</span> $location <span>order by</span> ${column};</pre></div>
<div dir="auto" data-snippet-clipboard-copy-content="const options = {
  unsafe: {
    column: &#39;lastName&#39;
  }
};
const users = await db.users.from({ location: &#39;Brisbane&#39; }, options);"><pre><span>const</span> <span>options</span> <span>=</span> <span>{</span>
  <span>unsafe</span>: <span>{</span>
    <span>column</span>: <span>&#39;lastName&#39;</span>
  <span>}</span>
<span>}</span><span>;</span>
<span>const</span> <span>users</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>users</span><span>.</span><span>from</span><span>(</span><span>{</span> <span>location</span>: <span>&#39;Brisbane&#39;</span> <span>}</span><span>,</span> <span>options</span><span>)</span><span>;</span></pre></div>
<p dir="auto">If the unsafe parameter is <code>undefined</code> in the options argument, it will be removed from the SQL statement.</p>
<p dir="auto">Single quotes in strings should be escaped with <code>\</code>. JSON functions are automatically typed and parsed. For example, the following:</p>
<div dir="auto" data-snippet-clipboard-copy-content="select id, object(name, startTime) as nest from events;"><pre><span>select</span> id, object(name, startTime) <span>as</span> nest <span>from</span> events;</pre></div>
<p dir="auto">will have the type:</p>
<div dir="auto" data-snippet-clipboard-copy-content="interface EventQuery {
  id: number;
  nest: { name: string, startTime: Date }
}"><pre><span>interface</span> <span>EventQuery</span> <span>{</span>
  <span>id</span>: <span>number</span><span>;</span>
  <span>nest</span>: <span>{</span> <span>name</span>: <span>string</span><span>,</span> <span>startTime</span>: <span>Date</span> <span>}</span>
<span>}</span></pre></div>
<p dir="auto">Nulls are automatically removed from all <code>groupArray</code> results. When all of the properties of <code>object</code> are from a left or right join, and there are no matches from that table, instead of returning, for example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="{ name: null, startTime: null }"><pre><span>{</span> <span>name</span>: <span>null</span><span>,</span> <span>startTime</span>: <span>null</span> <span>}</span></pre></div>
<p dir="auto">the entire object will be null.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Transactions and concurrency</h2><a id="user-content-transactions-and-concurrency" aria-label="Permalink: Transactions and concurrency" href="#transactions-and-concurrency"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Transactions involve taking a connection from a pool of connections by calling <code>getTransaction</code>. Once you have finished using the transaction, you should call <code>release</code> to return the connection to the pool. If there are a large number of simultaneous transactions, the connection pool will be empty and <code>getTransaction</code> will start to wait until a connection is returned to the pool.</p>
<div dir="auto" data-snippet-clipboard-copy-content="import { db } from &#39;./db.js&#39;;

try {
  const tx = await db.getTransaction();
  await tx.begin();

  const coachId = await tx.coach.insert({
    name: &#39;Eugene Bareman&#39;,
    city: &#39;Auckland&#39;
  });
  const fighterId = await tx.fighter.get({ name: /Israel/ }, &#39;id&#39;);
  await tx.fighterCoach.insert({
    fighterId,
    coachId
  });
  
  await tx.commit();
}
catch (e) {
  console.log(e);
  await tx.rollback();
}
finally {
  db.release(tx);
}"><pre><span>import</span> <span>{</span> <span>db</span> <span>}</span> <span>from</span> <span>&#39;./db.js&#39;</span><span>;</span>

<span>try</span> <span>{</span>
  <span>const</span> <span>tx</span> <span>=</span> <span>await</span> <span>db</span><span>.</span><span>getTransaction</span><span>(</span><span>)</span><span>;</span>
  <span>await</span> <span>tx</span><span>.</span><span>begin</span><span>(</span><span>)</span><span>;</span>

  <span>const</span> <span>coachId</span> <span>=</span> <span>await</span> <span>tx</span><span>.</span><span>coach</span><span>.</span><span>insert</span><span>(</span><span>{</span>
    <span>name</span>: <span>&#39;Eugene Bareman&#39;</span><span>,</span>
    <span>city</span>: <span>&#39;Auckland&#39;</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> <span>fighterId</span> <span>=</span> <span>await</span> <span>tx</span><span>.</span><span>fighter</span><span>.</span><span>get</span><span>(</span><span>{</span> <span>name</span>: <span><span>/</span>Israel<span>/</span></span> <span>}</span><span>,</span> <span>&#39;id&#39;</span><span>)</span><span>;</span>
  <span>await</span> <span>tx</span><span>.</span><span>fighterCoach</span><span>.</span><span>insert</span><span>(</span><span>{</span>
    fighterId<span>,</span>
    coachId
  <span>}</span><span>)</span><span>;</span>
  
  <span>await</span> <span>tx</span><span>.</span><span>commit</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
<span>catch</span> <span>(</span><span>e</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>e</span><span>)</span><span>;</span>
  <span>await</span> <span>tx</span><span>.</span><span>rollback</span><span>(</span><span>)</span><span>;</span>
<span>}</span>
<span>finally</span> <span>{</span>
  <span>db</span><span>.</span><span>release</span><span>(</span><span>tx</span><span>)</span><span>;</span>
<span>}</span></pre></div>

<p dir="auto">To run the tests, first go into the <code>test</code> folder and run <code>node setup.js</code> to move the test database to the right location. You can then run the tests with <code>node test.js</code> or <code>npm test</code>.</p>
</article></div></div>
  </body>
</html>
