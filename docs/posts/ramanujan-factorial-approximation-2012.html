<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.johndcook.com/blog/2012/09/25/ramanujans-factorial-approximation/">Original</a>
    <h1>Ramanujan Factorial Approximation (2012)</h1>
    
    <div id="readability-page-1" class="page"><div>
		<p>Ramanujan came up with an approximation for factorial that resembles Stirling’s famous approximation but is much more accurate.</p>
<p><img src="https://www.johndcook.com/ramanujan_factorial_formula.svg" alt="n! \sim \sqrt{\pi} \left(\frac{n}{e}\right)^n \sqrt[6]{8n^3 + 4n^2 + n + \frac{1}{30}}"/></p>
<p>As with Stirling’s approximation, the relative error in Ramanujan’s approximation decreases as <em>n</em> gets larger. Typically these approximations are not useful for small values of <em>n</em>. For <em>n</em> = 5, Stirling’s approximation gives 118.02 while the exact value is 120. But Ramanujan’s approximation gives 120.00015.</p>
<p>Here’s an implementation of the approximation in Python.</p>
<pre>    def ramanujan(x):
        fact = sqrt(pi)*(x/e)**x
        fact *= (((8*x + 4)*x + 1)*x + 1/30.)**(1./6.)
        return fact
</pre>
<p>For non-integer values of <em>x</em>, the function returns an approximation for Γ(<em>x</em>+1), an extension of factorial to real values. Here’s a plot of the accuracy of Ramanujan’s approximation.</p>
<p><img loading="lazy" src="https://www.johndcook.com/ramanujan_factorial.png" alt="plot of precision of Ramanujan&#39;s approximation" width="400" height="314"/></p>
<p>For <em>x</em> = 50, Ramanujan’s approximation is good to nearly 10 significant figures, whereas Stirling’s approximation is good to about 7.</p>
<p>Here’s a little trickier implementation.</p>
<pre>    def ramanujan2(x):
        fact = sqrt(pi)*(x/e)**x
        fact *= (((8*x + 4)*x + 1)*x + 1/30.)**(1./6.)
        if isinstance(x, int):
             fact = int(fact)
        return fact
</pre>
<p>This code gives the same value as before if <em>x</em> is not an integer. But it gives exact values of factorial for <em>x</em> = 0, 1, 2, … 10. If <em>x</em> is 11 or greater, the result is not exact, but the relative error is less than 10^-7 and decreases as x increases. Ramanujan’s approximation always errs on the high side, so rounding the result down improves the accuracy and makes it exact for small integer inputs.</p>
<p>The downside of this trick is that now, for example, <code>ramanujan2(5)</code> and <code>ramanujan2(5.0)</code> give different results. In some contexts, the improved accuracy may not be worth the inconsistency.</p>
<p>Reference: <a href="http://files.ele-math.com/articles/jmi-05-53.pdf">On Gosper’s formula for the Gamma function</a></p>
<p><strong>Related post</strong>: <a href="https://www.johndcook.com/blog/2011/03/14/a-ramanujan-series-for-calculating-pi/">A Ramanujan series for calculating pi<br/>
</a></p>
<p>For daily posts on analysis, follow <a href="https://twitter.com/analysisfact">@AnalysisFact</a> on Twitter.</p><p><a href="https://twitter.com/analysisfact"><img src="https://www.johndcook.com/twitter2018/analysisfact_no_padding.svg" width="100" width="100" alt="AnalysisFact twitter icon"/></a></p>
			</div></div>
  </body>
</html>
