<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://chromium.googlesource.com/chromiumos/docs/&#43;/HEAD/development_basics.md#programming-languages-and-style">Original</a>
    <h1>ChromiumOS Developer Guide, Programming languages and style</h1>
    
    <div id="readability-page-1" class="page"><div><div><div><p>This document covers guidelines to keep in mind when working on the ChromiumOS project.</p><h2><a name="Documentation" href="#Documentation"><span></span></a><a name="documentation" href="#documentation"><span></span></a>Documentation</h2><h3><a name="General-guidelines" href="#General-guidelines"><span></span></a><a name="general-guidelines" href="#general-guidelines"><span></span></a>General guidelines</h3><p>ChromiumOS follows the Chromium project&#39;s <a href="https://chromium.googlesource.com/chromium/src/+/HEAD/docs/documentation_guidelines.md">documentation guidelines</a> and <a href="https://chromium.googlesource.com/chromium/src/+/HEAD/docs/documentation_best_practices.md">documentation best practices</a>.</p><h3><a name="Design-documents" href="#Design-documents"><span></span></a><a name="design-documents" href="#design-documents"><span></span></a>Design documents</h3><p>Design documents typically describe the problem that you‘re trying to solve, different approaches that you considered, and the path that you’re planning to take. They‘re useful for soliciting opinions from others before you start on the implementation, but they also help your code reviewers get their bearings and can answer other developers’ “why was this done like that?” questions after the work is complete (even after you‘ve forgotten the reasons why!). On top of all that, a design doc often helps you solidify a design in your own mind and convince yourself that you’re not missing anything.</p><p>Most non-trivial additions of new functionality, and particularly ones that require adding new daemons or new interactions between different processes, should have their own design docs. For smaller changes, documenting what you&#39;re doing and why in the issue tracker is often enough.</p><p>Share your design docs with your team mailing list, if not with the full <a href="https://groups.google.com/a/chromium.org/forum/#!forum/chromium-os-dev">chromium-os-dev</a> mailing list. See the existing <a href="https://www.chromium.org/chromium-os/chromiumos-design-docs">ChromiumOS design docs</a> and <a href="https://www.chromium.org/developers/design-documents">Chromium design docs</a> for inspiration.</p><h2><a name="Programming-languages-and-style" href="#Programming-languages-and-style"><span></span></a><a name="programming-languages-and-style" href="#programming-languages-and-style"><span></span></a>Programming languages and style</h2><h3><a name="Rust" href="#Rust"><span></span></a><a name="rust" href="#rust"><span></span></a>Rust</h3><p>The newest userspace code in ChromiumOS is usually written in Rust to take advantage of its improved security and ergonomics. Being a memory safe language with a runtime overhead similar to C/C++ makes it uniquely suited for new code with reduced incidence of security and stability bugs.</p><p>The Rust style guide is currently in development by the ChromiumOS Authors, but it basically follows that of Rust&#39;s default rustfmt configuration. Additionally clippy is used a linter, usually with certain lints suppressed. For an example of what lints might be disabled, look at the <a href="https://chromium.googlesource.com/chromiumos/platform/crosvm/+/HEAD/bin/clippy">set from crosvm</a>. The <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/rust_on_cros.md">Rust on ChromeOS</a> document has more information.</p><p>In certain cases C++ is the better choice for userspace code. In particular, existing C++ projects should not be converted to Rust, except in exceptional circumstances. However, new modules to existing C++ projects have been successfully written in Rust. Other cases where C++ should be considered are projects reliant on Mojo, which has no production ready Rust bindings.</p><h3><a name="Programming-languages-and-style-C-1" href="#Programming-languages-and-style-C-1"><span></span></a><a name="programming-languages-and-style-c-1" href="#programming-languages-and-style-c-1"><span></span></a>C++</h3><p>Most userspace code in the ChromiumOS project is written in C++, whether it&#39;s part of the Chrome browser itself or a system daemon exposing new functionality.</p><p>The Chromium project, and by extension the ChromiumOS project, follow the <a href="https://google.github.io/styleguide/cppguide.html">Google C++ style guide</a>, with the <a href="https://chromium.googlesource.com/chromium/src/+/HEAD/styleguide/c++/c++.md">Chromium C++ style guide</a> layered on top to provide additional guidelines and clarify ambiguities.</p><p>The <a href="https://chromium.googlesource.com/chromium/src/+/HEAD/styleguide/c++/c++-features.md">Modern C++ use in Chromium</a> document lists which of the many new features introduced in the C++11, 14, and 17 standard are allowed. ChromiumOS follows the list except std::optional. It is banned on Chromium due to its undefined behavior when a std::nullopt is dereferenced. However, ChromiumOS C++ is hardened and will crash in such cases. Use std::optional instead of absl::optional.</p><p>New C++ programs should go into new directories in the <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/platform2_primer.md">platform2 repository</a>, which is checked out to <code>src/platform2</code>.</p><h3><a name="Programming-languages-and-style-C-2" href="#Programming-languages-and-style-C-2"><span></span></a><a name="programming-languages-and-style-c-2" href="#programming-languages-and-style-c-2"><span></span></a>C</h3><p>C should only be used for code that is part of the Linux kernel or ChromeOS firmware.</p><p>Both kernel and firmware code should follow the <a href="https://github.com/torvalds/linux/blob/HEAD/Documentation/process/coding-style.rst">Linux kernel coding style</a>. The <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/kernel_development.md">Kernel Development</a> guide has more details about ChromeOS kernel development, and the <a href="https://chromium.googlesource.com/chromiumos/platform/ec/+/HEAD/README.md">EC Development page</a> discusses firmware.</p><p>Usage of C in new first-party userspace projects is strongly discouraged. Unless there is a critical, external to ChromeOS reason to write a new userspace project in C, usage of C will be disallowed.</p><p><code>platform</code> and <code>platform2</code> OWNERS are encouraged to reject new C code in first-party userspace ChromeOS components.</p><h3><a name="Shell" href="#Shell"><span></span></a><a name="shell" href="#shell"><span></span></a>Shell</h3><p>Sometimes shell scripting can be the best way to perform lightweight, non-persistent tasks that need to run periodically on ChromeOS systems, but there are also big downsides: it‘s much more difficult to write tests for shell scripts than for C++ code, and scripts have a tendency to grow to the point where they become difficult to maintain. If you’re planning to add a shell script that is likely to grow in complexity, consider instead using C++ from the start to save yourself the trouble of rewriting it down the road.</p><p>Shell scripts are mainly used for a few categories of tasks in ChromeOS:</p><ul><li>Upstart initialization scripts, as in <a href="https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/init/">src/platform2/init</a>. See the <a href="https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/init/STYLE">init STYLE file</a> and <a href="https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/init/README">init README file</a> for guidelines.</li><li>Portage <code>.ebuild</code> files, as in the <a href="https://chromium.googlesource.com/chromiumos/overlays/chromiumos-overlay">chromiumos-overlay repository</a>. We follow the upstream guidelines; see the <a href="https://devmanual.gentoo.org/ebuild-writing/index.html">Ebuild Writing</a> page and specifically the <a href="https://devmanual.gentoo.org/ebuild-writing/file-format/index.html">Ebuild File Format</a>.</li><li>Miscellaneous development-related tasks</li></ul><p>Read the <a href="https://google.github.io/styleguide/shell.xml">Google shell style guide</a> and <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/styleguide/shell.md">ChromiumOS shell style guidelines</a> before writing scripts, with the caveat that the Upstart or Portage guidelines take precedence when writing those types of scripts.</p><p>For shell scripts that ship with the OS image, be extra careful. The shell provides powerful features, but the flip side is that security pitfalls are tricky to avoid. Think twice whether your shell statements can have unintended side effects, in particular if your script runs with full privileges (as is the case with init scripts). As a guideline, keep things simple and move more complex processing to a properly sandboxed environment in an C++ daemon.</p><h3><a name="Python" href="#Python"><span></span></a><a name="python" href="#python"><span></span></a>Python</h3><p>The Python interpreter is not included in production ChromeOS system images, but Python is used heavily for development and testing.</p><p>We largely follow the <a href="https://google.github.io/styleguide/pyguide.html">Google Python style guide</a>, but see the <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/styleguide/python.md">ChromiumOS Python style guidelines</a> for important differences, particularly around indenting and naming. For tests, see the <a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/HEAD/docs/coding-style.md">autotest coding style</a>.</p><h2><a name="Testing" href="#Testing"><span></span></a><a name="testing" href="#testing"><span></span></a>Testing</h2><p>The <a href="https://www.chromium.org/chromium-os/testing">ChromiumOS testing site</a> is the main repository of information about testing.</p><h3><a name="Unit-tests" href="#Unit-tests"><span></span></a><a name="unit-tests" href="#unit-tests"><span></span></a>Unit tests</h3><p>Unit tests should be added alongside new code. It&#39;s important to design your code with testability in mind, as adding tests after-the-fact often requires heavy refactoring.</p><p>Good unit tests are fast, lightweight, reliable, and easy to run within the chroot as part of your development workflow. We use <a href="https://github.com/google/googletest">Google Test</a> (which is comprised of the GoogleTest unit testing framework and the GoogleMock mocking framework) to test C++ code. <a href="https://github.com/google/googletest/blob/HEAD/googletest/docs/primer.md">Why Google C++ Testing Framework?</a> and the <a href="https://github.com/google/googletest/blob/HEAD/googletest/docs/faq.md">Google Test FAQ</a> are good introductions, and the <a href="https://www.chromium.org/chromium-os/testing/adding-unit-tests-to-the-build">unit testing document</a> has more details about how unit tests get run.</p><p>See the <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/testing/unit_tests.md">Best practices for writing ChromeOS unit tests</a> document for more guidance on writing good unit tests.</p><h3><a name="Autotest" href="#Autotest"><span></span></a><a name="autotest" href="#autotest"><span></span></a>Autotest</h3><p><a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/HEAD/docs/user-doc.md">Autotest</a> is used to run tests on live ChromeOS systems. Autotests are useful for performing integration testing (e.g. verifying that two processes are able to communicate with each other over IPC), but they have heavy costs:</p><ul><li>Autotests are harder to run than unit tests: you need either a dedicated test device or a virtual machine.</li><li>Autotests are much slower than unit tests: even a no-op test can take 30 seconds or longer per run.</li><li>Since autotests involve at least a controlling system and a test device, they&#39;re susceptible to networking issues and hardware flakiness.</li><li>Since autotests run on full, live systems, failures can be caused by issues in components unrelated to the one that you&#39;re trying to test.</li></ul><p>Whenever you can get equivalent coverage from either unit tests or autotests, use unit tests. Design your system with unit testing in mind.</p><h2><a name="Code-reviews" href="#Code-reviews"><span></span></a><a name="code-reviews" href="#code-reviews"><span></span></a>Code reviews</h2><p>The ChromiumOS project follows the <a href="https://chromium.googlesource.com/chromium/src/+/HEAD/docs/code_reviews.md">Chromium code review policy</a>: all code and data changes must be reviewed by another project member before being committed. Note that ChromiumOS&#39;s review process has some differences; see the <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/developer_guide.md#Upload-your-changes-and-get-a-code-review">Developer Guide&#39;s code review instructions</a>.</p><p>OWNERS files are not (yet) enforced for non-browser parts of the ChromiumOS codebase, but please act as if they were. If there‘s an OWNERS file in the directory that you’re modifying or a parent directory, add at least one developer that&#39;s listed in it to your code review and wait for their approval before committing your change.</p><p>Owners may want to consider setting up notifications for changes to their code. To receive notifications of changes to <code>src/platform2/debugd</code>, open your <a href="https://chromium-review.googlesource.com/settings/#Notifications">Gerrit notification settings</a> and add a new entry for project <code>chromiumos/platform2</code> and expression <code>file:&#34;^debugd/.*&#34;</code>.</p><h2><a name="Issue-trackers" href="#Issue-trackers"><span></span></a><a name="issue-trackers" href="#issue-trackers"><span></span></a>Issue trackers</h2><p>Public ChromiumOS bugs and feature requests are tracked using the <a href="https://crbug.com/">chromium issue tracker</a>. Note that this tracker is shared with the Chromium project; most OS-specific issues are classified under an <code>OS&gt;</code>-prefixed component and have an <code>OS=Chrome</code> label. The <code>crbug.com</code> redirector makes it easy to jump directly to an issue with a given ID; <code>https://crbug.com/123</code> will redirect to issue #123, for instance.</p><p>Keep discussion in the issue tracker instead of in email or over IM. Issues remain permanently available and are viewable by people not present for the original discussion; email and IM exchanges are harder to find after the fact and may even be deleted automatically. <code>BUG=chromium:123</code> lines in commit descriptions and <code>https://crbug.com/123</code> mentions in code comments also make it easy to link back to the issue that describes the original motivation for a change.</p><p>Avoid discussing multiple problems in a single issue. It‘s not possible to split an existing issue into multiple new issues, and it can take a long time to read through an issue’s full history to figure out what is currently being discussed.</p><p>Similarly, do not reopen an old, closed issue in response to the reoccurrence of a bug: the old issue probably contains now-irrelevant milestone and merge labels and outdated information. Instead, create a new issue and refer to the prior issue in its initial description. Text of the form <code>issue 123</code> will automatically be turned into a link.</p><p>There is much more information about filing bugs and using labels in the <a href="https://www.chromium.org/for-testers/bug-reporting-guidelines">Chromium bug reporting guidelines</a>.</p><h2><a name="Mailing-lists" href="#Mailing-lists"><span></span></a><a name="mailing-lists" href="#mailing-lists"><span></span></a>Mailing lists</h2><p>See the <a href="https://chromium.googlesource.com/chromiumos/docs/+/HEAD/contact.md">contact</a> document for more details.</p><h2><a name="Developing-in-the-open" href="#Developing-in-the-open"><span></span></a><a name="developing-in-the-open" href="#developing-in-the-open"><span></span></a>Developing in the open</h2><p>ChromiumOS is an open-source project. Whenever possible (i.e. when not discussing private, partner-related information), use the public issue tracker and mailing lists rather than the internal versions.</p></div></div></div></div>
  </body>
</html>
