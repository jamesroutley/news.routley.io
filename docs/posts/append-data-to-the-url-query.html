<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://daniel.haxx.se/blog/2022/11/10/append-data-to-the-url-query/">Original</a>
    <h1>Append data to the url query</h1>
    
    <div id="readability-page-1" class="page"><div>
		
<p>A new curl option was born: <code><a href="https://curl.se/docs/manpage.html#--url-query">--url-query</a></code>.</p>



<h2>How it started</h2>



<p>curl offered the <code>-d</code> / <code>--data</code> option  already in its first release back in 1998. curl 4.0. A trusted old friend.</p>



<p>curl also has some companion versions of this option that work slightly differently, but they all have the common feature that they append data to the the request body. Put simply: with these options users construct the body contents to POST. Very useful and powerful. Still today one of the most commonly used curl options, for apparent reasons.</p>



<pre>curl -d name=mrsmith -d color=blue https://example.com</pre>



<h2>Convert to query</h2>



<p>A few years into curl’s lifetime, in 2001, we introduced the <code>-G</code> / <code>--get</code> option. This option let you use <code>-d</code> to create a data set, but the data is not sent as a POST body anymore but is instead converted to a query string and used in a GET request.</p>



<pre>curl -G -d name=mrsmith -d color=blue https://example.com</pre>



<p>This would make curl send a GET request to this URL:  <code>https://example.com/?name=mrsmith&amp;color=blue</code></p>



<p>The “query” is the part of the URL that sits on the right side of the question mark (but before the fragment that if it exists starts with the first <code>#</code> following the question mark).</p>



<h2>URL-encode</h2>



<p>In 2008 we added <code>--data-urlencode</code> which made it even easier for users and scripts to use these options correctly as now curl itself can URL-encode the given data instead of relying on the user to do it. Previously, script authors would have to do that encoding before passing the data to curl which was tedious and error prone. This feature also works in combination with <code>-G</code> of course.</p>



<h2>How about both?</h2>



<p>The <code>-d</code> options family make a POST. The <code>-G</code> converts it to a GET.</p>



<p>If you want convenient curl command line options to <strong>both</strong> make content to send in the POST body <strong>and</strong><em><strong> </strong></em>to create query parameters in the URL you were however out of luck. You would then have to go back to use <code>-d</code> but handcraft and encode the query parameters “manually”.</p>



<p>Until curl 7.87.0. Due to ship on December 21, 2022. (<a href="https://github.com/curl/curl/commit/b6e1afd069f0a621b21bf27a461dc5297ce30031">this commit</a>)</p>



<h2><code>--url-query</code> is your new friend</h2>



<p>This is curl’s 249th command line option and it lets you append parameters to the query part of the given URL, using the same syntax as <code>--data-urlencode</code> uses.</p>



<p>Using this, a user can now conveniently create a POST request body and at the same time add a set of query parameters for the URL which the request uses.</p>



<p>A basic example that sends the same POST body and URL query:</p>



<pre>curl -d name=mrsmith -d color=blue --url-query name=mrsmith --url-query color=blue https://example.com</pre>



<h2>Syntax</h2>



<p>I told you it uses the data-urlencode syntax, but let me remind you how that works. You use <code>--url-query [data]</code> where <code>[data]</code> can be provided using these different ways:</p>



<figure><table><tbody><tr><td>content</td><td>This will make curl URL-encode the content and pass that on. Just be careful so that the content does not contain any = or @ symbols, as that will then make the syntax match one of the other cases below!</td></tr><tr><td>=content</td><td>This will make curl URL-encode the content and pass that on. The preceding = symbol is not included in the data.</td></tr><tr><td>name=content</td><td>This will make curl URL-encode the content part and pass that on. Note that the name part is expected to be URL-encoded already.</td></tr><tr><td>@filename</td><td>This will make curl load data from the given file (including any newlines), URL-encode that data and pass it on in the POST.</td></tr><tr><td>name@filename</td><td>This will make curl load data from the given file (including any newlines), URL-encode that data and pass it on in the POST. The name part gets an equal sign appended, resulting in <em>name=urlencoded-file-content</em>. Note that the name is expected to be URL-encoded already.</td></tr><tr><td>+content</td><td>The data is provided as-is unencoded</td></tr></tbody></table></figure>



<p>For each new <code>--url-query</code>, curl will insert an ampersand (&amp;) between the parts it adds to the query.</p>



<h2>Replaces -G</h2>



<p>This new friend we call <code>--url-query</code> makes <code>-G</code> rather pointless, as this is a more powerful option that does everything -G ever did and a lot more. We will of course still keep -G supported and working. Because that is how we work.</p>



<p>A boring fact of life is that new versions of curl trickle out into the world rather slowly to ordinary users. Because of this, we can be certain that scripts and users all over will need to keep using -G for yet another undefined period of time.</p>



<h2>Trace</h2>



<p>Finally: remember that if you want curl to show you what it sends in a POST request, the normal <code>-v</code> / <code>--verbose</code> does not suffice as it will not show you the request body. You then rather need to use <a href="https://everything.curl.dev/usingcurl/verbose/trace"><code>--trace</code> or <code>--trace-ascii</code></a>.</p>
	</div></div>
  </body>
</html>
