<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nostarttls.secvuln.info/">Original</a>
    <h1>Why TLS is better without STARTTLS (2021)</h1>
    
    <div id="readability-page-1" class="page">
	<img src="https://nostarttls.secvuln.info/images/nostarttls.svg" height="300" alt="logo"/>

	<header id="top">
		
	</header>

	<section>
		<h2>Why TLS is better without STARTTLS</h2>

		<p>by Damian Poddebniak¹, Fabian Ising¹, Hanno Böck², and Sebastian Schinzel¹</p>
		<p>¹ Münster University of Applied Sciences ² Independent Researcher</p>
		<p><em>Full paper <a href="https://www.usenix.org/conference/usenixsecurity21/presentation/poddebniak">published
					at USENIX Security 21</a></em></p>

	</section>

	<section>
		<h2>Introduction</h2>

		<p>Connections between email clients and servers provide two ways to be protected with TLS: While implicit TLS
			encrypts the connection from the start and runs on a separate port, STARTTLS
			provides a mechanism to upgrade existing unencrypted connections to TLS.</p>
		<p>Sometimes STARTTLS is seen as an opportunistic encryption mode that provides TLS protection
			only when available. This is trivially vulnerable to downgrade attacks. However, modern email clients
			usually have the expectation that STARTTLS is enforced, and when enabled, no unencrypted communication
			is possible.</p>
		<p>Upgrading connections via STARTTLS is fragile and vulnerable to a number of security
			vulnerabilities and attacks. We found more than 40 vulnerabilities in STARTTLS implementations. We
			conclude that these vulnerabilities are so common that we recommend
			avoiding using STARTTLS when possible.</p>

		<img src="https://nostarttls.secvuln.info/images/email.svg" alt="Steps of an email submission and access. From left to right: Author (Email Client), Provider, Provider, Recipient (Email Client)."/>

	</section>

	<section>
		<h2>Attacks</h2>

		<p>We assume a Meddler-in-the-Middle (MitM) attacker who can modify connections established between an
			email client and the email server of a provider.</p>

		<h3>Stealing Login Credentials with SMTP and IMAP via Command Injection</h3>

		<p>In 2011 Postfix developer Wietse Venema <a href="http://www.postfix.org/CVE-2011-0411.html">described a bug
				in STARTTLS implementations</a> that allowed
			injecting plaintext commands that a server interprets as if they were part of the
			encrypted connection. This works by sending additional commands with the STARTTLS command to the
			server in the same TCP segment.</p>

		<p>We found that despite being known since 2011, this vulnerability is still very common. We found
			15 vulnerable implementations, and in scans, 2% of all mail servers showed this vulnerability.</p>

		<p>This command injection can be used to steal credentials with the SMTP and IMAP protocols.</p>
		<p>Our attack requires a Meddler in the Middle (MitM) attacker that can modify network traffic and has
			login credentials for their own account on the same server. The attacker can inject commands
			that authenticate them and then start sending (SMTP) or storing (IMAP) an email.
			The login credentials sent by the victim will be stored in the email that the attacker
			can access.</p>
		<p>The command injection can also be used for a cross-protocol attack to serve HTTPS content with
			the mail server&#39;s certificate. Detailed descriptions of these attacks can be found in our paper.</p>

		<h3>Mailbox content forgery via Response Injection</h3>

		<p>We discovered an attack similar to the command injection in email client applications.
			We call this a response injection.
			This bug affected many popular mail clients, including Apple Mail, Mozilla Thunderbird, Claws Mail, and
			Mutt.</p>
		<p>By injecting additional content to the server message in response to the STARTTLS command before the TLS
			handshake,
			we can inject server commands that the client will process as if they were part of the encrypted connection.
			This
			can be used to forge mailbox content.</p>

		<h3>IMAP connection downgrade via PREAUTH and credential-stealing with REFERRAL</h3>

		<p>In the IMAP protocol, a server can signal the client in the first message that it is already authenticated
			via
			the PREAUTH command. The protocol forbids using the STARTTLS command in an authenticated state. Therefore, if
			a client application accepts PREAUTH, it cannot enforce STARTTLS.</p>
		<p>A Meddler in the Middle attacker can use this to prevent STARTTLS from upgrading the connection and force
			a client to an unencrypted connection.</p>
		<p>This vulnerability was originally <a href="http://jkt.flaska.net/blog/Trojita_0_4_1__a_security_update_for_CVE_2014_2567.html">found in
				Trojitá in 2014</a>. We discovered that multiple other
			email client applications were vulnerable to the same bug.</p>
		<p>This bug is especially severe in combination with the IMAP features <a href="https://datatracker.ietf.org/doc/html/rfc2221">Login Referrals</a> and <a href="https://datatracker.ietf.org/doc/html/rfc2193">Mailbox Referrals</a>.
			These commands allow a server to instruct a client to log into another IMAP server. By using PREAUTH to
			prevent an encrypted connection, an attacker can use referrals to force a client to send credentials to an
			attacker-controlled server.
			Fortunately, the referral features are not supported by many clients.
			We found only one client - Alpine - vulnerable to this combination of PREAUTH and referrals.</p>

		<h3>Additional Attacks</h3>

		<p>We found additional attacks, whose security impact may vary for implementations.
			Please see our paper to learn more about these attacks.</p>
	</section>

	<section>
		<h2>Conclusion</h2>

		<p>All vulnerabilities described here rely on the transition of an insecure connection to a
			secure connection.
			Implicit TLS does not have such a transition and is therefore not vulnerable to any of these attacks.
			We therefore consider implicit TLS a more secure option than STARTTLS.</p>
		<p>We also point out that STARTTLS always introduces at least one extra connection
			round trip. So implicit TLS generally provides better performance.</p>
	</section>

	<section>
		<h2>Impact</h2>

		<p>The demonstrated attacks require an active attacker and may be recognized when
				used against an email client that tries to enforce the transition to TLS.
				We have informed all popular email client and server vendors and most issues are already
				fixed.
				We think that the demonstrated attacks would be difficult to execute on a large scale, and we
				primarily expect them to be used in targeted attacks.
				As a general recommendation, you should always update your software and (to also profit from faster
				connections)
				reconfigure your email client to use implicit TLS only (see below).</p>
	</section>

	<section>
		<h2>Recommendations</h2>

		<h3>For Email Client Users</h3>

		<p>If possible, we recommend that users check and configure their email clients to use SMTP, POP3 and IMAP with
			implicit TLS on dedicated ports, i.e., SMTP/Submission on port 465, POP3 on port 995, and IMAP on port 993.
                        This is in line with already existing recommendations in
                        <a href="https://datatracker.ietf.org/doc/html/rfc8314#section-3">RFC 8314</a> and was already recommended
                        by <a href="https://www.agwa.name/blog/post/starttls_considered_harmful">security professionals</a> before.
		</p>
		<p>Some mail service providers, notably Microsoft and Apple, do not support implicit TLS for SMTP/Submission.
			We recommend that users ask their mail service providers to offer the more secure implicit TLS option.</p>

		<h3>For Application Developers</h3>

		<p>Both email server and client applications should offer implicit TLS by default.
			In the long term, software developers may decide to not support STARTTLS at all and thus simplify both
			their code and configuration dialogs and files.</p>

		<p>We recommend auditing all applications supporting STARTTLS - both on the server and the client side -
			for the bugs discovered.
			Most importantly, applications need to ensure that no unencrypted content gets processed as part of an
			encrypted connection.
			IMAP applications must make sure that they do not allow PREAUTH in combination with STARTTLS.
			We provide the <a href="https://github.com/fhms-its/EAST">EAST toolkit</a>, which allows testing
			applications.
		</p>

		<h3>For Mail Server Administrators</h3>

		<p>Make sure your server supports implicit TLS for all supported protocols.
			If possible, consider disabling STARTTLS for IMAP, POP3 and SMTP submission.</p>

		<p>If you really need to support STARTTLS, we recommend testing your server with our tool for the command
			injection vulnerability for all supported protocols.
			If your server software is vulnerable, you should ask your vendor for a security update.</p>

		<h2>FAQ</h2>

		<h3>Isn&#39;t STARTTLS insecure anyway?</h3>

		<p>STARTTLS is used in two &#34;modes&#34;, &#34;opportunistic&#34;, and &#34;enforced&#34;.
			Email clients must authenticate themselves with a username and password before submitting a new email or
			accessing existing emails.
			For these connections, the transition to TLS via STARTTLS <b>must</b> be strictly enforced because a
			downgrade would reveal the username and password and give an attacker full access to the email account.</p>

		<h3>How can I test if my software is vulnerable?</h3>

		<p>We provide the <a href="https://github.com/fhms-its/EAST">EAST toolkit</a> that allows testing email clients
			and servers.</p>

		<p><b>Testing an email server</b> for the command injection is relatively easy with our <a href="https://github.com/Email-Analysis-Toolkit/command-injection-tester">Command Injection Tester</a>.
			<a href="https://github.com/drwetter/testssl.sh">testssl.sh</a> (dev version) and
			<a href="https://github.com/tls-attacker/TLS-Attacker/tree/starttls">TLS-Attacker</a>/<a href="https://github.com/tls-attacker/TLS-Scanner/tree/starttls">TLS-Scanner</a> (starttls branch) also check for the command injection.
		</p>

		<p><b>Testing an email client</b> is more complex, and we refer to EAST&#39;s <a href="https://github.com/Email-Analysis-Toolkit/fake-mail-server">Fake Mail Server</a> component.
		</p>

		<h3>Are other protocols with support for STARTTLS or similar mechanisms affected?</h3>

		<p>We expect to see similar vulnerabilities in other protocols using STARTTLS, e.g., XMPP, FTP, IRC, or LDAP.
			Thus, our recommendation to avoid STARTTLS and use implicit TLS when possible applies to those protocols as
			well.
			We encourage security researchers to look for such vulnerabilities in other protocols.</p>
		<p>Some protocols only support STARTTLS and provide no implicit TLS mechanism.
			We recommend that standards bodies define implicit TLS modes for these protocols and that future protocols
			do this by default and avoid STARTTLS completely.</p>

		<h3>What about communication between email servers (MTA to MTA)?</h3>

		<p>Traditionally, STARTTLS between email servers only protects against passive attacks and is vulnerable to
			active attacks such as STARTTLS stripping.
			Thus STARTTLS vulnerabilities do not give an advantage to the attacker.</p>
		<p>However, efforts like <a href="https://datatracker.ietf.org/doc/html/rfc8461">MTA-STS</a> and <a href="https://datatracker.ietf.org/doc/html/rfc7671">DANE</a> provide authentication mechanisms for MTA
			to MTA connections.
			Therefore, server software should be investigated for STARTTLS vulnerabilities as well.
			Particularly relevant are the buffering bugs, which can happen both for the sending (response injection) and
			receiving (command injection) side of a mail server.
			We have found and reported some vulnerabilities in server software during our research.</p>
		<p>Currently, there is no standardized way to use implicit TLS for MTA to MTA connections.
			Therefore, it is not possible to avoid STARTTLS without changes to the protocol specification.</p>

		<h3>How important is this?</h3>
		<p><a href="https://www.ipcc.ch/assessment-report/ar6/">It&#39;s not the most important thing you should worry about today.</a></p>

		<h3>How can I contact you?</h3>

		<p>You can reach us via mail or twitter:</p>
<ul><li>Damian Poddebniak, <a href="https://norden.social/@duesee">@duesee@norden.social</a>, poddebniak@fh-muenster.de</li>
<li>Fabian Ising, <a href="https://twitter.com/Murgi">@Murgi</a>, F.Ising@fh-muenster.de</li>
<li><a href="https://hboeck.de/">Hanno Böck</a>, <a href="https://mastodon.social/@hanno">@hanno@mastodon.social</a>, hanno@hboeck.de</li>
<li>Sebastian Schinzel, <a href="https://twitter.com/seecurity">@seecurity</a>, schinzel@fh-muenster.de</li>
</ul>

	</section>

	<section>
		<h2>Reported Vulnerabilities</h2>

		<p>The following is a list of all STARTTLS-related vulnerabilities we found during our research.
			None of the issues would be present if implicit TLS had been used exclusively.
			Due to different kinds of reports, not all issues are publicly documented.
			All issues were reported more than 90 days ago.</p>

		<h3>Email Clients</h3>

		<p>As an end user, make sure to use the newest version of your email software.
			The following list serves as a quick check if your client is still affected.</p>

		<h4>Response Injection (Buffering)</h4>

		<table id="table_client_1">
			<thead>
				<tr>
					<th>Product</th>
					<th>Protocol</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Apple Mail (macOS)</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Fixed in macOS High Sierra 10.13.6/Big Sur 11.4</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-9941">CVE-2020-9941</a>, <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-30696">CVE-2021-30696</a></td>
				</tr>
				<tr>
					<td>Apple Mail (iOS/iPadOS)</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Fixed in iOS/iPadOS 14.0</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-9941">CVE-2020-9941</a></td>
				</tr>
				<tr>
					<td>Mozilla Thunderbird</td>
					<td>IMAP</td>
					<td>Fixed in 78.7.0</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-15685">CVE-2020-15685</a>, <a href="https://www.mozilla.org/en-US/security/advisories/mfsa2021-05/">Vendor advisory</a>,
						<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1622640">Bug report</a>
					</td>
				</tr>
				<tr>
					<td>Claws Mail</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Fixed in 3.17.6 for SMTP/POP3, See libEtPan for IMAP</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-15917">CVE-2020-15917</a></td>
				</tr>
				<tr>
					<td>Mutt</td>
					<td>IMAP/SMTP/POP3</td>
					<td>Fixed in 1.14.4</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-14954">CVE-2020-14954</a></td>
				</tr>
				<tr>
					<td>NeoMutt</td>
					<td>IMAP/SMPT/POP3</td>
					<td>Fixed in 2020-06-19</td>
					<td><a href="https://github.com/neomutt/neomutt/commit/fb013ec666759cb8a9e294347c7b4c1f597639cc">Commit/Patch</a>,
						see also <a href="https://nvd.nist.gov/vuln/detail/CVE-2020-14954">CVE-2020-14954</a></td>
				</tr>
				<tr>
					<td>Evolution</td>
					<td>SMTP/POP3</td>
					<td>Fixed in 3.36.4 (evolution-data-server)</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-14928">CVE-2020-14928</a></td>
				</tr>
				<tr>
					<td>LibEtPan (Mail Framework for C Language)</td>
					<td>IMAP/SMTP/POP3</td>
					<td>Fixed in repository, unreleased</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-15953">CVE-2020-15953</a></td>
				</tr>
				<tr>
					<td>Exim (MTA sending)</td>
					<td>SMTP</td>
					<td>Unfixed (reported privately)</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-38371">CVE-2021-38371</a></td>
				</tr>
				<tr>
					<td>Gmail (iOS/iPadOS)</td>
					<td>SMTP/IMAP</td>
					<td>Unfixed (reported privately)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Mail.ru, MyMail</td>
					<td>SMTP</td>
					<td>Unfixed (reported privately, report closed as not applicable)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Yandex</td>
					<td>SMTP/IMAP</td>
					<td>Unfixed (reported privately)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>PHP (stream_socket_enable_crypto)</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Unfixed</td>
					<td><a href="https://bugs.php.net/bug.php?id=80008">Bug report (private)</a>
					</td>
				</tr>
			</tbody>
		</table>

		<h4>Negotiation and Tampering bugs</h4>

		<table id="table_client_2">
			<thead>
				<tr>
					<th>Product</th>
					<th>Description</th>
					<th>Protocol</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Gmail (Android)</td>
					<td>Leak of emails</td>
					<td>IMAP</td>
					<td>Fixed (retested in 2021.07.11.387440246)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Gmail (Go)</td>
					<td>Leak of emails</td>
					<td>IMAP</td>
					<td>Fixed (retested in 2020.10.15.341102866)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Samsung Email</td>
					<td>Leak of emails</td>
					<td>IMAP</td>
					<td>Fixed (untested)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Alpine</td>
					<td>Untagged responses accepted before STARTTLS</td>
					<td>IMAP</td>
					<td>fixed in 2.25</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-38370">CVE-2021-38370</a>,
<a href="https://alpineapp.email/alpine/release/alpine-2.25.html">Release notes</a></td>
				</tr>
				<tr>
					<td>Trojitá <span>Trojita</span></td>
					<td>Untagged responses accepted before STARTTLS</td>
					<td>IMAP</td>
					<td>Unknown</td>
					<td><a href="https://bugs.kde.org/show_bug.cgi?id=432353">Bug report</a></td>
				</tr>
				<tr>
					<td>Mozilla Thunderbird</td>
					<td>Server responses prior to STARTTLS processed</td>
					<td>IMAP</td>
					<td>Fixed in 78.12</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-29969">CVE-2021-29969</a>, <a href="https://www.mozilla.org/en-US/security/advisories/mfsa2021-30/">Vendor advisory</a>
					</td>
				</tr>
				<tr>
					<td>KMail</td>
					<td>STARTTLS ignored when &#34;Server requires authentication&#34; not checked</td>
					<td>SMTP</td>
					<td>Unfixed</td>
					<td><a href="https://bugs.kde.org/show_bug.cgi?id=423423">Bug report</a></td>
				</tr>
				<tr>
					<td>Sylpheed</td>
					<td>STARTTLS stripping</td>
					<td>IMAP</td>
					<td>Unknown</td>
					<td><a href="https://sylpheed.sraoss.jp/redmine/issues/322">Bug report</a></td>
				</tr>
				<tr>
					<td>OfflineIMAP</td>
					<td>STARTTLS stripping</td>
					<td>IMAP</td>
					<td>Unknown</td>
					<td><a href="https://github.com/OfflineIMAP/offlineimap/issues/669">Bug report</a></td>
				</tr>
				<tr>
					<td>GMX / Web.de Mail Collector</td>
					<td>STARTTLS stripping</td>
					<td>POP3/IMAP</td>
					<td>Fixed</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Mail.ru, MyMail, Email app for Gmail</td>
					<td>STARTTLS Stripping</td>
					<td>SMTP</td>
					<td>Unfixed (report closed as not applicable)</td>
					<td>-</td>
				</tr>
			</tbody>
		</table>

		<h4>Avoiding Encryption via IMAP PREAUTH</h4>

		<table id="table_client_3">
			<thead>
				<tr>
					<th>Product</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Apple Mail (iOS/iPadOS)</td>
					<td>Fixed in iOS 15.1</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Mozilla Thunderbird</td>
					<td>Fixed in 68.9.0</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-12398">CVE-2020-12398</a></td>
				</tr>
				<tr>
					<td>Alpine</td>
					<td>Fixed in 2.23</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-14929">CVE-2020-14929</a>, <a href="https://repo.or.cz/alpine.git/commit/000edd9036b6aea5e6a06900ecd6c58faec665ab">Commit</a></td>
				</tr>
				<tr>
					<td>Mutt</td>
					<td>Fixed in 1.14.3</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-14093">CVE-2020-14093</a></td>
				</tr>
				<tr>
					<td>NeoMutt</td>
					<td>Fixed in Release 2020-06-19</td>
					<td><a href="https://github.com/neomutt/neomutt/commit/9909cde1f332d2f641c6aec0eb92adf0a150c7e5">Commit/Patch</a>,
						see also <a href="https://nvd.nist.gov/vuln/detail/CVE-2020-14093">CVE-2020-14093</a></td>
				</tr>
				<tr>
					<td>GMX / Web.de Mail Collector</td>
					<td>Fixed</td>
					<td>-</td>
				</tr>
			</tbody>
		</table>

		<h4>Certificate Validation</h4>

		<table id="table_client_4">
			<thead>
				<tr>
					<th>Product</th>
					<th>Protocol</th>
					<th>Description</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>OfflineIMAP</td>
					<td>IMAP</td>
					<td>Accepts untrusted certificates</td>
					<td>Unknown</td>
					<td><a href="https://github.com/OfflineIMAP/offlineimap/issues/669">Bug report</a></td>
				</tr>
				<tr>
					<td>GMX / Web.de Mail Collector</td>
					<td>POP3/IMAP</td>
					<td>Accepts untrusted certificates</td>
					<td>Still allows self-signed</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Yandex</td>
					<td>SMTP/IMAP</td>
					<td>Accepts untrusted certificates</td>
					<td>Unknown (report closed as not eligible)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Mail.ru, MyMail</td>
					<td>SMTP</td>
					<td>Accepts untrusted certificates (SMTP, IMAP)</td>
					<td>Unknown (report closed as duplicate)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Outlook (Android &amp; iOS)</td>
					<td>SMTP/IMAP</td>
					<td>Certificate hostname not checked (SMTP, IMAP)</td>
					<td>Unknown (report closed as low/medium severity)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Geary</td>
					<td>SMTP/IMAP</td>
					<td>Accepting an untrusted certificate creates a permanent trust exception for all certificates</td>
					<td>Fixed in 3.36.3</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-24661">CVE-2020-24661</a></td>
				</tr>
				<tr>
					<td>Trojitá <span>Trojita</span></td>
					<td>SMTP</td>
					<td>Accepts untrusted certificates</td>
					<td>Fixed in repository (77ddd5d4) (no official releases)</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-15047">CVE-2020-15047</a></td>
				</tr>
				<tr>
					<td>Ruby Net::SMTP</td>
					<td>SMTP</td>
					<td>Only checks hostname, ignores certificate signature</td>
					<td>Fixed in 2.7.2</td>
					<td><a href="https://hackerone.com/reports/980249">Bug report</a></td>
				</tr>
			</tbody>
		</table>

		<h4>Crashes</h4>

		<table id="table_client_5">
			<thead>
				<tr>
					<th>Product</th>
					<th>Protocol</th>
					<th>Description</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Alpine</td>
					<td>IMAP</td>
					<td>Crash when LIST or LSUB send before STARTTLS</td>
					<td>Fixed in 2.25</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-46853">CVE-2021-46853</a>, <a href="https://alpineapp.email/alpine/release/alpine-2.25.html">Release notes</a></td>
				</tr>
				<tr>
					<td>Balsa</td>
					<td>IMAP</td>
					<td>Nullptr dereference when TLS required and PREAUTH send</td>
					<td>Fixed in 2.5.10</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-16118">CVE-2020-16118</a></td>
				</tr>
				<tr>
					<td>Balsa</td>
					<td>IMAP</td>
					<td>Stack overflow due to repeated BAD answer to CAPABILITY command</td>
					<td>Fixed in 2.6.3</td>
					<td><a href="https://gitlab.gnome.org/GNOME/balsa/-/issues/48">Bug Report</a></td>
				</tr>
				<tr>
					<td>Balsa</td>
					<td>IMAP</td>
					<td>Crash on untagged EXPUNGE response</td>
					<td>Fixed in 2.6.3</td>
					<td><a href="https://gitlab.gnome.org/GNOME/balsa/-/issues/54">Bug Report</a></td>
				</tr>
				<tr>
					<td>Evolution</td>
					<td>IMAP</td>
					<td>Invalid free when no auth mechanisms in greeting</td>
					<td>Fixed in &gt;3.35.91</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-16117">CVE-2020-16117</a></td>
				</tr>
			</tbody>
		</table>

		<h4>Miscellaneous</h4>

		<table id="table_client_6">
			<thead>
				<tr>
					<th>Product</th>
					<th>Protocol</th>
					<th>Description</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>KMail</td>
					<td>POP3</td>
					<td>Setup wizard in POP3 defaults to unencrypted connections</td>
					<td>Unfixed</td>
					<td><a href="https://bugs.kde.org/show_bug.cgi?id=423426">Bug Report</a></td>
				</tr>
				<tr>
					<td>KMail</td>
					<td>POP3</td>
					<td>Config shows &#34;encrypted&#34;, but it isn&#39;t</td>
					<td>Unfixed</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-15954">CVE-2020-15954</a></td>
				</tr>
				<tr>
					<td>KMail</td>
					<td>SMTP/IMAP</td>
					<td>Dialog loop &#34;forces&#34; the user to accept invalid certificates</td>
					<td>Unfixed</td>
					<td><a href="https://bugs.kde.org/show_bug.cgi?id=423424">Bug Report</a></td>
				</tr>
				<tr>
					<td>Mozilla Thunderbird</td>
					<td>POP3</td>
					<td>Infinite loop when POP3 server replies with -ERR to STLS command</td>
					<td>Unknown</td>
					<td><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1641882">Bug Report</a></td>
				</tr>
				<tr>
					<td>Trojitá <span>Trojita</span></td>
					<td>SMTP/IMAP</td>
					<td>Hard to choose implicit TLS due to typo (German)</td>
					<td>Fixed</td>
					<td><a href="https://bugs.kde.org/show_bug.cgi?id=416942">Bug Report</a></td>
				</tr>
				<tr>
					<td>Trojitá <span>Trojita</span></td>
					<td>SMTP</td>
					<td>SMTP defaults to plaintext on port 587</td>
					<td>Unknown</td>
					<td><a href="https://bugs.kde.org/show_bug.cgi?id=432354">Bug Report</a></td>
				</tr>
			</tbody>
		</table>

		<h3>Email Servers</h3>

		<p>We found 320.000 vulnerable email servers in an Internet-wide scan and conducted a coordinated disclosure
			involving different CERTs.
			It is impracticable to inform and keep track of the update process of all mail service providers on the
			Internet, and thus we identified and prioritized popular mail service
			providers.
			We only list these in the following table.</p>
		<p>Server issues are generally more severe than client issues.
			Unfortunately, no client configuration prevents server issues from being exploited, not even the usage of
			implicit TLS.
			Thus, you must ensure that your server (or your mail service provider) is not affected by STARTTLS issues.
		</p>
		<p>You can use our <a href="https://github.com/Email-Analysis-Toolkit/command-injection-tester">command_injection_tester tool</a> to verify that your server is not affected by the
			most severe issue.</p>

		<h4>Command Injection (Buffering)</h4>

		<table>
			<thead>
				<tr>
					<th>Product</th>
					<th>Protocol</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Nemesis (used by GMX / Web.de, provider)</td>
					<td>POP3/IMAP</td>
					<td>Fixed (reported privately)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Interia.pl (provider)</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Fixed (reported privately)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Yahoo (only MTA-to-MTA, provider)</td>
					<td>SMTP</td>
					<td>Unfixed (reported privately)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Yandex (provider)</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Unfixed (reported privately)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>s/qmail</td>
					<td>SMTP</td>
					<td>Fixed in 4.0.09</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-15955">CVE-2020-15955</a></td>
				</tr>
				<tr>
					<td>Coremail</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Unfixed (reported via CERT)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Citadel</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Unfixed</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-29547">CVE-2020-29547</a>, <a href="https://uncensored.citadel.org/dotgoto?room=Citadel%20Security">Bug report</a></td>
				</tr>
				<tr>
					<td>Gordano GMS</td>
					<td>POP3/IMAP</td>
					<td>Unfixed</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-37844">CVE-2021-37844</a></td>
				</tr>
				<tr>
					<td>recvmail</td>
					<td>SMTP</td>
					<td>Fixed in 3.1.2 (reported privately)</td>
					<td>-</td>
				</tr>
				<tr>
					<td>SmarterMail</td>
					<td>POP3</td>
					<td>Fixed in Build 7537</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2020-29548">CVE-2020-29548</a></td>
				</tr>
				<tr>
					<td>Burp Collaborator</td>
					<td>SMTP</td>
					<td>Fixed in 2020.9.2</td>
					<td><a href="https://hackerone.com/reports/953219">Bug report</a>, <a href="https://portswigger.net/burp/releases/professional-community-2020-9-2">Vendor release
							notes</a></td>
				</tr>
				<tr>
					<td>Dovecot</td>
					<td>SMTP</td>
					<td>Fixed in 2.3.14.1 and 2.3.15</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-33515">CVE-2021-33515</a></td>
				</tr>
				<tr>
					<td>Mercury/32</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Fixed in 4.90</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-33487">CVE-2021-33487</a></td>
				</tr>
				<tr>
					<td>QMail Toaster (1.4.1)</td>
					<td>SMTP</td>
					<td>Project discontinued</td>
					<td>-</td>
				</tr>
				<tr>
					<td>Courier</td>
					<td>POP3</td>
					<td>Fixed in 1.1.5 (reported privately), known since 2013</td>
					<td><a href="https://sourceforge.net/p/courier/mailman/courier-imap/thread/525D3389.4080507@csi.uned.es/">Discussion
							from 2013</a>, <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-38084">CVE-2021-38084</a>,
						<a href="https://sourceforge.net/p/courier/mailman/message/37329216/">Fix</a>
					</td>
				</tr>
				<tr>
					<td>PHP (stream_socket_enable_crypto)</td>
					<td>SMTP/POP3/IMAP</td>
					<td>Unfixed</td>
					<td><a href="https://bugs.php.net/bug.php?id=80008">Bug report (private)</a>
					</td>
				</tr>
			</tbody>
		</table>

		<h4>Session Fixation</h4>

		<table>
			<thead>
				<tr>
					<th>Product</th>
					<th>Protocol</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Citadel</td>
					<td>POP3/IMAP</td>
					<td>Reported via forum, unfixed</td>
					<td><a href="https://uncensored.citadel.org/dotgoto?room=Citadel%20Security">Forum with report</a>,
						<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-37845">CVE-2021-37845</a>
					</td>
				</tr>
				<tr>
					<td>IPswitch iMail</td>
					<td>POP3/IMAP</td>
					<td>Fixed in iMail 12.5.8</td>
					<td><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-37846">CVE-2021-37846</a>,
						<a href="https://docs.ipswitch.com/_Messaging/IMailServer/v12.5.8/ReleaseNotes/index.htm?__hstc=126706642.c9c7cafa58b688b17ecd93145d68181b.1582537542192.1583158280464.1583320041727.16&amp;__hssc=126706642.13.1583320041727&amp;__hsfp=3981430878#link2&#34;">Changelog</a>
					</td>
				</tr>
			</tbody>
		</table>

		<h4>Miscellaneous Issues</h4>

		<table>
			<thead>
				<tr>
					<th>Product</th>
					<th>Protocol</th>
					<th>Description</th>
					<th>Status</th>
					<th>Links</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Nemesis (used by GMX / Web.de, provider)</td>
					<td>SMTP</td>
					<td>Advertises authentication before STARTTLS even though it is disabled</td>
					<td>Fixed (reported via Bugbounty)</td>
					<td>-</td>
				</tr>
			</tbody>
		</table>
	</section>

	<section>
	<h3>Media reports</h3>

	<p><a href="https://www.golem.de/news/verschluesselung-sicherheitsrisiko-starttls-2108-158714.html">Golem.de: Sicherheitsrisiko STARTTLS</a></p>

        <h3>Presentations</h3>
        <p><a href="https://www.youtube.com/watch?v=cJhJdMC_PGI">USENIX Security &#39;21 - Why TLS is better without STARTTLS</a></p>

	<h3>Followup research</h3>

	<p>After we published our research some people found similar bugs in other protocols using STARTTLS.</p>

	<p><a href="https://fy.blackhats.net.au/blog/html/2021/08/12/starttls_in_ldap.html">StartTLS in LDAP</a></p>

	</section>

      

	



</div>
  </body>
</html>
