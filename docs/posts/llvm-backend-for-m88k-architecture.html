<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/redstar/llvm-m88k">Original</a>
    <h1>LLVM backend for m88k architecture</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">This repository contains the current state of my <strong>m88k backend for LLVM</strong>.
For general information about LLVM, please read <a href="https://github.com/redstar/llvm-m88k/blob/main-m88k/README.md">README.md</a>.</p>
<p dir="auto">The Motorola 88000 is a RISC architecture developed by Motorola in the late
1980s. See <a href="https://en.wikipedia.org/wiki/Motorola_88000" rel="nofollow">Wikipedia</a> for a
general overview.</p>
<p dir="auto">The code is based on the example from my book &#34;Learn LLVM 12&#34; (see
<a href="https://learning.oreilly.com/library/view/learn-llvm-12/9781839213502/" rel="nofollow">O&#39;Reilly</a>,
<a href="https://www.packtpub.com/product/learn-llvm-12/9781839213502" rel="nofollow">Packt</a> or
<a href="https://www.amazon.com/Learn-LLVM-12-beginners-libraries/dp/1839213507/" rel="nofollow">Amazon</a>).
It differs in the following ways:</p>
<ul dir="auto">
<li>Uses only GlobalISel. SelectionDAG support has been removed.</li>
<li>Minimal clang support. Makes it easy to crash the backend.</li>
<li>All machine instructions are implemented.</li>
<li>Assembler supports <code>.requires81100</code> directive.</li>
<li>Updates/refactoring of AsmParser, register definition, calling convention, etc.</li>
<li>Removed all Itineries in favor of the new scheduling model.</li>
</ul>
<h2 dir="auto"><a id="user-content-building-llvm-with-the-m88k-backend" aria-hidden="true" href="#building-llvm-with-the-m88k-backend"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building LLVM with the m88k backend</h2>
<p dir="auto">The m88k backend is added as experimental backend to LLVM, named <code>M88k</code>.
It&#39;s prefined in the CMake files, but if you want to compile other experimental
targets, too, then you have to pass option</p>
<p dir="auto"><code>-DLLVM_EXPERIMENTAL_TARGETS_TO_BUILD=&#34;M88k&#34;</code></p>
<p dir="auto">to CMake.</p>
<h2 dir="auto"><a id="user-content-development" aria-hidden="true" href="#development"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Development</h2>
<p dir="auto">The main development happens in branch <code>main-m88k</code>. The branch
<code>release/13.x-m88k</code> contains an older state based on LLVM 13.x. The branch
<code>release/12.x-m88k</code> contains the source from my
<a href="https://www.packtpub.com/product/learn-llvm-12/9781839213502" rel="nofollow">book</a> on top of
LLVM 12.x.</p>
<p dir="auto">This repository mirrors the LLVM <code>main</code> and <code>release/*</code> branches. I keep my
files on top of <code>main</code>, which means that I often rebase. Sorry!</p>
<h2 dir="auto"><a id="user-content-status" aria-hidden="true" href="#status"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Status</h2>
<p dir="auto">It is already possible to cross-compile small applications. For example, save the
following C source on your development machine as <code>hello.c</code>:</p>
<div data-snippet-clipboard-copy-content="int printf(const char * __restrict, ...);

int gcd_sub(int a, int b) {
  while (a != b) {
    if (a &gt; b)
      a -= b;
    else
      b -= a;
  }
  return a;
}

int main(int argc, char *argv[]) {
  int gcd = gcd_sub(123, 99);
  printf(&#34;gcd(123, 99) = %d\n&#34;, gcd);
  return 0;
}"><pre><code>int printf(const char * __restrict, ...);

int gcd_sub(int a, int b) {
  while (a != b) {
    if (a &gt; b)
      a -= b;
    else
      b -= a;
  }
  return a;
}

int main(int argc, char *argv[]) {
  int gcd = gcd_sub(123, 99);
  printf(&#34;gcd(123, 99) = %d\n&#34;, gcd);
  return 0;
}
</code></pre></div>
<p dir="auto">Compile the file with clang using <code>clang -target m88k-openbsd -c hello.c</code>
and copy the resulting object file <code>hello.o</code> to your OpenBSD m88k system.</p>
<p dir="auto">On the m88k system, you can link the program and run it:</p>
<div data-snippet-clipboard-copy-content="gcc hello.o &amp;&amp; ./a.out
gcd(123, 99) = 3"><pre><code>gcc hello.o &amp;&amp; ./a.out
gcd(123, 99) = 3
</code></pre></div>
<h2 dir="auto"><a id="user-content-support" aria-hidden="true" href="#support"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Support</h2>
<p dir="auto">If you like this work, then there are several ways you can support me:</p>
<ul dir="auto">
<li>You can contributes patches.</li>
<li>You can provide access to real hardware, e.g. as ssh login.</li>
<li>If you find some documentation (e.g. the ABI updates from 88open) I would be
happy to receive a copy.</li>
<li>You can buy me a beer or a coffee.</li>
</ul>
<h2 dir="auto"><a id="user-content-general-information-about-m88k" aria-hidden="true" href="#general-information-about-m88k"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>General information about m88k</h2>
<h3 dir="auto"><a id="user-content-programming-manuals" aria-hidden="true" href="#programming-manuals"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Programming manuals</h3>
<p dir="auto">You can find the user manuals for the 88100 and 88110 CPUs, the 88200 MMU and the
88410 secondary cache controller at bitsavers:
<a href="http://www.bitsavers.org/components/motorola/88000/" rel="nofollow">http://www.bitsavers.org/components/motorola/88000/</a>. The manual for the 88110
CPU and the 88410 cache controller are also available on GitHub:
<a href="https://github.com/awesome-cpus/awesome-cpus-m88k">https://github.com/awesome-cpus/awesome-cpus-m88k</a>. Some of the files can also be
found on <a href="https://archive.org/" rel="nofollow">https://archive.org/</a>.</p>
<p dir="auto">The ELF ABI is only available at
<a href="https://archive.org/details/bitsavers_attunixSysa0138776555SystemVRelease488000ABI1990_8011463" rel="nofollow">https://archive.org/details/bitsavers_attunixSysa0138776555SystemVRelease488000ABI1990_8011463</a>.</p>
<p dir="auto">The book <a href="https://www.amazon.com/Programming-Motorola-88000-Michael-Tucker/dp/0830635335/" rel="nofollow">Programming the Motorola 88000</a>
by Michael Tucker and Bruce Coorpender (ISBN-13: 978-0830635337,
ISBN-10: 0830635335) is out of print.</p>
<p dir="auto">In the book <a href="https://www.oreilly.com/library/view/microprocessor-architectures-2nd/9781483295534/" rel="nofollow">Microprocessor Architectures, 2nd Edition</a>
by Steve Heath, you find a description of the M88000 architecture in chapter 3.</p>
<p dir="auto">Regarding the ABI, there were some changes made by the 88open consortium. I have
not yet found that documents. If you have some of them then please contact me!</p>
<h3 dir="auto"><a id="user-content-systems" aria-hidden="true" href="#systems"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Systems</h3>
<p dir="auto">The <a href="https://www.openbsd.org/luna88k.html" rel="nofollow">OpenBSD/luna88k</a> port is still active
and provides the latest OS releases.
On a Linux or FreeBSD machine, you can use <a href="http://gavare.se/gxemul/" rel="nofollow">GXemul</a> to
run OpenBSD/luna88k.</p>
<p dir="auto">You can find information about real hardware at <a href="http://m88k.com/" rel="nofollow">m88k.com</a>.</p>
<h3 dir="auto"><a id="user-content-toolchain" aria-hidden="true" href="#toolchain"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Toolchain</h3>
<p dir="auto">gcc 3.3.6 is last version with support for the m88k architecture. See the manual
page at
<a href="https://gcc.gnu.org/onlinedocs/gcc-3.3.6/gcc/M88K-Options.html#M88K-Options" rel="nofollow">https://gcc.gnu.org/onlinedocs/gcc-3.3.6/gcc/M88K-Options.html#M88K-Options</a>.</p>
<p dir="auto">You can download that version from
ftp://ftp.nluug.nl/mirror/languages/gcc/releases/gcc-3.3.6/gcc-3.3.6.tar.gz</p>
<p dir="auto">binutils 2.16 is last version with support for the m88k architecture. See the
manual page at
<a href="https://sourceware.org/binutils/docs-2.16/" rel="nofollow">https://sourceware.org/binutils/docs-2.16/</a></p>
</article>
          </div></div>
  </body>
</html>
