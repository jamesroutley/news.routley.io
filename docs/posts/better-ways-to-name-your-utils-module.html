<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.moderndescartes.com/essays/noutils">Original</a>
    <h1>Better ways to name your utils module</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
	

<p> Originally posted 2023-09-06</p>
<p> Tagged: <a href="https://rafalcieslak.wordpress.com/essays/tags/software_engineering">software_engineering</a></p>
<p> <em>Obligatory disclaimer: all opinions are mine and not of my employer </em></p>
<hr/>

<p>As the joke goes, the two hardest problems in computer science are 1)
cache invalidation and 2) naming. Like all good jokes, there’s a kernel
of truth in there. Naming is poetry; the perfect name has both precise
meaning but also precise connotation. Naming is also mathematics; the
judicious choice of which concepts deserve a name can trivialize a
problem. In software engineering terms, good naming is equivalent to
good factoring of the problem domain into the right abstractions and
APIs.</p>
<p>A utils.py module is a failure of naming. Let’s talk about ways we
can improve the situation.</p>
<h2 id="utils.py-considered-harmful"><code>utils.py</code> Considered
Harmful</h2>
<p>see also: <code>helper.py</code>, <code>misc.py</code></p>
<p>First, a quick rundown: why exactly are utility modules considered
harmful?</p>
<p>At a philosophical level: code should make its intent clear. Nobody
would let a function name like <code>do_stuff()</code> pass code review.
So why tolerate an equally ambiguous module name?</p>
<p>At a practical level: utility modules tend to accumulate
dependencies, causing everything to depend on everything via the utils
bottleneck. It’s a great breeding ground for inadvertent circular
dependencies.</p>
<p>At a social level: the existence of one module named
<code>utils.py</code> implicitly grants permission to create more,
leading up to that doleful moment when you have to resolve a name
collision between two or more <code>utils</code> modules.</p>
<h3 id="not-considered-harmful-foo_utils.py">Not Considered Harmful:
foo_utils.py</h3>
<p>While the ideal codebase should not have any <code>utils.py</code> in
it, a pragmatic compromise is to categorize your utility code.
<code>foo_utils.py</code> demonstrates intention: it is about
<code>foo</code>, but more importantly, it is not about stuff that is
not <code>foo</code>. <code>utils/foo.py</code> is also okay.</p>
<h2 id="sorting-your-utilities">Sorting your utilities</h2>
<p>I’ve seen many flavors of utility code which could be easily sorted
into more appropriate categories. See if any of the following categories
match your code:</p>
<p><code>$PLATFORM_utils</code> - hacks, workarounds, and codified usage
patterns for a platform’s deficiencies and inconveniences. Retry/backoff
logic? Concurrency and consistency workarounds? Missing primitives?
Auth? Environment management?</p>
<p><code>testing_utils</code> - make the testing process easier
(randomness, parametrization, fuzzing, customized assertions, etc.). Do
not put test fixtures or mocks here! Those belong alongside the unit
tests that consume them. There are lots of great libraries out there for
making your tests better - <code>mock</code>, <code>parametrized</code>,
<code>hypothesis</code>, to name a few.</p>
<p><code>$DOMAIN_SPECIFIC_CONCEPT</code> - Your domain probably has some
domain-specific concepts that are not obvious to outsiders. Middleware?
Augmentation? Symmetries? If you’re relatively inexperienced in the
problem domain, you may not realize these concepts exist, and reinvent
them poorly in the utils module. Read other OSS codebases, papers, or
books to learn what these concepts are. A special-shoutout goes to
parsers and compilers, which people reinvent badly on a regular
basis.</p>
<p><code>base</code> - Foundational data types, definitions, and
concepts that are used pervasively throughout the codebase. This will
get imported everywhere, so keep a strict watch on its dependencies.</p>
<p><code>$SYSTEM_client</code>: When data generated by one system is
consumed by another, and their APIs don’t quite align, then some adaptor
code is needed to munge the data formats. If both systems are under your
control, you should figure out a better API. If one or both of those
systems is from a third party provider, then you have no choice but to
write adaptor code. As a company grows, it’s pragmatic for teams to
start treating each other as third parties, depending on org chart
distance.</p>
<p><code>visualizations</code>: often used interactively and tends to
invoke libraries with unique GUI or system dependencies that don’t work
on CI or other headless deployments.</p>
<p>single-use code: Code that only has one caller. This often makes its
way into utility modules in an attempt to hide ugly code. You should
keep this code right next to its caller, or inline the code. Nobody is
being fooled by the indirection.</p>
<h2 id="codebase-maintainers-do-you-have-a-utils-problem">Codebase
maintainers: Do you have a utils problem?</h2>
<p>Try measuring the percentage of code that lives in “utils” modules.
You can accomplish this by running <code>cloc</code> on your codebase,
and then running
<code>find . -name &#34;utils.py&#34; | cloc --list-file=-</code> to get
util-specific metrics.</p>
<p>Broken down by percent of code in utils modules:</p>
<ul>
<li>0-2%: Healthy.</li>
<li>2-10%: Unhealthy. Share this essay with your team and discourage
further additions to utils.py</li>
<li>10+%: Morbid. Your codebase – or possibly your management – needs an
intervention of some sort.</li>
</ul>
<p>If you have a healthy amount of code in utils modules,
congratulations! I’d suggest writing up the <code>cloc</code> commands
as a script to monitor regression. Of course, beware Goodheart’s law,
and don’t hold anyone to this metric!</p>


    </div>
</div></div>
  </body>
</html>
