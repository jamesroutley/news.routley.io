<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.phor.net/2022/11/04/Does-OpenSea-Shared-Storefront-have-a-backdoor.html">Original</a>
    <h1>Backdoor in OpenSea allows to take anybody&#39;s tokens</h1>
    
    <div id="readability-page-1" class="page"><article>
    <!-- This helps if the first item in the article is a margin note -->
<p>This project demonstrates how OpenSea administrators can take any tokens minted on the OpenSea Shared Storefront. This is a previously-undocumented backdoor.</p>

<p>Is this what artists expected when they decided to mint with OpenSea?</p>

<h2 id="background">Background</h2>

<p>OpenSea Shared Storefront is the ERC-1155 contract deployed on Ethereum Mainnet. If you try to create an NFT using the OpenSea website and follow all the default options without creating your own smart contract, this is where your NFT will go.</p>

<p>At time of writing, this contract holds NFTs “owned” by 600k+ accounts.</p>

<p>There <a href="https://etherscan.io/txs?a=0x495f947276749ce646f68ac8c248420045cb7b5e">are about 1 million transactions</a> against this contract.</p>

<p>OpenSea administrators maintain control over this contract such that they can take, or freeze, anybody’s NFT at any time. The contract’s source code is not published and this control ability is not disclosed anywhere in OpenSea’s terms of service or documentation.</p>

<p>OpenSea’s level of control should be considered “signature authority” over the assets, for US FinCen purposes and this makes OpenSea administrators capable of executing civil asset seizures/forfeitures requested by governments.</p>

<h2 id="demonstration">Demonstration</h2>

<p>I <a href="https://github.com/fulldecent/opensea-shared-storefront-backdoor">published a project</a> showing you exactly how to perform these asset seizures.</p>

<p>This project allows you to make a live copy of Ethereum Mainnet, execute some transactions as if you were OpenSea (even though you don’t know their private key) and examine the outcomes.</p>

<p>You should see some information printed and proof that the token was transferred even though the “owner” did not wittingly authorize it.</p>

<p>If OpenSea administrators run this same transaction with their real private key this token would be transferred for real. (What you are seeing is a local copy of this transaction which ignores the fact that it is invalid for want of the correct private key.)</p>

<p>The above paragraph is a brief simplification. OpenSea Shared Storefront has recently changed from a single owner, to a Gnosis safe. No difference, to execute this transaction OpenSea administrators need to use only a slightly different process.</p>

<h2 id="is-opensea-violating-us-treasury-ofacsdn-sanction-requirements">Is OpenSea violating US Treasury OFAC/SDN sanction requirements?</h2>

<p>Is OpenSea subverting sanctions by allowing sanctioned entities to hold digital assets that OpenSea has the ability to seize?</p>

<p>In their <a href="https://opensea.io/privacy">privacy policy</a>, they already state that customer’s personal data can be used to comply with investigations by law enforcement and for other reasons.</p>

<p>But are they using this ability to seize tokens? And since OpenSea is obligated to stop transactions with sanctioned entities from the OFAR/SDN lists, are they using this ability to comply with this requirement?</p>

<p>To answer this question, I reviewed the historical list of OpenSea Shared Storefront token holders and then current OFAC/SDN sanctions lists to find if OpenSea has effectively stopped sanctioned entities from putting through transactions. Too much for this post, so stay tuned for a follow up post here.</p>

<h2 id="how-do-decompile-and-study-smart-contracts">How do decompile and study smart contracts</h2>

<p>Because OpenSea did not publish the source code for this contract, it was necessary for me to decompile it to study it. If you would ever like to try the same approach with other popular but unverified smart contracts, below are some basic notes on the approach.</p>

<p>Here are some notes about how to effectively decompile and study smart contracts, read the Matrix. I recommend doing this on paper with color pencils/highlighters. You might have to take a lot of notes and this helps.</p>

<ol>
  <li>Use <a href="https://ethervm.io/decompile">Online Solidity Decompiler</a>.</li>
  <li>Remove top-level <code>contract</code>, reduce indent, paste into MS Word or similar</li>
</ol>

<p>Since OpenSea general produces intentional code, I was only looking for backdoors, code paths that results in a <code>SSTORE</code>.</p>

<ol>
  <li>Replace <code>revert.*;</code> to <code>REVERT</code></li>
  <li>Replace `  var.<em>\W+REVERT.</em><code> and </code>  memory.*\W+REVERT<code> to </code>REVERT`, go back and forth a few times</li>
  <li>In <code>main</code> function</li>
  <li>Find dispatches that result in <code>return</code>, replace with <code>return; // does not change state</code></li>
  <li>On dispatch, mark in red any called function/goto</li>
  <li>On red things, mark in red any called function/goto, repeat</li>
  <li>Delete everything not red</li>
</ol>

<p>You have completed the easy steps. Go to bed and do the rest steps with full brain power.</p>

<h2 id="acknowledgements">Acknowledgements</h2>

<ul>
  <li>Contract decompilation (easier than reading straight bytecode) provided by <a href="https://ethervm.io/decompile">https://ethervm.io/decompile</a></li>
  <li>Tracing each <code>SLOAD</code> and <code>STATICCALL</code> while playing with contracts provided by <a href="https://twitter.com/sohamzemse">@sohamzemse</a> in <a href="https://github.com/zemse/hardhat-tracer">hardhat-tracer</a>, running on <a href="https://twitter.com/HardhatHQ">@HardhatHQ</a> <a href="https://hardhat.org/">Hardhat</a>.</li>
</ul>

<h2 id="reading-circle-questions">Reading circle questions</h2>

<ul>
  <li>For artists, does this shared ownership with OpenSea affect your interest in publishing with them?</li>
  <li>Does OpenSea’s ability to take tokens count as “ownership” in the same way that the token’s buyer is considered an “owner”?</li>
  <li>Is OpenSea’s implementation compliant with <a href="https://eips.ethereum.org/EIPS/eip-1155#approval">ERC-1155</a>’s transfer and approval specifications?</li>
  <li>Is it necessary for a large company to publish their smart contract’s source code even when many people won’t read it?</li>
</ul>

    <p>▧</p>  
    <h2>Comments</h2>
    <p>Discuss and share this topic anywhere. May we recommend:</p>
    <ul><li>
        <a target="_blank" href="https://twitter.com/fulldecent/status/1589652866041401344">
          <figure>
          <blockquote>
            <p>The official Twitter thread</p>
          </blockquote>
          
        </figure> 
      </a>
    </li><li>
        <a target="_blank" href="https://twitter.com/fulldecent/status/1577066829440503808">
          <figure>
          <blockquote>
            <p>Why didn&#39;t OpenSea publish this smart contract?</p>
          </blockquote>
          
        </figure> 
      </a>
    </li><li>
        <a target="_blank" href="https://twitter.com/fulldecent/status/1582140475208699904">
          <figure>
          <blockquote>
            <p>Reverse engineering bytecode, Ben Affleck style, no paycheck</p>
          </blockquote>
          
        </figure> 
      </a>
    </li><li>Please let me know any other good media coverage I should link here.</li>
      <li>Talk with me live every Tuesday 6pm (New York) at <a target="csh" href="https://phor.net/#speaking">NFT/Web3 Community Service Hour</a>.</li>
    </ul>
  </article></div>
  </body>
</html>
