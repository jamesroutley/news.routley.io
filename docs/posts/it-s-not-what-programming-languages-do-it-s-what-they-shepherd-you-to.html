<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nibblestew.blogspot.com/2020/03/its-not-what-programming-languages-do.html">Original</a>
    <h1>It&#39;s not what programming languages do, it&#39;s what they shepherd you to</h1>
    
    <div id="readability-page-1" class="page"><section id="main" role="main">
						<div id="loop-container">
		<div>
			<article>
		
		<div>
						
<p>In this post, we’ll see how to style an input element used to add images:</p>











<p>Into one that adds images and generates a preview with a “+” button:</p>



    



<p>(Clicking on the “submit” button will print a list of the added image files)</p>



<p>We’ll obtain this result by using a second input as a helper, storing the added image files in an array, and setting the input files before submitting.</p>



<h2>Markup</h2>



<p>Our markup will consist of a form with two input elements.</p>



<pre data-enlighter-language="html" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">&lt;form class=&#34;custom__form&#34;&gt;
  &lt;p&gt;Add image&lt;/p&gt;
  &lt;div class=&#34;custom__image-container&#34;&gt;
    &lt;label id=&#34;add-img-label&#34; for=&#34;add-single-img&#34;&gt;+&lt;/label&gt;
    &lt;input type=&#34;file&#34; id=&#34;add-single-img&#34; accept=&#34;image/jpeg&#34; /&gt;
  &lt;/div&gt;
  &lt;input
    type=&#34;file&#34;
    id=&#34;image-input&#34;
    name=&#34;photos&#34;
    accept=&#34;image/jpeg&#34;
    multiple
  /&gt;
  &lt;br /&gt;
  &lt;div class=&#34;form__controls&#34;&gt;&lt;button type=&#34;submit&#34;&gt;Submit&lt;/button&gt;&lt;/div&gt;
&lt;/form&gt;</pre>



<p>The first input element <code>add-single-img</code> will be used to add the image files one by one. However, the input <code>image-input</code> is the one we really care about when submitting the form.</p>



<p>One important aspect is that the <code>+</code> label element is associated with the helper input via the <code>for</code> attribute. This way, when we click on it, the input is triggered. </p>



<h2>Styling</h2>



<p>Both input elements will be hidden because it’s difficult to modify and style them directly.</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">.custom__form input {
  opacity: 0;
  height: 0;
}</pre>



<p>The “+” button used to select images is placed inside a container. As we select images, a preview of them will be added to this same container.</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">.custom__image-container {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}</pre>



<p>Since the helper input element is hidden, we interact with it via its label (important to set the <code>for</code> attribute accordingly). We style it to look like a square button.</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">.custom__image-container label {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 150%;
  cursor: pointer;
  width: 100px;
  height: 100px;
  border: solid 1px black;
  border-radius: 5px;
  object-fit: cover;
}</pre>



<p>Similar rules are applied to <code>img</code> elements that will be added to the container as we select new image files.</p>



<pre data-enlighter-language="raw" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">.custom__image-container img {
  width: 100px;
  height: 100px;
  border: solid 1px black;
  border-radius: 5px;
  object-fit: cover;
}</pre>



<h2>Scripts</h2>



<p>We start by defining the following global variables.</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">const imgInputHelper = document.getElementById(&#34;add-single-img&#34;);
const imgInputHelperLabel = document.getElementById(&#34;add-img-label&#34;);
const imgContainer = document.querySelector(&#34;.custom__image-container&#34;);
const imgFiles = [];</pre>



<p>The first three are there only for convenience. The global <code>imgFiles</code> will store the image <a href="https://developer.mozilla.org/en-US/docs/Web/API/File">files</a> that the user selects. </p>



<h3>Adding image previews</h3>



<p>Every time we select an image via the <code>+</code> button, a preview of it will be generated. We’ll trigger this effect via a “change” event listener on the helper input element. </p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">const addImgHandler = () =&gt; {
  const file = imgInputHelper.files[0];
  if (!file) return;

  // Generate img preview
  const reader = new FileReader();
  reader.readAsDataURL(file);
  reader.onload = () =&gt; {
    const newImg = document.createElement(&#34;img&#34;);
    newImg.src = reader.result;
    imgContainer.insertBefore(newImg, imgInputHelperLabel);
  };

  // Store img file
  imgFiles.push(file);

  // Reset image input
  imgInputHelper.value = &#34;&#34;;
  return;
};

imgInputHelper.addEventListener(&#34;change&#34;, addImgHandler);</pre>



<p>To generate the image preview, we used a <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader">FileReader</a>. A more direct approach would use the <code>URL.createObjectURL</code> method, as can be seen in <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file#examples">this example</a>.</p>



<h3>Creating a list of files</h3>



<p>We stored the added images in the <code>imgFiles</code> array. Input elements store files in <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/FileList">FileList</a></code> objects. There is no “FileList” constructor. We will create it indirectly via a <code>DataTransfer</code> object. </p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">const getImgFileList = (imgFiles) =&gt; {
  const imgFilesHelper = new DataTransfer();
  imgFiles.forEach((imgFile) =&gt; imgFilesHelper.items.add(imgFile));
  return imgFilesHelper.files;
};</pre>



<p>The function above takes the array of Files <code>imgFiles</code> that we used previously to store the image files. It returns a <code>FileList</code> generated by using the <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer/files">DataTransfer</a></code> object. </p>



<p>Credit for this approach goes to <a href="https://stackoverflow.com/questions/52078853/is-it-possible-to-update-filelist/56447852#56447852">this StackOverflow answer</a>.</p>



<h3>Submitting the list of files</h3>



<p>Before the actual form submission,  we will take the files stored in <code>imgFiles</code>, create a “FileList” and assign it to the input element (not the helper).</p>



<pre data-enlighter-language="js" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">const customFormSubmitHandler = (ev) =&gt; {
  ev.preventDefault();
  const firstImgInput = document.getElementById(&#34;image-input&#34;);
  firstImgInput.files = getImgFileList(imgFiles);
  // submit form to server, etc
};

document
  .querySelector(&#34;.custom__form&#34;)
  .addEventListener(&#34;submit&#34;, customFormSubmitHandler);</pre>



<p>As a result, we’ll have our original input element <code>image-input</code> with a FileList as if we had selected them directly using the native element.</p>



<hr/>



<p>Access the source code <a href="https://github.com/fabrizzio-gz/img-input-stytle">here</a>.</p>
					</div>
					</article>
		<nav>
	
	
</nav>	    
    
    
    
    </div>	</div>
</section></div>
  </body>
</html>
