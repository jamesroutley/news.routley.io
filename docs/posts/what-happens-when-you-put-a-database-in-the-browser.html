<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://motherduck.com/blog/olap-database-in-browser/">Original</a>
    <h1>What Happens When You Put a Database in the Browser?</h1>
    
    <div id="readability-page-1" class="page"><div><div><p><a href="https://webassembly.org/">WebAssembly</a> (Wasm) has transformed the capabilities of browsers, enabling high-performance applications without needing anything beyond the browser itself. DuckDB, which <a href="https://duckdb.org/docs/api/wasm/overview.html">can also run in browsers via Wasm</a>, opens up numerous possibilities. In this blog, we&#39;ll explore various use cases of DuckDB in the browser and introduce a fun, practical example that you can try yourself, complete with <a href="https://github.com/mehd-io/parquet-info-firefox-extension/tree/main">source code</a>.</p>
<section><h2 id="why-wasm">Why Wasm?</h2><p>Wasm is a powerful tool that is gaining traction in web development. Popular applications like <a href="https://www.figma.com/blog/webassembly-cut-figmas-load-time-by-3x/">Figma</a> use Wasm to run complex software written in languages such as C++ or Rust directly in the browser. This allows for fast, lightweight applications that are easy to deploy. As browsers become more capable, even utilizing WebGPU to harness GPU power directly, possibilities such as training machine learning models locally on your machine via a browser link are becoming feasible, eliminating setup hassles.</p><p>An exciting project in the Wasm ecosystem is <a href="https://pyodide.org/en/stable/">pyodide</a>, which ports CPython to WebAssembly, offering a full Python environment in your browser just from a URL, minimizing reliance on cloud resources. Check out the pyodide REPL <a href="https://pyodide.org/en/stable/console.html">here</a>.</p></section>
<section><h2 id="current-uses-of-duckdb-wasm">Current Uses of DuckDB Wasm</h2><p>DuckDB, being a C++ written, embedded database, is ideal for Wasm. It has been compiled to WebAssembly, allowing it to operate inside any browser. You can experience this <a href="https://shell.duckdb.org/">here</a> by running DuckDB directly in your browser.
DuckDB Wasm is particularly useful in user interfaces requiring lightweight analytic operations, reducing network traffic.</p><p>Here are some common scenarios:</p><ol>
<li>Ad-hoc queries on data lakes, such as schema exploration or data previews.</li>
<li>Dynamic querying in dashboards by adjusting filters on-the-fly.</li>
<li>Educational tools for SQL learning or in-browser SQL IDEs.</li>
</ol><p>For example, <a href="https://lakefs.io/">lakeFS</a> has integrated DuckDB Wasm <a href="https://lakefs.io/blog/lakefs-duckdb-embedding-an-olap-database-in-the-lakefs-ui/">for ad-hoc queries within their Web UI</a>. Similarly, companies like <a href="https://evidence.dev/blog/why-we-built-usql/">Evidence</a> and <a href="https://count.co/blog/how-we-evolved-our-query-architecture-with-duckdb/">Count</a> leverage DuckDB Wasm to enhance performance.</p><p><img alt="demo_lake_fs" sizes="90vw,
                        (min-width: 728px) 688px,
                        (min-width: 960px) 840px,
                        (min-width: 1302px) 816px," srcset="/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=3840&amp;q=75 3840w" src="https://motherduck.com/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Flakefs_demo_6c2ecdc39d.gif&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" loading="lazy"/>
<em>Running DuckDB, embedded in the lakeFS UI</em></p><p><img alt="evidence" sizes="90vw,
                        (min-width: 728px) 688px,
                        (min-width: 960px) 840px,
                        (min-width: 1302px) 816px," srcset="/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=3840&amp;q=75 3840w" src="https://motherduck.com/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2Fusql_architecture_19ec231cea.png&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" loading="lazy"/>
<em>Universal SQL Architecture from Evidence: Data -&gt; Storage -&gt; DuckDB Wasm -&gt; Components</em></p></section>
<section><h2 id="duckdb-wasm-as-a-firefox-extension">DuckDB Wasm as a Firefox extension</h2><p>It&#39;s pretty common when navigating to object storage (would it AWS S3 or GCP Cloud storage, or Azure blob storage), that you want to quickly inspect a file or its schema, would it be for debugging or quickly preview a sample of data.</p><p>In this small project, we have created a Firefox extension that displays the schema of Parquet files when you hover your mouse over them in GCP Cloud Storage.
Here&#39;s a short video demo.</p><video width="500" height="500" loop="" autoplay="" muted="">
  <source src="https://motherduck-com-web-prod.s3.amazonaws.com/assets/img/demo_plugin_firefox_ca72404906.mp4" type="video/mp4"/>
  Your browser does not support the video tag.
</video><p>The internals are pretty simple - with DuckDB Wasm, we can run directly a query on the client side, which does a query of the remote parquet file, and display its metadata.</p><img alt="architecture" sizes="90vw,
                        (min-width: 728px) 688px,
                        (min-width: 960px) 840px,
                        (min-width: 1302px) 816px," srcset="/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=640&amp;q=75 640w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=750&amp;q=75 750w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=828&amp;q=75 828w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=1080&amp;q=75 1080w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=1200&amp;q=75 1200w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=1920&amp;q=75 1920w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=2048&amp;q=75 2048w, /_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=3840&amp;q=75 3840w" src="https://motherduck.com/_next/image/?url=https%3A%2F%2Fmotherduck-com-web-prod.s3.amazonaws.com%2Fassets%2Fimg%2FDrawing_2024_06_17_17_29_09_excalidraw_e143fccef6.png&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" loading="lazy"/><p>Let&#39;s get a grasp of the main component of the Firefox extension code, written in Javascript.</p><p>We instantiate the database :</p><pre><code>
<span>async</span> <span>function</span> <span>makeDB</span>(<span></span>) {
  <span>const</span> logger = <span>new</span> duckdb.<span>ConsoleLogger</span>();
  <span>const</span> worker = <span>await</span> duckdb.<span>createWorker</span>(bundle.<span>mainWorker</span>);
  <span>const</span> db = <span>new</span> duckdb.<span>AsyncDuckDB</span>(logger, worker);
  <span>await</span> db.<span>instantiate</span>(bundle.<span>mainModule</span>);
  <span>return</span> db
}
</code></pre><p>Create a function to handle query results :</p><pre><code><span>async</span> <span>function</span> <span>query</span>(<span>sql</span>) {
  <span>const</span> q = <span>await</span> conn.<span>query</span>(sql); 
  <span>const</span> rows = q.<span>toArray</span>().<span>map</span>(<span>Object</span>.<span>fromEntries</span>);
  rows.<span>columns</span> = q.<span>schema</span>.<span>fields</span>.<span>map</span>(<span>(<span>d</span>) =&gt;</span> d.<span>name</span>);
  <span>return</span> rows;
}

</code></pre><p>And finally a function to handle hover events :</p><pre><code><span>async</span> <span>function</span> <span>hover</span>(<span>request, sender, sendResponse</span>) {
  
  
  <span>const</span> fileName = request[<span>&#39;filename&#39;</span>];

  
  <span>const</span> url = sender.<span>url</span>;

  
  
  <span>const</span> bucketName = url.<span>split</span>(<span>&#39;/storage/browser/&#39;</span>)[<span>1</span>].<span>split</span>(<span>&#39;;&#39;</span>)[<span>0</span>];

  
  <span>const</span> filePath = <span>`s3://<span>${bucketName}</span>/<span>${fileName}</span>`</span>;
  <span>console</span>.<span>log</span>(filePath);

  <span>const</span> schema = <span>await</span> <span>query</span>(<span>`SELECT path_in_schema AS column_name, type FROM parquet_metadata(&#39;<span>${filePath}</span>&#39;);`</span>);
  <span>return</span> <span>Promise</span>.<span>resolve</span>({ schema });
}
</code></pre><p>As you can see, we are using the <a href="https://duckdb.org/docs/data/parquet/metadata.html">parquet_metadata()</a> function to retrieve parquet schema here.
After that what is left is to define the handler and the panel displayed. You can check out the full code <a href="https://github.com/mehd-io/parquet-info-firefox-extension/blob/main/content_scripts/main.js">here</a>.
Check out the complete extension code <a href="https://github.com/mehd-io/parquet-info-firefox-extension/tree/main/content_scripts/main.js">here</a>, and watch our <a href="https://www.youtube.com/watch?v=81qCRIvKI6A">full livestream</a> with <a href="https://www.linkedin.com/in/christopheblefari/">Christophe Blefari</a> discussing DuckDB Wasm and this project.</p></section>
<section><h2 id="what-about-motherduck">What about MotherDuck?</h2><p>The MotherDuck UI uses DuckDB Wasm to ensure responsive querying, especially when manipulating data already loaded locally. This means there is no need to communicate with the cloud, and both data and computing remain on your local machine.</p><p>We&#39;ve also launched our <a href="https://motherduck.com/docs/key-tasks/data-apps/wasm-client/">Wasm SDK</a> to enable developers to create data-driven applications using Wasm, powered by DuckDB and MotherDuck.</p></section>
<section><h2 id="moving-forward">Moving forward</h2><p>In this blog, we&#39;ve seen how Wasm is already reshaping popular web applications. DuckDB Wasm offers a unique opportunity for data professionals to build faster and more efficient analytics applications.</p><p>Try out <a href="https://app.motherduck.com/">MotherDuck</a> for free, explore our Wasm SDK, and keep coding and quacking!</p></section></div></div><div><div><p>Subscribe to MotherDuck Blog</p><form><div><div><p><label for="subscribe_md_emails">Also subscribe to other MotherDuck updates</label></p></div></div></form></div></div></div>
  </body>
</html>
