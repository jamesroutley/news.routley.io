<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://samcurry.net/web-hackers-vs-the-auto-industry/">Original</a>
    <h1>Web hackers vs. the auto industry</h1>
    
    <div id="readability-page-1" class="page"><div>

	<div data-post-id="2180"><div data-node="gblar1it397k">
	<div>
						<div>
		
<div data-node="m5gsot39auye">
			<div data-node="e840htir16yx">
	<div><div data-node="jiqv0lwo81m4">
	<div>
		<div>
	<p>During the fall of 2022, a few friends and I took a road trip from Chicago, IL to Washington, DC to attend a cybersecurity conference and (try) to take a break from our usual computer work.</p>
<p>While we were visiting the University of Maryland, we came across a fleet of electric scooters scattered across the campus and couldn&#39;t resist poking at the scooter&#39;s mobile app. To our surprise, our actions caused the horns and headlights on all of the scooters to turn on and stay on for 15 minutes straight.</p>
<p><iframe loading="lazy" title="Oops" width="688" height="387" src="https://www.youtube.com/embed/YRAy3wv5SCk?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe></p>
<p>When everything eventually settled down, we sent a report over to the scooter manufacturer and became super interested in trying to more ways to make more things honk. We brainstormed for a while, and then realized that nearly every automobile manufactured in the last 5 years had nearly identical functionality. If an attacker were able to find vulnerabilities in the API endpoints that vehicle telematics systems used, they could honk the horn, flash the lights, remotely track, lock/unlock, and start/stop vehicles, completely remotely.</p>
<p>At this point, we started a group chat and all began to work with the goal of finding vulnerabilities affecting the automotive industry. Over the next few months, we found as many car-related vulnerabilities as we could. The following writeup details our work exploring the security of telematic systems, automotive APIs, and the infrastructure that supports it.</p>
<h2>Findings Summary</h2>
<p>During our engagement, we found the following vulnerabilities in the companies listed below:</p>
<ul>
<li><span><strong>Kia, Honda, Infiniti, Nissan, Acura</strong></span>
<ul>
<li aria-level="2"><span>Fully remote lock, unlock, engine start, engine stop, precision locate, flash headlights, and honk vehicles using only the VIN number</span></li>
<li aria-level="2"><span>Fully remote account takeover and PII disclosure via VIN number (name, phone number, email address, physical address)</span></li>
<li aria-level="2"><span>Ability to lock users out of remotely managing their vehicle, change ownership</span>
<ul>
<li aria-level="3"><span><span><span>For Kia’s specifically, we could remotely access the 360-view camera and view live images from the car</span></span></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Mercedes-Benz</strong></span>
<ul>
<li>Access to hundreds of mission-critical internal applications via improperly configured SSO, including…
<ul>
<li>Multiple Github instances behind SSO</li>
<li>Company-wide internal chat tool, ability to join nearly any channel</li>
<li>SonarQube, Jenkins, misc. build servers</li>
<li>Internal cloud deployment services for managing AWS instances</li>
<li>Internal Vehicle related APIs</li>
</ul>
</li>
<li>Remote Code Execution on multiple systems</li>
<li>Memory leaks leading to employee/customer PII disclosure, account access</li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Hyundai, Genesis</strong></span>
<ul>
<li aria-level="2"><span>Fully remote lock, unlock, engine start, engine stop, precision locate, flash headlights, and honk vehicles using only the victim email address</span></li>
<li aria-level="2"><span>Fully remote account takeover and PII disclosure via victim email address (name, phone number, email address, physical address)</span></li>
<li aria-level="2"><span>Ability to lock users out of remotely managing their vehicle, change ownership</span></li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>BMW, Rolls Royce</strong></span>
<ul>
<li>Company-wide core SSO vulnerabilities which allowed us to access any employee application as any employee, allowed us to…
<ul>
<li aria-level="3"><span>Access to internal dealer portals where you can query any VIN number to retrieve sales documents for BMW</span></li>
<li aria-level="3"><span>Access any application locked behind SSO on behalf of any employee, including applications used by remote workers and dealerships</span></li>
</ul>
</li>
</ul>
</li>
<li><span><strong>Ferrari</strong></span>
<ul>
<li aria-level="2"><span>Full zero-interaction account takeover for any Ferrari customer account</span></li>
<li aria-level="2"><span>IDOR to access all Ferrari customer records</span></li>
<li aria-level="2"><span>Lack of access control allowing an attacker to create, modify, delete employee “back office” administrator user accounts and all user accounts with capabilities to modify Ferrari owned web pages through the CMS system</span></li>
<li aria-level="2"><span>Ability to add HTTP routes on api.ferrari.com (rest-connectors) and view all existing rest-connectors and secrets associated with them (authorization headers)</span></li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Spireon</strong></span>
<ul>
<li><span>Multiple vulnerabilities, including:</span>
<ul>
<li aria-level="3"><span>Full administrator access to a company-wide administration panel with ability to send arbitrary commands to an estimated 15.5 million vehicles (unlock, start engine, disable starter, etc.), read any device location, and flash/update device firmware</span></li>
<li aria-level="3"><span>Remote code execution on core systems for managing user accounts, devices, and fleets. Ability to access and manage all data across all of Spireon</span></li>
<li aria-level="3"><span>Ability to fully takeover any fleet (this would’ve allowed us to track &amp; shut off starters for police, ambulances, and law enforcement vehicles for a number of different large cities and dispatch commands to those vehicles, e.g. “navigate to this location”)</span></li>
<li aria-level="3"><span>Full administrative access to all Spireon products, including the following…</span>
<ul>
<li aria-level="3"><span>GoldStar - </span><a href="https://www.spireon.com/products/goldstar/"><span>https://www.spireon.com/products/goldstar/</span></a></li>
<li aria-level="4"><span>LoJack - </span><a href="https://www.spireon.com/products/goldstar/lojackgo/"><span>https://www.spireon.com/products/goldstar/lojackgo/</span></a><span> </span></li>
<li aria-level="4"><span>FleetLocate - </span><a href="https://www.spireon.com/products/fleetlocate-for-fleet-managers/"><span>https://www.spireon.com/products/fleetlocate-for-fleet-managers/</span></a><span> </span></li>
<li aria-level="4"><span>NSpire - </span><a href="https://www.spireon.com/spireon-nspire-platform/"><span>https://www.spireon.com/spireon-nspire-platform/</span></a><span> </span></li>
<li aria-level="4"><span>Trailer &amp; Asset - </span><a href="https://www.spireon.com/solutions/trailer-asset-managers/"><span>https://www.spireon.com/solutions/trailer-asset-managers/</span></a></li>
</ul>
</li>
<li aria-level="3"><span>In total, there were…</span>
<ul>
<li aria-level="4"><span>15.5 million devices (mostly vehicles)</span></li>
<li aria-level="4">1.2 million user accounts (end user accounts, fleet managers, etc.)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Ford</strong></span>
<ul>
<li aria-level="2"><span>Full memory disclosure on production vehicle Telematics API discloses</span>
<ul>
<li aria-level="3"><span>Discloses customer PII and access tokens for tracking and executing commands on vehicles</span></li>
<li aria-level="3"><span>Discloses configuration credentials used for internal services related to Telematics</span></li>
<li aria-level="3"><span>Ability to authenticate into customer account and access all PII and perform actions against vehicles</span></li>
</ul>
</li>
<li aria-level="2"><span><span>Customer account takeover via improper URL parsing, allows an attacker to completely access victim account including vehicle portal</span></span></li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Reviver</strong></span>
<ul>
<li aria-level="2"><span>Full super administrative access to manage all user accounts and vehicles for all Reviver connected vehicles. An attacker could perform the following:</span>
<ul>
<li aria-level="3"><span>Track the physical GPS location and manage the license plate for all Reviver customers (e.g. changing the slogan at the bottom of the license plate to arbitrary text)</span></li>
<li aria-level="3"><span>Update any vehicle status to “STOLEN” which updates the license plate and informs authorities</span></li>
<li aria-level="3"><span>Access all user records, including what vehicles people owned, their physical address, phone number, and email address</span></li>
<li aria-level="3"><span>Access the fleet management functionality for any company, locate and manage all vehicles in a fleet</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Porsche</strong></span>
<ul>
<li aria-level="2"><span><span><span>Ability to send retrieve vehicle location, send vehicle commands, and retrieve customer information via vulnerabilities affecting the vehicle Telematics service</span></span></span></li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Toyota</strong></span>
<ul>
<li aria-level="2"><span>IDOR on Toyota Financial that discloses the name, phone number, email address, and loan status of any Toyota financial customers</span></li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>Jaguar, Land Rover</strong></span>
<ul>
<li>User account IDOR disclosing password hash, name, phone number, physical address, and vehicle information</li>
</ul>
</li>
</ul>
<ul>
<li><span><strong>SiriusXM</strong></span>
<ul>
<li><span><span>Leaked AWS keys with full organizational read/write S3 access, ability to retrieve all files including (what appeared to be) user databases, source code, and config files for Sirius</span></span></li>
</ul>
</li>
</ul>
<h2>Vulnerability Writeups</h2>
<h3>(1) Full Account Takeover on BMW and Rolls Royce via Misconfigured SSO</h3>
<p>While testing BMW assets, we identified a custom SSO portal for employees and contractors of BMW. This was super interesting to us, as any vulnerabilities identified here could potentially allow an attacker to compromise any account connected to all of BMWs assets.</p>
<p>For instance, if a dealer wanted to access the dealer portal at a physical BMW dealership, they would have to authenticate through this portal. Additionally, this SSO portal was used to access internal tools and related devops infrastructure.</p>
<p>The first thing we did was fingerprint the host using OSINT tools like gau and ffuf. After a few hours of fuzzing, we identified a WADL file which exposed API endpoints on the host via sending the following HTTP request:</p>
<pre><span>GET /rest/api/application.wadl HTTP/1.1
</span><span>Host: xpita.bmwgroup.com</span></pre>
<p><span>The HTTP response contained all available REST endpoints on the xpita host. We began enumerating the endpoints and sending mock HTTP requests to see what functionality was available.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image-one.png" alt="" width="2560" height="1410" srcset="https://samcurry.net/wp-content/uploads/2022/12/image-one.png 2560w, https://samcurry.net/wp-content/uploads/2022/12/image-one-300x165.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image-one-1024x564.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image-one-768x423.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image-one-1536x846.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image-one-2048x1128.png 2048w, https://samcurry.net/wp-content/uploads/2022/12/image-one-1600x881.png 1600w" sizes="(max-width: 2560px) 100vw, 2560px"/></p>
<p><span>One immediate finding was that we were able to query all BMW user accounts via sending asterisk queries in the user field API endpoint. This allowed us to enter something like “sam*” and retrieve the user information for a user named “sam.curry” without having to guess the actual username.</span></p>
<p><b>HTTP Request</b></p>
<pre><span>GET /reset/api/users/example* HTTP/1.1
</span><span>Host: xpita.bmwgroup.com</span></pre>
<p><b>HTTP Response</b></p>
<pre><span>HTTP/1.1 200 OK
</span><span>Content-type: application/json

</span><span>{“id”:”redacted”,”firstName”:”Example”,”lastName”:”User”,”userName”:”example.user”}</span></pre>
<p><span>Once we found this vulnerability, we continued testing the other accessible API endpoints. One particularly interesting one which stood out immediately was the “/rest/api/chains/accounts/:user_id/totp” endpoint. We noticed the word “totp” which usually stood for one-time password generation.</span></p>
<p><span>When we sent an HTTP request to this endpoint using the SSO user ID gained from the wildcard query paired with the TOTP endpoint, it returned a random 7-digit number. The following HTTP request and response demonstrate this behavior:</span></p>
<p><b>HTTP Request</b></p>
<pre><span>GET /rest/api/chains/accounts/unique_account_id/totp HTTP/1.1
</span><span>Host: xpita.bmwgroup.com</span></pre>
<p><b>HTTP Response</b></p>
<pre><span>HTTP/1.1 200 OK
</span><span>Content-type: text/plain
</span><span>
9373958</span></pre>
<p><span>For whatever reason, it appeared that this HTTP request would generate a TOTP for the user’s account. We guessed that this interaction worked with the “forgot password” functionality, so we found an example user account by querying “example*” using our original wildcard finding and retrieving the victim user ID. After retrieving this ID, we initiated a reset password attempt for the user account until we got to the point where the system requested a TOTP code from the user’s 2FA device (e.g. email or phone).</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2023/01/image12-1.png" alt="" width="1944" height="1054" srcset="https://samcurry.net/wp-content/uploads/2023/01/image12-1.png 1944w, https://samcurry.net/wp-content/uploads/2023/01/image12-1-300x163.png 300w, https://samcurry.net/wp-content/uploads/2023/01/image12-1-1024x555.png 1024w, https://samcurry.net/wp-content/uploads/2023/01/image12-1-768x416.png 768w, https://samcurry.net/wp-content/uploads/2023/01/image12-1-1536x833.png 1536w, https://samcurry.net/wp-content/uploads/2023/01/image12-1-1600x867.png 1600w" sizes="(max-width: 1944px) 100vw, 1944px"/></p>
<p><span>At this point, we retrieved the TOTP code generated from the API endpoint and entered it into the reset password confirmation field.</span></p>
<p><span>It worked! We had reset a user account, gaining full account takeover on any BMW employee and contractor user.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image17.png" alt="" width="1999" height="511" srcset="https://samcurry.net/wp-content/uploads/2022/12/image17.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image17-300x77.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image17-1024x262.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image17-768x196.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image17-1536x393.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image17-1600x409.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>At this point, it was possible to completely take over any BMW or Rolls Royce employee account and access tools used by those employees.</span></p>
<p><span>To demonstrate the impact of the vulnerability, we simply Googled “BMW dealer portal” and used our account to access the dealer portal used by sales associates working at physical BMW and Rolls Royce dealerships.</span></p>
<p><span>After logging in, we observed that the demo account we took over was tied to an actual dealership, and we could access all of the functionality that the dealers themselves had access to. This included the ability to query a specific VIN number and retrieve sales documents for the vehicle.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image5.png" alt="" width="1999" height="1386" srcset="https://samcurry.net/wp-content/uploads/2022/12/image5.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image5-300x208.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image5-1024x710.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image5-768x532.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image5-1536x1065.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image5-1600x1109.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2023/01/fixed.png" alt="" width="1999" height="1102" srcset="https://samcurry.net/wp-content/uploads/2023/01/fixed.png 1999w, https://samcurry.net/wp-content/uploads/2023/01/fixed-300x165.png 300w, https://samcurry.net/wp-content/uploads/2023/01/fixed-1024x565.png 1024w, https://samcurry.net/wp-content/uploads/2023/01/fixed-768x423.png 768w, https://samcurry.net/wp-content/uploads/2023/01/fixed-1536x847.png 1536w, https://samcurry.net/wp-content/uploads/2023/01/fixed-1600x882.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image21.png" alt="" width="1999" height="1220" srcset="https://samcurry.net/wp-content/uploads/2022/12/image21.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image21-300x183.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image21-1024x625.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image21-768x469.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image21-1536x937.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image21-1600x976.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>With our level of access, there was a huge amount of functionality we could’ve performed against BMW and Rolls Royce customer accounts and customer vehicles. We stopped testing at this point and reported the vulnerability.</span></p>
<h3>(2) Remote Code Execution and Access to Hundreds of Internal Tools on Mercedes-Benz and Rolls Royce via Misconfigured SSO</h3>
<p><span>Early in our testing, someone in our group had purchased a Mercedes-Benz vehicle and so we began auditing the Mercedes-Benz infrastructure. We took the same approach as BMW and began testing the Mercedes-Benz employee SSO.</span></p>
<p><span>We weren’t able to find any vulnerabilities affecting the SSO portal itself, but by exploring the SSO website we observed that they were running some form of LDAP for the employee accounts. Based on our high level understanding of their infrastructure, we guessed that the individual employee applications used a centralized LDAP system to authenticate users. We began exploring each of these websites in an attempt to find a public registration so we could gain SSO credentials to access, even at a limited level, the employee applications.</span></p>
<p><span>After fuzzing random sites for a while, we eventually found the “umas.mercedes-benz.com” website which was built for vehicle repair shops to request specific tools access from Mercedes-Benz. The website had public registration enabled as it was built for repair shops and appeared to write to the same database as the core employee LDAP system.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image33.png" alt="" width="1534" height="967" srcset="https://samcurry.net/wp-content/uploads/2022/12/image33.png 1534w, https://samcurry.net/wp-content/uploads/2022/12/image33-300x189.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image33-1024x646.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image33-768x484.png 768w" sizes="(max-width: 1534px) 100vw, 1534px"/></p>
<p><span>We filled out all the required fields for registration, created a user account, then used our recon data to identify sites which redirected to the Mercedes-Benz SSO. The first one we attempted was a pretty obvious employee tool, it was “git.mercedes-benz.com”, short for Github. We attempted to use our user credentials to sign in to the Mercedes-Benz Github and saw that we were able to login. Success!</span></p>
<p><span>The Mercedes-Benz Github, after authenticating, asked us to set up 2FA on our account so we could access the app. We installed the 2FA app and added it to our account, entered our code, then saw that we were in. We had access to “git.mercedes-benz.com” and began looking around.</span></p>
<p><span>After a few minutes, we saw that the Github instance had internal documentation and source code for various Mercedes-Benz projects including the Mercedes Me Connect app which was used by customers to remotely connect to their vehicles. The internal documentation gave detailed instructions for employees to follow if they wanted to build an application for Mercedes-Benz themselves to talk to customer vehicles and the specific steps one would have to take to talk to customer vehicles.</span></p>
<p><span>At this point, we reported the vulnerability, but got some pushback after a few days of waiting on an email response. The team seemed to misunderstand the impact, so they asked us to demonstrate further impact.</span></p>
<p><span>We used our employee account to login to numerous applications which contained sensitive information and achieved remote code execution via exposed actuators, spring boot consoles, and dozens of sensitive internal applications used by Mercedes-Benz employees. One of these applications was the Mercedes-Benz Mattermost (basically Slack). We had permission to join any channel, including security channels, and could pose as a Mercedes-Benz employee who could ask whatever questions necessary for an actual attacker to elevate their privileges across the Benz infrastructure.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image32.png" alt="" width="1608" height="998" srcset="https://samcurry.net/wp-content/uploads/2022/12/image32.png 1608w, https://samcurry.net/wp-content/uploads/2022/12/image32-300x186.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image32-1024x636.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image32-768x477.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image32-1536x953.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image32-1600x993.png 1600w" sizes="(max-width: 1608px) 100vw, 1608px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image15.png" alt="" width="1539" height="1102" srcset="https://samcurry.net/wp-content/uploads/2022/12/image15.png 1539w, https://samcurry.net/wp-content/uploads/2022/12/image15-300x215.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image15-1024x733.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image15-768x550.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image15-1536x1100.png 1536w" sizes="(max-width: 1539px) 100vw, 1539px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image26.png" alt="" width="1522" height="1112" srcset="https://samcurry.net/wp-content/uploads/2022/12/image26.png 1522w, https://samcurry.net/wp-content/uploads/2022/12/image26-300x219.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image26-1024x748.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image26-768x561.png 768w" sizes="(max-width: 1522px) 100vw, 1522px"/></p>
<p>To give an overview, we could access the following services:</p>
<ul>
<li>Multiple employee-only Githubs with sensitive information containing documentation and configuration files for multiple applications across the Mercedes-Benz infrastructure</li>
<li>Spring boot actuators which lead to remote code execution, information disclosure, on sensitive employee and customer facing applications</li>
<li>AWS and cloud-computing control panels where we could request, manage, and access various internal systems</li>
<li>XENTRY systems used to communicate with customer vehicles</li>
<li>Internal OAuth and application-management related functionality for configuring and managing internal apps</li>
<li>Hundreds of miscellaneous internal services</li>
</ul>
<h3>(3) Full Vehicle Takeover on Kia via Deprecated Dealer Portal</h3>
<p><span>When we looked at Kia, we noticed how its vehicle enrollment process was different from its parent company Hyundai. We mapped out all of the domains and we came across the “kdelaer.com” domain where dealers are able to register for an account to activate Kia connect for customers who purchase vehicles. At this point, we found the domain “kiaconnect.kdealer.com” which allowed us to enroll an arbitrary VIN but required a valid session to work.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image11.png" alt="" width="1999" height="264" srcset="https://samcurry.net/wp-content/uploads/2022/12/image11.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image11-300x40.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image11-1024x135.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image11-768x101.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image11-1536x203.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image11-1600x211.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>While looking at the website’s main.js code, we observed the following authorization functionality for generating the token required to access the website functionality:</span></p>
<pre>validateSSOToken() {
const e = this.geturlParam(&#34;token&#34;),
i = this.geturlParam(&#34;vin&#34;);
return this.postOffice({
token: e,
vin: i
}, &#34;/prof/gbl/vsso&#34;, &#34;POST&#34;, &#34;preLogin&#34;).pipe(ye(this.processSuccessData), Nn(this.handleError))
}</pre>
<p><span>Since we didn’t have valid authorization credentials, we continued to search through the JavaScript file until finding the “prelogin” header. This header, when sent, allowed us to initiate enrollment for an arbitrary VIN number.</span></p>
<p><span>Although we were able to bypass the authorization check for VIN ownership, the website continued throwing errors for an invalid session.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image24.png" alt="" width="1999" height="257" srcset="https://samcurry.net/wp-content/uploads/2022/12/image24.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image24-300x39.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image24-1024x132.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image24-768x99.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image24-1536x197.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image24-1600x206.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>To bypass this, we took a session token from “owners.kia.com” (the site used for customers to remotely connect to their vehicles) and appended it to our request to pair the VIN number to a customer account here:</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image37.png" alt="" width="1579" height="1073" srcset="https://samcurry.net/wp-content/uploads/2022/12/image37.png 1579w, https://samcurry.net/wp-content/uploads/2022/12/image37-300x204.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image37-1024x696.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image37-768x522.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image37-1536x1044.png 1536w" sizes="(max-width: 1579px) 100vw, 1579px"/></p>
<p><span>Something really interesting to note: for every Kia account that we queried, the server returned an associated profile with the email “</span><a href="https://samcurry.net/cdn-cgi/l/email-protection#3b5f5a484b52505e0a0a7b425a53545415585456"><span><span data-cfemail="aacecbd9dac3c1cf9b9bead3cbc2c5c584c9c5c7">[email protected]</span></span></a><span>”. We’re not sure if this email address has access to the user account, but based on our understanding of the Kia website it appeared that the email address was connected to every account that we had searched. We’ve asked the Kia team for clarification but haven’t heard back on what exactly this is.</span></p>
<p><span>Now that we had a valid vehicle initialization session, we could use the JSON returned in the HTTP response returned from pairing the customer’s account to continue the vehicle takeover. We would use the “prelogin” header once again to generate a dealer token (intended to be accessed by Kia dealers themselves) to pair any vehicle to the attacker’s customer account.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image4.png" alt="" width="1999" height="468" srcset="https://samcurry.net/wp-content/uploads/2022/12/image4.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image4-300x70.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image4-1024x240.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image4-768x180.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image4-1536x360.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image4-1600x375.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>Lastly, we can just head to the link to finish the activation and enrollment which you can see below here.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image23.png" alt="" width="1999" height="435" srcset="https://samcurry.net/wp-content/uploads/2022/12/image23.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image23-300x65.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image23-1024x223.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image23-768x167.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image23-1536x334.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image23-1600x348.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>The attacker will receive a link via email on their Kia customer account after the above dealer pairing process is completed. The activation portal below is the final step to pair the Kia vehicle to the attacker’s customer account.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image25.png" alt="" width="1999" height="962" srcset="https://samcurry.net/wp-content/uploads/2022/12/image25.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image25-300x144.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image25-1024x493.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image25-768x370.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image25-1536x739.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image25-1600x770.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>Lastly, after we’ve filled out the above form, it takes about 1-2 minutes for Kia Connect to fully activate and give full access to send lock, unlock, remote start, remote stop, locate, and (most interestingly) remotely access vehicle cameras!</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image14.png" alt="" width="1999" height="684" srcset="https://samcurry.net/wp-content/uploads/2022/12/image14.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image14-300x103.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image14-1024x350.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image14-768x263.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image14-1536x526.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image14-1600x547.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image7.png" alt="" width="969" height="697" srcset="https://samcurry.net/wp-content/uploads/2022/12/image7.png 969w, https://samcurry.net/wp-content/uploads/2022/12/image7-300x216.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image7-768x552.png 768w" sizes="(max-width: 969px) 100vw, 969px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image35.png" alt="" width="1481" height="723" srcset="https://samcurry.net/wp-content/uploads/2022/12/image35.png 1481w, https://samcurry.net/wp-content/uploads/2022/12/image35-300x146.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image35-1024x500.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image35-768x375.png 768w" sizes="(max-width: 1481px) 100vw, 1481px"/></p>
<h3>(4) Full Account Takeover on Ferrari and Arbitrary Account Creation allows Attacker to Access, Modify, and Delete All Customer Information and Access Administrative CMS Functionality to Manage Ferrari Websites</h3>
<p><span>When we began targeting Ferrari, we mapped out all domains under the publicly available domains like “ferrari.com” and browsed around to see what was accessible. One target we found was “api.ferrari.com”, a domain which offered both customer facing and internal APIs for Ferrari systems. Our goal was to get the highest level of access possible for this API.</span></p>
<p><span>We analyzed the JavaScript present on several Ferrari subdomains that looked like they were for use by Ferrari dealers. These subdomains included `cms-dealer.ferrari.com`, `cms-new.ferrari.com` and `cms-dealer.test.ferrari.com`.</span></p>
<p><span>One of the patterns we notice when testing web applications is poorly implemented single sign on functionality which does not restrict access to the underlying application. This was the case for the above subdomains. It was possible to extract the JavaScript present for these applications, allowing us to understand the backend API routes in use.</span></p>
<p><span>When reverse engineering JavaScript bundles, it is important to check what constants have been defined for the application. Often these constants contain sensitive credentials or at the very least, tell you where the backend API is, that the application talks to.</span></p>
<p><span>For this application, we noticed the following constants were set:</span></p>
<pre><span>const i = {
</span><span>                        production: !0,
</span><span>                        envName: &#34;production&#34;,
</span><span>                        version: &#34;0.0.0&#34;,
</span><span>                        build: &#34;20221223T162641363Z&#34;,
</span><span>                        name: &#34;ferrari.dws-preowned.backoffice&#34;,
</span><span>                        formattedName: &#34;CMS SPINDOX&#34;,
</span><span>                        feBaseUrl: &#34;https://{{domain}}.ferraridealers.com/&#34;,
</span><span>                        fePreownedBaseUrl: &#34;https://{{domain}}.ferrari.com/&#34;,
</span><span>                        apiUrl: &#34;https://api.ferrari.com/cms/dws/back-office/&#34;,
</span><span>                        apiKey: &#34;REDACTED&#34;,
</span><span>                        s3Bucket: &#34;ferrari-dws-preowned-pro&#34;,
</span><span>                        cdnBaseUrl: &#34;https://cdn.ferrari.com/cms/dws/media/&#34;,
</span><span>                        thronAdvUrl: &#34;https://ferrari-app-gestioneautousate.thron.com/?fromSAML#/ad/&#34;
</span><span>                    }</span></pre>
<p><span>From the above constants we can understand that the base API URL is `https://api.ferrari.com/cms/dws/back-office/` and a potential API key for this API is `REDACTED`.</span></p>
<p><span>Digging further into the JavaScript we can look for references to `apiUrl` which will inform us as to how this API is called and how the API key is being used. For example, the following JavaScript sets certain headers if the API URL is being called:</span></p>
<pre><span>})).url.startsWith(x.a.apiUrl) &amp;&amp; ![&#34;/back-office/dealers&#34;, &#34;/back-office/dealer-settings&#34;, &#34;/back-office/locales&#34;, &#34;/back-office/currencies&#34;, &#34;/back-office/dealer-groups&#34;].some(t =&gt; !!e.url.match(t)) &amp;&amp; (e = (e = e.clone({
</span><span>                                    headers: e.headers.set(&#34;Authorization&#34;, &#34;&#34; + (s || void 0))
</span><span>                                })).clone({
</span><span>                                    headers: e.headers.set(&#34;x-api-key&#34;, &#34;&#34; + a)
</span><span>                                }));</span></pre>
<p><span>All the elements needed for this discovery were conveniently tucked away in this JavaScript file. We knew what backend API to talk to and its routes, as well as the API key we needed to authenticate to the API.</span></p>
<p><span>Within the JavaScript, we noticed an API call to `/cms/dws/back-office/auth/bo-users`. When requesting this API through Burp Suite, it leaked all of the users registered for the Ferrari Dealers application. Furthermore, it was possible to send a POST request to this endpoint to add ourselves as a super admin user.</span></p>
<p><span>While impactful, we were still looking for a vulnerability that affected the broader Ferrari ecosystem and every end user. Spending more time deconstructing the JavaScript, we found some API calls were being made to `rest-connectors`:</span></p>
<pre><span>return t.prototype.getConnectors = function() {
</span><span>    return this.httpClient.get(&#34;rest-connectors&#34;)
</span><span>}, t.prototype.getConnectorById = function(t) {
</span><span>    return this.httpClient.get(&#34;rest-connectors/&#34; + t)
</span><span>}, t.prototype.createConnector = function(t) {
</span><span>    return this.httpClient.post(&#34;rest-connectors&#34;, t)
</span><span>}, t.prototype.updateConnector = function(t, e) {
</span><span>    return this.httpClient.put(&#34;rest-connectors/&#34; + t, e)
</span><span>}, t.prototype.deleteConnector = function(t) {
</span><span>    return this.httpClient.delete(&#34;rest-connectors/&#34; + t)
</span><span>}, t.prototype.getItems = function() {
</span><span>    return this.httpClient.get(&#34;rest-connector-models&#34;)
</span><span>}, t.prototype.getItemById = function(t) {
</span><span>    return this.httpClient.get(&#34;rest-connector-models/&#34; + t)
</span><span>}, t.prototype.createItem = function(t) {
</span><span>    return this.httpClient.post(&#34;rest-connector-models&#34;, t)
</span><span>}, t.prototype.updateItem = function(t, e) {
</span><span>    return this.httpClient.put(&#34;rest-connector-models/&#34; + t, e)
</span><span>}, t.prototype.deleteItem = function(t) {
</span><span>    return this.httpClient.delete(&#34;rest-connector-models/&#34; + t)
</span><span>}, t</span></pre>
<p><span>The following request unlocked the final piece in the puzzle. Sending the following request revealed a treasure trove of API credentials for Ferrari: :</span></p>
<pre><span>GET /cms/dws/back-office/rest-connector-models HTTP/1.1</span></pre>
<p><span>To explain what this endpoint&#39;s purpose was: Ferrari had configured a number of backend APIs that could be communicated with by hitting specific paths. When hitting this API endpoint, it returned this list of API endpoints, hosts and authorization headers (in plain text). </span></p>
<p><span>This information disclosure allowed us to query Ferrari’s production API to access the personal information of any Ferrari customer. In addition to being able to view these API endpoints, we could also register new rest connectors or modify existing ones. </span></p>
<p><b>HTTP Request</b></p>
<pre><span>GET /core/api/v1/<a href="https://samcurry.net/cdn-cgi/l/email-protection" data-cfemail="e4b197819697db8189858d88d98d858aa48d858aca978c">[email protected]</a> HTTP/1.1
</span><span>Host: fcd.services.ferrari.com</span>
</pre>
<p><b>HTTP Response</b></p>
<pre><span>HTTP/1.1 200 OK
</span><span>Content-type: application/json</span>

<span>…&#34;guid&#34;:&#34;2d32922a-28c4-483e-8486-7c2222b7b59c&#34;,&#34;email&#34;:&#34;<a href="https://samcurry.net/cdn-cgi/l/email-protection" data-cfemail="4128202f0128202f6f3229">[email protected]</a>&#34;,&#34;nickName&#34;:&#34;<a href="https://samcurry.net/cdn-cgi/l/email-protection" data-cfemail="e8818986a8818986c69b80">[email protected]</a>&#34;,&#34;firstName&#34;:&#34;Ian&#34;,&#34;lastName&#34;:&#34;Carroll&#34;,&#34;birthdate&#34;:&#34;1963-12-11T00:00:00&#34;…</span></pre>
<p><span>The API key and production endpoints that were disclosed using the previous staging API key allowed an attacker to access, create, modify, and delete any production user account. It additionally allowed an attacker to query users via email address or nickname.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image30.png" alt="" width="1893" height="1202" srcset="https://samcurry.net/wp-content/uploads/2022/12/image30.png 1893w, https://samcurry.net/wp-content/uploads/2022/12/image30-300x190.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image30-1024x650.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image30-768x488.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image30-1536x975.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image30-1600x1016.png 1600w" sizes="(max-width: 1893px) 100vw, 1893px"/></p>
<p><span>Additionally, an attacker could POST to the “/core/api/v1/Users/:id/Roles” endpoint to edit their user roles, setting themselves to have super-user permissions or become a Ferrari owner.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image31.png" alt="" width="1999" height="1442" srcset="https://samcurry.net/wp-content/uploads/2022/12/image31.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image31-300x216.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image31-1024x739.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image31-768x554.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image31-1536x1108.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image31-1600x1154.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>This vulnerability would allow an attacker to access, modify, and delete any Ferrari customer account with access to manage their vehicle profile.</span></p>
<h3>(5) SQL Injection and Regex Authorization Bypass on Spireon Systems allows Attacker to Access, Track, and Send Arbitrary Commands to 15 million Telematics systems and Additionally Fully Takeover Fleet Management Systems for Police Departments, Ambulance Services, Truckers, and Many Business Fleet Systems</h3>
<p><span>When identifying car-related targets to hack on, we found the company Spireon. In the early 90s and 2000s, there were a few companies like OnStar, Goldstar, and FleetLocate which were standalone devices which were put into vehicles to track and manage them. The devices have the capabilities to be tracked and receive arbitrary commands, e.g. locking the starter so the vehicle cannot start.</span></p>
<p><span>Sometime in the past, Spireon had acquired many GPS Vehicle Tracking and Management Companies and put them under the Spireon parent company. </span></p>
<p><span>We read through the Spireon marketing and saw that they claimed to have over 15 million connected vehicles. They offered services directly to customers and additionally many services through their subsidiary companies like OnStar.</span></p>
<p><span>We decided to research them as, if an attacker were able to compromise the administration functionality for these devices and fleets, they would be able to perform actions against over 15 million vehicles with very interesting functionalities like sending a cities police officers a dispatch location, disabling vehicle starters, and accessing financial loan information for dealers.</span></p>
<p><span>Our first target for this was very obvious: admin.spireon.com</span></p>
<p><span>The website appeared to be a very out of date global administration portal for Spireon employees to authenticate and perform some sort of action. We attempted to identify interesting endpoints which were accessible without authorization, but kept getting redirected back to the login.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image29.png" alt="" width="1999" height="1084" srcset="https://samcurry.net/wp-content/uploads/2022/12/image29.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image29-300x163.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image29-1024x555.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image29-768x416.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image29-1536x833.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image29-1600x868.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>Since the website was so old, we tried the trusted manual SQL injection payloads but were kicked out by a WAF that was installed on the system</span></p>
<p><span>We switched to a much simpler payload: sending an apostrophe, seeing if we got an error, then sending two apostrophes and seeing if we did not get an error. This worked! The system appeared to be reacting to sending an odd versus even number of apostrophes. This indicated that our input in both the username and password field was being passed to a system which could likely be vulnerable to some sort of SQL injection attack.</span></p>
<p><span>For the username field, we came up with a very simple payload:</span></p>
<pre>victim&#39; #</pre>
<p><span>The above payload was designed to simply cut off the password check from the SQL query. We sent this HTTP request to Burp Suite’s intruder with a common username list and observed that we received various 301 redirects to “/dashboard” for the username “administrator” and “admin”.</span></p>
<p><span>After manually sending the HTTP request using the admin username, we observed that we were authenticated into the Spireon administrator portal as an administrator user. At this point, we browsed around the application and saw many interesting endpoints.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image18.png" alt="" width="1929" height="1148" srcset="https://samcurry.net/wp-content/uploads/2022/12/image18.png 1929w, https://samcurry.net/wp-content/uploads/2022/12/image18-300x179.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image18-1024x609.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image18-768x457.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image18-1536x914.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image18-1600x952.png 1600w" sizes="(max-width: 1929px) 100vw, 1929px"/></p>
<p><span>The functionality was designed to manage Spireon devices remotely. The administrator user had access to all Spireon devices, including those of OnStar, GoldStar, and FleetLocate. We could query these devices and retrieve the live location of whatever the devices were installed on, and additionally send arbitrary commands to these devices. There was additional functionality to overwrite the device configuration including what servers it reached out to download updated firmware.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image27.png" alt="" width="1999" height="1011" srcset="https://samcurry.net/wp-content/uploads/2022/12/image27.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image27-300x152.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image27-1024x518.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image27-768x388.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image27-1536x777.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image27-1600x809.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>Using this portal, an attacker could create a malicious Spireon package, update the vehicle configuration to call out to the modified package, then download and install the modified Spireon software.</span></p>
<p><span>At this point, an attacker could backdoor the Spireon device and run arbitrary commands against the device. </span></p>
<p><span>Since these devices were very ubiquitous and were installed on things like tractors, golf carts, police cars, and ambulances, the impact of each device differed. For some, we could only access the live GPS location of the device, but for others we could disable the starter and send police and ambulance dispatch locations.</span></p>
<p><span>We reported the vulnerability immediately, but during testing, we observed an HTTP 500 error which disclosed the API URL of the backend API endpoint that the “admin.spireon.com” service reached out to. Initially, we dismissed this as we assumed it was internal, but after circling back we observed that we could hit the endpoint and it would trigger an HTTP 403 forbidden error.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image13.png" alt="" width="1999" height="476" srcset="https://samcurry.net/wp-content/uploads/2022/12/image13.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image13-300x71.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image13-1024x244.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image13-768x183.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image13-1536x366.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image13-1600x381.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>Our goal now was seeing if we could find some sort of authorization bypass on the host and what endpoints were accessible. By bypassing the administrator UI, we could directly reach out to each device and have direct queries for vehicles and user accounts via the backend API calls.</span></p>
<p><span>We fuzzed the host and eventually observed some weird behavior:</span><span><br/>
</span></p>
<p><span>By sending any string with “admin” or “dashboard”, the system would trigger an HTTP 403 forbidden response, but would return 404 if we didn’t include this string. As an example, if we attempted to load “/anything-admin-anything” we’d receive 403 forbidden, while if we attempted to load “/anything-anything” it would return a 404.</span></p>
<p><span>We took the blacklisted strings, put them in a list, then attempted to enumerate the specific endpoints with fuzzing characters (%00 to %FF) stuck behind the first and last characters.</span></p>
<p><span>During scanning, we saw that the following HTTP requests would return a 200 OK response:</span><span><br/>
</span></p>
<pre><span>GET /%0dadmin
</span><span>GET /%0ddashboard</span></pre>
<p><span>Through Burp Suite, we sent the HTTP response to our browser and observed the response: it was a full administrative portal for the core Spireon app. We quickly set up a match and replace rule to modify GET /admin and GET /dashboard to the endpoints with the %0d prefix.</span></p>
<p><span>After setting up this rule, we could browse to “/admin” or “/dashboard” and explore the website without having to perform any additional steps. We observed that there were dozens of endpoints which were used to query all connected vehicles, send arbitrary commands to connected vehicles, and view all customer tenant accounts, fleet accounts, and customer accounts. We had access to everything.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image1.png" alt="" width="1999" height="1085" srcset="https://samcurry.net/wp-content/uploads/2022/12/image1.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image1-300x163.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image1-1024x556.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image1-768x417.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image1-1536x834.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image1-1600x868.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image3.png" alt="" width="1929" height="1102" srcset="https://samcurry.net/wp-content/uploads/2022/12/image3.png 1929w, https://samcurry.net/wp-content/uploads/2022/12/image3-300x171.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image3-1024x585.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image3-768x439.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image3-1536x877.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image3-1600x914.png 1600w" sizes="(max-width: 1929px) 100vw, 1929px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2023/01/device-search-1.png" alt="" width="1999" height="1102" srcset="https://samcurry.net/wp-content/uploads/2023/01/device-search-1.png 1999w, https://samcurry.net/wp-content/uploads/2023/01/device-search-1-300x165.png 300w, https://samcurry.net/wp-content/uploads/2023/01/device-search-1-1024x565.png 1024w, https://samcurry.net/wp-content/uploads/2023/01/device-search-1-768x423.png 768w, https://samcurry.net/wp-content/uploads/2023/01/device-search-1-1536x847.png 1536w, https://samcurry.net/wp-content/uploads/2023/01/device-search-1-1600x882.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image6.png" alt="" width="1999" height="952" srcset="https://samcurry.net/wp-content/uploads/2022/12/image6.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image6-300x143.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image6-1024x488.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image6-768x366.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image6-1536x732.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image6-1600x762.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>At this point, a malicious actor could backdoor the 15 million devices, query what ownership information was associated with a specific VIN, retrieve the full user information for all customer accounts, and invite themselves to manage any fleet which was connected to the app.</span></p>
<p><span>For our proof of concept, we invited ourselves to a random fleet account and saw that we received an invitation to administrate a US Police Department where we could track the entire police fleet.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2023/01/fleetlocate.png" alt="" width="898" height="444" srcset="https://samcurry.net/wp-content/uploads/2023/01/fleetlocate.png 1536w, https://samcurry.net/wp-content/uploads/2023/01/fleetlocate-300x148.png 300w, https://samcurry.net/wp-content/uploads/2023/01/fleetlocate-1024x506.png 1024w, https://samcurry.net/wp-content/uploads/2023/01/fleetlocate-768x380.png 768w" sizes="(max-width: 898px) 100vw, 898px"/></p>
<h3>(6) Mass Assignment on Reviver allows an Attacker to Remotely Track and Overwrite the Virtual License Plates for All Reviver Customers, Track and Administrate Reviver Fleets, and Access, Modify, and Delete All User Information</h3>
<p><span>In October, 2022, California announced that it had legalized digital license plates. We researched this for a while and found that most, if not all of the digital license plates, were done through a company called Reviver.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image28.png" alt="" width="915" height="337" srcset="https://samcurry.net/wp-content/uploads/2022/12/image28.png 600w, https://samcurry.net/wp-content/uploads/2022/12/image28-300x111.png 300w" sizes="(max-width: 915px) 100vw, 915px"/></p>
<p><span>If someone wanted a digital license plate, they’d buy the virtual Reviver license plate which included a SIM card for remotely tracking and updating the license plate. Customers who uses Reviver could remotely update their license plates slogan, background, and additionally report if the car had been stolen via setting the plate tag to “STOLEN”.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image8.png" alt="" width="1892" height="1202" srcset="https://samcurry.net/wp-content/uploads/2022/12/image8.png 1892w, https://samcurry.net/wp-content/uploads/2022/12/image8-300x191.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image8-1024x651.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image8-768x488.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image8-1536x976.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image8-1600x1016.png 1600w" sizes="(max-width: 1892px) 100vw, 1892px"/></p>
<p><span>Since the license plate could be used to track vehicles, we were super interested in Reviver and began auditing the mobile app. We proxied the HTTP traffic and saw that all API functionality was done on the &#34;pr-api.rplate.com&#34; website. After creating a user account, our user account was assigned to a unique “company” JSON object which allowed us to add other sub-users to our account.</span></p>
<p><span>The company JSON object was super interesting as we could update many of the JSON fields within the object. One of these fields was called “type” and was default set to “CONSUMER”. After noticing this, we dug through the app source code in hopes that we could find another value to set it to, but were unsuccessful.</span></p>
<p><span>At this point, we took a step back and wondered if there was an actual website we could talk to versus proxying traffic through the mobile app. We looked online for a while before getting the idea to perform a reset password on our account which gave us a URL to navigate to.</span></p>
<p><span>Once we opened the password reset URL, we observed that the website had tons of functionality including the ability to administer vehicles, fleets, and user accounts. This was super interesting as we now had a lot more API endpoints and functionality to access. Additionally, the JavaScript on the website appeared to have the names of the other roles that our user account could be (e.g. specialized names for user, moderator, admin, etc.)</span></p>
<p><span>We queried the “CONSUMER” string in the JavaScript and saw that there were other roles that were defined in the JavaScript. After attempting to update our “role” parameter to the disclosed “CORPORATE” role, we refreshed out profile metadata, then saw that it was successful! We were able to change our roles to ones other than the default user account, opening the door to potential privilige escalation vulnerabilities.</span></p>
<p><span>It appeared that, even though we had updated our account to the &#34;CORPORATE&#34; role, we were still receiving authorization vulnerabilities when logging into the website. We thought for a while until realizing that we could invite users to our modified account which had the elevated role, which may then grant the invited users the required permissions since they were invited via an intended way versus mass assigning an account to an elevated role.</span></p>
<p><span>After inviting a new account, accepting the invitation, and logging into the account, we observed that we no longer received authorization errors and could access fleet management functionality. This meant that we could likely (1) mass assign our account to an even higher elevated role (e.g. admin), then (2) invite a user to our account which would be assigned the appropriate permissions.</span></p>
<p><span>This perplexed us as there was likely some administration group which existed in the system but that we had not yet identified. We brute forced the “type” parameter using wordlists until we noticed that setting our group to the number “4” had updated our role to “REVIVER_ROLE”. It appeared that the roles were indexed to numbers, and we could simply run through the numbers 0-100 and find all the roles on the website.</span></p>
<p><span>The “0” role was the string “REVIVER”, and after setting this on our account and re-inviting a new user, we logged into the website normally and observed that the UI was completely broken and we couldn’t click any buttons. From what we could guess, we had the administrator role but were accessing the account using the customer facing frontend website and not the appropriate administrator frontend website. We would have to find the endpoints used by administrators ourselves.</span></p>
<p><span>Since our administrator account theoretically had elevated permissions, our first test was simply querying a user account and seeing if we could access someone else&#39;s data: this worked!</span></p>
<p><span>We could take any of the normal API calls (viewing vehicle location, updating vehicle plates, adding new users to accounts) and perform the action using our super administrator account with full authorization.</span></p>
<p><span>At this point, we reported the vulnerability and observed that it was patched in under 24 hours. An actual attacker could remotely update, track, or delete anyone’s REVIVER plate. We could additionally access any dealer (e.g. Mercedes-Benz dealerships will often package REVIVER plates) and update the default image used by the dealer when the newly purchased vehicle still had DEALER tags.</span></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image22.png" alt="" width="1999" height="1089" srcset="https://samcurry.net/wp-content/uploads/2022/12/image22.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image22-300x163.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image22-1024x558.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image22-768x418.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image22-1536x837.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image22-1600x872.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image9.png" alt="" width="1999" height="1089" srcset="https://samcurry.net/wp-content/uploads/2022/12/image9.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image9-300x163.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image9-1024x558.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image9-768x418.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image9-1536x837.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image9-1600x872.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><img decoding="async" loading="lazy" src="https://samcurry.net/wp-content/uploads/2022/12/image10.png" alt="" width="1999" height="1084" srcset="https://samcurry.net/wp-content/uploads/2022/12/image10.png 1999w, https://samcurry.net/wp-content/uploads/2022/12/image10-300x163.png 300w, https://samcurry.net/wp-content/uploads/2022/12/image10-1024x555.png 1024w, https://samcurry.net/wp-content/uploads/2022/12/image10-768x416.png 768w, https://samcurry.net/wp-content/uploads/2022/12/image10-1536x833.png 1536w, https://samcurry.net/wp-content/uploads/2022/12/image10-1600x868.png 1600w" sizes="(max-width: 1999px) 100vw, 1999px"/></p>
<p><span>The Reviver website also offered fleet management functionality which we had full access to.</span></p>
<h3>(7) Full Remote Vehicle Access and Full Account Takeover affecting Hyundai and Genesis</h3>
<p>This vulnerability was written up on Twitter and can be accessed on the following thread:</p>
<blockquote data-width="550" data-dnt="true"><p lang="en" dir="ltr">We recently found a vulnerability affecting Hyundai and Genesis vehicles where we could remotely control the locks, engine, horn, headlights, and trunk of vehicles made after 2012.</p>— Sam Curry (@samwcyo) <a href="https://twitter.com/samwcyo/status/1597695281881296897?ref_src=twsrc%5Etfw">November 29, 2022</a></blockquote>
<h3>(8) Full Remote Vehicle Access and Full Account Takeover affecting Honda, Nissan, Infiniti, Acura</h3>
<p><span>This vulnerability was written up on Twitter and can be accessed on the following thread:</span></p>
<blockquote data-width="550" data-dnt="true"><p lang="en" dir="ltr">More car hacking!</p>— Sam Curry (@samwcyo) <a href="https://twitter.com/samwcyo/status/1597792097175674880?ref_src=twsrc%5Etfw">November 30, 2022</a></blockquote>
<h3>(9) Full Vehicle Takeover on Nissan via Mass Assignment</h3>
<p><span>This vulnerability was written up on Twitter and can be accessed on the following thread:</span></p>
<blockquote data-width="550" data-dnt="true"><p lang="en" dir="ltr">Good Morning, I feel like we need more car haxs. So here is another vulnerability we found that got us remote commands on every internet connected Nissan &amp; Infiniti. Bug was fixed.</p>— ꙅɿɘƚɔɘqꙅ (@_specters_) <a href="https://twitter.com/_specters_/status/1597984481511903234?ref_src=twsrc%5Etfw">November 30, 2022</a></blockquote>
<h2>Credits</h2>
<p><span>The following people contributed towards this project:</span></p>
<ul>
<li>Sam Curry (<a href="https://twitter.com/samwcyo">https://twitter.com/samwcyo</a>)</li>
<li>Neiko Rivera (<a href="https://twitter.com/_specters_">https://twitter.com/_specters_</a>)</li>
<li>Brett Buerhaus (<a href="https://twitter.com/bbuerhaus">https://twitter.com/bbuerhaus</a>)</li>
<li>Maik Robert (<a href="https://twitter.com/xEHLE_">https://twitter.com/xEHLE_</a>)</li>
<li>Ian Carroll (<a href="https://twitter.com/iangcarroll">https://twitter.com/iangcarroll</a>)</li>
<li>Justin Rhinehart (<a href="https://twitter.com/sshell_">https://twitter.com/sshell_</a>)</li>
<li>Shubham Shah (<a href="https://twitter.com/infosec_au">https://twitter.com/infosec_au</a>)</li>
</ul>
<p>Special thanks to the following people who helped create this blog post:</p>
<ul>
<li>Ben Sadeghipour (<a href="https://twitter.com/nahamsec">https://twitter.com/nahamsec</a>)</li>
<li>Joseph Thacker (<a href="https://twitter.com/rez0__">https://twitter.com/rez0__</a>)</li>
</ul>
</div>
	</div>
</div>
</div>
</div>
	</div>
		</div>
	</div>
</div>
</div>
</div></div>
  </body>
</html>
