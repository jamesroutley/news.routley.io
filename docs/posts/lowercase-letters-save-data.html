<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://endtimes.dev/why-lowercase-letters-save-data/">Original</a>
    <h1>Lowercase letters save data</h1>
    
    <div id="readability-page-1" class="page"><div><article><main><p>Lowercase letters and uppercase letters use the same amout of data — <code>1 byte</code> each.</p><p>So, it&#39;s surprising to learn that swapping uppercase letters for lowercase letters saves data.</p><p>For example: I took the front page of <a href="https://news.ycombinator.com/">Hacker News</a> and rewrote the title of each article in <code>sentence case</code> instead of <code>title case</code> — reducing the size by <code>31 bytes</code>.</p><p>How can it be true that changing a few uppercase letters to lowercase letters saves data? The answer is <strong>compression</strong>.</p><p>It isn&#39;t intuitive, but once you understand how text compression works, it will begin to make sense.</p><p>In this article I hope to…</p><ul><li>Help you understand how text compression works, using <strong>interactive examples</strong>!</li><li>Show you how I came to the conclusion that <code>title case</code> on hacker news emits the <strong>equivalent yearly carbon as a car driving the width of Sri Lanka.</strong></li><li>Show you some examples of where this knowledge can be used to <strong>systematically save data.</strong></li></ul><h2 id="why-do-lowercase-letters-save-data">Why do lowercase letters save data?<a href="#why-do-lowercase-letters-save-data"> #</a></h2><p>Text compression is more effective when…</p><ul><li>There&#39;s a smaller variety of characters in the text</li><li>The less common characters use used less frequently</li><li>Characters or groups of characters are repeated more often.</li></ul><p>Replacing uppercase characters with their more common lowercase counterparts helps with all three of these.</p><p>To understand why this works you need to understand how compression works.</p><h2 id="how-does-text-compression-work">How does text compression work?<a href="#how-does-text-compression-work"> #</a></h2><p>To explain how text compression works, we&#39;ll specifically look at the <code>deflate</code> algorithm commonly used in <code>zip</code> files. The principles are the same for other algorithms too.</p><p>Deflate uses two compression methods — <code>Huffman encoding</code> and <code>LZSS</code> — both of these compression methods are effected by replacing uppercase letters with lowercase.</p><h3 id="huffman-encoding">Huffman encoding<a href="#huffman-encoding"> #</a></h3><p>The deflate algorithm starts with <code>Huffman encoding</code>.</p><p>Each character in an uncompressed text file uses up the same amount of data. (This isn&#39;t exactly true, but is true enough for this explanation.)</p><p>In <code>utf-8</code> this is <code>8 bits</code>. (a bit is a binary <code>1</code> or <code>0</code>)</p><p>A text file using <code>utf-8</code> encodes the letters like this:</p><p><code>B</code> is <code>01000010</code></p><p><code>b</code> is <code>01100010</code></p><p><code>a</code> is <code>01100001</code></p><p><code>o</code> is <code>01101111</code></p><p>Now, take a word that only uses those four characters, say <code>Baobab</code>.</p><p>Using <code>utf-8</code> the text <code>Baobab</code> is encoded like this: <code>010000100110000101101111011000100110000101100010</code>.</p><p>If we know we don&#39;t need any other letters, we can save a lot of data by changing the encoding to use fewer bits.</p><p>We could change <code>B</code> to <code>10</code>, <code>b</code> to <code>11</code>, <code>a</code> to <code>00</code>, and <code>o</code> to <code>01</code>.</p><p>The text <code>Baobab</code> would compress to <code>100001110011</code>.</p><p>The word <code>Baobab</code> contains four distinct characters, the best we can do is give them each a <code>2-bit</code> sequence.</p><p>But if we lowercased the <code>B</code>, we&#39;d only have three distinct characters, and we could take things a step further.</p><p>We could change the encoding so that the most frequently used character, <code>b</code>, is represented by only <code>1-bit</code>. Reducing the compressed version of <code>baobab</code> to <code>101001011</code></p><p>We do this using <code>Huffman encoding</code>.</p><p><strong>Using <code>Huffman encoding</code> we can represent more frequently used characters with fewer bits.</strong></p><p>Here&#39;s an interactive explanation for how it works. Enter text below to see its uncompressed and compressed binary forms.</p><p>To compress our text using huffman encoding we first need to build a frequency table of all the characters in our text. To do this we…</p><ol><li><strong>count the number of each character</strong></li><li><strong>order them by frequency</strong>.</li></ol><p>Then we build a <strong>Huffman tree</strong> following these rules:</p><ol><li>Make each character a <code>leaf</code> in our tree.</li><li>Take the two characters with the lowest frequency and connect them with a node — give that node the combined frequency of both our leaves.</li><li>Remove those two leaves from the list — and add their connecting node to the list instead.</li><li>Repeat the above steps until there are no more leaves or nodes left in the list.</li></ol><p>It&#39;s a little complicated but once you&#39;re done you can make a pretty diagram like this:</p><p>We can use the above tree to work out the new encoding for each of our characters.</p><p>To determine each character&#39;s encoding, we begin at the top of the tree and climb down towards the character to find its encoding. Each time we climb dow to the left we add a <code>0</code>, when we go down to the right we add a <code>1</code>.</p><p>The characters that appear more frequently in our text require a shorter climb down the tree — and so can be encoded with fewer <code>1s</code> and <code>0s</code>.</p><h3 id="more-savings-with-smaller-trees">More savings with smaller trees<a href="#more-savings-with-smaller-trees"> #</a></h3><p>We can&#39;t decode <code>Huffman encoding</code> without the tree. So when we send text compressed with <code>Huffman encoding</code> we send the tree along too.</p><p><strong>By using fewer uppercase letters in our text, we increase the chance of their being no instance of any given uppercase letter. Meaning the tree we send is smaller too.</strong></p><p>For instance if we change the text &#34;Decompression is the Mission of the Compression Commission&#34; from <code>title case</code> to <code>sentence case</code> we don&#39;t need a leaf in our tree for uppercase <code>M</code> and <code>C</code>. This makes our compression more efficient — but also makes the <code>Huffman tree</code> smaller.</p><h2 id="lzss">LZSS<a href="#lzss"> #</a></h2><p><code>Deflate</code> also uses another compression method. It compresses data with <code>Huffman encoding</code> and then again using the <code>Lempel-Ziv-Storer-Szymanski (LZSS)</code> algorithm.</p><p><code>LZSS</code> works by finding repeated chunks of data and replacing them with a shorter reference to the first time they appeared.</p><p>The referencing is done by replacing the repeated sequence with a <code>pointer</code>. This pointer consists of two numbers:</p><ul><li>the first number tells us how far back to go to find the original sequence</li><li>the second number tells us how long the original sequence is</li></ul><p>Here&#39;s a simplified example of how the LZSS algorithm works, the pointers are displayed like this <code>&lt;1,2&gt;</code>.</p><p>Play around with the input below. See how removing capital letters can result in more repeated sequences — and fewer bytes.</p><h2 id="how-much-data-can-lowercase-save">How much data can lowercase save?<a href="#how-much-data-can-lowercase-save"> #</a></h2><p>Before you start lowercasing everything, remember that there are much worse offenders when it comes to online waste. <em>e.g. unoptimized images, auto-playing videos, unused JavaScript.</em> Do those first!</p><p>But that being said, lowercasing is surprisingly effective. Here&#39;s an example:</p><h3 id="replacing-title-case-with-sentence-case-on-hacker-news">Replacing title case with sentence case on Hacker News<a href="#replacing-title-case-with-sentence-case-on-hacker-news"> #</a></h3><p>As mentioned in the intro — I took the front page of Hacker News and rewrote the title of each article in <code>sentence case</code> instead of <code>title case</code>.</p><p>Each <code>html</code> file had the exact same number of characters — but when compressed into zip files the <code>title case</code> file was <code>5,992 bytes</code> and the <code>sentence case</code> file was <code>5,961 bytes</code>. Saving <code>31 bytes</code>!</p><p>Perhaps not a lot, but a nice side effect of making headings easier to read.</p><p>Using the fomula provided by <a href="https://sustainablewebdesign.org/calculating-digital-emissions/">sustainablewebdesign.org</a> tells us that for each visit to Hacker News would save <code>0.00001059642g</code> of carbon if written in <code>sentence case</code>.</p><p>Assuming that Hacker News gets about <code>10 million</code> visits a day changing to sentence case would result in the prevention of <code>105g</code> of carbon daily. that&#39;s the equivalent of burning <code>4.3</code> gallons of gasoline a year. Enough fuel to drive a Mini Cooper <code>137.6 miles</code> — roughly the width of Sri Lanka.</p><h2 id="systematically-lowercasing-case‑insensitive-code">Systematically lowercasing case‑insensitive code.<a href="#systematically-lowercasing-case‑insensitive-code"> #</a></h2><p>Some minifiers automatically lowercase some code to save a few bytes after compressing — but this is not common or applied consistently.</p><p>Any given optimisation from a <code>minifier</code> probably falls into the category of <em>too small to care about</em> — but collectively they save lots of data, which makes websites faster and less energy intensive.</p><p>For instance, many <code>html</code> files start with am uppercase doctype declaration like this:</p><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>&gt;</span></span></code></pre><p>but the <a href="https://html.spec.whatwg.org/multipage/syntax.html#the-doctype"><code>HTML5</code> specification states that this is case insensitive</a>, so an <code>html minifier</code> could save some data by changing this to:</p><pre><code><span><span>&lt;!</span><span>doctype</span> <span>html</span><span>&gt;</span></span></code></pre><p>This optimizations has been implemented by <a href="https://github.com/kangax/html-minifier/issues/822"><code>html-minifier</code></a> but not by others.</p><h3 id="some-examples-of-lowercase‑able-code">Some examples of lowercase‑able code<a href="#some-examples-of-lowercase‑able-code"> #</a></h3><p>There are many examples of code that can be lowercased to save data. Here are some examples that are commonly uppercase when they needn&#39;t be.</p><ul><li><p><strong>hex colors</strong></p><pre><code><span>*</span> <span>{</span></code></pre><pre><code><span>*</span> <span>{</span></code></pre></li><li><p><strong>character encodings</strong></p><pre><code><span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>&#34;</span>UTF-8<span>&#34;</span></span><span>&gt;</span></span></code></pre><pre><code><span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>&#34;</span>utf-8<span>&#34;</span></span><span>&gt;</span></span></code></pre></li><li><p><strong>JavaScript exponents</strong></p><pre><code><span>const</span> trillion <span>=</span> <span>10E12</span></code></pre><pre><code><span>const</span> trillion <span>=</span> <span>10e12</span></code></pre></li><li><p><strong>lang attributes</strong></p><pre><code><span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>&#34;</span>EN<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>html</span><span>&gt;</span></span></code></pre><pre><code><span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>&#34;</span>en<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>html</span><span>&gt;</span></span></code></pre></li><li><p><strong>svg path commands</strong></p><pre><code><span><span><span>&lt;</span>path</span> <span>d</span><span><span>=</span><span>&#34;</span>M 1 1 L 1 -1 Z<span>&#34;</span></span> <span>/&gt;</span></span></code></pre><pre><code><span><span><span>&lt;</span>path</span> <span>d</span><span><span>=</span><span>&#34;</span>m 1 1 L 2 0 z<span>&#34;</span></span> <span>/&gt;</span></span></code></pre></li></ul><p>I&#39;ve hope you found this interesting. If you&#39;re similarly inclined to help optimize the web to save energy you can help me gather more of these examples in <a href="https://github.com/DitheringIdiot/lowercase-able-code">this git repo</a>.</p></main></article></div></div>
  </body>
</html>
