<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://iafisher.com/blog/2026/01/monorepo-2026">Original</a>
    <h1>The monorepo: my personal software infrastructure in 2026</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p>Four years ago, I wrote about <a href="https://iafisher.com/blog/2022/02/khaganate">Khaganate</a>, my suite of personal productivity software. Khaganate has evolved into a new system, started from scratch on 1 January 2025, that I call the &#34;monorepo&#34;. What I describe here is my progress, 387 days, 838 commits, and <a href="https://iafisher.com/blog/2025/12/my-67-bugs-in-2025">60+ bugs</a> later.</p>
<h2>Foundations</h2>
<h3>Hardware</h3>
<p>My personal infrastructure runs on two computers:</p>
<ul>
<li>My macOS laptop</li>
<li>A Dell workstation in my apartment (&#34;the homeserver&#34;) running Rocky Linux on <a href="https://www.proxmox.com/en/">Proxmox</a></li>
</ul>
<p>These machines are connected to each other and to my phone by a Tailscale VPN. The laptop is for development and for services that need to access local files (mainly, my Obsidian vault). The homeserver is for everything else.</p>
<h3>The foundation repo</h3>
<p>I keep configuration files, shell scripts, and Python libraries in a <a href="https://github.com/iafisher/foundation">foundation</a> repo that I clone on every computer that I use. I can configure a new computer in under a minute with <code>wget https://iafisher.com/bootstrap.sh &amp;&amp; bash bootstrap.sh ~</code>.</p>
<p>The main purpose of the foundation repo is to ensure a consistent shell and editor environment across all my machines, but it also includes a few foundational Python modules, like the <a href="https://github.com/iafisher/foundation/blob/master/python/ian/prelude/prelude.py">prelude</a> that I import at the top of every Python file in the monorepo.</p>
<h3>Files and databases</h3>
<p>The laptop and the homeserver each have a <code>~/.ian</code> directory. <code>~/.ian/repos/current</code> is a symlink to the latest deployed source code of the monorepo itself. <code>~/.ian/apps/&lt;APP&gt;</code> is for application-specific storage. Logs are at <code>~/.ian/logs/&lt;APP&gt;</code>; the <code>kg logs</code> command is helpful for finding and viewing them.</p>
<p>The primary data store for my applications is not the filesystem, however, but the Postgres database that runs on the homeserver. The schema of the database is defined by a <code>schema.sql</code> file in the monorepo. The SQL file is run on every deployment; constructs like <code>IF NOT EXISTS</code> ensure that it is idempotent.</p>
<p>Each computer also has a local SQLite database for data that does not need to be centrally managed, or for operations that need to succeed even if the network connection to the homeserver is interrupted or unavailable. There is likewise a <code>schema_local.sql</code> file for SQLite.</p>
<h3>The job scheduler</h3>
<p>The <a href="https://iafisher.com/blog/2025/09/jobserver-woes">job scheduler</a> is my own homegrown <code>cron</code>, but friendlier:</p>
<ul>
<li>I can configure a new job with a JSON file in the repo, and it will be automatically scheduled when the repo is deployed. I can write <code>&#34;schedule&#34;: {&#34;daily&#34;: {&#34;times_of_day&#34;: [&#34;4pm&#34;]}}</code> – no more <code>0 16 * * *</code>.</li>
<li>It ensures that job logs, standard output, and standard error all go into the right place in the <code>~/.ian/logs</code> directory.</li>
<li>It comes with a CLI frontend with commands like <code>kg jobs list</code>, <code>kg jobs show</code>, and <code>kg jobs run</code>.</li>
<li>If a job fails, it sends me an email that includes the last 50 lines of the job&#39;s logs.</li>
</ul>
<p>The job scheduler is one of the key components of the monorepo; it currently handles no less than 26 scheduled jobs!</p>
<h3><code>lib/command</code></h3>
<p><code>lib/command</code> parses command-line arguments. It can infer the command-line interface from the type annotations of a Python function:</p>
<div><pre><span></span><code><span>from</span> <span>typing</span> <span>import</span> <span>Annotated</span>

<span>from</span> <span>lib</span> <span>import</span> <span>command</span>

<span>def</span> <span>main_sync</span><span>(</span>
    <span>*</span><span>,</span>
    <span>quiet</span><span>:</span> <span>bool</span><span>,</span>
    <span>write</span><span>:</span> <span>Annotated</span><span>[</span>
        <span>bool</span><span>,</span> <span>command</span><span>.</span><span>Extra</span><span>(</span><span>help</span><span>=</span><span>&#34;write to database instead of doing a dry run&#34;</span><span>)</span>
    <span>],</span>
<span>)</span> <span>-&gt;</span> <span>None</span><span>:</span>
    <span>...</span>

<span>cmd</span> <span>=</span> <span>command</span><span>.</span><span>Group</span><span>()</span>
<span>cmd</span><span>.</span><span>add2</span><span>(</span><span>&#34;sync&#34;</span><span>,</span> <span>main_sync</span><span>)</span>
<span>command</span><span>.</span><span>dispatch</span><span>(</span><span>cmd</span><span>)</span>
</code></pre></div>

<p>It is designed to allow multiple levels of nested subcommands, e.g.:</p>
<div><pre><span></span><code>λ kg jobs daemon -h
Usage: kg jobs daemon SUBCMD

  Manage the daemon.

Subcommands:

  kill      . Kill the daemon.
  start     . Start the daemon.
  status    . Check the status of the daemon.
</code></pre></div>

<p>Many of the command-line applications in the monorepo use subcommands for clarity and organization.</p>
<h3><code>lib/pdb</code></h3>
<p><code>lib/pdb</code> is a thin wrapper around <a href="https://www.psycopg.org/">Psycopg</a>:</p>
<div><pre><span></span><code><span>from</span> <span>lib</span> <span>import</span> <span>pdb</span>

<span>with</span> <span>pdb</span><span>.</span><span>connect</span><span>()</span> <span>as</span> <span>db</span><span>:</span>
    <span>book_models</span> <span>=</span> <span>db</span><span>.</span><span>fetch_all</span><span>(</span>
        <span>pdb</span><span>.</span><span>SQL</span><span>(</span><span>&#34;SELECT </span><span>{}</span><span> FROM </span><span>{}</span><span>&#34;</span><span>)</span><span>.</span><span>format</span><span>(</span><span>T</span><span>.</span><span>star</span><span>,</span> <span>T</span><span>.</span><span>table</span><span>),</span>
        <span>t</span><span>=</span><span>pdb</span><span>.</span><span>t</span><span>(</span><span>models</span><span>.</span><span>Book</span><span>),</span>
    <span>)</span>
</code></pre></div>

<p>By default, <code>with pdb.connect()</code> executes the body in a single database transaction, but you can also choose autocommit mode, or manage transactions manually.</p>
<p>I don&#39;t use an ORM, but I do have a Python script that parses the SQL schema file and generates a Python class for each database table. These classes include constants for the table and column names, so if I rename or delete a column, the typechecker will find any places where that column is used in code. In the snippet above, <code>T.star</code> and <code>T.table</code> come from the auto-generated class.</p>
<h3><code>lib/kgjson</code></h3>
<p><code>lib/kgjson</code> converts Python dataclasses to and from JSON:</p>
<div><pre><span></span><code><span>from</span> <span>lib</span> <span>import</span> <span>kgjson</span>

<span>@dataclass</span>
<span>class</span> <span>Message</span><span>(</span><span>kgjson</span><span>.</span><span>Base</span><span>):</span>
    <span>title</span><span>:</span> <span>str</span>
    <span>body</span><span>:</span> <span>str</span>
    <span>html</span><span>:</span> <span>bool</span>
    <span>throttle_label</span><span>:</span> <span>List</span><span>[</span><span>str</span><span>]</span>
    <span>high_priority</span><span>:</span> <span>bool</span>
    <span>extra_css</span><span>:</span> <span>str</span>

<span>message</span> <span>=</span> <span>Message</span><span>()</span>
<span>json_string</span> <span>=</span> <span>message</span><span>.</span><span>serialize</span><span>()</span>
<span>message_again</span> <span>=</span> <span>Message</span><span>.</span><span>deserialize</span><span>(</span><span>json_string</span><span>)</span>
</code></pre></div>

<p>The JSON schema is inferred from the type annotations. A <code>kgjson.Base</code> class can have another <code>kgjson.Base</code> class as a field.</p>
<h3><code>lib/obsidian</code></h3>
<p>I use <a href="https://obsidian.md/">Obsidian</a>, the note-taking app and Markdown editor, heavily in my daily life. <code>lib/obsidian</code> lets me manipulate Obsidian-flavored Markdown files in Python:</p>
<div><pre><span></span><code><span>from</span> <span>lib</span> <span>import</span> <span>obsidian</span>

<span>vault</span> <span>=</span> <span>obsidian</span><span>.</span><span>Vault</span><span>.</span><span>main</span><span>()</span>
<span>for</span> <span>path</span> <span>in</span> <span>vault</span><span>.</span><span>markdown_files</span><span>():</span>
    <span>document</span> <span>=</span> <span>obsidian</span><span>.</span><span>Document</span><span>.</span><span>from_path</span><span>(</span><span>path</span><span>)</span>
    <span>print</span><span>(</span><span>document</span><span>.</span><span>word_count</span><span>())</span>

    <span>for</span> <span>section</span> <span>in</span> <span>document</span><span>.</span><span>sections</span><span>():</span>
        <span>print</span><span>(</span><span>section</span><span>.</span><span>title</span><span>())</span>
</code></pre></div>

<h3>Web applications</h3>
<p>Web applications use <a href="https://flask.palletsprojects.com/en/stable/">Flask</a> on the backend and <a href="https://mithril.js.org/index.html">Mithril.js</a> on the frontend. I have DNS set up in my Tailscale VPN so that my web services can use short URLs like http://bookmarks/. I use <a href="https://caddyserver.com/">Caddy</a> as a reverse proxy.</p>
<h3>Other utility libraries</h3>
<ul>
<li><code>lib/dblog</code> for lightweight structured logging to the local SQLite database</li>
<li><code>lib/emailalerts</code> for sending email alerts, with throttling</li>
<li><code>lib/githelper</code> for working with Git repositories</li>
<li><code>lib/humanunits</code> for converting to and from human-readable units like &#39;1h&#39; or &#39;2 MB&#39;</li>
<li><code>lib/oshelper</code> for OS utilities, like replacing files atomically and managing lock files</li>
<li><code>lib/secrets</code> for managing secret values like API keys more securely than as plaintext environment variables</li>
<li><code>lib/simplemail</code> for sending emails to myself using the Fastmail API</li>
<li><code>lib/tabular</code> for printing tabular data in the terminal</li>
<li><code>lib/timehelper</code> for date and time utilities</li>
</ul>
<h3>Deployment</h3>
<p>My development environment is kept separate from the live environment on my laptop and on the homeserver. The core of the deployment script is just <code>git push</code>, but there are a good number of set-up and clean-up steps, like building the frontend assets and running <code>schema.sql</code> to update the database schema.</p>
<h2>Applications</h2>
<h3><code>app/habits</code></h3>
<p>This is one piece that has changed only modestly since 2022, when <a href="https://iafisher.com/blog/2022/02/khaganate">I wrote</a>:</p>
<blockquote>
<p>The first iteration of the Khaganate habit tracker was similar to Loop, with a set cadence for each habit and a grid of daily checkmarks. I switched to a linear view because it takes up less space and allows me to record multiple instances of the same habit in a single day. Each habit carries a certain number of points, and I track the total points from good and bad habits on my metrics dashboard. The individual habits are also useful as their own metrics (e.g. &#34;How many times did I cook this month?&#34;), and for setting goals that can be tracked automatically (for example, &#34;Eat out less than X times a month&#34;).</p>
</blockquote>
<p>Habits are still color-coded as good (green), neutral (gray), or bad (red) – indeed, the UI has changed little in 4 years – but I no longer track &#34;points&#34; or set goals, and I&#39;ve broadened the definition of &#34;habits&#34; to include, e.g., how often I fall sick or how often I give a presentation.</p>
<h3><code>app/bookmarks</code></h3>
<p><code>app/bookmarks</code> is a web UI for articles and webpages I wish to read, which are automatically pulled from a few sources:</p>
<ul>
<li>My unread bookmarks in Chrome</li>
<li>RSS feeds I follow</li>
<li>The front page of Hacker News each day, filtered by an LLM</li>
</ul>
<p>The web interface was mainly written by Claude Code, and I had it add some bells-and-whistles like categorization, editing, and shuffling, which I in fact seldom use.</p>
<p><img src="https://iafisher.com/static/uploads/2026-01-22-monorepo-habits.png"/></p>
<p>Bookmarks that remain unread after 60 days are silently pruned.</p>
<h3><code>app/golinks</code></h3>
<p>A <a href="https://iafisher.com/blog/2020/10/golinks">go link</a> is a short, named link like &#39;go/crossword&#39; that redirects to a target page. My original implementation of go links was a browser extension; the current implementation is nothing more than a barebones HTTP server that reads from a single database table, plus a DNS entry for the top-level &#39;go&#39; domain.</p>
<h3><code>app/is-it-up</code></h3>
<p><code>app/is-it-up</code> checks once an hour that my personal website and <a href="https://cityquiz.io">CityQuiz.io</a> are running, and sends me an email if they are not.</p>
<h3><code>app/obsidian</code></h3>
<p><code>app/obsidian</code> is a collection of Python scripts for my Obsidian vault. The main job is called <code>tidy</code>. Its purpose is to create backlinks from, e.g., a dated page like <code>2026-01-habits-reorganization.md</code> to the corresponding journal page, or to a &#39;topic&#39; page like <code>t-software-projects</code>. It uses <code>lib/obsidian</code> to parse and update the Markdown files in-place.</p>
<p>My Obsidian vault is also a Git repository; a regular snapshot job creates a commit with all unstaged changes.</p>
<h3><code>app/obsidian_plugins</code></h3>
<p>Besides the Python scripts in <code>app/obsidian</code>, I have some proper <a href="https://obsidian.md/plugins">Obsidian plugins</a> written in TypeScript:</p>
<ul>
<li>A quick switcher that I like more than both the built-in switcher and <a href="https://github.com/scambier/obsidian-omnisearch">Omnisearch</a></li>
<li>A find-in-file plugin that uses <code>ripgrep</code> to search the vault</li>
</ul>
<h3><code>app/money</code></h3>
<p><code>app/money</code> ingests transaction CSV files from my bank accounts and credit cards, normalizes them, and stores them in my database. (I still download all the CSV files manually; this is one thing I want to automate further.)</p>
<p>I can run <code>money summary 2025q3</code> on the command-line to see how much I spent in the third quarter of 2025, broken down by category. Compared to the pie and bar charts that I had in Khaganate, the state of things in <code>app/money</code> is less sophisticated, with the major exception that transactions are imported automatically from my statements – in Khaganate, I had to enter every transaction manually.</p>
<h3>Other apps</h3>
<ul>
<li><code>app/logrotate</code> deletes old log files in <code>~/.ian/logs</code>.</li>
<li><code>app/backup</code> saves a back-up of my laptop&#39;s hard drive to Backblaze every night.</li>
<li><code>app/llm2</code> and <code>app/llmweb</code> are the command-line and web interfaces, respectively, to my LLM tooling, which I will discuss in greater detail in a future post.</li>
<li>I self-host a Jupyter instance which I use for one-off projects like graphing my habits over time or analyzing my finances.</li>
</ul>
<h2>Future directions</h2>
<p>The monorepo isn&#39;t open-source for the sake of my personal privacy, but the <a href="https://github.com/iafisher/foundation">foundation</a> repo is, and I intend to move many of the monorepo libraries there once they are stable.</p>
<p>Little of the code in the monorepo was written by AI. I expect to use LLMs more in the future but will still likely continue to write most of the code myself. After all, I do enjoy programming for its own sake – otherwise I might as well have used <a href="https://click.palletsprojects.com/en/stable/">Click</a> and <a href="https://docs.pydantic.dev/latest/">Pydantic</a> instead of writing my own <code>lib/command</code> and <code>lib/kgjson</code>.</p>
<p>In my post on Khaganate, I asked:</p>
<blockquote>
<p>I&#39;ve certainly spent a lot of time on Khaganate — the git repository has more than 2,300 commits since November 2019. Has it been worth it?</p>
</blockquote>
<p>I answered &#39;yes&#39; then, and even though I eventually retired Khaganate, I continue to think that my personal software infrastructure is something worth investing in. ∎</p>
  </div></div>
  </body>
</html>
