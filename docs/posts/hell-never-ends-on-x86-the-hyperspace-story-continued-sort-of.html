<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cohost.org/cathoderaydude/post/1311259-hell-never-ends-on-x">Original</a>
    <h1>Hell Never Ends on x86: The Hyperspace Story, Continued, Sort Of</h1>
    
    <div id="readability-page-1" class="page"><div data-post-body="true"><div><p>When researching Phoenix Hyperspace for <!-- --><a href="https://cohost.org/cathoderaydude/post/1228730-taking-the-deepest-p" target="_blank" rel="nofollow noopener noreferrer">my highly upsetting post<!-- --></a> on the subject, it was hard to avoid news articles proclaiming that it had been sold off by Phoenix (when they gave up wholesale on their idea of making anything other than BIOSes) and bought up by HP. However, that&#39;s where the trail ended; attempts to find out what, if anything, HP had done with it proved fruitless. That is, until two days ago.<!-- --></p><hr/>
<!-- --><p>When researching an only tangentially related subject (the Dell Latitude Z600, which runs a completely different instant-on linux) I stumbled across a mention of <!-- --><em>HP QuickWeb<!-- --></em>, described as another fast-booting Linux distro. Digging into this, I uncovered quite a shocking amount of information I had managed to miss before, on account of there being no standardized terminology for any of this stuff.<!-- --></p>
<!-- --><p>The discovery process on all of this happened so quickly that I don&#39;t really want to drag it out the way I did in the previous post. Once I knew the terminology, it took me maybe six hours to make it from beginning to end. The journey is less important than the destination in this leg of the story, so let me just summarize much of it, broken up into Important Data Nodes:<!-- --></p>
<!-- --><ul>
<!-- --><li>
<!-- --><p>HP did in fact buy Hyperspace in late 2009 - but they didn&#39;t do anything with it right away.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p><em>Prior<!-- --></em> to the acquisition, they already had an instant-on Linux - one based on Splashtop, under the name QuickWeb.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>It&#39;s amazing that I missed this, because they sold it across their <!-- --><em>whole range<!-- --></em> for several years. Netbooks (Mini 210), consumer machines (Envy 13/14), business (Probook 4730s, 4530s, 4430s), executive (Elitebook 8540w, 8440p) - and these are just some examples. There were many more. I was able to walk into RePC the day after I learned about this and walk out with two machines that support it, that&#39;s how common it was.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Laptops with QuickWeb support have a little button with a globe icon that boots QuickWeb instead of your normal OS. Note that not <!-- --><em>all<!-- --></em> HPs with globe buttons can do it; on some, that button just opens a web browser within Windows. There is no way to tell which is which. For instance, the Elitebook 8460 and 8470 look exactly identical, but only the former supports QuickWeb.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>A couple years after the acquisition (AFAICT) HP finally decided to do something with Hyperspace: They quietly replaced the existing QuickWeb with one based on Hyperspace, with no fanfare or announcement of any kind. I can find no information linking the two - the only way I was able to prove this was by downloading two revisions of QuickWeb, extracting them, and finding strings for Splashtop in one and Hyperspace in the other.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>As with the other Hyperspace (and Splashtop) implementations I showed in the previous post, the actual OS is completly uninteresting. In fact, it doesn&#39;t even have the unholy host filesystem access feature, or the office suite, or the ability to save files at all. It&#39;s simply a web browser, Skype, an email client, and some news and stonks widgets.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Additionally, HP did not base their implementation on Hyperspace Hybrid or Dual. It&#39;s the very basic version: a fast-boot Linux that dual-boots with Windows.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>It is not, however, a conventional MBR-type dual-boot setup, nor is it using Phoenix&#39;s wacky hidden BEER partition table nonsense. Instead, the OS is simply stored as files on a FAT32 partition called HP_TOOLS; it&#39;s not even hidden, the user can see it in Windows.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Since this era of HP laptop had early UEFI, and UEFI can read FAT32, they used custom firmware code to just look for a partition with that specific name, then it finds &#34;HP_TOOLS\QuickWeb\QuickWeb.efi&#34; and boot it. EFI is a big step in making the PC more boring (good meaning)<!-- --></p>
<!-- --></li>
<!-- --></ul>
<!-- --><p>Okay, let&#39;s have some pictures.<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quickweb-buttons-2.jpg" alt="Photo of the Quickweb button on an HP laptop" title="Photo of the Quickweb button on an HP laptop"/></p>
<!-- --><p>This is the &#34;globe&#34; button. As noted, it doesn&#39;t mean a machine definitely has QuickWeb.<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quickweb-2.jpg" alt="Photo of a laptop running HP QuickWeb, showing a &#34;desktop&#34; full of &#34;widgets&#34;, such as a photo album and recently visited pages, as well as a summary of email messages, and a series of shortcut icons at the bottom to a web browser, music, photo viewer, Skype, chat app, and calendar" title="Photo of a laptop running HP QuickWeb, showing a &#34;desktop&#34; full of &#34;widgets&#34;, such as a photo album and recently visited pages, as well as a summary of email messages, and a series of shortcut icons at the bottom to a web browser, music, photo viewer, Skype, chat app, and calendar"/></p>
<!-- --><p>This is Quickweb - specifically, a version I haven&#39;t yet been able to locate. This is from an old blog post. It&#39;s obviously Splashtop-based, since it&#39;s clearly branded in the screenshot, but it seems to be much closer to the original offering, with a widget based &#34;desktop&#34; and a number of bundled apps including Skype, chat, email, music and a photo viewer. I found a couple other screenshots that make it clear that the latter two apps are <!-- --><em>still<!-- --></em> the terrible Adobe Flash crap that they were selling in 2009.<!-- --></p>
<!-- --><p>I have seen references in HPs docs to QuickWeb version numbers, but no clear rubric. I suspect that this version is &#34;QuickWeb 1,&#34; the next one is &#34;QuickWeb 2&#34;, and the Hyperspace version is &#34;QuickWeb 3.&#34;<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quickweb-1.jpg" alt="Photo of a laptop running HP QuickWeb, showing the about page for a web browser that takes up the whole screen" title="Photo of a laptop running HP QuickWeb, showing the about page for a web browser that takes up the whole screen"/></p>
<!-- --><p>The above is what I suspect was &#34;QuickWeb 2.&#34; It says version 1, but who knows whose numbering scheme that is. It&#39;s still Splashtop-based, but HP has removed the branding. I was able to install it on a machine (EliteBook 8440p,) but it seems to have absolutely no features other than a web browser - this is the <!-- --><em>sole<!-- --></em> UI. It appears to be a huge downgrade, reason unknown.<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quickweb-3.jpg" alt="Photo of a laptop running HP QuickWeb, showing a very different widget &#34;desktop&#34; with CNN news headlines, sticky notes, stock ticker, clock, weather, and a calculator widget, as well as a search/address bar for launching a browser" title="Photo of a laptop running HP QuickWeb, showing a very different widget &#34;desktop&#34; with CNN news headlines, sticky notes, stock ticker, clock, weather, and a calculator widget, as well as a search/address bar for launching a browser"/></p>
<!-- --><p>This is the Hyperspace version, which I think is &#34;QuickWeb 3.&#34; Functionally, it&#39;s a middle ground; it has Skype and email, plus these widgets (which, again, still work; I connected to wifi and both the CNN and BBC headline widgets populated.) Otherwise, it is still very barebones, not much better than &#34;QuickWeb 1&#34; from the looks of things.<!-- --></p>
<!-- --><p>As noted, there is <!-- --><em>nothing<!-- --></em> worth discussing about the OSes themselves. It&#39;s mostly just fascinating that Hyperspace continued to have a life at all, and kind of a disappointment that HP&#39;s vision of its future didn&#39;t include any of its advanced implementations, and in fact didn&#39;t even include the office suite or anything that made it more interesting than Splashtop.<!-- --></p>
<!-- --><p>Anyway, let&#39;s get into <!-- --><a href="https://www.youtube.com/watch?v=S79XB-mTstA" target="_blank" rel="nofollow noopener noreferrer">the new shit<!-- --></a>.<!-- --></p>
<!-- --><h2>This Is The New Shit<!-- --></h2>
<!-- --><p>While investigating QuickWeb, I began finding mentions of something called Quick<!-- --><em>Look<!-- --></em>. At first, it wasn&#39;t clear if this was two names for the same thing, but it became apparent that QuickLook was a distinct product, because I learned that certain models (e.g. EliteBook 8440p) had <!-- --><em>another<!-- --></em> separate button for launching it.<!-- --></p>
<!-- --><p>Let me reiterate: Certain HP laptops have <!-- --><em>three power buttons<!-- --></em> that launch different OSes. That slaps all on it&#39;s own.<!-- --></p>
<!-- --><p>But what <!-- --><em>is<!-- --></em> Quicklook?<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quicklook-1.jpg" alt="A laptop screen with a blue banner proclaiming &#39;HP Quicklook&#39;, and an error message in many languages stating that no user information was found" title="A laptop screen with a blue banner proclaiming &#39;HP Quicklook&#39;, and an error message in many languages stating that no user information was found"/></p>
<!-- --><p>It&#39;s not an &#34;OS.&#34; It&#39;s a <!-- --><em>program.<!-- --></em> Literally - it turns out to be &#34;HP_TOOLS\QuickLook\QuickLook.efi&#34;, a <!-- --><em>standalone EFI application.<!-- --></em> Normally you only see those in the form of OS bootloaders, BIOS config utilities, or maybe a very limited motherboard/laptop vendor recovery or firmware flashing tool. But EFI apps are just binaries, and EFI is a limited &#34;OS&#34; that provides a set of libraries, so you can conceivably write many complex programs to run inside of it.<!-- --></p>
<!-- --><p>HP decided to write Outlook.<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quicklook-2.jpg" alt="A laptop screen with the same &#34;HP QuickLook&#34; banner, but now the rest of the screen displays a clean, businesslike blue-on-white calendar view. There are icons to add and delete calendar events, and one event exists, labeled &#34;Meeting with Steven Job.&#34; A sidebar displays calendars spanning three months, and another sidebar displays details on the current event" title="A laptop screen with the same &#34;HP QuickLook&#34; banner, but now the rest of the screen displays a clean, businesslike blue-on-white calendar view. There are icons to add and delete calendar events, and one event exists, labeled &#34;Meeting with Steven Job.&#34; A sidebar displays calendars spanning three months, and another sidebar displays details on the current event"/></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quicklook-3.jpg" alt="The same QuickLook app, except an email composition dialog is open, featuring the usual MVP (to, CC, Bcc, subject and body fields; Save to Drafts; Signature)" title="The same QuickLook app, except an email composition dialog is open, featuring the usual MVP (to, CC, Bcc, subject and body fields; Save to Drafts; Signature)"/></p>
<!-- --><p>QuickLook is an email and calendar app that you can launch directly instead of booting a normal OS. I need to stress that, as far as I can tell, <!-- --><em>this is not Linux<!-- --></em>, this is not DOS, this is not <!-- --><em>anything<!-- --></em>. This is a bespoke <!-- --><em>standalone program<!-- --></em>, written in C (there are .c files mentioned all throughout the .EFI, which is just a Windows-format .EXE with a different name.) It leverages EFI&#39;s basic mouse/keyboard/graphics APIs, like &#34;Absolute Pointer Protocol&#34; and &#34;Graphics Output Protocol.&#34;<!-- --></p>
<!-- --><p>To reiterate, because I need to know you understand: HP wrote an email/calendar client completely from scratch that runs inside your system&#39;s BIOS.<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quickweb-buttons-1.jpg" alt="The button strip on an Elitebook 8440p, showing the power, QuickLook and QuickWeb buttons" title="The button strip on an Elitebook 8440p, showing the power, QuickLook and QuickWeb buttons"/></p>
<!-- --><p>When you press the QuickLook button (the left blue icon above; the right is QuickWeb), the machine powers on, POSTs, and then hard code in the EFI firmware checks for an attached hard drive with a partition called HP_TOOLS, then boots straight into Quicklook\QuickLook.EFI, and then <!-- --><em>that is what is running on your machine.<!-- --></em> Not Windows, not Linux. Your PC is <!-- --><em>natively running QuickLook<!-- --></em>.<!-- --></p>
<!-- --><p>So, how does it handle networking, SMTP/IMAP, and all the complexities of Outlook, without actually being Outlook? How does it read and write to your .OST database on your main NTFS partition without risking corruption? Well, naturally, it doesn&#39;t. This is another filthy hack.<!-- --></p>
<!-- --><p>When you install QuickLook, it installs a plugin for Outlook (only supported on 2003 and 2007) which <!-- --><em>periodically, at a configurable interval, copies the entire contents of your inbox and calendar to an XML file in HP_TOOLS.<!-- --></em> If you send an email or edit a calendar event from QuickLook, it just writes it to an XML file, and when you boot into Windows again, the Outlook plugin reads it and replicates those actions within the real user DB.<!-- --></p>
<!-- --><p>What I said was a lie: HP didn&#39;t reimplement Outlook at all. They wrote a <!-- --><em>generic email and calendar app<!-- --></em>, then wrote an Outlook connector for it.<!-- --></p>
<!-- --><p>This has implications.<!-- --></p>
<!-- --><p>When I first started Quicklook, it complained that there was no user data, and I had to install the Outlook plugin to fix that. But at this point, you may be wondering: if it&#39;s not actually touching the Outlook data file, then why do we even need Outlook, or Windows at all? The answer, as far as I know, is that you don&#39;t - and HP doesn&#39;t even claim that you do.<!-- --></p>
<!-- --><p>HP provides a <!-- --><a href="http://h10032.www1.hp.com/ctg/Manual/c01564727.pdf" target="_blank" rel="nofollow noopener noreferrer">document<!-- --></a> explaining how QuickLook works, which includes instructions on how to <!-- --><em>build the HP_TOOLS partition manually<!-- --></em> and populate it with the needed files. There is no claim that you <!-- --><em>must<!-- --></em> set this up using their official installer.<!-- --></p>
<!-- --><p>I haven&#39;t tried yet, but I can&#39;t think of a reason you couldn&#39;t do this from Linux, by simply making the partition and copying the files over. They aren&#39;t &#34;blessed.&#34; There are no secret MBR entries. EFI is <!-- --><em>modern software<!-- --></em>, not a taped together pile of shit based on code from 1983 that only barely understands x64 and thinks it&#39;s booting from a floppy drive or a <!-- --><em>cassette port<!-- --></em>. It knows what AHCI is! It can just read the fucking filesystem! It doesn&#39;t need a hand up from some absurd preboot bodgery. This whole thing is just a bunch of files.<!-- --></p>
<!-- --><p>In addition, the data files are not complex:<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/quicklook-xml.png" alt="A chunk of XML code describing a calendar event" title="A chunk of XML code describing a calendar event"/></p>
<!-- --><p>There is nothing stopping you from writing your own script that reads a mail file from anything else - Thunderbird, or <!-- --><em>pine<!-- --></em> - and produces these files. QuickLook shouldn&#39;t care.<!-- --></p>
<!-- --><p>Not, of course, that you&#39;d WANT to use QuickLook. It doesn&#39;t boot that much faster than a modern OS on an SSD. Nowadays, it&#39;s utterly pointless, and additionally, it runs like <!-- --><em>shit<!-- --></em>.<!-- --></p>
<!-- --><p>While UEFI is &#34;an operating system&#34; for many intents and purposes... it&#39;s not a very <!-- --><em>good<!-- --></em> one. Its APIs are very limited and unoptimized, and that&#39;s probably why the UI updates at maybe 10fps. The mouse cursor doesn&#39;t even move smoothly. It really looks and feels like crap, and that&#39;s most likely because HP&#39;s devs had to write their own widget set, there&#39;s no 2D graphics acceleration, no multithreading, and the API may not even allow access to the framebuffer except through extremely crude, unoptimized full-screen updates.<!-- --></p>
<!-- --><p>Think of how the BIOS config on your motherboard from 2012 performed, then imagine trying to use that as an operating system. Oof. So just like Splashtop and Hyperspace, it&#39;s pointless, but it <!-- --><em>is<!-- --></em> neat - though sadly not as neat as the absurd ACPI horseshit from the last post.<!-- --></p>
<!-- --><p>However, I had not yet reached the end of my discoveries.<!-- --></p>
<!-- --><h2>Deeper, more sinful acts, for less payoff<!-- --></h2>
<!-- --><p>I was able to install QuickLook and QuickWeb on the machines I bought by simply downloading them from HP&#39;s driver site. Bless them, sort of. But while trying to find a specific version for a particular machine, I saw a link to a download for something called &#34;HP DayStarter.&#34; The description was... concerning.<!-- --></p>
<!-- --><blockquote>
<!-- --><p>The HP DayStarter displays Microsoft Outlook calendar information and custom messages while Windows loads on supported notebook models with supported operating systems.<!-- --></p>
<!-- --></blockquote>
<!-- --><p>My reaction was &#34;I&#39;m sorry. What,&#34; and it kinda still is.<!-- --></p>
<!-- --><p>I found this screenshot:<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/daystarter-2.jpg" alt="A fuzzy photo from a presentation showing a calendar, underneath which is the text &#34;Windows is starting&#34;" title="A fuzzy photo from a presentation showing a calendar, underneath which is the text &#34;Windows is starting&#34;"/></p>
<!-- --><p>Daystarter purports to show you your calendar <!-- --><em>while Windows is booting.<!-- --></em> And, okay, so what - they&#39;re just replacing the bootsplash image, like we all did on Windows 98 and XP when we were 13.<!-- --></p>
<!-- --><p>No. It <!-- --><em>steps through your week<!-- --></em> as it boots. And you can hit keyboard shortcuts to pause or clear it. This is a <!-- --><em>program<!-- --></em> that runs while Windows boots.<!-- --></p>
<!-- --><p>I don&#39;t... really... <!-- --><em>need<!-- --></em> to explain that this isn&#39;t possible. As-written: no, this isn&#39;t a thing, this can&#39;t be done, and I don&#39;t just mean &#34;it&#39;s hard and messy,&#34; I mean <!-- --><em>this should not be possible.<!-- --></em></p>
<!-- --><p>I am no systems programmer (nor have I passed the bar) but I know a little bit. The moment any Windows based on NT begins booting, the system is in protected mode. As the name suggests, this is a <!-- --><em>security feature<!-- --></em>, to prevent programs from doing things that endanger the reliability of the system.<!-- --></p>
<!-- --><p>As soon as the Windows kernel begins executing, it has <!-- --><em>total dominion<!-- --></em> over the PC. Nothing else is allowed to run - nothing else <!-- --><em>can<!-- --></em> run. The CPU is executing only the Windows kernel code. If anything else attempts to write to system memory - such as the VGA framebuffer - without the kernel&#39;s permission, it would result in a hardware-level exception, which the kernel would trap and discard.<!-- --></p>
<!-- --><p>I&#39;m overstating the point however. It doesn&#39;t matter that something else <!-- --><em>couldn&#39;t<!-- --></em> touch system memory, because there&#39;s <!-- --><em>just simply no way to execute other code.<!-- --></em> At this point in the boot process, your computer is like a MOS 6502 from 1979. It&#39;s a Turing machine. Each byte of machine code from the Windows kernel is executed in order, it does <!-- --><em>exactly<!-- --></em> what Microsoft coded it to do, and then the instruction pointer either advances or jumps to another location that the Windows kernel chooses.<!-- --></p>
<!-- --><p>There are no cracks into which to get your fingers. It&#39;s like asking &#34;what if my hand passed through this brick wall, how would we handle that scenario?&#34; It&#39;s not going to happen because it&#39;s logically impossible.<!-- --></p>
<!-- --><p>So I installed QuickLook and rebooted the laptop.<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/daystarter.jpg" alt="A fuzzy photo showing a laptop screen with the calendar from the previous image, and the &#34;Windows is starting&#34; text, but the calendar event is &#34;Meeting with Steven Jobs&#34;" title="A fuzzy photo showing a laptop screen with the calendar from the previous image, and the &#34;Windows is starting&#34; text, but the calendar event is &#34;Meeting with Steven Jobs&#34;"/></p>
<!-- --><p>Holy fucking hell. They really did it, the madmen. But <!-- --><em>how<!-- --></em>. Fucking <!-- --><em>how did they do this,<!-- --></em> when it should be <!-- --><em>physically impossible?<!-- --></em></p>
<!-- --><p>The first answer that comes to mind is &#34;they hacked the OS&#34;, but A) it would instantly get reverted by Microsoft SFC, B) it would instantly break as soon as you installed any OS patches, and C) nah. Just nah. HP did not write <!-- --><em>a program that binary-patches NTOSKRNL.COM.<!-- --></em> That isn&#39;t even on the table.<!-- --></p>
<!-- --><p>But... what else is left? What could they <!-- --><em>possibly<!-- --></em> have done to accomplish this?<!-- --></p>
<!-- --><p>If you can believe this: It&#39;s <!-- --><em>worse than Hyperspace Dual.<!-- --></em></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/daystarter-3.jpg" alt="A presentation slide covered in diagrams and text, mostly unimportant; the important parts described below" title="A presentation slide covered in diagrams and text, mostly unimportant; the important parts described below"/></p>
<!-- --><p>We don&#39;t have full documentation on how this works, but we have enough to assemble a working theory.<!-- --></p>
<!-- --><p>What we do know is that the Quicklook plugin for outlook creates a DayStarter folder on HP_TOOLS, and whenever a sync occurs, it reads your calendar and spits out 7 JPEG files. For instance:<!-- --></p>
<!-- --><p><img src="https://gekk.info/articles/images/quickweb/daystarter-1.jpg" alt="An image (distorted due to non-square pixel ratio) of a Daystarter splash-screen calendar showing the Steven Jobs meeting" title="An image (distorted due to non-square pixel ratio) of a Daystarter splash-screen calendar showing the Steven Jobs meeting"/></p>
<!-- --><p>This is one of the files it generated. These, again, are simply files in the FAT32 filesystem.<!-- --></p>
<!-- --><p>When you enable HP Daystarter (it&#39;s a setting in the BIOS setup), I believe that there is a piece of <!-- --><em>hard code<!-- --></em> in the firmware that activates. In other words, this is not an EFI application being loaded off the HDD like QuickWeb and QuickLook. There&#39;s no &#34;Daystarter.efi&#34;, and that makes sense - if you booted into that, you wouldn&#39;t be booting Windows.<!-- --></p>
<!-- --><p>Maybe it&#39;s chainloading into Windows? Well, this machine shipped with Windows 7, which didn&#39;t even get UEFI support until very late in its lifespan. It was almost certainly shipped in UEFI-CSM mode (aka BIOS mode,) and that&#39;s how it&#39;s working on my specimen. So they wouldn&#39;t be able to launch an EFI app, then chainload into a BIOS app - at least, all the universal bootloaders I&#39;ve tried claim that this is impossible, and I&#39;m sure if that wasn&#39;t the case they would be willing to do it.<!-- --></p>
<!-- --><p>The theory partly suggested by mxshift (who isn&#39;t on here, but we chat on discord and they do x86 firmware programming) is that Daystarter gets loaded by HP&#39;s EFI (i assume <!-- --><em>before<!-- --></em> it goes to CSM mode) and traps a certain interrupt or IO access. As Windows is starting, it keeps updating the VGA framebuffer to move the progress bar. Daystarter traps that event, throws it away, and instead writes its <!-- --><em>own<!-- --></em> content to the framebuffer. It also uses this opportunity to check the keyboard buffer for an F4 or F3, so it can take user input.<!-- --></p>
<!-- --><p>But wait - how is that code running? Windows is in protected mode at this point, what would be allowed to supersede it?<!-- --></p>
<!-- --><p>Per the slide reproduced above: <!-- --><em>Daystarter runs from goddamn System Management Mode.<!-- --></em></p>
<!-- --><p>I had never heard of SMM before today. Apparently this was introduced on the 386SL CPU (supposedly, to implement software-based thermal management features) and operates with a privilege level even higher than ring 0 (where the Windows kernel lives) with access to do virtually anything. It&#39;s a well-guarded feature, apparently, but hey - HP writes their own firmware. They can do whatever the hell they want.<!-- --></p>
<!-- --><p>So Daystarter is - naturally! - a <!-- --><em>horrifying<!-- --></em> abuse of a hardware feature not intended for this at all. I&#39;m told SMM has been leveraged before for many things it wasn&#39;t intended for, such as the implementation of USB legacy keyboard support, but this feels like it&#39;s just not justified.<!-- --></p>
<!-- --><p>Because, let&#39;s be real here: This is absurd! <!-- --><em>This is all so fucking absurd!<!-- --></em></p>
<!-- --><h2>The one stupid lever you can pull<!-- --></h2>
<!-- --><p>I have this long running theory about computer hardware manufacturers: They&#39;re miserable, and terrified.<!-- --></p>
<!-- --><p>I have written many times, from different angles, about what I think capitalism sees in Technology as a whole. The basic loop has been the same for over a century:<!-- --></p>
<!-- --><ul>
<!-- --><li>
<!-- --><p>Invent a thing<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Convince a group of people (hopefully &#34;everyone&#34;) that it will make them happier<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Make lots of profit by selling people your vacuum cleaner<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>MARKET SATURATION! Everyone has a vacuum and nobody needs a new one.<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Invent a new vacuum with a stronger motor OR a quieter motor OR a longer hose OR a better beater OR lighter weight<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Make lots of profit by selling people your <!-- --><em>new<!-- --></em> vacuum; they throw out their old one.<!-- --></p>
<!-- --></li>
<!-- --></ul>
<!-- --><p>Now look at PCs, from the perspective of a vendor like HP or Dell:<!-- --></p>
<!-- --><ul>
<!-- --><li>
<!-- --><p><em>Assemble<!-- --></em> a thing out of parts you had nothing to do with: an Intel CPU and chipset, Realtek audio, nVidia GPU, and so on<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Convince a group of people that yours is the cheapest or most reliable<!-- --></p>
<!-- --></li>
<!-- --><li>
<!-- --><p>Make lots of profit by selling people the exact same thing your competition has<!-- --></p>
<!-- --></li>
<!-- --></ul>
<!-- --><p>This is a much tougher row to hoe. The whole latter part of the loop is missing. How does Dell convince you that their machine has a new greeble, a new button, a new lever? They can&#39;t. It&#39;s impossible for them to add one, the PC doesn&#39;t work that way. The basic motherboard <!-- --><em>has<!-- --></em> to be wired up exactly the same way in every single machine in the world; all functions beyond basic CPU, memory and boot have to be provided by standardized components - USB, PCIe, or m.2. They <!-- --><em>have<!-- --></em> to work the same as all others of their type.<!-- --></p>
<!-- --><p>This means that Dell can&#39;t sell you a machine with a feature that isn&#39;t just <!-- --><em>a PCIe card<!-- --></em> or <!-- --><em>a USB device.<!-- --></em> Sure, maybe they could invent a device that uses those interfaces and refuse to sell it through any other channels except with their PCs - but I challenge you to come up with such a device that A) would be so compelling that it would make someone buy a Dell just to have it, and B) wouldn&#39;t be cloned as a generic product a week later. It&#39;s impossible.<!-- --></p>
<!-- --><p>It&#39;s even worse for motherboard vendors. <!-- --><em>All these companies are is turnkeys<!-- --></em>. They take the Intel socket of the month, Intel chipset of the month, and whichever other jellybean parts are current and glue them together. Is it <!-- --><em>easy?<!-- --></em> Probably not, but nobody cares.<!-- --></p>
<!-- --><p>Yeah, people have always had opinions. They&#39;d say &#34;all Gigabyte boards are trash&#34; - it&#39;s patent nonsense, and we all know it. People used Gigabyte or Abit or ECS boards for years with no real trouble. Sometimes a bad chipset came out, like the nForce, but that wasn&#39;t the board mfgr&#39;s fault. The only thing they ever really fucked up was the capacitor situation, and you better BELIEVE the vendors all rode THAT shit when it was finally acknowledged as a real problem. There were (and I think still are) motherboard boxes with MASSIVE wordart text proclaiming JAPANESE POLYMER CAPS as the highest-billed feature.<!-- --></p>
<!-- --><p>Because, yeah - what the hell else can a motherboard vendor offer? They aren&#39;t allowed to do anything! Their board HAS to work exactly the same as all others or it&#39;s useless trash. And how could they add any functionality anyway? They&#39;re essentially selling you the <!-- --><em>middle<!-- --></em> of a machine. All the parts you bolt on see it as a black box that&#39;s supposed to work a very specific way. It&#39;s logically impossible for anything the motherboard does to affect how the computer works; it&#39;s simply a junction box.<!-- --></p>
<!-- --><p>In the mid 2000s, Abit and ASUS and MSI were going <!-- --><em>batshit.<!-- --></em> They couldn&#39;t figure out what to do - the market for DIY PCs was huge, probably even moreso than now, but the only levers they had access to pull were thermal management and overclocking - <!-- --><em>so you better believe they rode it as hard as they can.<!-- --></em> That&#39;s when we started getting these grotesque, screen-filling overclocking apps with gallons of Graphic Design dumped on them; huge virtual gauges trying to turn &#34;adjusting a voltage rail by .01V&#34; into Some Matrix Shit.<!-- --></p>
<!-- --><p>It&#39;s also when Asus sold at least one board with a complete 5.25&#34; front drive bay panel dedicated to resetting your CMOS settings.<!-- --></p>
<!-- --><p>Yeah, I know, I know. Overclockers did need to do that a lot. But that&#39;s not why ASUS made such a big deal out of it. It was this great big army-green panel with caution stripes and a molly cover over the switch. Asus was <!-- --><em>so fucking pumped<!-- --></em> that they finally got to expose <!-- --><em>the one actual function their board had<!-- --></em>. Motherboards can&#39;t have buttons! This was the only one that could ever exist, and for 15 years it only got pressed once every five years. Asus were beside themselves that they finally got to have <!-- --><em>a feature<!-- --></em>.<!-- --></p>
<!-- --><p>I saw CMOS reset switches dressed up in so many ways, because that&#39;s all they had. And when EFI came along and gave motherboard vendors <!-- --><em>something, anything at all<!-- --></em> to customize, they ate it up. Every single motherboard has a completely different (and uniquely unnavigable) CMOS setup because, again, this is the only lever they can pull.<!-- --></p>
<!-- --><p>So, comparing to the situation in question:<!-- --></p>
<!-- --><p>Imagine being a product designer at HP, in the <!-- --><em>very weird<!-- --></em> year of 2010, and having some fucking VP storm in and go &#34;We have to deliver Features for Executives. We&#39;re selling $1500 notebooks to them, but Dell has exactly the same set of ins and outs as us. We need Features.&#34;<!-- --></p>
<!-- --><p>You just stare at the guy, and slowly go, &#34;We&#39;re... a motherboard. That&#39;s all we are, Bob. We can&#39;t <!-- --><em>have<!-- --></em> features. Everything that happens once the computer is on is inside Windows, and we aren&#39;t allowed to touch it.&#34;<!-- --></p>
<!-- --><p>And Bob tells you you&#39;re fucking fired, and turns to the next person and says the same thing. He repeats this until someone blurts out the dumbest idea anyone&#39;s ever had, and Bob goes &#34;That&#39;s it, make that.&#34;<!-- --></p>
<!-- --><p>What do executives do on their computers? Outlook. It&#39;s the only program they run. It&#39;s why you can&#39;t sell them anything - what, more RAM? Outlook runs fine in two gigs, even now, especially then. More CPU power? Same answer. A GPU? To do what? And that&#39;s all a computer manufacturer can do - stick in more jellybean parts that someone else made.<!-- --></p>
<!-- --><p>How do you make a computer somehow <!-- --><em>better<!-- --></em> at Outlook? The answer is that you can&#39;t, it&#39;s impossible. Windows controls the whole machine and Microsoft controls Outlook, HP can&#39;t stick their fingers in and somehow enhance the Outlook experience. So, they touched the only thing that Microsoft <!-- --><em>didn&#39;t<!-- --></em> control: The pre-boot experience.<!-- --></p>
<!-- --><p>Does it make <!-- --><em>sense<!-- --></em> to write a whole separate OS, just so an executive doesn&#39;t have to wait an extra 30 seconds to see their email? Of course not. This was also 2011, and SSDs existed. It would have cost less to just bundle an SSD, and would have worked better. Sleep and hibernate were also pretty functional by then. It would have been, and almost certainly was, faster to just put your machine to sleep and wake it up normally. But no, we need a <!-- --><em>feature<!-- --></em>. So HP wrote one of the only standalone EFI applications in existence.<!-- --></p>
<!-- --><p>And then they were out of ideas. Quasi-Outlook can now load in 15 seconds! Uh. Now what? What&#39;s left to attack?<!-- --></p>
<!-- --><p>Well... what if they <!-- --><em>are<!-- --></em> intending to get into Windows? We can&#39;t speed that up (on a 5400rpm spinning disk that our absolutely oblivious cost-reduction specialists forced us to include) - so what if we were able to at least <!-- --><em>display their calendar 15 seconds sooner?<!-- --></em></p>
<!-- --><p>Was this worth it? Worth inventing completely new forms of software, worth injecting code <!-- --><em>into the fucking thermal management layer<!-- --></em> that overrides parts of the Windows boot sequence and risks corrupting main RAM and rendering the machine unusable, all for a fucking 15 second speedup? Of course not. But <!-- --><em>it&#39;s the only lever they could pull,<!-- --></em> and it&#39;s better than getting fired because your position, and your business, and the company you work for, have been redundant for a decade.<!-- --></p></div></div></div>
  </body>
</html>
