<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://codelucky.com/runit-linux-init-service-supervision/">Original</a>
    <h1>Runit Linux: Complete Guide to Unix Init Scheme with Service Supervision</h1>
    
    <div id="readability-page-1" class="page"><div><p>runit is a lightweight, cross-platform Unix init scheme with service supervision that provides a reliable alternative to traditional init systems. Developed by Gerrit Pape, runit offers a simple yet powerful approach to process supervision and system initialization, making it an excellent choice for embedded systems, containers, and servers requiring robust service management.</p>
<div id="ez-toc-container">
<div>
<p>Table of Contents</p>
</div>
<nav><ul><li><a href="#What_is_runit">What is runit?</a></li><li><a href="#Key_Features_of_runit">Key Features of runit</a></li><li><a href="#runit_Architecture">runit Architecture</a><ul><li><a href="#Stage_1_System_Initialization">Stage 1: System Initialization</a></li><li><a href="#Stage_2_Service_Supervision">Stage 2: Service Supervision</a></li><li><a href="#Stage_3_System_Shutdown">Stage 3: System Shutdown</a></li></ul></li><li><a href="#Installing_runit">Installing runit</a><ul><li><a href="#UbuntuDebian">Ubuntu/Debian:</a></li><li><a href="#CentOSRHEL">CentOS/RHEL:</a></li><li><a href="#Arch_Linux">Arch Linux:</a></li><li><a href="#From_Source">From Source:</a></li></ul></li><li><a href="#Basic_runit_Commands">Basic runit Commands</a><ul><li><a href="#sv_%E2%80%93_Service_Control">sv – Service Control</a></li><li><a href="#Example_Output">Example Output:</a></li><li><a href="#runsvdir_%E2%80%93_Service_Directory_Monitor">runsvdir – Service Directory Monitor</a></li><li><a href="#runsv_%E2%80%93_Single_Service_Supervisor">runsv – Single Service Supervisor</a></li></ul></li><li><a href="#Creating_runit_Services">Creating runit Services</a><ul><li><a href="#Basic_Service_Structure">Basic Service Structure</a></li><li><a href="#Creating_a_Simple_Web_Server_Service">Creating a Simple Web Server Service</a></li><li><a href="#Service_with_Logging">Service with Logging</a></li></ul></li><li><a href="#Advanced_Service_Configuration">Advanced Service Configuration</a><ul><li><a href="#Service_with_Environment_Variables">Service with Environment Variables</a></li><li><a href="#Service_with_User_Privileges">Service with User Privileges</a></li></ul></li><li><a href="#Service_Management_Examples">Service Management Examples</a><ul><li><a href="#Monitoring_Service_Status">Monitoring Service Status</a></li><li><a href="#Interactive_Service_Control">Interactive Service Control</a></li></ul></li><li><a href="#Logging_with_svlogd">Logging with svlogd</a><ul><li><a href="#Basic_Logging_Configuration">Basic Logging Configuration</a></li><li><a href="#Log_Filtering">Log Filtering</a></li></ul></li><li><a href="#Troubleshooting_runit_Services">Troubleshooting runit Services</a><ul><li><a href="#Common_Issues_and_Solutions">Common Issues and Solutions</a><ul><li><a href="#Service_Wont_Start">Service Won’t Start</a></li><li><a href="#Service_Keeps_Restarting">Service Keeps Restarting</a></li></ul></li><li><a href="#Debugging_Service_Scripts">Debugging Service Scripts</a></li></ul></li><li><a href="#Performance_and_Resource_Management">Performance and Resource Management</a><ul><li><a href="#Resource_Limits">Resource Limits</a></li><li><a href="#CPU_Limits">CPU Limits</a></li></ul></li><li><a href="#Migration_from_Other_Init_Systems">Migration from Other Init Systems</a><ul><li><a href="#From_systemd">From systemd</a></li></ul></li><li><a href="#Best_Practices">Best Practices</a><ul><li><a href="#Service_Design_Principles">Service Design Principles</a></li><li><a href="#Security_Considerations">Security Considerations</a></li></ul></li><li><a href="#Monitoring_and_Alerting">Monitoring and Alerting</a><ul><li><a href="#Service_Health_Checks">Service Health Checks</a></li><li><a href="#Automated_Service_Recovery">Automated Service Recovery</a></li></ul></li><li><a href="#Conclusion">Conclusion</a></li></ul></nav></div>
<h2><span id="What_is_runit"></span>What is runit?<span></span></h2>
<p>runit is a Unix init scheme that replaces the traditional SysV init system with a more reliable and simpler approach. It consists of three main stages and provides automatic service supervision, meaning it continuously monitors running services and automatically restarts them if they fail. This makes runit particularly valuable for mission-critical applications where uptime is essential.</p>
<p>The system is designed around the philosophy of “do one thing and do it well,” focusing specifically on process supervision and service management. Unlike systemd or other complex init systems, runit maintains simplicity while providing robust functionality.</p>
<h2><span id="Key_Features_of_runit"></span>Key Features of runit<span></span></h2>
<ul>
<li><strong>Automatic Service Supervision:</strong> Continuously monitors services and restarts failed processes</li>
<li><strong>Simple Configuration:</strong> Uses plain shell scripts for service definitions</li>
<li><strong>Fast Boot Times:</strong> Parallel service startup reduces boot time</li>
<li><strong>Reliable Logging:</strong> Built-in logging mechanism with svlogd</li>
<li><strong>Cross-Platform:</strong> Works on Linux, BSD, and other Unix-like systems</li>
<li><strong>Small Footprint:</strong> Minimal resource usage and dependencies</li>
</ul>
<h2><span id="runit_Architecture"></span>runit Architecture<span></span></h2>
<p>runit operates through three distinct stages:</p>
<h3><span id="Stage_1_System_Initialization"></span>Stage 1: System Initialization<span></span></h3>
<p>This stage handles one-time system initialization tasks such as mounting filesystems, configuring network interfaces, and setting up the basic system environment. It’s equivalent to the traditional /etc/rc.sysinit script.</p>
<h3><span id="Stage_2_Service_Supervision"></span>Stage 2: Service Supervision<span></span></h3>
<p>The core of runit, this stage starts the runsvdir program which supervises all services. It continuously monitors service directories and automatically starts, stops, and restarts services as needed.</p>
<h3><span id="Stage_3_System_Shutdown"></span>Stage 3: System Shutdown<span></span></h3>
<p>Handles graceful system shutdown, including stopping all supervised services, unmounting filesystems, and performing cleanup tasks.</p>
<h2><span id="Installing_runit"></span>Installing runit<span></span></h2>
<p>runit installation varies depending on your Linux distribution:</p>
<h3><span id="UbuntuDebian"></span>Ubuntu/Debian:<span></span></h3>
<pre><code>sudo apt-get update
sudo apt-get install runit</code></pre>
<h3><span id="CentOSRHEL"></span>CentOS/RHEL:<span></span></h3>
<pre><code>sudo yum install runit
# or for newer versions
sudo dnf install runit</code></pre>
<h3><span id="Arch_Linux"></span>Arch Linux:<span></span></h3>
<pre><code>sudo pacman -S runit</code></pre>
<h3><span id="From_Source"></span>From Source:<span></span></h3>
<pre><code>wget http://smarden.org/runit/runit-2.1.2.tar.gz
tar xzf runit-2.1.2.tar.gz
cd runit-2.1.2
package/install</code></pre>
<h2><span id="Basic_runit_Commands"></span>Basic runit Commands<span></span></h2>
<p>runit provides several essential commands for service management:</p>
<h3><span id="sv_%E2%80%93_Service_Control"></span>sv – Service Control<span></span></h3>
<p>The <code>sv</code> command is the primary tool for controlling services:</p>
<pre><code># Start a service
sv start service_name

# Stop a service
sv stop service_name

# Restart a service
sv restart service_name

# Check service status
sv status service_name

# Get service uptime
sv up service_name</code></pre>
<h3><span id="Example_Output"></span>Example Output:<span></span></h3>
<pre><code>$ sv status nginx
run: nginx: (pid 1234) 3600s
$ sv status down_service
down: down_service: 0s, normally up</code></pre>
<h3><span id="runsvdir_%E2%80%93_Service_Directory_Monitor"></span>runsvdir – Service Directory Monitor<span></span></h3>
<p>Monitors service directories and starts runsv for each service:</p>
<pre><code>runsvdir /etc/service</code></pre>
<h3><span id="runsv_%E2%80%93_Single_Service_Supervisor"></span>runsv – Single Service Supervisor<span></span></h3>
<p>Supervises individual services:</p>
<pre><code>runsv /etc/service/nginx</code></pre>
<h2><span id="Creating_runit_Services"></span>Creating runit Services<span></span></h2>
<p>Creating services in runit involves setting up service directories with executable run scripts:</p>
<h3><span id="Basic_Service_Structure"></span>Basic Service Structure<span></span></h3>
<pre><code>/etc/sv/myservice/
├── run          # Main service script (required)
├── finish       # Cleanup script (optional)
├── down         # Prevents auto-start (optional)
└── log/         # Logging service (optional)
    └── run      # Log service script</code></pre>
<h3><span id="Creating_a_Simple_Web_Server_Service"></span>Creating a Simple Web Server Service<span></span></h3>
<p>Let’s create a service for a simple Python HTTP server:</p>
<pre><code># Create service directory
sudo mkdir -p /etc/sv/webserver

# Create the run script
sudo tee /etc/sv/webserver/run &lt;&lt; &#39;EOF&#39;
#!/bin/sh
exec 2&gt;&amp;1
cd /var/www/html
exec python3 -m http.server 8080
EOF

# Make it executable
sudo chmod +x /etc/sv/webserver/run

# Enable the service
sudo ln -s /etc/sv/webserver /etc/service/</code></pre>
<h3><span id="Service_with_Logging"></span>Service with Logging<span></span></h3>
<pre><code># Create log directory
sudo mkdir -p /etc/sv/webserver/log

# Create log run script
sudo tee /etc/sv/webserver/log/run &lt;&lt; &#39;EOF&#39;
#!/bin/sh
exec svlogd -tt /var/log/webserver
EOF

# Make it executable
sudo chmod +x /etc/sv/webserver/log/run

# Create log directory
sudo mkdir -p /var/log/webserver</code></pre>
<h2><span id="Advanced_Service_Configuration"></span>Advanced Service Configuration<span></span></h2>
<h3><span id="Service_with_Environment_Variables"></span>Service with Environment Variables<span></span></h3>
<pre><code># Create environment directory
sudo mkdir -p /etc/sv/myapp/env

# Set environment variables
echo &#34;production&#34; | sudo tee /etc/sv/myapp/env/NODE_ENV
echo &#34;3000&#34; | sudo tee /etc/sv/myapp/env/PORT

# Updated run script
sudo tee /etc/sv/myapp/run &lt;&lt; &#39;EOF&#39;
#!/bin/sh
exec 2&gt;&amp;1
exec chpst -e ./env -u appuser node /opt/myapp/server.js
EOF</code></pre>
<h3><span id="Service_with_User_Privileges"></span>Service with User Privileges<span></span></h3>
<pre><code>sudo tee /etc/sv/database/run &lt;&lt; &#39;EOF&#39;
#!/bin/sh
exec 2&gt;&amp;1
exec chpst -u postgres:postgres /usr/bin/postgres -D /var/lib/postgresql/data
EOF</code></pre>
<h2><span id="Service_Management_Examples"></span>Service Management Examples<span></span></h2>
<h3><span id="Monitoring_Service_Status"></span>Monitoring Service Status<span></span></h3>
<pre><code># Check all services
sudo sv status /etc/service/*

# Example output:
run: apache2: (pid 1456) 7200s
run: nginx: (pid 1234) 3600s
down: mysql: 120s, normally up
run: ssh: (pid 892) 86400s</code></pre>
<h3><span id="Interactive_Service_Control"></span>Interactive Service Control<span></span></h3>
<pre><code># Start multiple services
for service in nginx mysql redis; do
    sv start $service
    echo &#34;Started $service&#34;
done

# Monitor service startup
watch &#39;sv status /etc/service/*&#39;</code></pre>
<h2><span id="Logging_with_svlogd"></span>Logging with svlogd<span></span></h2>
<p>runit includes svlogd, a powerful logging daemon that provides automatic log rotation and filtering:</p>
<h3><span id="Basic_Logging_Configuration"></span>Basic Logging Configuration<span></span></h3>
<pre><code># Log configuration file
sudo tee /var/log/myservice/config &lt;&lt; &#39;EOF&#39;
s1000000  # Maximum log file size (1MB)
n10       # Keep 10 log files
t         # Add timestamps
EOF</code></pre>
<h3><span id="Log_Filtering"></span>Log Filtering<span></span></h3>
<pre><code># Filter logs by pattern
sudo tee /var/log/myservice/config &lt;&lt; &#39;EOF&#39;
+*error*     # Include lines containing &#39;error&#39;
-*debug*     # Exclude lines containing &#39;debug&#39;
s10000000    # 10MB log files
n5           # Keep 5 files
EOF</code></pre>
<h2><span id="Troubleshooting_runit_Services"></span>Troubleshooting runit Services<span></span></h2>
<h3><span id="Common_Issues_and_Solutions"></span>Common Issues and Solutions<span></span></h3>
<h4><span id="Service_Wont_Start"></span>Service Won’t Start<span></span></h4>
<pre><code># Check if run script is executable
ls -la /etc/sv/myservice/run

# Check for syntax errors
sh -n /etc/sv/myservice/run

# Check service logs
sudo tail -f /var/log/myservice/current</code></pre>
<h4><span id="Service_Keeps_Restarting"></span>Service Keeps Restarting<span></span></h4>
<pre><code># Check service status with details
sv status /etc/service/myservice

# Monitor service restarts
while true; do
    sv status /etc/service/myservice
    sleep 1
done</code></pre>
<h3><span id="Debugging_Service_Scripts"></span>Debugging Service Scripts<span></span></h3>
<pre><code># Add debug output to run script
#!/bin/sh
exec 2&gt;&amp;1
echo &#34;Starting service at $(date)&#34;
echo &#34;Environment: $(env)&#34;
echo &#34;User: $(whoami)&#34;
exec /path/to/program</code></pre>
<h2><span id="Performance_and_Resource_Management"></span>Performance and Resource Management<span></span></h2>
<h3><span id="Resource_Limits"></span>Resource Limits<span></span></h3>
<pre><code># Limit memory usage
sudo tee /etc/sv/myapp/run &lt;&lt; &#39;EOF&#39;
#!/bin/sh
exec 2&gt;&amp;1
exec chpst -m 100000000 -u appuser /opt/myapp/bin/myapp
EOF</code></pre>
<h3><span id="CPU_Limits"></span>CPU Limits<span></span></h3>
<pre><code># Nice priority adjustment
exec chpst -n 10 -u appuser /opt/myapp/bin/myapp</code></pre>
<h2><span id="Migration_from_Other_Init_Systems"></span>Migration from Other Init Systems<span></span></h2>
<h3><span id="From_systemd"></span>From systemd<span></span></h3>
<p>Converting a systemd service to runit:</p>
<pre><code># systemd service file
[Unit]
Description=My Web App
After=network.target

[Service]
Type=simple
User=webuser
WorkingDirectory=/opt/webapp
ExecStart=/opt/webapp/bin/server
Restart=always

[Install]
WantedBy=multi-user.target</code></pre>
<p>Equivalent runit service:</p>
<pre><code># /etc/sv/webapp/run
#!/bin/sh
exec 2&gt;&amp;1
cd /opt/webapp
exec chpst -u webuser /opt/webapp/bin/server</code></pre>
<h2><span id="Best_Practices"></span>Best Practices<span></span></h2>
<h3><span id="Service_Design_Principles"></span>Service Design Principles<span></span></h3>
<ul>
<li><strong>Keep run scripts simple:</strong> Avoid complex logic in run scripts</li>
<li><strong>Use exec:</strong> Replace the shell process with your program</li>
<li><strong>Redirect stderr:</strong> Use <code>exec 2&gt;&amp;1</code> to combine output streams</li>
<li><strong>Avoid daemonization:</strong> Run programs in foreground mode</li>
<li><strong>Set working directory:</strong> Use <code>cd</code> before executing programs</li>
</ul>
<h3><span id="Security_Considerations"></span>Security Considerations<span></span></h3>
<pre><code># Run service as non-root user
exec chpst -u serviceuser:servicegroup /path/to/program

# Set environment cleanly
exec chpst -e ./env -u serviceuser /path/to/program

# Limit resources
exec chpst -m 100000000 -o 1000 -u serviceuser /path/to/program</code></pre>
<h2><span id="Monitoring_and_Alerting"></span>Monitoring and Alerting<span></span></h2>
<h3><span id="Service_Health_Checks"></span>Service Health Checks<span></span></h3>
<pre><code>#!/bin/bash
# health_check.sh
for service in $(ls /etc/service/); do
    status=$(sv status &#34;/etc/service/$service&#34; 2&gt;/dev/null)
    if [[ $status == down* ]]; then
        echo &#34;ALERT: $service is down&#34;
        # Send notification
    fi
done</code></pre>
<h3><span id="Automated_Service_Recovery"></span>Automated Service Recovery<span></span></h3>
<pre><code># /etc/sv/myservice/finish
#!/bin/sh
# Cleanup script that runs when service exits
echo &#34;Service $1 exited with code $2 at $(date)&#34; &gt;&gt; /var/log/myservice/finish.log

# Conditional restart logic
if [ &#34;$2&#34; -eq &#34;100&#34; ]; then
    # Exit code 100 means don&#39;t restart
    touch ./down
fi</code></pre>
<h2><span id="Conclusion"></span>Conclusion<span></span></h2>
<p>runit provides a robust, lightweight alternative to complex init systems while maintaining simplicity and reliability. Its service supervision capabilities, combined with straightforward configuration and excellent performance characteristics, make it an excellent choice for various deployment scenarios.</p>
<p>The system’s philosophy of simplicity doesn’t compromise functionality – from basic service management to advanced logging and resource control, runit offers all the tools necessary for effective system administration. Whether you’re managing a single server or a complex distributed system, runit’s reliable service supervision ensures your applications remain available and performant.</p>
<p>By following the practices and examples outlined in this guide, you’ll be well-equipped to implement runit in your infrastructure and take advantage of its powerful service supervision capabilities. The lightweight nature and cross-platform compatibility make it particularly valuable for modern containerized environments and embedded systems where resource efficiency is crucial.</p>
</div></div>
  </body>
</html>
