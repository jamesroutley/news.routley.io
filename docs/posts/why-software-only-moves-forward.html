<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://swizec.com/blog/why-software-only-moves-forward/">Original</a>
    <h1>Why software only moves forward</h1>
    
    <div id="readability-page-1" class="page"><div id="content"><p>At scale there are no rollbacks and no cut-overs. Your software only moves forward.</p>
<p>aside: This email is adapted from a book chapter I spent the last 3 weeks writing. It&#39;s a complex idea that took 10 years to grok. I tried squeezing it into a digestible length. Would love to hear your thoughts.</p>
<img src="https://i.imgur.com/RmkciXk.png" alt="Servers with live traffic during an update"/>
<h2 id="data-lives-forever"><a href="#data-lives-forever"></a><a href="#data-lives-forever">Data lives forever</a></h2>
<p>Data is the biggest reason software only moves forward.</p>
<p>Once you save state, your code will need to understand that state forever. This is double true for state that leaves your system and becomes distributed.</p>
<p>Billing state, emails, and async jobs are a common early introduction to these issues.</p>
<p>When a user gives you money, they expect the transaction to be rock solid. You can&#39;t just lose their payment because you changed an implementation detail and their receipt no longer has a valid ID or a payment method you no longer support.</p>
<p>Plus billing state <em>loves</em> spreading to other systems.</p>
<p>You&#39;ll find finance moving it to spreadsheets and other weird programs, data integrations putting it in warehouses and BI tools, and it&#39;s going out in emails and 3rd party payment processors and their bank and your bank ... billing data gets everywhere. If any of those systems come back and ask for invoice <code>ID12345</code>, you better have an answer.</p>
<p>In most cases, tax and business authorities expect you to keep sale records for at least 5 years. Even if users never look that far back in history, an auditor might.</p>
<h3 id="how-data-only-moves-forward"><a href="#how-data-only-moves-forward"></a><a href="#how-data-only-moves-forward">How data only moves forward</a></h3>
<p>Say you started with two payment methods: stripe and coupons.</p>
<p>You write your database table to support a <code>payment_type</code> field. Code cares about this because the two payment types have different behaviors. They fetch info from different sources, display different UI, etc. Your business folk care about this because they want to know which purchases are revenue (stripe) and which aren&#39;t (coupons).</p>
<p>To keep your data clean and avoid unexpected values, you add a constraint on the database ‚Äì¬†<code>[&#39;stripe&#39;, &#39;coupon&#39;]</code> ‚Äì and types in your code. If anything unexpected shows up, the code throws an error. An error in this case is better than showing garbage payment info to the user.</p>
<p>Later you add cash and credit cards.</p>
<p>The constraint expands to <code>[&#39;stripe&#39;, &#39;coupon&#39;, &#39;credit_card&#39;, &#39;cash&#39;]</code>. You update types in the code and build the new code-paths.</p>
<p>You test your changes and deploy. However, testing payments is hard ‚Äì there&#39;s lots of edge cases and code-paths you can&#39;t replicate in a test environment without using real money. You soon find a bug.</p>
<p>But while your code was deployed, a few users have made purchases with the new payment types. Now you&#39;re stuck.</p>
<p>If you rollback that deploy, those new users who bought with <code>cash</code> or <code>credit_card</code> payments will get an error when they try to use the service they paid for. But that&#39;s okay ‚Äì the database won&#39;t let you rollback a constraint when existing data don&#39;t match.</p>
<p>How do you handle this?</p>
<p>You could delete <code>cash</code> and <code>credit_card</code> rows, but then you lose the payments. You could change them to <code>stripe</code> or <code>coupon</code>, but then you can&#39;t restore this info after you fix the bug ...</p>
<p>Ok so the <em>database</em> can&#39;t be rolled back. Data lives forever.</p>
<p>What about the code? That depends: Are you okay with users getting an error when the code tries to read a database row with a payment method it doesn&#39;t recognize? Maybe you can guarantee users can&#39;t do that by turning off a feature flag.</p>
<p>But then those users might complain when their recent purchase doesn&#39;t work correctly.</p>
<h2 id="distributed-systems--state"><a href="#distributed-systems--state"></a><a href="#distributed-systems--state">Distributed systems + state</a></h2>
<p>This is a classic distributed systems and state problem. You may not think of your code and database as a distributed system, but it is. Here&#39;s a 1 question test:</p>
<p>Can parts of the system (app, database, ...) change independently?</p>
<p>If the answers is yes, your system is distributed. You can independently deploy, update, start, stop, and otherwise manage parts of your system (app and database). Even if both run on the same machine and you almost always update them together.</p>
<p>This brings lots of benefits.</p>
<p>For example: You can update your application code without always upgrading to the latest version of your database service. Or you can reboot your application without losing database functionality that the finance team relies on. And in some cases you can even rollback your code without rolling back the database.</p>
<p>The end version of this approach for big teams is a microservices architecture where¬†every team runs their own flock of independent services that do specific things. Even at a smaller scale you&#39;ll run into at least</p>
<ul>
<li>a caching service,</li>
<li>a database service,</li>
<li>a load balancer,</li>
<li>your core app,</li>
<li>and a few services for async backend tasks</li>
</ul>
<p>Those scheduled jobs behave like services even if all they do is call an API on your core application. Does the API still work when the job triggers in 3 weeks? üòâ</p>
<h2 id="old-and-new-side-by-side-always"><a href="#old-and-new-side-by-side-always"></a><a href="#old-and-new-side-by-side-always">Old and new side-by-side always</a></h2>
<p>The challenge a distributed system brings is that all the parts need to agree on a shared definition of business logic.</p>
<p>If your database is structured one way and your code expects another, the system breaks. If a client calls an API and it doesn&#39;t exist, or your client can&#39;t parse the response, the system breaks.</p>
<p>You won&#39;t notice this while you&#39;re small and have little traffic. You can update database definitions, then update the code. Or update the code and then the database. Nothing bad happens.</p>
<p>But as you scale, that period between updating every part of the system becomes an issue. How long <em>exactly</em> are your database and your code out of sync? What about the clients? How many requests can you get during that time?</p>
<p>This depends on the update and the size of your system.</p>
<p>A large database takes longer to apply updates. An application with a few servers of redundancy takes longer than flipping 1 server. And who knows when end-users will hit the <code>Update</code> button on their client.</p>
<p>At scale, you can assume the system is always running multiple out-of-sync versions of your code. Requests never stop.</p>
<p>Imagine if a barista said <em>&#34;Oh sorry, you ordered coffee right when I was putting in a new stack of coffee cups. Couldn&#39;t hear you&#34;</em>. This happens and we repeat the order. All good. But if they charge you for the coffee, lose your order, then claim you never ordered and make you pay again ... you&#39;ll be pretty upset.</p>
<h3 id="your-updates-take-time-to-propagate"><a href="#your-updates-take-time-to-propagate"></a><a href="#your-updates-take-time-to-propagate">Your updates take time to propagate</a></h3>
<p>The worst update delay I&#39;ve seen was a user hitting our servers with an iOS app 2 years out of date. It broke and we got an alert. Then we crossed our fingers that the user figured out what to do because their client was from before we added the <em>&#34;Hey your app is out of date&#34;</em> popup feature.</p>
<p>Even without end-user clients, a few minutes to propagate updates is typical.</p>
<p>You&#39;ll deploy to 1 server, make sure it&#39;s good, reroute traffic, move on to the next server, until eventually the latest code runs everywhere (this is usually automated). While updates are happening, you have a few servers running old code and a few running new code ‚Äì all accepting live traffic distributed at random.</p>
<img src="https://i.imgur.com/RmkciXk.png" alt="Servers with live traffic during an update"/>
<p>These are known as <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">blue/green deploys</a>, a standard approach in managing distributed systems. Besides ensuring your code at least runs and passes checks before routing traffic, they also ensure there&#39;s no downtime.</p>
<p>When you have traffic and a distributed system, there is no such thing as a cut-over. You&#39;re always running multiple versions of your code.</p>
<h2 id="a-few-tips"><a href="#a-few-tips"></a><a href="#a-few-tips">A few tips</a></h2>
<p>There are no hard rules on how to handle software always moving forward. It depends on your update, the exact nature of your system, and your appetite for errors.</p>
<p>Here are a few rules of thumb I like to use:</p>
<ul>
<li>additive changes are fine</li>
<li>be permissive about your inputs (ignore extras instead of failing)</li>
<li>instead of breaking changes to an API endpoint, make a new one</li>
<li>update the database first</li>
<li>update servers before clients</li>
<li>if possible, have an option to force-update clients</li>
<li>accept all versions of an input and merge data on the back end</li>
<li>deprecate slowly</li>
<li>keep updates small</li>
</ul>
<p>You won&#39;t always need all of these.</p>
<p>Updating the payment system hits different than updating a button color. The key is to ask yourself <em>&#34;How will this break while there&#39;s a version mismatch? How do we keep both old and new clients happy?&#34;</em> then act accordingly.</p>
<p>If you&#39;re still here, thanks ‚ù§Ô∏è this is way long for an email</p>
<p>Cheers,</p><div><p><span>Published on <!-- -->November 1st, 2024<!-- --> <!-- -->in <a href="https://swizec.com/categories/software%20engineering/">Software Engineering</a>, <a href="https://swizec.com/categories/scaling%20fast%20book/">Scaling Fast Book</a></span></p><div><h4>Did you enjoy this article?</h4></div><h4>Continue reading about <!-- -->Why software only moves forward</h4><p>Semantically similar articles hand-picked by GPT-4</p><ul><li><a href="https://swizec.com/blog/you-can-t-stop-the-business-or-why-rewrites-fail/">You can&#39;t stop the business, or why rewrites fail</a></li><li><a href="https://swizec.com/blog/dont-neglect-your-upgrades/">Don&#39;t neglect your upgrades</a></li><li><a href="https://swizec.com/blog/logging-1721410-events-per-day-with-postgres-rails-heroku-and-a-bit-of-javascript/">Logging 1,721,410 events per day with Postgres, Rails, Heroku, and a bit of JavaScript</a></li><li><a href="https://swizec.com/blog/make-mistakes-easy-to-fix/">Make mistakes easy to fix</a></li><li><a href="https://swizec.com/blog/how-big-up-front-design-fails/">How big up-front design fails</a></li></ul><div role="dialog"><h2 id="learned-something-new-read-more-software-engineering-lessons-from-production"><a href="#learned-something-new-read-more-software-engineering-lessons-from-production"></a><a href="#learned-something-new-read-more-software-engineering-lessons-from-production">Learned something new? </a></h2>
<p>I write articles with real insight into the career and skills of a modern software engineer. <strong><em>&#34;Raw and honest from the heart!&#34;</em></strong> as one reader described them. Fueled by <strong>lessons learned over 20 years</strong> of building <strong>production code</strong> for side-projects, small businesses, and hyper growth startups. Both successful and not.</p>
<p>Subscribe below üëá</p><div><div><h3 id="software-engineering-lessons-from-production"><a href="#software-engineering-lessons-from-production"></a><a href="#software-engineering-lessons-from-production">Software Engineering Lessons from Production</a></h3>
<p>Join Swizec&#39;s Newsletter and get insightful emails üíå on <strong>mindsets</strong>, <strong>tactics</strong>, and <strong>technical skills</strong> for your career. Real lessons from building production software. No bullshit.</p>
<div><blockquote><p>&#34;Man, love your simple writing! Yours is the only newsletter I open and only blog that I give a fuck to read &amp; scroll
till the end. And wow always take away lessons with me.
Inspiring! And very relatable. üëå&#34;</p><p>~ <a href="https://twitter.com/ashfame/status/1286756578226405376">Ashish Kumar</a></p></blockquote></div></div></div></div><section><div><a href="https://swizec.com/senior-mindset/"><div data-gatsby-image-wrapper=""><p><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg%20height=&#39;2048&#39;%20width=&#39;2048&#39;%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20version=&#39;1.1&#39;%3E%3C/svg%3E"/></p><picture><source type="image/webp" data-srcset="/static/49b03d61b7348ccaa62e58389b04f057/d689f/SeniorMindset-cover-3d.webp 512w,/static/49b03d61b7348ccaa62e58389b04f057/67ded/SeniorMindset-cover-3d.webp 1024w,/static/49b03d61b7348ccaa62e58389b04f057/24224/SeniorMindset-cover-3d.webp 2048w" sizes="(min-width: 2048px) 2048px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" sizes="(min-width: 2048px) 2048px, 100vw" decoding="async" loading="lazy" data-src="/static/49b03d61b7348ccaa62e58389b04f057/d0275/SeniorMindset-cover-3d.png" data-srcset="/static/49b03d61b7348ccaa62e58389b04f057/ccc41/SeniorMindset-cover-3d.png 512w,/static/49b03d61b7348ccaa62e58389b04f057/b5658/SeniorMindset-cover-3d.png 1024w,/static/49b03d61b7348ccaa62e58389b04f057/d0275/SeniorMindset-cover-3d.png 2048w" alt="Senior Engineer Mindset cover"/></picture></div></a></div><div><h3>Senior Mindset Book</h3><p>Get promoted, earn a bigger salary, work for top companies</p><p><a href="https://swizec.com/senior-mindset/">Learn more</a></p></div></section>
<p><strong>Have a burning question that you think I can answer?</strong> Hit me up on <a href="https://twitter.com/swizec">twitter</a> and I&#39;ll do my best.</p>
<p><strong>Who am I and who do I help?</strong> I&#39;m Swizec Teller and I turn coders into engineers with <em>&#34;Raw and honest from the heart!&#34;</em> writing. No bullshit. Real insights into the career and skills of a modern software engineer.</p>
<p><strong>Want to become a <em>true</em> senior engineer?</strong> Take ownership, have autonomy, and be a force multiplier on your team. The Senior Engineer Mindset ebook can help üëâ <a href="https://swizec.com/senior-mindset">swizec.com/senior-mindset</a>. These are the shifts in mindset that unlocked my career.</p>
<p><strong>Curious about Serverless and the modern backend?</strong> Check out Serverless Handbook, for frontend engineers üëâ
<a href="https://serverlesshandbook.dev">ServerlessHandbook.dev</a></p>
<p><strong>Want to Stop copy pasting D3 examples and create data visualizations of your own?</strong> Learn how to build scalable dataviz React components your whole team can understand
with <a href="https://reactfordataviz.com">React for Data Visualization</a></p>
<p><strong>Want to get my best emails on JavaScript, React, Serverless, Fullstack Web, or Indie Hacking?</strong> Check out <a href="https://swizec.com/collections">swizec.com/collections</a></p>
<p><strong>Did someone amazing share this letter with you?</strong> Wonderful! You can sign up for my weekly letters for software engineers on their path to greatness, here: <a href="https://swizec.com/blog">swizec.com/blog</a></p>
<p><strong>Want to brush up on your modern JavaScript syntax?</strong> Check out my interactive cheatsheet: <a href="https://es6cheatsheet.com">es6cheatsheet.com</a></p>
<p><strong>By the way, just in case no one has told you it yet today: I love and appreciate you for who you are ‚ù§Ô∏è</strong></p></div></div></div>
  </body>
</html>
