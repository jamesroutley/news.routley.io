<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cceckman.com/writing/pact-keeper/">Original</a>
    <h1>Orb of the Pact Keeper</h1>
    
    <div id="readability-page-1" class="page"><div>
<blockquote>
<p>If you just want to see the finished product, <a href="#somatic-components">skip down</a>.</p>
</blockquote>
<p>Happy Halloween!</p>
<p>This week, my D&amp;D group had a special one-shot; given the occasion, we were asked to come in costume. I started with just two costume pieces for my character, T’paa:<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> an old cloak I had from a theatre production, and 3D-printed <a href="https://www.thingiverse.com/thing:28405" rel="external" target="_blank">chain-link circlet</a>.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/0-costume.webp"/>
</figure>
<p>That didn’t seem quite enough, so I reviewed my resources. I found:</p>
<ul>
<li>A <a href="https://learn.adafruit.com/introducing-circuit-playground/overview" rel="external" target="_blank">Circuit Playground</a> board, acquired as a gift from <a href="https://www.scannedinavian.com/" rel="external" target="_blank">Shae</a> (thanks!)</li>
<li>A 350mAh LiPo battery, acquired as a spare for an as-yet-unstarted project</li>
<li>Proficiency<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup> in <a href="https://openscad.org/" rel="external" target="_blank">OpenSCAD</a>, acquired while making the second generation of <a href="https://cceckman.com/writing/keyboard-holders-gen1">keyboard holders</a></li>
</ul>
<p>So I decided to make T’paa an arcane focus. This article is “the story”; all the software and 3D design I have done for this project are in the public domain, and are available at <a href="https://cceckman.com/r/tpaa" rel="external" target="_blank">https://cceckman.com/r/tpaa</a>.</p>
<h2 id="material-components">Material components</h2>
<p>In D&amp;D, a spellcaster can use an arcane focus in place of material components when casting a spell. A wizard’s staff or wand is the typical example, but an orb (e.g. crystal ball) or rod (favored by Harry Dresden) are also options. I pondered a bit; then went with an orb</p>
<h3 id="size-tiny">Size: Tiny</h3>
<p>All the buttons, LEDs, and connectors are on one side of the Circuit Playground’s PCB. I figured I’d put the board centrally in the orb, and shine the LEDs through the upper half.
The first version of the design came together pretty quickly.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/lower-p1.webp"/>
</figure>
<p>The lower hemisphere had a hole for the battery, a channel for the battery cable, and a pin for each hole on the Circuit Playground. The pin has a “standoff” section, larger than the hole, and a higher “pin” section to pass through the hole; the standoff section supports the PCB slightly above the hemisphere’s “floor”.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/upper-p1.webp"/>
</figure>
<p>I divided the upper hemisphere in two, down the center line. My thought was that each hemidemisphere could flex or rotate inward slightly to activate the buttons on the Circuit Playground. I included a cut-out for the JST socket on the Circuit Playground, which I found was the highest point; this let me keep the “roof” of the electronics compartment low, closer to the buttons.</p>
<p>Both hemispheres had a solid main body with an additional “lip”, to form the electronics compartment. The lips have a total of eight small notches in them, to allow magnet wire to pass through. Finally, each hemisphere has a few square holes in it, forming two squares that transit the equator. These allow the hemispheres to clip together…</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/clips-p1.webp"/>
</figure>
<p>…via two button-like clips that press in at opposite ends. I parameterized the design for either two or four of these clips, but only printed with two.</p>
<h3 id="uncommon-1">Uncommon (+1)</h3>
<p>To the library! I sliced the model, loaded the gcode, and set a 3d printer running.<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup> The print went smoothly, but the aftermath was less pleasant.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/gunk.webp"/>
</figure>
<p>I had sliced the design with each sphere “round side up”, i.e. with the printer bed at the equator. I had set the slicer to use grid supports, so the cavity of each hemisphere had a lot of material to remove. And I had to be pretty careful – the lower hemisphere ’s fill was interspersed with the pins/standoffs. Still, I managed to get the parts cleaned off…</p>
<p>…only to find they wouldn’t fit the electronics.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/2-p1-fit-fail.webp"/>
</figure>
<p>The largest problem was fitting the Circuit Playground. I thought I had used the hole-to-hole spacing from the Circuit Playground datasheet. However, I had just guessed at the angle of the several holes. It seems both the distance and dimension were wrong – the Circuit Playground simply would not fit on the pins.</p>
<p>While I was cleaning off the hemispheres, I found a nice gold-metallic filament for the clips, and set it running. When they came off the printer, I found the hemispheres did clip together well:<sup id="fnref:4"><a href="#fn:4" role="doc-noteref">4</a></sup></p>
<figure><img src="https://cceckman.com/writing/pact-keeper/1-p1.webp"/>
</figure>
<p>I had been careful with adding tolerance to the clip holes. I wanted the holes for the clip’s pins to be slightly larger than the pins themselves, but only on the “outside”, away from the axis that runs through the clips. That way, the clips could flex out slightly, but would provide a little tension/friction to hold them all together. And it worked!</p>
<p>I had <em>not</em> added tolerance to the battery compartment, though, so inserting the battery was a bit of a squeeze. And, the split of the upper hemisphere was not very effective: the halves could “wobble”, but I realized without a more careful lip / standoff design they wouldn’t contact the Circuit Playground’s buttons.</p>
<h2 id="rare-2">Rare (+2)</h2>
<p>I had just enough time to do a second run of the hemispheres, with a slightly revised design.</p>
<p>To fix the pins, I realized I didn’t need a pin for each hole in the Circuit Playground. I could put a pin through the leftmost and rightmost holes, and have a couple just-standoffs to keep the Circuit Playground from rotating.<sup id="fnref:5"><a href="#fn:5" role="doc-noteref">5</a></sup> In this case, “a couple” <a href="https://xkcd.com/1070/" rel="external" target="_blank">means three</a>: one under the USB connector, and two near the JST connector, next to the battery-cable channel.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/lower-p2.webp"/>
</figure>
<p>I pulled out my trusty calipers: 0.125&#34; for the holes, 1.950&#34; for the distance between the holes’ outer edges, so a center-to-center distance of 1.825&#34;. I added some <a href="https://en.wikipedia.org/wiki/Ease_%28sewing%29" rel="external" target="_blank"><del>ease</del></a> tolerance to the battery compartment, and joined the upper hemidemispheres into one hemisphere.</p>
<p>Finally, when I sliced the new models, I switched the orientation to put the equator up, and turned on “organic supports.” My hope was that this would make the supports easier to remove. I didn’t re-print the clips: I hadn’t changed any of the relevant parameters, I liked the ones I had.</p>
<p>The second-revision hemispheres fit great! The Circuit Playground fit perfectly onto the pins and standoffs, and the battery dropped easily into its compartment. The battery-wire channel turned out to be unnecessary: the battery’s wire <em>had to</em> run in the space made by the standoffs in order to make the distance. But there was just enough space for it to make it to the JST connector.</p>
<p>I had set the upper hemisphere to fill to use the “lightning” pattern, to avoid the LEDs needing to shine through extra material. It worked pretty well!</p>
<p>It was at this point – after about four hours of print time – that I realized the resemblance to a PokéBall. Oops!</p>
<h3 id="concentration">Concentration</h3>
<p>Most of the “organic supports” were easy to remove with a knife. But there was a lot of material left near the extremum of each hemisphere – the result was a little flatter than I wanted it. I had expected this, and planned on running over it with some sandpaper to smooth out the shape.</p>
<p>That was, it turns out, not a great plan.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/3-p2-sanded.webp"/>
</figure>
<p>I started with a coarse (80 grit) sandpaper. With that, I promptly broke off <em>sections of filament</em> from the top of the sphere, leaving a scar that no amount of sanding could truly address.</p>
<p>A 120-grit sandpaper, and more careful directional control (slightly diagonal to the grain), got more of the effect I wanted. That, and more patience.</p>
<p>Within the time I was willing to spend on it, I wasn’t entirely able to get the top hemisphere to be <em>spherical</em>. I’m not entirely dissatisfied with the uneven finish, but it’s not really what I’d intended or envisioned.</p>
<h2 id="very-rare-3">Very Rare (+3)</h2>
<p>I had just enough time to do another print run and fix a few of the previous issues.</p>
<p>Inverting the spheres had been a bad move; though cleaning out the supports in the first revision was annoying, it’s fine to leave the inner surfaces a little poorly-finished or scuffed. Smoothing out the spheres is a lot harder.</p>
<p>In the third attempt, I took a third approach. I split the sphere into three parts: upper and lower hemispheres, and a central electronics compartment. Each had a flat surface, so they could print flat on the bed.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/4-p3-separate.webp"/>
</figure>
<p>I tidied up the electronics compartment. I got rid of the misplaced channel for the battery cable, and instead made the battery compartment half-depth; this was enough space for the cable to sneak out and connect to the JST plug.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/5-p3-assembly.webp"/>
</figure>
<p>I also changed the shape of the clips to arcs, to get rid of the PokéBall resemblance.</p>
<figure><img src="https://cceckman.com/writing/pact-keeper/5-p3-assembled.webp"/>
</figure>
<p>The clip design still needs some revision; it does not hold the parts together as well as “button” clips. I tried to address this by gluing the lower section to the electronics compartment… and then dropped the whole thing, breaking the glue bond, just as I was leaving for my session.</p>
<h2 id="a-more-magichttpwwwcatborgjargonhtmlmagic-storyhtml-item">A <a href="http://www.catb.org/jargon/html/magic-story.html" rel="external" target="_blank">more magic</a> item</h2>
<p>As a prop, sure, an orb is fine. But this is a <strong>magic item</strong>: it has to light up. Luckily, I’ve been blinking Arduino LEDs <a href="https://www.youtube.com/watch?v=dFUlAQZB9Ng" rel="external" target="_blank">since I was Lexi’s age</a>; though it turns out I had a lot of Arduino conventions to review!</p>
<h3 id="range-touch">Range: Touch</h3>
<p>The Circuit Playground <a href="https://github.com/adafruit/Adafruit_CircuitPlayground/tree/master/examples/" rel="external" target="_blank">examples</a> include one <a href="https://github.com/adafruit/Adafruit_CircuitPlayground/blob/a6708e5a32bb63713add2aba2d494e20dac89a28/examples/mega_demo/CapTouchDemo.h#L10" rel="external" target="_blank">using the GPIO pins as capacitive sensors</a>. That is, the pads around the edge act like a touch sensors, and can be used as buttons.</p>
<p>I liked this idea a lot! I lined up the eight pads with eight of the LEDs, and created an accumulator for each. Touching the pad would quickly “charge up” the corresponding LED, and leaving the pad untouched would slowly “drain” the LED. I figured I could use a “fully charged” LED to trigger a spell.<sup id="fnref:6"><a href="#fn:6" role="doc-noteref">6</a></sup></p>
<p>What does “trigger a spell” do? Well, the onboard speaker <a href="https://github.com/adafruit/Adafruit_CircuitPlayground/blob/a6708e5a32bb63713add2aba2d494e20dac89a28/examples/Hello_CircuitPlayground/Hello_Speaker/Hello_Speaker.ino" rel="external" target="_blank">can play a square wave</a>; I could have a melody for each spell. Data-structure wise, this is pretty simple: the spellbook is an array of such melodies, each melody being an array of tuples of <code>(pitch, duration)</code>. Or going in the other direction, <em>tones</em> compose <em>tunes</em> in the <em>tome</em>.</p>
<p>I didn’t fully wire together the “charged LED” and “spell tune” halves of the code. Instead, as a prototype, I used the Circuit Playground’s slide switch to select one of two spells, and a button to activate the spell. The <em>eldritch blast</em> tune is just a few low-pitch pulses, evoking the multiple bursts of force the spell produces. The other tune, many folks my age will <em>find familiar</em>.</p>
<h3 id="somatic-components">Somatic components</h3>
<p>I liked the LED effects in the prototype, but as the physical design progressed, I realized:</p>
<ol>
<li>the buttons would not be usable while the focus is assembled</li>
<li>the GPIO pins would need additional circuitry to bridge to the outside</li>
</ol>
<p>I wasn’t going to be able to do anything about (1) without more design time than I had. I figured I could address (2) by running magnet wire to the outside surface of the sphere, extending the button’s capacitive “domain” to something I could touch. But I couldn’t find any magnet wire in brick-and-mortar distance, and I able to get the wire <em>and</em> hook it up <em>and</em> reprogram before my session.<sup id="fnref:7"><a href="#fn:7" role="doc-noteref">7</a></sup> What other inputs could I use?</p>
<p>The Circuit Playground has an <a href="https://github.com/adafruit/Adafruit_CircuitPlayground/blob/a6708e5a32bb63713add2aba2d494e20dac89a28/examples/Hello_CircuitPlayground/Hello_Accelerometer/Hello_Accelerometer.ino" rel="external" target="_blank">accelerometer</a>! I wrote some code to classify the orientation into one of six orthogonal vectors (up, down, left, right, forward, backward), and a little bit more code to keep a history of the last few orientations.</p>
<p>The “up” (default) or “in between” orientations, I assigned an idle animation: blue and green LED channels gradually fading in/out.<sup id="fnref:8"><a href="#fn:8" role="doc-noteref">8</a></sup></p>
<figure><video preload="metadata" controls="" muted="">
    <source src="/writing/pact-keeper/arcane-focus-idle.med.mp4" type="video/mp4"/>

    <source src="/writing/pact-keeper/arcane-focus-idle.med.webm" type="video/webm"/>

Your browser does not support the video element.
  </video><figcaption>Relax. Nothing bad is going to happen. I don&#39;t even know Explosive Runes.</figcaption>
</figure>
<p>I also assigned each school of magic an “incantation,” a sequence of positions that would activate it. Each incantation terminates with “forward”, the position in which the Circuit Playground’s LEDs face away from me… and towards my fellow players. Each school also got its own color / LED effect, and its own tune.<sup id="fnref:9"><a href="#fn:9" role="doc-noteref">9</a></sup></p>
<figure><video preload="metadata" controls="">
    <source src="/writing/pact-keeper/arcane-focus-somatic.med.mp4" type="video/mp4"/>

    <source src="/writing/pact-keeper/arcane-focus-somatic.med.webm" type="video/webm"/>

Your browser does not support the video element.
  </video><figcaption>Audio contains noise as well as music. Sorry-- my cat was playing with some fabric.</figcaption>
</figure>
<h2 id="legendary">Legendary?</h2>
<p>What’s next?</p>
<p>Well, this is probably going to sit on a shelf until next Halloween. I might try to add the magnet wire as a third control mechanism.<sup id="fnref:10"><a href="#fn:10" role="doc-noteref">10</a></sup> The model, especially the clips, could be cleaned up. But I’m probably just going to leave this on a shelf until next year.</p>
<p>This whole project is <em>quite similar</em> to the one that I originally got the batteries for, which makes me optimistic that I can knock that out soon. Stay tuned!</p>
<p>If you want to make one of these, or have advice for the next revision, drop me a line!</p>


<div role="doc-endnotes">
<hr/>
<ol>
<li id="fn:1">
<p>PHP programmers may know T’paa by his given name: <a href="http://www.phpsadness.com/sad/1" rel="external" target="_blank">T’paamayim Nekudotayim</a>. However, T’paa is an anti-changeling, a human stolen from his crib by the fey; at birth, he was given the name <a href="https://hachyderm.io/@cceckman/114773770804063678" rel="external" target="_blank">Jason Parsontaxer</a>. <a href="#fnref:1" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:2">
<p>Well, maybe half proficiency; I’m a bit of a Jack-of-all-Trades. <a href="#fnref:2" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:3">
<p>For the curious: I used Prusa Slicer to slice the model, and the library’s Prusa MK3S+ printers. I’ve used a couple of other models of printer at the same library, and the Prusae are definitely the easiest to work with: no tricky re-calibration, no real need to monitor. I have no commerical or investment relation with Prusa. <a href="#fnref:3" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:4">
<p>I was not as thorough about cleaning off the support material for the ends of the clips, so their print lines are very visible. I rather like the effect in this case: it looks intentional, an inscrutable sigil. <a href="#fnref:4" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:5">
<p>“But you only need three points to define a plane!” the geometer argues. <a href="http://johnsalvatier.org/blog/2017/reality-has-a-surprising-amount-of-detail" rel="external" target="_blank">In the real world</a> a standoff only counts as “half a point”: it provides a minimum height of a point but not a maximum. Concretely, if I had pins through the two lateral holes – along the PCB’s center of mass – and one standoff, the PCB could still rotate away from the standoff. <a href="#fnref:5" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:6">
<p>I forgot to take a video when I had the code in this state, and the board is not happy taking uploads at time of writing. I may post one here later! <a href="#fnref:6" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:7">
<p>I did order some magnet wire, and I left holes in the +3 design to run it out to the exterior. So I may yet add it! <a href="#fnref:7" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:8">
<p>At this point in his story, T’paa’s patron is Mab, the Queen of Air and Darkness– so by default I’m sticking with winter (blue) and fey (green) colors. <a href="#fnref:8" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:9">
<p>The Evocation school’s tune is just a very low frequency burst. As for the others – ten Internet points to whoever can name all of them. No cheating! <a href="#fnref:9" role="doc-backlink">↩︎</a></p>
</li>
<li id="fn:10">
<p>The buttons act as a “select” and “trigger” for the spells. This was very helpful when adding the tunes; as you can see, the gestures take a few seconds to run through! <a href="#fnref:10" role="doc-backlink">↩︎</a></p>
</li>
</ol>
</div>

</div></div>
  </body>
</html>
