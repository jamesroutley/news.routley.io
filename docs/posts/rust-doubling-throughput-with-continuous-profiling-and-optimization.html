<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.polarsignals.com/blog/posts/2025/02/11/doubling-throughput-with-continuous-profiling-and-optimization">Original</a>
    <h1>Rust: Doubling Throughput with Continuous Profiling and Optimization</h1>
    
    <div id="readability-page-1" class="page"><div><article><p><strong>Overview</strong></p><p><a href="https://s2.dev/">S2</a> is a serverless API designed for streaming data with a mission to make streams a cloud storage primitive. As a data-intensive cloud infrastructure, S2 sought ways to optimize performance and efficiently manage system bottlenecks. By leveraging Polar Signals Cloud, S2 was able to implement continuous profiling, leading to significant performance improvements and cost savings.</p><p><strong>Challenge</strong></p><p>S2 needed a solution to identify optimization opportunities during load testing and gain deeper insights into system bottlenecks under normal operations. The inefficiencies in CPU usage directly impacted the number of users S2 could serve and their operational costs. Without an efficient profiling tool, troubleshooting and optimizing performance became cumbersome and time-consuming.</p><p><strong>Solution</strong></p><p>Polar Signals Cloud provided S2 with continuous profiling capabilities, allowing the team to easily analyze performance data rather than relying on ad hoc tools like perf. Key features that stood out during the selection process included:</p><ul><li><strong>pprof.me</strong>: An immutable long-term snapshot for profiling.</li><li><strong>Inverting call stacks</strong>: A powerful feature to pinpoint the cumulative impact of specific functions.</li></ul><p>With these capabilities, S2 was able to identify and implement optimizations that significantly improved system efficiency.</p><p><strong>Why Polar Signals</strong></p><p>Polar Signals Cloud stood out due to its ability to provide continuous profiling with intuitive slicing and dicing of data. The flexibility in pricing also played a crucial role in addressing S2&#39;s unique challenges, as resource usage was influenced not just by CPU cores but also by code deployment frequency.</p><p><strong>Results</strong></p><p>By utilizing Polar Signals Cloud, S2 achieved measurable performance improvements, including:</p><ul><li><strong>CPU Optimization</strong>: During load testing, S2 discovered that computing SHA256 checksums consumed 68.37% of CPU when writing to three S3 Express directory buckets for regional durability. A one-line code change enabled hardware acceleration on Graviton via the sha2 library, reducing CPU usage to 31.82%. This change effectively doubled throughput without increasing compute costs.</li></ul><blockquote><em>“ 68.37% of CPU was spent computing these checksums. With a one-line code change to enable hardware-acceleration on Graviton via the sha2 library, this went down to 31.82%. This improvement allows us to push at least 2x more throughput from these processes without increasing our compute spend.” - Shikhar, CEO of S2</em></blockquote><div><p><span><img alt="Screenshot of the Cargo.toml change." src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p><p><span>Screenshot of the Cargo.toml change.</span></p></div><p><em>Before</em></p><div><p><span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p></div><p><em>After</em></p><div><p><span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p></div><ul><li><strong>Checksum Processing Efficiency</strong>: The AWS S3 Rust SDK was found to be unnecessarily recomputing CRC32C checksums. Identifying this issue led to the implementation of a simple workaround, further improving efficiency.</li><li><strong>Memory Allocation Improvements</strong>: Profiling also highlighted excessive CPU time spent in reallocating memory, which was resolved by reserving memory upfront.</li></ul><div><p><span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill"/></span></p></div><p>By implementing these optimizations, S2 was able to enhance system performance, reduce operational costs, and improve overall efficiency. The insights provided by Polar Signals Cloud were instrumental in achieving these outcomes.</p></article></div></div>
  </body>
</html>
