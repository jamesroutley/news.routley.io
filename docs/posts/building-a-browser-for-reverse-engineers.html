<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nullpt.rs/reverse-engineering-browser">Original</a>
    <h1>Building a Browser for Reverse Engineers</h1>
    
    <div id="readability-page-1" class="page"><div><p><span>I&#39;m Building a Browser for Reverse Engineers</span></p><p><time datetime="2025-10-06T00:00:00.000Z">Mon Oct 06 2025</time><small>authored by<!-- --> <a href="https://nullpt.rs/author/veritas" data-discover="true">veritas</a></small></p><h2 id="preamble">Preamble</h2>
<p>In the expanding world of AI my heart still lies in AST transforms, browser fingerprinting, and anti-bot circumvention. In fact, that&#39;s the majority of this blog&#39;s content. But my workflow always felt... primitive. I was still manually sifting through page scripts, pasting suspicious snippets into an editor, and writing bespoke deobfuscators by hand. Tools like Webcrack and deobfuscate.io help, but the end-to-end loop still felt slow and manual. I wanted to build a tool that would be my web reverse-engineering Swiss Army knife</p>
<p>If you&#39;re just curious about what it looks like and don&#39;t care about how it works then here&#39;s a quick showcase:</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/showcase-without-audio.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video></figure>
<h2 id="humble-beginnings">Humble Beginnings</h2>
<p>My first idea was simple: make a browser extension. For an MVP I wanted to hook an arbitrary function like <code>Array.prototype.push</code> as early as possible and log every call to it.</p>
<h2 id="hooking-functions-in-javascript">Hooking functions in JavaScript</h2>
<p>In JavaScript, it&#39;s trivial to hook into and override existing functions because you can reassign references at runtime. A common pattern is to stash the original function, replace it with a wrapper that does whatever instrumentation you want, and then call the original so the page keeps behaving normally:</p>
<pre><code><span>const</span> _origPush <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>;</span>
<span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span> <span>=</span> <span>function</span> <span>(</span><span><span>...</span>args</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;Array.push called on&#39;</span><span>,</span> <span>this</span><span>,</span> <span>&#39;with&#39;</span><span>,</span> args<span>)</span><span>;</span>
  <span>return</span> _origPush<span>.</span><span>apply</span><span>(</span><span>this</span><span>,</span> args<span>)</span><span>;</span>
<span>}</span><span>;</span>
</code></pre>
<p>Here&#39;s what that looks like in Chrome&#39;s devtools:</p>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/array-push-hook-demo.png" alt="Hooking Array.prototype.push inside the Chrome Devtools" layout="responsive" loading="lazy" width="100" height="100"/><figcaption>Hooking Array.prototype.push inside the Chrome Devtools</figcaption></figure>
<p>This technique should make it pretty straightforward to build a Chrome extension that hooks arbitrary global functions on page load and surfaces calls in a small UI.</p>
<h2 id="content-scripts">Content Scripts</h2>
<p>Chrome&#39;s content scripts are files that run in the context of web pages, which we can use to install our hooks early.</p>
<p>The idea is simple, we create a content script that runs at document_start that injects a tiny bit of code that replaces <code>Array.prototype.push</code> with a wrapper that logs and then calls the original.</p>
<pre><code><span>{</span>
 <span>&#34;name&#34;</span><span>:</span> <span>&#34;My extension&#34;</span><span>,</span>
 <span>&#34;content_scripts&#34;</span><span>:</span> <span>[</span>
   <span>{</span>
     <span>&#34;run_at&#34;</span><span>:</span> <span>&#34;document_start&#34;</span><span>,</span> 
     <span>&#34;matches&#34;</span><span>:</span> <span>[</span><span>&#34;&lt;all_urls&gt;&#34;</span><span>]</span><span>,</span>
     <span>&#34;js&#34;</span><span>:</span> <span>[</span><span>&#34;content-script.js&#34;</span><span>]</span>
   <span>}</span>
 <span>]</span>
<span>}</span>
</code></pre>
<pre><code><span>const</span> _origPush <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>;</span>
<span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span> <span>=</span> <span>function</span> <span>(</span><span><span>...</span>args</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;Array.push called on&#39;</span><span>,</span> <span>this</span><span>,</span> <span>&#39;with&#39;</span><span>,</span> args<span>)</span><span>;</span>
  <span>return</span> _origPush<span>.</span><span>apply</span><span>(</span><span>this</span><span>,</span> args<span>)</span><span>;</span>
<span>}</span><span>;</span>
</code></pre>
<p>Running this on a page that clearly used Array.push gave me... absolutely nothing. At first, I thought it had to be an execution order issue. Maybe my hook was loading too late? But after another read through the docs, I found this painfully obvious note staring me right in the face:</p>
<p><strong>“Content scripts live in an isolated world, allowing a content script to make changes to its JavaScript environment without conflicting with the page or other extensions’ content scripts.”</strong></p>
<p>In hindsight, of course that makes sense. Still, it sucked. I wasn’t ready to give up yet, though. I had a potentially clever workaround: injecting a <code>&lt;script&gt;</code> tag directly into the page with my hook inside. But, naturally, it could never be that easy.</p>
<p>I knew if I wanted to get this done, I would have to go down a layer.</p>
<blockquote>
<p><strong>Editor&#39;s Note</strong>: Some readers have kindly pointed out to me that this <em>is</em> actually possible to accomplish from an extension. However, the custom browser approach still has benefits explained later in the post :-)</p>
</blockquote>

<p>The Chrome DevTools Protocol (CDP) is the low-level bridge for instrumenting, inspecting, and debugging Chromium-based browsers. It’s what automation tools like Selenium and Playwright use under the hood. CDP exposes a large set of methods and events split across domains. The docs publish a convenient, <a href="https://chromedevtools.github.io/devtools-protocol/">comprehensive list</a> of them.</p>
<p>While reading the domains, one method jumped out: <code>Page.addScriptToEvaluateOnNewDocument</code>. Its description &#34;Evaluates given script in every frame upon creation (before loading frame&#39;s scripts)&#34; sounded like exactly the hook we needed: run code before the page’s own scripts so we can win the prototype race.</p>
<p>To prove the idea I built a tiny test: a page with a script that pushes a secret value into an array, and a CDP-injected hook that tries to observe that push. If the hook sees the secret, the technique works. I chose to prototype this using Electron. I could have spoken directly to the browser over raw CDP, but Electron made wiring up a UI, IPC, and a quick demo app way faster for a weekend PoC.</p>
<pre><code><span>const</span> <span>{</span> app<span>,</span> <span>BrowserWindow</span> <span>}</span> <span>=</span> <span>require</span><span>(</span><span>&#34;electron/main&#34;</span><span>)</span><span>;</span>

<span>function</span> <span>createWindow</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> win <span>=</span> <span>new</span> <span>BrowserWindow</span><span>(</span><span>{</span>
    <span>width</span><span>:</span> <span>800</span><span>,</span>
    <span>height</span><span>:</span> <span>600</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>const</span> dbg <span>=</span> win<span>.</span><span>webContents</span><span>.</span><span>debugger</span><span>;</span>
  dbg<span>.</span><span>attach</span><span>(</span><span>&#34;1.3&#34;</span><span>)</span><span>;</span>
  
  dbg<span>.</span><span>sendCommand</span><span>(</span><span>&#34;Page.enable&#34;</span><span>)</span><span>;</span>
  dbg<span>.</span><span>sendCommand</span><span>(</span><span>&#34;Page.addScriptToEvaluateOnNewDocument&#34;</span><span>,</span> <span>{</span>
    <span>source</span><span>:</span> <span><span>`</span><span>(() =&gt; {
        const _origPush = Array.prototype.push;
        Array.prototype.push = function (...args) {
            console.log(&#39;Array.push called on&#39;, this, &#39;with&#39;, args);
            return _origPush.apply(this, args);
        };
})();</span><span>`</span></span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  win<span>.</span><span>webContents</span><span>.</span><span>openDevTools</span><span>(</span><span>)</span><span>;</span>
  win<span>.</span><span>loadURL</span><span>(</span><span>&#34;file:///Users/veritas/demo/index.html&#34;</span><span>)</span><span>;</span>
<span>}</span>

app<span>.</span><span>whenReady</span><span>(</span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>createWindow</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre>
<p>The result?:</p>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/basic-cdp-test.png" alt="We can see a value being pushed to an array in the console" layout="responsive" loading="lazy" width="100" height="100"/><figcaption>We can see a value being pushed to an array in the console</figcaption></figure>
<p>It worked! I knew this PoC could take me far. I could hook any arbitrary global function or property and log (or spoof!) arguments and return values. The next step was building a user interface around it.</p>
<p>Since this started as a fun weekend project, I wanted the fastest path to a working demo. In true open-source fashion I searched for “electron web browser” and stumbled across <a href="https://github.com/samuelmaddock/electron-browser-shell">electron-browser-shell</a> by Samuel Maddock.</p>
<p>That project gave me an address bar, tabs, and a basic IPC-ready shell bridging the webview environment and my browser UI.</p>
<p>From there I added a sidebar that would display hooked function events as they fired.</p>
<p>To make things more interesting I needed to hook more than Array.push. A favorite target of fingerprinting scripts is the Canvas API. Sites can draw a static image to a <code>&lt;canvas&gt;</code>, call <code>toDataURL()</code> (or read pixel data), and use the resulting hash to fingerprint your GPU using subtle rendering differences. By correlating canvas hashes with other signals (user agent, installed fonts, etc.), trackers can build a surprisingly robust fingerprint. Watching and optionally spoofing these kind of calls is extremely useful for this kind of RE work.</p>
<p>The result looked as follows:</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/initial-hooks.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video><figcaption>Functions calls appearing in our sidebar after hooks have been fired</figcaption></figure>
<p>I was pretty happy with the direction the project was taking. The PoC actually felt useful. Remembering my previous work reverse-engineering TikTok’s web collector and how aggressively those collectors scrape client-side signals, I couldn’t resist testing the hook there. I fired up the demo, pointed it at TikTok, and watched the UI for activity.</p>
<p>The site was pulling a decent amount of telemetry. Canvas calls (like <code>toDataURL</code>), WebGL stats, font and plugin probes, and other subtle signals that, when combined, paint a detailed fingerprint. Seeing those calls appear in my sidebar made this project feel immediately worthwhile.</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/tiktok-overview.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video><figcaption>Canvas and other various hooks firing on Tiktok.com&#39;s homepage</figcaption></figure>
<p>I even made sure to include all canvas operations in a secrion of the detail pane to be able to recreate a canvas if necessary.</p>
<p>I wanted to run this against more anti-bots. Out of curiosity I pointed the demo at a site using Cloudflare’s Turnstile. I <em>knew</em> Turnstile was collecting various browser signals, but to my surprise, my sidebar showed nothing. Why was I seeing zero logs?</p>
<h2 id="oopifs-i-did-it-again">OOPif(S) I did it again</h2>
<p>Cloudflare renders the Turnstile widget inside a sandboxed iframe tucked into a closed shadow root. This iframe is an <a href="https://www.chromium.org/developers/design-documents/oop-iframes/">OOPIF</a> (out-of-process iframe). It lives in a different renderer process so page-level scripts (and our injected hooks) simply won’t run there, thus, no logs.</p>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/turnstile-iframe.png" alt="The Turnstile widget is enclosed inside of an iframe in a closed shadow root" layout="responsive" loading="lazy" width="100" height="100"/><figcaption>The Turnstile widget is enclosed inside of an iframe in a closed shadow root</figcaption></figure>
<h3 id="hopping-the-turnstile">Hopping the Turnstile</h3>
<blockquote>
<p>In 2024, the M.T.A. reports to have lost a combined $568 million in unpaid bus fares and $350 million in unpaid subway fares, wait, wrong turnstile.</p>
</blockquote>
<p>We needed a way to run our hooks inside those out-of-process frames. While scanning CDP I noticed the <code>Target.attachedToTarget</code> event. It fires when the debugger auto-attaches to a new target or when you explicitly call <code>attachToTarget</code>. This was the key: if we tell CDP to auto-attach to targets, it will notify us (and give us a <code>sessionId</code>) for every new frame/process as it appears. With that target/session info we can evaluate code in the correct context so our hook actually runs inside OOPIFs as they spawn.</p>
<pre><code><span>const</span> dbg <span>=</span> view<span>.</span><span>webContents</span><span>.</span><span>debugger</span>
dbg<span>.</span><span>on</span><span>(</span><span>&#39;message&#39;</span><span>,</span> <span>async</span> <span>(</span><span>_<span>,</span> method<span>,</span> params</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span>method <span>===</span> <span>&#39;Target.attachedToTarget&#39;</span><span>)</span> <span>{</span>
        <span>const</span> <span>{</span> sessionId<span>,</span> targetInfo <span>}</span> <span>=</span> params
        
        dbg<span>.</span><span>sendCommand</span><span>(</span><span>&#39;Runtime.enable&#39;</span><span>,</span> <span>{</span><span>}</span><span>,</span> sessionId<span>)</span><span>.</span><span>catch</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span><span>}</span><span>)</span>
        dbg<span>.</span><span>sendCommand</span><span>(</span><span>&#39;Page.enable&#39;</span><span>,</span> <span>{</span><span>}</span><span>,</span> sessionId<span>)</span><span>.</span><span>catch</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span><span>}</span><span>)</span>
        
        dbg<span>.</span><span>sendCommand</span><span>(</span><span>&#39;Page.addScriptToEvaluateOnNewDocument&#39;</span><span>,</span> <span>{</span> <span>source</span><span>:</span> hook <span>}</span><span>,</span> sessionId<span>)</span>
    <span>}</span>
<span>}</span><span>)</span>
</code></pre>
<p>Tada, we have events!</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/turnstile-demo.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video><figcaption>A stream of events appearing when navigating to a Cloudflare IUAM page</figcaption></figure>
<p>I’m not the first to hook common globals and dynamically analyze page scripts. Anti-bots are well aware of this trick and will use a variety of techniques to detect runtime JS patches, so you can’t assume your wrappers will stay hidden.</p>
<p>How is this possible?</p>
<h2 id="tostring-theory">toString theory</h2>
<p>In JavaScript, functions contain a <code>toString</code> instance method. Let&#39;s try calling this on a native function:</p>
<pre><code><span>const</span> mapToString <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>map</span><span>.</span><span>toString</span><span>(</span><span>)</span>

</code></pre>
<p>This means that the implementation of this function is provided by the browser&#39;s native code. How does this look like with our hook applied?:</p>
<pre><code><span>const</span> _origPush <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>;</span>
<span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span> <span>=</span> <span>function</span> <span>(</span><span><span>...</span>args</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;Array.push called on&#39;</span><span>,</span> <span>this</span><span>,</span> <span>&#39;with&#39;</span><span>,</span> args<span>)</span><span>;</span>
  <span>return</span> _origPush<span>.</span><span>apply</span><span>(</span><span>this</span><span>,</span> args<span>)</span><span>;</span>
<span>}</span><span>;</span>
<span>const</span> pushToString <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span> 
</code></pre>
<p>Oh no, our hook has been discovered! Luckily for us, this is easily patched</p>
<pre><code><span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>toString</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>&#34;function push() { [native code] }&#34;</span><span>;</span>
</code></pre>
<p>Phew, that was close.</p>
<pre><code><span>const</span> haha <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>toString</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span> 
</code></pre>
<p>Oh no, another leak!</p>
<pre><code><span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>toString</span><span>.</span><span>toString</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>&#34;function toString() { [native code] }&#34;</span><span>;</span> 
</code></pre>
<p>Ahhh! Another one!</p>
<pre><code><span>const</span> haha <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>toString</span><span>.</span><span>toString</span><span>.</span><span>toString</span><span>.</span><span>toString</span><span>.</span><span>toString</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>
</code></pre>
<p>Wait, you can do what now!?</p>
<pre><code><span>const</span> youCantEscape <span>=</span> <span>Function</span><span>.</span><span>toString</span><span>.</span><span>call</span><span>(</span><span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>)</span><span>;</span> 
</code></pre>
<p>These JS runtime patches turned out to be frustratingly leaky. Patch one hole and another opens. Fixes were possible, but every patch felt like a bandaid that introduced new detection vectors. see:</p>
<pre><code><span>const</span> _origPush <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>;</span>
<span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span> <span>=</span> <span>function</span> <span>(</span><span><span>...</span>args</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#39;Array.push called on&#39;</span><span>,</span> <span>this</span><span>,</span> <span>&#39;with&#39;</span><span>,</span> args<span>)</span><span>;</span>
  <span>return</span> _origPush<span>.</span><span>apply</span><span>(</span><span>this</span><span>,</span> args<span>)</span><span>;</span>
<span>}</span><span>;</span>


<span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>toString</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>&#34;function push() { [native code] }&#34;</span><span>;</span>
<span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>toString</span><span>.</span><span>toString</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>&#34;function toString() { [native code] }&#34;</span><span>;</span>


<span>const</span> anotherLeak <span>=</span> <span>Array</span><span>.</span><span>prototype</span><span>.</span><span>push</span><span>.</span><span>name</span><span>;</span> 
</code></pre>
<p>Those runtime patches were very brittle. Targets we were analyzing could detect the instrumentation and change behavior or even self destruct if they noticed they were being watched. Fixing each leak felt like an endless game of whack-a-mole, so I decided to go a layer deeper.</p>
<h2 id="forking-chromium">Forking Chromium</h2>
<p>At this point I knew I wanted to fork Chromium. I still planned to use Electron, at least for now, since I’d already built a decent UI and didn’t feel like rewriting it all in native C++. The idea was simple: fork Electron (and by extension Chromium), patch into the Blink layer where these API calls happen, and expose them somehow.</p>
<p>I didn’t spend too long figuring out how I’d surface those events. I was already using CDP, so why not create my own custom CDP domain and emit events from there? That way my existing Electron app could just subscribe to them like any other CDP event.</p>
<p>Luckily, Electron has a well-documented guide for building from source. Unluckily, building it took more than three hours on my M2 Pro Mac Mini. To make things worse, macOS 26 had broken parts of the build chain. The Metal toolchain wasn’t being detected no matter what I had tried. Eventually, I hardcoded the path into the build script just to move forward. After several hours of C++ compilation errors and boredom, I finally had a locally built Electron binary running from source.</p>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/electron-hello-page.png" alt="The default &#34;Hello World&#34; page running in our custom Electron build" layout="responsive" loading="lazy" width="100" height="100"/><figcaption>The default &#34;Hello World&#34; page running in our custom Electron build</figcaption></figure>
<p>Now came the hard part: creating a custom CDP domain. The <code>devtools-frontend</code> repository actually provides documentation on defining new protocol domains.</p>
<p>The gist is that protocols are defined in a <code>.pdl</code> (Protocol Definition Language) file, specifically <code>browser_protocol.pdl</code>. To add your own domain, you simply declare it there alongside the existing ones.</p>
<p>I decided to name my new domain <code>Snitch</code>, and defined it like this:</p>
<pre><code>experimental domain Snitch
  command disable
  command enable
  event toDataURLCalled
    parameters
      string dataURL
      optional string frameId
      optional string contextId
</code></pre>
<p>Next, you include your new protocol files in Blink’s build configuration, found in <code>third_party/blink/renderer/core/inspector/BUILD.gn</code>.</p>
<p>From there, you define an <em>agent</em>, the bridge that connects Blink’s internals to the DevTools Protocol so your new CDP domain can send and receive events.</p>
<p>I’ll be honest, the documentation for this part was pretty lacking. The only promising link in the documentation pointed to a locked Google Doc presumably restricted to Chrome team members. They say there&#39;s no better documentation than the source code itself! By dissecting existing domains like <code>DOMStorage</code>, <code>Network</code>, and others, I reverse-engineered how they registered and dispatched events, then adapted that pattern for my own <code>Snitch</code> domain.</p>
<p>I eventually landed on this:</p>
<p>snitch_agent.h</p>
<pre><code><span><span>#</span><span>ifndef</span> <span>THIRD_PARTY_BLINK_RENDERER_CORE_INSPECTOR_SNITCH_AGENT_H_</span></span>
<span><span>#</span><span>define</span> <span>THIRD_PARTY_BLINK_RENDERER_CORE_INSPECTOR_SNITCH_AGENT_H_</span></span>
<span><span>#</span><span>include</span> <span>&lt;optional&gt;</span></span>

<span><span>#</span><span>include</span> <span>&#34;third_party/blink/renderer/core/core_export.h&#34;</span></span>
<span><span>#</span><span>include</span> <span>&#34;third_party/blink/renderer/core/inspector/inspector_base_agent.h&#34;</span></span>
<span><span>#</span><span>include</span> <span>&#34;third_party/blink/renderer/core/inspector/protocol/snitch.h&#34;</span></span>

<span>namespace</span> blink <span>{</span>

<span>class</span> <span>InspectedFrames</span><span>;</span>

<span>class</span> <span>CORE_EXPORT</span> SnitchAgent <span>final</span>
    <span>:</span> <span>public</span> InspectorBaseAgent<span>&lt;</span>protocol<span>::</span>Snitch<span>::</span>Metainfo<span>&gt;</span> <span>{</span>
 <span>public</span><span>:</span>
  <span>SnitchAgent</span><span>(</span>InspectedFrames<span>*</span><span>)</span><span>;</span>
  <span>SnitchAgent</span><span>(</span><span>const</span> SnitchAgent<span>&amp;</span><span>)</span> <span>=</span> <span>delete</span><span>;</span>
  SnitchAgent<span>&amp;</span> <span>operator</span><span>=</span><span>(</span><span>const</span> SnitchAgent<span>&amp;</span><span>)</span> <span>=</span> <span>delete</span><span>;</span>
  <span>~</span><span>SnitchAgent</span><span>(</span><span>)</span> <span>override</span><span>;</span>

  <span>void</span> <span>Trace</span><span>(</span>Visitor<span>*</span><span>)</span> <span>const</span> <span>override</span><span>;</span>
  protocol<span>::</span>Response <span>enable</span><span>(</span><span>)</span> <span>override</span><span>;</span>
  protocol<span>::</span>Response <span>disable</span><span>(</span><span>)</span> <span>override</span><span>;</span>

  <span>void</span> <span>DidCanvasToDataURL</span><span>(</span>ExecutionContext<span>*</span><span>,</span> <span>const</span> String<span>&amp;</span> data_url<span>,</span>
                          <span>const</span> String<span>&amp;</span> frame_id<span>,</span>
                          <span>const</span> String<span>&amp;</span> context_id<span>)</span><span>;</span>

 <span>private</span><span>:</span>
  Member<span>&lt;</span>InspectedFrames<span>&gt;</span> inspected_frames_<span>;</span>
  InspectorAgentState<span>::</span>Boolean enabled_<span>;</span>
<span>}</span><span>;</span>

<span>}</span>  

<span><span>#</span><span>endif</span>  </span>

</code></pre>
<p>snitch_agent.cpp</p>
<pre><code><span><span>#</span><span>include</span> <span>&#34;third_party/blink/renderer/core/inspector/snitch_agent.h&#34;</span></span>
<span><span>#</span><span>include</span> <span>&#34;third_party/blink/renderer/core/inspector/inspected_frames.h&#34;</span></span>

<span>namespace</span> blink <span>{</span>

<span>SnitchAgent</span><span>::</span><span>SnitchAgent</span><span>(</span>
  InspectedFrames<span>*</span> inspected_frames<span>)</span>
  <span>:</span> <span>inspected_frames_</span><span>(</span>inspected_frames<span>)</span><span>,</span>
    <span>enabled_</span><span>(</span><span>&amp;</span>agent_state_<span>,</span> <span>false</span><span>)</span> <span>{</span><span>}</span>


<span>SnitchAgent</span><span>::</span><span>~</span><span>SnitchAgent</span><span>(</span><span>)</span> <span>=</span> <span>default</span><span>;</span>

<span>void</span> <span>SnitchAgent</span><span>::</span><span>Trace</span><span>(</span>Visitor<span>*</span> visitor<span>)</span> <span>const</span> <span>{</span>
  visitor<span>-&gt;</span><span>Trace</span><span>(</span>inspected_frames_<span>)</span><span>;</span>
  <span>InspectorBaseAgent</span><span>::</span><span>Trace</span><span>(</span>visitor<span>)</span><span>;</span>
<span>}</span>

protocol<span>::</span>Response <span>SnitchAgent</span><span>::</span><span>enable</span><span>(</span><span>)</span> <span>{</span>
  enabled_<span>.</span><span>Set</span><span>(</span><span>true</span><span>)</span><span>;</span>
  instrumenting_agents_<span>-&gt;</span><span>AddSnitchAgent</span><span>(</span><span>this</span><span>)</span><span>;</span>
  <span>return</span> protocol<span>::</span><span>Response</span><span>::</span><span>Success</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

protocol<span>::</span>Response <span>SnitchAgent</span><span>::</span><span>disable</span><span>(</span><span>)</span> <span>{</span>
  enabled_<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
  instrumenting_agents_<span>-&gt;</span><span>RemoveSnitchAgent</span><span>(</span><span>this</span><span>)</span><span>;</span>
  <span>return</span> protocol<span>::</span><span>Response</span><span>::</span><span>Success</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>void</span> <span>SnitchAgent</span><span>::</span><span>DidCanvasToDataURL</span><span>(</span>ExecutionContext<span>*</span> context<span>,</span> <span>const</span> String<span>&amp;</span> data_url<span>,</span>
                                     <span>const</span> String<span>&amp;</span> frame_id<span>,</span>
                                     <span>const</span> String<span>&amp;</span> context_id<span>)</span> <span>{</span>

  <span>if</span> <span>(</span><span>!</span>enabled_<span>.</span><span>Get</span><span>(</span><span>)</span><span>)</span> <span>{</span>
    <span>return</span><span>;</span>
  <span>}</span>

  std<span>::</span>optional<span>&lt;</span>String<span>&gt;</span> maybe_frame<span>;</span>
  <span>if</span> <span>(</span><span>!</span>frame_id<span>.</span><span>empty</span><span>(</span><span>)</span><span>)</span> <span>{</span>
    maybe_frame <span>=</span> frame_id<span>;</span>
  <span>}</span>

  std<span>::</span>optional<span>&lt;</span>String<span>&gt;</span> maybe_ctx<span>;</span>
  <span>if</span> <span>(</span><span>!</span>context_id<span>.</span><span>empty</span><span>(</span><span>)</span><span>)</span> <span>{</span>
    maybe_ctx <span>=</span> context_id<span>;</span>
  <span>}</span>

  <span>GetFrontend</span><span>(</span><span>)</span><span>-&gt;</span><span>toDataURLCalled</span><span>(</span>data_url<span>,</span> maybe_frame<span>,</span> maybe_ctx<span>)</span><span>;</span>
<span>}</span>

<span>}</span>  

</code></pre>
<p>Now I needed a way to trigger my new event from the native C++ implementation of <code>toDataURL</code>. The implementation for that function lives in <code>src/third_party/blink/renderer/core/html/canvas/html_canvas_element.cc</code>.</p>
<p>While digging through how other events were dispatched, I noticed something interesting. The agents weren’t called directly. Instead, events were emitted through <em>probes</em>. These probes act as intermediary hooks that Blink uses to fire instrumentation events into the DevTools pipeline.</p>
<p>Here’s a comment from that same class showing how a probe fires when a canvas element is created:</p>
<pre><code>CanvasRenderingContext<span>*</span> <span>HTMLCanvasElement</span><span>::</span><span>GetCanvasRenderingContextInternal</span><span>(</span>
    ExecutionContext<span>*</span> execution_context<span>,</span>
    <span>const</span> String<span>&amp;</span> type<span>,</span>
    <span>const</span> CanvasContextCreationAttributesCore<span>&amp;</span> attributes<span>)</span> <span>{</span>
  CanvasRenderingContext<span>::</span>CanvasRenderingAPI rendering_api <span>=</span>
      <span>CanvasRenderingContext</span><span>::</span><span>RenderingAPIFromId</span><span>(</span>type<span>)</span><span>;</span>

  

  CanvasRenderingContextFactory<span>*</span> factory <span>=</span>
      <span>GetRenderingContextFactory</span><span>(</span><span><span>static_cast</span><span><span>&lt;</span><span>int</span><span>&gt;</span></span></span><span>(</span>rendering_api<span>)</span><span>)</span><span>;</span>

  
  
  probe<span>::</span><span>DidCreateCanvasContext</span><span>(</span><span>&amp;</span><span>GetDocument</span><span>(</span><span>)</span><span>)</span><span>;</span>
  
<span>}</span>  
</code></pre>
<p>These probes are defined in a file called <code>core_probes.pidl</code>. The comment at the top of this file states:</p>
<pre><code>/*
 * make_instrumenting_probes.py uses this file as a source to generate
 * core_probes_inl.h, core_probes_impl.cc and core_probe_sink.h.
 *
 * The code below is not a correct IDL but a mix of IDL and C++.
 *
 * The syntax for an instrumentation method is as follows:
 *
 *    returnValue methodName([paramAttr1] param1, [paramAttr2] param2, ...)
</code></pre>
<p>Following this syntax, I added my custom probe:</p>
<pre><code><span>void</span> <span>DidCanvasToDataURL</span><span>(</span><span>[</span>Keep<span>]</span> ExecutionContext<span>*</span><span>,</span> String<span>&amp;</span> data_url<span>,</span> String<span>&amp;</span> frame_id<span>,</span> String<span>&amp;</span> context_id<span>)</span><span>;</span>
</code></pre>
<p>A similarly named <code>core_probes.json5</code> holds the mappings of which agents are responsible for which probes. We can add our entry as such:</p>
<pre><code><span>{</span>
    observers<span>:</span> <span>{</span>
        
        SnitchAgent<span>:</span> <span>{</span>
            probes<span>:</span> <span>[</span><span>&#34;DidCanvasToDataURL&#34;</span><span>]</span>
        <span>}</span>
        
    <span>}</span>
<span>}</span>
</code></pre>
<p>The final step in adding our custom domain is to register the agent in <code>WebDevToolsAgentImpl::AttachSession</code> like so:</p>
<pre><code>session<span>-&gt;</span><span><span>CreateAndAppend</span><span><span>&lt;</span>SnitchAgent<span>&gt;</span></span></span><span>(</span>inspected_frames<span>)</span><span>;</span>
</code></pre>
<p>and actually calling it in the implementation of <code>toDataURL</code>:</p>
<pre><code>String <span>HTMLCanvasElement</span><span>::</span><span>toDataURL</span><span>(</span><span>const</span> String<span>&amp;</span> mime_type<span>,</span>
                                    <span>const</span> ScriptValue<span>&amp;</span> quality_argument<span>,</span>
                                    ExceptionState<span>&amp;</span> exception_state<span>)</span> <span>const</span> <span>{</span>
  
  String data_url <span>=</span> <span>ToDataURLInternal</span><span>(</span>mime_type<span>,</span> quality<span>,</span> kBackBuffer<span>,</span>
                                      ReadbackType<span>::</span>kWebExposed<span>)</span><span>;</span>

  
  probe<span>::</span><span>DidCanvasToDataURL</span><span>(</span><span>GetExecutionContext</span><span>(</span><span>)</span><span>,</span> data_url<span>,</span> frame_id<span>,</span> context_id<span>)</span><span>;</span>

  <span>return</span> data_url<span>;</span>
<span>}</span>
</code></pre>
<p>After accidentally nuking my local repository and having to restart the entire process, including sitting through another 3 hour compilation 🥲, it was ready to test!</p>
<p>We can create a simple Electron test application:</p>
<pre><code><span>const</span> <span>{</span> app<span>,</span> <span>BrowserWindow</span> <span>}</span> <span>=</span> <span>require</span><span>(</span><span>&#34;electron/main&#34;</span><span>)</span><span>;</span>

<span>function</span> <span>createWindow</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> win <span>=</span> <span>new</span> <span>BrowserWindow</span><span>(</span><span>{</span>
    <span>width</span><span>:</span> <span>800</span><span>,</span>
    <span>height</span><span>:</span> <span>600</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>const</span> dbg <span>=</span> win<span>.</span><span>webContents</span><span>.</span><span>debugger</span><span>;</span>
  dbg<span>.</span><span>attach</span><span>(</span><span>&#34;1.3&#34;</span><span>)</span><span>;</span>
  dbg<span>.</span><span>sendCommand</span><span>(</span><span>&#34;Snitch.enable&#34;</span><span>)</span><span>;</span>
  dbg<span>.</span><span>on</span><span>(</span><span>&#34;message&#34;</span><span>,</span> <span>(</span><span>_<span>,</span> method<span>,</span> <span>{</span> dataURL <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span>method <span>===</span> <span>&#34;Snitch.toDataURLCalled&#34;</span><span>)</span> <span>{</span>
      <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;toDataURL called&#34;</span><span>,</span> dataURL<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span><span>)</span><span>;</span>
  win<span>.</span><span>loadURL</span><span>(</span><span>&#34;https://demo.fingerprint.com/playground&#34;</span><span>)</span><span>;</span>
<span>}</span>

app<span>.</span><span>whenReady</span><span>(</span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>createWindow</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
</code></pre>
<p>and run it pointing to our custom Electron build:</p>
<pre><code>$ /Users/veritas/electron/src/out/Testing/Electron.app/Contents/MacOS/Electron demo.js
</code></pre>
<p>Drumroll, please!</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/to-data-custom-browser.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video><figcaption>The Canvas toDataURL operation was caught by our custom build and sent through CDP!</figcaption></figure>
<p>It worked! We can see our custom CDP event firing and returning to us the result of a toDataURL call on FingerprintJS&#39; playground. We can now use these stealthy CDP events and not leak the fact that we&#39;re instrumenting these functions.</p>
<p>Note: Depending on what we do in these hooks, it may still be possible to detect us through any side-effects we introduce or potentially through timing checks (Is the function slower than it would usually be?).</p>

<p>This was powerful, but I wanted more. I needed a few extra tools to make this thing a real web reverse-engineering Swiss Army knife.</p>
<h3 id="deobfuscation">Deobfuscation</h3>
<p>One of the biggest time sinks in this kind of work is dealing with obfuscated scripts. I wanted a built-in tool that could automatically detect and attempt to deobfuscate scripts as they load. Using CDP’s <code>Network</code> domain, I intercept incoming JavaScript files and run a few lightweight heuristics to score their likelihood of being obfuscated. Suspicious ones are displayed in a separate tab, where I integrate tools like bensb’s <a href="https://deobfuscate.io">deobfuscate.io</a> to automatically try recovering a more readable version. The plan is to add more tools such as Webcrack and even custom deobfuscators of my own.</p>
<p>I also added a section that extracts and displays recovered string literals from the processed script for added speed.</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/obfuscation.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video><figcaption>Obfuscation tab running against a pretend CTF challenge</figcaption></figure>
<h3 id="overwriting-properties-and-functions">Overwriting properties and functions</h3>
<p>Hooking and reading is fun, but sometimes you want to <em>change</em> behavior. You now know that doing so in a browser environment, across OOPIFs and with anti-tamper checks is non-trivial. I built an <strong>Overrides</strong> tab where you can define custom JavaScript snippets that overwrite functions or properties across <em>all</em> frames. These execute without triggering common integrity checks, giving a clean way to spoof or alter these values.</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/overrides.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video><figcaption>Overriding navigator.userAgent and navigator.vendor from the Overrides tab</figcaption></figure>
<h3 id="fingerprint-payload-decryption">Fingerprint payload decryption</h3>
<p>My bread and butter is dissecting anti-bot and fingerprinting scripts. These scripts often encrypt or encode their payloads before sending them to backend validators, which makes analysis painful. To make life easier, I added a feature that detects known collectors and automatically intercepts their outbound requests. It decrypts (or decodes) the payloads and displays both the plaintext and structured data in a neat table view.</p>
<p>Of course, each collector still needs to be reverse-engineered beforehand. Maybe this is where AI-assisted payload analysis could step in someday? Maybe, but for now I will continue to hand-roll my own parsers :-)</p>
<figure><video width="320" height="240" controls=""><source src="/posts/reverse-engineering-browser/fingerprintjs-tab.mp4#t=0.001" type="video/mp4"/><p>Your browser does not support the video tag.</p></video><figcaption>FingerprintJS tab that shows the decoded payload in a nice table</figcaption></figure>
<h2 id="next-steps">Next steps</h2>
<p>I’m really happy with how this project has evolved. It’s gone from my quick weekend curiosity to a genuinely useful research tool. Still, I have a few major goals remain before I can say I&#39;m truly proud:</p>
<ol>
<li>
<p><strong>Abandon Electron</strong><!-- --></p>
</li>
<li>
<p><strong>Hook all the things</strong><!-- -->
<!-- --></p>
</li>
<li>
<p><strong>Release?</strong><!-- --></p>
</li>
</ol>
<p>And with that, I present to you a gallery of canvas fingerprint images that I&#39;ve collected during this project.</p>
<h2 id="fingerprint-gallery">Fingerprint Gallery</h2>
<h3 id="tiktok">Tiktok</h3>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/tiktok-canvas.png" alt="This one is pretty festive! It includes two pandas, Santa Claus, and a rainbow." layout="responsive" loading="lazy" width="100" height="100"/><figcaption>This one is pretty festive! It includes two pandas, Santa Claus, and a rainbow.</figcaption></figure>
<details><summary>Canvas operations:</summary><pre><code><span>const</span> canvas <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;canvas&#39;</span><span>)</span>
<span>const</span> context <span>=</span> canvas<span>.</span><span>getContext</span><span>(</span><span>&#34;2d&#34;</span><span>)</span>
<span>const</span> gradient0 <span>=</span> context<span>.</span><span>createLinearGradient</span><span>(</span><span>10</span><span>,</span> <span>0</span><span>,</span> <span>180</span><span>,</span> <span>1</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;red&#34;</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>0.1</span><span>,</span> <span>&#34;white&#34;</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>0.2</span><span>,</span> <span>&#34;blue&#34;</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>0.3</span><span>,</span> <span>&#34;yellow&#34;</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>0.4</span><span>,</span> <span>&#34;purple&#34;</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>0.7</span><span>,</span> <span>&#34;orange&#34;</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;magenta&#34;</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient0
context<span>.</span><span>fillRect</span><span>(</span><span>0</span><span>,</span> <span>10</span><span>,</span> <span>100</span><span>,</span> <span>6</span><span>)</span>
<span>const</span> gradient1 <span>=</span> context<span>.</span><span>createLinearGradient</span><span>(</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>100</span><span>,</span> <span>100</span><span>)</span>
gradient1<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;green&#34;</span><span>)</span>
gradient1<span>.</span><span>addColorStop</span><span>(</span><span>0.5</span><span>,</span> <span>&#34;yellow&#34;</span><span>)</span>
gradient1<span>.</span><span>addColorStop</span><span>(</span><span>0.7</span><span>,</span> <span>&#34;orange&#34;</span><span>)</span>
gradient1<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;magenta&#34;</span><span>)</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient1
context<span>.</span><span>arc</span><span>(</span><span>50</span><span>,</span> <span>10</span><span>,</span> <span>25</span><span>,</span> <span>0</span><span>,</span> <span>6.283185307179586</span><span>)</span>
context<span>.</span><span>stroke</span><span>(</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;rgba(150, 32, 170, .97)&#34;</span>
context<span>.</span><span>font</span> <span>=</span> <span>&#34;12px Sans&#34;</span>
context<span>.</span><span>textBaseline</span> <span>=</span> <span>&#34;top&#34;</span>
context<span>.</span><span>fillText</span><span>(</span><span>&#34;*+(}#?🐼 🎅&#34;</span><span>,</span> <span>18</span><span>,</span> <span>18</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>1</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;rgba(47, 211, 69, .99)&#34;</span>
context<span>.</span><span>font</span> <span>=</span> <span>&#34;14px Sans&#34;</span>
context<span>.</span><span>textBaseline</span> <span>=</span> <span>&#34;top&#34;</span>
context<span>.</span><span>fillText</span><span>(</span><span>&#34;🐼OynG@%tp$&#34;</span><span>,</span> <span>3</span><span>,</span> <span>3</span><span>)</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>arc</span><span>(</span><span>30</span><span>,</span> <span>10</span><span>,</span> <span>20</span><span>,</span> <span>0</span><span>,</span> <span>6.283185307179586</span><span>)</span>
context<span>.</span><span>strokeStyle</span> <span>=</span> <span>&#34;rgba(255, 12, 220, 1)&#34;</span>
context<span>.</span><span>stroke</span><span>(</span><span>)</span>
</code></pre></details>
<h3 id="fingerprintjs">FingerprintJS</h3>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/pangram.png" alt="A piece of a pangram whilst also being very happy!" layout="responsive" loading="lazy" width="100" height="100"/><figcaption>A piece of a pangram whilst also being very happy!</figcaption></figure>
<details><summary>Canvas operations:</summary><pre><code><span>const</span> canvas <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;canvas&#39;</span><span>)</span>
<span>const</span> context <span>=</span> canvas<span>.</span><span>getContext</span><span>(</span><span>&#34;2d&#34;</span><span>)</span>
context<span>.</span><span>rect</span><span>(</span><span>0</span><span>,</span> <span>0</span><span>,</span> <span>10</span><span>,</span> <span>10</span><span>)</span>
context<span>.</span><span>rect</span><span>(</span><span>2</span><span>,</span> <span>2</span><span>,</span> <span>6</span><span>,</span> <span>6</span><span>)</span>
context<span>.</span><span>isPointInPath</span><span>(</span><span>5</span><span>,</span> <span>5</span><span>,</span> <span>&#34;evenodd&#34;</span><span>)</span>
context<span>.</span><span>textBaseline</span> <span>=</span> <span>&#34;alphabetic&#34;</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;#f60&#34;</span>
context<span>.</span><span>fillRect</span><span>(</span><span>100</span><span>,</span> <span>1</span><span>,</span> <span>62</span><span>,</span> <span>20</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;#069&#34;</span>
context<span>.</span><span>font</span> <span>=</span> <span>&#34;11pt \&#34;Times New Roman\&#34;&#34;</span>
context<span>.</span><span>fillText</span><span>(</span><span>&#34;Cwm fjordbank gly 😃&#34;</span><span>,</span> <span>2</span><span>,</span> <span>15</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;rgba(102, 204, 0, 0.2)&#34;</span>
context<span>.</span><span>font</span> <span>=</span> <span>&#34;18pt Arial&#34;</span>
context<span>.</span><span>fillText</span><span>(</span><span>&#34;Cwm fjordbank gly 😃&#34;</span><span>,</span> <span>4</span><span>,</span> <span>45</span><span>)</span>
</code></pre></details>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/multiply.png" alt="Pretty abstract, pretty cool!" layout="responsive" loading="lazy" width="100" height="100"/><figcaption>Pretty abstract, pretty cool!</figcaption></figure>
<details><summary>Canvas operations:</summary><pre><code><span>const</span> canvas <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;canvas&#39;</span><span>)</span>
<span>const</span> context <span>=</span> canvas<span>.</span><span>getContext</span><span>(</span><span>&#34;2d&#34;</span><span>)</span>
context<span>.</span><span>globalCompositeOperation</span> <span>=</span> <span>&#34;multiply&#34;</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;#f2f&#34;</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>arc</span><span>(</span><span>40</span><span>,</span> <span>40</span><span>,</span> <span>40</span><span>,</span> <span>0</span><span>,</span> <span>6.283185307179586</span><span>,</span> <span>true</span><span>)</span>
context<span>.</span><span>closePath</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;#2ff&#34;</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>arc</span><span>(</span><span>80</span><span>,</span> <span>40</span><span>,</span> <span>40</span><span>,</span> <span>0</span><span>,</span> <span>6.283185307179586</span><span>,</span> <span>true</span><span>)</span>
context<span>.</span><span>closePath</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;#ff2&#34;</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>arc</span><span>(</span><span>60</span><span>,</span> <span>80</span><span>,</span> <span>40</span><span>,</span> <span>0</span><span>,</span> <span>6.283185307179586</span><span>,</span> <span>true</span><span>)</span>
context<span>.</span><span>closePath</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> <span>&#34;#f9c&#34;</span>
context<span>.</span><span>arc</span><span>(</span><span>60</span><span>,</span> <span>60</span><span>,</span> <span>60</span><span>,</span> <span>0</span><span>,</span> <span>6.283185307179586</span><span>,</span> <span>true</span><span>)</span>
context<span>.</span><span>arc</span><span>(</span><span>60</span><span>,</span> <span>60</span><span>,</span> <span>20</span><span>,</span> <span>0</span><span>,</span> <span>6.283185307179586</span><span>,</span> <span>true</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>&#34;evenodd&#34;</span><span>)</span>
</code></pre></details>
<h3 id="cloudflare">Cloudflare</h3>
<figure><img src="https://nullpt.rs/posts/reverse-engineering-browser/cf-canvas.png" alt="Is it a bird?" layout="responsive" loading="lazy" width="100" height="100"/><figcaption>Is it a bird?</figcaption></figure>
<details><summary>Canvas operations:</summary><pre><code><span>const</span> canvas <span>=</span> <span>document</span><span>.</span><span>createElement</span><span>(</span><span>&#39;canvas&#39;</span><span>)</span>
<span>const</span> context <span>=</span> canvas<span>.</span><span>getContext</span><span>(</span><span>&#34;2d&#34;</span><span>)</span>
<span>const</span> gradient0 <span>=</span> context<span>.</span><span>createRadialGradient</span><span>(</span><span>33</span><span>,</span> <span>18</span><span>,</span> <span>8</span><span>,</span> <span>42</span><span>,</span> <span>10</span><span>,</span> <span>226</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;#809900&#34;</span><span>)</span>
gradient0<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;#404041&#34;</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient0
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>11</span>
context<span>.</span><span>shadowColor</span> <span>=</span> <span>&#34;#F38020&#34;</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>moveTo</span><span>(</span><span>9</span><span>,</span> <span>14</span><span>)</span>
context<span>.</span><span>quadraticCurveTo</span><span>(</span><span>93</span><span>,</span> <span>48</span><span>,</span> <span>116</span><span>,</span> <span>111</span><span>)</span>
context<span>.</span><span>stroke</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>0</span>
<span>const</span> gradient1 <span>=</span> context<span>.</span><span>createRadialGradient</span><span>(</span><span>77</span><span>,</span> <span>98</span><span>,</span> <span>2</span><span>,</span> <span>27</span><span>,</span> <span>30</span><span>,</span> <span>206</span><span>)</span>
gradient1<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;#809900&#34;</span><span>)</span>
gradient1<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;#404041&#34;</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient1
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>ellipse</span><span>(</span><span>58</span><span>,</span> <span>55</span><span>,</span> <span>31</span><span>,</span> <span>28</span><span>,</span> <span>1.4441705959829747</span><span>,</span> <span>0.5401125108618993</span><span>,</span> <span>4.052233984744969</span><span>)</span>
context<span>.</span><span>stroke</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>0</span>
<span>const</span> gradient2 <span>=</span> context<span>.</span><span>createRadialGradient</span><span>(</span><span>108</span><span>,</span> <span>12</span><span>,</span> <span>10</span><span>,</span> <span>65</span><span>,</span> <span>118</span><span>,</span> <span>169</span><span>)</span>
gradient2<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;#1AB399&#34;</span><span>)</span>
gradient2<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;#E666B3&#34;</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient2
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>16</span>
context<span>.</span><span>shadowColor</span> <span>=</span> <span>&#34;#809980&#34;</span>
context<span>.</span><span>font</span> <span>=</span> <span>&#34;27.77777777777778px aanotafontaa&#34;</span>
context<span>.</span><span>fillText</span><span>(</span><span>&#34;Ry&#34;</span><span>,</span> <span>13</span><span>,</span> <span>67</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>0</span>
<span>const</span> gradient3 <span>=</span> context<span>.</span><span>createRadialGradient</span><span>(</span><span>46</span><span>,</span> <span>47</span><span>,</span> <span>0</span><span>,</span> <span>101</span><span>,</span> <span>108</span><span>,</span> <span>207</span><span>)</span>
gradient3<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;#4DB380&#34;</span><span>)</span>
gradient3<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;#FF4D4D&#34;</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient3
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>3</span>
context<span>.</span><span>shadowColor</span> <span>=</span> <span>&#34;#FF6633&#34;</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>moveTo</span><span>(</span><span>54</span><span>,</span> <span>5</span><span>)</span>
context<span>.</span><span>bezierCurveTo</span><span>(</span><span>54</span><span>,</span> <span>90</span><span>,</span> <span>32</span><span>,</span> <span>74</span><span>,</span> <span>71</span><span>,</span> <span>120</span><span>)</span>
context<span>.</span><span>stroke</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>0</span>
<span>const</span> gradient4 <span>=</span> context<span>.</span><span>createRadialGradient</span><span>(</span><span>119</span><span>,</span> <span>123</span><span>,</span> <span>3</span><span>,</span> <span>109</span><span>,</span> <span>90</span><span>,</span> <span>137</span><span>)</span>
gradient4<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;#E6B333&#34;</span><span>)</span>
gradient4<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;#3366E6&#34;</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient4
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>4</span>
context<span>.</span><span>shadowColor</span> <span>=</span> <span>&#34;#B3B31A&#34;</span>
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>moveTo</span><span>(</span><span>76</span><span>,</span> <span>0</span><span>)</span>
context<span>.</span><span>bezierCurveTo</span><span>(</span><span>1</span><span>,</span> <span>49</span><span>,</span> <span>103</span><span>,</span> <span>67</span><span>,</span> <span>49</span><span>,</span> <span>125</span><span>)</span>
context<span>.</span><span>stroke</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>0</span>
<span>const</span> gradient5 <span>=</span> context<span>.</span><span>createRadialGradient</span><span>(</span><span>34</span><span>,</span> <span>47</span><span>,</span> <span>1</span><span>,</span> <span>37</span><span>,</span> <span>59</span><span>,</span> <span>245</span><span>)</span>
gradient5<span>.</span><span>addColorStop</span><span>(</span><span>0</span><span>,</span> <span>&#34;#809900&#34;</span><span>)</span>
gradient5<span>.</span><span>addColorStop</span><span>(</span><span>1</span><span>,</span> <span>&#34;#404041&#34;</span><span>)</span>
context<span>.</span><span>fillStyle</span> <span>=</span> gradient5
context<span>.</span><span>beginPath</span><span>(</span><span>)</span>
context<span>.</span><span>ellipse</span><span>(</span><span>56</span><span>,</span> <span>57</span><span>,</span> <span>14</span><span>,</span> <span>8</span><span>,</span> <span>1.2273132071162383</span><span>,</span> <span>4.1926143018618225</span><span>,</span> <span>2.8853539230051624</span><span>)</span>
context<span>.</span><span>stroke</span><span>(</span><span>)</span>
context<span>.</span><span>fill</span><span>(</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>0</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>14</span>
context<span>.</span><span>shadowColor</span> <span>=</span> <span>&#34;#809900&#34;</span>
context<span>.</span><span>font</span> <span>=</span> <span>&#34;11.904761904761905px aanotafontaa&#34;</span>
context<span>.</span><span>strokeText</span><span>(</span><span>&#34;@H1&#34;</span><span>,</span> <span>30</span><span>,</span> <span>73</span><span>)</span>
context<span>.</span><span>shadowBlur</span> <span>=</span> <span>0</span><span>;</span>
</code></pre></details>
<h2 id="until-next-time">Until next time</h2>
<p>I&#39;d love to know if you found this even remotely interesting or think it&#39;s just a giant waste of time :-) I certainly had fun building it and had even more fun using it</p>
<h2 id="credits">Credits</h2>
<p><a href="https://github.com/pimothyxd">pimothyxd</a>: Helped with the design of the UI! Always someone I can depend on.</p>
<p><a href="https://blog.deobfuscate.io/">bensb</a>: Used his deobfuscator for the scripts tab. Also very knowledgable and a great person to chat ideas with.</p>
<p><a href="https://github.com/samuelmaddock/electron-browser-shell">samuelmaddock</a>: Your electron-browser-shell project made it very easy to get this spun up.</p><div><p><img src="https://avatars.githubusercontent.com/u/25884226" alt="veritas profile picture"/></p></div></div></div>
  </body>
</html>
