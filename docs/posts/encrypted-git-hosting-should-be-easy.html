<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/nathants/git-remote-aws">Original</a>
    <h1>Show HN: Encrypted Git hosting should be easy</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<h2 dir="auto"><a id="user-content-why" aria-hidden="true" href="#why"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>why</h2>
<p dir="auto">encrypted git hosting should be easy.</p>
<h2 dir="auto"><a id="user-content-how" aria-hidden="true" href="#how"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>how</h2>
<p dir="auto">encrypted git <a href="https://git-scm.com/docs/git-bundle" rel="nofollow">bundles</a> are stored in s3.</p>
<p dir="auto">compare and swap against dynamodb updates an ordered list of bundles. this enables multiple writers to safely collaborate on a single remote.</p>
<p dir="auto">each remote can hold one and only one branch.</p>
<p dir="auto">bundles in s3 are immutable, and force push is not allowed.</p>
<p dir="auto">bundles are encrypted with libsodium <a href="https://doc.libsodium.org/secret-key_cryptography/secretstream" rel="nofollow">secretstream</a>. user keys are libsodium box <a href="https://doc.libsodium.org/public-key_cryptography/authenticated_encryption#key-pair-generation" rel="nofollow">keypairs</a>. authorized user public keys are added to a <code>.publickeys</code> file in the git repository. to add or remove authorized users, update the publickeys file, then create and push to a new remote or delete s3 data and recreate an existing remote.</p>
<p dir="auto">metadata is stored unencrypted:</p>
<ul dir="auto">
<li>branch name</li>
<li>remote name</li>
<li>git hash for the start and end of each bundle</li>
</ul>
<p dir="auto">data is stored encrypted:</p>
<ul dir="auto">
<li>git bundles</li>
</ul>
<p dir="auto">both git sha1 and sha256 hashing algorithms are supported.</p>
<p dir="auto">private s3 buckets and dynamodb tables are created ondemand if they do not already exist.</p>
<h2 dir="auto"><a id="user-content-what" aria-hidden="true" href="#what"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>what</h2>
<p dir="auto">a custom git remote adding support for remotes like:</p>
<p dir="auto"><code>git remote add origin aws://${s3_bucket}+${dynamo_table}/${remote_name}</code></p>
<p dir="auto">the git remote binary provides a keygen for libsodium box <a href="https://doc.libsodium.org/public-key_cryptography/authenticated_encryption#key-pair-generation" rel="nofollow">keypairs</a>:</p>
<p dir="auto"><code>git-remote-aws --keygen ~/.git-remote-aws/publickey ~/.git-remote-aws/secretkey</code></p>
<p dir="auto">the default path for your secret key is <code>~/.git-remote-aws/secretkey</code>. this can be changed via environment variable <code>GIT_REMOTE_AWS_SECRETKEY</code>.</p>
<h2 dir="auto"><a id="user-content-install" aria-hidden="true" href="#install"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>install</h2>
<p dir="auto">install go and libsodium from your package manager:</p>
<div dir="auto" data-snippet-clipboard-copy-content="brew install         go     libsodium     # homebrew
sudo pacman -S       go     libsodium     # arch
sudo apk add         go     libsodium-dev # alpine
sudo apt-get install golang libsodium-dev # ubuntu/debian"><pre>brew install         go     libsodium     <span><span>#</span> homebrew</span>
sudo pacman -S       go     libsodium     <span><span>#</span> arch</span>
sudo apk add         go     libsodium-dev <span><span>#</span> alpine</span>
sudo apt-get install golang libsodium-dev <span><span>#</span> ubuntu/debian</span></pre></div>
<p dir="auto">install the binary and update PATH:</p>
<div dir="auto" data-snippet-clipboard-copy-content="go install github.com/nathants/git-remote-aws@latest

export PATH=$PATH:$(go env GOPATH)/bin"><pre>go install github.com/nathants/git-remote-aws@latest

<span>export</span> PATH=<span>$PATH</span>:<span><span>$(</span>go env GOPATH<span>)</span></span>/bin</pre></div>
<h2 dir="auto"><a id="user-content-usage" aria-hidden="true" href="#usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>usage</h2>
<div dir="auto" data-snippet-clipboard-copy-content="&gt;&gt; git init

&gt;&gt; git remote add origin aws://${bucket}+${table}/myrepo

&gt;&gt; mkdir -p ~/.git-remote-aws

&gt;&gt; git-remote-aws --keygen ~/.git-remote-aws/publickey ~/.git-remote-aws/secretkey

&gt;&gt; cat ~/.git-remote-aws/publickey &gt;&gt; .publickeys

&gt;&gt; git add .

&gt;&gt; git commit -m init

&gt;&gt; git push -u origin master

creating private s3 bucket: $bucket
lib/s3.go:329: created bucket: $bucket
lib/s3.go:367: created bucket tags for: $bucket
lib/s3.go:415: created public access block for $bucket: private
lib/s3.go:657: created encryption for $bucket: true
lib/s3.go:688: put bucket metrics for: $bucket
created private s3 bucket: $bucket
creating private dynamodb table: $table
lib/dynamodb.go:481: created table: $table
lib/dynamodb.go:974: waiting for table active: $table
lib/dynamodb.go:974: waiting for table active: $table
created private dynamodb table: $table
get dynamodb://$table/$bucket/myrepo
get dynamodb://$table/$bucket/myrepo
get s3://$bucket/
git bundle: 0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
put s3://$bucket/myrepo/0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
put s3://$bucket/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
put dynamodb://$table/$bucket/myrepo
To aws://$bucket+$table/myrepo
 * [new branch]      master -&gt; master

&gt;&gt; libaws s3-ls $bucket/ -r

770 myrepo/0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
 82 myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc

&gt;&gt; libaws dynamodb-item-scan $table | jq .

{
  &#34;branch&#34;: &#34;master&#34;,
  &#34;bundles&#34;: &#34;myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc&#34;,
  &#34;id&#34;: &#34;$bucket/myrepo&#34;,
  &#34;uid&#34;: null,
  &#34;unix&#34;: 0
}

&gt;&gt; cd $(mktemp -d)

&gt;&gt; git clone aws://${bucket}+${table}/myrepo

Cloning into &#39;myrepo&#39;...
get dynamodb://$table/$bucket/myrepo
get s3://$bucket/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
get dynamodb://$table/$bucket/myrepo
get s3://$bucket/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
get s3://$bucket/myrepo/0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
git unbundle: 0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
get dynamodb://$table/$bucket/myrepo
get s3://$bucket/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
"><pre><span>&gt;&gt;</span> git init

<span>&gt;&gt;</span> git remote add origin aws://<span>${bucket}</span>+<span>${table}</span>/myrepo

<span>&gt;&gt;</span> mkdir -p <span>~</span>/.git-remote-aws

<span>&gt;&gt;</span> git-remote-aws --keygen <span>~</span>/.git-remote-aws/publickey <span>~</span>/.git-remote-aws/secretkey

<span>&gt;&gt;</span> cat <span>~</span>/.git-remote-aws/publickey <span>&gt;&gt;</span> .publickeys

<span>&gt;&gt;</span> git add <span>.</span>

<span>&gt;&gt;</span> git commit -m init

<span>&gt;&gt;</span> git push -u origin master

creating private s3 bucket: <span>$bucket</span>
lib/s3.go:329: created bucket: <span>$bucket</span>
lib/s3.go:367: created bucket tags for: <span>$bucket</span>
lib/s3.go:415: created public access block <span>for</span> <span>$bucket</span>: private
lib/s3.go:657: created encryption <span>for</span> <span>$bucket</span>: <span>true</span>
lib/s3.go:688: put bucket metrics for: <span>$bucket</span>
created private s3 bucket: <span>$bucket</span>
creating private dynamodb table: <span>$table</span>
lib/dynamodb.go:481: created table: <span>$table</span>
lib/dynamodb.go:974: waiting <span>for</span> table active: <span>$table</span>
lib/dynamodb.go:974: waiting <span>for</span> table active: <span>$table</span>
created private dynamodb table: <span>$table</span>
get dynamodb://<span>$table</span>/<span>$bucket</span>/myrepo
get dynamodb://<span>$table</span>/<span>$bucket</span>/myrepo
get s3://<span>$bucket</span>/
git bundle: 0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
put s3://<span>$bucket</span>/myrepo/0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
put s3://<span>$bucket</span>/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
put dynamodb://<span>$table</span>/<span>$bucket</span>/myrepo
To aws://<span>$bucket</span>+<span>$table</span>/myrepo
 <span>*</span> [new branch]      master -<span>&gt;</span> master

<span>&gt;&gt;</span> libaws s3-ls <span>$bucket</span>/ -r

770 myrepo/0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
 82 myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc

<span>&gt;&gt;</span> libaws dynamodb-item-scan <span>$table</span> <span>|</span> jq <span>.</span>

{
  <span><span>&#34;</span>branch<span>&#34;</span></span>: <span><span>&#34;</span>master<span>&#34;</span></span>,
  <span><span>&#34;</span>bundles<span>&#34;</span></span>: <span><span>&#34;</span>myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc<span>&#34;</span></span>,
  <span><span>&#34;</span>id<span>&#34;</span></span>: <span><span>&#34;</span><span>$bucket</span>/myrepo<span>&#34;</span></span>,
  <span><span>&#34;</span>uid<span>&#34;</span></span>: null,
  <span><span>&#34;</span>unix<span>&#34;</span></span>: 0
}

<span>&gt;&gt;</span> <span>cd</span> <span><span>$(</span>mktemp -d<span>)</span></span>

<span>&gt;&gt;</span> git clone aws://<span>${bucket}</span>+<span>${table}</span>/myrepo

Cloning into <span><span>&#39;</span>myrepo<span>&#39;</span></span>...
get dynamodb://<span>$table</span>/<span>$bucket</span>/myrepo
get s3://<span>$bucket</span>/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
get dynamodb://<span>$table</span>/<span>$bucket</span>/myrepo
get s3://<span>$bucket</span>/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
get s3://<span>$bucket</span>/myrepo/0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
git unbundle: 0000000000000000000000000000000000000000..daf8ea23a2aa082a3eeffacbdda04917d14916cc
get dynamodb://<span>$table</span>/<span>$bucket</span>/myrepo
get s3://<span>$bucket</span>/myrepo/bundles_daf8ea23a2aa082a3eeffacbdda04917d14916cc
</pre></div>
</article>
          </div></div>
  </body>
</html>
