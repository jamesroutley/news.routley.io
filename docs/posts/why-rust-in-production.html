<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://corrode.dev/why-rust/">Original</a>
    <h1>Why Rust in Production?</h1>
    
    <div id="readability-page-1" class="page"><div><p><img src="https://corrode.dev/why-rust/hero.svg" alt="Why Rust?"/></p><p>Interest in Rust has surged in recent years, with tech leaders such as
Microsoft, Google, and Amazon coming forward to share their experiences of
leveraging Rust for critical systems.</p>
<p>Much of the dialogue about Rust, however, is still driven by those who have not
leveraged Rust in a significant production capacity or have only done so for
non-critical systems. This results in a skewed understanding of Rust&#39;s
application in production settings, especially for small and medium-sized
businesses, where discussions tend to highlight performance benefits and gloss
over other crucial aspects.</p>
<p>In my role as a Rust consultant, I have had the opportunity to engage with many
companies, both large and small. I found that companies value productivity,
stability, and long-term maintainability over performance.</p>
<p>Much of my Rust consultancy is under NDA, so I use public data and surveys to
back my insights. I&#39;m working with past clients to share more in the future.</p>
<p>This overview distills key insights, offering a resource for businesses to
assess whether Rust is the right tool for their use-case or not.</p>
<p>The intent is to provide an honest look at Rust&#39;s practicality for production
to help decision-makers understand its benefits and challenges.</p>
<h2 id="reasons-for-using-rust-in-production">Reasons For Using Rust In Production</h2>
<h3 id="reliability-and-stability">Reliability and Stability</h3>
<p>From experience, the majority of companies care less about uncompromising
performance and more about <a href="https://talks.osfc.io/osfc2021/talk/JTWYEH/">reliability and
stability</a> of their services. More
predictable and stable services are easier to maintain and cheaper to operate.
Less time is spent on debugging and on-call, and more time on building new
features. Scaling services is also easier when you know how systems behave under
load. </p>
<blockquote>
<p>Given our small team size, infrastructure reliability is crucial, otherwise,
maintenance starves innovation. Rust provides us with confidence that any code
modification or refactor is likely to produce working programs that will run for
months with minimal supervision. - <a href="https://x.ai/">xAI (formerly Twitter)</a></p>
</blockquote>
<p>This results in real cost savings for companies.</p>
<p>As requirements grow, Rust is a great language for building larger applications
that are maintained by a bigger team over a long period of time. This is due to
its strong type system, its focus on memory safety, its powerful tooling (cargo,
rustfmt, clippy, etc.) and its stability guarantees (backwards compatibility)
due to its edition system. All of that makes large-scale refactoring easier.</p>
<blockquote>
<p>We always talk about the performance gains [...] when using Rust but honestly I
much more look for the stability gains. - <a href="https://www.youtube.com/watch?v=KTJIsicwW5s">Stefan Baumgartner, Senior Product Architect at Dynatrace</a></p>
</blockquote>
<h3 id="predictable-runtime-behavior">Predictable Runtime Behavior</h3>
<p>Predictable runtime behavior is closely related to reliability and stability.
It means that services run smoothly without any hiccups. This is especially
important for latency-sensitive services like games, chat applications, or
services that need to act on real-time data.</p>
<p>Discord has a <a href="https://discord.com/blog/why-discord-is-switching-from-go-to-rust">great
article</a>
about why they switched from Go to Rust. They mention that Go&#39;s garbage
collector was a source of unpredictable latency spikes. After switching to Rust,
they were able to fully get rid of garbage collection and have a more
predictable runtime behavior.</p>
<blockquote>
<p>When we started load testing, we were instantly pleased with the results. The
latency of the Rust version was just as good as Go’s and had no latency spikes!</p>
</blockquote>
<p>Here is a diagram from the above article by Discord.
Notice how the latency spikes in the Go version are gone in the Rust version
and how that impacts the 95th percentile response time, making it much more
predictable and smooth.</p>
<p><img src="https://corrode.dev/why-rust/discord.png" alt="Discord Go vs Rust"/></p><p>Another example is
<a href="https://blog.cloudflare.com/big-pineapple-intro/">Cloudflare</a>,
which uses Rust to power their DNS service, <a href="https://1.1.1.1/">1.1.1.1</a>. They
mention that Rust&#39;s predictable runtime behavior is a big reason for using it:</p>
<blockquote>
<p>One of the things we’ve learned with the previous implementations is that, for
a service open to the public, a peak performance of the I/O matters less than
the ability to pace clients fairly.</p>
</blockquote>
<p>Furthermore, Rust shows excellent runtime behavior when handling network requests.
In a <a href="https://medium.com/star-gazers/benchmarking-low-level-i-o-c-c-rust-golang-java-python-9a0d505f85f">benchmark by Eugene Retunsky</a>, Rust had the lowest tail latency and maximum throughput next to C and C++. </p>
<p>Here is the diagram from the benchmark, showing the p99.9 latency for each
language under test. As the requests per second increase, the latency for Rust
stays low and stable. Go and Java on the other hand have a higher baseline
latency while Python shows latency spikes at a certain point.</p>
<p><img src="https://corrode.dev/why-rust/runtime.png" alt="Rust Runtime behavior"/></p><p>The author concludes:</p>
<blockquote>
<p>In conclusion, Rust has a much lower latency variance than Golang, Python, and especially Java. 
[...] Rust might be a better alternative to Golang, Java, or Python if predictable performance is crucial for your service. Also, before starting to write a new service in C or C++, it’s worth considering Rust. - <a href="https://medium.com/star-gazers/benchmarking-low-level-i-o-c-c-rust-golang-java-python-9a0d505f85f7">Eugene Retunsky</a></p>
</blockquote>
<h3 id="cost-savings">Cost Savings</h3>
<p>Rust has a low runtime overhead. This is especially important for services that
need to scale to handle a large number of requests.
It can save a lot of money on cloud infrastructure costs.</p>
<p>For example, AWS has a service called
<a href="https://aws.amazon.com/blogs/aws/firecracker-lightweight-virtualization-for-serverless-computing/">Firecracker</a>,
which runs virtual machines with very low overhead. It powers AWS Lambda functions and AWS Fargate containers.</p>
<blockquote>
<p>Firecracker consumes about 5 MiB of memory per microVM. You can run thousands
of secure VMs with widely varying vCPU and memory configurations on the same
instance.</p>
</blockquote>
<p>The better hardware utilization translates to lower costs for companies.</p>
<p>Firecracker allowed AWS to improve the efficiency of Fargate and help us pass on cost savings to customers.
As a result, we are reducing the price of Fargate by up to 50%. 
(<a href="https://shahbhargav.medium.com/firecracker-secure-and-fast-microvms-628e6043b572">Image source</a> and
<a href="https://aws.amazon.com/blogs/compute/aws-fargate-price-reduction-up-to-50/">AWS announcement</a>)</p>
<p><img src="https://corrode.dev/why-rust/fargate.png" alt="Firecracker"/></p><h3 id="ergonomics">Ergonomics</h3>
<p>Rust has a great developer experience. Its type system is very powerful and
allows you to encode complex invariants about your system in the type system.
This allows you to catch bugs at compile-time instead of at runtime.</p>
<p>Furthermore, concepts like pattern matching, enums, <code>Result</code> and <code>Option</code> types
allow for concise and expressive code.</p>
<blockquote>
<p>Rust has been a force multiplier for our team, and betting on Rust was one of
the best decisions we made. More than performance, its ergonomics and focus on
correctness has helped us tame sync’s complexity. We can encode complex
invariants about our system in the type system and have the compiler check them
for us. - <a href="https://dropbox.tech/infrastructure/rewriting-the-heart-of-our-sync-engine">Dropbox</a></p>
</blockquote>
<h3 id="focus-on-long-term-sustainability">Focus on Long-Term Sustainability</h3>
<p>Companies rarely rewrite their services in another language. It incurs a lot of costs
and risks. Only if a rewrite promises a <em>significant</em> upside, companies will
consider it.</p>
<p>One well-known company that started to heavily invest in Rust is Microsoft.</p>
<blockquote>
<p>Microsoft is going big on Rust and spending $10 million to make it 1st class
language in our engineering systems + $1 million @rustlang foundation. - <a href="https://twitter.com/dwizzzleMSFT/status/1720134540822520268">David Weston, Vice President of OS Security and Enterprise at Microsoft</a></p>
</blockquote>
<p>Microsoft even <a href="https://twitter.com/markrussinovich/status/1656416376125538304">integrated Rust into the Windows kernel</a>.
The fact that they take big bets on Rust shows that they are in it
for the long run. This is a good sign for the Rust ecosystem, as the backing of
a large company can help Rust to become more mainstream and ensure
long-term sustainability.</p>
<p>Similarly, <a href="https://www.kernel.org/doc/html/next/rust/index.html">the Linux kernel now supports Rust</a>
as well.
The Kernel incorporating Rust is a major endorsement of the language. Notably,
the Linux Kernel maintainers have previously <a href="http://harmful.cat-v.org/software/c++/linus">refused to integrate C++ in the Kernel</a>.</p>
<p>In a landmark development for Rust, the open source <a href="https://ferrous-systems.com/blog/officially-qualified-ferrocene/">Ferrocene
toolchain</a> has
achieved a significant milestone: Ferrocene, based on Rust 1.68, is now ISO
26262 and IEC 61508 qualified. This certification means that the Rust compiler
meets rigorous safety standards, making it fully usable in safety-critical
environments like automotive or avionics. Few other languages have
achieved this level of certification. It is another strong signal that Rust is
here to stay.</p>
<p>For another take on this, watch <a href="https://www.youtube.com/watch?v=WnIWRks35Fk">&#34;In It for the Long
Haul&#34;</a> by <a href="https://twitter.com/carols10cents">Carol
Nichols</a>.</p>
<h3 id="productivity-and-developer-happiness">Productivity And Developer Happiness</h3>
<p>Many developers enjoy working with Rust. It is the most admired language for the
6th year in a row according to the <a href="https://survey.stackoverflow.co/2023/#section-admired-and-desired-programming-scripting-and-markup-languages">StackOverflow Developer Survey</a>.
More than 80% of developers that use it want to use it again next year.</p>
<p>For teams that are looking to hire and retain talent, Rust is a great choice
because developer happiness is a big factor in job satisfaction and has a positive
impact on productivity.</p>
<h3 id="performance-and-energy-efficiency">Performance And Energy Efficiency</h3>
<p>As stated earlier, performance often gets mentioned as a main reason for using Rust.
Rust also has great support for multi-threaded workloads. Libraries like
<a href="https://github.com/rayon-rs/rayon">rayon</a> and <a href="https://tokio.rs/">Tokio</a> are considered
best-in-class for writing high-performance applications.</p>
<p>Making efficient use of compute resources has much deeper implications for
companies than just raw execution speed. One important aspect is energy efficiency.</p>
<p>In the below benchmark, taken from <a href="https://greenlab.di.uminho.pt/wp-content/uploads/2017/10/sleFinal.pdf">&#34;Energy Efficiency across Programming Languages&#34;</a>
by Pereira et al., Rust has superior runtime performance on par with C and C++
and faster than Go by a factor of 2-3x as well as Python by a factor of 70x.</p>
<table><thead><tr><th>Lang</th><th>Time (Normalized)</th></tr></thead><tbody>
<tr><td>C</td><td>1.00</td></tr>
<tr><td>Rust</td><td>1.04</td></tr>
<tr><td>C++</td><td>1.56</td></tr>
<tr><td>Java</td><td>1.89</td></tr>
<tr><td>Go</td><td>2.83</td></tr>
<tr><td>JavaScript</td><td>6.52</td></tr>
<tr><td>PHP</td><td>27.64</td></tr>
<tr><td>Ruby</td><td>59.34</td></tr>
<tr><td>Python</td><td>71.90</td></tr>
</tbody></table>
<p>This translates to lower energy consumption as well. 
Energy is an important cost factor for companies at scale.</p>
<p><img src="https://corrode.dev/why-rust/energy-consumption.svg" alt="Energy Efficiency across Programming Languages"/></p><h2 id="reasons-against-using-rust-in-production">Reasons Against Using Rust In Production</h2>
<h3 id="immature-ecosystem">Immature ecosystem</h3>
<p>Rust is a relatively young language. Version 1.0 was first released in 2015.
This means that the ecosystem is still maturing. Many important libraries <a href="https://www.reddit.com/r/rust/comments/11byl6u/why_is_every_crate_pre10/">did not see their 1.0 release yet</a>.</p>
<p>This phenomenon has been <a href="https://www.reddit.com/r/rust/comments/11byl6u/why_is_every_crate_pre10/ja3auop/">brought up as a reason to be cautious when using Rust in production</a>.</p>
<p>In practice, it might be hard to find production-grade libraries for specific
needs. Your team might be required to write custom crates or improve existing
ones. Furthermore, <a href="https://github.com/sponsors/explore?ecosystem=RUST">sponsoring open source maintainers</a> to work on critical
dependencies is a good way to ensure that the long-term sustainability of the
ecosystem.</p>
<p>That said, libraries for common tasks like JSON parsing or network handling are
very robust and stable and considered best-in-class. Breaking changes are rare
and important crates like <code>serde</code> or <code>tokio</code> are already past their 1.0 release.</p>
<h3 id="lack-of-developers">Lack Of Developers</h3>
<p>Related to the previous point, the Rust community is still relatively small.
It is hard to find developers with professional Rust experience. </p>
<p>From talking to companies that use Rust in production, I found that they are
mostly training their developers on the job.
Moreover, Rust is noted for enabling a smooth onboarding process for engineers
already proficient in languages like C++ or Java.</p>
<p>On the other hand, Rust developers are generally very passionate about their
craft and are actively seeking out jobs that allow them to use Rust,
so the market for Rust developers is growing. (Also see
the previous section about developer happiness.)</p>
<blockquote>
<p>Rust has more than tripled the size of its community over the past two years
and currently has 3.7M users, of which 0.6M joined in the last six months
alone.[...] Furthermore, Rust has built a loyal community of developers who care
about memory safety and security. - <a href="https://www.developernation.net/resources/reports/state-of-the-developer-nation-24th-edition-q1-2023">State of the Developer Nation 24th Edition - Q1 2023 report</a></p>
</blockquote>
<p><a href="https://www.developernation.net/resources/reports/state-of-the-developer-nation-24th-edition-q1-2023" target="_blank">
<img src="https://corrode.dev/why-rust/communities.svg" alt="Programming Language Communities Size"/>
</a></p><h3 id="tooling">Tooling</h3>
<p>Cargo, rustfmt, clippy, and rust-analyzer
are all great tools that make Rust development a joy. 
However, <a href="https://rustc-dev-guide.rust-lang.org/debugging-support-in-rustc.html">debugging support is still lacking</a>.
<a href="https://www.jetbrains.com/lp/devecosystem-2021/rust/">The story for profiling support is similar.</a></p>
<p>Recently, <a href="https://www.jetbrains.com/rust/">JetBrains announced RustRover</a>,
a new IDE for Rust which is based on IntelliJ.
This is a strong signal that JetBrains sees it as a good investment to build
tooling for Rust developers and that they expect Rust to become more mainstream.</p>
<h3 id="learning-curve">Learning Curve</h3>
<p>Rust has a famously steep learning curve. It is a complex language with many
advanced features. </p>
<p>When asked why they don&#39;t use Rust, participants of the <a href="https://blog.rust-lang.org/2023/08/07/Rust-Survey-2023-Results.html#rust-usage">2022 Annual Rust Survey</a>
mentioned the learning curve as the main reason:</p>
<p><img src="https://corrode.dev/why-rust/why-not-rust.svg" alt="Why not Rust?"/></p><p>In the <a href="https://blog.rust-lang.org/2020/12/16/rust-survey-2020.html#improved-learnability">Rust 2020
survey</a>,
participants were asked to rate the difficulty of various Rust concepts. Here
are the results:</p>
<p><img src="https://corrode.dev/why-rust/topic-difficulty-ratings.svg" alt="Difficulty by topic"/></p><p>Lifetime annotations, ownership, and borrowing were mentioned as the most
difficult topics to grasp. In real-world applications, lifetimes
are less of an issue, however, as the compiler can often infer them through
<a href="https://doc.rust-lang.org/reference/lifetime-elision.html">lifetime elision</a>.
Ownership and borrowing however are crucial concepts in Rust that need to be 
understood to become proficient.</p>
<p>It is important to set clear expectations for your team when adopting Rust: Rust
is not a language that you can learn in a few days. It requires practice to internalize
the concepts around ownership and borrowing to become productive with it.
Typically, it takes a few months to become productive with Rust:</p>
<blockquote>
<p>Based on our studies, more than 2/3 of respondents are confident in
contributing to a Rust codebase within two months or less when learning Rust.
Further, a third of respondents become as productive using Rust as other
languages in two months or less. <strong>Within four months, that number increased to
over 50%.</strong> - <a href="https://opensource.googleblog.com/2023/06/rust-fact-vs-fiction-5-insights-from-googles-rust-journey-2022.html">Google</a></p>
</blockquote>
<p>Depending on your immediate needs, this might be a deal-breaker for your team.
Other languages like Go or Python have a much lower learning curve and are
a better fit for rapid prototyping.</p>
<h3 id="compile-times">Compile Times</h3>
<p>Rust has a reputation for having long compile times. This is especially true for
large projects with many dependencies.</p>
<blockquote>
<p>Slow build speeds were by far the #1 reported challenge that developers have
when using Rust, with only a little more than 40% of respondents finding the
speed acceptable. - <a href="https://opensource.googleblog.com/2023/06/rust-fact-vs-fiction-5-insights-from-googles-rust-journey-2022.html">Google</a></p>
</blockquote>
<p>Rapid iteration is important for developers. Long compile times can be a
productivity killer. This is especially true for developers that are used to
languages like Go or Python, where the feedback loop is much faster.</p>
<p>Compile times are a known issue and the Rust team is <a href="https://nnethercote.github.io/2023/03/24/how-to-speed-up-the-rust-compiler-in-march-2023.html">working on improving them</a>.
For advice on how to improve compile times, see <a href="https://endler.dev/2020/rust-compile-times/">my article on this topic</a> with many practical tips.
For medium-sized projects, compile times are less of an issue. 
<a href="https://www.reddit.com/r/rust/comments/qgi421/doing_m1_macbook_pro_m1_max_64gb_compile/">Modern hardware can also mitigate the issue to some extent.</a></p>
<h2 id="conclusion">Conclusion</h2>
<p>Rust is a great language for building large-scale, reliable, and stable
applications. It is a good fit for companies that value productivity and
developer happiness and see it as a long-term investment.</p>
<p>On the other side, Rust is still a young language and the ecosystem is still
maturing. It has a steep learning curve and long compile times.</p>
<p>These challenges are not insurmountable, however. They require a commitment to
Rust and a willingness to invest in training and tooling.</p>
<p>Navigating the decision to integrate Rust into your technology stack is pivotal
and requires thoughtful consideration. Should you find yourself weighing its
benefits against your specific requirements, professional guidance can prove
invaluable. Equally, if you are ready to embrace Rust and are seeking expertise
in training or consulting to ensure a smooth transition, specialized support is
essential.</p>
<p><a href="https://corrode.dev/about/">Get in touch with me</a> to explore how Rust can contribute to your long-term success. </p>
<h2 id="further-reading">Further Reading</h2>
<ul>
<li><a href="https://opensource.googleblog.com/2023/06/rust-fact-vs-fiction-5-insights-from-googles-rust-journey-2022.html" target="_blank">Rust Fact vs. Fiction: 5 Insights from Google’s Rust Journey</a></li>
<li><a href="https://survey.stackoverflow.co/" target="_blank">StackOverflow Developer Surveys</a></li>
<li><a href="https://blog.rust-lang.org/2023/08/07/Rust-Survey-2023-Results.html" target="_blank">Annual Rust Survey Results</a></li>
</ul>
<hr/>
<p><small>
Title image modified from
<a href="https://www.freepik.com/free-vector/metallurgical-industry-company-isometric-vector-web-banner-with-pouring-molten-metal-from-steel-ladl_4015233.htm#page=2&amp;query=rust%20in%20production&amp;position=28&amp;from_view=search&amp;track=ais" target="_blank" rel="noopener noreferrer">vectorpouch</a> on Freepik
</small></p></div></div>
  </body>
</html>
