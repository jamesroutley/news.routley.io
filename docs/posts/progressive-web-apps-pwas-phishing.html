<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mrd0x.com/progressive-web-apps-pwa-phishing/">Original</a>
    <h1>Progressive Web Apps (PWAs) Phishing</h1>
    
    <div id="readability-page-1" class="page"><article><div><p>Phishing with Progressive Web Apps and UI manipulation<!-- end -->.</p>

<p>Progressive Web Apps or PWAs are applications that are built using web technologies (i.e. HTML, CSS, JavaScript) that can be installed and behave similarly to native applications. PWAs integrate with the OS better (i.e. they have their own app icon, can push notifications) and therefore they can lead to higher engagement for websites. The issue with PWAs is that manipulating the UI for phishing purposes is possible as we’ll explore in this blog.</p>
<p><span>
      <a href="https://mrd0x.com/static/151c36cbf7ed86ee2d62593060e7f3ae/6edca/intro-img.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Intro-img" title="Intro-img" src="https://mrd0x.com/static/151c36cbf7ed86ee2d62593060e7f3ae/8c557/intro-img.png" srcset="/static/151c36cbf7ed86ee2d62593060e7f3ae/4edbd/intro-img.png 175w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/13ae7/intro-img.png 350w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/8c557/intro-img.png 700w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/e996b/intro-img.png 1050w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/6edca/intro-img.png 1351w" sizes="(max-width: 700px) 100vw, 700px" loading="lazy"/>
  </a>
    </span></p>

<p>Before showing an attack scenario using a PWA, we’ll need to understand how to create one. Feel free to skip this section as I provide a working template on my GitHub for testing at the end of this post. At a basic level, a PWA requires the following files:</p>
<ol>
<li>Manifest File - The manifest is a JSON file that provides metadata about the web application. It allows the app to be installed on the user’s home screen.</li>
</ol>
<div data-language="json"><pre><code><span>{</span>
  <span>&#34;name&#34;</span><span>:</span> <span>&#34;Microsoft Login&#34;</span><span>,</span>
  <span>&#34;short_name&#34;</span><span>:</span> <span>&#34;Microsoft&#34;</span><span>,</span>
  <span>&#34;start_url&#34;</span><span>:</span> <span>&#34;/&#34;</span><span>,</span>
  <span>&#34;display&#34;</span><span>:</span> <span>&#34;standalone&#34;</span><span>,</span>
  <span>&#34;background_color&#34;</span><span>:</span> <span>&#34;#ffffff&#34;</span><span>,</span>
  <span>&#34;theme_color&#34;</span><span>:</span> <span>&#34;#000000&#34;</span><span>,</span>
  <span>&#34;icons&#34;</span><span>:</span> <span>[</span>
    <span>{</span>
      <span>&#34;src&#34;</span><span>:</span> <span>&#34;/images/icons/icon-192x192.png&#34;</span><span>,</span>
      <span>&#34;sizes&#34;</span><span>:</span> <span>&#34;192x192&#34;</span><span>,</span>
      <span>&#34;type&#34;</span><span>:</span> <span>&#34;image/png&#34;</span>
    <span>}</span><span>,</span>
    <span>{</span>
      <span>&#34;src&#34;</span><span>:</span> <span>&#34;/images/icons/icon-512x512.png&#34;</span><span>,</span>
      <span>&#34;sizes&#34;</span><span>:</span> <span>&#34;512x512&#34;</span><span>,</span>
      <span>&#34;type&#34;</span><span>:</span> <span>&#34;image/png&#34;</span>
    <span>}</span>
  <span>]</span>
<span>}</span></code></pre></div>
<ol start="2">
<li>Service Worker - A script that the browser runs in the background. This is used for enabling offline capabilities, push notifications, and background sync.</li>
</ol>
<div data-language="javascript"><pre><code>self<span>.</span><span>addEventListener</span><span>(</span><span>&#39;install&#39;</span><span>,</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
  event<span>.</span><span>waitUntil</span><span>(</span>
    caches<span>.</span><span>open</span><span>(</span><span>&#39;v1&#39;</span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>cache</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>return</span> cache<span>.</span><span>addAll</span><span>(</span><span>[</span>
        <span>&#39;/&#39;</span><span>,</span>
        <span>&#39;/index.html&#39;</span><span>,</span>
        <span>&#39;/styles.css&#39;</span><span>,</span>
        <span>&#39;/app.js&#39;</span><span>,</span>
        <span>&#39;/images/icons/icon-192x192.png&#39;</span><span>,</span>
        <span>&#39;/images/icons/icon-512x512.png&#39;</span>
      <span>]</span><span>)</span><span>;</span>
    <span>}</span><span>)</span>
  <span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

self<span>.</span><span>addEventListener</span><span>(</span><span>&#39;fetch&#39;</span><span>,</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
  event<span>.</span><span>respondWith</span><span>(</span>
    caches<span>.</span><span>match</span><span>(</span>event<span>.</span>request<span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>response</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>return</span> response <span>||</span> <span>fetch</span><span>(</span>event<span>.</span>request<span>)</span><span>;</span>
    <span>}</span><span>)</span>
  <span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre></div>
<ol start="3">
<li>HTML File - The main HTML file links the manifest and registers the service worker.</li>
</ol>
<div data-language="html"><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>&gt;</span></span>
<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>&#34;</span>en<span>&#34;</span></span><span>&gt;</span></span>
<span><span><span>&lt;</span>head</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>&#34;</span>UTF-8<span>&#34;</span></span><span>&gt;</span></span>
  <span><span><span>&lt;</span>meta</span> <span>name</span><span><span>=</span><span>&#34;</span>viewport<span>&#34;</span></span> <span>content</span><span><span>=</span><span>&#34;</span>width=device-width, initial-scale=1.0<span>&#34;</span></span><span>&gt;</span></span>
  <span><span><span>&lt;</span>link</span> <span>rel</span><span><span>=</span><span>&#34;</span>manifest<span>&#34;</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/manifest.json<span>&#34;</span></span><span>&gt;</span></span>
  <span><span><span>&lt;</span>title</span><span>&gt;</span></span>Example PWA<span><span><span>&lt;/</span>title</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>head</span><span>&gt;</span></span>
<span><span><span>&lt;</span>body</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>script</span><span>&gt;</span></span><span><span>
    <span>if</span> <span>(</span><span>&#39;serviceWorker&#39;</span> <span>in</span> navigator<span>)</span> <span>{</span>
      navigator<span>.</span>serviceWorker<span>.</span><span>register</span><span>(</span><span>&#39;/service-worker.js&#39;</span><span>)</span>
      <span>.</span><span>then</span><span>(</span><span>(</span><span>registration</span><span>)</span> <span>=&gt;</span> <span>{</span>
        console<span>.</span><span>log</span><span>(</span><span>&#39;Service Worker registered with scope:&#39;</span><span>,</span> registration<span>.</span>scope<span>)</span><span>;</span>
      <span>}</span><span>)</span><span>.</span><span>catch</span><span>(</span><span>(</span><span>error</span><span>)</span> <span>=&gt;</span> <span>{</span>
        console<span>.</span><span>error</span><span>(</span><span>&#39;Service Worker registration failed:&#39;</span><span>,</span> error<span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>
  </span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>body</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>html</span><span>&gt;</span></span></code></pre></div>
<ol start="4">
<li>Styles and Scripts - Any additional CSS and JavaScript files for the PWA to function correctly.</li>
</ol>

<p>Now that we understand how a PWA file is created, we can start weaponizing it for phishing. We will perform the following attack scenario:</p>
<ol>
<li>Victim accesses an attacker-controlled website.</li>
<li>Victim clicks an “Install Microsoft Application” button.</li>
<li>A browser pop-up appears asking the user to install the application. We can name our application anything such as “Microsoft Login” or “login.microsoftonline.com”. Keep in mind that our real domain name will show in smaller font underneath.</li>
<li>Victim installs application.</li>
<li>Upon successful installation, redirect the PWA window to a phishing page with a fake URL bar attached to the top of the page.</li>
</ol>
<p>Needless to say, this scenario can be tailored to any other company besides Microsoft.</p>
<h2>Step 1 - Setting Up Landing Page</h2>
<p>We start by creating our landing page with the “Install Microsoft Application” button.</p>
<p><span>
      <a href="https://mrd0x.com/static/634548dd12c937d59cc22f7b1afedfab/3e096/step1.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Step1" title="Step1" src="https://mrd0x.com/static/634548dd12c937d59cc22f7b1afedfab/8c557/step1.png" srcset="/static/634548dd12c937d59cc22f7b1afedfab/4edbd/step1.png 175w,
/static/634548dd12c937d59cc22f7b1afedfab/13ae7/step1.png 350w,
/static/634548dd12c937d59cc22f7b1afedfab/8c557/step1.png 700w,
/static/634548dd12c937d59cc22f7b1afedfab/e996b/step1.png 1050w,
/static/634548dd12c937d59cc22f7b1afedfab/2cefc/step1.png 1400w,
/static/634548dd12c937d59cc22f7b1afedfab/3e096/step1.png 1718w" sizes="(max-width: 700px) 100vw, 700px" loading="lazy"/>
  </a>
    </span></p>
<h2>Step 2 - Installing Application</h2>
<p>Clicking the “Install Microsoft Application” button prompts the user to install our PWA application.</p>
<ul>
<li>The application’s name is “Microsoft Login”.</li>
<li>The Microsoft logo is our application’s icon, which is set through the manifest file.</li>
</ul>
<p><span>
      <a href="https://mrd0x.com/static/2c607e9e973c019a316b35e8396cfc3b/a3bed/step2.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Step2" title="Step2" src="https://mrd0x.com/static/2c607e9e973c019a316b35e8396cfc3b/8c557/step2.png" srcset="/static/2c607e9e973c019a316b35e8396cfc3b/4edbd/step2.png 175w,
/static/2c607e9e973c019a316b35e8396cfc3b/13ae7/step2.png 350w,
/static/2c607e9e973c019a316b35e8396cfc3b/8c557/step2.png 700w,
/static/2c607e9e973c019a316b35e8396cfc3b/e996b/step2.png 1050w,
/static/2c607e9e973c019a316b35e8396cfc3b/2cefc/step2.png 1400w,
/static/2c607e9e973c019a316b35e8396cfc3b/a3bed/step2.png 1721w" sizes="(max-width: 700px) 100vw, 700px" loading="lazy"/>
  </a>
    </span></p>
<h2>Step 3 - Redirection</h2>
<p>After the application is successfully installed, redirect the user to the phishing page with a fake URL bar.</p>
<p><span>
      <a href="https://mrd0x.com/static/151c36cbf7ed86ee2d62593060e7f3ae/6edca/intro-img.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Step3" title="Step3" src="https://mrd0x.com/static/151c36cbf7ed86ee2d62593060e7f3ae/8c557/intro-img.png" srcset="/static/151c36cbf7ed86ee2d62593060e7f3ae/4edbd/intro-img.png 175w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/13ae7/intro-img.png 350w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/8c557/intro-img.png 700w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/e996b/intro-img.png 1050w,
/static/151c36cbf7ed86ee2d62593060e7f3ae/6edca/intro-img.png 1351w" sizes="(max-width: 700px) 100vw, 700px" loading="lazy"/>
  </a>
    </span></p>

<p>The demo below performs the previously mentioned steps but instead redirects users to a fake Microsoft phishing page that captures credentials. For higher quality <a href="https://mrd0x.com/e0754388117fc505ce247564b67f9891/demo.mp4">use this</a>.</p>
<p><img src="https://mrd0x.com/dbfe055166ee2415e129ff927b18dbb3/demo.gif" alt="Demo"/></p>

<p>Notice how the application’s icon is set to the Microsoft Logo, making it more realistic.</p>
<p><span>
      <a href="https://mrd0x.com/static/2695d3b302f8708eb92f531fdca7db8a/fe8a7/app-icon.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Step3" title="Step3" src="https://mrd0x.com/static/2695d3b302f8708eb92f531fdca7db8a/8c557/app-icon.png" srcset="/static/2695d3b302f8708eb92f531fdca7db8a/4edbd/app-icon.png 175w,
/static/2695d3b302f8708eb92f531fdca7db8a/13ae7/app-icon.png 350w,
/static/2695d3b302f8708eb92f531fdca7db8a/8c557/app-icon.png 700w,
/static/2695d3b302f8708eb92f531fdca7db8a/e996b/app-icon.png 1050w,
/static/2695d3b302f8708eb92f531fdca7db8a/fe8a7/app-icon.png 1223w" sizes="(max-width: 700px) 100vw, 700px" loading="lazy"/>
  </a>
    </span></p>

<p>I’ve included the demonstration PoC on my GitHub. You can find the files <a href="https://github.com/mrd0x/PWA-Phishing">here</a>.</p>

<p>As we saw, PWAs open up the path for UI manipulation that can trick users into believing they’re on a different website. This technique clearly has some disadvantages such as the requirement of the target user to install the application. Additionally, the PWA window briefly displays the actual domain name in the top right corner. However, I believe people’s habits of checking the URL bar will lead them to disregard that domain name (security awareness is required for this).</p>
<p>It may also be worth mentioning that prior to posting this blog I did find someone raising a <a href="https://github.com/w3c/manifest/issues/747">security concern</a> regarding the abuse of PWA for phishing back in 2018.</p></div></article></div>
  </body>
</html>
