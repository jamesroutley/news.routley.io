<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tylercipriani.com/blog/2024/10/24/plain-text-accounting/">Original</a>
    <h1>Eventually consistent plain text accounting</h1>
    
    <div id="readability-page-1" class="page"><article class="page">







<div id="pagebody">

<section id="content" role="main">

<figure>
<img src="https://photos.tylercipriani.com/2024-11-08_expenses.png" alt="Spending for October, generated by piping hledger → R"/>
<figcaption aria-hidden="true">Spending for October, generated by piping
hledger → R</figcaption>
</figure>
<p>Over the past six months, I’ve tracked my money with <a href="https://hledger.org/"><code>hledger</code></a>—a plain text
double-entry accounting system written in Haskell. It’s been
surprisingly painless.</p>
<p>My previous attempts to pick up <em>real</em> accounting tools
floundered. Hosted tools are privacy nightmares, and my stint with <a href="https://gnucash.org/">GnuCash</a> didn’t last.</p>
<p>But after stumbling on Dmitry Astapov’s “<a href="https://github.com/adept/full-fledged-hledger/wiki/">Full-fledged
<code>hledger</code></a>” wiki<a href="#fn1" id="fnref1" role="doc-noteref"><sup>1</sup></a>, it
clicked—<strong>eventually consistent</strong> accounting. Instead of
modeling your money all at once, take it one hacking session at a
time.</p>
<blockquote>
<p>It should be easy to work towards eventual consistency. […] I should
be able to [add financial records] bit by little bit, leaving things
half-done, and picking them up later with little (mental) effort.</p>
<p>– Dmitry Astapov, Full-Fledged Hledger</p>
</blockquote>
<section id="principles-of-my-system">
<h2>Principles of my system</h2>
<p>I’ve cobbled together a system based on these principles:</p>
<ul>
<li><strong>Avoid manual entry</strong> – Avoid typing in each
transaction. Instead, rely on CSVs from the bank.</li>
<li><strong>CSVs as truth</strong> – CSVs are the only things that
matter. Everything else can be blown away and rebuilt anytime.</li>
<li><strong>Embrace version control</strong> – Keep everything under
version control in Git for easy comparison and safe
experimentation.</li>
</ul>
</section>
<section id="learn-hledger-in-five-minutes">
<h2>Learn <code>hledger</code> in five minutes</h2>
<p><code>hledger</code> concepts are heady, but its use is simple. I
divide the core concepts into two categories:</p>
<ul>
<li>Stuff <code>hledger</code> cares about:
<ul>
<li><strong>Transactions</strong> – how <code>hledger</code> moves money
between accounts.</li>
<li><strong>Journal files</strong> – files full of transactions</li>
</ul></li>
<li>Stuff I care about:
<ul>
<li><strong>Rules files</strong> – how I set up accounts, import CSVs,
and move money between accounts.</li>
<li><strong>Reports</strong> – help me see where my money is going and
if I messed up my rules.</li>
</ul></li>
</ul>
<p><strong>Transactions</strong> move money between accounts:</p>
<pre><code>2024-01-01 Payday
    income:work      $-100.00
    assets:checking   $100.00</code></pre>
<p>This transaction shows that on Jan 1, 2024, money moved from
<code>income:work</code> into <code>assets:checking</code>—Payday.</p>
<p>The sum of each transaction should be $0. Money comes from somewhere,
and the same amount goes somewhere else—double-entry accounting. This is
powerful technology—it makes mistakes impossible to ignore.</p>
<p><strong>Journal files</strong> are text files containing one or more
transactions:</p>
<pre><code>2024-01-01 Payday
    income:work              $-100.00
    assets:checking           $100.00
2024-01-02 QUANSHENG UVK5
    assets:checking          $-29.34
    expenses:fun:radio        $29.34</code></pre>
<p><strong>Rules files</strong> transform CSVs into journal files via
regex matching.</p>
<p>Here’s a CSV from my bank:</p>
<pre><code>Transaction Date,Description,Category,Type,Amount,Memo
09/01/2024,DEPOSIT Paycheck,Payment,Payment,1000.00,
09/04/2024,PizzaPals Pizza,Food &amp; Drink,Sale,-42.31,
09/03/2024,Amazon.com*XXXXXXXXY,Shopping,Sale,-35.56,
09/03/2024,OBSIDIAN.MD,Shopping,Sale,-10.00,
09/02/2024,Amazon web services,Personal,Sale,-17.89,</code></pre>
<p>And here’s a <code>checking.rules</code> to transform that CSV into a
journal file so I can use it with <code>hledger</code>:</p>
<pre><code># checking.rules
# --------------
# Map CSV fields → hledger fields[0]
fields date,description,category,type,amount,memo,_
# `account1`: the account for the whole CSV.[1]
account1    assets:checking
account2    expenses:unknown
skip 1

date-format %m/%d/%Y
currency $

if %type Payment
    account2 income:unknown
if %category Food &amp; Drink
    account2 expenses:food:dining

# [0]: &lt;https://hledger.org/hledger.html#field-names&gt;
# [1]: &lt;https://hledger.org/hledger.html#account-field&gt;</code></pre>
<p>With these two files (<code>checking.rules</code> and
<code>2024-09_checking.csv</code>), I can make the CSV into a
journal:</p>
<pre><code>$ &gt; 2024-09_checking.journal \
    hledger print \
    --rules-file checking.rules \
    -f 2024-09_checking.csv
$ head 2024-09_checking.journal
2024-09-01 DEPOSIT Paycheck
    assets:checking        $1000.00
    income:unknown        $-1000.00

2024-09-02 Amazon web services
    assets:checking          $-17.89
    expenses:unknown          $17.89</code></pre>
<p><strong>Reports</strong> are interesting ways to view transactions
between accounts.</p>
<p>There are registers, balance sheets, and income statements:</p>
<pre><code>$ hledger incomestatement \
    --depth=2 \
    --file=2024-09_bank.journal

Revenues:
               $1000.00 income:unknown
-----------------------
               $1000.00


Expenses:
                 $42.31 expenses:food
                 $63.45 expenses:unknown
-----------------------
                $105.76
-----------------------
Net:            $894.24</code></pre>
<p>At the beginning of September, I spent <code>$105.76</code> and made
<code>$1000</code>, leaving me with <code>$894.24</code>.</p>
<p>But a good chunk is going to the default expense account,
<code>expenses:unknown</code>. I can use the
<code>hleger aregister</code> to see what those transactions are:</p>
<pre><code>$ hledger areg expenses:unknown \
    --file=2024-09_checking.journal \
    -O csv | \
  csvcut -c description,change | \
  csvlook
| description              | change |
| ------------------------ | ------ |
| OBSIDIAN.MD              |  10.00 |
| Amazon web services      |  17.89 |
| Amazon.com*XXXXXXXXY     |  35.56 |
l</code></pre>
<p>Then, I can add some more rules to my
<code>checking.rules</code>:</p>
<pre><code>if OBSIDIAN.MD
    account2 expenses:personal:subscriptions
if Amazon web services
    account2 expenses:personal:web:hosting
if Amazon.com
    account2 expenses:personal:shopping:amazon</code></pre>
<p>Now, I can reprocess my data to get a better picture of my
spending:</p>
<pre><code>$ &gt; 2024-09_bank.journal \
    hledger print \
    --rules-file bank.rules \
    -f 2024-09_bank.csv
$ hledger bal expenses \
    --depth=3 \
    --percent \
    -f 2024-09_checking2.journal
              30.0 %  expenses:food:dining
              33.6 %  expenses:personal:shopping
               9.5 %  expenses:personal:subscriptions
              16.9 %  expenses:personal:web
--------------------
             100.0 %</code></pre>
<p>For the Amazon.com purchase, I lumped it into the
<code>expenses:personal:shopping</code> account. But I could dig
deeper—download <a href="https://www.amazon.com/hz/privacy-central/data-requests/preview.html">my
order history from Amazon</a> and categorize that spending.</p>
<p>This is the power of working bit-by-bit—the data guides you to the
next, deeper rabbit hole.</p>
</section>
<section id="goals-and-non-goals">
<h2>Goals and non-goals</h2>
<p>Why am I doing this? For years, I maintained a monthly spreadsheet of
account balances. I had a balance sheet. But I still had questions.</p>
<figure>
<img src="https://photos.tylercipriani.com/2024-11-04_hledger-gnuplot-avg.png" alt="Spending over six months, generated by piping hledger → gnuplot"/>
<figcaption aria-hidden="true">Spending over six months, generated by
piping hledger → gnuplot</figcaption>
</figure>
<p>Before diving into accounting software, these were my goals:</p>
<ul>
<li><strong>Granular understanding of my spending</strong> – The big
one. This is where my monthly spreadsheet fell short. I knew I had money
in the bank—I kept my monthly balance sheet. I budgeted up-front the %
of my income I was saving. But I had no idea where my <em>other
money</em> was going.</li>
<li><strong>Data privacy</strong> – I’m unwilling to hand the keys to my
accounts to YNAB or Mint.</li>
<li><strong>Increased value over time</strong> – The more time I put in,
the more value I want to get out—this is what you get from professional
tools built for nerds. While I wished for low-effort setup, I wanted the
tool to be able to grow to more uses over time.</li>
</ul>
<p><strong>Non-goals</strong>—these are the parts I never cared
about:</p>
<ul>
<li><strong>Investment tracking</strong> – For now, I left this out of
scope. Between monthly balances in my spreadsheet and online investing
tools’ ability to drill down, I was fine.<a href="#fn2" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li><strong>Taxes</strong> – Folks smarter than me help me understand my
yearly taxes.<a href="#fn3" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
<li><strong>Shared system</strong> – I may want to share reports from
this system, but no one will have to work in it except me.</li>
<li><strong>Cash</strong> – Cash transactions are unimportant to me. I
withdraw money from the ATM sometimes. It evaporates.</li>
</ul>
<p><code>hledger</code> can track all these things. My setup is flexible
enough to support them someday. But that’s unimportant to me right
now.</p>
</section>
<section id="monthly-maintenance">
<h2>Monthly maintenance</h2>
<p>I spend about an hour a month checking in on my money Which frees me
to spend time making fancy charts—an activity I <a href="https://gist.github.com/thcipriani/9cd0a0e1e6d42fe27483d0a84b7de33d">perversely
enjoy</a>.</p>
<figure>
<img src="http://photos.tylercipriani.com/2024-11-12_hledger-gnuplot-cashflow.png" alt="Income vs. Expense, generated by piping hledger → gnuplot"/>
<figcaption aria-hidden="true">Income vs. Expense, generated by piping
hledger → gnuplot</figcaption>
</figure>
<p>Here’s my setup:</p>
<pre><code>$ tree ~/Documents/ledger
.
├── export
│   ├── 2024-balance-sheet.txt
│   └── 2024-income-statement.txt
├── import
│   ├── in
│   │   ├── amazon
│   │   │   └── order-history.csv
│   │   ├── credit
│   │   │   ├── 2024-01-01_2024-02-01.csv
│   │   │   ├── ...
│   │   │   └── 2024-10-01_2024-11-01.csv
│   │   └── debit
│   │       ├── 2024-01-01_2024-02-01.csv
│   │       ├── ...
│   │       └── 2024-10-01_2024-11-01.csv
│   └── journal
│       ├── amazon
│       │   └── order-history.journal
│       ├── credit
│       │   ├── 2024-01-01_2024-02-01.journal
│       │   ├── ...
│       │   └── 2024-10-01_2024-11-01.journal
│       └── debit
│           ├── 2024-01-01_2024-02-01.journal
│           ├── ...
│           └── 2024-10-01_2024-11-01.journal
├── rules
│   ├── amazon
│   │   └── journal.rules
│   ├── credit
│   │   └── journal.rules
│   ├── debit
│   │   └── journal.rules
│   └── common.rules
├── 2024.journal
├── Makefile
└── README</code></pre>
<p>Process:</p>
<ol type="1">
<li><strong>Import</strong> – download a CSV for the month from each
account and plop it into
<code>import/in/&lt;account&gt;/&lt;dates&gt;.csv</code></li>
<li><strong>Make</strong> – run <code>make</code></li>
<li><strong>Squint</strong> – Look at <code>git diff</code>; if it looks
good, <code>git add . &amp;&amp; git commit -m &#34;💸&#34;</code> otherwise
review <code>hledger areg</code> to see details.</li>
</ol>
<p>The <code>Makefile</code> generates everything under
<code>import/journal</code>:</p>
<ul>
<li>journal files from my CSVs using their corresponding rules.</li>
<li>reports in the <code>export</code> folder</li>
</ul>
<p>I include all the journal files in the <code>2024.journal</code> with
the line: <code>include ./import/journal/*/*.journal</code></p>
<p>Here’s the <code>Makefile</code>:</p>
<div id="cb11"><pre><code><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span>SHELL </span><span>:=</span><span> /bin/bash</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span>RAW_CSV </span><span>=</span><span> </span><span>$(</span><span>wildcard</span><span> import/in/**/*.csv</span><span>)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span>JOURNALS </span><span>=</span><span> </span><span>$(</span><span>foreach</span><span> file</span><span>,</span><span>$(</span><span>RAW_CSV</span><span>)</span><span>,</span><span>$(</span><span>subst</span><span> /in/</span><span>,</span><span>/journal/</span><span>,</span><span>$(</span><span>patsubst</span><span> %.csv</span><span>,</span><span>%.journal</span><span>,</span><span>$(</span><span>file</span><span>))))</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span>.PHONY:</span><span> all</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span>all:</span><span> </span><span>$(</span><span>JOURNALS</span><span>)</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    hledger is -f 2024.journal &gt; export/2024-income-statement.txt</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    hledger bs -f 2024.journal &gt; export/2024-balance-sheet.txt</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span>.PHONY</span> <span>clean</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span>clean:</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        rm -rf import/journal/**/*.journal</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span>import/journal/%.journal:</span><span> import/in/%.csv</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span>@</span><span>echo </span><span>&#34;Processing csv </span><span>$&lt;</span><span> to </span><span>$@</span><span>&#34;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span>@</span><span>echo </span><span>&#34;---&#34;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span>@</span><span>mkdir -p </span><span>$(</span><span>shell</span><span> dirname </span><span>$@)</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span>@</span><span>hledger print --rules-file rules/</span><span>$(</span><span>shell</span><span> basename </span><span>$$</span><span>(dirname </span><span>$&lt;)</span><span>)/journal.rules -f </span><span>&#34;</span><span>$&lt;</span><span>&#34;</span><span> &gt; </span><span>&#34;</span><span>$@</span><span>&#34;</span></span></code></pre></div>
<p>If I find anything amiss (e.g., if my balances are different than
what the bank tells me), I look at <code>hleger areg</code>. I may tweak
my rules or my CSVs and then I run
<code>make clean &amp;&amp; make</code> and try again.</p>
<p>Simple, plain text accounting made simple.</p>
<p>And if I ever want to dig deeper, <code>hledger</code>’s <a href="https://hledger.org/1.40/hledger.html">docs</a> have more to
teach. But for now, the balance of effort vs. reward is perfect.</p>
</section>


</section>









</div>



</article></div>
  </body>
</html>
