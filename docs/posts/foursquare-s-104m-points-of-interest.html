<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tech.marksblogg.com/foursquare-open-global-poi-dataset.html">Original</a>
    <h1>Foursquare&#39;s 104M Points of Interest</h1>
    
    <div id="readability-page-1" class="page"><div id="article_text">
            <p>Point of Interest (POI) datasets of any strong quality have rarely been published freely. Overture and OpenStreetMap (OSM) have been making inroads but even in 2021, I could only find half of Starbucks&#39; locations in OSM.</p>
<p>Companies that produce these datasets can charge yearly rental fees that run into the 6-figure territory.</p>
<p>I&#39;ve worked with a few of these commercial feeds. On their own, they&#39;re not great for plotting POIs on maps but they&#39;re invaluable for building geocoding systems.</p>
<p>This week, Foursquare announced they&#39;re making their POI dataset freely available. I was really surprised to hear this as I suspect they were earning a good amount of revenue from this dataset and there isn&#39;t a lot of competition from the freely available datasets.</p>
<p>In this post, I&#39;ll dive into Foursquare&#39;s newly open POI dataset.</p>
<div id="thank-you-fused">
<h2>Thank you, Fused</h2>
<p>I&#39;d like to thank <a href="https://www.linkedin.com/in/skashuk/">Sina Kashuk</a> for publishing Foursquare&#39;s POI dataset to the <a href="https://source.coop/repositories/fused/fsq-os-places/description">Source Cooperative</a> site. I&#39;d also like to thank his co-founder <a href="https://www.linkedin.com/in/isaacbrodsky/">Isaac Brodsky</a> for granting me access to their geospatial computing platform <a href="https://www.fused.io/">Fused</a>. It helped build fluency in this dataset while I was preparing this post.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/brave_aDW3LDvxQD.png"><img alt="Fused" src="https://tech.marksblogg.com/theme/images/fsq_pois/brave_aDW3LDvxQD.png"/></a>
</p></div>
<div id="my-workstation">
<h2>My Workstation</h2>
<p>I&#39;m using a 6 GHz Intel Core <a href="https://www.intel.com/content/www/us/en/products/sku/236773/intel-core-i9-processor-14900k-36m-cache-up-to-6-00-ghz/specifications.html">i9-14900K</a> CPU. It has 8 performance cores and 16 efficiency cores with a total of 32 threads and 32 MB of L2 cache. It has a liquid cooler attached and is housed in a spacious, full-sized, Cooler Master HAF 700 computer case. I&#39;ve come across videos on YouTube where people have managed to overclock the i9-14900KF to <a href="https://www.youtube.com/watch?v=fb7pl7PZOYo">9.1 GHz</a>.</p>
<p>The system has 96 GB of DDR5 RAM clocked at 6,000 MT/s and a 5th-generation, Crucial T700 4 TB NVMe M.2 SSD which can read at speeds up to 12,400 MB/s. There is a heatsink on the SSD to help keep its temperature down. This is my system&#39;s C drive.</p>
<p>The system is powered by a 1,200-watt, fully modular, Corsair Power Supply and is sat on an ASRock Z790 Pro RS Motherboard.</p>
<p>I&#39;m running Ubuntu 22 LTS via Microsoft&#39;s Ubuntu for Windows on Windows 11 Pro. In case you&#39;re wondering why I don&#39;t run a Linux-based desktop as my primary work environment, I&#39;m still using an Nvidia GTX 1080 GPU which has better driver support on Windows and I use ArcGIS Pro from time to time which only supports Windows natively.</p>
</div>
<div id="installing-prerequisites">
<h2>Installing Prerequisites</h2>
<p>I&#39;ll use a few tools to help prepare and visualise the data in this post.</p>
<div><pre><span></span>$<span> </span>sudo<span> </span>apt<span> </span>update
$<span> </span>sudo<span> </span>apt<span> </span>install<span> </span><span>\</span>
<span>    </span>awscli<span> </span><span>\</span>
<span>    </span>jq
</pre></div>
<p>I&#39;ll use DuckDB, along with its <a href="https://github.com/isaacbrodsky/h3-duckdb">H3</a>, <a href="https://duckdb.org/docs/extensions/json">JSON</a>, <a href="https://community-extensions.duckdb.org/extensions/lindel.html">Lindel</a>, <a href="https://duckdb.org/docs/data/parquet/overview">Parquet</a> and <a href="https://duckdb.org/docs/extensions/spatial.html">Spatial</a> extensions, in this post.</p>
<div><pre><span></span>$<span> </span><span>cd</span><span> </span>~
$<span> </span>wget<span> </span>-c<span> </span>https://github.com/duckdb/duckdb/releases/download/v1.1.3/duckdb_cli-linux-amd64.zip
$<span> </span>unzip<span> </span>-j<span> </span>duckdb_cli-linux-amd64.zip
$<span> </span>chmod<span> </span>+x<span> </span>duckdb
$<span> </span>~/duckdb
</pre></div>
<div><pre><span></span><span>INSTALL</span><span> </span><span>h3</span><span> </span><span>FROM</span><span> </span><span>community</span><span>;</span>
<span>INSTALL</span><span> </span><span>lindel</span><span> </span><span>FROM</span><span> </span><span>community</span><span>;</span>
<span>INSTALL</span><span> </span><span>json</span><span>;</span>
<span>INSTALL</span><span> </span><span>parquet</span><span>;</span>
<span>INSTALL</span><span> </span><span>spatial</span><span>;</span>
</pre></div>
<p>I&#39;ll set up DuckDB to load every installed extension each time it launches.</p>

<div><pre><span></span>.timer on
.width 180
LOAD h3;
LOAD lindel;
LOAD json;
LOAD parquet;
LOAD spatial;
</pre></div>
<p>The maps in this post were rendered with <a href="https://www.qgis.org/en/site/forusers/download.html">QGIS</a> version 3.40. QGIS is a desktop application that runs on Windows, macOS and Linux. The application has grown in popularity in recent years and has ~15M application launches from users all around the world each month.</p>
<p>I used QGIS&#39; <a href="https://geoinformaticsworld.com/how-to-download-and-install-google-earth-images-in-qgis-using-tiles-plugin/">Tile+ plugin</a> to add geospatial context with Esri&#39;s World Imagery Basemap. The dark, non-satellite imagery maps are mostly made up of vector data from Natural Earth and Overture.</p>
</div>
<div id="downloading-foursquare-s-pois">
<h2>Downloading Foursquare&#39;s POIs</h2>
<p>The following will download 11 GB of Parquet files.</p>
<div><pre><span></span>$<span> </span>aws<span> </span>s3<span> </span>sync<span> </span><span>\</span>
<span>    </span>s3://fused/fsq-os-places/<span> </span><span>\</span>
<span>    </span>~/pois<span> </span><span>\</span>
<span>    </span>--endpoint-url<span>=</span>https://data.source.coop
</pre></div>
<p>This dataset will be refreshed monthly so expect the disk space requirements to grow by ~11 GB each month as time goes on.</p>
</div>
<div id="data-fluency">
<h2>Data Fluency</h2>
<p>Below is an example record from this dataset.</p>
<div><pre><span></span>$<span> </span><span>cd</span><span> </span>~/pois/2024-11-19/places/

$<span> </span><span>echo</span><span> </span><span>&#34;SELECT *</span>
<span>        FROM   READ_PARQUET(&#39;*.parquet&#39;)</span>
<span>        WHERE  country = &#39;EE&#39;</span>
<span>        LIMIT  1&#34;</span><span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>~/duckdb<span> </span>-json<span> </span><span>\</span>
<span>    </span><span>|</span><span> </span>jq<span> </span>-S<span> </span>.
</pre></div>
<div><pre><span></span><span>[</span>
<span>  </span><span>{</span>
<span>    </span><span>&#34;address&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;admin_region&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;country&#34;</span><span>:</span><span> </span><span>&#34;EE&#34;</span><span>,</span>
<span>    </span><span>&#34;date_closed&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;date_created&#34;</span><span>:</span><span> </span><span>&#34;2011-06-11&#34;</span><span>,</span>
<span>    </span><span>&#34;date_refreshed&#34;</span><span>:</span><span> </span><span>&#34;2020-11-30&#34;</span><span>,</span>
<span>    </span><span>&#34;email&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;facebook_id&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;fsq_category_ids&#34;</span><span>:</span><span> </span><span>&#34;[4bf58dd8d48988d16d941735]&#34;</span><span>,</span>
<span>    </span><span>&#34;fsq_category_labels&#34;</span><span>:</span><span> </span><span>&#34;[Dining and Drinking &gt; Cafe, Coffee, and Tea House &gt; Café]&#34;</span><span>,</span>
<span>    </span><span>&#34;fsq_place_id&#34;</span><span>:</span><span> </span><span>&#34;4df395c46284fefe8fc2cac4&#34;</span><span>,</span>
<span>    </span><span>&#34;geometry&#34;</span><span>:</span><span> </span><span>&#34;POINT (22.486121923982086 58.252406944851465)&#34;</span><span>,</span>
<span>    </span><span>&#34;instagram&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;latitude&#34;</span><span>:</span><span> </span><span>58.252406944851465</span><span>,</span>
<span>    </span><span>&#34;locality&#34;</span><span>:</span><span> </span><span>&#34;Kuressaare&#34;</span><span>,</span>
<span>    </span><span>&#34;longitude&#34;</span><span>:</span><span> </span><span>22.486121923982086</span><span>,</span>
<span>    </span><span>&#34;name&#34;</span><span>:</span><span> </span><span>&#34;Kohvik Tareke&#34;</span><span>,</span>
<span>    </span><span>&#34;po_box&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;post_town&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;postcode&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;region&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;tel&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;twitter&#34;</span><span>:</span><span> </span><span>null</span><span>,</span>
<span>    </span><span>&#34;website&#34;</span><span>:</span><span> </span><span>null</span>
<span>  </span><span>}</span>
<span>]</span>
</pre></div>
<p>There are over 104M records in total.</p>

<div><pre><span></span><span>SELECT</span><span> </span><span>COUNT</span><span>(</span><span>*</span><span>)</span>
<span>FROM</span><span>   </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>);</span><span> </span><span>-- 104,181,215</span>
</pre></div>
<p>Most columns are well populated. Only eight columns have an 85%+ NULL rate.</p>
<div><pre><span></span><span>SELECT</span><span>   </span><span>column_name</span><span>,</span>
<span>         </span><span>column_type</span><span>,</span>
<span>         </span><span>null_percentage</span><span>,</span>
<span>         </span><span>approx_unique</span>
<span>FROM</span><span>     </span><span>(</span><span>SUMMARIZE</span>
<span>          </span><span>FROM</span><span> </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>))</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>1</span><span>;</span>
</pre></div>
<div><pre><span></span>┌─────────────────────┬─────────────┬─────────────────┬───────────────┐
│     column_name     │ column_type │ null_percentage │ approx_unique │
│       varchar       │   varchar   │  decimal(9,2)   │     int64     │
├─────────────────────┼─────────────┼─────────────────┼───────────────┤
│ address             │ VARCHAR     │           35.71 │      50549830 │
│ admin_region        │ VARCHAR     │           90.16 │           185 │
│ country             │ VARCHAR     │            0.02 │           242 │
│ date_closed         │ VARCHAR     │           94.18 │          5074 │
│ date_created        │ VARCHAR     │            0.00 │          6146 │
│ date_refreshed      │ VARCHAR     │            0.00 │          1939 │
│ email               │ VARCHAR     │           88.78 │       9451926 │
│ facebook_id         │ BIGINT      │           93.29 │       5827724 │
│ fsq_category_ids    │ VARCHAR[]   │           11.06 │        608378 │
│ fsq_category_labels │ VARCHAR[]   │           11.06 │        461277 │
│ fsq_place_id        │ VARCHAR     │            0.00 │     115532409 │
│ geometry            │ GEOMETRY    │            0.00 │      97030828 │
│ instagram           │ VARCHAR     │           98.91 │        413585 │
│ latitude            │ DOUBLE      │            0.00 │      87959408 │
│ locality            │ VARCHAR     │           27.96 │       1370111 │
│ longitude           │ DOUBLE      │            0.00 │      83434671 │
│ name                │ VARCHAR     │            0.00 │      75651468 │
│ po_box              │ VARCHAR     │           99.71 │         46682 │
│ post_town           │ VARCHAR     │           97.43 │         10740 │
│ postcode            │ VARCHAR     │           45.32 │       2799572 │
│ region              │ VARCHAR     │           32.61 │        294146 │
│ tel                 │ VARCHAR     │           54.30 │      38456652 │
│ twitter             │ VARCHAR     │           95.38 │       1632976 │
│ website             │ VARCHAR     │           69.41 │      18694432 │
├─────────────────────┴─────────────┴─────────────────┴───────────────┤
│ 24 rows                                                   4 columns │
└─────────────────────────────────────────────────────────────────────┘
</pre></div>
</div>
<div id="heatmap">
<h2>Heatmap</h2>
<p>This is a heatmap showing where the highest densities of POIs are located.</p>

<div><pre><span></span><span>COPY</span><span> </span><span>(</span>
<span>    </span><span>SELECT</span><span>   </span><span>H3_CELL_TO_BOUNDARY_WKT</span><span>(</span>
<span>                  </span><span>H3_LATLNG_TO_CELL</span><span>(</span><span>latitude</span><span>,</span>
<span>                                    </span><span>longitude</span><span>,</span>
<span>                                    </span><span>5</span><span>))::</span><span>geometry</span><span> </span><span>geom</span><span>,</span>
<span>             </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>AS</span><span> </span><span>num_recs</span>
<span>    </span><span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>    </span><span>WHERE</span><span>    </span><span>longitude</span><span> </span><span>&lt;</span><span> </span><span>170</span>
<span>    </span><span>AND</span><span>      </span><span>longitude</span><span> </span><span>&gt;</span><span> </span><span>-</span><span>170</span>
<span>    </span><span>AND</span><span>      </span><span>latitude</span><span> </span><span>IS</span><span> </span><span>NOT</span><span> </span><span>NULL</span>
<span>    </span><span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span>
<span>)</span><span> </span><span>TO</span><span> </span><span>&#39;fsq.pois.h3_5.gpkg&#39;</span>
<span>    </span><span>WITH</span><span> </span><span>(</span><span>FORMAT</span><span> </span><span>GDAL</span><span>,</span>
<span>          </span><span>DRIVER</span><span> </span><span>&#39;GPKG&#39;</span><span>,</span>
<span>          </span><span>LAYER_CREATION_OPTIONS</span><span> </span><span>&#39;WRITE_BBOX=YES&#39;</span><span>);</span>
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_l1Qb2dmTos.jpg"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_l1Qb2dmTos.jpg"/></a></p><p>The heatmap across Europe matches population densities well. But if you look at the Red Sea closely you&#39;ll find there are a lot of POIs over water bodies.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_qwEeKDWZLv.jpg"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_qwEeKDWZLv.jpg"/></a></p><p>China has a decent number of POIs in this dataset. Thailand is completely lit up compared to its neighbours. North Korea appears almost completely pitch-black compared to South Korea.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_l1x8mPDVd7.jpg"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_l1x8mPDVd7.jpg"/></a></p><p>The basemap used above has the world&#39;s urban centres coloured orange. Almost none of these urban centres are visible in the heatmaps which means Foursquare did a good job of covering the world&#39;s urban centres with this dataset.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_s3wQUefabV.jpg"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_s3wQUefabV.jpg"/></a>
</p></div>
<div id="country-count">
<h2>Country Count</h2>
<p>There are 253 countries represented in this dataset.</p>

<div><pre><span></span><span>SELECT</span><span> </span><span>COUNT</span><span>(</span><span>DISTINCT</span><span> </span><span>country</span><span>)</span>
<span>FROM</span><span>   </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>);</span><span> </span><span>-- 253</span>
</pre></div>
<p>The US has ~23.5M records followed by Indonesia and Turkey with over 8M each.</p>
<div><pre><span></span><span>.</span><span>maxrows</span><span> </span><span>20</span>

<span>SELECT</span><span> </span><span>country</span><span>,</span>
<span>       </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>num_recs</span>
<span>FROM</span><span>   </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>2</span><span> </span><span>DESC</span><span>;</span>
</pre></div>
<div><pre><span></span>┌─────────┬──────────┐
│ country │ num_recs │
│ varchar │  int64   │
├─────────┼──────────┤
│ US      │ 23481388 │
│ ID      │  8567041 │
│ TR      │  8077069 │
│ BR      │  5206462 │
│ DE      │  4955682 │
│ JP      │  4767710 │
│ GB      │  4098159 │
│ RU      │  3067249 │
│ FR      │  3060670 │
│ MX      │  2820025 │
│ ·       │        · │
│ ·       │        · │
│ ·       │        · │
│ IO      │       63 │
│ WF      │       55 │
│ UM      │       53 │
│ HM      │       43 │
│ CC      │       35 │
│ AN      │       33 │
│ TK      │       22 │
│ PN      │       15 │
│ BV      │       12 │
│ PZ      │        1 │
├─────────┴──────────┤
│      254 rows      │
│     (20 shown)     │
└────────────────────┘
</pre></div>
</div>
<div id="categories">
<h2>Categories</h2>
<p>The POIs are well-categorised and go into a lot of detail on their own. Below are the most common, top-level categories.</p>

<div><pre><span></span><span>SELECT</span><span>   </span><span>COUNT</span><span>(</span><span>*</span><span>),</span>
<span>         </span><span>fsq_category_labels</span><span>[</span><span>1</span><span>]</span>
<span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>WHERE</span><span>    </span><span>fsq_category_labels</span><span> </span><span>IS</span><span> </span><span>NOT</span><span> </span><span>NULL</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>2</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>1</span><span> </span><span>DESC</span>
<span>LIMIT</span><span>    </span><span>20</span><span>;</span>
</pre></div>
<div><pre><span></span>┌──────────────┬─────────────────────────────────────────────────────────────────────────────────────┐
│ count_star() │                               fsq_category_labels[1]                                │
│    int64     │                                       varchar                                       │
├──────────────┼─────────────────────────────────────────────────────────────────────────────────────┤
│      2445949 │ Business and Professional Services &gt; Office                                         │
│      1953758 │ Community and Government &gt; Residential Building &gt; Apartment or Condo                │
│      1831582 │ Business and Professional Services &gt; Automotive Service &gt; Automotive Repair Shop    │
│      1707012 │ Business and Professional Services &gt; Health and Beauty Service &gt; Hair Salon         │
│      1536639 │ Dining and Drinking &gt; Restaurant                                                    │
│      1490833 │ Landmarks and Outdoors &gt; Structure                                                  │
│      1352067 │ Business and Professional Services                                                  │
│      1278305 │ Dining and Drinking &gt; Cafe, Coffee, and Tea House &gt; Café                            │
│      1255136 │ Retail &gt; Construction Supplies Store                                                │
│      1174087 │ Dining and Drinking &gt; Bar                                                           │
│       998010 │ Travel and Transportation &gt; Lodging &gt; Hotel                                         │
│       966683 │ Travel and Transportation &gt; Road                                                    │
│       956831 │ Health and Medicine &gt; Physician &gt; Doctor&#39;s Office                                   │
│       867655 │ Business and Professional Services &gt; Financial Service &gt; Banking and Finance &gt; Bank │
│       850209 │ Community and Government &gt; Spiritual Center &gt; Church                                │
│       814109 │ Retail &gt; Fashion Retail &gt; Clothing Store                                            │
│       770410 │ Health and Medicine &gt; Dentist                                                       │
│       730096 │ Retail                                                                              │
│       727223 │ Business and Professional Services &gt; Factory                                        │
│       713314 │ Community and Government &gt; Housing Development                                      │
├──────────────┴─────────────────────────────────────────────────────────────────────────────────────┤
│ 20 rows                                                                                  2 columns │
└────────────────────────────────────────────────────────────────────────────────────────────────────┘
</pre></div>
</div>
<div id="tallinn-s-old-town">
<h2>Tallinn&#39;s Old Town</h2>
<p>I&#39;ll extract out Tallinn&#39;s POIs.</p>

<div><pre><span></span><span>COPY</span><span> </span><span>(</span>
<span>    </span><span>SELECT</span><span>   </span><span>*</span><span> </span><span>EXCLUDE</span><span>(</span><span>fsq_category_ids</span><span>,</span><span> </span><span>fsq_category_labels</span><span>),</span>
<span>             </span><span>fsq_category_ids</span><span>::</span><span>TEXT</span><span> </span><span>AS</span><span> </span><span>fsq_category_ids</span><span>,</span>
<span>             </span><span>fsq_category_labels</span><span>::</span><span>TEXT</span><span> </span><span>AS</span><span> </span><span>fsq_category_labels</span>
<span>    </span><span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>    </span><span>WHERE</span><span>    </span><span>longitude</span><span> </span><span>&gt;</span><span> </span><span>24</span><span>.</span><span>44103</span>
<span>    </span><span>AND</span><span>      </span><span>longitude</span><span> </span><span>&lt;</span><span> </span><span>25</span><span>.</span><span>00123</span>
<span>    </span><span>AND</span><span>      </span><span>latitude</span><span>  </span><span>&lt;</span><span> </span><span>59</span><span>.</span><span>61838</span>
<span>    </span><span>AND</span><span>      </span><span>latitude</span><span>  </span><span>&gt;</span><span> </span><span>59</span><span>.</span><span>34467</span>
<span>)</span><span> </span><span>TO</span><span> </span><span>&#39;fsq.pois.tallinn.gpkg&#39;</span>
<span>    </span><span>WITH</span><span> </span><span>(</span><span>FORMAT</span><span> </span><span>GDAL</span><span>,</span>
<span>          </span><span>DRIVER</span><span> </span><span>&#39;GPKG&#39;</span><span>,</span>
<span>          </span><span>LAYER_CREATION_OPTIONS</span><span> </span><span>&#39;WRITE_BBOX=YES&#39;</span><span>);</span>
</pre></div>
<p>There are a lot of POIs in Tallinn Bay along the ferry route used between Estonia and the rest of the world.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_4blynD6EpS.jpg"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_4blynD6EpS.jpg"/></a></p><p>There are a lot of POIs right in the middle of Town Hall Square. Some are of nearby businesses while others are of events that have been held in the Square in years past.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_6LT0aCRWYH.jpg"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_6LT0aCRWYH.jpg"/></a>
</p></div>
<div id="tallinn-airport">
<h2>Tallinn Airport</h2>
<p>Tallinn Airport&#39;s Shops aren&#39;t in OpenStreetMap&#39;s database for some reason. There are tons of places to eat and drink at the Airport but you&#39;d never know from the OSM map.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/brave_AAQSHIq9Fo.png"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/brave_AAQSHIq9Fo.png"/></a></p><p>The POI dataset Foursquare has for the Airport does include every shop. It&#39;s just a matter of picking through all the other random POIs next to them.</p>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_aEeKktVjpI.jpg"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_aEeKktVjpI.jpg"/></a>
</p></div>
<div id="starbucks">
<h2>Starbucks</h2>
<p>There are a total of 53,022 records that match Starbucks in this dataset. Starbucks had 38K outlets last year. This 53K figure could also include locations they&#39;ve since closed down.</p>
<p>Most records are simply named &#34;Starbucks&#34; but there is a longtail of variations as well.</p>

<div><pre><span></span><span>SELECT</span><span>   </span><span>COUNT</span><span>(</span><span>*</span><span>),</span>
<span>         </span><span>name</span>
<span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>WHERE</span><span>    </span><span>name</span><span> </span><span>ILIKE</span><span> </span><span>&#39;%starbucks%&#39;</span>
<span>GROUP</span><span> </span><span>BY</span><span> </span><span>2</span>
<span>ORDER</span><span> </span><span>BY</span><span> </span><span>1</span><span> </span><span>DESC</span><span>;</span>
</pre></div>
<div><pre><span></span>┌──────────────┬─────────────────────────────────────┐
│ count_star() │                name                 │
│    int64     │               varchar               │
├──────────────┼─────────────────────────────────────┤
│        42167 │ Starbucks                           │
│          589 │ Starbucks Coffee                    │
│          588 │ Starbucks (ستاربكس)                 │
│          480 │ Starbucks 星巴克                    │
│          367 │ Starbucks (สตาร์บัคส์)                 │
│          289 │ Starbucks (星巴克)                  │
│          248 │ Starbucks Reserve                   │
│          172 │ starbucks                           │
│          133 │ 星巴克 Starbucks                    │
│          122 │ Starbucks On The Go                 │
│          108 │ Starbucks Reserve 星巴克臻选        │
│           48 │ STARBUCKS                           │
│           47 │ Starbucks coffee                    │
│           46 │ Starbucks | ستاربكس                 │
│           39 │ STARBUCKS COFFEE                    │
│           35 │ Starbucks Drive Thru                │
│           34 │ Starbucks Coffe                     │
│           18 │ starbucks coffee                    │
│           15 │ Starbucks coffe                     │
│           15 │ Starbucks / ستاربكس                 │
│            · │          ·                          │
│            · │          ·                          │
│            · │          ·                          │
│            1 │ Starbucks Ferry Terminal            │
│            1 │ Starbucks Dallah                    │
│            1 │ starbucks Atyafmall                 │
│            1 │ Starbucks Naz                       │
│            1 │ 24hr Starbucks                      │
│            1 │ Starbucks At Nemours                │
│            1 │ Starbucks.SU                        │
│            1 │ Starbucks Metropolis Mall           │
│            1 │ Starbucks Atakum                    │
│            1 │ Starbucks - Travis Air Force Base   │
│            1 │ Toyota South Campus Starbucks       │
│            1 │ Starbucks Coffee Pejaten            │
│            1 │ Starbucks blok m                    │
│            1 │ Starbucks Kemang village            │
│            1 │ Starbucks km.97                     │
│            1 │ Starbucks Muara Bungo Mall          │
│            1 │ Starbucks Ngagel                    │
│            1 │ Starbucks libi                      │
│            1 │ Starbucks Coffee Kuta               │
│            1 │ Starbucks Coffee 広尾有栖川公園前店 │
├──────────────┴─────────────────────────────────────┤
│ 6560 rows (40 shown)                     2 columns │
└────────────────────────────────────────────────────┘
</pre></div>
<p>I&#39;ll build a heatmap of their locations.</p>
<div><pre><span></span><span>COPY</span><span> </span><span>(</span>
<span>    </span><span>SELECT</span><span>   </span><span>H3_CELL_TO_BOUNDARY_WKT</span><span>(</span>
<span>                  </span><span>H3_LATLNG_TO_CELL</span><span>(</span><span>latitude</span><span>,</span>
<span>                                    </span><span>longitude</span><span>,</span>
<span>                                    </span><span>2</span><span>))::</span><span>geometry</span><span> </span><span>geom</span><span>,</span>
<span>             </span><span>COUNT</span><span>(</span><span>*</span><span>)</span><span> </span><span>AS</span><span> </span><span>num_recs</span>
<span>    </span><span>FROM</span><span>     </span><span>READ_PARQUET</span><span>(</span><span>&#39;*.parquet&#39;</span><span>)</span>
<span>    </span><span>WHERE</span><span>    </span><span>longitude</span><span> </span><span>&lt;</span><span> </span><span>170</span>
<span>    </span><span>AND</span><span>      </span><span>longitude</span><span> </span><span>&gt;</span><span> </span><span>-</span><span>170</span>
<span>    </span><span>AND</span><span>      </span><span>latitude</span><span> </span><span>IS</span><span> </span><span>NOT</span><span> </span><span>NULL</span>
<span>    </span><span>AND</span><span>      </span><span>name</span><span> </span><span>ILIKE</span><span> </span><span>&#39;%starbucks%&#39;</span>
<span>    </span><span>GROUP</span><span> </span><span>BY</span><span> </span><span>1</span>
<span>)</span><span> </span><span>TO</span><span> </span><span>&#39;fsq.starbucks.h3_2.gpkg&#39;</span>
<span>    </span><span>WITH</span><span> </span><span>(</span><span>FORMAT</span><span> </span><span>GDAL</span><span>,</span>
<span>          </span><span>DRIVER</span><span> </span><span>&#39;GPKG&#39;</span><span>,</span>
<span>          </span><span>LAYER_CREATION_OPTIONS</span><span> </span><span>&#39;WRITE_BBOX=YES&#39;</span><span>);</span>
</pre></div>
<p><a href="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_o27L39xU1a.png"><img alt="Foursquare" src="https://tech.marksblogg.com/theme/images/fsq_pois/qgis-bin_o27L39xU1a.png"/></a>
</p></div>

        </div><p>
            Thank you for taking the time to read this post. I offer both consulting and hands-on development services to clients in North America and Europe. If you&#39;d like to discuss how my offerings can help your business please contact me via <a href="https://uk.linkedin.com/in/marklitwintschik/">LinkedIn</a>.
        </p></div>
  </body>
</html>
