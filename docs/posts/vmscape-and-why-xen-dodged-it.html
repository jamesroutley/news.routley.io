<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://virtualize.sh/blog/vmscape-and-why-xen-dodged-it/">Original</a>
    <h1>VMScape and why Xen dodged it</h1>
    
    <div id="readability-page-1" class="page"><div>
        <p>It’s been less than two weeks since the security team at ETH Zürich published their research on a new microarchitectural attack they call <strong>VMScape</strong>:</p><figure><a href="https://comsec.ethz.ch/research/microarch/vmscape-exposing-and-exploiting-incomplete-branch-predictor-isolation-in-cloud-environments/?ref=virtualize.sh"><div><p>VMScape: Exposing and Exploiting Incomplete Branch Predictor Isolation in Cloud Environments – Computer Security Group</p><p><img src="https://virtualize.sh/blog/content/images/icon/cropped-Mini-Logo-270x270.jpg" alt=""/><span>Skip to content</span></p></div><p><img src="https://virtualize.sh/blog/content/images/thumbnail/ETH_COMSEC_small.png" alt="" onerror="this.style.display = &#39;none&#39;"/></p></a></figure><p>It’s a neat piece of work, and it shows once again how CPUs, with all their clever tricks for performance, can sometimes open the door to data leaks across virtual machines.</p><h2 id="what-is-vmscape">What is VMScape?</h2><p>The short version: modern CPUs use a <strong>branch predictor</strong> to guess where code will go next. It makes things faster, but the predictor also “remembers” past patterns. If you can manipulate that memory, you can mislead the CPU and peek at things you shouldn’t. That’s the basic idea behind Spectre-style attacks.</p><p>According to the ETH team:</p><blockquote>“We find that branch predictor state is not fully flushed across VMs, enabling cross-VM Branch Target Injection (vBTI) primitives. We demonstrate the practical impact of vBTI with VMScape, a cross-VM attack capable of leaking QEMU userspace secrets from a malicious guest VM on AMD Zen 4 and Zen 5 CPUs.”</blockquote><p>In other words, a malicious VM can target the hypervisor’s userspace components and start leaking data. For KVM, that means QEMU, which is heavily exposed. VMware is in the same situation.</p><h2 id="why-xen-wasn%E2%80%99t-affected">Why Xen wasn’t affected</h2><p>The researchers also note that <strong>Xen is not vulnerable</strong>. That’s not because Xen has no bugs (it does, like every hypervisor), but because of its architecture.</p><p>From day one, Xen was designed to keep the hypervisor core small and move everything else out. Device emulation, storage drivers, network stacks — they all live in <strong>Dom0</strong>, which is itself just another virtual machine. Dom0 has more privileges than a normal guest, but it’s still not the hypervisor.</p><figure><img src="https://virtualize.sh/blog/content/images/2025/09/xen-overview.drawio.svg" alt="" loading="lazy" width="701" height="461"/></figure><p>That architectural choice makes Xen closer to a <strong>microkernel</strong> than a traditional monolithic hypervisor. The core stays minimal, with a narrow set of responsibilities, and anything that doesn’t absolutely need to run at the highest privilege level gets pushed out. That’s not just elegant — it’s a big deal for security.</p><h2 id="size-matters-in-a-good-way">Size matters (in a good way)</h2><p>Because the hypervisor itself is small, it’s easier to audit, reason about, and even certify. That’s why you’ll find Xen at the heart of a lot of <strong>embedded and safety-critical projects</strong>, where formal verification and certification are required. Try doing that with a massive, monolithic kernel and you’ll quickly run into a wall. With Xen, it’s actually feasible (and being done as we speak).</p><p>VMScape highlights the benefits of that design: QEMU is simply not sitting next to the hypervisor. Even if you leak information from it, you’re still only talking about a process in Dom0, not the privileged heart of the system.</p><h2 id="why-this-matters">Why this matters</h2><p>Architectural choices made twenty years ago are paying off today. By separating responsibilities, Xen reduced its attack surface and avoided a whole class of problems. That doesn’t make it invincible (Xen has had and will have its share of vulnerabilities) but it does mean that <strong>by design, certain attacks don’t land as hard.</strong></p><p>As the ETH Zürich team points out, mitigations for KVM involve adding new predictor flushes, which Linux developers have already started to implement. VMware will need similar patches. Xen doesn’t need those same emergency measures, because the architecture already put a buffer in place.</p><figure><img src="https://virtualize.sh/blog/content/images/2025/09/2025-Xen-Panda-Standup-Green-Circle-Transparent-1.webp" alt="" loading="lazy" width="529" height="600"/></figure><h2 id="defense-in-depth">Defense in depth</h2><p>It’s tempting to say “Xen wins” and stop there. But that’s not the whole story. Security is never just about one design decision. CPUs will keep evolving, new side channels will keep appearing, and no hypervisor can afford to be complacent.</p><p>Still, VMScape is a good reminder that <strong>defense in depth starts at the architecture level</strong>. A small, microkernel-like core, privilege separation, isolation of device emulation — all of that adds resilience. It won’t stop every possible attack, but it does add another layer of safety, and in security, layers are what make the difference.</p>
    </div></div>
  </body>
</html>
