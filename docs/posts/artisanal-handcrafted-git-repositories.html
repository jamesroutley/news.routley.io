<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://drew.silcock.dev/blog/artisanal-git/">Original</a>
    <h1>Artisanal handcrafted Git repositories</h1>
    
    <div id="readability-page-1" class="page"><article> <p>There’s no love and care put into crafting our git repositories nowadays.</p>
<p>Let’s change that.</p>
<p>I’m going to talk about how to handmake your git repositories without using these silly git commands.</p>
<p>You might also learn a bit more about how git works under the hood during the process, or whatever.</p>
<p>If you’re so inclined, you might also take it as an opportunity to appreciate how the power of git comes not from the complexity of its code but from the simplicity and elegance of its design. I mean, if that’s your thing.</p>
<p>Git refers to the user-friendly commands as “porcelain” and to the internals as “plumbing”, so you can think of this as an introductory lesson in git plumbing. In fact, git has “plumbing” commands which we’re not even using, so this is more like an introductory course in git fluid dynamics. In other words, it’s pretty silly.</p>
<a href="#pre-requisites">#</a><h2 id="pre-requisites">Pre-requisites</h2>
<p>I’m going to assume you are familiar with git and are comfortable in a shell environment, otherwise this probably won’t make much sense to you.</p>
<a href="#lets-get-started">#</a><h2 id="lets-get-started">Let’s get started</h2>
<p>The first thing we’d do normally is run <code>git init</code>, but where’s the care and attention in that? We’re going to do it the old-fashioned way, like the pilgrims of yore would’ve done.</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>mkdir</span><span> </span><span>artisanal-git</span></p></div><div><div><p>2</p></div><p><span>$</span><span> </span><span>cd</span><span> </span><span>artisanal-git</span></p></div><div><div><p>3</p></div></div><div><div><p>4</p></div><p><span># This is where git stores all the information for a repository, from branches to</span></p></div><div><div><p>5</p></div><p><span># commits to objects.</span></p></div><div><div><p>6</p></div><p><span>$</span><span> </span><span>mkdir</span><span> </span><span>.git</span></p></div><div><div><p>7</p></div></div><div><div><p>8</p></div><p><span># Git expects these folders to exist, but we don&#39;t need to add anything into them yet.</span></p></div><div><div><p>9</p></div><p><span>$</span><span> </span><span>mkdir</span><span> </span><span>-p</span><span> </span><span>.git/hooks</span><span> </span><span>.git/info</span><span> </span><span>.git/objects/info</span><span> </span><span>.git/objects/pack</span><span> </span><span>.git/refs/heads</span><span> </span><span>.git/refs/remotes</span><span> </span><span>.git/refs/tags</span><span> </span><span>.git/logs</span></p></div><div><div><p>10</p></div></div><div><div><p>11</p></div><p><span># This is just a standard repo-specific config file – these are the default values on my</span></p></div><div><div><p>12</p></div><p><span># machine.</span></p></div><div><div><p>13</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>&lt;&lt;</span><span>EOF</span><span> </span><span>&gt;</span><span> </span><span>.git/config</span></p></div><div><div><p>14</p></div><p><span>[core]</span></p></div><div><div><p>15</p></div><p><span><span>    </span></span><span>repositoryformatversion = 0</span></p></div><div><div><p>16</p></div><p><span><span>    </span></span><span>filemode = true</span></p></div><div><div><p>17</p></div><p><span><span>    </span></span><span>bare = false</span></p></div><div><div><p>18</p></div><p><span><span>    </span></span><span>logallrefupdates = true</span></p></div><div><div><p>19</p></div><p><span><span>    </span></span><span>ignorecase = true</span></p></div><div><div><p>20</p></div><p><span><span>    </span></span><span>precomposeunicode = true</span></p></div><div><div><p>21</p></div><p><span>EOF</span></p></div></code></pre></figure></div>
<p>Now we only have to add one more file before we’ve got a valid git repository, and that’s the <code>HEAD</code>. You might’ve come across this before – <code>HEAD</code> just means “what is your repository pointing to right now?”. It’s a text file and it’s either got a reference in (the normal state of a repository) or just a plain commit hash – this is what’s referred to as a “detached head” (sounds painful, I know).</p>
<p>We’re going to point git to our default branch, called <code>main</code>.</p>
<div><figure><pre data-language="shell"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>echo</span><span> </span><span>&#34;ref: refs/heads/main&#34;</span><span> </span><span>&gt;</span><span> </span><span>.git/HEAD</span></p></div></code></pre></figure></div>
<p>You might be thinking – wait a minute, where is this <code>main</code> branch? I’ve not created any branches yet. And you haven’t, but that’s fine because we don’t have any commits yet. We can run <code>git status</code> to check whether git is happy with our handiwork so far.</p>
<div><figure><pre data-language="shell"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>git</span><span> </span><span>status</span></p></div><div><div><p>2</p></div><p><span>On</span><span> </span><span>branch</span><span> </span><span>main</span></p></div><div><div><p>3</p></div></div><div><div><p>4</p></div><p><span>No</span><span> </span><span>commits</span><span> </span><span>yet</span></p></div><div><div><p>5</p></div></div><div><div><p>6</p></div><p><span>nothing</span><span> </span><span>to</span><span> </span><span>commit</span><span> (create/copy </span><span>files</span><span> </span><span>and</span><span> </span><span>use</span><span> </span><span>&#34;git add&#34;</span><span> </span><span>to</span><span> </span><span>track</span><span>)</span></p></div></code></pre></figure></div>
<p>If you get the error “fatal: This operation must be run in a work tree”, it’s probably just because you’re running it from inside the <code>.git</code> folder, which won’t work. Just cd one level up and you should be good to go.</p>
<p>Nice! Now, let’s get committing.</p>
<a href="#content-addressable-storage">#</a><h2 id="content-addressable-storage">Content Addressable Storage</h2>
<p>Before we start hand-crafting our commits, we need to spend a bit of time refining our craftwork by studying the lore.</p>
<p>First, we need to understand what an <em>“object”</em> is in git, what they are and how git stores them.</p>
<p>Git needs to store lots of things. If you create a commit in git, git then needs to store everything about the commit itself, including the commit description, which files it includes, who committed it, the timestamp, and the contents of the files.</p>
<p>All of these things are stored as “objects”. But what do these look like? Let’s take another repository which already has a bunch of data in it.</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>git</span><span> </span><span>log</span><span> </span><span>-1</span></p></div><div><div><p>2</p></div><p><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span></p></div><div><div><p>3</p></div><p><span>commit</span><span> </span><span>84eae65b6780129486768e6497736c38bfdf9b3d</span><span> (HEAD -</span><span>&gt;</span><span> </span><span>main,</span><span> </span><span>origin/main,</span><span> </span><span>origin/HEAD</span><span>) ┃</span></p></div><div><div><p>4</p></div><p><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></p></div><div><div><p>5</p></div><p><span>Author:</span><span> </span><span>Drew</span><span> </span><span>Silcock</span><span> </span><span>&lt;redacted&gt;</span></p></div><div><div><p>6</p></div><p><span>Date:</span><span>   </span><span>Mon</span><span> </span><span>Sep</span><span> </span><span>30</span><span> </span><span>21:39:55</span><span> </span><span>2024</span><span> </span><span>+0100</span></p></div><div><div><p>7</p></div></div><div><div><p>8</p></div><p><span>    </span><span>Improve</span><span> </span><span>py</span><span> </span><span>3.13</span><span> </span><span>graphs</span><span> </span><span>and</span><span> </span><span>add</span><span> </span><span>extra</span><span> </span><span>section</span><span> </span><span>on</span><span> </span><span>scaling.</span></p></div></code></pre></figure></div>
<p>This is the last commit in the repo for this blog, at the time of writing. We can see that the commit is identified by its SHA-1 hash, <code>84eae65b</code> (I can’t be bothered to type out the whole thing).</p>
<p>This is where things start to get clever – the way git stores all these things like commits, files, etc.<sup><a href="#user-content-fn-not-everything" id="user-content-fnref-not-everything" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup> is not based on some location separate from the data itself like a filename or a key (which would require knowing this filename/key outside of the data itself, e.g. by querying a central listing) but based on the contents of the thing itself. Do a SHA-1 hash of the object and that is the “key” that you use to find the object on disk.</p>
<p>This is called Content Addressable Storage (CAS) or sometimes fixed-content storage and once you recognise it, you start <a href="https://www.youtube.com/watch?v=5b3e2blXsZk">seeing it all over the place</a>. CAS and content addressing in general are used by, among other things:</p>
<ul>
<li><a href="https://docs.docker.com/engine/storage/drivers/#images-and-layers">Docker layers</a></li>
<li><a href="https://docs.ipfs.tech/how-to/address-ipfs-on-web">InterPlanetary File System (IPFS)</a></li>
<li><a href="https://www.cs.princeton.edu/courses/archive/fall18/cos418/docs/L6-dhts.pdf">BitTorrent via Distributed Hash Tables (DHTs)</a></li>
<li><a href="https://nixos.wiki/wiki/Ca-derivations">Nix</a></li>
</ul>
<p>A side bonus of using content addressable storage is that if you ever have duplicate files, you don’t need to store them twice – they’ll have the same hash so they’ll be stored in the same location.</p>
<a href="#commit-objects">#</a><h3 id="commit-objects">Commit objects</h3>
<p>To find commit <code>84eae65b</code> we need to look in <code>.git/objects/84/eae65b6780129486768e6497736c38bfdf9b3d</code>. The data is compressed using zlib so we have to pipe it into a decompressor (I’m using <a href="https://zlib.net/pigz/">pigz</a> here):</p>
<div><figure><pre data-language="shell"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>.git/objects/84/eae65b6780129486768e6497736c38bfdf9b3d</span><span> </span><span>|</span><span> </span><span>pigz</span><span> </span><span>-d</span></p></div><div><div><p>2</p></div><p><span>commit</span><span> </span><span>1136tree</span><span> </span><span>5a0be7720e65417e08034a64bc257bc56a60b4b3</span></p></div><div><div><p>3</p></div><p><span>parent</span><span> </span><span>e345662c7d53408eb2638cf0fdbae442fe6b68f4</span></p></div><div><div><p>4</p></div><p><span>author</span><span> </span><span>Drew</span><span> </span><span>Silcock</span><span> </span><span>&lt;redacted&gt;</span><span> </span><span>1727728795</span><span> </span><span>+0100</span></p></div><div><div><p>5</p></div><p><span>committer</span><span> </span><span>Drew</span><span> </span><span>Silcock</span><span> </span><span>&lt;redacted&gt;</span><span> </span><span>1727728795</span><span> </span><span>+0100</span></p></div><div><div><p>6</p></div><p><span>gpgsig</span><span> </span><span>-----BEGIN</span><span> </span><span>PGP</span><span> </span><span>SIGNATURE-----</span></p></div><div><div><p>7</p></div></div><div><div><p>8</p></div><p><span> </span><span>iQIzBAABCAAdFiEEaZwozZ5d++BpkqZmtEW8+mMmNyAFAmb7DJsACgkQtEW8+mMm</span></p></div><div><div><p>9</p></div><p><span> </span><span>NyAZeBAAs2I1rodxTBpOnFUgNnl5Slf2o03VZlc7kvbw2miCUP5CkO40REHzGXXE</span></p></div><div><div><p>10</p></div><p><span> </span><span>K3sJSUhObttTrKr0GjUChcvzBZBKoigawP+h3IeY07whhhTcnNaBXjQqzpcl+G5A</span></p></div><div><div><p>11</p></div><p><span> </span><span>ryEVkQXdCqVRWAk3I/6Z3hFlfUogzbxihGoEKvjyMZtmfy0di0WAOJ+PLlTIEwJJ</span></p></div><div><div><p>12</p></div><p><span> </span><span>SQYcUaA7l01ocIWy85MezGJHZEpurcBjzu5nkYCMGRw85u9tXXqjzaYh6Fu7WVEH</span></p></div><div><div><p>13</p></div><p><span> </span><span>rHmBO8tEFF/WcQC1FonVggrOQOAsssuaMxwxKV/p4HRxP9lHGmzFCGfbKAY1bQ82</span></p></div><div><div><p>14</p></div><p><span> </span><span>2dWgROwMAp6jtvLSX6OLu6i0O3+m6NAwTtKcOFDU+Jae4h2m1GC3/8qDukhK7o+e</span></p></div><div><div><p>15</p></div><p><span> </span><span>5LJCLAZPtTvpai43COLRnF9iteV15H267WOxpIvXqbMBwIFcaaHepFMLA0Y39Kr3</span></p></div><div><div><p>16</p></div><p><span> </span><span>FHd1JAaaE6fiUe4rjNP5Wx6ZVLKdEYznjbxgxiRkr9dcemR5SUQtreHjaaLTo0E9</span></p></div><div><div><p>17</p></div><p><span> </span><span>m6bEE1huZp+gu/dy9e7hgNORiwmkUP49r4/WPbNwwKrMxr5lD1ZwQk6DKEi6jAyq</span></p></div><div><div><p>18</p></div><p><span> </span><span>BduJ4fdtamFlngnbJtoW0LHsdxROMwHkqs1Pz4zxpmeOZZEv0p0pzFhM30ta+YjQ</span></p></div><div><div><p>19</p></div><p><span> </span><span>ogBAyoRGHAZG2cze5uI8Cg7fr1A+uTqGmBAXexYN+/ok4+Bf/5g</span><span>=</span></p></div><div><div><p>20</p></div><p><span> </span><span>=gvSk</span></p></div><div><div><p>21</p></div><p><span> </span><span>-----END</span><span> </span><span>PGP</span><span> </span><span>SIGNATURE-----</span></p></div><div><div><p>22</p></div></div><div><div><p>23</p></div><p><span>Improve</span><span> </span><span>py</span><span> </span><span>3.13</span><span> </span><span>graphs</span><span> </span><span>and</span><span> </span><span>add</span><span> </span><span>extra</span><span> </span><span>section</span><span> </span><span>on</span><span> </span><span>scaling.</span></p></div></code></pre></figure></div>
<p>If we pipe this into <a href="https://github.com/sharkdp/hexyl">hexyl</a> we can see the hidden null byte:</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>.git/objects/84/eae65b6780129486768e6497736c38bfdf9b3d</span><span> </span><span>|</span><span> </span><span>pigz</span><span> </span><span>-d</span><span> </span><span>|</span><span> </span><span>hexyl</span></p></div><div><div><p>2</p></div><p><span>┌────────┬─────────────────────────┬─────────────────────────┬────────┬────────┐</span></p></div><div><div><p>3</p></div><p><span>│00000000│</span><span> </span><span>63</span><span> </span><span>6f</span><span> </span><span>6d</span><span> </span><span>6d</span><span> </span><span>69</span><span> </span><span>74</span><span> </span><span>20</span><span> </span><span>31</span><span> </span><span>┊</span><span> </span><span>31</span><span> </span><span>33</span><span> </span><span>36</span><span> </span><span>00</span><span> </span><span>74</span><span> </span><span>72</span><span> </span><span>65</span><span> </span><span>65</span><span> </span><span>│commit</span><span> </span><span>1┊136⋄tree│</span></p></div><div><div><p>4</p></div><p><span>│00000010│</span><span> </span><span>20</span><span> </span><span>35</span><span> </span><span>61</span><span> </span><span>30</span><span> </span><span>62</span><span> </span><span>65</span><span> </span><span>37</span><span> </span><span>37</span><span> </span><span>┊</span><span> </span><span>32</span><span> </span><span>30</span><span> </span><span>65</span><span> </span><span>36</span><span> </span><span>35</span><span> </span><span>34</span><span> </span><span>31</span><span> </span><span>37</span><span> </span><span>│</span><span> </span><span>5a0be77┊20e65417│</span></p></div><div><div><p>5</p></div><p><span>│00000020│</span><span> </span><span>65</span><span> </span><span>30</span><span> </span><span>38</span><span> </span><span>30</span><span> </span><span>33</span><span> </span><span>34</span><span> </span><span>61</span><span> </span><span>36</span><span> </span><span>┊</span><span> </span><span>34</span><span> </span><span>62</span><span> </span><span>63</span><span> </span><span>32</span><span> </span><span>35</span><span> </span><span>37</span><span> </span><span>62</span><span> </span><span>63</span><span> </span><span>│e08034a6┊4bc257bc│</span></p></div><div><div><p>6</p></div><p><span>│00000030│</span><span> </span><span>35</span><span> </span><span>36</span><span> </span><span>61</span><span> </span><span>36</span><span> </span><span>30</span><span> </span><span>62</span><span> </span><span>34</span><span> </span><span>62</span><span> </span><span>┊</span><span> </span><span>33</span><span> </span><span>0a</span><span> </span><span>70</span><span> </span><span>61</span><span> </span><span>72</span><span> </span><span>65</span><span> </span><span>6e</span><span> </span><span>74</span><span> </span><span>│56a60b4b┊3_parent│</span></p></div><div><div><p>7</p></div><p><span>│00000040│</span><span> </span><span>20</span><span> </span><span>65</span><span> </span><span>33</span><span> </span><span>34</span><span> </span><span>35</span><span> </span><span>36</span><span> </span><span>36</span><span> </span><span>32</span><span> </span><span>┊</span><span> </span><span>63</span><span> </span><span>37</span><span> </span><span>64</span><span> </span><span>35</span><span> </span><span>33</span><span> </span><span>34</span><span> </span><span>30</span><span> </span><span>38</span><span> </span><span>│</span><span> </span><span>e345662┊c7d53408│</span></p></div><div><div><p>8</p></div><p><span>│00000050│</span><span> </span><span>65</span><span> </span><span>62</span><span> </span><span>32</span><span> </span><span>36</span><span> </span><span>33</span><span> </span><span>38</span><span> </span><span>63</span><span> </span><span>66</span><span> </span><span>┊</span><span> </span><span>30</span><span> </span><span>66</span><span> </span><span>64</span><span> </span><span>62</span><span> </span><span>61</span><span> </span><span>65</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>│eb2638cf┊0fdbae44│</span></p></div><div><div><p>9</p></div><p><span>...</span></p></div></code></pre></figure></div>
<p>So this follows the format <code>commit (content length)\x00(commit contents)</code> which is the format used by all the other types of objects too.</p>
<a href="#tree-objects">#</a><h3 id="tree-objects">Tree objects</h3>
<p>We can see the hash of another object here by looking at the first info after the null byte: <code>tree 5a0be7720e65417e08034a64bc257bc56a60b4b3</code>. This tells us that the “tree” object with hash <code>5a0be772</code> contains the files included in the commit.</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>.git/objects/5a/0be7720e65417e08034a64bc257bc56a60b4b3</span><span> </span><span>|</span><span> </span><span>pigz</span><span> </span><span>-d</span></p></div><div><div><p>2</p></div><p><span>tree</span><span> </span><span>678100644</span><span> </span><span>.gitignore�</span><span> </span><span>H@�L�������BO��p�100644</span><span> </span><span>.prettierignore�Y��Vt</span><span>$</span><span>��n!]-</span><span> </span><span>]�100644</span><span> </span><span>.prettierrc.mjs�2iY��n�</span><span>$3Q</span><span>%�w��40000</span><span> </span><span>.vscode</span></p></div><div><div><p>3</p></div><p><span>                                                                                                                                     </span><span>3���i(�[�Ə��D��100644</span><span> </span><span>LICENCE���+�����rW4�^�</span><span>;</span><span>��r100644</span><span> </span><span>README.md]%��h�</span></p></div><div><div><p>4</p></div><p><span>~</span><span>n�</span><span>*</span><span>Q�w</span></p></div><div><div><p>5</p></div><p><span>       </span><span>�+�100644</span><span> </span><span>TODO.txt��E+1�n�[��</span><span>    </span><span>��ڏ�100644</span><span> </span><span>astro.config.mjs</span><span>(</span></p></div><div><div><p>6</p></div><p><span>                                                                    </span><span>��c�Xp����jl�5A40000</span><span> </span><span>fonts�0�A�����&#39;���y�}40000 images��[z��CY��9������100644 logo.svg���</span></p></div><div><div><p>7</p></div><p><span><span>                                                                                                                                                             </span></span><span>i:L��6��</span></p></div><div><div><p>8</p></div><p><span>100644 package-lock.json�����,!���ԥ��1��100644 package.jsonH�jCi��� i�za�c;�b�40000 public�D�PD0en/�%1��0ư��40000 src�OF;�0�                                         ���)</span></p></div><div><div><p>9</p></div><p><span>�a�100644 tsconfig.jso?�s����V�v 4ice&gt;y⏎</span></p></div></code></pre></figure></div>
<p>We can clearly see that this contains some useful information like filenames and some 644s which smells of unix permissions/file modes, but it looks like a mixed binary-text format. If we look at the hex, we can see a bit clearer what’s going on:</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>.git/objects/5a/0be7720e65417e08034a64bc257bc56a60b4b3</span><span> </span><span>|</span><span> </span><span>pigz</span><span> </span><span>-d</span><span> </span><span>|</span><span> </span><span>hexyl</span></p></div><div><div><p>2</p></div><p><span>┌────────┬─────────────────────────┬─────────────────────────┬────────┬────────┐</span></p></div><div><div><p>3</p></div><p><span>│00000000│</span><span> </span><span>74</span><span> </span><span>72</span><span> </span><span>65</span><span> </span><span>65</span><span> </span><span>20</span><span> </span><span>36</span><span> </span><span>37</span><span> </span><span>38</span><span> </span><span>┊</span><span> </span><span>00</span><span> </span><span>31</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>20</span><span> </span><span>│tree</span><span> </span><span>678┊⋄100644</span><span> </span><span>│</span></p></div><div><div><p>4</p></div><p><span>│00000010│</span><span> </span><span>2e</span><span> </span><span>67</span><span> </span><span>69</span><span> </span><span>74</span><span> </span><span>69</span><span> </span><span>67</span><span> </span><span>6e</span><span> </span><span>6f</span><span> </span><span>┊</span><span> </span><span>72</span><span> </span><span>65</span><span> </span><span>00</span><span> </span><span>d6</span><span> </span><span>20</span><span> </span><span>48</span><span> </span><span>19</span><span> </span><span>40</span><span> </span><span>│.gitigno┊re⋄×</span><span> </span><span>H•@│</span></p></div><div><div><p>5</p></div><p><span>│00000020│</span><span> </span><span>d7</span><span> </span><span>4c</span><span> </span><span>de</span><span> </span><span>f6</span><span> </span><span>ff</span><span> </span><span>ba</span><span> </span><span>be</span><span> </span><span>c0</span><span> </span><span>┊</span><span> </span><span>d2</span><span> </span><span>42</span><span> </span><span>4f</span><span> </span><span>a7</span><span> </span><span>b5</span><span> </span><span>70</span><span> </span><span>f6</span><span> </span><span>31</span><span> </span><span>│×L××××××┊×BO××p×1│</span></p></div><div><div><p>6</p></div><p><span>│00000030│</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>20</span><span> </span><span>2e</span><span> </span><span>70</span><span> </span><span>┊</span><span> </span><span>72</span><span> </span><span>65</span><span> </span><span>74</span><span> </span><span>74</span><span> </span><span>69</span><span> </span><span>65</span><span> </span><span>72</span><span> </span><span>69</span><span> </span><span>│00644</span><span> </span><span>.p┊rettieri│</span></p></div><div><div><p>7</p></div><p><span>│00000040│</span><span> </span><span>67</span><span> </span><span>6e</span><span> </span><span>6f</span><span> </span><span>72</span><span> </span><span>65</span><span> </span><span>00</span><span> </span><span>dd</span><span> </span><span>59</span><span> </span><span>┊</span><span> </span><span>c0</span><span> </span><span>f4</span><span> </span><span>8e</span><span> </span><span>56</span><span> </span><span>74</span><span> </span><span>24</span><span> </span><span>ef</span><span> </span><span>9b</span><span> </span><span>│gnore⋄×Y┊×××Vt</span><span>$</span><span>××│</span></p></div><div><div><p>8</p></div><p><span>│00000050│</span><span> </span><span>e7</span><span> </span><span>6e</span><span> </span><span>21</span><span> </span><span>1d</span><span> </span><span>5d</span><span> </span><span>2d</span><span> </span><span>20</span><span> </span><span>5d</span><span> </span><span>┊</span><span> </span><span>e2</span><span> </span><span>80</span><span> </span><span>31</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>│×n!•]-</span><span> </span><span>]┊××100644│</span></p></div><div><div><p>9</p></div><p><span>│00000060│</span><span> </span><span>20</span><span> </span><span>2e</span><span> </span><span>70</span><span> </span><span>72</span><span> </span><span>65</span><span> </span><span>74</span><span> </span><span>74</span><span> </span><span>69</span><span> </span><span>┊</span><span> </span><span>65</span><span> </span><span>72</span><span> </span><span>72</span><span> </span><span>63</span><span> </span><span>2e</span><span> </span><span>6d</span><span> </span><span>6a</span><span> </span><span>73</span><span> </span><span>│</span><span> </span><span>.pretti┊errc.mjs│</span></p></div><div><div><p>10</p></div><p><span>│00000070│</span><span> </span><span>00</span><span> </span><span>b8</span><span> </span><span>32</span><span> </span><span>69</span><span> </span><span>59</span><span> </span><span>18</span><span> </span><span>96</span><span> </span><span>10</span><span> </span><span>┊</span><span> </span><span>b9</span><span> </span><span>6e</span><span> </span><span>eb</span><span> </span><span>24</span><span> </span><span>33</span><span> </span><span>51</span><span> </span><span>25</span><span> </span><span>89</span><span> </span><span>│⋄×2iY•×•┊×n×</span><span>$3Q</span><span>%×│</span></p></div><div><div><p>11</p></div><p><span>│00000080│</span><span> </span><span>77</span><span> </span><span>04</span><span> </span><span>02</span><span> </span><span>b4</span><span> </span><span>eb</span><span> </span><span>34</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>┊</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>20</span><span> </span><span>2e</span><span> </span><span>76</span><span> </span><span>73</span><span> </span><span>63</span><span> </span><span>6f</span><span> </span><span>│w••××400┊00</span><span> </span><span>.vsco│</span></p></div><div><div><p>12</p></div><p><span>│00000090│</span><span> </span><span>64</span><span> </span><span>65</span><span> </span><span>00</span><span> </span><span>0c</span><span> </span><span>33</span><span> </span><span>c7</span><span> </span><span>c3</span><span> </span><span>c0</span><span> </span><span>┊</span><span> </span><span>69</span><span> </span><span>28</span><span> </span><span>c9</span><span> </span><span>5b</span><span> </span><span>e8</span><span> </span><span>c6</span><span> </span><span>8f</span><span> </span><span>9f</span><span> </span><span>│de⋄_3×××┊i</span><span>(</span><span>×[××××│</span></p></div><div><div><p>13</p></div><p><span>│000000a0│</span><span> </span><span>15</span><span> </span><span>a5</span><span> </span><span>08</span><span> </span><span>c8</span><span> </span><span>44</span><span> </span><span>a3</span><span> </span><span>dc</span><span> </span><span>31</span><span> </span><span>┊</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>20</span><span> </span><span>4c</span><span> </span><span>49</span><span> </span><span>│•×•×D××1┊00644</span><span> </span><span>LI│</span></p></div><div><div><p>14</p></div><p><span>│000000b0│</span><span> </span><span>43</span><span> </span><span>45</span><span> </span><span>4e</span><span> </span><span>43</span><span> </span><span>45</span><span> </span><span>00</span><span> </span><span>e2</span><span> </span><span>18</span><span> </span><span>┊</span><span> </span><span>cd</span><span> </span><span>e0</span><span> </span><span>2b</span><span> </span><span>a8</span><span> </span><span>bf</span><span> </span><span>d9</span><span> </span><span>ea</span><span> </span><span>c7</span><span> </span><span>│CENCE⋄×•┊××+×××××│</span></p></div><div><div><p>15</p></div><p><span>│000000c0│</span><span> </span><span>72</span><span> </span><span>57</span><span> </span><span>34</span><span> </span><span>f4</span><span> </span><span>5e</span><span> </span><span>95</span><span> </span><span>3b</span><span> </span><span>b7</span><span> </span><span>┊</span><span> </span><span>87</span><span> </span><span>72</span><span> </span><span>31</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>│rW4×^×</span><span>;</span><span>×┊×r100644│</span></p></div><div><div><p>16</p></div><p><span>│000000d0│</span><span> </span><span>20</span><span> </span><span>52</span><span> </span><span>45</span><span> </span><span>41</span><span> </span><span>44</span><span> </span><span>4d</span><span> </span><span>45</span><span> </span><span>2e</span><span> </span><span>┊</span><span> </span><span>6d</span><span> </span><span>64</span><span> </span><span>00</span><span> </span><span>5d</span><span> </span><span>25</span><span> </span><span>dd</span><span> </span><span>e9</span><span> </span><span>68</span><span> </span><span>│</span><span> </span><span>README.┊md⋄]%××h│</span></p></div><div><div><p>17</p></div><p><span>│000000e0│</span><span> </span><span>b1</span><span> </span><span>0a</span><span> </span><span>7e</span><span> </span><span>6e</span><span> </span><span>a3</span><span> </span><span>2a</span><span> </span><span>51</span><span> </span><span>a7</span><span> </span><span>┊</span><span> </span><span>14</span><span> </span><span>77</span><span> </span><span>0c</span><span> </span><span>c8</span><span> </span><span>2b</span><span> </span><span>06</span><span> </span><span>b0</span><span> </span><span>31</span><span> </span><span>│×_~n×</span><span>*</span><span>Q×┊•w_×+•×1│</span></p></div><div><div><p>18</p></div><p><span>│000000f0│</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>20</span><span> </span><span>54</span><span> </span><span>4f</span><span> </span><span>┊</span><span> </span><span>44</span><span> </span><span>4f</span><span> </span><span>2e</span><span> </span><span>74</span><span> </span><span>78</span><span> </span><span>74</span><span> </span><span>00</span><span> </span><span>be</span><span> </span><span>│00644</span><span> </span><span>TO┊DO.txt⋄×│</span></p></div><div><div><p>19</p></div><p><span>│00000100│</span><span> </span><span>1c</span><span> </span><span>e0</span><span> </span><span>45</span><span> </span><span>2b</span><span> </span><span>31</span><span> </span><span>bd</span><span> </span><span>6e</span><span> </span><span>fd</span><span> </span><span>┊</span><span> </span><span>5b</span><span> </span><span>a2</span><span> </span><span>e3</span><span> </span><span>9f</span><span> </span><span>14</span><span> </span><span>09</span><span> </span><span>e9</span><span> </span><span>e8</span><span> </span><span>│•×E+1×n×┊[×××•_××│</span></p></div><div><div><p>20</p></div><p><span>│00000110│</span><span> </span><span>da</span><span> </span><span>8f</span><span> </span><span>a0</span><span> </span><span>31</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>┊</span><span> </span><span>34</span><span> </span><span>20</span><span> </span><span>61</span><span> </span><span>73</span><span> </span><span>74</span><span> </span><span>72</span><span> </span><span>6f</span><span> </span><span>2e</span><span> </span><span>│×××10064┊4</span><span> </span><span>astro.│</span></p></div><div><div><p>21</p></div><p><span>│00000120│</span><span> </span><span>63</span><span> </span><span>6f</span><span> </span><span>6e</span><span> </span><span>66</span><span> </span><span>69</span><span> </span><span>67</span><span> </span><span>2e</span><span> </span><span>6d</span><span> </span><span>┊</span><span> </span><span>6a</span><span> </span><span>73</span><span> </span><span>00</span><span> </span><span>28</span><span> </span><span>0c</span><span> </span><span>93</span><span> </span><span>c5</span><span> </span><span>63</span><span> </span><span>│config.m┊js⋄</span><span>(</span><span>_××c│</span></p></div><div><div><p>22</p></div><p><span>│00000130│</span><span> </span><span>bd</span><span> </span><span>58</span><span> </span><span>70</span><span> </span><span>16</span><span> </span><span>16</span><span> </span><span>b0</span><span> </span><span>e6</span><span> </span><span>1e</span><span> </span><span>┊</span><span> </span><span>f9</span><span> </span><span>ab</span><span> </span><span>6a</span><span> </span><span>6c</span><span> </span><span>ef</span><span> </span><span>35</span><span> </span><span>41</span><span> </span><span>34</span><span> </span><span>│×Xp••××•┊××jl×5A4│</span></p></div><div><div><p>23</p></div><p><span>│00000140│</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>20</span><span> </span><span>66</span><span> </span><span>6f</span><span> </span><span>6e</span><span> </span><span>┊</span><span> </span><span>74</span><span> </span><span>73</span><span> </span><span>00</span><span> </span><span>ef</span><span> </span><span>30</span><span> </span><span>1e</span><span> </span><span>e8</span><span> </span><span>41</span><span> </span><span>│0000</span><span> </span><span>fon┊ts⋄×0•×A│</span></p></div><div><div><p>24</p></div><p><span>│00000150│</span><span> </span><span>8d</span><span> </span><span>c7</span><span> </span><span>18</span><span> </span><span>d7</span><span> </span><span>c1</span><span> </span><span>16</span><span> </span><span>ed</span><span> </span><span>27</span><span> </span><span>┊</span><span> </span><span>1c</span><span> </span><span>8d</span><span> </span><span>b6</span><span> </span><span>a4</span><span> </span><span>79</span><span> </span><span>d0</span><span> </span><span>7d</span><span> </span><span>34</span><span> </span><span>│××•××•×&#39;┊•×××y×}4│</span></p></div><div><div><p>25</p></div><p><span>│00000160│ 30 30 30 30 20 69 6d 61 ┊ 67 65 73 00 1c 10 b7 b5 │0000 ima┊ges⋄••××│</span></p></div><div><div><p>26</p></div><p><span>│00000170│ 5b 7a 99 9c 43 59 18 e7 ┊ d9 39 fa 8f c8 ff d2 ca │[z××CY•×┊×9××××××│</span></p></div><div><div><p>27</p></div><p><span>│00000180│ 31 30 30 36 34 34 20 6c ┊ 6f 67 6f 2e 73 76 67 00 │100644 l┊ogo.svg⋄│</span></p></div><div><div><p>28</p></div><p><span>│00000190│ 95 07 b5 d8 0b 69 3a 4c ┊ 96 eb 06 36 b6 a7 0b be │×•××•i:L┊××•6××•×│</span></p></div><div><div><p>29</p></div><p><span>│000001a0│ a6 83 29 0d 31 30 30 36 ┊ 34 34 20 70 61 63 6b 61 │××)_1006┊44 packa│</span></p></div><div><div><p>30</p></div><p><span>│000001b0│ 67 65 2d 6c 6f 63 6b 2e ┊ 6a 73 6f 6e 00 9e 8f bc │ge-lock.┊json⋄×××│</span></p></div><div><div><p>31</p></div><p><span>│000001c0│ b0 d9 7f 11 2c 21 f7 a9 ┊ 8e d4 a5 be d8 31 10 86 │××••,!××┊×××××1•×│</span></p></div><div><div><p>32</p></div><p><span>│000001d0│ e4 31 30 30 36 34 34 20 ┊ 70 61 63 6b 61 67 65 2e │×100644 ┊package.│</span></p></div><div><div><p>33</p></div><p><span>│000001e0│ 6a 73 6f 6e 00 48 97 6a ┊ 43 69 f1 f4 e4 20 69 91 │json⋄H×j┊Ci××× i×│</span></p></div><div><div><p>34</p></div><p><span>│000001f0│ 02 7a 61 ec 63 3b 80 62 ┊ b9 34 30 30 30 30 20 70 │•za×c;×b┊×40000 p│</span></p></div><div><div><p>35</p></div><p><span>│00000200│ 75 62 6c 69 63 00 b0 44 ┊ d0 50 44 17 30 65 6e 2f │ublic⋄×D┊×PD•0en/│</span></p></div><div><div><p>36</p></div><p><span>│00000210│ 90 25 31 97 d1 30 c6 b0 ┊ 90 a8 34 30 30 30 30 20 │×%1××0××┊××40000 │</span></p></div><div><div><p>37</p></div><p><span>│00000220│ 73 72 63 00 cb 4f 46 3b ┊ b9 02 30 0e 8d 0a aa d6 │src⋄×OF;┊×•0•×_××│</span></p></div><div><div><p>38</p></div><p><span>│00000230│ 84 03 44 c6 40 2d b9 5d ┊ 31 30 30 36 34 34 20 74 │×•D×@-×]┊100644 t│</span></p></div><div><div><p>39</p></div><p><span>│00000240│ 61 69 6c 77 69 6e 64 2e ┊ 63 6f 6e 66 69 67 2e 6d │ailwind.┊config.m│</span></p></div><div><div><p>40</p></div><p><span>│00000250│ 6a 73 00 6b 3c 62 76 4e ┊ 97 2a f4 50 e1 e4 3d d8 │js⋄k&lt;bvN┊×*×P××=×│</span></p></div><div><div><p>41</p></div><p><span>│00000260│ d6 b9 35 5f b8 07 f2 34 ┊ 30 30 30 30 20 74 69 6e │××5_×•×4┊0000 tin│</span></p></div><div><div><p>42</p></div><p><span>│00000270│ 61 00 60 6f b2 72 1f d5 ┊ df 74 c9 81 c1 f6 36 42 │a⋄`o×r•×┊×t××××6B│</span></p></div><div><div><p>43</p></div><p><span>│00000280│ 38 23 0d d0 61 ae 31 30 ┊ 30 36 34 34 20 74 73 63 │8#_×a×10┊0644 tsc│</span></p></div><div><div><p>44</p></div><p><span>│00000290│ 6f 6e 66 69 67 2e 6a 73 ┊ 6f 6e 00 08 3f fe 73 de │onfig.js┊on⋄•?×s×│</span></p></div><div><div><p>45</p></div><p><span>│000002a0│ c8 f0 8b 56 e3 76 20 00 ┊ 05 34 69 63 65 3e 79    │×××V×v ⋄┊•4ice&gt;y │</span></p></div><div><div><p>46</p></div><p><span>└────────┴─────────────────────────┴─────────────────────────┴────────┴────────┘</span></p></div></code></pre></figure></div>
<p>Ok maybe it’s not that much clearer, but it’s obvious once I explain it:</p>
<div><figure><pre data-language="plaintext" tabindex="0"><code><div><div><p>1</p></div><p><span>(file mode) (file name)\x00(binary hash)(file mode) (file name)\x00(binary hash)...</span></p></div></code></pre></figure></div>
<p>The file mode is in plaintext so here we see that the file <code>.gitignore</code> has mode <code>100644</code> which (<a href="https://stackoverflow.com/a/15059931">according to Greg Bacon on StackOverflow</a>) means a regular file with permissions 644. (Side note: I don’t know what git does on Windows where unix file modes and stat don’t exist, leave a comment below if you do!)</p>
<p>This also tells us that the hash of the <code>.gitignore</code> file is <code>d6 20 48 19 40 d7 4c de f6 ff ba be c0 d2 42 4f a7 b5 70 f6</code> – we don’t need a null terminator at the end of this because SHA-1 hashes are always precisely 20 bytes, so we can go straight into the file mode of the next file in the tree without any bytes separating the two files in the tree.</p>
<p>Because git uses this content-addressing system, we can then look up the file itself using this hash:</p>
<div><figure><pre data-language="shell"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>.git/objects/d6/20481940d74cdef6ffbabec0d2424fa7b570f6</span><span>|</span><span>pigz</span><span> </span><span>-d</span></p></div><div><div><p>2</p></div><p><span>blob</span><span> </span><span>274.vscode</span></p></div><div><div><p>3</p></div></div><div><div><p>4</p></div><p><span># build output</span></p></div><div><div><p>5</p></div><p><span>dist/</span></p></div><div><div><p>6</p></div></div><div><div><p>7</p></div><p><span># generated types</span></p></div><div><div><p>8</p></div><p><span>.astro/</span></p></div><div><div><p>9</p></div></div><div><div><p>10</p></div><p><span># dependencies</span></p></div><div><div><p>11</p></div><p><span>node_modules/</span></p></div><div><div><p>12</p></div></div><div><div><p>13</p></div><p><span># logs</span></p></div><div><div><p>14</p></div><p><span>npm-debug.log*</span></p></div><div><div><p>15</p></div><p><span>yarn-debug.log*</span></p></div><div><div><p>16</p></div><p><span>yarn-error.log*</span></p></div><div><div><p>17</p></div><p><span>pnpm-debug.log*</span></p></div><div><div><p>18</p></div></div><div><div><p>19</p></div></div><div><div><p>20</p></div><p><span># environment variables</span></p></div><div><div><p>21</p></div><p><span>.env</span></p></div><div><div><p>22</p></div><p><span>.env.production</span></p></div><div><div><p>23</p></div></div><div><div><p>24</p></div><p><span># macOS-specific files</span></p></div><div><div><p>25</p></div><p><span>.DS_Store</span></p></div><div><div><p>26</p></div></div><div><div><p>27</p></div><p><span># jetbrains setting folder</span></p></div><div><div><p>28</p></div><p><span>.idea/</span></p></div></code></pre></figure></div>
<p>Again, we see the object type, in this case “blob” indicating file contents, followed by the length of the file contents, followed by a null byte (not shown by terminal here), followed by the file contents (and a very exciting example it is).</p>
<p>There’s actually some helper commands, which git calls “plumbing” commands, for printing out object info: <code>git cat-file -p (sha-1 hash)</code> will pretty print the object contents (the <code>-t</code> flag will display the object type and <code>-s</code> will display the size). We haven’t covered annotated tags, which are also objects, but they’re quite similar to commits and not massively interesting for our discussion. Lightweight tags (without messages) are just references to commits hashes, not objects, so are stored in the <code>refs/</code> folder alongside branches.</p>
<p>Neat!</p>
<a href="#but-wait-theres-no-diffsdelta-here-i-thought-commits-were-showing-changes-to-files">#</a><h3 id="but-wait-theres-no-diffsdelta-here-i-thought-commits-were-showing-changes-to-files">But wait, there’s no diffs/delta here! I thought commits were showing changes to files?</h3>
<p>Commits do not store deltas or differences between files but rather store the whole before and the whole after. This was actually one of the big selling points of git compared to competing version control systems, back before git became the de-facto standard<sup><a href="#user-content-fn-perforce-mercurial" id="user-content-fnref-perforce-mercurial" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup>.</p>
<p>What git does when you do <code>git diff</code> is get the before contents, get the after contents, then run a differ on these two versions to display to the user. You can even change the differ that git uses. Personally, I use <a href="https://dandavison.github.io/delta/">delta</a>, but I’ve heard good things about <a href="https://difftastic.wilfred.me.uk/">difftastic</a> and <a href="https://github.com/so-fancy/diff-so-fancy">diff-so-fancy</a>.</p>
<p>You might be thinking that this will surely make repositories mahoosive, right? We’ll get onto that in just a second.</p>
<a href="#whats-up-with-the-first-two-letters-of-the-hash-being-the-folder">#</a><h3 id="whats-up-with-the-first-two-letters-of-the-hash-being-the-folder">What’s up with the first two letters of the hash being the folder?</h3>
<p>Good question. Apparently, there are some filesystems which don’t allow you to have more than a certain n# files in any particular directory, and others which use a sequential scan to find a file within a directory, which wouldn’t be good if you were trying to commit to the Linux kernel, which has some <a href="https://softwareengineering.stackexchange.com/a/301401">~4.5 million objects</a> or so.</p>
<p>SHA-1 hashes are well distributed so you can expect as many hashes starting with <code>00</code> as <code>1e</code> as <code>8f</code> and every other possible combination. Git takes advantage of this by checking whether there are 27 or more files in any of these subdirectories<sup><a href="#user-content-fn-actually-17" id="user-content-fnref-actually-17" data-footnote-ref="" aria-describedby="footnote-label">3</a></sup>. If so, it would indicate that there are more than 6,700 objects in total, which tells git that it’s time to “pack” those “loose” objects up into packfiles, to save on space.</p>
<a href="#time-to-pack-it-up">#</a><h3 id="time-to-pack-it-up">Time to pack it up</h3>
<p>If you look in the <code>.git/objects</code> folder, there are a couple of non-hex folders that you might be wondering about. One is called <code>info/</code> and one is called <code>pack/</code>.</p>
<p>The “info” folder is super interesting and not something I encountered before researching for this blog post – turns out multiple git repositories can share a single object database to reduce on storage size which is pretty neat. I think the “info” folder is only used for very specific, niche use cases to be honest.</p>
<p>The “pack” folder is very commonly used, and it’s where git puts its packfiles. What’s a packfile, I hear you ask? Well, as I said above, when git decides that there are too many “loose” objects in the <code>.git/objects</code> folder (apparently, <a href="https://stackoverflow.com/a/18732276">6,700 by default</a>), it pulls multiple objects together into a single packfile. This allows multiple objects to be compressed together within the same file, improving compression ratios.</p>
<p>This does introduce the problem of how to find objects once they’ve been packed up. Git supports per-pack index files and also multi-index files, which is a more recent introduction that allows using a single index for all your packs. If you’re using multiple pack index files, you can try some tactics like looking at the most recently changed packfiles first as potential speedups, but ultimately you do have to search through all the packfile index files to find your object.</p>
<a href="#creating-our-first-commit">#</a><h2 id="creating-our-first-commit">Creating our first commit</h2>
<p>Now that we understand git objects, we can make our first commit.</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>echo</span><span> </span><span>-e</span><span> </span><span>&#34;Has spring come indeed?\nOn that nameless mountain lie\nThin layers of mist.\n\n  - Matsuo Bashō&#34;</span><span> </span><span>&gt;</span><span> </span><span>haiku.txt</span></p></div><div><div><p>2</p></div></div><div><div><p>3</p></div><p><span>$</span><span> </span><span>git</span><span> </span><span>status</span></p></div><div><div><p>4</p></div><p><span>On</span><span> </span><span>branch</span><span> </span><span>main</span></p></div><div><div><p>5</p></div></div><div><div><p>6</p></div><p><span>No</span><span> </span><span>commits</span><span> </span><span>yet</span></p></div><div><div><p>7</p></div></div><div><div><p>8</p></div><p><span>Untracked</span><span> </span><span>files:</span></p></div><div><div><p>9</p></div><p><span><span>  </span></span><span>(</span><span>use</span><span> </span><span>&#34;git add &lt;file&gt;...&#34;</span><span> </span><span>to</span><span> </span><span>include</span><span> </span><span>in</span><span> </span><span>what</span><span> </span><span>will</span><span> </span><span>be</span><span> </span><span>committed</span><span>)</span></p></div><div><div><p>10</p></div><p><span>        </span><span>haiku.txt</span></p></div><div><div><p>11</p></div></div><div><div><p>12</p></div><p><span>nothing</span><span> </span><span>added</span><span> </span><span>to</span><span> </span><span>commit</span><span> </span><span>but</span><span> </span><span>untracked</span><span> </span><span>files</span><span> </span><span>present</span><span> (use </span><span>&#34;git add&#34;</span><span> </span><span>to</span><span> </span><span>track</span><span>)</span></p></div></code></pre></figure></div>
<p>Okay, so normally we would need to add the file to our staging area before we can commit it. But we don’t really need to do that because we’re handcrafting our artisanal repository. Plus, the index is a binary file located in <code>.git/index</code> which makes it a) not massively interesting and b) not particularly easy to manipulate using just command line tools.</p>
<p>If you’re interested in learning more about the index file format and enjoy sitting down with a cup of hot mocha and an internal documentation page describing binary file formats, take a look over at the git docs reference page on the index format: <a href="https://git-scm.com/docs/index-format%5B%5Eme-disclaimer">https://git-scm.com/docs/index-format[^me-disclaimer</a>].</p>
<a href="#creating-our-file-blob">#</a><h3 id="creating-our-file-blob">Creating our file blob</h3>
<p>Okay, so we need to construct the commit object from scratch. Let’s start with the blob, then use that to construct the tree, then we can build the commit object from that tree.</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>haiku.txt</span><span> </span><span>|</span><span> </span><span>wc</span><span> </span><span>-c</span></p></div><div><div><p>2</p></div><p><span>      </span><span>94</span></p></div><div><div><p>3</p></div></div><div><div><p>4</p></div><p><span># Note: SHA-1 is done before applying zlib compression.</span></p></div><div><div><p>5</p></div><p><span>$</span><span> </span><span>echo</span><span> </span><span>-e</span><span> </span><span>&#34;blob 94\x00$(</span><span>cat</span><span> haiku.txt)&#34;</span><span> </span><span>|</span><span> </span><span>sha1sum</span></p></div><div><div><p>6</p></div><p><span>e5d59773e77daf9f9b9129781ca77d475a451831</span><span>  </span><span>-</span></p></div><div><div><p>7</p></div></div><div><div><p>8</p></div><p><span>$</span><span> </span><span>mkdir</span><span> </span><span>-p</span><span> </span><span>.git/objects/e5</span></p></div><div><div><p>9</p></div></div><div><div><p>10</p></div><p><span>$</span><span> </span><span>echo</span><span> </span><span>-e</span><span> </span><span>&#34;blob 94\x00$(</span><span>cat</span><span> haiku.txt)&#34;</span><span> </span><span>|</span><span> </span><span>pigz</span><span> </span><span>-z</span><span> </span><span>&gt;</span><span> </span><span>.git/objects/e5/d59773e77daf9f9b9129781ca77d475a451831</span></p></div><div><div><p>11</p></div></div><div><div><p>12</p></div><p><span># Check whether we messed it up yet</span></p></div><div><div><p>13</p></div><p><span>$</span><span> </span><span>git</span><span> </span><span>cat-file</span><span> </span><span>-p</span><span> </span><span>e5d59773e77daf9f9b9129781ca77d475a451831</span></p></div><div><div><p>14</p></div><p><span>Has</span><span> </span><span>spring</span><span> </span><span>come</span><span> </span><span>indeed?</span></p></div><div><div><p>15</p></div><p><span>On</span><span> </span><span>that</span><span> </span><span>nameless</span><span> </span><span>mountain</span><span> </span><span>lie</span></p></div><div><div><p>16</p></div><p><span>Thin</span><span> </span><span>layers</span><span> </span><span>of</span><span> </span><span>mist.</span></p></div><div><div><p>17</p></div></div><div><div><p>18</p></div><p><span>  </span><span>-</span><span> </span><span>Matsuo</span><span> </span><span>Bashō</span></p></div><div><div><p>19</p></div></div><div><div><p>20</p></div><p><span># Nice!</span></p></div></code></pre></figure></div>
<a href="#creating-our-tree-blob">#</a><h3 id="creating-our-tree-blob">Creating our tree blob</h3>
<p>Phew, so now let’s use that file blob object to create a tree blob with just that file in it, using file mode 100644 again:</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span># Let&#39;s make a helper function for the hex to bytes conversion.</span></p></div><div><div><p>2</p></div><p><span># Note: I use fish, where this works but you need to add another `\\` before the `x&amp;` in</span></p></div><div><div><p>3</p></div><p><span># the sed command.</span></p></div><div><div><p>4</p></div><p><span>$</span><span> </span><span>function</span><span> </span><span>hex-to-bytes</span><span>() </span><span>{</span><span> </span><span>printf</span><span> </span><span>&#34;$(</span><span>printf</span><span> &#34;</span><span>$1</span><span>&#34; </span><span>|</span><span> </span><span>sed</span><span> &#39;s/../\\x&amp;/g&#39;)&#34;</span><span>; }</span></p></div></code></pre></figure></div>
<p>Note for Fish shell users: your <code>hex-to-bytes()</code> function will look like this:</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>function</span><span> </span><span>hex-to-bytes;</span><span> printf </span><span>&#34;$(</span><span>printf</span><span> &#34;</span><span>$argv</span><span>[1]&#34; </span><span>|</span><span> </span><span>sed</span><span> &#39;s/../\\\\x&amp;/g&#39;)&#34;</span><span>; </span><span>end</span></p></div></code></pre></figure></div>
<p>Back to creating our tree object:</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>printf</span><span> </span><span>&#34;100644 haiku.txt\x00$(</span><span>hex-to-bytes</span><span> e5d59773e77daf9f9b9129781ca77d475a451831)&#34;</span><span> </span><span>|</span><span> </span><span>hexyl</span></p></div><div><div><p>2</p></div><p><span>┌────────┬─────────────────────────┬─────────────────────────┬────────┬────────┐</span></p></div><div><div><p>3</p></div><p><span>│00000000│</span><span> </span><span>31</span><span> </span><span>30</span><span> </span><span>30</span><span> </span><span>36</span><span> </span><span>34</span><span> </span><span>34</span><span> </span><span>20</span><span> </span><span>68</span><span> </span><span>┊</span><span> </span><span>61</span><span> </span><span>69</span><span> </span><span>6b</span><span> </span><span>75</span><span> </span><span>2e</span><span> </span><span>74</span><span> </span><span>78</span><span> </span><span>74</span><span> </span><span>│100644</span><span> </span><span>h┊aiku.txt│</span></p></div><div><div><p>4</p></div><p><span>│00000010│</span><span> </span><span>00</span><span> </span><span>e5</span><span> </span><span>d5</span><span> </span><span>97</span><span> </span><span>73</span><span> </span><span>e7</span><span> </span><span>7d</span><span> </span><span>af</span><span> </span><span>┊</span><span> </span><span>9f</span><span> </span><span>9b</span><span> </span><span>91</span><span> </span><span>29</span><span> </span><span>78</span><span> </span><span>1c</span><span> </span><span>a7</span><span> </span><span>7d</span><span> </span><span>│⋄×××s×}×┊×××</span><span>)x•×}│</span></p></div><div><div><p>5</p></div><p><span>│00000020│</span><span> </span><span>47</span><span> </span><span>5a</span><span> </span><span>45</span><span> </span><span>18</span><span> </span><span>31</span><span> </span><span>0a</span><span>       </span><span>┊</span><span>                         </span><span>│GZE•1_</span><span>  </span><span>┊</span><span>        </span><span>│</span></p></div><div><div><p>6</p></div><p><span>└────────┴─────────────────────────┴─────────────────────────┴────────┴────────┘</span></p></div><div><div><p>7</p></div></div><div><div><p>8</p></div><p><span># Looks good so far.</span></p></div><div><div><p>9</p></div><p><span>$</span><span> </span><span>printf</span><span> </span><span>&#34;100644 haiku.txt\x00$(</span><span>hex-to-bytes</span><span> e5d59773e77daf9f9b9129781ca77d475a451831)&#34;</span><span> </span><span>|</span><span> </span><span>wc</span><span> </span><span>-c</span></p></div><div><div><p>10</p></div><p><span>      </span><span>37</span></p></div><div><div><p>11</p></div></div><div><div><p>12</p></div><p><span>$</span><span> </span><span>printf</span><span> </span><span>&#34;tree 37\x00100644 haiku.txt\x00$(</span><span>hex-to-bytes</span><span> e5d59773e77daf9f9b9129781ca77d475a451831)&#34;</span><span> </span><span>|</span><span> </span><span>sha1sum</span></p></div><div><div><p>13</p></div><p><span>4aff48f6390a65b88d343ea5d23c03007646b5c2</span><span>  </span><span>-</span></p></div><div><div><p>14</p></div></div><div><div><p>15</p></div><p><span>$</span><span> </span><span>mkdir</span><span> </span><span>-p</span><span> </span><span>.git/objects/4a</span></p></div><div><div><p>16</p></div></div><div><div><p>17</p></div><p><span>$</span><span> </span><span>printf</span><span> </span><span>&#34;tree 37\x00100644 haiku.txt\x00$(</span><span>hex-to-bytes</span><span> e5d59773e77daf9f9b9129781ca77d475a451831)&#34;</span><span> </span><span>|</span><span> </span><span>pigz</span><span> </span><span>-z</span><span> </span><span>&gt;</span><span> </span><span>.git/objects/4a/ff48f6390a65b88d343ea5d23c03007646b5c2</span></p></div></code></pre></figure></div>
<a href="#creating-our-commit">#</a><h3 id="creating-our-commit">Creating our commit</h3>
<p>Now that we have our tree, we can create the commit! (Finally…)</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span># This will vary on your machine, obviously</span></p></div><div><div><p>2</p></div><p><span>$</span><span> </span><span>date</span><span> </span><span>+&#39;%s %z&#39;</span></p></div><div><div><p>3</p></div><p><span>1752659127</span><span> </span><span>+0100</span></p></div><div><div><p>4</p></div></div><div><div><p>5</p></div><p><span># Feel free to replace with your name/email and timestamp/timezone – just bear in mind</span></p></div><div><div><p>6</p></div><p><span># that the SHA-1 hash will be different.</span></p></div><div><div><p>7</p></div><p><span># Note: Commits usually have a &#34;parent&#34; field but as this is our first commit, it has no</span></p></div><div><div><p>8</p></div><p><span># parent.</span></p></div><div><div><p>9</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>&lt;&lt;</span><span>EOF</span><span> </span><span>&gt;</span><span> </span><span>/tmp/my-commit</span></p></div><div><div><p>10</p></div><p><span>tree 4aff48f6390a65b88d343ea5d23c03007646b5c2</span></p></div><div><div><p>11</p></div><p><span>author Drew Silcock &lt;redacted&gt; 1752659127 +0100</span></p></div><div><div><p>12</p></div><p><span>committer Drew Silcock &lt;redacted&gt; 1752659127 +0100</span></p></div><div><div><p>13</p></div></div><div><div><p>14</p></div><p><span>Initial artisanal commit.</span></p></div><div><div><p>15</p></div><p><span>EOF</span></p></div><div><div><p>16</p></div></div><div><div><p>17</p></div><p><span># Optional – I like to sign my commits.</span></p></div><div><div><p>18</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>/tmp/my-commit</span><span> </span><span>|</span><span> </span><span>gpg</span><span> </span><span>--armor</span><span> </span><span>--detach-sign</span></p></div><div><div><p>19</p></div><p><span>-----BEGIN</span><span> </span><span>PGP</span><span> </span><span>SIGNATURE-----</span></p></div><div><div><p>20</p></div></div><div><div><p>21</p></div><p><span>iQIzBAABCAAdFiEEaZwozZ5d++BpkqZmtEW8+mMmNyAFAmh3diEACgkQtEW8+mMm</span></p></div><div><div><p>22</p></div><p><span>NyDomRAAvWYhK9Eg+ZjmChFR2ZX9bB/KZH+H3ksziy2UHp8LiaHgOb3Ira02rpSm</span></p></div><div><div><p>23</p></div><p><span>LvVQjxmgurzYBd3nl1e/8E+V3TH1kGOzmvaoCcjJkSUj6togvD7+eImulc1/xkri</span></p></div><div><div><p>24</p></div><p><span>q/qqPXxvj2UoRMbSc4cVy/8SZ/MTxNWtCJsuFRe6iKLRiqk67h3PY+gvebCuJteC</span></p></div><div><div><p>25</p></div><p><span>TevKxWV/ra+NRX2Q0w52SEUpGTVcnnxYPyMEi28Kmd9VZUsOvuC43RMm/p7u/eiC</span></p></div><div><div><p>26</p></div><p><span>kAzJ3GKN4oQvN/3Xz8akb09VX66M/xbMYNv/J0pbSdeIGofMDfLA3oKeZzhrvUVf</span></p></div><div><div><p>27</p></div><p><span>zsrpiJ9kq2CTGIuZMJZQvPc8aEEMbr/PAHgSnSTicayon7JLoi5aaoyhZLCD+pgK</span></p></div><div><div><p>28</p></div><p><span>Sd6OMMjrKs61UL2qxelVVde2tZumfOL4GmILrhxQgqZbZsdfDUvPMee9yFkEZVam</span></p></div><div><div><p>29</p></div><p><span>re8ekkUlYmlmckTqJ0yQ7VTLYhdxPN+0DRynuiKKQaQlsCHhQi2MTYEn9l+mfbrO</span></p></div><div><div><p>30</p></div><p><span>7gUAe697+kDwo2VECs4Z7wtPG9F+kGNFpsC0CnGMWjKRR8ZBV9BBiLyc/SZgNd9Q</span></p></div><div><div><p>31</p></div><p><span>MZLQWPPvnMw0YlS59rHbUk3VwebxBKx8vX2WBt1NPFtmzkFRr73yL+e69JczspoM</span></p></div><div><div><p>32</p></div><p><span>t6FRuXH0bTtF+uVf7qD0saFXCC9lphLYFe5PuyzpIKwWbazGDFA</span><span>=</span></p></div><div><div><p>33</p></div><p><span>=rE6v</span></p></div><div><div><p>34</p></div><p><span>-----END</span><span> </span><span>PGP</span><span> </span><span>SIGNATURE-----</span></p></div><div><div><p>35</p></div></div><div><div><p>36</p></div><p><span># We need to insert this signature into the commit in the format `gpgsig &lt;signature&gt;`.</span></p></div><div><div><p>37</p></div><p><span># The single space at the start of each line is important.</span></p></div><div><div><p>38</p></div><p><span># NOTE: My auto-formatter is removing the whitespace on the line after &#34;BEGIN PGP</span></p></div><div><div><p>39</p></div><p><span># SIGNATURE&#34; – it should have a single space. You need that single space.</span></p></div><div><div><p>40</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>&lt;&lt;</span><span>EOF</span><span> </span><span>&gt;</span><span> </span><span>/tmp/my-commit-signed</span></p></div><div><div><p>41</p></div><p><span>tree 4aff48f6390a65b88d343ea5d23c03007646b5c2</span></p></div><div><div><p>42</p></div><p><span>author Drew Silcock &lt;redacted&gt; 1752659127 +0100</span></p></div><div><div><p>43</p></div><p><span>committer Drew Silcock &lt;redacted&gt; 1752659127 +0100</span></p></div><div><div><p>44</p></div><p><span>gpgsig -----BEGIN PGP SIGNATURE-----</span></p></div><div><div><p>45</p></div></div><div><div><p>46</p></div><p><span><span> </span></span><span>iQIzBAABCAAdFiEEaZwozZ5d++BpkqZmtEW8+mMmNyAFAmh3diEACgkQtEW8+mMm</span></p></div><div><div><p>47</p></div><p><span><span> </span></span><span>NyDomRAAvWYhK9Eg+ZjmChFR2ZX9bB/KZH+H3ksziy2UHp8LiaHgOb3Ira02rpSm</span></p></div><div><div><p>48</p></div><p><span><span> </span></span><span>LvVQjxmgurzYBd3nl1e/8E+V3TH1kGOzmvaoCcjJkSUj6togvD7+eImulc1/xkri</span></p></div><div><div><p>49</p></div><p><span><span> </span></span><span>q/qqPXxvj2UoRMbSc4cVy/8SZ/MTxNWtCJsuFRe6iKLRiqk67h3PY+gvebCuJteC</span></p></div><div><div><p>50</p></div><p><span><span> </span></span><span>TevKxWV/ra+NRX2Q0w52SEUpGTVcnnxYPyMEi28Kmd9VZUsOvuC43RMm/p7u/eiC</span></p></div><div><div><p>51</p></div><p><span><span> </span></span><span>kAzJ3GKN4oQvN/3Xz8akb09VX66M/xbMYNv/J0pbSdeIGofMDfLA3oKeZzhrvUVf</span></p></div><div><div><p>52</p></div><p><span><span> </span></span><span>zsrpiJ9kq2CTGIuZMJZQvPc8aEEMbr/PAHgSnSTicayon7JLoi5aaoyhZLCD+pgK</span></p></div><div><div><p>53</p></div><p><span><span> </span></span><span>Sd6OMMjrKs61UL2qxelVVde2tZumfOL4GmILrhxQgqZbZsdfDUvPMee9yFkEZVam</span></p></div><div><div><p>54</p></div><p><span><span> </span></span><span>re8ekkUlYmlmckTqJ0yQ7VTLYhdxPN+0DRynuiKKQaQlsCHhQi2MTYEn9l+mfbrO</span></p></div><div><div><p>55</p></div><p><span><span> </span></span><span>7gUAe697+kDwo2VECs4Z7wtPG9F+kGNFpsC0CnGMWjKRR8ZBV9BBiLyc/SZgNd9Q</span></p></div><div><div><p>56</p></div><p><span><span> </span></span><span>MZLQWPPvnMw0YlS59rHbUk3VwebxBKx8vX2WBt1NPFtmzkFRr73yL+e69JczspoM</span></p></div><div><div><p>57</p></div><p><span><span> </span></span><span>t6FRuXH0bTtF+uVf7qD0saFXCC9lphLYFe5PuyzpIKwWbazGDFA=</span></p></div><div><div><p>58</p></div><p><span><span> </span></span><span>=rE6v</span></p></div><div><div><p>59</p></div><p><span><span> </span></span><span>-----END PGP SIGNATURE-----</span></p></div><div><div><p>60</p></div></div><div><div><p>61</p></div><p><span>Initial artisanal commit.</span></p></div><div><div><p>62</p></div><p><span>EOF</span></p></div><div><div><p>63</p></div></div><div><div><p>64</p></div><p><span># Now we&#39;re ready to add the commit as an object into git&#39;s loose object storage.</span></p></div><div><div><p>65</p></div><p><span>$</span><span> </span><span>cat</span><span> </span><span>/tmp/my-commit-signed</span><span> </span><span>|</span><span> </span><span>wc</span><span> </span><span>-c</span></p></div><div><div><p>66</p></div><p><span>    </span><span>1027</span></p></div><div><div><p>67</p></div></div><div><div><p>68</p></div><p><span>$</span><span> </span><span>echo</span><span> </span><span>-e</span><span> </span><span>&#34;commit 1027\x00$(</span><span>cat</span><span> /tmp/my-commit-signed)&#34;</span><span> </span><span>|</span><span> </span><span>sha1sum</span></p></div><div><div><p>69</p></div><p><span>d62016426c1b7b4125d47bad267aeaaa78bb817c</span><span>  </span><span>-</span></p></div><div><div><p>70</p></div></div><div><div><p>71</p></div><p><span>$</span><span> </span><span>mkdir</span><span> </span><span>-p</span><span> </span><span>.git/objects/d6</span></p></div><div><div><p>72</p></div></div><div><div><p>73</p></div><p><span>$</span><span> </span><span>echo</span><span> </span><span>-e</span><span> </span><span>&#34;commit 1027\x00$(</span><span>cat</span><span> /tmp/my-commit-signed)&#34;</span><span> </span><span>|</span><span> </span><span>pigz</span><span> </span><span>-z</span><span> </span><span>&gt;</span><span> </span><span>.git/objects/d6/2016426c1b7b4125d47bad267aeaaa78bb817c</span></p></div></code></pre></figure></div>
<p>Okay, so now we’ve created our commit, but we haven’t told git that our main branch points to this commit yet. That’s fine, we just need to create the main branch reference file.</p>
<a href="#okay-but-what-is-a-reference">#</a><h3 id="okay-but-what-is-a-reference">Okay, but what is a reference?</h3>
<p>Well, an object is something that has data within it – it has a type and size and gets stored in <code>.git/objects</code> as either loose or packed files. A reference is just a hash – no contents. References live in <code>.git/refs</code> and there are 3 common types:</p>
<ul>
<li>local branches, that live in <code>.git/refs/heads/</code>, e.g. <code>.git/refs/heads/main</code> for the “main” branch</li>
<li>remote branches, that live in <code>.git/refs/remotes</code>, e.g. <code>.git/refs/remotes/origin/main</code> for the “main” branch in the remote called “origin”</li>
<li>lightweight tags, that live in <code>.git/refs/tags</code>, e.g. <code>.git/refs/tags/v1.2.3</code> for the “v1.2.3” tag (as mentioned before, annotated tags are objects because they contain messages).</li>
</ul>
<p>When you do <code>git fetch</code>, git checks the refs on the server to see whether they match the ones you’ve got in your <code>.git/refs/remotes</code> folder, and updates your local folder accordingly. When git says <code>Your branch is up to date with &#39;origin/main&#39;.</code>, it’s just saying that your local branch has the same reference in it than the remote branch, i.e. <code>.git/refs/heads/main</code> is identical to <code>.git/refs/remotes/origin/main</code>.</p>
<p>So what’s in one of these reference files? It’s just a commit hash! We already know our commit hash so let’s make our <code>main</code> branch and point it to our artisanally created commit:</p>
<div><figure><pre data-language="shell"><code><div><div><p>1</p></div><p><span>echo</span><span> </span><span>&#34;d62016426c1b7b4125d47bad267aeaaa78bb817c&#34;</span><span> </span><span>&gt;</span><span> </span><span>.git/refs/heads/main</span></p></div></code></pre></figure></div>
<a href="#checking-our-work">#</a><h3 id="checking-our-work">Checking our work</h3>
<p>We can use our good-old porcelain commands to check our handiwork:</p>
<div><figure><pre data-language="shell" tabindex="0"><code><div><div><p>1</p></div><p><span>$</span><span> </span><span>git</span><span> </span><span>status</span></p></div><div><div><p>2</p></div><p><span>On</span><span> </span><span>branch</span><span> </span><span>main</span></p></div><div><div><p>3</p></div><p><span>nothing</span><span> </span><span>to</span><span> </span><span>commit,</span><span> </span><span>working</span><span> </span><span>tree</span><span> </span><span>clean</span></p></div><div><div><p>4</p></div></div><div><div><p>5</p></div><p><span>$</span><span> </span><span>git</span><span> </span><span>branch</span></p></div><div><div><p>6</p></div><p><span>*</span><span> main</span></p></div><div><div><p>7</p></div></div><div><div><p>8</p></div><p><span>$</span><span> </span><span>git</span><span> </span><span>log</span><span> </span><span>--show-signature</span></p></div><div><div><p>9</p></div><p><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓</span></p></div><div><div><p>10</p></div><p><span>commit</span><span> </span><span>d62016426c1b7b4125d47bad267aeaaa78bb817c</span><span> (HEAD -</span><span>&gt;</span><span> </span><span>main</span><span>) ┃</span></p></div><div><div><p>11</p></div><p><span>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span></p></div><div><div><p>12</p></div><p><span>gpg:</span><span> </span><span>Signature</span><span> </span><span>made</span><span> </span><span>Wed</span><span> </span><span>16</span><span> </span><span>Jul</span><span> </span><span>10:51:29</span><span> </span><span>2025</span><span> </span><span>BST</span></p></div><div><div><p>13</p></div><p><span>gpg:</span><span>                </span><span>using</span><span> </span><span>RSA</span><span> </span><span>key</span><span> </span><span>699C28CD9E5DFBE06992A666B445BCFA63263720</span></p></div><div><div><p>14</p></div><p><span>gpg:</span><span> </span><span>Good</span><span> </span><span>signature</span><span> </span><span>from</span><span> </span><span>&#34;Drew Silcock &lt;redacted&gt;&#34;</span><span> [unknown]</span></p></div><div><div><p>15</p></div><p><span>gpg:</span><span> </span><span>WARNING:</span><span> </span><span>This</span><span> </span><span>key</span><span> </span><span>is</span><span> </span><span>not</span><span> </span><span>certified</span><span> </span><span>with</span><span> </span><span>a</span><span> </span><span>trusted</span><span> </span><span>signature!</span></p></div><div><div><p>16</p></div><p><span>gpg:</span><span>          </span><span>There</span><span> </span><span>is</span><span> </span><span>no</span><span> </span><span>indication</span><span> </span><span>that</span><span> </span><span>the</span><span> </span><span>signature</span><span> </span><span>belongs</span><span> </span><span>to</span><span> </span><span>the</span><span> </span><span>owner.</span></p></div><div><div><p>17</p></div><p><span>Primary</span><span> </span><span>key</span><span> </span><span>fingerprint:</span><span> </span><span>699C</span><span> </span><span>28CD</span><span> </span><span>9E5D</span><span> </span><span>FBE0</span><span> </span><span>6992</span><span>  </span><span>A666</span><span> </span><span>B445</span><span> </span><span>BCFA</span><span> </span><span>6326</span><span> </span><span>3720</span></p></div><div><div><p>18</p></div><p><span>Author:</span><span> </span><span>Drew</span><span> </span><span>Silcock</span><span> </span><span>&lt;redacted&gt;</span></p></div><div><div><p>19</p></div><p><span>Date:</span><span>   </span><span>Wed</span><span> </span><span>Jul</span><span> </span><span>16</span><span> </span><span>10:45:27</span><span> </span><span>2025</span><span> </span><span>+0100</span></p></div><div><div><p>20</p></div></div><div><div><p>21</p></div><p><span>    </span><span>Initial</span><span> </span><span>artisanal</span><span> </span><span>commit.</span></p></div></code></pre></figure></div>
<p>Nice! We did it 🎉🎊</p>
<a href="#troubleshooting">#</a><h2 id="troubleshooting">Troubleshooting</h2>
<p>If you get stuck with any of these points or get an error like <code>error: bad tree object HEAD</code>, try running <code>git fsck --full</code> and it’s likely to tell you what’s gone wrong.</p>
<a href="#future-topics">#</a><h2 id="future-topics">Future Topics</h2>
<p>It’s taken long enough to get to this point, but there’s a bunch of really interesting stuff that we didn’t have a chance to talk about – leave a comment, send me an email or shout into the wind which of the following you’d like to hear in a follow-up post:</p>
<ul>
<li>Stashes – how do they work? (Spoiler: they’re basically just commits)</li>
<li>Reflog – what is it and why should I care?</li>
<li>Packfile format and indices – I want to hear more about these packfiles and how git looks through them.</li>
<li>Index file format – I am deeply upset that you skipped over this and demand a full blog post covering the binary format in full detail bit-by-bit, otherwise I will be seeking legal action.</li>
<li>Networking – how does git communicate with the server? What’s the actual on-the-wire difference between using <code>https://github.com/...</code> vs. <code><a href="https://words.filippo.io/cdn-cgi/l/email-protection" data-cfemail="fd8e8e95bd9a948995889fd39e9290">[email protected]</a>:/...</code> vs. <code><a href="https://words.filippo.io/cdn-cgi/l/email-protection" data-cfemail="afc8c6dbefc8c6dbc7dacd81ccc0c2">[email protected]</a>:...</code>. I actually have no idea about this so it’d be interesting to explore.</li>
</ul>
<a href="#conclusion">#</a><h2 id="conclusion">Conclusion</h2>
<p>While it was fun to learn how all these internals work, it’s not a good idea to do this in an actual repository – you will break things, and it will make you sad.</p>
<p>Hopefully, you found this interesting. To be honest, if you make it this far, you either a) skipped over the rest to see whether the conclusion said anything interesting (sorry to disappoint) or b) are the kind of person who reads all the way through highly technical articles about artisanal hand-crafted git repositories. Either way, I hope you enjoyed the read and maybe even learned something.</p>
<p>If there’s one thing to take away from this, it is the elegance of the design of git, and how it’s actually not that complicated once you understand the underlying file formats. Yes, I know there’s rebases and reflogs and all these more complicated things but git is not magic, and implementing a git clone (pun intended) from scratch in a language of your choice actually wouldn’t be that hard! At least, if you ignore the more complex things.</p>
<a href="#further-reading">#</a><h2 id="further-reading">Further reading</h2>
<p>The main inspiration for this was reading Julia Evans’ blog posts about git, so if you found this interesting, check our her posts about git. Then check out all the others too, they’re all good.</p>
<ul>
<li>Julia Evans – Inside .git – <a href="https://jvns.ca/blog/2024/01/26/inside-git">https://jvns.ca/blog/2024/01/26/inside-git</a></li>
<li>Julia Evans – In a git repository, where do your files live? – <a href="https://jvns.ca/blog/2023/09/14/in-a-git-repository--where-do-your-files-live-/">https://jvns.ca/blog/2023/09/14/in-a-git-repository—where-do-your-files-live-/</a></li>
<li>Git Reference Documentation – The Git indec file has the following format – <a href="https://git-scm.com/docs/index-format">https://git-scm.com/docs/index-format</a></li>
<li>Unpacking Git packfiles – <a href="https://codewords.recurse.com/issues/three/unpacking-git-packfiles">https://codewords.recurse.com/issues/three/unpacking-git-packfiles</a></li>
<li>Abin Simon (@meain) – What is in that .git directory? – <a href="https://blog.meain.io/2023/what-is-in-dot-git/">https://blog.meain.io/2023/what-is-in-dot-git/</a></li>
<li>Dulwich Project Documentation – Git File format – <a href="https://www.samba.org/~jelmer/dulwich/docs/tutorial/file-format.html">https://www.samba.org/~jelmer/dulwich/docs/tutorial/file-format.html</a></li>
</ul>
   </article></div>
  </body>
</html>
