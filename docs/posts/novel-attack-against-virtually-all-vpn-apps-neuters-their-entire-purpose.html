<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://arstechnica.com/security/2024/05/novel-attack-against-virtually-all-vpn-apps-neuters-their-entire-purpose/">Original</a>
    <h1>Novel attack against virtually all VPN apps neuters their entire purpose</h1>
    
    <div id="readability-page-1" class="page"><div>
            <h4>
      VPN BUSTER    —
</h4>
            
            <h2 itemprop="description">TunnelVision vulnerability has existed since 2002 and may already be known to attackers.</h2>
            <section>

  


  
</section>        </div><section>
            <div itemprop="articleBody">
                                    
<figure>
  <img src="https://cdn.arstechnica.net/wp-content/uploads/2024/05/vpn-tunnel-800x625.jpg" alt="Novel attack against virtually all VPN apps neuters their entire purpose"/>
      <figcaption><p>Getty Images</p></figcaption>  </figure>

  




<!-- cache hit 56:single/related:dd31fda08d2692c665d23175c356f19f --><!-- empty -->
<p>Researchers have devised an attack against nearly all virtual private network applications that forces them to send and receive some or all traffic outside of the encrypted tunnel designed to protect it from snooping or tampering.</p>
<p>TunnelVision, as the researchers have named their attack, largely negates the entire purpose and selling point of VPNs, which is to encapsulate incoming and outgoing Internet traffic in an encrypted tunnel and to cloak the user’s IP address. The researchers believe it affects all VPN applications when they’re connected to a hostile network and that there are no ways to prevent such attacks except when the user&#39;s VPN runs on Linux or Android. They also said their attack technique may have been possible since 2002 and may already have been discovered and used in the wild since then.</p>
<h2>Reading, dropping, or modifying VPN traffic</h2>
<p>The effect of TunnelVision is “the victim&#39;s traffic is now decloaked and being routed through the attacker directly,” a <a href="https://www.youtube.com/watch?v=ajsLmZia6UU">video demonstration</a> explained. “The attacker can read, drop or modify the leaked traffic and the victim maintains their connection to both the VPN and the Internet.”</p>
<figure><p><iframe type="text/html" width="560" height="315" src="https://www.youtube.com/embed/ajsLmZia6UU?si=kroidLuk1JIYZpl_?start=0&amp;wmode=transparent" frameborder="0" allowfullscreen=""></iframe></p><figcaption><p>TunnelVision - CVE-2024-3661 - Decloaking Full and Split Tunnel VPNs - Leviathan Security Group.</p></figcaption></figure>
<p>The attack works by manipulating the <a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCP server</a> that allocates IP addresses to devices trying to connect to the local network. A setting known as <a href="https://datatracker.ietf.org/doc/html/rfc3442">option 121</a> allows the DHCP server to override default routing rules that send VPN traffic through a local IP address that initiates the encrypted tunnel. By using option 121 to route VPN traffic through the DHCP server, the attack diverts the data to the DHCP server itself. Researchers from Leviathan Security explained:</p>                                            
                                                        
<blockquote><p>Our technique is to run a DHCP server on the same network as a targeted VPN user and to also set our DHCP configuration to use itself as a gateway. When the traffic hits our gateway, we use traffic forwarding rules on the DHCP server to pass traffic through to a legitimate gateway while we snoop on it.</p>
<p>We use DHCP option 121 to set a route on the VPN user’s routing table. The route we set is arbitrary and we can also set multiple routes if needed. By pushing routes that are more specific than a /0 CIDR range that most VPNs use, we can make routing rules that have a higher priority than the routes for the virtual interface the VPN creates. We can set multiple /1 routes to recreate the 0.0.0.0/0 all traffic rule set by most VPNs.</p>
<p>Pushing a route also means that the network traffic will be sent over the same interface as the DHCP server instead of the virtual network interface. This is intended functionality that isn’t clearly stated in the RFC. Therefore, for the routes we push, it is never encrypted by the VPN’s virtual interface but instead transmitted by the network interface that is talking to the DHCP server. As an attacker, we can select which IP addresses go over the tunnel and which addresses go over the network interface talking to our DHCP server.</p>
<figure><a href="https://cdn.arstechnica.net/wp-content/uploads/2024/05/TunnelVision_Diagram_DHCP_121_Reroute_Traffic.png" data-height="1891" data-width="1430" alt="A malicious DHCP option 121 route that causes traffic to never be encrypted by the VPN process."><img alt="A malicious DHCP option 121 route that causes traffic to never be encrypted by the VPN process." src="https://cdn.arstechnica.net/wp-content/uploads/2024/05/TunnelVision_Diagram_DHCP_121_Reroute_Traffic-640x846.png" width="640" height="846" srcset="https://cdn.arstechnica.net/wp-content/uploads/2024/05/TunnelVision_Diagram_DHCP_121_Reroute_Traffic-1280x1693.png 2x"/></a><figcaption><p><a href="https://cdn.arstechnica.net/wp-content/uploads/2024/05/TunnelVision_Diagram_DHCP_121_Reroute_Traffic.png" data-height="1891" data-width="1430">Enlarge</a> <span>/</span> A malicious DHCP option 121 route that causes traffic to never be encrypted by the VPN process.</p><p>Leviathan Security</p></figcaption></figure>
<p>We now have traffic being transmitted outside the VPN’s encrypted tunnel. This technique can also be used against an already established VPN connection once the VPN user’s host needs to renew a lease from our DHCP server. We can artificially create that scenario by setting a short lease time in the DHCP lease, so the user updates their routing table more frequently. In addition, the VPN control channel is still intact because it already uses the physical interface for its communication. In our testing, the VPN always continued to report as connected, and the kill switch was never engaged to drop our VPN connection.</p></blockquote>
<p>The attack can most effectively be carried out by a person who has administrative control over the network the target is connecting to. In that scenario, the attacker configures the DHCP server to use option 121. It’s also possible for people who can connect to the network as an unprivileged user to perform the attack by setting up their own rogue DHCP server.</p>                                            
                                                        
<p>The attack allows some or all traffic to be routed through the unencrypted tunnel. In either case, the VPN application will report that all data is being sent through the protected connection. Any traffic that’s diverted away from this tunnel will not be encrypted by the VPN and the Internet IP address viewable by the remote user will belong to the network the VPN user is connected to, rather than one designated by the VPN app.</p>
<p>Interestingly, Android is the only operating system that fully immunizes VPN apps from the attack because it doesn&#39;t implement option 121. For all other OSes, there are no complete fixes. When apps run on Linux there’s a setting that minimizes the effects, but even then TunnelVision can be used to exploit a <a href="https://en.wikipedia.org/wiki/Side-channel_attack">side channel</a> that can be used to de-anonymize destination traffic and perform targeted denial-of-service attacks. Network firewalls can also be configured to deny inbound and outbound traffic to and from the physical interface. This remedy is problematic for two reasons: (1) a VPN user connecting to an untrusted network has no ability to control the firewall and (2) it opens the same side channel present with the Linux mitigation.</p>
<p>The most effective fixes are to run the VPN inside of a virtual machine whose network adapter isn’t in bridged mode or to connect the VPN to the Internet through the Wi-Fi network of a cellular device. The research, from Leviathan Security researchers Lizzie Moratti and Dani Cronce, is available <a href="https://www.leviathansecurity.com/blog/tunnelvision">here</a>.</p>

                                                </div>

            
            
            
        </section></div>
  </body>
</html>
