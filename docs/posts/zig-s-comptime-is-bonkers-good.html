<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.scottredig.com/blog/bonkers_comptime/">Original</a>
    <h1>Zig&#39;s comptime is bonkers good</h1>
    
    <div id="readability-page-1" class="page"><div id="main">
<p>Programming has obvious abilities to increase productivity through automated manipulation of data.  Metaprogramming allows code to be treated as data, turning programming’s power back onto itself.  Programming close to the metal has perhaps the most to gain from metaprogramming as high level concepts need to be mapped precisely to low level operations.  Yet outside of functional languages I’ve always found the metaprogramming story to be a disappointment.  So when I saw that Zig lists metaprogramming as a major feature, I took interest.</p><p>Honestly, my first experience writing something using Zig’s comptime were pretty rough.  The concepts seemed foreign, and figuring out how to achieve the outcome I wanted was difficult.  Then with a perspective shift, everything clicked and suddenly I loved it.  To help speed you along that path of discovery, presented below are 6 different “views” of comptime.  Each view focuses on a different way you can translate existing programming knowledge into working with Zig.</p><p>This is also not a full guide on all you need to know to write comptime. It’s more focused on providing a breadth of strategies, stretching your understanding in different ways that together lend a fuller picture of how to think about comptime.</p><p>For clarity, all of the examples are valid Zig code, but the transformations done by the examples are only conceptual in nature.  They are not how Zig is implemented.</p><h2>View 0: You can ignore it.</h2><p>It’s pretty weird to say I love a feature, then immediately declare you can ignore it.  However, I’m starting with what I truly think is Zig comptime’s superpower.  The third item in <code>zig zen</code> is <q>Favor reading code over writing code.</q>  Being able to easily read code is important for all sorts of reasons, as it is how you build a conceptual understanding that is required to debug or make modifications to that codebase.</p><p>Metaprogramming can quickly land itself into the realm of “write only code”.  If you’re trying to work with macro based metaprogramming or code generation, there’s now two versions of the code: the source code and the expanded code.  The extra layer of indirection makes everything from reading to debugging the code more difficult.  If you determine the behavior of the program needs to change, you need to determine what the generated code needs to be, and then have determine how to get the metaprogramming to produce that code.</p><p>In Zig, none of that overhead necessary.  You can simply ignore that portions of the code are run at different times, conceptually mixing runtime and comptime.  To demonstrate this, let’s step through two different pieces of code.  The first is some normal runtime code to set a baseline for stepping through code, and the second utilizes comptime.</p><div><div id="08D759430C_0"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span></span>
<span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_1"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_2"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_3"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span><span>value</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_4"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
<span><span>value</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_5"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
<span><span>value</span><span>:</span> <span>i64</span> <span>=</span> <span>2</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_6"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
<span><span>value</span><span>:</span> <span>i64</span> <span>=</span> <span>2</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_7"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
<span><span>value</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_8"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>6</span><span>;</span></span>
<span><span>value</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_9"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>6</span><span>;</span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="08D759430C_10"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>6</span><span>;</span></span>
<span></span>
</pre><pre><span>array&#39;s sum is 6.</span>
</pre></div><p><span id="08D759430C_previous" onclick="previous(&#39;08D759430C&#39;);">Previous</span><span id="08D759430C_reset" onclick="reset(&#39;08D759430C&#39;);">Reset</span><span id="08D759430C_next" onclick="next(&#39;08D759430C&#39;);">Next</span></p></div><p>Press next to step through the program, observing the changing state.  This one is simple enough: sum a list of numbers.  Now let’s do something weirder: sum the fields of a struct.  It’s a contrived example, but demonstrates the point well.</p><div><div id="D6F25F103F_0"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span></span>
<span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_1"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_2"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_3"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;a&#34;</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_4"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
<span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;a&#34;</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_5"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
<span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;b&#34;</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_6"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
<span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;b&#34;</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_7"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
<span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_8"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>6</span><span>;</span></span>
<span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_9"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>6</span><span>;</span></span>
<span></span>
</pre><pre><span></span>
</pre></div><div id="D6F25F103F_10"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span><span>}</span><span>;</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span><span>my_struct</span><span>:</span> <span>MyStruct</span> <span>=</span> <span>.</span><span>{</span><span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span> <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span> <span>.</span><span>c</span> <span>=</span> <span>3</span><span>}</span><span>;</span></span>
<span><span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>6</span><span>;</span></span>
<span></span>
</pre><pre><span>struct&#39;s sum is 6.</span>
</pre></div><p><span id="D6F25F103F_previous" onclick="previous(&#39;D6F25F103F&#39;);">Previous</span><span id="D6F25F103F_reset" onclick="reset(&#39;D6F25F103F&#39;);">Reset</span><span id="D6F25F103F_next" onclick="next(&#39;D6F25F103F&#39;);">Next</span></p></div><p>The comptime example here, compared to the array sum example, is pretty much a non-event.  That is the entire point!  An executable of this code is as efficient as if you hand wrote a sum function for the struct’s type in C, yet the code reads like something you might write in a language with runtime reflection.  While this isn’t how Zig actually works, this also isn’t some entirely theoretical exercise either: the Zig core team is working on a debugger that lets you step through code mixing comptime and runtime exactly like this example.</p><p>There’s a lot of Zig which is comptime, much more than some simple type reflection, yet you don’t need to dig into any of the details to simply read code.  Of course, if you want to actually write coding using comptime, you will eventually need to do more than ignore it.</p><h2>View 1: Oh look, generics.</h2><p>Generics are not a specific feature in Zig.  Instead a simple subset of comptime features together handle everything you need for generic programming.  This view doesn’t let you understand all of comptime, but it does provide you an entry point to complete many of the tasks you might use it for.  To make a type generic, simply wrap its definition in a function which takes a type, and returns a type.</p><div><div id="3E51882D94_0"><pre><span><span>pub</span> <span>fn</span> <span>GenericMyStruct</span><span>(</span><span>comptime</span> <span>T</span><span>:</span> <span>type</span><span>)</span> <span>type</span> <span>{</span></span>
<span>    <span>return</span> <span>struct</span> <span>{</span></span>
<span>        <span>a</span><span>:</span> <span>T</span><span>,</span></span>
<span>        <span>b</span><span>:</span> <span>T</span><span>,</span></span>
<span>        <span>c</span><span>:</span> <span>T</span><span>,</span></span>
<span></span>
<span>        <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>GenericMyStruct</span><span>(</span><span>T</span><span>)</span><span>)</span> <span>T</span> <span>{</span></span>
<span>            <span>var</span> <span>sum</span><span>:</span> <span>T</span> <span>=</span> <span>0</span><span>;</span></span>
<span>            <span>const</span> <span>fields</span> <span>=</span> <span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>GenericMyStruct</span><span>(</span><span>T</span><span>)</span><span>)</span><span>;</span></span>
<span>            <span>inline</span> <span>for</span> <span>(</span><span>fields</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>                <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>            <span>}</span></span>
<span>            <span>return</span> <span>sum</span><span>;</span></span>
<span>        <span>}</span></span>
<span>    <span>}</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>my_struct</span><span>:</span> <span>GenericMyStruct</span><span>(</span><span>i64</span><span>)</span> <span>=</span> <span>.</span><span>{</span></span>
<span>        <span>.</span><span>a</span> <span>=</span> <span>1</span><span>,</span></span>
<span>        <span>.</span><span>b</span> <span>=</span> <span>2</span><span>,</span></span>
<span>        <span>.</span><span>c</span> <span>=</span> <span>3</span><span>,</span></span>
<span>    <span>}</span><span>;</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;struct&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>my_struct</span><span>.</span><span>sumFields</span><span>(</span><span>)</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre></div><p><span id="3E51882D94_previous" onclick="previous(&#39;3E51882D94&#39;);">Previous</span><span id="3E51882D94_reset" onclick="reset(&#39;3E51882D94&#39;);">Reset</span><span id="3E51882D94_next" onclick="next(&#39;3E51882D94&#39;);">Next</span></p></div><p>Generic functions are possible as well.</p><div><div id="F4F43A2C18_0"><pre><span><span>fn</span> <span>quadratic</span><span>(</span><span>comptime</span> <span>T</span><span>:</span> <span>type</span><span>,</span> <span>a</span><span>:</span> <span>T</span><span>,</span> <span>b</span><span>:</span> <span>T</span><span>,</span> <span>c</span><span>:</span> <span>T</span><span>,</span> <span>x</span><span>:</span> <span>T</span><span>)</span> <span>T</span> <span>{</span></span>
<span>    <span>return</span> <span>a</span> <span>*</span> <span>x</span><span>*</span><span>x</span> <span>+</span> <span>b</span> <span>*</span> <span>x</span> <span>+</span> <span>c</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>a</span> <span>=</span> <span>quadratic</span><span>(</span><span>f32</span><span>,</span> <span>21.6</span><span>,</span> <span>3.2</span><span>,</span> <span>-</span><span>3</span><span>,</span> <span>0.5</span><span>)</span><span>;</span></span>
<span>    <span>const</span> <span>b</span> <span>=</span> <span>quadratic</span><span>(</span><span>i64</span><span>,</span> <span>1</span><span>,</span> <span>-</span><span>3</span><span>,</span> <span>4</span><span>,</span> <span>2</span><span>)</span><span>;</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;Answer: {d}{d}\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>a</span><span>,</span> <span>b</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre></div><p><span id="F4F43A2C18_previous" onclick="previous(&#39;F4F43A2C18&#39;);">Previous</span><span id="F4F43A2C18_reset" onclick="reset(&#39;F4F43A2C18&#39;);">Reset</span><span id="F4F43A2C18_next" onclick="next(&#39;F4F43A2C18&#39;);">Next</span></p></div><p>It is also possible to infer the type of an argument by using the special type <code>anytype</code>, typically used if the type of the argument doesn’t matter to the rest of the function signature.</p><h2>View 2: Standard code, run at compile time.</h2><p>It’s a tale as old as <del>time</del> programming:  A way to automate commands is added.  Then you need variables, of course.  Oh, conditionals too.  Please, can I have loops?  The path to a shoehorned macro language is paved with reasonable feature requests.  Zig uses the same language in runtime, comptime, and even the build system.</p><p>Consider the classic fizz buzz.</p><div><div id="C8698F3BFB_0"><pre><span><span>fn</span> <span>fizzBuzz</span><span>(</span><span>writer</span><span>:</span> <span>std</span><span>.</span><span>io</span><span>.</span><span>AnyWriter</span><span>)</span> <span>!</span><span>void</span> <span>{</span></span>
<span>    <span>var</span> <span>i</span><span>:</span> <span>usize</span> <span>=</span> <span>1</span><span>;</span></span>
<span>    <span>while</span> <span>(</span><span>i</span> <span>&lt;=</span> <span>100</span><span>)</span> <span>:</span> <span>(</span><span>i</span> <span>+=</span> <span>1</span><span>)</span> <span>{</span></span>
<span>        <span>if</span> <span>(</span><span>i</span> <span>%</span> <span>3</span> <span>==</span> <span>0</span> <span>and</span> <span>i</span> <span>%</span> <span>5</span> <span>==</span> <span>0</span><span>)</span> <span>{</span></span>
<span>            <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;fizzbuzz\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span>        <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>i</span> <span>%</span> <span>3</span> <span>==</span> <span>0</span><span>)</span> <span>{</span></span>
<span>            <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;fizz\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span>        <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>i</span> <span>%</span> <span>5</span> <span>==</span> <span>0</span><span>)</span> <span>{</span></span>
<span>            <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;buzz\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span>        <span>}</span> <span>else</span> <span>{</span></span>
<span>            <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;{d}\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>i</span><span>}</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>    <span>}</span></span>
<span><span>}</span></span>
<span></span>
<span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>!</span><span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>out_writer</span> <span>=</span> <span>std</span><span>.</span><span>io</span><span>.</span><span>getStdOut</span><span>(</span><span>)</span><span>.</span><span>writer</span><span>(</span><span>)</span><span>.</span><span>any</span><span>(</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>fizzBuzz</span><span>(</span><span>out_writer</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre></div><p><span id="C8698F3BFB_previous" onclick="previous(&#39;C8698F3BFB&#39;);">Previous</span><span id="C8698F3BFB_reset" onclick="reset(&#39;C8698F3BFB&#39;);">Reset</span><span id="C8698F3BFB_next" onclick="next(&#39;C8698F3BFB&#39;);">Next</span></p></div><p>Simple enough.  Though, one thing that I always find funny about conversations of making Fizz Buzz fast is that the standard version of the problem always runs for exactly the first 100 numbers.  So given that the output is fixed, why not just precompute the answer and output that?  Using the exact same fizzBuzz function, we can do just that.</p><div><div id="E33E659A24_0"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>!</span><span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>full_fizzbuzz</span> <span>=</span> <span>comptime</span> <span>init</span><span>:</span> <span>{</span></span>
<span>        <span>var</span> <span>cw</span> <span>=</span> <span>std</span><span>.</span><span>io</span><span>.</span><span>countingWriter</span><span>(</span><span>std</span><span>.</span><span>io</span><span>.</span><span>null_writer</span><span>)</span><span>;</span></span>
<span>        <span>fizzBuzz</span><span>(</span><span>cw</span><span>.</span><span>writer</span><span>(</span><span>)</span><span>.</span><span>any</span><span>(</span><span>)</span><span>)</span> <span>catch</span> <span>unreachable</span><span>;</span></span>
<span></span>
<span>        <span>var</span> <span>buffer</span><span>:</span> <span>[</span><span>cw</span><span>.</span><span>bytes_written</span><span>]</span><span>u8</span> <span>=</span> <span>undefined</span><span>;</span></span>
<span>        <span>var</span> <span>fbs</span> <span>=</span> <span>std</span><span>.</span><span>io</span><span>.</span><span>fixedBufferStream</span><span>(</span><span>&amp;</span><span>buffer</span><span>)</span><span>;</span></span>
<span>        <span>fizzBuzz</span><span>(</span><span>fbs</span><span>.</span><span>writer</span><span>(</span><span>)</span><span>.</span><span>any</span><span>(</span><span>)</span><span>)</span> <span>catch</span> <span>unreachable</span><span>;</span></span>
<span></span>
<span>        <span>break</span> <span>:</span><span>init</span> <span>buffer</span><span>;</span></span>
<span>    <span>}</span><span>;</span></span>
<span></span>
<span>    <span>const</span> <span>out_writer</span> <span>=</span> <span>std</span><span>.</span><span>io</span><span>.</span><span>getStdOut</span><span>(</span><span>)</span><span>.</span><span>writer</span><span>(</span><span>)</span><span>.</span><span>any</span><span>(</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>out_writer</span><span>.</span><span>writeAll</span><span>(</span><span>&amp;</span><span>full_fizzbuzz</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre></div><p><span id="E33E659A24_previous" onclick="previous(&#39;E33E659A24&#39;);">Previous</span><span id="E33E659A24_reset" onclick="reset(&#39;E33E659A24&#39;);">Reset</span><span id="E33E659A24_next" onclick="next(&#39;E33E659A24&#39;);">Next</span></p></div><p>Here the comptime keyword indicates that the block it precedes will run during the compile.  Additionally the block is labeled “init”, so that the whole block can evaluate to a value with the later break.  A writer which counts how many bytes are written (but discards the actual bytes written) is used to determine the total length.  An array is created with that length, written to, and set as full_fizzbuzz.</p><p>Timing just the critical section, the precomputed version runs about 9 times faster.  Of course, this example is so small the total execution time is dominated by other factors, but you get the idea.</p><p>There are a few small differences between comptime and runtime.  Only comptime has access to variables of types <code>comptime_int, comptime_float, or type</code>.  Additionally some functions have only comptime arguments, effectively making them comptime only.  Runtime is the only one to have access to system calls, or anything which would use them.  If your code doesn’t use any of those features, it will work equally well in both comptime and runtime.</p><h2>View 3: Partial Evaluation</h2><p>Now we’re getting to the fun stuff.</p><p>One way to view evaluation of code is to substitute inputs with their runtime value, and then repeatedly substitute the first expression into the evaluated form until only the result remains.  This is common in CS theory contexts, and some functional languages.  As a set up to a later example, we’ll use the array sum to get an idea of this process:</p><div><div id="92FB17A09D_0"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>array</span><span>)</span> <span>|</span><span>value</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Break the for loop into individual statements.</span>
<span></span>
</pre></div><div id="92FB17A09D_1"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>{</span></span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>0</span><span>]</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>{</span></span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>1</span><span>]</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>{</span></span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>2</span><span>]</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Substitue array[0] with 1.</span>
<span></span>
</pre></div><div id="92FB17A09D_2"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>1</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>1</span><span>]</span><span>;</span> </span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>2</span><span>]</span><span>;</span> </span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Substitute value with 1.</span>
<span></span>
</pre></div><div id="92FB17A09D_3"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>{</span> </span>
<span></span>
<span>        <span>sum</span> <span>+=</span> <span>1</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>1</span><span>]</span><span>;</span> </span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>2</span><span>]</span><span>;</span> </span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Increment sum by 1.</span>
<span></span>
</pre></div><div id="92FB17A09D_4"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>1</span><span>]</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>2</span><span>]</span><span>;</span> </span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Substitute array[1] with 2.</span>
<span></span>
</pre></div><div id="92FB17A09D_5"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>2</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>2</span><span>]</span><span>;</span> </span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Substitute value with 2.</span>
<span></span>
</pre></div><div id="92FB17A09D_6"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>1</span><span>;</span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span>    <span>{</span> </span>
<span></span>
<span>        <span>sum</span> <span>+=</span> <span>2</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>2</span><span>]</span><span>;</span> </span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span> </span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Increment sum by 2.</span>
<span></span>
</pre></div><div id="92FB17A09D_7"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span>    <span>const</span> <span>array</span><span>:</span> <span>[</span><span>3</span><span>]</span><span>i64</span> <span>=</span> <span>.</span><span>{</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>}</span><span>;</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>array</span><span>[</span><span>2</span><span>]</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Substitute array[2] with 3.</span>
<span></span>
</pre></div><div id="92FB17A09D_8"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>{</span> </span>
<span>        <span>const</span> <span>value</span> <span>=</span> <span>3</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>value</span><span>;</span></span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Substitute value with 3.</span>
<span></span>
</pre></div><div id="92FB17A09D_9"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>3</span><span>;</span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>{</span> </span>
<span></span>
<span>        <span>sum</span> <span>+=</span> <span>3</span><span>;</span></span>
<span>    <span>}</span> </span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Increment sum by 3.</span>
<span></span>
</pre></div><div id="92FB17A09D_10"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>6</span><span>;</span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>sum</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Substitute sum with 6.</span>
<span></span>
</pre></div><div id="92FB17A09D_11"><pre><span><span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>void</span> <span>{</span></span>
<span></span>
<span></span>
<span> </span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>std</span><span>.</span><span>debug</span><span>.</span><span>print</span><span>(</span><span>&#34;array&#39;s sum is {d}.\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>6</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre><pre><span>Next std.debug.print would be replaced by its implementation.</span>
<span>Stopping here for simplicity.</span>
</pre></div><p><span id="92FB17A09D_previous" onclick="previous(&#39;92FB17A09D&#39;);">Previous</span><span id="92FB17A09D_reset" onclick="reset(&#39;92FB17A09D&#39;);">Reset</span><span id="92FB17A09D_next" onclick="next(&#39;92FB17A09D&#39;);">Next</span></p></div><p>Partial evaluation is a technique by which you can pass some, but not necessarily all, of the arguments to a function.  The substitutions for expressions which use already only known values in this context can be performed.  This produces a new function which only takes the still unknown arguments.  Zig comptime can be viewed as a partial evaluation taking place during the compile process.  Taking another look at the sum struct example, gives us:</p><div><div id="605AF2C7FD_0"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span>inline for indicates that this for loop runs at comptime, so break the</span>
<span>iterations into individual statements.</span>
</pre></div><div id="605AF2C7FD_1"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;a&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;b&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span>Replace field_name with its value.</span>
<span></span>
</pre></div><div id="605AF2C7FD_2"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>{</span></span>
<span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>&#34;a&#34;</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;b&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span>@field allows accessing a field using a comptime known string.</span>
<span></span>
</pre></div><div id="605AF2C7FD_3"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>{</span></span>
<span></span>
<span>            <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;b&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span>continue with the next field, skipping ahead a bit.</span>
<span></span>
</pre></div><div id="605AF2C7FD_4"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>{</span></span>
<span></span>
<span>            <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span></span>
<span>            <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span>            <span>const</span> <span>field_name</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span>and the last field, skipping ahead again.</span>
<span></span>
</pre></div><div id="605AF2C7FD_5"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>{</span></span>
<span></span>
<span>            <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span></span>
<span>            <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>{</span></span>
<span></span>
<span>            <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>c</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span>Cleaning up the unnessisary scopes.</span>
<span></span>
</pre></div><div id="605AF2C7FD_6"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span></span>
<span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span></span>
<span></span>
<span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span></span>
<span></span>
<span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>c</span><span>;</span></span>
<span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span></span>
<span></span>
</pre></div><p><span id="605AF2C7FD_previous" onclick="previous(&#39;605AF2C7FD&#39;);">Previous</span><span id="605AF2C7FD_reset" onclick="reset(&#39;605AF2C7FD&#39;);">Reset</span><span id="605AF2C7FD_next" onclick="next(&#39;605AF2C7FD&#39;);">Next</span></p></div><p>The final function is “hand optimized”, but the work is done by Zig’s comptime.  This allows the intent to be directly coded.  No “remember to update the sum function when you change these fields” comment needed.  Any changes to <code>MyStruct</code>’s fields are just handled correctly.</p><h2>View 4: Comptime Evaluation, runtime code emission</h2><p>This is nearly the same as partial evaluation.  Here, there are two version of the code, input (pre-comptime) and output (post-comptime).  The input code is run by the compiler.  If a statement is knowable at compile time, it is simply evaluated.  However if a statement requires some runtime value, the statement is added to the output code.</p><div><div id="D58CE870A8_0"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_1"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_2"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;a&#34;</span><span>;</span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_3"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;a&#34;</span><span>;</span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_4"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;b&#34;</span><span>;</span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_5"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;b&#34;</span><span>;</span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_6"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_7"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span><span>field_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span> <span>=</span> <span>&#34;c&#34;</span><span>;</span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>c</span><span>;</span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_8"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>c</span><span>;</span></span>
<span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><div id="D58CE870A8_9"><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>            <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>        <span>}</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre><pre><span></span>
</pre><pre><span><span>const</span> <span>MyStruct</span> <span>=</span> <span>struct</span> <span>{</span></span>
<span>    <span>a</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>b</span><span>:</span> <span>i64</span><span>,</span></span>
<span>    <span>c</span><span>:</span> <span>i64</span><span>,</span></span>
<span></span>
<span>    <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>        <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>a</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>b</span><span>;</span></span>
<span>        <span>sum</span> <span>+=</span> <span>my_struct</span><span>.</span><span>c</span><span>;</span></span>
<span>        <span>return</span> <span>sum</span><span>;</span></span>
<span>    <span>}</span></span>
<span><span>}</span><span>;</span></span>
</pre></div><p><span id="D58CE870A8_previous" onclick="previous(&#39;D58CE870A8&#39;);">Previous</span><span id="D58CE870A8_reset" onclick="reset(&#39;D58CE870A8&#39;);">Reset</span><span id="D58CE870A8_next" onclick="next(&#39;D58CE870A8&#39;);">Next</span></p></div><p>This view is actually the closest to how Zig’s compiler handles comptime.  The primary difference is that Zig first parses the syntax of your code, and turns it into bytecode for a virtual machine.  That virtual machine running is how comptime is implemented.  This virtual machine will evaluate whatever it can, and emit new bytecode (which is later translated into machine code) for whatever needs to be handled at runtime.  Conditionals such as if statements with runtime inputs simply emit both paths.</p><p>A natural result of this is that dead code is never semantically analyzed.  This can take some getting used to, as writing an invalid function doesn’t always give you a compile error until you actually try to use it.  However this also makes compilation more efficient, and allows more natural looking conditional compilation, no <code>#ifdef</code>s here!</p><p>It’s worth noting how much comptime permeates Zig’s design.  All Zig code runs through this virtual machine, including functions with no obvious use of comptime.  Even where you see simple type names, such as function arguments, are actually expressions which evaluate in comptime to a variable of type <code>type</code>.  This is how the generics example above works.  It also means you can use a more complicated expressions to calculate a type, where appropriate.</p><p>Another consequence of this is that static analysis of Zig code is much more complicated than most statically typed languages, since significant portions of the compiler need to run to even determine all of the types.  So until Zig tooling is able to catch up, editor tools such as code completion don’t always work well.</p><h2>View 5: Textual Code Generation</h2><p>I lamented the difficulty of writing code that outputs new source code at the beginning of the post.  Yet it remains a powerful tool that, even in Zig, has its place in solving some problems.  If this method of metaprogramming is familiar to you then moving to Zig comptime might feel like a significant downgrade.  There is a familiar structure to writing code that, when run, produces code.</p><p>But wait, the last example did just that, right?  If you look at things in just the right way, there is an underlying equivalence between code that writes code and mixed comptime and runtime code.</p><p>The following example doesn’t step through code, instead it flips between two versions.  The first is an example which outputs the code, and the second is the familiar comptime example.  The two versions of code are aligned with the same logic on the same line.</p><div><div id="17333ED16D_0"><pre><span><span>pub</span> <span>fn</span> <span>writeSumFn</span><span>(</span></span>
<span>    <span>writer</span><span>:</span> <span>std</span><span>.</span><span>io</span><span>.</span><span>AnyWriter</span><span>,</span></span>
<span>    <span>type_name</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span><span>,</span></span>
<span>    <span>field_names</span><span>:</span> <span>[</span><span>]</span><span>[</span><span>]</span><span>const</span> <span>u8</span><span>,</span></span>
<span><span>)</span> <span>!</span><span>void</span> <span>{</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;fn sumFields(value: {s}) i64 {{\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>type_name</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;var sum: i64 = 0;\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>field_names</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;sum += value.{s};\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>field_name</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;return sum;\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;}}\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre></div><div id="17333ED16D_1"><pre><span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>MyStruct</span><span>)</span> <span>i64</span> <span>{</span></span>
<span>    <span>var</span> <span>sum</span><span>:</span> <span>i64</span> <span>=</span> <span>0</span><span>;</span></span>
<span>    <span>inline</span> <span>for</span> <span>(</span><span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>MyStruct</span><span>)</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>return</span> <span>sum</span><span>;</span></span>
<span><span>}</span></span>
<span></span>
</pre></div><p>Toggle</p><p>Notice how there are two conversions: The code which runs in the generator becomes the comptime part of the code.  The code which the generator outputs becomes the runtime part of the code.</p><p>Another thing I like about this example is it shows how generating code which uses type information as an input is much simpler with Zig.  The example handwaves where the type name and field name information comes from.  If you’re using some other form of input, such as a specification, Zig provides <code>@embedFile</code> which you can use to then parse like you normally would.</p><p>Bringing back the generics example, there are a few more subtleties worth highlighting:</p><div><div id="46445E3685_0"><pre><span><span>pub</span> <span>fn</span> <span>writeMyStructOfType</span><span>(</span></span>
<span>    <span>writer</span><span>:</span> <span>std</span><span>.</span><span>io</span><span>.</span><span>AnyWriter</span><span>,</span></span>
<span>    <span>T</span><span>:</span> <span>[</span><span>]</span><span>const</span> <span>u8</span><span>,</span></span>
<span><span>)</span> <span>!</span><span>void</span> <span>{</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;const MyStruct_{s} = struct {{\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>T</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;a: {s},\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>T</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;b: {s},\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>T</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;c: {s},\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>T</span><span>}</span><span>)</span><span>;</span></span>
<span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;fn sumFields(value: MyStruct_{s}) {s} {{\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>T</span><span>,</span><span>T</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;var sum: {s} = 0;\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>T</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>const</span> <span>fields</span> <span>=</span> <span>[</span><span>_</span><span>]</span><span>[</span><span>]</span><span>const</span> <span>u8</span><span>{</span> <span>&#34;a&#34;</span><span>,</span> <span>&#34;b&#34;</span><span>,</span> <span>&#34;c&#34;</span> <span>}</span><span>;</span></span>
<span>    <span>for</span> <span>(</span><span>fields</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>        <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;sum += value.{s};\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>field_name</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>}</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;return sum;\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;}}\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span>    <span>try</span> <span>writer</span><span>.</span><span>print</span><span>(</span><span>&#34;}};\n&#34;</span><span>,</span> <span>.</span><span>{</span><span>}</span><span>)</span><span>;</span></span>
<span><span>}</span></span>
</pre></div><div id="46445E3685_1"><pre><span><span>pub</span> <span>fn</span> <span>GenericMyStruct</span><span>(</span><span>comptime</span> <span>T</span><span>:</span> <span>type</span><span>)</span> <span>type</span> <span>{</span></span>
<span></span>
<span></span>
<span></span>
<span>    <span>return</span> <span>struct</span> <span>{</span></span>
<span>        <span>a</span><span>:</span> <span>T</span><span>,</span></span>
<span>        <span>b</span><span>:</span> <span>T</span><span>,</span></span>
<span>        <span>c</span><span>:</span> <span>T</span><span>,</span></span>
<span></span>
<span>        <span>fn</span> <span>sumFields</span><span>(</span><span>my_struct</span><span>:</span> <span>GenericMyStruct</span><span>(</span><span>T</span><span>)</span><span>)</span> <span>T</span> <span>{</span></span>
<span>            <span>var</span> <span>sum</span><span>:</span> <span>T</span> <span>=</span> <span>0</span><span>;</span></span>
<span>            <span>const</span> <span>fields</span> <span>=</span> <span>comptime</span> <span>std</span><span>.</span><span>meta</span><span>.</span><span>fieldNames</span><span>(</span><span>GenericMyStruct</span><span>(</span><span>T</span><span>)</span><span>)</span><span>;</span></span>
<span>            <span>inline</span> <span>for</span> <span>(</span><span>fields</span><span>)</span> <span>|</span><span>field_name</span><span>|</span> <span>{</span></span>
<span>                <span>sum</span> <span>+=</span> <span>@field</span><span>(</span><span>my_struct</span><span>,</span> <span>field_name</span><span>)</span><span>;</span></span>
<span>            <span>}</span></span>
<span>            <span>return</span> <span>sum</span><span>;</span></span>
<span>        <span>}</span></span>
<span>    <span>}</span><span>;</span></span>
<span><span>}</span></span>
</pre></div><p>Toggle</p><p>The fields retain the conversion above, but mix the two in a single line.  The field’s type expression is done by the generator/at comptime, while the field itself ends up as a definition used by the runtime code.</p><p>References to the name of the type are more direct with comptime, able to use the function directly instead of having to concat text into a name that has be to consistent across uses.</p><p>There is an exception to this view.  You can create types where the names of the fields are determined at comptime, however doing so involves calling a builtin function with a specification containing a list of field definitions.  As a result you can’t define declarations, such as methods, on these types.  In practice this doesn’t limit the expressiveness of your code, but it does limit what kinds of API you can expose to other code.</p><p>Relevant to this section are textual macros such as those in C.  Most of the sane things you can do can be done in comptime, though they rarely take a form that looks similar.  However, you can’t do everything that text macros allow.  For example, you can’t decide that you dislike a Zig keyword and have a macro substitute your own.  I think this is the right call, even if it’s a rough transition for those used to that ability.  Besides, Zig has half a century of programmers figuring out what is right, so its choices are far more sane.</p><h2>Conclusion</h2><p>When reading Zig code to understand the end behavior, taking comptime into consideration isn’t necessary.  When writing comptime code, I usually think about it in one of the forms of partial evaluation.  However, if you know how you’d solve a problem using a different methodology of metaprogramming, it’s very likely you’ll be able to translate it into comptime.</p><p>Realizing the textual code generation conversion exists is why I’m all in on Zig’s style of comptime metaprogramming.  On one hand, textual code generation is maximally powerful, on the other hand, the ability to ignore comptime while reading and debugging is maximally simple.  This is why, as I titled the post, Zig’s comptime is bonkers good.</p><h2>Further Reading</h2><p>Zig is not a one trick pony built upon comptime.  You can learn more about Zig at the <a href="https://ziglang.org/" target="_blank">official website</a>.</p><p>I used the same example multiple times in this post to simplify showing the different conversions that take place.  The downside of this is despite talking a lot about comptime, I haven’t actually shown much of it.  The <a href="https://ziglang.org/documentation/0.13.0/" target="_blank">language reference</a> goes over the specific features of comptime.</p><p>If you want to see more examples, I recommend just reading some of Zig’s standard library.  A few links for the curious:</p><p>The <a href="https://github.com/ziglang/zig/blob/0.13.0/lib/std/fmt.zig#L80" target="_blank">formatting function used by std.debug.print</a> in the examples is a powerful generic function.  Lots of languages parse their format strings at runtime, and possibly add some special validators to the string format to catch errors early.  In Zig, the format string is parsed at comptime, creating efficient output code while also performing all validation at compile time.</p><p><a href="https://github.com/ziglang/zig/blob/0.13.0/lib/std/array_list.zig#L25" target="_blank">ArrayList</a> is a fairly simple but fully featured generic container.</p><p>Zig main functions can have one of several different return types.  In typical Zig fashion, this isn’t some magical implementation in the compiler, but just some <a href="https://github.com/ziglang/zig/blob/0.13.0/lib/std/start.zig#L508" target="_blank">typical comptime code</a>.</p>
</div><hr/><p>If you wish to reach me about this post to provide a comment or correction, please email me at <a href="mailto:blogcomments@scottredig.com">blogcomments@scottredig.com</a></p><p><a href="https://www.scottredig.com/rss.xml" type="application/rss+xml">Subscribe to the RSS feed to be notified of my next post.</a></p>
    </div>
  
</div></div>
  </body>
</html>
