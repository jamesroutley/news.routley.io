<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/freelawproject/x-ray">Original</a>
    <h1>X-ray: a Python library for finding bad redactions in PDF documents</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text"><p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://raw.githubusercontent.com/freelawproject/x-ray/main/redacted.png"><img src="https://raw.githubusercontent.com/freelawproject/x-ray/main/redacted.png" alt="Image of REDACTED STAMP"/></a></p>
<p dir="auto">x-ray is a Python library for finding bad redactions in PDF documents.</p>

<p dir="auto">At Free Law Project, we collect millions of PDFs. An ongoing problem
is that people fail to properly redact things. Instead of doing it the right
way, they just draw a black rectangle or a black highlight on top of black
text and call it a day. Well, when that happens you just select the text under
the rectangle, and you can read it again. Not great.</p>
<p dir="auto">After witnessing this problem for years, we decided it would be good to figure
out how common it is, so, with some help, we built this simple tool. You give
the tool the path to a PDF. It tells you if it has worthless redactions in it.</p>

<p dir="auto">Right now, <code>x-ray</code> works pretty well and we are using it to analyze documents
in our collections. It could be better though. Bad redactions take many forms.
See the issues tab for other examples we don&#39;t yet support. We&#39;d love your
help solving some of tougher cases.</p>

<p dir="auto">With uv, do:</p>

<p dir="auto">With pip, that&#39;d be:</p>


<p dir="auto"><code>uvx</code> lets you run this without even installing it. For example, here&#39;s an amicus brief we filed that doesn&#39;t have any bad redactions:</p>
<div data-snippet-clipboard-copy-content="uvx --from x-ray xray https://storage.courtlistener.com/recap/gov.uscourts.ca3.125346/gov.uscourts.ca3.125346.45.0.pdf
{}"><pre><code>uvx --from x-ray xray https://storage.courtlistener.com/recap/gov.uscourts.ca3.125346/gov.uscourts.ca3.125346.45.0.pdf
{}
</code></pre></div>
<p dir="auto">Once you <em>do</em> install x-ray, you can easily use it on the command line. Once installed, just:</p>
<div dir="auto" data-snippet-clipboard-copy-content="% xray path/to/your/file.pdf
{
  &#34;1&#34;: [
    {
      &#34;bbox&#34;: [
        58.550079345703125,
        72.19873046875,
        75.65007781982422,
        739.3987426757812
      ],
      &#34;text&#34;: &#34;The Ring travels by way of Cirith Ungol&#34;
    }
  ]
}"><pre>% xray path/to/your/file.pdf
{
  <span><span>&#34;</span>1<span>&#34;</span></span>: [
    {
      <span><span>&#34;</span>bbox<span>&#34;</span></span>: [
        58.550079345703125,
        72.19873046875,
        75.65007781982422,
        739.3987426757812
      ],
      <span><span>&#34;</span>text<span>&#34;</span></span>: <span><span>&#34;</span>The Ring travels by way of Cirith Ungol<span>&#34;</span></span>
    }
  ]
}</pre></div>
<p dir="auto">Or if you have the file on a server somewhere, give it a URL. If it starts with <code>https://</code>, it will be interpreted as a PDF to download. Here&#39;s congressional testimony our director made (it doesn&#39;t have any bad redactions):</p>
<div dir="auto" data-snippet-clipboard-copy-content="% xray https://free.law/pdf/congressional-testimony-michael-lissner-free-law-project-hearing-on-ethics-and-transparency-2021-10-26.pdf
{}"><pre>% xray https://free.law/pdf/congressional-testimony-michael-lissner-free-law-project-hearing-on-ethics-and-transparency-2021-10-26.pdf
{}</pre></div>
<p dir="auto">A fun trick you can do is to make a file with one URL per line, call it <code>urls.txt</code>. Then you can run this to check each URL:</p>
<div dir="auto" data-snippet-clipboard-copy-content="xargs -n 1 xray  &lt; urls.txt"><pre>xargs -n 1 xray  <span>&lt;</span> urls.txt</pre></div>
<p dir="auto">However you run <code>xray</code> on the command line, you&#39;ll get JSON as output. When you have that, you can use it with tools like <a href="https://stedolan.github.io/jq/" rel="nofollow"><code>jq</code></a>. The format is as follows:</p>
<ul dir="auto">
<li>It&#39;s a dict.</li>
<li>The keys are page numbers.</li>
<li>Each page number maps to a list of dicts.</li>
<li>Each of those dicts maps to two keys.</li>
<li>The first key is <code>bbox</code>. This is a four-tuple that indicates the x,y positions of the upper left corner and then lower right corners of the bad redaction.</li>
<li>The second key is <code>text</code>. This is the text under the bad rectangle.</li>
</ul>
<p dir="auto">Simple enough.</p>
<p dir="auto">You can also use it as a Python module, if you prefer the long-form:</p>
<div data-snippet-clipboard-copy-content="% python -m xray some-file.pdf"><pre><code>% python -m xray some-file.pdf
</code></pre></div>
<p dir="auto">But that&#39;s not as easy to remember.</p>
<p dir="auto">If you want a bit more, you can, of course, use <code>xray</code> in Python:</p>
<div dir="auto" data-snippet-clipboard-copy-content="from pprint import pprint
import xray
bad_redactions = xray.inspect(&#34;some/path/to/your/file.pdf&#34;)  # Pathlib works too
pprint(bad_redactions)
{1: [{&#39;bbox&#39;: (58.550079345703125,
               72.19873046875,
               75.65007781982422,
               739.3987426757812),
      &#39;text&#39;: &#39;Aragorn is the one true king.&#39;}]}"><pre><span>from</span> <span>pprint</span> <span>import</span> <span>pprint</span>
<span>import</span> <span>xray</span>
<span>bad_redactions</span> <span>=</span> <span>xray</span>.<span>inspect</span>(<span>&#34;some/path/to/your/file.pdf&#34;</span>)  <span># Pathlib works too</span>
<span>pprint</span>(<span>bad_redactions</span>)
{<span>1</span>: [{<span>&#39;bbox&#39;</span>: (<span>58.550079345703125</span>,
               <span>72.19873046875</span>,
               <span>75.65007781982422</span>,
               <span>739.3987426757812</span>),
      <span>&#39;text&#39;</span>: <span>&#39;Aragorn is the one true king.&#39;</span>}]}</pre></div>
<p dir="auto">The output is the same as above, except it&#39;s a Python object, not a JSON object.</p>
<p dir="auto">If you already have the file contents as a <code>bytes</code> object, that&#39;ll work too:</p>
<div dir="auto" data-snippet-clipboard-copy-content="some_bytes = requests.get(&#34;https://lotr-secrets.com/some-doc.pdf&#34;).content
bad_redactions = xray.inspect(some_bytes)"><pre><span>some_bytes</span> <span>=</span> <span>requests</span>.<span>get</span>(<span>&#34;https://lotr-secrets.com/some-doc.pdf&#34;</span>).<span>content</span>
<span>bad_redactions</span> <span>=</span> <span>xray</span>.<span>inspect</span>(<span>some_bytes</span>)</pre></div>
<p dir="auto">Note that because the <code>inspect</code> method uses the same signature no matter what,
the type of the object you give it is essential:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Input</th>
<th><code>xray</code>&#39;s Assumption</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>str</code> or Pathlib <code>Path</code></td>
<td>local file</td>
</tr>
<tr>
<td><code>str</code> that starts with <code>https://</code></td>
<td>URL to download</td>
</tr>
<tr>
<td><code>bytes</code></td>
<td>PDF in memory</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">This means that if you provide the filename on disk as a bytes object instead
of a <code>str</code>, it&#39;s not going to work. This will fail:</p>
<div dir="auto" data-snippet-clipboard-copy-content="xray.inspect(b&#34;some-file-path.pdf&#34;)"><pre><span>xray</span>.<span>inspect</span>(<span>b&#34;some-file-path.pdf&#34;</span>)</pre></div>
<p dir="auto">That&#39;s pretty much it. There are no configuration files or other variables to
learn. You give it a file name. If there is a bad redaction in it, you&#39;ll soon
find out.</p>

<p dir="auto">Under the covers, <code>xray</code> uses the high-performant <a href="https://pymupdf.readthedocs.io/" rel="nofollow">PyMuPDF project</a> to parse PDFs. It has been a wonderful project to work with.</p>
<p dir="auto">You can read the source to see how it works, but the general idea is to:</p>
<ol dir="auto">
<li>
<p dir="auto">Find rectangles in a PDF.</p>
</li>
<li>
<p dir="auto">Find letters in the same location</p>
</li>
<li>
<p dir="auto">Render the rectangle as an image</p>
</li>
<li>
<p dir="auto">Inspect the rectangle to see if it&#39;s all one color. If it is, then that&#39;s a
bad redaction. If not, then we assume you can see a mix of text and
drawings, indicating a redaction that&#39;s OK.</p>
</li>
</ol>
<p dir="auto">The PDF format is a big and complicated one, so it&#39;s difficult to do all this perfectly. We do our best, but there&#39;s always more to do to make it better. <a href="https://free.law/donate/" rel="nofollow">Donations</a> and sponsored work help.</p>

<p dir="auto">Please see the issues list on Github for things we need, or start a conversation if you have questions. Before you do your first contribution, we&#39;ll need a signed contributor license agreement. See the template in the repo.</p>

<p dir="auto">Releases happen automatically via Github Actions. To trigger an automated build:</p>
<ol start="0" dir="auto">
<li>
<p dir="auto">Update CHANGES.md</p>
</li>
<li>
<p dir="auto">Update the version in pyproject.toml</p>
</li>
<li>
<p dir="auto">Tag the commit with something like &#34;v0.0.0&#34;.</p>
</li>
</ol>
<p dir="auto">If you wish to create a new version manually, the process is:</p>
<ol dir="auto">
<li>
<p dir="auto">Update version info in <code>pyproject.toml</code></p>
</li>
<li>
<p dir="auto">Configure your Pypi credentials <a href="https://python-poetry.org/docs/repositories/#configuring-credentials" rel="nofollow">with Poetry</a></p>
</li>
<li>
<p dir="auto">Build and publish the version:</p>
</li>
</ol>


<p dir="auto">This repository is available under the permissive BSD license, making it easy and safe to incorporate in your own libraries.</p>
<p dir="auto">Pull and feature requests welcome. Online editing in GitHub is possible (and easy!).</p>
</article></div></div>
  </body>
</html>
