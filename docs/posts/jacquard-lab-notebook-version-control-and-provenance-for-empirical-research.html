<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.inkandswitch.com/jacquard/notebook/">Original</a>
    <h1>Jacquard lab notebook: Version control and provenance for empirical research</h1>
    
    <div id="readability-page-1" class="page"><article>
  <h2><a href="https://www.inkandswitch.com/jacquard/notebook/01/">01 · Versioning and provenance for empirical research</a></h2>
  <p>2024 Aug 6</p>
  <p>How do researchers write papers that contain data analysis and charts?</p>



<figure>
  <img src="https://www.inkandswitch.com/jacquard/static/01/thermal-gs.png"/>
  <figcaption>
  A figure from <a href="https://ui.adsabs.harvard.edu/link_gateway/2023MNRAS.522.1394G/EPRINT_PDF">an empirical astronomy paper</a>
  </figcaption>
</figure>


<p>Consider a hypothetical astronomy paper. Measurements are collected from a telescope and written into a raw data file, which is reduced into a smaller CSV, which is loaded into a Python analysis notebook, which outputs further intermediate data files, as well as several visualizations as PNGs, which are then dragged into a web-based collaborative LaTeX editor where the team edits the paper and refines the charts.</p>
<p>This cobbling-together of tools and intermediate data files can cause serious problems for teams of researchers:</p>
<ul>
<li><strong>“How did we generate this chart?&#34;</strong>: Researchers waste time remembering what script and data were used to generate a given chart or data table. And when an analysis gets updated, it’s tricky to remember what other steps need to be manually rerun to correctly update downstream results.</li>
<li><strong>“Where’d that file go?&#34;</strong>: The text, the figures, and the code for the paper are spread across various web apps and devices. Any collaborator can edit the paper text on the web, but the moment they want to edit a chart, they have to email their collaborator who has the code on their laptop. Sometimes the team even loses track of a file entirely.</li>
<li><strong>“What’s changed recently?&#34;</strong> Authors risk missing important changes made by their collaborators. It’s generally challenging to suggest or review changes; many “track changes” views present too much detail and are difficult to parse.</li>
</ul>
<p>Through conversations with researchers in fields ranging from astrophysics to oceanography, we’ve learned that these kinds of problems cause daily friction, stealing focus from important work and even causing mistakes. Some researchers use software engineering tools like Git and Makefiles to help with these problems, but those tools are an awkward fit for exploratory research programming, and aren’t easily accessible to scientists who are less familiar with the command line.</p>
<p>On this project, we’re prototyping Jacquard: a collaborative environment for writing empirical research papers. The goal is to free up researchers to focus more on their core work of science and communication, and less on tedious bookkeeping. (The name “Jacquard” comes from the <a href="https://en.wikipedia.org/wiki/Jacquard_machine">automated loom</a> that was an important step in the history of computing.)</p>
<p>Jacquard builds on years of work at Ink &amp; Switch, including most recently <a href="https://www.inkandswitch.com/patchwork/notebook/">Patchwork</a>: a browser-based <a href="https://www.inkandswitch.com/local-first/">local-first</a> collaboration environment with powerful version control utilities like branching and history views.</p>



<figure>
  <img src="https://www.inkandswitch.com/jacquard/static/01/diff-sidebar-replace.webp"/>
  <figcaption>
  <a href="https://www.inkandswitch.com/patchwork/notebook">Patchwork</a> explored features like <a href="https://www.inkandswitch.com/patchwork/notebook/04/">diff views</a> for reviewing text edits
  </figcaption>
</figure>


<p>We’re starting out by extending Patchwork to support the kinds of data needed by empirical research papers, like LaTeX files and data visualization scripts. From there, we aim to add on powerful capabilities like tracking provenance of derived artifacts or making suggestions on a branch. Throughout this process, the prototype should remain a simple web-based collaboration interface that’s accessible to researchers who don’t have prior experience with version control or build systems.</p>
<p>A couple notes about our process:</p>
<p>First, while we’re aiming to invent new collaboration workflows, supporting real science work requires integrating with existing tools as well. So we’ll be taking a pragmatic approach that meets scientists where they are, building bridges to existing desktop workflows and programs.</p>
<p>Second, while this work is related to efforts in scientific reproducibility, that’s not our top priority. Reproducibility efforts often focus on packaging up results once they’re completed; we’re more interested in supporting and accelerating the messy process of getting to the results in the first place.</p>
<p>We’ll be posting updates as we go on this blog. If you’d like to follow along, feel free to <a href="https://buttondown.email/inkandswitch">sign up for the Ink &amp; Switch email newsletter</a> to receive periodic emails about our progress. And if you’re an empirical researcher (in any discipline) and would like to talk with us about your experiences with these problems, we’d love to chat—please reach out at <a href="mailto:geoffrey@inkandswitch.com">geoffrey@inkandswitch.com</a>.</p>

</article><article>
  <h2><a href="https://www.inkandswitch.com/jacquard/notebook/02/">02 · Tracking provenance</a></h2>
  <p>2024 Aug 14</p>
  <p>Scientific papers straddle two worlds. They’re thoughtfully crafted prose documents, but they’re also <em>computational</em> documents containing data analyses and visualizations. Today, the prose and computational parts of a paper often live in different environments and tools, which causes friction for teams of scientists.</p>
<p>For instance, one scientist told us that he keeps chart-generation code in a git repo, but collaborates with coauthors in the web-based Overleaf tool. Every time a chart changes, he needs to manually drag files from his computer into the browser. Meanwhile, his collaborators have little visibility into the code and data that generate charts.</p>
<p>Other scientists have told us about difficulties staying oriented as they move between a paper and the data pipelines that feed into it. A paper’s LaTeX source refers to a chart PNG file… but wait, which data file and Python script were used to generate that PNG?</p>
<p>We wondered: <strong>what if one collaboration environment could host both the text of the paper <em>and</em> the data visualization code</strong>, making it seamless to edit them together? Here’s a prototype:</p>


<figure>
  <video controls="" preload="metadata" width="100%" src="/jacquard/static/02/jacquard-provenance.mp4">
  <figcaption>
    Using a provenance graph to navigate a project and automatically propagate updates
  </figcaption>
</video></figure>


<p>The demo shows a web-based collaboration environment with <em>provenance</em> — information about how computed artifacts were generated from source material. By keeping track of provenance, we know when an output file needs to be rebuilt, and we know how to do it. <strong>We can also use provenance to create a map of the project:</strong></p>


<figure>
  <img src="https://www.inkandswitch.com/jacquard/static/02/build-graph.png"/>
  <figcaption>
  The build graph shows how files affect one another.
  </figcaption>
</figure>


<p>A core challenge we’re exploring in this prototype is how to integrate a collaborative web-based editor with the full power of running arbitrary computations on a Unix shell.</p>
<p>Behind the scenes of this demo, there is a watcher process which can be hosted on any computer, like a scientist’s own laptop or a cloud server. When the user requests a rebuild from the web interface, the watcher process detects the request, re-runs commands like the Python script or the LaTeX compiler, and syncs the results as well as provenance information back to the web view.</p>
<p>We think the ability to run the watcher process on any computer provides useful flexibility. At first, a scientist can easily try out computations without needing to initially make them portable or run them in a Docker container. At the same time, it’s straightforward to introduce a more reproducible environment at any time.</p>
<p>Currently the provenance tracking is fairly manual and relies on user annotations when running commands, though we have developed some automation helpers for specific cases like a LaTeX build. In the long run, we’d like to explore tracing filesystem access to automatically determine which files are used by a command.</p>

<h4 id="takeaways"><a href="#takeaways">Takeaways</a></h4><p>Two surprises so far from our experience with this prototype:</p>
<ol>
<li>
<p><strong>Implicit build spec:</strong> “Build systems” like this usually have a “makefile” – a specification file that defines how outputs should be generated from inputs. But we realized during our design phase that the provenance information we were tracking made a makefile unnecessary. Once you’ve run a command to generate an output file, the implicit trace of provenance records the information that would ordinarily be explicitly written in a makefile. We’ve gotten feedback from scientists that this approach serves their needs well.</p>
</li>
<li>
<p><strong>Provenance as map:</strong> We created the build graph as a quick way to see which files are out of date, but we’ve also found it surprisingly useful as a “map” for navigating a project’s contents. It’s easy to find the final PDF at the bottom of the graph. Pipelines of input into the paper are automatically organized above. Although the simple graph we’re showing now might become a tangle in larger projects, we plan to explore more ways to let authors map out their projects through provenance relationships.</p>
</li>
</ol>

<h4 id="prior-art"><a href="#prior-art">Prior art</a></h4><p>Our thinking on provenance tracking has been inspired by prior work, in particular two papers:</p>
<p><a href="https://hal.science/hal-02981632/document">FileWeaver: Flexible File Management with Automatic Dependency Tracking</a> by Julien Gori, Han Han, and Michel Beaudouin-Lafon, shows a dependency graph view of build tasks over a Unix filesystem:</p>


<figure>
  <img src="https://www.inkandswitch.com/jacquard/static/02/fileweaver.png"/>
  <figcaption>
  FileWeaver shows a dependency graph between files.
  </figcaption>
</figure>


<p><a href="https://pg.ucsd.edu/publications/Philip-Guo_PhD-dissertation_software-tools-for-research-programming.pdf">Burrito</a>, by Philip Guo and Margo Seltzer, tracks research programming activites on a Linux machine, including showing provenance relationships between inputs and outputs.</p>


<figure>
  <img src="https://www.inkandswitch.com/jacquard/static/02/burrito.png"/>
  <figcaption>
  Burrito shows relationships between input and output files.
  </figcaption>
</figure>


<p>Our prototype shares the general idea of this prior work: that tracking and visualizing provenance can help people manage projects with complex file structures. But we’re building in a collaborative local-first editor built on <a href="https://automerge.org/">Automerge</a> rather than a desktop Unix environment, which opens up new technical opportunities to reimagine features like versioning and provenance.</p>
<p><em>Thanks to <a href="https://www.cfa.harvard.edu/people/will-golay">Will Golay</a> for providing the code for the <a href="https://academic.oup.com/mnras/article/522/1/1394/7110428">sample paper</a> in the demo.</em></p>

</article></div>
  </body>
</html>
