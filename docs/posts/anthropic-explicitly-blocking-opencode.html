<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://gist.github.com/R44VC0RP/bd391f6a23185c0fed6c6b5fb2bac50e">Original</a>
    <h1>Anthropic Explicitly Blocking OpenCode</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="anthropic-screws-opencode.ts">
        <tbody><tr>
          <td id="file-anthropic-screws-opencode-ts-L1" data-line-number="1"></td>
          <td id="file-anthropic-screws-opencode-ts-LC1">#!/usr/bin/env bun</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L2" data-line-number="2"></td>
          <td id="file-anthropic-screws-opencode-ts-LC2"><span>/**</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L3" data-line-number="3"></td>
          <td id="file-anthropic-screws-opencode-ts-LC3"><span> * ============================================================</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L4" data-line-number="4"></td>
          <td id="file-anthropic-screws-opencode-ts-LC4"><span> * PROOF: Anthropic is specifically blocking &#34;OpenCode&#34; </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L5" data-line-number="5"></td>
          <td id="file-anthropic-screws-opencode-ts-LC5"><span> * in Claude Code OAuth system prompts</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L6" data-line-number="6"></td>
          <td id="file-anthropic-screws-opencode-ts-LC6"><span> * ============================================================</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L7" data-line-number="7"></td>
          <td id="file-anthropic-screws-opencode-ts-LC7"><span> *</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L8" data-line-number="8"></td>
          <td id="file-anthropic-screws-opencode-ts-LC8"><span> * Video covering this script here: https://www.youtube.com/watch?v=G9YX6StP2-M</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L9" data-line-number="9"></td>
          <td id="file-anthropic-screws-opencode-ts-LC9"><span> * </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L10" data-line-number="10"></td>
          <td id="file-anthropic-screws-opencode-ts-LC10"><span> * This script demonstrates that Anthropic has specifically blocked</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L11" data-line-number="11"></td>
          <td id="file-anthropic-screws-opencode-ts-LC11"><span> * the phrase &#34;You are OpenCode&#34; in system prompts when using Claude&#39;s</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L12" data-line-number="12"></td>
          <td id="file-anthropic-screws-opencode-ts-LC12"><span> * OAuth tokens (Pro/Max subscription), while allowing other identity</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L13" data-line-number="13"></td>
          <td id="file-anthropic-screws-opencode-ts-LC13"><span> * statements like &#34;You are Cursor&#34;, &#34;You are Pi&#34;, etc.</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L14" data-line-number="14"></td>
          <td id="file-anthropic-screws-opencode-ts-LC14"><span> * </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L15" data-line-number="15"></td>
          <td id="file-anthropic-screws-opencode-ts-LC15"><span> * OpenCode (https://opencode.ai) is an open-source AI coding assistant.</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L16" data-line-number="16"></td>
          <td id="file-anthropic-screws-opencode-ts-LC16"><span> * </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L17" data-line-number="17"></td>
          <td id="file-anthropic-screws-opencode-ts-LC17"><span> * SETUP:</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L18" data-line-number="18"></td>
          <td id="file-anthropic-screws-opencode-ts-LC18"><span> *   mkdir test-anthropic &amp;&amp; cd test-anthropic</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L19" data-line-number="19"></td>
          <td id="file-anthropic-screws-opencode-ts-LC19"><span> *   bun init -y</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L20" data-line-number="20"></td>
          <td id="file-anthropic-screws-opencode-ts-LC20"><span> *   bun add @openauthjs/openauth</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L21" data-line-number="21"></td>
          <td id="file-anthropic-screws-opencode-ts-LC21"><span> *   # Copy this file as opencode.ts</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L22" data-line-number="22"></td>
          <td id="file-anthropic-screws-opencode-ts-LC22"><span> *   bun opencode.ts</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L23" data-line-number="23"></td>
          <td id="file-anthropic-screws-opencode-ts-LC23"><span> * </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L24" data-line-number="24"></td>
          <td id="file-anthropic-screws-opencode-ts-LC24"><span> * REQUIREMENTS:</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L25" data-line-number="25"></td>
          <td id="file-anthropic-screws-opencode-ts-LC25"><span> *   - Bun runtime (https://bun.sh)</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L26" data-line-number="26"></td>
          <td id="file-anthropic-screws-opencode-ts-LC26"><span> *   - Claude Pro or Max subscription</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L27" data-line-number="27"></td>
          <td id="file-anthropic-screws-opencode-ts-LC27"><span> * </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L28" data-line-number="28"></td>
          <td id="file-anthropic-screws-opencode-ts-LC28"><span> * HOW IT WORKS:</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L29" data-line-number="29"></td>
          <td id="file-anthropic-screws-opencode-ts-LC29"><span> *   1. Authenticates via OAuth using your Claude Pro/Max account</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L30" data-line-number="30"></td>
          <td id="file-anthropic-screws-opencode-ts-LC30"><span> *   2. Tests various system prompts against the Claude API</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L31" data-line-number="31"></td>
          <td id="file-anthropic-screws-opencode-ts-LC31"><span> *   3. Shows which prompts are blocked vs allowed</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L32" data-line-number="32"></td>
          <td id="file-anthropic-screws-opencode-ts-LC32"><span> * </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L33" data-line-number="33"></td>
          <td id="file-anthropic-screws-opencode-ts-LC33"><span> * FINDINGS:</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L34" data-line-number="34"></td>
          <td id="file-anthropic-screws-opencode-ts-LC34"><span> *   - First system block MUST be exactly: </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L35" data-line-number="35"></td>
          <td id="file-anthropic-screws-opencode-ts-LC35"><span> *     &#34;You are Claude Code, Anthropic&#39;s official CLI for Claude.&#34;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L36" data-line-number="36"></td>
          <td id="file-anthropic-screws-opencode-ts-LC36"><span> *   - Second block can contain almost anything EXCEPT:</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L37" data-line-number="37"></td>
          <td id="file-anthropic-screws-opencode-ts-LC37"><span> *     &#34;You are OpenCode&#34; or &#34;You are opencode&#34;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L38" data-line-number="38"></td>
          <td id="file-anthropic-screws-opencode-ts-LC38"><span> *   - Other identity statements work fine (Cursor, Pi, Droid, etc.)</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L39" data-line-number="39"></td>
          <td id="file-anthropic-screws-opencode-ts-LC39"><span> * </span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L40" data-line-number="40"></td>
          <td id="file-anthropic-screws-opencode-ts-LC40"><span> * This appears to be targeted blocking of a specific competitor.</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L41" data-line-number="41"></td>
          <td id="file-anthropic-screws-opencode-ts-LC41"><span> */</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L42" data-line-number="42"></td>
          <td id="file-anthropic-screws-opencode-ts-LC42">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L43" data-line-number="43"></td>
          <td id="file-anthropic-screws-opencode-ts-LC43"><span>import</span> <span>*</span> <span>as</span> <span>readline</span> <span>from</span> <span>&#34;node:readline&#34;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L44" data-line-number="44"></td>
          <td id="file-anthropic-screws-opencode-ts-LC44"><span>import</span> <span>{</span> <span>generatePKCE</span> <span>}</span> <span>from</span> <span>&#34;@openauthjs/openauth/pkce&#34;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L45" data-line-number="45"></td>
          <td id="file-anthropic-screws-opencode-ts-LC45">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L46" data-line-number="46"></td>
          <td id="file-anthropic-screws-opencode-ts-LC46"><span>const</span> <span>CLIENT_ID</span> <span>=</span> <span>&#34;9d1c250a-e61b-44d9-88ed-5944d1962f5e&#34;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L47" data-line-number="47"></td>
          <td id="file-anthropic-screws-opencode-ts-LC47"><span>const</span> <span>CC_HEADER</span> <span>=</span> <span>&#34;You are Claude Code, Anthropic&#39;s official CLI for Claude.&#34;</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L48" data-line-number="48"></td>
          <td id="file-anthropic-screws-opencode-ts-LC48">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L49" data-line-number="49"></td>
          <td id="file-anthropic-screws-opencode-ts-LC49"><span>const</span> <span>rl</span> <span>=</span> <span>readline</span><span>.</span><span>createInterface</span><span>(</span><span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L50" data-line-number="50"></td>
          <td id="file-anthropic-screws-opencode-ts-LC50">  <span>input</span>: <span>process</span><span>.</span><span>stdin</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L51" data-line-number="51"></td>
          <td id="file-anthropic-screws-opencode-ts-LC51">  <span>output</span>: <span>process</span><span>.</span><span>stdout</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L52" data-line-number="52"></td>
          <td id="file-anthropic-screws-opencode-ts-LC52"><span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L53" data-line-number="53"></td>
          <td id="file-anthropic-screws-opencode-ts-LC53">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L54" data-line-number="54"></td>
          <td id="file-anthropic-screws-opencode-ts-LC54"><span>function</span> <span>prompt</span><span>(</span><span>question</span>: <span>string</span><span>)</span>: <span>Promise</span><span>&lt;</span><span>string</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L55" data-line-number="55"></td>
          <td id="file-anthropic-screws-opencode-ts-LC55">  <span>return</span> <span>new</span> <span>Promise</span><span>(</span><span>(</span><span>resolve</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L56" data-line-number="56"></td>
          <td id="file-anthropic-screws-opencode-ts-LC56">    <span>rl</span><span>.</span><span>question</span><span>(</span><span>question</span><span>,</span> <span>(</span><span>answer</span><span>)</span> <span>=&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L57" data-line-number="57"></td>
          <td id="file-anthropic-screws-opencode-ts-LC57">      <span>resolve</span><span>(</span><span>answer</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L58" data-line-number="58"></td>
          <td id="file-anthropic-screws-opencode-ts-LC58">    <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L59" data-line-number="59"></td>
          <td id="file-anthropic-screws-opencode-ts-LC59">  <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L60" data-line-number="60"></td>
          <td id="file-anthropic-screws-opencode-ts-LC60"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L61" data-line-number="61"></td>
          <td id="file-anthropic-screws-opencode-ts-LC61">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L62" data-line-number="62"></td>
          <td id="file-anthropic-screws-opencode-ts-LC62"><span>// ============ OAuth Functions ============</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L63" data-line-number="63"></td>
          <td id="file-anthropic-screws-opencode-ts-LC63">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L64" data-line-number="64"></td>
          <td id="file-anthropic-screws-opencode-ts-LC64"><span>async</span> <span>function</span> <span>authorize</span><span>(</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L65" data-line-number="65"></td>
          <td id="file-anthropic-screws-opencode-ts-LC65">  <span>const</span> <span>pkce</span> <span>=</span> <span>await</span> <span>generatePKCE</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L66" data-line-number="66"></td>
          <td id="file-anthropic-screws-opencode-ts-LC66">  <span>const</span> <span>url</span> <span>=</span> <span>new</span> <span>URL</span><span>(</span><span>&#34;https://claude.ai/oauth/authorize&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L67" data-line-number="67"></td>
          <td id="file-anthropic-screws-opencode-ts-LC67">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;code&#34;</span><span>,</span> <span>&#34;true&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L68" data-line-number="68"></td>
          <td id="file-anthropic-screws-opencode-ts-LC68">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;client_id&#34;</span><span>,</span> <span>CLIENT_ID</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L69" data-line-number="69"></td>
          <td id="file-anthropic-screws-opencode-ts-LC69">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;response_type&#34;</span><span>,</span> <span>&#34;code&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L70" data-line-number="70"></td>
          <td id="file-anthropic-screws-opencode-ts-LC70">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;redirect_uri&#34;</span><span>,</span> <span>&#34;https://console.anthropic.com/oauth/code/callback&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L71" data-line-number="71"></td>
          <td id="file-anthropic-screws-opencode-ts-LC71">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;scope&#34;</span><span>,</span> <span>&#34;org:create_api_key user:profile user:inference&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L72" data-line-number="72"></td>
          <td id="file-anthropic-screws-opencode-ts-LC72">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;code_challenge&#34;</span><span>,</span> <span>pkce</span><span>.</span><span>challenge</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L73" data-line-number="73"></td>
          <td id="file-anthropic-screws-opencode-ts-LC73">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;code_challenge_method&#34;</span><span>,</span> <span>&#34;S256&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L74" data-line-number="74"></td>
          <td id="file-anthropic-screws-opencode-ts-LC74">  <span>url</span><span>.</span><span>searchParams</span><span>.</span><span>set</span><span>(</span><span>&#34;state&#34;</span><span>,</span> <span>pkce</span><span>.</span><span>verifier</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L75" data-line-number="75"></td>
          <td id="file-anthropic-screws-opencode-ts-LC75">  <span>return</span> <span>{</span> <span>url</span>: <span>url</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>,</span> <span>verifier</span>: <span>pkce</span><span>.</span><span>verifier</span> <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L76" data-line-number="76"></td>
          <td id="file-anthropic-screws-opencode-ts-LC76"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L77" data-line-number="77"></td>
          <td id="file-anthropic-screws-opencode-ts-LC77">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L78" data-line-number="78"></td>
          <td id="file-anthropic-screws-opencode-ts-LC78"><span>async</span> <span>function</span> <span>exchange</span><span>(</span><span>code</span>: <span>string</span><span>,</span> <span>verifier</span>: <span>string</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L79" data-line-number="79"></td>
          <td id="file-anthropic-screws-opencode-ts-LC79">  <span>const</span> <span>splits</span> <span>=</span> <span>code</span><span>.</span><span>split</span><span>(</span><span>&#34;#&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L80" data-line-number="80"></td>
          <td id="file-anthropic-screws-opencode-ts-LC80">  <span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;https://console.anthropic.com/v1/oauth/token&#34;</span><span>,</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L81" data-line-number="81"></td>
          <td id="file-anthropic-screws-opencode-ts-LC81">    <span>method</span>: <span>&#34;POST&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L82" data-line-number="82"></td>
          <td id="file-anthropic-screws-opencode-ts-LC82">    <span>headers</span>: <span>{</span> <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L83" data-line-number="83"></td>
          <td id="file-anthropic-screws-opencode-ts-LC83">    <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L84" data-line-number="84"></td>
          <td id="file-anthropic-screws-opencode-ts-LC84">      <span>code</span>: <span>splits</span><span>[</span><span>0</span><span>]</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L85" data-line-number="85"></td>
          <td id="file-anthropic-screws-opencode-ts-LC85">      <span>state</span>: <span>splits</span><span>[</span><span>1</span><span>]</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L86" data-line-number="86"></td>
          <td id="file-anthropic-screws-opencode-ts-LC86">      <span>grant_type</span>: <span>&#34;authorization_code&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L87" data-line-number="87"></td>
          <td id="file-anthropic-screws-opencode-ts-LC87">      <span>client_id</span>: <span>CLIENT_ID</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L88" data-line-number="88"></td>
          <td id="file-anthropic-screws-opencode-ts-LC88">      <span>redirect_uri</span>: <span>&#34;https://console.anthropic.com/oauth/code/callback&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L89" data-line-number="89"></td>
          <td id="file-anthropic-screws-opencode-ts-LC89">      <span>code_verifier</span>: <span>verifier</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L90" data-line-number="90"></td>
          <td id="file-anthropic-screws-opencode-ts-LC90">    <span>}</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L91" data-line-number="91"></td>
          <td id="file-anthropic-screws-opencode-ts-LC91">  <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L92" data-line-number="92"></td>
          <td id="file-anthropic-screws-opencode-ts-LC92">  <span>if</span> <span>(</span><span>!</span><span>result</span><span>.</span><span>ok</span><span>)</span> <span>return</span> <span>null</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L93" data-line-number="93"></td>
          <td id="file-anthropic-screws-opencode-ts-LC93">  <span>const</span> <span>json</span> <span>=</span> <span>await</span> <span>result</span><span>.</span><span>json</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L94" data-line-number="94"></td>
          <td id="file-anthropic-screws-opencode-ts-LC94">  <span>return</span> <span>json</span><span>.</span><span>access_token</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L95" data-line-number="95"></td>
          <td id="file-anthropic-screws-opencode-ts-LC95"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L96" data-line-number="96"></td>
          <td id="file-anthropic-screws-opencode-ts-LC96">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L97" data-line-number="97"></td>
          <td id="file-anthropic-screws-opencode-ts-LC97"><span>// ============ Test Functions ============</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L98" data-line-number="98"></td>
          <td id="file-anthropic-screws-opencode-ts-LC98">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L99" data-line-number="99"></td>
          <td id="file-anthropic-screws-opencode-ts-LC99"><span>interface</span> <span>TestResult</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L100" data-line-number="100"></td>
          <td id="file-anthropic-screws-opencode-ts-LC100">  <span>name</span>: <span>string</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L101" data-line-number="101"></td>
          <td id="file-anthropic-screws-opencode-ts-LC101">  <span>secondBlock</span>: <span>string</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L102" data-line-number="102"></td>
          <td id="file-anthropic-screws-opencode-ts-LC102">  <span>success</span>: <span>boolean</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L103" data-line-number="103"></td>
          <td id="file-anthropic-screws-opencode-ts-LC103"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L104" data-line-number="104"></td>
          <td id="file-anthropic-screws-opencode-ts-LC104">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L105" data-line-number="105"></td>
          <td id="file-anthropic-screws-opencode-ts-LC105"><span>async</span> <span>function</span> <span>runTest</span><span>(</span><span>accessToken</span>: <span>string</span><span>,</span> <span>name</span>: <span>string</span><span>,</span> <span>secondBlock</span>: <span>string</span><span>)</span>: <span>Promise</span><span>&lt;</span><span>TestResult</span><span>&gt;</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L106" data-line-number="106"></td>
          <td id="file-anthropic-screws-opencode-ts-LC106">  <span>process</span><span>.</span><span>stdout</span><span>.</span><span>write</span><span>(</span><span>`  <span><span>${</span><span>name</span><span>}</span></span>... `</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L107" data-line-number="107"></td>
          <td id="file-anthropic-screws-opencode-ts-LC107">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L108" data-line-number="108"></td>
          <td id="file-anthropic-screws-opencode-ts-LC108">  <span>const</span> <span>response</span> <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;https://api.anthropic.com/v1/messages?beta=true&#34;</span><span>,</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L109" data-line-number="109"></td>
          <td id="file-anthropic-screws-opencode-ts-LC109">    <span>method</span>: <span>&#34;POST&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L110" data-line-number="110"></td>
          <td id="file-anthropic-screws-opencode-ts-LC110">    <span>headers</span>: <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L111" data-line-number="111"></td>
          <td id="file-anthropic-screws-opencode-ts-LC111">      <span>&#34;Content-Type&#34;</span>: <span>&#34;application/json&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L112" data-line-number="112"></td>
          <td id="file-anthropic-screws-opencode-ts-LC112">      <span>&#34;Authorization&#34;</span>: <span>`Bearer <span><span>${</span><span>accessToken</span><span>}</span></span>`</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L113" data-line-number="113"></td>
          <td id="file-anthropic-screws-opencode-ts-LC113">      <span>&#34;anthropic-version&#34;</span>: <span>&#34;2023-06-01&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L114" data-line-number="114"></td>
          <td id="file-anthropic-screws-opencode-ts-LC114">      <span>&#34;anthropic-beta&#34;</span>: <span>&#34;oauth-2025-04-20,interleaved-thinking-2025-05-14,claude-code-20250219&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L115" data-line-number="115"></td>
          <td id="file-anthropic-screws-opencode-ts-LC115">      <span>&#34;user-agent&#34;</span>: <span>&#34;claude-cli/2.1.2 (external, cli)&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L116" data-line-number="116"></td>
          <td id="file-anthropic-screws-opencode-ts-LC116">    <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L117" data-line-number="117"></td>
          <td id="file-anthropic-screws-opencode-ts-LC117">    <span>body</span>: <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L118" data-line-number="118"></td>
          <td id="file-anthropic-screws-opencode-ts-LC118">      <span>model</span>: <span>&#34;claude-sonnet-4-20250514&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L119" data-line-number="119"></td>
          <td id="file-anthropic-screws-opencode-ts-LC119">      <span>max_tokens</span>: <span>1024</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L120" data-line-number="120"></td>
          <td id="file-anthropic-screws-opencode-ts-LC120">      <span>system</span>: <span>[</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L121" data-line-number="121"></td>
          <td id="file-anthropic-screws-opencode-ts-LC121">        <span>{</span> <span>type</span>: <span>&#34;text&#34;</span><span>,</span> <span>text</span>: <span>CC_HEADER</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L122" data-line-number="122"></td>
          <td id="file-anthropic-screws-opencode-ts-LC122">        <span>{</span> <span>type</span>: <span>&#34;text&#34;</span><span>,</span> <span>text</span>: <span>secondBlock</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L123" data-line-number="123"></td>
          <td id="file-anthropic-screws-opencode-ts-LC123">      <span>]</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L124" data-line-number="124"></td>
          <td id="file-anthropic-screws-opencode-ts-LC124">      <span>tools</span>: <span>[</span><span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L125" data-line-number="125"></td>
          <td id="file-anthropic-screws-opencode-ts-LC125">        <span>name</span>: <span>&#34;mcp_test&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L126" data-line-number="126"></td>
          <td id="file-anthropic-screws-opencode-ts-LC126">        <span>description</span>: <span>&#34;Test tool&#34;</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L127" data-line-number="127"></td>
          <td id="file-anthropic-screws-opencode-ts-LC127">        <span>input_schema</span>: <span>{</span> <span>type</span>: <span>&#34;object&#34;</span><span>,</span> <span>properties</span>: <span>{</span><span>}</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L128" data-line-number="128"></td>
          <td id="file-anthropic-screws-opencode-ts-LC128">      <span>}</span><span>]</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L129" data-line-number="129"></td>
          <td id="file-anthropic-screws-opencode-ts-LC129">      <span>messages</span>: <span>[</span><span>{</span> <span>role</span>: <span>&#34;user&#34;</span><span>,</span> <span>content</span>: <span>&#34;Say hello in 5 words.&#34;</span> <span>}</span><span>]</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L130" data-line-number="130"></td>
          <td id="file-anthropic-screws-opencode-ts-LC130">    <span>}</span><span>)</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L131" data-line-number="131"></td>
          <td id="file-anthropic-screws-opencode-ts-LC131">  <span>}</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L132" data-line-number="132"></td>
          <td id="file-anthropic-screws-opencode-ts-LC132">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L133" data-line-number="133"></td>
          <td id="file-anthropic-screws-opencode-ts-LC133">  <span>if</span> <span>(</span><span>!</span><span>response</span><span>.</span><span>ok</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L134" data-line-number="134"></td>
          <td id="file-anthropic-screws-opencode-ts-LC134">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;FAIL&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L135" data-line-number="135"></td>
          <td id="file-anthropic-screws-opencode-ts-LC135">    <span>return</span> <span>{</span> name<span>,</span> secondBlock<span>,</span> <span>success</span>: <span>false</span> <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L136" data-line-number="136"></td>
          <td id="file-anthropic-screws-opencode-ts-LC136">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L137" data-line-number="137"></td>
          <td id="file-anthropic-screws-opencode-ts-LC137">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L138" data-line-number="138"></td>
          <td id="file-anthropic-screws-opencode-ts-LC138">  <span>await</span> <span>response</span><span>.</span><span>json</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L139" data-line-number="139"></td>
          <td id="file-anthropic-screws-opencode-ts-LC139">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;PASS&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L140" data-line-number="140"></td>
          <td id="file-anthropic-screws-opencode-ts-LC140">  <span>return</span> <span>{</span> name<span>,</span> secondBlock<span>,</span> <span>success</span>: <span>true</span> <span>}</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L141" data-line-number="141"></td>
          <td id="file-anthropic-screws-opencode-ts-LC141"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L142" data-line-number="142"></td>
          <td id="file-anthropic-screws-opencode-ts-LC142">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L143" data-line-number="143"></td>
          <td id="file-anthropic-screws-opencode-ts-LC143"><span>async</span> <span>function</span> <span>runTests</span><span>(</span><span>accessToken</span>: <span>string</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L144" data-line-number="144"></td>
          <td id="file-anthropic-screws-opencode-ts-LC144">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\n&#34;</span> <span>+</span> <span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L145" data-line-number="145"></td>
          <td id="file-anthropic-screws-opencode-ts-LC145">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;SYSTEM PROMPT VALIDATION TESTS&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L146" data-line-number="146"></td>
          <td id="file-anthropic-screws-opencode-ts-LC146">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L147" data-line-number="147"></td>
          <td id="file-anthropic-screws-opencode-ts-LC147">  <span>console</span><span>.</span><span>log</span><span>(</span><span>`\nFirst block (required): &#34;<span><span>${</span><span>CC_HEADER</span><span>}</span></span>&#34;`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L148" data-line-number="148"></td>
          <td id="file-anthropic-screws-opencode-ts-LC148">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\nTesting second block content:\n&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L149" data-line-number="149"></td>
          <td id="file-anthropic-screws-opencode-ts-LC149">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L150" data-line-number="150"></td>
          <td id="file-anthropic-screws-opencode-ts-LC150">  <span>const</span> <span>tests</span> <span>=</span> <span>[</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L151" data-line-number="151"></td>
          <td id="file-anthropic-screws-opencode-ts-LC151">    <span>// These FAIL - &#34;You are OpenCode&#34; pattern is blocked</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L152" data-line-number="152"></td>
          <td id="file-anthropic-screws-opencode-ts-LC152">    <span>{</span> <span>name</span>: <span>&#34;You are OpenCode.&#34;</span><span>,</span> <span>block</span>: <span>&#34;You are OpenCode.&#34;</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L153" data-line-number="153"></td>
          <td id="file-anthropic-screws-opencode-ts-LC153">    <span>{</span> <span>name</span>: <span>&#34;You are opencode.&#34;</span><span>,</span> <span>block</span>: <span>&#34;You are opencode.&#34;</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L154" data-line-number="154"></td>
          <td id="file-anthropic-screws-opencode-ts-LC154">    </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L155" data-line-number="155"></td>
          <td id="file-anthropic-screws-opencode-ts-LC155">    <span>// These PASS - other identity statements work fine</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L156" data-line-number="156"></td>
          <td id="file-anthropic-screws-opencode-ts-LC156">    <span>{</span> <span>name</span>: <span>&#34;You are Cursor.&#34;</span><span>,</span> <span>block</span>: <span>&#34;You are Cursor.&#34;</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L157" data-line-number="157"></td>
          <td id="file-anthropic-screws-opencode-ts-LC157">    <span>{</span> <span>name</span>: <span>&#34;You are Pi.&#34;</span><span>,</span> <span>block</span>: <span>&#34;You are Pi.&#34;</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L158" data-line-number="158"></td>
          <td id="file-anthropic-screws-opencode-ts-LC158">    <span>{</span> <span>name</span>: <span>&#34;You are Droid.&#34;</span><span>,</span> <span>block</span>: <span>&#34;You are Droid.&#34;</span> <span>}</span><span>,</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L159" data-line-number="159"></td>
          <td id="file-anthropic-screws-opencode-ts-LC159">  <span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L160" data-line-number="160"></td>
          <td id="file-anthropic-screws-opencode-ts-LC160">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L161" data-line-number="161"></td>
          <td id="file-anthropic-screws-opencode-ts-LC161">  <span>const</span> <span>results</span>: <span>TestResult</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L162" data-line-number="162"></td>
          <td id="file-anthropic-screws-opencode-ts-LC162">  <span>for</span> <span>(</span><span>const</span> <span>test</span> <span>of</span> <span>tests</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L163" data-line-number="163"></td>
          <td id="file-anthropic-screws-opencode-ts-LC163">    <span>const</span> <span>result</span> <span>=</span> <span>await</span> <span>runTest</span><span>(</span><span>accessToken</span><span>,</span> <span>test</span><span>.</span><span>name</span><span>,</span> <span>test</span><span>.</span><span>block</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L164" data-line-number="164"></td>
          <td id="file-anthropic-screws-opencode-ts-LC164">    <span>results</span><span>.</span><span>push</span><span>(</span><span>result</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L165" data-line-number="165"></td>
          <td id="file-anthropic-screws-opencode-ts-LC165">    <span>await</span> <span>new</span> <span>Promise</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>setTimeout</span><span>(</span><span>r</span><span>,</span> <span>300</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L166" data-line-number="166"></td>
          <td id="file-anthropic-screws-opencode-ts-LC166">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L167" data-line-number="167"></td>
          <td id="file-anthropic-screws-opencode-ts-LC167">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L168" data-line-number="168"></td>
          <td id="file-anthropic-screws-opencode-ts-LC168">  <span>// Summary</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L169" data-line-number="169"></td>
          <td id="file-anthropic-screws-opencode-ts-LC169">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\n&#34;</span> <span>+</span> <span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L170" data-line-number="170"></td>
          <td id="file-anthropic-screws-opencode-ts-LC170">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;RESULTS&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L171" data-line-number="171"></td>
          <td id="file-anthropic-screws-opencode-ts-LC171">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L172" data-line-number="172"></td>
          <td id="file-anthropic-screws-opencode-ts-LC172">  </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L173" data-line-number="173"></td>
          <td id="file-anthropic-screws-opencode-ts-LC173">  <span>const</span> <span>passed</span> <span>=</span> <span>results</span><span>.</span><span>filter</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>r</span><span>.</span><span>success</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L174" data-line-number="174"></td>
          <td id="file-anthropic-screws-opencode-ts-LC174">  <span>const</span> <span>failed</span> <span>=</span> <span>results</span><span>.</span><span>filter</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>!</span><span>r</span><span>.</span><span>success</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L175" data-line-number="175"></td>
          <td id="file-anthropic-screws-opencode-ts-LC175">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L176" data-line-number="176"></td>
          <td id="file-anthropic-screws-opencode-ts-LC176">  <span>console</span><span>.</span><span>log</span><span>(</span><span>`\nPassed: <span><span>${</span><span>passed</span><span>.</span><span>length</span><span>}</span></span> | Failed: <span><span>${</span><span>failed</span><span>.</span><span>length</span><span>}</span></span>`</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L177" data-line-number="177"></td>
          <td id="file-anthropic-screws-opencode-ts-LC177">  </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L178" data-line-number="178"></td>
          <td id="file-anthropic-screws-opencode-ts-LC178">  <span>if</span> <span>(</span><span>failed</span><span>.</span><span>length</span> <span>&gt;</span> <span>0</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L179" data-line-number="179"></td>
          <td id="file-anthropic-screws-opencode-ts-LC179">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\nBLOCKED (cannot use in 2nd system block):&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L180" data-line-number="180"></td>
          <td id="file-anthropic-screws-opencode-ts-LC180">    <span>failed</span><span>.</span><span>forEach</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>`  - &#34;<span><span>${</span><span>r</span><span>.</span><span>secondBlock</span><span>}</span></span>&#34;`</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L181" data-line-number="181"></td>
          <td id="file-anthropic-screws-opencode-ts-LC181">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L182" data-line-number="182"></td>
          <td id="file-anthropic-screws-opencode-ts-LC182">  </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L183" data-line-number="183"></td>
          <td id="file-anthropic-screws-opencode-ts-LC183">  <span>if</span> <span>(</span><span>passed</span><span>.</span><span>length</span> <span>&gt;</span> <span>0</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L184" data-line-number="184"></td>
          <td id="file-anthropic-screws-opencode-ts-LC184">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\nALLOWED:&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L185" data-line-number="185"></td>
          <td id="file-anthropic-screws-opencode-ts-LC185">    <span>passed</span><span>.</span><span>forEach</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span><span>`  - &#34;<span><span>${</span><span>r</span><span>.</span><span>secondBlock</span><span>}</span></span>&#34;`</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L186" data-line-number="186"></td>
          <td id="file-anthropic-screws-opencode-ts-LC186">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L187" data-line-number="187"></td>
          <td id="file-anthropic-screws-opencode-ts-LC187">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L188" data-line-number="188"></td>
          <td id="file-anthropic-screws-opencode-ts-LC188">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\n&#34;</span> <span>+</span> <span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L189" data-line-number="189"></td>
          <td id="file-anthropic-screws-opencode-ts-LC189">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;CONCLUSION: Anthropic specifically blocks &#39;You are OpenCode&#39;&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L190" data-line-number="190"></td>
          <td id="file-anthropic-screws-opencode-ts-LC190">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;            but allows other identity statements.&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L191" data-line-number="191"></td>
          <td id="file-anthropic-screws-opencode-ts-LC191">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span> <span>+</span> <span>&#34;\n&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L192" data-line-number="192"></td>
          <td id="file-anthropic-screws-opencode-ts-LC192"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L193" data-line-number="193"></td>
          <td id="file-anthropic-screws-opencode-ts-LC193">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L194" data-line-number="194"></td>
          <td id="file-anthropic-screws-opencode-ts-LC194"><span>// ============ Main ============</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L195" data-line-number="195"></td>
          <td id="file-anthropic-screws-opencode-ts-LC195">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L196" data-line-number="196"></td>
          <td id="file-anthropic-screws-opencode-ts-LC196"><span>async</span> <span>function</span> <span>main</span><span>(</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L197" data-line-number="197"></td>
          <td id="file-anthropic-screws-opencode-ts-LC197">  <span>const</span> <span>args</span> <span>=</span> <span>process</span><span>.</span><span>argv</span><span>.</span><span>slice</span><span>(</span><span>2</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L198" data-line-number="198"></td>
          <td id="file-anthropic-screws-opencode-ts-LC198">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L199" data-line-number="199"></td>
          <td id="file-anthropic-screws-opencode-ts-LC199">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\n&#34;</span> <span>+</span> <span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L200" data-line-number="200"></td>
          <td id="file-anthropic-screws-opencode-ts-LC200">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;  ANTHROPIC OAUTH SYSTEM PROMPT TESTER&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L201" data-line-number="201"></td>
          <td id="file-anthropic-screws-opencode-ts-LC201">  <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;=&#34;</span><span>.</span><span>repeat</span><span>(</span><span>50</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L202" data-line-number="202"></td>
          <td id="file-anthropic-screws-opencode-ts-LC202">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L203" data-line-number="203"></td>
          <td id="file-anthropic-screws-opencode-ts-LC203">  <span>let</span> <span>accessToken</span> <span>=</span> <span>args</span><span>[</span><span>0</span><span>]</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L204" data-line-number="204"></td>
          <td id="file-anthropic-screws-opencode-ts-LC204">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L205" data-line-number="205"></td>
          <td id="file-anthropic-screws-opencode-ts-LC205">  <span>if</span> <span>(</span><span>!</span><span>accessToken</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L206" data-line-number="206"></td>
          <td id="file-anthropic-screws-opencode-ts-LC206">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\nNo token provided. Starting OAuth flow...\n&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L207" data-line-number="207"></td>
          <td id="file-anthropic-screws-opencode-ts-LC207">    </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L208" data-line-number="208"></td>
          <td id="file-anthropic-screws-opencode-ts-LC208">    <span>const</span> <span>{</span> url<span>,</span> verifier <span>}</span> <span>=</span> <span>await</span> <span>authorize</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L209" data-line-number="209"></td>
          <td id="file-anthropic-screws-opencode-ts-LC209">    </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L210" data-line-number="210"></td>
          <td id="file-anthropic-screws-opencode-ts-LC210">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;1. Open this URL in your browser:\n&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L211" data-line-number="211"></td>
          <td id="file-anthropic-screws-opencode-ts-LC211">    <span>console</span><span>.</span><span>log</span><span>(</span><span>url</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L212" data-line-number="212"></td>
          <td id="file-anthropic-screws-opencode-ts-LC212">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\n2. Authorize and copy the code shown.\n&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L213" data-line-number="213"></td>
          <td id="file-anthropic-screws-opencode-ts-LC213">    </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L214" data-line-number="214"></td>
          <td id="file-anthropic-screws-opencode-ts-LC214">    <span>const</span> <span>code</span> <span>=</span> <span>await</span> <span>prompt</span><span>(</span><span>&#34;3. Paste the code here: &#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L215" data-line-number="215"></td>
          <td id="file-anthropic-screws-opencode-ts-LC215">    </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L216" data-line-number="216"></td>
          <td id="file-anthropic-screws-opencode-ts-LC216">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;\nExchanging code for token...&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L217" data-line-number="217"></td>
          <td id="file-anthropic-screws-opencode-ts-LC217">    <span>accessToken</span> <span>=</span> <span>await</span> <span>exchange</span><span>(</span><span>code</span><span>.</span><span>trim</span><span>(</span><span>)</span><span>,</span> <span>verifier</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L218" data-line-number="218"></td>
          <td id="file-anthropic-screws-opencode-ts-LC218">    </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L219" data-line-number="219"></td>
          <td id="file-anthropic-screws-opencode-ts-LC219">    <span>if</span> <span>(</span><span>!</span><span>accessToken</span><span>)</span> <span>{</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L220" data-line-number="220"></td>
          <td id="file-anthropic-screws-opencode-ts-LC220">      <span>console</span><span>.</span><span>error</span><span>(</span><span>&#34;\nFailed to get access token!&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L221" data-line-number="221"></td>
          <td id="file-anthropic-screws-opencode-ts-LC221">      <span>process</span><span>.</span><span>exit</span><span>(</span><span>1</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L222" data-line-number="222"></td>
          <td id="file-anthropic-screws-opencode-ts-LC222">    <span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L223" data-line-number="223"></td>
          <td id="file-anthropic-screws-opencode-ts-LC223">    </td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L224" data-line-number="224"></td>
          <td id="file-anthropic-screws-opencode-ts-LC224">    <span>console</span><span>.</span><span>log</span><span>(</span><span>&#34;Got access token!\n&#34;</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L225" data-line-number="225"></td>
          <td id="file-anthropic-screws-opencode-ts-LC225">  <span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L226" data-line-number="226"></td>
          <td id="file-anthropic-screws-opencode-ts-LC226">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L227" data-line-number="227"></td>
          <td id="file-anthropic-screws-opencode-ts-LC227">  <span>await</span> <span>runTests</span><span>(</span><span>accessToken</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L228" data-line-number="228"></td>
          <td id="file-anthropic-screws-opencode-ts-LC228">  <span>rl</span><span>.</span><span>close</span><span>(</span><span>)</span><span>;</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L229" data-line-number="229"></td>
          <td id="file-anthropic-screws-opencode-ts-LC229"><span>}</span></td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L230" data-line-number="230"></td>
          <td id="file-anthropic-screws-opencode-ts-LC230">
</td>
        </tr>
        <tr>
          <td id="file-anthropic-screws-opencode-ts-L231" data-line-number="231"></td>
          <td id="file-anthropic-screws-opencode-ts-LC231"><span>main</span><span>(</span><span>)</span><span>.</span><span>catch</span><span>(</span><span>console</span><span>.</span><span>error</span><span>)</span><span>.</span><span>finally</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>rl</span><span>.</span><span>close</span><span>(</span><span>)</span><span>)</span><span>;</span></td>
        </tr>
  </tbody></div></div>
  </body>
</html>
