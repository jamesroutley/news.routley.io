<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.scattered-thoughts.net/log/0042/">Original</a>
    <h1>0042: consulting lessons, there are no strings on me, buttondown, focus goof, jsfuck, 1ml</h1>
    
    <div id="readability-page-1" class="page"><article>
  <h2 id="consulting-lessons">consulting lessons</h2>
<p>I ended my consulting gig not long after starting, when it became obvious that we had very different ideas about how to write high-performance software.</p>
<p>I guess I can add this to my list of things learned about consulting. It&#39;s not enough to be clear on what I&#39;m being hired to produce - we also need to make sure we&#39;re on the same page as to what producing that output will actually look like. I&#39;ll have to think about how to do that effectively.</p>
<p>The disagreement in this case was at least partly caused by my high rates. They wanted me to just focus on assembling the skeleton of the architecture and not waste time on testing/benchmarking/optimization, which they can do themselves later. But I don&#39;t think that design is separable from measurement/validation.</p>
<p>&#34;Give us a sketch and we&#39;ll fill in the details&#34; makes sense if the details are self-contained, but performance tends to entangle all the details together. The overall design needs to be determined by the details, making the skill is procedural, rather than declarative.</p>
<p>Anyway, I&#39;d be much wealthier if I could just take peoples money and give them what they ask for without caring if I&#39;m delivering something worth the cost.</p>
<h2 id="there-are-no-strings-on-me"><a href="https://www.scattered-thoughts.net/writing/there-are-no-strings-on-me/">there are no strings on me</a></h2>
<p>The latest in this series of musings on language design for malleable software:</p>
<ul>
<li><a href="https://www.scattered-thoughts.net/writing/the-shape-of-data/">The shape of data</a></li>
<li><a href="https://www.scattered-thoughts.net/writing/implementing-interactive-languages/">Implementing interactive languages</a></li>
<li><a href="https://www.scattered-thoughts.net/writing/babys-first-wasm-compiler/">Baby&#39;s first wasm compiler</a></li>
<li><a href="https://www.scattered-thoughts.net/writing/there-are-no-strings-on-me/">There are no strings on me</a></li>
</ul>
<p>I have a whole pile of notes and ideas that have been slowly coalescing in my head over the last year or two. Now it&#39;s time to start pinning some decisions in place to constrain the rest of the design space.</p>
<p>I&#39;m planning to spend at least 2024 working on this. Compared to my work on <a href="https://www.scattered-thoughts.net/#imp_v0">imp</a>, zest has a much clearer purpose and the design problems are more in the &#39;adjacent possible&#39;. Most of the pieces have already been tried elsewhere in some form, and the remaining few aren&#39;t critical.</p>
<p>I&#39;ll also return to sustaining that work through <a href="https://github.com/sponsors/jamii">github sponsors</a>. It&#39;ll likely never be enough to support us entirely without some consulting work on the side, but it certainly slows the bleeding. There&#39;s value too to the support and accountability, I think.</p>
<h2 id="buttondown">buttondown</h2>
<p>Tinyletter closed down so I moved the email notifications to <a href="https://buttondown.email/">buttondown</a>. It&#39;s more expensive than the alternatives but seems less likely to go on an <a href="https://ourincrediblejourney.tumblr.com/post/735350248580546560/tinyletter">incredible journey</a> in the near future. So far it&#39;s been pretty pleasant to use - the interface is definitely focused squarely at programmers rather than marketers.</p>
<p>Let me know if you didn&#39;t get the email for this log :)</p>
<h2 id="focus-goof">focus goof</h2>
<p>I had a bug in <a href="https://github.com/jamii/focus">focus</a> that I&#39;ve been lazy about tracking down. Every so often it would just crash. But weirdly it didn&#39;t leave a coredump. I also couldn&#39;t reproduce the crash in gdb, or even reliably reproduce it at all except to notice that it always happened when searching using ripgrap. So I&#39;ve just been ignoring it for a while.</p>
<p>I mentioned this to a friend who suggested leaving strace attached to see if it was dying in the middle of a syscall or in userland code. So after a day or two it crashes again and I look at the log from strace and the last syscall executed is... kill. On it&#39;s own pid. </p>
<p>The victim was the murderer all along!</p>
<p>Here&#39;s the murder weapon:</p>
<pre data-lang="zig"><code data-lang="zig"><span>const</span><span> pgid </span><span>=</span><span> std.os.linux.</span><span>syscall1</span><span>(.getpgid</span><span>, </span><span>@as</span><span>(usize</span><span>, </span><span>@bitCast</span><span>(</span><span>@as</span><span>(isize</span><span>,</span><span> self.child_process.id))))</span><span>;
</span><span>std.os.</span><span>kill</span><span>(</span><span>-</span><span>@as</span><span>(i32</span><span>, </span><span>@intCast</span><span>(pgid))</span><span>,</span><span> std.os.SIG.KILL) </span><span>catch </span><span>{}</span><span>;
</span></code></pre>
<p>This code is used not just for calling ripgrep but also compilers, unit tests, fuzzers etc. Many of which spawn subprocesses and don&#39;t clean them up properly when killed. So to run them I fork a child which immediately calls setsid to start a new process group. And when I&#39;m done with them I kill the whole process group.</p>
<p>But there&#39;s a race condition here. If I run the above code before the child process has been scheduled and runs setsid, then pgid is the pid of the parent process and it kills itself, leaving no incriminating coredumps. And since it&#39;s a race, running it in gdb can alter the timing enough to prevent reproducing the crash.</p>
<p>The root problem here of course is that <a href="http://catern.com/process.html">linux doesn&#39;t have a sane way to supervise processes</a>. So here&#39;s my hacky workaround:</p>
<pre data-lang="zig"><code data-lang="zig"><span>var</span><span> my_pgid </span><span>=</span><span> std.os.linux.</span><span>syscall1</span><span>(.getpgid</span><span>, </span><span>@as</span><span>(usize</span><span>, </span><span>@bitCast</span><span>(</span><span>@as</span><span>(isize</span><span>,</span><span> std.os.linux.</span><span>getpid</span><span>()))))</span><span>;
</span><span>var</span><span> child_pgid </span><span>=</span><span> my_pgid</span><span>;
</span><span>// Have to wait for child to finish `setsid`
</span><span>while </span><span>(my_pgid </span><span>==</span><span> child_pgid) {
</span><span>    child_pgid </span><span>=</span><span> std.os.linux.</span><span>syscall1</span><span>(.getpgid</span><span>, </span><span>@as</span><span>(usize</span><span>, </span><span>@bitCast</span><span>(</span><span>@as</span><span>(isize</span><span>,</span><span> self.child_process.id))))</span><span>;
</span><span>}
</span><span>std.os.</span><span>kill</span><span>(</span><span>-</span><span>@as</span><span>(i32</span><span>, </span><span>@intCast</span><span>(child_pgid))</span><span>,</span><span> std.os.SIG.KILL) </span><span>catch </span><span>{}</span><span>;
</span></code></pre>
<h2 id="jsfuck"><a href="https://github.com/aemkei/jsfuck/">jsfuck</a></h2>
<p>Javascript is definitely haunted.</p>
<pre data-lang="javascript"><code data-lang="javascript"><span>&gt; </span><span>deno
</span><span>Deno </span><span>1.33</span><span>.</span><span>3
</span><span>exit using ctrl</span><span>+</span><span>d</span><span>, </span><span>ctrl</span><span>+</span><span>c</span><span>, </span><span>or </span><span>close</span><span>()
</span><span>REPL is running </span><span>with </span><span>all permissions allowed</span><span>.
</span><span>To specify permissions</span><span>, </span><span>run </span><span>`deno repl` </span><span>with </span><span>allow flags</span><span>.
</span><span>&gt; </span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]][([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]]((</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>+</span><span>[</span><span>!</span><span>[]]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+!+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>+</span><span>(</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+!+</span><span>[]]))[(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([]</span><span>+</span><span>[])[([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]][([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>((</span><span>+</span><span>[])[([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+!+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]]](</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]])</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]])()(([]</span><span>+</span><span>[])[(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]]()[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]]</span><span>+</span><span>(</span><span>+</span><span>(</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]</span><span>+</span><span>[</span><span>+!+</span><span>[]]))[(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([]</span><span>+</span><span>[])[([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]][([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>((</span><span>+</span><span>[])[([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+!+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]]](</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+!+</span><span>[]])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>+</span><span>[</span><span>!</span><span>[]]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+!+</span><span>[]]]</span><span>+</span><span>(</span><span>+</span><span>(</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]))[(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([]</span><span>+</span><span>[])[([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]][([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>((</span><span>+</span><span>[])[([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+!+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]]](</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]])</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>([]</span><span>+</span><span>[])[(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>([][[]]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>([][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[][(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+</span><span>[]]])[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>+</span><span>[]]]</span><span>+</span><span>(</span><span>!!</span><span>[]</span><span>+</span><span>[])[</span><span>+!+</span><span>[]]]()[</span><span>+!+</span><span>[]</span><span>+</span><span>[</span><span>!+</span><span>[]</span><span>+!+</span><span>[]]])
</span><span>&#34;hello world&#34;
</span></code></pre>
<h2 id="1ml-core-and-modules-united"><a href="https://people.mpi-sws.org/%7Erossberg/1ml/1ml-jfp-draft.pdf">1ML - Core and Modules United</a></h2>
<p>This has been on my reading list forever. Finally got around to it.</p>
<p>It&#39;s going to take a few more readings to really get a grip on it. My rough understanding at the moment is that it&#39;s in some ways quite similar to zig. The big and important difference is that types are opaque, so the result of a type-constructing function can&#39;t depend on the input type except parametrically. This means that type checking can reason about the result abstractly before specialization, so we can type-check functions rather than just specialization of functions. And have good IDE completions etc.</p>
<p>But a lot of useful code in zig depends non-parameterically on input types! For example, <a href="https://github.com/ziglang/zig/blob/67709b638224ac03820226c6744d8b6ead59184c//lib/std/multi_array_list.zig#L9-L20">MultiArrayList</a> automates the conversion from array-of-structs to struct-of-arrays. </p>
<p>After some prompting from <a href="https://matklad.github.io/">matklad</a> I don&#39;t think this is completely irreconcilable. In:</p>
<pre data-lang="zig"><code data-lang="zig"><span>fn </span><span>MultiArrayList</span><span>(</span><span>comptime </span><span>T</span><span>: </span><span>type</span><span>) </span><span>type </span><span>{
</span><span>   </span><span>...
</span><span>}
</span></code></pre>
<p>The <code>...</code> constructs the type and the return type of the function is just <code>type</code>. But most of the public interface of <code>MultiArrayList(T)</code> is parametric in <code>T</code> (if we allow some associated-type-like helper functions for introspecting the type). It&#39;s only the internals that are non-parameteric. So in some hypothetical 1ML-zig we could write:</p>
<pre data-lang="zig"><code data-lang="zig"><span>fn </span><span>MultiArrayList</span><span>(</span><span>comptime </span><span>T</span><span>: </span><span>type</span><span>) </span><span>MultiArrayListSignature</span><span>(T) {
</span><span>   </span><span>...
</span><span>}
</span><span>
</span><span>fn </span><span>MultiArrayListSignature</span><span>(</span><span>comptime </span><span>T</span><span>: </span><span>type</span><span>) </span><span>type </span><span>{
</span><span>  </span><span>return struct </span><span>{
</span><span>     </span><span>fn </span><span>init</span><span>(</span><span>Allocator</span><span>) </span><span>Self 
</span><span>     </span><span>fn </span><span>get</span><span>(</span><span>Self</span><span>, </span><span>usize</span><span>) </span><span>T
</span><span>     </span><span>fn </span><span>items</span><span>(</span><span>Self</span><span>, </span><span>comptime </span><span>field</span><span>: </span><span>@fieldOf</span><span>(</span><span>T</span><span>)) </span><span>@fieldTypeOf</span><span>(T</span><span>,</span><span> field)
</span><span>  }
</span><span>}
</span></code></pre>
<p>And then everything in <code>MultiArrayListSignature</code> is parametric in <code>T</code>, so the type checker can reason about it before specialization.</p>
<p>We&#39;re probably still going to run into limitations in places (eg can you express the type <code>T where @fieldOf(T) == @fieldOf(U)</code>?). One of the really nice things about the zig/julia approach to types is that it&#39;s incredibly simple. You only ever have to reason about concrete types. Whereas with 1ML I&#39;m already unsure exactly what kind of code I&#39;d be allowed to write. So I&#39;m not sure I want to think too far down this path. But I&#39;ll keep it in the idea stew.</p>

</article></div>
  </body>
</html>
