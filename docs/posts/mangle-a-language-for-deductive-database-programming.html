<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/google/mangle">Original</a>
    <h1>Mangle â€“ a language for deductive database programming</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Mangle is a programming language for deductive database programming. It
is an extension of Datalog, with various extensions like aggregation, function
calls and optional type-checking.</p>
<p dir="auto">Deductive database programming is useful for bringing data from multiple
data sources together since it enables us to represent and query that data in
a uniform way. It can also be used to model domain knowledge, similar
to machine-readable ontology but without being restricted to binary
predicates.</p>
<p dir="auto">Datalog is an expressive declarative language similar to relational calculus
(think SQL and relational views). Unlike relational calculus, it also supports
recursive rules and program structuring in a straightforward way.</p>
<p dir="auto">Mangle contains Datalog as a fragment and adds extensions that make its use
more practical. Some of the good properties like guaranteed termination are
lost when such extensions are used.</p>
<p dir="auto">The goal of Mangle as an open source project is to convey the concepts in
a way that is accessible to developers and lends itself to easy experimentation.
This repository contains an implementation of Mangle as a go library that can be
easily embedded into applications.</p>
<p dir="auto">Check out the <a href="https://github.com/google/mangle/blob/main/docs/README.md">docs</a> and the
<a href="https://github.com/google/mangle/discussions">GitHub discussions</a> for more
information. There is also a Q&amp;A section.</p>
<p dir="auto">For an example how to use Mangle library in a database-like grpc service,
see the separate <a href="https://github.com/burakemir/mangle-service">Mangle demo service repo</a>.</p>
<p dir="auto">This is not an officially supported Google product.</p>

<ul dir="auto">
<li><a href="#examples">Examples</a></li>
<li><a href="#building">Building</a></li>
</ul>


<p dir="auto">Imagine you were asked to spot software affected by the
<a href="https://www.cisa.gov/uscert/apache-log4j-vulnerability-guidance" rel="nofollow">log4j vulnerability discovered in late 2021</a>.
We want to look for projects that contain a Java archive (jar file) of
log4j that is not updated to the patched version.</p>
<div dir="auto" data-snippet-clipboard-copy-content="projects_with_vulnerable_log4j(P) :-
  projects(P),
  contains_jar(P, &#34;log4j&#34;, Version),
  Version != &#34;2.17.1&#34;,
  Version != &#34;2.12.4&#34;,
  Version != &#34;2.3.2&#34;."><pre><span>projects_with_vulnerable_log4j</span>(<span>P</span>) <span>:-</span>
  projects(<span>P</span>),
  contains_jar(<span>P</span>, <span>&#34;log4j&#34;</span>, <span>Version</span>),
  <span>Version</span> <span>!</span><span>=</span> <span>&#34;2.17.1&#34;</span>,
  <span>Version</span> <span>!</span><span>=</span> <span>&#34;2.12.4&#34;</span>,
  <span>Version</span> <span>!</span><span>=</span> <span>&#34;2.3.2&#34;</span><span>.</span></pre></div>
<p dir="auto">This is a Mangle <em>rule</em>: conceptually, the implementation retrieve all
possible values for variables <code>P</code> and <code>Version</code> that make all the subgoals true.</p>
<p dir="auto">Simple Mangle rules like this correspond to select-project-join relational
queries. The same query in SQL would look like this:</p>
<div dir="auto" data-snippet-clipboard-copy-content="SELECT projects.id as P
FROM projects JOIN contains_jar ON projects.id = contains_jar.project_id
WHERE contains_jar.version NOT IN (&#34;2.17.1&#34;, &#34;2.12.4&#34;, &#34;2.3.2&#34;)"><pre><span>SELECT</span> <span>projects</span>.<span>id</span> <span>as</span> P
<span>FROM</span> projects <span>JOIN</span> contains_jar <span>ON</span> <span>projects</span>.<span>id</span> <span>=</span> <span>contains_jar</span>.<span>project_id</span>
<span>WHERE</span> <span>contains_jar</span>.<span>version</span> NOT <span>IN</span> (<span><span>&#34;</span>2.17.1<span>&#34;</span></span>, <span><span>&#34;</span>2.12.4<span>&#34;</span></span>, <span><span>&#34;</span>2.3.2<span>&#34;</span></span>)</pre></div>
<p dir="auto">Unlike SQL, our Mangle rule <code>projects_with_vulnerable_log4j</code> has a name
and can be referenced in other queries.</p>
<p dir="auto">(If translating non-recursive Datalog into SQL queries sounds interesting, you
should check out the <a href="https://logica.dev/" rel="nofollow">Logica</a> open source project.)</p>

<p dir="auto">In practice, querying is rarely enough and we also need grouping and
aggregation.</p>
<div data-snippet-clipboard-copy-content="count_projects_with_vulnerable_log4j(Num) :-
  projects_with_vulnerable_log4j(P) |&gt; do fn:group_by(), let Num = fn:Count()."><pre><code>count_projects_with_vulnerable_log4j(Num) :-
  projects_with_vulnerable_log4j(P) |&gt; do fn:group_by(), let Num = fn:Count().
</code></pre></div>

<p dir="auto">The example does not specify what <code>contains_jar</code> does. Here is a possible
implementation for <code>contains_jar</code> that walks a dependency graph.
This shows that Mangle rules can be recursive.</p>
<div data-snippet-clipboard-copy-content="contains_jar(P, Name, Version) :-
  contains_jar_directly(P, Name, Version).

contains_jar(P, Name, Version) :-
  project_depends(P, Q),
  contains_jar(Q, Name, Version)."><pre><code>contains_jar(P, Name, Version) :-
  contains_jar_directly(P, Name, Version).

contains_jar(P, Name, Version) :-
  project_depends(P, Q),
  contains_jar(Q, Name, Version).
</code></pre></div>
<p dir="auto">The two rules correspond to two cases in which a project may &#34;contain&#34; a jar:
either directly, or through some dependency.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Knowledge Graphs, Property Graphs</h3><a id="user-content-knowledge-graphs-property-graphs" aria-label="Permalink: Knowledge Graphs, Property Graphs" href="#knowledge-graphs-property-graphs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In requirements engineering, one needs to captures real world concepts in a
domain model and controlled vocabulary. Description logics use
roles to describe how concepts interact, but these relationships are always
binary. Mangle can represent binary predicates, but also arbitrary n-ary
relations. Moreover it also has support for structured data.</p>
<div data-snippet-clipboard-copy-content="one_or_two_leg_trip(Codes, Start, Destination, Price) :-
  direct_conn(Code, Start, Destination, Price)
  |&gt; let Codes = [Code].

one_or_two_leg_trip(Codes, Start, Destination, Price) :-
  direct_conn(FirstCode, Start, Connecting, FirstLegPrice).
  direct_conn(SecondCode, Connecting, Destination, SecondLegPrice)
  |&gt; let Code = [FirstCode, SecondCode],
     let Price = fn:plus(FirstLegPrice, SecondLegPrice).
"><pre><code>one_or_two_leg_trip(Codes, Start, Destination, Price) :-
  direct_conn(Code, Start, Destination, Price)
  |&gt; let Codes = [Code].

one_or_two_leg_trip(Codes, Start, Destination, Price) :-
  direct_conn(FirstCode, Start, Connecting, FirstLegPrice).
  direct_conn(SecondCode, Connecting, Destination, SecondLegPrice)
  |&gt; let Code = [FirstCode, SecondCode],
     let Price = fn:plus(FirstLegPrice, SecondLegPrice).

</code></pre></div>
<section data-identity="77eacd0d-d84f-4e57-b16d-63ff017574e1" data-host="https://viewscreen.githubusercontent.com" data-src="https://viewscreen.githubusercontent.com/markdown/mermaid?docs_host=https%3A%2F%2Fdocs.github.com" data-type="mermaid" aria-label="mermaid rendered output container">
  <div data-json="{&#34;data&#34;:&#34;graph LR\n    /zurich --&amp;gt;|/code/ZL &amp;lt;br /&amp;gt; 60 CHF| /lausanne\n    /zurich --&amp;gt;|/code/ZB &amp;lt;br /&amp;gt; 30 CHF| /bern\n    /bern --&amp;gt;|/code/BL &amp;lt;br /&amp;gt; 30 CHF| /lausanne\n&#34;}" data-plain="graph LR
    /zurich --&gt;|/code/ZL &lt;br /&gt; 60 CHF| /lausanne
    /zurich --&gt;|/code/ZB &lt;br /&gt; 30 CHF| /bern
    /bern --&gt;|/code/BL &lt;br /&gt; 30 CHF| /lausanne
" dir="auto">
    <div dir="auto">
      <pre lang="mermaid" aria-label="Raw mermaid code">graph LR
    /zurich --&gt;|/code/ZL &lt;br /&gt; 60 CHF| /lausanne
    /zurich --&gt;|/code/ZB &lt;br /&gt; 30 CHF| /bern
    /bern --&gt;|/code/BL &lt;br /&gt; 30 CHF| /lausanne
</pre>
    </div>
  </div>
  <span role="presentation">
    <span data-view-component="true">
  <svg style="box-sizing: content-box; color: var(--color-icon-primary);" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true" data-view-component="true">
    <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" fill="none"></circle>
    <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke"></path>
</svg>    <span>Loading</span>
</span>
  </span>
</section>


<p dir="auto">Get the dependencies (see <a href="https://github.com/google/mangle/blob/main/go.mod">go.mod</a>), build the library, run tests:</p>
<div data-snippet-clipboard-copy-content="go get -t ./...
go build ./...
go test ./..."><pre><code>go get -t ./...
go build ./...
go test ./...
</code></pre></div>
<div dir="auto"><h3 tabindex="-1" dir="auto">Regenerating the parser sources</h3><a id="user-content-regenerating-the-parser-sources" aria-label="Permalink: Regenerating the parser sources" href="#regenerating-the-parser-sources"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you want to regenerate the parser sources, you need to set up ANTLR first.
This requires a Java runtime environment.</p>
<div data-snippet-clipboard-copy-content="wget http://www.antlr.org/download/antlr-4.13.2-complete.jar
alias antlr=&#39;java -jar $PWD/antlr-4.13.2-complete.jar&#39;
antlr -Dlanguage=Go -package gen -o ./ parse/gen/Mangle.g4 -visitor"><pre><code>wget http://www.antlr.org/download/antlr-4.13.2-complete.jar
alias antlr=&#39;java -jar $PWD/antlr-4.13.2-complete.jar&#39;
antlr -Dlanguage=Go -package gen -o ./ parse/gen/Mangle.g4 -visitor
</code></pre></div>

<p dir="auto">The Mangle maintainers welcome external contributions to spec, documentation
and this implementation (see <a href="https://github.com/google/mangle/blob/main/CONTRIBUTING.md">CONTRIBUTING.md</a>) and also other
implementations. Pull requests will be handled
<a href="https://github.com/tensorflow/tensorflow/blob/master/CONTRIBUTING.md">like for tensorflow</a>,
to ensure our internal usage and tests will pass.</p>
</article></div></div>
  </body>
</html>
