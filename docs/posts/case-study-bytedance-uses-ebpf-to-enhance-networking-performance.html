<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ebpf.foundation/case-study-bytedance-uses-ebpf-to-enhance-networking-performance/">Original</a>
    <h1>Case Study: ByteDance Uses eBPF to Enhance Networking Performance</h1>
    
    <div id="readability-page-1" class="page"><div>

            
            <div role="main">

            
<article id="post-1212">
  
  <div>

		<div data-hide-featured-media="0">
      
        <div><p><a href="https://www.linuxfoundation.org/hubfs/eBPF/Case%20Study%20Bytedance%20Uses%20eBPF%20to%20Enhance%20Networking%20Performance.pdf"><em>Download this case study in PDF format</em></a></p>
<h3><b>Overview</b></h3>
<p><span>Bytedance, a global technology company operating a wide range of content platforms around the world at massive scale, faced significant challenges in ensuring performance and stability across its data centers. With over a million servers running containerized applications, the company required a networking solution that could handle high throughput while maintaining stability. By leveraging eBPF technology, Bytedance successfully implemented a decentralized networking solution that improved efficiency, scalability, and performance.</span></p>
<h3><b>Challenge</b></h3>
<p><span>As Bytedance scaled its operations, its existing container networking solution, which relied on virtual Ethernet devices, began showing limitations. Key challenges included:</span></p>
<ul>
<li><b>Performance Bottlenecks</b><span>: The virtual Ethernet-based solution introduced soft-interrupt bottlenecks in the network stack, causing inefficiencies.</span></li>
<li><b>Stability Concerns</b><span>: Ensuring stability at such a large scale was critical, but unproven solutions posed risks in production environments.</span></li>
<li><b>Kernel Version Constraints</b><span>: Upgrading to the required kernel version (6.8) was not immediately feasible due to operational constraints.</span></li>
</ul>
<p><span>To address these challenges, Bytedance required a robust, scalable, and high-performance solution that could be deployed incrementally across its data centers.</span></p>
<h3><b>Solution</b></h3>
<p><span>Bytedance turned to eBPF to address these challenges. eBPF, a powerful technology for dynamically and safely reprogramming the Linux kernel, enabled the company to redesign its container networking stack. Key steps in the implementation included:</span></p>
<ul>
<li><b>Introducing netkit</b><span>:</span>
<ul>
<li><span>Bytedance adopted </span><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/net/netkit.c"><span>netkit</span></a><span>, an eBPF-powered networking device introduced in version 6.8 of the Linux kernel, which provides superior performance over traditional virtual Ethernet in container networking.</span></li>
<li><span>To accommodate existing constraints and legacy deployments, netkit was backported to kernel version 5.15, ensuring compatibility with Bytedance’s infrastructure.</span></li>
</ul>
</li>
<li><b>Rolling Upgrade Strategy</b><span>:</span>
<ul>
<li><span>A carefully orchestrated upgrade process ensured minimal disruption. Both the container networking interface and kernel upgrades were managed independently, allowing a gradual transition to netkit.</span></li>
<li><span>There was a concern over potential issues with mixed deployments, so compatibility between netkit and virtual Ethernet was ensured throughout the transition.</span></li>
</ul>
</li>
<li><b>Handling Failures</b><span>:</span>
<ul>
<li><span>Fallback mechanisms were implemented to handle scenarios where netkit or its associated eBPF programs failed, to ensure uninterrupted service.</span></li>
</ul>
</li>
</ul>
<h3><b>Results</b></h3>
<p><span>The deployment of eBPF and netkit delivered significant improvements across Bytedance’s data centers:</span></p>
<ul>
<li><b>Performance Gains</b><span>:</span>
<ul>
<li><span>Eliminated the last soft-interrupt in the network stack, leading to a 10% improvement in throughput.</span></li>
<li><span>Resolved issues with high CPU load and packet reordering caused by virtual Ethernet, enhancing overall efficiency.</span></li>
</ul>
</li>
<li><b>Scalability and Stability</b><span>:</span>
<ul>
<li><span>Successfully deployed netkit across dozens of clusters, demonstrating its reliability and readiness for broader adoption.</span></li>
</ul>
</li>
<li><b>Operational Benefits</b><span>:</span>
<ul>
<li><span>Simplified the networking stack, reducing maintenance overhead and improving system observability.</span></li>
</ul>
</li>
</ul>
<h3><b>Future Plans</b></h3>
<p><span>Bytedance plans to further explore the potential of eBPF, including:</span></p>
<ul>
<li><b>Hardware Offloading</b><span>: Combining eBPF with hardware offloading to achieve even greater network performance.</span></li>
<li><b>Broader Use Cases</b><span>: Expanding eBPF’s application beyond container networking to other areas of system optimization.</span></li>
</ul>
<h3><b>Conclusion</b></h3>
<p><span>Bytedance’s adoption of eBPF and netkit highlights the transformative potential of this technology in addressing large-scale networking challenges. By redesigning its networking stack and leveraging the flexibility of eBPF, Bytedance achieved measurable performance improvements while ensuring stability and scalability. This deployment serves as a testament to eBPF’s capability to drive innovation in modern data center operations.</span></p>
<p><span>To learn more about their use of netkit, check out the </span><a href="https://www.youtube.com/watch?v=0w788CqTp0c"><span>talk from eBPF Summit</span></a><span>.</span></p>
</div>        
      </div><!--/post-content-->
      
    </div><!--/inner-wrap-->
    
</article>
        </div><!--/post-area-->

            
        </div></div>
  </body>
</html>
