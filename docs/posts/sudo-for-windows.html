<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://devblogs.microsoft.com/commandline/introducing-sudo-for-windows/">Original</a>
    <h1>Sudo for Windows</h1>
    
    <div id="readability-page-1" class="page"><div id="featured">

	<div>
                         <p>
            February 7th, 2024</p><!-- .entry-meta -->
        
<p>We’re excited to announce the release of Sudo for Windows in <a href="https://aka.ms/wip26052">Windows 11 Insider Preview Build 26052</a>! Sudo for Windows is a new way for users to run elevated commands directly from an unelevated console session. It is an ergonomic and familiar solution for users who want to elevate a command without having to first open a new elevated console.</p>
<p>We are also excited to announce that we are open-sourcing this project <a href="https://github.com/microsoft/sudo">here</a> on GitHub! We’re working hard to add more information about the project in the GitHub repo and will be sharing more details about our plans in the coming months! If you’re looking for additional functionality that Sudo for Windows does not provide, check out Gerardo Grignoli’s <a href="https://github.com/gerardog/gsudo">gsudo</a> which has a number of additional features and configuration options.</p>
<h2 id="how-to-enable-sudo-for-windows">How to enable Sudo for Windows</h2>
<p>To enable Sudo for Windows, navigate to the Settings &gt; For Developers page in Windows Settings and toggle on the “Enable Sudo” option:</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/commandline/wp-content/uploads/sites/33/2024/02/for-developers-settings1.png" alt="For Developer Settings"/></p>
<p>You can alternatively enable Sudo for Windows by running the following command <strong>in an elevated console session</strong>:</p>
<pre><code>sudo config --enable &lt;configuration_option&gt;
</code></pre>
<p><img decoding="async" src="https://devblogs.microsoft.com/commandline/wp-content/uploads/sites/33/2024/02/sudo-config.gif" alt="sudo configuration"/></p>
<h2 id="how-to-configure-sudo-for-windows">How to configure Sudo for Windows</h2>
<p>Sudo for Windows currently supports three different configuration options:</p>
<ol>
<li><a href="#configuration-option-1-force-a-new-window">In a new window</a> (forceNewWindow)</li>
<li><a href="#configuration-option-2-input-closed">Input closed</a> (disableInput)</li>
<li><a href="#configuration-option-3-inline">Inline</a> (normal)</li>
</ol>
<p>To change the configuration option, use the drop-down menu in the Settings &gt; For Developers page in Windows Settings:</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/commandline/wp-content/uploads/sites/33/2024/02/for-developers-settings2.png" alt="For Developers - Sudo Configurations"/></p>
<p>You can alternatively change the configuration option by running the following command in an elevated console session:</p>
<pre><code>sudo config --enable &lt;configuration_option&gt;
</code></pre>
<h3 id="configuration-option-1-in-a-new-window">Configuration Option 1: In a New Window</h3>
<p>In this configuration, Sudo for Windows will open a new elevated console window and run the command in that window. This is the default configuration option when sudo is enabled. For example, if you run:</p>
<pre><code>sudo netstat -ab
</code></pre>
<p>A new window will open and the command will be run in that window:</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/commandline/wp-content/uploads/sites/33/2024/02/force-new-window.gif" alt="sudo netstat -ab"/></p>
<h3 id="configuration-option-2-input-closed">Configuration Option 2: Input Closed</h3>
<p>In this configuration, Sudo for Windows will run the elevated process in the current window, but the new process will be spawned with its stdin closed. This means that the new process will not accept any user input, so this configuration will not work for processes that require further user input after elevation.</p>
<h3 id="configuration-option-3-inline">Configuration Option 3: Inline</h3>
<p>This configuration is most similar to the behavior of sudo on other operating systems. In this configuration, Sudo for Windows will run the elevated process with its stdin, stdout, and stderr all connected to the current window. This means the new elevated process can take in input and route output to the current window.</p>
<h2 id="how-does-it-work">How does it work?</h2>
<p>When elevating a process from the command-line with sudo, a UAC dialog will appear asking the user to confirm the elevation:</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/commandline/wp-content/uploads/sites/33/2024/02/uac-dialog.png" alt="UAC Dialog"/></p>
<p>Once the user confirms the elevation, the process will be elevated based on the <a href="#how-to-configure-sudo-for-windows">configuration option</a> selected by the user.</p>
<p>You can check out the optional parameters for the <code>sudo</code> command by running <code>sudo -h</code> in your console.</p>
<h3 id="in-a-new-window">In a New Window</h3>
<p>In this configuration, sudo.exe will launch a new elevated console window and run the command in that window. The new window will be launched with the same working directory as the current window. The new window will also be launched with the same environment variables as the current window. This configuration has a similar flow to the runas command.</p>
<h3 id="input-closed-and-inline">Input Closed and Inline</h3>
<p>In these configurations, sudo.exe will launch a new elevated process, an elevated sudo.exe process, and the original unelevated sudo.exe will establish an RPC connection with the new elevated process. In other words, information is passed from the unelevated sudo instance to the elevated one. Specifically, the console handles from the unelevated process are passed to the elevated process which allows the elevated process to read input from the unelevated process and write output to the unelevated process. However, when sudo is configured in the “Input Closed” configuration, the elevated process will essentially not be passed the console’s input handle, so it will not be able to read input from the user.</p>
<p>Here is a diagram of how the process hierarchy looks:</p>
<p><img decoding="async" src="https://devblogs.microsoft.com/commandline/wp-content/uploads/sites/33/2024/02/sudo-diagram.png" alt="sudo diagram"/></p>
<p>It is important when running sudo in the “Inline” or “Input Closed” configurations to be aware of the security implications. It is possible that a medium integrity process can drive the elevated process. This risk is mitigated in the “Input Closed” configuration because the elevated process will not be able to read input from the user.</p>
<p>Over the coming months we will be working on expanding documentation for Sudo for Windows and will be sharing more details about the security implications of running sudo in the “Inline” configuration.</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/htQhM1Y-adM?si=z4wZTwmgHBLDXWYU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" title="Introducing Sudo for Windows!"></iframe></p>
<h2 id="whats-next">What’s next?</h2>
<p>Our team is working on open-sourcing Sudo for Windows and we’re excited to share more details about our plans in the coming months. In the meantime, we’d love to hear your feedback! Please share your feedback directly in the <a href="https://github.com/microsoft/sudo">GitHub</a> repository.</p>

        

        
		
        
	</div><!-- .entry-content -->

</div></div>
  </body>
</html>
