<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rachelbythebay.com/w/2021/10/05/cmd/">Original</a>
    <h1>&#39;date -d&#39; vs. &#39;date -s&#39;, and &#39;show foo&#39; vs. &#39;clear foo&#39;</h1>
    
    
<p>
Here&#39;s something fun I saw which created an outage once.  I&#39;ve written 
about this
<a href="https://rachelbythebay.com/w/2018/04/12/date/">before,</a>
but in light of yesterday&#39;s fun and games, I figured this one is worth 
another mention.
</p>
<p>
There was someone running around trying to do some work on a Linux box.  
They had picked up some time_t value from the logs - that is, the number 
of seconds since January 1, 1970 at midnight UTC that is typically 
thought of as &#34;Unix time&#34;.  Right now, it&#39;s about 1.6 billion, and will 
hit 1.7 billion in November 2023.  They wanted to turn it back into a 
human-readable date.
</p>
<p>
One way to do this on a Linux box with the usual GNU userspace stuff is 
to feed it to date, like this:
</p>
<pre class="terminal">$ date -d @1700000000
Tue Nov 14 14:13:20 PST 2023
</pre>
<p>
The problem is, there&#39;s another command very much like it that will even 
spit out the same output, only it has a nice little side-effect: 
<em>it also sets the clock</em>.  That command is date <b>-s</b>.
</p>
<p>
If you&#39;re on a QWERTY layout or are generally familiar with it, you 
might notice that [S] and [D] are right next to each other and are an 
easy typo to make with your left hand.  That&#39;s one way to screw up.
</p>
<p>
Another problem is that you might not have known that -s has that 
effect, and you have been using it because it gives you the output you 
want, and you don&#39;t realize what else it can do.
</p>
<p>
Anyway, on this day, that person needed to translate a numeric count of 
seconds since the Unix epoch to a regular time string they could read, 
used the wrong command (off by ONE KEY POSITION), and *set the clock* to 
this wrong time.
</p>
<p>
This then touched off a whole bunch of badness which I already talked 
about before.  It messed up other systems, and brought up questions of 
how to defend against it, and all of that other good stuff you&#39;d expect 
to hear after a problem of that sort.
</p>
<p>
What&#39;s reminding me of it today is something I heard about yesterday&#39;s 
FB outage.  I don&#39;t know exactly what went on inside there, or what 
happened to break everything, but I heard a rumor it was a command that 
was supposed to <em>display</em> everything, but instead it 
<em>cleared</em> everything.
</p>
<p>
That is, it might just be the difference between:
</p>
<div class="terminal">
<p>
show mpls lsp
</p>
</div>
<p>
... and ...
</p>
<div class="terminal">
<a href="https://www.juniper.net/documentation/us/en/software/junos/mpls/topics/ref/command/clear-mpls-lsp.html">clear mpls lsp</a>
</div>
<p>
Of course, nobody&#39;s going to confirm or deny that, so we can only guess.
But look at that: one command just lists a bunch of stuff, and the other 
one knocks them out!
</p>
<p>
Hopefully the similarity to &#39;date -d&#39; vs. &#39;date -s&#39; is clear.
</p>
<p>
Small commands can have giant consequences.
</p>

  </body>
</html>
