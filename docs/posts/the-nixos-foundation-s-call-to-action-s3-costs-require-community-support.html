<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://discourse.nixos.org/t/the-nixos-foundations-call-to-action-s3-costs-require-community-support/28672">Original</a>
    <h1>The NixOS Foundation’s Call to Action: S3 Costs Require Community Support</h1>
    
    <div id="readability-page-1" class="page"><div id="main-outlet">
        

  


      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>Hi all,</p>
<p>TL;DR - Kicking off an effort to secure long-term funding for our S3 costs and exploring alternatives. This comes after multiple years where Logicblox has been graciously sponsoring the S3 costs for Nix! An enormous thank you to them.</p>
<p>The LogicBlox team (which has since been acquired by Infor) has been providing significant support to the Nix ecosystem by sponsoring our S3 buckets. They have asked to transfer the ownership of the costs and give us a good heads up (timeline discussed below). We are now working on transferring the expenses/ownership to the foundation.</p>
<h3>
<a name="details-1" href="#details-1"></a>Details</h3>
<p>Estimated Monthly Costs - ~$9000 / month for hosting <a href="http://cache.nixos.org">cache.nixos.org</a>, see the <a href="https://discourse.nixos.org/t/nixos-foundations-financial-summary-a-transparent-look-into-2022/28107/15">breakdown for more details</a>.</p>
<p>Deadline - Aiming for July 1st</p>
<h3>
<a name="initial-potential-solution-brainstorm-2" href="#initial-potential-solution-brainstorm-2"></a>Initial Potential Solution Brainstorm</h3>
<p>We’re exploring different solutions for this, including getting direct sponsoring from a hosting provider (AWS or Cloudfare) and having the foundation paying for the S3 buckets through community sponsorship.</p>
<p>So far the most likely solutions are:</p>
<ul>
<li>Migrating the buckets to <a href="https://www.cloudflare.com/products/r2/">Cloudflare R2</a>, and using the generous OSS sponsorship offer <a href="https://blog.cloudflare.com/cloudflare-new-oss-sponsorships-program/">they recently announced</a>. That would incur a fixed cost of around $32k for the migration.</li>
<li>Keeping the bucket as it is and paying it in full ($9k/month at the moment, steadily rising as the cache keeps growing)</li>
<li>Keeping the budget, but garbage-collecting it. We could shrink probably shrink the costs a lot (realistically up to 70%), but there are heavy tradeoffs at play here since the data in the cache is sometimes very valuable.</li>
</ul>
<h3>
<a name="call-to-action-next-steps-3" href="#call-to-action-next-steps-3"></a>Call to Action &amp; Next Steps</h3>
<ul>
<li>Fundraising: We will start a general fundraiser for the cache, as every option currently on the table would require significant costs.</li>
<li>Creating a NixOS community task force to investigate these possibilities further: If you are interested in joining, please comment or reach out. - <a href="https://matrix.to/#/#foundation:nixos.org" rel="noopener nofollow ugc">https://matrix.to/#/#foundation:nixos.org</a>
</li>
<li>General request to everyone who has thoughts on this topic to join the discussion/brainstorming: <a href="https://matrix.to/#/#foundation:nixos.org" rel="noopener nofollow ugc">https://matrix.to/#/#foundation:nixos.org</a>
<ul>
<li>Are there any other providers we can explore?</li>
</ul>
</li>
<li>We will follow up with Cloudflare/AWS to receive more information and explore any other options/opportunities.</li>
</ul>
<p>Domen, Ron, Jonas, Eelco, Théophane</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>
          <meta itemprop="keywords" content=""/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>Maybe a company like Infomaniak would be willing to help, they provide S3 as a service.</p>

        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discourse.nixos.org/u/ryantm"><span itemprop="name">ryantm</span></a>
            
              pinned globally 
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2023-06-02T19:46:08Z">
                June 2, 2023,  7:46pm
              </time>
              <meta itemprop="dateModified" content="2023-06-02T19:46:08Z"/>
          <span itemprop="position">#3</span>
          </span>
        </p></div>
        

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>I just want to note multiple things regarding that.</p>

<p>I very much agree that this data is extremely valuable, and losing it would be a terrible blow for research communities and even understanding our own ecosystems.</p>
<p>That’s why I believe, no matter what happens: new store paths should be shipped to something that does not cost egress fees if possible, more on that later.</p>
<p>Onto the next thing:</p>

<p>The $32K migration fee, is, I assume, the egress thingie that AWS charge everyone for trying to quit their platform.</p>
<p>Multiple things to unpack:</p>
<p>(1) Have we reached out to AWS regarding this matter while pleading our case as a non-trivial open source project (which they benefited from, I’m certain, indirectly)?</p>
<p>(3) Egress fees are a known tactic to vendor lock-in people into a platform:<br/>
</p><div><a href="https://discourse.nixos.org/uploads/default/original/2X/a/a01b582d2cd02e0f8fb343eeaa4a3fd39df3ec18.png" data-download-href="https://discourse.nixos.org/uploads/default/a01b582d2cd02e0f8fb343eeaa4a3fd39df3ec18" title="image"><img src="https://discourse.nixos.org/uploads/default/optimized/2X/a/a01b582d2cd02e0f8fb343eeaa4a3fd39df3ec18_2_690x431.png" alt="image" data-base62-sha1="mQmYMTL88joNtOKDInporu9uDZm" width="690" height="431" srcset="https://discourse.nixos.org/uploads/default/optimized/2X/a/a01b582d2cd02e0f8fb343eeaa4a3fd39df3ec18_2_690x431.png, https://discourse.nixos.org/uploads/default/original/2X/a/a01b582d2cd02e0f8fb343eeaa4a3fd39df3ec18.png 1.5x, https://discourse.nixos.org/uploads/default/original/2X/a/a01b582d2cd02e0f8fb343eeaa4a3fd39df3ec18.png 2x" data-small-upload="https://discourse.nixos.org/uploads/default/optimized/2X/a/a01b582d2cd02e0f8fb343eeaa4a3fd39df3ec18_2_10x10.png"/></a></div></div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          

<p>If we care for historics I think durability is a very nice benefit</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>Just for curiosity sake, how many paths are there?</p>
<p>I don’t know if it’s just me but occasionally (almost often) when I am writing derivations the build stucks at querying for the narinfo of the derivation I just built. It is stuck only in the situations where it checks for the narinfo of a path that is not in the cache.</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discourse.nixos.org/u/qyliss"><span itemprop="name">qyliss</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2023-06-02T20:46:14Z">
                June 2, 2023,  8:46pm
              </time>
              <meta itemprop="dateModified" content="2023-06-02T20:46:14Z"/>
          <span itemprop="position">#7</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          
<p>Assuming it stays reasonably competitive, we should strongly consider whether we could pay our infrastructure team for this as well — the alternative of being okay paying (indirectly) AWS employees’ salaries, while not being okay to pay our own community members for the same purpose wouldn’t make any sense.</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          
<p>Obviously, what I’m asking for, is to compute what are we willing to guarantee vs. what can we afford realistically.</p>
<p>If we have enough to pay for this level of durability, maybe via AWS sponsoring! (<a href="https://cdn-aws.deb.debian.org/">https://cdn-aws.deb.debian.org/</a> !) — why not!</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discourse.nixos.org/u/misuzu"><span itemprop="name">misuzu</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2023-06-02T20:59:29Z">
                June 2, 2023,  8:59pm
              </time>
              <meta itemprop="dateModified" content="2023-06-02T20:59:29Z"/>
          <span itemprop="position">#10</span>
          </span>
        </p></div>
        <p>I’ve frequently thought that staging cycles might be expensive in terms of storage (build artifacts are mostly unused). Maybe there’s a benefit in splitting master/release branches and staging/glibc updates/etc to different storage spaces for easier garbage collection of development build cache.</p>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          
<p>At <a href="http://dotsrc.org" rel="noopener nofollow ugc">dotsrc.org</a> we would love to help but have only ~17 TB of free space since our mirrors mostly run on decommissioned hardware and a relatively low budget.</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discourse.nixos.org/u/flokli"><span itemprop="name">flokli</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2023-06-02T21:30:52Z">
                June 2, 2023,  9:30pm
              </time>
              <meta itemprop="dateModified" content="2023-06-02T21:30:52Z"/>
          <span itemprop="position">#12</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Another thing to keep in mind is that the NAR format is pretty wasteful on its own, no matter if we compress the NAR files or not.</p>
<p>A lot of the files inside a store path don’t actually change, and “exploding” the NAR file and the structure into smaller parts gives a lot of possibility for deduplication.</p>
<p>As part of my work on <a href="https://tvix.dev/">tvix</a>, I’ve been spending quite some time on tvix-store, which is using a model similar to git trees/blobs (<a href="https://cs.tvl.fyi/depot/-/blob/tvix/store/docs/why-not-git-trees.md">but not quite</a>) as an underlying storage.</p>
<p>It is still able to produce NAR files on demand, just using another internal, content-adressed storage model for the underlying data.</p>
<p>We are already using all that logic in other places, but I also have some code wiring this up to a HTTP server handler, so Nix clients would still be able to “download NAR files” even though we don’t need to store them as such.</p>
<p>If there’s interest to explore this idea further, maybe start ingesting some store paths and see how much dedup we get, and potentially write some fetch-through migration tool, I’d be happy to discuss this further.</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <p>This post was flagged by the community and is temporarily hidden.</p>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <p>I know one thing at the time, etc.</p>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          
<p>We already discussed migrating alternatives from GitHub, e.g. to Codeberg, IIRC, <a href="https://discourse.nixos.org/u/davidak">@davidak</a> explored it. It didn’t scale.</p>
<p>When we will have this situation, we will cross the bridge, I believe. For now, I imagine that GitHub has an incentive to provide us free services in exchange for a user base.</p>
<p>A bigger disaster would be Fastly <img src="https://discourse.nixos.org/images/emoji/twitter/stuck_out_tongue.png?v=10" title=":stuck_out_tongue:" alt=":stuck_out_tongue:"/>.</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discourse.nixos.org/u/ron"><span itemprop="name">ron</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2023-06-02T23:05:14Z">
                June 2, 2023, 11:05pm
              </time>
              <meta itemprop="dateModified" content="2023-06-02T23:05:14Z"/>
          <span itemprop="position">#16</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Small update, we are continuing to work on multiple communications thread with AWS to figure out if there is a possibility to receive further support on the topic.</p>
<p>Again, thank you to everyone that is getting involved! &lt;3</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>(Originally mentioned on matrix in a discussion with <a href="https://discourse.nixos.org/u/raitobezarius">@RaitoBezarius</a>)</p>
<p>Another consideration for the s3 migration would be to leverage AWS Snowball (<a href="https://aws.amazon.com/snowball/" rel="noopener nofollow ugc">AWS Snowball | Secure Edge Computing and Offline Data Transfer | Amazon Web Services</a>). It seems like it would help with the egress cost (~0.03/GB instead of ~0.09/GB) and not require the destination to have a large network pipe. Its essentially the modern version of a station wagon full of tapes.</p>
<p>Specs of the storage-optimized snowball (<a href="https://docs.aws.amazon.com/snowball/latest/developer-guide/sbe-specifications.html#specs-storage-optimized-v35s" rel="noopener nofollow ugc">AWS Snowball Edge Device Specifications - AWS Snowball Edge Developer Guide</a>) which we would need 2x of:</p>
<pre><code>Storage specifications:
NVME storage capacity 	210 TB usable (for object and NFS data transfer)

Dimensions and weight specifications:
Weight 	49.7 pounds (22.45 Kg)
Height 	15.5 inches (394 mm)
Width 	10.6 inches (265 mm)
Length 	28.3 inches (718 mm)
</code></pre>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discourse.nixos.org/u/uep"><span itemprop="name">uep</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2023-06-03T00:12:13Z">
                June 3, 2023, 12:12am
              </time>
              <meta itemprop="dateModified" content="2023-06-03T00:47:24Z"/>
          <span itemprop="position">#18</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>I like the confluence of the two points around garbage collection and deduplication. Both have a chance to recover (potentially rather large) total storage space.  Staging builds (and older builds from unstable, and a progressive list of others) are unlikely to ever be used, and could be garbage-collected. Lots of things deduplicate (and compress) well in an expanded store, as my own zfs-based instances demonstrate.</p>
<p>Storage provides like AWS undoubtedly use this for their own cost advantage, we should make sure we can take our own advantage of the data we understand best.</p>
<p>Doing either can get us some space back, and each can reduce the work needed for (or benefit available from) the other: stuff that deduplicates from a staging build was unchanged when that staging landed, for example.</p>
<p>The nice thing here is that despite this interaction, they’re not really in competition with each other, except perhaps in some ivory-tower view of wanting a perfect single solution. They can operate on different time-scales to provide practical benefit and shrink the problem to more manageable levels as things progress; we could collect some garbage now to reduce immediate storage costs and potential transfer/migration costs (and time) while more extensive storage format changes supporting dedup are developed and finalised. I can even imagine an approach where some of this historical data is archived off elsewhere for a while, gc’d from the expensive cache, and maybe reinjected again later.</p>
<p>Choosing which garbage to collect might be helped with some better data. We have a split of warm vs cold storage already, I assume that’s based on S3’s automatic migration, and it holds some clues (but there are caches in front, so regularly-used items might not get S3 activity). Do we have stats on what items are hit from Fastly, and a way to turn that into a view of which closures are pulling things in?</p>
<p>What is the actual value of historical builds, in the abstract (assuming we can identify and exclude particular items that are in current use for various accidental or deliberate reasons)?</p>
<p>There are a lot of more extensive changes along these lines that can benefit everyone, applying similar benefits to local stores and network transfers, as has been discussed before.  Because of that, though, they will take longer, even if this situation gives some impetus to revive the effort. What happened to the content-addressible store work, for example?</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://discourse.nixos.org/u/jtolio"><span itemprop="name">jtolio</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2023-06-03T04:00:17Z">
                June 3, 2023,  4:00am
              </time>
              <meta itemprop="dateModified" content="2023-06-03T04:10:47Z"/>
          <span itemprop="position">#19</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Hey friends! Nix user and Chief Strategy Officer of <a href="https://www.storj.io/" rel="noopener nofollow ugc">Storj</a> here. We’re somewhat like BitTorrent meets S3.</p>
<p>Storj is S3 compatible $4/TB/mo and $7/TB egress. This isn’t $0/TB egress of course, but might perhaps be a long-term sustainable option.</p>
<p>Migrations from S3 are free (via our partnership with <a href="https://www.cloudflyer.io/" rel="noopener nofollow ugc">https://www.cloudflyer.io/</a>, see their site for details). Even though we are decentralized storage, there isn’t any funny business with new protocols or challenging technical adoption. We work with any S3 or HTTP clients.</p>
<p>We have 20,000 global points of presence, so you don’t have to worry about multiregion replication or content delivery. We handle that for you as part of the base product.</p>
<p>We are open source and would love to help support the Nix community. Could we help here?</p>
        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>Telnyx has an S3 compatible service. No egress fees and storage costs looks to be right at $1k a month for 425GB (Ignoring the contact us for better pricing button.)</p>
<p>Caveat. I know very little about the details on it. We have had great luck with using them for VOIP service but I have never looked into using their storage service.</p>

        </div>

        <meta itemprop="headline" content="The NixOS Foundation&#39;s Call to Action: S3 Costs Require Community Support"/>

        

         

      </div>






    </div></div>
  </body>
</html>
