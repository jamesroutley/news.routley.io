<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.neowin.net/news/kde-plasma-prepares-crackdown-on-focus-stealing-window-behavior-under-wayland/">Original</a>
    <h1>KDE Plasma prepares crackdown on focus-stealing window behavior under Wayland</h1>
    
    <div id="readability-page-1" class="page"><div itemprop="articleBody">
                                                                        <p><img alt="KDE Plasma" src="https://cdn.neowin.com/news/images/uploaded/2025/06/1750516218_kde-plasma-2.webp"/></p>

<p>One of the most <a href="https://www.neowin.net/news/kde-is-fixing-blurry-screens-by-snapping-almost-1x-scale-factors-back-to-1x-on-wayland/">interesting things about Wayland</a> is how it handles window focus, unlike X11, where focus stealing can be frustrating and even a security risk. Its main advantage is a mechanism that prevents focus stealing. The protocol that plays a role in this is known as &#34;XDG Activation.&#34;</p>

<p>Here&#39;s how it works: Say you double-click a PDF file in your file manager. The file manager first asks the Wayland compositor for a special, single-use &#34;activation token&#34;. This request is tied directly to your click, proving a human wanted this to happen.</p>

<p>The file manager then launches your PDF viewer and hands it the token. The PDF viewer, upon starting, shows this token to the compositor and asks to be activated. The compositor checks if the token is legit and, if so, gives the PDF viewer focus.</p>

                            <!-- PLACE THIS SECTION INSIDE OF YOUR BODY WHERE YOU WANT THE VIDEO PLAYER TO RENDER -->
            <p>If the token is missing, old, or otherwise invalid, the compositor says no. The viewer window will not get focus, and instead, its icon in the taskbar will start flashing to grab your attention.</p>

<figure><a href="https://cdn.neowin.com/news/images/uploaded/2025/08/1754304760_bildschirmfoto_20250731_143103-1024x740.webp"><img alt="KWrite text editor window window has no focus colors are softened Task bar with a couple of apps KWrite icon has an orange background behind it indicating KWrite is demanding attention" height="740" src="https://cdn.neowin.com/news/images/uploaded/2025/08/1754304760_bildschirmfoto_20250731_143103-1024x740.webp" width="1024"/></a>

<figcaption>Flashing icon in the taskbar | Image: <a href="https://blog.broulik.de/2025/08/on-window-activation/">Kai-Uwe Broulik</a></figcaption></figure><p>Kai-Uwe Broulik, a KDE developer, recently wrote about the plan to &#34;switch on KWinâ€™s focus stealing on Wayland at a low level&#34;. This means KWin, the window manager for KDE Plasma, will begin enforcing this properly.</p>

<p>Under X11, new or dialog windows can only grab focus if their application was most recently active, a check often based on a timestamp called <code>_NET_WM_USER_TIME</code>. It was a flimsy system at best. For example, Kai cited how the prevention logic on X11 would sometimes stop the Adobe Flash Player fullscreen window from showing on top of a YouTube video. On X11, an application could just call <strong><code>XSetInputFocus</code></strong> on another app&#39;s window, and while KWin would try to undo it, focus did flicker for a moment.</p>

<p>Over on Wayland, things are much better with XDG Activation, but some apps still violate the protocol through improper usage. In situations like that, KWin would, by default, just focus any new window that opened. This is changing.</p>

<p>A new &#34;Extreme&#34; setting for &#34;Focus Stealing Prevention&#34; in the Window Management settings will force KWin to activate a window if and only if it requests activation with a valid token.</p>

<figure><a href="https://cdn.neowin.com/news/images/uploaded/2025/08/1754304876_screenshot_20250802_100046-1024x658.webp"><img alt="Window Behavior configuration dialog various window-related tabs and options mouse cursor pointing at a combo box Focus stealing prevention whose current item is Extreme" height="658" src="https://cdn.neowin.com/news/images/uploaded/2025/08/1754304876_screenshot_20250802_100046-1024x658.webp" width="1024"/></a>

<figcaption>Image: <a href="https://blog.broulik.de/2025/08/on-window-activation/">Kai-Uwe Broulik</a></figcaption></figure><p>Using this stricter mode, developers Xaver Hugl and Kai-Uwe Broulik have already fixed a ton of issues, introducing several key changes:</p>

<ul>
<li>Dolphin no longer discards its activation token when launching a new instance.</li>
	<li>KRunner, Kickoff, and other Plasmoid popups now correctly request activation.</li>
	<li>LayerShell-Qt now requests activation on show and properly reads the <strong><code>XDG_ACTIVATION_TOKEN</code></strong> from the environment.</li>
	<li>Allowing privileged clients like Plasma to request tokens correctly.</li>
	<li>Ignoring modifier key presses for focus prevention logic, since they are often part of a global shortcut.</li>
</ul>
<p>The work extends to the backend as well, with the DBusRunner specification now gaining a <code>SetActivationToken</code> method that is called just before an action runs. Baloo, the desktop search runner, now uses this to ensure that opening files in an existing application window works correctly.</p>

<p>You can learn more on <a href="https://blog.broulik.de/2025/08/on-window-activation/">Kai&#39;s blog post.</a></p>
                        
                        
                                                                    </div></div>
  </body>
</html>
