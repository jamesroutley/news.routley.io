<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.trickster.dev/post/lesser-known-parts-of-python-standard-library/">Original</a>
    <h1>Lesser known parts of Python standard library</h1>
    
    <div id="readability-page-1" class="page"><div class="page">

            

            <section>
    
    <div>
        <p>In this article we will explore some lesser known, but interesting and useful
corners of Python standard library.</p>
<hr/>
<p>Python dictionaries and lists are bread and butter for many applications, but
might be too simple for more advanced data organisation. To provide more
powerful containers for storing data in memory Python ships a <code>collection</code>
module with things like:</p>
<ul>
<li>Deque - list-like data structure for efficient insertion and removal of items
from either end.</li>
<li>Counter - subclass of dictionary to count stuff.</li>
<li><code>ChainMap</code> - meta-dictionary that provides unified key-value mapping across
multiple dictionaries without copying the data.</li>
<li>Advanced structures for data mappings:
<ul>
<li><code>OrderedDict</code> - dictionary that maintains order of key-value pairs (e.g. when
HTTP header value matters for dealing with certain security mechanisms).</li>
<li><code>namedtuple</code> - a factory function that creates a subclass of tuple with named
fields. Could be convenient for more OOP approach than just using <code>dict</code>.</li>
<li><code>defaultdict</code> - dictionary with some or all or the values pre-filled. Could
be handy when you want to provide values for fields that may be missing
in web pages being scraped.</li>
</ul>
</li>
<li><code>UserDict</code>, <code>UserList</code> and <code>UserString</code> - wrappers for <code>dict</code>, <code>list</code> and <code>str</code>
for further subclassing.</li>
</ul>
<p>API reference: <a href="https://docs.python.org/3/library/collections.html">https://docs.python.org/3/library/collections.html</a></p>
<hr/>
<p>Python has <code>with</code> keyword to create context manager that will auto-cleanup
things within lexical scope. For example, you don’t have to worry about closing
a file yourself if you open it like this:</p>
<div><pre tabindex="0"><code data-lang="python"><span><span><span>with</span> open(<span>&#34;results.txt&#34;</span>, <span>&#34;w&#34;</span>) <span>as</span> out_f:
</span></span><span><span>    out_f<span>.</span>write(<span>&#34;...</span><span>\n</span><span>&#34;</span>)
</span></span><span><span>    <span>...</span>
</span></span></code></pre></div><p><code>contextlib</code> module provide helpers to work with context managers in your code.
For example, you can use <code>@contextmanager</code> annotation to turn your own function
into one that could be used via <code>with</code> syntax.</p>
<p>API reference: <a href="https://docs.python.org/3/library/contextlib.html">https://docs.python.org/3/library/contextlib.html</a></p>
<hr/>
<p>Due to technical reality of how floating point number are represented,
floating point computations can have some weird results:</p>
<pre tabindex="0"><code>&gt;&gt;&gt; 0.1 + 0.1 + 0.1 - 0.3
5.551115123125783e-17
&gt;&gt;&gt; 1.2 + 2.2
3.4000000000000004
</code></pre><p>This is mathematically incorrect and a deal breaker for some applications, such
as those dealing with money. To address this problem, Python ships <code>decimal</code>
module that allows us represent decimal numbers as Python objects with operator
overloading. Computations are adjusted so that we get we get the correct result
(within a configurable level of precision):</p>
<pre tabindex="0"><code>&gt;&gt;&gt; from decimal import *
&gt;&gt;&gt; one_point_two = Decimal(&#39;1.2&#39;)
&gt;&gt;&gt; one_point_two
Decimal(&#39;1.2&#39;)
&gt;&gt;&gt; two_point_two = Decimal(&#39;2.2&#39;)
&gt;&gt;&gt; two_point_two
Decimal(&#39;2.2&#39;)
&gt;&gt;&gt; one_point_two + two_point_two
Decimal(&#39;3.4&#39;)
</code></pre><p>API reference: <a href="https://docs.python.org/3/library/decimal.html">https://docs.python.org/3/library/decimal.html</a></p>
<hr/>
<p>Likewise, we can run into problem when dealing with fractions - one third is
not exactly equal to 0.333… Python ships with <code>fractions</code> module to represent
them as Python objects with operator overloading:</p>
<pre tabindex="0"><code>&gt;&gt;&gt; import fractions
&gt;&gt;&gt; one_third = fractions.Fraction(numerator=1, denominator=3)
&gt;&gt;&gt; 2 * one_third
Fraction(2, 3)
</code></pre><p>API reference: <a href="https://docs.python.org/3/library/fractions.html">https://docs.python.org/3/library/fractions.html</a></p>
<hr/>
<p>Python interpreter is implemented as <a href="https://en.wikipedia.org/wiki/Stack_machine">stack machine</a>
internally. When you run some Python code it is compiled to Python-specific
bytecode that Python VM executes. For debugging or performance optimisation
purposes it might be desirable to disassemble Python bytecode into instruction.
The standard Python installation ships with <code>dis</code> module that takes Python
code units (e.g. a function) and disassembles the code into a kind of
pseudo-assembler:</p>
<pre tabindex="0"><code>&gt;&gt;&gt; import dis
&gt;&gt;&gt; def add(a, b):
...     return a+b
... 
&gt;&gt;&gt; dis.dis(add)
  1           0 RESUME                   0

  2           2 LOAD_FAST                0 (a)
              4 LOAD_FAST                1 (b)
              6 BINARY_OP                0 (+)
             10 RETURN_VALUE
</code></pre><p>API reference: <a href="https://docs.python.org/3/library/dis.html">https://docs.python.org/3/library/dis.html</a></p>
<hr/>
<p>Python <code>statistics</code> module provides a small toolkit of statistical algorithms
for relatively simple applications where it is an overkill to use Pandas or
Numpy: standard deviation, several kinds of average of numeric data, linear
regression, correlation, normal distribution and others. For people eager to
join the AI/ML revolution it provides Naive Bayes classifier - an algorithm
that can be considered a minimum viable example of machine learning.</p>
<p>API reference: <a href="https://docs.python.org/3/library/statistics.html">https://docs.python.org/3/library/statistics.html</a></p>
<hr/>
<p>You may sometimes want to open web browser from your Python code. Since Python
is portable and multiplatform language this may be bit of hassle due to
differences between platforms and setups. To make this easier Python ships a
<code>webbrowser</code> module with simple API to make a browser show a page. For example,
we can call <code>open_new()</code> function with URL:</p>
<pre tabindex="0"><code>&gt;&gt;&gt; import webbrowser
&gt;&gt;&gt; webbrowser.open_new(&#39;https://trickster.dev&#39;)
True
</code></pre><p>If you want to open a local file (e.g. HTML report with results of some
automation) you need to pass a file URL to one of the functions:</p>
<pre tabindex="0"><code>&gt;&gt;&gt; import os
&gt;&gt;&gt; file_url = &#39;file://&#39; + os.path.realpath(&#39;test.html&#39;)
&gt;&gt;&gt; webbrowser.open(file_url)
True
</code></pre><p>API reference: <a href="https://docs.python.org/3/library/webbrowser.html">https://docs.python.org/3/library/webbrowser.html</a></p>
<hr/>
<p>Distributing Python programs in source code form can be problematic if there’s
some non-technical users at the receiving end. Even if they have Python installed
there can be lacking dependencies, version conflicts and other runtime issues.
To make this less terrible Python ships <code>zipapp</code> module with CLI tool and Python
API to package Python code into single file packages. This provides an interesting
midpoint between using virtual environments and solutions like PyInstaller to
compile the app into platform-specific form - code remains portable, but
Python interpreter has to be there to run it.</p>
<p>API reference: <a href="https://docs.python.org/3/library/zipapp.html">https://docs.python.org/3/library/zipapp.html</a></p>

    </div>
    

            </section>

            <section>
                <div>
<div>
    

<p>Code level discussion of web scraping, gray hat automation, growth hacking and bounty hunting</p>
</div>



</div>
                <hr/>
                <p>
            By rl1987, 
            2024-08-19
        </p>
            </section>

            

        </div></div>
  </body>
</html>
