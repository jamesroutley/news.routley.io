<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://simonwillison.net/2024/Aug/24/pipe-syntax-in-sql/">Original</a>
    <h1>Google&#39;s new pipe syntax in SQL</h1>
    
    <div id="readability-page-1" class="page"><div>


<p><strong><a href="https://research.google/pubs/sql-has-problems-we-can-fix-them-pipe-syntax-in-sql/">SQL Has Problems. We Can Fix Them: Pipe Syntax In SQL</a></strong> (<a href="https://news.ycombinator.com/item?id=41338877" title="Hacker News">via</a>) A new paper from Google Research describing custom syntax for analytical SQL queries that has been rolling out inside Google since February, reaching 1,600 &#34;seven-day-active users&#34; by August 2024.</p>
<p>A key idea is here is to fix one of the biggest usability problems with standard SQL: the order of the clauses in a query. Starting with <code>SELECT</code> instead of <code>FROM</code> has always been confusing, see <a href="https://jvns.ca/blog/2019/10/03/sql-queries-don-t-start-with-select/">SQL queries don&#39;t start with SELECT</a> by Julia Evans.</p>
<p>Here&#39;s an example of the new alternative syntax, taken from the <a href="https://github.com/google/zetasql/blob/2024.08.2/docs/pipe-syntax.md">Pipe query syntax documentation</a> that was added to Google&#39;s open source <a href="https://github.com/google/zetasql">ZetaSQL</a> project last week.</p>
<p>For this SQL query:</p>
<div><pre><span>SELECT</span> component_id, <span>COUNT</span>(<span>*</span>)
<span>FROM</span> ticketing_system_table
<span>WHERE</span>
  <span>assignee_user</span>.<span>email</span> <span>=</span> <span><span>&#39;</span>username@email.com<span>&#39;</span></span>
  <span>AND</span> status <span>IN</span> (<span><span>&#39;</span>NEW<span>&#39;</span></span>, <span><span>&#39;</span>ASSIGNED<span>&#39;</span></span>, <span><span>&#39;</span>ACCEPTED<span>&#39;</span></span>)
<span>GROUP BY</span> component_id
<span>ORDER BY</span> component_id <span>DESC</span>;</pre></div>

<p>The Pipe query alternative would look like this:</p>
<pre><code>FROM ticketing_system_table
|&gt; WHERE
    assignee_user.email = &#39;username@email.com&#39;
    AND status IN (&#39;NEW&#39;, &#39;ASSIGNED&#39;, &#39;ACCEPTED&#39;)
|&gt; AGGREGATE COUNT(*)
   GROUP AND ORDER BY component_id DESC;
</code></pre>

<p>The Google Research paper is released as a two-column PDF. I <a href="https://news.ycombinator.com/item?id=41339138">snarked about this</a> on Hacker News: </p>
<blockquote>
<p>Google: you are a web company. Please learn to publish your research papers as web pages.</p>
</blockquote>
<p>This remains a long-standing pet peeve of mine. PDFs like this are horrible to read on mobile phones, hard to copy-and-paste from, have poor accessibility (see <a href="https://fedi.simonwillison.net/@simon/113017908957136345">this Mastodon conversation</a>) and are generally just <em>bad citizens</em> of the web.</p>
<p>Having complained about this I felt compelled to see if I could address it myself. Google&#39;s own Gemini Pro 1.5 model can process PDFs, so I uploaded the PDF to <a href="https://aistudio.google.com/">Google AI Studio</a> and prompted the <code>gemini-1.5-pro-exp-0801</code> model like this:</p>
<blockquote>
<p>Convert this document to neatly styled semantic HTML</p>
</blockquote>
<p>This worked <em>surprisingly well</em>. It output HTML for about half the document and then stopped, presumably hitting the output length limit, but a follow-up prompt of &#34;and the rest&#34; caused it to continue from where it stopped and run until the end.</p>
<p>Here&#39;s the result (with a banner I added at the top explaining that it&#39;s a conversion): <a href="https://static.simonwillison.net/static/2024/Pipe-Syntax-In-SQL.html">Pipe-Syntax-In-SQL.html</a></p>
<p>I haven&#39;t compared the two completely, so I can&#39;t guarantee there are no omissions or mistakes.</p>
<p>The figures from the PDF aren&#39;t present - Gemini Pro output tags like <code>&lt;img src=&#34;figure1.png&#34; alt=&#34;Figure 1: SQL syntactic clause order doesn&#39;t match semantic evaluation order. (From [25].)&#34;&gt;</code> but did nothing to help me create those images.</p>
<p>Amusingly the document ends with <code>&lt;p&gt;(A long list of references, which I won&#39;t reproduce here to save space.)&lt;/p&gt;</code> rather than actually including the references from the paper!</p>
<p>So this isn&#39;t a perfect solution, but considering it took just the first prompt I could think of it&#39;s a very promising start. I expect someone willing to spend more than the couple of minutes I invested in this could produce a very useful HTML alternative version of the paper with the assistance of Gemini Pro.</p>
<p>One last amusing note: I posted a link to this <a href="https://news.ycombinator.com/item?id=41339238">to Hacker News</a> a few hours ago. Just now when I searched Google for the exact title of the paper my HTML version was already the third result!</p>
<p>I&#39;ve now added a <code>&lt;meta name=&#34;robots&#34; content=&#34;noindex, follow&#34;&gt;</code> tag to the top of the HTML to keep this unverified <a href="https://simonwillison.net/tags/slop/">AI slop</a> out of their search index. This is a good reminder of how much better HTML is than PDF for sharing information on the web!</p>



</div></div>
  </body>
</html>
