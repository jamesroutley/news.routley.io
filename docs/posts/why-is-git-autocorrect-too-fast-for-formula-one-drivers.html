<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.gitbutler.com/why-is-git-autocorrect-too-fast-for-formula-one-drivers/">Original</a>
    <h1>Why is Git Autocorrect too fast for Formula One drivers?</h1>
    
    <div id="readability-page-1" class="page"><article>
	
	<div>
		<p>A while ago, I happened to see <a href="https://x.com/dhh/status/1853955671647260806?ref=blog.gitbutler.com" rel="noreferrer">a tweet</a> from <a href="https://x.com/dhh?ref=blog.gitbutler.com" rel="noreferrer">@dhh</a> where he mistyped a Git command as <code>git pushy</code> and was surprised to notice that Git figured out that he probably meant <code>git push</code> and then gave him <em>0.1 seconds</em> to verify if that&#39;s what he wanted to run before it ran it anyways.</p><figure><a href="https://x.com/dhh/status/1853955671647260806?ref=blog.gitbutler.com"><img src="https://blog.gitbutler.com/content/images/2025/01/CleanShot-2025-01-08-at-11.28.23@2x.png" alt="" loading="lazy" width="1178" height="796" srcset="https://blog.gitbutler.com/content/images/size/w600/2025/01/CleanShot-2025-01-08-at-11.28.23@2x.png 600w, https://blog.gitbutler.com/content/images/size/w1000/2025/01/CleanShot-2025-01-08-at-11.28.23@2x.png 1000w, https://blog.gitbutler.com/content/images/2025/01/CleanShot-2025-01-08-at-11.28.23@2x.png 1178w" sizes="(min-width: 720px) 720px"/></a></figure><h2 id="100-milliseconds">100 milliseconds?</h2><p>As David is a semi-professional <a href="https://x.com/dhhracing?ref=blog.gitbutler.com" rel="noreferrer">race car driver</a> in addition to being a fellow Ruby programming nerd, he naturally noticed that the amount of time that Git afforded him to react was impossible for even Formula One drivers.</p><p>Of course this seems like a ludicrous bit of Git functionality, but I figured if this was surprising to David, you too might wonder why Git gave him (and possibly gives you) about the length of time that it takes a human eye to blink in order to:</p><ul><li>read a sentence</li><li>determine if it&#39;s correct</li><li>attempt to cancel the command</li></ul><p>What could possibly be the reason to wait <em>100ms</em>? So little time is essentially equivalent to simply running the command.</p><p>Well, it&#39;s a combination of a misunderstanding, a misconfiguration, and the suggestion, 17 years ago, of a somewhat questionable unit of time by the Git maintainer himself.</p><h2 id="how-was-this-designed-to-work">How was this designed to work?</h2><p>It&#39;s important to note that this is <em>not</em> the default functionality of Git.</p><p>The <em>default</em> response to typing a command that doesn&#39;t exist is to simply not run anything, figure out which commands you might have meant by string similarity and then just exit. </p><p>If most of you type <code>git pushy</code>, you&#39;ll probably get this instead:</p><pre><code>❯ git pushy
git: &#39;pushy&#39; is not a git command. See &#39;git --help&#39;.

The most similar command is
        push</code></pre><p>Originally, if you typed an unknown command, it would just say &#34;this is not a git command&#34;. Then in 2008, Johannes Schindelin (somewhat jokingly) introduced a <a href="https://public-inbox.org/git/alpine.DEB.1.00.0807222100150.8986@racer/?ref=blog.gitbutler.com" rel="noreferrer">small patch</a> to go through all the known commands, show you what is most similar to what you typed and if there is only one closely matching, simply run it.</p><p>Then Alex Riesen introduced <a href="https://public-inbox.org/git/20080722210354.GD5113@blimp.local/?ref=blog.gitbutler.com" rel="noreferrer">a patch</a> to make it configurable via the <code>help.autocorrect</code> setting. In this initial patch, this setting was simply a boolean. </p><p>Since Git config settings that expect a boolean will interpret a <code>1</code> value as <code>true</code>, you could originally set <code>help.autocorrect</code> to <code>1</code> to have it automatically run the corrected command rather than just tell you what is similar.</p><p>As part of the conversation around this patch, Junio Hamano, to this day the Git maintainer, <a href="https://public-inbox.org/git/7vsku1jz4u.fsf@gitster.siamese.dyndns.org/?ref=blog.gitbutler.com">suggested</a>:</p><pre><code>Please make autocorrect not a binary but optionally the number of
deciseconds before it continues, so that I have a chance to hit ^C ;-)</code></pre><p>Which was what the setting value was changed to in the patch that was eventually accepted. This means that setting <code>help.autocorrect</code> to <code>1</code> logically means &#34;wait 100ms (1 decisecond) before continuing&#34;.</p><p>Now, why Junio thought <em>deciseconds</em> was a reasonable unit of time measurement for this is never discussed, so I don&#39;t really know why that is. Perhaps 1 full second felt too long so he wanted to be able to set it to half a second? We may never know. All we truly know is that this has never made sense to anyone ever since.</p><p><em>So</em>, the reason why it waits 100ms for David is that at some point he presumably learned about this setting, quite reasonably assumed that it was a boolean and set it to what Git config also generally considers to be a &#39;true&#39; value in order to enable it:</p><pre><code>❯ git config --global help.autocorrect 1</code></pre><p>Not understanding that in this context, this means &#34;wait 1 decisecond, then do whatever you think is best&#34; rather than &#34;please turn this feature on&#34;.</p><h2 id="what-should-it-be-set-to">What <em>should</em> it be set to?</h2><p>So, clearly you can set it to <code>10</code> for a full second or whatever. However, over the years, this setting has gathered a few other options that it will recognize. </p><p>According to the <a href="https://git-scm.com/docs/git-config?ref=blog.gitbutler.com#Documentation/git-config.txt-helpautoCorrect" rel="noreferrer">documentation</a>, here are the values it can be set to:</p><ul><li>0 (default): show the suggested command.</li><li>positive number: run the suggested command after specified deciseconds (0.1 sec).</li><li>&#34;immediate&#34;: run the suggested command immediately.</li><li>&#34;prompt&#34;: show the suggestion and prompt for confirmation to run the command.</li><li>&#34;never&#34;: don’t run or show any suggested command.</li></ul><p>Honestly, &#34;prompt&#34; is probably what most people would find the most reasonable, rather than a specific amount of time to wait for you to cancel the command.</p><p>If you <em>do</em> want to have it prompt you, you can run this:</p><pre><code>❯ git config --global help.autocorrect prompt

❯ git pushy
WARNING: You called a Git command named &#39;pushy&#39;, which does not exist.
Run &#39;push&#39; instead [y/N]?</code></pre><h2 id="how-does-it-guess">How does it guess?</h2><p>To keep picking on David, he followed up after doing some quick testing to see what the logic could be and it turns out that Git won&#39;t just take wild guesses. </p><p>There is a point where it will simply assume you&#39;re way off and not guess anything:</p><figure><a href="https://x.com/dhh/status/1853957115880378764?ref=blog.gitbutler.com"><img src="https://blog.gitbutler.com/content/images/2025/01/CleanShot-2025-01-08-at-14.36.04@2x.png" alt="" loading="lazy" width="880" height="400" srcset="https://blog.gitbutler.com/content/images/size/w600/2025/01/CleanShot-2025-01-08-at-14.36.04@2x.png 600w, https://blog.gitbutler.com/content/images/2025/01/CleanShot-2025-01-08-at-14.36.04@2x.png 880w" sizes="(min-width: 720px) 720px"/></a></figure><p>However, it&#39;s interesting to play around with this a bit:</p><pre><code>❯ git bass
WARNING: You called a Git command named &#39;bass&#39;, which does not exist.
Run &#39;rebase&#39; instead [y/N]? n

❯ git bassa
git: &#39;bassa&#39; is not a git command. See &#39;git --help&#39;.

❯ git dm
git: &#39;dm&#39; is not a git command. See &#39;git --help&#39;.

The most similar commands are
        am
        rm

❯ git dma
WARNING: You called a Git command named &#39;dma&#39;, which does not exist.
Run &#39;am&#39; instead [y/N]?</code></pre><p>So, <code>git bass</code> is close enough to <code>rebase</code> for it to guess that this could be what you mean. But <code>bassa</code> is not close enough for it to <em>still</em> think you maybe meant <code>rebase</code>.</p><p>Also, <code>git dm</code> could mean <code>am</code> or <code>rm</code>, but interestingly it matches on the end of the string and not necessarily from the beginning. Also, <code>dma</code> confidently matches <code>am</code> <em>only</em>.</p><p>So how is this working? </p><p>As some of you may have guessed, it&#39;s based on a fairly simple, modified Levenshtein distance algorithm - which is basically a way to figure out how expensive it is to change one string into a second string given single character edits, with some operations being more expensive than others. </p><p>It has a hard coded cutoff, so once it&#39;s too expensive for any of the known commands, it just assumes you really messed up, which is why some of these don&#39;t match anything and others, even though quite different, match several options.</p><h2 id="my-little-fix">My little fix</h2><p>In going through a bunch of the related autocorrect Git code in order to research this little blog post, I realized that there could be a relatively simple and largely backwards compatible fix. </p><p>Since a <code>1</code> value is so fast, it&#39;s in all human terms functionally equivalent to &#34;immediately&#34;, I wrote up a <a href="https://lore.kernel.org/git/09e516e7-37a5-4489-a30b-f26dd2462fc3@revi.email/T/?ref=blog.gitbutler.com#t" rel="noreferrer">small patch</a> to interpret a <code>1</code> as &#34;immediately&#34; rather than &#34;wait 100ms&#34;.</p><p>Junio came back to request that instead of special casing the &#34;1&#34; string, we should properly interpret any boolean string value (so &#34;yes&#34;, &#34;no&#34;, &#34;true&#34;, &#34;off&#34;, etc), so version two of my patch is currently in flight to additionally do that. </p><p>If I can get this landed, maybe future versions of Git will no longer test the mettle of Formula One drivers.</p><p>Anyhow, hope you enjoyed that little trip down this old alley of seemingly strange Git functionality. As is often the case with Git, there is some hidden method to the apparent madness, and like any open source project, there is a path to make it slightly better!</p>
			</div>
</article></div>
  </body>
</html>
