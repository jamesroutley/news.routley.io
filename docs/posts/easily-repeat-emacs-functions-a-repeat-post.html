<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://zck.org/emacs-repeat-mode-emacs-repeat-mode">Original</a>
    <h1>Easily repeat Emacs functions: a repeat post</h1>
    
    <div id="readability-page-1" class="page"><div>
    <p>Remember transient maps?</p>

    <p>I posted about them all the way <a href="https://zck.org/emacs-repeat-emacs-repeat">back in 2016</a>. Transient maps let you temporarily add a keymap that is active only for a single keypress. So you can easily do things like repeating commands, or having similar commands easier to call one after another.</p>

    <p>Well, times have changed.</p>

    <p>In 2022, Emacs 28.1 was released. This release added repeat mode, a piece of functionality that&#39;s similar to transient maps. Like transient maps, repeat mode allows for different actions to be triggered by keypresses after a function is called. Unlike transient maps, repeat mode works without modifying the source of the function being acted on.</p>

    <p>But repeat mode is not explained well.</p>

    <p>Like the name suggests, it lets you easily repeat commands, similarly to <code>C-x z</code> (<code>#&#39;repeat</code>). If that were all it does, repeat mode would still be useful. Luckily, there&#39;s more to repeat mode than repeating.</p>

    <p>Hrm. Maybe even the <em>name</em> is confusing.</p>
</div><div>
    <h2>Using repeat mode</h2>
    <div>
        <p>Enable it with <code>(repeat-mode 1)</code>. This will enable repeat mode on all functions with a repeat map.</p>

        <p>Now, every time a command is called, Emacs will look at the <code>&#39;repeat-map</code> property on that specific function for a keymap. If there&#39;s a keymap, Emacs will bind it as a transient map.</p>

        <p>To use it, add a thing with <code>(put #&#39;function-name &#39;repeat-map &#39;keymap-name)</code></p>

        <p>If you look carefully, you&#39;ll notice that I lied before. There isn&#39;t a <em>keymap</em> as the property; thre&#39;s a <em>symbol</em>. That is, the keymap name is quoted. It can&#39;t directly be a function, like a <code>make-keymap</code> call. Instead, make a variable and set its value to the desired keymap, like <code>(defvar my-example-repeat-map (define-keymap &#34;h&#34; #&#39;function-to-repeat))</code>.</p>

        <p>I suspect this is to encourage variable use, to be able to add and remove bindings from the keymap after it&#39;s added to the function. But that&#39;s just a guess.</p>
    </div>
</div></div>
  </body>
</html>
