<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/Hafthor/zsvutil">Original</a>
    <h1>Show HN: ZSV (Zip Separated Values) columnar data format</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">A utility for converting TSV files from/to ZSV files.</p>


<p dir="auto">ZSV (ZIP Separated Values) is a columnar data storage format with features
similar to <a href="https://parquet.apache.org" rel="nofollow">Parquet</a>, <a href="https://orc.apache.org" rel="nofollow">Orc</a>
or <a href="https://avro.apache.org" rel="nofollow">Avro</a>, however, it is built upon the simple
technologies of
<a href="https://en.wikipedia.org/wiki/Tab-separated_values" rel="nofollow">TSV (tab separated values)</a>
and <a href="https://en.wikipedia.org/wiki/ZIP_(file_format)" rel="nofollow">ZIP</a>, making it easy to
understand, create and consume, but still provide the query performance
characteristics of a modern columnar store format.</p>

<ul dir="auto">
<li>Be simple</li>
<li>Prefer mature, widely available technologies</li>
<li>Favor human readability</li>
<li>Be easy to parse and generate</li>
<li>Be efficient for simple tabular data</li>
<li>Prefer longevity over novelty</li>
</ul>

<p dir="auto">Given an original source, <strong>products.tsv</strong>, zsvutil import creates a
<strong>products.zsv</strong> file that is just a .zip file with a file inside for each
column, for example, SKU, Description and Price. Inside those files is just the
TSV for that column, compressed.</p>

<div dir="auto"><h3 tabindex="-1" dir="auto">Why is ZSV built on ZIP file format? Why not use .targz?</h3><a id="user-content-why-is-zsv-built-on-zip-file-format-why-not-use-targz" aria-label="Permalink: Why is ZSV built on ZIP file format? Why not use .targz?" href="#why-is-zsv-built-on-zip-file-format-why-not-use-targz"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">ZIP is a widely available, mature technology that is easy to use and has
built-in support in many languages and platforms. .targz is a single gzip
stream of a tar file, which is a collection of files. This makes it
effectively impossible to seek to a specific file without reading and
decompressing the whole stream up to that file. ZIP files are a collection of
individually compressed files, with a directory as a footer to the file, which
makes it easy to seek to a specific file without reading the whole file.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Why is ZSV built on TSV format? Why not CSV? Why not JSON?</h3><a id="user-content-why-is-zsv-built-on-tsv-format-why-not-csv-why-not-json" aria-label="Permalink: Why is ZSV built on TSV format? Why not CSV? Why not JSON?" href="#why-is-zsv-built-on-tsv-format-why-not-csv-why-not-json"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">TSV is a simple, human-readable format that is easy to understand and
manipulate. It is also trivial to parse and generate. CSV is also a good
choice, but it is more complex than TSV, with quoting and escaping rules
that can be confusing, ambiguous and inconsistent. JSON is a good format
for nested data, but it is not as easy to read or write as TSV. JSON is
also not as efficient as TSV for simple tabular data.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">What are some key shortcomings of ZSV?</h3><a id="user-content-what-are-some-key-shortcomings-of-zsv" aria-label="Permalink: What are some key shortcomings of ZSV?" href="#what-are-some-key-shortcomings-of-zsv"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">ZSV is not a good choice for binary or unstructured textual data. The main
limitation is that the data in the columns must not include the tab character
<code>⇥</code> or newline character <code>⮐</code>. This is a limitation of the TSV format. Any
escaping or encoding of these characters would make the format less
human-readable, harder to parse and could introduce ambiguity and consistency
problems.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">How well is ZSV supported by tools and platforms?</h3><a id="user-content-how-well-is-zsv-supported-by-tools-and-platforms" aria-label="Permalink: How well is ZSV supported by tools and platforms?" href="#how-well-is-zsv-supported-by-tools-and-platforms"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Today ZSV is not widely supported by tools and platforms, but it is easy to
convert between TSV and ZSV using zsvutil. It should be relatively easy to add
support for ZSV to any tool that supports columnar data formats.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">What is an ideal use case for ZSV?</h3><a id="user-content-what-is-an-ideal-use-case-for-zsv" aria-label="Permalink: What is an ideal use case for ZSV?" href="#what-is-an-ideal-use-case-for-zsv"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you are currently using TSV files and want to improve query performance
without changing your data format, ZSV is a good choice.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Simple Columnar Storage Example</h2><a id="user-content-simple-columnar-storage-example" aria-label="Permalink: Simple Columnar Storage Example" href="#simple-columnar-storage-example"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Given <strong>products.tsv</strong> with a header line</p>
<table>
<thead>
<tr>
<th><code>SKU⇥</code></th>
<th><code>Description⇥</code></th>
<th><code>Price⇥</code></th>
<th><code>Region⮐</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AA⇥</code></td>
<td><code>Item AA⇥</code></td>
<td><code>111.11⇥</code></td>
<td><code>US⮐</code></td>
</tr>
<tr>
<td><code>BB⇥</code></td>
<td><code>Item BB⇥</code></td>
<td><code>222.22⇥</code></td>
<td><code>US⮐</code></td>
</tr>
<tr>
<td><code>CC⇥</code></td>
<td><code>Item CC⇥</code></td>
<td><code>333.33⇥</code></td>
<td><code>US⮐</code></td>
</tr>
</tbody>
</table>
<p dir="auto">we would have a ZIP file products.zsv with the files SKU, Description and Price
inside. Each file would have just that column&#39;s data.</p>
<p dir="auto">Note that column names MUST be allowed by .zip format as entry names. Also, the
tab character <code>⇥</code> MUST NOT be used in the name.</p>

<ul dir="auto">
<li>SKU <code>AA⮐BB⮐CC⮐</code></li>
<li>Description <code>Item AA⮐Item BB⮐Item CC⮐</code></li>
<li>Price <code>111.11⮐222.22⮐333.33⮐</code></li>
<li>Region <code>US⮐US⮐US⮐</code></li>
</ul>
<p dir="auto">Note the number of rows in each column MUST be the same, except for Constant
Columns (see below). The nature of .zip files makes it possible to seek and read
just the columns required without having to read/decode the other columns. Note
that newline <code>⮐</code> MUST NOT appear in the actual column data since it is used to
separate rows. Note that each column row MUST end with a <code>⮐</code> including the last
one.</p>

<p dir="auto">These are features that are not required, but may be useful in some cases. They
are somewhat counter to our tenet of being simple, but they may be useful
enough to warrant the additional complexity. These features are mostly
independent of each other, so you can use one or more of them without using the
others.</p>

<p dir="auto">Constant Columns allow us to add an invariant column, which is useful for
partition keys. Note that the field has no trailing newline <code>⮐</code>.</p>

<ul dir="auto">
<li>SKU <code>AA⮐BB⮐CC⮐</code></li>
<li>Description <code>Item AA⮐Item BB⮐Item CC⮐</code></li>
<li>Price <code>111.11⮐222.22⮐333.33⮐</code></li>
<li>Region <code>US</code></li>
</ul>

<p dir="auto">If a collection of columns are always accessed together, it may make sense to
combine them, for example if SKU and Description were never accessed
independently, we could make <strong>products.zsv</strong> look like this:</p>

<ul dir="auto">
<li>SKU <code>AA⮐BB⮐CC⮐</code></li>
<li>Description⇥Price <code>Item AA⇥111.11⮐Item BB⇥222.22⮐Item CC⇥333.33⮐</code></li>
<li>Region <code>US</code></li>
</ul>
<p dir="auto">Note that Constant Columns MUST NOT participate in Compound Columns. Note that
along with newline <code>⮐</code>, the tab <code>⇥</code> character MUST NOT appear in the column
data in a Compound Column. Each row in any column MUST include the same number
of columns as its entry name.</p>

<p dir="auto">Data may be repeated using Compound Columns, if desired, for example:</p>

<ul dir="auto">
<li>SKU <code>AA⮐BB⮐CC⮐</code></li>
<li>Description⇥Price <code>Item AA⇥111.11⮐Item BB⇥222.22⮐Item CC⇥333.33⮐</code></li>
<li>Price <code>111.11⮐222.22⮐333.33⮐</code></li>
<li>Region <code>US</code></li>
</ul>
<p dir="auto">It is up to the reader to decide the optimal combination of ZIP entries to read
to meet the requirements and avoid reading unnecessary data. The same
combination of columns may appear in a different order, especially when the data
is sorted.</p>

<p dir="auto">Data may be nested by storing a ZIP of compressed row blob files inside the ZSV.</p>

<ul dir="auto">
<li>SKU <code>AA⮐BB⮐CC⮐</code></li>
<li>Description⇥Price <code>Item AA⇥111.11⮐Item BB⇥222.22⮐Item CC⇥333.33⮐</code></li>
<li>⇥Images (inner stored ZIP)
<ul dir="auto">
<li>0 <code>&lt;&lt;Image data for AA&gt;&gt;</code></li>
<li>1 <code>&lt;&lt;Image data for BB&gt;&gt;</code></li>
<li>2 <code>&lt;&lt;Image data for CC&gt;&gt;</code></li>
</ul>
</li>
</ul>
<p dir="auto">Data stored inside, Image data for BB, for example, is directly seekable and
fetchable without reading through any of the other data. The image data itself
may be compressed, but Images ZIP itself would not be compressed inside
products.zsv.</p>
<p dir="auto">Note the column name is prefixed with a tab <code>⇥</code> character to indicate to the
reader that this is a nested column.</p>

<p dir="auto">Row Groups may be used to split up longer data sets inside a bigger .zsv. This
is done by repeating the column file names followed by a double tab <code>⇥⇥</code> and a
unique number for each rowgroup.</p>

<ul dir="auto">
<li>SKU⇥⇥0 <code>AA⮐BB⮐</code></li>
<li>Description⇥Price⇥⇥0 <code>Item AA⇥111.11⮐Item BB⇥222.22⮐</code></li>
<li>Region⇥⇥0 <code>US</code></li>
<li>SKU⇥⇥1 <code>CC⮐</code></li>
<li>Description⇥Price⇥⇥1 <code>Item CC⇥333.33⮐</code></li>
<li>Region⇥⇥1 <code>US</code></li>
</ul>
<p dir="auto">Note the number of rows in each column of the row group MUST be equal. The
columns referenced in each row group MUST be equal. Columns referenced in each
row group SHOULD be in the same order and grouped together, however, this is not
a strict requirement and readers MUST NOT assume an order of files. Constant
columns may be different in each row group when named with the double tab or
there can be a single constant column as though there were no rowgroups.</p>

<ul dir="auto">
<li>SKU⇥⇥0 <code>AA⮐BB⮐</code></li>
<li>Description⇥Price⇥⇥0 <code>Item AA⇥111.11⮐Item BB⇥222.22⮐</code></li>
<li>SKU⇥⇥1 <code>CC⮐</code></li>
<li>Description⇥Price⇥⇥1 <code>Item CC⇥333.33⮐</code></li>
<li>Region <code>US</code></li>
</ul>

<p dir="auto">ZIP files support having comments on file entries inside. This may be used to
hold metadata about the contents that are otherwise unavailable, such as row
counts, partition information, sorting, distinct values, min/max text or values,
all in a bare keyname JSON format.</p>

<ul dir="auto">
<li>SKU⇥⇥0 <em>{rows:2, distinct:2, maxlength:2, min:&#34;AA&#34;, max:&#34;BB&#34;}</em> <code>AA⮐BB⮐</code></li>
<li>Description⇥⇥0 <em>{rows:2, distinct:2, maxlength:7}</em> <code>Item AA⮐Item BB⮐</code></li>
<li>Price⇥⇥0 <em>{rows:2, distinct:2, minvalue:111.11, maxvalue:222.22}</em> <code>111.11⮐222.22⮐</code></li>
<li>SKU⇥⇥1 <em>{rows:1, distinct:1, maxlength:2, min:&#34;CC&#34;, max:&#34;CC&#34;}</em> <code>CC⮐</code></li>
<li>Description⇥⇥1 <em>{rows:1, distinct:1, maxlength:7}</em> <code>Item CC⮐</code></li>
<li>Price⇥⇥1 <em>{rows:1, distinct:1, minvalue:333.33, maxvalue:333.33}</em> <code>333.33⮐</code></li>
<li>Region <em>{}</em> <code>US</code></li>
</ul>
<div dir="auto"><h2 tabindex="-1" dir="auto">Alternative CSV Inner Format</h2><a id="user-content-alternative-csv-inner-format" aria-label="Permalink: Alternative CSV Inner Format" href="#alternative-csv-inner-format"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">While TSV is the preferred inner format for ZSV, a form using CSV is also
possible. Each line has comma separated values and each value is either a quoted
string with JSON escapes possible, a JSON number, or a bare string, but with no
escapes and with forbidden characters.</p>

<ul dir="auto">
<li>SKU <code>&#34;AA&#34;⮐&#34;BB&#34;⮐&#34;CC&#34;⮐</code></li>
<li>Description⇥Price <code>&#34;Item AA&#34;,111.11⮐&#34;Item BB&#34;,222.22⮐&#34;Item CC&#34;,333.33⮐</code></li>
<li>Price <code>111.11⮐ 222.22⮐ 333.33⮐</code></li>
<li>Region <code>&#34;US&#34;</code></li>
</ul>
</article></div></div>
  </body>
</html>
