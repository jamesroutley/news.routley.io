<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/mthiim/dilithium-java">Original</a>
    <h1>Java implementation of a quantum computing resistant cryptographic algorithm</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">This is a Java implementation of Dilithium, based on the C reference implementation and documentation. Further, I&#39;ve wrapped it into a JCE provider, making it easy to use via a standardized interface.</p>
<p dir="auto">So what is Dilithium? The cryptographic algorithms RSA and ECC have long been known known to be vulnerable to attacks using quantum computers via Shor&#39;s algorithm. While quantum computers of the prerequisite size do not yet exist in practice, there&#39;s an ongoing search for algorithms that don&#39;t have this vulnerability. In fact, <a href="https://www.nist.gov/" rel="nofollow">NIST</a> has been running a competition for over 6 years in order to identify quantum-safe alternatives. On July 5th NIST <a href="https://www.nist.gov/news-events/news/2022/07/nist-announces-first-four-quantum-resistant-cryptographic-algorithms" rel="nofollow">announced</a> the three picks for Post-quantum digital signature schemes. Dilithium was among the three and was in fact recommended as the primary algorithm. Big congratulations to the authors! I wanted to study this new algorithm, and what better way than to try and implement it. This is what you are looking at :-)</p>
<p dir="auto">Dilithium is part of the CRYSTALS suite of algorithms and is based on algebratic lattices. Think linear algebra but where the matrix/vector entries are polynomials in the ring <math-renderer data-static-url="https://github.githubassets.com/static" data-run-id="d56876d3d9cd8ad22bf1d84727d4e456">$R_q = \mathbb{Z}_q[X]/(X^n+1)$</math-renderer>. For much more information (including the specification and C reference implementation I used), see <a href="https://pq-crystals.org/index.shtml" rel="nofollow">their page</a>.</p>
<p dir="auto">Like the reference implementation, this implementation supports all three documented security levels (levels 2, 3 and 5), all using the deterministic signature scheme. It passes all the KAT tests from the package. It supports serialization and deserialization using the documented formats.</p>
<p dir="auto">I have a dependency on Bouncy castle, which provides the SHAKE128/256 algorithms used internally in Dilithium.</p>
<p dir="auto"><em>IMPORTANT! This is a &#34;for fun&#34; implementation written in a couple of days. It&#39;s not intended to be production-grade code. No warranty or support of any kind is provided. However, it can be useful for diving into and experimenting with post-quantum algorithms. Use it at your own risk. If you don&#39;t like those terms, you must refrain from using this software.</em></p>
<h2 tabindex="-1" id="user-content-loading-the-security-provider" dir="auto"><a href="#loading-the-security-provider">Loading the security provider<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<div dir="auto" data-snippet-clipboard-copy-content="DilithiumProvider provider = new DilithiumProvider();
Security.addProvider(provider);"><pre>DilithiumProvider provider = new <span>DilithiumProvider</span>();
Security.addProvider(provider)<span>;</span></pre></div>
<p dir="auto">If you wish, instead of adding the provider using addProvider(), you can omit this line and explicitly provide the provider-object when calling the .getInstance() methods (see below).</p>
<h2 tabindex="-1" id="user-content-key-pair-generation" dir="auto"><a href="#key-pair-generation">Key pair generation<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">To generate a key pair you use:</p>
<div dir="auto" data-snippet-clipboard-copy-content="SecureRandom sr = new SecureRandom();
KeyPairGenerator kpg = KeyPairGenerator.getInstance(&#34;Dilithium&#34;);
kpg.initialize(DilithiumParameterSpec.LEVEL2, sr);			
KeyPair kp = kpg.generateKeyPair();"><pre>SecureRandom sr = new <span>SecureRandom</span>();
KeyPairGenerator kpg = KeyPairGenerator.getInstance(<span><span>&#34;</span>Dilithium<span>&#34;</span></span>)<span>;</span>
kpg.initialize(DilithiumParameterSpec.LEVEL2, sr)<span>;</span>			
KeyPair kp = <span>kpg.generateKeyPair</span>();</pre></div>
<p dir="auto">Note that you must provide an algorithm parameter spec representing the desired security level - the above example uses level 2, but you can select 3 and 5 as well. The three parameter spec objects are declared as static fields on the DilithiumParameterSpec class. Alternatively, a static method, getSpecForSecurityLevel(), is provided on DilithiumParameterSpec, allowing you to easily retrieve the spec for a given level at runtime.</p>
<h2 tabindex="-1" id="user-content-signing" dir="auto"><a href="#signing">Signing<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Having generated a key pair, signing works just the same as for other JCE providers. The example below signs a byte representation of &#34;Joy!&#34;.</p>
<div dir="auto" data-snippet-clipboard-copy-content="Signature sig = Signature.getInstance(&#34;Dilithium&#34;);
sig.initSign(kp.getPrivate());
sig.update(&#34;Joy!&#34;.getBytes());
byte[] signature = sig.sign();"><pre>Signature sig = Signature.getInstance(<span><span>&#34;</span>Dilithium<span>&#34;</span></span>)<span>;</span>
<span>sig.initSign(kp.getPrivate</span>());
<span>sig.update(&#34;Joy!&#34;.getBytes</span>());
byte[] signature = <span>sig.sign</span>();</pre></div>
<h2 tabindex="-1" id="user-content-signature-verification" dir="auto"><a href="#signature-verification">Signature verification<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Just as for signing, verification works as for other JCE providers</p>
<div dir="auto" data-snippet-clipboard-copy-content="Signature sig = Signature.getInstance(&#34;Dilithium&#34;);
sig.initVerify(kp.getPublic());
sig.update(&#34;Joy!&#34;.getBytes());
boolean b = sig.verify(signature);"><pre>Signature sig = Signature.getInstance(<span><span>&#34;</span>Dilithium<span>&#34;</span></span>)<span>;</span>
<span>sig.initVerify(kp.getPublic</span>());
<span>sig.update(&#34;Joy!&#34;.getBytes</span>());
boolean b = sig.verify(signature)<span>;</span></pre></div>
<p dir="auto">The boolean variable b now contains the outcome of the verification. Note that exceptions may be thrown in case of malformed signatures (as opposed to signatures that are merely incorrect).</p>
<h2 tabindex="-1" id="user-content-key-serializationdeserialization" dir="auto"><a href="#key-serializationdeserialization">Key serialization/deserialization<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">You can use the .getEncoded() method on the public and private key objects to obtain a byte representation of the key. The formats are compatible with the reference implementation.
In order to instantiate the keys from the byte representation, a key factory is provided. You can use this with the provided DilithiumPublicKeySpec and DilithiumPrivateKeySpec classes.
They are constructed using two parameters, namely the parameter spec (same as used for generating) and the byte representation. Note that the parameter spec is not encoded into the byte representation, and I decided to make the parameter choice explit rather than trying to infer it from length. In the future, I anticipate that ASN.1-based formats with OID&#39;s etc. will be standardized, and they will then explcitly encode the parameters. Of course, the serialization format could change as well as the standardization process moves along.</p>
<div dir="auto" data-snippet-clipboard-copy-content="byte[] pubkeyBytes = kp.getPublic().getEncoded(); // This is our bytes to be instantiated
KeyFactory kf = KeyFactory.getInstance(&#34;Dilithium&#34;);
PublicKey reconsructedPublicKey = kf.generatePublic(new DilithiumPublicKeySpec(spec, pubkeyBytes));"><pre>byte[] pubkeyBytes = <span>kp.getPublic().getEncoded</span>(); // This is our bytes to be instantiated
KeyFactory kf = KeyFactory.getInstance(<span><span>&#34;</span>Dilithium<span>&#34;</span></span>)<span>;</span>
PublicKey reconsructedPublicKey = kf.generatePublic(new DilithiumPublicKeySpec(spec, pubkeyBytes))<span>;</span></pre></div>
<p dir="auto">The private key may be reconstructed in the same fashion, using the DilithiumPrivateKeySpec class.</p>
<h2 tabindex="-1" id="user-content-low-level-use" dir="auto"><a href="#low-level-use">Low-level use<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">As an alternative to the low-level interface you can also use the static methods in the Dilithium class directly to generate, sign and verify. See e.g. how the JCE classes do it.</p>
<h2 tabindex="-1" id="user-content-running-the-known-answer-tests" dir="auto"><a href="#running-the-known-answer-tests">Running the known-answer tests<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">The official Dilithium package contains a known-answer test generator that generates a request and response file. I&#39;ve provided a Java utility in KAT.java that can read the
request file generated by the reference implementation, run through the tests and generate a corresponding response file. You can then compare this response file to the one
generated by the official known-answer test generator and verify that they are byte-identical. The KAT.java program is run with parameters:</p>
<div dir="auto" data-snippet-clipboard-copy-content=" &lt;input-request-file&gt; &lt;output-response-file&gt; &lt;level&gt;"><pre> <span>&lt;</span>input-request-file<span>&gt;</span> <span>&lt;</span>output-response-file<span>&gt;</span> <span>&lt;</span>level<span>&gt;</span></pre></div>
<p dir="auto">Note that the desired security level (2, 3 or 5) must be provided as the 3rd argument. This must match what is configured in the config.h file in the C implementation when generating the response file used for comparison.</p>
<h2 tabindex="-1" id="user-content-disclaimer" dir="auto"><a href="#disclaimer">DISCLAIMER<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">This library is available under the Apache 2.0 license (see LICENSE). Note that the code has not been examined by a third party for potential vulnerabilities and as mentioned was not made to be used for production use. No warranty of any kind is provided. If you don&#39;t like those terms, you must refrain from using this software.</p>
<h2 tabindex="-1" id="user-content-references" dir="auto"><a href="#references">References<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">For more information on the CRYSTALS project, see their <a href="https://pq-crystals.org/index.shtml" rel="nofollow">website</a>.</p>
<h2 tabindex="-1" id="user-content-contact" dir="auto"><a href="#contact">Contact<svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">Mail: <a href="mailto:martin@thiim.net">martin@thiim.net</a></p>
</article>
          </div></div>
  </body>
</html>
