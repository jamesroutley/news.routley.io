<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bengarcia.dev/making-o1-o3-and-sonnet-3-7-hallucinate-for-everyone">Original</a>
    <h1>Making o1, o3, and Sonnet 3.7 Hallucinate for Everyone</h1>
    
    <div id="readability-page-1" class="page"><div>
    <div>
  <p>A quick-fun story.</p><p>My (ops-but-sometimes-writes-scripts-to-help-out) coworker just tapped on my shoulder and asked me to look at his code that wasn&#39;t working. It was a bit something like this:</p><pre><code>User.includes(investments: -&gt; { where(state: :draft) })...</code></pre><p>This is <em>not</em> a feature of <code>ActiveRecord</code> or any libraries that I&#39;m aware of. I asked him why he thought this was valid syntax, and he pulled up his ChatGPT history. It looked something like this:</p><blockquote><p>Ask: How can I dynamically preload an association with conditions in rails? (Potentially followed up with - no custom has_many associations, no preloader object, don&#39;t filter the base query, etc.)</p></blockquote><p>Sometimes, you&#39;re routed to the correct answer. Which is to add the filter you want on the associated record as a standard where clause, and also add a <code>.references(:association)</code> to the query chain. Like so:</p><pre><code>User.includes(:investments).where(investments: { state: :draft }).references(:investments) </code></pre><p>However, with just a few tests, you&#39;re usually routed to that bizarre, non-existent syntax of including a lambda as a keyword argument value to the association you want it applied to. I recreated this a few times below:</p><div><action-text-attachment sgid="eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL2hhaGFoYWNvcm4vQWN0aXZlU3RvcmFnZTo6QmxvYi8xP2V4cGlyZXNfaW4iLCJwdXIiOiJhdHRhY2hhYmxlIn19--7e4233327ddf1c739bdd5ab7ddce6b63c9eeeb55" content-type="image/jpeg" url="https://bengarcia.dev/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--f8e927e75208ce1a199268fe64cb81eb97003c7e/o3-mini.jpg" filename="o3-mini.jpg" filesize="100324" width="1548" height="518" previewable="true" presentation="gallery" caption="o3-mini"><figure>
    <img src="https://bengarcia.dev/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MSwicHVyIjoiYmxvYl9pZCJ9fQ==--f8e927e75208ce1a199268fe64cb81eb97003c7e/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGciLCJyZXNpemVfdG9fbGltaXQiOlsxMDI0LDc2OF19LCJwdXIiOiJ2YXJpYXRpb24ifX0=--8f2f652f3630a1960185340282e991e2a041c2da/o3-mini.jpg"/>

  <figcaption>
      o3-mini
  </figcaption>
</figure></action-text-attachment></div><action-text-attachment sgid="eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL2hhaGFoYWNvcm4vQWN0aXZlU3RvcmFnZTo6QmxvYi8yP2V4cGlyZXNfaW4iLCJwdXIiOiJhdHRhY2hhYmxlIn19--6f2624587962f3c454b294e435fffff427dc2984" content-type="image/jpeg" url="https://bengarcia.dev/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MiwicHVyIjoiYmxvYl9pZCJ9fQ==--56cc79033b36aaf720b6da8b2d466d44bbe33468/image-20250226163600269.jpeg" filename="image-20250226163600269.jpeg" filesize="150561" width="1434" height="538" previewable="true" presentation="gallery" caption="Sonnet 3.7"><figure>
    <img src="https://bengarcia.dev/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MiwicHVyIjoiYmxvYl9pZCJ9fQ==--56cc79033b36aaf720b6da8b2d466d44bbe33468/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGVnIiwicmVzaXplX3RvX2xpbWl0IjpbMTAyNCw3NjhdfSwicHVyIjoidmFyaWF0aW9uIn19--0b561c821874124cce936ade814b8e868982a6d2/image-20250226163600269.jpeg"/>

  <figcaption>
      Sonnet 3.7
  </figcaption>
</figure></action-text-attachment><div><action-text-attachment sgid="eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL2hhaGFoYWNvcm4vQWN0aXZlU3RvcmFnZTo6QmxvYi8zP2V4cGlyZXNfaW4iLCJwdXIiOiJhdHRhY2hhYmxlIn19--51d64b906fe14db7db6f052a9853974fe7e72b09" content-type="image/jpeg" url="https://bengarcia.dev/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MywicHVyIjoiYmxvYl9pZCJ9fQ==--969d92ec93fc9db314fb76aaf1c3dec99009438b/image-20250226163728528.jpeg" filename="image-20250226163728528.jpeg" filesize="100125" width="1422" height="652" previewable="true" presentation="gallery" caption="Sonnet 3.5"><figure>
    <img src="https://bengarcia.dev/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6MywicHVyIjoiYmxvYl9pZCJ9fQ==--969d92ec93fc9db314fb76aaf1c3dec99009438b/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGVnIiwicmVzaXplX3RvX2xpbWl0IjpbMTAyNCw3NjhdfSwicHVyIjoidmFyaWF0aW9uIn19--0b561c821874124cce936ade814b8e868982a6d2/image-20250226163728528.jpeg"/>

  <figcaption>
      Sonnet 3.5
  </figcaption>
</figure></action-text-attachment></div><p>I was confused why the syntax &#34;felt&#34; familiar though, until my coworker pointed out <a href="https://discuss.rubyonrails.org/t/how-can-i-preload-an-association-with-conditions-of-a-collection/82230">I invented it while asking a question on the Rails forum two years ago.</a></p><div><action-text-attachment sgid="eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL2hhaGFoYWNvcm4vQWN0aXZlU3RvcmFnZTo6QmxvYi85P2V4cGlyZXNfaW4iLCJwdXIiOiJhdHRhY2hhYmxlIn19--0848f5157b21d8014bb9fec7d6991947ceb6e342" content-type="image/jpeg" url="https://bengarcia.dev/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsiZGF0YSI6OSwicHVyIjoiYmxvYl9pZCJ9fQ==--44db8342395a592a4f04d2ce2d709be6b185f91b/image-20250226165412919.jpeg" filename="image-20250226165412919.jpeg" filesize="137232" width="1424" height="528" previewable="true" presentation="gallery" caption="Exploring APIs"><figure>
    <img src="https://bengarcia.dev/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6OSwicHVyIjoiYmxvYl9pZCJ9fQ==--44db8342395a592a4f04d2ce2d709be6b185f91b/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGVnIiwicmVzaXplX3RvX2xpbWl0IjpbMTAyNCw3NjhdfSwicHVyIjoidmFyaWF0aW9uIn19--0b561c821874124cce936ade814b8e868982a6d2/image-20250226165412919.jpeg"/>

  <figcaption>
      Exploring APIs
  </figcaption>
</figure></action-text-attachment></div><p>Funny enough, my other &#34;idea&#34; in that thread is the other solution most LLMs hallucinate - accessing the Preloader object directly.</p><div><action-text-attachment sgid="eyJfcmFpbHMiOnsiZGF0YSI6ImdpZDovL2hhaGFoYWNvcm4vQWN0aXZlU3RvcmFnZTo6QmxvYi80P2V4cGlyZXNfaW4iLCJwdXIiOiJhdHRhY2hhYmxlIn19--cb51fe1dc317f39b97b4189ac31558dbeceb6b60" content-type="image/jpeg" url="https://bengarcia.dev/rails/active_storage/blobs/redirect/eyJfcmFpbHMiOnsiZGF0YSI6NCwicHVyIjoiYmxvYl9pZCJ9fQ==--e5a51f1123ff0480e96d3924d6711ed8d02fabf6/image-20250226165546302.jpg" filename="image-20250226165546302.jpg" filesize="167421" width="1346" height="1000" previewable="true" presentation="gallery" caption="This don&#39;t work either"><figure>
    <img src="https://bengarcia.dev/rails/active_storage/representations/redirect/eyJfcmFpbHMiOnsiZGF0YSI6NCwicHVyIjoiYmxvYl9pZCJ9fQ==--e5a51f1123ff0480e96d3924d6711ed8d02fabf6/eyJfcmFpbHMiOnsiZGF0YSI6eyJmb3JtYXQiOiJqcGciLCJyZXNpemVfdG9fbGltaXQiOlsxMDI0LDc2OF19LCJwdXIiOiJ2YXJpYXRpb24ifX0=--8f2f652f3630a1960185340282e991e2a041c2da/image-20250226165546302.jpg"/>

  <figcaption>
      This don&#39;t work either
  </figcaption>
</figure></action-text-attachment></div><p>I didn&#39;t realize this when posting originally, but this still requires you to loop through the posts and load the query returned by the preloader into each posts association target. I didn&#39;t include that, and LLMs seem to be confused too.</p><p>As far as I&#39;m aware, that forum post is the only place that you&#39;ll find that specific syntax exploration. As my comment above denotes, it would not work <em>anyway</em>. Why I included it in the first place is beyond me - I&#39;m working on making my writing more concise (which is why I carved out a section to explain that, and then this, and now this explanation of that....)</p><h3><strong>Conclusion</strong></h3><p>LLMs are really smart most of the time. But, once it reaches niche topics and doesn&#39;t have sufficient context, it begins to resemble myself early in my career. Open StackOverflow, Ctrl+C, Ctrl+V, Leeroy Jenkins style. I can&#39;t help but find it endearing.</p>
</div>

  </div></div>
  </body>
</html>
