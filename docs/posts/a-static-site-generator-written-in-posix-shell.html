<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://aashvik.com/posts/shell-ssg/">Original</a>
    <h1>A static site generator written in POSIX shell</h1>
    
    <div id="readability-page-1" class="page"><div><p>
    <small>
        <a href="https://aashvik.com/posts/shell-ssg.md" title="view markdown">View soure</a> for &#34;an ssg written in shell&#34;
        [<span sw="" gem="">sw gem</span>]
        from <a href="https://aashvik.com/#shell-ssg"><time sw="" gem="" datetime="2026-01-18">2026-01-18</time></a>
        in <a href="https://aashvik.com/tags#ssg">ssg</a>,  <a href="https://aashvik.com/tags#sw">sw</a>,  <a href="https://aashvik.com/tags#web">web</a>,  <a href="https://aashvik.com/tags#shell">shell</a>.
        </small>
</p>

<p>Earlier last year, I made this website into a <a href="https://aashvik.com/posts/client-route-md">JS single-page application</a> that used two GitHub repos and did regex crimes while praying JavaScript and cross-origin resource-sharing were enabled, and it worked the way a shopping cart with two wheels still rolls downhill…</p>
<p>So, after a few months of making and breaking different static site generators and website layouts, I’ve replaced it with a POSIX shell script (with an optional comrak dependency for markdown), because I enjoy cobbling HTML together and don’t want big JS frameworks for my small and simple site.</p>
<p>Please welcome: my very site-specific build script, a whole lot of string concatenation! Here’s <a href="https://aashvik.com/gen.sh"><code>gen.sh</code></a>, a static-site-generating script written in shell to turn a directory of markdown files and other resources into a complete blog website with tags, RSS, Atom, and JSON feeds, a sitemap, drafts, and more.</p>
<h2><a href="#what-do" aria-hidden="true" id="what-do"></a>What do?</h2>
<p><code>gen.sh</code> builds my static site. It’s the website you’re reading from right now. It’s built from handwritten HTML and CSS which the script pieces together, and the posts are written in markdown which it renders to HTML.</p>
<p><code>gen.sh</code> expects:</p>
<ol>
<li><code>posts/</code> directory, holding markdown;</li>
<li><code>include/</code>, holding any other assets to be copied into the website’s root, and</li>
<li><code>template/</code>, containing the templates for pages and feeds, which the script will fill.</li>
</ol>
<p><code>gen.sh</code> builds its output into <code>public/</code>, and is a (mostly) one-pass generator. Here’s what it does, in order:</p>
<ul>
<li>it copies <code>include</code> and <code>posts</code> into <code>public</code>,</li>
<li>reads markdown from <code>posts/*.md</code>,</li>
<li>extracts metadata from frontmatter,</li>
<li>renders content using <code>comrak</code> with extensions,</li>
<li>and emits:
<ul>
<li>per-post <code>index.html</code> pages into <code>public/posts/</code>,</li>
<li>an index,</li>
<li>a page for tags,</li>
<li>a page for drafts, and</li>
<li>multiple feeds and a sitemap</li>
</ul>
</li>
</ul>
<p>It does not keep a build cache – there is no incremental rebuild. There is only <u>running the script again</u>. It can exist without remembering anything, because it’s still decently fast:</p>
<pre><code><span># with 29 posts
</span><span>time</span><span> ./gen.sh
</span><span>________________________________________________________
</span><span>Executed</span><span> in  714.34 millis    fish           external
</span><span>   </span><span>usr</span><span> time  623.35 millis  482.00 micros  622.87 millis
</span><span>   </span><span>sys</span><span> time  185.92 millis  257.00 micros  185.66 millis
</span></code></pre>
<h2><a href="#how-work" aria-hidden="true" id="how-work"></a>How work?</h2>
<p>The latest version of the script is currently available at <a href="https://aashvik.com/gen.sh"><code>/gen.sh</code></a> – note that it may not stay relevant to this post due to future changes, and may not even exist later on. But here’s bit about how it currently works:</p>
<h3><a href="#loop" aria-hidden="true" id="loop"></a>loop?</h3>
<p>The script first <code>cp -r</code>s <code>include/*</code> and <code>posts</code> into <code>public/</code>, giving us paths like <code>public/posts/shell-ssg.md</code>, after which we must process each post.</p>
<p>It is trivial to extract a date value from my frontmatter format, so we can make the main loop which iterates over all posts process them chronologically:</p>
<pre><code><span>for</span><span> md </span><span>in </span><span>$(
</span><span>    </span><span>for</span><span> md </span><span>in</span><span> public/posts/*.md; </span><span>do
</span><span>        </span><span>sed</span><span> -n </span><span>&#39;</span><span>2,6s/^date: //p</span><span>&#39; &#34;$</span><span>md</span><span>&#34;; </span><span>echo </span><span>&#34;$</span><span>md</span><span>&#34;
</span><span>    </span><span>done </span><span>\
</span><span>        | </span><span>paste</span><span> - -    \
</span><span>        | </span><span>sort</span><span> -r </span><span>\
</span><span>        | </span><span>cut</span><span> -f2
</span><span>); </span><span>do
</span><span>    </span><span># extract deets
</span><span>    </span><span># make tags
</span><span>    </span><span># make article
</span><span>    </span><span># make post
</span><span>    </span><span># make feeds
</span><span>done
</span></code></pre>
<h3><a href="#getting-metadata" aria-hidden="true" id="getting-metadata"></a>getting metadata</h3>
<p>Many blog-focused SSGs process actual YAML, but mine’s a bit different… Each of my posts is a markdown file with a header in the first 6 lines:</p>
<pre><code><span>---
</span><span>date: 2025-10-22
</span><span>title: title
</span><span>desc: Longer description.
</span><span>tags: tag1 tag2 tag3
</span><span>cats: gem draft sw hw rb misc
</span><span>---
</span></code></pre>
<p>These are ignored by comrak due to the <code>--front-matter-delimiter ---</code> option. They can be in any order, so long as they’re all between lines 2 and 6… and I overdo frontmatter fetching a bit:</p>
<pre><code><span>post_date</span><span>=$</span><span>(</span><span>sed</span><span> -nE </span><span>&#39;</span><span>2,6s/^date[[:space:]]*:[[:space:]]*(.*)/\1/p</span><span>&#39; &#34;$</span><span>md</span><span>&#34;</span><span>)
</span><span>    </span><span>post_title</span><span>=&#34;$</span><span>(</span><span>fix_xml </span><span>&#34;$</span><span>(</span><span>sed</span><span> -nE </span><span>&#39;</span><span>2,6s/^title[[:space:]]*:[[:space:]]*(.*)/\1/p</span><span>&#39; &#34;$</span><span>md</span><span>&#34;</span><span>)</span><span>&#34;</span><span>)</span><span>&#34;
</span><span>    </span><span>post_desc</span><span>=&#34;$</span><span>(</span><span>fix_xml </span><span>&#34;$</span><span>(</span><span>sed</span><span> -nE </span><span>&#39;</span><span>2,6s/^desc(ription)?[[:space:]]*:[[:space:]]*(.*)/\2/p</span><span>&#39; &#34;$</span><span>md</span><span>&#34;</span><span>)</span><span>&#34;</span><span>)</span><span>&#34;
</span><span>    </span><span>post_tags</span><span>=$</span><span>(</span><span>sed</span><span> -nE </span><span>&#39;</span><span>2,6s/^tag(s)?[[:space:]]*:[[:space:]]*(.*)/\2/p</span><span>&#39; &#34;$</span><span>md</span><span>&#34;</span><span>)
</span><span>    </span><span>post_cats</span><span>=$</span><span>(</span><span>sed</span><span> -nE </span><span>&#39;</span><span>2,6s/^cat(egor)?(y)?(ie)?(s)?[[:space:]]*:[[:space:]]*(.*)/\5/p</span><span>&#39; &#34;$</span><span>md</span><span>&#34;</span><span>)
</span></code></pre>
<p>This lets me write the frontmatter very freely. For example, <code>cats</code>, <code>cat</code>, <code>categorys</code>, <code>categories</code>, <code>catyie</code>, <code>categors</code>, <code>categoryies</code>, <code>caty</code>, and <code>catys</code> are all valid metadata to for the “categories” line, and there can be any number (including zero!) of spaces before and after the colon.</p>
<p>For title and description, I do some straightforward HTML escaping:</p>
<details><summary><code>fix_xml()</code></summary>
<pre><code><span>fix_xml</span><span>() {
</span><span>    </span><span>echo </span><span>&#34;$</span><span>1</span><span>&#34; | </span><span>sed </span><span>&#39;</span><span>s/&amp;/\&amp;amp;/g; s/&lt;/\&amp;lt;/g; s/&gt;/\&amp;gt;/g; s/&#34;/\&amp;quot;/g; s/</span><span>&#39;&#34;</span><span>&#39;</span><span>&#34;&#39;</span><span>/\&amp;apos;/g</span><span>&#39;
</span><span>}
</span></code></pre>
</details>
<h3><a href="#comrak" aria-hidden="true" id="comrak"></a>comrak</h3>
<p>Markdown is rendered via <code>comrak</code>, because it’s fast (as seen above), and supports the <u>entirety of commonmark</u> along with many extensions and extra options. I invoke it:</p>
<pre><code><span>comrak </span><span>\
</span><span>    --unsafe </span><span>\
</span><span>    --smart </span><span>\
</span><span>    --front-matter-delimiter</span><span> --- \
</span><span>    --relaxed-autolinks </span><span>\
</span><span>    --header-ids </span><span>&#39;&#39; \
</span><span>    --syntax-highlighting</span><span> base16-eighties.dark \
</span><span>    --extension</span><span> alerts,autolink,description-lists,footnotes,greentext,math-code,math-dollars,multiline-block-quotes,spoiler,strikethrough,subscript,superscript,table,tasklist,underline,wikilinks-title-before-pipe \
</span><span>    ${</span><span>md</span><span>}
</span></code></pre>
<p>I really like a featureful markup language. My options and extensions:</p>
<ul>
<li>let me write raw HTML inside markdown,</li>
<li>enable my metadata format,</li>
<li>stylize my punctuation,</li>
<li>syntax highlight my code,</li>
<li>add footnotes, blockquotes, math, spoilers, text transforms, and alerts,</li>
<li>and allow for detailed CSS to my taste.</li>
</ul>
<p>Things then get personal when the resulting HTML is passed to <code>sed</code>.</p>
<h3><a href="#sed" aria-hidden="true" id="sed"></a>sed…</h3>
<p>I pass comrak output into <code>sed -z -E</code> for some extra features, this is safe to do as most accidentally-matching patterns in text are sanitized to HTML escape codes by comrak:</p>
<h4><a href="#side-by-side-images" aria-hidden="true" id="side-by-side-images"></a>side-by-side images</h4>
<p><code>&lt;img&gt;</code> tags separated by spaces or a single newline get wrapped in a flex container:</p>
<pre><code><span>s@</span><span>((</span><span>&lt;img</span><span>[^</span><span>&gt;</span><span>]</span><span>*</span><span>[[</span><span>:space:</span><span>]]</span><span>*/?&gt;</span><span>[[</span><span>:space:</span><span>]]</span><span>*</span><span>)</span><span>{2,}</span><span>)</span><span>@&lt;div style=&#34;display:flex;gap:1ch;&#34;&gt;</span><span>\</span><span>1</span><span>&lt;/div&gt;@g
</span></code></pre>
<p>This works well with the <code>img { width: fit-content; display: block; }</code> CSS that I enforce on all <code>&lt;img&gt;</code>s globally.</p>
<h4><a href="#image-titles-become-captions" aria-hidden="true" id="image-titles-become-captions"></a>image titles become captions</h4>
<p>Comrak already allows the <code>![alt](url &#34;title&#34;)</code> and <code>[hyperlink](link &#34;title&#34;)</code> format for adding a <code>title</code> attribute (text made visible by a browser on hover) to a tag, so I repurpose this to add captions to images with titles:</p>
<pre><code><span>s@&lt;img</span><span>([^</span><span>&gt;</span><span>]</span><span>*</span><span>)</span><span>title=&#34;</span><span>([^</span><span>&#34;</span><span>]</span><span>+</span><span>)</span><span>&#34;</span><span>([^</span><span>&gt;</span><span>]</span><span>*</span><span>)</span><span>&gt;@&lt;figure&gt;&lt;img</span><span>\</span><span>1</span><span>title=&#34;</span><span>\</span><span>2</span><span>&#34;</span><span>\</span><span>3</span><span>&gt;&lt;figcaption&gt;</span><span>\</span><span>2</span><span>&lt;/figcaption&gt;&lt;/figure&gt;@g
</span></code></pre>
<h4><a href="#media-autodetection" aria-hidden="true" id="media-autodetection"></a>media autodetection</h4>
<p>Images with a source URL ending in an audio or video format file extension get their appropriate tags, with very naiive but functioning MIME types:</p>
<pre><code><span>s@&lt;img</span><span>([^</span><span>&gt;</span><span>]</span><span>*</span><span>)</span><span>src=&#34;</span><span>([^</span><span>&#34;</span><span>]</span><span>+</span><span>)</span><span>\.</span><span>(</span><span>mp4|mov|ogv|webm|m4v|mkv|avi|mpg|mpeg</span><span>)</span><span>&#34;</span><span>([^</span><span>&gt;</span><span>]</span><span>*</span><span>)</span><span>/&gt;@&lt;video controls&gt;&lt;source</span><span>\</span><span>1 </span><span>src=&#34;</span><span>\</span><span>2</span><span>.\</span><span>3</span><span>&#34; type=&#34;video/</span><span>\</span><span>3</span><span>&#34;</span><span>\</span><span>4</span><span>&gt;&lt;/video&gt;@g
</span><span>s@&lt;img</span><span>([^</span><span>&gt;</span><span>]</span><span>*</span><span>)</span><span>src=&#34;</span><span>([^</span><span>&#34;</span><span>]</span><span>+</span><span>)</span><span>\.</span><span>(</span><span>mp3|wav|ogg|aac|m4a|flac</span><span>)</span><span>&#34;</span><span>([^</span><span>&gt;</span><span>]</span><span>*</span><span>)</span><span>/&gt;@&lt;audio controls&gt;&lt;source</span><span>\</span><span>1 </span><span>src=&#34;</span><span>\</span><span>2</span><span>.\</span><span>3</span><span>&#34; type=&#34;audio/</span><span>\</span><span>3</span><span>&#34;</span><span>\</span><span>4</span><span>/&gt;&lt;/audio&gt;@g
</span></code></pre>
<h4><a href="#assets-without-relative-path-hell" aria-hidden="true" id="assets-without-relative-path-hell"></a>assets without relative-path hell</h4>
<p>URLs for images and links matching <code>./*</code> turn into <code>/assets/post_slug/*</code>, letting me quickly refer to a file belonging to a folder named after the current post in the <code>/assets/</code> folder at the root of the website:</p>
<pre><code><span>s@(&lt;(img|a)[^&gt;]*[[:space:]](src|href)=[\&#34;&#39;\&#39;&#39;]?)\.@\1/assets/&#39;&#34;$post_slug&#34;&#39;@g
</span></code></pre>
<h3><a href="#wow-thats-a-lot-of-non-standard-markdown-functionality" aria-hidden="true" id="wow-thats-a-lot-of-non-standard-markdown-functionality"></a>“Wow, that’s a lot of non-standard markdown functionality!”</h3>
<p>I agree! I wrote the (<code>draft</code>) <a href="https://aashvik.com/posts/cmrk-cheatsheet"><code>posts/cmrk-cheatsheet</code></a> as a reference for the first few times I’d use these structures, and also to tune this site’s CSS.</p>
<h3><a href="#building-the-post" aria-hidden="true" id="building-the-post"></a>building the post</h3>
<p>Each post is rendered by filling a static HTML template with per-post metadata and rendered markdown. Rather than inventing a templating language, I use <code>envsubst</code>, which simply replaces exported environment variables in a file by shell <code>${string}</code> substitution, keeping the template boring and the shell script explicit.</p>
<p>So:</p>
<ol>
<li>extract metadata</li>
<li>render markdown to HTML with comrak</li>
<li>export a handful of variables</li>
<li>pipe the template through <code>envsubst</code> and into <code>public/${post_slug}/index.html</code></li>
</ol>
<p>Using <code>envsubst</code> looks something like this:</p>
<pre><code><span>export </span><span>var1 var2 var3
</span><span>envsubst </span><span>&lt; template/index.html &gt; &#34;</span><span>public/post_loc/index.html</span><span>&#34;
</span></code></pre>
<p>So, each post, the script exports the relevant metadata and ensures there’s a folder at <code>public/posts/${post_slug}</code>:</p>
<pre><code><span>post_dir</span><span>=$</span><span>{</span><span>md</span><span>%</span><span>.md}
</span><span>post_slug</span><span>=$</span><span>{</span><span>post_dir</span><span>#</span><span>public/posts/}
</span><span>mkdir</span><span> -p </span><span>$</span><span>post_dir
</span><span>export </span><span>post_title post_desc post_tags_comma post_content
</span></code></pre>
<p>It then builds the HTML content for the post, including some initial post information and a comment email, into post_content:</p>
<pre><code><span>export </span><span>post_content</span><span>=&#34;</span><span>\
</span><span>&lt;p&gt;
</span><span>    &lt;small&gt;
</span><span>        &lt;a href=&#39;/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}.md&#39; title=&#39;View markdown&#39; style=&#39;color:inherit&#39;&gt;View source&lt;/a&gt; for </span><span>\&#34;</span><span>$</span><span>{</span><span>post_title</span><span>}</span><span>\&#34;</span><span> [&lt;span </span><span>$</span><span>{</span><span>post_cats</span><span>}&gt;</span><span>$</span><span>{</span><span>post_cats</span><span>}&lt;/span&gt;] from
</span><span>        &lt;a href=&#39;/#</span><span>$</span><span>{</span><span>post_slug</span><span>}&#39; style=&#39;color:inherit&#39; </span><span>$</span><span>{</span><span>post_cats</span><span>}&gt;
</span><span>            &lt;time datetime=&#39;</span><span>$</span><span>{</span><span>post_date</span><span>}&#39;&gt;</span><span>$</span><span>{</span><span>post_date</span><span>}&lt;/time&gt;
</span><span>        &lt;/a&gt; in </span><span>$</span><span>{</span><span>post_tags_html</span><span>}.
</span><span>        &lt;br&gt;&lt;i&gt;</span><span>$</span><span>{</span><span>post_desc</span><span>}&lt;/i&gt;
</span><span>    &lt;/small&gt;
</span><span>&lt;/p&gt;
</span><span>$</span><span>(</span><span>comrak</span><span> OPTIONS </span><span>$</span><span>{</span><span>md</span><span>} </span><span>| </span><span>sed</span><span> -z -E </span><span>&#39;</span><span>REGEX</span><span>&#39;</span><span>)
</span><span>&lt;p&gt;
</span><span>    &lt;small&gt;
</span><span>        &lt;a href=&#39;mailto:comments@aashvik.com?subject=</span><span>$</span><span>(</span><span>fix_url </span><span>&#34;</span><span>Comment on </span><span>\&#34;</span><span>$</span><span>{</span><span>post_title</span><span>}</span><span>\&#34;</span><span> from aashvik.com/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}</span><span>&#34;</span><span>)&#39; style=&#39;color:inherit&#39;&gt;comment on </span><span>\&#34;</span><span>$</span><span>{</span><span>post_title</span><span>}</span><span>\&#34;</span><span>&lt;/a&gt;
</span><span>    &lt;/small&gt;
</span><span>&lt;/p&gt;</span><span>&#34;
</span></code></pre>
<p>To substitute into the post!</p>
<pre><code><span>envsubst </span><span>&lt; template/index.html &gt; &#34;$</span><span>{</span><span>post_dir</span><span>}/index.html</span><span>&#34;
</span></code></pre>
<h3><a href="#tags-counted-and-weaponized" aria-hidden="true" id="tags-counted-and-weaponized"></a>tags, counted and weaponized</h3>
<p>Welcome to the first ring of <code>eval</code>-hell. It’s not too cursed in here, we’re just working around not having the convenience of arrays in POSIX shell.</p>
<p>For every post, we make versions of the tags for HTML and different feeds:</p>
<pre><code><span>post_tags_comma</span><span>=&#34;&#34; </span><span>post_tags_html</span><span>=&#34;&#34; </span><span>post_tags_rss</span><span>=&#34;&#34; </span><span>post_tags_atom</span><span>=&#34;&#34; </span><span>post_tags_json</span><span>=&#34;</span><span>[</span><span>&#34;
</span><span>for</span><span> tag </span><span>in </span><span>$</span><span>post_tags</span><span>; </span><span>do
</span><span>    </span><span># light sanitize, because we eval later
</span><span>    </span><span>tag</span><span>=&#34;$</span><span>(</span><span>echo </span><span>&#34;$</span><span>tag</span><span>&#34; | </span><span>sed </span><span>&#39;</span><span>s/[^[:alnum:]-]//g</span><span>&#39;</span><span>)</span><span>&#34;
</span><span>    </span><span># and making variants:
</span><span>    </span><span>post_tags_comma</span><span>=&#34;$</span><span>{</span><span>post_tags_comma</span><span>}</span><span>$</span><span>{</span><span>tag</span><span>}, </span><span>&#34;
</span><span>    </span><span>post_tags_html</span><span>=&#34;$</span><span>{</span><span>post_tags_html</span><span>}&lt;a href=&#39;/tags#</span><span>$</span><span>{</span><span>tag</span><span>}&#39; style=&#39;color:inherit&#39;&gt;</span><span>$</span><span>{</span><span>tag</span><span>}&lt;/a&gt;, </span><span>&#34;
</span><span>    </span><span>post_tags_rss</span><span>=&#34;$</span><span>{</span><span>post_tags_rss</span><span>}&lt;category domain=&#39;https://username.com/tags#</span><span>$</span><span>{</span><span>tag</span><span>}&#39;&gt;</span><span>$</span><span>{</span><span>tag</span><span>}&lt;/category&gt;</span><span>&#34;
</span><span>    </span><span>post_tags_atom</span><span>=&#34;$</span><span>{</span><span>post_tags_atom</span><span>}&lt;category term=&#39;</span><span>$</span><span>{</span><span>tag</span><span>}&#39; scheme=&#39;https://username.com/tags#</span><span>$</span><span>{</span><span>tag</span><span>}&#39; label=&#39;</span><span>$</span><span>{</span><span>tag</span><span>}&#39;/&gt;</span><span>&#34;
</span><span>    </span><span>post_tags_json</span><span>=&#34;$</span><span>{</span><span>post_tags_json</span><span>}</span><span>\&#34;</span><span>$</span><span>{</span><span>tag</span><span>}</span><span>\&#34;</span><span>, </span><span>&#34;
</span><span>done
</span><span>post_tags_comma</span><span>=&#34;$</span><span>{</span><span>post_tags_comma</span><span>%</span><span>, }</span><span>&#34; </span><span>post_tags_html</span><span>=&#34;$</span><span>{</span><span>post_tags_html</span><span>%</span><span>, }</span><span>&#34; </span><span>post_tags_json</span><span>=&#34;$</span><span>{</span><span>post_tags_json</span><span>%</span><span>, }]</span><span>&#34;
</span><span># I&#39;m aware it&#39;s very extra
</span></code></pre>
<p>And, for each tag, with some mildly disturbing <code>eval</code>, the script:</p>
<ol>
<li>adds the current tag to <code>$tags</code> if not already present, and</li>
<li>adds the current post’s slug to a variable (like <code>$tags_4</code>) named after where in <code>$tags</code> (^) the list of posts having the tag it holds is…</li>
</ol>
<p>… as seen:</p>
<pre><code><span>for</span><span> tag </span><span>in </span><span>$</span><span>post_tags</span><span>; </span><span>do
</span><span>    </span><span># check if $tags has the current tag:
</span><span>    </span><span>case </span><span>&#34; $</span><span>tags </span><span>&#34; </span><span>in
</span><span>        *&#34; $</span><span>tag </span><span>&#34;*</span><span>) </span><span>;;
</span><span>        </span><span># if it doesn&#39;t, add the current tag to it:
</span><span>        *</span><span>) </span><span>tags</span><span>=&#34;$</span><span>tags </span><span>$</span><span>tag</span><span>&#34;;;
</span><span>    </span><span>esac
</span><span>    </span><span># (using get_tag_index as explained below)
</span><span>    </span><span>tagn</span><span>=$</span><span>(</span><span>get_tag_index </span><span>$</span><span>tag</span><span>)
</span><span>    </span><span># based on tagn, add the current $post_slug,
</span><span>    </span><span># to a variable based on the tagn index, like tag_3
</span><span>    </span><span>eval </span><span>&#34;</span><span>tag_</span><span>$</span><span>{</span><span>tagn</span><span>}=</span><span>\&#34;\$</span><span>{tag_</span><span>$</span><span>{</span><span>tagn</span><span>}} </span><span>$</span><span>{</span><span>post_slug</span><span>}</span><span>\&#34;</span><span>&#34;
</span><span>done
</span><span>
</span><span>for</span><span> tag </span><span>in </span><span>$</span><span>post_tags</span><span>; </span><span>do
</span><span>    </span><span>tagn</span><span>=$</span><span>(</span><span>get_tag_index </span><span>$</span><span>tag</span><span>)
</span><span>    </span><span>eval </span><span>&#34;</span><span>tag_</span><span>$</span><span>{</span><span>tagn</span><span>}_html=</span><span>\&#34;\$</span><span>{tag_</span><span>$</span><span>{</span><span>tagn</span><span>}_html-}
</span><span>$</span><span>{</span><span>article</span><span>}</span><span>\&#34;</span><span>&#34;
</span><span>done
</span></code></pre>
<p>Effectively maintaining an account of the posts under each tag.</p>
<details><summary>getting tag index</summary>
<pre><code><span># figure out where in `$tags`, `$1` is:
</span><span>get_tag_index</span><span>() {
</span><span>    </span><span>q</span><span>=$</span><span>1
</span><span>    </span><span>set</span><span> -- $</span><span>tags
</span><span>    </span><span>n</span><span>=</span><span>1
</span><span>    </span><span>for</span><span> t; </span><span>do
</span><span>        </span><span>[ </span><span>&#34;$</span><span>t</span><span>&#34; = &#34;$</span><span>q</span><span>&#34; </span><span>] </span><span>&amp;&amp; {
</span><span>            </span><span>echo </span><span>$</span><span>n
</span><span>            </span><span>return
</span><span>        }
</span><span>        </span><span>n</span><span>=$</span><span>((n</span><span>+</span><span>1</span><span>))
</span><span>    </span><span>done
</span><span>    </span><span>return</span><span> 1
</span><span>}
</span></code></pre>
</details>
<p>So that we may later, after the pass over posts, make a tags page listing all tags and all posts under each tag:</p>
<pre><code><span>tags</span><span>=&#34;$</span><span>{</span><span>tags</span><span>#?</span><span>}</span><span>&#34;
</span><span>tags_html</span><span>=&#34;&#34;
</span><span>
</span><span>for</span><span> tag </span><span>in </span><span>$(
</span><span>    </span><span>for</span><span> tag </span><span>in </span><span>$</span><span>tags</span><span>; </span><span>do
</span><span>        </span><span>echo </span><span>&#34;$</span><span>(
</span><span>            </span><span>echo </span><span>$</span><span>(
</span><span>                </span><span>eval</span><span> echo </span><span>&#34;</span><span>\$</span><span>{tag_</span><span>$</span><span>(
</span><span>                    </span><span>get_tag_index </span><span>$</span><span>tag
</span><span>                )}</span><span>&#34;
</span><span>            ) </span><span>| </span><span>wc</span><span> -w
</span><span>        ) </span><span>$</span><span>tag</span><span>&#34;
</span><span>    </span><span>done </span><span>\
</span><span>        | </span><span>sort</span><span> -nr </span><span>\
</span><span>        | </span><span>cut</span><span> -d</span><span>&#39; &#39;</span><span> -f2-
</span><span>); </span><span>do
</span><span>
</span><span>    </span><span>tags_html</span><span>=&#34;$</span><span>{</span><span>tags_html</span><span>}
</span><span>&lt;section id=&#39;</span><span>$</span><span>{</span><span>tag</span><span>}&#39;&gt;
</span><span>    &lt;header&gt;
</span><span>        &lt;a href=&#39;#</span><span>$</span><span>{</span><span>tag</span><span>}&#39;&gt;</span><span>$</span><span>{</span><span>tag</span><span>}&lt;/a&gt;
</span><span>    &lt;/header&gt;
</span><span>    </span><span>$</span><span>(</span><span>eval</span><span> echo </span><span>\$</span><span>{tag_</span><span>$</span><span>(</span><span>get_tag_index </span><span>$</span><span>tag</span><span>)_html-})
</span><span>&lt;/section&gt;
</span><span>&lt;br&gt;</span><span>&#34;
</span><span>
</span><span>done
</span></code></pre>
<p>You can see the final page at <a href="https://aashvik.com/tags"><code>/tags</code></a>, I’ve added some CSS interactivity to it with <code>:target</code> by linking back to and from posts with links that have URL fragments.</p>
<h3><a href="#index-page" aria-hidden="true" id="index-page"></a>index page</h3>
<p>The script generates a simple index page at <code>/index.html</code>. It’s a list of non-draft posts:</p>
<pre><code><span>article</span><span>=&#34;</span><span>&lt;article post </span><span>$</span><span>{</span><span>post_cats</span><span>} id=&#39;</span><span>$</span><span>{</span><span>post_slug</span><span>}&#39;&gt;
</span><span>    &lt;time datetime=&#39;</span><span>$</span><span>{</span><span>post_date</span><span>}&#39;&gt;
</span><span>        </span><span>$</span><span>{</span><span>post_date</span><span>}
</span><span>    &lt;/time&gt;
</span><span>    &lt;a href=&#39;/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}&#39;
</span><span>        title=&#39;</span><span>$</span><span>{</span><span>post_desc</span><span>} [</span><span>$</span><span>{</span><span>post_tags_comma</span><span>}] [</span><span>$</span><span>{</span><span>post_date</span><span>%??????</span><span>}]&#39;&gt;
</span><span>        </span><span>$</span><span>{</span><span>post_title</span><span>}
</span><span>    &lt;/a&gt;
</span><span>&lt;/article&gt;</span><span>&#34;
</span><span>
</span><span>index</span><span>=&#34;$</span><span>{</span><span>index</span><span>}
</span><span>$</span><span>{</span><span>article</span><span>}</span><span>&#34;
</span></code></pre>
<p>Post categories (the line of post metadata starting with “cats: “, where one of <code>sw</code>, <code>hw</code>, <code>rb</code>, or <code>misc</code> is also present along with an optional <code>gem</code> and/or <code>draft</code>) are also dumped in as attributes of the <code>&lt;a&gt;</code> tag to allow for CSS tricks.</p>
<h3><a href="#drafts" aria-hidden="true" id="drafts"></a>drafts?</h3>
<p>Before adding to the index or feeds, I skip to the end of the current iteration of the “posts” loop if the current post is a draft. To mark a post as a draft, we add <code>draft</code> anywhere in the “cats: “ line of metadata.</p>
<p>Drafts get their own page, at <code>/drafts</code>, similar to the index:</p>
<pre><code><span>echo </span><span>&#34;$</span><span>post_cats</span><span>&#34; | </span><span>grep</span><span> -q</span><span> draft &amp;&amp; {
</span><span>    </span><span>drafts</span><span>=&#34;$</span><span>{</span><span>drafts</span><span>}
</span><span>$</span><span>{</span><span>article</span><span>}</span><span>&#34;
</span><span>    </span><span>continue
</span><span>}
</span></code></pre>
<h3><a href="#feeds" aria-hidden="true" id="feeds"></a>feeds!</h3>
<p>For non-draft posts, the script generates RSS, Atom, and JSON feeds with a sitemap. It’s VERY extraneous. Nobody needs three types of feeds for my website, so I’ll probably only keep Atom. Still, for fun…</p>
<p>For every post, after generating different formats of tags into <code>$post_tags_rss</code>, <code>$post_tags_atom</code>, and <code>post_tags_json</code> as seen above, we append the current post’s information to <code>$items_sitemap</code>, <code>$items_rss</code>, <code>$items_atom</code>, and <code>$items_json</code> by inserting the post’s tags and various metadata.</p>
<p>Click to reveal:</p>
<details><summary>sitemap item</summary>
<p>Pretty short. Sitemaps don’t have too much of an accessibility benefit anymore, and are probably just making scraper bots’ lives easier now, so I’ll remove mine.</p>
<pre><code><span>items_sitemap</span><span>=&#34;$</span><span>{</span><span>items_sitemap</span><span>}
</span><span>&lt;url&gt;
</span><span>    &lt;loc&gt;https://username.com/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}&lt;/loc&gt;
</span><span>    &lt;lastmod&gt;</span><span>$</span><span>{</span><span>post_date</span><span>}&lt;/lastmod&gt;
</span><span>&lt;/url&gt;</span><span>&#34;
</span></code></pre>
</details>
<details><summary>RSS item</summary>
<p>RSS is a convoluted mess of standards, but following the RSS Advisory Board’s 2.0 standard and including as many of their elements as relevant:</p>
<pre><code><span>items_rss</span><span>=&#34;$</span><span>{</span><span>items_rss</span><span>}
</span><span>&lt;item&gt;
</span><span>    &lt;title&gt;</span><span>$</span><span>{</span><span>post_title</span><span>}&lt;/title&gt;
</span><span>    &lt;link&gt;https://username.com/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}&lt;/link&gt;
</span><span>    &lt;description&gt;</span><span>$</span><span>{</span><span>post_desc</span><span>}&lt;/description&gt;
</span><span>    &lt;author&gt;username@username.com (username)&lt;/author&gt;
</span><span>    &lt;dc:creator&gt;username&lt;/dc:creator&gt;
</span><span>    &lt;slash:section&gt;</span><span>$</span><span>{</span><span>post_tags</span><span>%% *</span><span>}&lt;/slash:section&gt;
</span><span>    &lt;slash:department&gt;</span><span>$</span><span>(</span><span>echo </span><span>$</span><span>post_date </span><span>| </span><span>cut</span><span> -c1-4</span><span>)&lt;/slash:department&gt;
</span><span>    &lt;slash:comments&gt;42&lt;/slash:comments&gt;
</span><span>    </span><span>$</span><span>{</span><span>post_tags_rss</span><span>}
</span><span>    &lt;comments&gt;</span><span>$</span><span>{</span><span>post_comment</span><span>}&lt;/comments&gt;
</span><span>    &lt;guid&gt;https://username.com/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}&lt;/guid&gt;
</span><span>    &lt;pubDate&gt;</span><span>$</span><span>(</span><span>date</span><span> -d </span><span>&#34;$</span><span>{</span><span>post_date</span><span>}</span><span>&#34;</span><span> +</span><span>&#34;</span><span>%a, %d %b %Y</span><span>&#34;</span><span>) 00:00:00 UT&lt;/pubDate&gt;
</span><span>    &lt;source url=&#39;https://username.com/rss.xml&#39;&gt;username&lt;/source&gt;
</span><span>&lt;/item&gt;</span><span>&#34;
</span></code></pre>
</details>
<details open=""><summary>Atom item</summary>
<p>Atom is, in my opinion, infinitely better than RSS. The spec is a lot cleaner and more straightforward. Since virtually every feed reader supports Atom, I think this is the one feed that I’ll leave on my site.</p>
<pre><code><span>items_atom</span><span>=&#34;$</span><span>{</span><span>items_atom</span><span>}
</span><span>&lt;entry&gt;
</span><span>  &lt;id&gt;https://username.com/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}&lt;/id&gt;
</span><span>  &lt;title&gt;</span><span>$</span><span>{</span><span>post_title</span><span>}&lt;/title&gt;
</span><span>  &lt;updated&gt;</span><span>$</span><span>{</span><span>post_date</span><span>}T00:00:00Z&lt;/updated&gt;
</span><span>  &lt;link rel=&#39;alternate&#39; type=&#39;text/html&#39; href=&#39;https://username.com/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}&#39;/&gt;
</span><span>  &lt;summary&gt;</span><span>$</span><span>{</span><span>post_desc</span><span>}&lt;/summary&gt;
</span><span>  </span><span>$</span><span>{</span><span>post_tags_atom</span><span>}
</span><span>  &lt;published&gt;</span><span>$</span><span>{</span><span>post_date</span><span>}T00:00:00Z&lt;/published&gt;
</span><span>&lt;/entry&gt;</span><span>&#34;
</span></code></pre>
</details>
<details><summary>JSON item</summary>
<p>The JSON feed spec is a pretty new syndication format. I see no reason to use this over or alongside Atom, so it will not make the cut.</p>
<pre><code><span>items_json</span><span>=&#34;$</span><span>{</span><span>items_json</span><span>}
</span><span>{
</span><span>    </span><span>\&#34;</span><span>id</span><span>\&#34;</span><span>: </span><span>\&#34;</span><span>$</span><span>{</span><span>post_slug</span><span>}</span><span>\&#34;</span><span>,
</span><span>    </span><span>\&#34;</span><span>url</span><span>\&#34;</span><span>: </span><span>\&#34;</span><span>https://username.com/posts/</span><span>$</span><span>{</span><span>post_slug</span><span>}</span><span>\&#34;</span><span>,
</span><span>    </span><span>\&#34;</span><span>title</span><span>\&#34;</span><span>: </span><span>\&#34;</span><span>$</span><span>(</span><span>sed</span><span> -n </span><span>&#39;</span><span>3p</span><span>&#39; $</span><span>md </span><span>| </span><span>sed </span><span>&#39;</span><span>s/&#34;/\\&#34;/g</span><span>&#39;</span><span>)</span><span>\&#34;</span><span>,
</span><span>    </span><span>\&#34;</span><span>summary</span><span>\&#34;</span><span>: </span><span>\&#34;</span><span>$</span><span>(</span><span>sed</span><span> -n </span><span>&#39;</span><span>4p</span><span>&#39; $</span><span>md </span><span>| </span><span>sed </span><span>&#39;</span><span>s/&#34;/\\&#34;/g</span><span>&#39;</span><span>)</span><span>\&#34;</span><span>,
</span><span>    </span><span>\&#34;</span><span>date_published</span><span>\&#34;</span><span>: </span><span>\&#34;</span><span>$</span><span>{</span><span>post_date</span><span>}</span><span>\&#34;</span><span>,
</span><span>    </span><span>\&#34;</span><span>tags</span><span>\&#34;</span><span>: </span><span>$</span><span>{</span><span>post_tags_json</span><span>}
</span><span>},</span><span>&#34;
</span></code></pre>
<p>I pipe title and description into a <code>sed &#39;s/&#34;/\\&#34;/g&#39;</code> to escape any doublequotes therein.</p>
</details>
<p>The root of my repo has a folder <code>template/</code> containing the static parts of feeds and sitemap, the template into which <code>$items_*</code>s are injected. Since I’ll soon be removing all but my Atom feed to cut redundancy, here they are, my very extra feed templates, using almost every feature the feed spec provides:</p>
<details open=""><summary>atom.xml</summary>
<p>Significantly more concise than RSS!</p>
<pre><code><span>&lt;?</span><span>xml </span><span>version</span><span>=&#34;</span><span>1.0</span><span>&#34; </span><span>encoding</span><span>=&#34;</span><span>utf-8</span><span>&#34;?&gt;
</span><span>&lt;</span><span>feed </span><span>xmlns</span><span>=&#34;</span><span>http://www.w3.org/2005/Atom</span><span>&#34;&gt;
</span><span>    &lt;</span><span>id</span><span>&gt;https://username.com/&lt;/</span><span>id</span><span>&gt;
</span><span>    &lt;</span><span>title</span><span>&gt;username&#39;s feed&lt;/</span><span>title</span><span>&gt;
</span><span>    &lt;</span><span>updated</span><span>&gt;${date_8601}&lt;/</span><span>updated</span><span>&gt;
</span><span>    &lt;</span><span>author</span><span>&gt;
</span><span>        &lt;</span><span>name</span><span>&gt;username&lt;/</span><span>name</span><span>&gt;
</span><span>        &lt;</span><span>email</span><span>&gt;username@username.com&lt;/</span><span>email</span><span>&gt;
</span><span>    &lt;/</span><span>author</span><span>&gt;
</span><span>    &lt;</span><span>link </span><span>type</span><span>=&#34;</span><span>text/html</span><span>&#34; </span><span>href</span><span>=&#34;</span><span>https://username.com</span><span>&#34;/&gt;
</span><span>    &lt;</span><span>link </span><span>rel</span><span>=&#34;</span><span>self</span><span>&#34; </span><span>type</span><span>=&#34;</span><span>application/atom+xml</span><span>&#34; </span><span>title</span><span>=&#34;</span><span>username.com&#39;s atom feed</span><span>&#34; </span><span>href</span><span>=&#34;</span><span>https://username.com/atom.xml</span><span>&#34;/&gt;
</span><span>    &lt;</span><span>link </span><span>rel</span><span>=&#34;</span><span>alternate</span><span>&#34; </span><span>type</span><span>=&#34;</span><span>application/rss+xml</span><span>&#34; </span><span>title</span><span>=&#34;</span><span>username.com&#39;s rss feed</span><span>&#34; </span><span>href</span><span>=&#34;</span><span>/rss.xml</span><span>&#34;/&gt;
</span><span>    &lt;</span><span>link </span><span>rel</span><span>=&#34;</span><span>alternate</span><span>&#34; </span><span>type</span><span>=&#34;</span><span>application/feed+json</span><span>&#34; </span><span>title</span><span>=&#34;</span><span>username.com&#39;s json feed</span><span>&#34; </span><span>href</span><span>=&#34;</span><span>/feed.json</span><span>&#34;/&gt;
</span><span>    &lt;</span><span>category </span><span>term</span><span>=&#34;</span><span>weblog</span><span>&#34; </span><span>scheme</span><span>=&#39;</span><span>https://username.com</span><span>&#39; </span><span>label</span><span>=&#39;</span><span>weblog</span><span>&#39;/&gt;
</span><span>    &lt;</span><span>generator </span><span>uri</span><span>=&#34;</span><span>https://username.com/gen.sh</span><span>&#34;&gt;my POSIX-shell static-site-generator script&lt;/</span><span>generator</span><span>&gt;
</span><span>    &lt;</span><span>icon</span><span>&gt;/favicon.png&lt;/</span><span>icon</span><span>&gt;&lt;</span><span>logo</span><span>&gt;/favicon.png&lt;/</span><span>logo</span><span>&gt;
</span><span>    &lt;</span><span>rights</span><span>&gt;© 2024—2025 username CC BY-NC-SA&lt;/</span><span>rights</span><span>&gt;
</span><span>    &lt;</span><span>subtitle</span><span>&gt;An Atom feed of posts from username.com: computers, robotics, and more.&lt;/</span><span>subtitle</span><span>&gt;
</span><span>    ${items_atom}
</span><span>&lt;/</span><span>feed</span><span>&gt;
</span></code></pre>
</details>
<details><summary>feed.json</summary>
<p>Nice, but obscure…</p>
<pre><code><span>{
</span><span>    &#34;</span><span>version</span><span>&#34;: &#34;</span><span>https://jsonfeed.org/version/1.1</span><span>&#34;,
</span><span>    &#34;</span><span>title</span><span>&#34;: &#34;</span><span>username&#39;s feed</span><span>&#34;,
</span><span>    &#34;</span><span>home_page_url</span><span>&#34;: &#34;</span><span>https://username.com/</span><span>&#34;,
</span><span>    &#34;</span><span>feed_url</span><span>&#34;: &#34;</span><span>https://username.com/feed.json</span><span>&#34;,
</span><span>    &#34;</span><span>description</span><span>&#34;: &#34;</span><span>An JSON feed of posts from username.com: computers, robotics, and more.</span><span>&#34;,
</span><span>    &#34;</span><span>user_comment</span><span>&#34;: &#34;</span><span>This feed links to posts on username.com</span><span>&#34;,
</span><span>    &#34;</span><span>icon</span><span>&#34;: &#34;</span><span>https://username.com/favicon.png</span><span>&#34;,
</span><span>    &#34;</span><span>favicon</span><span>&#34;: &#34;</span><span>https://username.com/favicon.png</span><span>&#34;,
</span><span>    &#34;</span><span>authors</span><span>&#34;: [{
</span><span>        &#34;</span><span>name</span><span>&#34;: &#34;</span><span>username</span><span>&#34;,
</span><span>        &#34;</span><span>url</span><span>&#34;: &#34;</span><span>mailto:username@username.com</span><span>&#34;,
</span><span>        &#34;</span><span>avatar</span><span>&#34;: &#34;</span><span>https://username.com/favicon.png</span><span>&#34;
</span><span>    }],
</span><span>    &#34;</span><span>language</span><span>&#34;: &#34;</span><span>en</span><span>&#34;,
</span><span>    &#34;</span><span>expired</span><span>&#34;: </span><span>false</span><span>,
</span><span>    &#34;</span><span>items</span><span>&#34;: [</span><span>$</span><span>{</span><span>items_json</span><span>}]
</span><span>}
</span></code></pre>
</details>
<details><summary>rss.xml</summary>
<p>A bloated mess of redundant elements…</p>
<pre><code><span>&lt;?</span><span>xml </span><span>version</span><span>=&#34;</span><span>1.0</span><span>&#34; </span><span>encoding</span><span>=&#34;</span><span>UTF-8</span><span>&#34;?&gt;
</span><span>&lt;</span><span>rss </span><span>version</span><span>=&#34;</span><span>2.0</span><span>&#34; </span><span>xmlns:atom</span><span>=&#34;</span><span>https://www.w3.org/2005/Atom</span><span>&#34; </span><span>xmlns:content</span><span>=&#34;</span><span>https://purl.org/rss/1.0/modules/content/</span><span>&#34; </span><span>xmlns:dc</span><span>=&#34;</span><span>https://purl.org/dc/elements/1.1/</span><span>&#34; </span><span>xmlns:slash</span><span>=&#34;</span><span>https://purl.org/rss/1.0/modules/slash/</span><span>&#34;&gt;
</span><span>    &lt;</span><span>channel</span><span>&gt;
</span><span>        &lt;</span><span>title</span><span>&gt;username&#39;s feed&lt;/</span><span>title</span><span>&gt;
</span><span>        &lt;</span><span>link</span><span>&gt;https://username.com&lt;/</span><span>link</span><span>&gt;
</span><span>        &lt;</span><span>atom:link </span><span>href</span><span>=&#34;</span><span>https://username.com/rss.xml</span><span>&#34; </span><span>rel</span><span>=&#34;</span><span>self</span><span>&#34; </span><span>type</span><span>=&#34;</span><span>application/rss+xml</span><span>&#34; /&gt;
</span><span>        &lt;</span><span>description</span><span>&gt;An RSS feed of posts from username.com: computers, robotics, and more.&lt;/</span><span>description</span><span>&gt;
</span><span>        &lt;</span><span>language</span><span>&gt;en&lt;/</span><span>language</span><span>&gt;
</span><span>        &lt;</span><span>copyright</span><span>&gt;© 2024—2025 username CC BY-NC-SA&lt;/</span><span>copyright</span><span>&gt;
</span><span>        &lt;</span><span>managingEditor</span><span>&gt;username@username.com (username)&lt;/</span><span>managingEditor</span><span>&gt;
</span><span>        &lt;</span><span>webMaster</span><span>&gt;username@username.com (username)&lt;/</span><span>webMaster</span><span>&gt;
</span><span>        &lt;</span><span>pubDate</span><span>&gt;${date_2822}&lt;/</span><span>pubDate</span><span>&gt;
</span><span>        &lt;</span><span>lastBuildDate</span><span>&gt;${date_2822}&lt;/</span><span>lastBuildDate</span><span>&gt;
</span><span>        &lt;</span><span>category</span><span>&gt;weblog&lt;/</span><span>category</span><span>&gt;
</span><span>        &lt;</span><span>generator</span><span>&gt;https://username.com/gen.sh&lt;/</span><span>generator</span><span>&gt;
</span><span>        &lt;</span><span>docs</span><span>&gt;https://www.rssboard.org/rss-specification&lt;/</span><span>docs</span><span>&gt;
</span><span>        &lt;</span><span>image</span><span>&gt;
</span><span>            &lt;</span><span>link</span><span>&gt;https://username.com&lt;/</span><span>link</span><span>&gt;
</span><span>            &lt;</span><span>title</span><span>&gt;username&#39;s feed&lt;/</span><span>title</span><span>&gt;
</span><span>            &lt;</span><span>url</span><span>&gt;https://username.com/favicon.png&lt;/</span><span>url</span><span>&gt;
</span><span>            &lt;</span><span>description</span><span>&gt;Read the username.com feed!&lt;/</span><span>description</span><span>&gt;
</span><span>            &lt;</span><span>height</span><span>&gt;48&lt;/</span><span>height</span><span>&gt;
</span><span>              &lt;</span><span>width</span><span>&gt;48&lt;/</span><span>width</span><span>&gt;
</span><span>        &lt;/</span><span>image</span><span>&gt;
</span><span>        ${items_rss}
</span><span>    &lt;/</span><span>channel</span><span>&gt;
</span><span>&lt;/</span><span>rss</span><span>&gt;
</span></code></pre>
</details>
<details><summary>sitemap.xml</summary>
<p>Sadly useles…</p>
<pre><code><span>&lt;?</span><span>xml </span><span>version</span><span>=&#34;</span><span>1.0</span><span>&#34; </span><span>encoding</span><span>=&#34;</span><span>UTF-8</span><span>&#34;?&gt;
</span><span>&lt;</span><span>urlset </span><span>xmlns</span><span>=&#34;</span><span>http://www.sitemaps.org/schemas/sitemap/0.9</span><span>&#34;&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;1.0&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/tags&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/drafts&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.2&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/404.html&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/rss.xml&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/atom.xml&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/feed.json&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/sitemap.xml&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/gen.sh&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   &lt;</span><span>url</span><span>&gt;
</span><span>      &lt;</span><span>loc</span><span>&gt;https://www.username.com/1kb&lt;/</span><span>loc</span><span>&gt;
</span><span>      &lt;</span><span>lastmod</span><span>&gt;${date_8601}&lt;/</span><span>lastmod</span><span>&gt;
</span><span>      &lt;</span><span>priority</span><span>&gt;0.7&lt;/</span><span>priority</span><span>&gt;
</span><span>   &lt;/</span><span>url</span><span>&gt;
</span><span>   ${items_sitemap}
</span><span>&lt;/</span><span>urlset</span><span>&gt;
</span></code></pre>
</details>
<p>Later, using the filled <code>$items_sitemap</code>, <code>$items_rss</code>, <code>$items_atom</code>, and <code>$items_json</code>, we build the main index page and all feeds…</p>
<pre><code><span># (8601 for atom and sitemap, like date -uIseconds)
</span><span># (2822 for rss, like date -uR)
</span><span>export </span><span>post_title</span><span>=</span><span>username </span><span>\
</span><span>    </span><span>post_desc</span><span>=&#34;</span><span>computers, robotics, and more</span><span>&#34; \
</span><span>    </span><span>post_tags_comma</span><span>=&#34;</span><span>index, home, landing, blog</span><span>&#34; \
</span><span>    </span><span>post_content</span><span>=&#34;
</span><span>&lt;p&gt;View &lt;span sw&gt;software&lt;/span&gt;,
</span><span>&lt;span hw&gt;hardware&lt;/span&gt;,
</span><span>&lt;span rb&gt;robotics&lt;/span&gt;,
</span><span>&lt;span misc&gt;miscellaneous&lt;/span&gt;,
</span><span>or &lt;a href=/drafts&gt;drafts&lt;/a&gt;.&lt;/p&gt;
</span><span>&lt;nav&gt;</span><span>$</span><span>{</span><span>index</span><span>}&lt;/nav&gt;</span><span>&#34; \
</span><span>    </span><span>items_sitemap </span><span>\
</span><span>    </span><span>items_rss </span><span>\
</span><span>    </span><span>items_atom </span><span>\
</span><span>    </span><span>items_json </span><span>\
</span><span>    </span><span>date_8601</span><span>=$</span><span>(</span><span>date</span><span> -u</span><span> +</span><span>%</span><span>Y</span><span>-</span><span>%</span><span>m</span><span>-</span><span>%</span><span>dT</span><span>%</span><span>H</span><span>:</span><span>%</span><span>M</span><span>:</span><span>%</span><span>SZ</span><span>) </span><span>\
</span><span>    </span><span>date_2822</span><span>=&#34;$</span><span>(</span><span>date</span><span> -u</span><span> +</span><span>&#39;</span><span>%a, %d %b %Y %H:%M:%S UT</span><span>&#39;</span><span>)</span><span>&#34;
</span></code></pre>
<p>With a fun trick enabled by the contents of our <code>template</code> folder!</p>
<pre><code><span>for</span><span> file </span><span>in</span><span> template/*; </span><span>do
</span><span>    </span><span>envsubst </span><span>&lt; $</span><span>file </span><span>&gt; public/$(</span><span>basename </span><span>$</span><span>file</span><span>)
</span><span>done
</span></code></pre>
<p>(^ As the <code>sitemap.xml</code>, <code>rss.xml</code>, <code>atom.xml</code>, <code>feed.json</code>, and <code>index.html</code> correspond exactly to the desired output files at the root of the website in <code>public/</code>)</p>
<h3><a href="#other-pages" aria-hidden="true" id="other-pages"></a>other pages</h3>
<p>Aside from the contents of <code>/public/posts/</code> and the feeds and index generated from <code>template/</code>, a few other pages are built with <code>envsubst</code>, including a <a href="https://aashvik.com/gen.sh"><code>gen.sh</code></a> self-recursing display and a 404 page:</p>
<pre><code><span>mkdir</span><span> public/gen.sh
</span><span>
</span><span>post_title</span><span>=&#34;</span><span>gen.sh</span><span>&#34; \
</span><span>post_desc</span><span>=&#34;</span><span>static site generator</span><span>&#34; \
</span><span>post_tags_comma=&#34;</span><span>generator, script, ssg</span><span>&#34; \
</span><span>head_extension=&#34;</span><span>&lt;style&gt;body {width: 80ch;}&lt;/style&gt;</span><span>&#34; \
</span><span>post_content=&#34;$</span><span>(
</span><span>    </span><span>printf </span><span>&#39;</span><span># gen.sh\n```sh\n%s\n```</span><span>&#39; </span><span>\
</span><span>    </span><span>&#34;$</span><span>(</span><span>cat</span><span> gen.sh)</span><span>&#34; </span><span>\
</span><span>    </span><span>| </span><span>comrak
</span><span>)</span><span>&#34; \
</span><span>envsubst &lt; template/index.html &gt; public/gen.sh/index.html
</span><span>
</span><span>
</span><span>post_title</span><span>=&#34;</span><span>404 not found</span><span>&#34; \
</span><span>post_desc</span><span>=&#34;</span><span>404 page</span><span>&#34; \
</span><span>post_tags_comma=&#34;</span><span>404, not found</span><span>&#34; \
</span><span>post_content=&#34;</span><span>&lt;h1&gt;404&lt;/h1&gt;&lt;p&gt;¯\_(ツ)_/¯&lt;/p&gt;</span><span>&#34; \
</span><span>envsubst &lt; template/index.html &gt; public/404.html
</span></code></pre>
<p>After processing posts, the <a href="https://aashvik.com/drafts"><code>/drafts</code></a> page is built, and after processing tags, the <a href="https://aashvik.com/tags"><code>/tags</code></a> page is built.</p>
<pre><code><span>mkdir</span><span> -p</span><span> public/tags
</span><span>
</span><span>post_title</span><span>=</span><span>tags </span><span>\
</span><span>post_desc</span><span>=&#34;</span><span>post tags and categories</span><span>&#34; \
</span><span>post_tags_comma=&#34;</span><span>tags, categories</span><span>&#34; \
</span><span>post_content=&#34;</span><span>&lt;h1&gt;tags&lt;/h1&gt;&lt;nav&gt;</span><span>$</span><span>{</span><span>tags_html</span><span>%</span><span>&lt;br&gt;}&lt;/nav&gt;</span><span>&#34; \
</span><span>envsubst &lt; template/index.html &gt; &#34;</span><span>public/tags/index.html</span><span>&#34;
</span><span>
</span><span>mkdir</span><span> -p</span><span> public/drafts/
</span><span>
</span><span>post_title</span><span>=</span><span>drafts </span><span>\
</span><span>post_desc</span><span>=&#34;</span><span>drafts and unindexed posts</span><span>&#34; \
</span><span>post_tags_comma=&#34;</span><span>drafts, posts, wip</span><span>&#34; \
</span><span>post_content=&#34;</span><span>&lt;h1&gt;drafts&lt;/h1&gt;&lt;nav&gt;</span><span>$</span><span>{</span><span>drafts</span><span>}&lt;/nav&gt;</span><span>&#34; \
</span><span>envsubst &lt; template/index.html &gt; &#34;</span><span>public/drafts/index.html</span><span>&#34;
</span></code></pre>
<p>And that’s about all it takes to make the script generate a full website.</p>
<h2><a href="#why-shell" aria-hidden="true" id="why-shell"></a>Why shell?</h2>
<p>Well, <em>not</em> really because it’s portable, as despite being a “POSIX script”, most of the <code>date</code> and <code>sed</code> tricks I do don’t work on the BSD versions of those commands, with comrak, additionally, being a dependency.</p>
<p><em>Certainly not</em> because it lets this script be highly configurable, extensible, reusable, or safe for strangers. This script is very much <em><u>site-specific machinery</u></em>, a generator for a very specific site with my preferences hardcoded.</p>
<p>More because shell is easy to write, and very close to the filesystem. Many command line utilities are available, and it’s <em>fun</em> to glue them together and string pipes.</p>
<p>It’s <em>fun</em> to write in shell. And in this case, it’s fast enough.</p>
<h2><a href="#outcome" aria-hidden="true" id="outcome"></a>Outcome</h2>
<p>The site works great! I’ve got GitHub Actions <a href="https://github.com/aashvikt/aashvikt.github.io/blob/main/.github/workflows/publish.yml">set up</a> to build it (after setting up the Rust toolchain for comrak, if needed) every commit, and it’s decent, with changes to my site usually being visible in an acceptable 30 seconds (not including the initial run with comrak rebuild) despite <code>./gen.sh</code> alone executing in under a second on my machine.</p>
<p>And most importantly, I understand the script’s one file end to end, which is, for me, the entire point.</p>
<!-- Six hundred and eighty-one lines? Whuh... I do suppose that's mostly the feed templates which I pasted in, hehe, and the long, abrupt code blocks nearly one-to-one with the actual script, so it does make sense... -->

<p><a href="mailto:comments@aashvik.com?subject=Comment%20on%20%22an%20ssg%20written%20in%20shell%22%20from%20aashvik.com%2Fposts%2Fshell-ssg">Comment on &#34;an ssg written in shell&#34;</a></p></div></div>
  </body>
</html>
