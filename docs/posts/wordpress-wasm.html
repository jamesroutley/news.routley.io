<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/adamziel/wordpress-wasm">Original</a>
    <h1>WordPress WASM</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/adamziel/wordpress-wasm/blob/trunk/demo.gif"><img src="https://github.com/adamziel/wordpress-wasm/raw/trunk/demo.gif" alt="" data-animated-image=""/></a></p>
<p dir="auto"><a href="https://stackblitz.com/edit/wp-plugin-playground" rel="nofollow">https://stackblitz.com/edit/wp-plugin-playground</a></p>
<p dir="auto">A writeup with details of how this work is coming! The README doc below is a short&amp;sweet form without too many details.</p>
<h2 dir="auto"><a id="user-content-running-the-demo" aria-hidden="true" href="#running-the-demo"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Running the demo</h2>
<p dir="auto">This repository ships with a pre-built demo that you can just run!</p>
<ol dir="auto">
<li>Clone this repo</li>
<li>Run <code>npm run dev</code></li>
<li>Visit <a href="http://127.0.0.1:8777/wordpress.html" rel="nofollow">http://127.0.0.1:8777/wordpress.html</a></li>
</ol>
<p dir="auto">If you want to build the assembly yourself, follow the instructions below.</p>
<p dir="auto">This repo draws inspiration from <a href="https://github.com/seanmorris/php-wasm">https://github.com/seanmorris/php-wasm</a> and uses <a href="https://github.com/aaemnnosttv/wp-sqlite-db">https://github.com/aaemnnosttv/wp-sqlite-db</a></p>
<h2 dir="auto"><a id="user-content-building-the-assembly" aria-hidden="true" href="#building-the-assembly"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building the assembly</h2>
<p dir="auto">The build process is split into automated parts. The scripts below create a docker image with the necessary tools, and build  PHP as WebAssembly.</p>
<h3 dir="auto"><a id="user-content-building-wasm-php-for-the-web" aria-hidden="true" href="#building-wasm-php-for-the-web"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building WASM PHP for the web</h3>

<h3 dir="auto"><a id="user-content-building-wasm-php-for-nodejs" aria-hidden="true" href="#building-wasm-php-for-nodejs"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Building WASM PHP for node.js</h3>

<p dir="auto">If you&#39;d like to customize the packaged WordPress installation, study and update
the build scripts accordingly.</p>
<h2 dir="auto"><a id="user-content-how-does-it-work" aria-hidden="true" href="#how-does-it-work"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>How does it work?</h2>
<p dir="auto">This repo uses four magic ingredients to make WordPress work in the browser:</p>
<ol dir="auto">
<li>A WordPress configured to use SQLite instead of MySQL. This is possible thanks to <a href="https://github.com/aaemnnosttv/wp-sqlite-db">https://github.com/aaemnnosttv/wp-sqlite-db</a>.</li>
<li>A PHP 7.4 compiled with SQLite3 support into WebAssembly.</li>
<li>A PHP + WordPress WebAssembly bundle created using the emscripten toolkit.</li>
<li>A service worker that loads the bundle and dispatches the regular HTTP traffic to the in-memory WordPress instance.</li>
</ol>
<p dir="auto">The static files (.js, .css, etc.) are served directly from the host filesystem, not from the WebAssembly bundle.</p>
<p dir="auto">The work is <em>heavily</em> inspired by <a href="https://github.com/seanmorris/php-wasm">https://github.com/seanmorris/php-wasm</a>.</p>
<h2 dir="auto"><a id="user-content-limitations" aria-hidden="true" href="#limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Limitations</h2>
<p dir="auto">The worker applies a series of strange patches to WordPress, it&#39;s unclear why they&#39;re needed at the moment.</p>
<p dir="auto">The site editor does not work at the moment. The block editor does, though.</p>
<p dir="auto">PHP cannot communicate with WordPress.org so the plugin directory etc does not work.</p>
<p dir="auto">The sqlite database lives in the memory and the changes only live as long as the service worker.</p>
<h2 dir="auto"><a id="user-content-future-work" aria-hidden="true" href="#future-work"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Future work</h2>
<ul dir="auto">
<li>Fix the workarounds mentioned above</li>
<li>Remove the static files from the wasm bundle</li>
<li>Remove unnecessary PHP extensions to lower the bundle size</li>
</ul>
</article>
          </div></div>
  </body>
</html>
