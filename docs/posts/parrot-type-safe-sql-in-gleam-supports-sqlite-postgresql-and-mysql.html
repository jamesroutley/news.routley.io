<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/daniellionel01/parrot">Original</a>
    <h1>Parrot â€“ type-safe SQL in Gleam, supports SQlite, PostgreSQL and MySQL</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto"><a href="https://hex.pm/packages/parrot" rel="nofollow"><img src="https://camo.githubusercontent.com/78544d22e07117af4c3de6097066c60d87e64f1aaebf254609a7e77948dfaa32/68747470733a2f2f696d672e736869656c64732e696f2f686578706d2f762f706172726f74" alt="Package Version" data-canonical-src="https://img.shields.io/hexpm/v/parrot"/></a>
<a href="https://hexdocs.pm/parrot/" rel="nofollow"><img src="https://camo.githubusercontent.com/4bb6f0346c92c97533ee101eb333cf8ab3c7c7285aa966aed1ba529e055f398b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f6865782d646f63732d666661666633" alt="Hex Docs" data-canonical-src="https://img.shields.io/badge/hex-docs-ffaff3"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/aa0e02b50aa124146e82ebee7620d4f3ce2fb9974b6b9e0b6249d13a588e412d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7461726765742d65726c616e672d613230303365"><img src="https://camo.githubusercontent.com/aa0e02b50aa124146e82ebee7620d4f3ce2fb9974b6b9e0b6249d13a588e412d/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7461726765742d65726c616e672d613230303365" alt="erlang" data-canonical-src="https://img.shields.io/badge/target-erlang-a2003e"/></a></p>
<blockquote>
<p dir="auto">ğŸš¨ <strong>Exciting News</strong></p>
</blockquote>

<ul dir="auto">
<li><a href="#">ğŸ¦œ Parrot / type-safe SQL in gleam</a>
<ul dir="auto">
<li><a href="#features">Features</a></li>
<li><a href="#usage--getting-started">Usage / Getting Started</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#development">Development</a></li>
<li><a href="#quirks">Quirks</a></li>
<li><a href="#faq">FAQ</a></li>
<li><a href="#future-work">Future Work</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul>
</li>
</ul>
<p dir="auto"><i><a href="http://ecotrust-canada.github.io/markdown-toc/" rel="nofollow">Table of contents generated with markdown-toc</a></i></p>

<p dir="auto"><strong>Most of the heavy lifting features are provided by / built into sqlc, I do not aim to take credit for them.</strong></p>
<p dir="auto">â˜‘ï¸ Supports SQlite, PostgreSQL and MySQL.</p>
<p dir="auto"><sup>*1</sup>: Meaning that it infers the names of the parameters from your sql queries in the gleam function you call. for example for a query called <code>FindUser</code>, defined as <code>SELECT * FROM user WHERE username = $1</code>, parrot will produce a function where the arguments match those column names: <code>pub fn find_user(username: String) { ... }</code>. If you have multiple parameters of the same data types this can avoid confusion and bugs.</p>




<ul dir="auto">
<li>Parrot will look for all *.sql files in any sql directory under your project&#39;s src directory.</li>
<li>Each *.sql file can contain as many SQL queries as you want.</li>
<li>All of the queries will compile into a single <code>src/[project name]/sql.gleam</code> module.</li>
</ul>
<p dir="auto">Here are some links to help you start out, if you are unfamiliar with the <a href="https://sqlc.dev/" rel="nofollow">sqlc</a> annotation syntax:</p>
<ul dir="auto">
<li><a href="https://docs.sqlc.dev/en/stable/tutorials/getting-started-mysql.html#schema-and-queries" rel="nofollow">Getting started with MySQL</a></li>
<li><a href="https://docs.sqlc.dev/en/stable/tutorials/getting-started-postgresql.html#schema-and-queries" rel="nofollow">Getting started with PostgreSQL</a></li>
<li><a href="https://docs.sqlc.dev/en/stable/tutorials/getting-started-sqlite.html#schema-and-queries" rel="nofollow">Getting started with SQlite</a></li>
</ul>
<p dir="auto">Here is an example of the file structure:</p>
<div dir="auto" data-snippet-clipboard-copy-content="â”œâ”€â”€ gleam.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ app.gleam
â”‚Â Â  â””â”€â”€ sql
â”‚Â Â      â”œâ”€â”€ auth.sql
â”‚Â Â      â””â”€â”€ posts.sql
â””â”€â”€ test
   â””â”€â”€ app_test.gleam"><pre>â”œâ”€â”€ gleam.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ app.gleam
â”‚Â Â  â””â”€â”€ sql
â”‚Â Â      â”œâ”€â”€ auth.sql
â”‚Â Â      â””â”€â”€ posts.sql
â””â”€â”€ <span>test</span>
   â””â”€â”€ app_test.gleam</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="# automatically detects database &amp; engine from env (DATABASE_URL by default)
$ gleam run -m parrot

# provide connection string from different environment variable
$ gleam run -m parrot -- -e PG_DATABASE_URL

# specify sqlite file
$ gleam run -m parrot -- --sqlite &lt;file_path&gt;

# see all options
$ gleam run -m parrot help"><pre><span><span>#</span> automatically detects database &amp; engine from env (DATABASE_URL by default)</span>
$ gleam run -m parrot

<span><span>#</span> provide connection string from different environment variable</span>
$ gleam run -m parrot -- -e PG_DATABASE_URL

<span><span>#</span> specify sqlite file</span>
$ gleam run -m parrot -- --sqlite <span>&lt;</span>file_path<span>&gt;</span>

<span><span>#</span> see all options</span>
$ gleam run -m parrot <span>help</span></pre></div>
<p dir="auto">If you use SQLite, you also need to have installed <a href="https://sqlite.org/index.html" rel="nofollow">sqlite3</a>.</p>
<p dir="auto">If you use MySQL, you also need to have installed <a href="https://dev.mysql.com/doc/refman/9.0/en/mysqldump.html" rel="nofollow">mysqldump</a> (comes by default if you have a mysql client installed).</p>
<p dir="auto">If you use PostgreSQL, you also need to have installed <a href="https://www.postgresql.org/docs/current/app-pgdump.html" rel="nofollow">pg_dump</a> (comes by default if you have a postgresql client installed).</p>

<p dir="auto">You now have type safe access to your sql queries.</p>
<p dir="auto">You might want to write wrapper functions for the database client library of your choice. If you are using <a href="https://github.com/lpil/pog">lpil/pog</a> or <a href="https://github.com/lpil/sqlight">lpil/sqlight</a>, you are in luck!
You can find functions to copy &amp; paste into your codebase here: <a href="https://github.com/daniellionel01/parrot/blob/main/docs/wrappers.md">wrappers</a></p>
<p dir="auto">An example with <a href="https://github.com/lpil/sqlight">lpil/sqlight</a>:</p>
<div dir="auto" data-snippet-clipboard-copy-content="import app/sql
import parrot/dev

fn parrot_to_sqlight(param: dev.Param) -&gt; sqlight.Value {
  // ...
}

pub fn main() {
  // ...

  let #(sql, with, expecting) = sql.get_user_by_username(&#34;alice&#34;)
  let with = parrot_to_sqlight(with)
  let row = sqlight.query(sql, on:, with:, expecting:)

  // ...
}"><pre><span>import</span> <span>app/sql</span>
<span>import</span> <span>parrot/dev</span>

<span>fn</span> <span>parrot_to_sqlight</span><span>(</span><span>param</span><span>:</span> <span><span>dev</span><span>.</span><span>Param</span></span><span>)</span> <span>-&gt;</span> <span><span>sqlight</span><span>.</span><span>Value</span></span> <span>{</span>
  <span>// ...</span>
<span>}</span>

<span>pub</span> <span>fn</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
  <span>// ...</span>

  <span>let</span> <span>#</span><span>(</span><span>sql</span><span>,</span> <span>with</span><span>,</span> <span>expecting</span><span>)</span> <span>=</span> <span>sql</span><span>.</span><span>get_user_by_username</span><span>(</span><span>&#34;alice&#34;</span><span>)</span>
  <span>let</span> <span>with</span> <span>=</span> <span>parrot_to_sqlight</span><span>(</span><span>with</span><span>)</span>
  <span>let</span> <span>row</span> <span>=</span> <span>sqlight</span><span>.</span><span>query</span><span>(</span><span>sql</span><span>,</span> <span>on</span><span>:</span><span>,</span> <span>with</span><span>:</span><span>,</span> <span>expecting</span><span>:</span><span>)</span>

  <span>// ...</span>
<span>}</span></pre></div>

<p dir="auto">If you want to see how this library works in action, take a look at the integration tests:</p>
<ul dir="auto">
<li>PostgreSQL: <a href="https://github.com/daniellionel01/parrot/blob/main/integration/psql">integration/psql</a></li>
<li>MySQL: <a href="https://github.com/daniellionel01/parrot/blob/main/integration/mysql">integration/mysql</a></li>
<li>SQlite: <a href="https://github.com/daniellionel01/parrot/blob/main/integration/sqlite">integration/sqlite</a></li>
</ul>

<p dir="auto"><a href="https://github.com/casey/just">just</a> is used to run project commands.</p>

<p dir="auto">There are scripts to spawn a MySQL or PostgreSQL docker container:</p>
<ul dir="auto">
<li><a href="https://github.com/daniellionel01/parrot/blob/main/bin/mysql.sh">MySQL Script</a></li>
<li><a href="https://github.com/daniellionel01/parrot/blob/main/bin/psql.sh">PostgreSQL Script</a></li>
</ul>
<p dir="auto">For example:</p>
<div dir="auto" data-snippet-clipboard-copy-content="$ ./bin/mysql.sh
# or
$ ./bin/psql.sh"><pre>$ ./bin/mysql.sh
<span><span>#</span> or</span>
$ ./bin/psql.sh</pre></div>

<div dir="auto" data-snippet-clipboard-copy-content="$ just test-sqlite
$ just test-mysql
$ just test-psql"><pre>$ just test-sqlite
$ just test-mysql
$ just test-psql</pre></div>

<p dir="auto">As with everything in software, there are some quirks with this library, due to
the nature of your database of choice and sqlc.</p>

<p dir="auto">If you have an <code>INTEGER[][]</code> column in Postgres, <code>pg_dump</code> does not correctly identify
the column as a two-dimensional array and therefore only gives you a <code>List(Int)</code> instead
of a <code>List(List(Int))</code>. If this is a problem for you, you can raise an issue and
we might come up with a solution or workaround.</p>

<p dir="auto">There are a couple of complex data types that are explictly made <code>dynamic</code>
since they are too complex to handle with the current implementation.
There is a plan for a better and more flexible implementation. Until then,
it will be wrapped in a dynamic type.</p>

<p dir="auto">So here is the catch: you can only execute parrot in an erlang gleam application.
However the generated code will also run in a javascript environment.
So if you need parrot for a javascript project, you can create a separate package and
copy over the generated module and that will work.</p>

<div dir="auto"><h3 tabindex="-1" dir="auto">What flavour of SQL does parrot support?</h3><a id="user-content-what-flavour-of-sql-does-parrot-support" aria-label="Permalink: What flavour of SQL does parrot support?" href="#what-flavour-of-sql-does-parrot-support"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This library supports everything that <a href="https://sqlc.dev/" rel="nofollow">sqlc</a> supports. As the time of this writing that
would be MySQL, PostgreSQL and SQlite.</p>
<p dir="auto">You can read more on language &amp; SQL support here:
<a href="https://docs.sqlc.dev/en/stable/reference/language-support.html" rel="nofollow">https://docs.sqlc.dev/en/stable/reference/language-support.html</a></p>
<div dir="auto"><h3 tabindex="-1" dir="auto">What sqlc features are not supported?</h3><a id="user-content-what-sqlc-features-are-not-supported" aria-label="Permalink: What sqlc features are not supported?" href="#what-sqlc-features-are-not-supported"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>
<p dir="auto">embeddeding structs (<a href="https://docs.sqlc.dev/en/stable/howto/embedding.html" rel="nofollow">https://docs.sqlc.dev/en/stable/howto/embedding.html</a>)</p>
</li>
<li>
<p dir="auto">Certain query annotations are not supported and will panic the process: <code>:execrows</code>, <code>:execlastid</code>, <code>:batchexec</code>, <code>:batchone</code>, <code>:batchmany</code>, <code>:copyfrom</code>. You can read more about it here: <a href="https://docs.sqlc.dev/en/stable/reference/query-annotations.html" rel="nofollow">https://docs.sqlc.dev/en/stable/reference/query-annotations.html</a></p>
</li>
</ul>

<p dir="auto">Ideas and actionable tasks are collected and organised here: <a href="https://github.com/daniellionel01/parrot/issues">https://github.com/daniellionel01/parrot/issues</a></p>
<p dir="auto">Contributions are welcomed!</p>

<ul dir="auto">
<li>This project was heavily inspired by <code>squirrel</code> (<a href="https://hex.pm/packages/squirrel" rel="nofollow">Hex</a>, <a href="https://github.com/giacomocavalieri/squirrel">GitHub</a>). Thank you <a href="https://github.com/giacomocavalieri">@giacomocavalieri</a>!</li>
<li>Thank you to <code>sqlc</code> (<a href="https://github.com/sqlc-dev/sqlc">GitHub</a>, <a href="https://sqlc.dev/" rel="nofollow">Website</a>)</li>
</ul>
</article></div></div>
  </body>
</html>
