<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mattjhall.co.uk/posts/be-careful-with-go-struct-embedding.html">Original</a>
    <h1>Be careful with Go struct embedding</h1>
    
    <div id="readability-page-1" class="page"><div>
      <div>
        <p>Go has a feature called struct embedding that allows you to compose types. It looks something like this:</p>
<pre><code><span>type</span> <span>Position</span> <span>struct</span> {
	<span>X</span> <span>int</span>
	<span>Y</span> <span>int</span>
}

<span>type</span> <span>Colour</span> <span>struct</span> {
	<span>R</span> <span>byte</span>
	<span>G</span> <span>byte</span>
	<span>B</span> <span>byte</span>
}

<span>type</span> <span>Rectangle</span> <span>struct</span> {
	<span>Position</span>
	<span>Colour</span>
	
	<span>Width</span>  <span>int</span>
	<span>Height</span> <span>int</span>
}

<span>r</span> <span>:=</span> <span>Rectangle</span>{}


<span>fmt</span>.<span>Printf</span>(<span>&#34;%d,%d\n&#34;</span>, <span>r</span>.<span>Position</span>.<span>X</span>, <span>r</span>.<span>Position</span>.<span>Y</span>)


<span>fmt</span>.<span>Printf</span>(<span>&#34;%d,%d\n&#34;</span>, <span>r</span>.<span>X</span>, <span>r</span>.<span>Y</span>)
</code></pre>
<p>But what do you think this code does?</p>
<pre><code><span>type</span> <span>FooService</span> <span>struct</span> {
	<span>URL</span> <span>string</span>
}

<span>type</span> <span>BarConnectionOptions</span> <span>struct</span> {
	<span>URL</span> <span>string</span>
}

<span>type</span> <span>BarService</span> <span>struct</span> {
	<span>BarConnectionOptions</span>
}

<span>type</span> <span>Options</span> <span>struct</span> {
	<span>FooService</span>
	<span>BarService</span>
}

<span>opts</span> <span>:=</span> <span>Options</span>{
	<span>FooService</span>: <span>FooService</span>{<span>URL</span>: <span>&#34;abc.com&#34;</span>},
	<span>BarService</span>: <span>BarService</span>{
		<span>BarConnectionOptions</span>: <span>BarConnectionOptions</span>{
			<span>URL</span>: <span>&#34;xyz.com&#34;</span>,
		},
	},
}

<span>fmt</span>.<span>Println</span>(<span>opts</span>.<span>URL</span>)
</code></pre>
<p>I would expect this to fail to compile as <code>URL</code> is ambiguous. It actually prints <code>abc.com</code>, presumably as it is the least nested version of that field. This happened at the day job, although it was caught in a test. Be careful when embedding structs!</p>

      </div>
    </div></div>
  </body>
</html>
