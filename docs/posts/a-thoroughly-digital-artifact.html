<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/">Original</a>
    <h1>A Thoroughly Digital Artifact</h1>
    
    <div id="readability-page-1" class="page"><div>
    <article>
        

        

        
        
            
                
                <ul>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#a-birthday-wish">A birthday wish</a>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#first-steps">First steps</a>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#meshes-and-solid-bodies">Meshes and solid bodies</a>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#public-data">Public data</a>
                        
                            <ul>
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#from-space">From space?</a>
                                    </li>

                                    
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#in-australia-it-s-pronounced-g-dal">In Australia, it&#39;s pronounced &#34;g&#39;dal&#34;</a>
                                    </li>

                                    
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#cartography-is-complicated">Cartography is complicated</a>
                                    </li>

                                    
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#the-one-custom-script">The one custom script</a>
                                    </li>

                                    
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#a-usable-heightmap">A usable heightmap</a>
                                    </li>

                                    
                                
                            </ul>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#a-mesh-is-born">A mesh is born</a>
                        
                            <ul>
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#back-to-the-realm-of-images">Back to the realm of images</a>
                                    </li>

                                    
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#a-matter-of-scale">A matter of scale</a>
                                    </li>

                                    
                                
                            </ul>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#a-dark-age">A dark age</a>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#test-prints">Test prints</a>
                        
                            <ul>
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#just-try-harder">Just try harder</a>
                                    </li>

                                    
                                
                            </ul>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#final-cut">Final cut</a>
                        
                            <ul>
                                
                                    <li>
                                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#pics-or-it-didn-t-happen">Pics or it didn&#39;t happen</a>
                                    </li>

                                    
                                
                            </ul>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#thank-yous">Thank yous</a>
                        
                    </li>
                
                    <li>
                        <a href="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/#things-i-learned-and-some-lessons">Things I learned, and some lessons</a>
                        
                    </li>
                
                </ul>
            
        

        <section>
            <p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/wood_ca_on_table.jpg" alt="A plywood slab carved with CNC into a topographic representation of California" title="A plywood slab carved with CNC into a topographic representation of California"/></p>

<p>Last summer, I wanted to get my wife something nice for her birthday. For many years, she had
expressed an occasional and casual desire for a topographic carving of the state of California,
where we live, and I thought it might be something I could figure out how to get her. In the end,
after many dozens of hours of work, five weeks, and several hundred dollars paid to a professional
CNC machine shop, I had the artifact shown in the picture above. This is the story of its creation,
starting from knowing almost nothing about GIS, cartography, or CNC machining.</p>

<p>Before you ask, I did not do a ton of research before embarking on this. As I write this, about six
months later, it only now occurred to me to do a basic search for an actual physical thing I could
buy, and luckily it seems that CNC-carved wooden relief maps of the whole state are not trivially
easy to come by, so, <em>phew!</em></p>
<p>No, my first step was to see if there were any shops in the area that could carve something out of
nice plywood, about a week before the intended recipient&#39;s birthday. I found one that was less than
ten minutes away, and filled out their web contact form. They had a field for material, and I said,
&#34;some nice plywood between 0.75 and 1.0 inches thick or similar&#34; (I didn&#39;t know exactly what was
available and wanted to give broad acceptable parameters), and under &#34;project description&#34;, I wrote,</p>
<blockquote>
<p>A relief map of California, carved from wood. Height exaggerated enough
to visibly discern the Santa Monica mountains. I can provide an STL file if needed.</p>
</blockquote>
<p>For some [incorrect] reason that I only later examined, I just sort of assumed that the shop would
have a library of shapes available for instantiating into whatever material medium you might
need. But just in case, I included that hedge about being able to provide an STL file. Needless to
say, that was a bluff.</p>
<p><img src="https://proclamations.nebcorp-hias.com/images/programmers_creed.jpg" alt="the programmer&#39;s creed: we do these things not because they are easy, but because we thought they were going to be easy -- from twitter user @unoservix, 2016-08-05" title="jfk overlaid with the programmer&#39;s creed: we do these things not because they are easy, but because we thought they were going to be easy"/>
<em></em></p><center><em><sup><sub>me, every. single. time.</sub></sup></em></center>
<p>Also needless to say, my bluff was immediately called, and I had the following exchange with the
shop:</p>
<blockquote>
<p><em>CNC Shop</em>: STL can work but I can’t manipulate it, which could save some money. If possible can it
be exported to an .igs or .iges or .stp format?</p>
<p><em>Me</em>: Yeah, STP should be no problem. Can you give a rough estimate of the cost for 1x2-foot relief carving?</p>
<p><em>Shop</em>: Without seeing the drawings, I can’t give even a close price but in the past they range from
a few hundred dollars to several thousand dollars.</p>
<p><em>Me</em>: That&#39;s totally fair! I&#39;ll get you some files in a few days.</p>
</blockquote>
<p>&#34;STP should be no problem ... I&#39;ll get you some files in a few days,&#34; was an even harder lean into
the bluff; my next communication with the shop was nearly four weeks later. But that&#39;s getting ahead
of things.</p>

<p>First off, let&#39;s talk about file formats and how to represent shapes with a
computer. I first said I could provide an <em>STL
file</em>. <a href="https://en.wikipedia.org/wiki/STL_(file_format)">STL</a> is a pretty bare-bones format that
describes the outside surface of a shape as a mesh of many, many triangles, each of which is
described by three 3D points, where each point (but not necessarily each edge) of the triangle lies
on the surface of the shape of the thing you&#39;re modeling. This format is popular with 3D printers,
which is how I became familiar with it.</p>
<p>STL is simple to implement and easy for a computer to read, but if you have a model in that format
that you need to manipulate, like you want to merge it with another shape, you won&#39;t have a good
time. In order to actually do things like that, it needs to be converted into a CAD program&#39;s native
representation of a &#34;solid body&#34;, which is pretty much what it sounds like: a shape made of a finite
volume of &#34;stuff&#34;, and NOT just an infinitesimally thin shell enclosing an empty volume, which is
what a mesh is.</p>
<p>In order for the CAD program to convert a mesh into a solid body, the mesh must be <em>manifold</em>,
meaning, no missing faces (triangles), and with a clearly-defined interior and exterior (all
triangles are facing in one direction relative to their interior). When there are no missing faces,
it&#39;s called &#34;water tight&#34;. You can still have &#34;holes&#34; in a mesh, like if you have a model of a
donut, but the surface of the donut can&#39;t have any missing faces. A valid STL
file&#39;s meshes are manifold.</p>
<p>The CNC shop had requested a model in a format called
<a href="https://www.fastradius.com/resources/everything-you-need-to-know-about-step-files/">ST<strong>P</strong></a>. <code>.stp</code>
is the extension for a &#34;STEP&#34; file; STEP is supposed to be short for &#34;standard for the exchange of
product data&#34;, so someone was playing pretty fast and loose with their initialisms, but I
digress. The main thing about STEP files is that CAD programs can really easily convert them into
their native internal solid body representation, which allows easy manipulation. <a name="prophecy"></a> Another thing about them is that a CAD program can usually turn a manifold mesh
into an STP file, unless the mesh is too complicated and your computer doesn&#39;t have enough RAM
(<em>note: foreshadowing</em>).</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/meshy-cube.png" alt="an overly-complicated mesh of a cube" title="an overly-complicated mesh of a cube"/>
<em></em></p><center><em><sup><sub>this cube&#39;s mesh has too many vertices and edges, I hope my computer has enough
RAM to work with it</sub></sup></em></center>
<p>But at that moment, I had nothing at all. Time to get some data and see if I can turn it into a model.</p>

<p>My first impulse was to search <a href="https://usgs.gov">USGS</a>&#39;s website for <a href="https://en.wikipedia.org/wiki/Digital_elevation_model">digital elevation
map</a> data, but I wound up not finding
anything appropriate. Searching now with the wisdom of experience and hindsight, I found this, which
would have been perfect:</p>
<p><a href="https://apps.nationalmap.gov/downloader/">https://apps.nationalmap.gov/downloader/</a></p>
<p>Did I just accidentally miss it then? Did I find it and not recognize its utility because I didn&#39;t
know what I was doing <em>at all</em>? The world may never know, but at least now you can benefit from my
many, many missteps.</p>
<h2 id="from-space">From space?</h2>
<p>Anyway, having not found anything I could really use from the USGS through all fault of my own, I
found <a href="https://portal.opentopography.org/raster?opentopoID=OTSRTM.082015.4326.1">this site</a>, from
OpenTopography, an organization run by the UCSD Supercomputer Center, under a grant from the
National Science Foundation. So, still hooray for public data!</p>
<p>That particular page is for a particular dataset; in this case, &#34;<a href="http://www2.jpl.nasa.gov/srtm/">SRTM
GL1</a> Global 30m&#34;. &#34;SRTM&#34; stands for &#34;<a href="https://en.wikipedia.org/wiki/Shuttle_Radar_Topography_Mission">Shuttle Radar Topography
Mission</a>&#34;, which was a Space Shuttle
mission in February, 2000, where it did a <a href="https://en.wikipedia.org/wiki/Interferometric_synthetic-aperture_radar">fancy radar
scan</a> of most of the land on
Earth. Though, it&#39;s hard to verify that the data was not synthesized with other datasets of more
recent, non-space origin, especially in places like California. But probably space was involved in
some way.</p>
<h2 id="in-australia-it-s-pronounced-g-dal">In Australia, it&#39;s pronounced &#34;g&#39;dal&#34;</h2>
<p>Anyway, I&#39;d found an open source of public data. This dataset&#39;s <a href="https://gisgeography.com/srtm-shuttle-radar-topography-mission/">horizontal resolution is 1 arc
second</a> (which is why it&#39;s
&#34;GL<strong>1</strong>&#34;), or roughly 30x30 meters, and the height data is accurate to within 16 meters. Not too
shabby!</p>
<p>They provided the data in the form of <a href="https://en.wikipedia.org/wiki/GeoTIFF">GeoTIFF</a>s, which are
basically an image where each pixel represents one data point (so, a 30x30 square meter plot)
centered at a particular location on the Earth&#39;s surface. It&#39;s a monochrome image, where absolute
height is mapped to absolute brightness of each pixel, and each pixel represents an exact location
in the world.</p>
<p>The only problem was that you could only download data covering up to 450,000 square kilometers at a
time, so I had had to download a bunch of separate files and then mosaic them together. Luckily,
there&#39;s a whole suite of open source tools called
<a href="https://gdal.org/faq.html#what-does-gdal-stand-for">GDAL</a>. Among that suite is a tool called
<code>gdal_merge.py</code> (yes, the <code>.py</code> is part of the name of the tool that gets installed to your system
when you install the GDAL tools), which does exactly what I wanted:</p>
<blockquote>
<p><code>gdal_merge.py -o ca_topo.tif norcal_topo.tif centcal_topo.tif socal_topo.tif so_cent_cal_topo.tif norcal_topo_redux.tif last_bit.tif east_ca.tif</code></p>
</blockquote>
<p>This produced a file called <code>ca_topo.tif</code>. It was very large, in every sense:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/geotiff-files.png" alt="listing of tif files with sizes" title="the input geotiff files and the resulting &#39;ca_topo.tif&#39; output file, which is 2.7 gigabytes"/>
<em></em></p><center><em><sup><sub>last_little_piece_i_swear_final_final2.tif</sub></sup></em></center>
<p>Using <a href="https://gdal.org/programs/gdalinfo.html">another tool</a> called <code>gdalinfo</code>, we can examine the
metadata of the mosaic we just created:</p>
<pre data-lang="text"><code data-lang="text"><span>$ gdalinfo -mm ca_topo.tif
</span><span>Driver: GTiff/GeoTIFF
</span><span>Files: ca_topo.tif
</span><span>Size is 40757, 35418
</span><span>Coordinate System is:
</span><span>GEOGCRS[&#34;WGS 84&#34;,
</span><span>    DATUM[&#34;World Geodetic System 1984&#34;,
</span><span>        ELLIPSOID[&#34;WGS 84&#34;,6378137,298.257223563,
</span><span>            LENGTHUNIT[&#34;metre&#34;,1]]],
</span><span>    PRIMEM[&#34;Greenwich&#34;,0,
</span><span>        ANGLEUNIT[&#34;degree&#34;,0.0174532925199433]],
</span><span>    CS[ellipsoidal,2],
</span><span>        AXIS[&#34;geodetic latitude (Lat)&#34;,north,
</span><span>            ORDER[1],
</span><span>            ANGLEUNIT[&#34;degree&#34;,0.0174532925199433]],
</span><span>        AXIS[&#34;geodetic longitude (Lon)&#34;,east,
</span><span>            ORDER[2],
</span><span>            ANGLEUNIT[&#34;degree&#34;,0.0174532925199433]],
</span><span>    ID[&#34;EPSG&#34;,4326]]
</span><span>Data axis to CRS axis mapping: 2,1
</span><span>Origin = (-125.109583333326071,42.114305555553187)
</span><span>Pixel Size = (0.000277777777778,-0.000277777777778)
</span><span>Metadata:
</span><span>  AREA_OR_POINT=Area
</span><span>Image Structure Metadata:
</span><span>  INTERLEAVE=BAND
</span><span>Corner Coordinates:
</span><span>Upper Left  (-125.1095833,  42.1143056) (125d 6&#39;34.50&#34;W, 42d 6&#39;51.50&#34;N)
</span><span>Lower Left  (-125.1095833,  32.2759722) (125d 6&#39;34.50&#34;W, 32d16&#39;33.50&#34;N)
</span><span>Upper Right (-113.7881944,  42.1143056) (113d47&#39;17.50&#34;W, 42d 6&#39;51.50&#34;N)
</span><span>Lower Right (-113.7881944,  32.2759722) (113d47&#39;17.50&#34;W, 32d16&#39;33.50&#34;N)
</span><span>Center      (-119.4488889,  37.1951389) (119d26&#39;56.00&#34;W, 37d11&#39;42.50&#34;N)
</span><span>Band 1 Block=40757x1 Type=Int16, ColorInterp=Gray
</span><span>    Computed Min/Max=-130.000,4412.000
</span></code></pre>
<p>If I may draw your attention to a couple things there, the image is 40,757 pixels wide and 35,418
pixels tall. The &#34;pixel size&#34; is 0.000277777777778 by 0.000277777777778; the units, given by the
&#34;angleunit&#34;, is degrees; 1 arc second is 1/3600th of a degree, which is 0.01754... They&#39;re degrees
of arc along the surface of the Earth, at a distance measured from the center of the
planet. As previously mentioned, that translates into a size of roughly 30 meters. So if you were
ever curious about how many 100-ish-foot squares you&#39;d need to fill a rectangle that fully enclosed
the entire border of California, then one billion, four-hundred-forty-three million,
five-hundred-thirty-one thousand, and four-hundred-twenty-six (40,757 times 35,418) is pretty close.</p>
<p>The other units in there are under the &#34;Coordinate System is&#34; section, and are meters relative to
the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System">World Geodetic System 1984</a> vertical datum
(distances from this reference surface in the dataset are within 16 meters of the true distance in
reality); the very last line is the lowest and highest points in file, which are <a name="minmax-height"></a>-130 meters and 4,412 meters respectively, relative to the baseline height
defined by the WGS84 ellipsoid. If you were to view the file with an image viewer, it would look
like this:<a name="raw-dem"></a></p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/small_ca_topo.png" alt="the ca_topo image; it&#39;s hard to make out details and very dark" title="a &#39;raw&#39; heightmap of california and parts of nevada, arizona, and mexico"/>
<em></em></p><center><em><sup><sub>if you squint, you can kinda see the mountains</sub></sup></em></center>
<p>It&#39;s almost completely black because the highest possible value an image like that could have for a
pixel is 65,535, and the highest point in our dataset is only 4,412, which is not that
much in comparison. Plus, it includes portions of not-California in the height data, and ideally, we
want those places to not be represented in our dataset; we have a little more processing to do
before we can use this.</p>
<h2 id="cartography-is-complicated">Cartography is complicated</h2>
<p>The first order of business is to mask out everything that&#39;s not California, and the first thing I
needed for that was a <a href="https://en.wikipedia.org/wiki/Shapefile">shapefile</a> that described the
California state border. Luckily, <a href="https://data.ca.gov/dataset/ca-geographic-boundaries">that exact
thing</a> is publicly available from the state&#39;s
website; thank you, State of California!</p>
<p>There was only one issue: the shapefile was in a different <a href="https://en.wikipedia.org/wiki/Map_projection">map
projection</a> than the data in our geotiff file. A &#34;map
projection&#34; is just the term for how you display a curved, 3D shape (like the border of a state on the
curved surface of the Earth) on a flat, 2D surface, like a map. If you look at the line in the
output of <code>gdalinfo</code> above that says, <code>ID[&#34;EPSG&#34;,4326]</code>, that is telling us the particular
projection used. <a href="https://en.wikipedia.org/wiki/EPSG_Geodetic_Parameter_Dataset">EPSG 4326</a> uses
latitude and longitude, expressed in degrees, covers the entire Earth including the poles, and
references the WGS84 ellipsoid as the ground truth.</p>
<p>The shapefile was in a projection called <a href="https://en.wikipedia.org/wiki/Web_Mercator_projection">EPSG
3857</a>, or &#34;Web Mercator&#34;. This is similar to
EPSG 4326, except instead of using the WGS84 ellipsoid, it pretends the Earth is a perfect
sphere. It only covers +/- 85-ish degrees of latitude (so not the poles), and it uses meters instead
of degrees of lat/long. It&#39;s popular with online map services (like Google Maps and Open Street
Maps) for displaying maps, hence the name, &#34;Web Mercator&#34;, so you&#39;d probably recognize the shapes of
things in it.</p>
<p>Once again, there&#39;s a <a href="https://gdal.org/programs/gdalwarp.html">handy GDAL tool</a>, <code>gdalwarp</code>, which
is for reprojecting geotiffs. So all we have to do is take our 4326-projected geotiff, use
<code>gdalwarp</code> to project it to 3857/Web Mercator, and then we can use the shapefile to mask off all
other height data outside the border of California.</p>
<p>It&#39;s almost <em>too</em> easy.</p>
<blockquote>
<p>gdalwarp -t_srs EPSG:3857 ca_topo.tif ca_topo_mercator.tif</p>
</blockquote>
<p>This gives us a 3857-projected file called <code>ca_topo_mercator.tif</code>. It still has over a billion
pixels in it (it&#39;s a little bigger overall, but the aspect is
much wider, with the different projection); scaling it down will be a very last step, since at that
point, it will no longer be a digital elevation map, it will just be an image. We&#39;ll get there,
just not yet.</p>
<p>Cracking open <code>gdalinfo</code>, we get:</p>
<pre data-lang="text"><code data-lang="text"><span>$ gdalinfo ca_topo_mercator.tif                             
</span><span>Driver: GTiff/GeoTIFF
</span><span>Files: ca_topo_mercator.tif
</span><span>Size is 36434, 39852
</span><span>Coordinate System is:
</span><span>PROJCRS[&#34;WGS 84 / Pseudo-Mercator&#34;,
</span><span>    BASEGEOGCRS[&#34;WGS 84&#34;,
</span><span>        ENSEMBLE[&#34;World Geodetic System 1984 ensemble&#34;,
</span><span>            MEMBER[&#34;World Geodetic System 1984 (Transit)&#34;],
</span><span>            MEMBER[&#34;World Geodetic System 1984 (G730)&#34;],
</span><span>            MEMBER[&#34;World Geodetic System 1984 (G873)&#34;],
</span><span>            MEMBER[&#34;World Geodetic System 1984 (G1150)&#34;],
</span><span>            MEMBER[&#34;World Geodetic System 1984 (G1674)&#34;],
</span><span>            MEMBER[&#34;World Geodetic System 1984 (G1762)&#34;],
</span><span>            MEMBER[&#34;World Geodetic System 1984 (G2139)&#34;],
</span><span>            ELLIPSOID[&#34;WGS 84&#34;,6378137,298.257223563,
</span><span>                LENGTHUNIT[&#34;metre&#34;,1]],
</span><span>            ENSEMBLEACCURACY[2.0]],
</span><span>        PRIMEM[&#34;Greenwich&#34;,0,
</span><span>            ANGLEUNIT[&#34;degree&#34;,0.0174532925199433]],
</span><span>        ID[&#34;EPSG&#34;,4326]],
</span><span>    CONVERSION[&#34;Popular Visualisation Pseudo-Mercator&#34;,
</span><span>        METHOD[&#34;Popular Visualisation Pseudo Mercator&#34;,
</span><span>            ID[&#34;EPSG&#34;,1024]],
</span><span>        PARAMETER[&#34;Latitude of natural origin&#34;,0,
</span><span>            ANGLEUNIT[&#34;degree&#34;,0.0174532925199433],
</span><span>            ID[&#34;EPSG&#34;,8801]],
</span><span>        PARAMETER[&#34;Longitude of natural origin&#34;,0,
</span><span>            ANGLEUNIT[&#34;degree&#34;,0.0174532925199433],
</span><span>            ID[&#34;EPSG&#34;,8802]],
</span><span>        PARAMETER[&#34;False easting&#34;,0,
</span><span>            LENGTHUNIT[&#34;metre&#34;,1],
</span><span>            ID[&#34;EPSG&#34;,8806]],
</span><span>        PARAMETER[&#34;False northing&#34;,0,
</span><span>            LENGTHUNIT[&#34;metre&#34;,1],
</span><span>            ID[&#34;EPSG&#34;,8807]]],
</span><span>    CS[Cartesian,2],
</span><span>        AXIS[&#34;easting (X)&#34;,east,
</span><span>            ORDER[1],
</span><span>            LENGTHUNIT[&#34;metre&#34;,1]],
</span><span>        AXIS[&#34;northing (Y)&#34;,north,
</span><span>            ORDER[2],
</span><span>            LENGTHUNIT[&#34;metre&#34;,1]],
</span><span>    USAGE[
</span><span>        SCOPE[&#34;Web mapping and visualisation.&#34;],
</span><span>        AREA[&#34;World between 85.06°S and 85.06°N.&#34;],
</span><span>        BBOX[-85.06,-180,85.06,180]],
</span><span>    ID[&#34;EPSG&#34;,3857]]
</span><span>Data axis to CRS axis mapping: 1,2
</span><span>Origin = (-13927135.110024485737085,5178117.270359318703413)
</span><span>Pixel Size = (34.591411839078859,-34.591411839078859)
</span><span>Metadata:
</span><span>  AREA_OR_POINT=Area
</span><span>Image Structure Metadata:
</span><span>  INTERLEAVE=BAND
</span><span>Corner Coordinates:
</span><span>Upper Left  (-13927135.110, 5178117.270) (125d 6&#39;34.50&#34;W, 42d 6&#39;51.50&#34;N)
</span><span>Lower Left  (-13927135.110, 3799580.326) (125d 6&#39;34.50&#34;W, 32d16&#39;33.21&#34;N)
</span><span>Upper Right (-12666831.611, 5178117.270) (113d47&#39;17.10&#34;W, 42d 6&#39;51.50&#34;N)
</span><span>Lower Right (-12666831.611, 3799580.326) (113d47&#39;17.10&#34;W, 32d16&#39;33.21&#34;N)
</span><span>Center      (-13296983.361, 4488848.798) (119d26&#39;55.80&#34;W, 37d21&#39;21.69&#34;N)
</span><span>Band 1 Block=36434x1 Type=Int16, ColorInterp=Gray
</span></code></pre>
<p>You can see that the <code>PROJCRS[ID]</code> value is <code>&#34;EPSG,3857&#34;</code>, as expected. The &#34;pixel size&#34; is
&#34;34.591411....&#34; and the &#34;lengthunit&#34; is &#34;metre&#34;. But the number of pixels is different, and the
shape is different, yet the coordinates of the bounding corners are the same as the original file&#39;s
(the latitude and longitude given as the second tuple). This is all from the Web Mercator&#39;s different
projection causing the aspect ratio to stretch horizontally, but it still represents the same area
of the planet.</p>
<h2 id="the-one-custom-script">The one custom script</h2>
<p>Now that we had our geotiff in the right projection, the next step was use the shapefile to mask out
the California border in it. Here is where GDAL failed me, and looking around now as I
write this, I still can&#39;t find a specific GDAL tool for doing it. Given how useful I found all the
other tools, I can&#39;t really complain, so I won&#39;t! It wasn&#39;t that hard to write something that would
do it with other open source tools; I didn&#39;t even bother checking this into a git repo or anything:</p>
<pre data-lang="python"><code data-lang="python"><span>#!/usr/bin/env python3
</span><span>
</span><span>import </span><span>fiona                  </span><span># for reading the shapefile
</span><span>import </span><span>rasterio               </span><span># for working with the geotiff
</span><span>import </span><span>rasterio.mask </span><span>as </span><span>rmask
</span><span>
</span><span>import </span><span>sys
</span><span>
</span><span>def </span><span>main</span><span>():
</span><span>    tif = sys.argv[</span><span>1</span><span>]
</span><span>    msk = sys.argv[</span><span>2</span><span>]
</span><span>    out = sys.argv[</span><span>3</span><span>]
</span><span>
</span><span>    </span><span>print</span><span>(&#34;</span><span>input: </span><span>{tif}</span><span>\n</span><span>mask: </span><span>{msk}</span><span>\n</span><span>output: </span><span>{out}</span><span>&#34;.</span><span>format</span><span>(</span><span>tif</span><span>=tif, </span><span>msk</span><span>=msk, </span><span>out</span><span>=out))
</span><span>    </span><span>if </span><span>input</span><span>(&#34;</span><span>Enter &#39;y&#39; to continue: </span><span>&#34;).</span><span>lower</span><span>() != &#39;</span><span>y</span><span>&#39;: </span><span># double-check I don&#39;t stomp something I wanted to keep
</span><span>        </span><span>print</span><span>(&#34;</span><span>See ya.</span><span>&#34;)
</span><span>        </span><span>return
</span><span>
</span><span>    </span><span>with </span><span>fiona.</span><span>open</span><span>(msk, &#34;</span><span>r</span><span>&#34;) </span><span>as </span><span>shapefile:
</span><span>        shapes = [feature[&#34;</span><span>geometry</span><span>&#34;] </span><span>for </span><span>feature </span><span>in </span><span>shapefile]
</span><span>
</span><span>        </span><span>with </span><span>rasterio.</span><span>open</span><span>(tif) </span><span>as </span><span>in_tif:
</span><span>            out_image, out_xform = rmask.</span><span>mask</span><span>(in_tif, shapes, </span><span>filled</span><span>=</span><span>True</span><span>, </span><span>crop</span><span>=</span><span>True</span><span>)
</span><span>            out_meta = in_tif.meta
</span><span>            out_meta.</span><span>update</span><span>({&#34;</span><span>driver</span><span>&#34;: &#34;</span><span>GTiff</span><span>&#34;,
</span><span>                             &#34;</span><span>height</span><span>&#34;: out_image.shape[</span><span>1</span><span>],
</span><span>                             &#34;</span><span>width</span><span>&#34;: out_image.shape[</span><span>2</span><span>],
</span><span>                             &#34;</span><span>transform</span><span>&#34;: out_xform})
</span><span>            </span><span>for </span><span>k, v </span><span>in </span><span>out_meta.</span><span>items</span><span>():
</span><span>                </span><span>print</span><span>(&#34;</span><span>{}</span><span>: </span><span>{}</span><span>&#34;.</span><span>format</span><span>(k, v)) </span><span># just outta curiosity
</span><span>
</span><span>            </span><span>with </span><span>rasterio.</span><span>open</span><span>(out, &#34;</span><span>w</span><span>&#34;, **out_meta) </span><span>as </span><span>dest:
</span><span>                dest.</span><span>write</span><span>(out_image)
</span><span>
</span><span>    </span><span>print</span><span>(&#34;</span><span>Wrote masked tif to </span><span>{}</span><span>&#34;.</span><span>format</span><span>(out))
</span><span>
</span><span>    </span><span>return
</span><span>
</span><span>if </span><span>__name__ == &#34;</span><span>__main__</span><span>&#34;:
</span><span>    </span><span>main</span><span>()
</span></code></pre>
<p>I include that just in case anyone else ever needs to do this, and doesn&#39;t find one of the hundreds
of other examples out there already. This one is nice because you don&#39;t need to pre-process the
shapefile into <a href="https://geojson.org/">GeoJSON</a> or anything, the
<a href="https://pypi.org/project/Fiona/1.4.2/">Fiona</a> package handles things like that transparently for
you, but don&#39;t think this is great Python or anything; it&#39;s the dumbest, quickest thing I could crap
out to do the task I needed to be done.</p>
<p>After running that script, I had a Web Mercator-projected geotiff that included data only for places
inside the state border of California. It was still enormous; the mask didn&#39;t change the shape and
you can&#39;t have non-rectangular images anyway, but at this point, I had the final desired
dataset. It was time to turn it into a heightmap that we could use to make a mesh.</p>
<h2 id="a-usable-heightmap">A usable heightmap</h2>
<p>I&#39;ve been trying to be careful about referring to the image file as a &#34;dataset&#34; or &#34;geotiff&#34;, vs. a
&#34;heightmap&#34;. A geotiff file is not a regular image file, it includes particular metadata and data
that is meant to be interpreted as a real map of the land; each pixel in it says something about an exact,
actual location in the real world. In our geotiff, a mountain would have to be more than twelve
miles high before it appeared as bright white.</p>
<p>A &#34;heightmap&#34; is an image file, like a geotiff, where each pixel&#39;s monochromatic intensity is meant
to represent height above some lowest plane. The difference is that the height values are <em>normalized</em>
so that the lowest height is 0, and the highest is the maximum possible value in the format&#39;s value
range. For geotiff digital elevation maps, which use 16-bit numbers as previously mentioned, that
maximum possible value is 65,535. But unlike a geotiff, a generic heightmap has no exact
correspondence with anything else; it&#39;s not necessarily an accurate dataset, and won&#39;t include the
GIS stuff like what projection it is, what the coordinate bounding boxes are, etc. But it <em>is</em>
useful for turning into a mesh.</p>
<p>And here I get to the <a href="https://gdal.org/programs/gdal_translate.html">final GDAL tool</a> I used,
<code>gdal_translate</code>. This is something that can read in a geotiff, and write out a different image
format. When in doubt, <a href="https://en.wikipedia.org/wiki/Portable_Network_Graphics">PNG</a> is fine, I
always say. It&#39;s a simple format that nearly everything can read, and is compressed so it should be
a much smaller file on disk, even if it&#39;s the same number of pixels. Smaller file size is always
easier.</p>
<blockquote>
<p><code>gdal_translate -of PNG -ot UInt16 -scale -130 4412 0 65535 masked_ca_topo.tif heightmap.png</code></p>
</blockquote>
<p>Like we saw <a href="#minmax-height">earlier</a>, the lowest point we had in our data was -130
meters, and the highest was 4,412. The <code>-scale -130 4412 0 65535</code> arguments are saying, &#34;anything
with a height of -130 should be totally dark, and anything with a height of 4,412 should be as
bright as possible, and anything in-between should be set proportionately.&#34; This is a linear
mapping, and preserves the relationships between vertical features (that is, if something is twice
as tall as another thing, that will still be true after being scaled), so in a sense, it&#39;s
&#34;accurate&#34;, but would it be good, was the question (<em>note: more foreshadowing</em>).</p>
<p>Once I had the PNG file, I used the <a href="https://imagemagick.org/script/convert.php">ImageMagick</a> <code>convert</code>
command to resize the file down to a reasonable size. Finally, I had something I could use to make a
mesh:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/scaled_heightmap.png" alt="the heightmap made by doing a linear scale of height to brightness" title="the heightmap made by doing a linear mapping of height to brightness"/></p>
<p>Pretty cool, right? I thought so! The detail is pretty great; that bright spot near the top is
<a href="https://en.wikipedia.org/wiki/Mount_Shasta">Mt. Shasta</a>, for example;
<a href="https://en.wikipedia.org/wiki/Mount_Whitney">Mt. Whitney</a> is slightly taller, but not by much, and
is part of a range so it doesn&#39;t stand out the way Shasta does. It was time to start making some 3D
geometry with the heightmap!</p>

<p>My next step was to figure out how exactly to turn that heightmap into a mesh. Some searching
assured me that <a href="https://www.blender.org/">Blender</a>, a free and open source 3D modeling package that
I&#39;d dabbled with before, would work well. For example, here&#39;s a pretty high-level walk-through of
<a href="https://alanedwardes.com/blog/posts/create-meshes-from-height-maps-using-blender/">how to use a heightmap to displace a mesh
plane</a>, which is
almost exactly what I first wanted to do. Before too long, I had something that looked like this:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/pointy_california_blending.png" alt="a very pointy california topo" title="the displaced mesh plane made from the first heightmap"/></p>
<p>At first glance, it looks OK, but there&#39;s so. much. detail. And it&#39;s very, very pointy; it just
looks jagged. Check out this close-up detail of Mt. Shasta:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/pointy_shasta_close-up.png" alt="a very pointy mt shasta" title="a very pointy mt shasta"/>
<em></em></p><center><em><sup><sub>witch&#39;s hat-assed mountain</sub></sup></em></center>
<p>You can tell it wounldn&#39;t be nice to touch, and being able to run your fingers along the shape
was a huge part of the appeal of having the physical object.</p>
<h2 id="back-to-the-realm-of-images">Back to the realm of images</h2>
<p>Given that it seemed like there were at least a couple semi-related problems from too much detail,
my first instinct was to blur the heightmap, and then reduce the size of it. I used the ImageMagick
<code>convert</code> command again <a href="https://legacy.imagemagick.org/Usage/blur/">to blur the image</a> a couple
rounds, and then resized it down:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/blurred_scaled_hm_3.png" alt="first attempt at blurring the heightmap" title="first attempt at blurred heightmap"/></p>
<p>A little better, but still not great. A few more rounds of blurring and shrinking got me
this:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/lo-rez_blurred_hm3.png" alt="second round of blurring the heightmap" title="second round of blurring the heightmap"/></p>
<p>With that version, I was able to produce some reasonable-looking geometry in Blender:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/blending_california.png" alt="a slightly smoother mesh" title="slightly smoother mesh in blender"/></p>
<p>Or so I thought.</p>
<p>It may have been smoother, it was still very pointy. A lot of the high-frequency detail has been removed, which
means it&#39;s not rough and jagged, but Shasta still looks ridiculous.</p>
<h2 id="a-matter-of-scale">A matter of scale</h2>
<p>The problem was that I was doing a linear scaling of the height of features in the data, and the
required factors were so enormous that it distorted the geometry in an ugly way.</p>
<p>The State of California is very large, but for the sake of argument, let&#39;s pretend it&#39;s exactly 700
miles tall, from the southern tip to the northern border&#39;s latitude, going straight north; the real
length is close to that. Also for the sake of argument, let&#39;s say that the tallest mountain is 3
miles tall; the actual height is a little less than that, but that&#39;s OK, the argument holds more
strongly at lower height. That means the ratio of height to length is 3/700, or 0.0043-ish.</p>
<p>If you had a physically accurate topographic carving of California that was a foot long, the tallest
peak on the carving would be 0.0043 feet high, which is about 1/200th of an inch, or about 0.13
millimeters. You&#39;d probably be able to tell with your fingers and maybe even your eyes where Shasta was,
and see that there was a faint line from the Sierra Nevadas, but that would be it. That&#39;s why it&#39;s
so hard to see the details in the <a href="#raw-dem">raw elevation data</a> geotiff.</p>
<p>In order to be able to see any detail, and to meet expectations about what a topographic carving is
supposed to look like, the height of the highest peaks needs to be scaled up by something like
10-20x. My problem was that I was doing a linear scale; I was making <em>everything</em> 10-20x taller than
it &#34;should&#34; be, which was causing everything to look stretched and weird.</p>
<p>And even with that amount of exaggeration, some low-elevation features were still not showing
up. For example, <a href="https://en.wikipedia.org/wiki/Sutter_Buttes">Sutter Buttes, a 2,000-foot tall mound in the Sacramento
Valley</a>, which is faintly visible in the heightmap, is
almost not there in the resulting mesh. It&#39;s about 1/7th the height of Shasta, which is not all that
much, when Shasta was represented by something 0.75 inches tall.</p>
<p>What I really needed was some non-linear way to scale the height, some way to exaggerate lower
altitudes more than higher ones. The highest points should stay as high as they were; they determine
the ultimate overall height, but lower points should be given a relative boost. An easy way to do
this is to take some fractional root (raise a number to a power between 0.0 and 1.0) of the linear
scaling factor, and use that new value instead. For example, the graph of <em>x</em> raised to the
0.41th power looks like this:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/exponential_plot.png" alt="y = x^0.41 between 0 and 1" title="a graph of the function `y = x^0.41` between 0 and 1"/></p>
<p>Notice how values <em>at</em> 0 and 1 are the same as they would be with linear scaling, values <em>near</em> 0
rapidly get scaled upward, and by the time you get near 1, it looks almost linear again. The linear
scaling function we&#39;d initially used would just look like a straight line from the lower left corner
to the upper right.</p>
<p>Luckily, <code>gdal_translate</code> has an option to do this kind of scaling, so it was a quick</p>
<blockquote>
<p><code>gdal_translate -of PNG -ot UInt16 -scale -130 4412 0 65535 -exponent 0.41 ca_topo.tif exponentially_scaled_heightmap.png</code></p>
</blockquote>
<p>and a couple rounds of blurring, and I had the following heightmap:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/lo-rez_exp_blurred.png" alt="a non-linearly scaled heightmap" title="nearly final heightmap, using exponential scaling to exaggerate lower altitudes"/></p>
<p>which resulted in a mesh that looked something like this inside Blender:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/non-linear_scaling_of_ca_height_data.png" alt="3D viewport in Blender showing a topo-displaced mesh that looks like California" title="You can see how Shasta doesn&#39;t stick out so much when the other hills are brought up a bit relatively speaking"/></p>
<p>Doesn&#39;t that look nicer? Notice how a bunch of things that were nearly invisible before, like Sutter
Buttes, are easily visible. Check out the <a href="https://en.wikipedia.org/wiki/Channel_Islands_(California)">Channel
Islands</a> now plain as day! I was feeling
pretty good about having this whole thing wrapped up shortly, only a little late for the birthday.</p>

<p>What followed was two frustrating weeks attempting to get a manifold mesh out of Blender that was
small enough, by which I mean number of vertices and edges, so that
<a href="https://www.freecadweb.org/">FreeCAD</a> could turn it into an STP file. Unfortunately, FreeCAD is not
a good tool for doing fancy things with meshes, like creating them from a heightmap, so I had to use
two different tools.</p>
<p>This also meant that I would run into surprising limits when going between them. Let me explain. I&#39;d
get a mesh in Blender, export it to a neutral mesh format like
<a href="https://en.wikipedia.org/wiki/Wavefront_.obj_file">OBJ</a> that both programs understand well, and it
would be a 60 megabyte file. My computer has 32 <strong>giga</strong>bytes, more than 500 times more memory than
that, so you&#39;d think it would not be a problem.</p>
<p>The act of asking FreeCAD to import that OBJ file as a <em>mesh</em>, and not even as a solid body, caused
the memory use to go to 21 gigabytes. This is a lot, but the computer still had plenty of room left
in memory for things like &#34;responding to the keyboard and mouse&#34; or &#34;redrawing the
screen&#34;. Everything at this point is still perfectly usable.</p>
<p>When I attempted to convert that mesh into a solid body, though, memory use ballooned up to
encompass all available RAM, and my system immediately came to a nearly imperceptible crawl until my
frantic <code>ctrl-c</code>s were finally registered by the <a href="https://www.gnu.org/software/libc/manual/html_node/Termination-Signals.html">signal
handlers</a> in FreeCAD
before I could use it again. This happened <em>a lot</em>. At last, <a href="#prophecy">the prophecy</a>
had come to pass.</p>
<p>I went through many rounds of attempting to clean up the mesh and reduce its complexity, but I don&#39;t
have many notes or intermediate artifacts from this time. A lot of that was being a beginner at both
Blender <strong>and</strong> FreeCAD, though there&#39;s so much educational material that I was rarely held back by
not knowing how to do a particular thing inside each program. A lot was inexperience in the domain;
I did not know how much detail was essential, and I did not have a lot of experience with digital
modeling in the first place. The workflow was very manual, and cycles were fairly long, which made
it hard to try a bunch of things in quick succession as experiments. All those things and more
conspired to make this portion of the process a total slog with very little to show off.</p>

<p>Eventually, after a couple weeks of trying and failing to get something into FreeCAD that I could then
work with (like merging it with a thick base and trimming that base to follow the shape of the
state), I had had enough. I was just going to send the shop an STL file and forget about trying to
get an STP file. I have some notes from then, right after I&#39;d started my first test print:</p>
<blockquote>
<p>I&#39;m finally printing something out. I&#39;ve given up on converting it into [something CAD-friendly];
it seems this is a Hard Problem, but I&#39;m not sure why. My goal with doing that was to give a
CAD-friendly file to a local CNC milling shop, per their request, since when I suggested a
mesh-based file (STL), the guy was like &#34;I can&#39;t do much manipulation with that to make it more
manufacturable, so a real CAD file would be best&#34;.</p>
<p>But at least with an STL file, I can print it myself. So that&#39;s going now, we&#39;ll see how it turns
out in no less than eight hours.</p>
<p>I haven&#39;t really done anything else with my computer besides this for a while.</p>
</blockquote>
<p>When that print was done, here&#39;s what it looked like:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/ca_topo_crappy_test_print.png" alt="a piece of literal dogshit" title="a piece of literal dogshit"/>
<em></em></p><center><em><sup><sub>don&#39;t look at me, I&#39;m hideous</sub></sup></em></center>
<p>In case you were not revolted enough, then please allow me to direct your gaze toward this eldritch
abomination:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/crappy_test_print_close_up.jpg" alt="close-up of extremely bad print results" title="close-up of extremely bad print results"/>
<em></em></p><center><em><sup><sub>what did I just say about looking at me</sub></sup></em></center>
<p>As bad as it looked, it felt even worse to touch. Setting aside the hideous base with its weird
visual artifacts due to those areas not being a single flat polygon, but rather several polygons
that were not parallel, there was still just too much high-frequency detail in the terrain, and it
was a total mismatch with the 3D printed medium.</p>
<p>The real thing was going to be carved out of wood by a <a href="https://all3dp.com/2/what-is-cnc-milling-simply-explained/">CNC
mill</a>, which uses a drill-like component
to carve away pieces of the material you&#39;re working with. This means that there&#39;s a tiny spinning
bit with a definite, finite size, and any detail in the model smaller than the end of that spinning
bit would likely be impossible to carve with it. This meant that all that high-frequency detail was
not only ugly, it was also completely unnecessary.</p>
<h2 id="just-try-harder">Just try harder</h2>
<p>I was very eager to get something into the CNC shop&#39;s hands at this point, but I also knew that this
model was not acceptable. So, I resolved to brutally simplify the geometry until I got something
that was workable inside FreeCAD.</p>
<p>First off, I made the heightmap even smaller, only 500 pixels wide. Fewer pixels means fewer details
for turning into a displacement map for a mesh! I also removed the Channel Islands from the
heightmap, resulting in this final mesh displacement input:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/final_heightmap.png" alt="it&#39;s the final heightmap" title="it&#39;s the final heightmap (sick synthesizer riff blasts)"/>
<em></em></p><center><em><sup><sub>it&#39;s the final heightmap (doot-doot-doot-doot,
doot-doot-doot-doot-doot)</sub></sup></em></center>
<p>Inside Blender, I&#39;d gotten quite proficient at running through the steps to generate a mesh from a
heightmap, and once I&#39;d done that, I went through several rounds of <a href="https://graphics.stanford.edu/courses/cs468-10-fall/LectureSlides/08_Simplification.pdf">mesh
simplification</a>;
the geometry was practically homeopathic.</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/final_ca_topo_blend.png" alt="the final model in blender" title="the final model in Blender"/>
<em></em></p><center><em><sup><sub>by the principles of homeopathy, the fewer the vertices, the more potent the mesh</sub></sup></em></center>
<p>Check out this close-up of Mt Shasta:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/final_shasta.png" alt="close-up of Shasta in the final model" title="close-up of Shasta in the final model"/>
<em></em></p><center><em><sup><sub>a chonkier, less lonesome Mt Shasta</sub></sup></em></center>
<p>Present, but not obnoxious. I printed out a second test print to make sure it looked as good in
physical reality:</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/final_printed.jpg" alt="the final test print of the final model" title="the final test print of the final model"/></p>
<p>Verdict: yes. If you want, you can visit
<a href="https://www.printables.com/model/240867-topographic-california">https://www.printables.com/model/240867-topographic-california</a> and download the 3D printer file to
print it yourself at home. If you don&#39;t have a 3D printer, you can still look at and interact with a
3D model of it in the browser on that site, so it&#39;s still kind of neat. A couple different strangers
uploaded pictures of their prints of it, which I thought was cool!</p>
<p>I brought the mesh into FreeCAD and finally was able to create the STP file the shop had
asked for, a mere twenty-five days after I&#39;d last spoken with them.</p>

<p>I emailed the file to the shop, and said,</p>
<blockquote>
<p>As modeled, there&#39;s probably more high-frequency detail in the mountains than is necessary, as I&#39;m
going for something that feels nice to the touch so smoother is better. It&#39;s also modeled at a
slightly larger scale than necessary, though not too far off (it&#39;s 500x577mm, and I&#39;m interested
in the 400-500mm range for width; the relief height is in the 20-30mm range depending on scale). I
was imagining it would be carved with contour cuts in some thick nice ply, though I&#39;m happy to
hear better ideas; I have literally no experience with making something like this.</p>
</blockquote>
<p>The shop came back with,</p>
<blockquote>
<p>I can’t smooth out the cuts, I can only cut what is there.  That being said, if I use a rounded cutter, it will round out the valleys but not the peaks as it won’t go into areas that it can’t reach.</p>
<p>Hope that makes sense.</p>
<p>Let me know if this will work for you or not.  If you think it will, I will try to program the toolpaths and see what it will look like.</p>
</blockquote>
<p>I definitely didn&#39;t want to lose the sharp seams in the bottoms of the valleys!</p>
<blockquote>
<p>Me: I guess what I was really saying is that if some detail is lost due to using a larger cutting
head that&#39;s probably fine. I wouldn&#39;t necessarily want the valleys to be made more concave than
they already are, though. Does that make sense?</p>
<p>Shop: Yes, that makes sense.  I can use a Vee cutter and it will cut the sharp edges in the
valleys.&#34;</p>
</blockquote>
<p>It felt nice to be understood! Next came the issue of cost:</p>
<blockquote>
<p>I ran the numbers on both sizes using a .01” step-over cut, meaning that is how far apart the
finish cuts will be from each other.</p>
<p>You will probably see some tool marks depending on what type of material is used.</p>
<p>The larger one is coming in at around $850.00 and the 12” one at $350.00.</p>
<p>I can go tighter, say .005” step-over and it will probably not show many marks but I won’t know
until I run it.</p>
<p>If I do that it will double the cut time so close to doubling the price.</p>
</blockquote>
<p>One of the things that my wife had said she wanted to do with the carving of California was sand and
finish it herself, so the coarser 0.01-inch step-over cut was not really a problem. Even the
0.005-inch cut would still require a final sanding before staining or sealing.</p>
<p>The &#34;larger one&#34; the shop referred to was for a 20-inch wide carving, which would be way too huge
anyway; 12 inches was fine. Still, $350 was at the top of what I had hoped/expected to spend. I
hoped it was worth it!</p>
<p>After a few more back-and-forths and days, I got a message from the shop saying it was ready. They
also said,</p>
<blockquote>
<p>I decided to run these with half the original step-over, which means it takes twice as long but
the finish is almost smooth.  I think you will be pleased with it.</p>
</blockquote>
<p>Whoa! This meant he had used the 0.005-inch cutting resolution, and the job had taken twice as long
as originally quoted. Like the <a href="https://getyarn.io/yarn-clip/0f78e11f-df94-42e4-8bdf-b11c39326f7c">kind and generous tailor from <em>The Hudsucker
Proxy</em></a>, he had given me the
double-stitch anyway, even though I had insisted that single stitch was fine. I was very excited and
grateful, and couldn&#39;t wait to see it.</p>
<h2 id="pics-or-it-didn-t-happen">Pics or it didn&#39;t happen</h2>
<p>When I got there, it was almost exactly what I had imagined and hoped it would be. Obviously, you&#39;ve
seen the photo at the top of the page, but please enjoy this CNC-carved topographic California porn.</p>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/wood-full-portrait.jpg" alt="portrait of the whole state" title="portrait shot of the whole carving"/>
<em></em></p><center><em><sup><sub>some nice soft lighting</sub></sup></em></center>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/wood_sutter_buttes.jpg" alt="our old friend, the Sutter Buttes" title="our old friend, the Sutter Buttes"/>
<em></em></p><center><em><sup><sub>sutter buttes, we meet again</sub></sup></em></center>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/wooden_like_blender.jpg" alt="down low view, like the shot from Blender" title="down low view, like the shot from Blender"/>
<em></em></p><center><em><sup><sub>recognize this angle, from blender?</sub></sup></em></center>
<p><img src="https://proclamations.nebcorp-hias.com/sundries/a-thoroughly-digital-artifact/wooden_shasta_close-up.jpg" alt="close up of Shasta" title="close up of Shasta"/>
<em></em></p><center><em><sup><sub>lookin&#39; good, shasta</sub></sup></em></center>
<p>I wasn&#39;t the only one pleased with it; my wife was delighted when she saw it.</p>
<p>MISSION ACCOMPLISHED, HAPPY <em><sub>belated</sub></em> BIRTHDAY!</p>

<p>Obviously, I have tons of people to thank for their help with this, either directly or
indirectly. First and foremost, my wife, for everything, but especially for the inspiration and also
patience with me during this process.</p>
<p>A close second for this project goes to Steve at <a href="https://www.triumphcnc.com/">Triumph CNC</a>. He
asked me what I was going to do with it, and when I said give it to my wife as a gift, he said, &#34;Oh,
that&#39;s great! I feel even better about using the smaller step-over now.&#34; If you need some CNC
milling done in Los Angeles, maybe give them a call!</p>
<p>Along the way during this journey I got a lot of feedback and suggestions from friends and
colleagues, so thank you, &#39;rades!</p>
<p>Of course, this would all have been unthinkably difficult not so long ago, but thanks to things like
NASA&#39;s missions and public GIS datasets, almost anyone can do something like this.</p>
<p>And not just public, government data and organizations, but private, passion-driven free software
projects like Blender and FreeCAD that rival functionality found in multi-thousand-dollar commercial
packages. I&#39;m in awe of their accomplishments; they are true wonders of the modern world.</p>

<p>I said early on that I knew basically nothing about any of this, and that was true. I had had some
earlier casual experience with both Blender and FreeCAD, and many, many years ago I had taken a
semester of engineering drafting my first year of college. But I knew basically nothing about GIS,
about the different map projections, about shapefiles, about any of the tools or jargon. Likewise,
I have no experience or instruction in any kind of CNC milling; my scant 3D printing experience
doesn&#39;t really apply.</p>
<p>This article is as close as I could get to serializing nearly everything I had to learn and do to
create that carving.</p>
<p>And at the time it was happening, it didn&#39;t feel like I was retaining all of it, or that I really,
truly understood everything I had done; I was hurrying as fast as I could toward a particular
goal. But in the course of writing this, I was basically retracing my steps, and found that I really
did have a pretty good handle on it. One of my favorite things to do is learn stuff, so this was a
great outcome for me!</p>
<p>If I were to do this again, or if I were starting for the first time with the benefit of someone
else&#39;s experience, there are obviously a few things I would do differently. First off, I&#39;d see if I
could find a lower-resolution dataset. One arc second is way overkill; at the scale of a topo
carving that you can hold in your hands, a resolution of several arc <em>minutes</em> (one arc minute is
one <a href="https://en.wikipedia.org/wiki/Nautical_mile">nautical mile</a>, which is about 1.1 regular
(terrestrial?) miles) would probably be enough.</p>
<p>I&#39;d also use the USGS <a href="https://apps.nationalmap.gov/downloader/">national map downloader</a> site to
get just the California data; you can upload a shapefile and it&#39;ll give you back a masked
geotiff. If I had started from that, it would have shaved at least two weeks off the time it took me
to make the thing; I could have jumped immediately into being frustrated in Blender and FreeCAD.</p>
<p>Speaking of, I wish I could give some guidance on effectively using Blender and FreeCAD, but that&#39;s
a journey only you can plot. That&#39;s probably not true, but I still feel like a doofus in those
tools, so I don&#39;t feel like it&#39;s worth anyone&#39;s time to hear from me about them. Good luck in your
quest!</p>
<hr/>













        </section>
            
    </article>
</div></div>
  </body>
</html>
