<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://mullvad.net/en/blog/macos-sometimes-leaks-traffic-after-system-updates">Original</a>
    <h1>MacOS sometimes leaks traffic after system updates</h1>
    
    <div id="readability-page-1" class="page"><div><!-- HTML_TAG_START --><p>We have found that you could be leaking traffic on macOS after system updates. To our current knowledge a reboot resolves it. We are currently investigating this and will follow up with more information.</p>
<h2>The current state</h2>
<p>In this scenario the macOS firewall does not seem to function correctly and is disregarding firewall rules. Most traffic will still go inside the VPN tunnel since the routing table specifies that it should. Unfortunately apps are not required to respect the routing table and can send traffic outside the tunnel if they try to. Some examples of apps that do this are Apple’s own apps and services since macOS 14.6, up until a recent 15.1 beta.</p>
<h2>What’s next?</h2>
<p>We’ve reported this to Apple and hopefully we’ll see a fix in the near future. In the meanwhile we will continue to investigate this to be able to provide more information to Apple and to see if there are any workarounds that we can implement in the app.</p>
<h2>Check if you are affected</h2>
<p>Run the following commands in a terminal to check if you are affected:</p>
<p> 1. Add a firewall rule that blocks all traffic</p>
<pre><code>echo &#34;block drop quick all&#34; | sudo pfctl -ef -</code></pre>
<p>2. Try to send traffic outside the tunnel</p>
<pre><code>curl https://am.i.mullvad.net/connected</code></pre>
<p>To clean up after the experiment, disable the firewall and clear all rules.</p>
<pre><code>sudo pfctl -d</code></pre>
<p>It is also possible to check if our app is leaking by doing the following:</p>
<p>1. Make sure you are not connected to a VPN</p>
<pre><code>route get mullvad.net | sed -nE &#39;s/.*interface: //p&#39;</code></pre>
<p>3. Connect to a VPN server using our app</p>
<pre><code>curl --interface &lt;interface&gt; https://am.i.mullvad.net/connected</code></pre>
<p>5. The request should time out if everything is working properly. If there is a response then you are leaking.</p><!-- HTML_TAG_END --></div></div>
  </body>
</html>
