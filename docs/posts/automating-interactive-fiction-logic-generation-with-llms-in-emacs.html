<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.tendollaradventure.com/automating-story-logic-with-llms/">Original</a>
    <h1>Automating Interactive Fiction Logic Generation with LLMs in Emacs</h1>
    
    <div id="readability-page-1" class="page"><div>		
		<div><p><em>summary: I automated the creation of transaction tracking logic for an Emacs-based interactive fiction book using an LLM (via gptel).</em>
</p>

<p>I have been writing an interactive children&#39;s book in Emacs where the protagonist <em>Daphne</em> earns, saves or spends money during her weeklong entrepreneurial adventure. The passages in my book are organized as follows:
</p>

<p><img src="https://blog.tendollaradventure.com/img/tda_passage_layout.webp" alt="Layout of my interactive fiction book"/></p>


<p>Since a reader may arrive at a passage from multiple routes, every passage includes some code to track transaction amounts, amongst other parameters. Using this code, I&#39;m able to show the reader Daphne&#39;s cash balance at any point in the book. 
</p>

<p><img src="https://blog.tendollaradventure.com/img/piggy_bank.webp" alt="screenshot of piggy bank showing cash balance"/></p>


<p>After writing 34 passages, I realized I could enhance the book&#39;s educational value by showing how Daphne&#39;s cash balance was calculated. This new feature would require modifying the code in every passage to include the context of the transactions. Hard to imagine now, but there was a time when implementing the feature would require tediously editing the code in every passage. To explore a more efficient solution, I turned to an LLM via the <a href="https://github.com/karthink/gptel" target="_blank">gptel</a> package for Emacs.
</p>

<p>Here&#39;s how I added the context of the transactions to every passage: I select the entire story, which is a single org file in Emacs, with <code>C-x h</code>, invoke <code>gptel-rewrite</code> with <code>C-u C-c r RET d</code>, then type out the following descriptive prompt:
</p>

<p><code>The selection is a series of passages, each passage falls under an org heading. each passage has a source code block. update the source code blocks to include a json object, cashOperations, that tracks the change in cash in the corresponding passage. The json object contains the following keys: &#34;operation&#34;, &#34;amount&#34; and &#34;description&#34;. &#34;operation&#34; can be &#34;add&#34; or &#34;subtract&#34;, &#34;amount&#34; is the change in cash amount (positive value), and description is a string of 3-5 words that describes the reason for the change in cash. Only append the cashOperations object if there has been an event or action to change the cash amount even if the net change is zero.</code>
</p>

<p>I follow up with <code>RET r</code> and wait.
</p>

<p><video controls="">
  <source src="/img/writing_book_logic_o.webm" type="video/webm"/>
  <source src="/img/writing_book_logic_o.mp4" type="video/mp4"/>
  Your browser does not support the video tag.
</video>
</p>

<p>I now have the context to implement an arithmetic explainer option.
</p>

<p><img src="https://blog.tendollaradventure.com/img/piggy_bank_ae.webp" alt="screenshot of the piggy bank with the arithmetic explainer enabled"/></p>



</div>

	    </div></div>
  </body>
</html>
