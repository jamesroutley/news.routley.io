<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://dataswamp.org/~solene/2022-07-23-openbsd-sshfs.html">Original</a>
    <h1>How to Use Sshfs on OpenBSD</h1>
    
    <div id="readability-page-1" class="page"><div>
<article id="20220723">
  <header>
  
    
    <p>Written by <em>Sol√®ne</em>, on 23 July 2022.</p>
    
  </header>
  
<p>Today we will learn about how to use sshfs, a program to mount a remote directory through ssh into our local file system.
</p>
<p>But OpenBSD has a different security model than in other Unixes systems, you can&#39;t use FUSE (Filesystem in USErspace) file systems from a non-root user. And because you need to run your fuse mount program as root, the mount point won&#39;t be reachable by other users because of permissions.
</p>
<p>Fortunately, with the correct combination of flags, this is actually achievable.
</p>
<p><a href="https://github.com/libfuse/sshfs">sshfs project website</a></p>

<p>First, as root we need to install sshfs-fuse from packages.
</p>
<pre><code># pkg_add sshfs-fuse
</code></pre>

<p>If we run sshfs as our user, we will get the error &#34;fuse_mount: permission denied&#34;, so root is mandatory for running the command.
</p>
<p>But if we run &#34;sshfs server.local:/home /mnt&#34; as root, we can&#39;t reach the /mnt directory with our regular user because it&#39;s root property:
</p>
<pre><code>$ ls /mnt/
ls: /mnt/: Permission denied
</code></pre>
<p>This confirms sshfs needs some extra flags to be used for non-root users on OpenBSD.
</p>

<p>As root, we will run sshfs to mount a directory from t470-wifi.local (my laptop Wi-Fi IP address on my LAN) to make it available to our user with uid 1000 and gid 1000 (this is the ids for the first user added), you can find the information about your users with the command &#34;id&#34;.  We will also use the allow_other mount option.
</p>
<pre><code># sshfs -o idmap=user,allow_other,uid=1000,gid=1000 solene@t470-wifi.local:/home/solene/ /mnt
</code></pre>
<p>After this command, when I switch to my user whose id and gid is 1000, I can read and write into /mnt.
</p>

<p>This article exists because many OpenBSD users struggle using sshfs, and it&#39;s not easy to find the solution on the Internet.
</p>
<p><a href="https://www.vincentdelft.be/static/post/post_20190203/openbsd-as-nas.pdf">OpenBSD as NAS FOSDEM talk giving an example of sshfs use</a></p>
<p>= &gt; https://marc.info/?l=openbsd-misc&amp;m=153390693400573&amp;w=2 misc@openbsd.org email thread explaining why fuse mount behavior changed in 2018
</p>

</article>
</div></div>
  </body>
</html>
