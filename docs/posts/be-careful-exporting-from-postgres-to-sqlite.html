<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://iafisher.com/blog/2024/11/exporting-postgres-to-sqlite">Original</a>
    <h1>Be careful exporting from Postgres to SQLite</h1>
    
    <div id="readability-page-1" class="page"><div class="page">
  <header>
  <a href="http://iafisher.com/">home</a>
  <a href="http://iafisher.com/blog">blog</a>
  <a href="http://iafisher.com/portfolio">portfolio</a>
  <a href="https://outsiderart.substack.com/" target="_blank">outsider art</a>
  <a href="https://github.com/iafisher" target="_blank">github</a>
</header>


  
  

  <p><code>psql</code> exports boolean columns as <code>t</code> or <code>f</code>, which SQLite will accept but treat differently from <code>1</code> and <code>0</code>.</p>
<p>I made this unfortunate discovery when I ran the full test suite for <a href="https://cityquiz.io">CityQuiz</a> for the first time in a while, and found that some of the tests failed because some cities were not listed as national capitals as expected.</p>
<p>I soon realized that <em>no</em> cities in the database were marked as capitals. The data was correct on the production site, so I immediately suspected there was a bug in the script I use to copy data from Postgres in prod to SQLite in development.</p>
<p>Sure enough, I found that <code>psql</code> serializes boolean columns as <code>t</code> or <code>f</code>, and while SQLite will accept these values, they won&#39;t work with code that expects boolean columns to be <code>1</code> or <code>0</code>.</p>
<p>This is <a href="https://iafisher.com/blog/2021/10/using-sqlite-effectively-in-python">not the first time</a> that SQLite&#39;s loose typing has bitten me, though, for what it&#39;s worth, SQLite&#39;s <a href="https://www.sqlite.org/stricttables.html">strict tables</a> feature would have caught this issue, but it is not turned on by default</p>
<p>My stop-gap solution was to add <code>UPDATE</code> statements in the import script to convert the boolean columns to the correct values – though this requires me to remember to update the import script every time I add a new boolean column.</p>
<p>I&#39;d love to know if there is a better solution to this particular problem, or a better way of accomplishing Postgres-to-SQLite export in general.</p>
<p>One other disturbing revelation from this debugging session is that SQLite will happily execute <code>.import my-data.csv my_new_table;</code> <em>but it will treat the semicolon as part of the table&#39;s name</em>. ∎</p>

  
</div></div>
  </body>
</html>
