<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://codeball.ai/blog/codex-todo-mvc">Original</a>
    <h1>Building a back end using only OpenAI Codex</h1>
    
    <div id="readability-page-1" class="page"><div><div><header><a href="https://codeball.ai/">Codeball</a>
			</header>

		<div>

	<div><p><img src="https://codeball.ai/avatars/gustav.jpeg"/></p><div><p>Gustav Westling</p>
			<p>August 24th, 2022</p></div></div>

	<p>In the last few weeks, I and the rest of our team have been playing around a lot with OpenAI&#39;s
		Codex Model, as we&#39;ve incorporated it into our latest feature (<a href="https://codeball.ai/suggester">the suggester</a>), and we&#39;ve been generally impressed by it&#39;s performance.
	</p>

	<p>&#34;OpenAI Codex is an artificial intelligence model developed by OpenAI. It parses natural
		language and generates code in response. It is used to power GitHub Copilot, a programming
		autocompletion tool developed for Visual Studio Code. Codex is a descendant of OpenAI&#39;s GPT-3
		model, fine-tuned for use in programming applications.&#34;
	</p>

	<p>I had the idea of a challenge for myself: Create something useful, from scratch, using only
		Codex.
	</p>

	<p>My goal was to create a backend for a TodoMVC-style app. In our case, it will be a backend for a
		tasklist with tasks that can be added, listed, and marked as completed. The frontend is to be
		built manually (in SvelteKit).
	</p>

	<p><img src="https://codeball.ai/todo-mvc.png"/>
		<i>Screenshot of the final application, once completed</i></p>

	<p>First, I tried to create the backend in Go, but Codex continuously messed up the syntax when
		inserting new code, and usually ended up adding a new function withing another one (syntax
		error!)
	</p>
	<p>I switched strategy, and attempted to generate a Python app instead, and it worked great. The
		continuation of this blog post is a series of prompts used, together with comments about what
		worked and what didn&#39;t end up working out.
	</p>

	<p>I ended up using the &#34;Codex&#34; in the <a href="https://openai.com/blog/gpt-3-edit-insert/">&#34;edit&#34; mode</a> as it makes the prompt design easier. The edit mode takes two inputs, a file and a instruction/prompt,
		and spits out a new version of the input file. For the input file, I started with an empty file,
		and for later prompts the output of the previous step was used.
	</p>

	<p>Here we go! First prompt:</p></div>

<div><div><div><p><code>Create a hello world flask webserver</code></p><p><!-- HTML_TAG_START -->Let&#39;s get started! In my first attempt I used &#34;python&#34; instead of &#34;flask&#34; in the prompt. The code worked, but was too low level, and I could sense that it would get complicated too fast.<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask</p>
				</div><div><p>8</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>Add a /tasks endpoint listing all tasks in a sqlite database</code></p><p><!-- HTML_TAG_START -->A Hello World might be cool and all, but it&#39;s time to write some <i>real</i> code.<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify</p>
				</div><div><p>12</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>14</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>18</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>before_first_request: Make sure that the tasks table exists (id auto incremental id, description text, done bool)</code></p><p><!-- HTML_TAG_START -->The tasks.db database does not exist yet, and has no tables.<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify</p>
				</div><div><p>6</p>
					<p>@app.before_first_request</p>
				</div><div><p>8</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>10</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>11</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>24</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>26</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>30</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>Update the tasks() method to return tasks as objects</code></p><p><!-- HTML_TAG_START -->Let&#39;s make the /tasks endpoint easier to consume (it&#39;s currently returning a list of lists), return as a list of objects.<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify</p>
				</div><div><p>6</p>
					<p>@app.before_first_request</p>
				</div><div><p>8</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>10</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>11</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>24</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>26</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>30</p>
					<p>        tasks_as_objects.append({</p>
				</div><div><p>32</p>
					<p>            &#34;description&#34;: task[1],</p>
				</div><div><p>35</p>
					<p>    return jsonify(tasks_as_objects)</p>
				</div><div><p>37</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>Add a /add endpoint that inserts new entries to the tasks table.</code></p><p><!-- HTML_TAG_START -->There is no CRUD without the C!<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify, request</p>
				</div><div><p>6</p>
					<p>@app.before_first_request</p>
				</div><div><p>8</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>10</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>11</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>24</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>26</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>30</p>
					<p>        tasks_as_objects.append({</p>
				</div><div><p>32</p>
					<p>            &#34;description&#34;: task[1],</p>
				</div><div><p>35</p>
					<p>    return jsonify(tasks_as_objects)</p>
				</div><div><p>37</p>
					<p>@app.route(&#34;/add&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>39</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>41</p>
					<p>    c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (request.form[&#34;description&#34;], 0))</p>
				</div><div><p>46</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>Add a /update endpoint that updates task descriptions and done status</code></p><p><!-- HTML_TAG_START -->Codex is on a streak, this works nicely!<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify, request</p>
				</div><div><p>6</p>
					<p>@app.before_first_request</p>
				</div><div><p>8</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>10</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>11</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>24</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>26</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>30</p>
					<p>        tasks_as_objects.append({</p>
				</div><div><p>32</p>
					<p>            &#34;description&#34;: task[1],</p>
				</div><div><p>35</p>
					<p>    return jsonify(tasks_as_objects)</p>
				</div><div><p>37</p>
					<p>@app.route(&#34;/add&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>39</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>41</p>
					<p>    c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (request.form[&#34;description&#34;], 0))</p>
				</div><div><p>46</p>
					<p>@app.route(&#34;/update&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>48</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>50</p>
					<p>    c.execute(&#34;UPDATE tasks SET description = ?, done = ? WHERE id = ?&#34;, (request.form[&#34;description&#34;], request.form[&#34;done&#34;], request.form[&#34;id&#34;]))</p>
				</div><div><p>55</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>Add CORS headers to allow connections from any host</code></p><p><!-- HTML_TAG_START -->Uuuuh! Our friend CORS showed up and stopped us from enjoying getting everything on the first try. We need to add a CORS handler.<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify, request</p>
				</div><div><p>2</p>
					<p>from flask_cors import CORS</p>
				</div><div><p>8</p>
					<p>@app.before_first_request</p>
				</div><div><p>10</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>12</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>13</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>26</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>28</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>32</p>
					<p>        tasks_as_objects.append({</p>
				</div><div><p>34</p>
					<p>            &#34;description&#34;: task[1],</p>
				</div><div><p>37</p>
					<p>    return jsonify(tasks_as_objects)</p>
				</div><div><p>39</p>
					<p>@app.route(&#34;/add&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>41</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>43</p>
					<p>    c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (request.form[&#34;description&#34;], 0))</p>
				</div><div><p>48</p>
					<p>@app.route(&#34;/update&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>50</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>52</p>
					<p>    c.execute(&#34;UPDATE tasks SET description = ?, done = ? WHERE id = ?&#34;, (request.form[&#34;description&#34;], request.form[&#34;done&#34;], request.form[&#34;id&#34;]))</p>
				</div><div><p>57</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>Update the add() method to return the id of the task created in json</code></p><p><!-- HTML_TAG_START -->The response from /add was a bit simple, and to improve the frontend (that I developer manually at this stage), it was nice to have the ID of the task in the response.<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify, request</p>
				</div><div><p>2</p>
					<p>from flask_cors import CORS</p>
				</div><div><p>8</p>
					<p>@app.before_first_request</p>
				</div><div><p>10</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>12</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>13</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>26</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>28</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>32</p>
					<p>        tasks_as_objects.append({</p>
				</div><div><p>34</p>
					<p>            &#34;description&#34;: task[1],</p>
				</div><div><p>37</p>
					<p>    return jsonify(tasks_as_objects)</p>
				</div><div><p>39</p>
					<p>@app.route(&#34;/add&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>41</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>43</p>
					<p>    c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (request.form[&#34;description&#34;], 0))</p>
				</div><div><p>46</p>
					<p>    return jsonify({&#34;id&#34;: c.lastrowid})</p>
				</div><div><p>48</p>
					<p>@app.route(&#34;/update&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>50</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>52</p>
					<p>    c.execute(&#34;UPDATE tasks SET description = ?, done = ? WHERE id = ?&#34;, (request.form[&#34;description&#34;], request.form[&#34;done&#34;], request.form[&#34;id&#34;]))</p>
				</div><div><p>57</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>Format</code></p><p><!-- HTML_TAG_START -->This step is just for fun, and with a simple &#34;Format&#34; prompt, the code was formatted to be compliant with PEP 8!<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify, request</p>
				</div><div><p>2</p>
					<p>from flask_cors import CORS</p>
				</div><div><p>9</p>
					<p>@app.before_first_request</p>
				</div><div><p>11</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>13</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>14</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>28</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>30</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>34</p>
					<p>        tasks_as_objects.append({</p>
				</div><div><p>36</p>
					<p>            &#34;description&#34;: task[1],</p>
				</div><div><p>39</p>
					<p>    return jsonify(tasks_as_objects)</p>
				</div><div><p>42</p>
					<p>@app.route(&#34;/add&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>44</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>46</p>
					<p>    c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (request.form[&#34;description&#34;], 0))</p>
				</div><div><p>49</p>
					<p>    return jsonify({&#34;id&#34;: c.lastrowid})</p>
				</div><div><p>52</p>
					<p>@app.route(&#34;/update&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>54</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>56</p>
					<p>    c.execute(&#34;UPDATE tasks SET description = ?, done = ? WHERE id = ?&#34;, (request.form[&#34;description&#34;], request.form[&#34;done&#34;], request.form[&#34;id&#34;]))</p>
				</div><div><p>62</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div><div><div><p><code>before_first_request, before conn.close: if the tasks table is empty, add three rows</code></p><p><!-- HTML_TAG_START -->To make [<a href="https://todo.codeball.ai/">the demo</a>] nicer to look at, let&#39;s add some example data!<!-- HTML_TAG_END --></p></div>

	<div><div><div><p>1</p>
					<p>from flask import Flask, jsonify, request</p>
				</div><div><p>2</p>
					<p>from flask_cors import CORS</p>
				</div><div><p>9</p>
					<p>@app.before_first_request</p>
				</div><div><p>11</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>13</p>
					<p>    c.execute(&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS tasks (</p>
				</div><div><p>14</p>
					<p>        id INTEGER PRIMARY KEY AUTOINCREMENT,</p>
				</div><div><p>22</p>
					<p>@app.before_first_request</p>
				</div><div><p>24</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>26</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>29</p>
					<p>        c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (&#34;Learn Python&#34;, 0))</p>
				</div><div><p>30</p>
					<p>        c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (&#34;Learn Flask&#34;, 0))</p>
				</div><div><p>31</p>
					<p>        c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (&#34;Learn SQL&#34;, 0))</p>
				</div><div><p>42</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>44</p>
					<p>    c.execute(&#34;SELECT * FROM tasks&#34;)</p>
				</div><div><p>48</p>
					<p>        tasks_as_objects.append({</p>
				</div><div><p>50</p>
					<p>            &#34;description&#34;: task[1],</p>
				</div><div><p>53</p>
					<p>    return jsonify(tasks_as_objects)</p>
				</div><div><p>56</p>
					<p>@app.route(&#34;/add&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>58</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>60</p>
					<p>    c.execute(&#34;INSERT INTO tasks (description, done) VALUES (?, ?)&#34;, (request.form[&#34;description&#34;], 0))</p>
				</div><div><p>63</p>
					<p>    return jsonify({&#34;id&#34;: c.lastrowid})</p>
				</div><div><p>66</p>
					<p>@app.route(&#34;/update&#34;, methods=[&#34;POST&#34;])</p>
				</div><div><p>68</p>
					<p>    conn = sqlite3.connect(&#39;tasks.db&#39;)</p>
				</div><div><p>70</p>
					<p>    c.execute(&#34;UPDATE tasks SET description = ?, done = ? WHERE id = ?&#34;, (request.form[&#34;description&#34;], request.form[&#34;done&#34;], request.form[&#34;id&#34;]))</p>
				</div><div><p>76</p>
					<p>if __name__ == &#34;__main__&#34;:</p>
				</div></div></div>
	</div></div>

<div><p>That&#39;s it, our backend is done! You can check it out, and use the frontend at <a href="https://todo.codeball.ai/">todo.codeball.ai</a>.
	</p>
	<p>Developing with Codex is a bit special, and it sometimes takes a few attempts to get it to write <i>exactly</i>
		what you want it to. But in broad strokes, getting from nothing to <i>something</i> in just
		<strong>10 prompts</strong> is really impressive and encouraging.
	</p>
	<p>Codex continues to amaze me, and I&#39;m sure that this task could be done in fewer steps (maybe
		even one?) with some <i>prompt engineering</i>. I&#39;d like to start a <strong>prompt golf</strong>
		challenge! If you have access to Codex, can you re-create this backend in fewer steps? As few characters
		as possible?
	</p>
	<p>Would be cool to see how far we can take this, looking forward to hear in the comments on <a href="https://news.ycombinator.com/item?id=32577624">Hacker News</a>.
	</p></div>





<p><a href="https://codeball.ai/">HIRE A BOT</a></p></div></div></div>
  </body>
</html>
