<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/maxpert/marmot">Original</a>
    <h1>Marmot: Multi-writer distributed SQLite based on NATS</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a href="https://goreportcard.com/report/github.com/maxpert/marmot" rel="nofollow"><img src="https://camo.githubusercontent.com/87831ce5c8f2926e577db195d8486ab14c92427246978f910ec010a65cbc26ae/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f6d6178706572742f6d61726d6f74" alt="Go Report Card" data-canonical-src="https://goreportcard.com/badge/github.com/maxpert/marmot"/></a>
<a href="https://discord.gg/AWUwY66XsE" rel="nofollow"><img src="https://camo.githubusercontent.com/e2b4960290c2bfa50e37e1d5ebe4ac0f4ba50ec59e6146707b88f185eae57cd1/68747470733a2f2f62616467656e2e6e65742f62616467652f69636f6e2f646973636f72643f69636f6e3d646973636f7264266c6162656c3d4d61726d6f74" alt="Discord" data-canonical-src="https://badgen.net/badge/icon/discord?icon=discord&amp;label=Marmot"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/d833bc56dd0b73030efcf262296010168436e1d2b3542293a48b1c6250506d33/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6d6178706572742f6d61726d6f74"><img src="https://camo.githubusercontent.com/d833bc56dd0b73030efcf262296010168436e1d2b3542293a48b1c6250506d33/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6d6178706572742f6d61726d6f74" alt="GitHub" data-canonical-src="https://img.shields.io/github/license/maxpert/marmot"/></a></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-what--why" aria-hidden="true" tabindex="-1" href="#what--why"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>What &amp; Why?</h2>
<p dir="auto">Marmot is a distributed SQLite replicator with leaderless, and eventual consistency. It allows you to build a robust replication
between your nodes by building on top of fault-tolerant <a href="https://nats.io/" rel="nofollow">NATS JetStream</a>.</p>
<p dir="auto">So if you are running a read heavy website based on SQLite, you should be easily able to scale it out by adding more SQLite replicated nodes.
SQLite is probably the most ubiquitous DB that exists almost everywhere, Marmot aims to make it even more ubiquitous for server
side applications by building a replication layer on top.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-quick-start" aria-hidden="true" tabindex="-1" href="#quick-start"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Quick Start</h2>
<p dir="auto">Download <a href="https://github.com/maxpert/marmot/releases/latest">latest</a> Marmot and extract package using:</p>
<div data-snippet-clipboard-copy-content="tar vxzf marmot-v*.tar.gz"><pre><code>tar vxzf marmot-v*.tar.gz
</code></pre></div>
<p dir="auto">From extracted directory run <code>examples/run-cluster.sh</code>. Make a change in <code>/tmp/marmot-1.db</code> using:</p>
<div data-snippet-clipboard-copy-content="bash &gt; sqlite3 /tmp/marmot-1.db
sqlite3 &gt; INSERT INTO Books (title, author, publication_year) VALUES (&#39;Pride and Prejudice&#39;, &#39;Jane Austen&#39;, 1813);"><pre><code>bash &gt; sqlite3 /tmp/marmot-1.db
sqlite3 &gt; INSERT INTO Books (title, author, publication_year) VALUES (&#39;Pride and Prejudice&#39;, &#39;Jane Austen&#39;, 1813);
</code></pre></div>
<p dir="auto">Now observe changes getting propagated to other database <code>/tmp/marmot-2.db</code>:</p>
<div data-snippet-clipboard-copy-content="bash &gt; sqlite3 /tmp/marmot-2.db
sqlite3 &gt; SELECT * FROM Books;"><pre><code>bash &gt; sqlite3 /tmp/marmot-2.db
sqlite3 &gt; SELECT * FROM Books;
</code></pre></div>
<p dir="auto">You should be able to make changes interchangeably and see the changes getting propagated.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-out-in-wild" aria-hidden="true" tabindex="-1" href="#out-in-wild"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Out in wild</h2>
<p dir="auto">Here are some official, and community demos/usages showing Marmot out in wild:</p>
<ul dir="auto">
<li><a href="https://www.youtube.com/watch?v=HycGtLjlikI" rel="nofollow">2-node HA for edge Kubernetes - Using Marmot</a></li>
<li><a href="https://maxpert.github.io/marmot/demo" rel="nofollow">Scaling Isso with Marmot on Fly.io</a></li>
<li><a href="https://github.com/maxpert/marmot-pocketbase-flyio">Scaling PocketBase with Marmot on Fly.io</a></li>
<li><a href="https://www.youtube.com/watch?v=QqZl61bJ9BA" rel="nofollow">Scaling PocketBase with Marmot 0.4.x</a></li>
<li><a href="https://youtu.be/GQ5x8pc9vuI" rel="nofollow">Scaling Keystone 6 with Marmot 0.4.x</a></li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-what-is-the-difference-from-others" aria-hidden="true" tabindex="-1" href="#what-is-the-difference-from-others"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>What is the difference from others?</h2>
<p dir="auto">Marmot is essentially a CDC (Change Data Capture) and replication pipeline running top of NATS. It can automatically configure appropriate
JetStreams making sure those streams evenly distribute load over those shards, so scaling simply boils down to adding more nodes, and
re-balancing those JetStreams (auto rebalancing not implemented yet).</p>
<p dir="auto">There are a few solutions like <a href="https://github.com/rqlite/rqlite">rqlite</a>, <a href="https://dqlite.io/" rel="nofollow">dqlite</a>, and
<a href="https://github.com/superfly/litefs">LiteFS</a> etc. All of them either are layers on top of SQLite (e.g.
rqlite, dqlite) that requires them to sit in the middle with network layer in order to provide
replication; or intercept physical page level writes to stream them off to replicas. In both
cases they require a single primary node where all the writes have to go, and then these
changes are applied to multiple readonly replicas.</p>
<p dir="auto">Marmot on the other hand is born different. It&#39;s born to act as a side-car to your existing processes:</p>
<ul dir="auto">
<li>Instead of requiring single primary, there is <strong>no primary</strong>! Which means <strong>any node can make changes to its local DB</strong>.
Marmot will use triggers to capture your changes, and then stream them off to NATS.</li>
<li>Instead of being strongly consistent, Marmot is <strong>eventually consistent</strong>. Which means no locking, or blocking of nodes.</li>
<li>It does not require any changes to your existing SQLite application logic for reading/writing.</li>
</ul>
<p dir="auto">Making these choices has multiple benefits:</p>
<ul dir="auto">
<li>You can read, and write to your SQLite database like you normally do. No extension, or VFS changes.</li>
<li>You can write on any node! You don&#39;t have to go to single primary for writing your data.</li>
<li>As long as you start with same copy of database, all the mutations will eventually converge
(hence eventually consistent).</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-what-happens-when-there-is-a-race-condition" aria-hidden="true" tabindex="-1" href="#what-happens-when-there-is-a-race-condition"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>What happens when there is a race condition?</h2>
<p dir="auto">In Marmot every row is uniquely mapped to a JetStream. This guarantees that for any node to publish changes for a row it has to go through
same JetStream as everyone else. If two nodes perform a change to same row in parallel, both of the nodes will compete to publish their
change to JetStream cluster. Due to <a href="https://docs.nats.io/running-a-nats-service/configuration/clustering/jetstream_clustering#raft" rel="nofollow">RAFT quorum</a>
constraint only one of the writer will be able to get its changes published first. Now as these changes are applied (even the publisher applies
its own changes to database) the <strong>last writer</strong> will always win. This means there is NO serializability guarantee of a transaction
spanning multiple tables. This is a design choice, in order to avoid any sort of global locking, and performance.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-limitations" aria-hidden="true" tabindex="-1" href="#limitations"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Limitations</h2>
<p dir="auto">Right now there are a few limitations on current solution:</p>
<ul dir="auto">
<li>Marmot does not support schema changes propagation, so any tables you create or columns you change won&#39;t be reflected.
This feature is being <a href="https://github.com/maxpert/marmot/discussions/59" data-hovercard-type="discussion" data-hovercard-url="/maxpert/marmot/discussions/59/hovercard">debated</a> and will be available in future
versions of Marmot.</li>
<li>You can&#39;t watch tables selectively on a DB. This is due to various limitations around snapshot and restore mechanism.</li>
<li>WAL mode required - since your DB is going to be processed by multiple processes the only way to have multi-process
changes reliably is via WAL.</li>
<li>Marmot is eventually consistent - This simply means rows can get synced out of order, and <code>SERIALIZABLE</code> assumptions
on transactions might not hold true anymore. However your application can choose to redirect writes to single node
so that your changes are always replayed in order.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-features" aria-hidden="true" tabindex="-1" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Features</h2>
<p dir="auto"><a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/a935962de0edf3144e936c824324624f4864636703b523c8e80103bc3f3fb83a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4576656e7475616c6c79253230436f6e73697374656e742d2545322539432539342545462542382538462d677265656e"><img src="https://camo.githubusercontent.com/a935962de0edf3144e936c824324624f4864636703b523c8e80103bc3f3fb83a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4576656e7475616c6c79253230436f6e73697374656e742d2545322539432539342545462542382538462d677265656e" alt="Eventually Consistent" data-canonical-src="https://img.shields.io/badge/Eventually%20Consistent-%E2%9C%94%EF%B8%8F-green"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/8af699b361c3fc9fd6e9fce1b73bfc07cf72937fc2300bfa5018f23bdeeb206c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c65616465726c6573732532305265706c69636174696f6e2d2545322539432539342545462542382538462d677265656e"><img src="https://camo.githubusercontent.com/8af699b361c3fc9fd6e9fce1b73bfc07cf72937fc2300bfa5018f23bdeeb206c/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c65616465726c6573732532305265706c69636174696f6e2d2545322539432539342545462542382538462d677265656e" alt="Leaderless Replication" data-canonical-src="https://img.shields.io/badge/Leaderless%20Replication-%E2%9C%94%EF%B8%8F-green"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/6fd11563aff681a5aec2104c198d7b60201f8417935b49d8e614e16e60231933/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4661756c74253230546f6c6572616e742d2545322539432539342545462542382538462d677265656e"><img src="https://camo.githubusercontent.com/6fd11563aff681a5aec2104c198d7b60201f8417935b49d8e614e16e60231933/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4661756c74253230546f6c6572616e742d2545322539432539342545462542382538462d677265656e" alt="Fault Tolerant" data-canonical-src="https://img.shields.io/badge/Fault%20Tolerant-%E2%9C%94%EF%B8%8F-green"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/25779ee511c7ba9877c484fd6238ac4a0cc55630297e933f49e3bec28dff9aa8/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4275696c742532306f6e2532304e4154532d2545322539432539342545462542382538462d677265656e"><img src="https://camo.githubusercontent.com/25779ee511c7ba9877c484fd6238ac4a0cc55630297e933f49e3bec28dff9aa8/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4275696c742532306f6e2532304e4154532d2545322539432539342545462542382538462d677265656e" alt="Built on NATS" data-canonical-src="https://img.shields.io/badge/Built%20on%20NATS-%E2%9C%94%EF%B8%8F-green"/></a></p>
<ul dir="auto">
<li>
<p dir="auto">Leaderless replication never requiring a single node to handle all write load.</p>
</li>
<li>
<p dir="auto">Ability to snapshot and fully recover from those snapshots. Multiple storage options for snapshot:</p>

</li>
<li>
<p dir="auto">Built with NATS, abstracting stream distribution and replication.</p>
</li>
<li>
<p dir="auto">Support for log entry compression, handling content heavy CMS needs.</p>
</li>
<li>
<p dir="auto">Sleep timeout support for serverless scenarios.</p>
</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-dependencies" aria-hidden="true" tabindex="-1" href="#dependencies"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Dependencies</h2>
<p dir="auto">Starting 0.8+ Marmot comes with embedded <a href="https://nats.io/download/" rel="nofollow">nats-server</a> with JetStream support. This not only reduces
the dependencies/processes that one might have to spin up, but also provides with out-of-box tooling like
<a href="https://github.com/nats-io/natscli">nat-cli</a>. You can also use existing libraries to build additional
tooling and scripts due to standard library support. Here is one example using Deno:</p>
<div data-snippet-clipboard-copy-content="deno run --allow-net https://gist.githubusercontent.com/maxpert/d50a49dfb2f307b30b7cae841c9607e1/raw/6d30803c140b0ba602545c1c0878d3394be548c3/watch-marmot-change-logs.ts -u &lt;nats_username&gt; -p &lt;nats_password&gt; -s &lt;comma_seperated_server_list&gt;"><pre><code>deno run --allow-net https://gist.githubusercontent.com/maxpert/d50a49dfb2f307b30b7cae841c9607e1/raw/6d30803c140b0ba602545c1c0878d3394be548c3/watch-marmot-change-logs.ts -u &lt;nats_username&gt; -p &lt;nats_password&gt; -s &lt;comma_seperated_server_list&gt;
</code></pre></div>
<p dir="auto">The output will look something like this:
<a target="_blank" rel="noopener noreferrer nofollow" href="https://user-images.githubusercontent.com/22441/196061378-21f885b3-7958-4a7e-994b-09d4e86df721.png"><img src="https://user-images.githubusercontent.com/22441/196061378-21f885b3-7958-4a7e-994b-09d4e86df721.png" alt="image"/></a></p>
<h2 tabindex="-1" dir="auto"><a id="user-content-production-status" aria-hidden="true" tabindex="-1" href="#production-status"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Production status</h2>
<ul dir="auto">
<li><code>v0.8.x</code> introduced support for embedded NATS. This is recommended version for production.</li>
<li><code>v0.7.x</code> moves to file based configuration rather than CLI flags, and S3 compatible snapshot storage.</li>
<li><code>v0.6.x</code> introduces snapshot save/restore. It&#39;s in pre-production state.</li>
<li><code>v0.5.x</code> introduces change log compression with zstd.</li>
<li><code>v0.4.x</code> introduces NATS based change log streaming, and continuous multi-directional sync.</li>
<li><code>v0.3.x</code> is deprecated, and unstable. DO NOT USE IT IN PRODUCTION.</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-cli-documentation" aria-hidden="true" tabindex="-1" href="#cli-documentation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>CLI Documentation</h2>
<p dir="auto">Marmot picks simplicity, and lesser knobs to configure by choice. Here are command line options you can use to
configure marmot:</p>
<ul dir="auto">
<li><code>config</code> - Path to a TOML configuration file. Check out <code>config.toml</code> comments for detailed documentation
on various configurable options.</li>
<li><code>cleanup</code> (default: <code>false</code>) - Just cleanup and exit marmot. Useful for scenarios where you are
performing a cleanup of hooks and change logs.</li>
<li><code>save-snapshot</code> (default: <code>false</code> <code>Since 0.6.x</code>) - Just snapshot the local database, and upload snapshot
to NATS/S3 server</li>
<li><code>cluster-addr</code> (default: none <code>Since 0.8.x</code>) - Sets the binding address for cluster, when specifying
this flag at-least two nodes will be required (or <code>replication_log.replicas</code>). It&#39;s a simple
<code>&lt;bind_address&gt;:&lt;port&gt;</code> pair that can be used to bind cluster listening server.
<ul dir="auto">
<li>Since <code>v0.8.4</code> Marmot will automatically expose a leaf server on <code>&lt;bind_address&gt;:&lt;port + 1&gt;</code>. This is
intended to reduce the number for flags. So if you expose cluster on port <code>4222</code> the port <code>4223</code> will
be automatically a leaf server listener.</li>
</ul>
</li>
<li><code>cluster-peers</code> (default: none <code>Since 0.8.x</code>) - Comma separated list of <code>nats://&lt;host&gt;:&lt;port&gt;/</code> peers of
NATS cluster. You can also use (Since version <code>v0.8.4</code> ) <code>dns://&lt;dns&gt;:&lt;port&gt;/</code> to A/AAAA record lookups.
Marmot will automatically resolve the DNS IPs at boot time to expand the routes with value of
<code>nats://&lt;ip&gt;:&lt;port&gt;/</code> value, where <code>&lt;ip&gt;</code> is replaced with all the DNS entries queried. There
are two additional query parameters you can use:
<ul dir="auto">
<li><code>min</code> - forcing Marmot to wait for minimum number of entries (e.g. <code>dns://foo:4222/?min=3</code> will require
3 DNS entries to be present before embedded NATs server is started)</li>
<li><code>interval_ms</code> - delay between DNS queries, which will prevent Marmot from flooding DNS server.</li>
</ul>
</li>
<li><code>leaf-server</code> (default: none <code>Since v0.8.4</code> )- Comma separated list of <code>nats://&lt;host&gt;:&lt;port&gt;/</code>
or <code>dns://&lt;dns&gt;:&lt;port&gt;/</code> just like <code>cluster-peers</code> can be used to connect to a cluster
as a leaf node.</li>
</ul>
<p dir="auto">For more details and internal workings of marmot <a href="https://maxpert.github.io/marmot/" rel="nofollow">go to these docs</a>.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-faqs--community" aria-hidden="true" tabindex="-1" href="#faqs--community"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>FAQs &amp; Community</h2>
<ul dir="auto">
<li>For FAQs visit <a href="https://maxpert.github.io/marmot/intro#faq" rel="nofollow">this page</a></li>
<li>For community visit our <a href="https://discord.gg/AWUwY66XsE" rel="nofollow">discord</a> or discussions on GitHub</li>
</ul>
<h2 tabindex="-1" dir="auto"><a id="user-content-our-sponsor" aria-hidden="true" tabindex="-1" href="#our-sponsor"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Our sponsor</h2>
<p dir="auto">Last but not least we would like to thank our sponsors who have been supporting development of this project.</p>
<p dir="auto"><a href="https://www.jetbrains.com/?utm_medium=opensource&amp;utm_source=marmot" rel="nofollow"><img src="https://camo.githubusercontent.com/c4c69e1b3d0c498dfc3319aeb429c38aa811edaa6960eab7f970cc09d654d121/68747470733a2f2f7265736f75726365732e6a6574627261696e732e636f6d2f73746f726167652f70726f64756374732f636f6d70616e792f6272616e642f6c6f676f732f476f4c616e645f69636f6e2e706e67" alt="GoLand logo." height="64" data-canonical-src="https://resources.jetbrains.com/storage/products/company/brand/logos/GoLand_icon.png"/>
<img src="https://camo.githubusercontent.com/316c7802db512367d7e93c9d0028e891e3fa065116f6449636537c74f34cc2c3/68747470733a2f2f7265736f75726365732e6a6574627261696e732e636f6d2f73746f726167652f70726f64756374732f636f6d70616e792f6272616e642f6c6f676f732f6a625f6265616d2e706e67" alt="JetBrains Logo (Main) logo." height="64" data-canonical-src="https://resources.jetbrains.com/storage/products/company/brand/logos/jb_beam.png"/></a></p>
</article>
          </div></div>
  </body>
</html>
