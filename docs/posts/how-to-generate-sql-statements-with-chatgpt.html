<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://forta.com/2023/07/10/how-to-generate-sql-statements-with-chatgpt/">Original</a>
    <h1>How to generate SQL statements with ChatGPT</h1>
    
    <div id="readability-page-1" class="page"><div>
<figure><img data-attachment-id="34396" data-permalink="https://forta.com/2023/07/10/how-to-generate-sql-statements-with-chatgpt/attachment/firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports/" data-orig-file="https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?fit=1024%2C1024&amp;ssl=1" data-orig-size="1024,1024" data-comments-opened="1" data-image-meta="{&#34;aperture&#34;:&#34;0&#34;,&#34;credit&#34;:&#34;&#34;,&#34;camera&#34;:&#34;&#34;,&#34;caption&#34;:&#34;&#34;,&#34;created_timestamp&#34;:&#34;0&#34;,&#34;copyright&#34;:&#34;&#34;,&#34;focal_length&#34;:&#34;0&#34;,&#34;iso&#34;:&#34;0&#34;,&#34;shutter_speed&#34;:&#34;0&#34;,&#34;title&#34;:&#34;&#34;,&#34;orientation&#34;:&#34;0&#34;}" data-image-title="Firefly a powerful ai robotic supercomputer working with databases and tables and generating reports" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?fit=300%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?fit=1024%2C1024&amp;ssl=1" decoding="async" width="300" height="300" src="https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=300%2C300&amp;ssl=1" alt="" data-recalc-dims="1" data-lazy-srcset="https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=300%2C300&amp;ssl=1 300w, https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=150%2C150&amp;ssl=1 150w, https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=768%2C768&amp;ssl=1 768w, https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=600%2C600&amp;ssl=1 600w, https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=800%2C800&amp;ssl=1 800w, https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=400%2C400&amp;ssl=1 400w, https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=200%2C200&amp;ssl=1 200w, https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?w=1024&amp;ssl=1 1024w" data-lazy-sizes="(max-width: 300px) 100vw, 300px" data-lazy-src="https://i0.wp.com/forta.com/wp-content/uploads/Firefly-a-powerful-ai-robotic-supercomputer-working-with-databases-and-tables-and-generating-reports.jpg?resize=300%2C300&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/></figure>



<p>ChatGPT is all the rage right now, and understandably so. Feeding it prompts and watching it spit out quality articles, recipes, travel itineraries, code examples, and more is fun and addictive. Yep, it’s a rabbit hole, and one we’re all getting a kick out of.</p>



<p>One of ChatGPT’s many neat tricks is its ability to generate SQL statements; you simply tell ChatGPT about your tables, verify that it understands the structure properly, and then ask for what you’d like returned, all in simple English. It works, and really well. And so, in this post I’ll demonstrate how to take advantage of this magical capability using tables (well, a subset of the tables) and examples from my <a href="https://forta.com/books/0135182794/">Sams Teach Yourself SQL in 10 Minutes</a>.</p>



<p>Ok, here goes. Obviously, you’ll need to log in to <a href="https://chat.openai.com/">ChatGPT</a> (creating an account if you’ve not yet done so).</p>



<p>The first thing you need to do is tell ChatGPT about your tables. Here’s the prompt I used:</p>



<pre>Customers table contains columns cust_id, cust_name. Orders table contains columns order_num, order_date, cust_id. Vendors table contains columns vend_id, vend_name. Products table contains columns prod_id, vend_id, prod_name, prod_price. OrderItems table contains columns order_num, prod_id, quantity, item_price.</pre>



<p>As you can see, I simply told ChatGPT the table names and the columns in each. (There are actually more columns in my tables; for brevity’s sake I opted to just list the ones needed here). So, what did ChatGPT do with this info? This is how it responded:</p>



<pre>It appears you are providing the structure of multiple database tables in a relational database, possibly SQL. These tables are Customers, Orders, Vendors, Products, and OrderItems.</pre>



<p>Ok. Take a deep breath, and … read that response. Seriously, that is mind-boggling! Not only did ChatGPT understand the tables I enumerated, but it also figured out all the table relationships. It worked out how Orders relate to Customers, and Products to OrderItems, and so on. I didn’t define any of them, it worked it which columns in which tables were related to others. It helps that the column name conventions I used were consistent, but still, wow!</p>



<p>Now to see how well ChatGPT generates SQL. This was my next prompt:</p>



<pre>Return a list of customers with a count of orders for each.</pre>



<p>ChatGPT worked for a few seconds and returned this:</p>



<pre>To return a list of customers along with a count of their orders, you could perform a SQL query that JOINs the Customers and Orders tables on the <code>cust_id</code> field, and then groups by the customer name or ID while counting the number of orders. Here&#39;s an example of how you might do this:</pre>



<pre data-enlighter-language="sql" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">SELECT C.cust_id, C.cust_name, COUNT(O.order_num) AS order_count
FROM Customers C
LEFT JOIN Orders O ON C.cust_id = O.cust_id
GROUP BY C.cust_id, C.cust_name
ORDER BY order_count DESC;</pre>



<pre>This query works by joining the Customers and Orders tables together where the <code>cust_id</code> fields match. For each customer, it counts the number of associated orders (<code>order_num</code> entries). The <code>GROUP BY</code> clause groups the results by both <code>cust_id</code> and <code>cust_name</code> to provide a count for each customer. The <code>ORDER BY</code> clause sorts the result by the count of orders in descending order so customers with the most orders come first.
Please note that if there are customers who haven&#39;t made any orders, they will also appear in the list with an order count of 0, because of the <code>LEFT JOIN</code> operation. If you only want customers who have made at least one order, you could use an <code>INNER JOIN</code> instead.</pre>



<p>Well, yeah, that worked, ChatGPT returned a SELECT statement that correctly joins the two needed tables so as to return customers and an order count for each. I love that it also added a note explaining that it has used a LEFT JOIN in order to include customers with 0 orders, and to change that to an INNER JOIN if that is not what is desired.</p>



<p>Impressive, right? But what about DBMS specific SQL? The best way to try that is to use dates (date manipulation functions tend to be notoriously DBMS specific). Here’s the prompt I used:</p>



<pre>Select customers who have made an order in the past 90 days with total order amount.</pre>



<p>This seems simple, right? Nope! There is actually no way to generate this SQL for every major DBMS, the functions needed to calculate 90 days from a specific date really are very DBMS specific. Here’s what ChatGPT returned:</p>



<pre>Sure, you can create a query that joins the <code>Customers</code>, <code>Orders</code>, and <code>OrderItems</code> tables to calculate the total order amount for each customer in the past 90 days. Here is an example SQL query:</pre>



<pre data-enlighter-language="sql" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">SELECT 
    C.cust_id, 
    C.cust_name, 
    SUM(OI.item_price * OI.quantity) AS total_order_amount
FROM 
    Customers C
INNER JOIN 
    Orders O ON C.cust_id = O.cust_id
INNER JOIN 
    OrderItems OI ON O.order_num = OI.order_num
WHERE 
    O.order_date &gt;= CURDATE() - INTERVAL 90 DAY
GROUP BY 
    C.cust_id, 
    C.cust_name
HAVING 
    total_order_amount &gt; 0
ORDER BY 
    total_order_amount DESC;
</pre>



<pre>This query starts by joining the <code>Customers</code>, <code>Orders</code>, and <code>OrderItems</code> tables together. It uses the <code>WHERE</code> clause to filter out any orders that weren&#39;t placed in the last 90 days. It then calculates the total order amount for each customer by multiplying the item price by the quantity (<code>OI.item_price * OI.quantity</code>) and summing these values. Finally, it uses the <code>HAVING</code> clause to include only customers who have a total order amount greater than 0, and orders the results by the total order amount in descending order.
Please note that the date comparison in the <code>WHERE</code> clause might slightly vary depending on the specific SQL dialect used. The query assumes the <code>order_date</code> column is of a date type that can be directly compared with <code>CURDATE() - INTERVAL 90 DAY</code>.</pre>



<p>ChatGPT returns a valid response, and notes that <em>the WHERE clause might slightly vary depending on the specific SQL dialect used</em>. Yeah, no kidding! So, what DBMS will this work with? Let’s ask ChatGPT:</p>



<pre>What DBMS can I use with this SQL statement?</pre>



<p>ChatGPT responds with:</p>



<pre>The SQL statement before the SQL Server-specific one is written in a fairly standard SQL dialect and should work on several different database management systems (DBMS), with potentially minor modifications due to slight differences in SQL syntax and function naming. Some of these DBMS include:
* MySQL: It&#39;s probably the most compatible with this statement, as the original statement appears to be written in a MySQL-friendly syntax.
* PostgreSQL: This DBMS also uses standard SQL syntax similar to that used in the statement. However, the CURDATE() function should be replaced with CURRENT_DATE.
* MariaDB: As a fork of MySQL, MariaDB maintains a high level of compatibility with MySQL&#39;s SQL syntax.
* SQLite: While SQLite uses a variant of SQL, the query might require minor modifications. For instance, SQLite does not support the INTERVAL keyword, so the date subtraction part would need to be adjusted.
Please note that Oracle, SQL Server, and some other DBMS might require more significant modifications due to differences in function naming and SQL syntax.</pre>



<p>Turns out ChatGPT generated syntax that would work with MySQL, a reasonable place to start, and also noted the tweaks needed use these statements with PostgreSQL and SQLite. And, yes, it also noted <em>that Oracle, SQL Server, and some other DBMS might require more significant modifications</em>. Ok, so let’s ask ChatGPT to do just that:</p>



<pre>Give me a version of that SELECT statement that will work with Microsoft SQL Server</pre>



<p>And the response is:</p>



<pre>Microsoft SQL Server has some differences in syntax and function naming compared to other SQL dialects. Here&#39;s how you might write the same query in SQL Server:</pre>



<pre data-enlighter-language="sql" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">SELECT 
    C.cust_id, 
    C.cust_name, 
    SUM(OI.item_price * OI.quantity) AS total_order_amount
FROM 
    Customers C
INNER JOIN 
    Orders O ON C.cust_id = O.cust_id
INNER JOIN 
    OrderItems OI ON O.order_num = OI.order_num
WHERE 
    O.order_date &gt;= DATEADD(day, -90, GETDATE())
GROUP BY 
    C.cust_id, 
    C.cust_name
HAVING 
    SUM(OI.item_price * OI.quantity) &gt; 0
ORDER BY 
    total_order_amount DESC;
</pre>



<pre>The <code>GETDATE()</code> function in SQL Server returns the current date and time, and <code>DATEADD(day, -90, GETDATE())</code> subtracts 90 days from the current date. This replaced <code>CURDATE() - INTERVAL 90 DAY</code> from the original query.</pre>



<p>You get the idea. ChatGPT does a remarkable job generating SQL so long as:</p>



<ul>
<li>Start by defining your tables. Use plain English, the less fussy the better.</li>



<li>Verify that ChatGPT has correctly understood your table structure. I it hasn’t (this can happen if column names are less consistent) then add a prompt explaining the required table relationships.</li>



<li>Then prompt for the SQL statements by clearly defining the desired output (in English, not SQL).</li>



<li>It’s best to tell ChatGPT what DBMS you are using.</li>
</ul>



<p>And there you have it, SQL generation powered by ChatGPT!</p>



<p>Oh, BTW, that image at the top left, the robot database thingy? That’s also generated by an AI, specifically <a href="https://firefly.adobe.com/">Adobe Firefly</a>. Seemed fitting for this post.</p>
</div></div>
  </body>
</html>
