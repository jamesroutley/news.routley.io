<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/gmpalter/cl-forth">Original</a>
    <h1>Common Lisp implementation of the Forth 2012 Standard</h1>
    
    <div id="readability-page-1" class="page"><div data-hpc="true"><article itemprop="text">
<p dir="auto">Common Lisp implementation of the <a href="https://forth-standard.org" rel="nofollow">Forth 2012 Standard</a>, CL-Forth</p>

<p dir="auto">CL-Forth is fully supported by CCL v1.12.2-82 or later.</p>
<p dir="auto">CL-Forth also supports SBCL 2.1.0 or later. However, at present, the word <code>RESIZE-FILE</code> will always return an error indication,
resulting in 7 failures in the File-Access word set tests.</p>
<p dir="auto">CL-Forth compiles with LispWorks but crashes running the Forth test suite.</p>
<div dir="auto"><h2 tabindex="-1" dir="auto">Supported Operating Systems</h2><a id="user-content-supported-operating-systems" aria-label="Permalink: Supported Operating Systems" href="#supported-operating-systems"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">CL-Forth is supported on macOS, Linux, and Windows.</p>
<p dir="auto">On macOS, it has been verified to run on macOS Ventura or later.</p>
<p dir="auto">On Linux, it has been verified to run on distributions with 5.10.162 kernels or later.</p>
<p dir="auto">On Windows, it has been verified to run on Windows 10 or later.</p>

<p dir="auto">CL-Forth is made available under the terms of the <a href="http://harihareswara.net/gmpalter/cl-forth/blob/main/LICENSE">MIT License</a>.</p>

<p dir="auto">CL-Forth is defined using ASDF and is dependent on the <a href="https://github.com/cffi/cffi">CFFI</a> and
<a href="https://github.com/trivial-gray-streams/trivial-gray-streams">trivial-gray-streams</a> libraries.</p>
<p dir="auto">To fetch a copy of CL-Forth and the <a href="https://github.com/gerryjackson/forth2012-test-suite.git">Forth 2012 Test Suite</a> configured
to only run tests for those word sets implemented by CL-Forth.</p>
<div dir="auto" data-snippet-clipboard-copy-content="git clone https://github.com/gmpalter/cl-forth.git --recurse-submodules"><pre>git clone https://github.com/gmpalter/cl-forth.git --recurse-submodules</pre></div>
<p dir="auto">To load CL-Forth into Lisp</p>
<div dir="auto" data-snippet-clipboard-copy-content="(require &#39;#:asdf)
(load &#34;cl-forth.asd&#34;)
(asdf:load-system &#39;#:cl-forth)"><pre>(<span>require</span> <span>&#39;</span>#:asdf)
(<span>load</span> <span><span>&#34;</span>cl-forth.asd<span>&#34;</span></span>)
(<span>asdf</span>:load-system <span>&#39;</span>#:cl-forth)</pre></div>
<p dir="auto">You can run the <a href="https://github.com/gerryjackson/forth2012-test-suite.git">Forth 2012 Test Suite</a></p>
<div dir="auto" data-snippet-clipboard-copy-content="(asdf:test-system &#39;#:cl-forth)"><pre>(<span>asdf</span>:test-system <span>&#39;</span>#:cl-forth)</pre></div>
<p dir="auto">To start the CL-Forth interpreter loop</p>

<p dir="auto">CL-Forth is case-insensitive.</p>
<div dir="auto"><h3 tabindex="-1" dir="auto">Building a Standalone CL-Forth</h3><a id="user-content-building-a-standalone-cl-forth" aria-label="Permalink: Building a Standalone CL-Forth" href="#building-a-standalone-cl-forth"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can build a standalone CL-Forth application.</p>
<p dir="auto">Launch Lisp and evaluate the forms</p>
<div dir="auto" data-snippet-clipboard-copy-content="(require &#39;#:asdf)
(load &#34;cl-forth.asd&#34;)
(asdf:load-system &#39;#:cl-forth/application)
(forth-app:save-application &#34;cl-forth&#34;)"><pre>(<span>require</span> <span>&#39;</span>#:asdf)
(<span>load</span> <span><span>&#34;</span>cl-forth.asd<span>&#34;</span></span>)
(<span>asdf</span>:load-system <span>&#39;</span>#:cl-forth/application)
(<span>forth-app</span>:save-application <span><span>&#34;</span>cl-forth<span>&#34;</span></span>)</pre></div>
<p dir="auto">This will create an executable named <code>cl-forth</code>. When you run <code>cl-forth</code>, it will startup directly into the Forth interpreter
loop.</p>
<div dir="auto" data-snippet-clipboard-copy-content="./cl-forth
CL-Forth Version 1.3
Running under Clozure Common Lisp Version 1.13 (v1.13) DarwinX8664
1 1 + .
2 OK.
: hello-world .&#34; Hello World!&#34; cr ;
OK.
hello-world
Hello World!
OK.
see hello-world
Source code for hello-world:
(DEFUN FORTH-WORDS::HELLO-WORLD (FS &amp;REST PARAMETERS)
  (DECLARE (IGNORABLE PARAMETERS))
  (WITH-FORTH-SYSTEM (FS)
    (TAGBODY (WRITE-STRING &#34;Hello World!&#34;)
             (TERPRI)
     :EXIT)))
OK.
bye
In this session:
  1 definition created
  240 bytes of object code generated"><pre>./cl-forth
CL-Forth Version <span>1.3</span>
Running under Clozure Common Lisp Version <span>1.13</span> (v1.13) DarwinX8664
<span>1</span> <span>1</span> + .
<span>2</span> OK.
: hello-world .&#34; <span>Hello World!&#34;</span> cr ;
OK.
hello-world
Hello World!
OK.
<span>see</span> hello-world
Source code <span>for</span> hello-world:
(DEFUN FORTH-WORDS::HELLO-WORLD (FS &amp;REST PARAMETERS)
  (DECLARE (IGNORABLE PARAMETERS))
  (WITH-FORTH-SYSTEM (FS)
    (TAGBODY (WRITE-STRING &#34;Hello World!&#34;)
             (TERPRI)
     :EXIT)))
OK.
bye
In this session:
  <span>1</span> definition created
  <span>240</span> bytes <span>of</span> object code generated</pre></div>
<p dir="auto">The application  recognizes these command line arguments</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>‑‑interpret EXPR</code>, <code>‑i EXPR</code></td>
<td>Evaluate <code>EXPR</code> before entering the Forth interpreter loop. <code>EXPR</code> may need to be quoted to avoid interpretation by the shell.  This argument may be used multiple times.</td>
</tr>
<tr>
<td><code>‑‑transcript PATH</code></td>
<td>Record a timestamped transcript of this session in the file <code>PATH</code></td>
</tr>
<tr>
<td><code>‑‑help</code>, <code>‑h</code></td>
<td>Display the available command line arguments and exit</td>
</tr>
<tr>
<td><code>‑‑version</code>, <code>‑V</code></td>
<td>Display the version of CL-Forth and exit</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto">CL-Forth does not implement the optional Block word set.</p>
<p dir="auto">CL-Forth does not implement the optional Extended-Character word set.</p>
<p dir="auto">CL-Forth does not implement <code>KEY</code> which is part of the Core word set.</p>
<p dir="auto">The following words that are part of the optional Facility and Facility extensions word set are not implemented.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AT-XY</code></td>
<td><code>KEY?</code></td>
<td><code>PAGE</code></td>
<td><code>EKEY</code></td>
<td><code>EKEY&gt;CHAR</code></td>
</tr>
<tr>
<td><code>EKEY&gt;FKEY</code></td>
<td><code>EKEY?</code></td>
<td><code>EMIT?</code></td>
<td><code>K-ALT-MASK</code></td>
<td><code>K-CTRL-MASK</code></td>
</tr>
<tr>
<td><code>K-DELETE</code></td>
<td><code>K-DOWN</code></td>
<td><code>K-END</code></td>
<td><code>K-F1</code></td>
<td><code>K-F10</code></td>
</tr>
<tr>
<td><code>K-F11</code></td>
<td><code>K-F12</code></td>
<td><code>K-F2</code></td>
<td><code>K-F3</code></td>
<td><code>K-F4</code></td>
</tr>
<tr>
<td><code>K-F5 </code></td>
<td><code>K-F6</code></td>
<td><code>K-F7</code></td>
<td><code>K-K8</code></td>
<td><code>K-F9</code></td>
</tr>
<tr>
<td><code>K-HOME</code></td>
<td><code>K-INSERT</code></td>
<td><code>K-LEFT</code></td>
<td><code>K-NEXT</code></td>
<td><code>K-PRIOR</code></td>
</tr>
<tr>
<td><code>K-RIGHT</code></td>
<td><code>K-SHIFT-MASK</code></td>
<td><code>K-UP</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div dir="auto"><h2 tabindex="-1" dir="auto">Foreign Function Interface</h2><a id="user-content-foreign-function-interface" aria-label="Permalink: Foreign Function Interface" href="#foreign-function-interface"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">CL-Forth includes a foreign function interface (FFI) loosely based on the External Library Interface in
<a href="https://www.forth.com/swiftforth/" rel="nofollow">SwiftForth</a>. See <a href="http://harihareswara.net/gmpalter/cl-forth/blob/main/FFI.md">FFI.md</a> for details.</p>

<p dir="auto">CL-Forth includes a number of words defined by other implementation that are not part of the Forth 2012 Standard.</p>
<p dir="auto">These words are specific to CL-Forth.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.SF</code></td>
<td>Display the contents of the floating-point stack</td>
</tr>
<tr>
<td><code>.SR</code></td>
<td>Display the contents of the return stack</td>
</tr>
<tr>
<td><code>ALL-WORDS</code></td>
<td>Display all words in all word lists in the search order</td>
</tr>
<tr>
<td><code>BREAK</code></td>
<td>Enter a Lisp break loop</td>
</tr>
<tr>
<td><code>INLINEABLE</code></td>
<td>Mark that the most recent definition&#39;s code may be inlined</td>
</tr>
<tr>
<td><code>NOTINTERPRETED</code></td>
<td>Mark that the most recent definition must only appear in definitions</td>
</tr>
<tr>
<td><code>RELOAD</code></td>
<td>Reload a predefined definition (i.e., created by <code>define-word</code>)</td>
</tr>
<tr>
<td><code>REMOVE</code></td>
<td>Erase a single word</td>
</tr>
<tr>
<td><code>SHOW-BACKTRACES</code></td>
<td>Controls whether exceptions display the return and data stacks</td>
</tr>
<tr>
<td><code>SHOW-CODE</code></td>
<td>Controls whether completing a definition shows the generated code</td>
</tr>
<tr>
<td><code>STATISTICS</code></td>
<td>Report some useful statistics about this CL-Forth session</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">These words are defined as &#34;Common Usage&#34; in the <a href="https://www.forth.com/forth-books/" rel="nofollow">Forth Programmer&#39;s Manual, 3rd Edition</a>.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>,&#34;</code></td>
<td><code>2+</code></td>
<td><code>2-</code></td>
<td><code>C+!</code></td>
<td><code>CONTEXT</code></td>
</tr>
<tr>
<td><code>CURRENT</code></td>
<td><code>CVARIABLE</code></td>
<td><code>M-</code></td>
<td><code>M/</code></td>
<td><code>NOT</code></td>
</tr>
<tr>
<td><code>NUMBER</code></td>
<td><code>NUMBER?</code></td>
<td><code>VOCABULARY</code></td>
<td></td>
<td></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">These words are defined by <a href="https://www.forth.com/swiftforth/" rel="nofollow">SwiftForth</a>.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-?</code></td>
<td><code>EMPTY</code></td>
<td><code>GILD</code></td>
<td><code>OFF</code></td>
<td><code>ON</code></td>
<td><code>OPTIONAL</code></td>
</tr>
<tr>
<td><code>SILENT</code></td>
<td><code>VERBOSE</code></td>
<td><code>WARNING</code></td>
<td><code>\\</code></td>
<td><code>{</code></td>
<td></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>

<p dir="auto"><em>TO BE SUPPLIED</em></p>

<p dir="auto">CL-Forth implements <code>CODE</code> and <code>;CODE</code> to allow the definition of words written in Lisp rather than Forth. The terminator for
the Lisp code block is <code>;ENDCODE</code>.</p>
<p dir="auto">Here is an example of using native code.</p>
<div dir="auto" data-snippet-clipboard-copy-content="\ ( c-addr1 u - c-addr2 u)
\ Converts the string at C-ADDR1 U to uppercase and leaves the result in transient space at C-ADDR2 U.
CODE UPCASE
  (let ((count (cell-signed (stack-pop data-stack)))
        (address (stack-pop data-stack)))
    (unless (plusp count)
      (forth-exception :invalid-numeric-argument &#34;Count to UPCASE must be positive&#34;))
    (multiple-value-bind (data offset)
        (memory-decode-address memory address)
      (let* ((original (forth-string-to-native data offset count))
             (upcased (string-upcase original))
             (string-space (reserve-string-space memory))
             (address (transient-space-base-address memory string-space)))
        (ensure-transient-space-holds memory string-space count)
        (multiple-value-bind (data offset)
            (memory-decode-address memory address)
          (native-into-forth-string upcased data offset)
          (seal-transient-space memory string-space)
          (stack-push data-stack address)
          (stack-push data-stack count)))))
;ENDCODE"><pre>\ ( <span>c</span><span>-</span><span>addr1</span> <span>u</span> <span>-</span> <span>c</span><span>-</span><span>addr2</span> <span>u</span>)
\ <span>Converts</span> <span>the</span> <span>string</span> <span>at</span> <span>C</span><span>-</span><span>ADDR1</span> <span>U</span> <span>to</span> <span>uppercase</span> <span>and</span> <span>leaves</span> <span>the</span> <span>result</span> <span>in</span> <span>transient</span> <span>space</span> <span>at</span> <span>C</span><span>-</span><span>ADDR2</span> <span>U</span>.
<span>CODE</span> <span>UPCASE</span>
  (<span>let</span> ((<span>count</span> (<span>cell</span><span>-</span><span>signed</span> (<span>stack</span><span>-</span><span>pop</span> <span>data</span><span>-</span><span>stack</span>)))
        (<span>address</span> (<span>stack</span><span>-</span><span>pop</span> <span>data</span><span>-</span><span>stack</span>)))
    (<span>unless</span> (<span>plusp</span> <span>count</span>)
      (<span>forth</span><span>-</span><span>exception</span> :<span>invalid</span><span>-</span><span>numeric</span><span>-</span><span>argument</span> <span>&#34;Count to UPCASE must be positive&#34;</span>))
    (<span>multiple</span><span>-</span><span>value</span><span>-</span><span>bind</span> (<span>data</span> <span>offset</span>)
        (<span>memory</span><span>-</span><span>decode</span><span>-</span><span>address</span> <span>memory</span> <span>address</span>)
      (<span>let</span><span>*</span> ((<span>original</span> (<span>forth</span><span>-</span><span>string</span><span>-</span><span>to</span><span>-</span><span>native</span> <span>data</span> <span>offset</span> <span>count</span>))
             (<span>upcased</span> (<span>string</span><span>-</span><span>upcase</span> <span>original</span>))
             (<span>string</span><span>-</span><span>space</span> (<span>reserve</span><span>-</span><span>string</span><span>-</span><span>space</span> <span>memory</span>))
             (<span>address</span> (<span>transient</span><span>-</span><span>space</span><span>-</span><span>base</span><span>-</span><span>address</span> <span>memory</span> <span>string</span><span>-</span><span>space</span>)))
        (<span>ensure</span><span>-</span><span>transient</span><span>-</span><span>space</span><span>-</span><span>holds</span> <span>memory</span> <span>string</span><span>-</span><span>space</span> <span>count</span>)
        (<span>multiple</span><span>-</span><span>value</span><span>-</span><span>bind</span> (<span>data</span> <span>offset</span>)
            (<span>memory</span><span>-</span><span>decode</span><span>-</span><span>address</span> <span>memory</span> <span>address</span>)
          (<span>native</span><span>-</span><span>into</span><span>-</span><span>forth</span><span>-</span><span>string</span> <span>upcased</span> <span>data</span> <span>offset</span>)
          (<span>seal</span><span>-</span><span>transient</span><span>-</span><span>space</span> <span>memory</span> <span>string</span><span>-</span><span>space</span>)
          (<span>stack</span><span>-</span><span>push</span> <span>data</span><span>-</span><span>stack</span> <span>address</span>)
          (<span>stack</span><span>-</span><span>push</span> <span>data</span><span>-</span><span>stack</span> <span>count</span>)))))
;<span>ENDCODE</span></pre></div>
</article></div></div>
  </body>
</html>
