<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/queer/boxxy">Original</a>
    <h1>Show HN: boxxy – Control where Linux programs put files, without symlinks</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">boxxy is a tool for boxing up misbehaving Linux applications and forcing them
to put their files and directories in the right place, <strong>without symlinks!</strong></p>
<p dir="auto">Linux-only! boxxy uses Linux namespaces for its functionality.</p>
<p dir="auto">For example, consider tmux. It wants to put its config in <code>~/.tmux.conf</code>. With
boxxy, you can put its config in <code>~/.config/tmux/tmux.conf</code> instead:</p>
<div dir="auto" data-snippet-clipboard-copy-content="# ~/.config/boxxy/boxxy.yaml
rules:
- name: &#34;redirect tmux config from ~/.tmux.conf to ~/.config/tmux/tmux.conf&#34;
  target: &#34;~/.tmux.conf&#34;
  rewrite: &#34;~/.config/tmux/tmux.conf&#34;
  mode: &#34;file&#34;"><pre><span><span>#</span> ~/.config/boxxy/boxxy.yaml</span>
<span>rules</span>:
- <span>name</span>: <span><span>&#34;</span>redirect tmux config from ~/.tmux.conf to ~/.config/tmux/tmux.conf<span>&#34;</span></span>
  <span>target</span>: <span><span>&#34;</span>~/.tmux.conf<span>&#34;</span></span>
  <span>rewrite</span>: <span><span>&#34;</span>~/.config/tmux/tmux.conf<span>&#34;</span></span>
  <span>mode</span>: <span><span>&#34;</span>file<span>&#34;</span></span></pre></div>
<p dir="auto"><a href="https://asciinema.org/a/558679" rel="nofollow"><img src="https://camo.githubusercontent.com/94d8d2f59da4f122fba3dc460b41591cea9e7f3af8de4c0f9b358005b33830c2/68747470733a2f2f61736369696e656d612e6f72672f612f3535383637392e737667" alt="asciicast" data-canonical-src="https://asciinema.org/a/558679.svg"/></a></p>
<h2 dir="auto"><a id="user-content-motivation" aria-hidden="true" href="#motivation"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>motivation</h2>
<p dir="auto">I recently had to use the AWS CLI. It wants to save data in <code>~/.aws</code>, but I
don&#39;t want it to just clutter up my <code>$HOME</code> however it wants. boxxy lets me
force it to puts its data somewhere nice and proper.</p>
<h2 dir="auto"><a id="user-content-features" aria-hidden="true" href="#features"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>features</h2>
<ul dir="auto">
<li>box any program and force it to put its files/directories where you want it to</li>
<li>context-dependent boxing, ie different rules apply in different directories
depending on your configuration</li>
<li>minimal overhead</li>
<li>opt-in immutable fs outside of rule rewrites, ie only the files/directories
you specify in rules are writable</li>
</ul>
<h2 dir="auto"><a id="user-content-example-usage" aria-hidden="true" href="#example-usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>example usage</h2>
<div dir="auto" data-snippet-clipboard-copy-content="git:(mistress) | ▶  cat ~/.config/boxxy/boxxy.yaml
rules:
- name: &#34;Store AWS CLI config in ~/.config/aws&#34;
  target: &#34;~/.aws&#34;
  rewrite: &#34;~/.config/aws&#34;

git:(mistress) | ▶  boxxy aws configure
 INFO  boxxy &gt; loaded 1 rules
 INFO  boxxy::enclosure &gt; applying rule &#39;Store AWS CLI config in ~/.config/aws&#39;
 INFO  boxxy::enclosure &gt; redirect: ~/.aws -&gt; ~/.config/aws
 INFO  boxxy::enclosure &gt; boxed &#34;aws&#34; ♥
AWS Access Key ID [****************d]: a
AWS Secret Access Key [****************c]: b
Default region name [b]: c
Default output format [a]: d
git:(mistress) | ▶  ls ~/.aws
git:(mistress) | ▶  ls ~/.config/aws
config  credentials
git:(mistress) | ▶  cat ~/.config/aws/config
[default]
region = c
output = d
git:(mistress) | ▶"><pre>git:(mistress) <span>|</span> ▶  cat <span>~</span>/.config/boxxy/boxxy.yaml
rules:
- name: <span><span>&#34;</span>Store AWS CLI config in ~/.config/aws<span>&#34;</span></span>
  target: <span><span>&#34;</span>~/.aws<span>&#34;</span></span>
  rewrite: <span><span>&#34;</span>~/.config/aws<span>&#34;</span></span>

git:(mistress) <span>|</span> ▶  boxxy aws configure
 INFO  boxxy <span>&gt;</span> loaded 1 rules
 INFO  boxxy::enclosure <span>&gt;</span> applying rule <span><span>&#39;</span>Store AWS CLI config in ~/.config/aws<span>&#39;</span></span>
 INFO  boxxy::enclosure <span>&gt;</span> redirect: <span>~</span>/.aws -<span>&gt;</span> <span>~</span>/.config/aws
 INFO  boxxy::enclosure <span>&gt;</span> boxed <span><span>&#34;</span>aws<span>&#34;</span></span> ♥
AWS Access Key ID [<span>****************</span>d]: a
AWS Secret Access Key [<span>****************</span>c]: b
Default region name [b]: c
Default output format [a]: d
git:(mistress) <span>|</span> ▶  ls <span>~</span>/.aws
git:(mistress) <span>|</span> ▶  ls <span>~</span>/.config/aws
config  credentials
git:(mistress) <span>|</span> ▶  cat <span>~</span>/.config/aws/config
[default]
region = c
output = d
git:(mistress) <span>|</span> ▶</pre></div>
<h3 dir="auto"><a id="user-content-suggested-usage" aria-hidden="true" href="#suggested-usage"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>suggested usage</h3>
<ul dir="auto">
<li><code>alias aws=&#34;boxxy aws&#34;</code> (repeat for other tools)</li>
<li>use contexts to keep project configs separate on disk</li>
<li>dotfiles!</li>
<li>stop using symlinks!!!</li>
</ul>
<h2 dir="auto"><a id="user-content-configuration" aria-hidden="true" href="#configuration"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>configuration</h2>
<p dir="auto">The boxxy configuration file lives in <code>~/.config/boxxy/boxxy.yaml</code>. If none
exists, an empty one will be created for you.</p>
<div dir="auto" data-snippet-clipboard-copy-content="rules:
# The name of the rule. User-friendly name for your reference
- name: &#34;redirect aws-cli from ~/.aws to ~/.config/aws&#34;
  # The target of the rule, ie the file/directory that will be shadowed by the
  # rewrite.
  target: &#34;~/.aws&#34;
  # The rewrite of the rule, ie the file/directory that will be used instead of
  # the target.
  rewrite: &#34;~/.config/aws&#34;
- name: &#34;use different k8s configs when in ~/Projects/my-cool-startup&#34;
  target: &#34;~/.kube/config&#34;
  rewrite: &#34;~/Projects/my-cool-startup/.kube/config&#34;
  # The context for the rule. Any paths listed in the context are paths where
  # this rule will apply. If no context is specified, the rule applies
  # globally.
  context:
  - &#34;~/Projects/my-cool-startup&#34;
  # The mode of this rule, either `directory` or `file`. `directory` is the
  # default. Must be specified for the correct behaviour when the target is a
  # file. Required because the target file/directory may not exist yet.
  mode: &#34;file&#34;
  # The list of commands that this rule applies to. If no commands are
  # specified, the rule applies to all programs run with boxxy.
  only:
  - &#34;kubectl&#34;"><pre><span>rules</span>:
<span><span>#</span> The name of the rule. User-friendly name for your reference</span>
- <span>name</span>: <span><span>&#34;</span>redirect aws-cli from ~/.aws to ~/.config/aws<span>&#34;</span></span>
  <span><span>#</span> The target of the rule, ie the file/directory that will be shadowed by the</span>
  <span><span>#</span> rewrite.</span>
  <span>target</span>: <span><span>&#34;</span>~/.aws<span>&#34;</span></span>
  <span><span>#</span> The rewrite of the rule, ie the file/directory that will be used instead of</span>
  <span><span>#</span> the target.</span>
  <span>rewrite</span>: <span><span>&#34;</span>~/.config/aws<span>&#34;</span></span>
- <span>name</span>: <span><span>&#34;</span>use different k8s configs when in ~/Projects/my-cool-startup<span>&#34;</span></span>
  <span>target</span>: <span><span>&#34;</span>~/.kube/config<span>&#34;</span></span>
  <span>rewrite</span>: <span><span>&#34;</span>~/Projects/my-cool-startup/.kube/config<span>&#34;</span></span>
  <span><span>#</span> The context for the rule. Any paths listed in the context are paths where</span>
  <span><span>#</span> this rule will apply. If no context is specified, the rule applies</span>
  <span><span>#</span> globally.</span>
  <span>context</span>:
  - <span><span>&#34;</span>~/Projects/my-cool-startup<span>&#34;</span></span>
  <span><span>#</span> The mode of this rule, either `directory` or `file`. `directory` is the</span>
  <span><span>#</span> default. Must be specified for the correct behaviour when the target is a</span>
  <span><span>#</span> file. Required because the target file/directory may not exist yet.</span>
  <span>mode</span>: <span><span>&#34;</span>file<span>&#34;</span></span>
  <span><span>#</span> The list of commands that this rule applies to. If no commands are</span>
  <span><span>#</span> specified, the rule applies to all programs run with boxxy.</span>
  <span>only</span>:
  - <span><span>&#34;</span>kubectl<span>&#34;</span></span></pre></div>
<h3 dir="auto"><a id="user-content-syntax" aria-hidden="true" href="#syntax"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>syntax</h3>
<div dir="auto" data-snippet-clipboard-copy-content="rules:
- name: &#34;any valid string&#34; # required
  target: &#34;path&#34; # required
  rewrite: &#34;path&#34; # required
  context: # optional
  - &#34;path&#34;
  - &#34;path&#34;
  mode: &#34;directory | file&#34; # optional
  only: # optional
  - &#34;binary name&#34;
  - &#34;binary name&#34;"><pre><span>rules</span>:
- <span>name</span>: <span><span>&#34;</span>any valid string<span>&#34;</span></span> <span><span>#</span> required</span>
  <span>target</span>: <span><span>&#34;</span>path<span>&#34;</span></span> <span><span>#</span> required</span>
  <span>rewrite</span>: <span><span>&#34;</span>path<span>&#34;</span></span> <span><span>#</span> required</span>
  <span>context</span>: <span><span>#</span> optional</span>
  - <span><span>&#34;</span>path<span>&#34;</span></span>
  - <span><span>&#34;</span>path<span>&#34;</span></span>
  <span>mode</span>: <span><span>&#34;</span>directory | file<span>&#34;</span></span> <span><span>#</span> optional</span>
  <span>only</span>: <span><span>#</span> optional</span>
  - <span><span>&#34;</span>binary name<span>&#34;</span></span>
  - <span><span>&#34;</span>binary name<span>&#34;</span></span></pre></div>
<h2 dir="auto"><a id="user-content-developing" aria-hidden="true" href="#developing"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>developing</h2>
<ol dir="auto">
<li>set up pre-commit: <code>pre-commit install</code></li>
<li>make sure it builds: <code>cargo build</code></li>
<li>do the thing!</li>
<li>test with the command of your choice, ex. <code>cargo run -- ls -lah ~/.config</code></li>
</ol>
<h3 dir="auto"><a id="user-content-how-does-it-work" aria-hidden="true" href="#how-does-it-work"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>how does it work?</h3>
<ul dir="auto">
<li>create temporary directory in /tmp</li>
<li>set up new user/mount namespace</li>
<li>bind-mount <code>/</code> to tmp directory</li>
<li>bind-mount rule mounts rw so that target programs can use them</li>
<li>remount <code>/</code> ro</li>
<li>run!</li>
</ul>
</article>
          </div></div>
  </body>
</html>
