<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://electricui.com/blog/spe-sensor-node">Original</a>
    <h1>A deep dive into Single Pair Ethernet</h1>
    
    <div id="readability-page-1" class="page"><div><div><main><p>Scott</p><p>Having used a wide range of field device communications busses from simple 4-20mA, classic serial busses like UART and Modbus, and more modern CAN bus, native USB, and Ethernet options I&#39;m always playing with different transports and protocols to see what solutions make sense in my grab-bag of designs for hardware projects.</p>
<p>I first became aware of Single Pair Ethernet when I was mindlessly browsing Sparkfun&#39;s new products announcements a while ago, but didn&#39;t jump in because I felt the real utility was the ability to power devices over the same cable.</p>
<p>More than a year later, Sparkfun&#39;s Single Pair Ethernet Design Challenge gave me the excuse to create the hardware I originally wanted, offering a power budget that can handle non-trivial hardware with data rates to match.</p>
<span><span>
      <a href="https://electricui.com/static/42c6ba82853c9da3b5fb5f9dce4427c3/109c0/test-mounted.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/42c6ba82853c9da3b5fb5f9dce4427c3/7bb4c/test-mounted.avif 225w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/212f8/test-mounted.avif 450w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/4d7a3/test-mounted.avif 900w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/6f77c/test-mounted.avif 1350w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/a848b/test-mounted.avif 1800w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/ca01a/test-mounted.avif 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/42c6ba82853c9da3b5fb5f9dce4427c3/7d522/test-mounted.webp 225w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/b5115/test-mounted.webp 450w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/5722e/test-mounted.webp 900w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/c5b95/test-mounted.webp 1350w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/8fb31/test-mounted.webp 1800w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/b1218/test-mounted.webp 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/42c6ba82853c9da3b5fb5f9dce4427c3/08b3c/test-mounted.jpg 225w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/12ba2/test-mounted.jpg 450w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/86440/test-mounted.jpg 900w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/7e63a/test-mounted.jpg 1350w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/96503/test-mounted.jpg 1800w,
/static/42c6ba82853c9da3b5fb5f9dce4427c3/109c0/test-mounted.jpg 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/42c6ba82853c9da3b5fb5f9dce4427c3/86440/test-mounted.jpg" alt="test-mounted" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>This write-up summarises my (successful) attempts at building a <em>Power over Data Line</em> (PoDL) compliant device and power supply as part of a one-month &#39;<em>sink or swim</em>&#39; approach to designing and testing new hardware, and getting to look at maturity of the 10Base-T1 ecosystem.</p>
<p>I&#39;ll quickly cover some PoDL basics, then walk through the critical design decisions and test process for a prototype underwater sensor node suitable for ocean research.</p>
<p>All project files and full schematics are <a href="https://github.com/Scottapotamas/spe-marine-node" target="_blank" rel="noopener noreferrer">available on GitHub</a>.</p>
<h2 id="why-is-single-pair-ethernet-interesting" is="h2">Why is Single Pair Ethernet interesting?</h2>
<p>Put simply, it&#39;s a step closer to what sounds like my ideal transport:</p>
<ul>
<li>Supports reasonably high data rates (for microcontrollers) at ~10 Mbps,</li>
<li>Adds the ability to provide reasonable amounts of power with up to 50W,</li>
<li>Has the ability to integrate easily with existing networking stacks,</li>
<li>and doesn&#39;t over-complicate wiring.</li>
</ul>
<p>As a bonus, Single Pair Ethernet supports long range &gt;1km cable runs which exceed typical Ethernet specifications, and does so while aiming for far lower power consumption.</p>
<p>Off to the side, 10Base-T1S has similar goals but is built around a multi-drop half-duplex wiring configuration for shorter distance networks.</p>
<h2 id="power-over-data-lines" is="h2">Power over Data Lines</h2>
<p>With conventional PoE, two spare pairs are used for power transfer which avoids the need to mix power and data.</p>
<p>With SPE+PoDL, the high frequency data signals are low voltage (<code>1.0Vpp</code> or <code>2.4Vpp</code>) compared to the large DC offset required by PoDL. Add in the fact that a single cable run can be &gt;1km long and some care needs to be taken to correctly couple and decouple data from the power lines.</p>
<span><span>
      <a href="https://electricui.com/static/c5ec7c6c934e2cacea47afa04f089e7c/9ef3b/coupling-network.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/c5ec7c6c934e2cacea47afa04f089e7c/7bb4c/coupling-network.avif 225w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/212f8/coupling-network.avif 450w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/4d7a3/coupling-network.avif 900w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/6f77c/coupling-network.avif 1350w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/a848b/coupling-network.avif 1800w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/2abc3/coupling-network.avif 2952w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/c5ec7c6c934e2cacea47afa04f089e7c/7d522/coupling-network.webp 225w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/b5115/coupling-network.webp 450w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/5722e/coupling-network.webp 900w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/c5b95/coupling-network.webp 1350w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/8fb31/coupling-network.webp 1800w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/b386c/coupling-network.webp 2952w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/c5ec7c6c934e2cacea47afa04f089e7c/08b3c/coupling-network.jpg 225w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/12ba2/coupling-network.jpg 450w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/86440/coupling-network.jpg 900w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/7e63a/coupling-network.jpg 1350w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/96503/coupling-network.jpg 1800w,
/static/c5ec7c6c934e2cacea47afa04f089e7c/9ef3b/coupling-network.jpg 2952w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/c5ec7c6c934e2cacea47afa04f089e7c/86440/coupling-network.jpg" alt="coupling-network" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>The coupled inductors (differential mode) couple DC supply onto the twisted pair, while the transceiver&#39;s data is inductively coupled through the isolation transformer. To reduce common mode noise, a choke filters the input, and it&#39;s also a good idea to protect the transceiver from high voltage transients with suitable ESD supression measures (typically TVS diodes).</p>
<p>For convenience in the field, the specification allows the conductors to be installed in any orientation. This means that downstream devices need to support reverse polarity power with a rectification or FET based switching arrangement.</p>
<h3 id="podl-types-and-classes" is="h3">PoDL Types and Classes</h3>
<p>Standards develop and change over time as the group and industry work out the details. SPE+PoDL is just as confusing as I expected and has 16 supported power classes and a compatibility matrix between power classes and <code>10Base-T1S</code>, <code>10Base-T1L</code>, <code>100BaseT1</code>, <code>1000BaseT1</code>.</p>
<p><code>IEEE 802.3bu</code> started by defining several Types of power capable SPE devices <code>A</code>, <code>B</code>, <code>C</code> and <code>D</code>, primarily for automotive use. This included 10 classes for unregulated and regulated 12V and 24V options, along with regulated 48V.</p>
<div><table><thead><tr><th>Class</th><th>PD Power Budget (W)</th><th>PD Vmin</th><th>PD Vmax</th><th>Current Limit (mA)</th></tr></thead><tbody><tr><td>0</td><td>0.5</td><td>4.94</td><td>18</td><td>101</td></tr><tr><td>1</td><td>1</td><td>4.41</td><td>18</td><td>227</td></tr><tr><td>2</td><td>3</td><td>12</td><td>18</td><td>249</td></tr><tr><td>3</td><td>5</td><td>10.6</td><td>18</td><td>471</td></tr><tr><td>4</td><td>1</td><td>10.3</td><td>36</td><td>97</td></tr><tr><td>5</td><td>3</td><td>8.86</td><td>36</td><td>339</td></tr><tr><td>6</td><td>5</td><td>23.3</td><td>36</td><td>215</td></tr><tr><td>7</td><td>10</td><td>21.7</td><td>36</td><td>461</td></tr><tr><td>8</td><td>30</td><td>40.8</td><td>60</td><td>735</td></tr><tr><td>9</td><td>50</td><td>36.7</td><td>60</td><td>1360</td></tr></tbody></table></div>
<p><code>IEEE 802.3cg</code> later simplified things by adding Type E devices (<code>10Base-T1L</code> only) and another 6 classes of power delivery suitable for ~1-8W devices running with 20-30V (nominally 24V), and a massive 50W when using 54V supplies.</p>
<div><table><thead><tr><th>Class</th><th>PD Power Budget (W)</th><th>PD Vmin</th><th>PD Vmax</th><th>Current Limit (mA)</th></tr></thead><tbody><tr><td>10</td><td>1.23</td><td>14</td><td>30</td><td>92</td></tr><tr><td>11</td><td>3.2</td><td>14</td><td>30</td><td>240</td></tr><tr><td>12</td><td>8.4</td><td>14</td><td>30</td><td>632</td></tr><tr><td>13</td><td>7.7</td><td>35</td><td>58</td><td>231</td></tr><tr><td>14</td><td>20</td><td>35</td><td>58</td><td>600</td></tr><tr><td>15</td><td>52</td><td>35</td><td>58</td><td>1579</td></tr></tbody></table></div>
<p>For my typical projects, being able to use 24V with a few watts of power budget is the right balance of capable and practical, so I decided to aim for Class 12 support.</p>
<p>When a power supply wants to provide power to a downstream device, it first attempts to <strong>detect</strong> compliant PD hardware, and then uses a bidirectional communications process called SCCP to <strong>classify</strong> the device.</p>
<h3 id="detection--classification" is="h3">Detection &amp; Classification</h3>
<p>Detection is reasonably straightforward - the power supply uses a constant-current source capable of 9-16mA and ensure the open-loop voltage doesn&#39;t exceed 5.5V.</p>
<p>The downstream device uses this stimulus current to power up a small regulator for it&#39;s VID circuitry. Then, it sinks current until the voltage is brought within the specified signature range of 4.05-4.55V.</p>
<p>The power supply monitors the power line voltage and can signal to when a valid downstream device is identifying itself correctly.</p>
<p>The classification process is more involved, where both sides implement current sinking circuitry for a half-duplex 333bps communications link. The <a href="https://www.ti.com/lit/an/snla395/snla395.pdf" target="_blank" rel="noopener noreferrer">TI SNLA395 appnote</a> explains it reasonably well.</p>
<span><span>
      <a href="https://electricui.com/static/53302bbe384677b7066835f53166cb98/3d2f8/ref-ti-note.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/53302bbe384677b7066835f53166cb98/7bb4c/ref-ti-note.avif 225w,
/static/53302bbe384677b7066835f53166cb98/212f8/ref-ti-note.avif 450w,
/static/53302bbe384677b7066835f53166cb98/4d7a3/ref-ti-note.avif 900w,
/static/53302bbe384677b7066835f53166cb98/6f77c/ref-ti-note.avif 1350w,
/static/53302bbe384677b7066835f53166cb98/12c67/ref-ti-note.avif 1423w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/53302bbe384677b7066835f53166cb98/7d522/ref-ti-note.webp 225w,
/static/53302bbe384677b7066835f53166cb98/b5115/ref-ti-note.webp 450w,
/static/53302bbe384677b7066835f53166cb98/5722e/ref-ti-note.webp 900w,
/static/53302bbe384677b7066835f53166cb98/c5b95/ref-ti-note.webp 1350w,
/static/53302bbe384677b7066835f53166cb98/a2e15/ref-ti-note.webp 1423w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/53302bbe384677b7066835f53166cb98/1663a/ref-ti-note.png 225w,
/static/53302bbe384677b7066835f53166cb98/7f757/ref-ti-note.png 450w,
/static/53302bbe384677b7066835f53166cb98/7abe2/ref-ti-note.png 900w,
/static/53302bbe384677b7066835f53166cb98/5d6e7/ref-ti-note.png 1350w,
/static/53302bbe384677b7066835f53166cb98/3d2f8/ref-ti-note.png 1423w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/53302bbe384677b7066835f53166cb98/7abe2/ref-ti-note.png" alt="ref-ti-note" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>Electrically this can be as simple as some resistors and an extra mosfet on each board controlled by a microcontroller, but reference material often includes extra buffering and input protection circuitry.</p>
<p>While literature suggest either bit-banging or an SPI peripheral make data transfer easy, I wasn&#39;t particularly keen to spend several hundred dollars to buy the specification <em>and then</em> implement a driver to communicate correctly.</p>
<p>Looking for alternatives, the <a href="https://www.analog.com/en/products/ltc9111.html" target="_blank" rel="noopener noreferrer">Analog Devices LTC9111</a> is a viable option for adding SCCP to the Type E downstream devices, with the added benefit of simplifying input polarity handling. For ~$5 and a simplified BOM this is probably a pretty easy choice.</p>
<p>Unfortunately, a simple supply-side SCCP controller doesn&#39;t seem to exist yet, the only option I could find was the incredibly expensive ($20) <a href="https://www.analog.com/media/en/technical-documentation/data-sheets/ltc4296-1.pdf" target="_blank" rel="noopener noreferrer">LTC4296</a> 5-port controller intended for switch style devices.</p>
<h3 id="fast-startup" is="h3">Fast Startup</h3>
<p>For a fully capable PoDL supply, both detection and classification steps would be implemented.</p>
<p>However the standard allows us to only implement detection <strong>OR</strong> classification and call it &#39;Fast-start operation&#39;. Given the lower complexity of detection, this was a pretty appealing option.</p>
<h2 id="submersible-sensor-node" is="h2">Submersible Sensor Node</h2>
<p>So now we understand what SPE+PoDL will let us do, lets get into the design.</p>
<p>Marine scientists often need to make observations or stimulate the environment. The combination of harsh environmental conditions, specialised hardware, and tricky cross-domain skill-sets needed to develop bespoke hardware presents a special challenge.</p>
<blockquote>
<p><em>Did you know</em>: Playing sounds of healthy reefs can help attract marine life to damaged reefs and accelerate recovery processes!</p>
</blockquote>
<p>A single conductor pair providing power and data over long distances offers some interesting improvements in data rate, reduced power consumption, and simpler (cheaper/lighter) cabling.</p>
<p>Building on the Sparkfun MicroMod ecosystem (and hardware provided as part of the design challenge), I&#39;ll design replacements for the data-only ADIN1110 function boards which add PoDL capabilities.</p>
<p>Then we&#39;ll package them in a waterproof enclosure suitable for small sensing payloads as a technology demonstrator.</p>
<h3 id="mechanical-design" is="h3">Mechanical Design</h3>
<p>The electronics need to fit inside a practical waterproof housing, so I let the mechanical design drive the design choices for the electronics stack.</p>
<p>I considered building a housing out of PVC pipe with glands and a heaping of potting compound, but found <a href="https://bluerobotics.com/" target="_blank" rel="noopener noreferrer">BlueRobotics</a> sell reasonably configurable waterproof housing parts for building custom modules for use on their ROV platforms. As a bonus, STEP models for most of their parts made it pretty easy to plan out the housing and mock up the electronics.</p>
<p>I chose the smallest 2″ acrylic tube (<em>~58mm OD</em>) and matching aluminium end-caps. This provides an internal volume constrained by the 50 mm tube diameter and ~118 mm maximum gap between bulkheads.</p>
<span><span>
      <a href="https://electricui.com/static/088568aed072f890e72372ddc150ddc6/81ebc/mech-side-view.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/088568aed072f890e72372ddc150ddc6/7bb4c/mech-side-view.avif 225w,
/static/088568aed072f890e72372ddc150ddc6/212f8/mech-side-view.avif 450w,
/static/088568aed072f890e72372ddc150ddc6/4d7a3/mech-side-view.avif 900w,
/static/088568aed072f890e72372ddc150ddc6/6f77c/mech-side-view.avif 1350w,
/static/088568aed072f890e72372ddc150ddc6/dee7e/mech-side-view.avif 1655w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/088568aed072f890e72372ddc150ddc6/7d522/mech-side-view.webp 225w,
/static/088568aed072f890e72372ddc150ddc6/b5115/mech-side-view.webp 450w,
/static/088568aed072f890e72372ddc150ddc6/5722e/mech-side-view.webp 900w,
/static/088568aed072f890e72372ddc150ddc6/c5b95/mech-side-view.webp 1350w,
/static/088568aed072f890e72372ddc150ddc6/94cc5/mech-side-view.webp 1655w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/088568aed072f890e72372ddc150ddc6/08b3c/mech-side-view.jpg 225w,
/static/088568aed072f890e72372ddc150ddc6/12ba2/mech-side-view.jpg 450w,
/static/088568aed072f890e72372ddc150ddc6/86440/mech-side-view.jpg 900w,
/static/088568aed072f890e72372ddc150ddc6/7e63a/mech-side-view.jpg 1350w,
/static/088568aed072f890e72372ddc150ddc6/81ebc/mech-side-view.jpg 1655w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/088568aed072f890e72372ddc150ddc6/86440/mech-side-view.jpg" alt="mech-side-view" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>The top cap/bulkhead has 4×M10 threaded holes for accessories as part of BlueRobotic&#39;s hardware ecosystem. The prototype uses:</p>
<ul>
<li>4.5mm Wetlink penetrator for the tether cable</li>
<li>10m, high resolution pressure sensor</li>
<li>White indicator LED</li>
<li>Pressure relief/test valve</li>
</ul>
<p>Whilst this prototype won&#39;t see properly deep water, BlueRobotics suggest this tube configuration should be capable of withstanding 200 meter operation, and far deeper if an aluminium sleeve is used.</p>
<p>I created mockup PCB models which I could use for board outlines in KiCAD, and to check how much height was available for the tall parts like SPE connector block and inductors.</p>
<span><span>
      <a href="https://electricui.com/static/7060e3fa200115e95c17f672264fb473/5ea5e/mech-height-study.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/7060e3fa200115e95c17f672264fb473/7bb4c/mech-height-study.avif 225w,
/static/7060e3fa200115e95c17f672264fb473/212f8/mech-height-study.avif 450w,
/static/7060e3fa200115e95c17f672264fb473/4d7a3/mech-height-study.avif 900w,
/static/7060e3fa200115e95c17f672264fb473/6f77c/mech-height-study.avif 1350w,
/static/7060e3fa200115e95c17f672264fb473/6b417/mech-height-study.avif 1505w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/7060e3fa200115e95c17f672264fb473/7d522/mech-height-study.webp 225w,
/static/7060e3fa200115e95c17f672264fb473/b5115/mech-height-study.webp 450w,
/static/7060e3fa200115e95c17f672264fb473/5722e/mech-height-study.webp 900w,
/static/7060e3fa200115e95c17f672264fb473/c5b95/mech-height-study.webp 1350w,
/static/7060e3fa200115e95c17f672264fb473/9d902/mech-height-study.webp 1505w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/7060e3fa200115e95c17f672264fb473/1663a/mech-height-study.png 225w,
/static/7060e3fa200115e95c17f672264fb473/7f757/mech-height-study.png 450w,
/static/7060e3fa200115e95c17f672264fb473/7abe2/mech-height-study.png 900w,
/static/7060e3fa200115e95c17f672264fb473/5d6e7/mech-height-study.png 1350w,
/static/7060e3fa200115e95c17f672264fb473/5ea5e/mech-height-study.png 1505w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/7060e3fa200115e95c17f672264fb473/7abe2/mech-height-study.png" alt="mech-height-study" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>There&#39;s a reasonable amount of room in the tube, but clearances like these usually have a habit of looking larger when being designed on a screen.</p>
<p>There are 3 PCB&#39;s that need to be designed - the main &#39;spine&#39; PCB which behaves like a MicroMod compliant carrier board, and the power supply and device variants of the SPE+PoDL communications board.</p>
<h3 id="backplane-pcb" is="h3">Backplane PCB</h3>
<p>Acting as the MicroMod &#39;carrier&#39;, this board acts as the tube&#39;s electrical spine and provides the processor and function board NGFF (aka M.2) connectors, as well as USB and SWD connectors, a 3.3V regulator, some I2C headers, and breakout pads for expansion IO.</p>
<span><span>
      <a href="https://electricui.com/static/1ad7fda83ef4983e2774a3d3d0ae04dc/1f855/sch-backplane-overview.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/1ad7fda83ef4983e2774a3d3d0ae04dc/7bb4c/sch-backplane-overview.avif 225w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/212f8/sch-backplane-overview.avif 450w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/4d7a3/sch-backplane-overview.avif 900w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/6f77c/sch-backplane-overview.avif 1350w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/a848b/sch-backplane-overview.avif 1800w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/b0cf9/sch-backplane-overview.avif 1886w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/1ad7fda83ef4983e2774a3d3d0ae04dc/7d522/sch-backplane-overview.webp 225w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/b5115/sch-backplane-overview.webp 450w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/5722e/sch-backplane-overview.webp 900w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/c5b95/sch-backplane-overview.webp 1350w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/8fb31/sch-backplane-overview.webp 1800w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/e22d9/sch-backplane-overview.webp 1886w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/1ad7fda83ef4983e2774a3d3d0ae04dc/1663a/sch-backplane-overview.png 225w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/7f757/sch-backplane-overview.png 450w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/7abe2/sch-backplane-overview.png 900w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/5d6e7/sch-backplane-overview.png 1350w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/7385a/sch-backplane-overview.png 1800w,
/static/1ad7fda83ef4983e2774a3d3d0ae04dc/1f855/sch-backplane-overview.png 1886w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/1ad7fda83ef4983e2774a3d3d0ae04dc/7abe2/sch-backplane-overview.png" alt="sch-backplane-overview" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>The hardest part of designing this board was trying to untangle the supported GPIO across the range of processor boards, and how that&#39;s mapped against the function boards. While Sparkfun&#39;s documentation and guides normally sit between &#39;<em>pretty good</em>&#39; and &#39;<em>excellent</em>&#39;, this process was rather tedious.</p>
<p>From another (unfinished) project, I already had pretty much the entire range of MicroMod processor boards laying around (<code>ESP32</code>, <code>STM32F405</code>, <code>NRF52840</code>, <code>RP2040</code>, <code>SAMD51</code>, <code>Teensy</code>, <code>Apollo3</code>/Artemis) and wanted the design to support the widest range of targets possible (the whole point of MicroMod).</p>
<p>This list of options is cut down substantially if much more than the primary SPI and I2C busses are needed, you want <code>ADIN1110</code> example library to work, and most processor boards have subtle implementation inconsistencies which turn the pin allocation into a trade-off balancing act.</p>
<span><span>
      <a href="https://electricui.com/static/f16c89a25a21b05f27dffaef6cd12bf9/9bae2/pcb-render-backplane.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/f16c89a25a21b05f27dffaef6cd12bf9/7bb4c/pcb-render-backplane.avif 225w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/212f8/pcb-render-backplane.avif 450w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/4d7a3/pcb-render-backplane.avif 900w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/6f77c/pcb-render-backplane.avif 1350w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/a848b/pcb-render-backplane.avif 1800w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/e4150/pcb-render-backplane.avif 2067w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/f16c89a25a21b05f27dffaef6cd12bf9/7d522/pcb-render-backplane.webp 225w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/b5115/pcb-render-backplane.webp 450w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/5722e/pcb-render-backplane.webp 900w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/c5b95/pcb-render-backplane.webp 1350w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/8fb31/pcb-render-backplane.webp 1800w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/9f0bd/pcb-render-backplane.webp 2067w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/f16c89a25a21b05f27dffaef6cd12bf9/1663a/pcb-render-backplane.png 225w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/7f757/pcb-render-backplane.png 450w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/7abe2/pcb-render-backplane.png 900w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/5d6e7/pcb-render-backplane.png 1350w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/7385a/pcb-render-backplane.png 1800w,
/static/f16c89a25a21b05f27dffaef6cd12bf9/9bae2/pcb-render-backplane.png 2067w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/f16c89a25a21b05f27dffaef6cd12bf9/7abe2/pcb-render-backplane.png" alt="pcb-render-backplane" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>It&#39;s a two-layer 46 x 100 mm 1.6 mm 2-layer board with pretty relaxed fabrication requirements, costing under $10 from typical commodity Chinese PCBA fabs.</p>
<p>I opted to try the taller 4mm solderable standoff on the rear for sensor mounting and added some spare IO pads and solderable links to make/break the <code>I2C1</code> bus from the connectors.</p>
<h3 id="pd-function-board" is="h3">PD Function Board</h3>
<p>This function board implements the <a href="https://electricui.com/blog/www.analog.com/ADIN1110.html">ADIN1110</a> SPE transceiver in a similar manner to <a href="https://www.sparkfun.com/products/19038" target="_blank" rel="noopener noreferrer">Sparkfun&#39;s function board</a>, but deviates from the dev-kit by adding the necessary coupling network and detection circuitry to act as a Class 10-12 PoDL device aka PD.</p>
<span><span>
      <a href="https://electricui.com/static/5725068c0c87770254ca137acb24adb4/d1a1d/sch-pd-overview.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/5725068c0c87770254ca137acb24adb4/7bb4c/sch-pd-overview.avif 225w,
/static/5725068c0c87770254ca137acb24adb4/212f8/sch-pd-overview.avif 450w,
/static/5725068c0c87770254ca137acb24adb4/4d7a3/sch-pd-overview.avif 900w,
/static/5725068c0c87770254ca137acb24adb4/6f77c/sch-pd-overview.avif 1350w,
/static/5725068c0c87770254ca137acb24adb4/a848b/sch-pd-overview.avif 1800w,
/static/5725068c0c87770254ca137acb24adb4/e0a08/sch-pd-overview.avif 2362w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/5725068c0c87770254ca137acb24adb4/7d522/sch-pd-overview.webp 225w,
/static/5725068c0c87770254ca137acb24adb4/b5115/sch-pd-overview.webp 450w,
/static/5725068c0c87770254ca137acb24adb4/5722e/sch-pd-overview.webp 900w,
/static/5725068c0c87770254ca137acb24adb4/c5b95/sch-pd-overview.webp 1350w,
/static/5725068c0c87770254ca137acb24adb4/8fb31/sch-pd-overview.webp 1800w,
/static/5725068c0c87770254ca137acb24adb4/55be9/sch-pd-overview.webp 2362w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/5725068c0c87770254ca137acb24adb4/1663a/sch-pd-overview.png 225w,
/static/5725068c0c87770254ca137acb24adb4/7f757/sch-pd-overview.png 450w,
/static/5725068c0c87770254ca137acb24adb4/7abe2/sch-pd-overview.png 900w,
/static/5725068c0c87770254ca137acb24adb4/5d6e7/sch-pd-overview.png 1350w,
/static/5725068c0c87770254ca137acb24adb4/7385a/sch-pd-overview.png 1800w,
/static/5725068c0c87770254ca137acb24adb4/d1a1d/sch-pd-overview.png 2362w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/5725068c0c87770254ca137acb24adb4/7abe2/sch-pd-overview.png" alt="sch-pd-overview" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>I won&#39;t go into the implementation details around the <code>ADIN1110</code> or MicroMod edge-connector, but if you&#39;re interested the full schematics are in the <a href="https://github.com/Scottapotamas/spe-marine-node" target="_blank" rel="noopener noreferrer">Git repository</a>.</p>
<p>The key areas of discussion are the signature circuitry, and how power is handled once the supply enables full bus voltage.</p>
<span><span>
      <a href="https://electricui.com/static/aabef3f6ab507c878dc6ed8d77bef93e/a7e78/sch-pd-vid.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/aabef3f6ab507c878dc6ed8d77bef93e/7bb4c/sch-pd-vid.avif 225w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/212f8/sch-pd-vid.avif 450w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/4d7a3/sch-pd-vid.avif 900w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/6f77c/sch-pd-vid.avif 1350w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/a848b/sch-pd-vid.avif 1800w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/ceeb6/sch-pd-vid.avif 2502w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/aabef3f6ab507c878dc6ed8d77bef93e/7d522/sch-pd-vid.webp 225w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/b5115/sch-pd-vid.webp 450w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/5722e/sch-pd-vid.webp 900w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/c5b95/sch-pd-vid.webp 1350w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/8fb31/sch-pd-vid.webp 1800w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/d9f7c/sch-pd-vid.webp 2502w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/aabef3f6ab507c878dc6ed8d77bef93e/1663a/sch-pd-vid.png 225w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/7f757/sch-pd-vid.png 450w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/7abe2/sch-pd-vid.png 900w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/5d6e7/sch-pd-vid.png 1350w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/7385a/sch-pd-vid.png 1800w,
/static/aabef3f6ab507c878dc6ed8d77bef93e/a7e78/sch-pd-vid.png 2502w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/aabef3f6ab507c878dc6ed8d77bef93e/7abe2/sch-pd-vid.png" alt="sch-pd-vid" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>From left to right, we&#39;ve got a <code>AP7375</code> wide input voltage LDO which can tolerate bus voltage providing the 3.3V supply to a <code>MCP65R41T</code> comparator with an internal 1.2V internal reference.</p>
<p>The voltage divider (<code>R1</code>, <code>R2</code>) is configured to output approximately 1.2V (matching the internal reference voltage) for a 4.05V input voltage. The output of the comparator then controls a simple N-channel mosfet which switches the <code>TL431</code> shunt regulator on or off, resulting in a regulated voltage which matches the signature voltage range.</p>
<blockquote>
<p>In bench testing the signature voltage measured on the supply side was ~3.905V, slightly lower than intended.</p>
<p>I ended up replacing <code>R2</code> with 390k to compensate for voltage drop over the rectifier diodes, resulting in a signature voltage of 4.4V.</p>
</blockquote>
<p>Assuming the detection circuit works correctly, the power supply would then enable the full bus voltage of 24VDC.</p>
<span><span>
      <a href="https://electricui.com/static/ddba4fcd7b43787dfc481dd3af87d2da/56723/sch-pd-regulation.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/ddba4fcd7b43787dfc481dd3af87d2da/7bb4c/sch-pd-regulation.avif 225w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/212f8/sch-pd-regulation.avif 450w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/4d7a3/sch-pd-regulation.avif 900w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/6f77c/sch-pd-regulation.avif 1350w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/a848b/sch-pd-regulation.avif 1800w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/5e212/sch-pd-regulation.avif 2505w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/ddba4fcd7b43787dfc481dd3af87d2da/7d522/sch-pd-regulation.webp 225w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/b5115/sch-pd-regulation.webp 450w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/5722e/sch-pd-regulation.webp 900w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/c5b95/sch-pd-regulation.webp 1350w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/8fb31/sch-pd-regulation.webp 1800w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/42c69/sch-pd-regulation.webp 2505w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/ddba4fcd7b43787dfc481dd3af87d2da/1663a/sch-pd-regulation.png 225w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/7f757/sch-pd-regulation.png 450w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/7abe2/sch-pd-regulation.png 900w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/5d6e7/sch-pd-regulation.png 1350w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/7385a/sch-pd-regulation.png 1800w,
/static/ddba4fcd7b43787dfc481dd3af87d2da/56723/sch-pd-regulation.png 2505w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/ddba4fcd7b43787dfc481dd3af87d2da/7abe2/sch-pd-regulation.png" alt="sch-pd-regulation" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>The <code>TPS26625</code> eFuse switch is configured to automatically switch on once the input voltage is above the PoDL Class 10-12 minimum voltage specification of 14V. It also provides configurable over-voltage and current limiting which makes a compact layout possible.</p>
<p>The 5V regulator is an interesting part - the Texas Instruments <code>TLVM23625</code> is a tiny, 36V capable, 2.5A switch-mode regulator with an integrated inductor and switch. This was pretty helpful with the constrained layout.</p>
<p>The 5V output is used to power the function board&#39;s 3.3V LDO, and also back-powers the carrier board. I included a current shunt and amplifier allow for sink-side current measurement on the 5V rail.</p>
<span><span>
      <a href="https://electricui.com/static/bd0332f20545bc475f8953f4e6704565/f2a99/pcb-render-pd.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/bd0332f20545bc475f8953f4e6704565/7bb4c/pcb-render-pd.avif 225w,
/static/bd0332f20545bc475f8953f4e6704565/212f8/pcb-render-pd.avif 450w,
/static/bd0332f20545bc475f8953f4e6704565/4d7a3/pcb-render-pd.avif 900w,
/static/bd0332f20545bc475f8953f4e6704565/1ba5a/pcb-render-pd.avif 1301w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/bd0332f20545bc475f8953f4e6704565/7d522/pcb-render-pd.webp 225w,
/static/bd0332f20545bc475f8953f4e6704565/b5115/pcb-render-pd.webp 450w,
/static/bd0332f20545bc475f8953f4e6704565/5722e/pcb-render-pd.webp 900w,
/static/bd0332f20545bc475f8953f4e6704565/123be/pcb-render-pd.webp 1301w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/bd0332f20545bc475f8953f4e6704565/1663a/pcb-render-pd.png 225w,
/static/bd0332f20545bc475f8953f4e6704565/7f757/pcb-render-pd.png 450w,
/static/bd0332f20545bc475f8953f4e6704565/7abe2/pcb-render-pd.png 900w,
/static/bd0332f20545bc475f8953f4e6704565/f2a99/pcb-render-pd.png 1301w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/bd0332f20545bc475f8953f4e6704565/7abe2/pcb-render-pd.png" alt="pcb-render-pd" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>The resulting layout is reasonably dense, but maintains the same MicroMod Function board dimensions.</p>
<blockquote>
<p>I tweaked the 5V regulator&#39;s feedback network after testing. I was seeing the intended 5.03V regulated voltage, but needed to compensate for the ~0.205V drop over the protection diode.</p>
</blockquote>
<h3 id="pse-function-board" is="h3">PSE Function Board</h3>
<p>This board shares the input coupling network and <code>ADIN1110</code> design with the PD board, but replaces the detection signalling circuitry and bulk regulator with the necessary circuitry to test and detect valid downstream devices. Instead of using the power switch to power up the board when bus voltage is within spec, it&#39;s used to switch the HV input on once detection succeeds.</p>
<span><span>
      <a href="https://electricui.com/static/0ceb0b5ba519c043d2c8933bd0b1fa85/f8310/sch-pse-overview.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/0ceb0b5ba519c043d2c8933bd0b1fa85/7bb4c/sch-pse-overview.avif 225w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/212f8/sch-pse-overview.avif 450w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/4d7a3/sch-pse-overview.avif 900w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/6f77c/sch-pse-overview.avif 1350w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/a848b/sch-pse-overview.avif 1800w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/113fb/sch-pse-overview.avif 2428w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/0ceb0b5ba519c043d2c8933bd0b1fa85/7d522/sch-pse-overview.webp 225w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/b5115/sch-pse-overview.webp 450w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/5722e/sch-pse-overview.webp 900w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/c5b95/sch-pse-overview.webp 1350w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/8fb31/sch-pse-overview.webp 1800w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/3c689/sch-pse-overview.webp 2428w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/0ceb0b5ba519c043d2c8933bd0b1fa85/1663a/sch-pse-overview.png 225w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/7f757/sch-pse-overview.png 450w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/7abe2/sch-pse-overview.png 900w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/5d6e7/sch-pse-overview.png 1350w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/7385a/sch-pse-overview.png 1800w,
/static/0ceb0b5ba519c043d2c8933bd0b1fa85/f8310/sch-pse-overview.png 2428w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/0ceb0b5ba519c043d2c8933bd0b1fa85/7abe2/sch-pse-overview.png" alt="sch-pse-overview" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>Unlike the PD board, managing the detection process does require microcontroller interaction to enable the current source, watch the detection circuit, and then disable the current source before enabling the HV switch.</p>
<p>Additionally, maintain full voltage signature (MVFS) behaviour needs the microcontroller to monitor the current sense signal for a minimum peak load of 11mA per 10ms span to keep the power supply  active (though this can be set lower if needed).</p>
<span><span>
      <a href="https://electricui.com/static/08d7629ad1e47526347722c91404e292/a8ae7/sch-source-detection.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/08d7629ad1e47526347722c91404e292/7bb4c/sch-source-detection.avif 225w,
/static/08d7629ad1e47526347722c91404e292/212f8/sch-source-detection.avif 450w,
/static/08d7629ad1e47526347722c91404e292/4d7a3/sch-source-detection.avif 900w,
/static/08d7629ad1e47526347722c91404e292/6f77c/sch-source-detection.avif 1350w,
/static/08d7629ad1e47526347722c91404e292/a848b/sch-source-detection.avif 1800w,
/static/08d7629ad1e47526347722c91404e292/87a4d/sch-source-detection.avif 2463w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/08d7629ad1e47526347722c91404e292/7d522/sch-source-detection.webp 225w,
/static/08d7629ad1e47526347722c91404e292/b5115/sch-source-detection.webp 450w,
/static/08d7629ad1e47526347722c91404e292/5722e/sch-source-detection.webp 900w,
/static/08d7629ad1e47526347722c91404e292/c5b95/sch-source-detection.webp 1350w,
/static/08d7629ad1e47526347722c91404e292/8fb31/sch-source-detection.webp 1800w,
/static/08d7629ad1e47526347722c91404e292/ec111/sch-source-detection.webp 2463w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/08d7629ad1e47526347722c91404e292/1663a/sch-source-detection.png 225w,
/static/08d7629ad1e47526347722c91404e292/7f757/sch-source-detection.png 450w,
/static/08d7629ad1e47526347722c91404e292/7abe2/sch-source-detection.png 900w,
/static/08d7629ad1e47526347722c91404e292/5d6e7/sch-source-detection.png 1350w,
/static/08d7629ad1e47526347722c91404e292/7385a/sch-source-detection.png 1800w,
/static/08d7629ad1e47526347722c91404e292/a8ae7/sch-source-detection.png 2463w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/08d7629ad1e47526347722c91404e292/7abe2/sch-source-detection.png" alt="sch-source-detection" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>From left to right, a 7V output wide input LDO powers the current stimulus circuit. Instead of building a constant-current source from scratch, I use a <code>NSI50010YT1G</code> LED driver IC which is switched on/off by a P-channel mosfet. This approach is intentionally simple, but probably not ideal as there&#39;s limited control over the current output and startup slew-rate.</p>
<p>The current source output is protected from the switched 24V output by a diode, and also has a 5.6V zener diode to clamp the output voltage to the specified maximum open-loop voltage of 5.5V.</p>
<p>Once the downstream powers up and starts presenting the signature voltage range of 4.05V to 4.55V, the <code>TLV6700</code> window comparator output provides the microcontroller with the <code>VID_VALID</code> signal.</p>
<p>The microcontroller then enables this board&#39;s <code>TPS26625</code> eFuse to pass the 24V input supply to the downstream device. On this board, the eFuse&#39;s ULVO and OVP is configured for the Class 10-12 allowable PSE range of 20-30V.</p>
<span><span>
      <a href="https://electricui.com/static/55d04c91b77215934d95b8c9e680bb08/960b8/pcb-render-pse.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/55d04c91b77215934d95b8c9e680bb08/7bb4c/pcb-render-pse.avif 225w,
/static/55d04c91b77215934d95b8c9e680bb08/212f8/pcb-render-pse.avif 450w,
/static/55d04c91b77215934d95b8c9e680bb08/4d7a3/pcb-render-pse.avif 900w,
/static/55d04c91b77215934d95b8c9e680bb08/f15a4/pcb-render-pse.avif 1331w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/55d04c91b77215934d95b8c9e680bb08/7d522/pcb-render-pse.webp 225w,
/static/55d04c91b77215934d95b8c9e680bb08/b5115/pcb-render-pse.webp 450w,
/static/55d04c91b77215934d95b8c9e680bb08/5722e/pcb-render-pse.webp 900w,
/static/55d04c91b77215934d95b8c9e680bb08/8b8bb/pcb-render-pse.webp 1331w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/55d04c91b77215934d95b8c9e680bb08/1663a/pcb-render-pse.png 225w,
/static/55d04c91b77215934d95b8c9e680bb08/7f757/pcb-render-pse.png 450w,
/static/55d04c91b77215934d95b8c9e680bb08/7abe2/pcb-render-pse.png 900w,
/static/55d04c91b77215934d95b8c9e680bb08/960b8/pcb-render-pse.png 1331w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/55d04c91b77215934d95b8c9e680bb08/7abe2/pcb-render-pse.png" alt="pcb-render-pse" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>I&#39;m a little annoyed with how the detection circuitry part placement and routing turned out, a mix of rushing the design late at night and higher part count made it tricky to fit in the same area as the PD&#39;s circuitry.</p>
<blockquote>
<p>As an aside, this PSE design probably makes more sense as it&#39;s own carrier board, or as a media converter to 10BaseT ethernet.</p>
<p>Implementing it as a function board allowed for design re-use and opens up some flexibility in final use-cases though.</p>
</blockquote>
<h3 id="printable-mounting-brackets" is="h3">Printable mounting brackets</h3>
<p>With the boards designed, I brought exported STEP models back into my CAD model and designed a pair of 3D printed board mounts use the 4×M3 internal mounting holes in the bulkheads.</p>
<p>The upper bracket abuses the solderable standoffs on the rear of the backplane board as mounting features, along with the key cutout in the PCB to force alignment.</p>
<span><span>
      <a href="https://electricui.com/static/d7542fcc08e7a961de3feb6a0665b62f/69b48/mech-pcb-mounts.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/d7542fcc08e7a961de3feb6a0665b62f/7bb4c/mech-pcb-mounts.avif 225w,
/static/d7542fcc08e7a961de3feb6a0665b62f/212f8/mech-pcb-mounts.avif 450w,
/static/d7542fcc08e7a961de3feb6a0665b62f/4d7a3/mech-pcb-mounts.avif 900w,
/static/d7542fcc08e7a961de3feb6a0665b62f/6f77c/mech-pcb-mounts.avif 1350w,
/static/d7542fcc08e7a961de3feb6a0665b62f/a848b/mech-pcb-mounts.avif 1800w,
/static/d7542fcc08e7a961de3feb6a0665b62f/b16ce/mech-pcb-mounts.avif 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/d7542fcc08e7a961de3feb6a0665b62f/7d522/mech-pcb-mounts.webp 225w,
/static/d7542fcc08e7a961de3feb6a0665b62f/b5115/mech-pcb-mounts.webp 450w,
/static/d7542fcc08e7a961de3feb6a0665b62f/5722e/mech-pcb-mounts.webp 900w,
/static/d7542fcc08e7a961de3feb6a0665b62f/c5b95/mech-pcb-mounts.webp 1350w,
/static/d7542fcc08e7a961de3feb6a0665b62f/8fb31/mech-pcb-mounts.webp 1800w,
/static/d7542fcc08e7a961de3feb6a0665b62f/7e36f/mech-pcb-mounts.webp 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/d7542fcc08e7a961de3feb6a0665b62f/08b3c/mech-pcb-mounts.jpg 225w,
/static/d7542fcc08e7a961de3feb6a0665b62f/12ba2/mech-pcb-mounts.jpg 450w,
/static/d7542fcc08e7a961de3feb6a0665b62f/86440/mech-pcb-mounts.jpg 900w,
/static/d7542fcc08e7a961de3feb6a0665b62f/7e63a/mech-pcb-mounts.jpg 1350w,
/static/d7542fcc08e7a961de3feb6a0665b62f/96503/mech-pcb-mounts.jpg 1800w,
/static/d7542fcc08e7a961de3feb6a0665b62f/69b48/mech-pcb-mounts.jpg 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/d7542fcc08e7a961de3feb6a0665b62f/86440/mech-pcb-mounts.jpg" alt="mech-pcb-mounts" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>Because the mounted electronics need to slide through the tube to meet the other end-cap, a simple tapered groove design is used to retain the PCB once installed.</p>
<h3 id="electronics-assembly--testing" is="h3">Electronics Assembly &amp; Testing</h3>
<p>PCBs and printed parts were ordered from China and arrived in South Australia in a pretty impressive 4-days. The components from DigiKey arrived a day or two later.</p>
<span>
      
    </span>
<p>I assembled 2 of each board using a pretty typical paste stencil and reflow plate, with some hot air assisting for heavier parts.</p>
<span>
      
    </span>
<p>Bring-up testing didn&#39;t throw any surprises, I started with a lab supply to check the power paths didn&#39;t have any critical errors.</p>
<p>The PD board eFuse ULVO/OVP behaviour and 5V regulator behaved as expected. The rectifier and decoupling network also handled 24V with either polarity without issue, dropping about 0.4V across the rectifier diodes.</p>
<p>Testing the PSE board was similar, checking the current source output with a multimeter, then using the lab supply to provide a 4.2V test voltage to trigger the window comparator&#39;s output.</p>
<span><span>
      <a href="https://electricui.com/static/cc2f15f90345f6f39e589450be488f5d/c3f3a/podl-negotiation.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/cc2f15f90345f6f39e589450be488f5d/7bb4c/podl-negotiation.avif 225w,
/static/cc2f15f90345f6f39e589450be488f5d/212f8/podl-negotiation.avif 450w,
/static/cc2f15f90345f6f39e589450be488f5d/4d7a3/podl-negotiation.avif 900w,
/static/cc2f15f90345f6f39e589450be488f5d/6f77c/podl-negotiation.avif 1350w,
/static/cc2f15f90345f6f39e589450be488f5d/a848b/podl-negotiation.avif 1800w,
/static/cc2f15f90345f6f39e589450be488f5d/e5db1/podl-negotiation.avif 1977w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/cc2f15f90345f6f39e589450be488f5d/7d522/podl-negotiation.webp 225w,
/static/cc2f15f90345f6f39e589450be488f5d/b5115/podl-negotiation.webp 450w,
/static/cc2f15f90345f6f39e589450be488f5d/5722e/podl-negotiation.webp 900w,
/static/cc2f15f90345f6f39e589450be488f5d/c5b95/podl-negotiation.webp 1350w,
/static/cc2f15f90345f6f39e589450be488f5d/8fb31/podl-negotiation.webp 1800w,
/static/cc2f15f90345f6f39e589450be488f5d/89984/podl-negotiation.webp 1977w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/cc2f15f90345f6f39e589450be488f5d/1663a/podl-negotiation.png 225w,
/static/cc2f15f90345f6f39e589450be488f5d/7f757/podl-negotiation.png 450w,
/static/cc2f15f90345f6f39e589450be488f5d/7abe2/podl-negotiation.png 900w,
/static/cc2f15f90345f6f39e589450be488f5d/5d6e7/podl-negotiation.png 1350w,
/static/cc2f15f90345f6f39e589450be488f5d/7385a/podl-negotiation.png 1800w,
/static/cc2f15f90345f6f39e589450be488f5d/c3f3a/podl-negotiation.png 1977w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/cc2f15f90345f6f39e589450be488f5d/7abe2/podl-negotiation.png" alt="podl-negotiation" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>I quickly wrote some simple PD detection handling code which uses a state-machine to control the detection behaviour:</p>
<ul>
<li>Enable the current source,</li>
<li>Wait for the downstream device to boot,</li>
<li>Check the comparator output for VID valid flag (and filter it),</li>
<li>Disable the current source, wait a bit,</li>
<li>Enable the power switch to enable 24V supply.</li>
</ul>
<p>The scope trace below shows the PoDL bus voltage in yellow (<code>CH1</code>), and the PD board&#39;s 5V regulator is the blue trace (<code>CH2</code>). The state-machine timing was intentionally slowed down to make the trace easier to understand.</p>
<span><span>
      <a href="https://electricui.com/static/42da4620b0e945a7bfe630920ca73219/7842b/scope-pd-detection.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/42da4620b0e945a7bfe630920ca73219/7bb4c/scope-pd-detection.avif 225w,
/static/42da4620b0e945a7bfe630920ca73219/212f8/scope-pd-detection.avif 450w,
/static/42da4620b0e945a7bfe630920ca73219/c6718/scope-pd-detection.avif 800w" sizes="(max-width: 800px) 100vw, 800px" type="image/avif"/><source srcset="/static/42da4620b0e945a7bfe630920ca73219/7d522/scope-pd-detection.webp 225w,
/static/42da4620b0e945a7bfe630920ca73219/b5115/scope-pd-detection.webp 450w,
/static/42da4620b0e945a7bfe630920ca73219/47a22/scope-pd-detection.webp 800w" sizes="(max-width: 800px) 100vw, 800px" type="image/webp"/>
          <source srcset="/static/42da4620b0e945a7bfe630920ca73219/1663a/scope-pd-detection.png 225w,
/static/42da4620b0e945a7bfe630920ca73219/7f757/scope-pd-detection.png 450w,
/static/42da4620b0e945a7bfe630920ca73219/7842b/scope-pd-detection.png 800w" sizes="(max-width: 800px) 100vw, 800px" type="image/png"/>
          <img src="https://electricui.com/static/42da4620b0e945a7bfe630920ca73219/7842b/scope-pd-detection.png" alt="scope-pd-detection" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>We can see the current source enable, settle at 4.4V for 5ms, then decay once the current source is disabled. Then the 24V switch enables with a nicely controlled slew rate thanks to the eFuse, followed by the 5V regulator cleanly coming up a couple of milliseconds later.</p>
<p>This is a successful power up sequence for 24V PoDL!</p>
<p>On the data side, I mounted the custom function boards into the MicroMod function carrier and flashed some basic Arduino test sketches to exercise the ADIN1110&#39;s self-test loopback.</p>
<div><div><pre><code><span><p><span>Adin1110 found!</span></p><p><span>Frame Generator/Checker Results:</span></p><p><span>    (FG) Sent:           20000 frames</span></p><p><span>    (FC) Received:       20000 frames</span></p><p><span>         Rx Errors             = 0</span></p><p><span>           LEN_ERR_CNT         = 0</span></p><p><span>           ALGN_ERR_CNT        = 0</span></p><p><span>           SYMB_ERR_CNT        = 0</span></p><p><span>           OSZ_CNT             = 0</span></p><p><span>           USZ_CNT             = 0</span></p><p><span>           ODD_CNT             = 0</span></p><p><span>           ODD_PRE_CNT         = 0</span></p><p><span>           FALSE_CARRIER_CNT   = 0</span></p></span></code></pre></div></div>
<p>We can communicate with the MAC over SPI successfully, so that part of the implementation is also working fine!</p>
<h4 id="making-late-night-mistakes" is="h4">Making late night mistakes</h4>
<p>At this point, it&#39;s rather amazing that the design and implementation has gone almost perfectly to plan...</p>
<p>So I tried testing a 6S LiPo battery as my &#39;field&#39; 24V source instead of my lab supply. I&#39;m sure a few of you reading are seeing where this is going.</p>
<p>The inrush spike resulted in the PSE board&#39;s onboard (unprotected) 7V LDO being sacrificed to the cause. Hindsight is 20/20 and immediate, so I cobbled together a simple resistor based soft-start circuit and filter from scrap parts to prevent any future mishaps.</p>
<p>Also, it was about this time when I noticed I had unfortunately placed the processor board mounting standoff about 1.05mm further than it&#39;s intended position. Not a big deal, but incredibly frustrating to see gap between screw and board edge.</p>
<h3 id="firmware" is="h3">Firmware</h3>
<p>With the electronics <em>mostly</em> working without issue, it was time to interface to the test sensors and send some packets.</p>
<p>The boards were designed without assuming any specific sensors would be used, but I used these I2C sensors:</p>
<ul>
<li>Temperature &amp; Humidity - <code>SHTC3</code> via <a href="https://www.sparkfun.com/products/16467" target="_blank" rel="noopener noreferrer">Sparkfun <code>SEN-16467</code></a></li>
<li>Motion - <code>LSM6DSO</code> via <a href="https://www.sparkfun.com/products/18020" target="_blank" rel="noopener noreferrer">Sparkfun <code>SEN-18020</code></a></li>
<li>Depth/Pressure - <code>MS5837</code> via <a href="https://bluerobotics.com/store/sensors-cameras/sensors/bar02-sensor-r1-rp/" target="_blank" rel="noopener noreferrer">BlueRobotics <code>Bar02</code></a></li>
</ul>
<p>The Sparkfun breakouts mount directly to the standoffs on the rear of the backplane board.</p>
<p>The <code>Bar02</code> comes with a JST-GH connector, so I re-terminated it with a JST-SH connector for consistency with the other boards and headers on the backplane PCB.</p>
<p>Attempting to avoid any more scope-creep, I opted to use the Arduino ecosystem instead of going bare-metal with my preferred STM32 or ESP32 toolchains. The promise of quick integration with pre-made libraries for the sensors, T1L transciever, and communications protocol was alluring.</p>
<p>The project is structured as a simple super-loop which runs some state-machines to handle polling sensors before packing data into packets for transfer over SPE.</p>
<h4 id="writing-a-ms5837-driver" is="h4">Writing a MS5837 Driver</h4>
<p>The very cool <code>MS5837-02</code> pressure sensor supports absurdly high precision (via oversampling) at rather high sample rates - starting with a base resolution of <code>0.11 mbar</code> at <code>1.5kHz</code> and <code>0.016 mbar</code> at <code>~60Hz</code>.</p>
<blockquote>
<p>Converting the pressure resolution into a more understandable unit puts the absurdity of this sensor into context:</p>
<p><code>0.016 mbar</code> equates to a depth change of roughly <code>0.16 millimeters</code> in sea water. <code>160 μm</code>!</p>
</blockquote>
<p>Unfortunately, the BlueRobotics Arduino driver only supports the maximum oversampling (<code>OSR = 8192</code>) setting and forces a 40ms blocking delay...</p>
<p>I implemented a generic C library to work with the <code>MS5837-02</code>, letting the integrating developer take back some control over configuration and sampling behaviour. This approach allows the library to be used with a simple state-machine or with RTOS style yields.</p>
<div><div><pre><code><span><p><span>// FreeRTOS example task</span></p><p><span>uint16_t</span><span> wait_us </span><span>=</span><span> </span><span>0</span><span>;</span></p><p><span>// Measurement request function returns a microsecond duration</span></p><p><span>// which we need to wait out before attempting to read the sample.</span></p><p><span>// Request a pressure reading</span></p><p><span>wait_us </span><span>=</span><span> </span><span>ms5837_start_conversion</span><span>(</span><span> </span><span>&amp;</span><span>sensor</span><span>,</span><span> SENSOR_PRESSURE</span><span>,</span><span> OSR_8192 </span><span>);</span></p><p><span>vTaskDelay</span><span>(</span><span> </span><span>pdMS_TO_TICKS</span><span>(</span><span>wait_us</span><span>/</span><span>1000</span><span>)</span><span> </span><span>);</span></p><p><span>ms5837_read_conversion</span><span>(</span><span> </span><span>&amp;</span><span>sensor</span><span> </span><span>);</span></p><p><span>// Request temperature reading</span></p><p><span>wait_us </span><span>=</span><span> </span><span>ms5837_start_conversion</span><span>(</span><span> </span><span>&amp;</span><span>sensor</span><span>,</span><span> SENSOR_TEMPERATURE</span><span>,</span><span> OSR_2048 </span><span>);</span></p><p><span>vTaskDelay</span><span>(</span><span> </span><span>pdMS_TO_TICKS</span><span>(</span><span>wait_us</span><span>/</span><span>1000</span><span>)</span><span> </span><span>);</span></p><p><span>ms5837_read_conversion</span><span>(</span><span> </span><span>&amp;</span><span>sensor</span><span> </span><span>);</span></p><p><span>// Once pressure and temp are sampled, run the conversion function</span></p><p><span>ms5837_calculate</span><span>(</span><span> </span><span>&amp;</span><span>sensor</span><span> </span><span>);</span></p><p><span>float</span><span> pressure </span><span>=</span><span> </span><span>ms5837_pressure_mbar</span><span>(</span><span> </span><span>&amp;</span><span>sensor</span><span> </span><span>);</span></p><p><span>float</span><span> temperature </span><span>=</span><span> </span><span>ms5837_temperature_celcius</span><span>(</span><span> </span><span>&amp;</span><span>sensor</span><span> </span><span>);</span></p></span></code></pre></div></div>
<p>While the temperature is needed for the 2nd order pressure compensation maths, I didn&#39;t see any downside from reducing the temperature oversampling slightly which also allows for quicker turnaround time.</p>
<p>My driver is a simple open-sourced and <a href="https://github.com/Scottapotamas/MS5837" target="_blank" rel="noopener noreferrer">available standalone on GitHub</a>.</p>
<h4 id="internal-sensors" is="h4">Internal Sensors</h4>
<p>The SHTC3 and LSM6DS0 Arduino libraries were better behaved, and I was able to throw together a reasonable implementation sampling the IMU&#39;s FIFO buffer reasonably easily.</p>
<h4 id="adin1110-serial-bridge" is="h4">ADIN1110 Serial Bridge</h4>
<p>At the start of the project I wanted to implement proper TCP/IP support via LwIP to connect the sensor node directly to a normal Ethernet network through a media converter, but the lack of integration examples and diminishing amount of time meant I knew I would run out of time during debugging. Maybe next time!</p>
<p>Building off Sparkfun&#39;s reasonably thin <code>sfe_spe_advanced</code> wrapper around Analog Device&#39;s library, I was able to send raw buffers of bytes between the transcievers with fairly minimal effort.</p>
<p>Because I&#39;m familiar with the protocol (and wrote the library) I was able to connect the <code>electricui-embedded</code> read and write callbacks, and setup the power-supply side MicroMod process to act as a nearly transparent SPE-to-Serial proxy.</p>
<blockquote>
<p>The fact that a 10 Mbps networked node was constrained by a 10x slower serial link (<code>912600 baud</code>) was slightly amusing, but will hopefully be an area I can address with a bit more time in the future.</p>
</blockquote>
<h3 id="user-interface" is="h3">User Interface</h3>
<p>I&#39;m using Electric UI&#39;s <a href="https://electricui.com/docs/interface/transformer">DataFlow and DataTransformer</a> system to calculate real-time wave height statistics on the stream of depth sensor data. Turns out wave analysis and meaningful visualisations are slightly non-trivial, so I&#39;ll probably write a second post going into greater depth.</p>
<p>As a quick overview:</p>
<ul>
<li>Filter the incoming pressure measurement stream to reduce noise,</li>
<li>Calculate the rate of depth change (derivative),</li>
<li>Detect peak and troughs, and the time between them,</li>
<li>Average the midpoint height of detected waves to create a long-running reference depth,</li>
<li>Generate a histogram to show wave behaviour relative to the reference depth.</li>
</ul>
<p>These statistics are data-loggable alongside the raw sensor streams.</p>
<span><span>
      <a href="https://electricui.com/static/5ecb68eb113236a756848b7f2c757396/b6db4/ui-screenshot.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/5ecb68eb113236a756848b7f2c757396/7bb4c/ui-screenshot.avif 225w,
/static/5ecb68eb113236a756848b7f2c757396/212f8/ui-screenshot.avif 450w,
/static/5ecb68eb113236a756848b7f2c757396/4d7a3/ui-screenshot.avif 900w,
/static/5ecb68eb113236a756848b7f2c757396/6f77c/ui-screenshot.avif 1350w,
/static/5ecb68eb113236a756848b7f2c757396/a848b/ui-screenshot.avif 1800w,
/static/5ecb68eb113236a756848b7f2c757396/1e8ce/ui-screenshot.avif 2231w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/5ecb68eb113236a756848b7f2c757396/7d522/ui-screenshot.webp 225w,
/static/5ecb68eb113236a756848b7f2c757396/b5115/ui-screenshot.webp 450w,
/static/5ecb68eb113236a756848b7f2c757396/5722e/ui-screenshot.webp 900w,
/static/5ecb68eb113236a756848b7f2c757396/c5b95/ui-screenshot.webp 1350w,
/static/5ecb68eb113236a756848b7f2c757396/8fb31/ui-screenshot.webp 1800w,
/static/5ecb68eb113236a756848b7f2c757396/7f057/ui-screenshot.webp 2231w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/5ecb68eb113236a756848b7f2c757396/1663a/ui-screenshot.png 225w,
/static/5ecb68eb113236a756848b7f2c757396/7f757/ui-screenshot.png 450w,
/static/5ecb68eb113236a756848b7f2c757396/7abe2/ui-screenshot.png 900w,
/static/5ecb68eb113236a756848b7f2c757396/5d6e7/ui-screenshot.png 1350w,
/static/5ecb68eb113236a756848b7f2c757396/7385a/ui-screenshot.png 1800w,
/static/5ecb68eb113236a756848b7f2c757396/b6db4/ui-screenshot.png 2231w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/5ecb68eb113236a756848b7f2c757396/7abe2/ui-screenshot.png" alt="ui-screenshot" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>Thanks to reasonably easy export from the CAD packages, we have a high quality 3D model of the tube and custom electronics just sitting there...</p>
<p>A quick trip through Blender to perform <em>Planar Decimation</em> helps bring the model complexity down from ~2M tris to a couple hundred thousand, and we export the file as a <code>gltf</code>.</p>
<span><span>
      <a href="https://electricui.com/static/3853961bf8bd43c5c3f922c4ea2e3c46/5c895/ui-blender-decimation.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/3853961bf8bd43c5c3f922c4ea2e3c46/7bb4c/ui-blender-decimation.avif 225w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/212f8/ui-blender-decimation.avif 450w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/4d7a3/ui-blender-decimation.avif 900w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/6f77c/ui-blender-decimation.avif 1350w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/83781/ui-blender-decimation.avif 1403w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/3853961bf8bd43c5c3f922c4ea2e3c46/7d522/ui-blender-decimation.webp 225w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/b5115/ui-blender-decimation.webp 450w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/5722e/ui-blender-decimation.webp 900w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/c5b95/ui-blender-decimation.webp 1350w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/37589/ui-blender-decimation.webp 1403w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/3853961bf8bd43c5c3f922c4ea2e3c46/1663a/ui-blender-decimation.png 225w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/7f757/ui-blender-decimation.png 450w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/7abe2/ui-blender-decimation.png 900w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/5d6e7/ui-blender-decimation.png 1350w,
/static/3853961bf8bd43c5c3f922c4ea2e3c46/5c895/ui-blender-decimation.png 1403w" sizes="(max-width: 900px) 100vw, 900px" type="image/png"/>
          <img src="https://electricui.com/static/3853961bf8bd43c5c3f922c4ea2e3c46/7abe2/ui-blender-decimation.png" alt="ui-blender-decimation" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>It&#39;s pretty easy to then import and use with ThreeJS.</p>
<h3 id="final-assembly" is="h3">Final Assembly</h3>
<p>With firmware running and the boards finished, it was time to mount the PoDL PD function board, ESP32 MicroMod processor, and internal sensor breakouts to the backplane board.</p>
<span><span>
      <a href="https://electricui.com/static/7a4b518c8e3f076480f38d4af4460b8c/69b48/assy-pcbs-in-hand.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/7a4b518c8e3f076480f38d4af4460b8c/7bb4c/assy-pcbs-in-hand.avif 225w,
/static/7a4b518c8e3f076480f38d4af4460b8c/212f8/assy-pcbs-in-hand.avif 450w,
/static/7a4b518c8e3f076480f38d4af4460b8c/4d7a3/assy-pcbs-in-hand.avif 900w,
/static/7a4b518c8e3f076480f38d4af4460b8c/6f77c/assy-pcbs-in-hand.avif 1350w,
/static/7a4b518c8e3f076480f38d4af4460b8c/a848b/assy-pcbs-in-hand.avif 1800w,
/static/7a4b518c8e3f076480f38d4af4460b8c/b16ce/assy-pcbs-in-hand.avif 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/7a4b518c8e3f076480f38d4af4460b8c/7d522/assy-pcbs-in-hand.webp 225w,
/static/7a4b518c8e3f076480f38d4af4460b8c/b5115/assy-pcbs-in-hand.webp 450w,
/static/7a4b518c8e3f076480f38d4af4460b8c/5722e/assy-pcbs-in-hand.webp 900w,
/static/7a4b518c8e3f076480f38d4af4460b8c/c5b95/assy-pcbs-in-hand.webp 1350w,
/static/7a4b518c8e3f076480f38d4af4460b8c/8fb31/assy-pcbs-in-hand.webp 1800w,
/static/7a4b518c8e3f076480f38d4af4460b8c/7e36f/assy-pcbs-in-hand.webp 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/7a4b518c8e3f076480f38d4af4460b8c/08b3c/assy-pcbs-in-hand.jpg 225w,
/static/7a4b518c8e3f076480f38d4af4460b8c/12ba2/assy-pcbs-in-hand.jpg 450w,
/static/7a4b518c8e3f076480f38d4af4460b8c/86440/assy-pcbs-in-hand.jpg 900w,
/static/7a4b518c8e3f076480f38d4af4460b8c/7e63a/assy-pcbs-in-hand.jpg 1350w,
/static/7a4b518c8e3f076480f38d4af4460b8c/96503/assy-pcbs-in-hand.jpg 1800w,
/static/7a4b518c8e3f076480f38d4af4460b8c/69b48/assy-pcbs-in-hand.jpg 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/7a4b518c8e3f076480f38d4af4460b8c/86440/assy-pcbs-in-hand.jpg" alt="assy-pcbs-in-hand" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>Also pictured is the <em>vanity</em> <code>APA102-2020</code> LED rings which were intended to act as an adjustable mock load to test the power delivery components.</p>
<p>The printed mount was then screwed to the aluminium cap, where I had already installed the 2-core tether cable and external sensors.</p>
<span><span>
      <a href="https://electricui.com/static/7f3d4caf7cccbec7da2b3348c3dca6f5/69b48/assy-backplane-install.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/7f3d4caf7cccbec7da2b3348c3dca6f5/7bb4c/assy-backplane-install.avif 225w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/212f8/assy-backplane-install.avif 450w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/4d7a3/assy-backplane-install.avif 900w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/6f77c/assy-backplane-install.avif 1350w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/a848b/assy-backplane-install.avif 1800w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/b16ce/assy-backplane-install.avif 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/7f3d4caf7cccbec7da2b3348c3dca6f5/7d522/assy-backplane-install.webp 225w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/b5115/assy-backplane-install.webp 450w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/5722e/assy-backplane-install.webp 900w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/c5b95/assy-backplane-install.webp 1350w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/8fb31/assy-backplane-install.webp 1800w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/7e36f/assy-backplane-install.webp 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/7f3d4caf7cccbec7da2b3348c3dca6f5/08b3c/assy-backplane-install.jpg 225w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/12ba2/assy-backplane-install.jpg 450w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/86440/assy-backplane-install.jpg 900w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/7e63a/assy-backplane-install.jpg 1350w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/96503/assy-backplane-install.jpg 1800w,
/static/7f3d4caf7cccbec7da2b3348c3dca6f5/69b48/assy-backplane-install.jpg 1920w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/7f3d4caf7cccbec7da2b3348c3dca6f5/86440/assy-backplane-install.jpg" alt="assy-backplane-install" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>After a bit of cable management, the assembly was suspended in the acrylic sleeve and the bottom cap carefully aligned to retain the backplane PCB.</p>
<span><span>
      <a href="https://electricui.com/static/b9ed6d6b12b88e5f3b238bef5b1aa881/109c0/assy-complete.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/b9ed6d6b12b88e5f3b238bef5b1aa881/7bb4c/assy-complete.avif 225w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/212f8/assy-complete.avif 450w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/4d7a3/assy-complete.avif 900w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/6f77c/assy-complete.avif 1350w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/a848b/assy-complete.avif 1800w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/ca01a/assy-complete.avif 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/b9ed6d6b12b88e5f3b238bef5b1aa881/7d522/assy-complete.webp 225w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/b5115/assy-complete.webp 450w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/5722e/assy-complete.webp 900w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/c5b95/assy-complete.webp 1350w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/8fb31/assy-complete.webp 1800w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/b1218/assy-complete.webp 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/b9ed6d6b12b88e5f3b238bef5b1aa881/08b3c/assy-complete.jpg 225w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/12ba2/assy-complete.jpg 450w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/86440/assy-complete.jpg 900w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/7e63a/assy-complete.jpg 1350w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/96503/assy-complete.jpg 1800w,
/static/b9ed6d6b12b88e5f3b238bef5b1aa881/109c0/assy-complete.jpg 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/b9ed6d6b12b88e5f3b238bef5b1aa881/86440/assy-complete.jpg" alt="assy-complete" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>Once assembled, I removed the pressure-relief valve stem and attached a vacuum pump to perform a leak test.</p>
<p>Overall, I&#39;m pretty happy with how everything turned out, just wished I had a bit more time for refinement!</p>
<h2 id="field-testing" is="h2">Field Testing</h2>
<p>We tested the tube in a pool briefly to check buoyancy. During the early mechanical design stages I created a simple spreadsheet to estimate the assembly mass and displacement from first-principles which suggested additional ballast weight was not needed (slightly negatively buoyant). In the real-world it was slightly positively buoyant and could use a bit of extra weight.</p>
<p>Being the natural over-achiever (and qualified diver) that he is, my colleague Michael suggested we should give it real-world test.</p>
<p>We drove down to a popular dive reef with good jetty access to test the sensor node.</p>
<span><span>
      <a href="https://electricui.com/static/3d3d304b384a4c7dd8dee69c3f1e14c6/109c0/test-jetty.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/3d3d304b384a4c7dd8dee69c3f1e14c6/7bb4c/test-jetty.avif 225w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/212f8/test-jetty.avif 450w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/4d7a3/test-jetty.avif 900w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/6f77c/test-jetty.avif 1350w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/a848b/test-jetty.avif 1800w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/ca01a/test-jetty.avif 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/3d3d304b384a4c7dd8dee69c3f1e14c6/7d522/test-jetty.webp 225w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/b5115/test-jetty.webp 450w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/5722e/test-jetty.webp 900w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/c5b95/test-jetty.webp 1350w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/8fb31/test-jetty.webp 1800w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/b1218/test-jetty.webp 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/3d3d304b384a4c7dd8dee69c3f1e14c6/08b3c/test-jetty.jpg 225w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/12ba2/test-jetty.jpg 450w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/86440/test-jetty.jpg 900w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/7e63a/test-jetty.jpg 1350w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/96503/test-jetty.jpg 1800w,
/static/3d3d304b384a4c7dd8dee69c3f1e14c6/109c0/test-jetty.jpg 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/3d3d304b384a4c7dd8dee69c3f1e14c6/86440/test-jetty.jpg" alt="test-jetty" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>By stitching some velcro lengths to each side of some printed mounting clamps, it provided a fairly easily removable and non-invasive mounting solution that could be handled underwater.</p>
<p>If the sensor node was deployed for longer periods of time, a more carefully designed mount would be necessary.</p>
<span><span>
      <a href="https://electricui.com/static/2f7066bfca131eaff31be7815b4b621c/109c0/test-diver.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/2f7066bfca131eaff31be7815b4b621c/7bb4c/test-diver.avif 225w,
/static/2f7066bfca131eaff31be7815b4b621c/212f8/test-diver.avif 450w,
/static/2f7066bfca131eaff31be7815b4b621c/4d7a3/test-diver.avif 900w,
/static/2f7066bfca131eaff31be7815b4b621c/6f77c/test-diver.avif 1350w,
/static/2f7066bfca131eaff31be7815b4b621c/a848b/test-diver.avif 1800w,
/static/2f7066bfca131eaff31be7815b4b621c/ca01a/test-diver.avif 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/2f7066bfca131eaff31be7815b4b621c/7d522/test-diver.webp 225w,
/static/2f7066bfca131eaff31be7815b4b621c/b5115/test-diver.webp 450w,
/static/2f7066bfca131eaff31be7815b4b621c/5722e/test-diver.webp 900w,
/static/2f7066bfca131eaff31be7815b4b621c/c5b95/test-diver.webp 1350w,
/static/2f7066bfca131eaff31be7815b4b621c/8fb31/test-diver.webp 1800w,
/static/2f7066bfca131eaff31be7815b4b621c/b1218/test-diver.webp 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/2f7066bfca131eaff31be7815b4b621c/08b3c/test-diver.jpg 225w,
/static/2f7066bfca131eaff31be7815b4b621c/12ba2/test-diver.jpg 450w,
/static/2f7066bfca131eaff31be7815b4b621c/86440/test-diver.jpg 900w,
/static/2f7066bfca131eaff31be7815b4b621c/7e63a/test-diver.jpg 1350w,
/static/2f7066bfca131eaff31be7815b4b621c/96503/test-diver.jpg 1800w,
/static/2f7066bfca131eaff31be7815b4b621c/109c0/test-diver.jpg 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/2f7066bfca131eaff31be7815b4b621c/86440/test-diver.jpg" alt="test-diver" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<span><span>
      <a href="https://electricui.com/static/f291f1f031bac5ff3de766cd519da3af/109c0/test-fish.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
          <source srcset="/static/f291f1f031bac5ff3de766cd519da3af/7bb4c/test-fish.avif 225w,
/static/f291f1f031bac5ff3de766cd519da3af/212f8/test-fish.avif 450w,
/static/f291f1f031bac5ff3de766cd519da3af/4d7a3/test-fish.avif 900w,
/static/f291f1f031bac5ff3de766cd519da3af/6f77c/test-fish.avif 1350w,
/static/f291f1f031bac5ff3de766cd519da3af/a848b/test-fish.avif 1800w,
/static/f291f1f031bac5ff3de766cd519da3af/ca01a/test-fish.avif 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/avif"/><source srcset="/static/f291f1f031bac5ff3de766cd519da3af/7d522/test-fish.webp 225w,
/static/f291f1f031bac5ff3de766cd519da3af/b5115/test-fish.webp 450w,
/static/f291f1f031bac5ff3de766cd519da3af/5722e/test-fish.webp 900w,
/static/f291f1f031bac5ff3de766cd519da3af/c5b95/test-fish.webp 1350w,
/static/f291f1f031bac5ff3de766cd519da3af/8fb31/test-fish.webp 1800w,
/static/f291f1f031bac5ff3de766cd519da3af/b1218/test-fish.webp 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/webp"/>
          <source srcset="/static/f291f1f031bac5ff3de766cd519da3af/08b3c/test-fish.jpg 225w,
/static/f291f1f031bac5ff3de766cd519da3af/12ba2/test-fish.jpg 450w,
/static/f291f1f031bac5ff3de766cd519da3af/86440/test-fish.jpg 900w,
/static/f291f1f031bac5ff3de766cd519da3af/7e63a/test-fish.jpg 1350w,
/static/f291f1f031bac5ff3de766cd519da3af/96503/test-fish.jpg 1800w,
/static/f291f1f031bac5ff3de766cd519da3af/109c0/test-fish.jpg 2000w" sizes="(max-width: 900px) 100vw, 900px" type="image/jpeg"/>
          <img src="https://electricui.com/static/f291f1f031bac5ff3de766cd519da3af/86440/test-fish.jpg" alt="test-fish" title="" loading="lazy" decoding="async"/>
        </picture>
  </a>
    </span></span>
<p>I think we got the tick of approval from the locals.</p>
<h2 id="useful-resources--thanks" is="h2">Useful Resources &amp; Thanks</h2>
<p>Firstly, thanks to Jack &amp; Brittany for accompanying us during the test dive. It wouldn&#39;t have gone as smoothly without you!</p>
<p>Thanks to Michael for doing such a great job documenting the assembly and test.</p>
<p>On the design side, I found these manufacturer app notes helpful:</p>
<ul>
<li><a href="https://www.ti.com/lit/an/snla395/snla395.pdf" target="_blank" rel="noopener noreferrer">TI SNLA395 - How to Implement an IEEE 802.3cg or 802.3bu-Compliant
PoDL PSE</a></li>
<li><a href="https://www.ti.com/lit/an/snvaa25a/snvaa25a.pdf" target="_blank" rel="noopener noreferrer">TI SNVAA25A - 10BASE-T1L Power over Data Lines
Powered Device Design</a></li>
<li><a href="https://product.tdk.com/en/techlibrary/applicationnote/single-pair-ethernet.html" target="_blank" rel="noopener noreferrer">TDK - How to implement 10Base-T1L</a></li>
</ul></main></div></div></div>
  </body>
</html>
