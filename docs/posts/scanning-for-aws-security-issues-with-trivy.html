<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://lia.mg/posts/trivy-aws/">Original</a>
    <h1>Scanning for AWS Security Issues with Trivy</h1>
    
    <div id="readability-page-1" class="page"><div><h2 id="what-is-trivy"><span>What is Trivy?</span><a href="#what-is-trivy"><i></i></a></h2><p><a href="https://github.com/aquasecurity/trivy">Trivy</a> is a multifunctional, open-source security scanner. It can scan various targets (filesystems, containers, git repositories and more) in order to discover security issues (vulnerabilities, misconfigurations, and secrets). In short, Trivy can find a bunch of different types of security issue in pretty much anything you point it at, for free.</p><h2 id="scanning-aws"><span>Scanning AWS</span><a href="#scanning-aws"><i></i></a></h2><p>As of this week, <a href="https://github.com/aquasecurity/trivy/discussions/2716">Trivy v0.31.0</a> allows you to scan AWS accounts for security issues. You can either run the CLI locally or integrate it into your CI/CD pipeline.</p><p>The rules applied to AWS are all the misconfiguration rules built into Trivy for IaC scanning. This means the rules are consistent across platforms and, as a bonus, can be used to find the causes of AWS issues when infrastructure is defined with Terraform or CloudFormation.</p><p>Whilst you can already scan the infrastructure-as-code that defines your AWS resources with <code>trivy config</code>, you can now scan your live AWS account(s) directly too.</p><h2 id="getting-started"><span>Getting Started</span><a href="#getting-started"><i></i></a></h2><p>Trivy uses the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">same authentication methods</a> as the AWS CLI to configure and authenticate your access to the AWS platform. This means if you already use the AWS CLI, you should be able to run Trivy against your AWS account without any extra configuration - just point and shoot! Otherwise, you‚Äôll need to <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">configure Trivy to use your AWS credentials</a>.</p><p>We recommend you use a user/role with the <code>ReadOnlyAccess</code> policy attached.</p><p>Kicking off a scan is as simple as:</p><div><p><code><table><tbody><tr><td><pre>1
</pre></td><td><pre>trivy aws <span>--region</span> us-east-1
</pre></td></tr></tbody></table></code></p></div><p>You can even omit the <code>--region</code> flag if you have a default region configured in your AWS environment vars or config file.</p><h2 id="reviewing-results"><span>Reviewing Results</span><a href="#reviewing-results"><i></i></a></h2><p>Once the scan is complete, you‚Äôll get an overview in your terminal which should look like this:</p><p><img data-src="/assets/img/posts/trivy-aws/overview.png" alt="trivy aws scan results" data-proofer-ignore=""/></p><p>This summarises the number of results - by severity - for each AWS service scanned.</p><p>You can run additional commands to filter the results without having to run the entire scan again - results are cached locally per AWS account/region.</p><p>To ‚Äúzoom in‚Äù on results for a particular service, you can use the <code>--service</code> flag:</p><div><p><code><table><tbody><tr><td><pre>1
</pre></td><td><pre>trivy aws <span>--region</span> us-east-1 <span>--service</span> s3
</pre></td></tr></tbody></table></code></p></div><p>This will give you a summary of the selected service, with the number of issues - again by severity - for each resource within the service. Note that only resources with detected security issues are shown here.</p><p>Here‚Äôs an example:</p><p><img data-src="/assets/img/posts/trivy-aws/service.png" alt="s3 results example" data-proofer-ignore=""/></p><p>You can show the individual issues for a resource by using the <code>--arn</code> flag, for example:</p><div><p><code><table><tbody><tr><td><pre>1
</pre></td><td><pre>trivy aws <span>--service</span> s3 <span>--arn</span> arn:aws:s3:::example-bucket
</pre></td></tr></tbody></table></code></p></div><p>This will result in output like the following:</p><p><img data-src="/assets/img/posts/trivy-aws/resource.png" alt="s3 bucket results example" data-proofer-ignore=""/></p><p>Each result contains a severity, a summary, and further information on the issue, with a link to the relevant AVD documentation which includes various guides on resolving the problem.</p><h2 id="summary"><span>Summary</span><a href="#summary"><i></i></a></h2><p>In summary, Trivy can now scan AWS accounts for security issues, with all the capabilities of its existing community-enhanced misconfiguration checks.</p><p>We have lots of exciting plans for Trivy. Become part of the journey by <a href="https://slack.aquasec.com">joining our Slack</a> community and <a href="https://github.com/aquasecurity/trivy">contributing on GitHub</a>. Also, let us know if you have questions or if there are other features you‚Äôd like to see in Trivy.</p><p>And when you try the new Trivy features, share it on social media! üôå</p></div><div><div><p> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</p></div></div></div>
  </body>
</html>
