<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="http://www.pixelbeat.org/programming/shell_script_mistakes.html">Original</a>
    <h1>Common shell script mistakes (2008)</h1>
    
    <div id="readability-page-1" class="page"><div id="content">
                <div><p>
I&#39;ve written a few <a href="http://www.pixelbeat.org/scripts/">shell scripts</a> in my time
and have read many more, and I see the same issues cropping up again and again
(unfortunately even in my own scripts sometimes).

</p><p>While there are lots of shell programming <a href="http://mywiki.wooledge.org/BashPitfalls">pitfalls</a>,
at least the interpreter will tell you immediately about them.
The mistakes I describe below, generally mean that your script will run fine now,
but if the data changes or you move your script to another system, then you may have problems.</p>

<p>I think some of the reason shell scripts tend to have lots of issues
is that commonly one doesn&#39;t learn shell scripting like &#34;traditional&#34; programming languages.
Instead scripts tend to evolve from existing interactive command line use, or are based on
existing scripts which themselves have propagated the limitations of ancient
shell script interpreters.</p>

<p>It&#39;s definitely worth spending the relatively small amount of time required
to <a href="http://tldp.org/LDP/abs/html/">learn</a> the shell script language correctly,
if one uses linux/BSD/Mac OS X desktops or servers, where it is commonly used.</p>

<h2>Inappropriate use</h2><p>
shell is the main <i>domain specific language</i> designed to manipulate
the UNIX abstractions for data and logic, i.e. <a href="http://www.pixelbeat.org/talks/linux_and_python/page12.html">files and processes</a>.
So as well as being useful at the command line, its use permeates any UNIX system.
Correspondingly, please be wary of writing scripts that deviate from these abstractions,
and have significant data manipulation in the shell process itself.
While flexible, shell is not designed as a general purpose language and
becomes unwieldly when not leveraging the various <a href="http://www.pixelbeat.org/docs/unix_commands/">UNIX tools</a> effectively.
A good knowlegde of the various UNIX tools goes hand in hand with effective shell programming.

</p><h2>Stylistic issues</h2><p>
First I&#39;ll mention some ways to clean up shell scripts without changing their functionality.
Note I use a shortcut form of the conditional operator below (and in my shell scripts),
when doing <i>simple</i> conditional operations, as it&#39;s much more concise.
So I use </p><SPAN>[ &#34;$var&#34; = &#34;find&#34; ] &amp;&amp; echo &#34;found&#34;</SPAN><p> instead of the equivalent:
</p><pre>if [ &#34;$var&#34; = &#34;find&#34; ]; then
  echo &#34;found&#34;
fi
</pre><p>

It&#39;s better to use the longer <i>&#34;if&#34;</i> form though, if running multiple
commands based on the condition, because if you use `set -e` in your script
to exit immediately upon unexpected command failure, then using
</p><SPAN>[ &#34;$var&#34; ] &amp;&amp; cmd1 &amp;&amp; cmd2 &amp;&amp; last</SPAN><p>
would only exit if <i>&#34;last&#34;</i> fails.

</p><h3> [ x&#34;$var&#34; = x&#34;find&#34; ] &amp;&amp; echo found</h3><p>
The use of x&#34;$var&#34; was required in case var is &#34;&#34; or &#34;-hyphen&#34;.
Thinking about this for a moment should indicate that the
shell can handle both of these cases unambiguously, and if it doesn&#39;t it&#39;s a bug.
This bug was probably fixed about 20 years ago, so stop propagating this nonsense please!
Shell doesn&#39;t have the cleanest syntax to start with, so polluting it
with stuff like this is horrible.

</p><h3>[ ! -z &#34;$var&#34; ] &amp;&amp; echo &#34;var not empty&#34;</h3><p>
This is a double negative, and is very prevalent in shell scripts for some reason.</p><!-- google_ad_section_start(weight=ignore) -->
        

        
        
<!-- google_ad_section_end -->

                </div>
</div></div>
  </body>
</html>
