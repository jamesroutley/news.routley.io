<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://bugs.ruby-lang.org/issues/18481">Original</a>
    <h1>Ruby: Porting YJIT to Rust</h1>
    
    <div id="readability-page-1" class="page"><div id="journal-95912-notes"><p>Eregon (Benoit Daloze) wrote in <a href="#note-1">#note-1</a>:</p>

<blockquote>
<p>Would it make sense to automatically download a Rust toolchain when building with YJIT?</p>
</blockquote>

<p>I don&#39;t think so. Trying to download during a build will result in problems for many packagers.  Ruby doesn&#39;t try to download during build for any of the other dependencies it has, and it makes no sense to start doing so now, IMO.</p>

<blockquote>
<p>I assume the Rust code would need a specific version of Rust (newer versions might work but not always, backward compat is not eternal) and so it&#39;d probably need a fixed version to be sure it builds.</p>
</blockquote>

<p>Rust is supposed to be fairly backwards compatible for the last few years.  As long as the YJIT team commits to supporting a Rust version that was released more than 12 months ago (say Rust 1.50), and continues to support that version going forward (as Ruby continues to support C99), I don&#39;t expect this to be a significant issue.  However, that should be a hard requirement, we would want to avoid version creep where each new version of Ruby requires a newer version of Rust to build YJIT. If the YJIT team does not think that is feasible, to me that would be a sign that Rust is not yet mature enough for Ruby to rely on.</p>

<blockquote>
<p>In other words, I think it would be nice when building CRuby if it could just download the Rust toolchain it needs, and not require everyone building CRuby to have the right version of Rust, which is likely non-trivial especially for people not familiar at all with Rust.</p>
</blockquote>

<p>If Ruby does this, it should only even attempt to do if it is sure in advance that such a toolchain exists for the platform (binary downloads only).  It doesn&#39;t makes sense to download and compile Rust itself, considering Rust takes much much longer to build than Ruby.  I still think that is a bad idea, but at least it doesn&#39;t hurt platforms that don&#39;t have a such a toolchain built for them.</p>

<blockquote>
<p>This would also avoid Ruby installers like ruby-install/ruby-build/RVM/etc to have to add new dependencies, which sounds difficult for e.g. older OS and their package managers which might not have a recent Rust available.</p>

<p>There could still be a configure option to use an existing Rust toolchain, or automatically detect if the right version is installed.</p>
</blockquote>

<p>Or a configure option to opt-in to such toolchain downloading, which IMO would be the best way to support such automated downloading (if we want to support it at all).</p>

<blockquote>
<p>As an alternative, building CRuby (without disabling YJIT) and without the right Rust installed could output instructions for how to install Rust. But this would be much less convenient.</p>
</blockquote>

<p>I agree that outputing instructions and stopping the build is a bad idea.  </p>

<p>I think Rust should be treated like OpenSSL. If you build Ruby without OpenSSL, Ruby doesn&#39;t download OpenSSL for you, it just doesn&#39;t build the openssl extension.  Similarly, if you build Ruby without Rust, Ruby just won&#39;t build yjit.  That seems like the simplest and best way to handle things, IMO.  After all, yjit is a purely optional part of Ruby, and use of yjit should be transparent, modulo performance.</p>
</div></div>
  </body>
</html>
