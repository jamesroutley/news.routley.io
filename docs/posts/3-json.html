<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://rgbcu.be/blog/3-json/">Original</a>
    <h1>3-JSON</h1>
    
    <div id="readability-page-1" class="page"><div>
  <p>From the
<a href="https://oldmanprogrammer.net/source.php?dir=projects/tree/CHANGES"><code>tree(1)</code> release notes</a>,
version 2.0.0:</p>
<blockquote>
<ul>
<li>Output un-indented JSON on file descriptor 3 (&#34;stddata&#34;) automatically if
file descriptor 3 is present (currently Linux only.) Maybe switch to BSON.</li>
</ul>
</blockquote>
<p>Surely, nothing will happen if I just assume that the existence of a specific
file descriptor implies something, as nobody is crazy or stupid enough to
hardcode such a thing? <strong><em>&lt;insert sounds of cars crashing in the
background&gt;</em></strong></p>
<p>Oops (from the <code>tree</code>version 2.0.2 release notes):</p>
<blockquote>
<ul>
<li>Okay, apparently the stddata addition is causing havoc (who knew how many
scripts just haphazardly hand programs random file descriptors, that&#39;s
surely not a problem.) Going forward the stddata option will only work if
the environment variable STDDATA_FD is present or set to the descriptor to
produce the JSON output on.</li>
</ul>
</blockquote>
<p>Assuming anything about the users environment is and will always be a mistake.
But it&#39;s still cool we can have <code>tree</code> output structured data using
<code>STDDATA_FD</code>:</p>
<div><pre><code>&gt; STDDATA_FD=<span>1</span> tree

<span>[</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;directory&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;.&#34;</span><span>,</span><span>&#34;contents&#34;</span><span>:</span><span>[</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2024-01-01-test.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2024-03-04-htmnix.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2024-04-02-cosmic-drift.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2024-04-15-nix-iceberg.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2024-05-20-swap-i.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2024-09-30-gitignore.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2025-06-05-why-cores.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2025-06-09-nginix.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2025-06-20-intro-cab.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2025-07-04-derive-broken.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;2025-07-20-no-gnulib.md&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;file&#34;</span><span>,</span><span>&#34;name&#34;</span><span>:</span><span>&#34;_data.ts&#34;</span><span>}</span><span>]</span><span>}</span><span>,</span><span>{</span><span>&#34;type&#34;</span><span>:</span><span>&#34;report&#34;</span><span>,</span><span>&#34;directories&#34;</span><span>:</span><span>1</span><span>,</span><span>&#34;files&#34;</span><span>:</span><span>12</span><span>}</span><span>]</span>
</code></pre></div>
<p>Also, obligatory <a href="https://nushell.sh/">nushell</a> mention (using the <code>markdown</code>
table style because for some reason the fancy characters don&#39;t render properly
with my webfont):</p>
<div><pre><code>&gt; STDDATA_FD=1 tree | from json

|-#-|---<span>type</span>----|-name-|------------------contents-------------------|-directories-|-files-|
| 0 | directory | .    | |-#--|-<span>type</span>-|------------name-------------| |    nope     | nope  |
|   |           |      | |  0 | file | 2024-01-01-test.md          | |             |       |
|   |           |      | |  1 | file | 2024-03-04-htmnix.md        | |             |       |
|   |           |      | |  2 | file | 2024-04-02-cosmic-drift.md  | |             |       |
|   |           |      | |  3 | file | 2024-04-15-nix-iceberg.md   | |             |       |
|   |           |      | |  4 | file | 2024-05-20-swap-i.md        | |             |       |
|   |           |      | |  5 | file | 2024-09-30-gitignore.md     | |             |       |
|   |           |      | |  6 | file | 2025-06-05-why-cores.md     | |             |       |
|   |           |      | |  7 | file | 2025-06-09-nginix.md        | |             |       |
|   |           |      | |  8 | file | 2025-06-20-intro-cab.md     | |             |       |
|   |           |      | |  9 | file | 2025-07-04-derive-broken.md | |             |       |
|   |           |      | | 10 | file | 2025-07-20-no-gnulib.md     | |             |       |
|   |           |      | | 11 | file | _data.ts                    | |             |       |
| 1 | report    | nope |                    nope                     |           1 |    12 |
</code></pre></div>


  
</div></div>
  </body>
</html>
