<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://spencer.wtf/2026/02/20/cleaning-up-merged-git-branches-a-one-liner-from-the-cias-leaked-dev-docs.html">Original</a>
    <h1>I found a useful Git one liner buried in leaked CIA developer docs</h1>
    
    <div id="readability-page-1" class="page"><article>
    <p>In 2017, WikiLeaks published Vault7 - a large cache of CIA hacking tools and internal documents. Buried among the exploits and surveillance tools was something far more mundane: <a href="https://wikileaks.org/ciav7p1/cms/page_1179773.html">a page of internal developer documentation with git tips and tricks</a>.</p>

<p>Most of it is fairly standard stuff, amending commits, stashing changes, using bisect. But one tip has lived in my <code>~/.zshrc</code> ever since.</p>

<h2 id="the-problem">The Problem</h2>

<p>Over time, a local git repo accumulates stale branches. Every feature branch, hotfix, and experiment you’ve ever merged sits there doing nothing. <code>git branch</code> starts to look like a graveyard.</p>

<p>You can list merged branches with:</p>

<pre><code>git branch --merged
</code></pre>

<p>But deleting them one by one is tedious. The CIA’s dev team has a cleaner solution:</p>

<h2 id="the-original-command">The original command</h2>

<pre><code>git branch --merged | grep -v &#34;\*\|master&#34; | xargs -n 1 git branch -d
</code></pre>

<p>How it works:</p>

<ul>
  <li><code>git branch --merged</code> — lists all local branches that have already been merged into the current branch</li>
  <li><code>grep -v &#34;\*\|master&#34;</code> — filters out the current branch (<code>*</code>) and <code>master</code> so you don’t delete either</li>
  <li><code>xargs -n 1 git branch -d</code> — deletes each remaining branch one at a time, safely (lowercase <code>-d</code> won’t touch unmerged branches)</li>
</ul>

<h2 id="the-updated-command">The updated command</h2>

<p>Since most projects now use <code>main</code> instead of <code>master</code>, you can update the command and exclude any other branches you frequently use:</p>

<pre><code>git branch --merged origin/main | grep -vE &#34;^\s*(\*|main|develop)&#34; | xargs -n 1 git branch -d
</code></pre>

<p>Run this from <code>main</code> after a deployment and your branch list goes from 40 entries back down to a handful.</p>

<p>I keep this as a git alias so I don’t have to remember the syntax:</p>

<pre><code>alias ciaclean=&#39;git branch --merged origin/main | grep -vE &#34;^\s*(\*|main|develop)&#34; | xargs -n 1 git branch -d&#39;
</code></pre>

<p>Then in your repo just run:</p>

<pre><code>ciaclean
</code></pre>

<p>Small thing, but one of those commands that quietly saves a few minutes every week and keeps me organised.</p>

  </article><div>
  <header>
    <h2>Thanks for reading</h2>
    <p>You can follow me here for my latest thoughts and projects</p>
  </header>
  
</div></div>
  </body>
</html>
