<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://nicole.express/2022/games-made-in-a-cave.html">Original</a>
    <h1>A Last Gasp of 2D: The Cave CV1000</h1>
    
    <div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>Two-dimensional video game hardware is often considered a solved problem. Things like hardware sprites and tilemaps are basically gone; everything is done in software. Anything past that is done with 3d accelerators that work on entirely different principles. So let’s today take a look at a machine at the very end of the 2d period. And maybe also see why a straightforward platform still vexes emulator developers today. Bonus: A cool game!</p>

<h2 id="the-cave-cv1000">The Cave CV1000</h2>

<p><img src="https://nicole.express/assets/img/evac/overview.JPEG" title="it&#39;s a small PCB, which is nice" alt="The CV1000 PCB"/></p>

<p>CAVE Co. Ltd., niche manufacturer of shoot-em-ups, has shown up before on this blog; they made some of the last and best titles for the <a href="https://nicole.express/2022/polly-want-a-game-master.html">IGS PolyGame Master</a>. But that system was, even in the early 2000’s, a relic. To keep up today, CAVE needed something newer. And due to their niche market, CAVE needed something more powerful but also cheaper to manufacture. This is, as far as I can tell, the only arcade platform they developed completely in house: the CV-1000, often just called the CAVE SH-3 hardware, whose first title, <em>Mushihimesama</em>, was released in October of 2004.</p>

<p><img src="https://nicole.express/assets/img/evac/sh3.JPEG" title="this system is the zen point between the saturn and dreamcast. based off of nothing more than the SuperH number. other than that they have nothing in common." alt="The SH3 CPU"/></p>

<p>The system is powered by a 133 MHz SH-3 CPU, a predecessor of the SH-4 used in the Dreamcast and <a href="https://nicole.express/2021/sega-sammy-atomiswave.html">Atomiswave</a>, so nothing cutting-edge for 2004.</p>

<p><img src="https://nicole.express/assets/img/evac/ymz.JPEG" title="nicole you&#39;ve given away your serial number you fool the ghosts will get you" alt="The YMZ770 sound chip"/></p>

<p>And the sound chip is a YMZ770, which belongs to the same family as the YMZ774 in the IGS PGM2. Here, it’s used in a mono configuration. It’s worth noting that much like the IGS PGM2, the system is still JAMMA, even in an era where JVS was definitely becoming more dominant. Among other things, this means that it also features the sound amplifier on-board.</p>

<p><img src="https://nicole.express/assets/img/evac/cyclone.JPEG" title="windy around here isn&#39;t it" alt="The Altera Cyclone FPGA chip on the board"/></p>

<p>The video hardware is implemented on this FPGA. It’s actually a bit lower resolution than the PolyGame Master; the same number of scanlines, but fewer pixels per scanline. (But as we saw, the PGM actually has very narrow pixels) And an interesting thing about this platform is that it’s designed from the ground up for CAVE’s 2D, bullet-heavy shooters– only one title, <em>Puzzle! Mushihime<s>sama</s>tama</em> didn’t fall in that genre.</p>

<h3 id="but-first-the-jtag">But first, the JTAG</h3>

<p>Here’s a small aside. You might have noticed the system is covered in ports. For the most part, you don’t need to care about these to play the game; just plug in the JAMMA connector. That’s what JAMMA is for. But what’s, say, P4?</p>

<p><img src="https://nicole.express/assets/img/evac/jtag.jpg" title="port of call" alt="A port labeled P4"/></p>

<p>P4 is a JTAG connector. If you’re brave enough to do some wiring, you can attach this to a USB blaster and read or write to several of the flash memory chips onboard. Don’t think of this as an easy way to convert to other games, though:</p>

<ol>
  <li>The chips containing the sound data aren’t accessible over JTAG.</li>
  <li>The process is agonizingly slow– 3 days to read out or write the entire U2 graphics ROM. Any interruption could break the process.</li>
  <li>Of course, if your game has bad blocks on its U2 chip, you’ll need to manually remap the bad blocks for your new game.</li>
</ol>

<p>I don’t think CAVE ever intended an end user to use this capability. But if you want to mess with it, GitHub user buffis has made some Python scripts to help with the process <a href="https://github.com/buffis/cv1k_research/tree/main/JTAG">here</a>. Don’t ask me for help– I’m too much of a coward.</p>

<h2 id="the-blitter">The blitter</h2>

<p>The video hardware of the CV1000 is a framebuffer setup. What this means is that there’s a place in video memory that corresponds to the screen pixels, and editing them edits what’s shown on screen. I don’t even know what the first machine to use a setup like this is; on consoles, it’s the <a href="https://nicole.express/2021/the-most-unfair-child.html">Channel F</a>, the first console to use interchangeable cartridges and a CPU. It was rare and noteworthy then; but not now.</p>

<p>The CAVE platform is all 15-bit RGB, 5 bits for each color, and 1 reserved for an alpha transparency. You can in fact extract this data directly; it’s stored in the U2 flash memory chip. Here’s some graphics I extracted; notice that there is a major difference with things like the IGS PolyGame Master and other older tile-based systems: nothing is paletted. These colors are part of the data, so there’s no limit on the number of colors per sprite, or anything like that.</p>

<p><img src="https://nicole.express/assets/img/evac/boxes.png" title="lmnop, on its own-- I think this may be unused?" alt="Some letters with colors"/></p>



<p>On the CAVE hardware, unlike the Channel F, the framebuffer isn’t all you get. Instead, there’s something called a <strong>blitter</strong>, implemented on the FPGA.</p>

<p>CAVE definitely didn’t invent the blitter– the term dates back to the 1975 Xerox Alto’s “bit blit” function. A blitter is basically a specialized form of block memory copy. The <a href="https://nicole.express/2020/personal-computer-engine.html">PC Engine</a> has block memory transfer operations, and the <a href="https://nicole.express/2020/why-do-you-need-an-arcade-card.html">Arcade Card</a> works because those blocks can be efficiently copied to video RAM. But nobody calls that a blitter– because the PC Engine is tile-based. The blitter is designed for <em>framebuffers</em>, dealing with the particulars of screen video layout and transparency.</p>

<p><img src="https://nicole.express/assets/img/inter&amp;lace/amiblob.jpg" title="my mouse can&#39;t keep up with the commodore" alt="A straight line in the Amiga UI gets a jog in it because of bad deinterlacing"/></p>

<p>Probably the retro system best known for use of a blitter is Commodore’s Amiga computer. The Amiga had eight hardware sprites, but to have additional moving elements on screen, you could use what Amiga programmers call “BOBs”, <strong>b</strong>litter <strong>ob</strong>jects. The Amiga blitter could copy images into graphics memory. But you could also include a “mask”; areas where each pixel corresponds with a <code>0</code> in a mask aren’t copied. You can use these to build additional sprites on screen, but you have to handle clearing the background behind them as they move (oftentimes by redrawing the screen each frame), unlike hardware sprites, where you can move them “for free”.</p>



<p>BOBs on the Amiga deserves a post of its own, but this isn’t it. This is about the CAVE SH-3 platform, and here, <em>everything</em> is a BOB. Plus, transparency isn’t mask-based, instead it uses the last bit. The <a href="https://github.com/mamedev/mame/blob/master/src/devices/video/epic12.cpp">MAME</a> source code documents the draw command, which blits a source area to a destination. Notice that these are squares of arbitrary size; this is just copying memory from one place to another. But because the designers of the copy device knew it’d be used for graphics, they were able to a lot of options that do some math on those bytes first.</p>

<div><div><pre><code>Draw command
This command draws gfx data.
Offset Bits              Description
       fedcba98 76543210
00     0001---- -------- 0x1 for draw
       ----x--- -------- Flip X
       -----x-- -------- Flip Y
       ------x- -------- Enable Blending
       -------x -------- Enable Transparent
       -------- -xxx---- Source Blending mode
       -------- -----xxx Destination Blending mode
02     xxxxxxxx -------- Source Alpha value
       -------- xxxxxxxx Destination Alpha value
04     ---xxxxx xxxxxxxx Source X start position
06     ----xxxx xxxxxxxx Source Y start position
08     sxxxxxxx xxxxxxxx Destination X start position
0a     sxxxxxxx xxxxxxxx Destination Y start position
0c     ---xxxxx xxxxxxxx Source Width
0e     ----xxxx xxxxxxxx Source Height
10     -------- xxxxxxxx Source Red multiplication (0x80 = 100%)
12     xxxxxxxx -------- Source Green multiplication (0x80 = 100%)
       -------- xxxxxxxx Source Blue multiplication (0x80 = 100%)
</code></pre></div></div>

<p>Too complicated to understand these options through text? Well, just boot up today’s showcase game, <em>Ibara</em>, and enter the service menu’s OBJECT TEST. There, you can modify some of these in action on an example image. For example, here I’ve set the green multiplication to zero, making the source look purple.</p>

<p><img src="https://nicole.express/assets/img/evac/est.jpg" title="this is kind of a pain to navigate" alt="A very busy object test screen. A large block of copied memory is purple."/></p>

<p>Notice the sheer number of options here; while each byte is either transparent or not (if transparency is enabled), each block copy has 8-bit alpha transparency, allowing some nice mixing effects. While scaling doesn’t appear to be implemented in hardware, since this is RAM, the program can always implement that in software. The CAVE SH-3 platform is a very modern platform, taking advantage of its fast FPGA and CPU to handle everything in a way faster that hardware sprites could do.</p>



<h3 id="and-thats-the-catch">And that’s the catch</h3>

<p>Let’s take a platform with hardware sprites and DMA, the Nintendo Entertainment System (NES). On the NES, hardware sprites are generally configured by creating a table in the 2kiB word RAM, and then during VBLANK, uploading that entire table to memory in a <a href="https://www.nesdev.org/wiki/PPU_registers#OAM_DMA_($4014)_%3E_write">DMA pass</a>, which takes 513-4 cycles. Notice that nothing there actually depends on the amount of sprites you use. This is typical for hardware sprites. Slowdown on the NES has nothing to do with how many sprites you’re using, except that more sprites <em>probably</em> means your game logic is doing more.</p>

<p>But a blitter object is something that takes CPU time and blitter copy time for each individual BOB. This means that blitter-based systems are inherently more prone to slowdown than sprite-based systems. And, surprisingly, that’s not such a bad thing.</p>

<p><img src="https://nicole.express/assets/img/evac/dying.jpg" title="yes my ship is mid-exploding, what of it" alt="A boss with many large bullets on screen"/></p>

<p>This hardware was used almost exclusively for “bullet hell” shooters, known, logically enough, for the huge amounts of bullets that can be on-screen at a given time. This is considered <a href="https://www.nesdev.org/wiki/Limitations#Bullet_hell_shooter">poorly suited</a> for hardware sprite-based systems like the NES due to strict limits on the numbers of sprites, but those huge numbers of bullets are also going to slow down the game even with a blazingly fast SH-3 CPU.</p>

<p>Why isn’t that so bad? It will slow down the game when there is a lot going on screen; this is exactly the time that the player will want the game to slow down. Hardware limitations give you a bullet time effect, and one that you never actually need to code for deliberately. As long as you’re just the right amount of inefficient, at least.</p>

<p><img src="https://nicole.express/assets/img/evac/err.png" title="WARNING: This game is emulated imperfectly. Plus, a huge battleship is approaching fast!" alt="MAME error message. Improperly emulated features: timing"/></p>

<p>But what’s easier for the game developer is harder for the emulator developer. See, timing is tricky. Timing on a blitter implemented on a commodity FPGA (with a number of variants) and a relatively rare CPU (the MAME implementation is actually based off of the Dreamcast’s SH-4), all on a circuit board that is very expensive and not easy to run your own code on? It’s definitely not impossible. But it’s a lot of tricky work that requires a very dedicated developer with expensive equipment (the clocks on this system run fast compared to, say, the Super Nintendo) and particular skills. Until then, you’ll see this warning.</p>

<p>And it’s not just MAME. The PlayStation 2 port of <em>Ibara</em>, the only time that particular game made it out of the arcades, is known for having little to no slowdown compared to the arcade version. This makes the game much more difficult.</p>

<h2 id="the-game-ibara">The game: <em>Ibara</em></h2>

<p>So the CAVE SH-3 hardware is straightforward on its surface, but surprisingly complex in the fine details. That’s also a description of the game I have on it.</p>

<p><img src="https://nicole.express/assets/img/evac/title.jpg" title="eBara" alt="Ibara title screen"/></p>

<p><em>Ibara</em>, released to Japanese arcades in 2005, has an interesting history.</p>



<p>Its lead developer is Shinobu Yagawa, and this is his first game for CAVE: he came from prior work at Raizing/Eighting, and before that worked as a Famicom developer at <a href="https://gdri.smspower.org/wiki/index.php/KID">KID</a>, where he developed the legendary <em>Summer Carnival ‘92: Recca</em>.</p>

<p><img src="https://nicole.express/assets/img/evac/recca.jpg" title="This game looks way better in motion" alt="Recca gameplay"/></p>

<p><em>Ibara</em> isn’t very much like <em>Recca</em>, though– for that, you’ll want its sequel, <em>Pink Sweets: Ibara Sorekara</em>. <em>Ibara</em> takes after a title from Yagawa’s Raizing era, <em>Battle Garegga</em>. <em>Garegga</em> is one of those shooters that is downright legendary among enthusiasts, but has less visibility outside of them. Such is life in a niche genre.</p>

<p><img src="https://nicole.express/assets/img/evac/garg.png" title="Battle Greg" alt="Battle Garegga title screen"/></p>

<p><em>Ibara</em>, according to <a href="http://www.hardcoregaming101.net/ibara/">legend</a>, originates from CAVE founder Tsuneki Ikeda meeting with Shinobu Yagawa with a simple offer: make <em>Garegga</em>, but at CAVE. And that’s what <em>Ibara</em> is. It has the looks and music of a CAVE shooter, and in this era, that means beautiful prerendered art, and anime girls a-plenty. It also means colorful bullets that stand out across the background.</p>

<p><img src="https://nicole.express/assets/img/evac/teresa.jpg" title="Is &#39;Teresa&#39; an exotic name" alt="Dr Teresa in the Rose Garden"/></p>

<p>But in terms of <em>gameplay</em>, it’s much more <em>Garegga</em> than <em>Dodonpachi</em>. Starting the game you can hold buttons to change your character’s attributes (only two characters here, linked to 1P and 2P sides). A scoring system based off of chaining medals dropped by enemies to get higher values, but letting a medal fall break the chain. All of these systems are also completely unexplained. There’s also a surprisingly generous extra life system; an “extend” is granted every million points. And that also means rank.</p>

<p>A rank system is a dynamic difficulty system; in addition to the level layouts, the game becomes harder the better you are at it. It judges this by the powerups you collect, how often you shoot, and the longer you live without dying. <em>Battle Garegga</em> didn’t invent the concept, but it’s very aggressive here, the game can become nearly impossible. A skilled player needs to understand the rank system; and the only way to go down in rank is to die. Watch a <a href="https://www.youtube.com/watch?v=Bswv7nO9sa0">1cc run</a>, and you’ll see constant suicides– not a good strategy in most shooters!</p>



<p>It’s probably not a game for everyone, but in 2005, shoot ‘em ups weren’t for everyone. They had a dedicated fanbase. A fanbase dedicated enough to buy PCB sets like this at home. And Yagawa was nice enough to include some features for them.</p>

<h2 id="special-mode">Special mode</h2>

<p>So arcade PCBs are generally expected to be purchased by arcade operators, not game players. And that means businessmen, businessmen or repair folks who may not even be that good at the games they put on location. But I believe the supergun hobby actually started in the Japanese shoot-em-up fanbase, or at least, that was an early place for its popularity. CAVE’s PCB sets were definitely being bought by fans in 2005. And Shinobu Yagawa left them a gift.</p>

<p>Flip the DIP switch 2, and then hold down the “A” and “B” buttons while pressing the “TEST button”. If you did it right, you’ll see “special ver.” now listed in the test menu.</p>

<p><img src="https://nicole.express/assets/img/evac/spec-ops.png" title="I wish I was special" alt="TEST MODE special ver."/></p>

<p>The test mode of the <em>Ibara</em> PCB is fun enough to mess with as-is, as I showed with the object test above. But here let’s go into the GAME MODE. Right away, you’ll see a difference– the CAVE logo also features a build date, in lovely readable white-on-white text.</p>

<p><img src="https://nicole.express/assets/img/evac/ver.png" title="I wonder how many versions of Ibara are out there" alt="harware ver.20040303 00"/></p>

<p>Let’s look at the game demo.</p>

<p><img src="https://nicole.express/assets/img/evac/hiscore.png" title="fun fact: the battery on the board powers a real time clock, used for that rose clock" alt="Gameplay. There is a row of @ signs cut off at the bottom, and a number next to R at the top."/></p>

<p>Notice the row of green @ signs at the bottom of the screen. I believe, though I’m not sure, that this is a CPU usage meter. When it maxes out is when you’d start to see slowdown. At the top of the screen, the high score alternates with this version, a display of the rank. As noted, the rank is actually a large number that is constantly decreasing. Being able to see the rank is invaluable to higher-level play.</p>

<p>And if you had any doubts that this was for enthusiasts, not arcade operators?</p>

<p><img src="https://nicole.express/assets/img/evac/pause.png" title="not to be confused with PAWS" alt="Very beginning of Ibara. A pause text is shown."/></p>

<p>It adds the ability to pause in-game. No arcade operator would stand for <em>that</em>.</p>

<h2 id="markets-are-fickle">Markets are fickle</h2>

<p>So, all this adds up pretty well, right? The developers of <em>Mushihimesama</em> and <em>Battle Garegga</em> join forces to create a game with the art of the former and the complexity of the latter. A lot of nice bonuses are added for enthusiasts, which is not as common to see in CAVE games that Yagawa wasn’t involved on. A recipe for huge success?</p>

<p>Well… no. <em>Ibara</em> wasn’t what CAVE fans had been waiting to see, as it played much more like a Raizing shmup. To recoup their investment, CAVE retooled the game, releasing in February 2006 <em>Ibara Kuro: Black Label</em>. (It succeeded an “Arrange” mode in the PlayStation 2 port that introduced some of its ideas)</p>



<p><img src="https://nicole.express/assets/img/evac/blk-title.png" title="that extra character in the title screen, 黒, is &#39;kuro&#39; and just means &#39;black&#39;" alt="Ibara Kuro black label title screen"/></p>

<p><em>Ibara Kuro</em> essentially moves <em>Ibara</em> to be more in line with a CAVE shooter. For example, you now pick the ship you start with from a menu rather than knowing what buttons to press.</p>

<p><img src="https://nicole.express/assets/img/evac/blk-ship.png" title="this doesn&#39;t exist in regular Ibara" alt="Ibara Kuro black label ship select screen."/></p>

<p>The game itself is also quite a bit different. You can see these right away once the game starts.</p>

<p><img src="https://nicole.express/assets/img/evac/blk-ui.png" title="how am I out of lives already" alt="Ibara Kuro gameplay, featuring a weapons bar at the bottom and a rank indicator"/></p>

<p>You can see a weapons bar at the bottom, which lets you choose between the option upgrades you’ve collected on the fly. The weapons work differently; <em>Ibara</em> was a 2-button game. <em>Ibara Kuro</em> is a 4-button, as the main weapon works a bit more like the laser/shot system in <em>Dodonpachi</em>. Items can fly towards your ship when you’re close as well.</p>

<table>
  <thead>
    <tr>
      <th>Button</th>
      <th><em>Ibara</em></th>
      <th><em>Ibara Kuro</em></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1 (tap)</td>
      <td>Fire</td>
      <td>Fire rapid shot</td>
    </tr>
    <tr>
      <td>1 (hold)</td>
      <td>Autofire</td>
      <td>Fire sustained shot, move slower</td>
    </tr>
    <tr>
      <td>2 (tap)</td>
      <td>Bomb</td>
      <td>Bomb</td>
    </tr>
    <tr>
      <td>2 (hold)</td>
      <td>Hado-cannon</td>
      <td>Hado-cannon</td>
    </tr>
    <tr>
      <td>3</td>
      <td> </td>
      <td>Autofire (rapid shot)</td>
    </tr>
    <tr>
      <td>4</td>
      <td> </td>
      <td>Switch option configuration</td>
    </tr>
  </tbody>
</table>

<p>You’ll also notice a rank indicator. But the rank works completely different; the rank can swing dramatically, and it’s possible to lower the rank by maxing out rank for a bonus, or by collecting roses. But it can also get a lot higher faster.</p>

<p><img src="https://nicole.express/assets/img/evac/blk-bullets.png" title="now that&#39;s a bullet hell" alt="Ibara Kuro gameplay, huge numbers of bullets in stage 1"/></p>

<p>And after <em>Ibara Kuro</em>, Yagawa’s next CAVE titles would no longer attempt the <em>Battle Garegga</em>-style gameplay, though some elements, like medals and rank systems would continue to exist.</p>

<h2 id="the-pc-always-wins">The PC always wins</h2>

<p><em>Ibara</em> was the second game released for the CV1000 platform, and followed the same configuration as the first, <em>Mushihimesama</em>, known as CV1000-B. Quite a few games were released on this; until 2008, when the CV1000-D upgrade was released for <em>Deathsmiles Mega Black Label</em>, which doubled the total video RAM. This was used until the last CV1000 titles, <em>Akai Katana</em> and <em>Dodonpachi Saidaioujou</em>.</p>



<p>And what do they use today? Well, uh, not much– 2012’s <em>Dodonpachi Saidaioujou</em> was their last unique shooter. But 2009’s <em>Deathsmiles II</em> was released for a unique PC-based platform. <em>Akai Katana</em> made it to the PC-based Type-X (as <em>Akai Katana Shin</em>) and Exa-Arcadia (as <em>Crimson Katana Exa Label</em>) platforms; <em>Saidaioujou</em> also came to the latter (as <em>Dodonpachi True Death Exa Label</em>). Is the CAVE SH-3 platform cool? Yes, I think so. The PC may always win, but do you have a <a href="https://www.heartcade.com/product/cave-pcb-enclosure-cv1000-cavewich">cool laser-cut case</a> for <em>your</em> PC?</p>

<p><img src="https://nicole.express/assets/img/evac/case.JPEG" title="The JAMMA edge extender is necessary for my supergun but does ruin the look a little" alt="the CAVE CV-1000 PCB now safely enveloped on top and bottom but not the sides by resin"/></p>

<p>I mean I guess technically nothing says you couldn’t make a laser-cut acrylic case for a PC…</p>

  </div>

  
</article>

      </div>
    </div></div>
  </body>
</html>
