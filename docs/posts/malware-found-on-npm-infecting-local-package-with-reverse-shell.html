<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.reversinglabs.com/blog/malicious-npm-patch-delivers-reverse-shell">Original</a>
    <h1>Malware found on NPM infecting local package with reverse shell</h1>
    
    <div id="readability-page-1" class="page"><div>

<p id="hs_cos_wrapper_module_1577203992502740" data-hs-cos-general-type="widget" data-hs-cos-type="module">
<h2>For the first time, RL researchers discover malicious locally-installed npm packages infecting other legitimate packages.</h2>
</p>
</div><div>
<p><span id="hs_cos_wrapper_post_body" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p><img src="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=1400&amp;height=732&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp" width="1400" height="732" loading="lazy" alt="Malicious-npm-patch-delivers-reverse-shell" srcset="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=700&amp;height=366&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp 700w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=1400&amp;height=732&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp 1400w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=2100&amp;height=1098&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp 2100w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=2800&amp;height=1464&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp 2800w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=3500&amp;height=1830&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp 3500w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=4200&amp;height=2196&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp 4200w" sizes="(max-width: 1400px) 100vw, 1400px"/>Unlike some other public repositories, the npm package repository is never really quiet. And, while there has been <a href="https://www.reversinglabs.com/blog/the-changing-face-of-open-source-security" rel="noopener">some decline in malware numbers between 2023 and 2024</a>, this year&#39;s numbers don’t seem to continue that downward trend. Still, while RL has detected some interesting npm malware so far this year, none of it warranted a detailed writeup.</p>
<!--more-->
<h2><em>ethers-provider2</em> delivers the malware</h2>
<p>The package <em>ethers-provider2 </em>was still available on npm at the time of publication. The package mirrors another, legitimate and widely-used npm package, <em>ssh2</em>, which has more than 350 million downloads and more than 1,600 dependent applications. The <em>ethers-provider2</em> package contains the <em>ssh2</em> source code, adding some malicious elements to it. So the whole package functions exactly how the <em>ssh2</em> package would — with something extra.</p>
<a href="https://blog.reversinglabs.com/hubfs/Blog/Malicious-npm-patch-figure_1.png"><img src="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_1.png?width=1400&amp;name=Malicious-npm-patch-figure_1.png" alt="ReversingLabs" width="1400" srcset="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_1.png?width=700&amp;name=Malicious-npm-patch-figure_1.png 700w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_1.png?width=1400&amp;name=Malicious-npm-patch-figure_1.png 1400w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_1.png?width=2100&amp;name=Malicious-npm-patch-figure_1.png 2100w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_1.png?width=2800&amp;name=Malicious-npm-patch-figure_1.png 2800w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_1.png?width=3500&amp;name=Malicious-npm-patch-figure_1.png 3500w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_1.png?width=4200&amp;name=Malicious-npm-patch-figure_1.png 4200w" sizes="(max-width: 1400px) 100vw, 1400px"/></a>
<p>Figure 1: ethers-provider2’s second stage</p>
<p>The second-stage malware also creates a file, <em>loader.js</em>, which writes code with the same functionality as the malicious code used to “patch” the ethers’ file, and then runs it.</p>
<a href="https://blog.reversinglabs.com/hubfs/Blog/Malicious-npm-patch-figure_2.png"><img src="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_2.png?width=1400&amp;name=Malicious-npm-patch-figure_2.png" alt="ReversingLabs" width="1400" srcset="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_2.png?width=700&amp;name=Malicious-npm-patch-figure_2.png 700w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_2.png?width=1400&amp;name=Malicious-npm-patch-figure_2.png 1400w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_2.png?width=2100&amp;name=Malicious-npm-patch-figure_2.png 2100w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_2.png?width=2800&amp;name=Malicious-npm-patch-figure_2.png 2800w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_2.png?width=3500&amp;name=Malicious-npm-patch-figure_2.png 3500w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_2.png?width=4200&amp;name=Malicious-npm-patch-figure_2.png 4200w" sizes="(max-width: 1400px) 100vw, 1400px"/></a>
<p>Figure 2: Reverse shell opened towards threat actors’ server</p>
<h2>Discussion</h2>
<p>While not as common as infostealers on the npm platform, downloaders are far from uncommon and are frequently encountered. However, this downloader is notable because of the exceptional strategies employed by the attackers to hide the malicious payload it delivered. These evasive techniques were more thorough and effective than we have observed in npm-based downloaders before. </p>
<h2>I am (not) throwin’ away my shot</h2>
<p>The other package belonging to the same campaign, <em>ethers-providerz </em>had only three versions, and the last two were very similar to <em>ethers-provider2</em>; whereas the first one <em>1.16.0</em> looked more like a test version, with some parts that didn&#39;t work as the threat actor probably intended.</p>
<p>Which npm package was targeted for patching is speculative at this point, because the path to each file was written incorrectly, with the threat actor defining the scope, but not providing the name of the intended package.</p>
<a href="https://blog.reversinglabs.com/hubfs/Blog/Malicious-npm-patch-figure_3.png"><img src="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_3.png?width=1400&amp;name=Malicious-npm-patch-figure_3.png" alt="ReversingLabs" width="1400" srcset="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_3.png?width=700&amp;name=Malicious-npm-patch-figure_3.png 700w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_3.png?width=1400&amp;name=Malicious-npm-patch-figure_3.png 1400w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_3.png?width=2100&amp;name=Malicious-npm-patch-figure_3.png 2100w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_3.png?width=2800&amp;name=Malicious-npm-patch-figure_3.png 2800w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_3.png?width=3500&amp;name=Malicious-npm-patch-figure_3.png 3500w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_3.png?width=4200&amp;name=Malicious-npm-patch-figure_3.png 4200w" sizes="(max-width: 1400px) 100vw, 1400px"/></a>
<p>Figure 3: Malicious payload inside install.js script</p>
<p>The RL research team also observed the malicious payload creating a malicious file, <em>loader.js</em>, in the folder <em>node_modules</em>, and executing it. The <em>node_modules</em> folder is where npm packages are stored by default once they are installed. The file <em>loader.js</em> downloads the second stage from <em>hxxp[:]//5[.]199[.]166[.]1[:]31337/config</em>.</p>
<h2>RL YARA rule helps detect <em>ethers</em></h2>
<p>Detection of the malicious packages <em>ethers-provider2</em> and <em>ethers-providerz</em> was the easy part. They had very low download counts and contained non-obfuscated malicious code downloading the second stage inside the install script. RL’s Spectra platform finds obfuscated or non-obfuscated — and clearly malicious code — lurking in install scripts by identifying behaviors and characteristics when scanning both open- source and commercial, closed-source binaries.  </p>
<a href="https://blog.reversinglabs.com/hubfs/Blog/Malicious-npm-patch-figure_4.png"><img src="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_4.png?width=1400&amp;name=Malicious-npm-patch-figure_4.png" alt="ReversingLabs" width="1400" srcset="https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_4.png?width=700&amp;name=Malicious-npm-patch-figure_4.png 700w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_4.png?width=1400&amp;name=Malicious-npm-patch-figure_4.png 1400w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_4.png?width=2100&amp;name=Malicious-npm-patch-figure_4.png 2100w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_4.png?width=2800&amp;name=Malicious-npm-patch-figure_4.png 2800w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_4.png?width=3500&amp;name=Malicious-npm-patch-figure_4.png 3500w, https://www.reversinglabs.com/hs-fs/hubfs/Blog/Malicious-npm-patch-figure_4.png?width=4200&amp;name=Malicious-npm-patch-figure_4.png 4200w" sizes="(max-width: 1400px) 100vw, 1400px"/></a>
<p>Figure 4: Malicious part of the “patched” file</p>
<h2>YARA Rule</h2>
<p><em><span>rule npm_Downloader_InjectedMaliciousCode</span></em></p>
<h2>Even more packages?</h2>
<p>After this research was done, new packages were found that appear to be connected to this campaign: <em>reproduction-hardhat</em> and <em>@theoretical123/providers</em>. The former was a simple reverse shell that would connect to the IP address <em>5[.]199[.]166[.]1</em>, and the latter was a package downloading a second stage from <em>hxxp[:]//5[.]199[.]166[.]1[:]31337/config</em> and impersonating a legitimate npm package <em>@ethersproject/providers</em>. Both have been removed from npm.</p>
<h2>Conclusion</h2>
<p>As RL noted in its <a href="https://www.reversinglabs.com/sscs-report" rel="noopener">2025 Software Supply Chain Security Report</a>, the scope of software supply chain risks is growing for both software producers and end-user organizations. While there was a drop in instances of malware discovered on open-source repositories like npm and PyPI in 2024, threat actors have not lost interest in promoting malicious packages to open-source developers. </p>
<h2>Indicators of Compromise (IOCs)</h2>
<p>Indicators of Compromise (IoCs) refer to forensic artifacts or evidence related to a security breach or unauthorized activity on a computer network or system. IOCs play a crucial role in cybersecurity investigations and cyber incident response efforts, helping analysts and cybersecurity professionals identify and detect potential security incidents.</p>

<h2><span>Second-stage payload</span></h2>
<div data-hs-responsive-table="true">
<table>
<tbody>
<tr>
<td><span><strong>SHA1</strong></span></td>
</tr>
<tr>
<td>hxxp[:]//5[.]199[.]166[.]1[:]31337/install</td>
</tr>
</tbody>
</table>
</div>
<h2><span>Third-stage payload</span></h2>
<div data-hs-responsive-table="true">
<table>
<tbody>
<tr>
<td><span><strong>SHA1</strong></span></td>
</tr>
<tr>
<td>hxxp[:]//5[.]199[.]166[.]1[:]31337/config</td>
</tr>
</tbody>
</table>
</div>
</span></p>


</div><div> 
<article>
<a href="https://www.reversinglabs.com/blog/malicious-npm-patch-delivers-reverse-shell">
<img src="https://3375217.fs1.hubspotusercontent-na1.net/hub/3375217/hubfs/Blog/Malicious-npm-patch-delivers-reverse-shell.webp?width=480&amp;name=Malicious-npm-patch-delivers-reverse-shell.webp" alt="Malware found on npm infecting local package with reverse shell"/>
</a>
<div>
<h3><a href="https://www.reversinglabs.com/blog/malicious-npm-patch-delivers-reverse-shell">Malware found on npm infecting local package with reverse shell</a></h3>
<p>
For the first time, RL researchers discover malicious locally-installed npm packages infecting other legitimate packages.
</p>
<p><a href="https://www.reversinglabs.com/blog/malicious-npm-patch-delivers-reverse-shell">Read More</a>
</p></div>
</article>
<article>
<a href="https://www.reversinglabs.com/blog/crypto-gets-a-target-on-its-back">
<img src="https://3375217.fs1.hubspotusercontent-na1.net/hub/3375217/hubfs/target-back-crypto-attacks.jpg?width=480&amp;name=target-back-crypto-attacks.jpg" alt="Crypto malware attacks: 23 supply chain incidents set off alarms"/>
</a>
<div>
<h3><a href="https://www.reversinglabs.com/blog/crypto-gets-a-target-on-its-back">Crypto malware attacks: 23 supply chain incidents set off alarms</a></h3>
<p>
Target on back-alert: Open source was increasingly exploited in attacks on cryptocurrency infrastructure and apps in 2024. 
</p>
<p><a href="https://www.reversinglabs.com/blog/crypto-gets-a-target-on-its-back">Read More</a>
</p></div>
</article>
<article>
<a href="https://www.reversinglabs.com/blog/ciso-survey-6-lessons-for-tpcrm">
<img src="https://3375217.fs1.hubspotusercontent-na1.net/hub/3375217/hubfs/tpcrm-risk-ciso-survey.jpg?width=480&amp;name=tpcrm-risk-ciso-survey.jpg" alt="CISO survey: 6 lessons to boost third-party cyber-risk management"/>
</a>
<div>
<h3><a href="https://www.reversinglabs.com/blog/ciso-survey-6-lessons-for-tpcrm">CISO survey: 6 lessons to boost third-party cyber-risk management</a></h3>
<p>
Risk is rising across the software supply chain while visibility remains low, making TPCRM challenging. Here&#39;s what you need to know.
</p>
<p><a href="https://www.reversinglabs.com/blog/ciso-survey-6-lessons-for-tpcrm">Read More</a>
</p></div>
</article>
</div></div>
  </body>
</html>
