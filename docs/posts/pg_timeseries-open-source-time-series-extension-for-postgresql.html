<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://tembo.io/blog/pg-timeseries">Original</a>
    <h1>pg_timeseries: Open-source time-series extension for PostgreSQL</h1>
    
    <div id="readability-page-1" class="page"><div>  <p>We are excited to launch <code>pg_timeseries</code>: a PostgreSQL extension focused on creating a cohesive user experience around the creation, maintenance, and use of time-series tables. You can now use pg_timeseries to create time-series tables, configure the compression and retention of older data, monitor time-series partitions, and run complex time-series analytics functions with a user-friendly syntax. pg_timeseries is <a href="https://github.com/tembo-io/pg_timeseries">open-sourced</a> under the PostgreSQL license and can be added to your existing PostgreSQL installation or tried as a part of the <a href="https://tembo.io/docs/product/stacks/analytical/timeseries">Timeseries Stack</a> on <a href="https://cloud.tembo.io/">Tembo Cloud</a>.</p>

<p>Put simply, time-series data is a collection of data points, each with a timestamp attached. These could be stock prices recorded throughout a trading day, temperature and availability data returned from devices and sensors, or web traffic on a website. Time-series workloads typically include queries filtering by time (generally for some degree of recency) and aggregation queries to summarize the data for analytics.</p>
<p><img src="https://tembo.io/_astro/ts-wiki.6MOvJoCu_ZGpQ8A.webp" alt="time-series" title="time-series" width="601" height="447" loading="lazy" decoding="async"/></p>
<h2 id="using-postgresql-for-time-series-workloads">Using PostgreSQL for Time-series workloads</h2>
<p>We believe that PostgreSQL can be used to <a href="https://tembo.io/blog/tembo-manifesto">power any data workload</a> thanks to its extensions and ecosystem tools. Therefore, at Tembo, we aim to make it easy for users to <a href="https://tembo.io/blog/ga">use the entire PostgreSQL ecosystem</a> to reduce the complexity of the modern data stack.</p>
<p>In the last year, we’ve built several <a href="https://tembo.io/docs/product/stacks/intro-to-stacks">stacks</a> and extensions that help you run <a href="https://tembo.io/docs/product/stacks/analytical/data-warehouse">analytics</a>, <a href="https://tembo.io/docs/product/stacks/ai/vectordb">AI</a>, and <a href="https://tembo.io/docs/product/stacks/transactional/oltp">operational</a> workloads on PostgreSQL. However, our customers’ most requested stack has been one able to store and act upon their time-series data. That way, they can store all of their data with a single PostgreSQL provider who can meet all their needs.</p>
<p>You may already be asking: “why not just power the stack using <a href="https://github.com/timescale/timescaledb">TimescaleDB</a>?” The Timescale License would restrict our use of features such as compression, incremental materialized views, and bottomless storage. With these missing, we felt that what remained would not provide an adequate basis for our customers’ time-series needs. Therefore, we decided to build our own PostgreSQL-licensed extension.</p>
<h2 id="building-blocks-for-pg_timeseries">Building blocks for pg_timeseries</h2>
<p>To efficiently store and query time-series data, there are a few requirements:</p>
<ul>
<li>Easily manage time-series data</li>
<li>Deal with high-throughput ingest</li>
<li>Answer range queries fast</li>
<li>Efficiently store large amounts of data</li>
<li>Run complex analytics functions</li>
</ul>
<p>PostgreSQL has several features that provide the right building blocks to solve these requirements. Features such as <a href="https://www.postgresql.org/docs/current/ddl-partitioning.html">native partitioning</a>, variety of <a href="https://www.postgresql.org/docs/current/indexes.html">indexes</a>, <a href="https://www.postgresql.org/docs/current/rules-materializedviews.html">materialized views</a>, and <a href="https://www.postgresql.org/docs/current/tutorial-window.html">window / analytics functions</a> provide the main functionality. Several extensions add additional features to PostgreSQL to make it even better: <a href="https://github.com/pgpartman/pg_partman">pg_partman</a> for partition management, <a href="https://github.com/citusdata/pg_cron">pg_cron</a> for scheduling jobs, <a href="https://github.com/hydradatabase/hydra/tree/main/columnar">columnar</a> for compression, <a href="https://github.com/sraoss/pg_ivm">pg_ivm</a> for incremental materialized views, and <a href="https://github.com/tembo-io/pg_tier">pg_tier</a> for long-term offloading of older partitions.</p>
<p>Making all of these components work together cohesively is a tall order, and is hard for most users. pg_timeseries aims to solve this problem.</p>
<h2 id="pg_timeseries-the-simplest-way-to-manage-your-time-series-data-in-postgresql">pg_timeseries: The simplest way to manage your time-series data in PostgreSQL</h2>
<p>pg_timeseries combines the functionality of extensions such as pg_partman, pg_cron, and Hydra’s columnar in order to provide a unified and intuitive interface for managing and querying time-series tables. The PostgreSQL ecosystem has contained many approaches to various aspects of time-series workloads for years and pg_timeseries does the work of making sure all PostgreSQL users experience how these tools work together to make time-series workloads a cinch.</p>
<p>All pg_timeseries requires to get started is a table with a time-like column, partitioned on that column. After that, simply call <a href="https://github.com/tembo-io/pg_timeseries/blob/main/doc/reference.md#enable_ts_table">enable_ts_table</a>:</p>
<pre tabindex="0"><code><span><span>    CREATE TABLE measurements (</span></span>
<span><span>      metric_name text,</span></span>
<span><span>      metric_value numeric,</span></span>
<span><span>      metric_time timestamptz NOT NULL</span></span>
<span><span>    ) PARTITION BY RANGE (metric_time);</span></span>
<span><span></span></span>
<span><span>    SELECT enable_ts_table(&#39;measurements&#39;);</span></span></code></pre>
<p>The extension includes various views such as <a href="https://github.com/tembo-io/pg_timeseries/blob/main/doc/reference.md#ts_table_info">ts_table_info</a> and <a href="https://github.com/tembo-io/pg_timeseries/blob/main/doc/reference.md#ts_part_info">ts_part_info</a> to surface important information about your tables and partitions:</p>
<pre tabindex="0"><code><span><span>    SELECT table_id, table_size_bytes FROM ts_table_info;</span></span>
<span><span></span></span>
<span><span>    ┌──────────────┬──────────────────┐</span></span>
<span><span>    │   table_id   │ table_size_bytes │</span></span>
<span><span>    ├──────────────┼──────────────────┤</span></span>
<span><span>    │ measurements │            98304 │</span></span>
<span><span>    └──────────────┴──────────────────┘</span></span>
<span><span></span></span>
<span><span>	SELECT * FROM ts_part_info;</span></span>
<span><span></span></span>
<span><span>    ┌─[ RECORD 1 ]─────┬───────────────────────────────┐</span></span>
<span><span>    │ table_id         │ measurements                  │</span></span>
<span><span>    │ part_id          │ measurements_p20240411        │</span></span>
<span><span>    │ part_range       │ FOR VALUES FROM (&#39;2024-04-11 …│</span></span>
<span><span>    │                  │…00:00:00+00&#39;) TO (&#39;2024-04-18…│</span></span>
<span><span>    │                  │… 00:00:00+00&#39;)                │</span></span>
<span><span>    │ table_size_bytes │ 8192                          │</span></span>
<span><span>    │ access_method    │ heap                          │</span></span>
<span><span>    ├─[ RECORD 2 ]─────┼───────────────────────────────┤</span></span>
<span><span>    │ table_id         │ measurements                  │</span></span>
<span><span>    │ part_id          │ measurements_p20240418        │</span></span>
<span><span>    │ part_range       │ FOR VALUES FROM (&#39;2024-04-18 …│</span></span>
<span><span>    │                  │…00:00:00+00&#39;) TO (&#39;2024-04-25…│</span></span>
<span><span>    │                  │… 00:00:00+00&#39;)                │</span></span>
<span><span>    │ table_size_bytes │ 8192                          │</span></span>
<span><span>    │ access_method    │ heap                          │</span></span>
<span><span>    └──────────────────┴───────────────────────────────┘</span></span></code></pre>
<p>As partitions “age out” of your time-series tables, you can choose whether to have them compressed using columnar storage, deleted entirely, or both. For example, the following will cause partitions to be compressed if their data is older than 90 days, and will drop them entirely after one year:</p>
<pre tabindex="0"><code><span><span>    SELECT set_ts_compression_policy(&#39;measurements&#39;, &#39;90 days&#39;);</span></span>
<span><span>    SELECT set_ts_retention_policy(&#39;measurements&#39;, &#39;365 days&#39;);</span></span></code></pre>
<p>Finally, pg_timeseries includes additional functions like <a href="https://github.com/tembo-io/pg_timeseries/blob/main/doc/reference.md#locf">locf</a>, <a href="https://github.com/tembo-io/pg_timeseries/blob/main/doc/reference.md#firstlast">last</a> and <a href="https://github.com/tembo-io/pg_timeseries/blob/main/doc/reference.md#date_bin_table">date_bin_table</a> to make writing time-series queries easier. We know SQL can sometimes be hard to wrangle into doing what you want with time-series data, so these functions were written to enhance query maintainability. For instance, the following will bin data in the specified range by hour and fill any missing hours with the previous reading. It also includes the name of the metric in each hour with the highest reading:</p>
<pre tabindex="0"><code><span><span>    SELECT</span></span>
<span><span>      locf(avg(metric_value)) OVER (ORDER BY metric_time) avg_val,</span></span>
<span><span>      last(metric_name, metric_value) highest,</span></span>
<span><span>      metric_time</span></span>
<span><span>    FROM date_bin_table(NULL::measurements, &#39;1 hour&#39;, &#39;[2024-05-09,2024-06-07]&#39;)</span></span>
<span><span></span></span>
<span><span>    ┌──────────┬─────────┬────────────────────────┐</span></span>
<span><span>    │  avg_val │ highest │      metric_time       │</span></span>
<span><span>    ├──────────┼─────────┼────────────────────────┤</span></span>
<span><span>    │        ∅ │       ∅ │ 2024-05-09 15:00:00+00 │</span></span>
<span><span>    │     3.00 │       3 │ 2024-05-09 16:00:00+00 │</span></span>
<span><span>    │    55.00 │    temp │ 2024-05-09 17:00:00+00 │</span></span>
<span><span>    │    55.00 │    temp │ 2024-05-09 18:00:00+00 │</span></span>
<span><span>    │    17.00 │     cpu │ 2024-05-09 19:00:00+00 │</span></span>
<span><span>    │    17.00 │     cpu │ 2024-05-09 20:00:00+00 │</span></span>
<span><span>    │    23.00 │    disk │ 2024-05-09 21:00:00+00 │</span></span>
<span><span>    │    23.00 │    disk │ 2024-05-09 22:00:00+00 │</span></span>
<span><span>    │    84.00 │    eth0 │ 2024-05-09 23:00:00+00 │</span></span>
<span><span>    │    49.00 │    eth1 │ 2024-05-10 00:00:00+00 │</span></span>
<span><span>    │    49.00 │    eth1 │ 2024-05-10 01:00:00+00 │</span></span>
<span><span>    └──────────┴─────────┴────────────────────────┘</span></span></code></pre>
<h2 id="were-just-getting-started">We’re just getting started</h2>
<p>We know building a full-featured time-series extension for PostgreSQL requires a lot of pieces. However, we’re committed to building them in the open, with the community. The current roadmap includes the following features:</p>
<ul>
<li>Offloading older partitions to cold storage such as S3</li>
<li>Approximate functions for efficient analytics</li>
<li>Incremental materialized views</li>
<li>Roll-up and roll-off of older partitions</li>
<li>Additional analytics helper functions</li>
</ul>
<p>The entire planned roadmap is present on the <a href="https://github.com/tembo-io/pg_timeseries/tree/main?tab=readme-ov-file#roadmap">GitHub README</a> and features will be prioritized based on demand from users. Our next addition is going to be plugging in <a href="https://github.com/tembo-io/pg_tier">pg_tier</a> with pg_timeseries to allow offloading older tables to cold storage such as S3.</p>
<p>The simplest way to try out pg_timeseries is spinning up a free instance of the Timeseries stack on Tembo Cloud. We look forward to your feedback!</p>  </div></div>
  </body>
</html>
