<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://pauley.me/post/2023/spot-price-trends/">Original</a>
    <h1>Farewell to the Era of Cheap EC2 Spot Instances</h1>
    
    <div id="readability-page-1" class="page"><div><p>AWS Spot instances offer a discount off on-demand rates in exchange for the risk of instance preemption (running instances stopped) and unavailability (no capacity to start instances). I have long held the belief that spot instances are underpriced, as most tenants underestimate their tolerance for preemption or overestimate its likelihood. In reality, instance preemption is rare in most instance families, and tolerating a large set of different instance types (such as by <a href="https://pauley.me/post/2022/spot-instance-pricing">taking advantage of equivalent instances</a>) can allow drastic savings over on-demand with minimal negative impact. A well-designed spot placement strategy has generally been able to achieve much of the max savings (“up to 90%”) that <a href="https://aws.amazon.com/ec2/spot/" target="_blank" rel="noopener">Amazon claims</a>. In effect, spot compute leverages a market inefficiency in which other tenants pay too much.</p><p>It appears, however, that this is changing, and quickly. As macroeconomic conditions change and businesses look to trim costs, cloud bills are on the chopping block. It has recently been reported that <a href="https://www.theregister.com/2023/04/17/amazon_annual_shareholder_letter_aws/" target="_blank" rel="noopener">Amazon is trying to help customers cut costs</a> through more efficient deployments. Third-party data can give us some idea where this optimization is occuring: on-demand instance usage by Vantage customers <a href="https://www.vantage.sh/cloud-cost-report/2023-q1" target="_blank" rel="noopener">dropped to its lowest ever</a> (around 30%). Amazon is likely pushing a similar trend globally, encouraging customers to switch to savings plans/reserved instances and spot instances.</p><figure><div><p><img alt="&lt;code&gt;t4g.nano&lt;/code&gt; spot pricing in &lt;code&gt;us-east-1&lt;/code&gt;" srcset="/post/2023/spot-price-trends/t4g.nano-price-history_hu16c39038afd009e47b0a69bd35ac4335_73562_e239054fc23151584538ebb23bfd9f8c.webp 400w,
/post/2023/spot-price-trends/t4g.nano-price-history_hu16c39038afd009e47b0a69bd35ac4335_73562_1d163ea5bc5d5aaeeace8cca7ec94cfb.webp 760w,
/post/2023/spot-price-trends/t4g.nano-price-history_hu16c39038afd009e47b0a69bd35ac4335_73562_1200x1200_fit_q75_h2_lanczos_3.webp 1200w" src="https://pauley.me/post/2023/spot-price-trends/t4g.nano-price-history_hu16c39038afd009e47b0a69bd35ac4335_73562_e239054fc23151584538ebb23bfd9f8c.webp" width="760" height="356" loading="lazy" data-zoomable=""/></p></div></figure><p><code>t4g.nano</code> spot prices in <code>us-east-1</code>. Yikes!</p><p>At the same time, if you’re already using spot instances you may have noticed your savings start to dry up. I know I did! So naturally I went out and tried to measure it. Is this spike in spot prices just a blip in the radar, or have macroeconomic conditions also had an effect on spot pricing?</p><p>Any good experiment has a hypothesis. Today, we’re testing the hypothesis that there’s only so much spot savings to go around. By this I mean in aggregate: as more tenants move to spot instances will Amazon bring in less money, or is there some fixed amount of overall spot discount that is “split” between customers? The last couple months would argue that our hypothesis is true, and as more businesses use spot instances the savings will continue to diminish. For example:</p><figure><div><p><img alt="Mean Spot Price/On Demand ratio grouped by region" srcset="/post/2023/spot-price-trends/region_ratios_hu832fb2939958bc775cb9988b0026c977_73072_ef729021b012c64bccd8c58a3f59c3ad.webp 400w,
/post/2023/spot-price-trends/region_ratios_hu832fb2939958bc775cb9988b0026c977_73072_4aa8fad7b73ef23a43a52475abfa25e3.webp 760w,
/post/2023/spot-price-trends/region_ratios_hu832fb2939958bc775cb9988b0026c977_73072_1200x1200_fit_q75_h2_lanczos_3.webp 1200w" src="https://pauley.me/post/2023/spot-price-trends/region_ratios_hu832fb2939958bc775cb9988b0026c977_73072_ef729021b012c64bccd8c58a3f59c3ad.webp" width="640" height="480" loading="lazy" data-zoomable=""/></p></div></figure><p>This figure shows aggregate spot ratios (the mean ratio of spot price to on-demand price, across availability zones/instance types) within each region over the past year. These values shift with supply and demand constantly, but historically have kept within a tight range. That is, until the past few months. Since the start of 2023, spot ratios have spiked as much as 55% (in <code>us-east-1</code>). In four of the largest AWS regions<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> prices have skyrocketed, and others may not be far behind.</p><p>Regardless of what is causing it, these increased prices are surely putting pressure on cloud customer compute budgets. Next, we’ll take a deeper dive and try to pin down <em>why</em> they’re occuring, and also some ideas on what to do about it.</p><p>Without more details, one might suspect that this is just Amazon playing with pricing levers. One way that we can differentiate this is by looking at the actual underlying infrastructure: if actual spot instance demand is increasing then we would expect to see an increase in instance preemptions.</p><p>Thankfully, our research group manages a large-scale deployment of <code>t3</code>/<code>t4</code> spot instances. Between October 2022 and today, we’ve provisioned <em>5.5 million</em> spot instances on AWS across all regions. We use these to study <a href="https://pauley.me/publication/2022/eipsim22/">how cloud providers allocate IP addresses</a> and<a href="https://pauley.me/publication/2022/oakland22/"> its effect on tenant security</a>. Each server runs for 10 minutes each before shutting down, but we also track when instances get preempted. Here’s a plot of preemption rates for spot instances in regions with price spikes vs. without:</p><figure><div><p><img alt="Preemption rate in spiked regions vs. others" srcset="/post/2023/spot-price-trends/preemption_rates_hu15859f60051699c055d9d01947c91303_49408_ce226d0c236c805094c1b95cd5ddcdaa.webp 400w,
/post/2023/spot-price-trends/preemption_rates_hu15859f60051699c055d9d01947c91303_49408_d2ac23581e253fccd5429a76ecd2349a.webp 760w,
/post/2023/spot-price-trends/preemption_rates_hu15859f60051699c055d9d01947c91303_49408_1200x1200_fit_q75_h2_lanczos_3.webp 1200w" src="https://pauley.me/post/2023/spot-price-trends/preemption_rates_hu15859f60051699c055d9d01947c91303_49408_ce226d0c236c805094c1b95cd5ddcdaa.webp" width="640" height="480" loading="lazy" data-zoomable=""/></p></div></figure><p>We see a near quadrupling in preemption rates in the span of just a few months! Note that our spot pools are diversified across instance families, availability zones, and in this case even regions! The data suggest a marked increase in aggregate spot instance demand. Note that these preemption rates are across the 10-minute windows that instance are deployed for, so in a given month the odds of being preempted are much higher!</p><p>Of course, increase in demand may not affect all instance types equally. Let’s look at spot price changes by instance family. In this table, note that prices are normalized as a fraction of the on-demand cost:</p><div><table><thead><tr><th>Family</th><th>Price 2023-01-01</th><th>Price 2023-05-01</th><th>Change</th></tr></thead><tbody><tr><td>m3</td><td>0.24</td><td>0.53</td><td>+158%</td></tr><tr><td>a1</td><td>0.32</td><td>0.77</td><td>+148%</td></tr><tr><td>t3a</td><td>0.35</td><td>0.75</td><td>+115%</td></tr><tr><td>g5g</td><td>0.34</td><td>0.69</td><td>+108%</td></tr><tr><td>t4g</td><td>0.35</td><td>0.69</td><td>+105%</td></tr><tr><td>inf1</td><td>0.34</td><td>0.66</td><td>+105%</td></tr><tr><td>t2</td><td>0.31</td><td>0.61</td><td>+97%</td></tr><tr><td>c6id</td><td>0.33</td><td>0.6</td><td>+90%</td></tr><tr><td>c6in</td><td>0.26</td><td>0.49</td><td>+89%</td></tr><tr><td>c5a</td><td>0.4</td><td>0.74</td><td>+88%</td></tr><tr><td>t3</td><td>0.32</td><td>0.61</td><td>+87%</td></tr><tr><td>g3</td><td>0.31</td><td>0.57</td><td>+87%</td></tr><tr><td>g4ad</td><td>0.32</td><td>0.6</td><td>+86%</td></tr><tr><td>h1</td><td>0.36</td><td>0.65</td><td>+85%</td></tr><tr><td>m6in</td><td>0.24</td><td>0.43</td><td>+85%</td></tr><tr><td>m4</td><td>0.33</td><td>0.59</td><td>+84%</td></tr><tr><td>c4</td><td>0.32</td><td>0.57</td><td>+84%</td></tr><tr><td>c5ad</td><td>0.41</td><td>0.73</td><td>+83%</td></tr><tr><td>c5n</td><td>0.31</td><td>0.53</td><td>+82%</td></tr><tr><td>m6idn</td><td>0.21</td><td>0.38</td><td>+81%</td></tr><tr><td>m6id</td><td>0.32</td><td>0.52</td><td>+80%</td></tr><tr><td>r3</td><td>0.21</td><td>0.35</td><td>+80%</td></tr><tr><td>r4</td><td>0.25</td><td>0.43</td><td>+79%</td></tr><tr><td>vt1</td><td>0.56</td><td>0.78</td><td>+77%</td></tr><tr><td>m6a</td><td>0.41</td><td>0.69</td><td>+77%</td></tr><tr><td>c6a</td><td>0.44</td><td>0.75</td><td>+77%</td></tr><tr><td>m5a</td><td>0.4</td><td>0.69</td><td>+76%</td></tr><tr><td>r5ad</td><td>0.27</td><td>0.45</td><td>+75%</td></tr><tr><td>c3</td><td>0.48</td><td>0.69</td><td>+75%</td></tr><tr><td>r5a</td><td>0.3</td><td>0.51</td><td>+74%</td></tr><tr><td>r6a</td><td>0.33</td><td>0.54</td><td>+72%</td></tr><tr><td>c7g</td><td>0.45</td><td>0.79</td><td>+72%</td></tr><tr><td>r6in</td><td>0.19</td><td>0.32</td><td>+71%</td></tr><tr><td>c6gn</td><td>0.38</td><td>0.62</td><td>+71%</td></tr><tr><td>m6i</td><td>0.36</td><td>0.59</td><td>+70%</td></tr><tr><td>r6idn</td><td>0.18</td><td>0.29</td><td>+70%</td></tr><tr><td>m6gd</td><td>0.35</td><td>0.59</td><td>+69%</td></tr><tr><td>c6gd</td><td>0.38</td><td>0.66</td><td>+69%</td></tr><tr><td>m5ad</td><td>0.38</td><td>0.58</td><td>+67%</td></tr><tr><td>r6id</td><td>0.26</td><td>0.41</td><td>+67%</td></tr><tr><td>m5n</td><td>0.35</td><td>0.52</td><td>+66%</td></tr><tr><td>m5zn</td><td>0.26</td><td>0.38</td><td>+65%</td></tr><tr><td>m5d</td><td>0.31</td><td>0.49</td><td>+65%</td></tr><tr><td>c6i</td><td>0.36</td><td>0.6</td><td>+64%</td></tr><tr><td>c5d</td><td>0.32</td><td>0.5</td><td>+62%</td></tr><tr><td>r5n</td><td>0.26</td><td>0.39</td><td>+62%</td></tr><tr><td>c6g</td><td>0.45</td><td>0.72</td><td>+62%</td></tr><tr><td>m5</td><td>0.33</td><td>0.54</td><td>+62%</td></tr><tr><td>r6gd</td><td>0.3</td><td>0.48</td><td>+61%</td></tr><tr><td>im4gn</td><td>0.3</td><td>0.48</td><td>+60%</td></tr><tr><td>m6g</td><td>0.41</td><td>0.65</td><td>+59%</td></tr><tr><td>r5d</td><td>0.26</td><td>0.39</td><td>+59%</td></tr><tr><td>m5dn</td><td>0.35</td><td>0.45</td><td>+59%</td></tr><tr><td>r5b</td><td>0.32</td><td>0.39</td><td>+58%</td></tr><tr><td>r6i</td><td>0.3</td><td>0.44</td><td>+56%</td></tr><tr><td>g4dn</td><td>0.31</td><td>0.48</td><td>+55%</td></tr><tr><td>r6g</td><td>0.32</td><td>0.49</td><td>+52%</td></tr><tr><td>x2gd</td><td>0.38</td><td>0.51</td><td>+51%</td></tr><tr><td>z1d</td><td>0.33</td><td>0.48</td><td>+51%</td></tr><tr><td>r5dn</td><td>0.29</td><td>0.37</td><td>+46%</td></tr><tr><td>c5</td><td>0.36</td><td>0.48</td><td>+35%</td></tr><tr><td>g5</td><td>0.33</td><td>0.44</td><td>+31%</td></tr><tr><td>x2idn</td><td>0.38</td><td>0.43</td><td>+31%</td></tr><tr><td>r5</td><td>0.28</td><td>0.35</td><td>+30%</td></tr><tr><td>x1</td><td>0.3</td><td>0.39</td><td>+28%</td></tr><tr><td>c1</td><td>0.56</td><td>0.27</td><td>+26%</td></tr><tr><td>i3</td><td>0.33</td><td>0.38</td><td>+16%</td></tr><tr><td>d3</td><td>0.34</td><td>0.36</td><td>+15%</td></tr><tr><td>i4i</td><td>0.35</td><td>0.36</td><td>+11%</td></tr><tr><td>is4gen</td><td>0.3</td><td>0.33</td><td>+11%</td></tr><tr><td>i2</td><td>0.3</td><td>0.33</td><td>+8%</td></tr><tr><td>d2</td><td>0.3</td><td>0.31</td><td>+4%</td></tr><tr><td>dl1</td><td>0.3</td><td>0.31</td><td>+3%</td></tr><tr><td>i3en</td><td>0.31</td><td>0.31</td><td>+1%</td></tr><tr><td>p2</td><td>0.42</td><td>0.38</td><td>+0%</td></tr><tr><td>trn1</td><td>0.3</td><td>0.3</td><td>+0%</td></tr><tr><td>p4d</td><td>0.3</td><td>0.3</td><td>+0%</td></tr><tr><td>p3dn</td><td>0.3</td><td>0.3</td><td>+0%</td></tr><tr><td>x1e</td><td>0.3</td><td>0.3</td><td>+0%</td></tr><tr><td>d3en</td><td>0.41</td><td>0.32</td><td>-7%</td></tr><tr><td>g3s</td><td>0.35</td><td>0.3</td><td>-11%</td></tr><tr><td>x2iedn</td><td>0.43</td><td>0.31</td><td>-12%</td></tr><tr><td>p3</td><td>0.39</td><td>0.3</td><td>-13%</td></tr><tr><td>f1</td><td>0.43</td><td>0.31</td><td>-14%</td></tr><tr><td>x2iezn</td><td>0.46</td><td>0.3</td><td>-15%</td></tr><tr><td>g2</td><td>0.84</td><td>0.52</td><td>-24%</td></tr><tr><td>m1</td><td>0.35</td><td>0.21</td><td>-25%</td></tr><tr><td>m2</td><td>0.61</td><td>0.26</td><td>-37%</td></tr><tr><td>t1</td><td>0.5</td><td>0.19</td><td>-39%</td></tr></tbody></table></div><p>There’s quite a bit of range here, though the overall trend is positive. The price reductions are more of an exception that proves the rule, as older families (such as <code>m1</code> and <code>t1</code>) have too poor of compute performance to be price competitive.</p><p>Overall, I think we’ve entered a race to the bottom in terms of spot discounts. For now, you can likely still reduce your bills by diversifying across <a href="https://pauley.me/post/2022/spot-instance-pricing">equivalent instances in other families</a>. The largest price win you can get would be to move to a region that has not (yet!) seen price spikes, but this is probably not feasible for a lot of architectures.</p><p>On the plus side, spot prices can’t keep rising forever. Since Amazon’s new spot pricing model, it appears that spot prices rarely if ever exceed on-demand prices. If your architecture is designed to accept preemption and the cost of provisioning replacement instances isn’t too high (e.g., compute time to start a new instance), you probably won’t turn out worse than if you used on demand instances. Using spot instances can also be seen as a sort of built-in chaos monkey, since even on-demand instances can fail. However, as the discount on spot instances erodes it may make less and less sense to invest in the resilient design to use them.</p><p>Spot instances have offered an incredible price advantage to those who are willing to architect around preemptible instances, but the party may be coming to close. While there is still some savings to be had, organizations should make their architecture decisions in light of these decaying benefits, and more strongly consider approaches with more guaranteed savings (such as Savings Plans) when they have predictable usage.</p></div></div>
  </body>
</html>
