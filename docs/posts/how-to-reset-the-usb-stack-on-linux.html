<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.wesleyac.com/posts/linux-reset-usb">Original</a>
    <h1>How to reset the USB stack on Linux</h1>
    
    <div id="readability-page-1" class="page"><div>
            <p>I&#39;ve recently started having issues with the USB stack on my Linux laptop getting itself wedged. Rebooting fixes the problem, but I&#39;d rather not have to reboot, so I looked into ways to reset the USB stack without needing a reboot. Almost all of the answers on the internet about how to do so either do not work on modern Linux systems, or did not reset at low enough of a level to fix the specific problem I was having.</p>

<p>The solution is to unbind and rebind the USB controller to the xHCI driver. First, find the PCI bus number of the misbehaving USB controller, using <code>lspci -D</code>. Then, write that bus number to <code>/sys/bus/pci/drivers/xhci_hcd/unbind</code>, for instance, by running <code>echo 0000:00:14.0 | sudo tee /sys/bus/pci/drivers/xhci_hcd/unbind</code> (replacing <code>0000:00:14.0</code> with whatever the PCI bus number you found in the previous step was). This will disable the USB controller. Once you&#39;ve done that, reenable it by writing the same bus number to <code>/sys/bus/pci/drivers/xhci_hcd/bind</code>.</p>

<p>Here&#39;s a script that will do that all for you, in case it&#39;s useful:</p>
<div><pre><code data-lang="bash"><span>#!/usr/bin/env bash</span>

<span>set</span> -eo pipefail

<span>DEVICE</span><span>=</span><span>$(</span>lspci -Dm | grep <span>&#34;USB controller&#34;</span> | cut -f1 -d<span>&#39; &#39;</span> | head -n1<span>)</span>

<span>echo</span> <span>$DEVICE</span> &gt; /sys/bus/pci/drivers/xhci_hcd/unbind
<span>echo</span> <span>$DEVICE</span> &gt; /sys/bus/pci/drivers/xhci_hcd/bind
</code></pre></div>
<p>You may need to modify the grep for &#34;USB controller&#34;, depending on how your USB controller identifies itself.</p>

          </div></div>
  </body>
</html>
