<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/marcoheisig/Petalisp">Original</a>
    <h1>Petalisp: Elegant High Performance Computing</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto">Petalisp is an attempt to generate high performance code for parallel
  computers by JIT-compiling array definitions. It is not a full blown
  programming language, but rather a carefully crafted extension of Common
  Lisp that allows for extreme optimization and parallelization.</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-getting-started" aria-hidden="true" href="#getting-started"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Getting Started</h2>
<ol dir="auto">
  <li>Install Lisp and a suitable IDE.  If unsure, pick <a href="https://portacle.github.io/" rel="nofollow">Portacle</a>.</li>
  <li>Download Petalisp via <a href="https://www.quicklisp.org/" rel="nofollow">Quicklisp</a>.</li>
  <li>Check out some of the <a href="https://github.com/marcoheisig/Petalisp/blob/master/examples">examples</a>.</li>
</ol>
<h2 tabindex="-1" dir="auto"><a id="user-content-showcases" aria-hidden="true" href="#showcases"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Showcases</h2>
<p dir="auto">Petalisp is still under development, so the following examples may still
  change slightly. Nevertheless they give a good glimpse on what programming
  with Petalisp will be like.</p>
<p dir="auto">Example 1: transposing a matrix</p>
<div dir="auto" data-snippet-clipboard-copy-content="(defun lazy-transpose (A)
  (lazy-reshape A (transform m n to n m)))"><pre>(<span>defun</span> <span>lazy-transpose</span> (A)
  (lazy-reshape A (transform m n to n m)))</pre></div>
<p dir="auto">Example 2: matrix-matrix multiplication</p>
<div dir="auto" data-snippet-clipboard-copy-content="(defun matrix-multiplication (A B)
  (lazy-reduce #&#39;+
   (lazy #&#39;*
    (lazy-reshape A (transform m n to n m 1))
    (lazy-reshape B (transform n k to n 1 k)))))"><pre>(<span>defun</span> <span>matrix-multiplication</span> (A B)
  (lazy-reduce <span>#&#39;+</span>
   (lazy <span>#&#39;</span>*
    (lazy-reshape A (transform m n to n m <span>1</span>))
    (lazy-reshape B (transform n k to n <span>1</span> k)))))</pre></div>
<p dir="auto">Example 3: the numerical Jacobi scheme in two dimensions</p>
<div dir="auto" data-snippet-clipboard-copy-content="(defun lazy-jacobi-2d (grid iterations)
  (let ((interior (interior grid)))
    (if (zerop iterations) grid
        (lazy-jacobi-2d
         (lazy-fuse
          x
          (lazy #&#39;* 0.25
           (lazy #&#39;+
            (lazy-reshape x (transform i0 i1 to (+ i0 1) i1) interior)
            (lazy-reshape x (transform i0 i1 to (- i0 1) i1) interior)
            (lazy-reshape x (transform i0 i1 to i0 (+ i1 1)) interior)
            (lazy-reshape x (transform i0 i1 to i0 (- i1 1)) interior))))
         (- iterations 1)))))"><pre>(<span>defun</span> <span>lazy-jacobi-2d</span> (grid iterations)
  (<span>let</span> ((interior (interior grid)))
    (<span>if</span> (zerop iterations) grid
        (lazy-jacobi-2d
         (lazy-fuse
          x
          (lazy <span>#&#39;</span>* <span>0.25</span>
           (lazy <span>#&#39;+</span>
            (lazy-reshape x (transform i0 i1 to (+ i0 <span>1</span>) i1) interior)
            (lazy-reshape x (transform i0 i1 to (- i0 <span>1</span>) i1) interior)
            (lazy-reshape x (transform i0 i1 to i0 (+ i1 <span>1</span>)) interior)
            (lazy-reshape x (transform i0 i1 to i0 (- i1 <span>1</span>)) interior))))
         (- iterations <span>1</span>)))))</pre></div>
<h2 tabindex="-1" dir="auto"><a id="user-content-performance" aria-hidden="true" href="#performance"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Performance</h2>
<p dir="auto">Coming soon!</p>
<h2 tabindex="-1" dir="auto"><a id="user-content-frequently-asked-questions" aria-hidden="true" href="#frequently-asked-questions"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Frequently Asked Questions</h2>
<h3 tabindex="-1" dir="auto"><a id="user-content-is-petalisp-similar-to-numpy" aria-hidden="true" href="#is-petalisp-similar-to-numpy"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Is Petalisp similar to NumPy?</h3>
<p dir="auto">NumPy is a widely used Python library for scientific computing on arrays.
  It provides powerful N-dimensional arrays and a variety of functions for
  working with these arrays.</p>
<p dir="auto">Petalisp works on a more fundamental level.  It provides even more powerful
  N-dimensional arrays, but just a few building blocks for working on them -
  element-wise function application, reduction, reshaping and array fusion.</p>
<p dir="auto">So Petalisp is not a substitute for NumPy.  However, it could be used to
  write a library that behaves like NumPy, but that is much faster and fully
  parallelized.  In fact, writing such a library is one of my future goals.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-do-i-have-to-program-lisp-to-use-petalisp" aria-hidden="true" href="#do-i-have-to-program-lisp-to-use-petalisp"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Do I have to program Lisp to use Petalisp?</h3>
<p dir="auto">Not necessarily.  Not everyone has the time to learn Common Lisp.  That is
  why I am also working on some <a href="https://github.com/marcoheisig/petalisp-for-python">convenient Python bindings</a> for Petalisp.</p>
<p dir="auto">But: If you ever have time to learn Lisp, do it!  It is an enlightening
  experience.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-how-can-i-get-emacs-to-indent-petalisp-code-nicely" aria-hidden="true" href="#how-can-i-get-emacs-to-indent-petalisp-code-nicely"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>How can I get Emacs to indent Petalisp code nicely?</h3>
<p dir="auto">Put the following code in your initialization file:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(put &#39;lazy &#39;common-lisp-indent-function &#39;(1 &amp;rest 1))
(put &#39;lazy-reduce &#39;common-lisp-indent-function &#39;(1 &amp;rest 1))
(put &#39;lazy-multireduce &#39;common-lisp-indent-function &#39;(1 1 &amp;rest 1))
(put &#39;lazy-multiple-value &#39;common-lisp-indent-function &#39;(1 1 &amp;rest 1))
(put &#39;lazy-reshape &#39;common-lisp-indent-function &#39;(1 &amp;rest 1))"><pre>(<span>put</span> <span>&#39;lazy</span> <span>&#39;common-lisp-indent-function</span> &#39;(<span>1</span> <span>&amp;rest</span> <span>1</span>))
(<span>put</span> <span>&#39;lazy-reduce</span> <span>&#39;common-lisp-indent-function</span> &#39;(<span>1</span> <span>&amp;rest</span> <span>1</span>))
(<span>put</span> <span>&#39;lazy-multireduce</span> <span>&#39;common-lisp-indent-function</span> &#39;(<span>1</span> <span>1</span> <span>&amp;rest</span> <span>1</span>))
(<span>put</span> <span>&#39;lazy-multiple-value</span> <span>&#39;common-lisp-indent-function</span> &#39;(<span>1</span> <span>1</span> <span>&amp;rest</span> <span>1</span>))
(<span>put</span> <span>&#39;lazy-reshape</span> <span>&#39;common-lisp-indent-function</span> &#39;(<span>1</span> <span>&amp;rest</span> <span>1</span>))</pre></div>
<h3 tabindex="-1" dir="auto"><a id="user-content-why-is-petalisp-licensed-under-agpl" aria-hidden="true" href="#why-is-petalisp-licensed-under-agpl"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Why is Petalisp licensed under AGPL?</h3>
<p dir="auto">I am aware that this license prevents some people from using or
  contributing to this piece of software, which is a shame. But unfortunately
  the majority of software developers have not yet understood that</p>
<ol dir="auto">
  <li>In a digital world, free software is a necessary prerequisite for a free
    society.</li>
  <li>When developing software, open collaboration is way more efficient than
    competition.</li>
</ol>
<p dir="auto">So as long as distribution of non-free software is socially accepted,
  copyleft licenses like the AGPL seem to be the lesser evil.</p>
<p dir="auto">That being said, I am willing to discuss relicensing on an individual
  basis.</p>
<h3 tabindex="-1" dir="auto"><a id="user-content-why-is-petalisp-written-in-common-lisp" aria-hidden="true" href="#why-is-petalisp-written-in-common-lisp"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Why is Petalisp written in Common Lisp?</h3>
<p dir="auto">I couldn’t wish for a better tool for the job. Common Lisp is extremely
  rich in features, standardized, fast, safe and mature. The Lisp community
  is amazing and there are excellent libraries for almost every imaginable
  task.</p>
<p dir="auto">To illustrate why Lisp is particularly well suited for a project like
  Petalisp, consider the following implementation of a JIT-compiler for
  mapping a function over a vector of a certain element type:</p>
<div dir="auto" data-snippet-clipboard-copy-content="(defun vector-mapper (element-type)
  (compile nil `(lambda (fn vec)
                  (declare (function fn)
                           (type (simple-array ,element-type (*)) vec)
                           (optimize (speed 3) (safety 0)))
                  (loop for index below (length vec) do
                    (symbol-macrolet ((elt (aref vec index)))
                      (setf elt (funcall fn elt)))))))"><pre>(<span>defun</span> <span>vector-mapper</span> (element-type)
  (compile <span>nil</span> `(<span>lambda</span> (fn vec)
                  (declare (function fn)
                           (type (simple-array ,element-type (*)) vec)
                           (optimize (speed <span>3</span>) (safety <span>0</span>)))
                  (<span>loop</span> for index below (length vec) <span>do</span>
                    (symbol-macrolet ((elt (aref vec index)))
                      (<span>setf</span> elt (funcall fn elt)))))))</pre></div>
<p dir="auto">Not only is this JIT-compiler just 8 lines of code, it is also 20 times
  faster than invoking GCC or Clang on a roughly equivalent piece of C code.</p>
</article>
          </div></div>
  </body>
</html>
