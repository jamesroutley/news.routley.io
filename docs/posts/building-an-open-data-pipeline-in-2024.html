<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.twingdata.com/p/building-an-open-data-pipeline-in">Original</a>
    <h1>Building an open data pipeline in 2024</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div class=""><div><div dir="auto"><p><span>In a previous post on the </span><a href="https://blog.twingdata.com/p/embrace-the-differences-between-development" rel="">commoditization of SQL</a><span>, I touched on the concept of building a data stack that harnesses this approach. One key element of this architecture involves utilizing </span><a href="https://iceberg.apache.org/" rel="">Iceberg</a><span> as the core data storage layer, with the flexibility to choose the most suitable compute environment depending on the specific needs of your use case. For instance, if you’re powering BI reporting you’ll often want to prioritize speed so your customers can quickly get the data they need. Conversely, cost may be the biggest factor if you’re working on a batch data pipeline job. Additionally, you may have external data customers in which case you want to prioritize availability over everything else. While there is no one-size-fits-all solution, understanding your unique use cases and requirements allows you to tailor your approach accordingly.</span></p><p>There are a few dimensions here and I want to go through each of them separately although in practice it’s going to be a combination of factors.</p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png" width="1456" height="1168" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/a30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:1168,&#34;width&#34;:1456,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:null,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:null,&#34;href&#34;:null,&#34;belowTheFold&#34;:false,&#34;topImage&#34;:true,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa30051ff-be18-4899-99c4-ceb16e483102_1600x1284.png 1456w" sizes="100vw" fetchpriority="high"/></picture></div></a></figure></div><p><span>We live in a world of “big data” but even within big data we have entirely different tiers. Smaller data sets can be handled using </span><a href="https://duckdb.org/" rel="">DuckDB</a><span> on a single node instance. Larger data sets require some sort of map-reduce approach and can leverage modern data warehouses, such as </span><a href="https://www.snowflake.com/en/" rel="">Snowflake</a><span> or </span><a href="https://www.databricks.com/" rel="">Databricks</a><span>. And if you’re dealing with truly massive datasets you can take advantage of GPUs for your data jobs.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png" width="673" height="147" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/b71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:147,&#34;width&#34;:673,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:null,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:null,&#34;href&#34;:null,&#34;belowTheFold&#34;:false,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb71148be-13d5-4e05-88a7-b9bae1127e0d_673x147.png 1456w" sizes="100vw"/></picture></div></a></figure></div><p>There are two types of latency to consider. The first type is data processing, which refers to the time required to transform and process the data. The  second type is the speed at which queries can be executed in interactive or reporting use cases. Imagine you have a service that collects e-commerce transaction data to help customers understand their sales better. You receive an event for every transaction but given the scale you choose to aggregate the data hourly and the aggregation takes 10 minutes to run. When the data is aggregated users are then able to query it via a BI tool and 95% of queries execute within 5 seconds. In this case, your data processing latency is at most 70 minutes but your query latency is a few seconds.</p><p>You can improve data processing latency by running the jobs more frequently or on larger hardware. To improve query latency you can have larger hardware and keep as much data “hot” and in memory rather than pulling it from “cold” storage. As with most things, reducing latency will cost you more.</p><p>In general, managed tools will give you stronger governance and access controls compared to open source solutions. For businesses dealing with sensitive data that requires a robust security model, commercial solutions may be worth investing in, as they can provide an added layer of reassurance and a stronger audit trail.</p><p>Different types of data will often have different requirements. Typically, raw events often deal with personally identifiable information and have high sensitivity. However, as the data is rolled up and aggregated, the sensitivity level tends to decrease, allowing for more defined roles and responsibilities around the data sensitivity levels.</p><p>Cost is a function of the above but is also a key dimension on its own. Depending on the economics of your business cost may actually be the constraint that forces you to compromise on some of the other requirements. It can be useful to think of the ideal architecture where cost is not a factor and then keep stripping and compromising as you layer on more and more cost considerations. That also gives you a good sense of your priorities and how to tradeoff between them. For instance, you might realize that achieving sub-second query latency is less crucial than establishing a robust security model.</p><p>A helpful approach when thinking about cost is asking the question of what it would look like if you had twice the budget? What about half the budget? That can inspire some creative thinking and lead to solutions that weren’t obvious at first.</p><p><span>Before starting </span><a href="https://www.twingdata.com/" rel="">Twing Data</a><span>, I gained valuable experience working at </span><a href="https://triplelift.com/" rel="">TripleLift</a><span>, an advertising technology company, where I held several engineering leadership positions over the course of 10 years. During my time there, we went through multiple iterations of a data pipeline. Drawing from that experience, I wanted to utilize the framework mentioned above to create an architecture that is specifically tailored to accommodate diverse requirements while leveraging Iceberg and the different compute environments available.</span></p><div><figure><a target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png" data-component-name="Image2ToDOM" rel=""><div><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png" width="961" height="601" data-attrs="{&#34;src&#34;:&#34;https://substack-post-media.s3.amazonaws.com/public/images/30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png&#34;,&#34;srcNoWatermark&#34;:null,&#34;fullscreen&#34;:null,&#34;imageSize&#34;:null,&#34;height&#34;:601,&#34;width&#34;:961,&#34;resizeWidth&#34;:null,&#34;bytes&#34;:null,&#34;alt&#34;:null,&#34;title&#34;:null,&#34;type&#34;:null,&#34;href&#34;:null,&#34;belowTheFold&#34;:true,&#34;topImage&#34;:false,&#34;internalRedirect&#34;:null}" alt="" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F30dafc71-9648-4b5b-9ad5-29fe1ea97fe5_961x601.png 1456w" sizes="100vw" loading="lazy"/></picture></div></a></figure></div><p>Here’s a breakdown of how it fits together.</p><ol><li><p><span>Log-level events are collected in </span><a href="https://redpanda.com/" rel="">Redpanda</a><span> and persisted to </span><a href="https://www.cloudflare.com/developer-platform/r2/" rel="">Cloudflare R2</a><span> (</span><a href="https://dansdatathoughts.substack.com/p/from-s3-to-r2-an-economic-opportunity" rel="">better than AWS S3</a><span>) using </span><a href="https://parquet.apache.org/" rel="">Parquet</a><span> and Iceberg. There are hundreds of billions of events each day and range from information about the advertising auctions being run, to the winners of each auction, to collecting information around whether the ad was viewed and for how long.</span></p></li><li><p><span>Data modeling is done using </span><a href="https://sqlmesh.com/" rel="">SQLMesh</a><span> and orchestrated in </span><a href="https://dagster.io/" rel="">dagster</a><span>. Complex transformations that require distributed work with large-scale joins run in Snowflake. One example is joining all the events from the first step in order to create a wide table where each row represents everything we know about a single auction.</span></p></li><li><p>DuckDB is used for simpler jobs that can run on a single node. For example, taking the wide and large table from the second step and coming up with smaller tables that have a subset of the dimensions and are highly aggregated.</p></li><li><p><a href="https://cube.dev/" rel="">Cube</a><span> is used as a semantic layer to give us a standard way of defining the metrics we care about and ensuring they are consistent across multiple access paths.</span></p></li><li><p><span>One access path is </span><a href="https://www.metabase.com/" rel="">Metabase</a><span> which acts as our BI tool. By going through Cube we can ensure we use standard definitions and take advantage of Cube’s pre-aggregation/caching layer.</span></p></li><li><p>Some of our engineers use Python directly and can also take advantage of the semantic layer offered by Cube.</p></li><li><p>We also want to allow power users, such as data scientists, the ability to query the data directly from R2 using whatever compute layer they want. They may want to use Spark or even Snowflake but they’re able to because the data is stored using an open storage format, Iceberg.</p></li></ol><p>This approach is centered around Iceberg and its open nature. In the above example we can switch Snowflake with Databricks without any trouble. Moreover, we have the flexibility to adopt different orchestration, data modeling, and semantic layers as needed. The foundation of this flexibility lies in the fact that the core of the system, the data itself, is not confined to a proprietary format. This not only leads to cost-effectiveness but also fosters innovation as both you and the ecosystem expand and evolve.</p></div></div></div></article></div></div></div>
  </body>
</html>
