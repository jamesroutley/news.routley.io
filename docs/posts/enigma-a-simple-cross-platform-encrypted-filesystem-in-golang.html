<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://github.com/aegistudio/enigma">Original</a>
    <h1>Enigma: A simple cross-platform encrypted filesystem in Golang</h1>
    
    <div id="readability-page-1" class="page"><div data-target="readme-toc.content">
            <article itemprop="text">
<p dir="auto"><a target="_blank" rel="noopener noreferrer" href="https://github.com/aegistudio/enigma/actions/workflows/build.yml/badge.svg"><img src="https://github.com/aegistudio/enigma/actions/workflows/build.yml/badge.svg" alt="build"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/4439f5796e6af02dbb466e7b01e7c88aaa18bf5b44da26833124f37296ef8820/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652f6165676973747564696f2f656e69676d61"><img src="https://camo.githubusercontent.com/4439f5796e6af02dbb466e7b01e7c88aaa18bf5b44da26833124f37296ef8820/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652f6165676973747564696f2f656e69676d61" alt="release" data-canonical-src="https://img.shields.io/github/release/aegistudio/enigma"/></a>
<a target="_blank" rel="noopener noreferrer nofollow" href="https://camo.githubusercontent.com/a7fe9976c4ef9e8cc023fd37c701459c118da762d53aab7d966786f6841a335e/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652d646174652f6165676973747564696f2f656e69676d612e7376673f636f6c6f723d626c7565266c6162656c3d757064617465"><img src="https://camo.githubusercontent.com/a7fe9976c4ef9e8cc023fd37c701459c118da762d53aab7d966786f6841a335e/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652d646174652f6165676973747564696f2f656e69676d612e7376673f636f6c6f723d626c7565266c6162656c3d757064617465" alt="update" data-canonical-src="https://img.shields.io/github/release-date/aegistudio/enigma.svg?color=blue&amp;label=update"/></a></p>
<p dir="auto">Enigma is a simple encrypted filesystem that adds a thin layer of
encryption over native filesystem and keeps your most sensitive
secrets.</p>
<p dir="auto"><a href="https://github.com/aegistudio/enigma/blob/master/doc/quickstart.md#quickstart-for-windows-with-winfsp">Quickstart for Windows (with WinFSP)</a></p>
<p dir="auto"><a href="https://github.com/aegistudio/enigma/blob/master/doc/quickstart.md#quickstart-for-linux-with-fuse">Quickstart for Linux (with FUSE)</a></p>
<p dir="auto">
<a target="_blank" rel="noopener noreferrer" href="https://github.com/aegistudio/enigma-assets/blob/693f0bd237cc73108e45dacb40eaf142a0255a75/winfsp.gif"><img src="https://github.com/aegistudio/enigma-assets/raw/693f0bd237cc73108e45dacb40eaf142a0255a75/winfsp.gif" width="71%" height="71%" data-animated-image=""/></a>
</p>
<p dir="auto">
<a target="_blank" rel="noopener noreferrer" href="https://github.com/aegistudio/enigma-assets/blob/03198af9acc329642c3a084e05838e4cd4c7ea35/fuse.gif"><img src="https://github.com/aegistudio/enigma-assets/raw/03198af9acc329642c3a084e05838e4cd4c7ea35/fuse.gif" width="71%" height="71%" data-animated-image=""/></a>
</p>
<h2 dir="auto"><a id="user-content-roadmap" aria-hidden="true" href="#roadmap"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Roadmap</h2>
<ul dir="auto">
<li>Operation Mode
<ul>
<li> Direct mapping mode</li>
<li> POSIX-compatible mode</li>
</ul>
</li>
<li>Key Specification
<ul>
<li> File (prone to invasion) <sup><a href="#user-content-fn-1-ca5fe5dc454924b78fee79247939c620" id="user-content-fnref-1-ca5fe5dc454924b78fee79247939c620" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup></li>
<li> Vault (with <a href="https://github.com/hashicorp/vault">github.com/hashicorp/vault</a>)</li>
<li> HTTP request (remote decryption)</li>
</ul>
</li>
<li>Integration
<ul>
<li> WinFSP (<strong>Windows</strong> only, with <a href="https://github.com/aegistudio/go-winfsp">github.com/aegistudio/go-winfsp</a>)</li>
<li> FUSE (<strong>Linux</strong> and <strong>Mac</strong> only, with <a href="https://github.com/hanwen/go-fuse">github.com/hanwen/go-fuse</a>)</li>
<li> HTTP (trivially by Golang&#39;s <code>http</code> library)</li>
<li> FTP (with <a href="https://github.com/fclairamb/ftpserverlib">github.com/fclairamb/ftpserverlib</a>)</li>
<li> NFSv3</li>
</ul>
</li>
</ul>
<h2 dir="auto"><a id="user-content-methods-of-encryption" aria-hidden="true" href="#methods-of-encryption"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Methods of Encryption</h2>
<p dir="auto"><em><strong>(WARN: the method of encryption is undergoing restatement and
reassessment. The author is working on it so that the project will
have security audit as soon as possible.)</strong></em></p>
<p dir="auto">Both the file names and data will be encrypted by an <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" rel="nofollow">AES-256</a>
key in <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#CTR" rel="nofollow">CTR mode</a>,
which takes trillions of years for the attackers to crack, owing to
the miracles of cryptology.</p>
<p dir="auto">Encrypting in CTR mode enables the filesystem to random access the
stored content, without bloating the file size. Many CPUs support
hardware accelerating computation of AES-256 block. This is crucial
for implementing a fast, efficient and low overhead file system.</p>
<p dir="auto">The nonce, which is required by CTR mode to encrypt file names and
data, is generated regarding the path relative to root in filesystem.
Walking down the path to the final component of file name, we compute
the SHA256 hash of its parent&#39;s hash concatenating current visited
component. The hash of <code>/</code> is the SHA256 digest of the key.</p>
<p dir="auto">Since all information to calculate the nonce is contained inside the
file or directory&#39;s path we are going to visit naturally, we don&#39;t
need to spend any extra space to store the nonce.</p>
<p dir="auto">Under the same directory, encrypting file names with the same nonce
directly is prone to <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack" rel="nofollow">chosen-plaintext attack</a>.
To mitigate, we generate a short extra nonce for each file name,
which is computed from the cryptological digest. Then the nonce for
the file name is computed from the digest of the directory it is in,
plus the short extra nonce and the file&#39;s length. After being
encrypted, the file name is encoded in Base64 as it is usually in
invalid ASCII or Unicode.</p>
<p dir="auto">For resisting <a href="https://en.wikipedia.org/wiki/Birthday_attack" rel="nofollow">birthday attack</a>,
the default extra nonce size is 3 bytes, which yields a birthday
bound of about <code>Q(H) = 46819.7</code> files and low possibility bound of
about <code>n(H;0.25%) = 2813.6</code> files <sup><a href="#user-content-fn-2-ca5fe5dc454924b78fee79247939c620" id="user-content-fnref-2-ca5fe5dc454924b78fee79247939c620" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup>, and is considered providing
enough security under most circumstances.</p>
<p dir="auto">The AES-256 key for encrypting the file system, is randomly generated
through a cryptologically secure random process, then encrypted and
authenticated by a root key supports <a href="https://en.wikipedia.org/wiki/Authenticated_encryption" rel="nofollow">AEAD</a>.
This extra indirection enables us to check whether proper key is
specified, and enables online decryption to protect the root key,
without sacrificing the performance.</p>
<h2 dir="auto"><a id="user-content-license" aria-hidden="true" href="#license"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>License</h2>
<p dir="auto">The project is licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">Apache-2.0</a>.
Anyone is free to modify and redistribute the code, however they
must swear the oath of keeping users&#39; data and secrets sacred and
depicts what they have modified for users&#39; judgement.</p>
<section data-footnotes="">
<ol dir="auto">
<li id="user-content-fn-1-ca5fe5dc454924b78fee79247939c620">
<p dir="auto">Storing your key as regular files on the disk directly can be
a security issue if your physical machine has been invaded. It&#39;s not
so risky if the key is transfered over TTY, pipe, socket, etc. <a href="#user-content-fnref-1-ca5fe5dc454924b78fee79247939c620" data-footnote-backref="" aria-label="Back to content"><g-emoji alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a></p>
</li>
<li id="user-content-fn-2-ca5fe5dc454924b78fee79247939c620">
<p dir="auto">Assume native file system supports file name of maximum 128
bytes, there&#39;re <code>(128-1) * 6 / 8 - 1 = 94.25</code> cases of file names&#39;
length. The number of outputs for file names&#39; nonces is
<code>H = 94.25 * (2^24) = 1581252608.0</code>. <a href="#user-content-fnref-2-ca5fe5dc454924b78fee79247939c620" data-footnote-backref="" aria-label="Back to content"><g-emoji alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a></p>
</li>
</ol>
</section>
</article>
          </div></div>
  </body>
</html>
