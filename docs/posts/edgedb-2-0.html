<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://www.edgedb.com/blog/edgedb-2-0">Original</a>
    <h1>EdgeDB 2.0</h1>
    
    <div id="readability-page-1" class="page"><div><div><div>
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<section data-section-id="edgedb-2-0" id="edgedb-2-0">
<!-- -->
<p>Today, just under 6 months after the release of 1.0 üèÅ, we‚Äôre excited
            to announce <b>EdgeDB 2.0</b>.</p>
<p>Since our 1.0 release in February, we‚Äôve published 3 minor versions in the 1.x
            line, started a <a href="https://discord.gg/edgedb">Discord</a> (750 members and
            counting!), accumulated a few thousand more GitHub stars, and grown to
            thousands of active users. We couldn‚Äôt be happier with how things
            have gone‚Äîand we have some crazy exciting stuff in the pipeline.</p>
<p>Back to 2.0. This release brings a slew of new features, including:</p>
<ul>
<li>
<p>a built-in admin UI;</p>
</li>
<li>
<p>a top-level <code>GROUP</code> statement in EdgeQL;</p>
</li>
<li>
<p>object-level security;</p>
</li>
<li>
<p>range types;</p>
</li>
<li>
<p>an official Rust client library (at long last!)</p>
</li>
<li>
<p>‚Ä¶and a lot more.</p>
</li>
</ul>
<div data-section-id="before-we-dive-in" id="before-we-dive-in">

<p>‚Ä¶let‚Äôs briefly discuss why to use EdgeDB as the database for your next project.</p>
<p>EdgeDB is a new database that extends the relational model to eliminate the
                objet-relational impedance mismatch. This lets you model and query your data
                in a more intuitive object-oriented way, while retaining the reliability and
                performance of the classic relational model. We call it a <a href="https://www.edgedb.com/#what_is_a_graph_relational_database_">graph-relational
                    database</a>.</p>
<p>By natively bridging the object-relational gap, EdgeDB eliminates the need for
                additional tooling like ORMs and middleware to manage data modeling,
                migrations, querying, and middleware. These are a de facto necessity when
                building applications with a traditional relational database. EdgeDB
                eliminates unnecessary layers from your software stack, enables powerful
                querying that‚Äôs impossible with ORMs and impractical with SQL, and brings
                significant runtime <a href="https://www.edgedb.com/blog/why-orms-are-slow-and-getting-slower">performance benefits</a>.</p>
<p>The full list of EdgeDB features printed on a thin strip of paper would
                probably stretch to the moon and back. But let‚Äôs enumerate some of the biggest
                ones:</p>
<p><b>A declarative schema</b></p>
<p>‚Ä¶which lets you express computed properties, inheritance, functions, complex
                constraints and indexes, and access control rules.</p>
<div><div><div><pre><span><span>type</span> User {
  <span>required</span> <span>property</span> email <span>-&gt;</span> <span>str</span> {
    <span>constraint</span> <span>exclusive</span>;
  }
}

<span>type</span> BlogPost {
  <span>required</span> <span>property</span> title <span>-&gt;</span> <span>str</span>;
  <span>required</span> <span>property</span> published <span>-&gt;</span> <span>bool</span> {
    <span>default</span> <span>:=</span> <span>false</span>
  };
  <span>link</span> author <span>-&gt;</span> User;

  <span>index</span> <span>on</span> (.title);
}</span></pre></div></div></div>
<p><b>A builtin migration system</b></p>
<p>‚Ä¶consisting of a database-native migration planner, automatic migration
                history tracking, and a CLI-based workflow.</p>
<div><div><div><div><pre>$ </pre><pre><span>edgedb migration create</span></pre></div><div><pre>Created dbschema/migrations/00001.edgeql</pre></div></div></div><div><div><div><pre>Applied dbschema/migrations/00001.edgeql</pre></div></div></div></div>
<p><b>A modern, lean query language</b></p>
<p>‚Ä¶that‚Äôs matches the expressive power of SQL while remaining more composable
                and less verbose (and eliminating <code>JOIN</code>!)</p>
<div><div><div><pre><span><span>select</span> BlogPost {
  title,
  trimmed_title <span>:=</span> <span>str_trim</span>(.title),
  author: {
    email
  }
}
<span>filter</span> <span>not</span> .published</span></pre></div></div></div>
<p><b>A TypeScript query builder</b></p>
<p>‚Ä¶that can express <em>arbitrary</em> EdgeQL queries and automatically infer the query
                return type.</p>
<div><div><div><pre><span>e<span>.</span><span>select</span><span>(</span>e<span>.</span>BlogPost<span>,</span> post <span>=&gt;</span> <span>(</span><span>{</span>
  title<span>:</span> <span>true</span><span>,</span>
  trimmed_title<span>:</span> e<span>.</span><span>str_trim</span><span>(</span>post<span>.</span>title<span>)</span><span>,</span>
  author<span>:</span> <span>{</span>
    email<span>:</span> <span>true</span>
  <span>}</span><span>,</span>
  filter<span>:</span> e<span>.</span><span>op</span><span>(</span><span>&#34;not&#34;</span><span>,</span> post<span>.</span>published<span>)</span>
<span>}</span><span>)</span><span>)</span></span></pre></div></div></div>
<p>And it‚Äôs 100% <a href="https://github.com/edgedb/edgedb">open source</a> and <b>powered by Postgres</b> under the
                hood.</p>
<p>For a more philosophical treatment of our motivations for building EdgeDB,
                check out our <a href="https://www.edgedb.com/blog/edgedb-1-0">EdgeDB 1.0 announcement</a>. In the meantime, let‚Äôs talk
                about 2.0.</p>
</div>
<div data-section-id="what-s-new-in-2-0" id="what-s-new-in-2-0">

<p>EdgeDB 2.0 improvements touch every aspect of the database: the type system,
                the query language, the client libraries and binary protocol, and the
                developer experience of building an app with EdgeDB.</p>
<p>Refer to the <a href="https://www.edgedb.com/docs/changelog/2_x">v2.0 changelog</a> for an overly detailed list of
                    features and fixes and instructions for upgrading your projects to EdgeDB
                    2.0.</p>
</div>
<div data-section-id="edgedb-ui" id="edgedb-ui">

<div><p><img src="https://www.edgedb.com/_images/_blog/bee230d0551d6227dc6e224e2a39377278c4accb-940.webp" width="2000" height="1236" loading="lazy" srcset="/_images/_blog/bee230d0551d6227dc6e224e2a39377278c4accb-940.webp 940w, /_images/_blog/bee230d0551d6227dc6e224e2a39377278c4accb-940-2x.webp 1880w, /_images/_blog/bee230d0551d6227dc6e224e2a39377278c4accb-770.webp 770w, /_images/_blog/bee230d0551d6227dc6e224e2a39377278c4accb-770-2x.webp 1540w" sizes="(max-width: 1920px) 940px, (max-width: 1440px) 840px, (max-width: 1024px) 680px, (max-width: 768px) 100vw, 1120px"/></p></div>
<p>EdgeDB UI is a beautiful, feature-rich admin panel baked directly into all
                EdgeDB 2.0+ instances. Open it by running <code>edgedb ui</code> in your project
                directory, which will open a <code>localhost</code> page in your default browser. It
                ships with:</p>
<ul>
<li>
<p>a data browser and editor;</p>
</li>
<li>
<p>a REPL for writing and executing EdgeQL queries;</p>
</li>
<li>
<p>a schema introspection tool with text-based and graphical
                        visualizations of the schema.</p>
</li>
</ul>
<p>Use EdgeDB UI to populate your new database with some test data, debug that
                complex EdgeQL query, or scroll around your schema graph admiringly.</p>
<p>Needless to say that this is just the beginning. In the future releases we‚Äôll
                continue to add new features to the UI, like a query plan visualizer, built-in
                documentation, and administration tools.</p>
</div>
<div data-section-id="the-group-statement" id="the-group-statement">

<p>The new top-level <a href="https://www.edgedb.com/docs/edgeql/group">GROUP</a> statement can be used to partition and
                aggregate data. The output of <code>GROUP</code> is a set of objects‚Äîjust like any old
                <code>SELECT</code> query. Each object represents a group and contains three fields:
                <code>grouping</code>, <code>key</code>, and <code>elements</code>. Here‚Äôs a simple example:</p>
<div><div><div><div><pre>db&gt; </pre><pre><span><span>group</span> Movie <span>by</span> .release_year;</span></pre></div><div><pre>{
  {
    key: {release_year: 2016},
    grouping: {&#39;release_year&#39;},
    elements: {
      default::Movie {title: &#39;Captain America: Civil War&#39;},
      default::Movie {title: &#39;Doctor Strange&#39;},
    },
  },
  {
    key: {release_year: 2017},
    grouping: {&#39;release_year&#39;},
    elements: {
      default::Movie {title: &#39;Guardians of the Galaxy Vol. 2&#39;},
      default::Movie {title: &#39;Spider-Man: Homecoming&#39;},
      default::Movie {title: &#39;Thor: Ragnarok&#39;},
    },
  },
  ...
}</pre></div></div></div></div>
<p>You can also group by arbitrary EdgeQL expressions, nested fetch properties
                and links on <code>elements</code>, and run complex analytical queries with grouping
                sets (hello <code>CUBE</code> and <code>ROLLUP</code>!). Though its true power lies in its
                ability to <em>compose</em> with the rest of the language:</p>
<div><div><div><div><pre>db&gt; 
... 
... 
... 
... 
... 
... 
... 
... 
... 
... 
... </pre><pre><span><span>with</span>
  groups <span>:=</span> (
    <span>group</span> Movie
    <span>using</span>
      starts_with_vowel <span>:=</span> <span>re_test</span>(<span>&#39;(?i)^[aeiou]&#39;</span>, .title),
    <span>by</span> starts_with_vowel
  )
<span>select</span> groups {
  starts_with_vowel <span>:=</span> .key.starts_with_vowel,
  <span>count</span> <span>:=</span> <span>count</span>(.elements),
  mean_title_length <span>:=</span> math::<span>mean</span>(<span>len</span>(.elements.title))
};</span></pre></div><div><pre>{
  {starts_with_vowel: false, count: 12, mean_title_length: 19.75},
  {starts_with_vowel: true, count: 3, mean_title_length: 19.66},
}</pre></div></div></div></div>
<p>In SQL, <code>GROUP BY</code> is a clause tacked onto the end of the <code>SELECT</code>
                statement that dramatically changes the intent of the query and imposes a list
                of requirements. (For instance, all columns other than the grouped keys are to
                be referenced only as arguments to aggregate functions.) By contrast, the
                EdgeQL syntax allows for <em>frictionless composability</em>, giving it an edge (üòò)
                over SQL.</p>
</div>
<div data-section-id="object-level-security-and-global-variables" id="object-level-security-and-global-variables">
<h2 id="object-level-security-and-global-variables">Object-level security and global variables</h2>
<p>EdgeDB‚Äôs powerful schema current supports a full set of primitive datatypes,
                descriptive object syntax, type mixins, dynamically computed properties and
                links, complex constraints and indexes, user-defined functions, and more. It‚Äôs
                more than capable of representing a data model of any complexity.</p>
<p>With EdgeDB 2.0, we‚Äôre taking this to the next level. With <b>object-level
                    security</b> you can implement your application‚Äôs access control logic at the
                schema level. EdgeDB will transparently enforce it everywhere and act as a
                single source of truth in your infrastructure.</p>
<p>In practice, this means adding <em>access policies</em> to your object types that
                restrict the set of objects that can be selected, inserted, updated, or
                deleted for a particular type. Let‚Äôs start with a simple blog schema with no
                access policies.</p>
<div><div><div><pre><span><span>type</span> User {
  <span>required</span> <span>property</span> email <span>-&gt;</span> <span>str</span> {
    <span>constraint</span> <span>exclusive</span>;
  };
}

<span>type</span> BlogPost {
  <span>required</span> <span>property</span> title <span>-&gt;</span> <span>str</span>;
  <span>link</span> author <span>-&gt;</span> User;
}</span></pre></div></div></div>
<p>We‚Äôre going to add an access policy to ensure that posts can only be updated
                by their <code>author</code>. But how do we communicate to the database who is
                executing a particular query?</p>
<div><div><div><pre><span>  <span>global</span> current_user <span>-&gt;</span> <span>uuid</span>;

  <span>type</span> User {
    <span>required</span> <span>property</span> email <span>-&gt;</span> <span>str</span> {
      <span>constraint</span> <span>exclusive</span>;
    };
  }

  <span>type</span> BlogPost {
    <span>required</span> <span>property</span> title <span>-&gt;</span> <span>str</span>;
    <span>link</span> author <span>-&gt;</span> User;
  }</span></pre></div></div></div>
<p>We add a <b>global variable</b> called <code>current_user</code>. Global variables
                are a new mechanism for defining a <em>context</em> for query execution. Once a
                global has been declared in your schema, you can easily set a value for it via
                the client API or in REPL.</p>
<div><div><div><div><div><pre><span><span>import</span> createClient <span>from</span> <span>&#39;edgedb&#39;</span><span>;</span>

<span>const</span> client <span>=</span> <span>createClient</span><span>(</span><span>)</span><span>;</span>

<span>const</span> <span>myApiHandler</span> <span>=</span> <span>async</span> <span>(</span>userId<span>:</span> <span>string</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> scopedClient <span>=</span> client<span>.</span><span>withGlobals</span><span>(</span><span>{</span>
    current_user<span>:</span> userId<span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>return</span> <span>await</span> scopedClient<span>.</span><span>query</span><span>(</span>
    <span><span>`</span><span>select global current_user;</span><span>`</span></span>
  <span>)</span><span>;</span>
<span>}</span></span></pre></div></div></div></div><div><div><div><div><pre><span><span>import</span> edgedb

client <span>=</span> edgedb<span>.</span>create_client<span>(</span><span>)</span>

<span>async</span> <span>def</span> <span>my_api_handler</span><span>(</span>user_id<span>)</span><span>:</span>
    scoped_client <span>=</span> client<span>.</span>with_globals<span>(</span><span>{</span>
        <span>&#39;current_user&#39;</span><span>:</span> user_id<span>,</span>
    <span>}</span><span>)</span>

    <span>return</span> <span>await</span> scoped_client<span>.</span>query<span>(</span>
      <span>&#34;select global current_user;&#34;</span>
    <span>)</span></span></pre></div></div></div></div><div><div><div><div><div><pre>db&gt; 
... </pre><pre><span><span>set</span> <span>global</span> current_user <span>:=</span>
  (<span>SELECT</span> User <span>FILTER</span> .email <span>=</span> <span>&#39;elvis@edgedb.com&#39;</span>).id;</span></pre></div></div></div><div><div><div><pre>db&gt; </pre><pre><span><span>select</span> <span>global</span> current_user;</span></pre></div><div><pre>{&lt;uuid&gt;&#34;5b4d1530-0e0b-11ed-ae2a-133197f4faf5&#34;}</pre></div></div></div></div></div></div>
<p>Our client libraries efficiently pack and transfer global variables
                    as well as transparently handle the necessary client-side connection pooling
                    and protocol-level magic for you.</p>
<p>Importantly (and unlike <a href="https://www.edgedb.com/docs/edgeql/parameters#ref-eql-params"><span>query parameters</span></a>) you can
                reference global variables in any context, including in your schema. Let‚Äôs use
                <code>current_user</code> to add a new access policy to <code>BlogPost</code>.</p>
<div><div><div><pre><span>  <span>global</span> current_user <span>-&gt;</span> <span>uuid</span>;

  <span>type</span> User {
    <span>required</span> <span>property</span> email <span>-&gt;</span> <span>str</span> {
      <span>constraint</span> <span>exclusive</span>;
    };
  }

  <span>type</span> BlogPost {
    <span>required</span> <span>property</span> title <span>-&gt;</span> <span>str</span>;
    <span>link</span> author <span>-&gt;</span> User;
    <span>access</span> <span>policy</span> own_posts
       <span>allow</span> <span>all</span>
       <span>using</span> (.author.id <span>?=</span> <span>global</span> current_user)
  }</span></pre></div></div></div>
<p>The new <em>access policy</em> is called <code>own_posts</code> and it <em>allows</em>
<b>all</b>
                operations‚Äîselect, update, insert, delete‚Äîif the post‚Äôs <code>.author.id</code>
                property is equal to the value of <code>current_user</code> global variable.</p>
<p>We are excited about how flexible the design of access policies turned out
                to be:</p>
<ul>
<li>
<p>Policies can <code>allow</code> or <code>deny</code> access to specific operations, including
                        <code>select</code>, <code>insert</code>, <code>delete</code>, and <code>update</code> (which can be further
                        subdivided into <code>update read</code> and <code>update write</code>);</p>
</li>
<li>
<p>The <code>using</code> expression can correspond to an arbitrary EdgeQL expression;</p>
</li>
<li>
<p>You can add as many policies as you like.</p>
</li>
</ul>
<p>This is a new versatile mechanism that can be used to implement a broad
                range of access logic. Here‚Äôs an example on how to use access policies
                to implement a temporal mixin type:</p>
<div><div><div><pre><span><span>abstract</span> <span>type</span> Temporal {
  <span>required</span> <span>property</span> validity_period <span>-&gt;</span> <span>range</span><span>&lt;</span><span>datetime</span><span>&gt;</span>;

  <span>access</span> <span>policy</span> hide_invalid <span>allow</span> <span>all</span> <span>using</span> (
    <span>contains</span>(.validity_period, <span>datetime_of_transaction</span>())
  )
}</span></pre></div></div></div>
<p>Refer to the <a href="https://www.edgedb.com/docs/datamodel/access_policies#ref-datamodel-access-policies"><span>documentation</span></a>
                for more details and examples.</p>
</div>
<div data-section-id="and-so-much-more" id="and-so-much-more">
<h2 id="and-so-much-more">‚Ä¶and so much more!</h2>
<p><b>Rust.</b> The official Rust <a href="https://crates.io/crates/edgedb-tokio">client</a> is here, finally! üéâ
                While we are using Rust pretty extensively (e.g. our CLI is 100% Rust),
                it took us some time to figure out and tune the API design of the client
                library. This brings the list of first-party client libraries to 4,
                including <a href="https://github.com/edgedb/edgedb-js">TypeScript</a>, <a href="https://github.com/edgedb/edgedb-python">Python</a>, and
                <a href="https://github.com/edgedb/edgedb-go">Go</a>, along with community-maintained packages for
                <a href="https://github.com/quinchs/EdgeDB.Net">.NET</a> and <a href="https://github.com/nsidnev/edgedb-elixir">Elixir</a>.</p>
<p><b>Protocol.</b> EdgeDB‚Äôs <a href="https://www.edgedb.com/docs/reference/protocol/index">binary protocol</a> reached version 1.0,
                receiving multiple enhancements:</p>
<ul>
<li>
<p>Fully stateless: this enables having multiple concurrent sessions
                        within one connection, as well as tunneling the protocol over HTTP.
                        The HTTP tunneling is already used to implement the REPL experience
                        of the new UI, and can later be used to enable new experiences, such
                        as integration with environments like <a href="https://vercel.com/live">Next.js Live</a>.</p>
</li>
<li>
<p>Support for global variables and local state. Upon connecting clients
                        receive the full state descriptor to be able to serialize values
                        for global variables and configuration.</p>
</li>
<li>
<p>Optimized parse/execute flow. Clients require even fewer back
                        and forth communications with the server, improving latency.</p>
</li>
</ul>
<p><b>Efficient local development.</b> EdgeDB 2.0 supports socket activation for
                development instances, which means that it doesn‚Äôt run on your devbox until
                you actually try to use it. And when you do use it, all internal process pools
                autoscale to use the minimal amount of resources. This conserves your machine‚Äôs
                RAM and CPU and allows you to work on multiple EdgeDB projects without
                experiencing any slowdowns.</p>
<p><b>Ranges.</b> EdgeDB 2.0 <a href="https://www.edgedb.com/docs/stdlib/range">supports range types</a> that can represent
                intervals of values, such as date/time values or 64-bit integers. Ranges
                implement a number of operators and built-in functions, and support casting
                to JSON and back.</p>
<p><b>Date/time.</b> Date/time API was <a href="https://github.com/edgedb/rfcs/blob/master/text/1013-datetime-arithmetic.rst">tweaked</a> to make
                arithmetic on local date and local time more sound. A new
                <a href="https://www.edgedb.com/docs/stdlib/datetime#type::cal::date_duration">cal::date_duration</a> type was added along with a several new
                helper functions.</p>
<p>The list continues, read it in full in the v2 <a href="https://www.edgedb.com/docs/changelog/2_x">changelog</a>!</p>
</div>
<div data-section-id="future" id="future">

<p>We plan to release EdgeDB 3.0 in about 6 months. We‚Äôre sticking to a fast
                release cadence because there‚Äôs so much we want to do! Currently topping the
                todo list:</p>
<ul>
<li>
<p><code>EXPLAIN</code> command to analyze EdgeQL queries;</p>
</li>
<li>
<p>user-definable error types (exceptions);</p>
</li>
<li>
<p>support for splats in EdgeQL shapes;</p>
</li>
<li>
<p>role-based access control;</p>
</li>
<li>
<p>full-text search support.</p>
</li>
</ul>
<p>Last, but not least, we are close to launching a preview of <b>EdgeDB Cloud</b>,
                a fully-managed hosted EdgeDB service that will make it possible
                to spin up a production-ready instances with a single CLI command.
                Sign up below to be the first to experience it. üå§</p>

<p>In the meantime, join us on <a href="https://discord.gg/edgedb">Discord</a>, give us a star on <a href="https://github.com/edgedb/edgedb">GitHub</a>, and‚Äîmost importantly‚Äîgo build something wonderful with EdgeDB! ‚ù§Ô∏è</p>
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
<!-- -->
</div>
</section>
</div></div></div></div>
  </body>
</html>
