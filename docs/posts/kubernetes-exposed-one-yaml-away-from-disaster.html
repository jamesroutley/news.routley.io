<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://blog.aquasec.com/kubernetes-exposed-one-yaml-away-from-disaster">Original</a>
    <h1>Kubernetes Exposed: One YAML Away from Disaster</h1>
    
    <div id="readability-page-1" class="page"><div>
<div>
<div data-widget-type="blog_content" data-x="0" data-w="12">


<div>
  <div>
    <div>

      

      <p><span id="hs_cos_wrapper_post_body" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p>If you thought that falling victim to ransomware, or a hacker hijacking your workstation was a nightmare, consider the potential catastrophe of having your Kubernetes (k8s) cluster hijacked. It could be a disaster magnified a million times over.</p>

<p>Kubernetes has gained immense popularity among businesses in recent years due to its undeniable prowess in orchestrating and managing containerized applications. It consolidates your source code, cloud accounts, and secrets into a single hub. However, in the wrong hands, access to a company&#39;s k8s cluster could be not just harmful, but potentially catastrophic. </p>
<p>In our investigation, we uncovered Kubernetes clusters belonging to more than 350 organizations, open-source projects, and individuals, openly accessible and largely unprotected. At least 60% of them were breached and had an active campaign that deployed malware and backdoors. </p>
<p>Most of these clusters were tied to small to medium-sized organizations, with a notable subset connected to vast conglomerates, some of them even part of the Fortune 500. The organizations we identified cut across a variety of sectors, encompassing Financial, Aerospace, Automotive, Industrial, Security, among others. </p>
<p>We found two main misconfigurations among the things we discovered. The most common one, was broadly covered in the past, but still a troubling issue, is allowing anonymous access with privileges. The second issue that stood above the rest is running <span>`kubectl`</span> proxy with some arguments that lead to unknowingly exposing the cluster to the internet. For a more comprehensive understanding of these misconfigurations, we will dive deeper into them below. </p>
<p>We will elaborate on the methodology of our research and provide an in-depth exploration of our significant findings. </p>
<h2>Finding exposed k8s clusters </h2>
<p>Attackers often use search engines such as Shodan, Censys, and Zoomeye to find misconfigured or vulnerable hosts. They also search the internet for exposed hosts using botnets or tools like masscan and Zgrab to quickly scan wide IP ranges and identify services on exposed ports. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg?width=1000&amp;height=644&amp;name=Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg" alt="Figure-1---Screen-Shot-2023-07-13-at-10.08.25-" width="1000" height="644" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg?width=500&amp;height=322&amp;name=Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg?width=1000&amp;height=644&amp;name=Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg?width=1500&amp;height=966&amp;name=Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg?width=2000&amp;height=1288&amp;name=Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg?width=2500&amp;height=1610&amp;name=Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg?width=3000&amp;height=1932&amp;name=Figure-1---Screen-Shot-2023-07-13-at-10.08.25-.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>While this initial number (~3 million) is enormous it does not reflect how many clusters are at risk, hence we modified our search queries to look specifically for API servers which can be exploited by attackers. </p>
<p>Over a period of three months, we conducted a few separate searches using Shodan. In our initial query, we identified 120 IP addresses. Each subsequent search (weekly) revealed approximately 20 new IP addresses. Cumulatively, throughout the duration of this research, we pinpointed just over 350 distinct IP addresses. </p>
<h3>General findings </h3>
<p>Upon analyzing the newly discovered 350+ hosts, we found that the majority (72%) had ports 443 and 6443 exposed. These are the default HTTPS ports. We found that 19% of the hosts used HTTP ports such as 8001 and 8080, while the rest used less common ports (for instance 9999). </p>
<p>The host distribution revealed that while most (85%) had between 1 to 3 nodes, some hosted between 20 to 30 nodes within their Kubernetes clusters. The higher node count might indicate larger organizations or more significant clusters. </p>
<p>As for geographical distribution, the majority of servers had geo-location affiliation to North America, with a substantial footprint of AWS (~80%). In contrast, various Chinese cloud providers accounted for about 17% of the servers. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/figure-2-k8s-blog-8-2023.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/figure-2-k8s-blog-8-2023.jpg?width=1000&amp;height=492&amp;name=figure-2-k8s-blog-8-2023.jpg" alt="figure-2-k8s-blog-8-2023" width="1000" height="492" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/figure-2-k8s-blog-8-2023.jpg?width=500&amp;height=246&amp;name=figure-2-k8s-blog-8-2023.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/figure-2-k8s-blog-8-2023.jpg?width=1000&amp;height=492&amp;name=figure-2-k8s-blog-8-2023.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/figure-2-k8s-blog-8-2023.jpg?width=1500&amp;height=738&amp;name=figure-2-k8s-blog-8-2023.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/figure-2-k8s-blog-8-2023.jpg?width=2000&amp;height=984&amp;name=figure-2-k8s-blog-8-2023.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/figure-2-k8s-blog-8-2023.jpg?width=2500&amp;height=1230&amp;name=figure-2-k8s-blog-8-2023.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/figure-2-k8s-blog-8-2023.jpg?width=3000&amp;height=1476&amp;name=figure-2-k8s-blog-8-2023.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 2: Geo-location of the k8s clusters, as can be seen most of them in the US </p>
<p>The API server is used to access the Kubernetes secrets, thus open access enables an attacker to take full control over the cluster. However, Kubernetes clusters usually do not just store their own secrets. In many instances, the Kubernetes cluster is a part of the organization&#39;s Software Development Life Cycle (SDLC), thereby the Kubernetes cluster needs access to Source Code Management (SCM), Continuous Integration/Continuous Deployment (CI/CD), registries, and the Cloud Service Provider.</p>
<p>In the Kubernetes secrets there was a wide range of additional secrets associated with various environments. These include SCM environments like GitHub, CI platforms like Jenkins, various registries such as Docker Hub, external database services like Redis or PostgreSQL, and many others. </p>
<p>In our analysis of the cluster owners&#39; identities, we discovered that they ranged from Fortune 500 companies to small, medium, and large-sized enterprises. Interestingly, we also encountered open-source projects, which, if compromised, could trigger a supply chain infection vector with implications for millions of users. </p>
<p>To underscore the potential ramifications of an exposed Kubernetes cluster, consider the case of a small analytics firm we discovered. While a breach in this company wouldn&#39;t necessarily garner widespread media attention, one of its customers is a top-tier Fortune 500 company with a multi-billion-dollar revenue stream. Since this company was an analytics services provider, the Kubernetes cluster contained high volume of highly sensitive information of the fortune-500 company in various databases hosted on the cluster, since the cluster was exposed, this data was exposed, and the exposure of this data could significantly impact the business operations of this large enterprise. </p>
<h3>What can be found in exposed k8s clusters? </h3>
<p>Kubernetes clusters have emerged as the preferred solution for practitioners looking to manage containerized applications effectively. These clusters often contain various software, services, and resources, enabling users to deploy and scale applications with relative ease. </p>
<p>Housing a wide array of sensitive and valuable assets, Kubernetes clusters can store customer data, financial records, intellectual property, access credentials, secrets, configurations, container images, infrastructure credentials, encryption keys, certificates, and network or service information. </p>
<p>However, when the API server permits anyone to access the API server and query the cluster. The following are some of the commands that can yield insightful information: </p>
<div data-hs-responsive-table="true">
<table>
<tbody>
<tr>
<td><span><strong>Command</strong></span></td>
<td>
<p><span><strong>Usability</strong></span></p>
</td>
</tr>
<tr>
<td data-celllook="0">
<p><strong><span data-contrast="auto"><span>‘</span><span>/</span><span>api</span><span>/v1/pods</span><span>’</span></span></strong><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
<td data-celllook="0">
<p><span data-contrast="auto"><span>Lists the </span><span>available </span><span>pods</span></span><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="0">
<p><strong><span data-contrast="auto"><span>‘</span><span>/</span><span>api</span><span>/v1/</span><span>nodes’</span></span></strong><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
<td data-celllook="0">
<p><span data-contrast="auto"><span>Lists all the available nodes</span></span><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="0">
<p><strong><span data-contrast="auto"><span>‘/</span><span>api</span><span>/v1/</span><span>configmaps</span><span>’</span></span></strong><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
<td data-celllook="0">
<p><span data-contrast="auto"><span>List all the configurations for the k8s cluster</span></span><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="0">
<p><strong><span data-contrast="auto"><span>‘/</span><span>api</span><span>/v1/</span><span>secrets</span><span>’</span></span></strong><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
<td data-celllook="0">
<p><span data-contrast="auto"><span>Lists all the secrets stored in the </span><span>etcd</span></span><span data-ccp-props="{&#34;201341983&#34;:0,&#34;335559740&#34;:259}"> </span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p>The secrets often contain information about internal or external Registries. In many cases developers configured a configuration file of a registry (such as <span>“.dockerconfig”</span>), inside there were links to other environments and secrets or credentials (including Docker Hub, Cloud Service Provider, and internally managed ones). Threat actors can use these credentials to expand their reach. They can pull further IP and sensitive information or poison the registry (if the key allows that) to run malicious code on further systems in the network. In addition, in many cases we have seen secrets to SCMs such as GitHub, GitLab, Bitbucket etc. Access tokens allow an attacker to clone the git repository. In some cases, attackers can even add new malicious code to the SCM (if the key allows that).</p>
<p>While it may appear innocuous to grant universal access for listing the pods, potential problems can arise when a developer opts to include secrets within the environment variables, as demonstrated in the following example: </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg?width=1000&amp;height=505&amp;name=Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg" alt="Figure-3---Screen-Shot-2023-08-01-at-8.46.20" width="1000" height="505" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg?width=500&amp;height=253&amp;name=Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg?width=1000&amp;height=505&amp;name=Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg?width=1500&amp;height=758&amp;name=Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg?width=2000&amp;height=1010&amp;name=Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg?width=2500&amp;height=1263&amp;name=Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg?width=3000&amp;height=1515&amp;name=Figure-3---Screen-Shot-2023-08-01-at-8.46.20.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 3: A screenshot from a k8s pods list, that shows how developers sometimes insert secrets to environment variables and mistakenly expose invaluable secrets</p>
<p>As depicted in Figure 3 above, the pods environment variables which we were able to list using <span>‘/api/v1/pods’</span> encompasses extremely sensitive secrets that impact the operational aspects of the organization. These include credentials for the cloud provider (in this case, AWS), various databases, email and phone services, Google app services, among others. </p>
<p>Another potential attack vector within a Kubernetes cluster is accessing internal services. Attackers can gain access to these services, which frequently operate without authentication. In cases where authentication is required, the credentials can typically be found within the Kubernetes secrets space. Services of type <span>‘ClusterIP’</span> that expose http/s application can be reached using a URL of the following structure: </p>
<p>https[:]//IP-ADDRESS[:]PORT/api/v1/namespaces/the-service-namespace/services/https:servicename:port/proxy </p>
<p>In Figure 4 below, an internal Harbor that was discovered in one of the exposed Kubernetes clusters is presented. The user has admin rights, and there are two projects, one of which is defined as private. This could potentially mean that sensitive internal code is susceptible to exposure to attackers. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg?width=1000&amp;height=550&amp;name=Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg" alt="Figure-4--Screen-Shot-2023-06-12-at-9.40.12" width="1000" height="550" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg?width=500&amp;height=275&amp;name=Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg?width=1000&amp;height=550&amp;name=Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg?width=1500&amp;height=825&amp;name=Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg?width=2000&amp;height=1100&amp;name=Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg?width=2500&amp;height=1375&amp;name=Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg?width=3000&amp;height=1650&amp;name=Figure-4--Screen-Shot-2023-06-12-at-9.40.12.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 4: Unauthenticated internal Harbor service allow access to a private project</p>
<p>The following example, showcased in Figure 5, demonstrates the risks of an exposed Elasticsearch database. As a part of the Kubernetes cluster, and given its perception as an internal service, this database is set up without any authentication. This lack of security measures enables an attacker to readily access and harvest sensitive data. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg?width=1000&amp;height=686&amp;name=Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg" alt="Figure-5---Screen-Shot-2023-07-17-at-10.09.20" width="1000" height="686" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg?width=500&amp;height=343&amp;name=Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg?width=1000&amp;height=686&amp;name=Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg?width=1500&amp;height=1029&amp;name=Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg?width=2000&amp;height=1372&amp;name=Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg?width=2500&amp;height=1715&amp;name=Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg?width=3000&amp;height=2058&amp;name=Figure-5---Screen-Shot-2023-07-17-at-10.09.20.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 5: Internal Elasticsearch service can be queried from the outside</p>
<p>Most of the clusters we encountered were only accessible for a few hours, but our data collection tools managed to identify and record the exposed information. This highlights a sobering truth about such misconfigurations; even if promptly detected and corrected, a well-prepared attacker with automation capabilities can still gain access to the Kubernetes cluster at a later stage or infiltrate various other elements of the SDLC. Because, once the secrets were exposed to threat actors, they can now use them to gain authenticated access to your cluster.</p>
<p>The API server is used to run containers in pods. An attacker can run a container (or exec to an existing one) and try querying the meta-data server to get credentials for a given role attached to the cluster. </p>
<p>Using “http://169.254.169.254/latest/meta-data/iam/security-credentials/*” </p>
<p>This technique allows attackers a foothold in the cloud account using the permissions attached to this EKS cluster. Needless to say, this is applicable with other cloud service providers. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-6---carbon-(15).jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-6---carbon-(15).jpg?width=1000&amp;height=395&amp;name=Figure-6---carbon-(15).jpg" alt="Figure-6---carbon-(15)" width="1000" height="395" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-6---carbon-(15).jpg?width=500&amp;height=198&amp;name=Figure-6---carbon-(15).jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-6---carbon-(15).jpg?width=1000&amp;height=395&amp;name=Figure-6---carbon-(15).jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-6---carbon-(15).jpg?width=1500&amp;height=593&amp;name=Figure-6---carbon-(15).jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-6---carbon-(15).jpg?width=2000&amp;height=790&amp;name=Figure-6---carbon-(15).jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-6---carbon-(15).jpg?width=2500&amp;height=988&amp;name=Figure-6---carbon-(15).jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-6---carbon-(15).jpg?width=3000&amp;height=1185&amp;name=Figure-6---carbon-(15).jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p><span>Figure 6: In the secrets API we found many exposed keys. In the screenshot you can see one of GCS, containing private and access keys</span>  </p>
<h3>Ongoing Campaigns Against k8s Clusters </h3>
<p>We found that approximately 60% of the clusters were actively under attack by a cryptominers. Over the past 2 years, we have been running a Kubernetes cluster with various of its components as honeypots. We used the data from our honeypots to shed a brighter light on these on-going campaigns. </p>
<p>We found that: </p>
<ol>
<li><span>Currently, there are 3 main running campaigns aimed at mine cryptocurrency. </span></li>
<li>Attackers collect secrets from exposed clusters in the wild and test what they can do with them.</li>
<li>The RBAC buster.</li>
<li>The TeamTNT campaign. </li>
</ol>

<h3>Cryptomining campaigns</h3>
<p><span><span>Lchaia/xmrig </span></span></p>
<p>Utilizing the daemonset object feature which allows the threat actor to deploy pods on each individual node with a single call to the API server, we have seen a campaign that attacked many servers in the wild and accumulated over 1.4 million pulls. </p>
<p>The threat actor deployed from Docker Hub the container image lchaia/xmrig:latest. As can be seen in the container image name, this is an xmrig miner which is mining Monero cryptocoin. The threat actor used the pool moneroocean.stream (44[.]196[.]193[.]227), with the wallet ID  </p>
<p>47C9nKzzPYWJPRBSjPUbmK7ghZDk3zfZx9kXh9WyetKS8Dwy7eDVpf4FKVctsuz48UEcJLt53SEFBYYWRqZi3TxhMcbGWub. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/figure-7-k8s-blog-8-2023.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/figure-7-k8s-blog-8-2023.jpg?width=336&amp;height=126&amp;name=figure-7-k8s-blog-8-2023.jpg" alt="figure-7-k8s-blog-8-2023" width="336" height="126" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/figure-7-k8s-blog-8-2023.jpg?width=168&amp;height=63&amp;name=figure-7-k8s-blog-8-2023.jpg 168w, https://blog.aquasec.com/hs-fs/hubfs/figure-7-k8s-blog-8-2023.jpg?width=336&amp;height=126&amp;name=figure-7-k8s-blog-8-2023.jpg 336w, https://blog.aquasec.com/hs-fs/hubfs/figure-7-k8s-blog-8-2023.jpg?width=504&amp;height=189&amp;name=figure-7-k8s-blog-8-2023.jpg 504w, https://blog.aquasec.com/hs-fs/hubfs/figure-7-k8s-blog-8-2023.jpg?width=672&amp;height=252&amp;name=figure-7-k8s-blog-8-2023.jpg 672w, https://blog.aquasec.com/hs-fs/hubfs/figure-7-k8s-blog-8-2023.jpg?width=840&amp;height=315&amp;name=figure-7-k8s-blog-8-2023.jpg 840w, https://blog.aquasec.com/hs-fs/hubfs/figure-7-k8s-blog-8-2023.jpg?width=1008&amp;height=378&amp;name=figure-7-k8s-blog-8-2023.jpg 1008w" sizes="(max-width: 336px) 100vw, 336px"/></a></p>
<p>Figure 7: lchaia/xmrig container image in Docker Hub with over 1 million pulls </p>
<p>The container deployed is <span>“lchaia/xmrig”.</span> We were able to find the person’s GitHub profile <a href="https://github.com/leonardochaia">https://github.com/leonardochaia </a></p>
<p>This wasn’t a single campaign. Next, the attacker utilized TOR exit node to conceal his IP address and launched the attack 282 consecutive times. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-8---carbon-(11).jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-8---carbon-(11).jpg?width=1000&amp;height=903&amp;name=Figure-8---carbon-(11).jpg" alt="Figure-8---carbon-(11)" width="1000" height="903" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-8---carbon-(11).jpg?width=500&amp;height=452&amp;name=Figure-8---carbon-(11).jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-8---carbon-(11).jpg?width=1000&amp;height=903&amp;name=Figure-8---carbon-(11).jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-8---carbon-(11).jpg?width=1500&amp;height=1355&amp;name=Figure-8---carbon-(11).jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-8---carbon-(11).jpg?width=2000&amp;height=1806&amp;name=Figure-8---carbon-(11).jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-8---carbon-(11).jpg?width=2500&amp;height=2258&amp;name=Figure-8---carbon-(11).jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-8---carbon-(11).jpg?width=3000&amp;height=2709&amp;name=Figure-8---carbon-(11).jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 8: Daemonset execution as recorded in our honeypot of the lchaia/xmrig container </p>
<p><span>The ssww attack </span></p>
<p>This campaign is a bit more aggressive. First the attacker lists all the available nodes. Next kills some competing campaigns, with the command shown in figure 9 below. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-9---carbon-(34).jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-9---carbon-(34).jpg?width=1000&amp;height=74&amp;name=Figure-9---carbon-(34).jpg" alt="Figure-9---carbon-(34)" width="1000" height="74" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-9---carbon-(34).jpg?width=500&amp;height=37&amp;name=Figure-9---carbon-(34).jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-9---carbon-(34).jpg?width=1000&amp;height=74&amp;name=Figure-9---carbon-(34).jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-9---carbon-(34).jpg?width=1500&amp;height=111&amp;name=Figure-9---carbon-(34).jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-9---carbon-(34).jpg?width=2000&amp;height=148&amp;name=Figure-9---carbon-(34).jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-9---carbon-(34).jpg?width=2500&amp;height=185&amp;name=Figure-9---carbon-(34).jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-9---carbon-(34).jpg?width=3000&amp;height=222&amp;name=Figure-9---carbon-(34).jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Then the attacker creates a daemonset with a cron command. This daemonset mounts the filesystem of the host with root privileges. Thus, the cron is written directly on the host, each host/node actually, which promises both persistence, in case the misconfiguration is detected and fixed, and also high privileges on each host.  When the cron is executed, it initiates an attack that runs a cryptominer. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg?width=1000&amp;height=535&amp;name=Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg" alt="Figure-10---Screen-Shot-2023-07-18-at-9.48.36" width="1000" height="535" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg?width=500&amp;height=268&amp;name=Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg?width=1000&amp;height=535&amp;name=Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg?width=1500&amp;height=803&amp;name=Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg?width=2000&amp;height=1070&amp;name=Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg?width=2500&amp;height=1338&amp;name=Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg?width=3000&amp;height=1605&amp;name=Figure-10---Screen-Shot-2023-07-18-at-9.48.36.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 10: ssww attack as recorded in our honeypot </p>
<p><span>The Dero campaign </span></p>
<p>This campaign was initially reported by CrowdStrike. They only reported, however, about the <span>‘pauseyyf/pause:latest’</span> container image, while we found additional container images under the <span>‘alpineyyf’</span> account which had more activity. </p>
<p>The <span>‘pauseyyf/pause’</span> container image had 10K pulls, while <span>‘alpineyyf/pause’</span> accumulated 46K pulls and <span>‘alpineyyf/alpins’ </span>with over 100K pulls. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg?width=336&amp;height=117&amp;name=Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg" alt="Figure-11--Screen-Shot-2023-03-28-at-14.28.22" width="336" height="117" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg?width=168&amp;height=59&amp;name=Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg 168w, https://blog.aquasec.com/hs-fs/hubfs/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg?width=336&amp;height=117&amp;name=Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg 336w, https://blog.aquasec.com/hs-fs/hubfs/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg?width=504&amp;height=176&amp;name=Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg 504w, https://blog.aquasec.com/hs-fs/hubfs/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg?width=672&amp;height=234&amp;name=Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg 672w, https://blog.aquasec.com/hs-fs/hubfs/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg?width=840&amp;height=293&amp;name=Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg 840w, https://blog.aquasec.com/hs-fs/hubfs/Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg?width=1008&amp;height=351&amp;name=Figure-11--Screen-Shot-2023-03-28-at-14.28.22.jpg 1008w" sizes="(max-width: 336px) 100vw, 336px"/></a></p>
<p><span>Figure 11: The Dero campaign is pulling container images from Docker Hub; this one has over 100K pulls</span> </p>
<p><span>The RBAC buster campaign </span></p>
<p>This is another campaign that exploits the RBAC to create a very hidden backdoor, this was discovered as part of this research. We published a separate blog about it, you can read further <a href="https://blog.aquasec.com/leveraging-kubernetes-rbac-to-backdoor-clusters%C2%A0" rel="noopener" target="_blank">here</a>. </p>
<p><span>TeamTNT campaign </span></p>
<p>We recently reported a novel highly aggressive campaign by TeamTNT (<a href="https://blog.aquasec.com/threat-alert-anatomy-of-silentbobs-cloud-attack%C2%A0" rel="noopener" target="_blank">part1</a>, <a href="https://blog.aquasec.com/teamtnt-reemerged-with-new-aggressive-cloud-campaign%C2%A0" rel="noopener" target="_blank">part2</a>). In this campaign TeamTNT is searching for and collecting cloud service providers tokens (AWS, Azure, GCP etc). </p>
<p>Once collected they are actively using these credentials to collect further information about the cloud account and the possible targets that can be gathered, such as storage environments such as S3 and Blobs, Lambdas, and functions, etc. </p>
<h3>The attack vectors in focus </h3>
<p>We have identified two common misconfigurations, widely found in organizations, and actively exploited in the wild.</p>
<p><span>Misconfiguration 1 – anonymous user with high privileges </span></p>
<p>In many cases unauthenticated requests to the cluster are enabled by default. It means that anyone can send requests and understand that the communication is with a k8s cluster, but it does not mean that anyone can get access to the cluster. This is true in native k8s environment and even on some cloud providers managed clusters, and the response an unauthenticated user received (as can be seen in figure 12 below). </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-12---api-server-flag.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-12---api-server-flag.jpg?width=1000&amp;height=166&amp;name=Figure-12---api-server-flag.jpg" alt="Figure-12---api-server-flag" width="1000" height="166" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-12---api-server-flag.jpg?width=500&amp;height=83&amp;name=Figure-12---api-server-flag.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-12---api-server-flag.jpg?width=1000&amp;height=166&amp;name=Figure-12---api-server-flag.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-12---api-server-flag.jpg?width=1500&amp;height=249&amp;name=Figure-12---api-server-flag.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-12---api-server-flag.jpg?width=2000&amp;height=332&amp;name=Figure-12---api-server-flag.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-12---api-server-flag.jpg?width=2500&amp;height=415&amp;name=Figure-12---api-server-flag.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-12---api-server-flag.jpg?width=3000&amp;height=498&amp;name=Figure-12---api-server-flag.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 12: Anonymous-auth flag is enabled in the default EKS cluster configuration. </p>
<p>As illustrated in figure 13 below, DevOps and Developers undergo authentication phase and then authorization phase. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg?width=1000&amp;height=478&amp;name=Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg" alt="Figure-13---Screen-Shot-2023-07-17-at-12.06.46" width="1000" height="478" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg?width=500&amp;height=239&amp;name=Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg?width=1000&amp;height=478&amp;name=Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg?width=1500&amp;height=717&amp;name=Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg?width=2000&amp;height=956&amp;name=Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg?width=2500&amp;height=1195&amp;name=Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg?width=3000&amp;height=1434&amp;name=Figure-13---Screen-Shot-2023-07-17-at-12.06.46.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 13: k8s authentication sequence</p>
<p>Below you can see the paradox of the k8s clusters, as illustrated in figure 14 below, anonymous unauthenticated user only undergoes one phase of authorization. It is also important to note that on most of the cloud providers the default configuration is to make the API server accessible from the internet to anyone.</p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg?width=1000&amp;height=476&amp;name=Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg" alt="Figure-14---Screen-Shot-2023-07-17-at-12.06.53" width="1000" height="476" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg?width=500&amp;height=238&amp;name=Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg?width=1000&amp;height=476&amp;name=Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg?width=1500&amp;height=714&amp;name=Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg?width=2000&amp;height=952&amp;name=Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg?width=2500&amp;height=1190&amp;name=Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg?width=3000&amp;height=1428&amp;name=Figure-14---Screen-Shot-2023-07-17-at-12.06.53.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a><span> Figure 14: k8s authentication sequence when anonymous requests are allowed</span></p>
<p>By default, the anonymous user has no permissions. But we have seen that practitioner in the wild, and in some cases, give privileges to the anonymous user. When mixing all the above, a severe misconfiguration is created.  </p>
<p>We have seen cases in which practitioners bind the anonymous user role with other roles, often with admin roles, which puts their clusters in danger. A mixture of these misconfigurations can allow attackers to gain unauthorized access to the Kubernetes cluster, potentially compromising all applications running on it as well as other environments. </p>
<p>This leads to that you’re only one YAML away from disaster. A simple misconfiguration, a mistake can lead to an exposed cluster. As you can see in the wild the following mistakes: </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-15---michael_second.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-15---michael_second.jpg?width=1000&amp;height=346&amp;name=Figure-15---michael_second.jpg" alt="Figure-15---michael_second" width="1000" height="346" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-15---michael_second.jpg?width=500&amp;height=173&amp;name=Figure-15---michael_second.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-15---michael_second.jpg?width=1000&amp;height=346&amp;name=Figure-15---michael_second.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-15---michael_second.jpg?width=1500&amp;height=519&amp;name=Figure-15---michael_second.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-15---michael_second.jpg?width=2000&amp;height=692&amp;name=Figure-15---michael_second.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-15---michael_second.jpg?width=2500&amp;height=865&amp;name=Figure-15---michael_second.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-15---michael_second.jpg?width=3000&amp;height=1038&amp;name=Figure-15---michael_second.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 15: A configuration file taken from an exposed cluster in the wild. This cluster has 7 nodes and belongs to a large company. </p>
<p><span>Misconfiguration 2 – exposed proxy </span></p>
<p>Another common misconfiguration that was widely documented in our research is a misconfiguration in the <span>‘kubectl proxy’ </span>command. As illustrated below, when you run <span>‘kubectl proxy’</span> you are forwarding authorized and authenticated requests to the API server. </p>
<p><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg?width=1000&amp;height=382&amp;name=Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg" alt="Figure-16---Screen-Shot-2023-07-17-at-12.08.26" width="1000" height="382" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg?width=500&amp;height=191&amp;name=Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg?width=1000&amp;height=382&amp;name=Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg?width=1500&amp;height=573&amp;name=Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg?width=2000&amp;height=764&amp;name=Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg?width=2500&amp;height=955&amp;name=Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg?width=3000&amp;height=1146&amp;name=Figure-16---Screen-Shot-2023-07-17-at-12.08.26.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></p>
<p>Figure 16: Running kubectl proxy on your workstation</p>
<p>When you run the same command with the following flags <span>‘--address=`0.0.0.0` --accept-hosts `.*`’</span>, the proxy on your workstation will now listen and forward authorized and authenticated requests to the API server from any host that has HTTP access to the workstation. Mind, that the privileges are the same privileges that the user who ran the <span>‘kubectl proxy’</span> command has. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg?width=1000&amp;height=392&amp;name=Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg" alt="Figure-17---Screen-Shot-2023-07-17-at-12.08.38" width="1000" height="392" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg?width=500&amp;height=196&amp;name=Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg?width=1000&amp;height=392&amp;name=Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg?width=1500&amp;height=588&amp;name=Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg?width=2000&amp;height=784&amp;name=Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg?width=2500&amp;height=980&amp;name=Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg?width=3000&amp;height=1176&amp;name=Figure-17---Screen-Shot-2023-07-17-at-12.08.38.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>Figure 17: Running kubectl proxy on your workstation, listening to the entire internet</p>
<p>Mind that some publications encourage practitioners to use the <span>‘kubectl proxy’</span> command for various purposes. For instance, various tutorials that explain about Kubernetes Dashboard installation are encouraging users to run the proxy command and do not explicitly warn about possible implications, as can be seen in these links (<a href="https://zjor.medium.com/how-to-deploy-a-dashboard-to-your-kubernetes-cluster-96c926793b80 " rel="noopener" target="_blank">one</a>, <a href="https://sysaix.com/installing-kubernetes-dashboard-on-kubernetes-cluster " rel="noopener" target="_blank">two</a>, <a href="https://janrock.medium.com/kubernetes-dashboard-token-issue-solved-6df37893bef6 " rel="noopener" target="_blank">three</a>). </p>
<h3>Summary and mitigation </h3>
<p>Throughout this blog, we explored the critical misconfigurations that often exist in the API server of Kubernetes clusters, particularly focusing on two: the binding of an admin role to an anonymous user and the worldwide exposure of the <span>`kubectl proxy`</span>. Despite the severe security implications, such misconfigurations are prevalent across organizations, irrespective of their size, indicating a gap in the understanding and management of <a href="https://www.aquasec.com/cloud-native-academy/kubernetes-in-production/kubernetes-security-best-practices-10-steps-to-securing-k8s/" rel="noopener" target="_blank">Kubernetes security.</a>  </p>
<p>We analyzed several real-world incidents where attackers exploited these misconfigurations to deploy malware, cryptominers, and backdoors. These campaigns underscored the potential risks and the extensive damage that these vulnerabilities can cause if not properly addressed.  </p>
<p>Two basic steps you can take to mitigate these risks are: </p>
<ol>
<li>
<p><span><span>Employee Training: </span>Organizations must invest in training their staff about the potential risks, best practices, and correct configurations. This will minimize human errors leading to such misconfigurations. </span></p>
</li>
<li>
<p><span>Securing <span>`kubectl proxy`</span>: </span>Ensure that the <span>`kubectl proxy` </span>is not exposed to the internet. It should be set up within a secure network environment and accessible only by authenticated and authorized users. </p>
</li>
</ol>
<p>In addition, you can leverage the Aqua platform to take further mitigation measures:  <span></span></p>
<ul>
<li><span><span>Role-Based Access Control (RBAC): </span></span><span>RBAC is a native Kubernetes feature that can limit who can access the Kubernetes API and what permissions they have. Avoid assigning the admin role to an anonymous user. Make sure to assign appropriate permissions to each user and strictly adhere to the principle of least privilege.</span></li>
<li><strong>Implementing Admission Control Policies: </strong>Kubernetes Admission Controllers can intercept requests to the Kubernetes API server before persistence, enabling you to define and enforce policies that bolster security. We strongly recommend admission controls that prevent binding any role with the anonymous role, which will harden the security posture of your Kubernetes clusters. Aqua platform allows you to set such policy which better defends your clusters.</li>
</ul>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Screenshot-2023-08-04-at-2.57.55-PM.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.57.55-PM.jpg?width=1000&amp;height=209&amp;name=Screenshot-2023-08-04-at-2.57.55-PM.jpg" alt="Screenshot-2023-08-04-at-2.57.55-PM" width="1000" height="209" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.57.55-PM.jpg?width=500&amp;height=105&amp;name=Screenshot-2023-08-04-at-2.57.55-PM.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.57.55-PM.jpg?width=1000&amp;height=209&amp;name=Screenshot-2023-08-04-at-2.57.55-PM.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.57.55-PM.jpg?width=1500&amp;height=314&amp;name=Screenshot-2023-08-04-at-2.57.55-PM.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.57.55-PM.jpg?width=2000&amp;height=418&amp;name=Screenshot-2023-08-04-at-2.57.55-PM.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.57.55-PM.jpg?width=2500&amp;height=523&amp;name=Screenshot-2023-08-04-at-2.57.55-PM.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.57.55-PM.jpg?width=3000&amp;height=627&amp;name=Screenshot-2023-08-04-at-2.57.55-PM.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>   <a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Screenshot-2023-08-04-at-2.58.19-PM.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.58.19-PM.jpg?width=1000&amp;height=504&amp;name=Screenshot-2023-08-04-at-2.58.19-PM.jpg" alt="Screenshot-2023-08-04-at-2.58.19-PM" width="1000" height="504" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.58.19-PM.jpg?width=500&amp;height=252&amp;name=Screenshot-2023-08-04-at-2.58.19-PM.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.58.19-PM.jpg?width=1000&amp;height=504&amp;name=Screenshot-2023-08-04-at-2.58.19-PM.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.58.19-PM.jpg?width=1500&amp;height=756&amp;name=Screenshot-2023-08-04-at-2.58.19-PM.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.58.19-PM.jpg?width=2000&amp;height=1008&amp;name=Screenshot-2023-08-04-at-2.58.19-PM.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.58.19-PM.jpg?width=2500&amp;height=1260&amp;name=Screenshot-2023-08-04-at-2.58.19-PM.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Screenshot-2023-08-04-at-2.58.19-PM.jpg?width=3000&amp;height=1512&amp;name=Screenshot-2023-08-04-at-2.58.19-PM.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<ul>
<li><span>Regular Auditing:</span> Implement regular auditing of your Kubernetes clusters. This allows you to track each action performed in the cluster, helping in identifying anomalies and taking quick remedial actions. </li>
</ul>
<p>Aqua&#39;s scanner for cloud native environments including containers, code repositories, VMs, Kubernetes clusters, and cloud providers allows you to obtain the <a href="https://www.aquasec.com/cloud-native-academy/supply-chain-security/sbom/" rel="noopener" target="_blank">Software Bill of Material (SBOM)</a>, find vulnerabilities and misconfigurations, sensitive information, and secrets. You can scan your Kubernetes clusters for excessive RBAC permissions and exposed workloads as recommended previously. </p>

<p>In addition, you can scan your runtime environments to get access to hundreds of events that help you understand how your systems and applications behave. Aqua can trace low level system activity as well as detect higher level security anomalies. Use Aqua to monitor your Kubernetes clusters for suspicious behaviors like the ones previously described.</p>

<p>The Kube-hunter automated penetration testing tool can be used to hunt for security weaknesses in your Kubernetes clusters. Regularly schedule Kube-hunter scans and take corrective actions based on the results. </p>
<p>As illustrated in the screenshot below, the Aqua platform allows for the running of Kube Hunter to find misconfigurations that can endanger the cluster. For instance, in the example below, the API server returns information about the cluster’s health to anonymous user, this could be marked as a failed test or alternatively to be suppressed at your disposal. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Screen-Shot-2023-08-07-at-10.01.06.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.01.06.jpg?width=1000&amp;height=667&amp;name=Screen-Shot-2023-08-07-at-10.01.06.jpg" alt="Screen-Shot-2023-08-07-at-10.01.06" width="1000" height="667" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.01.06.jpg?width=500&amp;height=334&amp;name=Screen-Shot-2023-08-07-at-10.01.06.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.01.06.jpg?width=1000&amp;height=667&amp;name=Screen-Shot-2023-08-07-at-10.01.06.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.01.06.jpg?width=1500&amp;height=1001&amp;name=Screen-Shot-2023-08-07-at-10.01.06.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.01.06.jpg?width=2000&amp;height=1334&amp;name=Screen-Shot-2023-08-07-at-10.01.06.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.01.06.jpg?width=2500&amp;height=1668&amp;name=Screen-Shot-2023-08-07-at-10.01.06.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.01.06.jpg?width=3000&amp;height=2001&amp;name=Screen-Shot-2023-08-07-at-10.01.06.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>You can click on the test and get further information, as can be seen below, which shows information about the failed inspections by the platform. In this case there is a privileged container which could allow privilege escalation if an attacker finds initial access to the cluster. Other controls such as <span>‘API server hunter’</span> may indicate that the cluster is exposed to the world or exposes secrets, a severe problem widely explained in this blog, this control can help you to mitigate the risks. </p>
<p><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Screen-Shot-2023-08-07-at-10.03.09.jpg" rel="noopener" target="_blank"><img src="https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.03.09.jpg?width=1000&amp;height=202&amp;name=Screen-Shot-2023-08-07-at-10.03.09.jpg" alt="Screen-Shot-2023-08-07-at-10.03.09" width="1000" height="202" loading="lazy" srcset="https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.03.09.jpg?width=500&amp;height=101&amp;name=Screen-Shot-2023-08-07-at-10.03.09.jpg 500w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.03.09.jpg?width=1000&amp;height=202&amp;name=Screen-Shot-2023-08-07-at-10.03.09.jpg 1000w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.03.09.jpg?width=1500&amp;height=303&amp;name=Screen-Shot-2023-08-07-at-10.03.09.jpg 1500w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.03.09.jpg?width=2000&amp;height=404&amp;name=Screen-Shot-2023-08-07-at-10.03.09.jpg 2000w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.03.09.jpg?width=2500&amp;height=505&amp;name=Screen-Shot-2023-08-07-at-10.03.09.jpg 2500w, https://blog.aquasec.com/hs-fs/hubfs/Screen-Shot-2023-08-07-at-10.03.09.jpg?width=3000&amp;height=606&amp;name=Screen-Shot-2023-08-07-at-10.03.09.jpg 3000w" sizes="(max-width: 1000px) 100vw, 1000px"/></a></p>
<p>By employing these mitigation strategies, organizations can significantly enhance their Kubernetes security, ensuring their clusters are safe from common attacks. It is important to remember that Kubernetes security is not a one-time task but a continuous process of learning, adapting, and improving as the technology and threat landscape evolve.  </p>

</span>
      </p>

      

      

    </div>
  </div>
</div>
</div>

</div><!--end row-->
</div></div>
  </body>
</html>
