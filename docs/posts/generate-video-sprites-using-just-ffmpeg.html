<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://steelcm.com/blog/generating-video-sprites-using-ffmpeg/">Original</a>
    <h1>Generate video sprites using just FFmpeg</h1>
    
    <div id="readability-page-1" class="page"><article>

  
  <p id="excerpt">Learn how to create video sprites with just FFmpeg â€” perfect for lightweight video previews.</p>
  

  <hr/>
<p>The following is an example of a video preview of the
<a href="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4">Big Buck Bunny</a>
video using a sprite sheet generated from Ffmpeg. Hover over the image to see
the preview change.</p>



<p>Save the following shell script as <code>sprite.sh</code>, and update the permissions so
you can execute it (ie. <code>chmod +x ./sprite.sh</code>).</p>
<pre><code><span>#! /usr/bin/bash</span>

<span>INPUT</span><span>=</span><span>$1</span>
<span>OUTPUT</span><span>=</span><span>$2</span>
<span>FRAMES</span><span>=</span><span>20</span>


<span>DURATION_S</span><span>=</span><span><span>$(</span>ffprobe <span>-v</span> error <span>-show_entries</span> <span>format</span><span>=</span>duration <span>-of</span> <span>default</span><span>=</span>noprint_wrappers<span>=</span><span>1</span>:nokey<span>=</span><span>1</span> $INPUT<span>)</span></span>


<span>FPS</span><span>=</span><span><span>$(</span><span>echo</span> <span>&#34;scale=8; <span>$FRAMES</span> / <span>$DURATION_S</span>&#34;</span> <span>|</span> <span>bc</span><span>)</span></span>


ffmpeg <span>\</span>
  <span>-y</span> <span>\</span>
  <span>-i</span> <span>&#34;<span>$INPUT</span>&#34;</span> <span>\</span>
  <span>-frames</span> <span>1</span> <span>\</span>
  <span>-q:v</span> <span>2</span> <span>\</span>
  <span>-filter_complex</span> <span>&#34;fps=<span>$FPS</span>,pad=width=max(iw\,ih*(16/9)):height=ow/(16/9):x=(ow-iw)/2:y=(oh-ih)/2,scale=-1:135:force_original_aspect_ratio=decrease,tile=1x<span>$FRAMES</span>&#34;</span> <span>\</span>
  <span>$OUTPUT</span></code></pre>
<p>You can then run the script as follows:</p>
<pre><code>./sprite.sh yourvideo.mp4 yourvideospritesheet.png</code></pre>
<p>The ffmpeg command can be explained as follows:</p>
<ul>
<li>
<p><code>-y</code> Override any existing output.</p>
</li>
<li>
<p><code>-i &#34;$INPUT&#34;</code> The input file.</p>
</li>
<li>
<p><code>-frames 1</code> Only output a single image (one frame).</p>
</li>
<li>
<p><code>-q:v 2</code> Ouput quality, 0 is the best.</p>
</li>
<li>
<p><code>-filter_complex</code> That&#39;s where all the magic happens.</p>
<ul>
<li><code>fps=$FPS</code> Set the desired FPS to extract the 20 frames from the entire
length of the video.</li>
<li><code>pad=width=max(iw\,ih*(16/9)):height=ow/(16/9):x=(ow-iw)/2:y=(oh-ih)/2</code> This
pads the frame into a 16:9 aspect ratio and centres it.</li>
<li><code>scale=-1:135:force_original_aspect_ratio=decrease</code> This scales the frame
down to 240x135.</li>
<li><code>tile=1x$FRAMES</code> Finally we tile our output vertically into this grid, 1
frame across, 20 frames down.</li>
</ul>
</li>
</ul>
<p>The final output image look as follows. Once combined with some basic CSS and
JS, the scrubbing preview seen at the start of this article can be achieved.</p>
<p><img src="https://steelcm.com/images/sprite.png" alt="sprite"/></p>

</article></div>
  </body>
</html>
