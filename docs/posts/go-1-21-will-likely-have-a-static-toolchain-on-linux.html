<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://utcc.utoronto.ca/~cks/space/blog/programming/Go121LinuxStaticToolchain">Original</a>
    <h1>Go 1.21 will (likely) have a static toolchain on Linux</h1>
    
    <div id="readability-page-1" class="page"><div><h2>Go 1.21 will (likely) have a static toolchain on Linux</h2>

	<p><small>April  7, 2023</small></p>
</div><div><p>A while back, <a href="https://mastodon.social/@cks/109989270338998056">I lamented on the Fediverse</a>:</p>

<blockquote><p>Current status: yak shaving a Go 1.17 built on Ubuntu 20.04 so I can
build Go 1.20 on 20.04 so I can build a binary with Go 1.20 that will
run on 20.04 for reasons.</p>
</blockquote>

<p>The easy way to solve this problem would have been to <a href="https://go.dev/dl/">download
an official binary release tarball</a>, because
these are built so that they&#39;ll run on pretty much any Linux
(presumably on a system with a very old glibc, since they&#39;re actually
dynamically linked, with <a href="https://utcc.utoronto.ca/~cks/space/blog/programming/GoAndGlibcVersioning">glibc symbol versioning</a>
only requiring 2.3.2 or later). Because I already had a whole set
of Go source trees, I picked the hard way.</p>

<p>At this point you might wonder why the Go toolchain is dynamically
linked against the system glibc. Although I haven&#39;t tried to analyze
symbol usage, the obvious assumption is that it&#39;s dynamically linked
because various Go tools want to download packages over the network,
which requires looking up DNS names, which is <a href="https://utcc.utoronto.ca/~cks/space/blog/programming/GoAndGlibcVersioning">a very common cause
of dynamically linking to glibc</a>.</p>

<p>The good news, as pointed out to me by <a href="https://tiny.tilde.website/@magical/110024172558620168">@magical</a>, is that
in Go 1.21 and later the plan is for the compiler to be built using
the pure Go resolver only and to be a static executable. Relevant
reading here is apparently <a href="https://github.com/golang/go/issues/53862">issue #53862</a> and <a href="https://github.com/golang/go/issues/57007">issue #57007</a> (<a href="https://tiny.tilde.website/@magical/110024074622100382">via</a>). As far
as I know, the elements of this plan have already landed in the Go
development version; my current development Go binaries are static
binaries.</p>

<blockquote><pre>; ./go version
go version devel go1.21-66cac9e1e4 Fri Apr 7 23:34:21 2023 +0000 linux/amd64
; ldd ./go
        not a dynamic executable
</pre>
</blockquote>

<p>Unless the Go developers revert this for some reason, Go 1.21 and later
will be static executables on Linux.</p>

<p>(Doing this before Go 1.21 is tricky <a href="https://mastodon.social/@cks/110023851992559099">for reasons beyond the scope
of this entry</a>.)</p>

<p>This is a nice little quality of life improvement for people (like
me) mostly working on recent Linuxes but who periodically have to
deal with older ones. It won&#39;t automatically make your own programs
version-independent, but for them you can use &#39;-tags osusergo,netgo&#39;
when you build or install Go programs.</p>

<p>(You might wonder why I didn&#39;t just build the Go program I needed
to run on Ubuntu 20.04 with those flags in the first place. The
answer is that I was distracted by the flow of circumstances. First
I tried to run the program on a 20.04 machine in addition to some
22.04 ones, and got <a href="https://utcc.utoronto.ca/~cks/space/blog/programming/GoAndGlibcVersioning">glibc version errors</a>,
so I tried to rebuild it on 20.04 to be more universal, then I had
the &#39;go&#39; compiler toolchain not work with the same problem, and by
that point my mental focus was on &#39;make the compiler toolchain work&#39;.)</p>
</div></div>
  </body>
</html>
