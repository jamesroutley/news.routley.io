<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://ds-security.com/post/stop-using-jwts-for-sessions/">Original</a>
    <h1>Stop using JSON Web Tokens for user sessions</h1>
    
    <div id="readability-page-1" class="page"><div>
                <h2 id="introduction">Introduction</h2>
<p>Modern web applications (so called single page applications) often utilize JSON Web tokens (JWTs) for session handling instead of cookies. However, in many cases, the logout mechanism is not effectively implemented. The most critical issue arises when an XSS vulnerability is discovered.</p>
<blockquote>
<p>Why should we even <em>logout</em> from a web application?</p>
</blockquote>
<p>For security reasons, it is advisable for users to log out from a web application once they have completed their tasks. This practice is particularly crucial for sensitive applications, such as online banking, as it reduces the attack surface and makes it significantly harder for an attacker to hijack another user’s session.</p>
<p>Frequently, when a Logout function is present in the application and is implemented with JSON Web Tokens, the application stores the JWT in an insecure location, such as the JavaScript code itself or the local storage in the user’s browser. This approach is insecure because essential flags like <code>HTTPOnly</code><sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup> are not supported. Consequently, this allows an attacker to use JavaScript to access tokens. Moreover, the logout function often merely overwrites the JWT on the client side, leaving user sessions valid until timeout.</p>
<h2 id="the-worst-part">The worst part</h2>
<p>Once an attacker discovers a Cross-Site-Scripting (XSS) vulnerability within the application, it’s “GAME OVER.” The attacker can gain access to the JWT and exploit it to access the application in the context of another user.</p>
<p>The “attack chain” is depicted in the following diagram and operates as follows:</p>
<ol>
<li>The attacker exploits a stored XSS vulnerability within the web application (e.g., in a guest comment).</li>
<li>An admin logs into the web application.</li>
<li>The web server generates the JWT and sends it to the user. The browser stores the JWT and uses it to access the web server resources with admin permissions.</li>
<li>The admin navigates to the manipulated page <code>/stored_XSS</code> that contains the attacker’s injected JavaScript code.</li>
<li>The attacker’s JavaScript code is sent to the admin.</li>
<li>The malicious JavaScript code executes in the admin’s browser. The attacker’s JavaScript code steals the admin’s JWT and sends it to the attacker.</li>
<li>The attacker can access the web application using the admin’s JWT and perform privileged admin functions.</li>
</ol>
<p><img src="https://ds-security.com/files/XSS_with_JWTs.svg" alt="Attack path exploiting XSS with JWTs.svg"/></p>
<p>We have seen this vulnerability numeros times in security assessments. In my opinion single-page application have a serious design issue when they use JWTs for authentification. This attack would not be possible with a cookie based session mechanisn where attributes like <code>HttpOnly</code> would prevents injected JavaScript Code from accessing the JWTs.</p>


            </div></div>
  </body>
</html>
