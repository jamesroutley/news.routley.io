<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>James Routley | Feed</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="../styles.css"
      media="screen"
    />
  </head>
  <body>
    <a href="/index.html">Back</a>
    <a href="https://systemsapproach.substack.com/p/its-tcp-vs-rpc-all-over-again">Original</a>
    <h1>It&#39;s TCP vs. RPC All over Again</h1>
    
    <div id="readability-page-1" class="page"><div><div><article><div class=""><div><div dir="auto"><p><span>We’ve written </span><a href="https://systemsapproach.substack.com/p/quic-is-not-a-tcp-replacement" rel="">previously</a><span> about the fact that the Internet seems to be missing a standard protocol for the request/response paradigm, with repeated attempts to force-fit TCP leading to inevitable mismatches. Sometimes we feel that we are the only people who think this way, with our networking </span><a href="https://book.systemsapproach.org/e2e/rpc.html" rel="">book</a><span> being one of the few to suggest a third paradigm beyond datagrams (UDP) and byte streams (TCP). But a lively debate on the topic has reassured us that we are not alone, as we discuss in this week’s newsletter.</span></p><p><span>Even though I’ve probably experienced enough debates about TCP to last a lifetime, I read Ivan Pepelnjak’s recent </span><a href="https://blog.ipspace.net/2023/01/data-center-tcp-replacement.html" rel="">blog post</a><span> raising objections to John Ousterhout’s position paper </span><a href="https://arxiv.org/abs/2210.00714" rel="">It’s Time to Replace TCP in the Datacenter</a><span> with considerable interest. John’s </span><a href="https://homa-transport.atlassian.net/wiki/spaces/HOMA/pages/19922945/Response+to+Ivan+Pepelnjak+s+Blog+Post" rel="">rebuttal</a><span> to Ivan’s post only piqued my interest. I have never understood why the Internet has worked so persistently to adapt TCP in support of request/reply workloads instead of standardizing an RPC transport protocol to complement TCP. Their exchange gives me a reason to revisit that question (apropos of </span><a href="https://en.wikipedia.org/wiki/Groundhog_Day_(film)" rel="">Groundhog Day</a><span>, I suppose).</span></p><p><span>Before getting to that, I want to be clear that John does not need anyone’s help defending his work. His original position paper and follow-on response are clearly argued and backed by as much data as he could lay his hands on. That does not surprise me. I remember the first paper I saw his research group present. It was at the 10th SOSP, entitled </span><a href="https://dl.acm.org/doi/10.1145/323647.323631" rel="">A Trace-Driven Analysis of the UNIX 4.2 BSD File System</a><span>, and it is worth mentioning because two years later he came back to the 11th SOSP with </span><a href="https://dl.acm.org/doi/10.1145/41457.37501" rel="">Caching in the Sprite Network File System</a><span>, describing a system that addressed the problems the analysis revealed. At the time (the mid-to-late 1980s), Sprite was one of a handful of distributed operating systems built around fast RPC mechanisms. Dave Cheriton’s </span><a href="https://dl.acm.org/doi/abs/10.1145/800217.806621" rel="">V kernel</a><span> and Andy Tanenbaum’s </span><a href="https://en.wikipedia.org/wiki/Amoeba_(operating_system)" rel="">Amoeba</a><span>  were two others. This work happened at the same time TCP was starting to get attention, in no small part because it was released as part of UNIX 4.2 BSD. To close the loop on this story, I found Sprite’s RPC mechanism to be compelling, and so adapted it to my own research on the </span><a href="https://dl.acm.org/doi/10.1145/74850.74860" rel="">x-Kernel</a><span>. That line of research later formed the basis of the </span><a href="https://book.systemsapproach.org/e2e/rpc.html" rel="">RPC Section</a><span> in our textbook. I was pleased to see Sprite RPC reincarnated in the </span><a href="https://homa-transport.atlassian.net/wiki/spaces/HOMA/overview" rel="">Homa</a><span> protocol.</span></p><p><span>It was important to me to put RPC on equal footing with TCP when we wrote the first edition of our book, in part because of the central role it played in distributed computing, and in part because you didn’t have to look far to find RPC-like behavior in the Internet: SMTP was a purpose-built RPC for email; SNMP was a purpose-built RPC for network management; DNS was a purpose-built RPC for name resolution; and then several years later, HTTP was introduced as purpose-built RPC for web resources. That we have since turned HTTP into the Internet’s </span><em><a href="https://book.systemsapproach.org/e2e/trend.html" rel="">de facto</a></em><a href="https://book.systemsapproach.org/e2e/trend.html" rel=""> RPC protocol</a><span> (and then now realizing that it is suboptimal, are trying to optimize it by collapsing all the layers into the new </span><a href="https://book.systemsapproach.org/e2e/tcp.html#quic" rel="">QUIC</a><span> protocol), is only a testament to how small a role technical rationale plays in what happens in industry. Or maybe it’s more about </span><a href="https://en.wikipedia.org/wiki/Not_invented_here" rel="">NIH</a><span>, in as much as the Internet and distributed systems communities were largely disjoint for many years. (I can count on one hand the people I saw at both SOSP and SIGCOMM during the years I actively attended both.)</span></p><p><span>Another explanation is that the Internet has unnecessarily coupled the transport protocol with the rest of the RPC framework. Conflating the two naturally follows from the purpose-built examples I just gave: SMTP is bundled with MIME; SNMP is bundled with MIB; and HTTP is bundled with HTML. But the idea of promoting a self-contained and general-purpose request/reply transport protocol as a peer of TCP goes back to 1988, and the (ultimately) thwarted attempt to standardize </span><a href="https://datatracker.ietf.org/doc/html/rfc1045" rel="">VMTP</a><span>, which was based on experience with the V kernel.</span></p><p><span>But coming back to the specific question of RPC vs TCP in the datacenter, it still has me scratching my head about why it hasn’t happened. The datacenter is a unique and self-contained environment. One explanation is that TCP is a chameleon protocol, or as I described it in another post, as much a </span><a href="https://systemsapproach.substack.com/p/tcp-the-p-is-for-platform" rel="">platform as it is a protocol</a><span>. You want individual messages instead of a byte-stream? TCP has an </span><a href="https://book.systemsapproach.org/e2e/tcp.html#record-boundaries" rel="">option</a><span> for that. In contrast, RPC is natively message-oriented. You want multiple outstanding calls without head-of-line blocking? TCP can do that by opening multiple connections. In contrast, RPC protocols decouple “logical channels” from request/reply message pairs. You want congestion control? TCP can give you one version tuned for the wide-area and another version </span><a href="https://tcpcc.systemsapproach.org/variants.html#datacenters-dctcp-on-ramp" rel="">tuned for the datacenter</a><span>. In contrast, perhaps the biggest contribution of Homa is to challenge the premise of TCP’s flow-centric approach to congestion control for datacenter workloads. You want a low-latency network stack? Well that’s a challenge TCP has a 40-year history of trying to optimize away, and when that falls short, ultimately looking to </span><a href="https://systemsapproach.substack.com/p/the-accidental-smartnic" rel="">SmartNICs</a><span> to solve. In contrast, RPC was designed from the start to optimize round-trip performance in low-latency networks. It’s difficult for me to imagine TCP ever doing better.</span></p><p><span>Maybe it comes down to a matter of judgment. Do you prefer multiple specialized tools or a single general-purpose tool? Creating the latter is the holy grail of system design, but when you consider how dominant the request/reply message exchange is in cloud computing, I find the argument for a transport protocol optimized for that use case to be more compelling. Or said another way, maybe RPC </span><em>is</em><span> the general-purpose tool, and we’ve been stubbornly trying to adapt a niche tool for far too long, creating what my former student Sean O’Malley once called a </span><a href="https://coolmaterial.com/gear/this-german-knife-from-1880-is-the-mother-of-all-swiss-army-knives/" rel="">Swiss army knife with a jacuzzi blade</a><span>.</span></p><p><span>But my original question was to ask </span><em>why</em><span> that hasn’t happened. The only answer I can come up with is that judgment often reflects biases. If you’ve been taught that TCP covers every use case (with UDP providing an escape hatch for the rare exceptions that might arise), then it’s difficult to see a request/reply transport protocol as an equally viable alternative. The emergence of QUIC lends credibility to the latter perspective, with Homa representing a second design—one that’s been optimized for the datacenter (and not limited to HTTP’s five operations).</span></p><p><span>Now that we have made it possible to pay for this newsletter, we’d like to thank the people who already signed up. Perhaps you could try asking your company to reimburse the small subscription fee as a business expense – </span><a href="https://docs.google.com/document/d/1bmYKZ-PtdIcFkbBJCPZm6w-vIt9N1dLZQYGoqHXiX18/edit?usp=sharing" rel="">here is a template</a><span> to help. </span></p><p><span>A few things that we’ve been reading this week relating to previous posts: Christian Huitema has played around with </span><a href="https://www.privateoctopus.com/2023/02/07/quic-to-mars.html" rel="">QUIC as a transport protocol for interplanetary communication</a><span>, and it wasn’t all smooth sailing. Like everyone else, the New Yorker is jumping in to help us understand ChatGPT, and we liked </span><a href="https://www.newyorker.com/tech/annals-of-technology/chatgpt-is-a-blurry-jpeg-of-the-web" rel="">this piece</a><span> which makes the analogy to lossy compression. Since giving up Twitter and </span><a href="https://systemsapproach.substack.com/p/decentralization-strikes-back" rel="">moving our social media presence</a><span> to Mastodon, we’ve been liking it over there, and </span><a href="http://@pluralistic@mamot.fr" rel="">Cory Doctorow</a><span> has thoughts about the </span><a href="https://doctorow.medium.com/of-course-mastodon-lost-users-c48ef8102891" rel="">growth in Mastodon’s user numbers</a><span>. Follow us </span><a href="https://discuss.systems/@SystemsAppr" rel="">@SystemsAppr@discuss.systems.</a></p></div></div></div></article></div></div></div>
  </body>
</html>
